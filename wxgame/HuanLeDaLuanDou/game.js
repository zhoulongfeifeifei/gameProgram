	define("filePackage.js", function(require, module, exports){ 			
!function(){function t(t){this.options=t||{locator:{}}}function e(t,e,s){function a(e){var i=t[e];if(!i)if(r)i=2==t.length?function(i){t(e,i)}:t;else for(var a=arguments.length;--a&&!(i=t[arguments[a]]););o[e]=i&&function(t){i(t+n(s))}||function(){}}if(!t){if(e instanceof i)return e;t=e}var o={},r=t instanceof Function;return s=s||{},a("warning","warn"),a("error","warn","warning"),a("fatalError","warn","warning","error"),o}function i(){this.cdata=!1}function s(t,e){e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber}function n(t){return t?"\n@"+(t.systemId||"")+"#[line:"+t.lineNumber+",col:"+t.columnNumber+"]":void 0}function a(t,e,i){return"string"==typeof t?t.substr(e,i):t.length>=e+i||e?new java.lang.String(t,e,i)+"":t}function o(t,e){t.currentElement?t.currentElement.appendChild(e):t.document.appendChild(e)}t.prototype.parseFromString=function(t,s){var n=this.options,a=new XMLReader,o=n.domBuilder||new i,r=n.errorHandler,h=n.locator,l=n.xmlns||{},c={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return h&&o.setDocumentLocator(h),a.errorHandler=e(r,o,h),a.domBuilder=n.domBuilder||o,/\/x?html?$/.test(s)&&(c.nbsp=" ",c.copy="©",l[""]="http://www.w3.org/1999/xhtml"),t?a.parse(t,l,c):a.errorHandler.error("invalid document source"),o.document},i.prototype={startDocument:function(){this.document=(new DOMImplementation).createDocument(null,null,null),this.locator&&(this.document.documentURI=this.locator.systemId)},startElement:function(t,e,i,n){var a=this.document,r=a.createElementNS(t,i||e),h=n.length;o(this,r),this.currentElement=r,this.locator&&s(this.locator,r);for(var l=0;h>l;l++){var t=n.getURI(l),c=n.getValue(l),i=n.getQName(l),d=a.createAttributeNS(t,i);d.getOffset&&s(d.getOffset(1),d),d.value=d.nodeValue=c,r.setAttributeNode(d)}},endElement:function(t,e,i){var s=this.currentElement;s.tagName;this.currentElement=s.parentNode},startPrefixMapping:function(t,e){},endPrefixMapping:function(t){},processingInstruction:function(t,e){var i=this.document.createProcessingInstruction(t,e);this.locator&&s(this.locator,i),o(this,i)},ignorableWhitespace:function(t,e,i){},characters:function(t,e,i){if(t=a.apply(this,arguments),this.currentElement&&t){if(this.cdata){var n=this.document.createCDATASection(t);this.currentElement.appendChild(n)}else{var n=this.document.createTextNode(t);this.currentElement.appendChild(n)}this.locator&&s(this.locator,n)}},skippedEntity:function(t){},endDocument:function(){this.document.normalize()},setDocumentLocator:function(t){(this.locator=t)&&(t.lineNumber=0)},comment:function(t,e,i){t=a.apply(this,arguments);var n=this.document.createComment(t);this.locator&&s(this.locator,n),o(this,n)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(t,e,i){var n=this.document.implementation;if(n&&n.createDocumentType){var a=n.createDocumentType(t,e,i);this.locator&&s(this.locator,a),o(this,a)}},warning:function(t){console.warn(t,n(this.locator))},error:function(t){console.error(t,n(this.locator))},fatalError:function(t){throw console.error(t,n(this.locator)),t}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(t){i.prototype[t]=function(){return null}}),window.DOMParser=t}(),function(){function t(t,e){for(var i in t)e[i]=t[i]}function e(e,i){function s(){}var n=e.prototype;if(Object.create){Object.create(i.prototype)}n instanceof i||(s.prototype=i.prototype,s=new s,t(n,s),e.prototype=n=s),n.constructor!=e&&("function"!=typeof e&&console.error("unknow Class:"+e),n.constructor=e)}function i(t,e){if(e instanceof Error)var s=e;else s=this,Error.call(this,tt[t]),this.message=tt[t],Error.captureStackTrace&&Error.captureStackTrace(this,i);return s.code=t,e&&(this.message=this.message+": "+e),s}function s(){}function n(t,e){this._node=t,this._refresh=e,a(this)}function a(e){var i=e._node._inc||e._node.ownerDocument._inc;if(e._inc!=i){var s=e._refresh(e._node);F(e,"length",s.length),t(s,e),e._inc=i}}function o(){}function r(t,e){for(var i=t.length;i--;)if(t[i]===e)return i}function h(t,e,i,s){if(s?e[r(e,s)]=i:e[e.length++]=i,t){i.ownerElement=t;var n=t.ownerDocument;n&&(s&&y(n,t,s),f(n,t,i))}}function l(t,e,s){var n=r(e,s);if(!(n>=0))throw i(et,new Error);for(var a=e.length-1;a>n;)e[n]=e[++n];if(e.length=a,t){var o=t.ownerDocument;o&&(y(o,t,s),s.ownerElement=null)}}function c(t){if(this._features={},t)for(var e in t)this._features=t[e]}function d(){}function u(t){return"<"==t&&"&lt;"||">"==t&&"&gt;"||"&"==t&&"&amp;"||'"'==t&&"&quot;"||"&#"+t.charCodeAt()+";"}function p(t,e){if(e(t))return!0;if(t=t.firstChild)do if(p(t,e))return!0;while(t=t.nextSibling)}function _(){}function f(t,e,i){t&&t._inc++;var s=i.namespaceURI;"http://www.w3.org/2000/xmlns/"==s&&(e._nsMap[i.prefix?i.localName:""]=i.value)}function y(t,e,i,s){t&&t._inc++;var n=i.namespaceURI;"http://www.w3.org/2000/xmlns/"==n&&delete e._nsMap[i.prefix?i.localName:""]}function m(t,e,i){if(t&&t._inc){t._inc++;var s=e.childNodes;if(i)s[s.length++]=i;else{for(var n=e.firstChild,a=0;n;)s[a++]=n,n=n.nextSibling;s.length=a}}}function g(t,e){var i=e.previousSibling,s=e.nextSibling;return i?i.nextSibling=s:t.firstChild=s,s?s.previousSibling=i:t.lastChild=i,m(t.ownerDocument,t),e}function v(t,e,i){var s=e.parentNode;if(s&&s.removeChild(e),e.nodeType===Q){var n=e.firstChild;if(null==n)return e;var a=e.lastChild}else n=a=e;var o=i?i.previousSibling:t.lastChild;n.previousSibling=o,a.nextSibling=i,o?o.nextSibling=n:t.firstChild=n,null==i?t.lastChild=a:i.previousSibling=a;do n.parentNode=t;while(n!==a&&(n=n.nextSibling));return m(t.ownerDocument||t,t),e.nodeType==Q&&(e.firstChild=e.lastChild=null),e}function C(t,e){var i=e.parentNode;if(i){var s=t.lastChild;i.removeChild(e);var s=t.lastChild}var s=t.lastChild;return e.parentNode=t,e.previousSibling=s,e.nextSibling=null,s?s.nextSibling=e:t.firstChild=e,t.lastChild=e,m(t.ownerDocument,t,e),e}function w(){this._nsMap={}}function x(){}function b(){}function S(){}function I(){}function T(){}function L(){}function k(){}function E(){}function D(){}function A(){}function B(){}function P(){}function M(t,e){switch(t.nodeType){case G:var i=t.attributes,s=i.length,n=t.firstChild,a=t.tagName,o=U===t.namespaceURI;e.push("<",a);for(var r=0;s>r;r++)M(i.item(r),e,o);if(n||o&&!/^(?:meta|link|img|br|hr|input)$/i.test(a)){if(e.push(">"),o&&/^script$/i.test(a))n&&e.push(n.data);else for(;n;)M(n,e),n=n.nextSibling;e.push("</",a,">")}else e.push("/>");return;case z:case Q:for(var n=t.firstChild;n;)M(n,e),n=n.nextSibling;return;case W:return e.push(" ",t.name,'="',t.value.replace(/[<&"]/g,u),'"');case V:return e.push(t.data.replace(/[<&]/g,u));case K:return e.push("<![CDATA[",t.data,"]]>");case q:return e.push("<!--",t.data,"-->");case J:var h=t.publicId,l=t.systemId;if(e.push("<!DOCTYPE ",t.name),h)e.push(' PUBLIC "',h),l&&"."!=l&&e.push('" "',l),e.push('">');else if(l&&"."!=l)e.push(' SYSTEM "',l,'">');else{var c=t.internalSubset;c&&e.push(" [",c,"]"),e.push(">")}return;case Y:return e.push("<?",t.target," ",t.data,"?>");case j:return e.push("&",t.nodeName,";");default:e.push("??",t.nodeName)}}function R(t,e,i){var s;switch(e.nodeType){case G:s=e.cloneNode(!1),s.ownerDocument=t;case Q:break;case W:i=!0}if(s||(s=e.cloneNode(!1)),s.ownerDocument=t,s.parentNode=null,i)for(var n=e.firstChild;n;)s.appendChild(R(t,n,i)),n=n.nextSibling;return s}function O(t,e,i){var n=new e.constructor;for(var a in e){var r=e[a];"object"!=typeof r&&r!=n[a]&&(n[a]=r)}switch(e.childNodes&&(n.childNodes=new s),n.ownerDocument=t,n.nodeType){case G:var h=e.attributes,l=n.attributes=new o,c=h.length;l._ownerElement=n;for(var d=0;c>d;d++)n.setAttributeNode(O(t,h.item(d),!0));break;case W:i=!0}if(i)for(var u=e.firstChild;u;)n.appendChild(O(t,u,i)),u=u.nextSibling;return n}function F(t,e,i){t[e]=i}function N(t){switch(t.nodeType){case 1:case 11:var e=[];for(t=t.firstChild;t;)7!==t.nodeType&&8!==t.nodeType&&e.push(N(t)),t=t.nextSibling;return e.join("");default:return t.nodeValue}}var U="http://www.w3.org/1999/xhtml",H={},G=H.ELEMENT_NODE=1,W=H.ATTRIBUTE_NODE=2,V=H.TEXT_NODE=3,K=H.CDATA_SECTION_NODE=4,j=H.ENTITY_REFERENCE_NODE=5,X=H.ENTITY_NODE=6,Y=H.PROCESSING_INSTRUCTION_NODE=7,q=H.COMMENT_NODE=8,z=H.DOCUMENT_NODE=9,J=H.DOCUMENT_TYPE_NODE=10,Q=H.DOCUMENT_FRAGMENT_NODE=11,$=H.NOTATION_NODE=12,Z={},tt={},et=(Z.INDEX_SIZE_ERR=(tt[1]="Index size error",1),Z.DOMSTRING_SIZE_ERR=(tt[2]="DOMString size error",2),Z.HIERARCHY_REQUEST_ERR=(tt[3]="Hierarchy request error",3),Z.WRONG_DOCUMENT_ERR=(tt[4]="Wrong document",4),Z.INVALID_CHARACTER_ERR=(tt[5]="Invalid character",5),Z.NO_DATA_ALLOWED_ERR=(tt[6]="No data allowed",6),Z.NO_MODIFICATION_ALLOWED_ERR=(tt[7]="No modification allowed",7),Z.NOT_FOUND_ERR=(tt[8]="Not found",8)),it=(Z.NOT_SUPPORTED_ERR=(tt[9]="Not supported",9),Z.INUSE_ATTRIBUTE_ERR=(tt[10]="Attribute in use",10));Z.INVALID_STATE_ERR=(tt[11]="Invalid state",11),Z.SYNTAX_ERR=(tt[12]="Syntax error",12),Z.INVALID_MODIFICATION_ERR=(tt[13]="Invalid modification",13),Z.NAMESPACE_ERR=(tt[14]="Invalid namespace",14),Z.INVALID_ACCESS_ERR=(tt[15]="Invalid access",15);i.prototype=Error.prototype,t(Z,i),s.prototype={length:0,item:function(t){return this[t]||null}},n.prototype.item=function(t){return a(this),this[t]},e(n,s),o.prototype={length:0,item:s.prototype.item,getNamedItem:function(t){for(var e=this.length;e--;){var i=this[e];if(i.nodeName==t)return i}},setNamedItem:function(t){var e=t.ownerElement;if(e&&e!=this._ownerElement)throw new i(it);var s=this.getNamedItem(t.nodeName);return h(this._ownerElement,this,t,s),s},setNamedItemNS:function(t){var e,s=t.ownerElement;if(s&&s!=this._ownerElement)throw new i(it);return e=this.getNamedItemNS(t.namespaceURI,t.localName),h(this._ownerElement,this,t,e),e},removeNamedItem:function(t){var e=this.getNamedItem(t);return l(this._ownerElement,this,e),e},removeNamedItemNS:function(t,e){var i=this.getNamedItemNS(t,e);return l(this._ownerElement,this,i),i},getNamedItemNS:function(t,e){for(var i=this.length;i--;){var s=this[i];if(s.localName==e&&s.namespaceURI==t)return s}return null}},c.prototype={hasFeature:function(t,e){var i=this._features[t.toLowerCase()];return!(!i||e&&!(e in i))},createDocument:function(t,e,i){var n=new _;if(n.doctype=i,i&&n.appendChild(i),n.implementation=this,n.childNodes=new s,e){var a=n.createElementNS(t,e);n.appendChild(a)}return n},createDocumentType:function(t,e,i){var s=new L;return s.name=t,s.nodeName=t,s.publicId=e,s.systemId=i,s}},d.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(t,e){return v(this,t,e)},replaceChild:function(t,e){this.insertBefore(t,e),e&&this.removeChild(e)},removeChild:function(t){return g(this,t)},appendChild:function(t){return this.insertBefore(t,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(t){return O(this.ownerDocument||this,this,t)},normalize:function(){for(var t=this.firstChild;t;){var e=t.nextSibling;e&&e.nodeType==V&&t.nodeType==V?(this.removeChild(e),t.appendData(e.data)):(t.normalize(),t=e)}},isSupported:function(t,e){return this.ownerDocument.implementation.hasFeature(t,e)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(t){for(var e=this;e;){var i=e._nsMap;if(i)for(var s in i)if(i[s]==t)return s;e=2==e.nodeType?e.ownerDocument:e.parentNode}return null},lookupNamespaceURI:function(t){for(var e=this;e;){var i=e._nsMap;if(i&&t in i)return i[t];e=2==e.nodeType?e.ownerDocument:e.parentNode}return null},isDefaultNamespace:function(t){var e=this.lookupPrefix(t);return null==e}},t(H,d),t(H,d.prototype),_.prototype={nodeName:"#document",nodeType:z,doctype:null,documentElement:null,_inc:1,insertBefore:function(t,e){if(t.nodeType==Q){for(var i=t.firstChild;i;){var s=i.nextSibling;this.insertBefore(i,e),i=s}return t}return null==this.documentElement&&1==t.nodeType&&(this.documentElement=t),v(this,t,e),t.ownerDocument=this,t},removeChild:function(t){return this.documentElement==t&&(this.documentElement=null),g(this,t)},importNode:function(t,e){return R(this,t,e)},getElementById:function(t){var e=null;return p(this.documentElement,function(i){return 1==i.nodeType&&i.getAttribute("id")==t?(e=i,!0):void 0}),e},createElement:function(t){var e=new w;e.ownerDocument=this,e.nodeName=t,e.tagName=t,e.childNodes=new s;var i=e.attributes=new o;return i._ownerElement=e,e},createDocumentFragment:function(){var t=new A;return t.ownerDocument=this,t.childNodes=new s,t},createTextNode:function(t){var e=new S;return e.ownerDocument=this,e.appendData(t),e},createComment:function(t){var e=new I;return e.ownerDocument=this,e.appendData(t),e},createCDATASection:function(t){var e=new T;return e.ownerDocument=this,e.appendData(t),e},createProcessingInstruction:function(t,e){var i=new B;return i.ownerDocument=this,i.tagName=i.target=t,i.nodeValue=i.data=e,i},createAttribute:function(t){var e=new x;return e.ownerDocument=this,e.name=t,e.nodeName=t,e.localName=t,e.specified=!0,e},createEntityReference:function(t){var e=new D;return e.ownerDocument=this,e.nodeName=t,e},createElementNS:function(t,e){var i=new w,n=e.split(":"),a=i.attributes=new o;return i.childNodes=new s,i.ownerDocument=this,i.nodeName=e,i.tagName=e,i.namespaceURI=t,2==n.length?(i.prefix=n[0],i.localName=n[1]):i.localName=e,a._ownerElement=i,i},createAttributeNS:function(t,e){var i=new x,s=e.split(":");return i.ownerDocument=this,i.nodeName=e,i.name=e,i.namespaceURI=t,i.specified=!0,2==s.length?(i.prefix=s[0],i.localName=s[1]):i.localName=e,i}},e(_,d),w.prototype={nodeType:G,hasAttribute:function(t){return null!=this.getAttributeNode(t)},getAttribute:function(t){var e=this.getAttributeNode(t);return e&&e.value||""},getAttributeNode:function(t){return this.attributes.getNamedItem(t)},setAttribute:function(t,e){var i=this.ownerDocument.createAttribute(t);i.value=i.nodeValue=""+e,this.setAttributeNode(i)},removeAttribute:function(t){var e=this.getAttributeNode(t);e&&this.removeAttributeNode(e)},appendChild:function(t){return t.nodeType===Q?this.insertBefore(t,null):C(this,t)},setAttributeNode:function(t){return this.attributes.setNamedItem(t)},setAttributeNodeNS:function(t){return this.attributes.setNamedItemNS(t)},removeAttributeNode:function(t){return this.attributes.removeNamedItem(t.nodeName)},removeAttributeNS:function(t,e){var i=this.getAttributeNodeNS(t,e);i&&this.removeAttributeNode(i)},hasAttributeNS:function(t,e){return null!=this.getAttributeNodeNS(t,e)},getAttributeNS:function(t,e){var i=this.getAttributeNodeNS(t,e);return i&&i.value||""},setAttributeNS:function(t,e,i){var s=this.ownerDocument.createAttributeNS(t,e);s.value=s.nodeValue=i,this.setAttributeNode(s)},getAttributeNodeNS:function(t,e){return this.attributes.getNamedItemNS(t,e)},getElementsByTagName:function(t){return new n(this,function(e){var i=[];return p(e,function(s){s===e||s.nodeType!=G||"*"!==t&&s.tagName!=t||i.push(s)}),i})},getElementsByTagNameNS:function(t,e){return new n(this,function(i){var s=[];return p(i,function(n){n===i||n.nodeType!==G||n.namespaceURI!==t||"*"!==e&&n.localName!=e||s.push(n)}),s})}},_.prototype.getElementsByTagName=w.prototype.getElementsByTagName,_.prototype.getElementsByTagNameNS=w.prototype.getElementsByTagNameNS,e(w,d),x.prototype.nodeType=W,e(x,d),b.prototype={data:"",substringData:function(t,e){return this.data.substring(t,t+e)},appendData:function(t){t=this.data+t,this.nodeValue=this.data=t,this.length=t.length},insertData:function(t,e){this.replaceData(t,0,e)},appendChild:function(t){throw new Error(tt[3])},deleteData:function(t,e){this.replaceData(t,e,"")},replaceData:function(t,e,i){var s=this.data.substring(0,t),n=this.data.substring(t+e);i=s+i+n,this.nodeValue=this.data=i,this.length=i.length}},e(b,d),S.prototype={nodeName:"#text",nodeType:V,splitText:function(t){var e=this.data,i=e.substring(t);e=e.substring(0,t),this.data=this.nodeValue=e,this.length=e.length;var s=this.ownerDocument.createTextNode(i);return this.parentNode&&this.parentNode.insertBefore(s,this.nextSibling),s}},e(S,b),I.prototype={nodeName:"#comment",nodeType:q},e(I,b),T.prototype={nodeName:"#cdata-section",nodeType:K},e(T,b),L.prototype.nodeType=J,e(L,d),k.prototype.nodeType=$,e(k,d),E.prototype.nodeType=X,e(E,d),D.prototype.nodeType=j,e(D,d),A.prototype.nodeName="#document-fragment",A.prototype.nodeType=Q,e(A,d),B.prototype.nodeType=Y,e(B,d),P.prototype.serializeToString=function(t){var e=[];return M(t,e),e.join("")},d.prototype.toString=function(){return P.prototype.serializeToString(this)};try{Object.defineProperty&&(Object.defineProperty(n.prototype,"length",{get:function(){return a(this),this.$$length}}),Object.defineProperty(d.prototype,"textContent",{get:function(){return N(this)},set:function(t){switch(this.nodeType){case 1:case 11:for(;this.firstChild;)this.removeChild(this.firstChild);(t||String(t))&&this.appendChild(this.ownerDocument.createTextNode(t));break;default:this.data=t,this.value=value,this.nodeValue=t}}}),F=function(t,e,i){t["$$"+e]=i})}catch(st){}window.DOMImplementation=c,window.XMLSerializer=P}(),function(){function t(){}function e(t,e,r,d,u){function p(t){if(t>65535){t-=65536;var e=55296+(t>>10),i=56320+(1023&t);return String.fromCharCode(e,i)}return String.fromCharCode(t)}function _(t){var e=t.slice(1,-1);return e in r?r[e]:"#"===e.charAt(0)?p(parseInt(e.substr(1).replace("x","0x"))):(u.error("entity not found:"+t),t)}function f(e){var i=t.substring(b,e).replace(/&#?\w+;/g,_);C&&y(b),d.characters(i,0,e-b),b=e}function y(e,i){for(;e>=g&&(i=v.exec(t));)m=i.index,g=m+i[0].length,C.lineNumber++;C.columnNumber=e-m+1}for(var m=0,g=0,v=/.+(?:\r\n?|\n)|.*$/g,C=d.locator,w=[{currentNSMap:e}],x={},b=0;;){var S=t.indexOf("<",b);if(0>S){if(!t.substr(b).match(/^\s*$/)){var I=d.document,T=I.createTextNode(t.substr(b));I.appendChild(T),d.currentElement=T}return}switch(S>b&&f(S),t.charAt(S+1)){case"/":var L=t.indexOf(">",S+3),k=t.substring(S+2,L),E=w.pop(),D=E.localNSMap;if(E.tagName!=k&&u.fatalError("end tag name: "+k+" is not match the current start tagName:"+E.tagName),d.endElement(E.uri,E.localName,k),D)for(var A in D)d.endPrefixMapping(A);L++;break;case"?":C&&y(S),L=l(t,S,d);break;case"!":C&&y(S),L=h(t,S,d,u);break;default:try{C&&y(S);var B=new c,L=s(t,S,B,_,u),P=B.length;if(P&&C){for(var M=i(C,{}),S=0;P>S;S++){var R=B[S];y(R.offset),R.offset=i(C,{})}i(M,C)}!B.closed&&o(t,L,B.tagName,x)&&(B.closed=!0,r.nbsp||u.warning("unclosed xml attribute")),n(B,d,w),"http://www.w3.org/1999/xhtml"!==B.uri||B.closed?L++:L=a(t,L,B.tagName,_,d)}catch(O){u.error("element parse error: "+O),L=-1}}0>L?f(S+1):b=L}}function i(t,e){return e.lineNumber=t.lineNumber,e.columnNumber=t.columnNumber,e}function s(t,e,i,s,n){for(var a,o,r=++e,h=f;;){var l=t.charAt(r);switch(l){case"=":if(h===y)a=t.slice(e,r),h=g;else{if(h!==m)throw new Error("attribute equal must after attrName");h=g}break;case"'":case'"':if(h===g){if(e=r+1,r=t.indexOf(l,e),!(r>0))throw new Error("attribute value no end '"+l+"' match");o=t.slice(e,r).replace(/&#?\w+;/g,s),i.add(a,o,e-1),h=C}else{if(h!=v)throw new Error('attribute value must after "="');o=t.slice(e,r).replace(/&#?\w+;/g,s),i.add(a,o,e),n.warning('attribute "'+a+'" missed start quot('+l+")!!"),e=r+1,h=C}break;case"/":switch(h){case f:i.setTagName(t.slice(e,r));case C:case w:case x:h=x,i.closed=!0;case v:case y:case m:break;default:throw new Error("attribute invalid close char('/')")}break;case"":n.error("unexpected end of input");case">":switch(h){case f:i.setTagName(t.slice(e,r));case C:case w:case x:break;case v:case y:o=t.slice(e,r),"/"===o.slice(-1)&&(i.closed=!0,o=o.slice(0,-1));case m:h===m&&(o=a),h==v?(n.warning('attribute "'+o+'" missed quot(")!!'),i.add(a,o.replace(/&#?\w+;/g,s),e)):(n.warning('attribute "'+o+'" missed value!! "'+o+'" instead!!'),i.add(o,o,e));break;case g:throw new Error("attribute value missed!!")}return r;case"":l=" ";default:if(" ">=l)switch(h){case f:i.setTagName(t.slice(e,r)),h=w;break;case y:a=t.slice(e,r),h=m;break;case v:var o=t.slice(e,r).replace(/&#?\w+;/g,s);n.warning('attribute "'+o+'" missed quot(")!!'),i.add(a,o,e);case C:h=w}else switch(h){case m:n.warning('attribute "'+a+'" missed value!! "'+a+'" instead!!'),i.add(a,a,e),e=r,h=y;break;case C:n.warning('attribute space is required"'+a+'"!!');case w:h=y,e=r;break;case g:h=v,e=r;break;case x:throw new Error("elements closed character '/' and '>' must be connected to")}}r++}}function n(t,e,i){for(var s=t.tagName,n=null,a=i[i.length-1].currentNSMap,o=t.length;o--;){var h=t[o],l=h.qName,c=h.value,d=l.indexOf(":");if(d>0)var u=h.prefix=l.slice(0,d),p=l.slice(d+1),_="xmlns"===u&&p;else p=l,u=null,_="xmlns"===l&&"";h.localName=p,_!==!1&&(null==n&&(n={},r(a,a={})),a[_]=n[_]=c,h.uri="http://www.w3.org/2000/xmlns/",e.startPrefixMapping(_,c))}for(var o=t.length;o--;){h=t[o];var u=h.prefix;u&&("xml"===u&&(h.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==u&&(h.uri=a[u]))}var d=s.indexOf(":");d>0?(u=t.prefix=s.slice(0,d),p=t.localName=s.slice(d+1)):(u=null,p=t.localName=s);var f=t.uri=a[u||""];if(e.startElement(f,p,s,t),t.closed){if(e.endElement(f,p,s),n)for(u in n)e.endPrefixMapping(u)}else t.currentNSMap=a,t.localNSMap=n,i.push(t)}function a(t,e,i,s,n){if(/^(?:script|textarea)$/i.test(i)){var a=t.indexOf("</"+i+">",e),o=t.substring(e+1,a);if(/[&<]/.test(o))return/^script$/i.test(i)?(n.characters(o,0,o.length),a):(o=o.replace(/&#?\w+;/g,s),n.characters(o,0,o.length),a)}return e+1}function o(t,e,i,s){var n=s[i];return null==n&&(n=s[i]=t.lastIndexOf("</"+i+">")),e>n}function r(t,e){for(var i in t)e[i]=t[i]}function h(t,e,i,s){var n=t.charAt(e+2);switch(n){case"-":if("-"===t.charAt(e+3)){var a=t.indexOf("-->",e+4);return a>e?(i.comment(t,e+4,a-e-4),a+3):(s.error("Unclosed comment"),-1)}return-1;default:if("CDATA["==t.substr(e+3,6)){var a=t.indexOf("]]>",e+9);return i.startCDATA(),i.characters(t,e+9,a-e-9),i.endCDATA(),a+3}var o=d(t,e),r=o.length;if(r>1&&/!doctype/i.test(o[0][0])){var h=o[1][0],l=r>3&&/^public$/i.test(o[2][0])&&o[3][0],c=r>4&&o[4][0],u=o[r-1];return i.startDTD(h,l&&l.replace(/^(['"])(.*?)\1$/,"$2"),c&&c.replace(/^(['"])(.*?)\1$/,"$2")),i.endDTD(),u.index+u[0].length}}return-1}function l(t,e,i){var s=t.indexOf("?>",e);if(s){var n=t.substring(e,s).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(n){n[0].length;return i.processingInstruction(n[1],n[2]),s+2}return-1}return-1}function c(t){}function d(t,e){var i,s=[],n=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(n.lastIndex=e,n.exec(t);i=n.exec(t);)if(s.push(i),i[1])return s}var u=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,p=new RegExp("[\\-\\.0-9"+u.source.slice(1,-1)+"·̀-ͯ\\ux203F-⁀]"),_=new RegExp("^"+u.source+p.source+"*(?::"+u.source+p.source+"*)?$"),f=0,y=1,m=2,g=3,v=4,C=5,w=6,x=7;t.prototype={parse:function(t,i,s){var n=this.domBuilder;n.startDocument(),r(i,i={}),e(t,i,s,n,this.errorHandler),n.endDocument()}},c.prototype={setTagName:function(t){if(!_.test(t))throw new Error("invalid tagName:"+t);this.tagName=t},add:function(t,e,i){if(!_.test(t))throw new Error("invalid attribute:"+t);this[this.length++]={qName:t,value:e,offset:i}},length:0,getLocalName:function(t){return this[t].localName},getOffset:function(t){return this[t].offset},getQName:function(t){return this[t].qName},getURI:function(t){return this[t].uri},getValue:function(t){return this[t].value}},window.XMLReader=t}();var policybox={mainbox:null,hideflag:!1,show:function(){},isGame:function(){var t=location.search;return t.indexOf("replay_id")<0},hide:function(){policybox.mainbox?(document.body.removeChild(policybox.mainbox),policybox.mainbox=null,policybox.hideflag=!0):policybox.hideflag||setTimeout(function(){policybox.hide()},1e3)},getCookie:function(t){return null}};window.policybox=policybox;var Laya=window.Laya=function(t,e){var i={isWXAPP:!0,__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:!0,enumerable:!1,configurable:!0},__presubstr:String.prototype.substr,__substr:function(t,e){return 1==arguments.length?i.__presubstr.call(this,t):i.__presubstr.call(this,t,e>0?e:this.length+e)},__init:function(t){t.forEach(function(t){t.__init$&&t.__init$()})},__isClass:function(t){return t&&(t.__isclass||t==Object||t==String||t==Array)},__newvec:function(t,e){var i=[];i.length=t;for(var s=0;t>s;s++)i[s]=e;return i},__extend:function(t,e){function s(){i.un(this,"constructor",t)}for(var n in e)if(e.hasOwnProperty(n)){var a=Object.getOwnPropertyDescriptor(e,n),o=a.get,r=a.set;o||r?o&&r?Object.defineProperty(t,n,a):(o&&Object.defineProperty(t,n,o),r&&Object.defineProperty(t,n,r)):t[n]=e[n]}s.prototype=e.prototype,t.prototype=new s,i.un(t.prototype,"__imps",i.__copy({},e.prototype.__imps))},__copy:function(t,e){if(!e)return null;t=t||{};for(var i in e)t[i]=e[i];return t},__package:function(e,s){if(!i.__packages[e]){i.__packages[e]=!0;var n=t,a=e.split(".");if(a.length>1)for(var o=0,r=a.length-1;r>o;o++){var h=n[a[o]];n=h?h:n[a[o]]={}}n[a[a.length-1]]||(n[a[a.length-1]]=s||{})}},__hasOwnProperty:function(t,e){function i(t,e){if(Object.hasOwnProperty.call(e.prototype,t))return!0;var s=e.prototype.__super;return null==s?null:i(t,s)}return e=e||this,Object.hasOwnProperty.call(e,t)||i(t,e.__class)},__typeof:function(t,e){if(!t||!e)return!1;if(e===String)return"string"==typeof t;if(e===Number)return"number"==typeof t;if(e.__interface__)e=e.__interface__;else if("string"!=typeof e)return t instanceof e;return t.__imps&&t.__imps[e]||t.__class==e},__as:function(t,e){return this.__typeof(t,e)?t:null},"interface":function(e,s){i.__package(e,{});var n=i.__internals,a=n[e]=n[e]||{self:e};if(s){var o=s.split(",");a.extend=[];for(var r=0;r<o.length;r++){var e=o[r];n[e]=n[e]||{self:e},a.extend.push(n[e])}}for(var h=t,l=e.split("."),r=0;r<l.length-1;r++)h=h[l[r]];h[l[l.length-1]]={__interface__:e}},"class":function(e,s,n,a){if(n&&i.__extend(e,n),s)if(i.__package(s,e),i.__classmap[s]=e,s.indexOf(".")>0){if(0==s.indexOf("laya.")){var o=s.split(".");a=a||o[o.length-1],i[a]&&console.log("Warning!,this class["+a+"] already exist:",i[a]),i[a]=e}}else"Main"==s?t.Main=e:(i[s]&&console.log("Error!,this class["+s+"] already exist:",i[s]),i[s]=e);var r=i.un,h=e.prototype;r(h,"hasOwnProperty",i.__hasOwnProperty),r(h,"__class",e),r(h,"__super",n),r(h,"__className",s),r(e,"__super",n),r(e,"__className",s),r(e,"__isclass",!0),r(e,"super",function(t){this.__super.call(t)})},imps:function(t,e){function s(t){var e,a;if((e=i.__internals[t])&&(n[t]=!0,a=e.extend))for(var o=0;o<a.length;o++)s(a[o].self)}if(!e)return null;var n=t.__imps||i.un(t,"__imps",{});for(var a in e)s(a)},getset:function(t,e,s,n,a){t?(n&&(e["_$GET_"+s]=n),a&&(e["_$SET_"+s]=a)):(n&&i.un(e,"_$get_"+s,n),a&&i.un(e,"_$set_"+s,a)),n&&a?Object.defineProperty(e,s,{get:n,set:a,enumerable:!1}):(n&&Object.defineProperty(e,s,{get:n,enumerable:!1}),a&&Object.defineProperty(e,s,{set:a,enumerable:!1}))},"static":function(t,e){function i(){var i=e[s],n=e[s+1];Object.defineProperty(t,i,{get:function(){return delete this[i],this[i]=n.call(this)},set:function(t){delete this[i],this[i]=t},enumerable:!0,configurable:!0})}for(var s=0,n=e.length;n>s;s+=2)"length"==e[s]?t.length=e[s+1].call(t):i()},un:function(t,e,s){return s||(s=t[e]),i.__propun.value=s,Object.defineProperty(t,e,i.__propun),s},uns:function(t,e){e.forEach(function(e){i.un(t,e)})}};return t.console=t.console||{log:function(){}},t.trace=t.console.log,Error.prototype.throwError=function(){throw arguments},String.prototype.substr=i.__substr,Object.defineProperty(Array.prototype,"fixed",{enumerable:!1}),i}(window,document);!function(t,e,i){i.un,i.uns,i["static"],i["class"],i.getset,i.__newvec}(window,document,Laya),function(window,document,Laya){var __un=Laya.un,__uns=Laya.uns,__static=Laya["static"],__class=Laya["class"],__getset=Laya.getset,__newvec=Laya.__newvec;Laya["interface"]("laya.runtime.IMarket"),Laya["interface"]("laya.filters.IFilter"),Laya["interface"]("laya.display.ILayout"),Laya["interface"]("laya.resource.IDispose"),Laya["interface"]("laya.runtime.IPlatform"),Laya["interface"]("laya.resource.IDestroy"),Laya["interface"]("laya.runtime.IConchNode"),Laya["interface"]("laya.filters.IFilterAction"),Laya["interface"]("laya.runtime.ICPlatformClass"),Laya["interface"]("laya.resource.ICreateResource"),Laya["interface"]("laya.runtime.IConchRenderObject"),Laya["interface"]("laya.runtime.IPlatformClass","laya.runtime.IPlatform");var RunDriver=function(){function t(){}return __class(t,"laya.utils.RunDriver"),t.FILTER_ACTIONS=[],t.pixelRatio=-1,t._charSizeTestDiv=null,t.now=function(){return Date.now()},t.getWindow=function(){return window},t.getPixelRatio=function(){if(t.pixelRatio<0){var e=Browser.context,i=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;t.pixelRatio=(Browser.window.devicePixelRatio||1)/i,t.pixelRatio<1&&(t.pixelRatio=1)}return t.pixelRatio},t.getIncludeStr=function(t){return null},t.createShaderCondition=function(t){},t.fontMap=[],t.measureText=function(e,i){var s=t.hanzi.test(e);if(s&&t.fontMap[i])return t.fontMap[i];var n=Browser.context;n.font=i;var a=n.measureText(e);return s&&(t.fontMap[i]=a),a},t.getWebGLContext=function(t){},t.beginFlush=function(){},t.endFinish=function(){},t.addToAtlas=null,t.flashFlushImage=function(t){},t.drawToCanvas=function(t,e,i,s,n,a){var o=HTMLCanvas.create("2D"),r=new RenderContext(i,s,o);return RenderSprite.renders[e]._fun(t,r,n,a),o},t.createParticleTemplate2D=null,t.createGLTextur=null,t.createWebGLContext2D=null,t.changeWebGLSize=function(t,e){},t.createRenderSprite=function(t,e){return new RenderSprite(t,e)},t.createFilterAction=function(t){return new ColorFilterAction},t.createGraphics=function(){return new Graphics},t.clear=function(t){Render._context.ctx.clear()},t.clearAtlas=function(t){},t.addTextureToAtlas=function(t){},t.getTexturePixels=function(t,e,i,s,n){return null},t.skinAniSprite=function(){return null},__static(t,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]),t}(),___Laya=function(){return __getset(1,Laya,"alertGlobalError",null,function(t){var e=0;t?Browser.window.onerror=function(t,i,s,n,a){e++<5&&a&&alert("出错啦，请把此信息截图给研发商\n"+t+"\n"+a.stack)}:Browser.window.onerror=null}),Laya.init=function(t,e,i){for(var s=[],n=2,a=arguments.length;a>n;n++)s.push(arguments[n]);if(!Laya._isinit){ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=Laya._arrayBufferSlice),Laya._isinit=!0,Browser.__init__(),Context.__init__(),Graphics.__init__(),Laya.timer=new Timer,Laya.loader=new LoaderManager;for(var n=0,o=s.length;o>n;n++)s[n].enable&&s[n].enable();return Font.__init__(),Style.__init__(),ResourceManager.__init__(),CacheManger.beginCheck(),Laya._currentStage=Laya.stage=new Stage,Laya.stage.conchModel&&Laya.stage.conchModel.setRootNode(),URL.rootPath=URL.basePath=URL.getPath(window.newBasePath),Laya.render=new Render(0,0),Laya.stage.size(t,e),RenderSprite.__init__(),KeyBoardManager.__init__(),MouseManager.instance.__init__(Laya.stage,Render.canvas),Input.__init__(),SoundManager.autoStopMusic=!0,LocalStorage.__init__(),Render.canvas}},Laya._arrayBufferSlice=function(t,e){var i=this,s=new Uint8Array(i,t,e-t),n=new Uint8Array(s.length);return n.set(s),n.buffer},Laya.stage=null,Laya.timer=null,Laya.loader=null,Laya.version="1.7.6beta",Laya.render=null,Laya._currentStage=null,Laya._isinit=!1,__static(Laya,["conchMarket",function(){return this.conchMarket=window.conch?conchMarket:null},"PlatformClass",function(){return this.PlatformClass=window.PlatformClass}]),Laya}(),Config=function(){function t(){}return __class(t,"Config"),t.WebGLTextCacheCount=500,t.atlasEnable=!1,t.showCanvasMark=!1,t.animationInterval=50,
t.isAntialias=!1,t.isAlpha=!1,t.premultipliedAlpha=!0,t.isStencil=!0,t.preserveDrawingBuffer=!1,t}(),EventDispatcher=function(){function t(){this._events=null}var e;__class(t,"laya.events.EventDispatcher");var i=t.prototype;return i.hasListener=function(t){var e=this._events&&this._events[t];return!!e},i.event=function(t,e){if(!this._events||!this._events[t])return!1;var i=this._events[t];if(i.run)i.once&&delete this._events[t],null!=e?i.runWith(e):i.run();else{for(var s=0,n=i.length;n>s;s++){var a=i[s];a&&(null!=e?a.runWith(e):a.run()),a&&!a.once||(i.splice(s,1),s--,n--)}0===i.length&&this._events&&delete this._events[t]}return!0},i.on=function(t,e,i,s){return this._createListener(t,e,i,s,!1)},i.once=function(t,e,i,s){return this._createListener(t,e,i,s,!0)},i._createListener=function(t,i,s,n,a,o){void 0===o&&(o=!0),o&&this.off(t,i,s,a);var r=e.create(i||this,s,n,a);this._events||(this._events={});var h=this._events;return h[t]?h[t].run?h[t]=[h[t],r]:h[t].push(r):h[t]=r,this},i.off=function(t,e,i,s){if(void 0===s&&(s=!1),!this._events||!this._events[t])return this;var n=this._events[t];if(null!=i)if(n.run)e&&n.caller!==e||n.method!==i||s&&!n.once||(delete this._events[t],n.recover());else{for(var a=0,o=0,r=n.length;r>o;o++){var h=n[o];!h||e&&h.caller!==e||h.method!==i||s&&!h.once||(a++,n[o]=null,h.recover())}a===r&&delete this._events[t]}return this},i.offAll=function(t){var e=this._events;if(!e)return this;if(t)this._recoverHandlers(e[t]),delete e[t];else{for(var i in e)this._recoverHandlers(e[i]);this._events=null}return this},i._recoverHandlers=function(t){if(t)if(t.run)t.recover();else for(var e=t.length-1;e>-1;e--)t[e]&&(t[e].recover(),t[e]=null)},i.isMouseEvent=function(e){return t.MOUSE_EVENTS[e]},t.MOUSE_EVENTS={rightmousedown:!0,rightmouseup:!0,rightclick:!0,mousedown:!0,mouseup:!0,mousemove:!0,mouseover:!0,mouseout:!0,click:!0,doubleclick:!0},t.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:!1,writable:!0}),e=function(t){function e(t,i,s,n){e.__super.call(this,t,i,s,n)}__class(e,"",t);var i=e.prototype;return i.recover=function(){this._id>0&&(this._id=0,e._pool.push(this.clear()))},e.create=function(t,i,s,n){return void 0===n&&(n=!0),e._pool.length?e._pool.pop().setTo(t,i,s,n):new e(t,i,s,n)},e._pool=[],e}(Handler)},t}(),Handler=function(){function t(t,e,i,s){this.once=!1,this._id=0,void 0===s&&(s=!1),this.setTo(t,e,i,s)}__class(t,"laya.utils.Handler");var e=t.prototype;return e.setTo=function(e,i,s,n){return this._id=t._gid++,this.caller=e,this.method=i,this.args=s,this.once=n,this},e.run=function(){if(null==this.method)return null;var t=this._id,e=this.method.apply(this.caller,this.args);return this._id===t&&this.once&&this.recover(),e},e.runWith=function(t){if(null==this.method)return null;var e=this._id;if(null==t)var i=this.method.apply(this.caller,this.args);else i=this.args||t.unshift?this.args?this.method.apply(this.caller,this.args.concat(t)):this.method.apply(this.caller,t):this.method.call(this.caller,t);return this._id===e&&this.once&&this.recover(),i},e.clear=function(){return this.caller=null,this.method=null,this.args=null,this},e.recover=function(){this._id>0&&(this._id=0,t._pool.push(this.clear()))},t.create=function(e,i,s,n){return void 0===n&&(n=!0),t._pool.length?t._pool.pop().setTo(e,i,s,n):new t(e,i,s,n)},t._pool=[],t._gid=1,t}(),BitmapFont=function(){function t(){this._texture=null,this._fontCharDic={},this._fontWidthMap={},this._complete=null,this._path=null,this._maxWidth=0,this._spaceWidth=10,this._padding=null,this.fontSize=12,this.autoScaleSize=!1,this.letterSpacing=0}__class(t,"laya.display.BitmapFont");var e=t.prototype;return e.loadFont=function(t,e){this._path=t,this._complete=e,Laya.loader.load([{url:this._path,type:"xml"},{url:this._path.replace(".fnt",".png"),type:"image"}],Handler.create(this,this.onLoaded))},e.onLoaded=function(){this.parseFont(Loader.getRes(this._path),Loader.getRes(this._path.replace(".fnt",".png"))),this._complete&&this._complete.run()},e.parseFont=function(t,e){if(null!=t&&null!=e){this._texture=e;var i=1,s=t.getElementsByTagName("info");this.fontSize=parseInt(s[0].attributes.size.nodeValue);var n=s[0].attributes.padding.nodeValue,a=n.split(",");this._padding=[parseInt(a[0]),parseInt(a[1]),parseInt(a[2]),parseInt(a[3])];var o=t.getElementsByTagName("char"),r=0;for(r=0;r<o.length;r++){var h=o[r].attributes,l=parseInt(h.id.nodeValue),c=parseInt(h.xoffset.nodeValue)/i,d=parseInt(h.yoffset.nodeValue)/i,u=parseInt(h.xadvance.nodeValue)/i,p=new Rectangle;p.x=parseInt(h.x.nodeValue),p.y=parseInt(h.y.nodeValue),p.width=parseInt(h.width.nodeValue),p.height=parseInt(h.height.nodeValue);var _=Texture.create(e,p.x,p.y,p.width,p.height,c,d);this._maxWidth=Math.max(this._maxWidth,u+this.letterSpacing),this._fontCharDic[l]=_,this._fontWidthMap[l]=u}}},e.getCharTexture=function(t){return this._fontCharDic[t.charCodeAt(0)]},e.destroy=function(){if(this._texture){for(var t in this._fontCharDic){var e=this._fontCharDic[t];e&&e.destroy()}this._texture.destroy(),this._fontCharDic=null,this._fontWidthMap=null,this._texture=null}},e.setSpaceWidth=function(t){this._spaceWidth=t},e.getCharWidth=function(t){var e=t.charCodeAt(0);return this._fontWidthMap[e]?this._fontWidthMap[e]+this.letterSpacing:" "==t?this._spaceWidth+this.letterSpacing:0},e.getTextWidth=function(t){for(var e=0,i=0,s=t.length;s>i;i++)e+=this.getCharWidth(t.charAt(i));return e},e.getMaxWidth=function(){return this._maxWidth},e.getMaxHeight=function(){return this.fontSize},e.drawText=function(t,e,i,s,n,a){var o,r=this.getTextWidth(t),h=0;"center"===n&&(h=(a-r)/2),"right"===n&&(h=a-r);for(var l=0,c=0,d=t.length;d>c;c++)o=this.getCharTexture(t.charAt(c)),o&&(e.graphics.drawTexture(o,i+l+h,s),l+=this.getCharWidth(t.charAt(c)))},t}(),Style=function(){function t(){this.alpha=1,this.visible=!0,this.scrollRect=null,this.blendMode=null,this._type=0,this._tf=t._TF_EMPTY}__class(t,"laya.display.css.Style");var e=t.prototype;return e.getTransform=function(){return this._tf},e.setTransform=function(e){this._tf="none"!==e&&e?e:t._TF_EMPTY},e.setTranslateX=function(e){this._tf===t._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.translateX=e},e.setTranslateY=function(e){this._tf===t._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.translateY=e},e.setScaleX=function(e){this._tf===t._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.scaleX=e},e.setScale=function(e,i){this._tf===t._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.scaleX=e,this._tf.scaleY=i},e.setScaleY=function(e){this._tf===t._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.scaleY=e},e.setRotate=function(e){this._tf===t._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.rotate=e},e.setSkewX=function(e){this._tf===t._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.skewX=e},e.setSkewY=function(e){this._tf===t._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.skewY=e},e.destroy=function(){this.scrollRect=null},e.render=function(t,e,i,s){},e.getCSSStyle=function(){return CSSStyle.EMPTY},e._enableLayout=function(){return!1},__getset(0,e,"scaleX",function(){return this._tf.scaleX},function(t){this.setScaleX(t)}),__getset(0,e,"transform",function(){return this.getTransform()},function(t){this.setTransform(t)}),__getset(0,e,"translateX",function(){return this._tf.translateX},function(t){this.setTranslateX(t)}),__getset(0,e,"translateY",function(){return this._tf.translateY},function(t){this.setTranslateY(t)}),__getset(0,e,"scaleY",function(){return this._tf.scaleY},function(t){this.setScaleY(t)}),__getset(0,e,"block",function(){return 0!=(1&this._type)}),__getset(0,e,"skewY",function(){return this._tf.skewY},function(t){this.setSkewY(t)}),__getset(0,e,"rotate",function(){return this._tf.rotate},function(t){this.setRotate(t)}),__getset(0,e,"skewX",function(){return this._tf.skewX},function(t){this.setSkewX(t)}),__getset(0,e,"paddingLeft",function(){return 0}),__getset(0,e,"paddingTop",function(){return 0}),__getset(0,e,"absolute",function(){return!0}),t.__init__=function(){t._TF_EMPTY=new TransformInfo,t.EMPTY=new t},t.EMPTY=null,t._TF_EMPTY=null,t}(),Font=function(){function t(e){this._type=0,this._weight=0,this._decoration=null,this._text=null,this.indent=0,this._color=Color.create(t.defaultColor),this.family=t.defaultFamily,this.stroke=t._STROKE,this.size=t.defaultSize,e&&e!==t.EMPTY&&e.copyTo(this)}__class(t,"laya.display.css.Font");var e=t.prototype;return e.set=function(t){this._text=null;for(var e=t.split(" "),i=0,s=e.length;s>i;i++){var n=e[i];switch(n){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}n.indexOf("px")>0&&(this.size=parseInt(n),this.family=e[i+1],i++)}},e.toString=function(){return this._text="",this.italic&&(this._text+="italic "),this.bold&&(this._text+="bold "),this._text+=this.size+"px "+this.family},e.copyTo=function(e){e._type=this._type,e._text=this._text,e._weight=this._weight,e._color=this._color,e.family=this.family,e.stroke=this.stroke!=t._STROKE?this.stroke.slice():t._STROKE,e.indent=this.indent,e.size=this.size},__getset(0,e,"password",function(){return 0!==(1024&this._type)},function(t){t?this._type|=1024:this._type&=-1025}),__getset(0,e,"color",function(){return this._color.strColor},function(t){this._color=Color.create(t)}),__getset(0,e,"italic",function(){return 0!==(512&this._type)},function(t){t?this._type|=512:this._type&=-513}),__getset(0,e,"bold",function(){return 0!==(2048&this._type)},function(t){t?this._type|=2048:this._type&=-2049}),__getset(0,e,"weight",function(){return""+this._weight},function(t){var e=0;switch(t){case"normal":break;case"bold":this.bold=!0,e=700;break;case"bolder":e=800;break;case"lighter":e=100;break;default:e=parseInt(t)}this._weight=e,this._text=null}),__getset(0,e,"decoration",function(){return this._decoration?this._decoration.value:"none"},function(t){var e=t.split(" ");switch(this._decoration||(this._decoration={}),e[0]){case"_":this._decoration.type="underline";break;case"-":this._decoration.type="line-through";break;case"overline":this._decoration.type="overline";break;default:this._decoration.type=e[0]}e[1]&&(this._decoration.color=Color.create(e)),this._decoration.value=t}),t.__init__=function(){t.EMPTY=new t(null)},t.EMPTY=null,t.defaultColor="#000000",t.defaultSize=12,t.defaultFamily="Arial",t.defaultFont="12px Arial",t._STROKE=[0,"#000000"],t._ITALIC=512,t._PASSWORD=1024,t._BOLD=2048,t}(),TransformInfo=function(){function t(){this.translateX=0,this.translateY=0,this.scaleX=1,this.scaleY=1,this.rotate=0,this.skewX=0,this.skewY=0}return __class(t,"laya.display.css.TransformInfo"),t}(),Graphics=function(){function t(){this._one=null,this._cmds=null,this._cacheBoundsType=!1,this._render=this._renderEmpty,Render.isConchNode&&(this._nativeObj=new _conchGraphics,this.id=this._nativeObj.conchID)}__class(t,"laya.display.Graphics");var e=t.prototype;return e.destroy=function(){this.clear(),this._temp=null,this._bounds=null,this._rstBoundPoints=null,this._vectorgraphArray=null,this._sp&&(this._sp._renderType=0),this._sp=null},e.clear=function(){if(this._one=null,this._render=this._renderEmpty,this._cmds=null,this._temp&&(this._temp.length=0),this._sp&&(this._sp._renderType&=-2),this._sp&&(this._sp._renderType&=-513),this._repaint(),this._vectorgraphArray){for(var t=0,e=this._vectorgraphArray.length;e>t;t++)VectorGraphManager.getInstance().deleteShape(this._vectorgraphArray[t]);this._vectorgraphArray.length=0}},e._repaint=function(){this._temp&&(this._temp.length=0),this._sp&&this._sp.repaint()},e._isOnlyOne=function(){return!this._cmds||0===this._cmds.length},e.getBounds=function(t){return void 0===t&&(t=!1),(!this._bounds||!this._temp||this._temp.length<1||t!=this._cacheBoundsType)&&(this._bounds=Rectangle._getWrapRec(this.getBoundPoints(t),this._bounds)),this._cacheBoundsType=t,this._bounds},e.getBoundPoints=function(t){return void 0===t&&(t=!1),(!this._temp||this._temp.length<1||t!=this._cacheBoundsType)&&(this._temp=this._getCmdPoints(t)),this._cacheBoundsType=t,this._rstBoundPoints=Utils.copyArray(this._rstBoundPoints,this._temp)},e._addCmd=function(t){this._cmds=this._cmds||[],t.callee=t.shift(),this._cmds.push(t)},e._getCmdPoints=function(e){void 0===e&&(e=!1);var i,s=Render._context,n=this._cmds;if(i=this._temp||(this._temp=[]),i.length=0,n||null==this._one||(t._tempCmds.length=0,t._tempCmds.push(this._one),n=t._tempCmds),!n)return i;var a;a=t._tempMatrixArrays,a.length=0;var o=t._initMatrix;o.identity();for(var r,h,l=t._tempMatrix,c=0,d=n.length;d>c;c++)switch(r=n[c],r.callee){case s._save:case 7:a.push(o),o=o.clone();break;case s._restore:case 8:o=a.pop();break;case s._scale:case 5:l.identity(),l.translate(-r[2],-r[3]),l.scale(r[0],r[1]),l.translate(r[2],r[3]),this._switchMatrix(o,l);break;case s._rotate:case 3:l.identity(),l.translate(-r[1],-r[2]),l.rotate(r[0]),l.translate(r[1],r[2]),this._switchMatrix(o,l);break;case s._translate:case 6:l.identity(),l.translate(r[0],r[1]),this._switchMatrix(o,l);break;case s._transform:case 4:l.identity(),l.translate(-r[1],-r[2]),l.concat(r[0]),l.translate(r[1],r[2]),this._switchMatrix(o,l);break;case 16:case 24:t._addPointArrToRst(i,Rectangle._getBoundPointS(r[0],r[1],r[2],r[3]),o);break;case 17:o.copyTo(l),l.concat(r[4]),t._addPointArrToRst(i,Rectangle._getBoundPointS(r[0],r[1],r[2],r[3]),l);break;case s._drawTexture:if(h=r[0],e)r[3]&&r[4]?t._addPointArrToRst(i,Rectangle._getBoundPointS(r[1],r[2],r[3],r[4]),o):(h=r[0],t._addPointArrToRst(i,Rectangle._getBoundPointS(r[1],r[2],h.width,h.height),o));else{var u=h.offsetX>0?h.offsetX:0,p=h.offsetY>0?h.offsetY:0;r[3]&&r[4]?t._addPointArrToRst(i,Rectangle._getBoundPointS(r[1]-u,r[2]-p,r[3]+h.sourceWidth-h.width,r[4]+h.sourceHeight-h.height),o):t._addPointArrToRst(i,Rectangle._getBoundPointS(r[1]-u,r[2]-p,h.width+h.sourceWidth-h.width,h.height+h.sourceHeight-h.height),o)}break;case s._fillTexture:r[3]&&r[4]?t._addPointArrToRst(i,Rectangle._getBoundPointS(r[1],r[2],r[3],r[4]),o):(h=r[0],t._addPointArrToRst(i,Rectangle._getBoundPointS(r[1],r[2],h.width,h.height),o));break;case s._drawTextureWithTransform:var _;r[5]?(o.copyTo(l),l.concat(r[5]),_=l):_=o,e?r[3]&&r[4]?t._addPointArrToRst(i,Rectangle._getBoundPointS(r[1],r[2],r[3],r[4]),_):(h=r[0],t._addPointArrToRst(i,Rectangle._getBoundPointS(r[1],r[2],h.width,h.height),_)):(h=r[0],u=h.offsetX>0?h.offsetX:0,p=h.offsetY>0?h.offsetY:0,r[3]&&r[4]?t._addPointArrToRst(i,Rectangle._getBoundPointS(r[1]-u,r[2]-p,r[3]+h.sourceWidth-h.width,r[4]+h.sourceHeight-h.height),_):t._addPointArrToRst(i,Rectangle._getBoundPointS(r[1]-u,r[2]-p,h.width+h.sourceWidth-h.width,h.height+h.sourceHeight-h.height),_));break;case s._drawRect:case 13:t._addPointArrToRst(i,Rectangle._getBoundPointS(r[0],r[1],r[2],r[3]),o);break;case s._drawCircle:case s._fillCircle:case 14:t._addPointArrToRst(i,Rectangle._getBoundPointS(r[0]-r[2],r[1]-r[2],r[2]+r[2],r[2]+r[2]),o);break;case s._drawLine:case 20:t._tempPoints.length=0;var f=NaN;f=.5*r[5],r[0]==r[2]?t._tempPoints.push(r[0]+f,r[1],r[2]+f,r[3],r[0]-f,r[1],r[2]-f,r[3]):r[1]==r[3]?t._tempPoints.push(r[0],r[1]+f,r[2],r[3]+f,r[0],r[1]-f,r[2],r[3]-f):t._tempPoints.push(r[0],r[1],r[2],r[3]),t._addPointArrToRst(i,t._tempPoints,o);break;case s._drawCurves:case 22:t._addPointArrToRst(i,Bezier.I.getBezierPoints(r[2]),o,r[0],r[1]);break;case s._drawPoly:case s._drawLines:case 18:t._addPointArrToRst(i,r[2],o,r[0],r[1]);break;case s._drawPath:case 19:t._addPointArrToRst(i,this._getPathPoints(r[2]),o,r[0],r[1]);break;case s._drawPie:case 15:t._addPointArrToRst(i,this._getPiePoints(r[0],r[1],r[2],r[3],r[4]),o)}return i.length>200?i=Utils.copyArray(i,Rectangle._getWrapRec(i)._getBoundPoints()):i.length>8&&(i=GrahamScan.scanPList(i)),i},e._switchMatrix=function(t,e){e.concat(t),e.copyTo(t)},e.drawTexture=function(t,e,i,s,n,a,o){if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===n&&(n=0),void 0===o&&(o=1),t&&!(.01>o)&&(s||(s=t.sourceWidth),n||(n=t.sourceHeight),s=s-t.sourceWidth+t.width,n=n-t.sourceHeight+t.height,!t.loaded||!(0>=s||0>=n))){e+=t.offsetX,i+=t.offsetY,this._sp&&(this._sp._renderType|=512);var r=[t,e,i,s,n,a,o];r.callee=a||1!=o?Render._context._drawTextureWithTransform:Render._context._drawTexture,null!=this._one||a||1!=o?this._saveToCmd(r.callee,r):(this._one=r,this._render=this._renderOneImg),t.loaded||t.once("loaded",this,this._textureLoaded,[t,r]),this._repaint()}},e.cleanByTexture=function(t,e,i,s,n){return void 0===s&&(s=0),void 0===n&&(n=0),t?void(this._one&&this._render===this._renderOneImg?(s||(s=t.sourceWidth),n||(n=t.sourceHeight),s=s-t.sourceWidth+t.width,n=n-t.sourceHeight+t.height,e+=t.offsetX,i+=t.offsetY,this._one[0]=t,this._one[1]=e,this._one[2]=i,this._one[3]=s,this._one[4]=n):(this.clear(),t&&this.drawTexture(t,e,i,s,n))):this.clear()},e.drawTextures=function(t,e){t&&this._saveToCmd(Render._context._drawTextures,[t,e])},e.fillTexture=function(t,e,i,s,n,a,o){if(void 0===s&&(s=0),void 0===n&&(n=0),void 0===a&&(a="repeat"),t){var r=[t,e,i,s,n,a,o||Point.EMPTY,{}];t.loaded||t.once("loaded",this,this._textureLoaded,[t,r]),this._saveToCmd(Render._context._fillTexture,r)}},e._textureLoaded=function(t,e){e[3]=e[3]||t.width,e[4]=e[4]||t.height,this._repaint()},e._saveToCmd=function(t,e){return this._sp&&(this._sp._renderType|=512),null==this._one?(this._one=e,this._render=this._renderOne):(this._sp&&(this._sp._renderType&=-2),this._render=this._renderAll,0===(this._cmds||(this._cmds=[])).length&&this._cmds.push(this._one),this._cmds.push(e)),e.callee=t,this._temp&&(this._temp.length=0),this._repaint(),e},e.clipRect=function(t,e,i,s){this._saveToCmd(Render._context._clipRect,[t,e,i,s])},e.fillText=function(t,e,i,s,n,a){this._saveToCmd(Render._context._fillText,[t,e,i,s||Font.defaultFont,n,a])},e.fillBorderText=function(t,e,i,s,n,a,o,r){this._saveToCmd(Render._context._fillBorderText,[t,e,i,s||Font.defaultFont,n,a,o,r])},e.strokeText=function(t,e,i,s,n,a,o){this._saveToCmd(Render._context._strokeText,[t,e,i,s||Font.defaultFont,n,a,o])},e.alpha=function(t){this._saveToCmd(Render._context._alpha,[t])},e.transform=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this._saveToCmd(Render._context._transform,[t,e,i])},e.rotate=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this._saveToCmd(Render._context._rotate,[t,e,i])},e.scale=function(t,e,i,s){void 0===i&&(i=0),void 0===s&&(s=0),this._saveToCmd(Render._context._scale,[t,e,i,s])},e.translate=function(t,e){this._saveToCmd(Render._context._translate,[t,e])},e.save=function(){this._saveToCmd(Render._context._save,[])},e.restore=function(){this._saveToCmd(Render._context._restore,[])},e.replaceText=function(t){this._repaint();var e=this._cmds;if(e){for(var i=e.length-1;i>-1;i--)if(this._isTextCmd(e[i].callee))return e[i][0].toUpperCase?e[i][0]=t:e[i][0].setText(t),!0}else if(this._one&&this._isTextCmd(this._one.callee))return this._one[0].toUpperCase?this._one[0]=t:this._one[0].setText(t),!0;return!1},e._isTextCmd=function(t){return t===Render._context._fillText||t===Render._context._fillBorderText||t===Render._context._strokeText},e.replaceTextColor=function(t){this._repaint();var e=this._cmds;if(e)for(var i=e.length-1;i>-1;i--)this._isTextCmd(e[i].callee)&&(e[i][4]=t,e[i][0].toUpperCase||(e[i][0].changed=!0));else this._one&&this._isTextCmd(this._one.callee)&&(this._one[4]=t,this._one[0].toUpperCase||(this._one[0].changed=!0))},e.loadImage=function(t,e,i,s,n,a){function o(t){t&&(r.drawTexture(t,e,i,s,n),null!=a&&a.call(r._sp,t))}var r=this;void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===n&&(n=0);var h=Loader.getRes(t);h?o(h):Laya.loader.load(t,Handler.create(null,o),null,"image")},e._renderEmpty=function(t,e,i,s){},e._renderAll=function(t,e,i,s){for(var n,a=this._cmds,o=0,r=a.length;r>o;o++)(n=a[o]).callee.call(e,i,s,n)},e._renderOne=function(t,e,i,s){this._one.callee.call(e,i,s,this._one)},e._renderOneImg=function(t,e,i,s){this._one.callee.call(e,i,s,this._one),2305!==t._renderType&&(t._renderType|=1)},e.drawLine=function(t,e,i,s,n,a){void 0===a&&(a=1);var o=0;Render.isWebGL&&(o=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(o));var r=a%2===0?0:.5,h=[t+r,e+r,i+r,s+r,n,a,o];this._saveToCmd(Render._context._drawLine,h)},e.drawLines=function(t,e,i,s,n){void 0===n&&(n=1);var a=0;if(i&&!(i.length<1)){Render.isWebGL&&(a=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(a));var o=n%2===0?0:.5,r=[t+o,e+o,i,s,n,a];this._saveToCmd(Render._context._drawLines,r)}},e.drawCurves=function(t,e,i,s,n){void 0===n&&(n=1);var a=[t,e,i,s,n];this._saveToCmd(Render._context._drawCurves,a)},e.drawRect=function(t,e,i,s,n,a,o){void 0===o&&(o=1);var r=a?o/2:0,h=a?o:0,l=[t+r,e+r,i-h,s-h,n,a,o];this._saveToCmd(Render._context._drawRect,l)},e.drawCircle=function(t,e,i,s,n,a){void 0===a&&(a=1);var o=n?a/2:0,r=0;Render.isWebGL&&(r=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(r));var h=[t,e,i-o,s,n,a,r];this._saveToCmd(Render._context._drawCircle,h)},e.drawPie=function(t,e,i,s,n,a,o,r){void 0===r&&(r=1);var h=o?r/2:0,l=o?r:0,c=0;Render.isWebGL&&(c=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(c));var d=[t+h,e+h,i-l,s,n,a,o,r,c];d[3]=Utils.toRadian(s),d[4]=Utils.toRadian(n),this._saveToCmd(Render._context._drawPie,d)},e._getPiePoints=function(e,i,s,n,a){var o=t._tempPoints;t._tempPoints.length=0,o.push(e,i);var r=Math.PI/10,h=NaN;for(h=n;a>h;h+=r)o.push(e+s*Math.cos(h),i+s*Math.sin(h));return a!=h&&o.push(e+s*Math.cos(a),i+s*Math.sin(a)),o},e.drawPoly=function(t,e,i,s,n,a){void 0===a&&(a=1);var o=0;if(Render.isWebGL){o=VectorGraphManager.getInstance().getId(),null==this._vectorgraphArray&&(this._vectorgraphArray=[]),this._vectorgraphArray.push(o);var r=!1;r=!(i.length>6)}var h=n?a%2===0?0:.5:0,l=[t+h,e+h,i,s,n,a,o,r];this._saveToCmd(Render._context._drawPoly,l)},e._getPathPoints=function(e){var i=0,s=0,n=t._tempPoints;n.length=0,s=e.length;var a;for(i=0;s>i;i++)a=e[i],a.length>1&&(n.push(a[1],a[2]),a.length>3&&n.push(a[3],a[4]));return n},e.drawPath=function(t,e,i,s,n){var a=[t,e,i,s,n];this._saveToCmd(Render._context._drawPath,a)},__getset(0,e,"cmds",function(){return this._cmds},function(t){this._sp&&(this._sp._renderType|=512),this._cmds=t,this._render=this._renderAll,this._repaint()}),t.__init__=function(){if(Render.isConchNode){for(var t=laya.display.Graphics.prototype,e=ConchGraphics.prototype,i=["clear","destroy","alpha","rotate","transform","scale","translate","save","restore","clipRect","blendMode","fillText","fillBorderText","_fands","drawRect","drawCircle","drawPie","drawPoly","drawPath","drawImageM","drawLine","drawLines","_drawPs","drawCurves","replaceText","replaceTextColor","_fillImage","fillTexture","setSkinMesh","drawParticle","drawImageS"],s=0,n=i.length;n>=s;s++){var a=i[s];t[a]=e[a]}t._saveToCmd=null,e.drawImageS&&(t.drawTextures=function(t,e){if(t&&t.loaded&&t.bitmap&&t.source){var i=t.uv,s=t.bitmap.width,n=t.bitmap.height;this.drawImageS(t.bitmap.source,i[0]*s,i[1]*n,(i[2]-i[0])*s,(i[5]-i[3])*n,t.offsetX,t.offsetY,t.width,t.height,e)}}),t.drawTexture=function(t,e,i,s,n,a,o){if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===n&&(n=0),void 0===o&&(o=1),t){if(!t.loaded)return void t.once("loaded",this,function(){this.drawTexture(t,e,i,s,n,a)});if(t.loaded&&t.bitmap&&t.source&&(s||(s=t.sourceWidth),n||(n=t.sourceHeight),s=s-t.sourceWidth+t.width,n=n-t.sourceHeight+t.height,!(0>=s||0>=n))){e+=t.offsetX,i+=t.offsetY;var r=t.uv,h=t.bitmap.width,l=t.bitmap.height;this.drawImageM(t.bitmap.source,r[0]*h,r[1]*l,(r[2]-r[0])*h,(r[5]-r[3])*l,e,i,s,n,a,o),this._repaint()}}},t.fillTexture=function(t,e,i,s,n,a,o){if(void 0===s&&(s=0),void 0===n&&(n=0),void 0===a&&(a="repeat"),t&&t.loaded){var r,h=Render._context.ctx,l=t.bitmap.width,c=t.bitmap.height,d=t.uv;r=t.uv!=Texture.DEF_UV?h.createPattern(t.bitmap.source,a,d[0]*l,d[1]*c,(d[2]-d[0])*l,(d[5]-d[3])*c):h.createPattern(t.bitmap.source,a);var u=0,p=0;o&&(e+=o.x%t.width,i+=o.y%t.height,u-=o.x%t.width,p-=o.y%t.height),this._fillImage(r,e,i,u,p,s,n)}}}},t._addPointArrToRst=function(e,i,s,n,a){void 0===n&&(n=0),void 0===a&&(a=0);var o=0,r=0;for(r=i.length,o=0;r>o;o+=2)t._addPointToRst(e,i[o]+n,i[o+1]+a,s)},t._addPointToRst=function(t,e,i,s){var n=Point.TEMP;n.setTo(e?e:0,i?i:0),s.transformPoint(n),t.push(n.x,n.y)},t._tempPoints=[],t._tempMatrixArrays=[],t._tempCmds=[],__static(t,["_tempMatrix",function(){return this._tempMatrix=new Matrix},"_initMatrix",function(){return this._initMatrix=new Matrix}]),t}(),Event=function(){function t(){}__class(t,"laya.events.Event");var e=t.prototype;return e.setTo=function(t,e,i){return this.type=t,this.currentTarget=e,this.target=i,this},e.stopPropagation=function(){this._stoped=!0},__getset(0,e,"stageY",function(){return Laya.stage.mouseY}),__getset(0,e,"charCode",function(){return this.nativeEvent.charCode}),__getset(0,e,"touches",function(){var t=this.nativeEvent.touches;if(t)for(var e=Laya.stage,i=0,s=t.length;s>i;i++){var n=t[i],a=Point.TEMP;a.setTo(n.clientX,n.clientY),e._canvasTransform.invertTransformPoint(a),e.transform.invertTransformPoint(a),n.stageX=a.x,n.stageY=a.y}return t}),__getset(0,e,"keyLocation",function(){return this.nativeEvent.keyLocation}),__getset(0,e,"ctrlKey",function(){return this.nativeEvent.ctrlKey}),__getset(0,e,"altKey",function(){return this.nativeEvent.altKey}),__getset(0,e,"shiftKey",function(){return this.nativeEvent.shiftKey}),__getset(0,e,"stageX",function(){return Laya.stage.mouseX}),t.EMPTY=new t,t.MOUSE_DOWN="mousedown",t.MOUSE_UP="mouseup",t.CLICK="click",t.RIGHT_MOUSE_DOWN="rightmousedown",t.RIGHT_MOUSE_UP="rightmouseup",t.RIGHT_CLICK="rightclick",t.MOUSE_MOVE="mousemove",t.MOUSE_OVER="mouseover",t.MOUSE_OUT="mouseout",t.MOUSE_WHEEL="mousewheel",t.ROLL_OVER="mouseover",t.ROLL_OUT="mouseout",t.DOUBLE_CLICK="doubleclick",t.CHANGE="change",t.CHANGED="changed",t.RESIZE="resize",t.ADDED="added",t.REMOVED="removed",t.DISPLAY="display",t.UNDISPLAY="undisplay",t.ERROR="error",t.COMPLETE="complete",t.LOADED="loaded",t.PROGRESS="progress",t.INPUT="input",t.RENDER="render",t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.KEY_DOWN="keydown",t.KEY_PRESS="keypress",t.KEY_UP="keyup",t.FRAME="enterframe",t.DRAG_START="dragstart",t.DRAG_MOVE="dragmove",t.DRAG_END="dragend",t.ENTER="enter",t.SELECT="select",t.BLUR="blur",t.FOCUS="focus",t.VISIBILITY_CHANGE="visibilitychange",t.FOCUS_CHANGE="focuschange",t.PLAYED="played",t.PAUSED="paused",t.STOPPED="stopped",t.START="start",t.END="end",t.ENABLE_CHANGED="enablechanged",t.ACTIVE_IN_HIERARCHY_CHANGED="activeinhierarchychanged",t.COMPONENT_ADDED="componentadded",t.COMPONENT_REMOVED="componentremoved",t.LAYER_CHANGED="layerchanged",t.HIERARCHY_LOADED="hierarchyloaded",t.RECOVERING="recovering",t.RECOVERED="recovered",t.RELEASED="released",t.LINK="link",t.LABEL="label",t.FULL_SCREEN_CHANGE="fullscreenchange",t.DEVICE_LOST="devicelost",t.MESH_CHANGED="meshchanged",t.MATERIAL_CHANGED="materialchanged",t.RENDERQUEUE_CHANGED="renderqueuechanged",t.WORLDMATRIX_NEEDCHANGE="worldmatrixneedchanged",t.ANIMATION_CHANGED="animationchanged",t}(),Keyboard=function(){function t(){}return __class(t,"laya.events.Keyboard"),t.NUMBER_0=48,t.NUMBER_1=49,t.NUMBER_2=50,t.NUMBER_3=51,t.NUMBER_4=52,t.NUMBER_5=53,t.NUMBER_6=54,t.NUMBER_7=55,t.NUMBER_8=56,t.NUMBER_9=57,t.A=65,t.B=66,t.C=67,t.D=68,t.E=69,t.F=70,t.G=71,t.H=72,t.I=73,t.J=74,t.K=75,t.L=76,t.M=77,t.N=78,t.O=79,t.P=80,t.Q=81,t.R=82,t.S=83,t.T=84,t.U=85,t.V=86,t.W=87,t.X=88,t.Y=89,t.Z=90,t.F1=112,t.F2=113,t.F3=114,t.F4=115,t.F5=116,t.F6=117,t.F7=118,t.F8=119,t.F9=120,t.F10=121,t.F11=122,t.F12=123,t.F13=124,t.F14=125,t.F15=126,t.NUMPAD=21,t.NUMPAD_0=96,t.NUMPAD_1=97,t.NUMPAD_2=98,t.NUMPAD_3=99,t.NUMPAD_4=100,t.NUMPAD_5=101,t.NUMPAD_6=102,t.NUMPAD_7=103,t.NUMPAD_8=104,t.NUMPAD_9=105,t.NUMPAD_ADD=107,t.NUMPAD_DECIMAL=110,t.NUMPAD_DIVIDE=111,t.NUMPAD_ENTER=108,t.NUMPAD_MULTIPLY=106,t.NUMPAD_SUBTRACT=109,t.SEMICOLON=186,t.EQUAL=187,t.COMMA=188,t.MINUS=189,t.PERIOD=190,t.SLASH=191,t.BACKQUOTE=192,t.LEFTBRACKET=219,t.BACKSLASH=220,t.RIGHTBRACKET=221,t.QUOTE=222,t.ALTERNATE=18,t.BACKSPACE=8,t.CAPS_LOCK=20,t.COMMAND=15,t.CONTROL=17,t.DELETE=46,t.ENTER=13,t.ESCAPE=27,t.PAGE_UP=33,t.PAGE_DOWN=34,t.END=35,t.HOME=36,t.LEFT=37,t.UP=38,t.RIGHT=39,t.DOWN=40,t.SHIFT=16,t.SPACE=32,t.TAB=9,t.INSERT=45,t}(),KeyBoardManager=function(){function t(){}return __class(t,"laya.events.KeyBoardManager"),t.__init__=function(){t._addEvent("keydown"),t._addEvent("keypress"),t._addEvent("keyup")},t._addEvent=function(t){Browser.document.addEventListener(t,function(e){laya.events.KeyBoardManager._dispatch(e,t)},!0)},t._dispatch=function(e,i){if(t.enabled){t._event._stoped=!1,t._event.nativeEvent=e,t._event.keyCode=e.keyCode||e.which||e.charCode,"keydown"===i?t._pressKeys[t._event.keyCode]=!0:"keyup"===i&&(t._pressKeys[t._event.keyCode]=null);for(var s=Laya.stage.focus&&null!=Laya.stage.focus.event&&Laya.stage.focus.displayedInStage?Laya.stage.focus:Laya.stage,n=s;n;)n.event(i,t._event.setTo(i,n,s)),n=n.parent}},t.hasKeyDown=function(e){return t._pressKeys[e]},t._pressKeys={},t.enabled=!0,__static(t,["_event",function(){return this._event=new Event}]),t}(),KeyLocation=function(){function t(){}return __class(t,"laya.events.KeyLocation"),t.STANDARD=0,t.LEFT=1,t.RIGHT=2,t.NUM_PAD=3,t}(),MouseManager=function(){function t(){this.mouseX=0,this.mouseY=0,this.disableMouseEvent=!1,this.mouseDownTime=0,this.mouseMoveAccuracy=2,this._stage=null,this._target=null,this._lastMoveTimer=0,this._isLeftMouse=!1,this._eventList=[],this._touchIDs={},this._id=1,this._tTouchID=0,this._event=new Event,this._matrix=new Matrix,this._point=new Point,this._rect=new Rectangle,this._prePoint=new Point,this._curTouchID=NaN}__class(t,"laya.events.MouseManager");var e=t.prototype;return e.__init__=function(e,i){this._stage=e;var s=this,n=this._eventList;i.oncontextmenu=function(e){return t.enabled?!1:void 0},i.addEventListener("mousedown",function(e){t.enabled&&(Browser.onIE||e.preventDefault(),n.push(e),s.mouseDownTime=Browser.now())}),i.addEventListener("mouseup",function(e){t.enabled&&(e.preventDefault(),n.push(e),s.mouseDownTime=-Browser.now())},!0),i.addEventListener("mousemove",function(e){if(t.enabled){e.preventDefault();var i=Browser.now();if(i-s._lastMoveTimer<10)return;s._lastMoveTimer=i,n.push(e)}},!0),i.addEventListener("mouseout",function(e){t.enabled&&n.push(e)}),i.addEventListener("mouseover",function(e){t.enabled&&n.push(e)}),i.addEventListener("touchstart",function(e){t.enabled&&(n.push(e),Input.isInputting||e.preventDefault(),s.mouseDownTime=Browser.now())}),i.addEventListener("touchend",function(e){t.enabled&&(Input.isInputting||e.preventDefault(),n.push(e),s.mouseDownTime=-Browser.now())},!0),i.addEventListener("touchmove",function(e){t.enabled&&(e.preventDefault(),n.push(e))},!0),i.addEventListener("mousewheel",function(e){t.enabled&&n.push(e)}),i.addEventListener("DOMMouseScroll",function(e){t.enabled&&n.push(e)})},e.initEvent=function(t,e){var i=this;i._event._stoped=!1,i._event.nativeEvent=e||t,i._target=null,this._point.setTo(t.pageX||t.clientX,t.pageY||t.clientY),this._stage._canvasTransform.invertTransformPoint(this._point),i.mouseX=this._point.x,i.mouseY=this._point.y,i._event.touchId=t.identifier||0,this._tTouchID=i._event.touchId;var s;s=TouchManager.I._event,s._stoped=!1,s.nativeEvent=i._event.nativeEvent,s.touchId=i._event.touchId},e.checkMouseWheel=function(t){this._event.delta=t.wheelDelta?.025*t.wheelDelta:-t.detail;for(var e=TouchManager.I.getLastOvers(),i=0,s=e.length;s>i;i++){var n=e[i];n.event("mousewheel",this._event.setTo("mousewheel",n,this._target))}},e.onMouseMove=function(t){TouchManager.I.onMouseMove(t,this._tTouchID)},e.onMouseDown=function(t){if(Input.isInputting&&Laya.stage.focus&&Laya.stage.focus.focus&&!Laya.stage.focus.contains(this._target)){var e=Laya.stage.focus._tf||Laya.stage.focus,i=t._tf||t;
i instanceof laya.display.Input&&i.multiline==e.multiline?e._focusOut():e.focus=!1}TouchManager.I.onMouseDown(t,this._tTouchID,this._isLeftMouse)},e.onMouseUp=function(t){TouchManager.I.onMouseUp(t,this._tTouchID,this._isLeftMouse)},e.check=function(t,e,i,s){this._point.setTo(e,i),t.fromParentPoint(this._point),e=this._point.x,i=this._point.y;var n=t.scrollRect;if(n&&(this._rect.setTo(n.x,n.y,n.width,n.height),!this._rect.contains(e,i)))return!1;if(!this.disableMouseEvent){if(t.hitTestPrior&&!t.mouseThrough&&!this.hitTest(t,e,i))return!1;for(var a=t._childs.length-1;a>-1;a--){var o=t._childs[a];if(!o.destroyed&&o.mouseEnabled&&o.visible&&this.check(o,e,i,s))return!0}}var r=!t.hitTestPrior||t.mouseThrough||this.disableMouseEvent?this.hitTest(t,e,i):!0;return r?(this._target=t,s.call(this,t)):s===this.onMouseUp&&t===this._stage&&(this._target=this._stage,s.call(this,this._target)),r},e.hitTest=function(t,e,i){var s=!1;if(t.scrollRect&&(e-=t.scrollRect.x,i-=t.scrollRect.y),t.hitArea instanceof laya.utils.HitArea)return t.hitArea.isHit(e,i);if(t.width>0&&t.height>0||t.mouseThrough||t.hitArea)if(t.mouseThrough)s=t.getGraphicBounds().contains(e,i);else{var n=this._rect;t.hitArea?n=t.hitArea:n.setTo(0,0,t.width,t.height),s=n.contains(e,i)}return s},e.runEvent=function(){var e=this._eventList.length;if(e){for(var i=this,s=0;e>s;){var n=this._eventList[s];switch("mousemove"!==n.type&&(this._prePoint.x=this._prePoint.y=-1e6),n.type){case"mousedown":this._touchIDs[0]=this._id++,t._isTouchRespond?t._isTouchRespond=!1:(i._isLeftMouse=0===n.button,i.initEvent(n),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseDown));break;case"mouseup":i._isLeftMouse=0===n.button,i.initEvent(n),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseUp);break;case"mousemove":Math.abs(this._prePoint.x-n.clientX)+Math.abs(this._prePoint.y-n.clientY)>=this.mouseMoveAccuracy&&(this._prePoint.x=n.clientX,this._prePoint.y=n.clientY,i.initEvent(n),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseMove));break;case"touchstart":t._isTouchRespond=!0,i._isLeftMouse=!0;for(var a=n.changedTouches,o=0,r=a.length;r>o;o++){var h=a[o];(t.multiTouchEnabled||isNaN(this._curTouchID))&&(this._curTouchID=h.identifier,this._id%200===0&&(this._touchIDs={}),this._touchIDs[h.identifier]=this._id++,i.initEvent(h,n),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseDown))}break;case"touchend":t._isTouchRespond=!0,i._isLeftMouse=!0;var l=n.changedTouches;for(o=0,r=l.length;r>o;o++)if(h=l[o],t.multiTouchEnabled||h.identifier==this._curTouchID){this._curTouchID=NaN,i.initEvent(h,n);var c=!1;c=i.check(i._stage,i.mouseX,i.mouseY,i.onMouseUp),c||i.onMouseUp(null)}break;case"touchmove":var d=n.changedTouches;for(o=0,r=d.length;r>o;o++)h=d[o],(t.multiTouchEnabled||h.identifier==this._curTouchID)&&(i.initEvent(h,n),i.check(i._stage,i.mouseX,i.mouseY,i.onMouseMove));break;case"wheel":case"mousewheel":case"DOMMouseScroll":i.checkMouseWheel(n);break;case"mouseout":i._stage.event("mouseout",i._event.setTo("mouseout",i._stage,i._stage));break;case"mouseover":i._stage.event("mouseover",i._event.setTo("mouseover",i._stage,i._stage))}s++}this._eventList.length=0}},t.enabled=!0,t.multiTouchEnabled=!0,t._isTouchRespond=!1,__static(t,["instance",function(){return this.instance=new t}]),t}(),TouchManager=function(){function t(){this.preOvers=[],this.preDowns=[],this.preRightDowns=[],this.enable=!0,this._lastClickTime=0,this._event=new Event}__class(t,"laya.events.TouchManager");var e=t.prototype;return e.getTouchFromArr=function(t,e){var i=0,s=0;s=e.length;var n;for(i=0;s>i;i++)if(n=e[i],n.id==t)return n;return null},e.removeTouchFromArr=function(t,e){var i=0;for(i=e.length-1;i>=0;i--)e[i].id==t&&e.splice(i,1)},e.createTouchO=function(t,e){var i;return i=Pool.getItem("TouchData")||{},i.id=e,i.tar=t,i},e.onMouseDown=function(e,i,s){if(void 0===s&&(s=!1),this.enable){var n,a,o;n=this.getTouchFromArr(i,this.preOvers),o=this.getEles(e,null,t._tEleArr),n?n.tar=e:(a=this.createTouchO(e,i),this.preOvers.push(a)),Browser.onMobile&&this.sendEvents(o,"mouseover",i);var r;r=s?this.preDowns:this.preRightDowns,n=this.getTouchFromArr(i,r),n?n.tar=e:(a=this.createTouchO(e,i),r.push(a)),this.sendEvents(o,s?"mousedown":"rightmousedown",i)}},e.sendEvents=function(t,e,i){void 0===i&&(i=0);var s=0,n=0;n=t.length,this._event._stoped=!1;var a;a=t[0];var o;for(s=0;n>s;s++){if(o=t[s],o.destroyed)return;if(o.event(e,this._event.setTo(e,o,a)),this._event._stoped)break}},e.getEles=function(t,e,i){for(i?i.length=0:i=[];t&&t!=e;)i.push(t),t=t.parent;return i},e.checkMouseOutAndOverOfMove=function(e,i,s){if(void 0===s&&(s=0),i!=e){var n,a,o=0,r=0;if(i.contains(e))a=this.getEles(e,i,t._tEleArr),this.sendEvents(a,"mouseover",s);else if(e.contains(i))a=this.getEles(i,e,t._tEleArr),this.sendEvents(a,"mouseout",s);else{a=t._tEleArr,a.length=0;var h;h=this.getEles(i,null,t._oldArr);var l;l=this.getEles(e,null,t._newArr),r=h.length;var c=0;for(o=0;r>o;o++){if(n=h[o],c=l.indexOf(n),c>=0){l.splice(c,l.length-c);break}a.push(n)}a.length>0&&this.sendEvents(a,"mouseout",s),l.length>0&&this.sendEvents(l,"mouseover",s)}}},e.onMouseMove=function(e,i){if(this.enable){var s;s=this.getTouchFromArr(i,this.preOvers);var n;n=this.getEles(e,null,t._tEleArr);s?(this.checkMouseOutAndOverOfMove(e,s.tar),s.tar=e):(this.sendEvents(n,"mouseover",i),this.preOvers.push(this.createTouchO(e,i))),this.sendEvents(n,"mousemove",i)}},e.getLastOvers=function(){return t._tEleArr.length=0,this.preOvers.length>0&&this.preOvers[0].tar?this.getEles(this.preOvers[0].tar,null,t._tEleArr):(t._tEleArr.push(Laya.stage),t._tEleArr)},e.onMouseUp=function(e,i,s){if(void 0===s&&(s=!1),this.enable){var n,a,o,r,h,l=0,c=0,d=Browser.onMobile;a=this.getEles(e,null,t._tEleArr),this.sendEvents(a,s?"mouseup":"rightmouseup",i);var u;if(u=s?this.preDowns:this.preRightDowns,n=this.getTouchFromArr(i,u)){var p=!1,_=Browser.now();if(p=_-this._lastClickTime<300,this._lastClickTime=_,e==n.tar)h=a;else for(o=this.getEles(n.tar,null,t._oldArr),h=t._newArr,h.length=0,c=o.length,l=0;c>l;l++)r=o[l],a.indexOf(r)>=0&&h.push(r);h.length>0&&this.sendEvents(h,s?"click":"rightclick",i),s&&p&&this.sendEvents(h,"doubleclick",i),this.removeTouchFromArr(i,u),n.tar=null,Pool.recover("TouchData",n)}else;n=this.getTouchFromArr(i,this.preOvers),n&&d&&(h=this.getEles(n.tar,null,h),h&&h.length>0&&this.sendEvents(h,"mouseout",i),this.removeTouchFromArr(i,this.preOvers),n.tar=null,Pool.recover("TouchData",n))}},t._oldArr=[],t._newArr=[],t._tEleArr=[],__static(t,["I",function(){return this.I=new t}]),t}(),Filter=function(){function t(){this._action=null}__class(t,"laya.filters.Filter");var e=t.prototype;return Laya.imps(e,{"laya.filters.IFilter":!0}),e.callNative=function(t){},__getset(0,e,"type",function(){return-1}),__getset(0,e,"action",function(){return this._action}),t.BLUR=16,t.COLOR=32,t.GLOW=8,t._filterStart=null,t._filterEnd=null,t._EndTarget=null,t._recycleScope=null,t._filter=null,t._useSrc=null,t._endSrc=null,t._useOut=null,t._endOut=null,t}(),ColorFilterAction=function(){function t(){this.data=null}__class(t,"laya.filters.ColorFilterAction");var e=t.prototype;return Laya.imps(e,{"laya.filters.IFilterAction":!0}),e.apply=function(t){var e=t.ctx.ctx,i=t.ctx.ctx.canvas;if(0==i.width||0==i.height)return i;for(var s,n=e.getImageData(0,0,i.width,i.height),a=n.data,o=0,r=a.length;r>o;o+=4)s=this.getColor(a[o],a[o+1],a[o+2],a[o+3]),0!=a[o+3]&&(a[o]=s[0],a[o+1]=s[1],a[o+2]=s[2],a[o+3]=s[3]);return e.putImageData(n,0,0),t},e.getColor=function(t,e,i,s){var n=[];if(this.data._mat&&this.data._alpha){var a=this.data._mat,o=this.data._alpha;n[0]=a[0]*t+a[1]*e+a[2]*i+a[3]*s+o[0],n[1]=a[4]*t+a[5]*e+a[6]*i+a[7]*s+o[1],n[2]=a[8]*t+a[9]*e+a[10]*i+a[11]*s+o[2],n[3]=a[12]*t+a[13]*e+a[14]*i+a[15]*s+o[3]}return n},t}(),Arith=function(){function t(){}return __class(t,"laya.maths.Arith"),t.formatR=function(t){return t>Math.PI&&(t-=2*Math.PI),t<-Math.PI&&(t+=2*Math.PI),t},t.isPOT=function(t,e){return t>0&&0===(t&t-1)&&e>0&&0===(e&e-1)},t.setMatToArray=function(t,e){t.a,t.b,t.c,t.d,t.tx+20,t.ty+20,1,e[0]=t.a,e[1]=t.b,e[4]=t.c,e[5]=t.d,e[12]=t.tx,e[13]=t.ty},t}(),Bezier=function(){function t(){this._controlPoints=[new Point,new Point,new Point],this._calFun=this.getPoint2}__class(t,"laya.maths.Bezier");var e=t.prototype;return e._switchPoint=function(t,e){var i=this._controlPoints.shift();i.setTo(t,e),this._controlPoints.push(i)},e.getPoint2=function(t,e){var i=this._controlPoints[0],s=this._controlPoints[1],n=this._controlPoints[2],a=Math.pow(1-t,2)*i.x+2*t*(1-t)*s.x+Math.pow(t,2)*n.x,o=Math.pow(1-t,2)*i.y+2*t*(1-t)*s.y+Math.pow(t,2)*n.y;e.push(a,o)},e.getPoint3=function(t,e){var i=this._controlPoints[0],s=this._controlPoints[1],n=this._controlPoints[2],a=this._controlPoints[3],o=Math.pow(1-t,3)*i.x+3*s.x*t*(1-t)*(1-t)+3*n.x*t*t*(1-t)+a.x*Math.pow(t,3),r=Math.pow(1-t,3)*i.y+3*s.y*t*(1-t)*(1-t)+3*n.y*t*t*(1-t)+a.y*Math.pow(t,3);e.push(o,r)},e.insertPoints=function(t,e){var i=NaN;t=t>0?t:5;var s=NaN;for(s=1/t,i=0;1>=i;i+=s)this._calFun(i,e)},e.getBezierPoints=function(t,e,i){void 0===e&&(e=5),void 0===i&&(i=2);var s=0,n=0;if(n=t.length,2*(i+1)>n)return[];var a;switch(a=[],i){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}for(;this._controlPoints.length<=i;)this._controlPoints.push(new Point);for(s=0;2*i>s;s+=2)this._switchPoint(t[s],t[s+1]);for(s=2*i;n>s;s+=2)this._switchPoint(t[s],t[s+1]),s/2%i==0&&this.insertPoints(e,a);return a},__static(t,["I",function(){return this.I=new t}]),t}(),GrahamScan=function(){function t(){}return __class(t,"laya.maths.GrahamScan"),t.multiply=function(t,e,i){return(t.x-i.x)*(e.y-i.y)-(e.x-i.x)*(t.y-i.y)},t.dis=function(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)},t._getPoints=function(e,i,s){for(void 0===i&&(i=!1),t._mPointList||(t._mPointList=[]);t._mPointList.length<e;)t._mPointList.push(new Point);return s||(s=[]),s.length=0,i?t.getFrom(s,t._mPointList,e):t.getFromR(s,t._mPointList,e),s},t.getFrom=function(t,e,i){var s=0;for(s=0;i>s;s++)t.push(e[s]);return t},t.getFromR=function(t,e,i){var s=0;for(s=0;i>s;s++)t.push(e.pop());return t},t.pListToPointList=function(e,i){void 0===i&&(i=!1);var s=0,n=e.length/2,a=t._getPoints(n,i,t._tempPointList);for(s=0;n>s;s++)a[s].setTo(e[s+s],e[s+s+1]);return a},t.pointListToPlist=function(e){var i,s=0,n=e.length,a=t._temPList;for(a.length=0,s=0;n>s;s++)i=e[s],a.push(i.x,i.y);return a},t.scanPList=function(e){return Utils.copyArray(e,t.pointListToPlist(t.scan(t.pListToPointList(e,!0))))},t.scan=function(e){var i,s,n,a=0,o=0,r=0,h=e.length,l={};for(s=t._temArr,s.length=0,h=e.length,a=h-1;a>=0;a--)i=e[a],n=i.x+"_"+i.y,l.hasOwnProperty(n)||(l[n]=!0,s.push(i));for(h=s.length,Utils.copyArray(e,s),a=1;h>a;a++)(e[a].y<e[r].y||e[a].y==e[r].y&&e[a].x<e[r].x)&&(r=a);for(i=e[0],e[0]=e[r],e[r]=i,a=1;h-1>a;a++){for(r=a,o=a+1;h>o;o++)(t.multiply(e[o],e[r],e[0])>0||0==t.multiply(e[o],e[r],e[0])&&t.dis(e[0],e[o])<t.dis(e[0],e[r]))&&(r=o);i=e[a],e[a]=e[r],e[r]=i}if(s=t._temArr,s.length=0,e.length<3)return Utils.copyArray(s,e);for(s.push(e[0],e[1],e[2]),a=3;h>a;a++){for(;s.length>=2&&t.multiply(e[a],s[s.length-1],s[s.length-2])>=0;)s.pop();e[a]&&s.push(e[a])}return s},t._mPointList=null,t._tempPointList=[],t._temPList=[],t._temArr=[],t}(),MathUtil=function(){function t(){}return __class(t,"laya.maths.MathUtil"),t.subtractVector3=function(t,e,i){i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2]},t.lerp=function(t,e,i){return t*(1-i)+e*i},t.scaleVector3=function(t,e,i){i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e},t.lerpVector3=function(t,e,i,s){var n=t[0],a=t[1],o=t[2];s[0]=n+i*(e[0]-n),s[1]=a+i*(e[1]-a),s[2]=o+i*(e[2]-o)},t.lerpVector4=function(t,e,i,s){var n=t[0],a=t[1],o=t[2],r=t[3];s[0]=n+i*(e[0]-n),s[1]=a+i*(e[1]-a),s[2]=o+i*(e[2]-o),s[3]=r+i*(e[3]-r)},t.slerpQuaternionArray=function(t,e,i,s,n,a,o){var r,h,l,c,d,u=t[e+0],p=t[e+1],_=t[e+2],f=t[e+3],y=i[s+0],m=i[s+1],g=i[s+2],v=i[s+3];return h=u*y+p*m+_*g+f*v,0>h&&(h=-h,y=-y,m=-m,g=-g,v=-v),1-h>1e-6?(r=Math.acos(h),l=Math.sin(r),c=Math.sin((1-n)*r)/l,d=Math.sin(n*r)/l):(c=1-n,d=n),a[o+0]=c*u+d*y,a[o+1]=c*p+d*m,a[o+2]=c*_+d*g,a[o+3]=c*f+d*v,a},t.getRotation=function(t,e,i,s){return Math.atan2(s-e,i-t)/Math.PI*180},t.sortBigFirst=function(t,e){return t==e?0:e>t?1:-1},t.sortSmallFirst=function(t,e){return t==e?0:e>t?-1:1},t.sortNumBigFirst=function(t,e){return parseFloat(e)-parseFloat(t)},t.sortNumSmallFirst=function(t,e){return parseFloat(t)-parseFloat(e)},t.sortByKey=function(e,i,s){void 0===i&&(i=!1),void 0===s&&(s=!0);var n;return n=i?s?t.sortNumBigFirst:t.sortBigFirst:s?t.sortNumSmallFirst:t.sortSmallFirst,function(t,i){return n(t[e],i[e])}},t}(),Matrix=function(){function t(t,e,i,s,n,a){this.inPool=!1,this.bTransform=!1,void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=1),void 0===n&&(n=0),void 0===a&&(a=0),this.a=t,this.b=e,this.c=i,this.d=s,this.tx=n,this.ty=a,this._checkTransform()}__class(t,"laya.maths.Matrix");var e=t.prototype;return e.identity=function(){return this.a=this.d=1,this.b=this.tx=this.ty=this.c=0,this.bTransform=!1,this},e._checkTransform=function(){return this.bTransform=1!==this.a||0!==this.b||0!==this.c||1!==this.d},e.setTranslate=function(t,e){return this.tx=t,this.ty=e,this},e.translate=function(t,e){return this.tx+=t,this.ty+=e,this},e.scale=function(t,e){this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this.bTransform=!0},e.rotate=function(t){var e=Math.cos(t),i=Math.sin(t),s=this.a,n=this.c,a=this.tx;this.a=s*e-this.b*i,this.b=s*i+this.b*e,this.c=n*e-this.d*i,this.d=n*i+this.d*e,this.tx=a*e-this.ty*i,this.ty=a*i+this.ty*e,this.bTransform=!0},e.skew=function(t,e){var i=Math.tan(t),s=Math.tan(e),n=this.a,a=this.b;return this.a+=s*this.c,this.b+=s*this.d,this.c+=i*n,this.d+=i*a,this},e.invertTransformPoint=function(t){var e=this.a,i=this.b,s=this.c,n=this.d,a=this.tx,o=e*n-i*s,r=n/o,h=-i/o,l=-s/o,c=e/o,d=(s*this.ty-n*a)/o,u=-(e*this.ty-i*a)/o;return t.setTo(r*t.x+l*t.y+d,h*t.x+c*t.y+u)},e.transformPoint=function(t){return t.setTo(this.a*t.x+this.c*t.y+this.tx,this.b*t.x+this.d*t.y+this.ty)},e.transformPointN=function(t){return t.setTo(this.a*t.x+this.c*t.y,this.b*t.x+this.d*t.y)},e.transformPointArray=function(t,e){for(var i=t.length,s=0;i>s;s+=2){var n=t[s],a=t[s+1];e[s]=this.a*n+this.c*a+this.tx,e[s+1]=this.b*n+this.d*a+this.ty}return e},e.transformPointArrayScale=function(t,e){for(var i=t.length,s=0;i>s;s+=2){var n=t[s],a=t[s+1];e[s]=this.a*n+this.c*a,e[s+1]=this.b*n+this.d*a}return e},e.getScaleX=function(){return 0===this.b?this.a:Math.sqrt(this.a*this.a+this.b*this.b)},e.getScaleY=function(){return 0===this.c?this.d:Math.sqrt(this.c*this.c+this.d*this.d)},e.invert=function(){var t=this.a,e=this.b,i=this.c,s=this.d,n=this.tx,a=t*s-e*i;return this.a=s/a,this.b=-e/a,this.c=-i/a,this.d=t/a,this.tx=(i*this.ty-s*n)/a,this.ty=-(t*this.ty-e*n)/a,this},e.setTo=function(t,e,i,s,n,a){return this.a=t,this.b=e,this.c=i,this.d=s,this.tx=n,this.ty=a,this},e.concat=function(t){var e=this.a,i=this.c,s=this.tx;return this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d,this.tx=s*t.a+this.ty*t.c+t.tx,this.ty=s*t.b+this.ty*t.d+t.ty,this},e.scaleEx=function(t,e){var i=this.a,s=this.b,n=this.c,a=this.d;0!==s||0!==n?(this.a=t*i,this.b=t*s,this.c=e*n,this.d=e*a):(this.a=t*i,this.b=0*a,this.c=0*i,this.d=e*a),this.bTransform=!0},e.rotateEx=function(t){var e=Math.cos(t),i=Math.sin(t),s=this.a,n=this.b,a=this.c,o=this.d;0!==n||0!==a?(this.a=e*s+i*a,this.b=e*n+i*o,this.c=-i*s+e*a,this.d=-i*n+e*o):(this.a=e*s,this.b=i*o,this.c=-i*s,this.d=e*o),this.bTransform=!0},e.clone=function(){var e=t._cache,i=e._length?e[--e._length]:new t;return i.a=this.a,i.b=this.b,i.c=this.c,i.d=this.d,i.tx=this.tx,i.ty=this.ty,i.bTransform=this.bTransform,i},e.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t.bTransform=this.bTransform,t},e.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty},e.destroy=function(){if(!this.inPool){var e=t._cache;this.inPool=!0,e._length||(e._length=0),e[e._length++]=this,this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.bTransform=!1}},t.mul=function(t,e,i){var s=t.a,n=t.b,a=t.c,o=t.d,r=t.tx,h=t.ty,l=e.a,c=e.b,d=e.c,u=e.d,p=e.tx,_=e.ty;return 0!==c||0!==d?(i.a=s*l+n*d,i.b=s*c+n*u,i.c=a*l+o*d,i.d=a*c+o*u,i.tx=l*r+d*h+p,i.ty=c*r+u*h+_):(i.a=s*l,i.b=n*u,i.c=a*l,i.d=o*u,i.tx=l*r+p,i.ty=u*h+_),i},t.mul16=function(t,e,i){var s=t.a,n=t.b,a=t.c,o=t.d,r=t.tx,h=t.ty,l=e.a,c=e.b,d=e.c,u=e.d,p=e.tx,_=e.ty;return 0!==c||0!==d?(i[0]=s*l+n*d,i[1]=s*c+n*u,i[4]=a*l+o*d,i[5]=a*c+o*u,i[12]=l*r+d*h+p,i[13]=c*r+u*h+_):(i[0]=s*l,i[1]=n*u,i[4]=a*l,i[5]=o*u,i[12]=l*r+p,i[13]=u*h+_),i},t.mulPre=function(t,e,i,s,n,a,o,r){var h=t.a,l=t.b,c=t.c,d=t.d,u=t.tx,p=t.ty;return 0!==i||0!==s?(r.a=h*e+l*s,r.b=h*i+l*n,r.c=c*e+d*s,r.d=c*i+d*n,r.tx=e*u+s*p+a,r.ty=i*u+n*p+o):(r.a=h*e,r.b=l*n,r.c=c*e,r.d=d*n,r.tx=e*u+a,r.ty=n*p+o),r},t.mulPos=function(t,e,i,s,n,a,o,r){var h=t.a,l=t.b,c=t.c,d=t.d,u=t.tx,p=t.ty;return 0!==l||0!==c?(r.a=e*h+i*c,r.b=e*l+i*d,r.c=s*h+n*c,r.d=s*l+n*d,r.tx=h*a+c*o+u,r.ty=l*a+d*o+p):(r.a=e*h,r.b=i*d,r.c=s*h,r.d=n*d,r.tx=h*a+u,r.ty=d*o+p),r},t.preMul=function(t,e,i){var s=t.a,n=t.b,a=t.c,o=t.d,r=e.a,h=e.b,l=e.c,c=e.d,d=e.tx,u=e.ty;return i.a=r*s,i.b=i.c=0,i.d=c*o,i.tx=d*s+t.tx,i.ty=u*o+t.ty,0===h&&0===l&&0===n&&0===a||(i.a+=h*a,i.d+=l*n,i.b+=r*n+h*o,i.c+=l*s+c*a,i.tx+=u*a,i.ty+=d*n),i},t.preMulXY=function(t,e,i,s){var n=t.a,a=t.b,o=t.c,r=t.d;return s.a=n,s.b=a,s.c=o,s.d=r,s.tx=e*n+t.tx+i*o,s.ty=i*r+t.ty+e*a,s},t.create=function(){var e=t._cache,i=e._length?e[--e._length]:new t;return i.inPool=!1,i},t.EMPTY=new t,t.TEMP=new t,t._cache=[],t}(),Point=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}__class(t,"laya.maths.Point");var e=t.prototype;return e.setTo=function(t,e){return this.x=t,this.y=e,this},e.distance=function(t,e){return Math.sqrt((this.x-t)*(this.x-t)+(this.y-e)*(this.y-e))},e.toString=function(){return this.x+","+this.y},e.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(t>0){var e=1/t;this.x*=e,this.y*=e}},t.TEMP=new t,t.EMPTY=new t,t}(),Rectangle=function(){function t(t,e,i,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=0),this.x=t,this.y=e,this.width=i,this.height=s}__class(t,"laya.maths.Rectangle");var e=t.prototype;return e.setTo=function(t,e,i,s){return this.x=t,this.y=e,this.width=i,this.height=s,this},e.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},e.contains=function(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.right&&e>=this.y&&e<this.bottom},e.intersects=function(t){return!(t.x>this.x+this.width||t.x+t.width<this.x||t.y>this.y+this.height||t.y+t.height<this.y)},e.intersection=function(e,i){return this.intersects(e)?(i||(i=new t),i.x=Math.max(this.x,e.x),i.y=Math.max(this.y,e.y),i.width=Math.min(this.right,e.right)-i.x,i.height=Math.min(this.bottom,e.bottom)-i.y,i):null},e.union=function(e,i){return i||(i=new t),this.clone(i),e.width<=0||e.height<=0?i:(i.addPoint(e.x,e.y),i.addPoint(e.right,e.bottom),this)},e.clone=function(e){return e||(e=new t),e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},e.toString=function(){return this.x+","+this.y+","+this.width+","+this.height},e.equals=function(t){return!(!t||t.x!==this.x||t.y!==this.y||t.width!==this.width||t.height!==this.height)},e.addPoint=function(t,e){return this.x>t&&(this.width+=this.x-t,this.x=t),this.y>e&&(this.height+=this.y-e,this.y=e),this.width<t-this.x&&(this.width=t-this.x),this.height<e-this.y&&(this.height=e-this.y),this},e._getBoundPoints=function(){var e=t._temB;return e.length=0,0==this.width||0==this.height?e:(e.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height),e)},e.isEmpty=function(){return this.width<=0||this.height<=0},__getset(0,e,"right",function(){return this.x+this.width}),__getset(0,e,"bottom",function(){return this.y+this.height}),t._getBoundPointS=function(e,i,s,n){var a=t._temA;return a.length=0,0==s||0==n?a:(a.push(e,i,e+s,i,e,i+n,e+s,i+n),a)},t._getWrapRec=function(e,i){if(!e||e.length<1)return i?i.setTo(0,0,0,0):t.TEMP.setTo(0,0,0,0);i=i?i:new t;var s,n,a,o,r,h=e.length,l=Point.TEMP;for(n=o=99999,a=r=-n,s=0;h>s;s+=2)l.x=e[s],l.y=e[s+1],n=n<l.x?n:l.x,o=o<l.y?o:l.y,a=a>l.x?a:l.x,r=r>l.y?r:l.y;return i.setTo(n,o,a-n,r-o)},t.EMPTY=new t,t.TEMP=new t,t._temB=[],t._temA=[],t}(),SoundManager=function(){function t(){}return __class(t,"laya.media.SoundManager"),__getset(1,t,"autoStopMusic",function(){return t._autoStopMusic},function(e){Laya.stage.off("blur",null,t._stageOnBlur),Laya.stage.off("focus",null,t._stageOnFocus),t._autoStopMusic=e,e&&(Laya.stage.on("blur",null,t._stageOnBlur),Laya.stage.on("focus",null,t._stageOnFocus))}),__getset(1,t,"muted",function(){return t._muted},function(e){e&&t.stopAllSound(),t.musicMuted=e,t._muted=e}),__getset(1,t,"musicMuted",function(){return t._musicMuted},function(e){e?(t._tMusic&&t.stopSound(t._tMusic),t._musicMuted=e):(t._musicMuted=e,t._tMusic&&t.playMusic(t._tMusic))}),__getset(1,t,"soundMuted",function(){return t._soundMuted},function(e){t._soundMuted=e}),t.addChannel=function(e){t._channels.indexOf(e)>=0||t._channels.push(e)},t.removeChannel=function(e){var i=0;for(i=t._channels.length-1;i>=0;i--)t._channels[i]==e&&t._channels.splice(i,1)},t._stageOnBlur=function(){t._musicChannel&&(t._musicChannel.isStopped||(t._blurPaused=!0,t._musicLoops=t._musicChannel.loops,t._musicCompleteHandler=t._musicChannel.completeHandler,t._musicPosition=t._musicChannel.position,t._musicChannel.stop(),Laya.stage.once("mousedown",null,t._stageOnFocus)))},t._stageOnFocus=function(){Laya.stage.off("mousedown",null,t._stageOnFocus),t._blurPaused&&(t.playMusic(t._tMusic,t._musicLoops,t._musicCompleteHandler,t._musicPosition),t._blurPaused=!1)},t.playSound=function(e,i,s,n,a){if(void 0===i&&(i=1),void 0===a&&(a=0),t._muted)return null;if(e=URL.formatURL(e),e==t._tMusic){if(t._musicMuted)return null}else if(t._soundMuted)return null;var o=Laya.loader.getRes(e);n||(n=t._soundClass),o||(o=new n,o.load(e),Loader.cacheRes(e,o));var r;return r=o.play(a,i),r.url=e,r.volume=e==t._tMusic?t.musicVolume:t.soundVolume,r.completeHandler=s,r},t.destroySound=function(t){var e=Laya.loader.getRes(t);e&&(Loader.clearRes(t),e.dispose())},t.playMusic=function(e,i,s,n){return void 0===i&&(i=0),void 0===n&&(n=0),e=URL.formatURL(e),t._tMusic=e,t._musicChannel&&t._musicChannel.stop(),t._musicChannel=t.playSound(e,i,s,null,n)},t.stopSound=function(e){e=URL.formatURL(e);var i,s=0;for(s=t._channels.length-1;s>=0;s--)i=t._channels[s],i.url==e&&i.stop()},t.stopAll=function(){t._tMusic=null;var e,i=0;for(i=t._channels.length-1;i>=0;i--)e=t._channels[i],e.stop()},t.stopAllSound=function(){var e,i=0;for(i=t._channels.length-1;i>=0;i--)e=t._channels[i],e.url!=t._tMusic&&e.stop()},t.stopMusic=function(){t._tMusic=null,t._musicChannel&&t._musicChannel.stop()},t.setSoundVolume=function(e,i){if(i)i=URL.formatURL(i),t._setVolume(i,e);else{t.soundVolume=e;var s,n=0;for(n=t._channels.length-1;n>=0;n--)s=t._channels[n],s.url!=t._tMusic&&(s.volume=e)}},t.setMusicVolume=function(e){t.musicVolume=e,t._setVolume(t._tMusic,e)},t._setVolume=function(e,i){var s,n=0;for(n=t._channels.length-1;n>=0;n--)s=t._channels[n],s.url==e&&(s.volume=i)},t.musicVolume=1,t.soundVolume=1,t.playbackRate=1,t._muted=!1,t._soundMuted=!1,t._musicMuted=!1,t._tMusic=null,t._musicChannel=null,t._channels=[],t._autoStopMusic=!1,t._blurPaused=!1,t._musicLoops=0,t._musicPosition=0,t._musicCompleteHandler=null,t._soundClass=null,t}(),LocalStorage=function(){function t(){}var e;return __class(t,"laya.net.LocalStorage"),t.__init__=function(){t._baseClass||(t._baseClass=e,e.init()),t.items=t._baseClass.items,t.support=t._baseClass.support},t.setItem=function(e,i){t._baseClass.setItem(e,i)},t.getItem=function(e){return t._baseClass.getItem(e)},t.setJSON=function(e,i){t._baseClass.setJSON(e,i)},t.getJSON=function(e){return t._baseClass.getJSON(e)},t.removeItem=function(e){t._baseClass.removeItem(e)},t.clear=function(){t._baseClass.clear()},t._baseClass=null,t.items=null,t.support=!1,t.__init$=function(){e=function(){function t(){}return __class(t,""),t.init=function(){try{t.items=window.localStorage,t.setItem("laya","1"),t.removeItem("laya"),t.support=!0}catch(e){}t.support||console.log("LocalStorage is not supprot or browser is private mode.")},t.setItem=function(e,i){try{t.support&&t.items.setItem(e,i)}catch(s){console.warn("set localStorage failed",s)}},t.getItem=function(e){return t.support?t.items.getItem(e):null},t.setJSON=function(e,i){try{t.support&&t.items.setItem(e,JSON.stringify(i))}catch(s){console.warn("set localStorage failed",s)}},t.getJSON=function(e){return JSON.parse(t.support?t.items.getItem(e):null)},t.removeItem=function(e){t.support&&t.items.removeItem(e)},t.clear=function(){t.support&&t.items.clear()},t.items=null,t.support=!0,t}()},t}(),ResourceVersion=function(){function t(){}return __class(t,"laya.net.ResourceVersion"),t.enable=function(e,i){Laya.loader.load(e,Handler.create(null,t.onManifestLoaded,[i]),null,"json"),URL.customFormat=t.addVersionPrefix},t.onManifestLoaded=function(e,i){t.manifest=i,e.run(),i||console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")},t.addVersionPrefix=function(e){return t.manifest&&t.manifest[e]?t.manifest[e]+"/"+e:e},t.manifest=null,t}(),URL=function(){function t(e){this._url=null,this._path=null,this._url=t.formatURL(e),this._path=t.getPath(e)}__class(t,"laya.net.URL");var e=t.prototype;return __getset(0,e,"path",function(){return this._path}),__getset(0,e,"url",function(){return this._url}),t.formatURL=function(e,i){if(!e)return"null path";if(e.indexOf(":")>0)return e;null!=t.customFormat&&(e=t.customFormat(e,i));var s=e.charAt(0);if("."===s)return t.formatRelativePath((i||t.basePath)+e);if("~"===s)return t.rootPath+e.substring(1);if("d"===s){if(0===e.indexOf("data:image"))return e}else if("/"===s)return e;return(i||t.basePath)+e},t.formatRelativePath=function(t){for(var e=t.split("/"),i=0,s=e.length;s>i;i++)".."==e[i]&&(e.splice(i-1,2),i-=2);return e.join("/")},t.isAbsolute=function(t){return t.indexOf(":")>0||"/"==t.charAt(0)},t.getPath=function(t){var e=t.lastIndexOf("/");return e>0?t.substr(0,e+1):""},t.getFileName=function(t){var e=t.lastIndexOf("/");return e>0?t.substr(e+1):t},t.version={},t.basePath="",t.rootPath="",t.customFormat=function(e){var i=t.version[e];return!Render.isConchApp&&i&&(e+="?v="+i),e},t}(),Render=function(){function t(e,i){function s(){Laya.stage._loop(),Browser.window.requestAnimationFrame(s)}this._timeId=0;var n=laya.renders.Render.isWebGL;t._mainCanvas.source.width=e,t._mainCanvas.source.height=i,n&&t.WebGL.init(t._mainCanvas,e,i),Browser.container.appendChild(t._mainCanvas.source),t._context=new RenderContext(e,i,n?null:t._mainCanvas),t._context.ctx.setIsMainContext(),Browser.window.requestAnimationFrame(s),Laya.stage.on("visibilitychange",this,this._onVisibilitychange)}__class(t,"laya.renders.Render");var e=t.prototype;return e._onVisibilitychange=function(){Laya.stage.isVisibility?0!=this._timeId&&Browser.window.clearInterval(this._timeId):this._timeId=Browser.window.setInterval(this._enterFrame,1e3)},e._enterFrame=function(t){Laya.stage._loop()},__getset(1,t,"context",function(){return t._context}),__getset(1,t,"canvas",function(){return t._mainCanvas.source}),t._context=null,t._mainCanvas=null,t.WebGL=null,t.isConchNode=!1,t.isConchApp=!1,t.isConchWebGL=!1,t.isWebGL=!1,t.is3DMode=!1,t.optimizeTextureMemory=function(t,e){return!0},t.__init$=function(){window.ConchRenderType=window.ConchRenderType||1,window.ConchRenderType|=window.conch?4:0,t.isConchNode=5==(5&window.ConchRenderType),t.isConchApp=4==(4&window.ConchRenderType),t.isConchWebGL=6==window.ConchRenderType},t}(),RenderContext=function(){function t(e,i,s){this.x=0,this.y=0,this._drawTexture=function(t,e,i){i[0].loaded&&this.ctx.drawTexture(i[0],i[1],i[2],i[3],i[4],t,e)},this._fillTexture=function(t,e,i){i[0].loaded&&this.ctx.fillTexture(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6],i[7])},this._drawTextureWithTransform=function(t,e,i){i[0].loaded&&this.ctx.drawTextureWithTransform(i[0],i[1],i[2],i[3],i[4],i[5],t,e,i[6])},this._fillQuadrangle=function(t,e,i){this.ctx.fillQuadrangle(i[0],i[1],i[2],i[3],i[4])},this._drawRect=function(t,e,i){var s=this.ctx;null!=i[4]&&(s.fillStyle=i[4],s.fillRect(t+i[0],e+i[1],i[2],i[3],null)),null!=i[5]&&(s.strokeStyle=i[5],s.lineWidth=i[6],s.strokeRect(t+i[0],e+i[1],i[2],i[3],i[6]))},this._drawPie=function(t,e,i){var s=this.ctx;Render.isWebGL&&s.setPathId(i[8]),s.beginPath(),Render.isWebGL?(s.movePath(i[0]+t,i[1]+e),s.moveTo(0,0)):s.moveTo(t+i[0],e+i[1]),s.arc(t+i[0],e+i[1],i[2],i[3],i[4]),s.closePath(),this._fillAndStroke(i[5],i[6],i[7],!0)},this._clipRect=function(t,e,i){this.ctx.clipRect(t+i[0],e+i[1],i[2],i[3])},this._fillRect=function(t,e,i){this.ctx.fillRect(t+i[0],e+i[1],i[2],i[3],i[4])},this._drawCircle=function(e,i,s){var n=this.ctx;Render.isWebGL&&n.setPathId(s[6]),Stat.drawCall++,n.beginPath(),Render.isWebGL&&n.movePath(s[0]+e,s[1]+i),n.arc(s[0]+e,s[1]+i,s[2],0,t.PI2),n.closePath(),this._fillAndStroke(s[3],s[4],s[5],!0)},this._fillCircle=function(e,i,s){Stat.drawCall++;var n=this.ctx;n.beginPath(),n.fillStyle=s[3],n.arc(s[0]+e,s[1]+i,s[2],0,t.PI2),n.fill()},this._setShader=function(t,e,i){this.ctx.setShader(i[0])},this._drawLine=function(t,e,i){var s=this.ctx;Render.isWebGL&&s.setPathId(i[6]),s.beginPath(),s.strokeStyle=i[4],s.lineWidth=i[5],Render.isWebGL?(s.movePath(t,e),s.moveTo(i[0],i[1]),s.lineTo(i[2],i[3])):(s.moveTo(t+i[0],e+i[1]),s.lineTo(t+i[2],e+i[3])),s.stroke()},this._drawLines=function(t,e,i){var s=this.ctx;Render.isWebGL&&s.setPathId(i[5]),s.beginPath(),t+=i[0],e+=i[1],Render.isWebGL&&s.movePath(t,e),s.strokeStyle=i[3],s.lineWidth=i[4];var n=i[2],a=2,o=n.length;if(Render.isWebGL)for(s.moveTo(n[0],n[1]);o>a;)s.lineTo(n[a++],n[a++]);else for(s.moveTo(t+n[0],e+n[1]);o>a;)s.lineTo(t+n[a++],e+n[a++]);s.stroke()},this._drawLinesWebGL=function(t,e,i){this.ctx.drawLines(t+this.x+i[0],e+this.y+i[1],i[2],i[3],i[4])},this._drawCurves=function(t,e,i){this.ctx.drawCurves(t,e,i)},this._draw=function(t,e,i){i[0].call(null,this,t,e)},this._transformByMatrix=function(t,e,i){this.ctx.transformByMatrix(i[0])},this._setTransform=function(t,e,i){this.ctx.setTransform(i[0],i[1],i[2],i[3],i[4],i[5])},this._setTransformByMatrix=function(t,e,i){this.ctx.setTransformByMatrix(i[0])},this._save=function(t,e,i){this.ctx.save()},this._restore=function(t,e,i){this.ctx.restore()},this._translate=function(t,e,i){this.ctx.translate(i[0],i[1])},this._transform=function(t,e,i){this.ctx.translate(i[1]+t,i[2]+e);var s=i[0];this.ctx.transform(s.a,s.b,s.c,s.d,s.tx,s.ty),this.ctx.translate(-t-i[1],-e-i[2])},this._rotate=function(t,e,i){this.ctx.translate(i[1]+t,i[2]+e),this.ctx.rotate(i[0]),this.ctx.translate(-t-i[1],-e-i[2])},this._scale=function(t,e,i){this.ctx.translate(i[2]+t,i[3]+e),this.ctx.scale(i[0],i[1]),this.ctx.translate(-t-i[2],-e-i[3])},this._alpha=function(t,e,i){this.ctx.globalAlpha*=i[0]},this._setAlpha=function(t,e,i){this.ctx.globalAlpha=i[0]},this._fillText=function(t,e,i){this.ctx.fillText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5])},this._strokeText=function(t,e,i){this.ctx.strokeText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6])},this._fillBorderText=function(t,e,i){this.ctx.fillBorderText(i[0],i[1]+t,i[2]+e,i[3],i[4],i[5],i[6],i[7])},this._blendMode=function(t,e,i){this.ctx.globalCompositeOperation=i[0]},this._beginClip=function(t,e,i){this.ctx.beginClip&&this.ctx.beginClip(t+i[0],e+i[1],i[2],i[3])},this._setIBVB=function(t,e,i){this.ctx.setIBVB(i[0]+t,i[1]+e,i[2],i[3],i[4],i[5],i[6],i[7])},this._fillTrangles=function(t,e,i){this.ctx.fillTrangles(i[0],i[1]+t,i[2]+e,i[3],i[4])},this._drawPath=function(t,e,i){var s=this.ctx;Render.isWebGL&&s.setPathId(-1),s.beginPath(),t+=i[0],e+=i[1];for(var n=i[2],a=0,o=n.length;o>a;a++){var r=n[a];switch(r[0]){case"moveTo":s.moveTo(t+r[1],e+r[2]);break;case"lineTo":
s.lineTo(t+r[1],e+r[2]);break;case"arcTo":s.arcTo(t+r[1],e+r[2],t+r[3],e+r[4],r[5]);break;case"closePath":s.closePath()}}var h=i[3];null!=h&&(s.fillStyle=h.fillStyle,s.fill());var l=i[4];null!=l&&(s.strokeStyle=l.strokeStyle,s.lineWidth=l.lineWidth||1,s.lineJoin=l.lineJoin,s.lineCap=l.lineCap,s.miterLimit=l.miterLimit,s.stroke())},this.drawPoly=function(t,e,i){this.ctx.drawPoly(t+this.x+i[0],e+this.y+i[1],i[2],i[3],i[4],i[5],i[6])},this._drawPoly=function(t,e,i){var s=this.ctx,n=i[2],a=2,o=n.length;if(Render.isWebGL)for(s.setPathId(i[6]),s.beginPath(),t+=i[0],e+=i[1],s.movePath(t,e),s.moveTo(n[0],n[1]);o>a;)s.lineTo(n[a++],n[a++]);else for(s.beginPath(),t+=i[0],e+=i[1],s.moveTo(t+n[0],e+n[1]);o>a;)s.lineTo(t+n[a++],e+n[a++]);s.closePath(),this._fillAndStroke(i[3],i[4],i[5],i[7])},this._drawSkin=function(t,e,i){var s=i[0];if(s){var n=this.ctx;s.render(n,t,e)}},this._drawParticle=function(t,e,i){this.ctx.drawParticle(t+this.x,e+this.y,i[0])},s?this.ctx=s.getContext("2d"):(s=HTMLCanvas.create("3D"),this.ctx=RunDriver.createWebGLContext2D(s),s._setContext(this.ctx)),s.size(e,i),this.canvas=s}__class(t,"laya.renders.RenderContext");var e=t.prototype;return e.destroy=function(){this.canvas&&(this.canvas.destroy(),this.canvas=null),this.ctx&&(this.ctx.destroy(),this.ctx=null)},e.drawTexture=function(t,e,i,s,n){t.loaded&&this.ctx.drawTexture(t,e,i,s,n,this.x,this.y)},e._drawTextures=function(t,e,i){i[0].loaded&&this.ctx.drawTextures(i[0],i[1],t+this.x,e+this.y)},e.drawTextureWithTransform=function(t,e,i,s,n,a,o){t.loaded&&this.ctx.drawTextureWithTransform(t,e,i,s,n,a,this.x,this.y,o)},e.fillQuadrangle=function(t,e,i,s,n){this.ctx.fillQuadrangle(t,e,i,s,n)},e.drawCanvas=function(t,e,i,s,n){this.ctx.drawCanvas(t,e+this.x,i+this.y,s,n)},e.drawRect=function(t,e,i,s,n,a){void 0===a&&(a=1);var o=this.ctx;o.strokeStyle=n,o.lineWidth=a,o.strokeRect(t+this.x,e+this.y,i,s,a)},e._fillAndStroke=function(t,e,i,s){void 0===s&&(s=!1);var n=this.ctx;null!=t&&(n.fillStyle=t,Render.isWebGL?n.fill(s):n.fill()),null!=e&&i>0&&(n.strokeStyle=e,n.lineWidth=i,n.stroke())},e.clipRect=function(t,e,i,s){this.ctx.clipRect(t+this.x,e+this.y,i,s)},e.fillRect=function(t,e,i,s,n){this.ctx.fillRect(t+this.x,e+this.y,i,s,n)},e.drawCircle=function(e,i,s,n,a){void 0===a&&(a=1),Stat.drawCall++;var o=this.ctx;o.beginPath(),o.strokeStyle=n,o.lineWidth=a,o.arc(e+this.x,i+this.y,s,0,t.PI2),o.stroke()},e.fillCircle=function(e,i,s,n){Stat.drawCall++;var a=this.ctx;a.beginPath(),a.fillStyle=n,a.arc(e+this.x,i+this.y,s,0,t.PI2),a.fill()},e.setShader=function(t){this.ctx.setShader(t)},e.drawLine=function(t,e,i,s,n,a){void 0===a&&(a=1);var o=this.ctx;o.beginPath(),o.strokeStyle=n,o.lineWidth=a,o.moveTo(this.x+t,this.y+e),o.lineTo(this.x+i,this.y+s),o.stroke()},e.clear=function(){this.ctx.clear()},e.transformByMatrix=function(t){this.ctx.transformByMatrix(t)},e.setTransform=function(t,e,i,s,n,a){this.ctx.setTransform(t,e,i,s,n,a)},e.setTransformByMatrix=function(t){this.ctx.setTransformByMatrix(t)},e.save=function(){this.ctx.save()},e.restore=function(){this.ctx.restore()},e.translate=function(t,e){this.ctx.translate(t,e)},e.transform=function(t,e,i,s,n,a){this.ctx.transform(t,e,i,s,n,a)},e.rotate=function(t){this.ctx.rotate(t)},e.scale=function(t,e){this.ctx.scale(t,e)},e.alpha=function(t){this.ctx.globalAlpha*=t},e.setAlpha=function(t){this.ctx.globalAlpha=t},e.fillWords=function(t,e,i,s,n){this.ctx.fillWords(t,e,i,s,n)},e.fillBorderWords=function(t,e,i,s,n,a,o){this.ctx.fillBorderWords(t,e,i,s,n,a,o)},e.fillText=function(t,e,i,s,n,a){this.ctx.fillText(t,e+this.x,i+this.y,s,n,a)},e.strokeText=function(t,e,i,s,n,a,o){this.ctx.strokeText(t,e+this.x,i+this.y,s,n,a,o)},e.blendMode=function(t){this.ctx.globalCompositeOperation=t},e.flush=function(){this.ctx.flush&&this.ctx.flush()},e.addRenderObject=function(t){this.ctx.addRenderObject(t)},e.beginClip=function(t,e,i,s){this.ctx.beginClip&&this.ctx.beginClip(t,e,i,s)},e.endClip=function(){this.ctx.endClip&&this.ctx.endClip()},e.fillTrangles=function(t,e,i){this.ctx.fillTrangles(i[0],i[1],i[2],i[3],i.length>4?i[4]:null)},t.PI2=2*Math.PI,t}(),RenderSprite=function(){function t(e,i){switch(this._next=i||t.NORENDER,e){case 0:return void(this._fun=this._no);case 1:return void(this._fun=this._image);case 2:return void(this._fun=this._alpha);case 4:return void(this._fun=this._transform);case 8:return void(this._fun=this._blend);case 16:return void(this._fun=this._canvas);case 64:return void(this._fun=this._mask);case 128:return void(this._fun=this._clip);case 256:return void(this._fun=this._style);case 512:return void(this._fun=this._graphics);case 2048:return void(this._fun=this._childs);case 1024:return void(this._fun=this._custom);case 513:return void(this._fun=this._image2);case 517:return void(this._fun=this._image2);case 32:return void(this._fun=Filter._filter);case 69905:return void(this._fun=t._initRenderFun)}this.onCreate(e)}__class(t,"laya.renders.RenderSprite");var e=t.prototype;return e.onCreate=function(t){},e._style=function(t,e,i,s){t._style.render(t,e,i,s);var n=this._next;n._fun.call(n,t,e,i,s)},e._no=function(t,e,i,s){},e._custom=function(t,e,i,s){t.customRender(e,i,s);var n=t._style._tf;this._next._fun.call(this._next,t,e,i-n.translateX,s-n.translateY)},e._clip=function(e,i,s,n){var a=this._next;if(a!=t.NORENDER){var o=e._style.scrollRect;i.ctx.save(),i.ctx.clipRect(s,n,o.width,o.height),a._fun.call(a,e,i,s-o.x,n-o.y),i.ctx.restore()}},e._blend=function(t,e,i,s){var n=t._style;n.blendMode&&(e.ctx.globalCompositeOperation=n.blendMode);var a=this._next;a._fun.call(a,t,e,i,s),e.ctx.globalCompositeOperation="source-over"},e._mask=function(t,e,i,s){var n=this._next;n._fun.call(n,t,e,i,s);var a=t.mask;a&&(e.ctx.globalCompositeOperation="destination-in",(a.numChildren>0||!a.graphics._isOnlyOne())&&(a.cacheAsBitmap=!0),a.render(e,i-t.pivotX,s-t.pivotY)),e.ctx.globalCompositeOperation="source-over"},e._graphics=function(t,e,i,s){var n=t._style._tf;t._graphics&&t._graphics._render(t,e,i-n.translateX,s-n.translateY);var a=this._next;a._fun.call(a,t,e,i,s)},e._image=function(t,e,i,s){var n=t._style;e.ctx.drawTexture2(i,s,n._tf.translateX,n._tf.translateY,t.transform,n.alpha,n.blendMode,t._graphics._one)},e._image2=function(t,e,i,s){var n=t._style._tf;e.ctx.drawTexture2(i,s,n.translateX,n.translateY,t.transform,1,null,t._graphics._one)},e._alpha=function(t,e,i,s){var n,a=t._style;if((n=a.alpha)>.01||t._needRepaint()){var o=e.ctx.globalAlpha;e.ctx.globalAlpha*=n;var r=this._next;r._fun.call(r,t,e,i,s),e.ctx.globalAlpha=o}},e._transform=function(e,i,s,n){var a=e.transform,o=this._next;a&&o!=t.NORENDER?(i.save(),i.transform(a.a,a.b,a.c,a.d,a.tx+s,a.ty+n),o._fun.call(o,e,i,0,0),i.restore()):o._fun.call(o,e,i,s,n)},e._childs=function(t,e,i,s){var n=t._style;if(i+=-n._tf.translateX+n.paddingLeft,s+=-n._tf.translateY+n.paddingTop,n._calculation){var a=t._getWords();if(a){var o=n;o&&(o.stroke?e.fillBorderWords(a,i,s,o.font,o.color,o.strokeColor,o.stroke):e.fillWords(a,i,s,o.font,o.color))}}var r,h=t._childs,l=h.length;if(t.viewport||t.optimizeScrollRect&&t._style.scrollRect){var c=t.viewport||t._style.scrollRect,d=c.x,u=c.y,p=c.right,_=c.bottom,f=NaN,y=NaN;for(m=0;l>m;++m)(r=h[m]).visible&&(f=r._x)<p&&f+r.width>d&&(y=r._y)<_&&y+r.height>u&&r.render(e,i,s)}else for(var m=0;l>m;++m)(r=h[m])._style.visible&&r.render(e,i,s)},e._canvas=function(t,e,i,s){var n=t._$P.cacheCanvas,a=this._next;if(!n)return void a._fun.call(a,t,c,i,s);var o,r,h,l,c=n.ctx,d=t._needRepaint()||!c;if("bitmap"===n.type?Stat.canvasBitmap++:Stat.canvasNormal++,d){n._cacheRec||(n._cacheRec=new Rectangle);var u,p;Render.isWebGL&&"bitmap"!==n.type?n._cacheRec.setTo(-t.pivotX,-t.pivotY,1,1):(l=t.getSelfBounds(),l.x-=t.pivotX,l.y-=t.pivotY,l.x-=16,l.y-=16,l.width+=32,l.height+=32,l.x=Math.floor(l.x+i)-i,l.y=Math.floor(l.y+s)-s,l.width=Math.floor(l.width),l.height=Math.floor(l.height),n._cacheRec.copyFrom(l)),l=n._cacheRec;var _=Render.isWebGL?1:Browser.pixelRatio*Laya.stage.clientScaleX,f=Render.isWebGL?1:Browser.pixelRatio*Laya.stage.clientScaleY;if(!Render.isWebGL){var y,m=1,g=1;for(y=t;y&&y!=Laya.stage;)m*=y.scaleX,g*=y.scaleY,y=y.parent;Render.isWebGL?(1>m&&(_*=m),1>g&&(f*=g)):(m>1&&(_*=m),g>1&&(f*=g))}if(u=l.width*_,p=l.height*f,r=l.x,h=l.y,Render.isWebGL&&"bitmap"===n.type&&(u>2048||p>2048))return console.warn("cache bitmap size larger than 2048,cache ignored"),n.ctx&&(Pool.recover("RenderContext",n.ctx),n.ctx.canvas.size(0,0),n.ctx=null),void a._fun.call(a,t,e,i,s);c||(c=n.ctx=Pool.getItem("RenderContext")||new RenderContext(u,p,HTMLCanvas.create("AUTO"))),c.ctx.sprite=t,o=c.canvas,o.clear(),(o.width!=u||o.height!=p)&&o.size(u,p),"bitmap"===n.type?o.context.asBitmap=!0:"normal"===n.type&&(o.context.asBitmap=!1);var v;if(1!=_||1!=f){var C=c.ctx;C.save(),C.scale(_,f),!Render.isConchWebGL&&Render.isConchApp&&(v=t._$P.cf,v&&C.setFilterMatrix&&C.setFilterMatrix(v._mat,v._alpha)),a._fun.call(a,t,c,-r,-h),C.restore(),Render.isConchApp&&!Render.isConchWebGL||t._applyFilters()}else C=c.ctx,!Render.isConchWebGL&&Render.isConchApp&&(v=t._$P.cf,v&&C.setFilterMatrix&&C.setFilterMatrix(v._mat,v._alpha)),a._fun.call(a,t,c,-r,-h),Render.isConchApp&&!Render.isConchWebGL||t._applyFilters();t._$P.staticCache&&(n.reCache=!1),Stat.canvasReCache++}else l=n._cacheRec,r=l.x,h=l.y,o=c.canvas;e.drawCanvas(o,i+r,s+h,l.width,l.height)},t.__init__=function(){function e(e,i){for(var s=0,n=0;n<e.length;n++)s|=e[n],t.renders[s]=i}var i,s=0,n=0;for(i=RunDriver.createRenderSprite(69905,null),n=t.renders.length=4096,s=0;n>s;s++)t.renders[s]=i;t.renders[0]=RunDriver.createRenderSprite(0,null),e([1,512,4,2],new t(1,null)),t.renders[513]=RunDriver.createRenderSprite(513,null),t.renders[517]=new t(517,null)},t._initRenderFun=function(e,i,s,n){var a=e._renderType,o=t.renders[a]=t._getTypeRender(a);o._fun(e,i,s,n)},t._getTypeRender=function(t){for(var e=null,i=2048;i>1;)i&t&&(e=RunDriver.createRenderSprite(i,e)),i>>=1;return e},t.IMAGE=1,t.ALPHA=2,t.TRANSFORM=4,t.BLEND=8,t.CANVAS=16,t.FILTERS=32,t.MASK=64,t.CLIP=128,t.STYLE=256,t.GRAPHICS=512,t.CUSTOM=1024,t.CHILDS=2048,t.INIT=69905,t.renders=[],t.NORENDER=new t(0,null),t}(),Context=function(){function t(){this._repaint=!1}__class(t,"laya.resource.Context");var e=t.prototype;return e.setIsMainContext=function(){},e.drawTextures=function(t,e,i,s){Stat.drawCall+=e.length/2;for(var n=t.width,a=t.height,o=0,r=e.length;r>o;o+=2)this.drawTexture(t,e[o],e[o+1],n,a,i,s)},e.drawCanvas=function(t,e,i,s,n){Stat.drawCall++,this.drawImage(t.source,e,i,s,n)},e.fillRect=function(t,e,i,s,n){Stat.drawCall++,n&&(this.fillStyle=n),this.__fillRect(t,e,i,s)},e.fillText=function(t,e,i,s,n,a){Stat.drawCall++,arguments.length>3&&null!=s&&(this.font=s,this.fillStyle=n,this.textAlign=a,this.textBaseline="top"),this.__fillText(t,e,i)},e.fillBorderText=function(t,e,i,s,n,a,o,r){Stat.drawCall++,this.font=s,this.fillStyle=n,this.textBaseline="top",this.strokeStyle=a,this.lineWidth=o,this.textAlign=r,this.__strokeText(t,e,i),this.__fillText(t,e,i)},e.strokeText=function(t,e,i,s,n,a,o){Stat.drawCall++,arguments.length>3&&null!=s&&(this.font=s,this.strokeStyle=n,this.lineWidth=a,this.textAlign=o,this.textBaseline="top"),this.__strokeText(t,e,i)},e.transformByMatrix=function(t){this.transform(t.a,t.b,t.c,t.d,t.tx,t.ty)},e.setTransformByMatrix=function(t){this.setTransform(t.a,t.b,t.c,t.d,t.tx,t.ty)},e.clipRect=function(t,e,i,s){Stat.drawCall++,this.beginPath(),this.rect(t,e,i,s),this.clip()},e.drawTexture=function(t,e,i,s,n,a,o){Stat.drawCall++;var r=t.uv,h=t.bitmap.width,l=t.bitmap.height;this.drawImage(t.source,r[0]*h,r[1]*l,(r[2]-r[0])*h,(r[5]-r[3])*l,e+a,i+o,s,n)},e.drawTextureWithTransform=function(t,e,i,s,n,a,o,r,h){Stat.drawCall++;var l=t.uv,c=t.bitmap.width,d=t.bitmap.height;this.save(),1!=h&&(this.globalAlpha*=h),a?(this.transform(a.a,a.b,a.c,a.d,a.tx+o,a.ty+r),this.drawImage(t.source,l[0]*c,l[1]*d,(l[2]-l[0])*c,(l[5]-l[3])*d,e,i,s,n)):this.drawImage(t.source,l[0]*c,l[1]*d,(l[2]-l[0])*c,(l[5]-l[3])*d,e+o,i+r,s,n),this.restore()},e.drawTexture2=function(t,e,i,s,n,a,o,r){"use strict";var h=r[0];if(h.loaded&&h.bitmap&&h.source){Stat.drawCall++;var l=1!==a;if(l){var c=this.globalAlpha;this.globalAlpha*=a}var d=h.uv,u=h.bitmap.width,p=h.bitmap.height;n?(this.save(),this.transform(n.a,n.b,n.c,n.d,n.tx+t,n.ty+e),this.drawImage(h.source,d[0]*u,d[1]*p,(d[2]-d[0])*u,(d[5]-d[3])*p,r[1]-i,r[2]-s,r[3],r[4]),this.restore()):this.drawImage(h.source,d[0]*u,d[1]*p,(d[2]-d[0])*u,(d[5]-d[3])*p,r[1]-i+t,r[2]-s+e,r[3],r[4]),l&&(this.globalAlpha=c)}},e.fillTexture=function(t,e,i,s,n,a,o,r){if(!r.pat){if(t.uv!=Texture.DEF_UV){var h=new HTMLCanvas("2D");h.getContext("2d"),h.size(t.width,t.height),h.context.drawTexture(t,0,0,t.width,t.height,0,0),t=new Texture(h)}r.pat=this.createPattern(t.bitmap.source,a)}var l=e,c=i,d=0,u=0;o&&(l+=o.x%t.width,c+=o.y%t.height,d-=o.x%t.width,u-=o.y%t.height),this.translate(l,c),this.fillRect(d,u,s,n,r.pat),this.translate(-l,-c)},e.flush=function(){return 0},e.fillWords=function(t,e,i,s,n){s&&(this.font=s),n&&(this.fillStyle=n);this.textBaseline="top",this.textAlign="left";for(var a=0,o=t.length;o>a;a++){var r=t[a];this.__fillText(r["char"],r.x+e,r.y+i)}},e.fillBorderWords=function(t,e,i,s,n,a,o){s&&(this.font=s),n&&(this.fillStyle=n),this.textBaseline="top",this.lineWidth=o,this.textAlign="left",this.strokeStyle=a;for(var r=0,h=t.length;h>r;r++){var l=t[r];this.__strokeText(l["char"],l.x+e,l.y+i),this.__fillText(l["char"],l.x+e,l.y+i)}},e.destroy=function(){this.canvas.width=this.canvas.height=0},e.clear=function(){this.clearRect(0,0,this._canvas.width,this._canvas.height),this._repaint=!1},e.drawCurves=function(t,e,i){this.beginPath(),this.strokeStyle=i[3],this.lineWidth=i[4];var s=i[2];t+=i[0],e+=i[1],this.moveTo(t+s[0],e+s[1]);for(var n=2,a=s.length;a>n;)this.quadraticCurveTo(t+s[n++],e+s[n++],t+s[n++],e+s[n++]);this.stroke()},t.__init__=function(t){var e=laya.resource.Context.prototype;t=t||window.wx.createCanvas().getContext("2d").__proto__,t.__fillText=t.fillText,t.__fillRect=t.fillRect,t.__strokeText=t.strokeText;var i=["drawTextures","fillWords","fillBorderWords","setIsMainContext","fillRect","strokeText","fillTexture","fillText","transformByMatrix","setTransformByMatrix","clipRect","drawTexture","drawTexture2","drawTextureWithTransform","flush","clear","destroy","drawCanvas","fillBorderText","drawCurves"];i.forEach(function(i){t[i]=e[i]})},t._default=new t,t}(),ResourceManager=function(){function t(){this._id=0,this._name=null,this._resources=null,this._memorySize=0,this._garbageCollectionRate=NaN,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=0,this._id=++t._uniqueIDCounter,this._name="Content Manager",t._isResourceManagersSorted=!1,this._memorySize=0,this._isOverflow=!1,this.autoRelease=!1,this.autoReleaseMaxSize=536870912,this._garbageCollectionRate=.2,t._resourceManagers.push(this),this._resources=[]}__class(t,"laya.resource.ResourceManager");var e=t.prototype;return Laya.imps(e,{"laya.resource.IDispose":!0}),e.getResourceByIndex=function(t){return this._resources[t]},e.getResourcesLength=function(){return this._resources.length},e.traceInfo=function(){for(var t,e=0,i=0,s=0;s<this._resources.length;s++)if(t=this._resources[s],t instanceof laya.webgl.resource.WebGLImage){var n=t.width>=512||t.height>=512;if(n){var a=t.width*t.height/1048576*4;console.log(t.src+"-----width:"+t.width+"----height:"+t.height+"----size:"+a+"M"),e+=a}else{var a=t.width*t.height/1048576*4;i+=a}}console.log("[Total memory of big:"+e+"][Total memory of small:"+i+"]")},e.addResource=function(t){t.resourceManager&&t.resourceManager.removeResource(t);var e=this._resources.indexOf(t);return-1===e?(t._resourceManager=this,this._resources.push(t),this.addSize(t.memorySize),!0):!1},e.removeResource=function(t){var e=this._resources.indexOf(t);return-1!==e?(this._resources.splice(e,1),t._resourceManager=null,this._memorySize-=t.memorySize,!0):!1},e.unload=function(){for(var t=this._resources.slice(0,this._resources.length),e=0;e<t.length;e++){var i=t[e];i.dispose()}t.length=0},e.setUniqueName=function(e){for(var i=!0,s=0;s<t._resourceManagers.length;s++)if(t._resourceManagers[s]._name===e&&t._resourceManagers[s]!==this)return void(i=!1);i?this.name!=e&&(this.name=e,t._isResourceManagersSorted=!1):this.setUniqueName(e.concat("-copy"))},e.dispose=function(){if(this===t._systemResourceManager)throw new Error("systemResourceManager不能被释放！");t._resourceManagers.splice(t._resourceManagers.indexOf(this),1),t._isResourceManagersSorted=!1;for(var e=this._resources.slice(0,this._resources.length),i=0;i<e.length;i++){var s=e[i];s.resourceManager.removeResource(s),s.dispose()}e.length=0},e.addSize=function(t){t&&(this.autoRelease&&t>0&&this._memorySize+t>this.autoReleaseMaxSize&&this.garbageCollection((1-this._garbageCollectionRate)*this.autoReleaseMaxSize),this._memorySize+=t)},e.garbageCollection=function(t){var e=this._resources;e=e.slice(),e.sort(function(t,e){if(!t||!e)throw new Error("a或b不能为空！");return t.released&&e.released?0:t.released?1:e.released?-1:t.lastUseFrameCount-e.lastUseFrameCount});for(var i=Stat.loopCount,s=0,n=e.length;n>s;s++){var a=e[s];if(!(i-a.lastUseFrameCount>1))return void(this._memorySize>=t&&(this._isOverflow=!0));if(a.releaseResource(),this._memorySize<t)return void(this._isOverflow=!1)}},__getset(0,e,"id",function(){return this._id}),__getset(0,e,"name",function(){return this._name},function(e){!e&&""===e||this._name===e||(this._name=e,t._isResourceManagersSorted=!1)}),__getset(0,e,"memorySize",function(){return this._memorySize}),__getset(1,t,"systemResourceManager",function(){return null===t._systemResourceManager&&(t._systemResourceManager=new t,t._systemResourceManager._name="System Resource Manager"),t._systemResourceManager}),__getset(1,t,"sortedResourceManagersByName",function(){return t._isResourceManagersSorted||(t._isResourceManagersSorted=!0,t._resourceManagers.sort(t.compareResourceManagersByName)),t._resourceManagers}),t.__init__=function(){t.currentResourceManager=t.systemResourceManager},t.getLoadedResourceManagerByIndex=function(e){return t._resourceManagers[e]},t.getLoadedResourceManagersCount=function(){return t._resourceManagers.length},t.recreateContentManagers=function(e){void 0===e&&(e=!1);for(var i=t.currentResourceManager,s=0;s<t._resourceManagers.length;s++){t.currentResourceManager=t._resourceManagers[s];for(var n=0;n<t.currentResourceManager._resources.length;n++)t.currentResourceManager._resources[n].releaseResource(e),t.currentResourceManager._resources[n].activeResource(e)}t.currentResourceManager=i},t.releaseContentManagers=function(e){void 0===e&&(e=!1);for(var i=t.currentResourceManager,s=0;s<t._resourceManagers.length;s++){t.currentResourceManager=t._resourceManagers[s];for(var n=0;n<t.currentResourceManager._resources.length;n++){var a=t.currentResourceManager._resources[n];!a.released&&a.releaseResource(e)}}t.currentResourceManager=i},t.compareResourceManagersByName=function(t,e){if(t==e)return 0;var i=t._name,s=e._name;if(null==i)return null==s?0:-1;if(null==s)return 1;var n=i.localeCompare(s);return 0!=n?n:(e.setUniqueName(s),s=e._name,i.localeCompare(s))},t._uniqueIDCounter=0,t._systemResourceManager=null,t._isResourceManagersSorted=!1,t._resourceManagers=[],t.currentResourceManager=null,t}(),System=function(){function System(){}return __class(System,"laya.system.System"),System.changeDefinition=function(name,classObj){Laya[name]=classObj;var str=name+"=classObj";eval(str)},System.__init__=function(){Render.isConchApp&&(conch.disableConchResManager(),conch.disableConchAutoRestoreLostedDevice())},System}(),Browser=function(){function t(){}return __class(t,"laya.utils.Browser"),__getset(1,t,"pixelRatio",function(){return t.__init__(),t.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")>-1?2:RunDriver.getPixelRatio()}),__getset(1,t,"height",function(){return t.__init__(),(Laya.stage&&Laya.stage.canvasRotation?t.clientWidth:t.clientHeight)*t.pixelRatio}),__getset(1,t,"clientWidth",function(){return t.__init__(),t.window.innerWidth||t.document.body.clientWidth}),__getset(1,t,"window",function(){return t.__init__(),t._window}),__getset(1,t,"clientHeight",function(){return t.__init__(),t.window.innerHeight||t.document.body.clientHeight||t.document.documentElement.clientHeight}),__getset(1,t,"width",function(){return t.__init__(),(Laya.stage&&Laya.stage.canvasRotation?t.clientHeight:t.clientWidth)*t.pixelRatio}),__getset(1,t,"container",function(){return t.__init__(),t._container||(t._container=t.createElement("div"),t._container.id="layaContainer",t.document.body.appendChild(t._container)),t._container},function(e){t._container=e}),__getset(1,t,"document",function(){return t.__init__(),t._document}),t.__init__=function(){if(!t._window){t._window=RunDriver.getWindow(),t._document=t.window.document,window.conch&&window.conch.setScreenWakeLock(!0),t._window.addEventListener("message",function(t){laya.utils.Browser._onMessage(t)},!1),t.document.__createElement=t.document.createElement,window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)};var e=window.document.body.style;e.margin=0,e.overflow="hidden";for(var i=window.document.getElementsByTagName("meta"),s=0,n=!1,a="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no";s<i.length;){var o=i[s];if("viewport"==o.name){o.content=a,n=!0;break}s++}if(n||(o=document.createElement("meta"),o.name="viewport",o.content=a,document.getElementsByTagName("head")[0].appendChild(o)),t.userAgent=t.window.navigator.userAgent,t.u=t.userAgent,t.onIOS=!!t.u.match(/\(i[^;]+;(U;)? CPU.+Mac OS X/),t.onMobile=t.u.indexOf("Mobile")>-1,t.onIPhone=t.u.indexOf("iPhone")>-1,t.onIPad=t.u.indexOf("iPad")>-1,t.onAndriod=t.u.indexOf("Android")>-1||t.u.indexOf("Adr")>-1,t.onWP=t.u.indexOf("Windows Phone")>-1,t.onQQBrowser=t.u.indexOf("QQBrowser")>-1,t.onMQQBrowser=t.u.indexOf("MQQBrowser")>-1||t.u.indexOf("Mobile")>-1&&t.u.indexOf("QQ")>-1,t.onIE=!!t.window.ActiveXObject||"ActiveXObject"in t.window,t.onWeiXin=t.u.indexOf("MicroMessenger")>-1,t.onPC=!t.onMobile,t.onWXAPP=!0,t.onSafari=!!t.u.match(/Version\/\d+\.\d\x20Mobile\/\S+\x20Safari/),t.onFirefox=t.u.indexOf("Firefox")>-1,t.onEdge=t.u.indexOf("Edge")>-1,t.httpProtocol="http:"==t.window.location.protocol,t.webAudioEnabled=!!(t.window.AudioContext||t.window.webkitAudioContext||t.window.mozAudioContext),t.soundType=t.webAudioEnabled?"WEBAUDIOSOUND":"AUDIOSOUND",Sound=t.webAudioEnabled?WebAudioSound:AudioSound,t.webAudioEnabled&&WebAudioSound.initWebAudio(),AudioSound._initMusicAudio(),t.enableTouch="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,SoundManager._soundClass=Sound,t.onWXAPP){var r=wx.getSystemInfoSync();r.system&&(t.onAndriod=r.system.indexOf("Android")>-1||r.system.indexOf("Adr")>-1,t.onIOS=r.system.indexOf("iOS")>-1||r.system.indexOf("IOS")>-1)}Render._mainCanvas=Render._mainCanvas||HTMLCanvas.create("WXAPP"),t.canvas||(t.canvas=HTMLCanvas.create("2D"),t.context=t.canvas.getContext("2d"))}},t._onMessage=function(e){if(e.data&&"size"==e.data.name){if(t.window.innerWidth=e.data.width,t.window.innerHeight=e.data.height,t.window.__innerHeight=e.data.clientHeight,!t.document.createEvent)return void console.warn("no document.createEvent");var i=t.document.createEvent("HTMLEvents");return i.initEvent("resize",!1,!1),void t.window.dispatchEvent(i)}},t.createElement=function(e){return t.__init__(),t.document.__createElement(e)},t.getElementById=function(e){return t.__init__(),t.document.getElementById(e)},t.removeElement=function(t){t&&t.parentNode&&t.parentNode.removeChild(t)},t.now=function(){return RunDriver.now()},t._window=null,t._document=null,t._container=null,t.userAgent=null,t.u=null,t.onIOS=!1,t.onMobile=!1,t.onIPhone=!1,t.onIPad=!1,t.onAndriod=!1,t.onWP=!1,t.onQQBrowser=!1,t.onMQQBrowser=!1,t.onSafari=!1,t.onWeiXin=!1,t.onPC=!1,t.httpProtocol=!1,t.webAudioEnabled=!1,t.soundType=null,t.enableTouch=!1,t.canvas=null,t.context=null,t.__init$=function(){},t}(),Byte=function(){function t(t){this._xd_=!0,this._allocated_=8,this._pos_=0,this._length=0,t?(this._u8d_=new Uint8Array(t),this._d_=new DataView(this._u8d_.buffer),this._length=this._d_.byteLength):this.___resizeBuffer(this._allocated_)}__class(t,"laya.utils.Byte");var e=t.prototype;return e.___resizeBuffer=function(t){try{var e=new Uint8Array(t);null!=this._u8d_&&(this._u8d_.length<=t?e.set(this._u8d_):e.set(this._u8d_.subarray(0,t))),this._u8d_=e,this._d_=new DataView(e.buffer)}catch(i){throw"___resizeBuffer err:"+t}},e.getString=function(){return this.rUTF(this.getUint16())},e.getFloat32Array=function(t,e){var i=new Float32Array(this._d_.buffer.slice(t,t+e));return this._pos_+=e,i},e.getUint8Array=function(t,e){var i=new Uint8Array(this._d_.buffer.slice(t,t+e));return this._pos_+=e,i},e.getInt16Array=function(t,e){var i=new Int16Array(this._d_.buffer.slice(t,t+e));return this._pos_+=e,i},e.getFloat32=function(){var t=this._d_.getFloat32(this._pos_,this._xd_);return this._pos_+=4,t},e.getFloat64=function(){var t=this._d_.getFloat64(this._pos_,this._xd_);return this._pos_+=8,t},e.writeFloat32=function(t){this.ensureWrite(this._pos_+4),this._d_.setFloat32(this._pos_,t,this._xd_),this._pos_+=4},e.writeFloat64=function(t){this.ensureWrite(this._pos_+8),this._d_.setFloat64(this._pos_,t,this._xd_),this._pos_+=8},e.getInt32=function(){var t=this._d_.getInt32(this._pos_,this._xd_);return this._pos_+=4,t},e.getUint32=function(){var t=this._d_.getUint32(this._pos_,this._xd_);return this._pos_+=4,t},e.writeInt32=function(t){this.ensureWrite(this._pos_+4),this._d_.setInt32(this._pos_,t,this._xd_),this._pos_+=4},e.writeUint32=function(t){this.ensureWrite(this._pos_+4),this._d_.setUint32(this._pos_,t,this._xd_),this._pos_+=4},e.getInt16=function(){var t=this._d_.getInt16(this._pos_,this._xd_);return this._pos_+=2,t},e.getUint16=function(){var t=this._d_.getUint16(this._pos_,this._xd_);return this._pos_+=2,t},e.writeUint16=function(t){this.ensureWrite(this._pos_+2),this._d_.setUint16(this._pos_,t,this._xd_),this._pos_+=2},e.writeInt16=function(t){this.ensureWrite(this._pos_+2),this._d_.setInt16(this._pos_,t,this._xd_),this._pos_+=2},e.getUint8=function(){return this._d_.getUint8(this._pos_++)},e.writeUint8=function(t){this.ensureWrite(this._pos_+1),this._d_.setUint8(this._pos_,t),this._pos_++},e._getUInt8=function(t){return this._d_.getUint8(t)},e._getUint16=function(t){return this._d_.getUint16(t,this._xd_)},e._getMatrix=function(){var t=new Matrix(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32());return t},e.rUTF=function(t){for(var e="",i=this._pos_+t,s=0,n=0,a=0,o=String.fromCharCode,r=this._u8d_,h=0;this._pos_<i;)s=r[this._pos_++],128>s?0!=s&&(e+=o(s)):224>s?e+=o((63&s)<<6|127&r[this._pos_++]):240>s?(n=r[this._pos_++],e+=o((31&s)<<12|(127&n)<<6|127&r[this._pos_++])):(n=r[this._pos_++],a=r[this._pos_++],e+=o((15&s)<<18|(127&n)<<12|a<<6&127|127&r[this._pos_++])),h++;return e},e.getCustomString=function(t){for(var e="",i=0,s=0,n=0,a=String.fromCharCode,o=this._u8d_;t>0;)if(s=o[this._pos_],128>s)e+=a(s),this._pos_++,t--;else for(i=s-128,this._pos_++,t-=i;i>0;)s=o[this._pos_++],n=o[this._pos_++],e+=a(n<<8|s),i--;return e},e.clear=function(){this._pos_=0,this.length=0},e.__getBuffer=function(){return this._d_.buffer},e.writeUTFBytes=function(t){t+="";for(var e=0,i=t.length;i>e;e++){var s=t.charCodeAt(e);127>=s?this.writeByte(s):2047>=s?(this.writeByte(192|s>>6),this.writeByte(128|63&s)):65535>=s?(this.writeByte(224|s>>12),this.writeByte(128|s>>6&63),this.writeByte(128|63&s)):(this.writeByte(240|s>>18),this.writeByte(128|s>>12&63),this.writeByte(128|s>>6&63),this.writeByte(128|63&s))}},e.writeUTFString=function(t){var e=0;e=this.pos,this.writeUint16(1),this.writeUTFBytes(t);var i=0;i=this.pos-e-2,this._d_.setUint16(e,i,this._xd_)},e.readUTFString=function(){var t=0;t=this.pos;var e=0;return e=this.getUint16(),this.readUTFBytes(e)},e.getUTFString=function(){return this.readUTFString()},e.readUTFBytes=function(t){return void 0===t&&(t=-1),0==t?"":(t=t>0?t:this.bytesAvailable,this.rUTF(t))},e.getUTFBytes=function(t){return void 0===t&&(t=-1),this.readUTFBytes(t)},e.writeByte=function(t){this.ensureWrite(this._pos_+1),this._d_.setInt8(this._pos_,t),this._pos_+=1},e.readByte=function(){return this._d_.getInt8(this._pos_++)},e.getByte=function(){return this.readByte()},e.ensureWrite=function(t){this._length<t&&(this._length=t),this._allocated_<t&&(this.length=t)},e.writeArrayBuffer=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),0>e||0>i)throw"writeArrayBuffer error - Out of bounds";0==i&&(i=t.byteLength-e),this.ensureWrite(this._pos_+i);var s=new Uint8Array(t);this._u8d_.set(s.subarray(e,e+i),this._pos_),this._pos_+=i},__getset(0,e,"buffer",function(){var t=this._d_.buffer;return t.byteLength==this.length?t:t.slice(0,this.length)}),__getset(0,e,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function(t){this._xd_="littleEndian"==t}),__getset(0,e,"length",function(){return this._length},function(t){this._allocated_<t?this.___resizeBuffer(this._allocated_=Math.floor(Math.max(t,2*this._allocated_))):this._allocated_>t&&this.___resizeBuffer(this._allocated_=t),this._length=t}),__getset(0,e,"pos",function(){return this._pos_},function(t){this._pos_=t,this._d_.byteOffset=t}),__getset(0,e,"bytesAvailable",function(){return this.length-this._pos_}),t.getSystemEndian=function(){if(!t._sysEndian){var e=new ArrayBuffer(2);new DataView(e).setInt16(0,256,!0),t._sysEndian=256===new Int16Array(e)[0]?"littleEndian":"bigEndian"}return t._sysEndian},t.BIG_ENDIAN="bigEndian",t.LITTLE_ENDIAN="littleEndian",t._sysEndian=null,t}(),CacheManger=function(){function t(){}return __class(t,"laya.utils.CacheManger"),t.regCacheByFunction=function(e,i){t.unRegCacheByFunction(e,i);var s;s={tryDispose:e,getCacheList:i},t._cacheList.push(s)},t.unRegCacheByFunction=function(e,i){var s=0,n=0;for(n=t._cacheList.length,s=0;n>s;s++)if(t._cacheList[s].tryDispose==e&&t._cacheList[s].getCacheList==i)return void t._cacheList.splice(s,1)},t.forceDispose=function(){var e=0,i=t._cacheList.length;for(e=0;i>e;e++)t._cacheList[e].tryDispose(!0)},t.beginCheck=function(e){void 0===e&&(e=15e3),Laya.timer.loop(e,null,t._checkLoop)},t.stopCheck=function(){Laya.timer.clear(null,t._checkLoop)},t._checkLoop=function(){var e=t._cacheList;if(!(e.length<1)){var i=Browser.now(),s=0,n=0;for(n=s=e.length;s>0&&(t._index++,t._index=t._index%n,e[t._index].tryDispose(!1),!(Browser.now()-i>t.loopTimeLimit));)s--}},t.loopTimeLimit=2,t._cacheList=[],t._index=0,t}(),ClassUtils=function(){function t(){}return __class(t,"laya.utils.ClassUtils"),t.regClass=function(e,i){t._classMap[e]=i},t.getRegClass=function(e){return t._classMap[e]},t.getInstance=function(e){var i=t.getClass(e);return i?new i:(console.warn("[error] Undefined class:",e),null)},t.createByJson=function(e,i,s,n,a){"string"==typeof e&&(e=JSON.parse(e));var o=e.props;if(!i&&(i=a?a.runWith(e):t.getInstance(o.runtime||e.type),!i))return null;var r=e.child;if(r)for(var h=0,l=r.length;l>h;h++){var c=r[h];if("render"!==c.props.name&&"render"!==c.props.renderType||!i._$set_itemRender)if("Graphic"==c.type)t.addGraphicsToSprite(c,i);else if(t.isDrawType(c.type))t.addGraphicToSprite(c,i,!0);else{var d=t.createByJson(c,null,s,n,a);"Script"==c.type?d.hasOwnProperty("owner")?d.owner=i:d.hasOwnProperty("target")&&(d.target=i):"mask"==c.props.renderType?i.mask=d:i.addChild(d)}else i.itemRender=c}if(o)for(var u in o){var p=o[u];"var"===u&&s?s[p]=i:p instanceof Array&&"function"==typeof i[u]?i[u].apply(i,p):i[u]=p}return n&&e.customProps&&n.runWith([i,e]),i.created&&i.created(),i},t.addGraphicsToSprite=function(e,i){var s;if(s=e.child,s&&!(s.length<1)){var n;n=t._getGraphicsFromSprite(e,i);var a=0,o=0;e.props&&(a=t._getObjVar(e.props,"x",0),
o=t._getObjVar(e.props,"y",0)),0!=a&&0!=o&&n.translate(a,o);var r=0,h=0;for(h=s.length,r=0;h>r;r++)t._addGraphicToGraphics(s[r],n);0!=a&&0!=o&&n.translate(-a,-o)}},t.addGraphicToSprite=function(e,i,s){void 0===s&&(s=!1);var n;n=s?t._getGraphicsFromSprite(e,i):i.graphics,t._addGraphicToGraphics(e,n)},t._getGraphicsFromSprite=function(t,e){var i;if(!t||!t.props)return e.graphics;var s;switch(s=t.props.renderType){case"hit":case"unHit":var n;e.hitArea||(e.hitArea=new HitArea),n=e.hitArea,n[s]||(n[s]=new Graphics),i=n[s]}return i||(i=e.graphics),i},t._getTransformData=function(e){var i;(e.hasOwnProperty("pivotX")||e.hasOwnProperty("pivotY"))&&(i=i||new Matrix,i.translate(-t._getObjVar(e,"pivotX",0),-t._getObjVar(e,"pivotY",0)));var s=t._getObjVar(e,"scaleX",1),n=t._getObjVar(e,"scaleY",1),a=t._getObjVar(e,"rotation",0);t._getObjVar(e,"skewX",0),t._getObjVar(e,"skewY",0);return 1==s&&1==n&&0==a||(i=i||new Matrix,i.scale(s,n),i.rotate(.0174532922222222*a)),i},t._addGraphicToGraphics=function(e,i){var s;if(s=e.props){var n;if(n=t.DrawTypeDic[e.type]){var a;a=i;var o,r=t._getParams(s,n[1],n[2],n[3]);o=t._tM,(o||1!=t._alpha)&&(a.save(),o&&a.transform(o),1!=t._alpha&&a.alpha(t._alpha)),a[n[0]].apply(a,r),(o||1!=t._alpha)&&a.restore()}}},t._adptLineData=function(t){return t[2]=parseFloat(t[0])+parseFloat(t[2]),t[3]=parseFloat(t[1])+parseFloat(t[3]),t},t._adptTextureData=function(t){return t[0]=Loader.getRes(t[0]),t},t._adptLinesData=function(e){return e[2]=t._getPointListByStr(e[2]),e},t.isDrawType=function(e){return"Image"==e?!1:t.DrawTypeDic.hasOwnProperty(e)},t._getParams=function(e,i,s,n){void 0===s&&(s=0);var a;a=t._temParam,a.length=i.length;var o=0,r=0;for(r=i.length,o=0;r>o;o++)a[o]=t._getObjVar(e,i[o][0],i[o][1]);t._alpha=t._getObjVar(e,"alpha",1);var h;return h=t._getTransformData(e),h?(s||(s=0),h.translate(a[s],a[s+1]),a[s]=a[s+1]=0,t._tM=h):t._tM=null,n&&t[n]&&(a=t[n](a)),a},t._getPointListByStr=function(t){var e;e=t.split(",");var i=0,s=0;for(s=e.length,i=0;s>i;i++)e[i]=parseFloat(e[i]);return e},t._getObjVar=function(t,e,i){return t.hasOwnProperty(e)?t[e]:i},t._temParam=[],t._classMap={Sprite:"laya.display.Sprite",Text:"laya.display.Text",Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivElement",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement"},t.getClass=function(e){var i=t._classMap[e]||e;return"string"==typeof i?Laya.__classmap[i]:i},t._tM=null,t._alpha=NaN,__static(t,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]),t}(),Color=function(){function t(e){if(this._color=[],"string"==typeof e){this.strColor=e,null===e&&(e="#000000"),"#"==e.charAt(0)&&(e=e.substr(1));var i=e.length;if(3==i||4==i){for(var s="",n=0;i>n;n++)s+=e[n]+e[n];e=s}var a=this.numColor=parseInt(e,16),o=8==e.length;if(o)return void(this._color=[parseInt(e.substr(0,2),16)/255,((16711680&a)>>16)/255,((65280&a)>>8)/255,(255&a)/255])}else a=this.numColor=e,this.strColor=Utils.toHexColor(a);this._color=[((16711680&a)>>16)/255,((65280&a)>>8)/255,(255&a)/255,1],this._color.__id=++t._COLODID}return __class(t,"laya.utils.Color"),t._initDefault=function(){t._DEFAULT={};for(var e in t._COLOR_MAP)t._SAVE[e]=t._DEFAULT[e]=new t(t._COLOR_MAP[e]);return t._DEFAULT},t._initSaveMap=function(){t._SAVE_SIZE=0,t._SAVE={};for(var e in t._DEFAULT)t._SAVE[e]=t._DEFAULT[e]},t.create=function(e){var i=t._SAVE[e+""];return null!=i?i:(t._SAVE_SIZE<1e3||t._initSaveMap(),t._SAVE[e+""]=new t(e))},t._SAVE={},t._SAVE_SIZE=0,t._COLOR_MAP={white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#AAAAAA"},t._DEFAULT=t._initDefault(),t._COLODID=1,t}(),Dictionary=function(){function t(){this._values=[],this._keys=[]}__class(t,"laya.utils.Dictionary");var e=t.prototype;return e.set=function(t,e){var i=this.indexOf(t);return i>=0?void(this._values[i]=e):(this._keys.push(t),void this._values.push(e))},e.indexOf=function(t){var e=this._keys.indexOf(t);return e>=0?e:(t="string"==typeof t?Number(t):"number"==typeof t?t.toString():t,this._keys.indexOf(t))},e.get=function(t){var e=this.indexOf(t);return 0>e?null:this._values[e]},e.remove=function(t){var e=this.indexOf(t);return e>=0?(this._keys.splice(e,1),this._values.splice(e,1),!0):!1},e.clear=function(){this._values.length=0,this._keys.length=0},__getset(0,e,"values",function(){return this._values}),__getset(0,e,"keys",function(){return this._keys}),t}(),Dragging=function(){function t(){this.ratio=.92,this.maxOffset=60,this._dragging=!1,this._clickOnly=!0}__class(t,"laya.utils.Dragging");var e=t.prototype;return e.start=function(t,e,i,s,n,a,o,r){void 0===r&&(r=.92),this.clearTimer(),this.target=t,this.area=e,this.hasInertia=i,this.elasticDistance=e?s:0,this.elasticBackTime=n,this.data=a,this._disableMouseEvent=o,this.ratio=r,1!=t.globalScaleX||1!=t.globalScaleY?this._parent=t.parent:this._parent=Laya.stage,this._clickOnly=!0,this._dragging=!0,this._elasticRateX=this._elasticRateY=1,this._lastX=this._parent.mouseX,this._lastY=this._parent.mouseY,Laya.stage.on("mouseup",this,this.onStageMouseUp),Laya.stage.on("mouseout",this,this.onStageMouseUp),Laya.timer.frameLoop(1,this,this.loop)},e.clearTimer=function(){Laya.timer.clear(this,this.loop),Laya.timer.clear(this,this.tweenMove),this._tween&&(this._tween.recover(),this._tween=null)},e.stop=function(){this._dragging&&(MouseManager.instance.disableMouseEvent=!1,Laya.stage.off("mouseup",this,this.onStageMouseUp),Laya.stage.off("mouseout",this,this.onStageMouseUp),this._dragging=!1,this.target&&this.area&&this.backToArea(),this.clear())},e.loop=function(){var t=this._parent.getMousePoint(),e=t.x,i=t.y,s=e-this._lastX,n=i-this._lastY;if(this._clickOnly){if(!(Math.abs(s*Laya.stage._canvasTransform.getScaleX())>1||Math.abs(n*Laya.stage._canvasTransform.getScaleY())>1))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this.target.event("dragstart",this.data),MouseManager.instance.disableMouseEvent=this._disableMouseEvent,this.target._set$P("$_MOUSEDOWN",!1)}else this._offsets.push(s,n);0===s&&0===n||(this._lastX=e,this._lastY=i,this.target.x+=s*this._elasticRateX,this.target.y+=n*this._elasticRateY,this.area&&this.checkArea(),this.target.event("dragmove",this.data))},e.checkArea=function(){if(this.elasticDistance<=0)this.backToArea();else{if(this.target.x<this.area.x)var t=this.area.x-this.target.x;else t=this.target.x>this.area.x+this.area.width?this.target.x-this.area.x-this.area.width:0;if(this._elasticRateX=Math.max(0,1-t/this.elasticDistance),this.target.y<this.area.y)var e=this.area.y-this.target.y;else e=this.target.y>this.area.y+this.area.height?this.target.y-this.area.y-this.area.height:0;this._elasticRateY=Math.max(0,1-e/this.elasticDistance)}},e.backToArea=function(){this.target.x=Math.min(Math.max(this.target.x,this.area.x),this.area.x+this.area.width),this.target.y=Math.min(Math.max(this.target.y,this.area.y),this.area.y+this.area.height)},e.onStageMouseUp=function(t){if(MouseManager.instance.disableMouseEvent=!1,Laya.stage.off("mouseup",this,this.onStageMouseUp),Laya.stage.off("mouseout",this,this.onStageMouseUp),Laya.timer.clear(this,this.loop),!this._clickOnly&&this.target)if(this.hasInertia){this._offsets.length<1&&this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY),this._offsetX=this._offsetY=0;for(var e=this._offsets.length,i=Math.min(e,6),s=this._offsets.length-i,n=e-1;n>s;n--)this._offsetY+=this._offsets[n--],this._offsetX+=this._offsets[n];this._offsetX=this._offsetX/i*2,this._offsetY=this._offsetY/i*2,Math.abs(this._offsetX)>this.maxOffset&&(this._offsetX=this._offsetX>0?this.maxOffset:-this.maxOffset),Math.abs(this._offsetY)>this.maxOffset&&(this._offsetY=this._offsetY>0?this.maxOffset:-this.maxOffset),Laya.timer.frameLoop(1,this,this.tweenMove)}else this.elasticDistance>0?this.checkElastic():this.clear()},e.checkElastic=function(){var t=NaN,e=NaN;if(this.target.x<this.area.x?t=this.area.x:this.target.x>this.area.x+this.area.width&&(t=this.area.x+this.area.width),this.target.y<this.area.y?e=this.area.y:this.target.y>this.area.y+this.area.height&&(e=this.area.y+this.area.height),isNaN(t)&&isNaN(e))this.clear();else{var i={};isNaN(t)||(i.x=t),isNaN(e)||(i.y=e),this._tween=Tween.to(this.target,i,this.elasticBackTime,Ease.sineOut,Handler.create(this,this.clear),0,!1,!1)}},e.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX,this._offsetY*=this.ratio*this._elasticRateY,this.target.x+=this._offsetX,this.target.y+=this._offsetY,this.area&&this.checkArea(),this.target.event("dragmove",this.data),(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5)&&(Laya.timer.clear(this,this.tweenMove),this.elasticDistance>0?this.checkElastic():this.clear())},e.clear=function(){if(this.target){this.clearTimer();var t=this.target;this.target=null,this._parent=null,t.event("dragend",this.data)}},t}(),Ease=function(){function t(){}return __class(t,"laya.utils.Ease"),t.linearNone=function(t,e,i,s){return i*t/s+e},t.linearIn=function(t,e,i,s){return i*t/s+e},t.linearInOut=function(t,e,i,s){return i*t/s+e},t.linearOut=function(t,e,i,s){return i*t/s+e},t.bounceIn=function(e,i,s,n){return s-t.bounceOut(n-e,0,s,n)+i},t.bounceInOut=function(e,i,s,n){return.5*n>e?.5*t.bounceIn(2*e,0,s,n)+i:.5*t.bounceOut(2*e-n,0,s,n)+.5*s+i},t.bounceOut=function(t,e,i,s){return(t/=s)<1/2.75?i*(7.5625*t*t)+e:2/2.75>t?i*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?i*(7.5625*(t-=2.25/2.75)*t+.9375)+e:i*(7.5625*(t-=2.625/2.75)*t+.984375)+e},t.backIn=function(t,e,i,s,n){return void 0===n&&(n=1.70158),i*(t/=s)*t*((n+1)*t-n)+e},t.backInOut=function(t,e,i,s,n){return void 0===n&&(n=1.70158),(t/=.5*s)<1?.5*i*(t*t*(((n*=1.525)+1)*t-n))+e:i/2*((t-=2)*t*(((n*=1.525)+1)*t+n)+2)+e},t.backOut=function(t,e,i,s,n){return void 0===n&&(n=1.70158),i*((t=t/s-1)*t*((n+1)*t+n)+1)+e},t.elasticIn=function(e,i,s,n,a,o){void 0===a&&(a=0),void 0===o&&(o=0);var r;return 0==e?i:1==(e/=n)?i+s:(o||(o=.3*n),!a||s>0&&s>a||0>s&&-s>a?(a=s,r=o/4):r=o/t.PI2*Math.asin(s/a),-(a*Math.pow(2,10*(e-=1))*Math.sin((e*n-r)*t.PI2/o))+i)},t.elasticInOut=function(e,i,s,n,a,o){void 0===a&&(a=0),void 0===o&&(o=0);var r;return 0==e?i:2==(e/=.5*n)?i+s:(o||(o=n*(.3*1.5)),!a||s>0&&s>a||0>s&&-s>a?(a=s,r=o/4):r=o/t.PI2*Math.asin(s/a),1>e?-.5*(a*Math.pow(2,10*(e-=1))*Math.sin((e*n-r)*t.PI2/o))+i:a*Math.pow(2,-10*(e-=1))*Math.sin((e*n-r)*t.PI2/o)*.5+s+i)},t.elasticOut=function(e,i,s,n,a,o){void 0===a&&(a=0),void 0===o&&(o=0);var r;return 0==e?i:1==(e/=n)?i+s:(o||(o=.3*n),!a||s>0&&s>a||0>s&&-s>a?(a=s,r=o/4):r=o/t.PI2*Math.asin(s/a),a*Math.pow(2,-10*e)*Math.sin((e*n-r)*t.PI2/o)+s+i)},t.strongIn=function(t,e,i,s){return i*(t/=s)*t*t*t*t+e},t.strongInOut=function(t,e,i,s){return(t/=.5*s)<1?.5*i*t*t*t*t*t+e:.5*i*((t-=2)*t*t*t*t+2)+e},t.strongOut=function(t,e,i,s){return i*((t=t/s-1)*t*t*t*t+1)+e},t.sineInOut=function(t,e,i,s){return.5*-i*(Math.cos(Math.PI*t/s)-1)+e},t.sineIn=function(e,i,s,n){return-s*Math.cos(e/n*t.HALF_PI)+s+i},t.sineOut=function(e,i,s,n){return s*Math.sin(e/n*t.HALF_PI)+i},t.quintIn=function(t,e,i,s){return i*(t/=s)*t*t*t*t+e},t.quintInOut=function(t,e,i,s){return(t/=.5*s)<1?.5*i*t*t*t*t*t+e:.5*i*((t-=2)*t*t*t*t+2)+e},t.quintOut=function(t,e,i,s){return i*((t=t/s-1)*t*t*t*t+1)+e},t.quartIn=function(t,e,i,s){return i*(t/=s)*t*t*t+e},t.quartInOut=function(t,e,i,s){return(t/=.5*s)<1?.5*i*t*t*t*t+e:.5*-i*((t-=2)*t*t*t-2)+e},t.quartOut=function(t,e,i,s){return-i*((t=t/s-1)*t*t*t-1)+e},t.cubicIn=function(t,e,i,s){return i*(t/=s)*t*t+e},t.cubicInOut=function(t,e,i,s){return(t/=.5*s)<1?.5*i*t*t*t+e:.5*i*((t-=2)*t*t+2)+e},t.cubicOut=function(t,e,i,s){return i*((t=t/s-1)*t*t+1)+e},t.quadIn=function(t,e,i,s){return i*(t/=s)*t+e},t.quadInOut=function(t,e,i,s){return(t/=.5*s)<1?.5*i*t*t+e:.5*-i*(--t*(t-2)-1)+e},t.quadOut=function(t,e,i,s){return-i*(t/=s)*(t-2)+e},t.expoIn=function(t,e,i,s){return 0==t?e:i*Math.pow(2,10*(t/s-1))+e-.001*i},t.expoInOut=function(t,e,i,s){return 0==t?e:t==s?e+i:(t/=.5*s)<1?.5*i*Math.pow(2,10*(t-1))+e:.5*i*(-Math.pow(2,-10*--t)+2)+e},t.expoOut=function(t,e,i,s){return t==s?e+i:i*(-Math.pow(2,-10*t/s)+1)+e},t.circIn=function(t,e,i,s){return-i*(Math.sqrt(1-(t/=s)*t)-1)+e},t.circInOut=function(t,e,i,s){return(t/=.5*s)<1?.5*-i*(Math.sqrt(1-t*t)-1)+e:.5*i*(Math.sqrt(1-(t-=2)*t)+1)+e},t.circOut=function(t,e,i,s){return i*Math.sqrt(1-(t=t/s-1)*t)+e},t.HALF_PI=.5*Math.PI,t.PI2=2*Math.PI,t}(),HitArea=function(){function t(){this._hit=null,this._unHit=null}__class(t,"laya.utils.HitArea");var e=t.prototype;return e.isHit=function(e,i){return t.isHitGraphic(e,i,this.hit)?!t.isHitGraphic(e,i,this.unHit):!1},e.contains=function(t,e){return this.isHit(t,e)},__getset(0,e,"hit",function(){return this._hit||(this._hit=new Graphics),this._hit},function(t){this._hit=t}),__getset(0,e,"unHit",function(){return this._unHit||(this._unHit=new Graphics),this._unHit},function(t){this._unHit=t}),t.isHitGraphic=function(e,i,s){if(!s)return!1;var n;if(n=s.cmds,!n&&s._one&&(n=t._cmds,n.length=1,n[0]=s._one),!n)return!1;var a=0,o=0;o=n.length;var r;for(a=0;o>a;a++)if(r=n[a]){var h=Render._context;switch(r.callee){case h._translate:case 6:e-=r[0],i-=r[1]}if(t.isHitCmd(e,i,r))return!0}return!1},t.isHitCmd=function(e,i,s){if(!s)return!1;var n=Render._context,a=!1;switch(s.callee){case n._drawRect:case 13:t._rec.setTo(s[0],s[1],s[2],s[3]),a=t._rec.contains(e,i);break;case n._drawCircle:case n._fillCircle:case 14:var o=NaN;e-=s[0],i-=s[1],o=e*e+i*i,a=o<s[2]*s[2];break;case n._drawPoly:case 18:e-=s[0],i-=s[1],a=t.ptInPolygon(e,i,s[2])}return a},t.ptInPolygon=function(e,i,s){var n;n=t._ptPoint,n.setTo(e,i);var a=0,o=NaN,r=NaN,h=NaN,l=NaN,c=0;c=s.length;for(var d=0;c>d;d+=2)if(o=s[d],r=s[d+1],h=s[(d+2)%c],l=s[(d+3)%c],r!=l&&!(n.y<Math.min(r,l)||n.y>=Math.max(r,l))){var u=(n.y-r)*(h-o)/(l-r)+o;u>n.x&&a++}return a%2==1},t._cmds=[],__static(t,["_rec",function(){return this._rec=new Rectangle},"_ptPoint",function(){return this._ptPoint=new Point}]),t}(),HTMLChar=function(){function t(e,i,s,n){this["char"]=e,this.charNum=e.charCodeAt(0),this._x=this._y=0,this.width=i,this.height=s,this.style=n,this.isWord=!t._isWordRegExp.test(e)}__class(t,"laya.utils.HTMLChar");var e=t.prototype;return Laya.imps(e,{"laya.display.ILayout":!0}),e.setSprite=function(t){this._sprite=t},e.getSprite=function(){return this._sprite},e._isChar=function(){return!0},e._getCSSStyle=function(){return this.style},__getset(0,e,"width",function(){return this._w},function(t){this._w=t}),__getset(0,e,"x",function(){return this._x},function(t){this._sprite&&(this._sprite.x=t),this._x=t}),__getset(0,e,"y",function(){return this._y},function(t){this._sprite&&(this._sprite.y=t),this._y=t}),__getset(0,e,"height",function(){return this._h},function(t){this._h=t}),t._isWordRegExp=new RegExp("[\\w.]",""),t}(),Log=function(){function t(){}return __class(t,"laya.utils.Log"),t.enable=function(){t._logdiv||(t._logdiv=Browser.window.document.createElement("div"),Browser.window.document.body.appendChild(t._logdiv),t._logdiv.style.cssText="pointer-events:none;border:white;overflow:hidden;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;")},t.toggle=function(){var e=t._logdiv.style;"1px"==e.width?e.width=e.height="50%":e.width=e.height="1px"},t.print=function(e){t._logdiv&&(t._count>=t.maxCount&&t.clear(),t._count++,t._logdiv.innerText+=e+"\n",t._logdiv.scrollTop=t._logdiv.scrollHeight)},t.clear=function(){t._logdiv.innerText="",t._count=0},t._logdiv=null,t._count=0,t.maxCount=20,t}(),Mouse=function(){function t(){}return __class(t,"laya.utils.Mouse"),__getset(1,t,"cursor",function(){return t._style.cursor},function(e){t._style.cursor=e}),t.hide=function(){"none"!=t.cursor&&(t._preCursor=t.cursor,t.cursor="none")},t.show=function(){"none"==t.cursor&&(t._preCursor?t.cursor=t._preCursor:t.cursor="auto")},t._preCursor=null,__static(t,["_style",function(){return this._style=Browser.document.body.style}]),t}(),Pool=function(){function t(){}return __class(t,"laya.utils.Pool"),t.getPoolBySign=function(e){return t._poolDic[e]||(t._poolDic[e]=[])},t.clearBySign=function(e){t._poolDic[e]&&(t._poolDic[e].length=0)},t.recover=function(e,i){i.__InPool||(i.__InPool=!0,t.getPoolBySign(e).push(i))},t.getItemByClass=function(e,i){var s=t.getPoolBySign(e),n=s.length?s.pop():new i;return n.__InPool=!1,n},t.getItemByCreateFun=function(e,i){var s=t.getPoolBySign(e),n=s.length?s.pop():i();return n.__InPool=!1,n},t.getItem=function(e){var i=t.getPoolBySign(e),s=i.length?i.pop():null;return s&&(s.__InPool=!1),s},t._poolDic={},t.InPoolSign="__InPool",t}(),PoolCache=function(){function t(){this.sign=null,this.maxCount=1e3}__class(t,"laya.utils.PoolCache");var e=t.prototype;return e.getCacheList=function(){return Pool.getPoolBySign(this.sign)},e.tryDispose=function(t){var e;e=Pool.getPoolBySign(this.sign),e.length>this.maxCount&&e.splice(this.maxCount,e.length-this.maxCount)},t.addPoolCacheManager=function(e,i){void 0===i&&(i=100);var s;s=new t,s.sign=e,s.maxCount=i,CacheManger.regCacheByFunction(Utils.bind(s.tryDispose,s),Utils.bind(s.getCacheList,s))},t}(),Stat=function(){function t(){}return __class(t,"laya.utils.Stat"),__getset(1,t,"onclick",null,function(e){t._canvas.source.onclick=e,t._canvas.source.style.pointerEvents=""}),t.show=function(e,i){if(void 0===e&&(e=0),void 0===i&&(i=0),Render.isConchApp)return void(conch.showFPS&&conch.showFPS(e,i));var s=Browser.pixelRatio;t._width=130*s,t._vx=75*s,t._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"},t._view[1]={title:"Sprite",value:"spriteCount",color:"white",units:"int"},t._view[2]={title:"DrawCall",value:"drawCall",color:"white",units:"int"},t._view[3]={title:"CurMem",value:"currentMemorySize",color:"yellow",units:"M"},Render.isWebGL?(t._view[4]={title:"Shader",value:"shaderCall",color:"white",units:"int"},Render.is3DMode?(t._view[0].title="FPS(3D)",t._view[5]={title:"TriFaces",value:"trianglesFaces",color:"white",units:"int"},t._view[6]={title:"treeNodeColl",value:"treeNodeCollision",color:"white",units:"int"},t._view[7]={title:"treeSpriteColl",value:"treeSpriteCollision",color:"white",units:"int"}):(t._view[0].title="FPS(WebGL)",t._view[5]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"})):t._view[4]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"},t._fontSize=12*s;for(var n=0;n<t._view.length;n++)t._view[n].x=4,t._view[n].y=n*t._fontSize+2*s;t._height=s*(12*t._view.length+3*s)+4,t._canvas||(t._canvas=new HTMLCanvas("2D"),t._canvas.size(t._width,t._height),t._ctx=t._canvas.getContext("2d"),t._ctx.textBaseline="top",t._ctx.font=t._fontSize+"px Sans-serif",t._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;left:"+e+"px;top:"+i+"px;width:"+t._width/s+"px;height:"+t._height/s+"px;"),t._first=!0,t.loop(),t._first=!1,Browser.container.appendChild(t._canvas.source),t.enable()},t.enable=function(){Laya.timer.frameLoop(1,t,t.loop)},t.hide=function(){t._canvas&&(Browser.removeElement(t._canvas.source),Laya.timer.clear(t,t.loop))},t.clear=function(){t.trianglesFaces=t.drawCall=t.shaderCall=t.spriteCount=t.treeNodeCollision=t.treeSpriteCollision=t.canvasNormal=t.canvasBitmap=t.canvasReCache=0},t.loop=function(){t._count++;var e=Browser.now();if(!(e-t._timer<1e3)){var i=t._count;t.FPS=Math.round(1e3*i/(e-t._timer)),t.trianglesFaces=Math.round(t.trianglesFaces/i),t.drawCall=Math.round(t.drawCall/i)-2,t.shaderCall=Math.round(t.shaderCall/i),t.spriteCount=Math.round(t.spriteCount/i)-1,t.canvasNormal=Math.round(t.canvasNormal/i),t.canvasBitmap=Math.round(t.canvasBitmap/i),t.canvasReCache=Math.ceil(t.canvasReCache/i),t.treeNodeCollision=Math.round(t.treeNodeCollision/i),t.treeSpriteCollision=Math.round(t.treeSpriteCollision/i);var s=t.FPS>0?Math.floor(1e3/t.FPS).toString():" ";if(t._fpsStr=t.FPS+(t.renderSlow?" slow":"")+" "+s,t._canvasStr=t.canvasReCache+"/"+t.canvasNormal+"/"+t.canvasBitmap,t.currentMemorySize=ResourceManager.systemResourceManager.memorySize,Laya.stage.event("qmdld_FPS_report"),t._canvas){var n=t._ctx;n.clearRect(t._first?0:t._vx,0,t._width,t._height);for(var a=0;a<t._view.length;a++){var o=t._view[a];t._first&&(n.fillStyle="white",n.fillText(o.title,o.x,o.y,null,null,null)),n.fillStyle=o.color;var r=t[o.value];"M"==o.units&&(r=Math.floor(r/1048576*100)/100+" M"),n.fillText(r+"",o.x+t._vx,o.y,null,null,null)}t.clear()}t._count=0,t._timer=e}},t.FPS=0,t.loopCount=0,t.shaderCall=0,t.drawCall=0,t.trianglesFaces=0,t.spriteCount=0,t.treeNodeCollision=0,t.treeSpriteCollision=0,t.canvasNormal=0,t.canvasBitmap=0,t.canvasReCache=0,t.renderSlow=!1,t.currentMemorySize=0,t._fpsStr=null,t._canvasStr=null,t._canvas=null,t._ctx=null,t._timer=0,t._count=0,t._width=0,t._height=100,t._view=[],t._fontSize=12,t._first=!1,t._vx=NaN,t}(),StringKey=function(){function t(){this._strsToID={},this._idToStrs=[],this._length=0}__class(t,"laya.utils.StringKey");var e=t.prototype;return e.add=function(t){var e=this._strsToID[t];return null!=e?e:(this._idToStrs[this._length]=t,this._strsToID[t]=this._length++)},e.getID=function(t){var e=this._strsToID[t];return null==e?-1:e},e.getName=function(t){var e=this._idToStrs[t];return null==e?void 0:e},t}(),Timer=function(){function t(){this._delta=0,this.scale=1,this.currFrame=0,this._mid=1,this._map=[],this._laters=[],this._handlers=[],this._temp=[],this._count=0,this.currTimer=Browser.now(),this._lastTimer=Browser.now(),Laya.timer&&Laya.timer.frameLoop(1,this,this._update)}var e;__class(t,"laya.utils.Timer");var i=t.prototype;return i._update=function(){if(this.scale<=0)return void(this._lastTimer=Browser.now());var t=this.currFrame=this.currFrame+this.scale,e=Browser.now();this._delta=(e-this._lastTimer)*this.scale;var i=this.currTimer=this.currTimer+this._delta;this._lastTimer=e;var s=this._handlers;for(this._count=0,o=0,r=s.length;r>o;o++)if(h=s[o],null!==h.method){var n=h.userFrame?t:i;n>=h.exeTime&&(h.repeat?n>h.exeTime&&(h.exeTime+=h.delay,h.run(!1),n>h.exeTime&&(h.exeTime+=Math.ceil((n-h.exeTime)/h.delay)*h.delay)):h.run(!0))}else this._count++;(this._count>30||t%200===0)&&this._clearHandlers();for(var a=this._laters,o=0,r=a.length-1;r>=o;o++){var h=a[o];null!==h.method&&(this._map[h.key]=null,h.run(!1)),this._recoverHandler(h),o===r&&(r=a.length-1)}a.length=0},i._clearHandlers=function(){for(var t=this._handlers,e=0,i=t.length;i>e;e++){var s=t[e];null!==s.method?this._temp.push(s):this._recoverHandler(s)}this._handlers=this._temp,this._temp=t,this._temp.length=0},i._recoverHandler=function(e){this._map[e.key]==e&&(this._map[e.key]=null),e.clear(),t._pool.push(e)},i._create=function(i,s,n,a,o,r,h){if(!n)return void o.apply(a,r);if(h){var l=this._getHandler(a,o);if(l)return l.repeat=s,l.userFrame=i,l.delay=n,l.caller=a,l.method=o,l.args=r,void(l.exeTime=n+(i?this.currFrame:this.currTimer+Browser.now()-this._lastTimer))}l=t._pool.length>0?t._pool.pop():new e,l.repeat=s,l.userFrame=i,l.delay=n,l.caller=a,l.method=o,l.args=r,l.exeTime=n+(i?this.currFrame:this.currTimer+Browser.now()-this._lastTimer),this._indexHandler(l),this._handlers.push(l)},i._indexHandler=function(t){var e=t.caller,i=t.method,s=e?e.$_GID||(e.$_GID=Utils.getGID()):0,n=i.$_TID||(i.$_TID=1e5*this._mid++);t.key=s+n,this._map[t.key]=t},i.once=function(t,e,i,s,n){void 0===n&&(n=!0),this._create(!1,!1,t,e,i,s,n)},i.loop=function(t,e,i,s,n){void 0===n&&(n=!0),this._create(!1,!0,t,e,i,s,n)},i.frameOnce=function(t,e,i,s,n){void 0===n&&(n=!0),this._create(!0,!1,t,e,i,s,n)},i.frameLoop=function(t,e,i,s,n){void 0===n&&(n=!0),this._create(!0,!0,t,e,i,s,n)},i.toString=function(){return"callLater:"+this._laters.length+" handlers:"+this._handlers.length+" pool:"+t._pool.length},i.clear=function(t,e){var i=this._getHandler(t,e);i&&(this._map[i.key]=null,i.key=0,i.clear())},i.clearAll=function(t){if(t)for(var e=0,i=this._handlers.length;i>e;e++){var s=this._handlers[e];s.caller===t&&(this._map[s.key]=null,s.key=0,s.clear())}},i._getHandler=function(t,e){var i=t?t.$_GID||(t.$_GID=Utils.getGID()):0,s=e.$_TID||(e.$_TID=1e5*this._mid++);return this._map[i+s]},i.callLater=function(i,s,n){if(null==this._getHandler(i,s)){if(t._pool.length)var a=t._pool.pop();else a=new e;a.caller=i,a.method=s,a.args=n,this._indexHandler(a),this._laters.push(a)}},i.runCallLater=function(t,e){var i=this._getHandler(t,e);i&&null!=i.method&&(this._map[i.key]=null,i.run(!0))},i.runTimer=function(t,e){this.runCallLater(t,e)},__getset(0,i,"delta",function(){return this._delta}),t._pool=[],t.__init$=function(){e=function(){function t(){this.key=0,this.repeat=!1,this.delay=0,this.userFrame=!1,this.exeTime=0,this.caller=null,this.method=null,this.args=null}__class(t,"");var e=t.prototype;return e.clear=function(){this.caller=null,this.method=null,this.args=null},e.run=function(t){var e=this.caller;if(e&&e.destroyed)return this.clear();var i=this.method,s=this.args;t&&this.clear(),null!=i&&(s?i.apply(e,s):i.call(e))},t}()},t}(),Tween=function(){function t(){this.gid=0}__class(t,"laya.utils.Tween");var e=t.prototype;return e.to=function(t,e,i,s,n,a,o){return void 0===a&&(a=0),void 0===o&&(o=!1),this._create(t,e,i,s,n,a,o,!0,!1,!0)},e.from=function(t,e,i,s,n,a,o){return void 0===a&&(a=0),void 0===o&&(o=!1),this._create(t,e,i,s,n,a,o,!1,!1,!0)},e._create=function(e,i,s,n,a,o,r,h,l,c){if(!e)throw new Error("Tween:target is null");this._target=e,this._duration=s,this._ease=n||i.ease||t.easeNone,this._complete=a||i.complete,this._delay=o,this._props=[],this._usedTimer=0,this._startTimer=Browser.now(),this._usedPool=l,this.update=i.update;var d=e.$_GID||(e.$_GID=Utils.getGID());return t.tweenMap[d]?(r&&t.clearTween(e),t.tweenMap[d].push(this)):t.tweenMap[d]=[this],c?0>=o?this.firstStart(e,i,h):Laya.timer.once(o,this,this.firstStart,[e,i,h]):this._initProps(e,i,h),this},e.firstStart=function(t,e,i){return t.destroyed?void this.clear():(this._initProps(t,e,i),void this._beginLoop())},e._initProps=function(t,e,i){for(var s in e)if("number"==typeof t[s]){var n=i?t[s]:e[s],a=i?e[s]:t[s];this._props.push([s,n,a-n]),i||(t[s]=n)}},e._beginLoop=function(){Laya.timer.frameLoop(1,this,this._doEase)},e._doEase=function(){this._updateEase(Browser.now())},e._updateEase=function(e){var i=this._target;if(i){if(i.destroyed)return t.clearTween(i);var s=this._usedTimer=e-this._startTimer-this._delay;if(!(0>s)){if(s>=this._duration)return this.complete();for(var n=s>0?this._ease(s,0,1,this._duration):0,a=this._props,o=0,r=a.length;r>o;o++){var h=a[o];i[h[0]]=h[1]+n*h[2]}this.update&&this.update.run()}}},e.complete=function(){if(this._target){Laya.timer.runTimer(this,this.firstStart);for(var t=this._target,e=this._props,i=this._complete,s=0,n=e.length;n>s;s++){var a=e[s];t[a[0]]=a[1]+a[2]}this.update&&this.update.run(),this.clear(),i&&i.run()}},e.pause=function(){Laya.timer.clear(this,this._beginLoop),Laya.timer.clear(this,this._doEase)},e.setStartTime=function(t){this._startTimer=t},e.clear=function(){this._target&&(this._remove(),this._clear())},e._clear=function(){this.pause(),Laya.timer.clear(this,this.firstStart),this._complete=null,this._target=null,this._ease=null,this._props=null,this._usedPool&&(this.update=null,Pool.recover("tween",this))},e.recover=function(){this._usedPool=!0,this._clear()},e._remove=function(){var e=t.tweenMap[this._target.$_GID];if(e)for(var i=0,s=e.length;s>i;i++)if(e[i]===this){e.splice(i,1);break}},e.restart=function(){this.pause(),this._usedTimer=0,this._startTimer=Browser.now();for(var t=this._props,e=0,i=t.length;i>e;e++){var s=t[e];this._target[s[0]]=s[1]}Laya.timer.once(this._delay,this,this._beginLoop)},e.resume=function(){this._usedTimer>=this._duration||(this._startTimer=Browser.now()-this._usedTimer-this._delay,this._beginLoop())},__getset(0,e,"progress",null,function(t){var e=t*this._duration;this._startTimer=Browser.now()-this._delay-e}),t.to=function(e,i,s,n,a,o,r,h){return void 0===o&&(o=0),void 0===r&&(r=!1),void 0===h&&(h=!0),Pool.getItemByClass("tween",t)._create(e,i,s,n,a,o,r,!0,h,!0)},t.from=function(e,i,s,n,a,o,r,h){return void 0===o&&(o=0),void 0===r&&(r=!1),void 0===h&&(h=!0),Pool.getItemByClass("tween",t)._create(e,i,s,n,a,o,r,!1,h,!0)},t.clearAll=function(e){if(e&&e.$_GID){var i=t.tweenMap[e.$_GID];if(i){for(var s=0,n=i.length;n>s;s++)i[s]._clear();i.length=0}}},t.clear=function(t){t.clear()},t.clearTween=function(e){t.clearAll(e)},t.easeNone=function(t,e,i,s){return i*t/s+e},t.tweenMap={},t}(),Utils=function(){function t(){}return __class(t,"laya.utils.Utils"),t.toRadian=function(e){return e*t._pi2},t.toAngle=function(e){return e*t._pi},t.toHexColor=function(t){if(0>t||isNaN(t))return null;for(var e=t.toString(16);e.length<6;)e="0"+e;return"#"+e},t.getGID=function(){return t._gid++},t.concatArray=function(t,e){if(!e)return t;if(!t)return e;var i=0,s=e.length;for(i=0;s>i;i++)t.push(e[i]);return t},t.clearArray=function(t){return t?(t.length=0,t):t},t.copyArray=function(t,e){if(t||(t=[]),!e)return t;t.length=e.length;var i=0,s=e.length;for(i=0;s>i;i++)t[i]=e[i];return t},t.getGlobalRecByPoints=function(t,e,i,s,n){var a;a=new Point(e,i),a=t.localToGlobal(a);var o;return o=new Point(s,n),o=t.localToGlobal(o),Rectangle._getWrapRec([a.x,a.y,o.x,o.y])},t.getGlobalPosAndScale=function(e){return t.getGlobalRecByPoints(e,0,0,1,1)},t.bind=function(t,e){var i=t;return i=t.bind(e)},t.measureText=function(t,e){return RunDriver.measureText(t,e)},t.updateOrder=function(t){if(!t||t.length<2)return!1;for(var e,i=1,s=0,n=t.length,a=NaN;n>i;){for(s=i,e=t[s],a=t[s]._zOrder;--s>-1&&t[s]._zOrder>a;)t[s+1]=t[s];t[s+1]=e,i++}var o=e.parent.conchModel;if(o)if(null!=o.updateZOrder)o.updateZOrder();else{for(i=0;n>i;i++)o.removeChild(t[i].conchModel);for(i=0;n>i;i++)o.addChildAt(t[i].conchModel,i)}return!0},t.transPointList=function(t,e,i){var s=0,n=t.length;for(s=0;n>s;s+=2)t[s]+=e,t[s+1]+=i},t.parseInt=function(t,e){void 0===e&&(e=0);var i=Browser.window.parseInt(t,e);return isNaN(i)?0:i},t.getFileExtension=function(e){t._extReg.lastIndex=e.lastIndexOf(".");var i=t._extReg.exec(e);return i&&i.length>1?i[1].toLowerCase():null},t.getTransformRelativeToWindow=function(t,e,i){var s=Laya.stage,n=laya.utils.Utils.getGlobalPosAndScale(t),a=s._canvasTransform.clone(),o=a.tx,r=a.ty;a.rotate(-Math.PI/180*Laya.stage.canvasDegree),a.scale(Laya.stage.clientScaleX,Laya.stage.clientScaleY);var h=Laya.stage.canvasDegree%180!=0,l=NaN,c=NaN;h?(l=i+n.y,c=e+n.x,l*=a.d,c*=a.a,90==Laya.stage.canvasDegree?(l=o-l,c+=r):(l+=o,c=r-c)):(l=e+n.x,c=i+n.y,l*=a.a,c*=a.d,l+=o,c+=r),c+=Laya.stage._safariOffsetY;var d=NaN,u=NaN;return h?(d=a.d*n.height,
u=a.a*n.width):(d=a.a*n.width,u=a.d*n.height),{x:l,y:c,scaleX:d,scaleY:u}},t.fitDOMElementInArea=function(e,i,s,n,a,o){e._fitLayaAirInitialized||(e._fitLayaAirInitialized=!0,e.style.transformOrigin=e.style.webKittransformOrigin="left top",e.style.position="absolute");var r=t.getTransformRelativeToWindow(i,s,n);e.style.transform=e.style.webkitTransform="scale("+r.scaleX+","+r.scaleY+") rotate("+Laya.stage.canvasDegree+"deg)",e.style.width=a+"px",e.style.height=o+"px",e.style.left=r.x+"px",e.style.top=r.y+"px"},t._gid=1,t._pi=180/Math.PI,t._pi2=Math.PI/180,t._extReg=/\.(\w+)\??/g,t.parseXMLFromString=function(t){var e;if(t=t.replace(/>\s+</g,"><"),e=(new DOMParser).parseFromString(t,"text/xml"),e.firstChild.textContent.indexOf("This page contains the following errors")>-1)throw new Error(e.firstChild.firstChild.textContent);return e},t}(),VectorGraphManager=function(){function t(){this.useDic={},this.shapeDic={},this.shapeLineDic={},this._id=0,this._checkKey=!1,this._freeIdArray=[],Render.isWebGL&&CacheManger.regCacheByFunction(Utils.bind(this.startDispose,this),Utils.bind(this.getCacheList,this))}__class(t,"laya.utils.VectorGraphManager");var e=t.prototype;return e.getId=function(){return this._id++},e.addShape=function(t,e){this.shapeDic[t]=e,this.useDic[t]||(this.useDic[t]=!0)},e.addLine=function(t,e){this.shapeLineDic[t]=e,this.shapeLineDic[t]||(this.shapeLineDic[t]=!0)},e.getShape=function(t){this._checkKey&&null!=this.useDic[t]&&(this.useDic[t]=!0)},e.deleteShape=function(t){this.shapeDic[t]&&(this.shapeDic[t]=null,delete this.shapeDic[t]),this.shapeLineDic[t]&&(this.shapeLineDic[t]=null,delete this.shapeLineDic[t]),null!=this.useDic[t]&&delete this.useDic[t]},e.getCacheList=function(){var t,e=[];for(t in this.shapeDic)e.push(this.shapeDic[t]);for(t in this.shapeLineDic)e.push(this.shapeLineDic[t]);return e},e.startDispose=function(t){var e;for(e in this.useDic)this.useDic[e]=!1;this._checkKey=!0},e.endDispose=function(){if(this._checkKey){var t;for(t in this.useDic)this.useDic[t]||this.deleteShape(t);this._checkKey=!1}},t.getInstance=function(){return t.instance=t.instance||new t},t.instance=null,t}(),WordText=function(){function t(){this.id=NaN,this.save=[],this.toUpperCase=null,this.changed=!1,this._text=null}__class(t,"laya.utils.WordText");var e=t.prototype;return e.setText=function(t){this.changed=!0,this._text=t},e.toString=function(){return this._text},e.charCodeAt=function(t){return this._text?this._text.charCodeAt(t):NaN},e.charAt=function(t){return this._text?this._text.charAt(t):null},__getset(0,e,"length",function(){return this._text?this._text.length:0}),t}(),Node=function(t){function e(){this._bits=0,this._displayedInStage=!1,this._parent=null,this.conchModel=null,this.name="",this.destroyed=!1,e.__super.call(this),this._childs=e.ARRAY_EMPTY,this._$P=e.PROP_EMPTY,this.timer=Laya.timer,this.conchModel=Render.isConchNode?this.createConchModel():null}__class(e,"laya.display.Node",t);var i=e.prototype;return i._setBit=function(t,e){if(1==t){var i=this._getBit(t);i!=e&&this._updateDisplayedInstage()}e?this._bits|=t:this._bits&=~t},i._getBit=function(t){return 0!=(this._bits&t)},i._setUpNoticeChain=function(){this._getBit(1)&&this._setUpNoticeType(1)},i._setUpNoticeType=function(t){var e=this;for(e._setBit(t,!0),e=e.parent;e;){if(e._getBit(t))return;e._setBit(t,!0),e=e.parent}},i.on=function(t,e,i,s){return"display"!==t&&"undisplay"!==t||this._getBit(1)||this._setUpNoticeType(1),this._createListener(t,e,i,s,!1)},i.once=function(t,e,i,s){return"display"!==t&&"undisplay"!==t||this._getBit(1)||this._setUpNoticeType(1),this._createListener(t,e,i,s,!0)},i.createConchModel=function(){return null},i.destroy=function(t){void 0===t&&(t=!0),this.destroyed=!0,this._parent&&this._parent.removeChild(this),this._childs&&(t?this.destroyChildren():this.removeChildren()),this._childs=null,this._$P=null,this.offAll(),this.timer.clearAll(this)},i.destroyChildren=function(){if(this._childs)for(var t=this._childs.length-1;t>-1;t--)this._childs[t].destroy(!0)},i.addChild=function(t){if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),t._parent===this){var i=this.getChildIndex(t);i!==this._childs.length-1&&(this._childs.splice(i,1),this._childs.push(t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,this._childs.length-1)),this._childChanged())}else t.parent&&t.parent.removeChild(t),this._childs===e.ARRAY_EMPTY&&(this._childs=[]),this._childs.push(t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,this._childs.length-1),t.parent=this,this._childChanged();return t},i.addChildren=function(t){for(var e=arguments,i=0,s=e.length;s>i;)this.addChild(e[i++])},i.addChildAt=function(t,i){if(!t||this.destroyed||t===this)return t;if(t.zOrder&&this._set$P("hasZorder",!0),i>=0&&i<=this._childs.length){if(t._parent===this){var s=this.getChildIndex(t);this._childs.splice(s,1),this._childs.splice(i,0,t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,i)),this._childChanged()}else t.parent&&t.parent.removeChild(t),this._childs===e.ARRAY_EMPTY&&(this._childs=[]),this._childs.splice(i,0,t),this.conchModel&&this.conchModel.addChildAt(t.conchModel,i),t.parent=this;return t}throw new Error("appendChildAt:The index is out of bounds")},i.getChildIndex=function(t){return this._childs.indexOf(t)},i.getChildByName=function(t){var e=this._childs;if(e)for(var i=0,s=e.length;s>i;i++){var n=e[i];if(n.name===t)return n}return null},i._get$P=function(t){return this._$P[t]},i._set$P=function(t,i){return this.destroyed||(this._$P===e.PROP_EMPTY&&(this._$P={}),this._$P[t]=i),i},i.getChildAt=function(t){return this._childs[t]},i.setChildIndex=function(t,e){var i=this._childs;if(0>e||e>=i.length)throw new Error("setChildIndex:The index is out of bounds.");var s=this.getChildIndex(t);if(0>s)throw new Error("setChildIndex:node is must child of this object.");return i.splice(s,1),i.splice(e,0,t),this.conchModel&&(this.conchModel.removeChild(t.conchModel),this.conchModel.addChildAt(t.conchModel,e)),this._childChanged(),t},i._childChanged=function(t){},i.removeChild=function(t){if(!this._childs)return t;var e=this._childs.indexOf(t);return this.removeChildAt(e)},i.removeSelf=function(){return this._parent&&this._parent.removeChild(this),this},i.removeChildByName=function(t){var e=this.getChildByName(t);return e&&this.removeChild(e),e},i.removeChildAt=function(t){var e=this.getChildAt(t);return e&&(this._childs.splice(t,1),this.conchModel&&this.conchModel.removeChild(e.conchModel),e.parent=null),e},i.removeChildren=function(t,i){if(void 0===t&&(t=0),void 0===i&&(i=2147483647),this._childs&&this._childs.length>0){var s=this._childs;if(0===t&&i>=o){var n=s;this._childs=e.ARRAY_EMPTY}else n=s.splice(t,i-t);for(var a=0,o=n.length;o>a;a++)n[a].parent=null,this.conchModel&&this.conchModel.removeChild(n[a].conchModel)}return this},i.replaceChild=function(t,e){var i=this._childs.indexOf(e);return i>-1?(this._childs.splice(i,1,t),this.conchModel&&(this.conchModel.removeChild(e.conchModel),this.conchModel.addChildAt(t.conchModel,i)),e.parent=null,t.parent=this,t):null},i._updateDisplayedInstage=function(){var t;t=this;var e=Laya.stage;for(this._displayedInStage=!1;t;){if(t._getBit(1)){this._displayedInStage=t._displayedInStage;break}if(t==e||t._displayedInStage){this._displayedInStage=!0;break}t=t.parent}},i._setDisplay=function(t){this._displayedInStage!==t&&(this._displayedInStage=t,t?this.event("display"):this.event("undisplay"))},i._displayChild=function(t,e){var i=t._childs;if(i)for(var s=0,n=i.length;n>s;s++){var a=i[s];a._getBit(1)&&(a._childs.length>0?this._displayChild(a,e):a._setDisplay(e))}t._setDisplay(e)},i.contains=function(t){if(t===this)return!0;for(;t;){if(t.parent===this)return!0;t=t.parent}return!1},i.timerLoop=function(t,e,i,s,n){void 0===n&&(n=!0),this.timer._create(!1,!0,t,e,i,s,n)},i.timerOnce=function(t,e,i,s,n){void 0===n&&(n=!0),this.timer._create(!1,!1,t,e,i,s,n)},i.frameLoop=function(t,e,i,s,n){void 0===n&&(n=!0),this.timer._create(!0,!0,t,e,i,s,n)},i.frameOnce=function(t,e,i,s,n){void 0===n&&(n=!0),this.timer._create(!0,!1,t,e,i,s,n)},i.clearTimer=function(t,e){this.timer.clear(t,e)},__getset(0,i,"numChildren",function(){return this._childs.length}),__getset(0,i,"parent",function(){return this._parent},function(t){this._parent!==t&&(t?(this._parent=t,this.event("added"),this._getBit(1)&&(this._setUpNoticeChain(),t.displayedInStage&&this._displayChild(this,!0)),t._childChanged(this)):(this.event("removed"),this._parent._childChanged(),this._getBit(1)&&this._displayChild(this,!1),this._parent=t))}),__getset(0,i,"displayedInStage",function(){return this._getBit(1)?this._displayedInStage:(this._setUpNoticeType(1),this._displayedInStage)}),e.ARRAY_EMPTY=[],e.PROP_EMPTY={},e.NOTICE_DISPLAY=1,e.MOUSEENABLE=2,e}(EventDispatcher),CSSStyle=function(t){function e(t){this._bgground=null,this._border=null,this._rect=null,this.lineHeight=0,e.__super.call(this),this._padding=e._PADDING,this._spacing=e._SPACING,this._aligns=e._ALIGNS,this._font=Font.EMPTY,this._ower=t}__class(e,"laya.display.css.CSSStyle",t);var i=e.prototype;return i.destroy=function(){this._ower=null,this._font=null,this._rect=null},i.inherit=function(t){this._font=t._font,this._spacing=t._spacing===e._SPACING?e._SPACING:t._spacing.slice(),this.lineHeight=t.lineHeight},i._widthAuto=function(){return 0!==(262144&this._type)},i.widthed=function(t){return 0!=(8&this._type)},i._calculation=function(t,e){function i(t,e,i){return t*i[0]+e*i[1]+i[2]}function s(t){var e=a.width,s=n.width;o.width&&(n.width=i(e,s,o.width)),o.height&&(n.height=i(e,s,o.height)),o.left&&(n.x=i(e,s,o.left)),o.top&&(n.y=i(e,s,o.top))}if(e.indexOf("%")<0)return!1;var n=this._ower,a=n.parent,o=this._rect;null===o&&(a._getCSSStyle()._type|=524288,a.on("resize",this,s),this._rect=o={input:{}});var r=e.split(" ");return r[0]=parseFloat(r[0])/100,1==r.length?r[1]=r[2]=0:(r[1]=parseFloat(r[1])/100,r[2]=parseFloat(r[2])),o[t]=r,o.input[t]=e,s(t),!0},i.heighted=function(t){return 0!=(8192&this._type)},i.size=function(t,e){var i=this._ower,s=!1;-1!==t&&t!=this._ower.width&&(this._type|=8,this._ower.width=t,s=!0),-1!==e&&e!=this._ower.height&&(this._type|=8192,this._ower.height=e,s=!0),s&&(i._layoutLater(),524288&this._type&&i.event("resize",this))},i._getAlign=function(){return this._aligns[0]},i._getValign=function(){return this._aligns[1]},i._getCssFloat=function(){return 0!=(32768&this._type)?32768:0},i._createFont=function(){return 4096&this._type?this._font:(this._type|=4096,this._font=new Font(this._font))},i.render=function(t,e,i,s){var n=t.width,a=t.height;i-=t.pivotX,s-=t.pivotY,this._bgground&&null!=this._bgground.color&&e.ctx.fillRect(i,s,n,a,this._bgground.color),this._border&&this._border.color&&e.drawRect(i,s,n,a,this._border.color.strColor,this._border.size)},i.getCSSStyle=function(){return this},i.cssText=function(t){this.attrs(e.parseOneCSS(t,";"))},i.attrs=function(t){if(t)for(var e=0,i=t.length;i>e;e++){var s=t[e];this[s[0]]=s[1]}},i.setTransform=function(t){"none"===t?this._tf=Style._TF_EMPTY:this.attrs(e.parseOneCSS(t,","))},i.translate=function(t,e){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.translateX=t,this._tf.translateY=e},i.scale=function(t,e){this._tf===Style._TF_EMPTY&&(this._tf=new TransformInfo),this._tf.scaleX=t,this._tf.scaleY=e},i._enableLayout=function(){return 0===(2&this._type)&&0===(4&this._type)},__getset(0,i,"block",t.prototype._$get_block,function(t){t?this._type|=1:this._type&=-2}),__getset(0,i,"valign",function(){return e._valigndef[this._aligns[1]]},function(t){this._aligns===e._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[1]=e._valigndef[t]}),__getset(0,i,"height",null,function(t){if(this._type|=8192,"string"==typeof t){if(this._calculation("height",t))return;t=parseInt(t)}this.size(-1,t)}),__getset(0,i,"width",null,function(t){if(this._type|=8,"string"==typeof t){var e=t.indexOf("auto");if(e>=0&&(this._type|=262144,t=t.substr(0,e)),this._calculation("width",t))return;t=parseInt(t)}this.size(t,-1)}),__getset(0,i,"fontWeight",function(){return this._font.weight},function(t){this._createFont().weight=t}),__getset(0,i,"left",null,function(t){var e=this._ower;if("string"==typeof t){if("center"===t?t="50% -50% 0":"right"===t&&(t="100% -100% 0"),this._calculation("left",t))return;t=parseInt(t)}e.x=t}),__getset(0,i,"_translate",null,function(t){this.translate(t[0],t[1])}),__getset(0,i,"absolute",function(){return 0!==(4&this._type)}),__getset(0,i,"top",null,function(t){var e=this._ower;if("string"==typeof t){if("middle"===t?t="50% -50% 0":"bottom"===t&&(t="100% -100% 0"),this._calculation("top",t))return;t=parseInt(t)}e.y=t}),__getset(0,i,"align",function(){return e._aligndef[this._aligns[0]]},function(t){this._aligns===e._ALIGNS&&(this._aligns=[0,0,0]),this._aligns[0]=e._aligndef[t]}),__getset(0,i,"bold",function(){return this._font.bold},function(t){this._createFont().bold=t}),__getset(0,i,"padding",function(){return this._padding},function(t){this._padding=t}),__getset(0,i,"leading",function(){return this._spacing[1]},function(t){"string"==typeof t&&(t=parseInt(t+"")),this._spacing===e._SPACING&&(this._spacing=[0,0]),this._spacing[1]=t}),__getset(0,i,"lineElement",function(){return 0!=(65536&this._type)},function(t){t?this._type|=65536:this._type&=-65537}),__getset(0,i,"cssFloat",function(){return 0!=(32768&this._type)?"right":"left"},function(t){this.lineElement=!1,"right"===t?this._type|=32768:this._type&=-32769}),__getset(0,i,"textDecoration",function(){return this._font.decoration},function(t){this._createFont().decoration=t}),__getset(0,i,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function(t){"nowrap"===t&&(this._type|=131072),"none"===t&&(this._type&=-131073)}),__getset(0,i,"background",null,function(t){return t?(this._bgground||(this._bgground={}),this._bgground.color=t,this._ower.conchModel&&this._ower.conchModel.bgColor(t),this._type|=16384,void(this._ower._renderType|=256)):void(this._bgground=null)}),__getset(0,i,"wordWrap",function(){return 0===(131072&this._type)},function(t){t?this._type&=-131073:this._type|=131072}),__getset(0,i,"color",function(){return this._font.color},function(t){this._createFont().color=t}),__getset(0,i,"password",function(){return this._font.password},function(t){this._createFont().password=t}),__getset(0,i,"backgroundColor",function(){return this._bgground?this._bgground.color:null},function(t){"none"===t?this._bgground=null:(this._bgground||(this._bgground={}),this._bgground.color=t),this._ower.conchModel&&this._ower.conchModel.bgColor(t),this._ower._renderType|=256}),__getset(0,i,"font",function(){return this._font.toString()},function(t){this._createFont().set(t)}),__getset(0,i,"weight",null,function(t){this._createFont().weight=t}),__getset(0,i,"letterSpacing",function(){return this._spacing[0]},function(t){"string"==typeof t&&(t=parseInt(t+"")),this._spacing===e._SPACING&&(this._spacing=[0,0]),this._spacing[0]=t}),__getset(0,i,"fontSize",function(){return this._font.size},function(t){this._createFont().size=t}),__getset(0,i,"italic",function(){return this._font.italic},function(t){this._createFont().italic=t}),__getset(0,i,"fontFamily",function(){return this._font.family},function(t){this._createFont().family=t}),__getset(0,i,"stroke",function(){return this._font.stroke[0]},function(t){this._createFont().stroke===Font._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[0]=t}),__getset(0,i,"strokeColor",function(){return this._font.stroke[1]},function(t){this._createFont().stroke===Font._STROKE&&(this._font.stroke=[0,"#000000"]),this._font.stroke[1]=t}),__getset(0,i,"border",function(){return this._border?this._border.value:""},function(t){if("none"==t)return void(this._border=null);this._border||(this._border={}),this._border.value=t;var e=t.split(" ");if(this._border.color=Color.create(e[e.length-1]),1==e.length)return this._border.size=1,void(this._border.type="solid");var i=0;e[0].indexOf("px")>0?(this._border.size=parseInt(e[0]),i++):this._border.size=1,this._border.type=e[i],this._ower._renderType|=256}),__getset(0,i,"borderColor",function(){return this._border&&this._border.color?this._border.color.strColor:null},function(t){return t?(this._border||(this._border={size:1,type:"solid"}),this._border.color=null==t?null:Color.create(t),this._ower.conchModel&&this._ower.conchModel.border(this._border.color.strColor),void(this._ower._renderType|=256)):void(this._border=null)}),__getset(0,i,"position",function(){return 4&this._type?"absolute":""},function(t){"absolute"==t?this._type|=4:this._type&=-5}),__getset(0,i,"display",null,function(t){switch(t){case"":this._type&=-3,this.visible=!0;break;case"none":this._type|=2,this.visible=!1,this._ower._layoutLater()}}),__getset(0,i,"paddingLeft",function(){return this.padding[3]}),__getset(0,i,"paddingTop",function(){return this.padding[0]}),__getset(0,i,"_scale",null,function(t){this._ower.scale(t[0],t[1])}),__getset(0,i,"_rotate",null,function(t){this._ower.rotation=t}),e.parseOneCSS=function(t,i){for(var s,n=[],a=t.split(i),o=0,r=a.length;r>o;o++){var h=a[o],l=h.indexOf(":"),c=h.substr(0,l).replace(/^\s+|\s+$/g,"");if(0!=c.length){var d=h.substr(l+1).replace(/^\s+|\s+$/g,""),u=[c,d];switch(c){case"italic":case"bold":u[1]="true"==d;break;case"line-height":u[0]="lineHeight",u[1]=parseInt(d);break;case"font-size":u[0]="fontSize",u[1]=parseInt(d);break;case"padding":s=d.split(" "),s.length>1||(s[1]=s[2]=s[3]=s[0]),u[1]=[parseInt(s[0]),parseInt(s[1]),parseInt(s[2]),parseInt(s[3])];break;case"rotate":u[0]="_rotate",u[1]=parseFloat(d);break;case"scale":s=d.split(" "),u[0]="_scale",u[1]=[parseFloat(s[0]),parseFloat(s[1])];break;case"translate":s=d.split(" "),u[0]="_translate",u[1]=[parseInt(s[0]),parseInt(s[1])];break;default:(u[0]=e._CSSTOVALUE[c])||(u[0]=c)}n.push(u)}}return n},e.parseCSS=function(t,i){for(var s;null!=(s=e._parseCSSRegExp.exec(t));)e.styleSheets[s[1]]=e.parseOneCSS(s[2],";")},e.EMPTY=new e(null),e._CSSTOVALUE={"letter-spacing":"letterSpacing","line-spacing":"lineSpacing","white-space":"whiteSpace","line-height":"lineHeight","scale-x":"scaleX","scale-y":"scaleY","translate-x":"translateX","translate-y":"translateY","font-family":"fontFamily","font-weight":"fontWeight","vertical-align":"valign","text-decoration":"textDecoration","background-color":"backgroundColor","border-color":"borderColor","float":"cssFloat"},e._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),e._aligndef={left:0,center:1,right:2,0:"left",1:"center",2:"right"},e._valigndef={top:0,middle:1,bottom:2,0:"top",1:"middle",2:"bottom"},e.styleSheets={},e.ALIGN_CENTER=1,e.ALIGN_RIGHT=2,e.VALIGN_MIDDLE=1,e.VALIGN_BOTTOM=2,e._CSS_BLOCK=1,e._DISPLAY_NONE=2,e._ABSOLUTE=4,e._WIDTH_SET=8,e._PADDING=[0,0,0,0],e._RECT=[-1,-1,-1,-1],e._SPACING=[0,0],e._ALIGNS=[0,0,0],e.ADDLAYOUTED=512,e._NEWFONT=4096,e._HEIGHT_SET=8192,e._BACKGROUND_SET=16384,e._FLOAT_RIGHT=32768,e._LINE_ELEMENT=65536,e._NOWARP=131072,e._WIDTHAUTO=262144,e._LISTERRESZIE=524288,e}(Style),AudioSound=function(t){function e(){this.url=null,this.audio=null,this.loaded=!1,e.__super.call(this)}__class(e,"laya.media.h5audio.AudioSound",t);var i=e.prototype;return i.dispose=function(){var t=e._audioCache[this.url];t&&(t.src="",delete e._audioCache[this.url])},i.load=function(t){function i(){a.loaded=!0,a.event("complete")}function s(t){a.event("error")}t=URL.formatURL(t),this.url=t,t=window.replacePath(t,Laya.URL.basePath);var n;if(t==SoundManager._tMusic?(e._initMusicAudio(),n=e._musicAudio,n.src!=t&&(e._audioCache[n.src]=null,n=null)):n=e._audioCache[t],n&&n.readyState>=2)return void this.event("complete");n||(t==SoundManager._tMusic?(e._initMusicAudio(),n=e._musicAudio):n=wx.createInnerAudioContext("musicAudio"),e._audioCache[t]=n,n.src=t),n.src=t,n.onCanplay(i),n.onError(s);var a=this;this.audio=n,n.load&&n.load()},i.play=function(t,i){if(void 0===t&&(t=0),void 0===i&&(i=0),!this.url)return null;var s;s=this.url==SoundManager._tMusic?e._musicAudio:e._audioCache[this.url];var n;n=Pool.getItem("audio:"+this.url),Render.isConchApp?n||(n=wx.createInnerAudioContext("musicAudio"),n.src=this.url):this.url==SoundManager._tMusic?(e._initMusicAudio(),n=e._musicAudio,n.src=this.url):(n=n?n:wx.createInnerAudioContext("musicAudio"),n.src=this.url);var a=new AudioSoundChannel(n);return a.url=this.url,a.loops=i,a.startTime=t,a.play(),SoundManager.addChannel(a),a},__getset(0,i,"duration",function(){var t;return t=e._audioCache[this.url],t?t.duration:0}),e._initMusicAudio=function(){e._musicAudio||(e._musicAudio||(e._musicAudio=wx.createInnerAudioContext("musicAudio")),Render.isConchApp||Browser.document.addEventListener("touchstart",e._makeMusicOK))},e._makeMusicOK=function(){Browser.document.removeEventListener("touchstart",e._makeMusicOK),e._musicAudio.src?e._musicAudio.play():e._musicAudio.src=""},e._audioCache={},e._musicAudio=null,e}(EventDispatcher),SoundChannel=function(t){function e(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.completeHandler=null,e.__super.call(this)}__class(e,"laya.media.SoundChannel",t);var i=e.prototype;return i.play=function(){},i.stop=function(){},i.pause=function(){},i.resume=function(){},i.__runComplete=function(t){t&&t.run()},__getset(0,i,"volume",function(){return 1},function(t){}),__getset(0,i,"position",function(){return 0}),__getset(0,i,"duration",function(){return 0}),e}(EventDispatcher),SoundChannel=function(t){function e(){this.url=null,this.loops=0,this.startTime=NaN,this.isStopped=!1,this.completeHandler=null,e.__super.call(this)}__class(e,"laya.media.SoundChannel",t);var i=e.prototype;return i.play=function(){},i.stop=function(){},i.pause=function(){},i.resume=function(){},i.__runComplete=function(t){t&&t.run()},__getset(0,i,"volume",function(){return 1},function(t){}),__getset(0,i,"position",function(){return 0}),__getset(0,i,"duration",function(){return 0}),e}(EventDispatcher),Sound=function(t){function e(){e.__super.call(this)}__class(e,"laya.media.Sound",t);var i=e.prototype;return i.load=function(t){},i.play=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),null},i.dispose=function(){},__getset(0,i,"duration",function(){return 0}),e}(EventDispatcher),WebAudioSound=function(t){function e(){this.url=null,this.loaded=!1,this.data=null,this.audioBuffer=null,this.__toPlays=null,e.__super.call(this)}__class(e,"laya.media.webaudio.WebAudioSound",t);var i=e.prototype;return i.load=function(t){window.WXAPP&&(t=window.replacePath(t,Laya.URL.basePath));var i=this;if(t=URL.formatURL(t),this.url=t,this.audioBuffer=e._dataCache[t],this.audioBuffer)return void this._loaded(this.audioBuffer);if(e.e.on("loaded:"+t,this,this._loaded),e.e.on("err:"+t,this,this._err),!e.__loadingSound[t]){e.__loadingSound[t]=!0;var s=new Browser.window.XMLHttpRequest;s.open("GET",t,!0),s.responseType="arraybuffer",s.onload=function(){i.data=s.response,e.buffs.push({buffer:i.data,url:i.url}),e.decode()},s.onerror=function(t){i._err()},s.send()}},i._err=function(){this._removeLoadEvents(),e.__loadingSound[this.url]=!1,this.event("error")},i._loaded=function(t){this._removeLoadEvents(),this.audioBuffer=t,e._dataCache[this.url]=this.audioBuffer,this.loaded=!0,this.event("complete")},i._removeLoadEvents=function(){e.e.off("loaded:"+this.url,this,this._loaded),e.e.off("err:"+this.url,this,this._err)},i.__playAfterLoaded=function(){if(this.__toPlays){var t,e=0,i=0;t=this.__toPlays,i=t.length;var s;for(e=0;i>e;e++)s=t[e],s[2]&&!s[2].isStopped&&this.play(s[0],s[1],s[2]);this.__toPlays.length=0}},i.play=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),i=i?i:new WebAudioSoundChannel,this.audioBuffer||this.url&&(this.__toPlays||(this.__toPlays=[]),this.__toPlays.push([t,e,i]),this.once("complete",this,this.__playAfterLoaded),this.load(this.url)),i.url=this.url,i.loops=e,i.audioBuffer=this.audioBuffer,i.startTime=t,i.play(),SoundManager.addChannel(i),i},i.dispose=function(){delete e._dataCache[this.url],delete e.__loadingSound[this.url]},__getset(0,i,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),e.decode=function(){e.buffs.length<=0||e.isDecoding||(e.isDecoding=!0,e.tInfo=e.buffs.shift(),e.ctx.decodeAudioData(e.tInfo.buffer,e._done,e._fail))},e._done=function(t){e.e.event("loaded:"+e.tInfo.url,t),e.isDecoding=!1,e.decode()},e._fail=function(){e.e.event("err:"+e.tInfo.url,null),e.isDecoding=!1,e.decode()},e._playEmptySound=function(){if(null!=e.ctx){var t=e.ctx.createBufferSource();t.buffer=e._miniBuffer,t.connect(e.ctx.destination),t.start(0,0,0)}},e._unlock=function(){e._unlocked||(e._playEmptySound(),"running"==e.ctx.state&&(Browser.document.removeEventListener("mousedown",e._unlock,!0),Browser.document.removeEventListener("touchend",e._unlock,!0),e._unlocked=!0))},e.initWebAudio=function(){"running"!=e.ctx.state&&(e._unlock(),Browser.document.addEventListener("mousedown",e._unlock,!0),Browser.document.addEventListener("touchend",e._unlock,!0))},e._dataCache={},e.buffs=[],e.isDecoding=!1,e._unlocked=!1,e.tInfo=null,e.__loadingSound={},__static(e,["window",function(){return this.window=Browser.window},"webAudioEnabled",function(){return this.webAudioEnabled=e.window.AudioContext||e.window.webkitAudioContext||e.window.mozAudioContext},"ctx",function(){return this.ctx=e.webAudioEnabled?new(e.window.AudioContext||e.window.webkitAudioContext||e.window.mozAudioContext):void 0},"_miniBuffer",function(){return this._miniBuffer=e.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new EventDispatcher}]),e}(EventDispatcher),HttpRequest=function(t){function e(){this._responseType=null,this._data=null,e.__super.call(this),this._http=new Browser.window.XMLHttpRequest}__class(e,"laya.net.HttpRequest",t);var i=e.prototype;return i.send=function(t,e,i,s,n){void 0===i&&(i="get"),void 0===s&&(s="text"),this._responseType=s,this._data=null;var a=this,o=this._http;if(window.WXAPP&&(t=window.replacePath(t,Laya.URL.basePath)),o.open(i,t,!0),n)for(var r=0;r<n.length;r++)o.setRequestHeader(n[r++],n[r]);else Render.isConchApp||(e&&"string"!=typeof e?o.setRequestHeader("Content-Type","application/json"):o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"));o.responseType="arraybuffer"!==s?"text":"arraybuffer",o.onerror=function(t){a._onError(t)},o.onabort=function(t){a._onAbort(t)},o.onprogress=function(t){a._onProgress(t)},o.onload=function(t){a._onLoad(t)},o.send(e)},i._onProgress=function(t){t&&t.lengthComputable&&this.event("progress",t.loaded/t.total)},i._onAbort=function(t){this.error("Request was aborted by user")},i._onError=function(t){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)},i._onLoad=function(t){var e=this._http,i=void 0!==e.status?e.status:200;200===i||204===i||0===i?this.complete():this.error("["+e.status+"]"+e.statusText+":"+e.responseURL)},i.error=function(t){this.clear(),this.event("error",t)},i.complete=function(){this.clear();var t=!0;try{"json"===this._responseType?this._data=JSON.parse(this._http.responseText):"xml"===this._responseType?this._data=Utils.parseXMLFromString(this._http.responseText):this._data=this._http.response||this._http.responseText}catch(e){t=!1,this.error(e.message)}t&&this.event("complete",this._data instanceof Array?[this._data]:this._data)},i.clear=function(){var t=this._http;t.onerror=t.onabort=t.onprogress=t.onload=null},__getset(0,i,"url",function(){return this._http.responseURL}),__getset(0,i,"http",function(){return this._http}),__getset(0,i,"data",function(){return this._data}),e}(EventDispatcher),Loader=function(t){function e(){this._data=null,this._url=null,this._type=null,this._cache=!1,this._http=null,e.__super.call(this)}__class(e,"laya.net.Loader",t);var i=e.prototype;return i.load=function(t,i,s,n,a){if(void 0===s&&(s=!0),void 0===a&&(a=!1),this._url=t,0===t.indexOf("data:image")?i="image":t=URL.formatURL(t),this._type=i||(i=this.getTypeFromUrl(t)),this._cache=s,this._data=null,!a&&e.loadedMap[t])return this._data=e.loadedMap[t],this.event("progress",1),void this.event("complete",this._data);if(n&&e.setGroup(t,n),null!=e.parserMap[i])return void(e.parserMap[i]instanceof laya.utils.Handler?e.parserMap[i].runWith(this):e.parserMap[i].call(null,this));if("image"===i||"htmlimage"===i||"nativeimage"===i)return this._loadImage(t);if("sound"===i)return this._loadSound(t);this._http||(this._http=new HttpRequest,this._http.on("progress",this,this.onProgress),this._http.on("error",this,this.onError),this._http.on("complete",this,this.onLoaded));var o;switch(i){case"atlas":o="json";break;case"font":o="xml";break;default:o=i}this._http.send(t,null,"get",o)},i.getTypeFromUrl=function(t){var i=Utils.getFileExtension(t);return i?e.typeMap[i]:(console.warn("Not recognize the resources suffix",t),"text")},i._loadImage=function(t){function e(){i.onload=null,i.onerror=null}t=URL.formatURL(t);var i,s=this,n=function(){e(),s.onLoaded(i)},a=function(){e(),s.event("error","Load image failed")};"nativeimage"===this._type?(i=new Browser.window.Image,i.crossOrigin="",i.onload=n,i.onerror=a,i.src=t):new HTMLImage.create(t,{onload:n,onerror:a,onCreate:function(t){i=t}})},i._loadSound=function(t){function e(){s(),a.onLoaded(n)}function i(){s(),n.dispose(),a.event("error","Load sound failed")}function s(){n.offAll()}var n=new SoundManager._soundClass,a=this;n.on("complete",this,e),n.on("error",this,i),n.load(t)},i.onProgress=function(t){"atlas"===this._type?this.event("progress",.3*t):this.event("progress",t)},i.onError=function(t){this.event("error",t)},i.onLoaded=function(t){var i=this._type;if("image"===i){var s=new Texture(t);s.url=this._url,this.complete(s)}else if("sound"===i||"htmlimage"===i||"nativeimage"===i)this.complete(t);else if("atlas"===i){if(!t.src&&!t._setContext){if(!this._data){if(this._data=t,t.meta&&t.meta.image)for(var n=t.meta.image.split(","),a=this._url.indexOf("/")>=0?"/":"\\",o=this._url.lastIndexOf(a),r=o>=0?this._url.substr(0,o+1):"",h=0,l=n.length;l>h;h++)n[h]=r+n[h];else n=[this._url.replace(".json",".png")];n.reverse(),t.toLoads=n,t.pics=[]}return this.event("progress",.3+1/n.length*.6),this._loadImage(n.pop())}if(this._data.pics.push(t),this._data.toLoads.length>0)return this.event("progress",.3+1/this._data.toLoads.length*.6),this._loadImage(this._data.toLoads.pop());var c=this._data.frames,d=this._url.split("?")[0],u=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:d.substring(0,d.lastIndexOf("."))+"/",p=this._data.pics,_=URL.formatURL(this._url),f=e.atlasMap[_]||(e.atlasMap[_]=[]);f.dir=u;for(var y in c){var m=c[y],g=p[m.frame.idx?m.frame.idx:0],v=URL.formatURL(u+y);e.cacheRes(v,Texture.create(g,m.frame.x,m.frame.y,m.frame.w,m.frame.h,m.spriteSourceSize.x,m.spriteSourceSize.y,m.sourceSize.w,m.sourceSize.h)),e.loadedMap[v].url=v,f.push(v)}this.complete(this._data)}else if("font"==i){if(!t.src)return this._data=t,this.event("progress",.5),this._loadImage(this._url.replace(".fnt",".png"));var C=new BitmapFont;C.parseFont(this._data,t);var w=this._url.split(".fnt")[0].split("/"),x=w[w.length-1];Text.registerBitmapFont(x,C),this._data=C,this.complete(this._data)}else this.complete(t)},i.complete=function(t){this._data=t,e._loaders.push(this),e._isWorking||e.checkNext()},i.endLoad=function(t){t&&(this._data=t),this._cache&&e.cacheRes(this._url,this._data),this.event("progress",1),this.event("complete",this.data instanceof Array?[this.data]:this.data)},__getset(0,i,"url",function(){return this._url}),__getset(0,i,"data",function(){return this._data}),__getset(0,i,"cache",function(){return this._cache}),__getset(0,i,"type",function(){return this._type}),e.checkNext=function(){e._isWorking=!0;for(var t=Browser.now(),i=t;e._startIndex<e._loaders.length;)if(i=Browser.now(),e._loaders[e._startIndex].endLoad(),e._startIndex++,Browser.now()-t>e.maxTimeOut)return console.warn("loader callback cost a long time:"+(Browser.now()-t)+" url="+e._loaders[e._startIndex-1].url),void Laya.timer.frameOnce(1,null,e.checkNext);
e._loaders.length=0,e._startIndex=0,e._isWorking=!1},e.clearRes=function(t,i){void 0===i&&(i=!1),t=URL.formatURL(t);var s=e.getAtlas(t);if(s){for(var n=0,a=s.length;a>n;n++){var o=s[n],r=e.getRes(o);r&&r.destroy(i),delete e.loadedMap[o]}s.length=0,delete e.atlasMap[t],delete e.loadedMap[t]}else{var h=e.loadedMap[t];h&&(h instanceof laya.resource.Texture&&h.bitmap&&h.destroy(i),delete e.loadedMap[t])}},e.getRes=function(t){return e.loadedMap[URL.formatURL(t)]},e.getAtlas=function(t){return e.atlasMap[URL.formatURL(t)]},e.cacheRes=function(t,i){t=URL.formatURL(t),null!=e.loadedMap[t]?console.warn("Resources already exist,is repeated loading:",t):e.loadedMap[t]=i},e.setGroup=function(t,i){e.groupMap[i]||(e.groupMap[i]=[]),e.groupMap[i].push(t)},e.clearResByGroup=function(t){if(e.groupMap[t]){var i=e.groupMap[t],s=0,n=i.length;for(s=0;n>s;s++)e.clearRes(i[s]);i.length=0}},e.TEXT="text",e.JSON="json",e.XML="xml",e.BUFFER="arraybuffer",e.IMAGE="image",e.SOUND="sound",e.ATLAS="atlas",e.FONT="font",e.typeMap={png:"image",jpg:"image",jpeg:"image",txt:"text",json:"json",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font"},e.parserMap={},e.groupMap={},e.maxTimeOut=100,e.loadedMap={},e.atlasMap={},e._loaders=[],e._isWorking=!1,e._startIndex=0,e}(EventDispatcher),ColorFilter=function(t){function e(t){e.__super.call(this),t||(t=[.3,.59,.11,0,0,.3,.59,.11,0,0,.3,.59,.11,0,0,0,0,0,1,0]),this._mat=new Float32Array(16),this._alpha=new Float32Array(4);for(var i=0,s=0,n=0;20>n;n++)n%5!=4?this._mat[i++]=t[n]:this._alpha[s++]=t[n];this._action=RunDriver.createFilterAction(32),this._action.data=this}__class(e,"laya.filters.ColorFilter",t);var i=e.prototype;return Laya.imps(i,{"laya.filters.IFilter":!0}),i.callNative=function(t){t._$P.cf=this;t.conchModel&&t.conchModel.setFilterMatrix&&t.conchModel.setFilterMatrix(this._mat,this._alpha)},__getset(0,i,"type",function(){return 32}),__getset(0,i,"action",function(){return this._action}),e}(Filter),LoaderManager=function(t){function e(){this.retryNum=1,this.retryDelay=0,this.maxLoader=5,this._loaders=[],this._loaderCount=0,this._resInfos=[],this._infoPool=[],this._maxPriority=5,this._failRes={},e.__super.call(this);for(var t=0;t<this._maxPriority;t++)this._resInfos[t]=[]}var i;__class(e,"laya.net.LoaderManager",t);var s=e.prototype;return s.create=function(t,e,i,s,n,a,o){function r(t,i){d++,t.progress=1,d===c&&e&&e.run()}function h(t,e){t.progress=e;for(var i=0,s=0;c>s;s++){var n=l[s];i+=n.progress}var a=i/c;u.runWith(a)}if(void 0===a&&(a=1),void 0===o&&(o=!0),t instanceof Array){var l=t,c=l.length,d=0;if(i)var u=Handler.create(i.caller,i.method,i.args,!1);for(var p=0;c>p;p++){var _=l[p];"string"==typeof _&&(_=l[p]={url:_}),_.progress=0;var f=i?Handler.create(null,h,[_],!1):null,y=i||e?Handler.create(null,r,[_]):null;this._create(_.url,y,f,_.clas||s,_.params||n,_.priority||a,o)}return!0}return this._create(t,e,i,s,n,a,o)},s._create=function(t,i,s,n,a,o,r){function h(e){l&&l.onAsynLoaded.call(l,t,e,a),i&&i.run()}void 0===o&&(o=1),void 0===r&&(r=!0);var l=this.getRes(t);if(l)s&&s.runWith(1),i&&i.run();else{var c=Utils.getFileExtension(t),d=e.createMap[c];n||(n=d[0]);var u=d[1];"atlas"==c?this.load(t,i,s,u,o,r):(n===Texture&&(u="htmlimage"),l=n?new n:null,this.load(t,Handler.create(null,h),s,u,o,!1,null,!0),r&&(this.cacheRes(t,l),l.url=t))}return l},s.load=function(t,s,n,a,o,r,h,l){if(void 0===o&&(o=1),void 0===r&&(r=!0),void 0===l&&(l=!1),t instanceof Array)return this._loadAssets(t,s,n,a,o,r,h);var c=Loader.getRes(t);if(null!=c)n&&n.runWith(1),s&&s.runWith(c),this._loaderCount||this.event("complete");else{var d=e._resMap[t];d?(s&&d._createListener("complete",s.caller,s.method,s.args,!1,!1),n&&d._createListener("progress",n.caller,n.method,n.args,!1,!1)):(d=this._infoPool.length?this._infoPool.pop():new i,d.url=t,d.type=a,d.cache=r,d.group=h,d.ignoreCache=l,s&&d.on("complete",s.caller,s.method,s.args),n&&d.on("progress",n.caller,n.method,n.args),e._resMap[t]=d,o=o<this._maxPriority?o:this._maxPriority-1,this._resInfos[o].push(d),this._next())}return this},s._next=function(){if(!(this._loaderCount>=this.maxLoader)){for(var t=0;t<this._maxPriority;t++){var e=this._resInfos[t];if(e.length>0){var i=e.shift();if(i)return this._doLoad(i)}}this._loaderCount||this.event("complete")}},s._doLoad=function(t){function e(e){i.offAll(),i._data=null,s._loaders.push(i),s._endLoad(t,e instanceof Array?[e]:e),s._loaderCount--,s._next()}this._loaderCount++;var i=this._loaders.length?this._loaders.pop():new Loader;i.on("complete",null,e),i.on("progress",null,function(e){t.event("progress",e)}),i.on("error",null,function(t){e(null)});var s=this;i.load(t.url,t.type,t.cache,t.group,t.ignoreCache)},s._endLoad=function(t,i){if(null==i){var s=this._failRes[t.url]||0;if(s<this.retryNum)return console.warn("[warn]Retry to load:",t.url),this._failRes[t.url]=s+1,void Laya.timer.once(this.retryDelay,this,this._addReTry,[t],!1);console.warn("[error]Failed to load:",t.url),this.event("error",t.url)}delete e._resMap[t.url],t.event("complete",i),t.offAll(),this._infoPool.push(t)},s._addReTry=function(t){this._resInfos[this._maxPriority-1].push(t),this._next()},s.clearRes=function(t,e){void 0===e&&(e=!1),Loader.clearRes(t,e)},s.getRes=function(t){return Loader.getRes(t)},s.cacheRes=function(t,e){Loader.cacheRes(t,e)},s.setGroup=function(t,e){Loader.setGroup(t,e)},s.clearResByGroup=function(t){Loader.clearResByGroup(t)},s.clearUnLoaded=function(){for(var t=0;t<this._maxPriority;t++){for(var i=this._resInfos[t],s=i.length-1;s>-1;s--){var n=i[s];n&&(n.offAll(),this._infoPool.push(n))}i.length=0}this._loaderCount=0,e._resMap={}},s.cancelLoadByUrls=function(t){if(t)for(var e=0,i=t.length;i>e;e++)this.cancelLoadByUrl(t[e])},s.cancelLoadByUrl=function(t){for(var i=0;i<this._maxPriority;i++)for(var s=this._resInfos[i],n=s.length-1;n>-1;n--){var a=s[n];a&&a.url===t&&(s[n]=null,a.offAll(),this._infoPool.push(a))}e._resMap[t]&&delete e._resMap[t]},s._loadAssets=function(t,e,i,s,n,a,o){function r(t,i){c++,t.progress=1,i||(p=!1),c===l&&e&&e.runWith(p)}function h(t,e){if(null!=i){t.progress=e;for(var s=0,n=0;n<u.length;n++){var a=u[n];s+=a.size*a.progress}var o=s/d;i.runWith(o)}}void 0===n&&(n=1),void 0===a&&(a=!0);for(var l=t.length,c=0,d=0,u=[],p=!0,_=0;l>_;_++){var f=t[_];"string"==typeof f&&(f={url:f,type:s,size:1,priority:n}),f.size||(f.size=1),f.progress=0,d+=f.size,u.push(f);var y=i?Handler.create(null,h,[f],!1):null,m=e||i?Handler.create(null,r,[f]):null;this.load(f.url,m,y,f.type,f.priority||1,a,f.group||o)}return this},e.cacheRes=function(t,e){Loader.cacheRes(t,e)},e._resMap={},__static(e,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]),e.__init$=function(){i=function(t){function e(){this.url=null,this.type=null,this.cache=!1,this.group=null,this.ignoreCache=!1,e.__super.call(this)}return __class(e,"",t),e}(EventDispatcher)},e}(EventDispatcher),Socket=function(t){function e(t,i,s){this._endian=null,this._stamp=NaN,this._socket=null,this._connected=!1,this._addInputPosition=0,this._input=null,this._output=null,this.timeout=0,this.objectEncoding=0,this.disableInput=!1,this._byteClass=null,this.protocols=[],void 0===i&&(i=0),e.__super.call(this),this._byteClass=s,this._byteClass=this._byteClass?this._byteClass:Byte,this.endian="bigEndian",this.timeout=2e4,this._addInputPosition=0,t&&i>0&&65535>i&&this.connect(t,i)}__class(e,"laya.net.Socket",t);var i=e.prototype;return i.connect=function(t,e){var i="ws://"+t+":"+e;this.connectByUrl(i)},i.connectByUrl=function(t){var e=this;null!=this._socket&&this.close(),this._socket&&this._cleanSocket(),this.protocols&&0!=this.protocols.length?this._socket=new Browser.window.WebSocket(t,this.protocols):this._socket=new Browser.window.WebSocket(t),this._socket.binaryType="arraybuffer",this._output=new this._byteClass,this._output.endian=this.endian,this._input=new this._byteClass,this._input.endian=this.endian,this._addInputPosition=0,this._socket.onopen=function(t){e._onOpen(t)},this._socket.onmessage=function(t){e._onMessage(t)},this._socket.onclose=function(t){e._onClose(t)},this._socket.onerror=function(t){e._onError(t)}},i._cleanSocket=function(){try{this._socket.close()}catch(t){}this._connected=!1,this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null,this._socket=null},i.close=function(){null!=this._socket&&this._cleanSocket()},i._onOpen=function(t){this._connected=!0,this.event("open",t)},i._onMessage=function(t){if(t&&t.data){var e=t.data;if(this.disableInput&&e)return void this.event("message",e);this._input.length>0&&this._input.bytesAvailable<1&&(this._input.clear(),this._addInputPosition=0);var i=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0),this._input.pos=this._addInputPosition,e&&("string"==typeof e?this._input.writeUTFBytes(e):this._input.writeArrayBuffer(e),this._addInputPosition=this._input.pos,this._input.pos=i),this.event("message",e)}},i._onClose=function(t){this._connected=!1,this.event("close",t)},i._onError=function(t){this.event("error",t)},i.send=function(t){this._socket.send(t)},i.flush=function(){if(this._output&&this._output.length>0){var t;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch(e){t=e}this._output.endian=this.endian,this._output.clear(),t&&this.event("error",t)}},__getset(0,i,"input",function(){return this._input}),__getset(0,i,"output",function(){return this._output}),__getset(0,i,"connected",function(){return this._connected}),__getset(0,i,"endian",function(){return this._endian},function(t){this._endian=t,null!=this._input&&(this._input.endian=t),null!=this._output&&(this._output.endian=t)}),e.LITTLE_ENDIAN="littleEndian",e.BIG_ENDIAN="bigEndian",e}(EventDispatcher),WorkerLoader=function(t){function e(){this.worker=null,e.__super.call(this);var t=this;this.worker=new Browser.window.Worker(e.workerPath),this.worker.onmessage=function(e){t.workerMessage(e.data)}}__class(e,"laya.net.WorkerLoader",t);var i=e.prototype;return i.workerMessage=function(t){if(t)switch(t.type){case"Image":this.imageLoaded(t);break;case"Msg":this.event("image_msg",t.msg)}},i.imageLoaded=function(t){if(t&&t.buffer&&t.buffer.length<10)return e._enable=!1,this._myTrace("buffer lost when postmessage ,disable workerloader"),this.event(t.url,null),void this.event("image_err",t.url+"\n"+t.msg);if(!t.dataType)return this.event(t.url,null),void this.event("image_err",t.url+"\n"+t.msg);var i,s=new HTMLCanvas("2D");i=s.source.getContext("2d");var n;switch(t.dataType){case"buffer":n=i.createImageData(t.width,t.height),n.data.set(t.buffer),s.size(n.width,n.height),i.putImageData(n,0,0);break;case"imagedata":n=t.imagedata,s.size(n.width,n.height),i.putImageData(n,0,0),n=t.imagedata;break;case"imageBitmap":n=t.imageBitmap,s.size(n.width,n.height),i.drawImage(n,0,0)}Render.isWebGL&&(s.memorySize=0,s=new laya.webgl.resource.WebGLImage(s,t.url)),this.event(t.url,s)},i._myTrace=function(t){var e=arguments,i=[],s=0,n=e.length;for(s=0;n>s;s++)i.push(e[s]);this.event("image_msg",i.join(" "))},i.loadImage=function(t){var e;e={},e.type="load",e.url=t,this.worker.postMessage(e)},i._loadImage=function(t){function i(){laya.net.WorkerLoader.I.off(t,s,n)}var s=this;if(!e._enable||t.toLowerCase().indexOf(".png")<0)return void e._preLoadFun.call(s,t);var n=function(n){i(),n?s.onLoaded(n):e._preLoadFun.call(s,t)};laya.net.WorkerLoader.I.on(t,s,n),laya.net.WorkerLoader.I.loadImage(t)},__getset(1,e,"enable",function(){return e._enable},function(t){e._enable=t,e._enable&&null==e._preLoadFun&&e.__init__()}),e.__init__=function(){return null!=e._preLoadFun?!1:Browser.window.Worker?(e._preLoadFun=Loader.prototype._loadImage,Loader.prototype._loadImage=e.prototype._loadImage,e.I||(e.I=new e),!0):!1},e.workerSupported=function(){return!!Browser.window.Worker},e.IMAGE_LOADED="image_loaded",e.IMAGE_ERR="image_err",e.IMAGE_MSG="image_msg",e.I=null,e._preLoadFun=null,e._enable=!1,e.workerPath="libs/worker.js",e}(EventDispatcher),Resource=function(t){function e(){this._id=0,this._lastUseFrameCount=0,this._memorySize=0,this._name=null,this._url=null,this._loaded=!1,this._released=!1,this._disposed=!1,this._resourceManager=null,this.lock=!1,e.__super.call(this),this._$1__id=++e._uniqueIDCounter,e._loadedResources.push(this),e._isLoadedResourcesSorted=!1,this._released=!0,this.lock=!1,this._memorySize=0,this._lastUseFrameCount=-1,ResourceManager.currentResourceManager&&ResourceManager.currentResourceManager.addResource(this)}__class(e,"laya.resource.Resource",t);var i=e.prototype;return Laya.imps(i,{"laya.resource.ICreateResource":!0,"laya.resource.IDispose":!0}),i.recreateResource=function(){this.startCreate(),this.completeCreate()},i.detoryResource=function(){},i.activeResource=function(t){void 0===t&&(t=!1),this._lastUseFrameCount=Stat.loopCount,(this._released||t)&&this.recreateResource()},i.releaseResource=function(t){return void 0===t&&(t=!1),!t&&this.lock?!1:!this._released||t?(this.detoryResource(),this._released=!0,this._lastUseFrameCount=-1,this.event("released",this),!0):!1},i.setUniqueName=function(t){for(var i=!0,s=0;s<e._loadedResources.length;s++)if(e._loadedResources[s]._name===t&&e._loadedResources[s]!==this)return void(i=!1);i?this.name!=t&&(this.name=t,e._isLoadedResourcesSorted=!1):this.setUniqueName(t.concat("-copy"))},i.onAsynLoaded=function(t,e,i){throw new Error("Resource: must override this function!")},i.dispose=function(){if(null!==this._resourceManager)throw new Error("附属于resourceManager的资源不能独立释放！");this._disposed=!0,this.lock=!1,this.releaseResource();var t=e._loadedResources.indexOf(this);-1!==t&&(e._loadedResources.splice(t,1),e._isLoadedResourcesSorted=!1),Loader.clearRes(this.url)},i.startCreate=function(){this.event("recovering",this)},i.completeCreate=function(){this._released=!1,this.event("recovered",this)},__getset(0,i,"loaded",function(){return this._loaded}),__getset(0,i,"id",function(){return this._$1__id}),__getset(0,i,"url",function(){return this._url},function(t){this._url=t}),__getset(0,i,"name",function(){return this._name},function(t){!t&&""===t||this.name===t||(this._name=t,e._isLoadedResourcesSorted=!1)}),__getset(0,i,"disposed",function(){return this._disposed}),__getset(0,i,"released",function(){return this._released}),__getset(0,i,"resourceManager",function(){return this._resourceManager}),__getset(0,i,"lastUseFrameCount",function(){return this._lastUseFrameCount}),__getset(0,i,"memorySize",function(){return this._memorySize},function(t){var e=t-this._memorySize;this._memorySize=t,this.resourceManager&&this.resourceManager.addSize(e)}),__getset(1,e,"sortedLoadedResourcesByName",function(){return e._isLoadedResourcesSorted||(e._isLoadedResourcesSorted=!0,e._loadedResources.sort(e.compareResourcesByName)),e._loadedResources},laya.events.EventDispatcher._$SET_sortedLoadedResourcesByName),e.getLoadedResourceByIndex=function(t){return e._loadedResources[t]},e.getLoadedResourcesCount=function(){return e._loadedResources.length},e.compareResourcesByName=function(t,e){if(t===e)return 0;var i=t.name,s=e.name;if(null===i)return null===s?0:-1;if(null==s)return 1;var n=i.localeCompare(s);return 0!=n?n:(e.setUniqueName(s),s=e.name,i.localeCompare(s))},e._uniqueIDCounter=0,e._loadedResources=[],e._isLoadedResourcesSorted=!1,e}(EventDispatcher),Texture=function(t){function e(t,i){this.offsetX=0,this.offsetY=0,this.sourceWidth=0,this.sourceHeight=0,this._w=0,this._h=0,this._uvID=0,e.__super.call(this),t&&t.useNum++,this.setTo(t,i)}__class(e,"laya.resource.Texture",t);var i=e.prototype;return i.setTo=function(t,i){if(this.bitmap=t,this.uv=i||e.DEF_UV,t){this._w=t.width,this._h=t.height,this.sourceWidth=this.sourceWidth||this._w,this.sourceHeight=this.sourceHeight||this._h,this._loaded=this._w>0;var s=this;if(this._loaded)RunDriver.addToAtlas&&RunDriver.addToAtlas(s);else{var n=t;n instanceof laya.resource.HTMLImage&&n.image&&n.image.addEventListener("load",function(t){RunDriver.addToAtlas&&RunDriver.addToAtlas(s)},!1)}}},i.active=function(){this.bitmap.activeResource()},i.destroy=function(t){void 0===t&&(t=!1),this.bitmap&&this.bitmap.useNum>0&&(t?(this.bitmap.dispose(),this.bitmap.useNum=0):(this.bitmap.useNum--,0==this.bitmap.useNum&&this.bitmap.dispose()),this.bitmap=null,this.url&&this===Laya.loader.getRes(this.url)&&Laya.loader.clearRes(this.url,t),this._loaded=!1)},i.load=function(t){var e=this;this._loaded=!1;var i=this.bitmap||(this.bitmap=HTMLImage.create(t));i&&i.useNum++;var s=this;i.onload=function(){i.onload=null,s._loaded=!0,e.sourceWidth=e._w=i.width,e.sourceHeight=e._h=i.height,s.event("loaded",this),RunDriver.addToAtlas&&RunDriver.addToAtlas(s)}},i.addTextureToAtlas=function(t){RunDriver.addTextureToAtlas(this)},i.getPixels=function(t,e,i,s){if(Render.isWebGL)return RunDriver.getTexturePixels(this,t,e,i,s);Browser.canvas.size(i,s),Browser.canvas.clear(),Browser.context.drawTexture(this,-t,-e,this.width,this.height,0,0);var n=Browser.context.getImageData(0,0,i,s);return n.data},i.onAsynLoaded=function(t,e){e&&e.useNum++,this.setTo(e,this.uv)},__getset(0,i,"source",function(){return this.bitmap?(this.bitmap.activeResource(),this.bitmap.source):null}),__getset(0,i,"loaded",function(){return this._loaded}),__getset(0,i,"released",function(){return this.bitmap.released}),__getset(0,i,"width",function(){return this._w?this._w:this.uv&&this.uv!==e.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function(t){this._w=t,this.sourceWidth||(this.sourceWidth=t)}),__getset(0,i,"repeat",function(){return Render.isWebGL&&this.bitmap?this.bitmap.repeat:!0},function(t){t&&Render.isWebGL&&this.bitmap&&(this.bitmap.repeat=t,t&&(this.bitmap.enableMerageInAtlas=!1))}),__getset(0,i,"height",function(){return this._h?this._h:this.uv&&this.uv!==e.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function(t){this._h=t,this.sourceHeight||(this.sourceHeight=t)}),__getset(0,i,"isLinearSampling",function(){return Render.isWebGL?9728!=this.bitmap.minFifter:!0},function(t){!t&&Render.isWebGL&&(t||-1!=this.bitmap.minFifter||-1!=this.bitmap.magFifter||(this.bitmap.minFifter=9728,this.bitmap.magFifter=9728,this.bitmap.enableMerageInAtlas=!1))}),e.moveUV=function(t,e,i){for(var s=0;8>s;s+=2)i[s]+=t,i[s+1]+=e;return i},e.create=function(t,i,s,n,a,o,r,h,l){void 0===o&&(o=0),void 0===r&&(r=0),void 0===h&&(h=0),void 0===l&&(l=0);var c=t instanceof laya.resource.Texture,d=c?t.uv:e.DEF_UV,u=c?t.bitmap:t,p=new e(u,null);u.width&&i+n>u.width&&(n=u.width-i),u.height&&s+a>u.height&&(a=u.height-s),p.width=n,p.height=a,p.offsetX=o,p.offsetY=r,p.sourceWidth=h||n,p.sourceHeight=l||a;var _=1/u.width,f=1/u.height;i*=_,s*=f,n*=_,a*=f;var y=p.uv[0],m=p.uv[1],g=p.uv[4],v=p.uv[5],C=g-y,w=v-m,x=e.moveUV(d[0],d[1],[i,s,i+n,s,i+n,s+a,i,s+a]);return p.uv=[y+x[0]*C,m+x[1]*w,g-(1-x[2])*C,m+x[3]*w,g-(1-x[4])*C,v-(1-x[5])*w,y+x[6]*C,v-(1-x[7])*w],p},e.createFromTexture=function(t,i,s,n,a){var o=Rectangle.TEMP.setTo(i-t.offsetX,s-t.offsetY,n,a),r=o.intersection(e._rect1.setTo(0,0,t.width,t.height),e._rect2);if(!r)return null;var h=e.create(t,r.x,r.y,r.width,r.height,r.x-o.x,r.y-o.y,n,a);return h.bitmap.useNum--,h},e.DEF_UV=[0,0,1,0,1,1,0,1],e.INV_UV=[0,1,1,1,1,0,0,0],e._rect1=new Rectangle,e._rect2=new Rectangle,e}(EventDispatcher),TimeLine=function(t){function e(){this._labelDic=null,this._tweenDic={},this._tweenDataList=[],this._endTweenDataList=null,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this._firstTweenDic={},this._startTimeSort=!1,this._endTimeSort=!1,this._loopKey=!1,this.scale=1,this._frameRate=60,this._frameIndex=0,this._total=0,e.__super.call(this)}var i;__class(e,"laya.utils.TimeLine",t);var s=e.prototype;return s.to=function(t,e,i,s,n){return void 0===n&&(n=0),this._create(t,e,i,s,n,!0)},s.from=function(t,e,i,s,n){return void 0===n&&(n=0),this._create(t,e,i,s,n,!1)},s._create=function(t,e,s,n,a,o){var r=new i;return r.isTo=o,r.type=0,r.target=t,r.duration=s,r.data=e,r.startTime=this._startTime+a,r.endTime=r.startTime+r.duration,r.ease=n,this._startTime=Math.max(r.endTime,this._startTime),this._tweenDataList.push(r),this._startTimeSort=!0,this._endTimeSort=!0,this},s.addLabel=function(t,e){var s=new i;return s.type=1,s.data=t,s.endTime=s.startTime=this._startTime+e,this._labelDic||(this._labelDic={}),this._labelDic[t]=s,this._tweenDataList.push(s),this},s.removeLabel=function(t){if(this._labelDic&&this._labelDic[t]){var e=this._labelDic[t];if(e){var i=this._tweenDataList.indexOf(e);i>-1&&this._tweenDataList.splice(i,1)}delete this._labelDic[t]}},s.gotoTime=function(t){function e(t,e){return t.endTime>e.endTime?1:t.endTime<e.endTime?-1:0}if(null!=this._tweenDataList&&0!=this._tweenDataList.length){var i,s;for(var n in this._firstTweenDic)if(s=this._firstTweenDic[n])for(var a in s)s.diyTarget.hasOwnProperty(a)&&(s.diyTarget[a]=s[a]);for(n in this._tweenDic)i=this._tweenDic[n],i.clear(),delete this._tweenDic[n];this._index=0,this._gidIndex=0,this._currTime=t,this._lastTime=Browser.now();var o;null==this._endTweenDataList||this._endTimeSort?(this._endTimeSort=!1,this._endTweenDataList=o=this._tweenDataList.concat(),o.sort(e)):o=this._endTweenDataList;for(var r,h=0,l=o.length;l>h;h++)if(r=o[h],0==r.type){if(!(t>=r.endTime))break;this._index=Math.max(this._index,h+1);var c=r.data;for(var d in c)r.isTo&&(r.target[d]=c[d])}for(h=0,l=this._tweenDataList.length;l>h;h++)r=this._tweenDataList[h],0==r.type&&t>=r.startTime&&t<r.endTime&&(this._index=Math.max(this._index,h+1),this._gidIndex++,i=Pool.getItemByClass("tween",Tween),i._create(r.target,r.data,r.duration,r.ease,Handler.create(this,this._animComplete,[this._gidIndex]),0,!1,r.isTo,!0,!1),i.setStartTime(this._currTime-(t-r.startTime)),i._updateEase(this._currTime),i.gid=this._gidIndex,this._tweenDic[this._gidIndex]=i)}},s.gotoLabel=function(t){if(null!=this._labelDic){var e=this._labelDic[t];e&&this.gotoTime(e.startTime)}},s.pause=function(){Laya.timer.clear(this,this._update)},s.resume=function(){this.play(this._currTime,this._loopKey)},s.play=function(t,e){function i(t,e){return t.startTime>e.startTime?1:t.startTime<e.startTime?-1:0}if(void 0===t&&(t=0),void 0===e&&(e=!1),this._tweenDataList){if(this._startTimeSort){this._startTimeSort=!1,this._tweenDataList.sort(i);for(var s=0,n=this._tweenDataList.length;n>s;s++){var a=this._tweenDataList[s];if(null!=a&&0==a.type){var o=a.target,r=o.$_GID||(o.$_GID=Utils.getGID()),h=null;null==this._firstTweenDic[r]?(h={},h.diyTarget=o,this._firstTweenDic[r]=h):h=this._firstTweenDic[r];for(var l in a.data)null==h[l]&&(h[l]=o[l])}}}"string"==typeof t?this.gotoLabel(t):this.gotoTime(t),this._loopKey=e,this._lastTime=Browser.now(),Laya.timer.frameLoop(1,this,this._update)}},s._update=function(){if(this._currTime>=this._startTime){if(!this._loopKey){for(var t in this._tweenDic)n=this._tweenDic[t],n.complete();return this._complete(),void this.pause()}if(this._complete(),!this._tweenDataList)return;this.gotoTime(0)}var e=Browser.now(),i=e-this._lastTime,s=this._currTime+=i*this.scale;this._lastTime=e;var n;if(0!=this._tweenDataList.length&&this._index<this._tweenDataList.length){var a=this._tweenDataList[this._index];s>=a.startTime&&(this._index++,0==a.type?(this._gidIndex++,n=Pool.getItemByClass("tween",Tween),n._create(a.target,a.data,a.duration,a.ease,new Handler(this,this._animComplete,[this._gidIndex]),0,!1,a.isTo,!0,!1),n.setStartTime(s),n.gid=this._gidIndex,this._tweenDic[this._gidIndex]=n):this.event("label",a.data))}for(t in this._tweenDic)n=this._tweenDic[t],n._updateEase(s)},s._animComplete=function(t){var e=this._tweenDic[t];e&&delete this._tweenDic[t]},s._complete=function(){this.event("complete")},s.reset=function(){var t;if(this._labelDic)for(t in this._labelDic)delete this._labelDic[t];var e;for(t in this._tweenDic)e=this._tweenDic[t],e.clear(),delete this._tweenDic[t];for(t in this._firstTweenDic)delete this._firstTweenDic[t];this._endTweenDataList=null,this._tweenDataList.length=0,this._currTime=0,this._lastTime=0,this._startTime=0,this._index=0,this._gidIndex=0,this.scale=1,Laya.timer.clear(this,this._update)},s.destroy=function(){this.reset(),this._labelDic=null,this._tweenDic=null,this._tweenDataList=null,this._firstTweenDic=null},__getset(0,s,"index",function(){return this._frameIndex},function(t){this._frameIndex=t,this.gotoTime(this._frameIndex/this._frameRate*1e3)}),__getset(0,s,"total",function(){return this._total=Math.floor(this._startTime/1e3*this._frameRate),this._total}),e.to=function(t,i,s,n,a){return void 0===a&&(a=0),(new e).to(t,i,s,n,a)},e.from=function(t,i,s,n,a){return void 0===a&&(a=0),(new e).from(t,i,s,n,a)},e.__init$=function(){i=function(){function t(){this.type=0,this.isTo=!0,this.startTime=NaN,this.endTime=NaN,this.target=null,this.duration=NaN,this.ease=null,this.data=null}return __class(t,""),t}()},e}(EventDispatcher),Sprite=function(t){function e(){this._transform=null,this._tfChanged=!1,this._x=0,this._y=0,this._width=0,this._height=0,this._repaint=1,this._mouseEnableState=0,this._zOrder=0,this._graphics=null,this._renderType=0,this._optimizeScrollRect=!1,this._texture=null,this.mouseThrough=!1,this.autoSize=!1,this.hitTestPrior=!1,this.viewport=null,e.__super.call(this),this._style=Style.EMPTY}__class(e,"laya.display.Sprite",t);var i=e.prototype;return Laya.imps(i,{"laya.display.ILayout":!0}),i.createConchModel=function(){return new ConchNode},i.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._style&&this._style.destroy(),this._transform=null,this._style=null,this._graphics=null},i.updateZOrder=function(){Utils.updateOrder(this._childs)&&this.repaint()},i.reCache=function(){this._$P.cacheCanvas&&(this._$P.cacheCanvas.reCache=!0),this._repaint=1},i.setBounds=function(t){this._set$P("uBounds",t)},i.getBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new Rectangle),Rectangle._getWrapRec(this._boundPointsToParent(),this._$P.mBounds)},i.getSelfBounds=function(){return this._$P.mBounds||this._set$P("mBounds",new Rectangle),Rectangle._getWrapRec(this._getBoundPointsM(!1),this._$P.mBounds)},i._boundPointsToParent=function(t){void 0===t&&(t=!1);var e=0,i=0;this._style&&(e=this._style._tf.translateX,i=this._style._tf.translateY,t=t||0!==this._style._tf.rotate,this._style.scrollRect&&(e+=this._style.scrollRect.x,i+=this._style.scrollRect.y));var s=this._getBoundPointsM(t);if(!s||s.length<1)return s;if(8!=s.length&&(s=t?GrahamScan.scanPList(s):Rectangle._getWrapRec(s,Rectangle.TEMP)._getBoundPoints()),!this.transform)return Utils.transPointList(s,this._x-e,this._y-i),s;var n=Point.TEMP,a=0,o=s.length;for(a=0;o>a;a+=2)n.x=s[a],n.y=s[a+1],this.toParentPoint(n),s[a]=n.x,s[a+1]=n.y;return s},i.getGraphicBounds=function(t){return void 0===t&&(t=!1),this._graphics?this._graphics.getBounds(t):Rectangle.TEMP.setTo(0,0,0,0)},i._getBoundPointsM=function(t){if(void 0===t&&(t=!1),this._$P.uBounds)return this._$P.uBounds._getBoundPoints();if(this._$P.temBM||this._set$P("temBM",[]),this.scrollRect){var e=Utils.clearArray(this._$P.temBM),i=Rectangle.TEMP;return i.copyFrom(this.scrollRect),Utils.concatArray(e,i._getBoundPoints()),e}var s,n,a,o=this._graphics?this._graphics.getBoundPoints():Utils.clearArray(this._$P.temBM);a=this._childs;for(var r=0,h=a.length;h>r;r++)s=a[r],s instanceof laya.display.Sprite&&1==s.visible&&(n=s._boundPointsToParent(t),n&&(o=o?Utils.concatArray(o,n):n));return o},i.getStyle=function(){return this._style===Style.EMPTY&&(this._style=new Style),this._style},i.setStyle=function(t){this._style=t},i._adjustTransform=function(){"use strict";this._tfChanged=!1;var t,e=this._style,i=e._tf,s=i.scaleX,n=i.scaleY;if(i.rotate||1!==s||1!==n||i.skewX||i.skewY){t=this._transform||(this._transform=Matrix.create()),t.bTransform=!0;var a=.0174532922222222*(i.rotate-i.skewX),o=.0174532922222222*(i.rotate+i.skewY),r=Math.cos(o),h=Math.sin(o),l=Math.sin(a),c=Math.cos(a);return t.a=s*r,t.b=s*h,t.c=-n*l,t.d=n*c,t.tx=t.ty=0,t}return this._transform&&this._transform.destroy(),this._transform=null,this._renderType&=-5,t},i.pos=function(t,e,i){if(void 0===i&&(i=!1),this._x!==t||this._y!==e){if(this.destroyed)return this;if(i){this._x=t,this._y=e,this.conchModel&&this.conchModel.pos(this._x,this._y);var s=this._parent;s&&0===s._repaint&&(s._repaint=1,s.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}else this.x=t,this.y=e}return this},i.pivot=function(t,e){return this.pivotX=t,this.pivotY=e,this},i.size=function(t,e){return this.width=t,this.height=e,this},i.scale=function(t,e,i){void 0===i&&(i=!1);var s=this.getStyle(),n=s._tf;if(n.scaleX!=t||n.scaleY!=e){if(this.destroyed)return this;if(i){s.setScale(t,e),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(t,e),this._renderType|=4;var a=this._parent;a&&0===a._repaint&&(a._repaint=1,a.parentRepaint())}else this.scaleX=t,this.scaleY=e}return this},i.skew=function(t,e){return this.skewX=t,this.skewY=e,this},i.render=function(t,e,i){Stat.spriteCount++,RenderSprite.renders[this._renderType]._fun(this,t,e+this._x,i+this._y),this._repaint=0},i.drawToCanvas=function(t,e,i,s){if(Render.isConchNode){var n=HTMLCanvas.create("2D"),a=new RenderContext(t,e,n);return a.ctx.setCanvasType(1),this.conchModel.drawToCanvas(n.source,i,s),n}return RunDriver.drawToCanvas(this,this._renderType,t,e,i,s)},i.customRender=function(t,e,i){this._renderType|=1024},i._applyFilters=function(){if(!Render.isWebGL){var t;if(t=this._$P.filters,t&&!(t.length<1))for(var e=0,i=t.length;i>e;e++)t[e].action.apply(this._$P.cacheCanvas)}},i._isHaveGlowFilter=function(){var t=0,e=0;if(this.filters)for(t=0;t<this.filters.length;t++)if(8==this.filters[t].type)return!0;for(t=0,e=this._childs.length;e>t;t++)if(this._childs[t]._isHaveGlowFilter())return!0;return!1},i.localToGlobal=function(t,e){void 0===e&&(e=!1),e===!0&&(t=new Point(t.x,t.y));for(var i=this;i&&i!=Laya.stage;)t=i.toParentPoint(t),i=i.parent;return t},i.globalToLocal=function(t,e){void 0===e&&(e=!1),e&&(t=new Point(t.x,t.y));for(var i=this,s=[];i&&i!=Laya.stage;)s.push(i),i=i.parent;for(var n=s.length-1;n>=0;)i=s[n],t=i.fromParentPoint(t),n--;return t},i.toParentPoint=function(t){if(!t)return t;t.x-=this.pivotX,t.y-=this.pivotY,this.transform&&this._transform.transformPoint(t),t.x+=this._x,t.y+=this._y;var e=this._style.scrollRect;return e&&(t.x-=e.x,t.y-=e.y),t},i.fromParentPoint=function(t){if(!t)return t;t.x-=this._x,t.y-=this._y;var e=this._style.scrollRect;return e&&(t.x+=e.x,t.y+=e.y),this.transform&&this._transform.invertTransformPoint(t),t.x+=this.pivotX,t.y+=this.pivotY,t},i.on=function(e,i,s,n){return 1!==this._mouseEnableState&&this.isMouseEvent(e)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(e,i,s,n,!1)):t.prototype.on.call(this,e,i,s,n)},i.once=function(e,i,s,n){return 1!==this._mouseEnableState&&this.isMouseEvent(e)?(this.mouseEnabled=!0,this._setBit(2,!0),this._parent&&this._$2__onDisplay(),this._createListener(e,i,s,n,!0)):t.prototype.once.call(this,e,i,s,n)},i._$2__onDisplay=function(){if(1!==this._mouseEnableState){var t=this;for(t=t.parent;t&&1!==t._mouseEnableState&&!t._getBit(2);)t.mouseEnabled=!0,t._setBit(2,!0),t=t.parent}},i.loadImage=function(t,e,i,s,n,a){function o(t){r.destroyed||(r.size(e+(s||t.width),i+(n||t.height)),r.repaint(),a&&a.runWith(t))}var r=this;return void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===n&&(n=0),this.graphics.loadImage(t,e,i,s,n,o),this},i.repaint=function(){this.conchModel&&this.conchModel.repaint&&this.conchModel.repaint(),0===this._repaint&&(this._repaint=1,this.parentRepaint()),this._$P&&this._$P.maskParent&&this._$P.maskParent.repaint()},i._needRepaint=function(){return 0!==this._repaint&&this._$P.cacheCanvas&&this._$P.cacheCanvas.reCache},i._childChanged=function(t){this._childs.length?this._renderType|=2048:this._renderType&=-2049,t&&this._get$P("hasZorder")&&Laya.timer.callLater(this,this.updateZOrder),
this.repaint()},i.parentRepaint=function(){var t=this._parent;t&&0===t._repaint&&(t._repaint=1,t.parentRepaint())},i.startDrag=function(t,e,i,s,n,a,o){void 0===e&&(e=!1),void 0===i&&(i=0),void 0===s&&(s=300),void 0===a&&(a=!1),void 0===o&&(o=.92),this._$P.dragging||this._set$P("dragging",new Dragging),this._$P.dragging.start(this,t,e,i,s,n,a,o)},i.stopDrag=function(){this._$P.dragging&&this._$P.dragging.stop()},i._setDisplay=function(e){if(!e){var i=this._$P.cacheCanvas;i&&i.ctx&&(Pool.recover("RenderContext",i.ctx),i.ctx.canvas.size(0,0),i.ctx=null);var s=this._$P._filterCache;s&&(s.destroy(),s.recycle(),this._set$P("_filterCache",null)),this._$P._isHaveGlowFilter&&this._set$P("_isHaveGlowFilter",!1)}t.prototype._setDisplay.call(this,e)},i.hitTestPoint=function(t,e){var i=this.globalToLocal(Point.TEMP.setTo(t,e)),s=this._$P.hitArea?this._$P.hitArea:Rectangle.TEMP.setTo(0,0,this._width,this._height);return s.contains(i.x,i.y)},i.getMousePoint=function(){return this.globalToLocal(Point.TEMP.setTo(Laya.stage.mouseX,Laya.stage.mouseY))},i._getWords=function(){return null},i._addChildsToLayout=function(t){var e=this._getWords();if(null==e&&0==this._childs.length)return!1;if(e)for(var i=0,s=e.length;s>i;i++)t.push(e[i]);return this._childs.forEach(function(e,i,s){e._style._enableLayout()&&e._addToLayout(t)}),!0},i._addToLayout=function(t){this._style.absolute||(this._style.block?t.push(this):this._addChildsToLayout(t)&&(this.x=this.y=0))},i._isChar=function(){return!1},i._getCSSStyle=function(){return this._style.getCSSStyle()},i._setAttributes=function(t,e){switch(t){case"x":this.x=parseFloat(e);break;case"y":this.y=parseFloat(e);break;case"width":this.width=parseFloat(e);break;case"height":this.height=parseFloat(e);break;default:this[t]=e}},i._layoutLater=function(){this.parent&&this.parent._layoutLater()},__getset(0,i,"optimizeScrollRect",function(){return this._optimizeScrollRect},function(t){this._optimizeScrollRect!=t&&(this._optimizeScrollRect=t,this.conchModel&&this.conchModel.optimizeScrollRect(t))}),__getset(0,i,"customRenderEnable",null,function(t){if(t&&(this._renderType|=1024,Render.isConchNode)){e.CustomList.push(this);var i=new HTMLCanvas("2d");i._setContext(new CanvasRenderingContext2D),this.customContext=new RenderContext(0,0,i),i.context.setCanvasType&&i.context.setCanvasType(2),this.conchModel.custom(i.context)}}),__getset(0,i,"cacheAsBitmap",function(){return"none"!==this.cacheAs},function(t){this.cacheAs=t?this._$P.hasFilter?"none":"normal":"none"}),__getset(0,i,"cacheAs",function(){return null==this._$P.cacheCanvas?"none":this._$P.cacheCanvas.type},function(t){t=Browser.onIOS?t:"none";var e=this._$P.cacheCanvas;t!==(e?e.type:"none")&&("none"!==t?(this._getBit(1)||this._setUpNoticeType(1),e||(e=this._set$P("cacheCanvas",Pool.getItemByClass("cacheCanvas",Object))),e.type=t,e.reCache=!0,this._renderType|=16,"bitmap"==t&&this.conchModel&&this.conchModel.cacheAs(1),this._set$P("cacheForFilters",!1)):this._$P.hasFilter?this._set$P("cacheForFilters",!0):(e&&Pool.recover("cacheCanvas",e),this._$P.cacheCanvas=null,this._renderType&=-17,this.conchModel&&this.conchModel.cacheAs(0)),this.repaint())}),__getset(0,i,"zOrder",function(){return this._zOrder},function(t){this._zOrder!=t&&(this._zOrder=t,this.conchModel&&this.conchModel.setZOrder&&this.conchModel.setZOrder(t),this._parent&&(t&&this._parent._set$P("hasZorder",!0),Laya.timer.callLater(this._parent,this.updateZOrder)))}),__getset(0,i,"rotation",function(){return this._style._tf.rotate},function(t){var e=this.getStyle();if(e._tf.rotate!==t){e.setRotate(t),this._tfChanged=!0,this.conchModel&&this.conchModel.rotate(t),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),__getset(0,i,"width",function(){return this.autoSize?this.getSelfBounds().width:this._width},function(t){this._width!==t&&(this._width=t,this.conchModel&&this.conchModel.size(t,this._height),this.repaint())}),__getset(0,i,"x",function(){return this._x},function(t){if(this._x!==t){if(this.destroyed)return;this._x=t,this.conchModel&&this.conchModel.pos(t,this._y);var e=this._parent;e&&0===e._repaint&&(e._repaint=1,e.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),__getset(0,i,"globalScaleY",function(){for(var t=1,e=this;e&&e!==Laya.stage;)t*=e.scaleX,e=e.parent;return t}),__getset(0,i,"hitArea",function(){return this._$P.hitArea},function(t){this._set$P("hitArea",t)}),__getset(0,i,"staticCache",function(){return this._$P.staticCache},function(t){this._set$P("staticCache",t),t||this.reCache()}),__getset(0,i,"texture",function(){return this._texture},function(t){this._texture!=t&&(this._texture=t,this.graphics.cleanByTexture(t,0,0))}),__getset(0,i,"y",function(){return this._y},function(t){if(this._y!==t){if(this.destroyed)return;this._y=t,this.conchModel&&this.conchModel.pos(this._x,t);var e=this._parent;e&&0===e._repaint&&(e._repaint=1,e.parentRepaint()),this._$P.maskParent&&0===this._$P.maskParent._repaint&&(this._$P.maskParent._repaint=1,this._$P.maskParent.parentRepaint())}}),__getset(0,i,"height",function(){return this.autoSize?this.getSelfBounds().height:this._height},function(t){this._height!==t&&(this._height=t,this.conchModel&&this.conchModel.size(this._width,t),this.repaint())}),__getset(0,i,"blendMode",function(){return this._style.blendMode},function(t){this.getStyle().blendMode=t,this.conchModel&&this.conchModel.blendMode(t),t&&"source-over"!=t?this._renderType|=8:this._renderType&=-9,this.parentRepaint()}),__getset(0,i,"scaleX",function(){return this._style._tf.scaleX},function(t){var e=this.getStyle();if(e._tf.scaleX!==t){e.setScaleX(t),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(t,e._tf.scaleY),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),__getset(0,i,"scaleY",function(){return this._style._tf.scaleY},function(t){var e=this.getStyle();if(e._tf.scaleY!==t){e.setScaleY(t),this._tfChanged=!0,this.conchModel&&this.conchModel.scale(e._tf.scaleX,t),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),__getset(0,i,"stage",function(){return Laya.stage}),__getset(0,i,"skewX",function(){return this._style._tf.skewX},function(t){var e=this.getStyle();if(e._tf.skewX!==t){e.setSkewX(t),this._tfChanged=!0,this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),__getset(0,i,"scrollRect",function(){return this._style.scrollRect},function(t){this.getStyle().scrollRect=t,this.repaint(),t?(this._renderType|=128,this.conchModel&&this.conchModel.scrollRect(t.x,t.y,t.width,t.height)):(this._renderType&=-129,this.conchModel&&(e.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(64):this.conchModel.removeType(128)))}),__getset(0,i,"skewY",function(){return this._style._tf.skewY},function(t){var e=this.getStyle();if(e._tf.skewY!==t){e.setSkewY(t),this._tfChanged=!0,this.conchModel&&this.conchModel.skew(e._tf.skewX,t),this._renderType|=4;var i=this._parent;i&&0===i._repaint&&(i._repaint=1,i.parentRepaint())}}),__getset(0,i,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function(t){this._tfChanged=!1,this._transform=t,t&&(this._x=t.tx,this._y=t.ty,t.tx=t.ty=0,this.conchModel&&this.conchModel.transform(t.a,t.b,t.c,t.d,this._x,this._y)),t?this._renderType|=4:(this._renderType&=-5,this.conchModel&&this.conchModel.removeType(4)),this.parentRepaint()}),__getset(0,i,"pivotX",function(){return this._style._tf.translateX},function(t){this.getStyle().setTranslateX(t),this.conchModel&&this.conchModel.pivot(t,this._style._tf.translateY),this.repaint()}),__getset(0,i,"pivotY",function(){return this._style._tf.translateY},function(t){this.getStyle().setTranslateY(t),this.conchModel&&this.conchModel.pivot(this._style._tf.translateX,t),this.repaint()}),__getset(0,i,"alpha",function(){return this._style.alpha},function(t){this._style&&this._style.alpha!==t&&(t=0>t?0:t>1?1:t,this.getStyle().alpha=t,this.conchModel&&this.conchModel.alpha(t),1!==t?this._renderType|=2:this._renderType&=-3,this.parentRepaint())}),__getset(0,i,"visible",function(){return this._style.visible},function(t){this._style&&this._style.visible!==t&&(this.getStyle().visible=t,this.conchModel&&this.conchModel.visible(t),this.parentRepaint())}),__getset(0,i,"graphics",function(){return this._graphics||(this.graphics=RunDriver.createGraphics())},function(t){this._graphics&&(this._graphics._sp=null),this._graphics=t,t?(this._renderType&=-2,this._renderType|=512,t._sp=this,this.conchModel&&this.conchModel.graphics(this._graphics)):(this._renderType&=-513,this._renderType&=-2,this.conchModel&&(e.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(256):this.conchModel.removeType(512))),this.repaint()}),__getset(0,i,"filters",function(){return this._$P.filters},function(t){t&&0===t.length&&(t=null),this._$P.filters!=t&&(this._set$P("filters",t?t.slice():null),Render.isConchApp&&(this.conchModel&&(e.RUNTIMEVERION<"0.9.1"?this.conchModel.removeType(16):this.conchModel.removeType(32)),this._$P.filters&&1==this._$P.filters.length&&this._$P.filters[0].callNative(this)),Render.isWebGL&&(t&&t.length?this._renderType|=32:this._renderType&=-33),t&&t.length>0?(this._getBit(1)||this._setUpNoticeType(1),Render.isWebGL&&1==t.length&&t[0]instanceof laya.filters.ColorFilter||("bitmap"!=this.cacheAs&&(Render.isConchNode||(this.cacheAs="bitmap"),this._set$P("cacheForFilters",!0)),this._set$P("hasFilter",!0))):(this._set$P("hasFilter",!1),this._$P.cacheForFilters&&"bitmap"==this.cacheAs&&(this.cacheAs="none")),this.repaint())}),__getset(0,i,"parent",t.prototype._$get_parent,function(e){t.prototype._$set_parent.call(this,e),e&&this._getBit(2)&&this._$2__onDisplay()}),__getset(0,i,"mask",function(){return this._$P._mask},function(t){t&&this.mask&&this.mask._$P.maskParent||(t?(this.cacheAs="bitmap",this._set$P("_mask",t),t._set$P("maskParent",this)):(this.cacheAs="none",this.mask&&this.mask._set$P("maskParent",null),this._set$P("_mask",t)),this.conchModel&&this.conchModel.mask(t?t.conchModel:null),this._renderType|=64,this.parentRepaint())}),__getset(0,i,"mouseEnabled",function(){return this._mouseEnableState>1},function(t){this._mouseEnableState=t?2:1}),__getset(0,i,"globalScaleX",function(){for(var t=1,e=this;e&&e!==Laya.stage;)t*=e.scaleX,e=e.parent;return t}),__getset(0,i,"mouseX",function(){return this.getMousePoint().x}),__getset(0,i,"mouseY",function(){return this.getMousePoint().y}),e.fromImage=function(t){return(new e).loadImage(t)},e.CustomList=[],__static(e,["RUNTIMEVERION",function(){return this.RUNTIMEVERION=window.conch?conchConfig.getRuntimeVersion().substr(conchConfig.getRuntimeVersion().lastIndexOf("-")+1):""}]),e}(Node),AudioSoundChannel=function(t){function e(t){this._audio=null,this._onEnd=null,this._resumePlay=null,e.__super.call(this),this._onEnd=Utils.bind(this.__onEnd,this),this._resumePlay=Utils.bind(this.__resumePlay,this);var i=this;t.onEnded(function(){i.__onEnd(i)}),this._audio=t}__class(e,"laya.media.h5audio.AudioSoundChannel",t);var i=e.prototype;return i.__onEnd=function(t){var e=t?t:this;return 1==e.loops?(e.completeHandler&&(Laya.timer.once(10,e,e.__runComplete,[e.completeHandler],!1),e.completeHandler=null),e.stop(),void e.event("complete")):(e.loops>0&&e.loops--,e.startTime=0,void e.play())},i.__resumePlay=function(){this._audio&&(this._audio.onCanplay=this._resumePlay);try{this._audio.currentTime=this.startTime,this._audio.play()}catch(t){this.event("error")}},i.play=function(){if(this._audio){this._audio.src=hf.Global.ResHost+this.url,this.isStopped=!1;try{this._audio.playbackRate=SoundManager.playbackRate,this._audio.currentTime=this.startTime}catch(t){return void(this._audio.onCanplay=this._resumePlay)}this._audio.play()}},i.stop=function(){this.isStopped=!0,SoundManager.removeChannel(this),this.completeHandler=null,this._audio&&("pause"in this._audio&&Render.isConchApp&&this._audio.stop(),this._audio.pause(),Browser.onIE||this._audio!=AudioSound._musicAudio&&Pool.recover("audio:"+this.url,this._audio),Browser.removeElement(this._audio),this._audio=null)},i.pause=function(){this.isStopped=!0,SoundManager.removeChannel(this),"pause"in this._audio&&this._audio.pause()},i.resume=function(){this._audio&&(this.isStopped=!1,SoundManager.addChannel(this),"play"in this._audio&&this._audio.play())},__getset(0,i,"position",function(){return this._audio?this._audio.currentTime:0}),__getset(0,i,"duration",function(){return this._audio?this._audio.duration:0}),__getset(0,i,"volume",function(){return this._audio?this._audio.volume:1},function(t){this._audio&&(this._audio.volume=t)}),e}(SoundChannel),WebAudioSoundChannel=function(t){function e(){this.audioBuffer=null,this.gain=null,this.bufferSource=null,this._currentTime=0,this._volume=1,this._startTime=0,this._pauseTime=0,this._onPlayEnd=null,this.context=WebAudioSound.ctx,e.__super.call(this),this._onPlayEnd=Utils.bind(this.__onPlayEnd,this),this.context.createGain?this.gain=this.context.createGain():this.gain=this.context.createGainNode()}__class(e,"laya.media.webaudio.WebAudioSoundChannel",t);var i=e.prototype;return i.play=function(){if(SoundManager.addChannel(this),this.isStopped=!1,this._clearBufferSource(),this.audioBuffer){var t=this.context,e=this.gain,i=t.createBufferSource();this.bufferSource=i,i.buffer=this.audioBuffer,i.connect(e),e&&e.disconnect(),e.connect(t.destination),i.onended=this._onPlayEnd,this.startTime>=this.duration&&(this.startTime=0),this._startTime=Browser.now(),this.gain.gain.value=this._volume,0==this.loops&&(i.loop=!0),i.playbackRate.value=SoundManager.playbackRate,i.start(0,this.startTime),this._currentTime=0}},i.__onPlayEnd=function(){return 1==this.loops?(this.completeHandler&&(Laya.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete")):(this.loops>0&&this.loops--,void this.play())},i._clearBufferSource=function(){if(this.bufferSource){var t=this.bufferSource;t.stop?t.stop(0):t.noteOff(0),t.disconnect(0),t.onended=null,e._tryCleanFailed||this._tryClearBuffer(t),this.bufferSource=null}},i._tryClearBuffer=function(t){if(!Browser.onIOS)return void(e._tryCleanFailed=!0);try{t.buffer=WebAudioSound._miniBuffer}catch(i){e._tryCleanFailed=!0}},i.stop=function(){this._clearBufferSource(),this.audioBuffer=null,this.gain&&this.gain.disconnect(),this.isStopped=!0,SoundManager.removeChannel(this),this.completeHandler=null},i.pause=function(){this.isStopped||(this._pauseTime=this.position),this._clearBufferSource(),this.gain&&this.gain.disconnect(),this.isStopped=!0,SoundManager.removeChannel(this)},i.resume=function(){this.startTime=this._pauseTime,this.play()},__getset(0,i,"position",function(){return this.bufferSource?(Browser.now()-this._startTime)/1e3+this.startTime:0}),__getset(0,i,"duration",function(){return this.audioBuffer?this.audioBuffer.duration:0}),__getset(0,i,"volume",function(){return this._volume},function(t){this.isStopped||(this._volume=t,this.gain.gain.value=t)}),e._tryCleanFailed=!1,e}(SoundChannel),Bitmap=function(t){function e(){this.useNum=0,e.__super.call(this),this._w=0,this._h=0}__class(e,"laya.resource.Bitmap",t);var i=e.prototype;return i.dispose=function(){this._resourceManager.removeResource(this),t.prototype.dispose.call(this)},__getset(0,i,"width",function(){return this._w}),__getset(0,i,"height",function(){return this._h}),__getset(0,i,"source",function(){return this._source}),e}(Resource),AnimationPlayerBase=function(t){function e(){this.loop=!1,this.wrapMode=0,this._index=0,this._count=0,this._isPlaying=!1,this._labels=null,this._isReverse=!1,this._frameRateChanged=!1,this._controlNode=null,this._actionName=null,e.__super.call(this),this._interval=Config.animationInterval,this._setUpNoticeType(1)}__class(e,"laya.display.AnimationPlayerBase",t);var i=e.prototype;return i.play=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=""),this._isPlaying=!0,this.index="string"==typeof t?this._getFrameByLabel(t):t,this.loop=e,this._actionName=i,this._isReverse=1==this.wrapMode,this.interval>0&&this.timerLoop(this.interval,this,this._frameLoop,null,!0)},i._getFrameByLabel=function(t){var e=0;for(e=0;e<this._count;e++)if(this._labels[e]&&this._labels[e].indexOf(t)>=0)return e;return 0},i._frameLoop=function(){if(this._isReverse){if(this._index--,this._index<0){if(!this.loop)return this._index=0,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=this._count>0?1:0,this._isReverse=!1):this._index=this._count-1,this.event("complete")}}else if(this._index++,this._index>=this._count){if(!this.loop)return this._index--,this.stop(),void this.event("complete");2==this.wrapMode?(this._index=this._count-2>=0?this._count-2:0,this._isReverse=!0):this._index=0,this.event("complete")}this.index=this._index},i._setControlNode=function(t){this._controlNode&&(this._controlNode.off("display",this,this._checkResumePlaying),this._controlNode.off("undisplay",this,this._checkResumePlaying)),this._controlNode=t,t&&t!=this&&(t.on("display",this,this._checkResumePlaying),t.on("undisplay",this,this._checkResumePlaying))},i._setDisplay=function(e){t.prototype._setDisplay.call(this,e),this._checkResumePlaying()},i._checkResumePlaying=function(){this._isPlaying&&(this._controlNode.displayedInStage?this.play(this._index,this.loop,this._actionName):this.clearTimer(this,this._frameLoop))},i.stop=function(){this._isPlaying=!1,this.clearTimer(this,this._frameLoop)},i.addLabel=function(t,e){this._labels||(this._labels={}),this._labels[e]||(this._labels[e]=[]),this._labels[e].push(t)},i.removeLabel=function(t){if(t){if(this._labels)for(var e in this._labels)this._removeLabelFromLabelList(this._labels[e],t)}else this._labels=null},i._removeLabelFromLabelList=function(t,e){if(t)for(var i=t.length-1;i>=0;i--)t[i]==e&&t.splice(i,1)},i.gotoAndStop=function(t){this.index="string"==typeof t?this._getFrameByLabel(t):t,this.stop()},i._displayToIndex=function(t){},i.clear=function(){this.stop(),this._labels=null},__getset(0,i,"interval",function(){return this._interval},function(t){this._interval!=t&&(this._frameRateChanged=!0,this._interval=t,this._isPlaying&&t>0&&this.timerLoop(t,this,this._frameLoop,null,!0))}),__getset(0,i,"isPlaying",function(){return this._isPlaying}),__getset(0,i,"index",function(){return this._index},function(t){if(this._index=t,this._displayToIndex(t),this._labels&&this._labels[t])for(var e=this._labels[t],i=0,s=e.length;s>i;i++)this.event("label",e[i])}),__getset(0,i,"count",function(){return this._count}),e.WRAP_POSITIVE=0,e.WRAP_REVERSE=1,e.WRAP_PINGPONG=2,e}(Sprite),Text=function(t){function e(){this._clipPoint=null,this._currBitmapFont=null,this._text=null,this._isChanged=!1,this._textWidth=0,this._textHeight=0,this._lines=[],this._lineWidths=[],this._startX=NaN,this._startY=NaN,this._lastVisibleLineIndex=-1,this._words=null,this._charSize={},this.underline=!1,this._underlineColor=null,e.__super.call(this),this.overflow=e.VISIBLE,this._style=new CSSStyle(this),this._style.wordWrap=!1}__class(e,"laya.display.Text",t);var i=e.prototype;return i.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._lines=null,this._words&&(this._words.length=0,this._words=null)},i._getBoundPointsM=function(t){void 0===t&&(t=!1);var e=Rectangle.TEMP;return e.setTo(0,0,this.width,this.height),e._getBoundPoints()},i.getGraphicBounds=function(t){void 0===t&&(t=!1);var e=Rectangle.TEMP;return e.setTo(0,0,this.width,this.height),e},i._getCSSStyle=function(){return this._style},i.lang=function(t,i,s,n,a,o,r,h,l,c,d){if(t=e.langPacks&&e.langPacks[t]?e.langPacks[t]:t,arguments.length<2)this._text=t;else{for(var u=0,p=arguments.length;p>u;u++)t=t.replace("{"+u+"}",arguments[u+1]);this._text=t}},i.renderText=function(t,e){var i=this.graphics;i.clear(!0);var s=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;Browser.context.font=s;var n=this.padding,a=n[3],o="left",r=this._lines,h=this.leading+this._charSize.height,l=this._currBitmapFont;l&&(h=this.leading+l.getMaxHeight());var c=n[0];if(!l&&this._width>0&&this._textWidth<=this._width&&("right"==this.align?(o="right",a=this._width-n[1]):"center"==this.align&&(o="center",a=.5*this._width+n[3]-n[1])),this._height>0){var d=this._textHeight>this._height?"top":this.valign;"middle"===d?c=.5*(this._height-e*h)+n[0]-n[2]:"bottom"===d&&(c=this._height-e*h-n[2])}var u=this._style;if(l&&l.autoScaleSize)var p=l.fontSize/this.fontSize;if(this._clipPoint)if(i.save(),l&&l.autoScaleSize){var _=0,f=0;_=this._width?this._width-n[3]-n[1]:this._textWidth,f=this._height?this._height-n[0]-n[2]:this._textHeight,_*=p,f*=p,i.clipRect(n[3],n[0],_,f)}else i.clipRect(n[3],n[0],this._width?this._width-n[3]-n[1]:this._textWidth,this._height?this._height-n[0]-n[2]:this._textHeight);var y=u.password;"prompt"in this&&this.prompt==this._text&&(y=!1);for(var m=0,g=0,v=Math.min(this._lines.length,e+t)||1,C=t;v>C;C++){var w,x=r[C];if(y){var b=x.length;x="";for(var S=b;S>0;S--)x+="●"}if(m=a-(this._clipPoint?this._clipPoint.x:0),g=c+h*C-(this._clipPoint?this._clipPoint.y:0),this.underline&&this.drawUnderline(o,m,g,C),l){var I=this.width;l.autoScaleSize&&(I=this.width*p),l.drawText(x,this,m,g,this.align,I)}else Render.isWebGL?(this._words||(this._words=[]),w=this._words.length>C-t?this._words[C-t]:new WordText,w.setText(x)):w=x,u.stroke?i.fillBorderText(w,m,g,s,this.color,u.strokeColor,u.stroke,o):i.fillText(w,m,g,s,this.color,o)}if(l&&l.autoScaleSize){var T=1/p;this.scale(T,T)}this._clipPoint&&i.restore(),this._startX=a,this._startY=c},i.drawUnderline=function(t,e,i,s){var n=this._lineWidths[s];switch(t){case"center":e-=n/2;break;case"right":e-=n;break;case"left":}i+=this._charSize.height,this._graphics.drawLine(e,i,e+n,i,this.underlineColor||this.color,1)},i.typeset=function(){if(this._isChanged=!1,!this._text)return this._clipPoint=null,this._textWidth=this._textHeight=0,void this.graphics.clear();Browser.context.font=this._getCSSStyle().font,this._lines.length=0,this._lineWidths.length=0,this.parseLines(this._text),this.evalTextSize(),this.checkEnabledViewportOrNot()?this._clipPoint||(this._clipPoint=new Point(0,0)):this._clipPoint=null;var t=this._lines.length;if(this.overflow!=e.VISIBLE){var i=this.overflow==e.HIDDEN?Math.floor:Math.ceil;t=Math.min(t,i((this.height-this.padding[0]-this.padding[2])/(this.leading+this._charSize.height)))}var s=this.scrollY/(this._charSize.height+this.leading)|0;this.renderText(s,t),this.repaint()},i.evalTextSize=function(){var t=NaN,e=NaN;t=Math.max.apply(this,this._lineWidths),e=this._currBitmapFont?this._lines.length*(this._currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2]:this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2],t==this._textWidth&&e==this._textHeight||(this._textWidth=t,this._textHeight=e,this._width&&this._height||this.conchModel&&this.conchModel.size(this._width||this._textWidth,this._height||this._textHeight))},i.checkEnabledViewportOrNot=function(){return this.overflow==e.SCROLL&&(this._width>0&&this._textWidth>this._width||this._height>0&&this._textHeight>this._height)},i.changeText=function(t){this._text!==t&&(this.lang(t+""),this._graphics&&this._graphics.replaceText(this._text)||this.typeset())},i.parseLines=function(t){var i=this.wordWrap||this.overflow==e.HIDDEN;if(i)var s=this.getWordWrapWidth();if(this._currBitmapFont)this._charSize.width=this._currBitmapFont.getMaxWidth(),this._charSize.height=this._currBitmapFont.getMaxHeight();else{var n=Browser.context.measureText(e._testWord);this._charSize.width=n.width,this._charSize.height=n.height||this.fontSize}for(var a=t.replace(/\r\n/g,"\n").split("\n"),o=0,r=a.length;r>o;o++){var h=a[o];i?this.parseLine(h,s):(this._lineWidths.push(this.getTextWidth(h)),this._lines.push(h))}},i.parseLine=function(t,i){var s,n=(Browser.context,this._lines),a=0,o=NaN,r=NaN,h=0;if(o=this.getTextWidth(t),i>=o)return n.push(t),void this._lineWidths.push(o);o=this._charSize.width,a=Math.floor(i/o),0==a&&(a=1),o=this.getTextWidth(t.substring(0,a)),r=o;for(var l=a,c=t.length;c>l;l++)if(o=this.getTextWidth(t.charAt(l)),r+=o,r>i)if(this.wordWrap){var d=t.substring(h,l);if(d.charCodeAt(d.length-1)<255&&(s=/(?:\w|-)+$/.exec(d),s&&(l=s.index+h,0==s.index?l+=d.length:d=t.substring(h,l))),n.push(d),this._lineWidths.push(r-o),h=l,!(c>l+a)){n.push(t.substring(h,c)),this._lineWidths.push(this.getTextWidth(n[n.length-1])),h=-1;break}l+=a,o=this.getTextWidth(t.substring(h,l)),r=o,l--}else if(this.overflow==e.HIDDEN)return n.push(t.substring(0,l)),void this._lineWidths.push(this.getTextWidth(n[n.length-1]));this.wordWrap&&-1!=h&&(n.push(t.substring(h,c)),this._lineWidths.push(this.getTextWidth(n[n.length-1])))},i.getTextWidth=function(t){return this._currBitmapFont?this._currBitmapFont.getTextWidth(t):Browser.context.measureText(t).width},i.getWordWrapWidth=function(){var t=this.padding,e=NaN;return e=this._currBitmapFont&&this._currBitmapFont.autoScaleSize?this._width*(this._currBitmapFont.fontSize/this.fontSize):this._width,0>=e&&(e=this.wordWrap?100:Browser.width),0>=e&&(e=100),e-t[3]-t[1]},i.getCharPoint=function(t,e){this._isChanged&&Laya.timer.runCallLater(this,this.typeset);for(var i=0,s=this._lines,n=0,a=0,o=s.length;o>a;a++){if(i+=s[a].length,i>t){var r=a;break}n=i}var h=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;Browser.context.font=h;var l=this.getTextWidth(this._text.substring(n,t)),c=e||new Point;return c.setTo(this._startX+l-(this._clipPoint?this._clipPoint.x:0),this._startY+r*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))},__getset(0,i,"width",function(){return this._width?this._width:this.textWidth+this.padding[1]+this.padding[3]},function(e){e!=this._width&&(t.prototype._$set_width.call(this,e),this.isChanged=!0)}),__getset(0,i,"textWidth",function(){return this._isChanged&&Laya.timer.runCallLater(this,this.typeset),this._textWidth}),__getset(0,i,"height",function(){return this._height?this._height:this.textHeight+this.padding[0]+this.padding[2]},function(e){e!=this._height&&(t.prototype._$set_height.call(this,e),this.isChanged=!0)}),__getset(0,i,"textHeight",function(){return this._isChanged&&Laya.timer.runCallLater(this,this.typeset),this._textHeight}),__getset(0,i,"padding",function(){return this._getCSSStyle().padding},function(t){this._getCSSStyle().padding=t,this.isChanged=!0}),__getset(0,i,"bold",function(){return this._getCSSStyle().bold},function(t){this._getCSSStyle().bold=t,this.isChanged=!0}),__getset(0,i,"text",function(){return this._text||""},function(t){this._text!==t&&(this.lang(t+""),this.isChanged=!0,this.event("change"))}),__getset(0,i,"color",function(){return this._getCSSStyle().color},function(t){this._getCSSStyle().color!=t&&(this._getCSSStyle().color=t,!this._isChanged&&this._graphics?this._graphics.replaceTextColor(this.color):this.isChanged=!0)}),__getset(0,i,"font",function(){return this._getCSSStyle().fontFamily},function(t){this._currBitmapFont&&(this._currBitmapFont=null,this.scale(1,1)),e._bitmapFonts&&e._bitmapFonts[t]&&(this._currBitmapFont=e._bitmapFonts[t]),this._getCSSStyle().fontFamily=t,this.isChanged=!0}),__getset(0,i,"fontSize",function(){return this._getCSSStyle().fontSize},function(t){this._getCSSStyle().fontSize=parseInt(t),this.isChanged=!0}),__getset(0,i,"italic",function(){return this._getCSSStyle().italic},function(t){this._getCSSStyle().italic=t,this.isChanged=!0}),__getset(0,i,"align",function(){return this._getCSSStyle().align},function(t){this._getCSSStyle().align=t,this.isChanged=!0}),__getset(0,i,"valign",function(){return this._getCSSStyle().valign},function(t){this._getCSSStyle().valign=t,this.isChanged=!0}),__getset(0,i,"wordWrap",function(){return this._getCSSStyle().wordWrap},function(t){this._getCSSStyle().wordWrap=t,this.isChanged=!0}),__getset(0,i,"leading",function(){return this._getCSSStyle().leading},function(t){this._getCSSStyle().leading=t,this.isChanged=!0}),__getset(0,i,"bgColor",function(){return this._getCSSStyle().backgroundColor},function(t){this._getCSSStyle().backgroundColor=t,this.isChanged=!0}),__getset(0,i,"borderColor",function(){return this._getCSSStyle().borderColor},function(t){this._getCSSStyle().borderColor=t,this.isChanged=!0}),__getset(0,i,"stroke",function(){return this._getCSSStyle().stroke},function(t){this._getCSSStyle().stroke=t,this.isChanged=!0}),__getset(0,i,"strokeColor",function(){return this._getCSSStyle().strokeColor},function(t){this._getCSSStyle().strokeColor=t,this.isChanged=!0}),__getset(0,i,"isChanged",null,function(t){this._isChanged!==t&&(this._isChanged=t,t&&Laya.timer.callLater(this,this.typeset))}),__getset(0,i,"scrollX",function(){return this._clipPoint?this._clipPoint.x:0},function(t){if(!(this.overflow!=e.SCROLL||this.textWidth<this._width)&&this._clipPoint){t=t<this.padding[3]?this.padding[3]:t;var i=this._textWidth-this._width;t=t>i?i:t;var s=this._height/(this._charSize.height+this.leading)|1;this._clipPoint.x=t,this.renderText(this._lastVisibleLineIndex,s)}}),__getset(0,i,"scrollY",function(){return this._clipPoint?this._clipPoint.y:0},function(t){if(!(this.overflow!=e.SCROLL||this.textHeight<this._height)&&this._clipPoint){t=t<this.padding[0]?this.padding[0]:t;var i=this._textHeight-this._height;t=t>i?i:t;var s=t/(this._charSize.height+this.leading)|0;this._lastVisibleLineIndex=s;var n=(this._height/(this._charSize.height+this.leading)|0)+1;this._clipPoint.y=t,this.renderText(s,n)}}),__getset(0,i,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width}),__getset(0,i,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height}),__getset(0,i,"lines",function(){return this._isChanged&&this.typeset(),this._lines}),__getset(0,i,"underlineColor",function(){return this._underlineColor},function(t){this._underlineColor=t,this._isChanged=!0,this.typeset()}),e.registerBitmapFont=function(t,i){e._bitmapFonts||(e._bitmapFonts={}),e._bitmapFonts[t]=i},e.unregisterBitmapFont=function(t,i){if(void 0===i&&(i=!0),e._bitmapFonts&&e._bitmapFonts[t]){var s=e._bitmapFonts[t];i&&s.destroy(),delete e._bitmapFonts[t]}},e._testWord="游",e.langPacks=null,e.VISIBLE="visible",e.SCROLL="scroll",e.HIDDEN="hidden",e._bitmapFonts=null,e}(Sprite),Stage=function(t){function e(){function t(){"hidden"==Browser.document[a]?(i._isVisibility=!1,n._isInputting()&&(Input.inputElement.target.focus=!1)):i._isVisibility=!0,n.event("visibilitychange")}this.focus=null,this.frameRate="fast",this.designWidth=0,this.designHeight=0,this.canvasRotation=!1,this.canvasDegree=0,this.renderingEnabled=!0,this.screenAdaptationEnabled=!0,this._screenMode="none",this._scaleMode="noscale",this._alignV="top",this._alignH="left",this._bgColor="black",this._mouseMoveTime=0,this._renderCount=0,this._safariOffsetY=0,this._frameStartTime=NaN,this._isFocused=!1,this._isVisibility=!1,this._scenes=null,this._wgColor=null,e.__super.call(this),this.offset=new Point,this._canvasTransform=new Matrix,this._previousOrientation=Browser.window.orientation;var i=this;this.transform=Matrix.create(),this._scenes=[],this.mouseEnabled=!0,this.hitTestPrior=!0,this.autoSize=!1,this._displayedInStage=!0,this._isFocused=!0,this._isVisibility=!0;var s=Browser.window,n=this;s.addEventListener("focus",function(){i._isFocused=!0,n.event("focus"),n.event("focuschange")}),s.addEventListener("blur",function(){i._isFocused=!1,n.event("blur"),n.event("focuschange"),n._isInputting()&&(Input.inputElement.target.focus=!1)});var a="visibilityState",o="visibilitychange",r=s.document;"undefined"!=typeof r.hidden?(o="visibilitychange",a="visibilityState"):"undefined"!=typeof r.mozHidden?(o="mozvisibilitychange",a="mozVisibilityState"):"undefined"!=typeof r.msHidden?(o="msvisibilitychange",a="msVisibilityState"):"undefined"!=typeof r.webkitHidden&&(o="webkitvisibilitychange",a="webkitVisibilityState"),
s.document.addEventListener(o,t),s.addEventListener("resize",function(){var t=Browser.window.orientation;null!=t&&t!=i._previousOrientation&&n._isInputting()&&(Input.inputElement.target.focus=!1),i._previousOrientation=t,n._isInputting()||(Browser.onSafari&&(n._safariOffsetY=(Browser.window.__innerHeight||Browser.document.body.clientHeight||Browser.document.documentElement.clientHeight)-Browser.window.innerHeight),n._resetCanvas())}),s.addEventListener("orientationchange",function(t){n._resetCanvas()}),this.on("mousemove",this,this._onmouseMove),Browser.onMobile&&this.on("mousedown",this,this._onmouseMove)}__class(e,"laya.display.Stage",t);var i=e.prototype;return i._isInputting=function(){return Browser.onMobile&&Input.isInputting},i._changeCanvasSize=function(){this.setScreenSize(Browser.clientWidth*Browser.pixelRatio,Browser.clientHeight*Browser.pixelRatio)},i._resetCanvas=function(){if(this.screenAdaptationEnabled){Render._mainCanvas;Laya.timer.once(100,this,this._changeCanvasSize,null,!1),Laya.timer.once(500,this,this._changeCanvasSize,null,!1),Laya.timer.once(1500,this,this._changeCanvasSize,null,!1),Laya.timer.once(2500,this,this._changeCanvasSize,null,!1)}},i.setScreenSize=function(t,e){var i=!1;if("none"!==this._screenMode){var s=1>t/e?"vertical":"horizontal";if(i=s!==this._screenMode){var n=e;e=t,t=n}}this.canvasRotation=i;var a=Render._mainCanvas,o=a.source.style,r=this._canvasTransform.identity(),h=this._scaleMode,l=t/this.designWidth,c=e/this.designHeight,d=this.designWidth,u=this.designHeight,p=t,_=e,f=Browser.pixelRatio;switch(this._width=this.designWidth,this._height=this.designHeight,h){case"noscale":l=c=1,p=this.designWidth,_=this.designHeight;break;case"showall":l=c=Math.min(l,c),d=p=Math.round(this.designWidth*l),u=_=Math.round(this.designHeight*c);break;case"noborder":l=c=Math.max(l,c),p=Math.round(this.designWidth*l),_=Math.round(this.designHeight*c);break;case"full":l=c=1,this._width=d=t,this._height=u=e;break;case"fixedwidth":c=l,this._height=u=Math.round(e/l);break;case"fixedheight":l=c,this._width=d=Math.round(t/c);break;case"fixedauto":t/e<this.designWidth/this.designHeight?(c=l,this._height=u=Math.round(e/l)):(l=c,this._width=d=Math.round(t/c))}l*=this.scaleX,c*=this.scaleY,1===l&&1===c?this.transform.identity():(this.transform.a=this._formatData(l/(p/d)),this.transform.d=this._formatData(c/(_/u)),this.conchModel&&this.conchModel.scale(this.transform.a,this.transform.d)),a.size(d,u),RunDriver.changeWebGLSize(d,u),r.scale(p/d/f,_/u/f),"left"===this._alignH?this.offset.x=0:"right"===this._alignH?this.offset.x=t-p:this.offset.x=.5*(t-p)/f,"top"===this._alignV?this.offset.y=0:"bottom"===this._alignV?this.offset.y=e-_:this.offset.y=.5*(e-_)/f,this.offset.x=Math.round(this.offset.x),this.offset.y=Math.round(this.offset.y),r.translate(this.offset.x,this.offset.y),this._safariOffsetY&&r.translate(0,this._safariOffsetY),this.canvasDegree=0,i&&("horizontal"===this._screenMode?(r.rotate(Math.PI/2),r.translate(e/f,0),this.canvasDegree=90):(r.rotate(-Math.PI/2),r.translate(0,t/f),this.canvasDegree=-90)),r.a=this._formatData(r.a),r.d=this._formatData(r.d),r.tx=this._formatData(r.tx),r.ty=this._formatData(r.ty),o.transformOrigin=o.webkitTransformOrigin=o.msTransformOrigin=o.mozTransformOrigin=o.oTransformOrigin="0px 0px 0px",o.transform=o.webkitTransform=o.msTransform=o.mozTransform=o.oTransform="matrix("+r.toString()+")",this._safariOffsetY&&r.translate(0,-this._safariOffsetY),r.translate(parseInt(o.left)||0,parseInt(o.top)||0),this.visible=!0,this._repaint=1,this.event("resize")},i._formatData=function(t){return Math.abs(t)<1e-6?0:Math.abs(1-t)<.001?t>0?1:-1:t},i.getMousePoint=function(){return Point.TEMP.setTo(this.mouseX,this.mouseY)},i.repaint=function(){this._repaint=1},i.parentRepaint=function(){},i._loop=function(){return this.render(Render.context,0,0),!0},i._onmouseMove=function(t){this._mouseMoveTime=Browser.now()},i.getTimeFromFrameStart=function(){return Browser.now()-this._frameStartTime},i.render=function(e,i,s){if("sleep"===this.frameRate){var n=Browser.now();if(!(n-this._frameStartTime>=1e3))return;this._frameStartTime=n}if(this._renderCount++,Render.isFlash&&this.repaint(),!this._style.visible)return void(this._renderCount%5===0&&(Stat.loopCount++,MouseManager.instance.runEvent(),Laya.timer._update()));this._frameStartTime=Browser.now();var a="mouse"===this.frameRate?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this.frameRate,o="slow"!==a,r=this._renderCount%2===0;if(Stat.renderSlow=!o,o||r){Stat.loopCount++,MouseManager.instance.runEvent(),Laya.timer._update();var h,l=0,c=0;if(Render.isConchNode)for(l=0,c=this._scenes.length;c>l;l++)h=this._scenes[l],h&&h._updateSceneConch();else for(l=0,c=this._scenes.length;c>l;l++)h=this._scenes[l],h&&h._updateScene();if(Render.isConchNode){var d=Sprite.CustomList;for(l=0,c=d.length;c>l;l++){var u=d[l];u.customRender(u.customContext,0,0)}return}Render.isWebGL&&this.renderingEnabled&&(e.clear(),t.prototype.render.call(this,e,i,s))}Render.isConchNode||!this.renderingEnabled||!o&&r||(Render.isWebGL?(RunDriver.clear(this._bgColor),RunDriver.beginFlush(),e.flush(),RunDriver.endFinish(),VectorGraphManager.instance&&VectorGraphManager.getInstance().endDispose()):(RunDriver.clear(this._bgColor),t.prototype.render.call(this,e,i,s)))},i._requestFullscreen=function(){var t=Browser.document.documentElement;t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()},i._fullScreenChanged=function(){Laya.stage.event("fullscreenchange")},i.exitFullscreen=function(){var t=Browser.document;t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen&&t.webkitExitFullscreen()},__getset(0,i,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1}),__getset(0,i,"width",t.prototype._$get_width,function(e){this.designWidth=e,t.prototype._$set_width.call(this,e),Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,i,"isFocused",function(){return this._isFocused}),__getset(0,i,"alignH",function(){return this._alignH},function(t){this._alignH=t,Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,i,"height",t.prototype._$get_height,function(e){this.designHeight=e,t.prototype._$set_height.call(this,e),Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,i,"transform",function(){return this._tfChanged&&this._adjustTransform(),this._transform=this._transform||Matrix.create()},t.prototype._$set_transform),__getset(0,i,"isVisibility",function(){return this._isVisibility}),__getset(0,i,"desginWidth",function(){return console.debug("desginWidth已经弃用，请使用designWidth代替"),this.designWidth}),__getset(0,i,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1}),__getset(0,i,"desginHeight",function(){return console.debug("desginHeight已经弃用，请使用designHeight代替"),this.designHeight}),__getset(0,i,"scaleMode",function(){return this._scaleMode},function(t){this._scaleMode=t,Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,i,"alignV",function(){return this._alignV},function(t){this._alignV=t,Laya.timer.callLater(this,this._changeCanvasSize)}),__getset(0,i,"bgColor",function(){return this._bgColor},function(t){this._bgColor=t,this.conchModel&&this.conchModel.bgColor(t),Render.isWebGL&&(t&&"black"!==t&&"#000000"!==t?this._wgColor=Color.create(t)._color:this._wgColor=null),t?Render.canvas.style.background=t:Render.canvas.style.background="none"}),__getset(0,i,"mouseX",function(){return Math.round(MouseManager.instance.mouseX/this.clientScaleX)}),__getset(0,i,"mouseY",function(){return Math.round(MouseManager.instance.mouseY/this.clientScaleY)}),__getset(0,i,"screenMode",function(){return this._screenMode},function(t){this._screenMode=t}),__getset(0,i,"visible",t.prototype._$get_visible,function(e){if(this.visible!==e){t.prototype._$set_visible.call(this,e);var i=Render._mainCanvas.source.style;i.visibility=e?"visible":"hidden"}}),__getset(0,i,"fullScreenEnabled",null,function(t){var e=Browser.document,i=Render.canvas;t?(i.addEventListener("mousedown",this._requestFullscreen),i.addEventListener("touchstart",this._requestFullscreen),e.addEventListener("fullscreenchange",this._fullScreenChanged),e.addEventListener("mozfullscreenchange",this._fullScreenChanged),e.addEventListener("webkitfullscreenchange",this._fullScreenChanged),e.addEventListener("msfullscreenchange",this._fullScreenChanged)):(i.removeEventListener("mousedown",this._requestFullscreen),i.removeEventListener("touchstart",this._requestFullscreen),e.removeEventListener("fullscreenchange",this._fullScreenChanged),e.removeEventListener("mozfullscreenchange",this._fullScreenChanged),e.removeEventListener("webkitfullscreenchange",this._fullScreenChanged),e.removeEventListener("msfullscreenchange",this._fullScreenChanged))}),e.SCALE_NOSCALE="noscale",e.SCALE_EXACTFIT="exactfit",e.SCALE_SHOWALL="showall",e.SCALE_NOBORDER="noborder",e.SCALE_FULL="full",e.SCALE_FIXED_WIDTH="fixedwidth",e.SCALE_FIXED_HEIGHT="fixedheight",e.SCALE_FIXED_AUTO="fixedauto",e.ALIGN_LEFT="left",e.ALIGN_RIGHT="right",e.ALIGN_CENTER="center",e.ALIGN_TOP="top",e.ALIGN_MIDDLE="middle",e.ALIGN_BOTTOM="bottom",e.SCREEN_NONE="none",e.SCREEN_HORIZONTAL="horizontal",e.SCREEN_VERTICAL="vertical",e.FRAME_FAST="fast",e.FRAME_SLOW="slow",e.FRAME_MOUSE="mouse",e.FRAME_SLEEP="sleep",e}(Sprite),SoundNode=function(t){function e(){this.url=null,this._channel=null,this._tar=null,this._playEvents=null,this._stopEvents=null,e.__super.call(this),this.visible=!1,this.on("added",this,this._onParentChange),this.on("removed",this,this._onParentChange)}__class(e,"laya.media.SoundNode",t);var i=e.prototype;return i._onParentChange=function(){this.target=this.parent},i.play=function(t,e){void 0===t&&(t=1),isNaN(t)&&(t=1),this.url&&(this.stop(),this._channel=SoundManager.playSound(this.url,t,e))},i.stop=function(){this._channel&&!this._channel.isStopped&&this._channel.stop(),this._channel=null},i._setPlayAction=function(t,e,i,s){void 0===s&&(s=!0),this[i]&&t&&(s?t.on(e,this,this[i]):t.off(e,this,this[i]))},i._setPlayActions=function(t,e,i,s){if(void 0===s&&(s=!0),t&&e){var n=e.split(","),a=0,o=0;for(o=n.length,a=0;o>a;a++)this._setPlayAction(t,n[a],i,s)}},__getset(0,i,"playEvent",null,function(t){this._playEvents=t,t&&this._tar&&this._setPlayActions(this._tar,t,"play")}),__getset(0,i,"target",null,function(t){this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!1),this._setPlayActions(this._tar,this._stopEvents,"stop",!1)),this._tar=t,this._tar&&(this._setPlayActions(this._tar,this._playEvents,"play",!0),this._setPlayActions(this._tar,this._stopEvents,"stop",!0))}),__getset(0,i,"stopEvent",null,function(t){this._stopEvents=t,t&&this._tar&&this._setPlayActions(this._tar,t,"stop")}),e}(Sprite),FileBitmap=function(t){function e(){this._src=null,this._onload=null,this._onerror=null,e.__super.call(this)}__class(e,"laya.resource.FileBitmap",t);var i=e.prototype;return __getset(0,i,"src",function(){return this._src},function(t){this._src=t}),__getset(0,i,"onload",null,function(t){}),__getset(0,i,"onerror",null,function(t){}),e}(Bitmap),HTMLCanvas=function(t){function e(t){this._is2D=!1,e.__super.call(this);var i=this;if(this._source=this,"WXAPP"===t){this._source=window.canvas;var s=this;s.getContext=function(t,e){if(i._ctx)return i._ctx;var n=i._ctx=i._source.getContext(t,e);return n&&(n._canvas=s,Render.isFlash||(n.size=function(t,e){})),n}}else if("2D"===t||"AUTO"===t&&!Render.isWebGL){this._is2D=!0,Browser.onWXAPP?(e.idx<1?this._source=window.canvas:this._source=wx.createCanvas(),e.idx++):this._source=Browser.createElement("canvas");var s=this;s.getContext=function(t,e){if(i._ctx)return i._ctx;var n=i._ctx=i._source.getContext(t,e);return n&&(n._canvas=s,Render.isFlash||(n.size=function(t,e){})),n}}}e.idx=1,__class(e,"laya.resource.HTMLCanvas",t);var i=e.prototype;return i.clear=function(){this._ctx&&this._ctx.clear()},i.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null},i.release=function(){},i._setContext=function(t){this._ctx=t},i.getContext=function(t,i){return this._ctx?this._ctx:this._ctx=e._createContext(this)},i.getMemSize=function(){return 0},i.size=function(t,e){this._w==t&&this._h==e||(this._w=t,this._h=e,this.memorySize=this._w*this._h*4,this._ctx&&this._ctx.size(t,e),this._source&&(this._source.height=e,this._source.width=t))},i.getCanvas=function(){return this._source},__getset(0,i,"context",function(){return this._ctx}),__getset(0,i,"asBitmap",null,function(t){}),e.create=function(t){return new e(t)},e.TYPE2D="2D",e.TYPE3D="3D",e.TYPEAUTO="AUTO",e._createContext=null,e}(Bitmap),HTMLSubImage=function(t){function e(t,i,s,n,a,o,r,h){throw e.__super.call(this),new Error("不允许new！")}return __class(e,"laya.resource.HTMLSubImage",t),e.create=function(t,i,s,n,a,o,r,h){return void 0===h&&(h=!1),new e(t,i,s,n,a,o,r,h)},e}(Bitmap),Animation=function(t){function e(){this._frames=null,this._url=null,e.__super.call(this),this._setControlNode(this)}__class(e,"laya.display.Animation",t);var i=e.prototype;return i.destroy=function(t){void 0===t&&(t=!0),this.stop(),laya.display.Sprite.prototype.destroy.call(this,t),this._frames=null,this._labels=null},i.play=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=""),i&&this._setFramesFromCache(i),this._isPlaying=!0,this.index="string"==typeof t?this._getFrameByLabel(t):t,this.loop=e,this._actionName=i,this._isReverse=1==this.wrapMode,this._frames&&this.interval>0&&this.timerLoop(this.interval,this,this._frameLoop,null,!0)},i._setFramesFromCache=function(t){var i=""!=t;if(this._url&&(t=this._url+"#"+t),t&&e.framesMap[t]){var s;return s=e.framesMap[t],s instanceof Array?(this._frames=e.framesMap[t],this._count=this._frames.length):(s.nodeRoot&&(e.framesMap[t]=this._parseGraphicAnimationByData(s),s=e.framesMap[t]),this._frames=s.frames,this._count=this._frames.length,this._frameRateChanged||(this._interval=s.interval),this._labels=this._copyLabels(s.labels)),!0}return i&&console.log("ani not found:",t),!1},i._copyLabels=function(t){if(!t)return null;var e;e={};var i;for(i in t)e[i]=Utils.copyArray([],t[i]);return e},i._frameLoop=function(){this._style.visible&&this._style.alpha>.01&&t.prototype._frameLoop.call(this)},i._displayToIndex=function(t){this._frames&&(this.graphics=this._frames[t])},i.clear=function(){this.stop(),this.graphics=null,this._frames=null,this._labels=null},i.loadImages=function(t,i){return void 0===i&&(i=""),this._url="",this._setFramesFromCache(i)||(this.frames=e.framesMap[i]?e.framesMap[i]:e.createFrames(t,i)),this},i.loadAtlas=function(t,i,s){function n(n){t===n&&(a.frames=e.framesMap[s]?e.framesMap[s]:e.createFrames(t,s),i&&i.run())}void 0===s&&(s=""),this._url="";var a=this;return a._setFramesFromCache(s)||(Loader.getAtlas(t)?n(t):Laya.loader.load(t,Handler.create(null,n,[t]),null,"atlas")),this},i.loadAnimation=function(t,e,i){this._url=t;var s=this;return this._actionName||(this._actionName=""),s._setFramesFromCache("")?(s._setFramesFromCache(this._actionName),e&&e.run()):!i||Loader.getAtlas(i)?this._loadAnimationData(t,e,i):Laya.loader.load(i,Handler.create(this,this._loadAnimationData,[t,e,i]),null,"atlas"),this},i._loadAnimationData=function(t,i,s){function n(s){if(Loader.getRes(s)&&t===s){var n;if(e.framesMap[t+"#"])o._setFramesFromCache(a._actionName),a.index=0,a._checkResumePlaying();else{var r=o._parseGraphicAnimation(Loader.getRes(t));if(!r)return;var h,l=r.animationList,c=0,d=l.length;for(c=0;d>c;c++)n=l[c],e.framesMap[t+"#"+n.name]=n,h||(h=n);h&&(e.framesMap[t+"#"]=h,o._setFramesFromCache(a._actionName),a.index=0),a._checkResumePlaying()}i&&i.run()}}var a=this;if(s&&!Loader.getAtlas(s))return void console.warn("atlas load fail:"+s);var o=this;Loader.getRes(t)?n(t):Laya.loader.load(t,Handler.create(null,n,[t]),null,"json"),Loader.clearRes(t)},i._parseGraphicAnimation=function(t){return GraphicAnimation.parseAnimationData(t)},i._parseGraphicAnimationByData=function(t){return GraphicAnimation.parseAnimationByData(t)},__getset(0,i,"frames",function(){return this._frames},function(t){this._frames=t,t&&(this._count=t.length,this._isPlaying?this.play(this._index,this.loop,this._actionName):this.index=this._index)}),__getset(0,i,"autoPlay",null,function(t){t?this.play():this.stop()}),__getset(0,i,"source",null,function(t){t.indexOf(".ani")>-1?this.loadAnimation(t):t.indexOf(".json")>-1||t.indexOf("als")>-1||t.indexOf("atlas")>-1?this.loadAtlas(t):this.loadImages(t.split(","))}),__getset(0,i,"autoAnimation",null,function(t){this.play(0,!0,t)}),e.createFrames=function(t,i){var s;if("string"==typeof t){var n=Loader.getAtlas(t);if(n&&n.length){s=[];for(var a=0,o=n.length;o>a;a++){var r=new Graphics;r.drawTexture(Loader.getRes(n[a]),0,0),s.push(r)}}}else if(t instanceof Array)for(s=[],a=0,o=t.length;o>a;a++)r=new Graphics,r.loadImage(t[a],0,0),s.push(r);return i&&(e.framesMap[i]=s),s},e.clearCache=function(t){var i,s=e.framesMap,n=t+"#";for(i in s)i!==t&&0!=i.indexOf(n)||delete e.framesMap[i]},e.framesMap={},e}(AnimationPlayerBase),FrameAnimation=function(t){function e(){this._targetDic=null,this._animationData=null,this._animationNewFrames=null,e.__super.call(this),null==e._sortIndexFun&&(e._sortIndexFun=MathUtil.sortByKey("index",!1,!0))}__class(e,"laya.display.FrameAnimation",t);var i=e.prototype;return i._setUp=function(t,e){this._labels=null,this._animationNewFrames=null,this._targetDic=t,this._animationData=e,this.interval=1e3/e.frameRate,e.parsed?(this._count=e.count,this._labels=e.labels,this._animationNewFrames=e.animationNewFrames):(this._animationNewFrames=[],this._calculateDatas()),e.parsed=!0,e.labels=this._labels,e.count=this._count,e.animationNewFrames=this._animationNewFrames},i.clear=function(){t.prototype.clear.call(this),this._targetDic=null,this._animationData=null},i._displayToIndex=function(t){if(this._animationData){0>t&&(t=0),t>this._count&&(t=this._count);var e=this._animationData.nodes,i=0,s=e.length;for(i=0;s>i;i++)this._displayNodeToFrame(e[i],t)}},i._displayNodeToFrame=function(t,e,i){i||(i=this._targetDic);var s=i[t.target];if(s){var n,a,o,r=t.frames,h=t.keys,l=0,c=h.length;for(l=0;c>l;l++)n=h[l],a=r[n],o=a.length>e?a[e]:a[a.length-1],s[n]=o}},i._calculateDatas=function(){if(this._animationData){var t,e=this._animationData.nodes,i=0,s=e.length;for(this._count=0,i=0;s>i;i++)t=e[i],this._calculateNodeKeyFrames(t);this._count+=1}},i._calculateNodeKeyFrames=function(t){var i,s,n=t.keyframes,a=t.target;t.frames||(t.frames={}),t.keys?t.keys.length=0:t.keys=[],t.initValues||(t.initValues={});for(i in n)s=n[i],t.frames[i]||(t.frames[i]=[]),this._targetDic&&this._targetDic[a]&&(t.initValues[i]=this._targetDic[a][i]),s.sort(e._sortIndexFun),t.keys.push(i),this._calculateNodePropFrames(s,t.frames[i],i,a)},i.resetToInitState=function(){if(this._targetDic&&this._animationData){var t,e,i=this._animationData.nodes,s=0,n=i.length;for(s=0;n>s;s++)if(t=i[s],e=t.initValues){var a=this._targetDic[t.target];if(a){var o;for(o in e)a[o]=e[o]}}}},i._calculateNodePropFrames=function(t,e,i,s){var n=0,a=t.length-1;for(e.length=t[a].index+1,n=0;a>n;n++)this._dealKeyFrame(t[n]),this._calculateFrameValues(t[n],t[n+1],e);0==a&&(e[0]=t[0].value,this._animationNewFrames&&(this._animationNewFrames[t[0].index]=!0)),this._dealKeyFrame(t[n])},i._dealKeyFrame=function(t){t.label&&""!=t.label&&this.addLabel(t.label,t.index)},i._calculateFrameValues=function(t,e,i){var s,n=0,a=t.index,o=e.index,r=t.value,h=e.value-t.value,l=o-a;if(o>this._count&&(this._count=o),t.tween)for(s=Ease[t.tweenMethod],null==s&&(s=Ease.linearNone),n=a;o>n;n++)i[n]=s(n-a,r,h,l),this._animationNewFrames&&(this._animationNewFrames[n]=!0);else for(n=a;o>n;n++)i[n]=r;this._animationNewFrames&&(this._animationNewFrames[t.index]=!0,this._animationNewFrames[e.index]=!0),i[e.index]=e.value},e._sortIndexFun=null,e}(AnimationPlayerBase),Input=function(t){function e(){this._focus=!1,this._multiline=!1,this._editable=!0,this._restrictPattern=null,this._type="text",this._prompt="",this._promptColor="#A9A9A9",this._originColor="#000000",this._content="",e.__super.call(this),this._maxChars=1e5,this._width=100,this._height=20,this.multiline=!1,this.overflow=Text.SCROLL,this.on("mousedown",this,this._onMouseDown),this.on("undisplay",this,this._onUnDisplay)}__class(e,"laya.display.Input",t);var i=e.prototype;return i.setSelection=function(t,e){this.focus=!0,laya.display.Input.inputElement.selectionStart=t,laya.display.Input.inputElement.selectionEnd=e},i._onUnDisplay=function(t){this.focus=!1},i._onMouseDown=function(t){this.focus=!0},i.render=function(t,e,i){laya.display.Sprite.prototype.render.call(this,t,e,i)},i._syncInputTransform=function(){var t=this.nativeInput,i=Utils.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]),s=this._width-this.padding[1]-this.padding[3],n=this._height-this.padding[0]-this.padding[2];Render.isConchApp?(t.setScale(i.scaleX,i.scaleY),t.setSize(s,n),t.setPos(i.x,i.y)):(e.inputContainer.style.transform=e.inputContainer.style.webkitTransform="scale("+i.scaleX+","+i.scaleY+") rotate("+Laya.stage.canvasDegree+"deg)",t.style.width=s+"px",t.style.height=n+"px",e.inputContainer.style.left=i.x+"px",e.inputContainer.style.top=i.y+"px")},i.select=function(){this.nativeInput.select()},i._setInputMethod=function(){e.input.parentElement&&e.inputContainer.removeChild(e.input),e.area.parentElement&&e.inputContainer.removeChild(e.area),e.inputElement=this._multiline?e.area:e.input,e.inputContainer.appendChild(e.inputElement),Text.RightToLeft&&(e.inputElement.style.direction="rtl")},i._focusIn=function(){laya.display.Input.isInputting=!0;var t=this.nativeInput;this._focus=!0;var e=t.style;e.whiteSpace=this.wordWrap?"pre-wrap":"nowrap",this._setPromptColor(),t.readOnly=!this._editable,Render.isConchApp&&t.setForbidEdit(!this._editable),t.maxLength=this._maxChars;this.padding;t.type=this._type,t.value=this._content,t.placeholder=this._prompt,Laya.stage.off("keydown",this,this._onKeyDown),Laya.stage.on("keydown",this,this._onKeyDown),Laya.stage.focus=this,this.event("focus"),(Browser.onPC||Browser.onWXAPP)&&t.focus();this._text;this._text=null,this.typeset(),t.setColor(this._originColor),t.setFontSize(this.fontSize),Render.isConchApp&&t.setMultiAble&&t.setMultiAble(this._multiline),e.lineHeight=this.leading+this.fontSize+"px",e.fontStyle=this.italic?"italic":"normal",e.fontWeight=this.bold?"bold":"normal",e.textAlign=this.align,e.padding="0 0",this._syncInputTransform(),!Render.isConchApp&&Browser.onPC&&Laya.timer.frameLoop(1,this,this._syncInputTransform)},i._setPromptColor=function(){e.promptStyleDOM=Browser.getElementById("promptStyle"),e.promptStyleDOM||(e.promptStyleDOM=Browser.createElement("style"),e.promptStyleDOM.setAttribute("id","promptStyle"),Browser.document.head.appendChild(e.promptStyleDOM)),e.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {color:"+this._promptColor+"}input:-moz-placeholder, textarea:-moz-placeholder {color:"+this._promptColor+"}input::-moz-placeholder, textarea::-moz-placeholder {color:"+this._promptColor+"}input:-ms-input-placeholder, textarea:-ms-input-placeholder {color:"+this._promptColor+"}"},i._focusOut=function(){laya.display.Input.isInputting=!1,this._focus=!1,this._text=null,this._content=this.nativeInput.value,this._content?(t.prototype._$set_text.call(this,this._content),t.prototype._$set_color.call(this,this._originColor)):(t.prototype._$set_text.call(this,this._prompt),t.prototype._$set_color.call(this,this._promptColor)),Laya.stage.off("keydown",this,this._onKeyDown),Laya.stage.focus=null,this.event("blur"),Render.isConchApp&&this.nativeInput.blur(),Browser.onPC&&Laya.timer.clear(this,this._syncInputTransform)},i._onKeyDown=function(t){13===t.keyCode&&(Browser.onMobile&&!this._multiline&&(this.focus=!1),this.event("enter"))},i.changeText=function(e){this._content=e,this._focus?(this.nativeInput.value=e||"",this.event("change")):t.prototype.changeText.call(this,e)},__getset(0,i,"color",t.prototype._$get_color,function(e){this._focus&&this.nativeInput.setColor(e),t.prototype._$set_color.call(this,this._content?e:this._promptColor),this._originColor=e}),__getset(0,i,"inputElementYAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。"),0},function(t){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementYAdjuster已弃用。")}),__getset(0,i,"multiline",function(){return this._multiline},function(t){this._multiline=t,this.valign=t?"top":"middle"}),__getset(0,i,"maxChars",function(){return this._maxChars},function(t){0>=t&&(t=1e5),this._maxChars=t}),__getset(0,i,"text",function(){return this._focus?this.nativeInput.value:this._content||""},function(e){t.prototype._$set_color.call(this,this._originColor),e+="",this._focus&&!Browser.onWXAPP?(this.nativeInput.value=e||"",this.event("change")):(Browser.onWXAPP&&(this.nativeInput.value=e||""),this._multiline||(e=e.replace(/\r?\n/g,"")),this._content=e,e?t.prototype._$set_text.call(this,e):(t.prototype._$set_text.call(this,this._prompt),t.prototype._$set_color.call(this,this.promptColor)))}),__getset(0,i,"nativeInput",function(){return this._multiline?e.area:e.input}),__getset(0,i,"prompt",function(){return this._prompt},function(e){!this._text&&e&&t.prototype._$set_color.call(this,this._promptColor),this.promptColor=this._promptColor,this._text?t.prototype._$set_text.call(this,this._text==this._prompt?e:this._text):t.prototype._$set_text.call(this,e),this._prompt=Text.langPacks&&Text.langPacks[e]?Text.langPacks[e]:e}),__getset(0,i,"focus",function(){return this._focus},function(t){var i=this.nativeInput;this._focus!==t&&(t?(i.target?i.target._focusOut():this._setInputMethod(),i.target=this,this._focusIn()):(i.target=null,this._focusOut(),i.blur(),Render.isConchApp?i.setPos(-1e4,-1e4):!Browser.onWXAPP&&e.inputContainer.contains(i)&&e.inputContainer.removeChild(i)))}),__getset(0,i,"restrict",function(){return this._restrictPattern?this._restrictPattern.source:""},function(t){t?(t="[^"+t+"]",t.indexOf("^^")>-1&&(t=t.replace("^^","")),this._restrictPattern=new RegExp(t,"g")):this._restrictPattern=null}),__getset(0,i,"editable",function(){return this._editable},function(t){this._editable=t,Render.isConchApp&&e.input.setForbidEdit(!t)}),__getset(0,i,"promptColor",function(){return this._promptColor},function(e){this._promptColor=e,this._content||t.prototype._$set_color.call(this,e)}),__getset(0,i,"type",function(){return this._type},function(t){"password"==t?this._getCSSStyle().password=!0:this._getCSSStyle().password=!1,this._type=t}),__getset(0,i,"inputElementXAdjuster",function(){return console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。"),0},function(t){console.warn("deprecated: 由于即使设置了该值，在各平台和浏览器之间也不一定一致，inputElementXAdjuster已弃用。")}),__getset(0,i,"asPassword",function(){return this._getCSSStyle().password},function(t){this._getCSSStyle().password=t,this._type="password",console.warn('deprecated: 使用type="password"替代设置asPassword, asPassword将在下次重大更新时删去'),this.isChanged=!0}),e.__init__=function(){e._createInputElement(),Browser.onMobile&&Render.canvas.addEventListener(e.IOS_IFRAME?"click":"touchend",e._popupInputMethod)},e._popupInputMethod=function(t){if(laya.display.Input.isInputting){var e=laya.display.Input.inputElement;e.focus()}},e.wxinputFocus=function(){console.log("wxinputFocus");var t=laya.display.Input.inputElement.target;window.wx.offKeyboardConfirm(),window.wx.offKeyboardInput(),window.wx.showKeyboard({defaultValue:t.text,maxLength:t.maxChars,multiple:t.multiline,confirmHold:!0,confirmType:"done",success:function(t){console.log("打开键盘成功")},fail:function(t){console.log("打开键盘出错:"+(t?t.errMsg:""))}}),window.wx.onKeyboardConfirm(function(i){var s=i?i.value:"";console.log("onKeyboardConfirm:"+s),s=e.faceReplace(s),t.text=s,t.event("input"),laya.display.Input.inputEnter()}),window.wx.onKeyboardInput(function(i){var s=i?i.value:"";return console.log("onKeyboardInput:"+s),t.multiline||-1==s.indexOf("\n")?(s=e.faceReplace(s),t.text=s,void t.event("input")):void laya.display.Input.inputEnter()})},e.inputEnter=function(){laya.display.Input.inputElement.target.focus=!1},e.wxinputblur=function(){console.log("wxinputblur"),e.hideKeyboard()},e.hideKeyboard=function(){console.log("hideKeyBoard"),window.wx.offKeyboardConfirm(),window.wx.offKeyboardInput(),window.wx.hideKeyboard({success:function(t){console.log("隐藏键盘")},fail:function(t){console.log("隐藏键盘出错:"+(t?t.errMsg:""))}})},e.faceReplace=function(t){var e=t,i=/[\uD83C|\uD83D|\uD83E][\uDC00-\uDFFF][\u200D|\uFE0F]|[\uD83C|\uD83D|\uD83E][\uDC00-\uDFFF]|[0-9|*|#]\uFE0F\u20E3|[0-9|#]\u20E3|[\u203C-\u3299]\uFE0F\u200D|[\u203C-\u3299]\uFE0F|[\u2122-\u2B55]|\u303D|[\A9|\AE]\u3030|\uA9|\uAE|\u3030/gi;e.match(i)&&(e=e.replace(i,""),Browser.onWXAPP||(laya.display.Input.inputElement.value=e));var s=/\uD83C[\uDF00-\uDFFF]|\uD83D[\uDC00-\uDE4F]/g;return e.match(s)&&(e=e.replace(s,""),Browser.onWXAPP||(laya.display.Input.inputElement.value=e)),e},e._createInputElement=function(){e._initInput(e.area=Browser.createElement("textarea")),e._initInput(e.input=Browser.createElement("input")),Browser.onWXAPP&&(e.area.focus=laya.display.Input.wxinputFocus,e.area.blur=laya.display.Input.wxinputblur,e.input.focus=laya.display.Input.wxinputFocus,e.input.blur=laya.display.Input.wxinputblur),e.inputContainer=Browser.createElement("div"),e.inputContainer.style.position="absolute",e.inputContainer.style.zIndex=1e5,Browser.container.appendChild(e.inputContainer),e.inputContainer.setPos=function(t,i){e.inputContainer.style.left=t+"px",e.inputContainer.style.top=i+"px"}},e._initInput=function(t){var i=t.style;i.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;",i.resize="none",i.backgroundColor="transparent",i.border="none",i.outline="none",i.zIndex=1,t.addEventListener("input",e._processInputting),t.addEventListener("mousemove",e._stopEvent),t.addEventListener("mousedown",e._stopEvent),t.addEventListener("touchmove",e._stopEvent),t.setFontFace=function(e){t.style.fontFamily=e},Render.isConchApp||(t.setColor=function(e){t.style.color=e},t.setFontSize=function(e){t.style.fontSize=e+"px"})},e._processInputting=function(t){var e=laya.display.Input.inputElement.target;if(e){var i=laya.display.Input.inputElement.value;e._restrictPattern&&(i=i.replace(/\u2006|\x27/g,""),e._restrictPattern.test(i)&&(i=i.replace(e._restrictPattern,""),laya.display.Input.inputElement.value=i)),e._text=i,e.event("input")}},e._stopEvent=function(t){"touchmove"==t.type&&t.preventDefault(),t.stopPropagation&&t.stopPropagation()},e.TYPE_TEXT="text",e.TYPE_PASSWORD="password",e.TYPE_EMAIL="email",e.TYPE_URL="url",e.TYPE_NUMBER="number",e.TYPE_RANGE="range",e.TYPE_DATE="date",e.TYPE_MONTH="month",e.TYPE_WEEK="week",e.TYPE_TIME="time",e.TYPE_DATE_TIME="datetime",e.TYPE_DATE_TIME_LOCAL="datetime-local",e.TYPE_SEARCH="search",e.input=null,e.area=null,e.inputElement=null,e.inputContainer=null,e.confirmButton=null,e.promptStyleDOM=null,e.inputHeight=45,e.isInputting=!1,e.stageMatrix=null,__static(e,["IOS_IFRAME",function(){return this.IOS_IFRAME=Browser.onIOS&&Browser.window.top!=Browser.window.self}]),e}(Text),HTMLImage=function(t){function e(t,i){this._recreateLock=!1,this._needReleaseAgain=!1,e.__super.call(this),this._init_(t,i)}__class(e,"laya.resource.HTMLImage",t);var i=e.prototype;return i._init_=function(t,e){this._src=t,this._source=new Browser.window.Image,e&&(e.onload&&(this.onload=e.onload),e.onerror&&(this.onerror=e.onerror),e.onCreate&&e.onCreate(this)),0!=t.indexOf("data:image")&&(this._source.crossOrigin=""),t&&(this._source.src=t)},i.recreateResource=function(){var t=this;if(""===this._src)throw new Error("src no null！");if(this._needReleaseAgain=!1,this._source){if(this._recreateLock)return;this.startCreate(),
this.memorySize=this._w*this._h*4,this._recreateLock=!1,this.completeCreate()}else{this._recreateLock=!0,this.startCreate();var e=this;this._source=new Browser.window.Image,this._source.crossOrigin="",this._source.onload=function(){return e._needReleaseAgain?(e._needReleaseAgain=!1,e._source.onload=null,void(e._source=null)):(e._source.onload=null,e.memorySize=t._w*t._h*4,e._recreateLock=!1,void e.completeCreate())},this._source.src=this._src}},i.detoryResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(this._source=null,this.memorySize=0)},i.onresize=function(){this._w=this._source.width,this._h=this._source.height},__getset(0,i,"onload",null,function(t){var e=this;this._onload=t,this._source&&(this._source.onload=null!=this._onload?function(){e.onresize(),e._onload()}:null)}),__getset(0,i,"onerror",null,function(t){var e=this;this._onerror=t,this._source&&(this._source.onerror=null!=this._onerror?function(){e._onerror()}:null)}),e.create=function(t,i){return new e(t,i)},e}(FileBitmap),EffectAnimation=function(t){function e(){this._target=null,this._playEvents=null,this._initData={},this._aniKeys=null,this._effectClass=null,e.__super.call(this)}__class(e,"laya.display.EffectAnimation",t);var i=e.prototype;return i._onOtherBegin=function(t){t!=this&&this.stop()},i.addEvent=function(){this._target&&this._playEvents&&(this._setControlNode(this._target),this._target.on(this._playEvents,this,this._onPlayAction))},i._onPlayAction=function(){this._target&&(this._target.event("effectanimationbegin",[this]),this._recordInitData(),this.play(0,!1))},i._recordInitData=function(){if(this._aniKeys){var t=0,e=0;e=this._aniKeys.length;var i;for(t=0;e>t;t++)i=this._aniKeys[t],this._initData[i]=this._target[i]}},i._displayToIndex=function(t){if(this._animationData){0>t&&(t=0),t>this._count&&(t=this._count);var e=this._animationData.nodes,i=0,s=e.length;for(s=s>1?1:s,i=0;s>i;i++)this._displayNodeToFrame(e[i],t)}},i._displayNodeToFrame=function(t,e,i){if(this._target){var s;s=this._target;var n,a,o,r,h=t.frames,l=t.keys,c=0,d=l.length;r=t.secondFrames;var u,p,_,f,y=0;for(c=0;d>c;c++)n=l[c],a=h[n],y=r[n],-1==y?o=this._initData[n]:y>e?(p=t.keyframes[n],_=p[0],_.tween?(u=Ease[_.tweenMethod],null==u&&(u=Ease.linearNone),f=p[1],o=u(e,this._initData[n],f.value-this._initData[n],f.index)):o=this._initData[n]):o=a.length>e?a[e]:a[a.length-1],s[n]=o}},i._calculateNodeKeyFrames=function(e){t.prototype._calculateNodeKeyFrames.call(this,e);var i,s,n,a=e.keyframes;e.target;n={},e.secondFrames=n;for(i in a)s=a[i],s.length<=1?n[i]=-1:n[i]=s[1].index},__getset(0,i,"target",function(){return this._target},function(t){this._target&&this._target.off("effectanimationbegin",this,this._onOtherBegin),this._target=t,this._target&&this._target.on("effectanimationbegin",this,this._onOtherBegin),this.addEvent()}),__getset(0,i,"playEvent",null,function(t){this._playEvents=t,t&&this.addEvent()}),__getset(0,i,"effectData",null,function(t){if(t){var e;e=t.animations,e&&e[0]&&(this._setUp({},e[0]),e[0].nodes&&e[0].nodes[0]&&(this._aniKeys=e[0].nodes[0].keys))}}),__getset(0,i,"effectClass",null,function(t){if(this._effectClass=ClassUtils.getClass(t),this._effectClass){var e;if(e=this._effectClass.uiView){var i;i=e.animations,i&&i[0]&&(this._setUp({},i[0]),i[0].nodes&&i[0].nodes[0]&&(this._aniKeys=i[0].nodes[0].keys))}}}),e.EffectAnimationBegin="effectanimationbegin",e}(FrameAnimation),GraphicAnimation=function(t){function e(){this.animationList=null,this.animationDic=null,this._nodeList=null,this._nodeDefaultProps=null,this._gList=null,this._nodeIDAniDic={},this._rootNode=null,this._nodeGDic=null,e.__super.call(this)}var i;__class(e,"laya.utils.GraphicAnimation",t);var s=e.prototype;return s._parseNodeList=function(t){this._nodeList||(this._nodeList=[]),this._nodeDefaultProps[t.compId]=t.props,t.compId&&this._nodeList.push(t.compId);var e=t.child;if(e){var i=0,s=e.length;for(i=0;s>i;i++)this._parseNodeList(e[i])}},s._calGraphicData=function(t){this._setUp(null,t),this._createGraphicData()},s._createGraphicData=function(){var t=[],e=0,i=this.count,s=this._animationNewFrames;s||(s=[]);var n;for(e=0;i>e;e++)!s[e]&&n||(n=this._createFrameGraphic(e)),t.push(n);this._gList=t},s._createFrameGraphic=function(t){var i=new Graphics;return e._rootMatrix||(e._rootMatrix=new Matrix),this._updateNodeGraphic(this._rootNode,t,e._rootMatrix,i),i},s._updateNodeGraphic=function(t,e,i,s,n){void 0===n&&(n=1);var a;a=this._nodeGDic[t.compId]=this._getNodeGraphicData(t.compId,e,this._nodeGDic[t.compId]),a.resultTransform||(a.resultTransform=new Matrix);var o;o=a.resultTransform,Matrix.mul(a.transform,i,o);var r,h=a.alpha*n;if(!(.01>h)){a.skin&&(r=this._getTextureByUrl(a.skin),r&&(o._checkTransform()?(s.drawTexture(r,0,0,a.width,a.height,o,h),a.resultTransform=null):s.drawTexture(r,o.tx,o.ty,a.width,a.height,null,h)));var l;if(l=t.child){var c=0,d=0;for(d=l.length,c=0;d>c;c++)this._updateNodeGraphic(l[c],e,o,s,h)}}},s._updateNoChilds=function(t,e){if(t.skin){var i=this._getTextureByUrl(t.skin);if(i){var s=t.transform;s._checkTransform();var n=!1;n=!s.bTransform,n?e.drawTexture(i,s.tx,s.ty,t.width,t.height,null,t.alpha):e.drawTexture(i,0,0,t.width,t.height,s.clone(),t.alpha)}}},s._updateNodeGraphic2=function(t,e,i){var s;if(s=this._nodeGDic[t.compId]=this._getNodeGraphicData(t.compId,e,this._nodeGDic[t.compId]),!t.child)return void this._updateNoChilds(s,i);var n=s.transform;n._checkTransform();var a=!1;a=!n.bTransform;var o=!1;o=a&&(0!=n.tx||0!=n.ty);var r=!1;r=n.bTransform||1!=s.alpha,r&&i.save(),1!=s.alpha&&i.alpha(s.alpha),a?o&&i.translate(n.tx,n.ty):i.transform(n.clone());var h;h=t.child;var l;if(s.skin&&(l=this._getTextureByUrl(s.skin),l&&i.drawTexture(l,0,0,s.width,s.height)),h){var c=0,d=0;for(d=h.length,c=0;d>c;c++)this._updateNodeGraphic2(h[c],e,i)}r?i.restore():a?o&&i.translate(-n.tx,-n.ty):i.transform(n.clone().invert())},s._calculateNodeKeyFrames=function(e){t.prototype._calculateNodeKeyFrames.call(this,e),this._nodeIDAniDic[e.target]=e},s.getNodeDataByID=function(t){return this._nodeIDAniDic[t]},s._getParams=function(t,i,s,n){var a=e._temParam;a.length=i.length;var o=0,r=i.length;for(o=0;r>o;o++)a[o]=this._getObjVar(t,i[o][0],s,i[o][1],n);return a},s._getObjVar=function(t,e,i,s,n){if(t.hasOwnProperty(e)){var a=t[e];return i>=a.length&&(i=a.length-1),t[e][i]}return n.hasOwnProperty(e)?n[e]:s},s._getNodeGraphicData=function(t,s,n){n||(n=new i),n.transform?n.transform.identity():n.transform=new Matrix;var a=this.getNodeDataByID(t);if(!a)return n;var o=a.frames,r=this._getParams(o,e._drawTextureCmd,s,this._nodeDefaultProps[t]),h=r[0],l=NaN,c=NaN,d=r[5],u=r[6],p=r[13],_=r[14],f=r[7],y=r[8],m=r[9],g=r[11],v=r[12];l=r[3],c=r[4];var C;n.skin=h,n.width=l,n.height=c,h&&(C=this._getTextureByUrl(h),C?(l||(l=C.width),c||(c=C.height)):console.warn("lost skin:",h,",you may load pics first")),n.alpha=r[10];var w;w=n.transform,0!=p&&(d=p*l),0!=_&&(u=_*c),0==d&&0==u||w.translate(-d,-u);var x=null;if(m||1!==f||1!==y||g||v){x=e._tempMt,x.identity(),x.bTransform=!0;var b=.0174532922222222*(m-g),S=.0174532922222222*(m+v),I=Math.cos(S),T=Math.sin(S),L=Math.sin(b),k=Math.cos(b);x.a=f*I,x.b=f*T,x.c=-y*L,x.d=y*k,x.tx=x.ty=0}return x&&(w=Matrix.mul(w,x,w)),w.translate(r[1],r[2]),n},s._getTextureByUrl=function(t){return Loader.getRes(t)},s.setAniData=function(t,i){if(t.animations){this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=t,this._parseNodeList(t);var s,n={},a=[],o=t.animations,r=0,h=o.length;for(r=0;h>r;r++)if(s=o[r],this._labels=null,(!i||i==s.name)&&s){try{this._calGraphicData(s)}catch(l){console.warn("parse animation fail:"+s.name+",empty animation created"),this._gList=[]}var c={};c.interval=1e3/s.frameRate,c.frames=this._gList,c.labels=this._labels,c.name=s.name,a.push(c),n[s.name]=c}this.animationList=a,this.animationDic=n}e._temParam.length=0},s.parseByData=function(t){var e,i;e=t.nodeRoot,i=t.aniO,delete t.nodeRoot,delete t.aniO,this._nodeDefaultProps={},this._nodeGDic={},this._nodeList&&(this._nodeList.length=0),this._rootNode=e,this._parseNodeList(e),this._labels=null;try{this._calGraphicData(i)}catch(s){console.warn("parse animation fail:"+i.name+",empty animation created"),this._gList=[]}var n=t;return n.interval=1e3/i.frameRate,n.frames=this._gList,n.labels=this._labels,n.name=i.name,n},s.setUpAniData=function(t){if(t.animations){var e,i={},s=[],n=t.animations,a=0,o=n.length;for(a=0;o>a;a++)if(e=n[a]){var r={};r.name=e.name,r.aniO=e,r.nodeRoot=t,s.push(r),i[e.name]=r}this.animationList=s,this.animationDic=i}},s._clear=function(){this.animationList=null,this.animationDic=null,this._gList=null,this._nodeGDic=null},e.parseAnimationByData=function(t){e._I||(e._I=new e);var i;return i=e._I.parseByData(t),e._I._clear(),i},e.parseAnimationData=function(t){e._I||(e._I=new e),e._I.setUpAniData(t);var i;return i={},i.animationList=e._I.animationList,i.animationDic=e._I.animationDic,e._I._clear(),i},e._temParam=[],e._I=null,e._rootMatrix=null,__static(e,["_drawTextureCmd",function(){return this._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",0],["height",0],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]]},"_tempMt",function(){return this._tempMt=new Matrix}]),e.__init$=function(){i=function(){function t(){this.skin=null,this.transform=null,this.resultTransform=null,this.width=NaN,this.height=NaN,this.alpha=1}return __class(t,""),t}()},e}(FrameAnimation);Laya.__init([EventDispatcher,LoaderManager,GraphicAnimation,Render,Browser,Timer,LocalStorage,TimeLine])}(window,document,Laya),function(t,e,i){var s=(i.un,i.uns,i["static"],i["class"]),n=(i.getset,i.__newvec,function(){function t(){}return s(t,"LayaMain"),t}());new n}(window,document,Laya),function(t,e,i){var s=(i.un,i.uns,i["static"]),n=i["class"],a=i.getset,o=i.__newvec,r=laya.maths.Arith,h=laya.maths.Bezier,l=laya.resource.Bitmap,c=laya.utils.Browser,d=laya.utils.Color,u=(laya.filters.ColorFilter,i.Config),p=laya.resource.Context,_=(laya.events.Event,laya.filters.Filter),f=laya.display.Graphics,y=laya.resource.HTMLCanvas,m=(laya.utils.HTMLChar,laya.resource.HTMLImage),g=laya.resource.HTMLSubImage,v=(laya.utils.Handler,laya.maths.Matrix),C=laya.maths.Point,w=laya.maths.Rectangle,x=laya.renders.Render,b=(laya.renders.RenderContext,laya.renders.RenderSprite),S=laya.resource.Resource,I=laya.resource.ResourceManager,T=laya.utils.RunDriver,L=laya.display.Sprite,k=laya.utils.Stat,E=laya.utils.StringKey,D=(laya.display.css.Style,laya.system.System),A=laya.resource.Texture,B=(laya.net.URL,laya.utils.Utils),P=laya.utils.VectorGraphManager;laya.utils.WordText;i["interface"]("laya.webgl.shapes.IShape"),i["interface"]("laya.webgl.submit.ISubmit"),i["interface"]("laya.webgl.text.ICharSegment"),i["interface"]("laya.webgl.canvas.save.ISaveData"),i["interface"]("laya.webgl.resource.IMergeAtlasBitmap"),i["interface"]("laya.filters.IFilterActionGL","laya.filters.IFilterAction");var M=function(){function t(){}n(t,"laya.filters.webgl.FilterActionGL");var e=t.prototype;return i.imps(e,{"laya.filters.IFilterActionGL":!0}),e.setValue=function(t){},e.setValueMix=function(t){},e.apply3d=function(t,e,i,s,n){return null},e.apply=function(t){return null},a(0,e,"typeMix",function(){return 0}),t}(),R=function(){function t(){}return n(t,"laya.webgl.shader.ShaderValue"),t}(),O=function(){function t(t,e,s){this._atlasID=0,this._width=0,this._height=0,this._texCount=0,this._rowInfo=null,this._cells=null,this._failSize=new i,void 0===t&&(t=0),void 0===e&&(e=0),void 0===s&&(s=0),this._cells=null,this._rowInfo=null,this._init(t,e),this._atlasID=s}var e,i;n(t,"laya.webgl.atlas.AtlasGrid");var s=t.prototype;return s.getAltasID=function(){return this._atlasID},s.setAltasID=function(t){t>=0&&(this._atlasID=t)},s.addTex=function(t,e,i){var s=this._get(e,i);return 0==s.ret?s:(this._fill(s.x,s.y,e,i,t),this._texCount++,s)},s._release=function(){null!=this._cells&&(this._cells.length=0,this._cells=null),this._rowInfo&&(this._rowInfo.length=0,this._rowInfo=null)},s._init=function(t,i){if(this._width=t,this._height=i,this._release(),0==this._width)return!1;this._cells=new Uint8Array(this._width*this._height*3),this._rowInfo=o(this._height);for(var s=0;s<this._height;s++)this._rowInfo[s]=new e;return this._clear(),!0},s._get=function(t,e){var i=new N;if(t>=this._failSize.width&&e>=this._failSize.height)return i;for(var s=-1,n=-1,a=this._width,o=this._height,r=this._cells,h=0;o>h;h++)if(!(this._rowInfo[h].spaceCount<t))for(var l=0;a>l;){var c=3*(h*a+l);if(0!=r[c]||r[c+1]<t||r[c+2]<e)l+=r[c+1];else{s=l,n=h;for(var d=0;t>d;d++)if(r[3*d+c+2]<e){s=-1;break}if(!(0>s))return i.ret=!0,i.x=s,i.y=n,i;l+=r[c+1]}}return i},s._fill=function(t,e,i,s,n){var a=this._width,o=this._height;this._check(a>=t+i&&o>=e+s);for(var r=e;s+e>r;++r){this._check(this._rowInfo[r].spaceCount>=i),this._rowInfo[r].spaceCount-=i;for(var h=0;i>h;h++){var l=3*(t+r*a+h);this._check(0==this._cells[l]),this._cells[l]=n,this._cells[l+1]=i,this._cells[l+2]=s}}if(t>0)for(r=0;s>r;++r){var c=0;for(h=t-1;h>=0&&0==this._cells[3*((e+r)*a+h)];--h,++c);for(h=c;h>0;--h)this._cells[3*((e+r)*a+t-h)+1]=h,this._check(h>0)}if(e>0)for(h=t;t+i>h;++h){for(c=0,r=e-1;r>=0&&0==this._cells[3*(h+r*a)];--r,c++);for(r=c;r>0;--r)this._cells[3*(h+(e-r)*a)+2]=r,this._check(r>0)}},s._check=function(t){0==t&&console.log("xtexMerger 错误啦")},s._clear=function(){this._texCount=0;for(var t=0;t<this._height;t++)this._rowInfo[t].spaceCount=this._width;for(var e=0;e<this._height;e++)for(var i=0;i<this._width;i++){var s=3*(e*this._width+i);this._cells[s]=0,this._cells[s+1]=this._width-i,this._cells[s+2]=this._width-e}this._failSize.width=this._width+1,this._failSize.height=this._height+1},t.__init$=function(){e=function(){function t(){this.spaceCount=0}return n(t,""),t}(),i=function(){function t(){this.width=0,this.height=0}return n(t,""),t}()},t}(),F=function(){function t(t,e,i,s){this._currentAtlasCount=0,this._maxAtlaserCount=0,this._width=0,this._height=0,this._gridSize=0,this._gridNumX=0,this._gridNumY=0,this._init=!1,this._curAtlasIndex=0,this._setAtlasParam=!1,this._atlaserArray=null,this._needGC=!1,this._setAtlasParam=!0,this._width=t,this._height=e,this._gridSize=i,this._maxAtlaserCount=s,this._gridNumX=t/i,this._gridNumY=e/i,this._curAtlasIndex=0,this._atlaserArray=[]}n(t,"laya.webgl.atlas.AtlasResourceManager");var e=t.prototype;return e.setAtlasParam=function(e,i,s,n){if(1==this._setAtlasParam)return t._sid_=0,this._width=e,this._height=i,this._gridSize=s,this._maxAtlaserCount=n,this._gridNumX=e/s,this._gridNumY=i/s,this._curAtlasIndex=0,this.freeAll(),!0;throw console.log("设置大图合集参数错误，只能在开始页面设置各种参数"),-1},e.pushData=function(e){this._setAtlasParam=!1;for(var i=Math.ceil((e.bitmap.width+2)/this._gridSize),s=Math.ceil((e.bitmap.height+2)/this._gridSize),n=!1,a=0;2>a;a++){for(var o=this._maxAtlaserCount,r=0;o>r;r++){var h=(this._curAtlasIndex+r)%o;this._atlaserArray.length-1>=h||this._atlaserArray.push(new Ct(this._gridNumX,this._gridNumY,this._width,this._height,t._sid_++));var l=this._atlaserArray[h],c=e.bitmap,d=l.inAtlasWebGLImagesKey.indexOf(c),u=0,p=0;if(-1!=d){var _=l.InAtlasWebGLImagesOffsetValue[d];u=_[0],p=_[1],l.addToAtlas(e,u,p),n=!0,this._curAtlasIndex=h;break}var f=l.addTex(1,i,s);if(f.ret){u=f.x*this._gridSize+1,p=f.y*this._gridSize+1,c.lock=!0,l.addToAtlasTexture(c,u,p),l.addToAtlas(e,u,p),n=!0,this._curAtlasIndex=h;break}}if(n)break;this._atlaserArray.push(new Ct(this._gridNumX,this._gridNumY,this._width,this._height,t._sid_++)),this._needGC=!0,this.garbageCollection(),this._curAtlasIndex=this._atlaserArray.length-1}return n||console.log(">>>AtlasManager pushData error"),n},e.addToAtlas=function(t){laya.webgl.atlas.AtlasResourceManager.instance.pushData(t)},e.garbageCollection=function(){if(this._needGC===!0){for(var t=this._atlaserArray.length-this._maxAtlaserCount,e=0;t>e;e++)this._atlaserArray[e].dispose();this._atlaserArray.splice(0,t),this._needGC=!1}return!0},e.freeAll=function(){for(var t=0,e=this._atlaserArray.length;e>t;t++)this._atlaserArray[t].dispose();this._atlaserArray.length=0,this._curAtlasIndex=0},e.getAtlaserCount=function(){return this._atlaserArray.length},e.getAtlaserByIndex=function(t){return this._atlaserArray[t]},a(1,t,"instance",function(){return t._Instance||(t._Instance=new t(laya.webgl.atlas.AtlasResourceManager.atlasTextureWidth,laya.webgl.atlas.AtlasResourceManager.atlasTextureHeight,16,laya.webgl.atlas.AtlasResourceManager.maxTextureCount)),t._Instance}),a(1,t,"enabled",function(){return t._enabled}),a(1,t,"atlasLimitWidth",function(){return t._atlasLimitWidth},function(e){t._atlasLimitWidth=e}),a(1,t,"atlasLimitHeight",function(){return t._atlasLimitHeight},function(e){t._atlasLimitHeight=e}),t._enable=function(){t._enabled=!0,u.atlasEnable=!0},t._disable=function(){t._enabled=!1,u.atlasEnable=!1},t.__init__=function(){t.atlasTextureWidth=2048,t.atlasTextureHeight=2048,t.maxTextureCount=5,t.atlasLimitWidth=512,t.atlasLimitHeight=512},t._enabled=!1,t._atlasLimitWidth=0,t._atlasLimitHeight=0,t.gridSize=16,t.atlasTextureWidth=0,t.atlasTextureHeight=0,t.maxTextureCount=0,t._atlasRestore=0,t.BOARDER_TYPE_NO=0,t.BOARDER_TYPE_RIGHT=1,t.BOARDER_TYPE_LEFT=2,t.BOARDER_TYPE_BOTTOM=4,t.BOARDER_TYPE_TOP=8,t.BOARDER_TYPE_ALL=15,t._sid_=0,t._Instance=null,t}(),N=function(){function t(){this.x=0,this.y=0,this.ret=!1,this.ret=!1,this.x=0,this.y=0}return n(t,"laya.webgl.atlas.MergeFillInfo"),t}(),U=function(){function t(){}return n(t,"laya.webgl.canvas.BlendMode"),t._init_=function(e){t.fns=[t.BlendNormal,t.BlendAdd,t.BlendMultiply,t.BlendScreen,t.BlendOverlay,t.BlendLight,t.BlendMask,t.BlendDestinationOut],t.targetFns=[t.BlendNormalTarget,t.BlendAddTarget,t.BlendMultiplyTarget,t.BlendScreenTarget,t.BlendOverlayTarget,t.BlendLightTarget,t.BlendMask,t.BlendDestinationOut]},t.BlendNormal=function(t){t.blendFuncSeparate(770,771,1,1)},t.BlendAdd=function(t){t.blendFunc(770,772)},t.BlendMultiply=function(t){t.blendFunc(774,771)},t.BlendScreen=function(t){t.blendFunc(770,1)},t.BlendOverlay=function(t){t.blendFunc(1,769)},t.BlendLight=function(t){t.blendFunc(770,1)},t.BlendNormalTarget=function(t){t.blendFuncSeparate(770,771,1,771)},t.BlendAddTarget=function(t){t.blendFunc(770,772)},t.BlendMultiplyTarget=function(t){t.blendFunc(774,771)},t.BlendScreenTarget=function(t){t.blendFunc(770,1)},t.BlendOverlayTarget=function(t){t.blendFunc(1,769)},t.BlendLightTarget=function(t){t.blendFunc(770,1)},t.BlendMask=function(t){t.blendFunc(0,770)},t.BlendDestinationOut=function(t){t.blendFunc(0,0)},t.activeBlendFunction=null,t.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"],t.TOINT={normal:0,add:1,multiply:2,screen:3,lighter:1,overlay:4,light:5,mask:6,"destination-out":7},t.NORMAL="normal",t.ADD="add",t.MULTIPLY="multiply",t.SCREEN="screen",t.LIGHT="light",t.OVERLAY="overlay",t.DESTINATIONOUT="destination-out",t.fns=[],t.targetFns=[],t}(),H=function(){function t(t){this._color=d.create("black"),this.setValue(t)}n(t,"laya.webgl.canvas.DrawStyle");var e=t.prototype;return e.setValue=function(t){if(t){if("string"==typeof t)return void(this._color=d.create(t));if(t instanceof laya.utils.Color)return void(this._color=t)}},e.reset=function(){this._color=d.create("black")},e.equal=function(t){return"string"==typeof t?this._color.strColor===t:t instanceof laya.utils.Color?this._color.numColor===t.numColor:!1},e.toColorStr=function(){return this._color.strColor},t.create=function(e){if(e){var i;if("string"==typeof e?i=d.create(e):e instanceof laya.utils.Color&&(i=e),i)return i._drawStyle||(i._drawStyle=new t(e))}return null},t.DEFAULT=new t("#000000"),t}(),G=function(){function t(){this._x=0,this._y=0,this.dirty=!1,this.offset=0,this.count=0,this.geoStart=0,this.tempArray=[],this.closePath=!1,this.geomatrys=[];pt.mainContext;this.ib=Kt.create(35048),this.vb=jt.create(5)}n(t,"laya.webgl.canvas.Path");var e=t.prototype;return e.addPoint=function(t,e){this.tempArray.push(t,e)},e.getEndPointX=function(){return this.tempArray[this.tempArray.length-2]},e.getEndPointY=function(){return this.tempArray[this.tempArray.length-1]},e.polygon=function(t,e,i,s,n,a){var o;return this.geomatrys.push(this._curGeomatry=o=new St(t,e,i,s,n,a)),s||(o.fill=!1),void 0==a&&(o.borderWidth=0),o},e.setGeomtry=function(t){this.geomatrys.push(this._curGeomatry=t)},e.drawLine=function(t,e,i,s,n){var a;return this.closePath?this.geomatrys.push(this._curGeomatry=a=new bt(t,e,i,s,n)):this.geomatrys.push(this._curGeomatry=a=new xt(t,e,i,s,n)),a.fill=!1,a},e.update=function(){var t=this.ib.byteLength,e=this.geomatrys.length;this.offset=t;for(var i=this.geoStart;e>i;i++)this.geomatrys[i].getData(this.ib,this.vb,this.vb.byteLength/20);this.geoStart=e,this.count=(this.ib.byteLength-t)/lt.BYTES_PIDX},e.reset=function(){this.vb.clear(),this.ib.clear(),this.offset=this.count=this.geoStart=0,this.geomatrys.length=0},t}(),W=function(){function t(){}n(t,"laya.webgl.canvas.save.SaveBase");var e=t.prototype;return i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){this._dataObj[this._valueName]=this._value,t._cache[t._cache._length++]=this,this._newSubmit&&(e._curSubmit=Z.RENDERBASE,e._renderKey=0)},t._createArray=function(){var t=[];return t._length=0,t},t._init=function(){var e=t._namemap={};return e[1]="ALPHA",e[2]="fillStyle",e[8]="font",e[256]="lineWidth",e[512]="strokeStyle",e[8192]="_mergeID",e[1024]=e[2048]=e[4096]=[],e[16384]="textBaseline",e[32768]="textAlign",e[65536]="_nBlendType",e[524288]="shader",e[1048576]="filters",e},t.save=function(e,i,s,n){if((e._saveMark._saveuse&i)!==i){e._saveMark._saveuse|=i;var a=t._cache,o=a._length>0?a[--a._length]:new t;o._value=s[o._valueName=t._namemap[i]],o._dataObj=s,o._newSubmit=n;var r=e._save;r[r._length++]=o}},t._cache=laya.webgl.canvas.save.SaveBase._createArray(),t._namemap=t._init(),t}(),V=function(){function t(){this._clipRect=new w}n(t,"laya.webgl.canvas.save.SaveClipRect");var e=t.prototype;return i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){e._clipRect=this._clipSaveRect,t._cache[t._cache._length++]=this,this._submitScissor.submitLength=e._submits._length-this._submitScissor.submitIndex,e._curSubmit=Z.RENDERBASE,e._renderKey=0},t.save=function(e,i){if(131072!=(131072&e._saveMark._saveuse)){e._saveMark._saveuse|=131072;var s=t._cache,n=s._length>0?s[--s._length]:new t;n._clipSaveRect=e._clipRect,e._clipRect=n._clipRect.copyFrom(e._clipRect),n._submitScissor=i;var a=e._save;a[a._length++]=n}},t._cache=W._createArray(),t}(),K=function(){function t(){this._saveuse=0}n(t,"laya.webgl.canvas.save.SaveMark");var e=t.prototype;return i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!0},e.restore=function(e){e._saveMark=this._preSaveMark,t._no[t._no._length++]=this},t.Create=function(e){var i=t._no,s=i._length>0?i[--i._length]:new t;return s._saveuse=0,s._preSaveMark=e._saveMark,e._saveMark=s,s},t._no=W._createArray(),t}(),j=function(){function t(){this._matrix=new v}n(t,"laya.webgl.canvas.save.SaveTransform");var e=t.prototype;return i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){e._curMat=this._savematrix,t._no[t._no._length++]=this},t.save=function(e){var i=e._saveMark;if(2048!==(2048&i._saveuse)){i._saveuse|=2048;var s=t._no,n=s._length>0?s[--s._length]:new t;n._savematrix=e._curMat,e._curMat=e._curMat.copyTo(n._matrix);var a=e._save;a[a._length++]=n}},t._no=W._createArray(),t}(),X=function(){function t(){}n(t,"laya.webgl.canvas.save.SaveTranslate");var e=t.prototype;return i.imps(e,{"laya.webgl.canvas.save.ISaveData":!0}),e.isSaveMark=function(){return!1},e.restore=function(e){e._curMat;e._x=this._x,e._y=this._y,t._no[t._no._length++]=this},t.save=function(e){var i=t._no,s=i._length>0?i[--i._length]:new t;s._x=e._x,s._y=e._y;var n=e._save;n[n._length++]=s},t._no=W._createArray(),t}(),Y=function(){function t(){this.target=null,this.repaint=!1,this._width=NaN,this._height=NaN,this._sp=null,this._clipRect=new w}n(t,"laya.webgl.resource.RenderTargetMAX");var e=t.prototype;return e.setSP=function(t){this._sp=t},e.size=function(t,e){var s=this;return this._width===t&&this._height===e?void this.target.size(t,e):(this.repaint=!0,this._width=t,this._height=e,this.target?this.target.size(t,e):this.target=kt.create(t,e),void(this.target.hasListener("recovered")||this.target.on("recovered",this,function(t){i.timer.callLater(s._sp,s._sp.repaint)})))},e._flushToTarget=function(t,e){if(!e._destroy){var i=dt.worldScissorTest,s=dt.worldClipRect;dt.worldClipRect=this._clipRect,this._clipRect.x=this._clipRect.y=0,this._clipRect.width=this._width,this._clipRect.height=this._height,dt.worldScissorTest=!1,pt.mainContext.disable(3089);var n=dt.worldAlpha,a=dt.worldMatrix4,o=dt.worldMatrix,r=dt.worldFilters,h=dt.worldShaderDefines;if(dt.worldMatrix=v.EMPTY,dt.restoreTempArray(),dt.worldMatrix4=dt.TEMPMAT4_ARRAY,dt.worldAlpha=1,dt.worldFilters=null,dt.worldShaderDefines=null,Lt.activeShader=null,e.start(),u.showCanvasMark?e.clear(0,1,0,.3):e.clear(0,0,0,0),t.flush(),e.end(),Lt.activeShader=null,dt.worldAlpha=n,dt.worldMatrix4=a,dt.worldMatrix=o,dt.worldFilters=r,dt.worldShaderDefines=h,dt.worldScissorTest=i,i){var l=dt.height-s.y-s.height;pt.mainContext.scissor(s.x,l,s.width,s.height),pt.mainContext.enable(3089)}dt.worldClipRect=s}},e.flush=function(t){this.repaint&&(this._flushToTarget(t,this.target),this.repaint=!1)},e.drawTo=function(t,e,i,s,n){t.drawTexture(this.target.getTexture(),e,i,s,n,0,0)},e.destroy=function(){this.target&&(this.target.destroy(),this.target=null,this._sp=null)},t}(),q=function(){function t(){this.ALPHA=1,this.shaderType=0,this.defines=new wt}return n(t,"laya.webgl.shader.d2.Shader2D"),t.__init__=function(){Ht.addInclude("parts/ColorFilter_ps_uniform.glsl","uniform vec4 colorAlpha;\nuniform mat4 colorMat;"),Ht.addInclude("parts/ColorFilter_ps_logic.glsl","gl_FragColor = gl_FragColor * colorMat + colorAlpha/255.0;"),Ht.addInclude("parts/GlowFilter_ps_uniform.glsl","uniform vec4 u_color;\nuniform float u_strength;\nuniform float u_blurX;\nuniform float u_blurY;\nuniform float u_offsetX;\nuniform float u_offsetY;\nuniform float u_textW;\nuniform float u_textH;"),Ht.addInclude("parts/GlowFilter_ps_logic.glsl","const float c_IterationTime = 10.0;\nfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\nvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\nvec2 vec2FilterDir = vec2(-(u_offsetX)/u_textW,-(u_offsetY)/u_textH);\nvec2 vec2FilterOff = vec2(u_blurX/u_textW/c_IterationTime * 2.0,u_blurY/u_textH/c_IterationTime * 2.0);\nfloat maxNum = u_blurX * u_blurY;\nvec2 vec2Off = vec2(0.0,0.0);\nfloat floatOff = c_IterationTime/2.0;\nfor(float i = 0.0;i<=c_IterationTime; ++i){\n	for(float j = 0.0;j<=c_IterationTime; ++j){\n		vec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n		vec4Color += texture2D(texture, v_texcoord + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n	}\n}\ngl_FragColor = vec4(u_color.rgb,vec4Color.a * u_strength);"),Ht.addInclude("parts/BlurFilter_ps_logic.glsl","gl_FragColor =   blur();\ngl_FragColor.w*=alpha;"),Ht.addInclude("parts/BlurFilter_ps_uniform.glsl","uniform float strength;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\nfloat sigma=strength/3.0;//3σ以外影响很小。即当σ=1的时候，半径为3\nfloat sig2 = sigma*sigma;\nfloat _2sig2 = 2.0*sig2;\n//return 1.0/(2*PI*sig2)*exp(-(x*x+y*y)/_2sig2)\nfloat gauss1 = 1.0/(2.0*PI*sig2);\n\nfloat getGaussian(float x, float y){\n    return gauss1*exp(-(x*x+y*y)/_2sig2);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoord-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}"),Ht.addInclude("parts/ColorAdd_ps_uniform.glsl","uniform vec4 colorAdd;\n"),Ht.addInclude("parts/ColorAdd_ps_logic.glsl","gl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);");var t,e;t="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",e='precision mediump float;\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec4 color= texture2D(texture, v_texcoord);\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',Ht.preCompile2D(0,1,t,e,null),t="attribute vec4 position;\nuniform vec2 size;\nuniform mat4 mmat;\nvoid main() {\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n}",e='precision mediump float;\nuniform vec4 color;\nuniform float alpha;\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\nvoid main() {\n	vec4 a = vec4(color.r, color.g, color.b, color.a);\n	a.w = alpha;\n	gl_FragColor = a;\n	#include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n}',Ht.preCompile2D(0,2,t,e,null),t="attribute vec4 position;\nattribute vec3 a_color;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nuniform vec2 u_pos;\nuniform vec2 size;\nvarying vec3 color;\nvoid main(){\n  vec4 tPos = vec4(position.x + u_pos.x,position.y + u_pos.y,position.z,position.w);\n  vec4 pos=mmat*u_mmat2*tPos;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  color=a_color;\n}",e="precision mediump float;\n//precision mediump float;\nvarying vec3 color;\nuniform float alpha;\nvoid main(){\n	//vec4 a=vec4(color.r, color.g, color.b, 1);\n	//a.a*=alpha;\n    gl_FragColor=vec4(color.r, color.g, color.b, alpha);\n}",Ht.preCompile2D(0,4,t,e,null),t="attribute vec4 position;\nattribute vec2 texcoord;\nuniform vec2 size;\n\n#ifdef WORLDMAT\nuniform mat4 mmat;\n#endif\nvarying vec2 v_texcoord;\nvoid main() {\n  #ifdef WORLDMAT\n  vec4 pos=mmat*position;\n  gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  #else\n  gl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n  #endif\n  \n  v_texcoord = texcoord;\n}",e='#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n//precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D texture;\nuniform float alpha;\nuniform vec4 u_TexRange;\nuniform vec2 u_offset;\n#include?BLUR_FILTER  "parts/BlurFilter_ps_uniform.glsl";\n#include?COLOR_FILTER "parts/ColorFilter_ps_uniform.glsl";\n#include?GLOW_FILTER "parts/GlowFilter_ps_uniform.glsl";\n#include?COLOR_ADD "parts/ColorAdd_ps_uniform.glsl";\n\nvoid main() {\n   vec2 newTexCoord;\n   newTexCoord.x = mod(u_offset.x + v_texcoord.x,u_TexRange.y) + u_TexRange.x;\n   newTexCoord.y = mod(u_offset.y + v_texcoord.y,u_TexRange.w) + u_TexRange.z;\n   vec4 color= texture2D(texture, newTexCoord);\n   color.a*=alpha;\n   gl_FragColor=color;\n   #include?COLOR_ADD "parts/ColorAdd_ps_logic.glsl";   \n   #include?BLUR_FILTER  "parts/BlurFilter_ps_logic.glsl";\n   #include?COLOR_FILTER "parts/ColorFilter_ps_logic.glsl";\n   #include?GLOW_FILTER "parts/GlowFilter_ps_logic.glsl";\n}',
Ht.preCompile2D(0,256,t,e,null),t="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_texcoord = texcoord;  \n}",e="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n	vec4 t_color = texture2D(texture, v_texcoord);\n	gl_FragColor = t_color.rgba * v_color;\n	gl_FragColor.a = gl_FragColor.a * alpha;\n}",Ht.preCompile2D(0,512,t,e,null)},t}(),z=function(){function t(t,e,i){this._value=0,this._name2int=t,this._int2name=e,this._int2nameMap=i}n(t,"laya.webgl.shader.ShaderDefines");var e=t.prototype;return e.add=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value|=t,this._value},e.addInt=function(t){return this._value|=t,this._value},e.remove=function(t){return"string"==typeof t&&(t=this._name2int[t]),this._value&=~t,this._value},e.isDefine=function(t){return(this._value&t)===t},e.getValue=function(){return this._value},e.setValue=function(t){this._value=t},e.toNameDic=function(){var e=this._int2nameMap[this._value];return e?e:t._toText(this._value,this._int2name,this._int2nameMap)},t._reg=function(t,e,i,s){i[t]=e,s[e]=t},t._toText=function(t,e,i){var s=i[t];if(s)return s;for(var n={},a=1,o=0;32>o&&(a=1<<o,!(a>t));o++)if(t&a){var r=e[a];r&&(n[r]="")}return i[t]=n,n},t._toInt=function(t,e){for(var i=t.split("."),s=0,n=0,a=i.length;a>n;n++){var o=e[i[n]];if(!o)throw new Error("Defines to int err:"+t+"/"+i[n]);s|=o}return s},t}(),J=function(){function t(){this.mVBBuffer=null,this.mIBBuffer=null,this.mVBData=null,this.mIBData=null,this.mEleNum=0,this.mTexture=null,this.transform=null,this._vs=null,this._ps=null,this._indexStart=-1,this._verticles=null,this._uvs=null,this._tempMat16=dt.getMatrArray()}n(t,"laya.webgl.shader.d2.skinAnishader.SkinMesh");var e=t.prototype;return e.init=function(e,i,s){if(i)this._vs=i;else{this._vs=[];var n=e.width,a=e.height,o=1,r=1,h=1,l=1;this._vs.push(0,0,0,0,o,r,h,l),this._vs.push(n,0,1,0,o,r,h,l),this._vs.push(n,a,1,1,o,r,h,l),this._vs.push(0,a,0,1,o,r,h,l)}s?this._ps=s:(t._defaultPS||(t._defaultPS=[],t._defaultPS.push(0,1,3,3,1,2)),this._ps=t._defaultPS),this.mVBData=new Float32Array(this._vs),this.mIBData=new Uint16Array(this._ps.length),this.mIBData.start=-1,this.mEleNum=this._ps.length,this.mTexture=e},e.init2=function(t,e,i,s,n){this.transform&&(this.transform=null),i?this._ps=i:(this._ps=[],this._ps.push(0,1,3,3,1,2)),this._verticles=s,this._uvs=n,this.mEleNum=this._ps.length,this.mTexture=t,(x.isConchNode||x.isConchApp)&&(this._initMyData(),this.mVBData=new Float32Array(this._vs))},e._initMyData=function(){var e=0,i=0,s=this._verticles.length,n=4*s;this._vs=t._tempVS;var a=!1;if(x.isConchNode||x.isConchApp?(this._vs.length=n,a=!0):this._vs.length<n&&(this._vs.length=n,a=!0),t._tVSLen=n,a)for(;n>e;)this._vs[e]=this._verticles[i],this._vs[e+1]=this._verticles[i+1],this._vs[e+2]=this._uvs[i],this._vs[e+3]=this._uvs[i+1],this._vs[e+4]=1,this._vs[e+5]=1,this._vs[e+6]=1,this._vs[e+7]=1,e+=8,i+=2;else for(;n>e;)this._vs[e]=this._verticles[i],this._vs[e+1]=this._verticles[i+1],this._vs[e+2]=this._uvs[i],this._vs[e+3]=this._uvs[i+1],e+=8,i+=2},e.getData2=function(e,i,s){this.mVBBuffer=e,this.mIBBuffer=i,this._initMyData(),e.appendEx2(this._vs,Float32Array,t._tVSLen,4),this._indexStart=i.byteLength;var n;n=t._tempIB,n.length<this._ps.length&&(n.length=this._ps.length);for(var a=0,o=this._ps.length;o>a;a++)n[a]=this._ps[a]+s;i.appendEx2(n,Uint16Array,this._ps.length,2)},e.getData=function(t,e,i){if(this.mVBBuffer=t,this.mIBBuffer=e,t.append(this.mVBData),this._indexStart=e.byteLength,this.mIBData.start!=i){for(var s=0,n=this._ps.length;n>s;s++)this.mIBData[s]=this._ps[s]+i;this.mIBData.start=i}e.append(this.mIBData)},e.render=function(t,e,i){if(x.isWebGL&&this.mTexture){t._renderKey=0,t._shader2D.glTexture=null,Q.getInstance().addSkinMesh(this);var s=Z.createShape(t,this.mIBBuffer,this.mVBBuffer,this.mEleNum,this._indexStart,mt.create(512,0));this.transform||(this.transform=v.EMPTY),this.transform.translate(e,i),v.mul16(this.transform,t._curMat,this._tempMat16),this.transform.translate(-e,-i);var n=s.shaderValue;n.textureHost=this.mTexture,n.offsetX=0,n.offsetY=0,n.u_mmat2=this._tempMat16,n.ALPHA=t._shader2D.ALPHA,t._submits[t._submits._length++]=s}else x.isConchApp&&this.mTexture&&(this.transform||(this.transform=v.EMPTY),t.setSkinMesh&&t.setSkinMesh(e,i,this._ps,this.mVBData,this.mEleNum,0,this.mTexture,this.transform))},t._tempVS=[],t._tempIB=[],t._defaultPS=null,t._tVSLen=0,t}(),Q=function(){function t(){this.ib=null,this.vb=null;pt.mainContext;this.ib=Kt.create(35048),this.vb=jt.create(8)}n(t,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var e=t.prototype;return e.addSkinMesh=function(t){t.getData2(this.vb,this.ib,this.vb.byteLength/32)},e.reset=function(){this.vb.clear(),this.ib.clear()},t.getInstance=function(){return t.instance=t.instance||new t},t.instance=null,t}(),$=function(){function t(t,e,i,s,n,a,o,r,h){this.r0=0,this.fill=!0,this.r1=Math.PI/2,void 0===h&&(h=0),this.x=t,this.y=e,this.width=i,this.height=s,this.edges=n,this.color=a,this.borderWidth=o,this.borderColor=r}n(t,"laya.webgl.shapes.BasePoly");var e=t.prototype;return i.imps(e,{"laya.webgl.shapes.IShape":!0}),e.getData=function(t,e,i){},e.rebuild=function(t){},e.setMatrix=function(t){},e.needUpdate=function(t){return!0},e.sector=function(t,e,i){var s=this.x,n=this.y,a=this.edges,o=(this.r1-this.r0)/a,r=this.width,h=this.height,l=this.color,c=(l>>16&255)/255,d=(l>>8&255)/255,u=(255&l)/255;t.push(s,n,c,d,u);for(var p=0;a+1>p;p++)t.push(s+Math.sin(o*p+this.r0)*r,n+Math.cos(o*p+this.r0)*h),t.push(c,d,u);for(p=0;a>p;p++)e.push(i,i+p+1,i+p+2)},e.createLine2=function(t,e,i,s,n,a){var o,r,h,l,c,d,u,p,_,f,y,m,g,v,C,w,x,b,S,I,T,L=t.concat(),k=n,E=this.borderColor,D=(E>>16&255)/255,A=(E>>8&255)/255,B=(255&E)/255,P=L.length/2,M=s,R=i/2;h=L[0],l=L[1],c=L[2],d=L[3],_=-(l-d),f=h-c,T=Math.sqrt(_*_+f*f),_=_/T*R,f=f/T*R,k.push(h-_+this.x,l-f+this.y,D,A,B,h+_+this.x,l+f+this.y,D,A,B);for(var O=1;P-1>O;O++)h=L[2*(O-1)],l=L[2*(O-1)+1],c=L[2*O],d=L[2*O+1],u=L[2*(O+1)],p=L[2*(O+1)+1],_=-(l-d),f=h-c,T=Math.sqrt(_*_+f*f),_=_/T*R,f=f/T*R,y=-(d-p),m=c-u,T=Math.sqrt(y*y+m*m),y=y/T*R,m=m/T*R,g=-f+l-(-f+d),v=-_+c-(-_+h),C=(-_+h)*(-f+d)-(-_+c)*(-f+l),w=-m+p-(-m+d),x=-y+c-(-y+u),b=(-y+u)*(-m+d)-(-y+c)*(-m+p),S=g*x-w*v,Math.abs(S)<.1?(S+=10.1,k.push(c-_+this.x,d-f+this.y,D,A,B,c+_+this.x,d+f+this.y,D,A,B)):(o=(v*b-x*C)/S,r=(w*C-g*b)/S,I=(o-c)*(o-c)+(r-d)+(r-d),k.push(o+this.x,r+this.y,D,A,B,c-(o-c)+this.x,d-(r-d)+this.y,D,A,B));h=L[L.length-4],l=L[L.length-3],c=L[L.length-2],d=L[L.length-1],_=-(l-d),f=h-c,T=Math.sqrt(_*_+f*f),_=_/T*R,f=f/T*R,k.push(c-_+this.x,d-f+this.y,D,A,B,c+_+this.x,d+f+this.y,D,A,B);var F=a;for(O=1;F>O;O++)e.push(M+2*(O-1),M+2*(O-1)+1,M+2*O+1,M+2*O+1,M+2*O,M+2*(O-1));return k},e.createLine=function(t,e,i,s){var n=t.concat(),a=t,o=this.borderColor,r=(o>>16&255)/255,h=(o>>8&255)/255,l=(255&o)/255;n.splice(0,5);var c,d,u,p,_,f,y,m,g,v,C,w,x,b,S,I,T,L,k,E,D,A=n.length/5,B=s,P=i/2;u=n[0],p=n[1],_=n[5],f=n[6],g=-(p-f),v=u-_,D=Math.sqrt(g*g+v*v),g=g/D*P,v=v/D*P,a.push(u-g,p-v,r,h,l,u+g,p+v,r,h,l);for(var M=1;A-1>M;M++)u=n[5*(M-1)],p=n[5*(M-1)+1],_=n[5*M],f=n[5*M+1],y=n[5*(M+1)],m=n[5*(M+1)+1],g=-(p-f),v=u-_,D=Math.sqrt(g*g+v*v),g=g/D*P,v=v/D*P,C=-(f-m),w=_-y,D=Math.sqrt(C*C+w*w),C=C/D*P,w=w/D*P,x=-v+p-(-v+f),b=-g+_-(-g+u),S=(-g+u)*(-v+f)-(-g+_)*(-v+p),I=-w+m-(-w+f),T=-C+_-(-C+y),L=(-C+y)*(-w+f)-(-C+_)*(-w+m),k=x*T-I*b,Math.abs(k)<.1?(k+=10.1,a.push(_-g,f-v,r,h,l,_+g,f+v,r,h,l)):(c=(b*L-T*S)/k,d=(I*S-x*L)/k,E=(c-_)*(c-_)+(d-f)+(d-f),a.push(c,d,r,h,l,_-(c-_),f-(d-f),r,h,l));u=n[n.length-10],p=n[n.length-9],_=n[n.length-5],f=n[n.length-4],g=-(p-f),v=u-_,D=Math.sqrt(g*g+v*v),g=g/D*P,v=v/D*P,a.push(_-g,f-v,r,h,l,_+g,f+v,r,h,l);var R=this.edges+1;for(M=1;R>M;M++)e.push(B+2*(M-1),B+2*(M-1)+1,B+2*M+1,B+2*M+1,B+2*M,B+2*(M-1));return a},e.createLoopLine=function(t,e,i,s,n,a){var o=t.concat(),r=n?n:t,h=this.borderColor,l=(h>>16&255)/255,c=(h>>8&255)/255,d=(255&h)/255;o.splice(0,5);var u=[o[0],o[1]],p=[o[o.length-5],o[o.length-4]],_=p[0]+.5*(u[0]-p[0]),f=p[1]+.5*(u[1]-p[1]);o.unshift(_,f,0,0,0),o.push(_,f,0,0,0);var y,m,g,v,C,w,x,b,S,I,T,L,k,E,D,A,B,P,M,R,O,F=o.length/5,N=s,U=i/2;g=o[0],v=o[1],C=o[5],w=o[6],S=-(v-w),I=g-C,O=Math.sqrt(S*S+I*I),S=S/O*U,I=I/O*U,r.push(g-S,v-I,l,c,d,g+S,v+I,l,c,d);for(var H=1;F-1>H;H++)g=o[5*(H-1)],v=o[5*(H-1)+1],C=o[5*H],w=o[5*H+1],x=o[5*(H+1)],b=o[5*(H+1)+1],S=-(v-w),I=g-C,O=Math.sqrt(S*S+I*I),S=S/O*U,I=I/O*U,T=-(w-b),L=C-x,O=Math.sqrt(T*T+L*L),T=T/O*U,L=L/O*U,k=-I+v-(-I+w),E=-S+C-(-S+g),D=(-S+g)*(-I+w)-(-S+C)*(-I+v),A=-L+b-(-L+w),B=-T+C-(-T+x),P=(-T+x)*(-L+w)-(-T+C)*(-L+b),M=k*B-A*E,Math.abs(M)<.1?(M+=10.1,r.push(C-S,w-I,l,c,d,C+S,w+I,l,c,d)):(y=(E*P-B*D)/M,m=(A*D-k*P)/M,R=(y-C)*(y-C)+(m-w)+(m-w),r.push(y,m,l,c,d,C-(y-C),w-(m-w),l,c,d));a&&(e=a);var G=this.edges+1;for(H=1;G>H;H++)e.push(N+2*(H-1),N+2*(H-1)+1,N+2*H+1,N+2*H+1,N+2*H,N+2*(H-1));return e.push(N+2*(H-1),N+2*(H-1)+1,N+1,N+1,N,N+2*(H-1)),r},t}(),Z=(function(){function t(t,e,i,s,n,a,o){this.lineWidth=t,this.lineColor=e,this.lineAlpha=i,this.fillColor=s,this.fillAlpha=n,this.shape=o,this.fill=a}n(t,"laya.webgl.shapes.GeometryData");var e=t.prototype;return e.clone=function(){return new t(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},e.getIndexData=function(){return null},e.getVertexData=function(){return null},e.destroy=function(){this.shape=null},t}(),function(){function t(t){if(t instanceof Float32Array)this.points=t;else if(t instanceof Array){t.length;this.points=new Float32Array(t)}}n(t,"laya.webgl.shapes.Vertex");var e=t.prototype;return i.imps(e,{"laya.webgl.shapes.IShape":!0}),e.getData=function(t,e,i){},e.needUpdate=function(t){return!1},e.rebuild=function(t){},e.setMatrix=function(t){},t}(),function(){function t(t){void 0===t&&(t=1e4),this._renderType=t}n(t,"laya.webgl.submit.Submit");var e=t.prototype;return i.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.releaseRender=function(){var e=t._cache;e[e._length++]=this,this.shaderValue.release(),this._vb=null},e.getRenderType=function(){return this._renderType},e.renderSubmit=function(){if(0===this._numEle)return 1;var t=this.shaderValue.textureHost;if(t){var e=t.source;if(!t.bitmap||!e)return 1;this.shaderValue.texture=e}this._vb.bind_upload(this._ib);var i=pt.mainContext;return this.shaderValue.upload(),U.activeBlendFunction!==this._blendFn&&(i.enable(3042),this._blendFn(i),U.activeBlendFunction=this._blendFn),k.drawCall++,k.trianglesFaces+=this._numEle/3,i.drawElements(4,this._numEle,5123,this._startIdx),1},t.__init__=function(){var e=t.RENDERBASE=new t(-1);e.shaderValue=new mt(0,0),e.shaderValue.ALPHA=-1234},t.create=function(e,i,s,n,a){var o=t._cache._length?t._cache[--t._cache._length]:new t;null==s&&(s=o._selfVb||(o._selfVb=jt.create(-1)),s.clear(),n=0),o._ib=i,o._vb=s,o._startIdx=n*lt.BYTES_PIDX,o._numEle=0;var r=e._nBlendType;o._blendFn=e._targets?U.targetFns[r]:U.fns[r],o.shaderValue=a,o.shaderValue.setValue(e._shader2D);var h=e._shader2D.filters;return h&&o.shaderValue.setFilters(h),o},t.createShape=function(e,i,s,n,a,o){var r=t._cache._length?t._cache[--t._cache._length]:new t;r._ib=i,r._vb=s,r._numEle=n,r._startIdx=a,r.shaderValue=o,r.shaderValue.setValue(e._shader2D);var h=e._nBlendType;return r._blendFn=e._targets?U.targetFns[h]:U.fns[h],r},t.TYPE_2D=1e4,t.TYPE_CANVAS=10003,t.TYPE_CMDSETRT=10004,t.TYPE_CUSTOM=10005,t.TYPE_BLURRT=10006,t.TYPE_CMDDESTORYPRERT=10007,t.TYPE_DISABLESTENCIL=10008,t.TYPE_OTHERIBVB=10009,t.TYPE_PRIMITIVE=10010,t.TYPE_RT=10011,t.TYPE_BLUR_RT=10012,t.TYPE_TARGET=10013,t.TYPE_CHANGE_VALUE=10014,t.TYPE_SHAPE=10015,t.TYPE_TEXTURE=10016,t.TYPE_FILLTEXTURE=10017,t.RENDERBASE=null,t._cache=(t._cache=[],t._cache._length=0,t._cache),t}()),tt=function(){function t(){this.fun=null,this.args=null}n(t,"laya.webgl.submit.SubmitCMD");var e=t.prototype;return i.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.renderSubmit=function(){return this.fun.apply(null,this.args),1},e.getRenderType=function(){return 0},e.releaseRender=function(){var e=t._cache;e[e._length++]=this},t.create=function(e,i){var s=t._cache._length?t._cache[--t._cache._length]:new t;return s.fun=i,s.args=e,s},t._cache=(t._cache=[],t._cache._length=0,t._cache),t}(),et=function(){function t(){this.variables={}}n(t,"laya.webgl.submit.SubmitCMDScope");var e=t.prototype;return e.getValue=function(t){return this.variables[t]},e.addValue=function(t,e){return this.variables[t]=e},e.setValue=function(t,e){return this.variables.hasOwnProperty(t)?this.variables[t]=e:null},e.clear=function(){for(var t in this.variables)delete this.variables[t]},e.recycle=function(){this.clear(),t.POOL.push(this)},t.create=function(){var e=t.POOL.pop();return e||(e=new t),e},t.POOL=[],t}(),it=function(){function t(){this.offset=0,this.startIndex=0,this._mat=v.create()}n(t,"laya.webgl.submit.SubmitOtherIBVB");var e=t.prototype;return i.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.releaseRender=function(){var e=t._cache;e[e._length++]=this},e.getRenderType=function(){return 10009},e.renderSubmit=function(){var e=this._shaderValue.textureHost;if(e){var i=e.source;if(!e.bitmap||!i)return 1;this._shaderValue.texture=i}this._vb.bind_upload(this._ib);var s=dt.worldMatrix4,n=v.TEMP;v.mulPre(this._mat,s[0],s[1],s[4],s[5],s[12],s[13],n);var a=dt.worldMatrix4=t.tempMatrix4;a[0]=n.a,a[1]=n.b,a[4]=n.c,a[5]=n.d,a[12]=n.tx,a[13]=n.ty,this._shader._offset=this.offset,this._shaderValue.refresh(),this._shader.upload(this._shaderValue),this._shader._offset=0;var o=pt.mainContext;return U.activeBlendFunction!==this._blendFn&&(o.enable(3042),this._blendFn(o),U.activeBlendFunction=this._blendFn),k.drawCall++,k.trianglesFaces+=this._numEle/3,o.drawElements(4,this._numEle,5123,this.startIndex),dt.worldMatrix4=s,Lt.activeShader=null,1},t.create=function(e,i,s,n,a,o,r,h,l){void 0===l&&(l=0);var c=t._cache._length?t._cache[--t._cache._length]:new t;c._ib=s,c._vb=i,c._numEle=n,c._shader=a,c._shaderValue=o;var d=e._nBlendType;switch(c._blendFn=e._targets?U.targetFns[d]:U.fns[d],l){case 0:c.offset=0,c.startIndex=h/(lt.BYTES_PE*i.vertexStride)*1.5,c.startIndex*=lt.BYTES_PIDX;break;case 1:c.startIndex=r,c.offset=h}return c},t._cache=(t._cache=[],t._cache._length=0,t._cache),t.tempMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t}(),st=function(){function t(){this.submitIndex=0,this.submitLength=0,this.context=null,this.clipRect=new w,this.screenRect=new w}n(t,"laya.webgl.submit.SubmitScissor");var e=t.prototype;return i.imps(e,{"laya.webgl.submit.ISubmit":!0}),e._scissor=function(t,e,i,s){var n=dt.worldMatrix4,a=n[0],o=n[5],r=n[12],h=n[13];if(t=t*a+r,e=e*o+h,i*=a,s*=o,1>i||1>s)return!1;var l=t+i,c=e+s;0>t&&(t=0,i=l-t),0>e&&(e=0,s=c-e);var d=dt.worldClipRect;if(t=Math.max(t,d.x),e=Math.max(e,d.y),i=Math.min(l,d.right)-t,s=Math.min(c,d.bottom)-e,1>i||1>s)return!1;var u=dt.worldScissorTest;return this.screenRect.copyFrom(d),d.x=t,d.y=e,d.width=i,d.height=s,dt.worldScissorTest=!0,e=dt.height-e-s,pt.mainContext.scissor(t,e,i,s),pt.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),u?(e=dt.height-this.screenRect.y-this.screenRect.height,pt.mainContext.scissor(this.screenRect.x,e,this.screenRect.width,this.screenRect.height),pt.mainContext.enable(3089)):(pt.mainContext.disable(3089),dt.worldScissorTest=!1),d.copyFrom(this.screenRect),!0},e._scissorWithTagart=function(t,e,i,s){if(1>i||1>s)return!1;var n=t+i,a=e+s;0>t&&(t=0,i=n-t),0>e&&(e=0,s=a-e);var o=dt.worldClipRect;if(t=Math.max(t,o.x),e=Math.max(e,o.y),i=Math.min(n,o.right)-t,s=Math.min(a,o.bottom)-e,1>i||1>s)return!1;var r=dt.worldScissorTest;return this.screenRect.copyFrom(o),dt.worldScissorTest=!0,o.x=t,o.y=e,o.width=i,o.height=s,e=dt.height-e-s,pt.mainContext.scissor(t,e,i,s),pt.mainContext.enable(3089),this.context.submitElement(this.submitIndex,this.submitIndex+this.submitLength),r?(e=dt.height-this.screenRect.y-this.screenRect.height,pt.mainContext.scissor(this.screenRect.x,e,this.screenRect.width,this.screenRect.height),pt.mainContext.enable(3089)):(pt.mainContext.disable(3089),dt.worldScissorTest=!1),o.copyFrom(this.screenRect),!0},e.renderSubmit=function(){return this.submitLength=Math.min(this.context._submits._length-1,this.submitLength),this.submitLength<1||this.clipRect.width<1||this.clipRect.height<1?this.submitLength+1:(this.context._targets?this._scissorWithTagart(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height):this._scissor(this.clipRect.x,this.clipRect.y,this.clipRect.width,this.clipRect.height),this.submitLength+1)},e.getRenderType=function(){return 0},e.releaseRender=function(){var e=t._cache;e[e._length++]=this,this.context=null},t.create=function(e){var i=t._cache._length?t._cache[--t._cache._length]:new t;return i.context=e,i},t._cache=(t._cache=[],t._cache._length=0,t._cache),t}(),nt=function(){function t(){this.step=0,this.blendMode=null,this.level=0}n(t,"laya.webgl.submit.SubmitStencil");var e=t.prototype;return i.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.renderSubmit=function(){switch(this.step){case 1:this.do1();break;case 2:this.do2();break;case 3:this.do3();break;case 4:this.do4();break;case 5:this.do5();break;case 6:this.do6()}return 1},e.getRenderType=function(){return 0},e.releaseRender=function(){var e=t._cache;e[e._length++]=this},e.do1=function(){var t=pt.mainContext;t.enable(2960),t.clear(1024),t.colorMask(!1,!1,!1,!1),t.stencilFunc(514,this.level,255),t.stencilOp(7680,7680,7682)},e.do2=function(){var t=pt.mainContext;t.stencilFunc(514,this.level+1,255),t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680)},e.do3=function(){var t=pt.mainContext;t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680),t.clear(1024),t.disable(2960)},e.do4=function(){var t=pt.mainContext;t.enable(2960),t.clear(1024),t.colorMask(!1,!1,!1,!1),t.stencilFunc(519,this.level,255),t.stencilOp(7680,7680,5386)},e.do5=function(){var t=pt.mainContext;t.stencilFunc(514,255,255),t.colorMask(!0,!0,!0,!0),t.stencilOp(7680,7680,7680)},e.do6=function(){var t=pt.mainContext;U.targetFns[U.TOINT[this.blendMode]](t)},t.create=function(e){var i=t._cache._length?t._cache[--t._cache._length]:new t;return i.step=e,i},t._cache=(t._cache=[],t._cache._length=0,t._cache),t}(),at=function(){function t(){this._renderType=0,this._vb=null,this._ib=null,this._startIdx=0,this._numEle=0,this.shaderValue=null,this.blendType=0,this.proName=null,this.scope=null}n(t,"laya.webgl.submit.SubmitTarget");var e=t.prototype;return i.imps(e,{"laya.webgl.submit.ISubmit":!0}),e.renderSubmit=function(){this._vb.bind_upload(this._ib);var t=this.scope.getValue(this.proName);return t&&(this.shaderValue.texture=t.source,this.shaderValue.strength&&!this.shaderValue.blurInfo&&(this.shaderValue.blurInfo=[t.width,t.height]),this.shaderValue.upload(),this.blend(),k.drawCall++,k.trianglesFaces+=this._numEle/3,pt.mainContext.drawElements(4,this._numEle,5123,this._startIdx)),1},e.blend=function(){if(U.activeBlendFunction!==U.fns[this.blendType]){var t=pt.mainContext;t.enable(3042),U.fns[this.blendType](t),U.activeBlendFunction=U.fns[this.blendType]}},e.getRenderType=function(){return 0},e.releaseRender=function(){var e=t._cache;e[e._length++]=this},t.create=function(e,i,s,n,a,o){var r=t._cache._length?t._cache[--t._cache._length]:new t;return r._ib=i,r._vb=s,r.proName=o,r._startIdx=n*lt.BYTES_PIDX,r._numEle=0,r.blendType=e._nBlendType,r.shaderValue=a,r.shaderValue.setValue(e._shader2D),r},t._cache=(t._cache=[],t._cache._length=0,t._cache),t}(),ot=function(){function t(){this._sourceStr=null}n(t,"laya.webgl.text.CharSegment");var e=t.prototype;return i.imps(e,{"laya.webgl.text.ICharSegment":!0}),e.textToSpit=function(t){this._sourceStr=t},e.getChar=function(t){return this._sourceStr.charAt(t)},e.getCharCode=function(t){return this._sourceStr.charCodeAt(t)},e.length=function(){return this._sourceStr.length},t}(),rt=function(){function t(){}var e;return n(t,"laya.webgl.text.DrawText"),t.__init__=function(){t._charsTemp=new Array,t._drawValue=new e,t._charSeg=new ot},t.customCharSeg=function(e){t._charSeg=e},t.getChar=function(e,i,s){return t._charsCache[i]=Ft.createOneChar(e,s)},t._drawSlow=function(e,i,s,n,a,o,r,h,l,c,d,u,p,_){var f,y,m=t._drawValue.value(o,h,l,c,p,_),g=0,v=0,C=t._charsTemp,w=0,x=NaN;if(n)for(C.length=n.length,g=0,v=n.length;v>g;g++)y=n[g],x=y.charNum+m.txtID,C[g]=f=t._charsCache[x]||t.getChar(y["char"],x,m),f.active();else{s instanceof laya.utils.WordText?t._charSeg.textToSpit(s.toString()):t._charSeg.textToSpit(s);var b=t._charSeg.length();for(C.length=b,g=0,v=b;v>g;g++)x=t._charSeg.getCharCode(g)+m.txtID,C[g]=f=t._charsCache[x]||t.getChar(t._charSeg.getChar(g),x,m),f.active(),w+=f.cw}var S=0;null!==r&&"left"!==r&&(S=-("center"==r?w/2:w));var I,T,L=NaN,k=0;if(n)for(g=0,v=C.length;v>g;g++)f=C[g],f.isSpace||(y=n[g],L=f.borderSize,I=f.texture,i._drawText(I,d+S+y.x*p-L,u+y.y*_-L,I.width,I.height,a,0,0,0,0));else{for(g=0,v=C.length;v>g;g++)f=C[g],f.isSpace||(L=f.borderSize,I=f.texture,i._drawText(I,d+S-L,u-L,I.width,I.height,a,0,0,0,0),e&&(T=e[k++],T||(T=e[k-1]=[]),T[0]=I,T[1]=S-L,T[2]=-L)),S+=f.cw;e&&(e.length=k)}},t._drawFast=function(t,e,i,s,n){for(var a,o,r=0,h=t.length;h>r;r++)o=t[r],a=o[0],a.active(),e._drawText(a,s+o[1],n+o[2],a.width,a.height,i,0,0,0,0)},t.drawText=function(e,s,n,a,o,r,h,l,c,d,p){if(!(s&&0===s.length||n&&0===n.length)){var _=a.a,f=a.d;(0!==a.b||0!==a.c)&&(_=f=1);var y=1!==_||1!==f;if(y&&i.stage.transform){var m=i.stage.transform;y=m.a===_&&m.d===f}else y=!1;if(y?(a=a.copyTo(yt._tmpMatrix),a.scale(1/_,1/f),a._checkTransform(),d*=_,p*=f):_=f=1,n)t._drawSlow(null,e,s,n,a,o,r,h,l,c,d,p,_,f);else{if(null===s.toUpperCase){var g=_+1e5*f,v=s;return void(v.changed||v.id!==g?(v.id=g,v.changed=!1,t._drawSlow(v.save,e,s,n,a,o,r,h,l,c,d,p,_,f)):t._drawFast(v.save,e,a,d,p))}var C=s+o.toString()+h+l+c+_+f+r,w=t._textsCache[C];w?t._drawFast(w,e,a,d,p):(t._textsCache.__length||(t._textsCache.__length=0),t._textsCache.__length>u.WebGLTextCacheCount&&(t._textsCache={},t._textsCache.__length=0,t._curPoolIndex=0),t._textCachesPool[t._curPoolIndex]?(w=t._textsCache[C]=t._textCachesPool[t._curPoolIndex],w.length=0):t._textCachesPool[t._curPoolIndex]=w=t._textsCache[C]=[],t._textsCache.__length++,t._curPoolIndex++,t._drawSlow(w,e,s,n,a,o,r,h,l,c,d,p,_,f))}}},t._charsTemp=null,t._textCachesPool=[],t._curPoolIndex=0,t._charsCache={},t._textsCache={},t._drawValue=null,t.d=[],t._charSeg=null,t.__init$=function(){e=function(){function t(){}n(t,"");var e=t.prototype;return e.value=function(e,i,s,n,a,o){this.font=e,this.fillColor=i,this.borderColor=s,this.lineWidth=n,this.scaleX=a,this.scaleY=o;var r=e.toString()+a+o+n+i+s;return this.txtID=t._keymap[r],this.txtID||(this.txtID=1e-7*++t._keymapCount,t._keymap[r]=this.txtID),this},t.clear=function(){t._keymap={},t._keymapCount=1},t._keymap={},t._keymapCount=1,t}()},t}(),ht=function(){function t(t){this._index=0,this._size=14,this._italic=-2,this.setFont(t||"14px Arial")}n(t,"laya.webgl.text.FontInContext");var e=t.prototype;return e.setFont=function(t){this._words=t.split(" ");for(var e=0,i=this._words.length;i>e;e++)if(this._words[e].indexOf("px")>0){this._index=e;break}this._size=parseInt(this._words[this._index]),this._text=null,this._italic=-2},e.getItalic=function(){return-2===this._italic&&(this._italic=this.hasType("italic")),this._italic},e.hasType=function(t){for(var e=0,i=this._words.length;i>e;e++)if(this._words[e]===t)return e;return-1},e.removeType=function(t){for(var e=0,i=this._words.length;i>e;e++)if(this._words[e]===t){this._words.splice(e,1),this._index>e&&this._index--;break}this._text=null,this._italic=-2},e.copyTo=function(t){return t._text=this._text,t._size=this._size,t._index=this._index,t._words=this._words.slice(),t._italic=-2,t},e.toString=function(){return this._text?this._text:this._text=this._words.join(" ")},a(0,e,"size",function(){return this._size},function(t){this._size=t,this._words[this._index]=t+"px",this._text=null}),t.create=function(e){var i=t._cache[e];return i?i:i=t._cache[e]=new t(e)},t.EMPTY=new t,t._cache={},t}(),lt=function(){function t(){}return n(t,"laya.webgl.utils.CONST3D2D"),t.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1],t.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0],t._TMPARRAY=[],t._OFFSETX=0,t._OFFSETY=0,s(t,["BYTES_PE",function(){return this.BYTES_PE=Float32Array.BYTES_PER_ELEMENT},"BYTES_PIDX",function(){return this.BYTES_PIDX=Uint16Array.BYTES_PER_ELEMENT}]),t}(),ct=function(){function t(){}return n(t,"laya.webgl.utils.GlUtils"),t.make2DProjection=function(t,e,i){return[2/t,0,0,0,0,-2/e,0,0,0,0,2/i,0,-1,1,0,1]},t.fillIBQuadrangle=function(t,e){if(e>65535/4)throw Error("IBQuadrangle count:"+e+" must<:"+Math.floor(65535/4));e=Math.floor(e),t._resizeBuffer(6*(e+1)*2,!1),t.byteLength=t.bufferLength;for(var i=t.getUint16Array(),s=0,n=0;e>n;n++)i[s++]=4*n,i[s++]=4*n+2,i[s++]=4*n+1,i[s++]=4*n,i[s++]=4*n+3,i[s++]=4*n+2;return t.setNeedUpload(),!0},t.expandIBQuadrangle=function(e,i){e.bufferLength>=6*i*2||t.fillIBQuadrangle(e,i)},t.mathCeilPowerOfTwo=function(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,t++,t},t.fillQuadrangleImgVb=function(t,e,i,s,n,a,o,r){"use strict";var h=(t._byteLength>>2)+16;t.byteLength=h<<2;var l=t.getFloat32Array();h-=16,l[h+2]=n[0],l[h+3]=n[1],l[h+6]=n[2],l[h+7]=n[3],l[h+10]=n[4],l[h+11]=n[5],l[h+14]=n[6],l[h+15]=n[7];var c=a.a,d=a.b,u=a.c,p=a.d;if(1!==c||0!==d||0!==u||1!==p){a.bTransform=!0;var _=a.tx+o,f=a.ty+r;l[h]=(s[0]+e)*c+(s[1]+i)*u+_,l[h+1]=(s[0]+e)*d+(s[1]+i)*p+f,l[h+4]=(s[2]+e)*c+(s[3]+i)*u+_,l[h+5]=(s[2]+e)*d+(s[3]+i)*p+f,l[h+8]=(s[4]+e)*c+(s[5]+i)*u+_,l[h+9]=(s[4]+e)*d+(s[5]+i)*p+f,l[h+12]=(s[6]+e)*c+(s[7]+i)*u+_,l[h+13]=(s[6]+e)*d+(s[7]+i)*p+f}else a.bTransform=!1,e+=a.tx+o,i+=a.ty+r,l[h]=e+s[0],l[h+1]=i+s[1],l[h+4]=e+s[2],l[h+5]=i+s[3],l[h+8]=e+s[4],l[h+9]=i+s[5],l[h+12]=e+s[6],l[h+13]=i+s[7];return t._upload=!0,!0},t.fillTranglesVB=function(t,e,i,s,n,a,o){"use strict";var r=(t._byteLength>>2)+s.length;t.byteLength=r<<2;var h=t.getFloat32Array();r-=s.length;for(var l=s.length,c=n.a,d=n.b,u=n.c,p=n.d,_=0;l>_;_+=4)if(h[r+_+2]=s[_+2],h[r+_+3]=s[_+3],1!==c||0!==d||0!==u||1!==p){n.bTransform=!0;var f=n.tx+a,y=n.ty+o;h[r+_]=(s[_]+e)*c+(s[_+1]+i)*u+f,h[r+_+1]=(s[_]+e)*d+(s[_+1]+i)*p+y}else n.bTransform=!1,e+=n.tx+a,i+=n.ty+o,h[r+_]=e+s[_],h[r+_+1]=i+s[_+1];return t._upload=!0,!0},t.copyPreImgVb=function(t,e,i){var s=t._byteLength>>2;t.byteLength=s+16<<2;for(var n=t.getFloat32Array(),a=0,o=s-16;4>a;a++)n[s]=n[o]+e,++s,++o,n[s]=n[o]+i,++s,++o,n[s]=n[o],++s,++o,n[s]=n[o],++s,++o;t._upload=!0},t.fillRectImgVb=function(t,e,i,s,n,a,o,r,h,l,c,d,u){void 0===u&&(u=!1);var p,_,f,y,m,g,v,C,w,x,b,S,I,T,L,k,E=1,D=r.a,A=r.b,B=r.c,P=r.d,M=e.width<99999999;if(1!==D||0!==A||0!==B||1!==P?(r.bTransform=!0,0===A&&0===B&&(E=23,w=n+i,x=a+s,b=r.tx+h,S=r.ty+l,p=D*i+b,f=D*w+b,_=P*s+S,y=P*x+S)):(E=23,r.bTransform=!1,p=i+r.tx+h,f=p+n,_=s+r.ty+l,y=_+a),M&&(m=e.x,g=e.y,v=e.width+m,C=e.height+g),1!==E&&(Math.min(p,f)>=v||Math.min(_,y)>=C||Math.max(f,p)<=m||Math.max(y,_)<=g))return!1;var R=t._byteLength>>2;t.byteLength=R+16<<2;var O=t.getFloat32Array();switch(O[R+2]=o[0],O[R+3]=o[1],O[R+6]=o[2],O[R+7]=o[3],O[R+10]=o[4],O[R+11]=o[5],O[R+14]=o[6],O[R+15]=o[7],E){case 1:b=r.tx+h,S=r.ty+l,w=n+i,x=a+s;var F=i,N=s,U=D*F,H=B*N,G=P*N,W=A*F,V=D*w,K=B*x,j=P*x,X=A*w;u?(I=U+H+b,L=Math.round(I)-I,T=G+W+S,k=Math.round(T)-T,O[R]=I+L,O[R+1]=T+k,O[R+4]=V+H+b+L,O[R+5]=G+X+S+k,O[R+8]=V+K+b+L,O[R+9]=j+X+S+k,O[R+12]=U+K+b+L,O[R+13]=j+W+S+k):(O[R]=U+H+b,O[R+1]=G+W+S,O[R+4]=V+H+b,O[R+5]=G+X+S,O[R+8]=V+K+b,O[R+9]=j+X+S,O[R+12]=U+K+b,O[R+13]=j+W+S);break;case 23:u?(I=p+c,L=Math.round(I)-I,T=_,k=Math.round(T)-T,O[R]=I+L,O[R+1]=T+k,O[R+4]=f+c+L,O[R+5]=_+k,O[R+8]=f+L,O[R+9]=y+k,O[R+12]=p+L,O[R+13]=y+k):(O[R]=p+c,O[R+1]=_,O[R+4]=f+c,O[R+5]=_,O[R+8]=f,O[R+9]=y,O[R+12]=p,O[R+13]=y)}return t._upload=!0,!0},t.fillLineVb=function(e,i,s,n,a,o,r,h){"use strict";var l=.5*r,c=t._fillLineArray,d=-(n-o),u=s-a,p=Math.sqrt(d*d+u*u);d/=p,u/=p,d*=l,u*=l,c[0]=s-d,c[1]=n-u,c[4]=s+d,c[5]=n+u,c[8]=a+d,c[9]=o+u,c[12]=a-d,c[13]=o-u,h&&h.transformPointArray(c,c);var _=(e._byteLength>>2)+16;return e.byteLength=_<<2,e.insertData(c,_-16),!0},t._fillLineArray=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t}(),dt=(function(){function t(){}return n(t,"laya.webgl.utils.MatirxArray"),t.ArrayMul=function(e,i,s){if(!e)return void t.copyArray(i,s);if(!i)return void t.copyArray(e,s);for(var n=NaN,a=NaN,o=NaN,r=NaN,h=0;4>h;h++)n=e[h],a=e[h+4],o=e[h+8],r=e[h+12],s[h]=n*i[0]+a*i[1]+o*i[2]+r*i[3],s[h+4]=n*i[4]+a*i[5]+o*i[6]+r*i[7],s[h+8]=n*i[8]+a*i[9]+o*i[10]+r*i[11],s[h+12]=n*i[12]+a*i[13]+o*i[14]+r*i[15]},t.copyArray=function(t,e){if(t&&e)for(var i=0;i<t.length;i++)e[i]=t[i]},t}(),function(){function t(){}return n(t,"laya.webgl.utils.RenderState2D"),t.getMatrArray=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},t.mat2MatArray=function(t,e){var i=t,s=e;return s[0]=i.a,s[1]=i.b,s[4]=i.c,s[5]=i.d,s[12]=i.tx,s[13]=i.ty,e},t.restoreTempArray=function(){t.TEMPMAT4_ARRAY[0]=1,t.TEMPMAT4_ARRAY[1]=0,t.TEMPMAT4_ARRAY[4]=0,t.TEMPMAT4_ARRAY[5]=1,t.TEMPMAT4_ARRAY[12]=0,t.TEMPMAT4_ARRAY[13]=0},t.clear=function(){t.worldScissorTest=!1,t.worldShaderDefines=null,t.worldFilters=null,t.worldAlpha=1,t.worldClipRect.x=t.worldClipRect.y=0,t.worldClipRect.width=t.width,t.worldClipRect.height=t.height,t.curRenderTarget=null},t._MAXSIZE=99999999,t.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.worldMatrix4=t.TEMPMAT4_ARRAY,t.worldAlpha=1,t.worldScissorTest=!1,t.worldFilters=null,t.worldShaderDefines=null,t.worldClipRect=new w(0,0,99999999,99999999),t.curRenderTarget=null,t.width=0,t.height=0,s(t,["worldMatrix",function(){return this.worldMatrix=new v}]),t}()),ut=function(){function t(t,i,s,n,a){function o(t){for(var e=t.split(" "),i=[],s=0;s<e.length;s++)e[s].length>0&&i.push(e[s]);return i}function r(t){var i,s,n=0,r=0,h=0,l=new e(0,null,null,null),c=l,d=t.split("\n");for(n=0,r=d.length;r>n;n++){var u=d[n];if(u.indexOf("#ifdef")>=0)i=o(u),c=new e(1,i[1],"",c);else if(u.indexOf("#else")>=0)s=c.condition,c=new e(2,null,"",c.parent),c.condition=s;else if(u.indexOf("#endif")>=0)c=c.parent;else if(u.indexOf("#include")>=0){i=o(u);var p=i[1],_=p.charAt(0);'"'!==_&&"'"!==_||(p=p.substr(1,p.length-2),h=p.lastIndexOf(_),h>0&&(p=p.substr(0,h))),h=i[0].indexOf("?");var f=h>0?i[0].substr(h+1):i[0];new e(1,f,a[p],c)}else c.childs.length>0&&0===c.childs[c.childs.length-1].type?c.childs[c.childs.length-1].text+="\n"+u:new e(0,null,u,c)}return l}this._VSTXT=i,this._PSTXT=s,this._VS=r(i),this._PS=r(s),this._nameMap=n}var e;n(t,"laya.webgl.utils.ShaderCompile");var i=t.prototype;return i.createShader=function(t,e,i){var s={},n="";if(t)for(var a in t)n+="#define "+a+"\n",s[a]=!0;var o=this._VS.toscript(s,[]),r=this._PS.toscript(s,[]);return(i||Ht.create)(n+o.join("\n"),n+r.join("\n"),e,this._nameMap)},t.IFDEF_NO=0,t.IFDEF_YES=1,t.IFDEF_ELSE=2,t.__init$=function(){e=function(){function t(t,e,i,s){if(this.childs=new Array,this.type=t,this.text=i,this.parent=s,s&&s.childs.push(this),e){var n="";this.testcondition="";for(var a=!1,o=!1,r=0,h=e.length;h>r;r++){var l=e.charAt(r);o="!&|() 	".indexOf(l)<0,a!=o&&(o&&(n+="this."),a=o),n+=l,this.testcondition+=l}}}n(t,"");var e=t.prototype;return e.toscript=function(t,e){if(0===this.type&&this.text&&e.push(this.text),this.childs.length<1&&!this.text)return e;if(0!==this.type){var i=!!function(t,e){return t[e]}(t,this.testcondition);if(2===this.type&&(i=!i),!i)return e;this.text&&e.push(this.text)}return this.childs.length>0&&this.childs.forEach(function(i,s,n){i.toscript(t,e)}),e},t}()},t}(),pt=function(){
function e(){}return n(e,"laya.webgl.WebGL"),e._uint8ArraySlice=function(){for(var t=this,e=t.length,i=new Uint8Array(t.length),s=0;e>s;s++)i[s]=t[s];return i},e._float32ArraySlice=function(){for(var t=this,e=t.length,i=new Float32Array(t.length),s=0;e>s;s++)i[s]=t[s];return i},e._uint16ArraySlice=function(t){var e,i=arguments,s=this,n=0,a=0;if(0===i.length)for(n=s.length,e=new Uint16Array(n),a=0;n>a;a++)e[a]=s[a];else if(2===i.length){var o=i[0],r=i[1];if(r>o)for(n=r-o,e=new Uint16Array(n),a=o;r>a;a++)e[a-o]=s[a];else e=new Uint16Array(0)}return e},e.expandContext=function(){var t=p.prototype,e=canvas.getContext("webgl");e.fillTrangles=t.fillTrangles,Gt.__int__(null),e.setIBVB=function(t,e,i,s,n,a,o,r,h,l){void 0===h&&(h=0),void 0===l&&(l=0),null===i&&(this._ib=this._ib||Kt.QuadrangleIB,i=this._ib,ct.expandIBQuadrangle(i,s.byteLength/64+8)),this._setIBVB(t,e,i,s,n,a,o,r,h,l)},e.fillTrangles=function(t,e,i,s,n){this._curMat=this._curMat||v.create(),this._vb=this._vb||jt.create(),this._ib||(this._ib=Kt.create(),ct.fillIBQuadrangle(this._ib,o/4));var a=this._vb,o=s.length>>4;ct.fillTranglesVB(a,e,i,s,n||this._curMat,0,0),ct.expandIBQuadrangle(this._ib,a.byteLength/64+8);var r=new mt(1,0);r.textureHost=t;var h=new Vt("attribute vec2 position; attribute vec2 texcoord; uniform vec2 size; uniform mat4 mmat; varying vec2 v_texcoord; void main() { vec4 p=vec4(position.xy,0.0,1.0);vec4 pos=mmat*p; gl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0); v_texcoord = texcoord; }","precision mediump float; varying vec2 v_texcoord; uniform sampler2D texture; void main() {vec4 color= texture2D(texture, v_texcoord); color.a*=1.0; gl_FragColor= color;}");a._vertType=3,this._setIBVB(e,i,this._ib,a,6*o,n,h,r,0,0)}},e.enable=function(){if(console.log("webgl enable!"),c.__init__(),x.isConchApp&&!x.isConchWebGL)return T.skinAniSprite=function(){var t=new J;return t},e.expandContext(),!1;if(T.getWebGLContext=function(t){for(var i,s=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=0;n<s.length;n++){try{i=t.getContext(s[n],{stencil:u.isStencil,alpha:u.isAlpha,antialias:u.isAntialias,premultipliedAlpha:u.premultipliedAlpha,preserveDrawingBuffer:!0})}catch(a){}if(i)return 0!==n&&(e._isExperimentalWebgl=!0),console.log("getWebGLGontext succ! "+s[n]),i}return null},e.mainContext=T.getWebGLContext(x._mainCanvas),null==e.mainContext)return!1;if(x.isWebGL)return!0;m.create=function(e,s){return t.WXAPP&&(e=t.replacePath(e,i.URL.basePath)),new Xt(e,s)},g.create=function(t,e,i,s,n,a,o){return new Ut(t,e,i,s,n,a,o)},x.WebGL=e,x.isWebGL=!0,console.log("Render.isWebGL="+x.isWebGL),rt.__init__(),T.createRenderSprite=function(t,e){return new gt(t,e)},T.createWebGLContext2D=function(t){return new yt(t)},T.changeWebGLSize=function(t,e){laya.webgl.WebGL.onStageResize(t,e)},T.createGraphics=function(){return new ft};var s=T.createFilterAction;return T.createFilterAction=s?s:function(t){return new vt},T.clear=function(t){dt.worldScissorTest&&laya.webgl.WebGL.mainContext.disable(3089);var e=x.context.ctx,s=0==e._submits._length||u.preserveDrawingBuffer?d.create(t)._color:i.stage._wgColor;s&&e.clearBG(s[0],s[1],s[2],s[3]),c.onWXAPP&&e.clearBG(0,0,0,1),dt.clear()},T.addToAtlas=function(t,e){void 0===e&&(e=!1);var s=t.bitmap;return x.optimizeTextureMemory(t.url,t)?void(i.__typeof(s,"laya.webgl.resource.IMergeAtlasBitmap")&&s.allowMerageInAtlas&&s.on("recovered",t,t.addTextureToAtlas)):void(s.enableMerageInAtlas=!1)},F._enable(),T.beginFlush=function(){for(var t=F.instance,e=t.getAtlaserCount(),i=0;e>i;i++){var s=t.getAtlaserByIndex(i).texture;s._flashCacheImageNeedFlush&&T.flashFlushImage(s)}},T.drawToCanvas=function(t,e,i,s,n,a){n-=t.x,a-=t.y;var o=new kt(i,s,6408,5121,0,!1);o.start(),x.context.clear(),t.render(x.context,n,dt.height-s+a),x.context.flush(),o.end();var r=o.getData(0,0,o.width,o.height);o.dispose();var h=new Ot;h._canvas=c.createElement("canvas"),h.size(i,s);var l=h._canvas.getContext("2d");c.canvas.size(i,s);var d=c.context,u=d.createImageData(i,s);return u.data.set(new Uint8ClampedArray(r.buffer)),d.putImageData(u,0,0),l.save(),l.translate(0,s),l.scale(1,-1),l.drawImage(c.canvas.source,0,0),l.restore(),h},T.createFilterAction=function(t){var e;switch(t){case 32:e=new vt}return e},T.addTextureToAtlas=function(t){t._uvID++,F._atlasRestore++,t.bitmap.enableMerageInAtlas&&F.instance.addToAtlas(t)},T.getTexturePixels=function(t,e,i,s,n){x.context.ctx.clear();var a=new L;a.graphics.drawTexture(t,-e,-i);var o=kt.create(s,n);o.start(),o.clear(0,0,0,0),a.render(x.context,0,0),x.context.ctx.flush(),o.end();for(var r=o.getData(0,0,s,n),h=[],l=0,c=n-1;c>=0;c--)for(var d=0;s>d;d++)l=4*(c*s+d),h.push(r[l]),h.push(r[l+1]),h.push(r[l+2]),h.push(r[l+3]);return h},T.skinAniSprite=function(){var t=new J;return t},_._filterStart=function(t,e,i,s,n){var a=t.getValue("bounds"),o=kt.create(a.width,a.height);if(o.start(),o.clear(0,0,0,0),t.addValue("src",o),t.addValue("ScissorTest",dt.worldScissorTest),dt.worldScissorTest){var r=new w;r.copyFrom(i.ctx._clipRect),t.addValue("clipRect",r),dt.worldScissorTest=!1,laya.webgl.WebGL.mainContext.disable(3089)}},_._filterEnd=function(t,e,i,s,n){var a=t.getValue("bounds"),o=t.getValue("src");o.end();var r=kt.create(a.width,a.height);r.start(),r.clear(0,0,0,0),t.addValue("out",r),e._set$P("_filterCache",r),e._set$P("_isHaveGlowFilter",t.getValue("_isHaveGlowFilter"))},_._EndTarget=function(t,e){var i=t.getValue("src");i.recycle();var s=t.getValue("out");s.end();var n=t.getValue("ScissorTest");if(n){dt.worldScissorTest=!0,laya.webgl.WebGL.mainContext.enable(3089),e.ctx.save();var a=t.getValue("clipRect");e.ctx.clipRect(a.x,a.y,a.width,a.height)}},_._useSrc=function(t){var e=t.getValue("out");e.end(),e=t.getValue("src"),e.start(),e.clear(0,0,0,0)},_._endSrc=function(t){var e=t.getValue("src");e.end()},_._useOut=function(t){var e=t.getValue("src");e.end(),e=t.getValue("out"),e.start(),e.clear(0,0,0,0)},_._endOut=function(t){var e=t.getValue("out");e.end()},_._recycleScope=function(t){t.recycle()},_._filter=function(t,e,i,s){var n=this._next;if(n){var a=t.filters,o=a.length;if(1==o&&32==a[0].type)return e.ctx.save(),e.ctx.setFilters([a[0]]),n._fun.call(n,t,e,i,s),void e.ctx.restore();var r,h,l=et.create(),c=C.TEMP,d=e.ctx._getTransformMatrix(),u=v.create();d.copyTo(u);var p=0,f=0,y=!1,m=t._$P._filterCache?t._$P._filterCache:null;if(!m||t._repaint){y=t._isHaveGlowFilter(),l.addValue("_isHaveGlowFilter",y),y&&(p=50,f=25),h=new w,h.copyFrom(t.getSelfBounds()),h.x+=t.x,h.y+=t.y,h.x-=t.pivotX+4,h.y-=t.pivotY+4;var g=h.x,x=h.y;if(h.width+=p+8,h.height+=p+8,c.x=h.x*u.a+h.y*u.c,c.y=h.y*u.d+h.x*u.b,h.x=c.x,h.y=c.y,c.x=h.width*u.a+h.height*u.c,c.y=h.height*u.d+h.width*u.b,h.width=c.x,h.height=c.y,h.width<=0||h.height<=0)return;m&&m.recycle(),l.addValue("bounds",h);var b=tt.create([l,t,e,0,0],_._filterStart);e.addRenderObject(b),e.ctx._renderKey=0,e.ctx._shader2D.glTexture=null;var S=t.x-g+f,I=t.y-x+f;n._fun.call(n,t,e,S,I),b=tt.create([l,t,e,0,0],_._filterEnd),e.addRenderObject(b);for(var T=0;o>T;T++){0!=T&&(b=tt.create([l],_._useSrc),e.addRenderObject(b),r=mt.create(1,0),v.TEMP.identity(),e.ctx.drawTarget(l,0,0,h.width,h.height,v.TEMP,"out",r,null,U.TOINT.overlay),b=tt.create([l],_._useOut),e.addRenderObject(b));var L=a[T];L.action.apply3d(l,t,e,0,0)}b=tt.create([l,e],_._EndTarget),e.addRenderObject(b)}else{if(y=t._$P._isHaveGlowFilter?t._$P._isHaveGlowFilter:!1,y&&(p=50,f=25),h=t.getBounds(),h.width<=0||h.height<=0)return;h.width+=p,h.height+=p,c.x=h.x*u.a+h.y*u.c,c.y=h.y*u.d+h.x*u.b,h.x=c.x,h.y=c.y,c.x=h.width*u.a+h.height*u.c,c.y=h.height*u.d+h.width*u.b,h.width=c.x,h.height=c.y,l.addValue("out",m)}i=i-f-t.x,s=s-f-t.y,c.setTo(i,s),u.transformPoint(c),i=c.x+h.x,s=c.y+h.y,r=mt.create(1,0),v.TEMP.identity(),e.ctx.drawTarget(l,i,s,h.width,h.height,v.TEMP,"out",r,null,U.TOINT.overlay),b=tt.create([l],_._recycleScope),e.addRenderObject(b),u.destroy()}},Float32Array.prototype.slice||(Float32Array.prototype.slice=e._float32ArraySlice),Uint16Array.prototype.slice||(Uint16Array.prototype.slice=e._uint16ArraySlice),Uint8Array.prototype.slice||(Uint8Array.prototype.slice=e._uint8ArraySlice),!0},e.onStageResize=function(t,i){null!=e.mainContext&&(e.mainContext.viewport(0,0,t,i),dt.width=t,dt.height=i)},e.isExperimentalWebgl=function(){return e._isExperimentalWebgl},e.addRenderFinish=function(){(e._isExperimentalWebgl||x.isFlash)&&(T.endFinish=function(){x.context.ctx.finish()})},e.removeRenderFinish=function(){e._isExperimentalWebgl&&(T.endFinish=function(){})},e.onInvalidGLRes=function(){F.instance.freeAll(),I.releaseContentManagers(!0),e.doNodeRepaint(i.stage),e.mainContext.viewport(0,0,dt.width,dt.height),i.stage.event("devicelost")},e.doNodeRepaint=function(t){0==t.numChildren&&t.repaint();for(var i=0;i<t.numChildren;i++)e.doNodeRepaint(t.getChildAt(i))},e.init=function(t,i,s){e.mainCanvas=t,y._createContext=function(t){return new yt(t)},e._isExperimentalWebgl=e._isExperimentalWebgl&&(c.onWeiXin||c.onMQQBrowser),e.frameShaderHighPrecision=!1;var n=laya.webgl.WebGL.mainContext;try{var a=n.getShaderPrecisionFormat(35632,36338);a.precision?e.frameShaderHighPrecision=!0:e.frameShaderHighPrecision=!1}catch(o){}if(n.deleteTexture1=n.deleteTexture,n.deleteTexture=function(t){t==_t.curBindTexValue&&(_t.curBindTexValue=null),n.deleteTexture1(t)},e.onStageResize(i,s),null==e.mainContext)throw new Error("webGL getContext err!");D.__init__(),F.__init__(),wt.__init__(),Z.__init__(),yt.__init__(),mt.__init__(),q.__init__(),Gt.__int__(n),U._init_(n),x.isConchApp&&conch.setOnInvalidGLRes(e.onInvalidGLRes)},e.mainCanvas=null,e.mainContext=null,e.antialias=!0,e.frameShaderHighPrecision=!1,e._bg_null=[0,0,0,0],e._isExperimentalWebgl=!1,e}(),_t=function(){function t(){}return n(t,"laya.webgl.WebGLContext"),t.UseProgram=function(e){return t._useProgram===e?!1:(pt.mainContext.useProgram(e),t._useProgram=e,!0)},t.setDepthTest=function(e,i){i!==t._depthTest&&(t._depthTest=i,i?e.enable(2929):e.disable(2929))},t.setDepthMask=function(e,i){i!==t._depthMask&&(t._depthMask=i,e.depthMask(i))},t.setDepthFunc=function(e,i){i!==t._depthFunc&&(t._depthFunc=i,e.depthFunc(i))},t.setBlend=function(e,i){i!==t._blend&&(t._blend=i,i?e.enable(3042):e.disable(3042))},t.setBlendFunc=function(e,i,s){(i!==t._sFactor||s!==t._dFactor)&&(t._sFactor=i,t._dFactor=s,e.blendFunc(i,s))},t.setCullFace=function(e,i){i!==t._cullFace&&(t._cullFace=i,i?e.enable(2884):e.disable(2884))},t.setFrontFace=function(e,i){i!==t._frontFace&&(t._frontFace=i,e.frontFace(i))},t.bindTexture=function(e,i,s){e.bindTexture(i,s),t.curBindTexTarget=i,t.curBindTexValue=s},t.DEPTH_BUFFER_BIT=256,t.STENCIL_BUFFER_BIT=1024,t.COLOR_BUFFER_BIT=16384,t.POINTS=0,t.LINES=1,t.LINE_LOOP=2,t.LINE_STRIP=3,t.TRIANGLES=4,t.TRIANGLE_STRIP=5,t.TRIANGLE_FAN=6,t.ZERO=0,t.ONE=1,t.SRC_COLOR=768,t.ONE_MINUS_SRC_COLOR=769,t.SRC_ALPHA=770,t.ONE_MINUS_SRC_ALPHA=771,t.DST_ALPHA=772,t.ONE_MINUS_DST_ALPHA=773,t.DST_COLOR=774,t.ONE_MINUS_DST_COLOR=775,t.SRC_ALPHA_SATURATE=776,t.FUNC_ADD=32774,t.BLEND_EQUATION=32777,t.BLEND_EQUATION_RGB=32777,t.BLEND_EQUATION_ALPHA=34877,t.FUNC_SUBTRACT=32778,t.FUNC_REVERSE_SUBTRACT=32779,t.BLEND_DST_RGB=32968,t.BLEND_SRC_RGB=32969,t.BLEND_DST_ALPHA=32970,t.BLEND_SRC_ALPHA=32971,t.CONSTANT_COLOR=32769,t.ONE_MINUS_CONSTANT_COLOR=32770,t.CONSTANT_ALPHA=32771,t.ONE_MINUS_CONSTANT_ALPHA=32772,t.BLEND_COLOR=32773,t.ARRAY_BUFFER=34962,t.ELEMENT_ARRAY_BUFFER=34963,t.ARRAY_BUFFER_BINDING=34964,t.ELEMENT_ARRAY_BUFFER_BINDING=34965,t.STREAM_DRAW=35040,t.STATIC_DRAW=35044,t.DYNAMIC_DRAW=35048,t.BUFFER_SIZE=34660,t.BUFFER_USAGE=34661,t.CURRENT_VERTEX_ATTRIB=34342,t.FRONT=1028,t.BACK=1029,t.CULL_FACE=2884,t.FRONT_AND_BACK=1032,t.BLEND=3042,t.DITHER=3024,t.STENCIL_TEST=2960,t.DEPTH_TEST=2929,t.SCISSOR_TEST=3089,t.POLYGON_OFFSET_FILL=32823,t.SAMPLE_ALPHA_TO_COVERAGE=32926,t.SAMPLE_COVERAGE=32928,t.NO_ERROR=0,t.INVALID_ENUM=1280,t.INVALID_VALUE=1281,t.INVALID_OPERATION=1282,t.OUT_OF_MEMORY=1285,t.CW=2304,t.CCW=2305,t.LINE_WIDTH=2849,t.ALIASED_POINT_SIZE_RANGE=33901,t.ALIASED_LINE_WIDTH_RANGE=33902,t.CULL_FACE_MODE=2885,t.FRONT_FACE=2886,t.DEPTH_RANGE=2928,t.DEPTH_WRITEMASK=2930,t.DEPTH_CLEAR_VALUE=2931,t.DEPTH_FUNC=2932,t.STENCIL_CLEAR_VALUE=2961,t.STENCIL_FUNC=2962,t.STENCIL_FAIL=2964,t.STENCIL_PASS_DEPTH_FAIL=2965,t.STENCIL_PASS_DEPTH_PASS=2966,t.STENCIL_REF=2967,t.STENCIL_VALUE_MASK=2963,t.STENCIL_WRITEMASK=2968,t.STENCIL_BACK_FUNC=34816,t.STENCIL_BACK_FAIL=34817,t.STENCIL_BACK_PASS_DEPTH_FAIL=34818,t.STENCIL_BACK_PASS_DEPTH_PASS=34819,t.STENCIL_BACK_REF=36003,t.STENCIL_BACK_VALUE_MASK=36004,t.STENCIL_BACK_WRITEMASK=36005,t.VIEWPORT=2978,t.SCISSOR_BOX=3088,t.COLOR_CLEAR_VALUE=3106,t.COLOR_WRITEMASK=3107,t.UNPACK_ALIGNMENT=3317,t.PACK_ALIGNMENT=3333,t.MAX_TEXTURE_SIZE=3379,t.MAX_VIEWPORT_DIMS=3386,t.SUBPIXEL_BITS=3408,t.RED_BITS=3410,t.GREEN_BITS=3411,t.BLUE_BITS=3412,t.ALPHA_BITS=3413,t.DEPTH_BITS=3414,t.STENCIL_BITS=3415,t.POLYGON_OFFSET_UNITS=10752,t.POLYGON_OFFSET_FACTOR=32824,t.TEXTURE_BINDING_2D=32873,t.SAMPLE_BUFFERS=32936,t.SAMPLES=32937,t.SAMPLE_COVERAGE_VALUE=32938,t.SAMPLE_COVERAGE_INVERT=32939,t.NUM_COMPRESSED_TEXTURE_FORMATS=34466,t.COMPRESSED_TEXTURE_FORMATS=34467,t.DONT_CARE=4352,t.FASTEST=4353,t.NICEST=4354,t.GENERATE_MIPMAP_HINT=33170,t.BYTE=5120,t.UNSIGNED_BYTE=5121,t.SHORT=5122,t.UNSIGNED_SHORT=5123,t.INT=5124,t.UNSIGNED_INT=5125,t.FLOAT=5126,t.DEPTH_COMPONENT=6402,t.ALPHA=6406,t.RGB=6407,t.RGBA=6408,t.LUMINANCE=6409,t.LUMINANCE_ALPHA=6410,t.UNSIGNED_SHORT_4_4_4_4=32819,t.UNSIGNED_SHORT_5_5_5_1=32820,t.UNSIGNED_SHORT_5_6_5=33635,t.FRAGMENT_SHADER=35632,t.VERTEX_SHADER=35633,t.MAX_VERTEX_ATTRIBS=34921,t.MAX_VERTEX_UNIFORM_VECTORS=36347,t.MAX_VARYING_VECTORS=36348,t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661,t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660,t.MAX_TEXTURE_IMAGE_UNITS=34930,t.MAX_FRAGMENT_UNIFORM_VECTORS=36349,t.SHADER_TYPE=35663,t.DELETE_STATUS=35712,t.LINK_STATUS=35714,t.VALIDATE_STATUS=35715,t.ATTACHED_SHADERS=35717,t.ACTIVE_UNIFORMS=35718,t.ACTIVE_ATTRIBUTES=35721,t.SHADING_LANGUAGE_VERSION=35724,t.CURRENT_PROGRAM=35725,t.NEVER=512,t.LESS=513,t.EQUAL=514,t.LEQUAL=515,t.GREATER=516,t.NOTEQUAL=517,t.GEQUAL=518,t.ALWAYS=519,t.KEEP=7680,t.REPLACE=7681,t.INCR=7682,t.DECR=7683,t.INVERT=5386,t.INCR_WRAP=34055,t.DECR_WRAP=34056,t.VENDOR=7936,t.RENDERER=7937,t.VERSION=7938,t.NEAREST=9728,t.LINEAR=9729,t.NEAREST_MIPMAP_NEAREST=9984,t.LINEAR_MIPMAP_NEAREST=9985,t.NEAREST_MIPMAP_LINEAR=9986,t.LINEAR_MIPMAP_LINEAR=9987,t.TEXTURE_MAG_FILTER=10240,t.TEXTURE_MIN_FILTER=10241,t.TEXTURE_WRAP_S=10242,t.TEXTURE_WRAP_T=10243,t.TEXTURE_2D=3553,t.TEXTURE=5890,t.TEXTURE_CUBE_MAP=34067,t.TEXTURE_BINDING_CUBE_MAP=34068,t.TEXTURE_CUBE_MAP_POSITIVE_X=34069,t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070,t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071,t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072,t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073,t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074,t.MAX_CUBE_MAP_TEXTURE_SIZE=34076,t.TEXTURE0=33984,t.TEXTURE1=33985,t.TEXTURE2=33986,t.TEXTURE3=33987,t.TEXTURE4=33988,t.TEXTURE5=33989,t.TEXTURE6=33990,t.TEXTURE7=33991,t.TEXTURE8=33992,t.TEXTURE9=33993,t.TEXTURE10=33994,t.TEXTURE11=33995,t.TEXTURE12=33996,t.TEXTURE13=33997,t.TEXTURE14=33998,t.TEXTURE15=33999,t.TEXTURE16=34e3,t.TEXTURE17=34001,t.TEXTURE18=34002,t.TEXTURE19=34003,t.TEXTURE20=34004,t.TEXTURE21=34005,t.TEXTURE22=34006,t.TEXTURE23=34007,t.TEXTURE24=34008,t.TEXTURE25=34009,t.TEXTURE26=34010,t.TEXTURE27=34011,t.TEXTURE28=34012,t.TEXTURE29=34013,t.TEXTURE30=34014,t.TEXTURE31=34015,t.ACTIVE_TEXTURE=34016,t.REPEAT=10497,t.CLAMP_TO_EDGE=33071,t.MIRRORED_REPEAT=33648,t.FLOAT_VEC2=35664,t.FLOAT_VEC3=35665,t.FLOAT_VEC4=35666,t.INT_VEC2=35667,t.INT_VEC3=35668,t.INT_VEC4=35669,t.BOOL=35670,t.BOOL_VEC2=35671,t.BOOL_VEC3=35672,t.BOOL_VEC4=35673,t.FLOAT_MAT2=35674,t.FLOAT_MAT3=35675,t.FLOAT_MAT4=35676,t.SAMPLER_2D=35678,t.SAMPLER_CUBE=35680,t.VERTEX_ATTRIB_ARRAY_ENABLED=34338,t.VERTEX_ATTRIB_ARRAY_SIZE=34339,t.VERTEX_ATTRIB_ARRAY_STRIDE=34340,t.VERTEX_ATTRIB_ARRAY_TYPE=34341,t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922,t.VERTEX_ATTRIB_ARRAY_POINTER=34373,t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975,t.COMPILE_STATUS=35713,t.LOW_FLOAT=36336,t.MEDIUM_FLOAT=36337,t.HIGH_FLOAT=36338,t.LOW_INT=36339,t.MEDIUM_INT=36340,t.HIGH_INT=36341,t.FRAMEBUFFER=36160,t.RENDERBUFFER=36161,t.RGBA4=32854,t.RGB5_A1=32855,t.RGB565=36194,t.DEPTH_COMPONENT16=33189,t.STENCIL_INDEX=6401,t.STENCIL_INDEX8=36168,t.DEPTH_STENCIL=34041,t.RENDERBUFFER_WIDTH=36162,t.RENDERBUFFER_HEIGHT=36163,t.RENDERBUFFER_INTERNAL_FORMAT=36164,t.RENDERBUFFER_RED_SIZE=36176,t.RENDERBUFFER_GREEN_SIZE=36177,t.RENDERBUFFER_BLUE_SIZE=36178,t.RENDERBUFFER_ALPHA_SIZE=36179,t.RENDERBUFFER_DEPTH_SIZE=36180,t.RENDERBUFFER_STENCIL_SIZE=36181,t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048,t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049,t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050,t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051,t.COLOR_ATTACHMENT0=36064,t.DEPTH_ATTACHMENT=36096,t.STENCIL_ATTACHMENT=36128,t.DEPTH_STENCIL_ATTACHMENT=33306,t.NONE=0,t.FRAMEBUFFER_COMPLETE=36053,t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054,t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055,t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057,t.FRAMEBUFFER_UNSUPPORTED=36061,t.FRAMEBUFFER_BINDING=36006,t.RENDERBUFFER_BINDING=36007,t.MAX_RENDERBUFFER_SIZE=34024,t.INVALID_FRAMEBUFFER_OPERATION=1286,t.UNPACK_FLIP_Y_WEBGL=37440,t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441,t.CONTEXT_LOST_WEBGL=37442,t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443,t.BROWSER_DEFAULT_WEBGL=37444,t._useProgram=null,t._depthTest=!0,t._depthMask=!0,t._blend=!1,t._cullFace=!1,t.curBindTexTarget=null,t.curBindTexValue=null,s(t,["_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_frontFace",function(){return this._frontFace=2305}]),t}(),ft=function(t){function e(){e.__super.call(this)}n(e,"laya.webgl.display.GraphicsGL",t);var i=e.prototype;return i.setShader=function(t){this._saveToCmd(x.context._setShader,[t])},i.setIBVB=function(t,e,i,s,n,a){this._saveToCmd(x.context._setIBVB,[t,e,i,s,n,a])},i.drawParticle=function(t,e,i){var s=T.createParticleTemplate2D(i);s.x=t,s.y=e,this._saveToCmd(x.context._drawParticle,[s])},e}(f),yt=function(t){function e(t){this._x=0,this._y=0,this._id=++e._COUNT,this._path=null,this._drawCount=1,this._maxNumEle=0,this._clear=!1,this._isMain=!1,this._atlasResourceChange=0,this._submits=[],this._curSubmit=null,this._ib=null,this._vb=null,this._nBlendType=0,this._saveMark=null,this.mId=-1,this.mHaveKey=!1,this.mHaveLineKey=!1,this.mX=0,this.mY=0,e.__super.call(this),this._width=99999999,this._height=99999999,this._clipRect=e.MAXCLIPRECT,this._shader2D=new q,this.mOutPoint,this._canvas=t,this._curMat=v.create(),x.isFlash?(this._ib=Kt.create(35044),ct.fillIBQuadrangle(this._ib,16)):this._ib=Kt.QuadrangleIB,this._vb=jt.create(-1),this._other=o.DEFAULT,this._save=[K.Create(this)],this._save.length=10,this.clear()}var o;n(e,"laya.webgl.canvas.WebGLContext2D",t);var r=e.prototype;return r.setIsMainContext=function(){this._isMain=!0},r.clearBG=function(t,e,i,s){var n=pt.mainContext;n.clearColor(t,e,i,s),n.clear(16384)},r._getSubmits=function(){return this._submits},r.destroy=function(){this._curMat&&this._curMat.destroy(),this._targets&&this._targets.destroy(),this._vb&&this._vb.releaseResource(),this._ib&&this._ib!=Kt.QuadrangleIB&&this._ib.releaseResource()},r.clear=function(){this._vb.clear(),this._targets&&(this._targets.repaint=!0),this._other=o.DEFAULT,this._clear=!0,this._repaint=!1,this._drawCount=1,this._renderKey=0,this._other.lineWidth=this._shader2D.ALPHA=1,this._nBlendType=0,this._clipRect=e.MAXCLIPRECT,this._curSubmit=Z.RENDERBASE,this._shader2D.glTexture=null,this._shader2D.fillStyle=this._shader2D.strokeStyle=H.DEFAULT;for(var t=0,i=this._submits._length;i>t;t++)this._submits[t].releaseRender();this._submits._length=0,this._curMat.identity(),this._other.clear(),this._saveMark=this._save[0],this._save._length=1},r.size=function(t,e){this._width=t,this._height=e,this._targets&&this._targets.size(t,e),this._canvas.memorySize-=this._canvas.memorySize},r._getTransformMatrix=function(){return this._curMat},r.translate=function(t,e){0===t&&0===e||(X.save(this),this._curMat.bTransform&&(j.save(this),this._curMat.transformPointN(C.TEMP.setTo(t,e)),t=C.TEMP.x,e=C.TEMP.y),this._x+=t,this._y+=e)},r.save=function(){this._save[this._save._length++]=K.Create(this)},r.restore=function(){var t=this._save._length;if(!(1>t))for(var e=t-1;e>=0;e--){var i=this._save[e];if(i.restore(this),i.isSaveMark())return void(this._save._length=e)}},r._fillText=function(t,e,i,s,n,a,o,r,h){var l=this._shader2D,c=this._curSubmit.shaderValue,u=n?ht.create(n):this._other.font;if(F.enabled)l.ALPHA!==c.ALPHA&&(l.glTexture=null),rt.drawText(this,t,e,this._curMat,u,h||this._other.textAlign,a,o,r,i,s);else{var p=(this._shader2D.defines.getValue(),a?d.create(a)._color:l.colorAdd);l.ALPHA===c.ALPHA&&p===l.colorAdd&&c.colorAdd===l.colorAdd||(l.glTexture=null,l.colorAdd=p),rt.drawText(this,t,e,this._curMat,u,h||this._other.textAlign,a,o,r,i,s)}},r.fillWords=function(t,e,i,s,n){this._fillText(null,t,e,i,s,n,null,-1,null)},r.fillText=function(t,e,i,s,n,a){this._fillText(t,null,e,i,s,n,null,-1,a)},r.strokeText=function(t,e,i,s,n,a,o){this._fillText(t,null,e,i,s,null,n,a||1,o)},r.fillBorderText=function(t,e,i,s,n,a,o,r){this._fillBorderText(t,null,e,i,s,n,a,o,r)},r._fillBorderText=function(t,i,s,n,a,o,r,h,l){if(!F.enabled)return this._fillText(t,i,s,n,a,null,r,h||1,l),void this._fillText(t,i,s,n,a,o,null,-1,l);var c=this._shader2D,d=this._curSubmit.shaderValue;c.ALPHA!==d.ALPHA&&(c.glTexture=null);var u=a?(e._fontTemp.setFont(a),e._fontTemp):this._other.font;rt.drawText(this,t,i,this._curMat,u,l||this._other.textAlign,o,r,h||1,s,n)},r.fillBorderWords=function(t,e,i,s,n,a,o){this._fillBorderText(null,t,e,i,s,n,a,o,null)},r.fillRect=function(t,e,i,s,n){var a=this._vb;if(ct.fillRectImgVb(a,this._clipRect,t,e,i,s,A.DEF_UV,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var o=this._shader2D.fillStyle;n&&(this._shader2D.fillStyle=H.create(n));var r=this._shader2D,h=this._curSubmit.shaderValue;if(r.fillStyle!==h.fillStyle||r.ALPHA!==h.ALPHA){r.glTexture=null;var l=this._curSubmit=Z.create(this,this._ib,a,(a._byteLength-64)/32*3,mt.create(2,0));l.shaderValue.color=r.fillStyle._color._color,l.shaderValue.ALPHA=r.ALPHA,this._submits[this._submits._length++]=l}this._curSubmit._numEle+=6,this._shader2D.fillStyle=o}},r.fillTexture=function(t,e,s,n,a,o,r,h){if(!(t.loaded&&t.bitmap&&t.source))return void(this.sprite&&i.timer.callLater(this,this._repaintSprite));var l=this._vb,c=t.bitmap.width,d=t.bitmap.height,u=t.uv,p=r.x%t.width,_=r.y%t.height;if(c!=h.w||d!=h.h){if(!h.w&&!h.h)switch(h.oy=h.ox=0,o){case"repeat":h.width=n,h.height=a;break;case"repeat-x":h.width=n,0>_?t.height+_>a?h.height=a:h.height=t.height+_:(h.oy=_,t.height+_>a?h.height=a-_:h.height=t.height);break;case"repeat-y":0>p?t.width+p>n?h.width=n:h.width=t.width+p:(h.ox=p,t.width+p>n?h.width=n-p:h.width=t.width),h.height=a;break;default:h.width=n,h.height=a}h.w=c,h.h=d,h.uv=[0,0,h.width/c,0,h.width/c,h.height/d,0,h.height/d]}if(e+=h.ox,s+=h.oy,p-=h.ox,_-=h.oy,ct.fillRectImgVb(l,this._clipRect,e,s,h.width,h.height,h.uv,this._curMat,this._x,this._y,0,0)){this._renderKey=0;var f=Tt.create(this,this._ib,l,(l._byteLength-64)/32*3,mt.create(256,0));this._submits[this._submits._length++]=f;var y=f.shaderValue;y.textureHost=t;var m=u[0]*c,g=u[1]*d,v=(u[2]-u[0])*c,C=(u[5]-u[3])*d,w=-p/c,x=-_/d;y.u_TexRange[0]=m/c,y.u_TexRange[1]=v/c,y.u_TexRange[2]=g/d,y.u_TexRange[3]=C/d,y.u_offset[0]=w,y.u_offset[1]=x,F.enabled&&!this._isMain&&f.addTexture(t,(l._byteLength>>2)-16),this._curSubmit=f,f._renderType=10017,f._numEle+=6}},r.setShader=function(t){W.save(this,524288,this._shader2D,!0),this._shader2D.shader=t},r.setFilters=function(t){W.save(this,1048576,this._shader2D,!0),this._shader2D.filters=t,this._curSubmit=Z.RENDERBASE,this._renderKey=0,this._drawCount++},r.drawTexture=function(t,e,i,s,n,a,o){this._drawTextureM(t,e,i,s,n,a,o,null,1)},r.addTextureVb=function(t,e,i){var s=this._curSubmit._vb||this._vb,n=s._byteLength>>2;s.byteLength=n+16<<2;for(var a=s.getFloat32Array(),o=0;16>o;o+=4)a[n++]=t[o]+e,a[n++]=t[o+1]+i,a[n++]=t[o+2],a[n++]=t[o+3];this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),s._upload=!0},r.willDrawTexture=function(t,e){if(!(t.loaded&&t.bitmap&&t.source))return this.sprite&&i.timer.callLater(this,this._repaintSprite),0;var s=t.bitmap,n=s.id+this._shader2D.ALPHA*e+10016;if(n==this._renderKey)return n;var a=this._shader2D,o=a.ALPHA,r=this._curSubmit.shaderValue;a.ALPHA*=e,this._renderKey=n,this._drawCount++,a.glTexture=s;var h=this._vb,l=null,c=h._byteLength/32*3;return l=Tt.create(this,this._ib,h,c,mt.create(1,0)),this._submits[this._submits._length++]=l,l.shaderValue.textureHost=t,l._renderType=10016,l._preIsSameTextureShader=10016===this._curSubmit._renderType&&a.ALPHA===r.ALPHA,this._curSubmit=l,a.ALPHA=o,n},r.drawTextures=function(t,s,n,a){if(!(t.loaded&&t.bitmap&&t.source))return void(this.sprite&&i.timer.callLater(this,this._repaintSprite));var o=this._clipRect;if(this._clipRect=e.MAXCLIPRECT,!this._drawTextureM(t,s[0],s[1],t.width,t.height,n,a,null,1))return void alert("drawTextures err");if(this._clipRect=o,k.drawCall+=s.length/2,!(s.length<4)){for(var r=this._curSubmit._vb||this._vb,h=this._curMat.a,l=this._curMat.d,c=2,d=s.length;d>c;c+=2)ct.copyPreImgVb(r,(s[c]-s[c-2])*h,(s[c+1]-s[c-1])*l),this._curSubmit._numEle+=6;this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle)}},r._drawTextureM=function(t,e,s,n,a,o,r,h,l){if(!(t.loaded&&t.bitmap&&t.source))return this.sprite&&i.timer.callLater(this,this._repaintSprite),!1;var c=this._curSubmit._vb||this._vb,d=t.bitmap;e+=o,s+=r,this._drawCount++;var u=d.id+this._shader2D.ALPHA*l+10016;if(u!=this._renderKey){this._renderKey=u;var p=this._curSubmit.shaderValue,_=this._shader2D,f=_.ALPHA;_.ALPHA*=l,_.glTexture=d;var y=this._vb,m=null,g=y._byteLength/32*3;m=Tt.create(this,this._ib,y,g,mt.create(1,0)),this._submits[this._submits._length++]=m,m.shaderValue.textureHost=t,m._renderType=10016,m._preIsSameTextureShader=10016===this._curSubmit._renderType&&_.ALPHA===p.ALPHA,this._curSubmit=m,c=this._curSubmit._vb||this._vb,_.ALPHA=f}return ct.fillRectImgVb(c,this._clipRect,e,s,n||t.width,a||t.height,t.uv,h||this._curMat,this._x,this._y,0,0)?(F.enabled&&!this._isMain&&this._curSubmit.addTexture(t,(c._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle),!0):!1},r._repaintSprite=function(){this.sprite.repaint()},r._drawText=function(t,e,i,s,n,a,o,r,h,l){var c=t.bitmap;this._drawCount++;var d=c.id+this._shader2D.ALPHA+10016;if(d!=this._renderKey){this._renderKey=d;var u=this._curSubmit.shaderValue,p=this._shader2D;p.glTexture=c;var _=this._vb,f=null,y=_._byteLength/32*3;f=F.enabled?Tt.create(this,this._ib,_,y,mt.create(1,0)):Tt.create(this,this._ib,_,y,Wt.create()),f._preIsSameTextureShader=10016===this._curSubmit._renderType&&p.ALPHA===u.ALPHA,this._submits[this._submits._length++]=f,f.shaderValue.textureHost=t,f._renderType=10016,this._curSubmit=f}t.active();var m=this._curSubmit._vb||this._vb;ct.fillRectImgVb(m,this._clipRect,e+o,i+r,s||t.width,n||t.height,t.uv,a||this._curMat,this._x,this._y,h,l,!0)&&(F.enabled&&!this._isMain&&this._curSubmit.addTexture(t,(m._byteLength>>2)-16),this._curSubmit._numEle+=6,this._maxNumEle=Math.max(this._maxNumEle,this._curSubmit._numEle))},r.drawTextureWithTransform=function(t,i,s,n,a,o,r,h,l){if(!o)return void this._drawTextureM(t,i,s,n,a,r,h,null,l);var c=this._curMat,d=this._x,u=this._y;(0!==r||0!==h)&&(this._x=r*c.a+h*c.c,this._y=h*c.d+r*c.b),o&&c.bTransform?(v.mul(o,c,e._tmpMatrix),o=e._tmpMatrix,o._checkTransform()):(this._x+=c.tx,this._y+=c.ty),this._drawTextureM(t,i,s,n,a,0,0,o,l),this._x=d,this._y=u},r.fillQuadrangle=function(t,e,i,s,n){var a=this._curSubmit,o=this._vb,r=this._shader2D,h=a.shaderValue;if(this._renderKey=0,t.bitmap){var l=t.bitmap;r.glTexture==l&&r.ALPHA===h.ALPHA||(r.glTexture=l,a=this._curSubmit=Z.create(this,this._ib,o,o._byteLength/32*3,mt.create(1,0)),a.shaderValue.glTexture=l,this._submits[this._submits._length++]=a),ct.fillQuadrangleImgVb(o,e,i,s,t.uv,n||this._curMat,this._x,this._y)}else a.shaderValue.fillStyle&&a.shaderValue.fillStyle.equal(t)&&r.ALPHA===h.ALPHA||(r.glTexture=null,a=this._curSubmit=Z.create(this,this._ib,o,o._byteLength/32*3,mt.create(2,0)),a.shaderValue.defines.add(2),a.shaderValue.fillStyle=H.create(t),this._submits[this._submits._length++]=a),ct.fillQuadrangleImgVb(o,e,i,s,A.DEF_UV,n||this._curMat,this._x,this._y);a._numEle+=6},r.drawTexture2=function(t,i,s,n,a,o,r,h){if(0!=o){var l=this._curMat;if(this._x=t*l.a+i*l.c,this._y=i*l.d+t*l.b,a&&(l.bTransform||a.bTransform?(v.mul(a,l,e._tmpMatrix),a=e._tmpMatrix):(this._x+=a.tx+l.tx,this._y+=a.ty+l.ty,a=v.EMPTY)),1!==o||r){var c=this._shader2D.ALPHA,d=this._nBlendType;this._shader2D.ALPHA=o,r&&(this._nBlendType=U.TOINT(r)),this._drawTextureM(h[0],h[1]-s,h[2]-n,h[3],h[4],0,0,a,1),this._shader2D.ALPHA=c,this._nBlendType=d}else this._drawTextureM(h[0],h[1]-s,h[2]-n,h[3],h[4],0,0,a,1);this._x=this._y=0}},r.drawCanvas=function(t,e,i,s,n){var a=t.context;if(this._renderKey=0,a._targets)this._submits[this._submits._length++]=It.create(a,0,null),this._curSubmit=Z.RENDERBASE,a._targets.drawTo(this,e,i,s,n);else{var o=this._submits[this._submits._length++]=It.create(a,this._shader2D.ALPHA,this._shader2D.filters),r=s/t.width,h=n/t.height,l=o._matrix;this._curMat.copyTo(l),1!=r&&1!=h&&l.scale(r,h);var c=l.tx,d=l.ty;l.tx=l.ty=0,l.transformPoint(C.TEMP.setTo(e,i)),l.translate(C.TEMP.x+c,C.TEMP.y+d),this._curSubmit=Z.RENDERBASE}u.showCanvasMark&&(this.save(),this.lineWidth=4,this.strokeStyle=a._targets?"yellow":"green",this.strokeRect(e-1,i-1,s+2,n+2,1),this.strokeRect(e,i,s,n,1),this.restore())},r.drawTarget=function(t,e,i,s,n,a,o,r,h,l){void 0===l&&(l=-1);var c=this._vb;if(ct.fillRectImgVb(c,this._clipRect,e,i,s,n,h||A.DEF_UV,a||this._curMat,this._x,this._y,0,0)){this._renderKey=0;var d=this._shader2D;d.glTexture=null;var u=(this._curSubmit.shaderValue,this._curSubmit=at.create(this,this._ib,c,(c._byteLength-64)/32*3,r,o));-1==l?u.blendType=this._nBlendType:u.blendType=l,u.scope=t,this._submits[this._submits._length++]=u,this._curSubmit._numEle+=6}},r.transform=function(t,e,i,s,n,a){j.save(this),v.mul(v.TEMP.setTo(t,e,i,s,n,a),this._curMat,this._curMat),this._curMat._checkTransform()},r.setTransformByMatrix=function(t){t.copyTo(this._curMat)},r.transformByMatrix=function(t){j.save(this),v.mul(t,this._curMat,this._curMat),this._curMat._checkTransform()},r.rotate=function(t){j.save(this),this._curMat.rotateEx(t)},r.scale=function(t,e){j.save(this),this._curMat.scaleEx(t,e)},r.clipRect=function(t,e,i,s){i*=this._curMat.a,s*=this._curMat.d;var n=C.TEMP;this._curMat.transformPoint(n.setTo(t,e)),this._renderKey=0;var a=this._curSubmit=st.create(this);this._submits[this._submits._length++]=a,a.submitIndex=this._submits._length,a.submitLength=9999999,V.save(this,a);var o=this._clipRect,r=o.x,h=o.y,l=n.x+i,c=n.y+s;r<n.x&&(o.x=n.x),h<n.y&&(o.y=n.y),o.width=Math.min(l,r+o.width)-o.x,o.height=Math.min(c,h+o.height)-o.y,this._shader2D.glTexture=null,a.clipRect.copyFrom(o),this._curSubmit=Z.RENDERBASE},r.setIBVB=function(t,e,i,s,n,a,o,r,h,l,c){if(void 0===h&&(h=0),void 0===l&&(l=0),void 0===c&&(c=0),null===i){if(x.isFlash){var d=s;d._selfIB||(d._selfIB=Kt.create(35044)),d._selfIB.clear(),i=d._selfIB}else i=this._ib;ct.expandIBQuadrangle(i,s.byteLength/(4*s.vertexStride*4))}if(!r||!o)throw Error("setIBVB must input:shader shaderValues");var u=it.create(this,s,i,n,o,r,h,l,c);a||(a=v.EMPTY),a.translate(t,e),v.mul(a,this._curMat,u._mat),a.translate(-t,-e),this._submits[this._submits._length++]=u,this._curSubmit=Z.RENDERBASE,this._renderKey=0},r.addRenderObject=function(t){this._submits[this._submits._length++]=t},r.fillTrangles=function(t,e,i,s,n){var a=this._curSubmit,o=this._vb,r=this._shader2D,h=a.shaderValue,l=s.length>>4,c=t.bitmap;
this._renderKey=0,r.glTexture==c&&r.ALPHA===h.ALPHA||(a=this._curSubmit=Z.create(this,this._ib,o,o._byteLength/32*3,mt.create(1,0)),a.shaderValue.textureHost=t,this._submits[this._submits._length++]=a),ct.fillTranglesVB(o,e,i,s,n||this._curMat,this._x,this._y),a._numEle+=6*l},r.submitElement=function(t,e){var i=this._submits;for(0>e&&(e=i._length);e>t;)t+=i[t].renderSubmit()},r.finish=function(){pt.mainContext.finish()},r.flush=function(){var t=Math.max(this._vb.byteLength/64,this._maxNumEle/6)+8;if(t>this._ib.bufferLength/12&&ct.expandIBQuadrangle(this._ib,t),!this._isMain&&F.enabled&&F._atlasRestore>this._atlasResourceChange){this._atlasResourceChange=F._atlasRestore;for(var e=this._submits,i=0,s=e._length;s>i;i++){var n=e[i];10016===n.getRenderType()&&n.checkTexture()}}return this.submitElement(0,this._submits._length),this._path&&this._path.reset(),Q.instance&&Q.getInstance().reset(),this._curSubmit=Z.RENDERBASE,this._renderKey=0,this._submits._length},r.setPathId=function(t){if(this.mId=t,-1!=this.mId){this.mHaveKey=!1;var e=P.getInstance();e.shapeDic[this.mId]&&(this.mHaveKey=!0),this.mHaveLineKey=!1,e.shapeLineDic[this.mId]&&(this.mHaveLineKey=!0)}},r.movePath=function(t,e){var i=t,s=e;t=this._curMat.a*i+this._curMat.c*s+this._curMat.tx,e=this._curMat.b*i+this._curMat.d*s+this._curMat.ty,this.mX+=t,this.mY+=e},r.beginPath=function(){var t=this._getPath();t.tempArray.length=0,t.closePath=!1,this.mX=0,this.mY=0},r.closePath=function(){this._path.closePath=!0},r.fill=function(t){void 0===t&&(t=!1);var e=this._getPath();this.drawPoly(0,0,e.tempArray,this.fillStyle._color.numColor,0,0,t)},r.stroke=function(){var t=this._getPath();if(this.lineWidth>0){if(-1==this.mId)t.drawLine(0,0,t.tempArray,this.lineWidth,this.strokeStyle._color.numColor);else if(this.mHaveLineKey){var e=P.getInstance().shapeLineDic[this.mId];e.rebuild(t.tempArray),t.setGeomtry(e)}else P.getInstance().addLine(this.mId,t.drawLine(0,0,t.tempArray,this.lineWidth,this.strokeStyle._color.numColor));t.update();var i=[this.mX,this.mY],s=Z.createShape(this,t.ib,t.vb,t.count,t.offset,mt.create(4,0));s.shaderValue.ALPHA=this._shader2D.ALPHA,s.shaderValue.u_pos=i,s.shaderValue.u_mmat2=dt.TEMPMAT4_ARRAY,this._submits[this._submits._length++]=s}},r.line=function(t,e,i,s,n,a){var o=this._curSubmit,r=this._vb;if(ct.fillLineVb(r,this._clipRect,t,e,i,s,n,a)){this._renderKey=0;var h=this._shader2D,l=o.shaderValue;h.strokeStyle===l.strokeStyle&&h.ALPHA===l.ALPHA||(h.glTexture=null,o=this._curSubmit=Z.create(this,this._ib,r,(r._byteLength-64)/32*3,mt.create(2,0)),o.shaderValue.strokeStyle=h.strokeStyle,o.shaderValue.mainID=2,o.shaderValue.ALPHA=h.ALPHA,this._submits[this._submits._length++]=o),o._numEle+=6}},r.moveTo=function(t,e,i){void 0===i&&(i=!0);var s=this._getPath();if(i){var n=t,a=e;t=this._curMat.a*n+this._curMat.c*a,e=this._curMat.b*n+this._curMat.d*a}s.addPoint(t,e)},r.lineTo=function(t,e,i){void 0===i&&(i=!0);var s=this._getPath();if(i){var n=t,a=e;t=this._curMat.a*n+this._curMat.c*a,e=this._curMat.b*n+this._curMat.d*a}s.addPoint(t,e)},r.drawCurves=function(t,e,i){this.setPathId(-1),this.beginPath(),this.strokeStyle=i[3],this.lineWidth=i[4];var s=i[2];t+=i[0],e+=i[1],this.movePath(t,e),this.moveTo(s[0],s[1]);for(var n=2,a=s.length;a>n;)this.quadraticCurveTo(s[n++],s[n++],s[n++],s[n++]);this.stroke()},r.arcTo=function(t,e,i,s,n){if(-1==this.mId||!this.mHaveKey){var a=this._getPath(),o=a.getEndPointX(),r=a.getEndPointY(),h=NaN,l=NaN,c=NaN,d=NaN,u=NaN,p=NaN,_=NaN,f=NaN,y=NaN,m=NaN,g=!1,v=t,w=e;t=this._curMat.a*v+this._curMat.c*w,e=this._curMat.b*v+this._curMat.d*w,v=i,w=s,i=this._curMat.a*v+this._curMat.c*w,s=this._curMat.b*v+this._curMat.d*w,n=this._curMat.a*n+this._curMat.c*n,h=o-t,l=r-e,c=i-t,d=s-e,C.TEMP.setTo(h,l),C.TEMP.normalize(),h=C.TEMP.x,l=C.TEMP.y,C.TEMP.setTo(c,d),C.TEMP.normalize(),c=C.TEMP.x,d=C.TEMP.y,u=Math.acos(h*c+l*d);var x=Math.tan(u/2);if(p=n/x,p>1e4)return void this.lineTo(t,e);0>=h*d-c*l?(_=t+h*p+l*n,f=e+l*p-h*n,y=Math.atan2(h,-l),m=Math.atan2(-c,d),g=!1):(_=t+h*p-l*n,f=e+l*p+h*n,y=Math.atan2(-h,l),m=Math.atan2(c,-d),g=!0),this.arc(_,f,n,y,m,g,!1)}},r.arc=function(t,e,i,s,n,a,o){if(void 0===a&&(a=!1),void 0===o&&(o=!0),-1!=this.mId){var r=P.getInstance().shapeDic[this.mId];if(r&&this.mHaveKey&&!r.needUpdate(this._curMat))return;t=0,e=0}var h=0,l=0,c=0,d=0,u=0,p=0,_=0,f=0,y=0,m=0,g=0;if(l=n-s,a)if(Math.abs(l)>=2*Math.PI)l=2*-Math.PI;else for(;l>0;)l-=2*Math.PI;else if(Math.abs(l)>=2*Math.PI)l=2*Math.PI;else for(;0>l;)l+=2*Math.PI;m=101>i?Math.max(10,l*i/5):201>i?Math.max(10,l*i/20):Math.max(10,l*i/40),c=l/m/2,d=Math.abs(4/3*(1-Math.cos(c))/Math.sin(c)),a&&(d=-d),g=0;var v=this._getPath(),C=NaN,w=NaN;for(y=0;m>=y;y++)h=s+l*(y/m),u=Math.cos(h),p=Math.sin(h),_=t+u*i,f=e+p*i,o&&(C=_,w=f,_=this._curMat.a*C+this._curMat.c*w,f=this._curMat.b*C+this._curMat.d*w),_==this._path.getEndPointX()&&f==this._path.getEndPointY()||v.addPoint(_,f);u=Math.cos(n),p=Math.sin(n),_=t+u*i,f=e+p*i,o&&(C=_,w=f,_=this._curMat.a*C+this._curMat.c*w,f=this._curMat.b*C+this._curMat.d*w),_==this._path.getEndPointX()&&f==this._path.getEndPointY()||v.addPoint(_,f)},r.quadraticCurveTo=function(t,e,i,s){var n=h.I,a=i,o=s;i=this._curMat.a*a+this._curMat.c*o,s=this._curMat.b*a+this._curMat.d*o,a=t,o=e,t=this._curMat.a*a+this._curMat.c*o,e=this._curMat.b*a+this._curMat.d*o;for(var r=n.getBezierPoints([this._path.getEndPointX(),this._path.getEndPointY(),t,e,i,s],30,2),l=0,c=r.length/2;c>l;l++)this.lineTo(r[2*l],r[2*l+1],!1);this.lineTo(i,s,!1)},r.rect=function(t,e,i,s){this._other=this._other.make(),this._other.path||(this._other.path=new G),this._other.path.rect(t,e,i,s)},r.strokeRect=function(t,e,i,s,n){var a=.5*n;this.line(t-a,e,t+i+a,e,n,this._curMat),this.line(t+i,e,t+i,e+s,n,this._curMat),this.line(t,e,t,e+s,n,this._curMat),this.line(t-a,e+s,t+i+a,e+s,n,this._curMat)},r.clip=function(){},r.drawPoly=function(t,e,i,s,n,a,o){void 0===o&&(o=!1),this._renderKey=0,this._shader2D.glTexture=null;var r=this._getPath();if(-1==this.mId)r.polygon(t,e,i,s,n?n:1,a);else if(this.mHaveKey){var h=P.getInstance().shapeDic[this.mId];h.setMatrix(this._curMat),h.rebuild(r.tempArray),r.setGeomtry(h)}else{var l=r.polygon(t,e,i,s,n?n:1,a);P.getInstance().addShape(this.mId,l),l.setMatrix(this._curMat)}r.update();var c,d=[this.mX,this.mY];if(!o){var u=nt.create(4);this.addRenderObject(u),c=Z.createShape(this,r.ib,r.vb,r.count,r.offset,mt.create(4,0)),c.shaderValue.ALPHA=this._shader2D.ALPHA,c.shaderValue.u_pos=d,c.shaderValue.u_mmat2=dt.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=c,u=nt.create(5),this.addRenderObject(u)}if(c=Z.createShape(this,r.ib,r.vb,r.count,r.offset,mt.create(4,0)),c.shaderValue.ALPHA=this._shader2D.ALPHA,c.shaderValue.u_pos=d,c.shaderValue.u_mmat2=dt.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=c,o||(u=nt.create(3),this.addRenderObject(u)),n>0){if(this.mHaveLineKey){var p=P.getInstance().shapeLineDic[this.mId];p.rebuild(r.tempArray),r.setGeomtry(p)}else P.getInstance().addShape(this.mId,r.drawLine(t,e,i,n,a));r.update(),c=Z.createShape(this,r.ib,r.vb,r.count,r.offset,mt.create(4,0)),c.shaderValue.ALPHA=this._shader2D.ALPHA,c.shaderValue.u_mmat2=dt.EMPTYMAT4_ARRAY,this._submits[this._submits._length++]=c}},r.drawParticle=function(t,e,i){i.x=t,i.y=e,this._submits[this._submits._length++]=i},r._getPath=function(){return this._path||(this._path=new G)},a(0,r,"globalCompositeOperation",function(){return U.NAMES[this._nBlendType]},function(t){var e=U.TOINT[t];null==e||this._nBlendType===e||(W.save(this,65536,this,!0),this._curSubmit=Z.RENDERBASE,this._renderKey=0,this._nBlendType=e)}),a(0,r,"strokeStyle",function(){return this._shader2D.strokeStyle},function(t){this._shader2D.strokeStyle.equal(t)||(W.save(this,512,this._shader2D,!1),this._shader2D.strokeStyle=H.create(t))}),a(0,r,"globalAlpha",function(){return this._shader2D.ALPHA},function(t){t=Math.floor(1e3*t)/1e3,t!=this._shader2D.ALPHA&&(W.save(this,1,this._shader2D,!0),this._shader2D.ALPHA=t)}),a(0,r,"asBitmap",null,function(t){if(t){if(this._targets||(this._targets=new Y),this._targets.repaint=!0,!this._width||!this._height)throw Error("asBitmap no size!");this._targets.setSP(this.sprite),this._targets.size(this._width,this._height)}else this._targets=null}),a(0,r,"fillStyle",function(){return this._shader2D.fillStyle},function(t){this._shader2D.fillStyle.equal(t)||(W.save(this,2,this._shader2D,!1),this._shader2D.fillStyle=H.create(t))}),a(0,r,"textAlign",function(){return this._other.textAlign},function(t){this._other.textAlign===t||(this._other=this._other.make(),W.save(this,32768,this._other,!1),this._other.textAlign=t)}),a(0,r,"lineWidth",function(){return this._other.lineWidth},function(t){this._other.lineWidth===t||(this._other=this._other.make(),W.save(this,256,this._other,!1),this._other.lineWidth=t)}),a(0,r,"textBaseline",function(){return this._other.textBaseline},function(t){this._other.textBaseline===t||(this._other=this._other.make(),W.save(this,16384,this._other,!1),this._other.textBaseline=t)}),a(0,r,"font",null,function(t){t!=this._other.font.toString()&&(this._other=this._other.make(),W.save(this,8,this._other,!1),this._other.font===ht.EMPTY?this._other.font=new ht(t):this._other.font.setFont(t))}),e.__init__=function(){o.DEFAULT=new o},e._SUBMITVBSIZE=32e3,e._MAXSIZE=99999999,e._RECTVBSIZE=16,e.MAXCLIPRECT=new w(0,0,99999999,99999999),e._COUNT=0,e._tmpMatrix=new v,s(e,["_fontTemp",function(){return this._fontTemp=new ht},"_drawStyleTemp",function(){return this._drawStyleTemp=new H(null)}]),e.__init$=function(){o=function(){function t(){this.lineWidth=1,this.path=null,this.textAlign=null,this.textBaseline=null,this.font=ht.EMPTY}n(t,"");var e=t.prototype;return e.clear=function(){this.lineWidth=1,this.path&&this.path.clear(),this.textAlign=this.textBaseline=null,this.font=ht.EMPTY},e.make=function(){return this===t.DEFAULT?new t:this},t.DEFAULT=null,t}()},e}(p),mt=function(t){function e(t,i){this.size=[0,0],this.alpha=1,this.ALPHA=1,this.subID=0,this._cacheID=0,e.__super.call(this),this.defines=new wt,this.position=e._POSITION,this.mainID=t,this.subID=i,this.textureHost=null,this.texture=null,this.fillStyle=null,this.color=null,this.strokeStyle=null,this.colorAdd=null,this.glTexture=null,this.u_mmat2=null,this._cacheID=t|i,this._inClassCache=e._cache[this._cacheID],t>0&&!this._inClassCache&&(this._inClassCache=e._cache[this._cacheID]=[],this._inClassCache._length=0),this.clear()}n(e,"laya.webgl.shader.d2.value.Value2D",t);var i=e.prototype;return i.setValue=function(t){},i.refresh=function(){var t=this.size;return t[0]=dt.width,t[1]=dt.height,this.alpha=this.ALPHA*dt.worldAlpha,this.mmat=dt.worldMatrix4,this},i._ShaderWithCompile=function(){return Ht.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,Vt.create)},i._withWorldShaderDefines=function(){var t=dt.worldShaderDefines,e=Ht.sharders[this.mainID|this.defines._value|t.getValue()];if(!e){var i,s,n={};i=this.defines.toNameDic();for(s in i)n[s]="";i=t.toNameDic();for(s in i)n[s]="";e=Ht.withCompile2D(0,this.mainID,n,this.mainID|this.defines._value|t.getValue(),Vt.create)}var a=dt.worldFilters;if(!a)return e;for(var o,r=a.length,h=0;r>h;h++)(o=a[h])&&o.action.setValue(this);return e},i.upload=function(){var t=dt;this.alpha=this.ALPHA*t.worldAlpha,dt.worldMatrix4!==dt.TEMPMAT4_ARRAY&&this.defines.add(128),pt.frameShaderHighPrecision&&this.defines.add(1024);var e,i=t.worldShaderDefines?this._withWorldShaderDefines():Ht.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();this.size[0]=t.width,this.size[1]=t.height,this.mmat=t.worldMatrix4,Lt.activeShader!==i?(i._shaderValueWidth!==t.width||i._shaderValueHeight!==t.height?(i._shaderValueWidth=t.width,i._shaderValueHeight=t.height):e=i._params2dQuick2||i._make2dQuick2(),i.upload(this,e)):(i._shaderValueWidth!==t.width||i._shaderValueHeight!==t.height?(i._shaderValueWidth=t.width,i._shaderValueHeight=t.height):e=i._params2dQuick1||i._make2dQuick1(),i.upload(this,e))},i.setFilters=function(t){if(this.filters=t,t)for(var e,i=t.length,s=0;i>s;s++)e=t[s],e&&(this.defines.add(e.type),e.action.setValue(this))},i.clear=function(){this.defines.setValue(this.subID)},i.release=function(){this._inClassCache[this._inClassCache._length++]=this,this.fillStyle=null,this.strokeStyle=null,this.clear()},e._initone=function(t,i){e._typeClass[t]=i,e._cache[t]=[],e._cache[t]._length=0},e.__init__=function(){e._POSITION=[2,5126,!1,4*lt.BYTES_PE,0],e._TEXCOORD=[2,5126,!1,4*lt.BYTES_PE,2*lt.BYTES_PE],e._initone(2,At),e._initone(4,Mt),e._initone(256,Bt),e._initone(512,Dt),e._initone(1,Pt),e._initone(65,Wt),e._initone(9,Pt)},e.create=function(t,i){var s=e._cache[t|i];return s._length?s[--s._length]:new e._typeClass[t|i](i)},e._POSITION=null,e._TEXCOORD=null,e._cache=[],e._typeClass=[],e.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e}(R),gt=function(t){function e(t,i){e.__super.call(this,t,i)}n(e,"laya.webgl.utils.RenderSprite3D",t);var i=e.prototype;return i.onCreate=function(t){switch(t){case 8:return void(this._fun=this._blend);case 4:return void(this._fun=this._transform)}},i._mask=function(t,i,s,n){var a,o,r=this._next,h=t.mask;if(h){i.ctx.save();var l=i.ctx.globalCompositeOperation,c=new w;if(c.copyFrom(h.getBounds()),c.width=Math.round(c.width),c.height=Math.round(c.height),c.x=Math.round(c.x),c.y=Math.round(c.y),c.width>0&&c.height>0){var d=et.create();d.addValue("bounds",c),a=tt.create([d,i],laya.webgl.utils.RenderSprite3D.tmpTarget),i.addRenderObject(a),h.render(i,-c.x,-c.y),a=tt.create([d],laya.webgl.utils.RenderSprite3D.endTmpTarget),i.addRenderObject(a),i.ctx.save(),i.clipRect(s+c.x,n+c.y,c.width,c.height),r._fun.call(r,t,i,s,n),i.ctx.restore(),o=nt.create(6),l=i.ctx.globalCompositeOperation,o.blendMode="mask",i.addRenderObject(o),v.TEMP.identity();var u=mt.create(1,0),p=A.INV_UV,_=c.width,f=c.height,y=32;(c.width<y||c.height<y)&&(p=e.tempUV,p[0]=0,p[1]=0,p[2]=c.width>=32?1:c.width/y,p[3]=0,p[4]=c.width>=32?1:c.width/y,p[5]=c.height>=32?1:c.height/y,p[6]=0,p[7]=c.height>=32?1:c.height/y,c.width=c.width>=32?c.width:y,c.height=c.height>=32?c.height:y,p[1]*=-1,p[3]*=-1,p[5]*=-1,p[7]*=-1,p[1]+=1,p[3]+=1,p[5]+=1,p[7]+=1),i.ctx.drawTarget(d,s+c.x,n+c.y,_,f,v.TEMP,"tmpTarget",u,p,6),a=tt.create([d],laya.webgl.utils.RenderSprite3D.recycleTarget),i.addRenderObject(a),o=nt.create(6),o.blendMode=l,i.addRenderObject(o)}i.ctx.restore()}else r._fun.call(r,t,i,s,n)},i._blend=function(t,e,i,s){var n=t._style,a=this._next;n.blendMode?(e.ctx.save(),e.ctx.globalCompositeOperation=n.blendMode,a._fun.call(a,t,e,i,s),e.ctx.restore()):a._fun.call(a,t,e,i,s)},i._transform=function(t,e,i,s){"use strict";var n=t.transform,a=this._next;if(n&&a!=b.NORENDER){var o=e.ctx;t._style;n.tx=i,n.ty=s;var r=o._getTransformMatrix(),h=r.clone();v.mul(n,r,r),r._checkTransform(),n.tx=n.ty=0,a._fun.call(a,t,e,0,0),h.copyTo(r),h.destroy()}else a._fun.call(a,t,e,i,s)},e.tmpTarget=function(t,e){var i=t.getValue("bounds"),s=kt.create(i.width,i.height);s.start(),s.clear(0,0,0,0),t.addValue("tmpTarget",s)},e.endTmpTarget=function(t){var e=t.getValue("tmpTarget");e.end()},e.recycleTarget=function(t){var e=t.getValue("tmpTarget");e.recycle(),t.recycle()},s(e,["tempUV",function(){return this.tempUV=new Array(8)}]),e}(b),vt=function(t){function e(){this.data=null,e.__super.call(this)}n(e,"laya.filters.webgl.ColorFilterActionGL",t);var s=e.prototype;return i.imps(s,{"laya.filters.IFilterActionGL":!0}),s.setValue=function(t){t.colorMat=this.data._mat,t.colorAlpha=this.data._alpha},s.apply3d=function(t,e,i,s,n){var a=t.getValue("bounds"),o=mt.create(1,0);o.setFilters([this.data]);var r=v.TEMP;r.identity(),i.ctx.drawTarget(t,0,0,a.width,a.height,r,"src",o)},e}(M),Ct=function(t){function e(t,i,s,n,a){this._atlasCanvas=null,this._inAtlasTextureKey=null,this._inAtlasTextureBitmapValue=null,this._inAtlasTextureOriUVValue=null,this._InAtlasWebGLImagesKey=null,this._InAtlasWebGLImagesOffsetValue=null,e.__super.call(this,t,i,a),this._inAtlasTextureKey=[],this._inAtlasTextureBitmapValue=[],this._inAtlasTextureOriUVValue=[],this._InAtlasWebGLImagesKey=[],this._InAtlasWebGLImagesOffsetValue=[],this._atlasCanvas=new Rt,this._atlasCanvas.width=s,this._atlasCanvas.height=n,this._atlasCanvas.activeResource(),this._atlasCanvas.lock=!0}n(e,"laya.webgl.atlas.Atlaser",t);var i=e.prototype;return i.computeUVinAtlasTexture=function(t,e,i,s){var n=F.atlasTextureWidth,a=F.atlasTextureHeight,o=i/n,r=s/a,h=(i+t.bitmap.width)/n,l=(s+t.bitmap.height)/a,c=t.bitmap.width/n,d=t.bitmap.height/a;t.uv=[o+e[0]*c,r+e[1]*d,h-(1-e[2])*c,r+e[3]*d,h-(1-e[4])*c,l-(1-e[5])*d,o+e[6]*c,l-(1-e[7])*d]},i.addToAtlasTexture=function(t,e,i){t instanceof laya.webgl.resource.WebGLImage&&(this._InAtlasWebGLImagesKey.push(t),this._InAtlasWebGLImagesOffsetValue.push([e,i])),this._atlasCanvas.texSubImage2D(e,i,t.atlasSource),t.clearAtlasSource()},i.addToAtlas=function(t,e,i){var s=t.uv.slice(),n=t.bitmap;this._inAtlasTextureKey.push(t),this._inAtlasTextureOriUVValue.push(s),this._inAtlasTextureBitmapValue.push(n),this.computeUVinAtlasTexture(t,s,e,i),t.bitmap=this._atlasCanvas},i.clear=function(){for(var t=0,e=this._inAtlasTextureKey.length;e>t;t++)this._inAtlasTextureKey[t].bitmap=this._inAtlasTextureBitmapValue[t],this._inAtlasTextureKey[t].uv=this._inAtlasTextureOriUVValue[t],this._inAtlasTextureKey[t].bitmap.lock=!1,this._inAtlasTextureKey[t].bitmap.releaseResource();this._inAtlasTextureKey.length=0,this._inAtlasTextureBitmapValue.length=0,this._inAtlasTextureOriUVValue.length=0,this._InAtlasWebGLImagesKey.length=0,this._InAtlasWebGLImagesOffsetValue.length=0},i.dispose=function(){this.clear(),this._atlasCanvas.dispose()},a(0,i,"InAtlasWebGLImagesOffsetValue",function(){return this._InAtlasWebGLImagesOffsetValue}),a(0,i,"texture",function(){return this._atlasCanvas}),a(0,i,"inAtlasWebGLImagesKey",function(){return this._InAtlasWebGLImagesKey}),e}(O),wt=function(t){function e(){e.__super.call(this,e.__name2int,e.__int2name,e.__int2nameMap)}return n(e,"laya.webgl.shader.d2.ShaderDefines2D",t),e.__init__=function(){e.reg("TEXTURE2D",1),e.reg("COLOR2D",2),e.reg("PRIMITIVE",4),e.reg("GLOW_FILTER",8),e.reg("BLUR_FILTER",16),e.reg("COLOR_FILTER",32),e.reg("COLOR_ADD",64),e.reg("WORLDMAT",128),e.reg("FILLTEXTURE",256),e.reg("FSHIGHPRECISION",1024)},e.reg=function(t,i){z._reg(t,i,e.__name2int,e.__int2name)},e.toText=function(t,e,i){return z._toText(t,e,i)},e.toInt=function(t){return z._toInt(t,e.__name2int)},e.TEXTURE2D=1,e.COLOR2D=2,e.PRIMITIVE=4,e.FILTERGLOW=8,e.FILTERBLUR=16,e.FILTERCOLOR=32,e.COLORADD=64,e.WORLDMAT=128,e.FILLTEXTURE=256,e.SKINMESH=512,e.SHADERDEFINE_FSHIGHPRECISION=1024,e.__name2int={},e.__int2name=[],e.__int2nameMap=[],e}(z),xt=(function(t){function e(t,i,s,n,a,o,r){e.__super.call(this,t,i,s,n,40,a,o,r)}return n(e,"laya.webgl.shapes.Ellipse",t),e}($),function(t){function e(t,i,s,n,a){this._points=[],this.rebuild(s),e.__super.call(this,t,i,0,0,0,a,n,a,0)}n(e,"laya.webgl.shapes.Line",t);var i=e.prototype;return i.rebuild=function(t){var e=t.length,i=this._points.length;e!=i&&(this.mUint16Array=new Uint16Array(6*(e/2-1)),this.mFloat32Array=new Float32Array(5*e)),this._points.length=0;for(var s=NaN,n=NaN,a=-1,o=-1,r=t.length/2,h=0;r>h;h++)s=t[2*h],n=t[2*h+1],(Math.abs(a-s)>.01||Math.abs(o-n)>.01)&&this._points.push(s,n),a=s,o=n},i.getData=function(t,e,i){var s=[],n=[];this.borderWidth>0&&this.createLine2(this._points,s,this.borderWidth,i,n,this._points.length/2),this.mUint16Array.set(s,0),this.mFloat32Array.set(n,0),t.append(this.mUint16Array),e.append(this.mFloat32Array)},e}($)),bt=function(t){function e(t,i,s,n,a){this._points=[];for(var o=NaN,r=NaN,h=-1,l=-1,c=s.length/2-1,d=0;c>d;d++)o=s[2*d],r=s[2*d+1],(Math.abs(h-o)>.01||Math.abs(l-r)>.01)&&this._points.push(o,r),h=o,l=r;o=s[2*c],r=s[2*c+1],h=this._points[0],l=this._points[1],(Math.abs(h-o)>.01||Math.abs(l-r)>.01)&&this._points.push(o,r),e.__super.call(this,t,i,0,0,this._points.length/2,0,n,a)}n(e,"laya.webgl.shapes.LoopLine",t);var i=e.prototype;return i.getData=function(t,e,i){if(this.borderWidth>0){for(var s=this.color,n=(s>>16&255)/255,a=(s>>8&255)/255,o=(255&s)/255,r=[],h=0,l=0,c=[],d=Math.floor(this._points.length/2),u=0;d>u;u++)h=this._points[2*u],l=this._points[2*u+1],r.push(this.x+h,this.y+l,n,a,o);this.createLoopLine(r,c,this.borderWidth,i+r.length/5),t.append(new Uint16Array(c)),e.append(new Float32Array(r))}},i.createLoopLine=function(t,e,i,s,n,a){var o=(t.length/5,t.concat()),r=n?n:t,h=this.borderColor,l=(h>>16&255)/255,c=(h>>8&255)/255,d=(255&h)/255,u=[o[0],o[1]],p=[o[o.length-5],o[o.length-4]],_=p[0]+.5*(u[0]-p[0]),f=p[1]+.5*(u[1]-p[1]);o.unshift(_,f,0,0,0),o.push(_,f,0,0,0);var y,m,g,v,C,w,x,b,S,I,T,L,k,E,D,A,B,P,M,R,O,F=o.length/5,N=s,U=i/2;g=o[0],v=o[1],C=o[5],w=o[6],S=-(v-w),I=g-C,O=Math.sqrt(S*S+I*I),S=S/O*U,I=I/O*U,r.push(g-S,v-I,l,c,d,g+S,v+I,l,c,d);for(var H=1;F-1>H;H++)g=o[5*(H-1)],v=o[5*(H-1)+1],C=o[5*H],w=o[5*H+1],x=o[5*(H+1)],b=o[5*(H+1)+1],S=-(v-w),I=g-C,O=Math.sqrt(S*S+I*I),S=S/O*U,I=I/O*U,T=-(w-b),L=C-x,O=Math.sqrt(T*T+L*L),T=T/O*U,L=L/O*U,k=-I+v-(-I+w),E=-S+C-(-S+g),D=(-S+g)*(-I+w)-(-S+C)*(-I+v),A=-L+b-(-L+w),B=-T+C-(-T+x),P=(-T+x)*(-L+w)-(-T+C)*(-L+b),M=k*B-A*E,Math.abs(M)<.1?(M+=10.1,r.push(C-S,w-I,l,c,d,C+S,w+I,l,c,d)):(y=(E*P-B*D)/M,m=(A*D-k*P)/M,R=(y-C)*(y-C)+(m-w)+(m-w),r.push(y,m,l,c,d,C-(y-C),w-(m-w),l,c,d));a&&(e=a);var G=this.edges+1;for(H=1;G>H;H++)e.push(N+2*(H-1),N+2*(H-1)+1,N+2*H+1,N+2*H+1,N+2*H,N+2*(H-1));return e.push(N+2*(H-1),N+2*(H-1)+1,N+1,N+1,N,N+2*(H-1)),r},e}($),St=function(t){function e(t,i,s,n,a,o){this._points=null,this._start=-1,this._repaint=!1,this._mat=v.create(),this._points=s.slice(0,s.length),e.__super.call(this,t,i,0,0,this._points.length/2,n,a,o)}n(e,"laya.webgl.shapes.Polygon",t);var i=e.prototype;return i.rebuild=function(t){this._repaint||(this._points.length=0,this._points=this._points.concat(t))},i.setMatrix=function(t){t.copyTo(this._mat)},i.needUpdate=function(t){return this._repaint=this._mat.a==t.a&&this._mat.b==t.b&&this._mat.c==t.c&&this._mat.d==t.d&&this._mat.tx==t.tx&&this._mat.ty==t.ty,!this._repaint},i.getData=function(t,e,i){var s,n=0,a=this._points,o=0;if(this.mUint16Array&&this.mFloat32Array&&this._repaint){if(this._start!=i){for(this._start=i,s=[],o=Math.floor(a.length/2),n=2;o>n;n++)s.push(i,i+n-1,i+n);this.mUint16Array=new Uint16Array(s)}}else{this._start=i,s=[];var r=[],h=this.color,l=(h>>16&255)/255,c=(h>>8&255)/255,d=(255&h)/255;for(o=Math.floor(a.length/2),n=0;o>n;n++)r.push(this.x+a[2*n],this.y+a[2*n+1],l,c,d);for(n=2;o>n;n++)s.push(i,i+n-1,i+n);this.mUint16Array=new Uint16Array(s),this.mFloat32Array=new Float32Array(r)}t.append(this.mUint16Array),e.append(this.mFloat32Array)},e}($),It=function(t){function e(){this._matrix=new v,this._matrix4=lt.defaultMatrix4.concat(),e.__super.call(this,1e4),this.shaderValue=new mt(0,0)}n(e,"laya.webgl.submit.SubmitCanvas",t);var i=e.prototype;return i.renderSubmit=function(){if(this._ctx_src._targets)return this._ctx_src._targets.flush(this._ctx_src),1;var t=dt.worldAlpha,e=dt.worldMatrix4,i=dt.worldMatrix,s=dt.worldFilters,n=dt.worldShaderDefines,a=this.shaderValue,o=this._matrix,r=this._matrix4,h=v.TEMP;return v.mul(o,i,h),r[0]=h.a,r[1]=h.b,r[4]=h.c,r[5]=h.d,r[12]=h.tx,r[13]=h.ty,dt.worldMatrix=h.clone(),dt.worldMatrix4=r,dt.worldAlpha=dt.worldAlpha*a.alpha,a.filters&&a.filters.length&&(dt.worldFilters=a.filters,dt.worldShaderDefines=a.defines),this._ctx_src.flush(),dt.worldAlpha=t,dt.worldMatrix4=e,dt.worldMatrix.destroy(),dt.worldMatrix=i,dt.worldFilters=s,dt.worldShaderDefines=n,1},i.releaseRender=function(){var t=e._cache;t[t._length++]=this},i.getRenderType=function(){return 10003},e.create=function(t,i,s){var n=e._cache._length?e._cache[--e._cache._length]:new e;n._ctx_src=t;var a=n.shaderValue;return a.alpha=i,a.defines.setValue(0),s&&s.length&&a.setFilters(s),n},e._cache=(e._cache=[],e._cache._length=0,e._cache),e}(Z),Tt=function(t){function e(t){this._preIsSameTextureShader=!1,this._isSameTexture=!0,this._texs=new Array,this._texsID=new Array,this._vbPos=new Array,void 0===t&&(t=1e4),e.__super.call(this,t)}n(e,"laya.webgl.submit.SubmitTexture",t);var i=e.prototype;return i.releaseRender=function(){var t=e._cache;t[t._length++]=this,this.shaderValue.release(),this._preIsSameTextureShader=!1,this._vb=null,this._texs.length=0,this._vbPos.length=0,this._isSameTexture=!0},i.addTexture=function(t,e){this._texsID[this._texs.length]=t._uvID,this._texs.push(t),this._vbPos.push(e)},i.checkTexture=function(){if(this._texs.length<1)return void(this._isSameTexture=!0);var t=this.shaderValue.textureHost,e=t.bitmap;if(null!==e)for(var i=this._vb.getFloat32Array(),s=0,n=this._texs.length;n>s;s++){var a=this._texs[s];a.active();var o=a.uv;if(this._texsID[s]!==a._uvID){this._texsID[s]=a._uvID;var r=this._vbPos[s];i[r+2]=o[0],i[r+3]=o[1],i[r+6]=o[2],i[r+7]=o[3],i[r+10]=o[4],i[r+11]=o[5],i[r+14]=o[6],i[r+15]=o[7],this._vb.setNeedUpload()}a.bitmap!==e&&(this._isSameTexture=!1)}},i.renderSubmit=function(){if(0===this._numEle)return e._shaderSet=!1,1;var t=this.shaderValue.textureHost;if(t){var i=t.source;if(!t.bitmap||!i)return e._shaderSet=!1,1;this.shaderValue.texture=i}this._vb.bind_upload(this._ib);var s=pt.mainContext;if(U.activeBlendFunction!==this._blendFn&&(s.enable(3042),this._blendFn(s),U.activeBlendFunction=this._blendFn),k.drawCall++,k.trianglesFaces+=this._numEle/3,this._preIsSameTextureShader&&Lt.activeShader&&e._shaderSet?Lt.activeShader.uploadTexture2D(this.shaderValue.texture):this.shaderValue.upload(),e._shaderSet=!0,this._texs.length>1&&!this._isSameTexture)for(var n=t.bitmap,a=0,o=Lt.activeShader,r=0,h=this._texs.length;h>r;r++){var l=this._texs[r];l.bitmap===n&&r+1!==h||(o.uploadTexture2D(l.source),s.drawElements(4,6*(r-a+1),5123,this._startIdx+6*a*lt.BYTES_PIDX),n=l.bitmap,a=r)}else s.drawElements(4,this._numEle,5123,this._startIdx);return 1},e.create=function(t,i,s,n,a){var o=e._cache._length?e._cache[--e._cache._length]:new e;null==s&&(s=o._selfVb||(o._selfVb=jt.create(-1)),s.clear(),n=0),o._ib=i,o._vb=s,o._startIdx=n*lt.BYTES_PIDX,o._numEle=0;var r=t._nBlendType;o._blendFn=t._targets?U.targetFns[r]:U.fns[r],o.shaderValue=a,o.shaderValue.setValue(t._shader2D);var h=t._shader2D.filters;return h&&o.shaderValue.setFilters(h),o},e._cache=(e._cache=[],e._cache._length=0,e._cache),e._shaderSet=!0,e}(Z),Lt=function(t){function e(){e.__super.call(this)}return n(e,"laya.webgl.shader.BaseShader",t),e.activeShader=null,e.bindShader=null,e}(S),kt=function(t){function e(t,i,s,n,a,o,r,h,l){this._type=0,this._svWidth=NaN,this._svHeight=NaN,this._preRenderTarget=null,this._alreadyResolved=!1,this._looked=!1,this._surfaceFormat=0,this._surfaceType=0,this._depthStencilFormat=0,this._mipMap=!1,this._repeat=!1,this._minFifter=0,this._magFifter=0,this._destroy=!1,void 0===s&&(s=6408),void 0===n&&(n=5121),void 0===a&&(a=34041),void 0===o&&(o=!1),void 0===r&&(r=!1),void 0===h&&(h=-1),void 0===l&&(l=-1),this._type=1,this._w=t,this._h=i,this._surfaceFormat=s,this._surfaceType=n,this._depthStencilFormat=a,this._mipMap=o,this._repeat=r,this._minFifter=h,this._magFifter=l,this._createWebGLRenderTarget(),this.bitmap.lock=!0,e.__super.call(this,this.bitmap,A.INV_UV)}n(e,"laya.webgl.resource.RenderTarget2D",t);var s=e.prototype;return i.imps(s,{"laya.resource.IDispose":!0}),s.getType=function(){return this._type},s.getTexture=function(){return this},s.size=function(t,e){this._w==t&&this._h==e||(this._w=t,this._h=e,this.release(),0!=this._w&&0!=this._h&&this._createWebGLRenderTarget())},s.release=function(){this.destroy()},s.recycle=function(){e.POOL.push(this)},s.start=function(){var t=pt.mainContext;return this._preRenderTarget=dt.curRenderTarget,dt.curRenderTarget=this,t.bindFramebuffer(36160,this.bitmap.frameBuffer),this._alreadyResolved=!1,1==this._type&&(t.viewport(0,0,this._w,this._h),this._svWidth=dt.width,this._svHeight=dt.height,dt.width=this._w,dt.height=this._h,Lt.activeShader=null),this},s.clear=function(t,e,i,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=1);var n=pt.mainContext;n.clearColor(t,e,i,s);var a=16384;switch(this._depthStencilFormat){case 33189:a|=256;break;case 36168:a|=1024;break;case 34041:a|=256,a|=1024}n.clear(a)},s.end=function(){var t=pt.mainContext;t.bindFramebuffer(36160,this._preRenderTarget?this._preRenderTarget.bitmap.frameBuffer:null),this._alreadyResolved=!0,dt.curRenderTarget=this._preRenderTarget,1==this._type?(t.viewport(0,0,this._svWidth,this._svHeight),dt.width=this._svWidth,dt.height=this._svHeight,Lt.activeShader=null):t.viewport(0,0,i.stage.width,i.stage.height)},s.getData=function(t,e,i,s){var n=pt.mainContext;n.bindFramebuffer(36160,this.bitmap.frameBuffer);var a=36053===n.checkFramebufferStatus(36160);if(!a)return n.bindFramebuffer(36160,null),null;var o=new Uint8Array(this._w*this._h*4);return n.readPixels(t,e,i,s,this._surfaceFormat,this._surfaceType,o),n.bindFramebuffer(36160,null),o},s.destroy=function(e){void 0===e&&(e=!1),this._destroy||(this._loaded=!1,this.bitmap.dispose(),this.bitmap=null,this._alreadyResolved=!1,this._destroy=!0,t.prototype.destroy.call(this))},s.dispose=function(){},s._createWebGLRenderTarget=function(){this.bitmap=new Nt(this.width,this.height,this._surfaceFormat,this._surfaceType,this._depthStencilFormat,this._mipMap,this._repeat,this._minFifter,this._magFifter),this.bitmap.activeResource(),this._alreadyResolved=!0,this._destroy=!1,this._loaded=!0,this.bitmap.on("recovered",this,function(t){this.event("recovered")})},a(0,s,"surfaceFormat",function(){return this._surfaceFormat}),a(0,s,"magFifter",function(){return this._magFifter}),a(0,s,"surfaceType",function(){return this._surfaceType}),a(0,s,"mipMap",function(){return this._mipMap}),a(0,s,"depthStencilFormat",function(){return this._depthStencilFormat}),a(0,s,"minFifter",function(){return this._minFifter}),a(0,s,"source",function(){return this._alreadyResolved?t.prototype._$get_source.call(this):null}),e.create=function(t,i,s,n,a,o,r,h,l){void 0===s&&(s=6408),void 0===n&&(n=5121),void 0===a&&(a=34041),void 0===o&&(o=!1),void 0===r&&(r=!1),void 0===h&&(h=-1),void 0===l&&(l=-1);var c=e.POOL.pop();return c||(c=new e(t,i)),c.bitmap&&c._w==t&&c._h==i&&c._surfaceFormat==s&&c._surfaceType==n&&c._depthStencilFormat==a&&c._mipMap==o&&c._repeat==r&&c._minFifter==h&&c._magFifter==l||(c._w=t,c._h=i,c._surfaceFormat=s,c._surfaceType=n,c._depthStencilFormat=a,c._mipMap=o,c._repeat=r,c._minFifter=h,c._magFifter=l,c.release(),c._createWebGLRenderTarget()),c},e.TYPE2D=1,e.TYPE3D=2,e.POOL=[],e}(A),Et=function(t){function e(){this._glBuffer=null,this._buffer=null,this._bufferType=0,this._bufferUsage=0,this._byteLength=0,e.__super.call(this),e._gl=pt.mainContext}n(e,"laya.webgl.utils.Buffer",t);var i=e.prototype;return i._bind=function(){this.activeResource(),e._bindActive[this._bufferType]===this._glBuffer||(e._gl.bindBuffer(this._bufferType,e._bindActive[this._bufferType]=this._glBuffer),Lt.activeShader=null)},i.recreateResource=function(){this.startCreate(),this._glBuffer||(this._glBuffer=e._gl.createBuffer()),this.completeCreate()},i.detoryResource=function(){this._glBuffer&&(pt.mainContext.deleteBuffer(this._glBuffer),this._glBuffer=null),this.memorySize=0},i.dispose=function(){this.resourceManager.removeResource(this),t.prototype.dispose.call(this)},a(0,i,"byteLength",function(){return this._byteLength}),a(0,i,"bufferType",function(){return this._bufferType}),a(0,i,"bufferUsage",function(){return this._bufferUsage}),e._gl=null,e._bindActive={},e}(S),Dt=function(t){function e(t){this.texcoord=null,this.offsetX=300,this.offsetY=0,e.__super.call(this,512,0);var i=8*lt.BYTES_PE;this.position=[2,5126,!1,i,0],this.texcoord=[2,5126,!1,i,2*lt.BYTES_PE],this.color=[4,5126,!1,i,4*lt.BYTES_PE]}return n(e,"laya.webgl.shader.d2.skinAnishader.SkinSV",t),e}(mt),At=function(t){function e(t){e.__super.call(this,2,0),this.color=[]}n(e,"laya.webgl.shader.d2.value.Color2dSV",t);var i=e.prototype;return i.setValue=function(t){t.fillStyle&&(this.color=t.fillStyle._color._color),t.strokeStyle&&(this.color=t.strokeStyle._color._color);
},e}(mt),Bt=function(t){function e(t){this.u_colorMatrix=null,this.strength=0,this.colorMat=null,this.colorAlpha=null,this.u_TexRange=[0,1,0,1],this.u_offset=[0,0],this.texcoord=mt._TEXCOORD,e.__super.call(this,256,0)}n(e,"laya.webgl.shader.d2.value.FillTextureSV",t);var i=e.prototype;return i.setValue=function(t){this.ALPHA=t.ALPHA,t.filters&&this.setFilters(t.filters)},i.clear=function(){this.texture=null,this.shader=null,this.defines.setValue(0)},e}(mt),Pt=function(t){function e(t){this.u_colorMatrix=null,this.strength=0,this.blurInfo=null,this.colorMat=null,this.colorAlpha=null,this.texcoord=mt._TEXCOORD,void 0===t&&(t=0),e.__super.call(this,1,t)}n(e,"laya.webgl.shader.d2.value.TextureSV",t);var i=e.prototype;return i.setValue=function(t){this.ALPHA=t.ALPHA,t.filters&&this.setFilters(t.filters)},i.clear=function(){this.texture=null,this.shader=null,this.defines.setValue(0)},e}(mt),Mt=function(t){function e(t){this.a_color=null,this.u_pos=[0,0],e.__super.call(this,4,0),this.position=[2,5126,!1,5*lt.BYTES_PE,0],this.a_color=[3,5126,!1,5*lt.BYTES_PE,2*lt.BYTES_PE]}return n(e,"laya.webgl.shader.d2.value.PrimitiveSV",t),e}(mt),Rt=function(t){function e(){this._flashCacheImage=null,this._flashCacheImageNeedFlush=!1,e.__super.call(this)}n(e,"laya.webgl.atlas.AtlasWebGLCanvas",t);var i=e.prototype;return i.recreateResource=function(){this.startCreate();var t=pt.mainContext,e=this._source=t.createTexture(),i=_t.curBindTexTarget,s=_t.curBindTexValue;_t.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,this._w,this._h,0,6408,5121,null),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),i&&s&&_t.bindTexture(t,i,s),this.memorySize=this._w*this._h*4,this.completeCreate()},i.detoryResource=function(){this._source&&(pt.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},i.texSubImage2D=function(t,e,i){if(x.isFlash){this._flashCacheImage||(this._flashCacheImage=m.create(""),this._flashCacheImage.image.createCanvas(this._w,this._h));var s=i.bitmapdata;t-1>=0&&this._flashCacheImage.image.copyPixels(s,0,0,s.width-1,s.height,t,e),t+1<=this._w&&this._flashCacheImage.image.copyPixels(s,0,0,s.width+1,s.height,t,e),e-1>=0&&this._flashCacheImage.image.copyPixels(s,0,0,s.width,s.height-1,t,e),e+1<=this._h&&this._flashCacheImage.image.copyPixels(s,0,0,s.width+1,s.height,t,e),this._flashCacheImage.image.copyPixels(s,0,0,s.width,s.height,t,e),this._flashCacheImageNeedFlush||(this._flashCacheImageNeedFlush=!0)}else{var n=pt.mainContext,a=_t.curBindTexTarget,o=_t.curBindTexValue;_t.bindTexture(n,3553,this._source),t-1>=0&&n.texSubImage2D(3553,0,t-1,e,6408,5121,i),t+1<=this._w&&n.texSubImage2D(3553,0,t+1,e,6408,5121,i),e-1>=0&&n.texSubImage2D(3553,0,t,e-1,6408,5121,i),e+1<=this._h&&n.texSubImage2D(3553,0,t,e+1,6408,5121,i),n.texSubImage2D(3553,0,t,e,6408,5121,i),a&&o&&_t.bindTexture(n,a,o)}},i.texSubImage2DPixel=function(t,e,i,s,n){var a=pt.mainContext,o=_t.curBindTexTarget,r=_t.curBindTexValue;_t.bindTexture(a,3553,this._source);var h=new Uint8Array(n.data);a.texSubImage2D(3553,0,t,e,i,s,6408,5121,h),o&&r&&_t.bindTexture(a,o,r)},a(0,i,"width",t.prototype._$get_width,function(t){this._w=t}),a(0,i,"height",t.prototype._$get_height,function(t){this._h=t}),e}(l),Ot=function(t){function e(){e.__super.call(this)}n(e,"laya.webgl.resource.WebGLCanvas",t);var i=e.prototype;return i.getCanvas=function(){return this._canvas},i.clear=function(){this._ctx&&this._ctx.clear()},i.destroy=function(){this._ctx&&this._ctx.destroy(),this._ctx=null},i._setContext=function(t){this._ctx=t},i.getContext=function(t,i){return this._ctx?this._ctx:this._ctx=e._createContext(this)},i.size=function(t,e){this._w==t&&this._h==e||(this._w=t,this._h=e,this._ctx&&this._ctx.size(t,e),this._canvas&&(this._canvas.height=e,this._canvas.width=t))},i.recreateResource=function(){this.startCreate(),this.createWebGlTexture(),this.completeCreate()},i.detoryResource=function(){this._source&&!this.iscpuSource&&(pt.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},i.createWebGlTexture=function(){var t=pt.mainContext;if(!this._canvas)throw"create GLTextur err:no data:"+this._canvas;var e=this._source=t.createTexture();this.iscpuSource=!1;var i=_t.curBindTexTarget,s=_t.curBindTexValue;_t.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,6408,5121,this._canvas),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10241,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),this.memorySize=this._w*this._h*4,i&&s&&_t.bindTexture(t,i,s)},i.texSubImage2D=function(t,e,i){var s=pt.mainContext,n=_t.curBindTexTarget,a=_t.curBindTexValue;_t.bindTexture(s,3553,this._source),s.texSubImage2D(3553,0,e,i,6408,5121,t._source),n&&a&&_t.bindTexture(s,n,a)},a(0,i,"context",function(){return this._ctx}),a(0,i,"asBitmap",null,function(t){this._ctx&&(this._ctx.asBitmap=t)}),e._createContext=null,e}(l),Ft=function(t){function e(t,i){this.CborderSize=12,e.__super.call(this),this["char"]=t,this.isSpace=" "===t,this.xs=i.scaleX,this.ys=i.scaleY,this.font=i.font.toString(),this.fontSize=i.font.size,this.fillColor=i.fillColor,this.borderColor=i.borderColor,this.lineWidth=i.lineWidth;var s,n=x.isConchApp;n?(s=ConchTextCanvas,s._source=ConchTextCanvas,s._source.canvas=ConchTextCanvas):s=c.canvas.source,this.canvas=s,this._enableMerageInAtlas=!0,n?this._ctx=s:this._ctx=this.canvas.getContext("2d",void 0);var a=B.measureText(this["char"],this.font);this.cw=a.width*this.xs,this.ch=(a.height||this.fontSize)*this.ys,this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.texture=new A(this)}n(e,"laya.webgl.resource.WebGLCharImage",t);var s=e.prototype;return i.imps(s,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),s.active=function(){this.texture.active()},s.recreateResource=function(){this.startCreate();var t=x.isConchApp;if(this.onresize(this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this.canvas&&(this.canvas.height=this._h,this.canvas.width=this._w),t){var e=this.fontSize;1==this.xs&&1==this.ys||(e=parseInt(e*(this.xs>this.ys?this.xs:this.ys)+""));var i="normal 100 "+e+"px Arial";this.borderColor&&(i+=" 1 "+this.borderColor),this._ctx.font=i,this._ctx.textBaseline="top",this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this["char"],this.CborderSize,this.CborderSize,null,null,null)}else this._ctx.save(),this._ctx.clearRect(0,0,this.cw+2*this.CborderSize,this.ch+2*this.CborderSize),this._ctx.font=this.font,this._ctx.textBaseline="top",this._ctx.translate(this.CborderSize,this.CborderSize),1==this.xs&&1==this.ys||this._ctx.scale(this.xs,this.ys),this.fillColor&&this.borderColor?(this._ctx.strokeStyle=this.borderColor,this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this["char"],0,0,null,null,0,null),this._ctx.fillStyle=this.fillColor,this._ctx.fillText(this["char"],0,0,null,null,null)):-1===this.lineWidth?(this._ctx.fillStyle=this.fillColor?this.fillColor:"white",this._ctx.fillText(this["char"],0,0,null,null,null)):(this._ctx.strokeStyle=this.borderColor?this.borderColor:"white",this._ctx.lineWidth=this.lineWidth,this._ctx.strokeText(this["char"],0,0,null,null,0,null)),this._ctx.restore();this.borderSize=this.CborderSize,this.completeCreate()},s.onresize=function(t,e){this._w=t,this._h=e,this._w<F.atlasLimitWidth&&this._h<F.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},s.clearAtlasSource=function(){},a(0,s,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),a(0,s,"atlasSource",function(){return this.canvas}),a(0,s,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(t){this._enableMerageInAtlas=t}),e.createOneChar=function(t,i){var s=new e(t,i);return s},e}(l),Nt=function(t){function e(t,i,s,n,a,o,r,h,l){void 0===s&&(s=6408),void 0===n&&(n=5121),void 0===a&&(a=34041),void 0===o&&(o=!1),void 0===r&&(r=!1),void 0===h&&(h=-1),void 0===l&&(l=1),e.__super.call(this),this._w=t,this._h=i,this._surfaceFormat=s,this._surfaceType=n,this._depthStencilFormat=a,this._mipMap=o,this._repeat=r,this._minFifter=h,this._magFifter=l}n(e,"laya.webgl.resource.WebGLRenderTarget",t);var i=e.prototype;return i.recreateResource=function(){this.startCreate();var t=pt.mainContext;this._frameBuffer||(this._frameBuffer=t.createFramebuffer()),this._source||(this._source=t.createTexture());var e=_t.curBindTexTarget,i=_t.curBindTexValue;_t.bindTexture(t,3553,this._source),t.texImage2D(3553,0,6408,this._w,this._h,0,this._surfaceFormat,this._surfaceType,null);var s=this._minFifter,n=this._magFifter,a=this._repeat?10497:33071,o=r.isPOT(this._w,this._h);if(o?(this._mipMap?-1!==s||(s=9987):-1!==s||(s=9729),-1!==n||(n=9729),t.texParameteri(3553,10241,s),t.texParameteri(3553,10240,n),t.texParameteri(3553,10242,a),t.texParameteri(3553,10243,a),this._mipMap&&t.generateMipmap(3553)):(-1!==s||(s=9729),-1!==n||(n=9729),t.texParameteri(3553,10241,s),t.texParameteri(3553,10240,n),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),t.bindFramebuffer(36160,this._frameBuffer),t.framebufferTexture2D(36160,36064,3553,this._source,0),this._depthStencilFormat)switch(this._depthStencilBuffer||(this._depthStencilBuffer=t.createRenderbuffer()),t.bindRenderbuffer(36161,this._depthStencilBuffer),t.renderbufferStorage(36161,this._depthStencilFormat,this._w,this._h),this._depthStencilFormat){case 33189:t.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 36168:t.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 34041:t.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer)}t.bindFramebuffer(36160,null),e&&i&&_t.bindTexture(t,e,i),t.bindRenderbuffer(36161,null),this.memorySize=this._w*this._h*4,this.completeCreate()},i.detoryResource=function(){this._frameBuffer&&(pt.mainContext.deleteTexture(this._source),pt.mainContext.deleteFramebuffer(this._frameBuffer),pt.mainContext.deleteRenderbuffer(this._depthStencilBuffer),this._source=null,this._frameBuffer=null,this._depthStencilBuffer=null,this.memorySize=0)},a(0,i,"depthStencilBuffer",function(){return this._depthStencilBuffer}),a(0,i,"frameBuffer",function(){return this._frameBuffer}),e}(l),Ut=function(t){function e(t,i,s,n,a,o,r){this.offsetX=0,this.offsetY=0,e.__super.call(this),this.repeat=!0,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,this.atlasImage=o,this.canvas=t,this._ctx=t.getContext("2d",void 0),this._w=n,this._h=a,this.offsetX=i,this.offsetY=s,this.src=r,this._enableMerageInAtlas=!0,F.enabled&&this._w<F.atlasLimitWidth&&this._h<F.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1}n(e,"laya.webgl.resource.WebGLSubImage",t);var s=e.prototype;return i.imps(s,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),s.size=function(t,e){this._w=t,this._h=e,this._ctx&&this._ctx.size(t,e),this.canvas&&(this.canvas.height=e,this.canvas.width=t)},s.recreateResource=function(){this.startCreate(),this.size(this._w,this._h),this._ctx.drawImage(this.atlasImage,this.offsetX,this.offsetY,this._w,this._h,0,0,this._w,this._h),this._allowMerageInAtlas&&this._enableMerageInAtlas?this.memorySize=0:this.createWebGlTexture(),this.completeCreate()},s.createWebGlTexture=function(){var t=pt.mainContext;if(!this.canvas)throw"create GLTextur err:no data:"+this.canvas;var e=this._source=t.createTexture(),i=_t.curBindTexTarget,s=_t.curBindTexValue;_t.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,6408,5121,this.canvas);var n=this.minFifter,a=this.magFifter,o=this.repeat?10497:33071,h=r.isPOT(this.width,this.height);h?(this.mipmap?-1!==n||(n=9987):-1!==n||(n=9729),-1!==a||(a=9729),t.texParameteri(3553,10240,a),t.texParameteri(3553,10241,n),t.texParameteri(3553,10242,o),t.texParameteri(3553,10243,o),this.mipmap&&t.generateMipmap(3553)):(-1!==n||(n=9729),-1!==a||(a=9729),t.texParameteri(3553,10241,n),t.texParameteri(3553,10240,a),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),i&&s&&_t.bindTexture(t,i,s),this.canvas=null,this.memorySize=this._w*this._h*4},s.detoryResource=function(){F.enabled&&this._allowMerageInAtlas||!this._source||(pt.mainContext.deleteTexture(this._source),this._source=null,this.memorySize=0)},s.clearAtlasSource=function(){},s.dispose=function(){this.resourceManager.removeResource(this),t.prototype.dispose.call(this)},a(0,s,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),a(0,s,"atlasSource",function(){return this.canvas}),a(0,s,"enableMerageInAtlas",function(){return this._allowMerageInAtlas},function(t){this._allowMerageInAtlas=t}),e}(l),Ht=function(t){function e(t,i,s,n){if(this.customCompile=!1,this._curActTexIndex=0,this.tag={},this._program=null,this._params=null,this._paramsMap={},this._offset=0,e.__super.call(this),!t||!i)throw"Shader Error";(x.isConchApp||x.isFlash)&&(this.customCompile=!0),this._id=++e._count,this._vs=t,this._ps=i,this._nameMap=n?n:{},null!=s&&(e.sharders[s]=this)}n(e,"laya.webgl.shader.Shader",t);var i=e.prototype;return i.recreateResource=function(){this.startCreate(),this._compile(),this.completeCreate(),this.memorySize=0},i.detoryResource=function(){pt.mainContext.deleteShader(this._vshader),pt.mainContext.deleteShader(this._pshader),pt.mainContext.deleteProgram(this._program),this._vshader=this._pshader=this._program=null,this._params=null,this._paramsMap={},this.memorySize=0,this._curActTexIndex=0},i._compile=function(){if(this._vs&&this._ps&&!this._params){this._reCompile=!0,this._params=[];var t,i=[this._vs,this._ps];this.customCompile&&(t=this._preGetParams(this._vs,this._ps));var s=pt.mainContext;if(this._program=s.createProgram(),this._vshader=e._createShader(s,i[0],35633),this._pshader=e._createShader(s,i[1],35632),s.attachShader(this._program,this._vshader),s.attachShader(this._program,this._pshader),s.linkProgram(this._program),!this.customCompile&&!s.getProgramParameter(this._program,35714))throw s.getProgramInfoLog(this._program);var n,a,o=0,r=0,h=this.customCompile?t.attributes.length:s.getProgramParameter(this._program,35721);for(o=0;h>o;o++){var l=this.customCompile?t.attributes[o]:s.getActiveAttrib(this._program,o);a=s.getAttribLocation(this._program,l.name),n={vartype:"attribute",ivartype:0,attrib:l,location:a,name:l.name,type:l.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},this._params.push(n)}var c=this.customCompile?t.uniforms.length:s.getProgramParameter(this._program,35718);for(o=0;c>o;o++){var d=this.customCompile?t.uniforms[o]:s.getActiveUniform(this._program,o);a=s.getUniformLocation(this._program,d.name),n={vartype:"uniform",ivartype:1,attrib:l,location:a,name:d.name,type:d.type,isArray:!1,isSame:!1,preValue:null,indexOfParams:0},n.name.indexOf("[0]")>0&&(n.name=n.name.substr(0,n.name.length-3),n.isArray=!0,n.location=s.getUniformLocation(this._program,n.name)),this._params.push(n)}for(o=0,r=this._params.length;r>o;o++)if(n=this._params[o],n.indexOfParams=o,n.index=1,n.value=[n.location,null],n.codename=n.name,n.name=this._nameMap[n.codename]?this._nameMap[n.codename]:n.codename,this._paramsMap[n.name]=n,n._this=this,n.uploadedValue=[],"attribute"!==n.vartype)switch(n.type){case 5124:n.fun=n.isArray?this._uniform1iv:this._uniform1i;break;case 5126:n.fun=n.isArray?this._uniform1fv:this._uniform1f;break;case 35664:n.fun=n.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:n.fun=n.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:n.fun=n.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:n.fun=this._uniform_sampler2D;break;case 35680:n.fun=this._uniform_samplerCube;break;case 35676:n.fun=this._uniformMatrix4fv;break;case 35670:n.fun=this._uniform1i;break;case 35674:case 35675:throw new Error("compile shader err!");default:throw new Error("compile shader err!")}else n.fun=this._attribute}},i.getUniform=function(t){return this._paramsMap[t]},i._attribute=function(t,e){var i=pt.mainContext;return i.enableVertexAttribArray(t.location),i.vertexAttribPointer(t.location,e[0],e[1],e[2],e[3],e[4]+this._offset),2},i._uniform1f=function(t,e){var i=t.uploadedValue;return i[0]!==e?(pt.mainContext.uniform1f(t.location,i[0]=e),1):0},i._uniform1fv=function(t,e){if(e.length<4){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(pt.mainContext.uniform1fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return pt.mainContext.uniform1fv(t.location,e),1},i._uniform_vec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(pt.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]),1):0},i._uniform_vec2v=function(t,e){if(e.length<2){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(pt.mainContext.uniform2fv(t.location,e),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],1):0}return pt.mainContext.uniform2fv(t.location,e),1},i._uniform_vec3=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(pt.mainContext.uniform3f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},i._uniform_vec3v=function(t,e){return pt.mainContext.uniform3fv(t.location,e),1},i._uniform_vec4=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(pt.mainContext.uniform4f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},i._uniform_vec4v=function(t,e){return pt.mainContext.uniform4fv(t.location,e),1},i._uniformMatrix2fv=function(t,e){return pt.mainContext.uniformMatrix2fv(t.location,!1,e),1},i._uniformMatrix3fv=function(t,e){return pt.mainContext.uniformMatrix3fv(t.location,!1,e),1},i._uniformMatrix4fv=function(t,e){return pt.mainContext.uniformMatrix4fv(t.location,!1,e),1},i._uniform1i=function(t,e){var i=t.uploadedValue;return i[0]!==e?(pt.mainContext.uniform1i(t.location,i[0]=e),1):0},i._uniform1iv=function(t,e){return pt.mainContext.uniform1iv(t.location,e),1},i._uniform_ivec2=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]?(pt.mainContext.uniform2i(t.location,i[0]=e[0],i[1]=e[1]),1):0},i._uniform_ivec2v=function(t,e){return pt.mainContext.uniform2iv(t.location,e),1},i._uniform_vec3i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]?(pt.mainContext.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]),1):0},i._uniform_vec3vi=function(t,e){return pt.mainContext.uniform3iv(t.location,e),1},i._uniform_vec4i=function(t,e){var i=t.uploadedValue;return i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]?(pt.mainContext.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]),1):0},i._uniform_vec4vi=function(t,e){return pt.mainContext.uniform4iv(t.location,e),1},i._uniform_sampler2D=function(t,i){var s=pt.mainContext,n=t.uploadedValue;return null==n[0]?(n[0]=this._curActTexIndex,s.uniform1i(t.location,this._curActTexIndex),s.activeTexture(e._TEXTURES[this._curActTexIndex]),_t.bindTexture(s,3553,i),this._curActTexIndex++,1):(s.activeTexture(e._TEXTURES[n[0]]),_t.bindTexture(s,3553,i),0)},i._uniform_samplerCube=function(t,i){var s=pt.mainContext,n=t.uploadedValue;return null==n[0]?(n[0]=this._curActTexIndex,s.uniform1i(t.location,this._curActTexIndex),s.activeTexture(e._TEXTURES[this._curActTexIndex]),_t.bindTexture(s,34067,i),this._curActTexIndex++,1):(s.activeTexture(e._TEXTURES[n[0]]),_t.bindTexture(s,34067,i),0)},i._noSetValue=function(t){console.log("no....:"+t.name)},i.uploadOne=function(t,e){this.activeResource(),_t.UseProgram(this._program);var i=this._paramsMap[t];i.fun.call(this,i,e)},i.uploadTexture2D=function(t){k.shaderCall++;var e=pt.mainContext;e.activeTexture(33984),_t.bindTexture(e,3553,t)},i.upload=function(t,e){Lt.activeShader=this,Lt.bindShader=this,this.activeResource(),_t.UseProgram(this._program),this._reCompile?(e=this._params,this._reCompile=!1):e=e||this._params;for(var i,s,n=e.length,a=0,o=0;n>o;o++)i=e[o],null!==(s=t[i.name])&&(a+=i.fun.call(this,i,s));k.shaderCall+=a},i.uploadArray=function(t,e,i){Lt.activeShader=this,Lt.bindShader=this,this.activeResource(),_t.UseProgram(this._program);for(var s,n,a=(this._params,0),o=e-2;o>=0;o-=2)n=this._paramsMap[t[o]],n&&(s=t[o+1],null!=s&&(i&&i[n.name]&&i[n.name].bind(),a+=n.fun.call(this,n,s)));k.shaderCall+=a},i.getParams=function(){return this._params},i._preGetParams=function(t,e){var i=[t,e],s={},n=[],a=[],o={},r=[];s.attributes=n,s.uniforms=a,s.defines=o;for(var h=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g"),l=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g"),c=0,d=0,u=0;2>u;u++){i[u]=i[u].replace(h,"");var p,_=i[u].match(l);for(c=0,d=_.length;d>c;c++){var f=_[c];if("attribute"==f||"uniform"==f)c=this.parseOne(n,a,_,c,f,!0);else{if("#define"==f){f=_[++c],r[f]=1;continue}if("#ifdef"==f){p=_[++c];o[p]=o[p]||[];for(c++;d>c;c++)if(f=_[c],"attribute"==f||"uniform"==f)c=this.parseOne(n,a,_,c,f,r[p]);else if("#else"==f)for(c++;d>c;c++)if(f=_[c],"attribute"==f||"uniform"==f)c=this.parseOne(n,a,_,c,f,!r[p]);else if("#endif"==f)break}}}}return s},i.parseOne=function(t,i,s,n,a,o){var r={type:e.shaderParamsMap[s[n+1]],name:s[n+2],size:isNaN(parseInt(s[n+3]))?1:parseInt(s[n+3])};return o&&("attribute"==a?t.push(r):i.push(r)),":"==s[n+3]&&(r.type=s[n+4],n+=2),n+=2},i.dispose=function(){this.resourceManager.removeResource(this),laya.resource.Resource.prototype.dispose.call(this)},e.getShader=function(t){return e.sharders[t]},e.create=function(t,i,s,n){return new e(t,i,s,n)},e.withCompile=function(t,i,s,n){if(s&&e.sharders[s])return e.sharders[s];var a=e._preCompileShader[2e-4*t];if(!a)throw new Error("withCompile shader err!"+t);return a.createShader(i,s,n)},e.withCompile2D=function(t,i,s,n,a){if(n&&e.sharders[n])return e.sharders[n];var o=e._preCompileShader[2e-4*t+i];if(!o)throw new Error("withCompile shader err!"+t+" "+i);return o.createShader(s,n,a)},e.addInclude=function(t,i){if(!i||0===i.length)throw new Error("add shader include file err:"+t);if(e._includeFiles[t])throw new Error("add shader include file err, has add:"+t);e._includeFiles[t]=i},e.preCompile=function(t,i,s,n){var a=2e-4*t;e._preCompileShader[a]=new ut(a,i,s,n,e._includeFiles)},e.preCompile2D=function(t,i,s,n,a){var o=2e-4*t+i;e._preCompileShader[o]=new ut(o,s,n,a,e._includeFiles)},e._createShader=function(t,e,i){var s=t.createShader(i);if(t.shaderSource(s,e),t.compileShader(s),!t.getShaderParameter(s,35713))throw t.getShaderInfoLog(s);return s},e._TEXTURES=[33984,33985,33986,33987,33988,33989,33990,,33991,33992],e._includeFiles={},e._count=0,e._preCompileShader={},e.SHADERNAME2ID=2e-4,e.sharders=(e.sharders=[],e.sharders.length=32,e.sharders),s(e,["shaderParamsMap",function(){return this.shaderParamsMap={"float":5126,"int":5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"nameKey",function(){return this.nameKey=new E}]),e}(Lt),Gt=function(t){function e(){this._maxsize=0,this._upload=!0,this._uploadSize=0,e.__super.call(this),this.lock=!0}n(e,"laya.webgl.utils.Buffer2D",t);var i=e.prototype;return i._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength),k.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,Et._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),Et._gl.bufferSubData(this._bufferType,0,this._buffer)},i._bufferSubData=function(t,e,i){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._maxsize=Math.max(this._maxsize,this._byteLength),k.loopCount%30==0&&(this._buffer.byteLength>this._maxsize+64&&(this.memorySize=this._buffer.byteLength,this._buffer=this._buffer.slice(0,this._maxsize+64),this._checkArrayUse()),this._maxsize=this._byteLength),this._uploadSize<this._buffer.byteLength&&(this._uploadSize=this._buffer.byteLength,Et._gl.bufferData(this._bufferType,this._uploadSize,this._bufferUsage),this.memorySize=this._uploadSize),e||i){var s=this._buffer.slice(e,i);Et._gl.bufferSubData(this._bufferType,t,s)}else Et._gl.bufferSubData(this._bufferType,t,this._buffer)},i._checkArrayUse=function(){},i._bind_upload=function(){return this._upload?(this._upload=!1,this._bind(),this._bufferData(),!0):!1},i._bind_subUpload=function(t,e,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this._upload?(this._upload=!1,this._bind(),this._bufferSubData(t,e,i),!0):!1},i._resizeBuffer=function(t,e){if(t<this._buffer.byteLength)return this;if(this.memorySize=t,e&&this._buffer&&this._buffer.byteLength>0){var i=new ArrayBuffer(t),s=new Uint8Array(i);s.set(new Uint8Array(this._buffer),0),this._buffer=i}else this._buffer=new ArrayBuffer(t);return this._checkArrayUse(),this._upload=!0,this},i.append=function(t){this._upload=!0;var e,i=0;i=t.byteLength,t instanceof Uint8Array?(this._resizeBuffer(this._byteLength+i,!0),e=new Uint8Array(this._buffer,this._byteLength)):t instanceof Uint16Array?(this._resizeBuffer(this._byteLength+i,!0),e=new Uint16Array(this._buffer,this._byteLength)):t instanceof Float32Array&&(this._resizeBuffer(this._byteLength+i,!0),e=new Float32Array(this._buffer,this._byteLength)),e.set(t,0),this._byteLength+=i,this._checkArrayUse()},i.appendEx=function(t,e){this._upload=!0;var i,s=0;s=t.byteLength,this._resizeBuffer(this._byteLength+s,!0),i=new e(this._buffer,this._byteLength),i.set(t,0),this._byteLength+=s,this._checkArrayUse()},i.appendEx2=function(t,e,i,s){void 0===s&&(s=1),this._upload=!0;var n,a=0;a=i*s,this._resizeBuffer(this._byteLength+a,!0),n=new e(this._buffer,this._byteLength);var o=0;for(o=0;i>o;o++)n[o]=t[o];this._byteLength+=a,this._checkArrayUse()},i.getBuffer=function(){return this._buffer},i.setNeedUpload=function(){this._upload=!0},i.getNeedUpload=function(){return this._upload},i.upload=function(){var t=this._bind_upload();return Et._gl.bindBuffer(this._bufferType,null),Et._bindActive[this._bufferType]=null,Lt.activeShader=null,t},i.subUpload=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0);var s=this._bind_subUpload();return Et._gl.bindBuffer(this._bufferType,null),Et._bindActive[this._bufferType]=null,Lt.activeShader=null,s},i.detoryResource=function(){t.prototype.detoryResource.call(this),this._upload=!0,this._uploadSize=0},i.clear=function(){this._byteLength=0,this._upload=!0},a(0,i,"bufferLength",function(){return this._buffer.byteLength}),a(0,i,"byteLength",t.prototype._$get_byteLength,function(t){this._byteLength!==t&&(t<=this._buffer.byteLength||this._resizeBuffer(2*t+256,!0),this._byteLength=t)}),e.__int__=function(t){Kt.QuadrangleIB=Kt.create(35044),ct.fillIBQuadrangle(Kt.QuadrangleIB,16)},e.FLOAT32=4,e.SHORT=2,e}(Et),Wt=(function(t){function e(t){this.u_blurX=!1,this.u_color=null,this.u_offset=null,this.u_strength=NaN,this.u_texW=0,this.u_texH=0,e.__super.call(this,9)}n(e,"laya.webgl.shader.d2.value.GlowSV",t);var i=e.prototype;return i.setValue=function(e){t.prototype.setValue.call(this,e)},i.clear=function(){t.prototype.clear.call(this)},e}(Pt),function(t){function e(t){e.__super.call(this,64),this.defines.add(64)}n(e,"laya.webgl.shader.d2.value.TextSV",t);var i=e.prototype;return i.release=function(){e.pool[e._length++]=this,this.clear()},i.clear=function(){t.prototype.clear.call(this)},e.create=function(){return e._length?e.pool[--e._length]:new e(null)},e.pool=[],e._length=0,e}(Pt)),Vt=function(t){function e(t,i,s,n){this._params2dQuick1=null,this._params2dQuick2=null,this._shaderValueWidth=NaN,this._shaderValueHeight=NaN,e.__super.call(this,t,i,s,n)}n(e,"laya.webgl.shader.d2.Shader2X",t);var i=e.prototype;return i.upload2dQuick1=function(t){this.upload(t,this._params2dQuick1||this._make2dQuick1())},i._make2dQuick1=function(){if(!this._params2dQuick1){this.activeResource(),this._params2dQuick1=[];for(var t,e=this._params,i=0,s=e.length;s>i;i++)t=e[i],(x.isFlash||"size"!==t.name&&"position"!==t.name&&"texcoord"!==t.name)&&this._params2dQuick1.push(t)}return this._params2dQuick1},i.detoryResource=function(){t.prototype.detoryResource.call(this),this._params2dQuick1=null,this._params2dQuick2=null},i.upload2dQuick2=function(t){this.upload(t,this._params2dQuick2||this._make2dQuick2())},i._make2dQuick2=function(){if(!this._params2dQuick2){this.activeResource(),this._params2dQuick2=[];for(var t,e=this._params,i=0,s=e.length;s>i;i++)t=e[i],(x.isFlash||"size"!==t.name)&&this._params2dQuick2.push(t)}return this._params2dQuick2},e.create=function(t,i,s,n){return new e(t,i,s,n)},e}(Ht),Kt=function(t){function e(t){this._uint8Array=null,this._uint16Array=null,void 0===t&&(t=35044),e.__super.call(this),this._bufferUsage=t,this._bufferType=34963,x.isFlash||(this._buffer=new ArrayBuffer(8))}n(e,"laya.webgl.utils.IndexBuffer2D",t);var i=e.prototype;return i._checkArrayUse=function(){this._uint8Array&&(this._uint8Array=new Uint8Array(this._buffer)),this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))},i.getUint8Array=function(){return this._uint8Array||(this._uint8Array=new Uint8Array(this._buffer))},i.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))},e.QuadrangleIB=null,e.create=function(t){return void 0===t&&(t=35044),new e(t)},e}(Gt),jt=function(t){function e(t,i){this._floatArray32=null,this._vertexStride=0,e.__super.call(this),this._vertexStride=t,this._bufferUsage=i,this._bufferType=34962,x.isFlash||(this._buffer=new ArrayBuffer(8)),this.getFloat32Array()}n(e,"laya.webgl.utils.VertexBuffer2D",t);var i=e.prototype;return i.getFloat32Array=function(){return this._floatArray32||(this._floatArray32=new Float32Array(this._buffer))},i.bind=function(t){t&&t._bind(),this._bind()},i.insertData=function(t,e){var i=this.getFloat32Array();i.set(t,e),this._upload=!0},i.bind_upload=function(t){t._bind_upload()||t._bind(),this._bind_upload()||this._bind()},i._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer))},i.detoryResource=function(){t.prototype.detoryResource.call(this);for(var e=0;10>e;e++)pt.mainContext.disableVertexAttribArray(e)},a(0,i,"vertexStride",function(){return this._vertexStride}),e.create=function(t,i){return void 0===i&&(i=35048),new e(t,i)},e}(Gt),Xt=function(t){function e(t,i){this._image=null,this._allowMerageInAtlas=!1,this._enableMerageInAtlas=!1,this.repeat=!1,this.mipmap=!1,this.minFifter=0,this.magFifter=0,e.__super.call(this,t,i),this.repeat=!1,this.mipmap=!1,this.minFifter=-1,this.magFifter=-1,"string"==typeof t?(this._src=t,this._image=new c.window.Image,i&&(i.onload&&(this.onload=i.onload),i.onerror&&(this.onerror=i.onerror),i.onCreate&&i.onCreate(this)),this._image.crossOrigin=t&&0==t.indexOf("data:")?null:"",t&&(this._image.src=t)):(this._src=i,this._image=t.source,this.onresize()),this._enableMerageInAtlas=!0}n(e,"laya.webgl.resource.WebGLImage",t);var s=e.prototype;return i.imps(s,{"laya.webgl.resource.IMergeAtlasBitmap":!0}),s._init_=function(t,e){},s._createWebGlTexture=function(){if(!this._image)throw"create GLTextur err:no data:"+this._image;var t=pt.mainContext,e=this._source=t.createTexture(),i=_t.curBindTexTarget,s=_t.curBindTexValue;_t.bindTexture(t,3553,e),t.texImage2D(3553,0,6408,6408,5121,this._image);var n=this.minFifter,a=this.magFifter,o=this.repeat?10497:33071,h=r.isPOT(this._w,this._h);h?(this.mipmap?-1!==n||(n=9987):-1!==n||(n=9729),-1!==a||(a=9729),t.texParameteri(3553,10241,n),t.texParameteri(3553,10240,a),t.texParameteri(3553,10242,o),t.texParameteri(3553,10243,o),this.mipmap&&t.generateMipmap(3553)):(-1!==n||(n=9729),-1!==a||(a=9729),t.texParameteri(3553,10241,n),t.texParameteri(3553,10240,a),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071)),i&&s&&_t.bindTexture(t,i,s),this._image.onload=function(){},this._image=null,h?this.memorySize=this._w*this._h*4*(1+1/3):this.memorySize=this._w*this._h*4,this._recreateLock=!1},s.recreateResource=function(){var t=this;if(null!=this._src&&""!==this._src)if(this._needReleaseAgain=!1,
this._image){if(this._recreateLock)return;this.startCreate(),this._allowMerageInAtlas&&this._enableMerageInAtlas?(this.memorySize=0,this._recreateLock=!1):this._createWebGlTexture(),this.completeCreate()}else{this._recreateLock=!0,this.startCreate();var e=this;this._image=new c.window.Image,this._image.crossOrigin=0==this._src.indexOf("data:")?null:"",this._image.onload=function(){return e._needReleaseAgain?(e._needReleaseAgain=!1,e._image.onload=function(){},void(e._image=null)):(e._allowMerageInAtlas&&e._enableMerageInAtlas?(t.memorySize=0,t._recreateLock=!1):e._createWebGlTexture(),void e.completeCreate())},this._image.src=this._src}},s.detoryResource=function(){this._recreateLock&&(this._needReleaseAgain=!0),this._source&&(pt.mainContext.deleteTexture(this._source),this._source=null,this._image=null,this.memorySize=0)},s.onresize=function(){this._w=this._image.width,this._h=this._image.height,F.enabled&&this._w<F.atlasLimitWidth&&this._h<F.atlasLimitHeight?this._allowMerageInAtlas=!0:this._allowMerageInAtlas=!1},s.clearAtlasSource=function(){this._image=null},a(0,s,"image",function(){return this._image}),a(0,s,"allowMerageInAtlas",function(){return this._allowMerageInAtlas}),a(0,s,"atlasSource",function(){return this._image}),a(0,s,"enableMerageInAtlas",function(){return this._enableMerageInAtlas},function(t){this._enableMerageInAtlas=t}),a(0,s,"onload",null,function(t){var e=this;this._onload=t,this._image&&(null!=this._onload?this._image.onload=function(){e.onresize(),e._onload()}:this._image.onload=function(){})}),a(0,s,"onerror",null,function(t){var e=this;this._onerror=t,this._image&&(null!=this._onerror?this._image.onerror=function(){e._onerror()}:this._image.onerror=function(){})}),e}(m);i.__init([rt,O,yt,ut])}(window,document,Laya),function(t,e,i){var s=(i.un,i.uns,i["static"]),n=i["class"],a=i.getset,o=i.__newvec,r=laya.maths.Bezier,h=laya.utils.Browser,l=laya.utils.Byte,c=(laya.events.Event,laya.events.EventDispatcher),d=laya.display.Graphics,u=laya.resource.HTMLCanvas,p=laya.utils.Handler,_=laya.net.Loader,f=laya.maths.MathUtil,y=laya.maths.Matrix,m=(laya.display.Node,laya.maths.Point,laya.maths.Rectangle),g=laya.renders.Render,v=(laya.renders.RenderContext,laya.resource.Resource),C=laya.utils.RunDriver,w=laya.display.Sprite,x=laya.utils.Stat,b=laya.resource.Texture,S=laya.net.URL,I=laya.utils.Utils,T=function(){function t(){this.nodes=null,this.name=null,this.playTime=NaN,this.bone3DMap=null,this.totalKeyframeDatasLength=0}return n(t,"laya.ani.AnimationContent"),t}(),L=function(){function t(){this.name=null,this.parentIndex=0,this.parent=null,this.keyframeWidth=0,this.lerpType=0,this.interpolationMethod=null,this.childs=null,this.keyFrame=null,this.playTime=NaN,this.extenData=null,this.dataOffset=0}return n(t,"laya.ani.AnimationNodeContent"),t}(),k=function(){function t(){}return n(t,"laya.ani.AnimationParser01"),t.parse=function(t,e){var i=e.__getBuffer(),s=0,n=0,a=0,o=0,r=0,h=0,c=0,d=e.readUTFString();t._aniClassName=d;var u,p=e.readUTFString().split("\n"),_=e.getUint8(),f=e.getUint32(),y=e.getUint32();f>0&&(u=i.slice(f,y));var m=new l(u);for(y>0&&(t._publicExtData=i.slice(y,i.byteLength)),t._useParent=!!e.getUint8(),t._anis.length=_,s=0;_>s;s++){var g=t._anis[s]=new T;g.nodes=new Array;var v=g.name=p[e.getUint16()];t._aniMap[v]=s,g.bone3DMap={},g.playTime=e.getFloat32();var C=g.nodes.length=e.getUint8();for(g.totalKeyframeDatasLength=0,n=0;C>n;n++){var w=g.nodes[n]=new L;w.childs=[];var x=e.getInt16();x>=0&&(w.name=p[x],g.bone3DMap[w.name]=n),w.keyFrame=new Array,w.parentIndex=e.getInt16(),-1==w.parentIndex?w.parent=null:w.parent=g.nodes[w.parentIndex],w.lerpType=e.getUint8();var b=e.getUint32();m.pos=b;var S=w.keyframeWidth=m.getUint16();if(g.totalKeyframeDatasLength+=S,0===w.lerpType||1===w.lerpType)for(w.interpolationMethod=[],w.interpolationMethod.length=S,a=0;S>a;a++)w.interpolationMethod[a]=it.interpolation[m.getUint8()];null!=w.parent&&w.parent.childs.push(w);var I=e.getUint16();I>0&&(w.extenData=i.slice(e.pos,e.pos+I),e.pos+=I);var k=e.getUint16();w.keyFrame.length=k;var E,D=0;for(a=0,o=k;o>a;a++){if(E=w.keyFrame[a]=new Q,E.duration=e.getFloat32(),E.startTime=D,2===w.lerpType){E.interpolationData=[];var A=e.getUint8(),B=0;switch(B=e.getFloat32()){case 254:for(E.interpolationData.length=S,c=0;S>c;c++)E.interpolationData[c]=0;break;case 255:for(E.interpolationData.length=S,c=0;S>c;c++)E.interpolationData[c]=5;break;default:for(E.interpolationData.push(B),h=1;A>h;h++)E.interpolationData.push(e.getFloat32())}}for(E.data=new Float32Array(S),E.dData=new Float32Array(S),E.nextData=new Float32Array(S),r=0;S>r;r++)E.data[r]=e.getFloat32(),E.data[r]>-1e-8&&E.data[r]<1e-8&&(E.data[r]=0);D+=E.duration}E.startTime=g.playTime,w.playTime=g.playTime,t._calculateKeyFrame(w,k,S)}}},t}(),E=function(){function t(){}return n(t,"laya.ani.AnimationParser02"),t.READ_DATA=function(){t._DATA.offset=t._reader.getUint32(),t._DATA.size=t._reader.getUint32()},t.READ_BLOCK=function(){for(var e=t._BLOCK.count=t._reader.getUint16(),i=t._BLOCK.blockStarts=[],s=t._BLOCK.blockLengths=[],n=0;e>n;n++)i.push(t._reader.getUint32()),s.push(t._reader.getUint32())},t.READ_STRINGS=function(){var e=t._reader.getUint32(),i=t._reader.getUint16(),s=t._reader.pos;t._reader.pos=e+t._DATA.offset;for(var n=0;i>n;n++)t._strings[n]=t._reader.readUTFString();t._reader.pos=s},t.parse=function(e,i){t._templet=e,t._reader=i;i.__getBuffer();t.READ_DATA(),t.READ_BLOCK(),t.READ_STRINGS();for(var s=0,n=t._BLOCK.count;n>s;s++){var a=i.getUint16(),o=t._strings[a],r=t["READ_"+o];if(null==r)throw new Error("model file err,no this function:"+a+" "+o);r.call()}},t.READ_ANIMATIONS=function(){var e=t._reader,i=e.__getBuffer(),s=0,n=0,a=0,o=0,r=e.getUint16(),h=[];for(h.length=r,s=0;r>s;s++)h[s]=it.interpolation[e.getByte()];var l=e.getUint8();for(t._templet._anis.length=l,s=0;l>s;s++){var c=t._templet._anis[s]={};c.nodes=new Array;var d=c.name=t._strings[e.getUint16()];t._templet._aniMap[d]=s,c.bone3DMap={},c.playTime=e.getFloat32();var u=c.nodes.length=e.getInt16();for(c.totalKeyframeDatasLength=0,n=0;u>n;n++){var p=c.nodes[n]={};p.keyframeWidth=r,p.childs=[];var _=e.getUint16();_>=0&&(p.name=t._strings[_],c.bone3DMap[p.name]=n),p.keyFrame=new Array,p.parentIndex=e.getInt16(),-1==p.parentIndex?p.parent=null:p.parent=c.nodes[p.parentIndex],c.totalKeyframeDatasLength+=r,p.interpolationMethod=h,null!=p.parent&&p.parent.childs.push(p);var f=e.getUint16();p.keyFrame.length=f;var y=null,m=null;for(a=0,o=f;o>a;a++){y=p.keyFrame[a]={},y.startTime=e.getFloat32(),m&&(m.duration=y.startTime-m.startTime),y.dData=new Float32Array(r),y.nextData=new Float32Array(r);var g=t._DATA.offset,v=e.getUint32(),C=4*r,w=i.slice(g+v,g+v+C);y.data=new Float32Array(w),m=y}y.duration=0,p.playTime=c.playTime,t._templet._calculateKeyFrame(p,f,r)}}},t._templet=null,t._reader=null,t._strings=[],s(t,["_BLOCK",function(){return this._BLOCK={count:0}},"_DATA",function(){return this._DATA={offset:0,size:0}}]),t}(),D=(function(){function t(){}return n(t,"laya.ani.AnimationState"),t.stopped=0,t.paused=1,t.playing=2,t}(),function(){function t(){this.name=null,this.root=null,this.parentBone=null,this.length=10,this.transform=null,this.inheritScale=!0,this.inheritRotation=!0,this.rotation=NaN,this.resultRotation=NaN,this.d=-1,this._tempMatrix=null,this._sprite=null,this.resultTransform=new z,this.resultMatrix=new y,this._children=[]}n(t,"laya.ani.bone.Bone");var e=t.prototype;return e.setTempMatrix=function(t){this._tempMatrix=t;var e,i=0,s=0;for(i=0,s=this._children.length;s>i;i++)e=this._children[i],e.setTempMatrix(this._tempMatrix)},e.update=function(t){this.rotation=this.transform.skX;var e;if(t)e=this.resultTransform.getMatrix(),y.mul(e,t,this.resultMatrix),this.resultRotation=this.rotation;else if(this.resultRotation=this.rotation+this.parentBone.resultRotation,this.parentBone)if(this.inheritRotation&&this.inheritScale)e=this.resultTransform.getMatrix(),y.mul(e,this.parentBone.resultMatrix,this.resultMatrix);else{var i=this.parentBone,s=NaN,n=NaN,a=NaN,o=this.parentBone.resultMatrix;e=this.resultTransform.getMatrix();var r=o.a*e.tx+o.c*e.ty+o.tx,h=o.b*e.tx+o.d*e.ty+o.ty,l=new y;this.inheritRotation?(s=Math.atan2(i.resultMatrix.b,i.resultMatrix.a),n=Math.cos(s),a=Math.sin(s),l.setTo(n,a,-a,n,0,0),y.mul(this._tempMatrix,l,y.TEMP),y.TEMP.copyTo(l),e=this.resultTransform.getMatrix(),y.mul(e,l,this.resultMatrix),this.resultMatrix.tx=r,this.resultMatrix.ty=h):this.inheritScale?(e=this.resultTransform.getMatrix(),y.TEMP.identity(),y.TEMP.d=this.d,y.mul(e,y.TEMP,this.resultMatrix),this.resultMatrix.tx=r,this.resultMatrix.ty=h):(e=this.resultTransform.getMatrix(),y.TEMP.identity(),y.TEMP.d=this.d,y.mul(e,y.TEMP,this.resultMatrix),this.resultMatrix.tx=r,this.resultMatrix.ty=h)}else e=this.resultTransform.getMatrix(),e.copyTo(this.resultMatrix);var c,d=0,u=0;for(d=0,u=this._children.length;u>d;d++)c=this._children[d],c.update()},e.updateChild=function(){var t,e=0,i=0;for(e=0,i=this._children.length;i>e;e++)t=this._children[e],t.update()},e.setRotation=function(t){this._sprite&&(this._sprite.rotation=180*t/Math.PI)},e.updateDraw=function(e,s){t.ShowBones&&!t.ShowBones[this.name]||(this._sprite?(this._sprite.x=e+this.resultMatrix.tx,this._sprite.y=s+this.resultMatrix.ty):(this._sprite=new w,this._sprite.graphics.drawCircle(0,0,5,"#ff0000"),this._sprite.graphics.drawLine(0,0,this.length,0,"#00ff00"),this._sprite.graphics.fillText(this.name,0,0,"20px Arial","#00ff00","center"),i.stage.addChild(this._sprite),this._sprite.x=e+this.resultMatrix.tx,this._sprite.y=s+this.resultMatrix.ty));var n,a=0,o=0;for(a=0,o=this._children.length;o>a;a++)n=this._children[a],n.updateDraw(e,s)},e.addChild=function(t){this._children.push(t),t.parentBone=this},e.findBone=function(t){if(this.name==t)return this;var e,i,s=0,n=0;for(s=0,n=this._children.length;n>s;s++)if(e=this._children[s],i=e.findBone(t))return i;return null},e.localToWorld=function(t){var e=t[0],i=t[1];t[0]=e*this.resultMatrix.a+i*this.resultMatrix.c+this.resultMatrix.tx,t[1]=e*this.resultMatrix.b+i*this.resultMatrix.d+this.resultMatrix.ty},t.ShowBones={},t}()),A=function(){function t(){this.name=null,this.parent=null,this.attachmentName=null,this.srcDisplayIndex=-1,this.type="src",this.templet=null,this.currSlotData=null,this.currTexture=null,this.currDisplayData=null,this.displayIndex=-1,this._diyTexture=null,this._parentMatrix=null,this._resultMatrix=null,this._replaceDic={},this._curDiyUV=null,this._curDiyVS=null,this._skinSprite=null,this.deformData=null,this._mVerticleArr=null}n(t,"laya.ani.bone.BoneSlot");var e=t.prototype;return e.showSlotData=function(t,e){void 0===e&&(e=!0),this.currSlotData=t,e&&(this.displayIndex=this.srcDisplayIndex),this.currDisplayData=null,this.currTexture=null},e.showDisplayByName=function(t){this.currSlotData&&this.showDisplayByIndex(this.currSlotData.getDisplayByName(t))},e.replaceDisplayByName=function(t,e){if(this.currSlotData){var i=0;i=this.currSlotData.getDisplayByName(t);var s=0;s=this.currSlotData.getDisplayByName(e),this.replaceDisplayByIndex(i,s)}},e.replaceDisplayByIndex=function(t,e){this.currSlotData&&(this._replaceDic[t]=e,this.displayIndex==t&&this.showDisplayByIndex(t))},e.showDisplayByIndex=function(t){if(this._replaceDic[t]&&(t=this._replaceDic[t]),this.currSlotData&&t>-1&&t<this.currSlotData.displayArr.length){if(this.displayIndex=t,this.currDisplayData=this.currSlotData.displayArr[t],this.currDisplayData){var e=this.currDisplayData.name;this.currTexture=this.templet.getTexture(e),this.currTexture&&g.isWebGL&&0==this.currDisplayData.type&&this.currDisplayData.uvs&&(this.currTexture=this.currDisplayData.createTexture(this.currTexture))}}else this.displayIndex=-1,this.currDisplayData=null,this.currTexture=null},e.replaceSkin=function(t){this._diyTexture=t,this._curDiyUV&&(this._curDiyUV.length=0),this.currDisplayData&&this._diyTexture==this.currDisplayData.texture&&(this._diyTexture=null)},e.setParentMatrix=function(t){this._parentMatrix=t},e.draw=function(e,i,s,n){if(void 0===s&&(s=!1),void 0===n&&(n=1),(null!=this._diyTexture||null!=this.currTexture)&&null!=this.currDisplayData||this.currDisplayData&&3==this.currDisplayData.type){var a=this.currTexture;this._diyTexture&&(a=this._diyTexture);var o;switch(this.currDisplayData.type){case 0:if(e){var r=this.getDisplayMatrix();if(this._parentMatrix){var h=!1;if(r){y.mul(r,this._parentMatrix,y.TEMP);var l;if(s?(null==this._resultMatrix&&(this._resultMatrix=new y),l=this._resultMatrix):l=new y,!g.isWebGL&&this.currDisplayData.uvs||g.isWebGL&&this._diyTexture&&this.currDisplayData.uvs){var c=t._tempMatrix;c.identity(),this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(c.d=-1),this.currDisplayData.uvs[0]>this.currDisplayData.uvs[4]&&this.currDisplayData.uvs[1]>this.currDisplayData.uvs[5]&&(h=!0,c.rotate(-Math.PI/2)),y.mul(c,y.TEMP,l)}else y.TEMP.copyTo(l);h?e.drawTexture(a,-this.currDisplayData.height/2,-this.currDisplayData.width/2,this.currDisplayData.height,this.currDisplayData.width,l):e.drawTexture(a,-this.currDisplayData.width/2,-this.currDisplayData.height/2,this.currDisplayData.width,this.currDisplayData.height,l)}}}break;case 1:if(s?(null==this._skinSprite&&(this._skinSprite=t.createSkinMesh()),o=this._skinSprite):o=t.createSkinMesh(),null==o)return;var d;if(null==this.currDisplayData.bones){var u=this.currDisplayData.weights;this.deformData&&(u=this.deformData);var p;this._diyTexture?(this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=J.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=J.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),p=this._curDiyUV):p=this.currDisplayData.uvs,this._mVerticleArr=u;this.currDisplayData.triangles.length/3;d=this.currDisplayData.triangles,o.init2(a,null,d,this._mVerticleArr,p);var _=this.getDisplayMatrix();if(this._parentMatrix&&_){y.mul(_,this._parentMatrix,y.TEMP);var f;s?(null==this._resultMatrix&&(this._resultMatrix=new y),f=this._resultMatrix):f=new y,y.TEMP.copyTo(f),o.transform=f}}else this.skinMesh(i,o,n);e.drawSkin(o);break;case 2:if(s?(null==this._skinSprite&&(this._skinSprite=t.createSkinMesh()),o=this._skinSprite):o=t.createSkinMesh(),null==o)return;this.skinMesh(i,o,n),e.drawSkin(o);break;case 3:}}},e.skinMesh=function(t,e,i){var s,n=this.currTexture,a=this.currDisplayData.bones;this._diyTexture?(n=this._diyTexture,this._curDiyUV||(this._curDiyUV=[]),0==this._curDiyUV.length&&(this._curDiyUV=J.getRelativeUV(this.currTexture.uv,this.currDisplayData.uvs,this._curDiyUV),this._curDiyUV=J.getAbsoluteUV(this._diyTexture.uv,this._curDiyUV,this._curDiyUV)),s=this._curDiyUV):s=this.currDisplayData.uvs;var o,r,h=this.currDisplayData.weights,l=this.currDisplayData.triangles,c=0,d=0,u=0,p=NaN,_=NaN,f=0,y=0,m=[],g=0,v=0;if(this.deformData&&this.deformData.length>0){var C=0;for(g=0,v=a.length;v>g;){for(u=a[g++]+g,c=0,d=0;u>g;g++)r=t[a[g]],p=h[f]+this.deformData[C++],_=h[f+1]+this.deformData[C++],y=h[f+2],c+=(p*r.a+_*r.c+r.tx)*y,d+=(p*r.b+_*r.d+r.ty)*y,f+=3;m.push(c,d)}}else for(g=0,v=a.length;v>g;){for(u=a[g++]+g,c=0,d=0;u>g;g++)r=t[a[g]],p=h[f],_=h[f+1],y=h[f+2],c+=(p*r.a+_*r.c+r.tx)*y,d+=(p*r.b+_*r.d+r.ty)*y,f+=3;m.push(c,d)}this._mVerticleArr=m,o=l,e.init2(n,null,o,this._mVerticleArr,s)},e.drawBonePoint=function(t){t&&this._parentMatrix&&t.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},e.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},e.getMatrix=function(){return this._resultMatrix},e.copy=function(){var e=new t;return e.type="copy",e.name=this.name,e.attachmentName=this.attachmentName,e.srcDisplayIndex=this.srcDisplayIndex,e.parent=this.parent,e.displayIndex=this.displayIndex,e.templet=this.templet,e.currSlotData=this.currSlotData,e.currTexture=this.currTexture,e.currDisplayData=this.currDisplayData,e},t.createSkinMesh=function(){return g.isWebGL||g.isConchApp?C.skinAniSprite():g.isWebGL?null:nt.useSimpleMeshInCanvas?new st:new et},s(t,["_tempMatrix",function(){return this._tempMatrix=new y}]),t}(),B=function(){function t(){this.mesh=null,this.transform=null,this.context=null,this.mode=0}n(t,"laya.ani.bone.canvasmesh.CanvasMeshRender");var e=t.prototype;return e.renderToContext=function(t){this.context=t.ctx||t,this.mesh&&(0==this.mode?this._renderWithIndexes(this.mesh):this._renderNoIndexes(this.mesh))},e._renderNoIndexes=function(t){var e=0,i=t.vertices.length/2,s=0;for(e=0;i-2>e;e++)s=2*e,this._renderDrawTriangle(t,s,s+2,s+4)},e._renderWithIndexes=function(t){var e=t.indexes,i=0,s=e.length;for(i=0;s>i;i+=3){var n=2*e[i],a=2*e[i+1],o=2*e[i+2];this._renderDrawTriangle(t,n,a,o)}},e._renderDrawTriangle=function(t,e,i,s){var n=this.context,a=t.uvs,o=t.vertices,r=t.texture,h=r.bitmap,l=h.source,c=r.width,d=r.height,u=h.width,p=h.height,_=NaN,f=NaN,y=NaN,m=NaN,g=NaN,v=NaN;if(t.useUvTransform){var C=t.uvTransform;_=(a[e]*C.a+a[e+1]*C.c+C.tx)*u,f=(a[i]*C.a+a[i+1]*C.c+C.tx)*u,y=(a[s]*C.a+a[s+1]*C.c+C.tx)*u,m=(a[e]*C.b+a[e+1]*C.d+C.ty)*p,g=(a[i]*C.b+a[i+1]*C.d+C.ty)*p,v=(a[s]*C.b+a[s+1]*C.d+C.ty)*p}else _=a[e]*u,f=a[i]*u,y=a[s]*u,m=a[e+1]*p,g=a[i+1]*p,v=a[s+1]*p;var w=o[e],x=o[i],b=o[s],S=o[e+1],I=o[i+1],T=o[s+1];if(t.canvasPadding>0){var L=t.canvasPadding,k=t.canvasPadding,E=(w+x+b)/3,D=(S+I+T)/3,A=w-E,B=S-D,P=Math.sqrt(A*A+B*B);w=E+A/P*(P+L),S=D+B/P*(P+k),A=x-E,B=I-D,P=Math.sqrt(A*A+B*B),x=E+A/P*(P+L),I=D+B/P*(P+k),A=b-E,B=T-D,P=Math.sqrt(A*A+B*B),b=E+A/P*(P+L),T=D+B/P*(P+k)}if(n.save(),this.transform){var M=this.transform;n.transform(M.a,M.b,M.c,M.d,M.tx,M.ty)}n.beginPath(),n.moveTo(w,S),n.lineTo(x,I),n.lineTo(b,T),n.closePath(),n.clip();var R=_*g+m*y+f*v-g*y-m*f-_*v,O=1/R,F=w*g+m*b+x*v-g*b-m*x-w*v,N=_*x+w*y+f*b-x*y-w*f-_*b,U=_*g*b+m*x*y+w*f*v-w*g*y-m*f*b-_*x*v,H=S*g+m*T+I*v-g*T-m*I-S*v,G=_*I+S*y+f*T-I*y-S*f-_*T,W=_*g*T+m*I*y+S*f*v-S*g*y-m*f*T-_*I*v;n.transform(F*O,H*O,N*O,G*O,U*O,W*O),n.drawImage(l,r.uv[0]*u,r.uv[1]*p,c,d,r.uv[0]*u,r.uv[1]*p,c,d),n.restore()},t}(),P=function(){function t(){this.texture=null,this.uvs=[0,0,1,0,1,1,0,1],this.vertices=[0,0,100,0,100,100,0,100],this.indexes=[0,1,3,3,1,2],this.uvTransform=null,this.useUvTransform=!1,this.canvasPadding=1}n(t,"laya.ani.bone.canvasmesh.MeshData");var e=t.prototype;return e.getBounds=function(){return m._getWrapRec(this.vertices)},t}(),M=function(){function t(){this.skinName=null,this.deformSlotDataList=[]}return n(t,"laya.ani.bone.DeformAniData"),t}(),R=function(){function t(){this.deformSlotDisplayList=[]}return n(t,"laya.ani.bone.DeformSlotData"),t}(),O=function(){function t(){this.boneSlot=null,this.slotIndex=-1,this.attachment=null,this.deformData=null,this.frameIndex=0,this.timeList=[],this.vectices=[],this.tweenKeyList=[]}n(t,"laya.ani.bone.DeformSlotDisplayData");var e=t.prototype;return e.binarySearch1=function(t,e){var i=0,s=t.length-2;if(0==s)return 1;for(var n=s>>>1;;){if(t[Math.floor(n+1)]<=e?i=n+1:s=n,i==s)return i+1;n=i+s>>>1}return 0},e.apply=function(t,e,i){if(void 0===i&&(i=1),t+=.05,!(this.timeList.length<=0)){var s=0,n=this.timeList[0];if(!(n>t)){var a=this.vectices[0].length,o=[],r=this.binarySearch1(this.timeList,t);if(this.frameIndex=r,t>=this.timeList[this.timeList.length-1]){var h=this.vectices[this.vectices.length-1];if(1>i)for(s=0;a>s;s++)o[s]+=(h[s]-o[s])*i;else for(s=0;a>s;s++)o[s]=h[s];return void(this.deformData=o)}var l=(this.tweenKeyList[this.frameIndex],this.vectices[this.frameIndex-1]),c=this.vectices[this.frameIndex],d=this.timeList[this.frameIndex-1],u=this.timeList[this.frameIndex];i=this.tweenKeyList[r-1]?(t-d)/(u-d):0;var p=NaN;for(s=0;a>s;s++)p=l[s],o[s]=p+(c[s]-p)*i;this.deformData=o}}},t}(),F=function(){function t(){this.time=NaN,this.drawOrder=[]}return n(t,"laya.ani.bone.DrawOrderData"),t}(),N=function(){function t(){this.name=null,this.intValue=0,this.floatValue=NaN,this.stringValue=null,this.time=NaN}return n(t,"laya.ani.bone.EventData"),t}(),U=function(){function t(t,e){this._targetBone=null,this._bones=null,this._data=null,this.name=null,this.mix=NaN,this.bendDirection=NaN,this.isSpine=!0,this._sp=null,this.isDebug=!1,this._data=t,this._targetBone=e[t.targetBoneIndex],this.isSpine=t.isSpine,null==this._bones&&(this._bones=[]),this._bones.length=0;for(var i=0,s=t.boneIndexs.length;s>i;i++)this._bones.push(e[t.boneIndexs[i]]);this.name=t.name,this.mix=t.mix,this.bendDirection=t.bendDirection}n(t,"laya.ani.bone.IkConstraint");var e=t.prototype;return e.apply=function(){switch(this._bones.length){case 1:this._applyIk1(this._bones[0],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.mix);break;case 2:this.isSpine?this._applyIk2(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix):this._applyIk3(this._bones[0],this._bones[1],this._targetBone.resultMatrix.tx,this._targetBone.resultMatrix.ty,this.bendDirection,this.mix)}},e._applyIk1=function(e,i,s,n){var a=e.parentBone,o=1/(a.resultMatrix.a*a.resultMatrix.d-a.resultMatrix.b*a.resultMatrix.c),r=i-a.resultMatrix.tx,h=s-a.resultMatrix.ty,l=(r*a.resultMatrix.d-h*a.resultMatrix.c)*o-e.transform.x,c=(h*a.resultMatrix.a-r*a.resultMatrix.b)*o-e.transform.y,d=Math.atan2(c,l)*t.radDeg-0-e.transform.skX;e.transform.scX<0&&(d+=180),d>180?d-=360:-180>d&&(d+=360),e.transform.skX=e.transform.skY=e.transform.skX+d*n,e.update()},e.updatePos=function(t,e){this._sp&&this._sp.pos(t,e)},e._applyIk2=function(e,s,n,a,o,r){if(0!=r){var h=e.resultTransform.x,l=e.resultTransform.y,c=e.transform.scX,d=e.transform.scY,u=s.transform.scX,p=0,_=0,f=0;0>c?(c=-c,p=180,f=-1):(p=0,f=1),0>d&&(d=-d,f=-f),0>u?(u=-u,_=180):_=0;var y=s.resultTransform.x,m=NaN,g=NaN,v=NaN,C=e.resultMatrix.a,x=e.resultMatrix.c,b=e.resultMatrix.b,S=e.resultMatrix.d,I=Math.abs(c-d)<=1e-4;I?(m=s.resultTransform.y,g=C*y+x*m+e.resultMatrix.tx,v=b*y+S*m+e.resultMatrix.ty):(m=0,g=C*y+e.resultMatrix.tx,v=b*y+e.resultMatrix.ty),this.isDebug&&(this._sp||(this._sp=new w,i.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(n,a,15,"#ffff00"),this._sp.graphics.drawCircle(g,v,15,"#ff00ff")),e.setRotation(Math.atan2(v-e.resultMatrix.ty,g-e.resultMatrix.tx));var T=e.parentBone;C=T.resultMatrix.a,x=T.resultMatrix.c,b=T.resultMatrix.b,S=T.resultMatrix.d;var L=1/(C*S-x*b),k=n-T.resultMatrix.tx,E=a-T.resultMatrix.ty,D=(k*S-E*x)*L-h,A=(E*C-k*b)*L-l;k=g-T.resultMatrix.tx,E=v-T.resultMatrix.ty;var B=(k*S-E*x)*L-h,P=(E*C-k*b)*L-l,M=Math.sqrt(B*B+P*P),R=s.length*u,O=NaN,F=NaN;if(I){R*=c;var N=(D*D+A*A-M*M-R*R)/(2*M*R);-1>N?N=-1:N>1&&(N=1),F=Math.acos(N)*o,C=M+R*N,x=R*Math.sin(F),O=Math.atan2(A*C-D*x,D*C+A*x)}else{C=c*R,x=d*R;var U=C*C,H=x*x,G=D*D+A*A,W=Math.atan2(A,D);b=H*M*M+U*G-U*H;var V=-2*H*M,K=H-U;if(S=V*V-4*K*b,S>0){var j=Math.sqrt(S);0>V&&(j=-j),j=-(V+j)/2;var X=j/K,Y=b/j,q=Math.abs(X)<Math.abs(Y)?X:Y;G>=q*q&&(E=Math.sqrt(G-q*q)*o,O=W-Math.atan2(E,q),F=Math.atan2(E/d,(q-M)/c))}var z=0,J=Number.MAX_VALUE,Q=0,$=0,Z=0,tt=0,et=0,it=0;k=M+C,S=k*k,S>tt&&(Z=0,tt=S,et=k),k=M-C,S=k*k,J>S&&(z=Math.PI,J=S,Q=k);var st=Math.acos(-C*M/(U-H));k=C*Math.cos(st)+M,E=x*Math.sin(st),S=k*k+E*E,J>S&&(z=st,J=S,Q=k,$=E),S>tt&&(Z=st,tt=S,et=k,it=E),(J+tt)/2>=G?(O=W-Math.atan2($*o,Q),F=z*o):(O=W-Math.atan2(it*o,et),F=Z*o)}var nt=Math.atan2(m,y)*f,at=e.resultTransform.skX;O=(O-nt)*t.radDeg+p-at,O>180?O-=360:-180>O&&(O+=360),e.resultTransform.x=h,e.resultTransform.y=l,e.resultTransform.skX=e.resultTransform.skY=at+O*r,at=s.resultTransform.skX,at%=360,F=((F+nt)*t.radDeg-0)*f+_-at,F>180?F-=360:-180>F&&(F+=360),s.resultTransform.x=y,s.resultTransform.y=m,s.resultTransform.skX=s.resultTransform.skY=s.resultTransform.skY+F*r,e.update()}},e._applyIk3=function(e,s,n,a,o,r){if(0!=r){var h=NaN,l=NaN,c=s.resultMatrix.a*s.length,d=s.resultMatrix.b*s.length,u=c*c+d*d,p=Math.sqrt(u),_=e.resultMatrix.tx,f=e.resultMatrix.ty,y=s.resultMatrix.tx,m=s.resultMatrix.ty,g=y-_,v=m-f,C=g*g+v*v,x=Math.sqrt(C);g=n-e.resultMatrix.tx,v=a-e.resultMatrix.ty;var b=g*g+v*v,S=Math.sqrt(b);if(S>=p+x||x>=S+p||p>=S+x){var I=NaN;I=S>=p+x?1:-1,y=_+I*(n-_)*x/S,m=f+I*(a-f)*x/S}else{var T=(C-u+b)/(2*b),L=Math.sqrt(C-T*T*b)/S,k=_+g*T,E=f+v*T,D=-v*L,A=g*L;o>0?(y=k-D,m=E-A):(y=k+D,m=E+A)}h=y,l=m,this.isDebug&&(this._sp||(this._sp=new w,i.stage.addChild(this._sp)),this._sp.graphics.clear(),this._sp.graphics.drawCircle(_,f,15,"#ff00ff"),this._sp.graphics.drawCircle(n,a,15,"#ffff00"),this._sp.graphics.drawCircle(h,l,15,"#ff00ff"));var B=NaN;B=Math.atan2(l-e.resultMatrix.ty,h-e.resultMatrix.tx),e.setRotation(B);var P;P=t._tempMatrix,P.identity(),P.rotate(B),P.scale(e.resultMatrix.getScaleX(),e.resultMatrix.getScaleY()),P.translate(e.resultMatrix.tx,e.resultMatrix.ty),P.copyTo(e.resultMatrix),e.updateChild();var M=NaN;M=Math.atan2(a-l,n-h),s.setRotation(M);var R;R=t._tempMatrix,R.identity(),R.rotate(M),R.scale(s.resultMatrix.getScaleX(),s.resultMatrix.getScaleY()),R.translate(h,l),P.copyTo(s.resultMatrix),s.updateChild()}},s(t,["radDeg",function(){return this.radDeg=180/Math.PI},"degRad",function(){return this.degRad=Math.PI/180},"_tempMatrix",function(){return this._tempMatrix=new y}]),t}(),H=function(){function t(){this.name=null,this.targetBoneName=null,this.bendDirection=1,this.mix=1,this.isSpine=!0,this.targetBoneIndex=-1,this.boneNames=[],this.boneIndexs=[]}return n(t,"laya.ani.bone.IkConstraintData"),t}(),G=function(){function t(){}return n(t,"laya.ani.bone.MeshTools"),t.findEdge=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!0);var s=0,n=0,a=0;for(n=t.length,a=-1,s=0;n>s;s+=2)(0>a||i==t[a+e]<t[s+e])&&(a=s);return a},t.findBestTriangle=function(e){var i=0;i=t.findEdge(e,1,!0);var s=0;s=t.findEdge(e,1,!1);var n=0;n=t.findEdge(e,0,!0);var a=0;a=t.findEdge(e,0,!1);var o;return o=t._bestTriangle,o.length=0,o.push(n,a),o.indexOf(i)<0&&o.push(i),o.indexOf(s)<0&&o.push(s),o},t.solveMesh=function(e,i){i=i||[],i.length=0;var s;s=e.uvs;var n;n=e.vertices;var a,o;o=t.findBestTriangle(s);var r=0,h=0,l=0;r=o[0],h=o[1],l=o[2],t._absArr.length=0,a=t.solvePoints(e.texture.uv,s[r],s[r+1],s[h]-s[r],s[h+1]-s[r+1],s[l]-s[r],s[l+1]-s[r+1],t._absArr);var c;return c=t.transPoints(a,n[r],n[r+1],n[h]-n[r],n[h+1]-n[r+1],n[l]-n[r],n[l+1]-n[r+1],i)},t.solvePoints=function(e,i,s,n,a,o,r,h){h=h||[];var l=0,c=0;c=e.length;var d;for(l=0;c>l;l+=2)d=t.solve2(e[l],e[l+1],i,s,n,a,o,r),h.push(d[0],d[1]);return h},t.transPoints=function(e,i,s,n,a,o,r,h){h=h||[];var l=0,c=0;c=e.length;var d;for(l=0;c>l;l+=2)d=t.transPoint(e[l],e[l+1],i,s,n,a,o,r,h);return h},t.transPoint=function(t,e,i,s,n,a,o,r,h){h=h||[];var l=NaN,c=NaN;return l=i+n*t+o*e,c=s+a*t+r*e,h.push(l,c),h},t.solve2=function(e,i,s,n,a,o,r,h,l,c){void 0===l&&(l=!1),c=c||[];var d=NaN,u=NaN;if(0==a)return t.solve2(e,i,s,n,r,h,a,o,!0,c);var p=NaN,_=NaN;return p=e-s,_=i-n,u=(_-p*o/a)/(h-r*o/a),d=(p-u*r)/a,l?c.push(u,d):c.push(d,u),c},t.solve=function(e,i,s,n){return t.solve2(e.x,e.y,i.x,i.y,s.x,s.y,n.x,n.y)},t._bestTriangle=[],t._absArr=[],t}(),W=function(){function t(t,e){this.target=null,this.data=null,this.bones=null,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this._debugKey=!1,this._spaces=null,this._segments=[],this._curves=[],this.data=t,this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.bones=[];for(var i=this.data.bones,s=0,n=i.length;n>s;s++)this.bones.push(e[i[s]])}n(t,"laya.ani.bone.PathConstraint");var e=t.prototype;return e.apply=function(t,e){var i=this.translateMix,s=this.translateMix,n=s>0,a=this.data.spacingMode,o="length"==a,r=this.data.rotateMode,h="tangent"==r,l="chainScale"==r,c=[],d=this.bones.length,u=h?d:d+1,p=[];this._spaces=p,p[0]=this.position;var _=this.spacing;if(l||o)for(var f=0,y=u-1;y>f;){var m=this.bones[f],g=m.length,v=g*m.resultMatrix.a,C=g*m.resultMatrix.b;g=Math.sqrt(v*v+C*C),l&&(c[f]=g),p[++f]=o?Math.max(0,g+_):_}else for(f=1;u>f;f++)p[f]=_;var w=this.computeWorldPositions(this.target,t,e,u,h,"percent"==this.data.positionMode,"percent"==a);if(this._debugKey){for(f=0;f<w.length;f++)e.drawCircle(w[f++],w[f++],5,"#00ff00");var x=[];for(f=0;f<w.length;f++)x.push(w[f++],w[f++]);e.drawLines(0,0,x,"#ff0000")}var b=w[0],S=w[1],I=this.data.offsetRotation,T="chain"==r&&0==I,L=NaN;for(f=0,L=3;d>f;f++,L+=3){m=this.bones[f],m.resultMatrix.tx+=(b-m.resultMatrix.tx)*i,m.resultMatrix.ty+=(S-m.resultMatrix.ty)*i,v=w[L],C=w[L+1];var k=v-b,E=C-S;if(l&&(g=c[f],0!=g)){var D=(Math.sqrt(k*k+E*E)/g-1)*s+1;m.resultMatrix.a*=D,m.resultMatrix.c*=D}if(b=v,S=C,n){var A=m.resultMatrix.a,B=m.resultMatrix.c,P=m.resultMatrix.b,M=m.resultMatrix.d,R=NaN,O=NaN,F=NaN;R=h?w[L-1]:0==p[f+1]?w[L+2]:Math.atan2(E,k),R-=Math.atan2(P,A)-I/180*Math.PI,T&&(O=Math.cos(R),F=Math.sin(R),g=m.length,b+=(g*(O*A-F*P)-k)*s,S+=(g*(F*A+O*P)-E)*s),R>Math.PI?R-=2*Math.PI:R<-Math.PI&&(R+=2*Math.PI),R*=s,O=Math.cos(R),F=Math.sin(R),m.resultMatrix.a=O*A-F*P,m.resultMatrix.c=O*B-F*M,m.resultMatrix.b=F*A+O*P,m.resultMatrix.d=F*B+O*M}}},e.computeWorldVertices2=function(e,i,s,n,a,o){var r,h,l=e.currDisplayData.bones,c=e.currDisplayData.weights,d=e.currDisplayData.triangles,u=0,p=0,_=0,f=0,y=0,m=0,g=0,v=0,C=0,w=0;if(null!=l){for(u=0;s>u;u+=2)f=l[p],p+=f+1,_+=f;var x=i;for(y=o,m=3*_;n>y;y+=2){for(g=0,v=0,f=l[p++],f+=p;f>p;p++,m+=3){r=x[l[p]].resultMatrix,C=c[m],w=c[m+1];var b=c[m+2];g+=(C*r.a+w*r.c+r.tx)*b,v+=(C*r.b+w*r.d+r.ty)*b}a[y]=g,a[y+1]=v}}else{d||(d=c),e.deformData&&(d=e.deformData),h=e.parent;var S;S=h.resultMatrix,S||(S=t._tempMt);var I=S.tx,T=S.ty,L=S.a,k=S.b,E=S.c,D=S.d;for(p=s,y=o;n>y;p+=2,y+=2)C=d[p],w=d[p+1],a[y]=C*L+w*k+I,a[y+1]=-(C*E+w*D+T)}},e.computeWorldPositions=function(t,e,i,s,n,a,o){var r=(t.currDisplayData.bones,t.currDisplayData.weights,t.currDisplayData.triangles,[]),h=0,l=t.currDisplayData.verLen,c=this.position,d=this._spaces,u=[],p=[],_=!1,f=l/6,y=-1,m=NaN,g=0,v=0,C=NaN,w=NaN,x=NaN,b=NaN;if(_)l+=2,u[l-2]=u[0],u[l-1]=u[1];else{if(f--,l-=4,this.computeWorldVertices2(t,e,2,l,r,0),this._debugKey)for(h=0;h<r.length;)i.drawCircle(r[h++],r[h++],10,"#ff0000");u=r}this._curves.length=f;var S=this._curves;m=0;var I=u[0],T=u[1],L=0,k=0,E=0,D=0,A=0,B=0,P=NaN,M=NaN,R=NaN,O=NaN,F=NaN,N=NaN,U=NaN,H=NaN,G=0;for(h=0,G=2;f>h;h++,G+=6)L=u[G],k=u[G+1],E=u[G+2],D=u[G+3],A=u[G+4],B=u[G+5],P=.1875*(I-2*L+E),M=.1875*(T-2*k+D),R=.09375*(3*(L-E)-I+A),O=.09375*(3*(k-D)-T+B),F=2*P+R,N=2*M+O,U=.75*(L-I)+P+.16666667*R,H=.75*(k-T)+M+.16666667*O,m+=Math.sqrt(U*U+H*H),U+=F,H+=N,F+=R,N+=O,m+=Math.sqrt(U*U+H*H),U+=F,H+=N,m+=Math.sqrt(U*U+H*H),U+=F+R,H+=N+O,m+=Math.sqrt(U*U+H*H),S[h]=m,I=A,T=B;if(a&&(c*=m),o)for(h=0;s>h;h++)d[h]*=m;var W=this._segments,V=0,K=0;for(h=0,g=0,v=0,K=0;s>h;h++,g+=3){if(w=d[h],c+=w,C=c,_)C%=m,0>C&&(C+=m),v=0;else{if(0>C){this.addBeforePosition(C,u,0,p,g);continue}if(C>m){this.addAfterPosition(C-m,u,l-4,p,g);continue}}for(;;v++)if(b=S[v],!(C>b)){0==v?C/=b:(x=S[v-1],C=(C-x)/(b-x));break}if(v!=y){y=v;var j=6*v;for(I=u[j],T=u[j+1],L=u[j+2],k=u[j+3],E=u[j+4],D=u[j+5],A=u[j+6],B=u[j+7],P=.03*(I-2*L+E),M=.03*(T-2*k+D),R=.006*(3*(L-E)-I+A),O=.006*(3*(k-D)-T+B),F=2*P+R,N=2*M+O,U=.3*(L-I)+P+.16666667*R,H=.3*(k-T)+M+.16666667*O,V=Math.sqrt(U*U+H*H),W[0]=V,j=1;8>j;j++)U+=F,H+=N,F+=R,N+=O,V+=Math.sqrt(U*U+H*H),W[j]=V;U+=F,H+=N,V+=Math.sqrt(U*U+H*H),W[8]=V,U+=F+R,H+=N+O,V+=Math.sqrt(U*U+H*H),W[9]=V,K=0}for(C*=V;;K++)if(b=W[K],!(C>b)){0==K?C/=b:(x=W[K-1],C=K+(C-x)/(b-x));break}this.addCurvePosition(.1*C,I,T,L,k,E,D,A,B,p,g,n||h>0&&0==w)}return p},e.addBeforePosition=function(t,e,i,s,n){var a=e[i],o=e[i+1],r=e[i+2]-a,h=e[i+3]-o,l=Math.atan2(h,r);s[n]=a+t*Math.cos(l),s[n+1]=o+t*Math.sin(l),s[n+2]=l},e.addAfterPosition=function(t,e,i,s,n){var a=e[i+2],o=e[i+3],r=a-e[i],h=o-e[i+1],l=Math.atan2(h,r);s[n]=a+t*Math.cos(l),s[n+1]=o+t*Math.sin(l),s[n+2]=l},e.addCurvePosition=function(t,e,i,s,n,a,o,r,h,l,c,d){0==t&&(t=1e-4);var u=t*t,p=u*t,_=1-t,f=_*_,y=f*_,m=_*t,g=3*m,v=_*g,C=g*t,w=e*y+s*v+a*C+r*p,x=i*y+n*v+o*C+h*p;l[c]=w,l[c+1]=x,d?l[c+2]=Math.atan2(x-(i*f+n*m*2+o*u),w-(e*f+s*m*2+a*u)):l[c+2]=0},t.NONE=-1,t.BEFORE=-2,t.AFTER=-3,s(t,["_tempMt",function(){return this._tempMt=new y}]),t}(),V=function(){function t(){this.name=null,
this.target=null,this.positionMode=null,this.spacingMode=null,this.rotateMode=null,this.offsetRotation=NaN,this.position=NaN,this.spacing=NaN,this.rotateMix=NaN,this.translateMix=NaN,this.bones=[]}return n(t,"laya.ani.bone.PathConstraintData"),t}(),K=function(){function t(){this.name=null,this.slotArr=[]}return n(t,"laya.ani.bone.SkinData"),t}(),j=function(){function t(){this.name=null,this.attachmentName=null,this.type=0,this.transform=null,this.width=NaN,this.height=NaN,this.texture=null,this.bones=null,this.uvs=null,this.weights=null,this.triangles=null,this.vertices=null,this.lengths=null,this.verLen=0}n(t,"laya.ani.bone.SkinSlotDisplayData");var e=t.prototype;return e.createTexture=function(t){return this.texture?this.texture:(this.texture=new b(t.bitmap,this.uvs),this.uvs[0]>this.uvs[4]&&this.uvs[1]>this.uvs[5]?(this.texture.width=t.height,this.texture.height=t.width,this.texture.offsetX=-t.offsetX,this.texture.offsetY=-t.offsetY,this.texture.sourceWidth=t.sourceHeight,this.texture.sourceHeight=t.sourceWidth):(this.texture.width=t.width,this.texture.height=t.height,this.texture.offsetX=-t.offsetX,this.texture.offsetY=-t.offsetY,this.texture.sourceWidth=t.sourceWidth,this.texture.sourceHeight=t.sourceHeight),this.texture)},e.destory=function(){this.texture&&this.texture.destroy()},t}(),X=function(){function t(){this.name=null,this.displayArr=[]}n(t,"laya.ani.bone.SlotData");var e=t.prototype;return e.getDisplayByName=function(t){for(var e,i=0,s=this.displayArr.length;s>i;i++)if(e=this.displayArr[i],e.attachmentName==t)return i;return-1},t}(),Y=function(){function t(t,e){this._data=null,this._bones=null,this.target=null,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this._temp=o(2,0),this._data=t,null==this._bones&&(this._bones=[]),this.target=e[t.targetIndex];var i=0,s=0;for(i=0,s=t.boneIndexs.length;s>i;i++)this._bones.push(e[t.boneIndexs[i]]);this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix}n(t,"laya.ani.bone.TfConstraint");var e=t.prototype;return e.apply=function(){for(var t,e=this.target.resultMatrix.a,i=this.target.resultMatrix.b,s=this.target.resultMatrix.c,n=this.target.resultMatrix.d,a=0,o=this._bones.length;o>a;a++){if(t=this._bones[a],this.rotateMix>0){var r=t.resultMatrix.a,h=t.resultMatrix.b,l=t.resultMatrix.c,c=t.resultMatrix.d,d=Math.atan2(s,e)-Math.atan2(l,r)+this._data.offsetRotation*Math.PI/180;d>Math.PI?d-=2*Math.PI:d<-Math.PI&&(d+=2*Math.PI),d*=this.rotateMix;var u=Math.cos(d),p=Math.sin(d);t.resultMatrix.a=u*r-p*l,t.resultMatrix.b=u*h-p*c,t.resultMatrix.c=p*r+u*l,t.resultMatrix.d=p*h+u*c}if(this.translateMix&&(this._temp[0]=this._data.offsetX,this._temp[1]=this._data.offsetY,this.target.localToWorld(this._temp),t.resultMatrix.tx+=(this._temp[0]-t.resultMatrix.tx)*this.translateMix,t.resultMatrix.ty+=(this._temp[1]-t.resultMatrix.ty)*this.translateMix,t.updateChild()),this.scaleMix>0){var _=Math.sqrt(t.resultMatrix.a*t.resultMatrix.a+t.resultMatrix.c*t.resultMatrix.c),f=Math.sqrt(e*e+s*s),y=_>1e-5?(_+(f-_+this._data.offsetScaleX)*this.scaleMix)/_:0;t.resultMatrix.a*=y,t.resultMatrix.c*=y,_=Math.sqrt(t.resultMatrix.b*t.resultMatrix.b+t.resultMatrix.d*t.resultMatrix.d),f=Math.sqrt(i*i+n*n),y=_>1e-5?(_+(f-_+this._data.offsetScaleY)*this.scaleMix)/_:0,t.resultMatrix.b*=y,t.resultMatrix.d*=y}if(this.shearMix>0){h=t.resultMatrix.b,c=t.resultMatrix.d;var m=Math.atan2(c,h);d=Math.atan2(n,i)-Math.atan2(s,e)-(m-Math.atan2(t.resultMatrix.c,t.resultMatrix.a)),d>Math.PI?d-=2*Math.PI:d<-Math.PI&&(d+=2*Math.PI),d=m+(d+this._data.offsetShearY*Math.PI/180)*this.shearMix,y=Math.sqrt(h*h+c*c),t.resultMatrix.b=Math.cos(d)*y,t.resultMatrix.d=Math.sin(d)*y}}},t}(),q=function(){function t(){this.name=null,this.targetIndex=0,this.rotateMix=NaN,this.translateMix=NaN,this.scaleMix=NaN,this.shearMix=NaN,this.offsetRotation=NaN,this.offsetX=NaN,this.offsetY=NaN,this.offsetScaleX=NaN,this.offsetScaleY=NaN,this.offsetShearY=NaN,this.boneIndexs=[]}return n(t,"laya.ani.bone.TfConstraintData"),t}(),z=function(){function t(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.mMatrix=null}n(t,"laya.ani.bone.Transform");var e=t.prototype;return e.initData=function(t){void 0!=t.x&&(this.x=t.x),void 0!=t.y&&(this.y=t.y),void 0!=t.skX&&(this.skX=t.skX),void 0!=t.skY&&(this.skY=t.skY),void 0!=t.scX&&(this.scX=t.scX),void 0!=t.scY&&(this.scY=t.scY)},e.getMatrix=function(){var t;return t=this.mMatrix?this.mMatrix:this.mMatrix=new y,t.identity(),t.scale(this.scX,this.scY),(this.skewX||this.skewY)&&this.skew(t,this.skewX*Math.PI/180,this.skewY*Math.PI/180),t.rotate(this.skX*Math.PI/180),t.translate(this.x,this.y),t},e.skew=function(t,e,i){var s=Math.sin(i),n=Math.cos(i),a=Math.sin(e),o=Math.cos(e);return t.setTo(t.a*o-t.b*s,t.a*a+t.b*n,t.c*o-t.d*s,t.c*a+t.d*n,t.tx*o-t.ty*s,t.tx*a+t.ty*n),t},t}(),J=function(){function t(){}return n(t,"laya.ani.bone.UVTools"),t.getRelativeUV=function(t,e,i){var s=t[0],n=t[2]-t[0],a=t[1],o=t[5]-t[1];i||(i=[]),i.length=e.length;var r=0,h=0;h=i.length;var l=1/n,c=1/o;for(r=0;h>r;r+=2)i[r]=(e[r]-s)*l,i[r+1]=(e[r+1]-a)*c;return i},t.getAbsoluteUV=function(t,e,i){if(0==t[0]&&0==t[1]&&1==t[4]&&1==t[5])return i?(I.copyArray(i,e),i):e;var s=t[0],n=t[2]-t[0],a=t[1],o=t[5]-t[1];i||(i=[]),i.length=e.length;var r=0,h=0;for(h=i.length,r=0;h>r;r+=2)i[r]=e[r]*n+s,i[r+1]=e[r+1]*o+a;return i},t}(),Q=function(){function t(){this.startTime=NaN,this.duration=NaN,this.interpolationData=null,this.data=null,this.dData=null,this.nextData=null}return n(t,"laya.ani.KeyFramesContent"),t}(),$=function(){function t(){}return n(t,"laya.ani.math.BezierLerp"),t.getBezierRate=function(e,i,s,n,a){var o=t._getBezierParamKey(i,s,n,a),r=100*o+e;if(t._bezierResultCache[r])return t._bezierResultCache[r];var h=t._getBezierPoints(i,s,n,a,o),l=0,c=0;for(c=h.length,l=0;c>l;l+=2)if(e<=h[l])return t._bezierResultCache[r]=h[l+1],h[l+1];return t._bezierResultCache[r]=1,1},t._getBezierParamKey=function(t,e,i,s){return 100*(100*(100*(100*t+e)+i)+s)},t._getBezierPoints=function(e,i,s,n,a){if(t._bezierPointsCache[a])return t._bezierPointsCache[a];var o;o=[0,0,e,i,s,n,1,1];var h;h=new r;var l;return l=h.getBezierPoints(o,100,3),t._bezierPointsCache[a]=l,l},t._bezierResultCache={},t._bezierPointsCache={},t}(),Z=function(t){function e(){this._destroyed=!1,this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._playStart=NaN,this._playEnd=NaN,this._playDuration=NaN,this._overallDuration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startUpdateLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this._cachePlayRate=NaN,this._fullFrames=null,this.isCache=!0,this.playbackRate=1,this.returnToZeroStopped=!1,e.__super.call(this),this._destroyed=!1,this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._overallDuration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startUpdateLoopCount=-1,this._cachePlayRate=1,this.cacheFrameRate=60,this.returnToZeroStopped=!1}n(e,"laya.ani.AnimationPlayer",t);var s=e.prototype;return i.imps(s,{"laya.resource.IDestroy":!0}),s._onTempletLoadedComputeFullKeyframeIndices=function(t,e,i){this._templet===i&&this._cachePlayRate===t&&this._cacheFrameRate===e&&this._computeFullKeyframeIndices()},s._computeFullKeyframeIndices=function(){for(var t=this._fullFrames=[],e=this._templet,i=this._cacheFrameRateInterval*this._cachePlayRate,s=0,n=e.getAnimationCount();n>s;s++){for(var a=[],o=0,r=e.getAnimation(s).nodes.length;r>o;o++){for(var h=e.getAnimation(s).nodes[o],l=Math.floor(h.playTime/i+.01),c=new Uint16Array(l+1),d=-1,u=0,p=h.keyFrame.length;p>u;u++){var _=h.keyFrame[u],f=_.startTime,y=f+_.duration+i;do{for(var m=Math.floor(f/i+.5),g=d+1;m>g;g++)c[g]=u;d=m,c[m]=u,f+=i}while(y>=f)}a.push(c)}t.push(a)}},s._onAnimationTempletLoaded=function(){this.destroyed||this._calculatePlayDuration()},s._calculatePlayDuration=function(){if(0!==this.state){var t=this._templet.getAniDuration(this._currentAnimationClipIndex);0===this._playEnd&&(this._playEnd=t),this._playEnd>t&&(this._playEnd=t),this._playDuration=this._playEnd-this._playStart}},s._setPlayParams=function(t,e){this._currentTime=t,this._currentKeyframeIndex=Math.floor(this.currentPlayTime/e+.01),this._currentFrameTime=this._currentKeyframeIndex*e},s._setPlayParamsWhenStop=function(t,e){this._currentTime=t,this._currentKeyframeIndex=Math.floor(t/e+.01),this._currentFrameTime=this._currentKeyframeIndex*e,this._currentAnimationClipIndex=-1},s._update=function(t){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var e=this._cacheFrameRateInterval*this._cachePlayRate,i=0;this._startUpdateLoopCount!==x.loopCount&&(i=t*this.playbackRate,this._elapsedPlaybackTime+=i);var s=this.playDuration;if(0!==this._overallDuration&&this._elapsedPlaybackTime>=this._overallDuration||0===this._overallDuration&&this._elapsedPlaybackTime>=s)return this._setPlayParamsWhenStop(s,e),void this.event("stopped");if(i+=this._currentTime,s>0)if(i>=s){do{if(i-=s,this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(s,e),this._stopWhenCircleFinish=!1,void this.event("stopped");s>i&&(this._setPlayParams(i,e),this.event("complete"))}while(i>=s)}else this._setPlayParams(i,e);else{if(this._stopWhenCircleFinish)return this._setPlayParamsWhenStop(s,e),this._stopWhenCircleFinish=!1,void this.event("stopped");this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this.event("complete")}}},s._destroy=function(){this.offAll(),this._templet=null,this._fullFrames=null,this._destroyed=!0},s.play=function(t,e,i,s,n){if(void 0===t&&(t=0),void 0===e&&(e=1),void 0===i&&(i=2147483647),void 0===s&&(s=0),void 0===n&&(n=0),!this._templet)throw new Error("AnimationPlayer:templet must not be null,maybe you need to set url.");if(0>i||0>s||0>n)throw new Error("AnimationPlayer:overallDuration,playStart and playEnd must large than zero.");if(0!==n&&s>n)throw new Error("AnimationPlayer:start must less than end.");this._currentTime=0,this._currentFrameTime=0,this._elapsedPlaybackTime=0,this.playbackRate=e,this._overallDuration=i,this._playStart=s,this._playEnd=n,this._paused=!1,this._currentAnimationClipIndex=t,this._currentKeyframeIndex=0,this._startUpdateLoopCount=x.loopCount,this.event("played"),this._templet.loaded?this._calculatePlayDuration():this._templet.once("loaded",this,this._onAnimationTempletLoaded),this._update(0)},s.playByFrame=function(t,e,i,s,n,a){void 0===t&&(t=0),void 0===e&&(e=1),void 0===i&&(i=2147483647),void 0===s&&(s=0),void 0===n&&(n=0),void 0===a&&(a=30);var o=1e3/a;this.play(t,e,i,s*o,n*o)},s.stop=function(t){void 0===t&&(t=!0),t?(this._currentTime=this._currentFrameTime=this._currentKeyframeIndex=0,this._currentAnimationClipIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},a(0,s,"playEnd",function(){return this._playEnd}),a(0,s,"templet",function(){return this._templet},function(t){0===!this.state&&this.stop(!0),this._templet!==t&&(this._templet=t,t.loaded?this._computeFullKeyframeIndices():t.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,this._cacheFrameRate]))}),a(0,s,"playStart",function(){return this._playStart}),a(0,s,"playDuration",function(){return this._playDuration}),a(0,s,"state",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),a(0,s,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),a(0,s,"overallDuration",function(){return this._overallDuration}),a(0,s,"currentFrameTime",function(){return this._currentFrameTime}),a(0,s,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),a(0,s,"currentPlayTime",function(){return this._currentTime+this._playStart}),a(0,s,"cachePlayRate",function(){return this._cachePlayRate},function(t){this._cachePlayRate!==t&&(this._cachePlayRate=t,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[t,this._cacheFrameRate])))}),a(0,s,"cacheFrameRate",function(){return this._cacheFrameRate},function(t){this._cacheFrameRate!==t&&(this._cacheFrameRate=t,this._cacheFrameRateInterval=1e3/this._cacheFrameRate,this._templet&&(this._templet.loaded?this._computeFullKeyframeIndices():this._templet.once("loaded",this,this._onTempletLoadedComputeFullKeyframeIndices,[this._cachePlayRate,t])))}),a(0,s,"currentTime",null,function(t){if(-1!==this._currentAnimationClipIndex&&this._templet&&this._templet.loaded){if(t<this._playStart||t>this._playEnd)throw new Error("AnimationPlayer:value must large than playStartTime,small than playEndTime.");this._startUpdateLoopCount=x.loopCount;var e=this._cacheFrameRateInterval*this._cachePlayRate;this._currentTime=t,this._currentKeyframeIndex=Math.floor(this.currentPlayTime/e),this._currentFrameTime=this._currentKeyframeIndex*e}}),a(0,s,"paused",function(){return this._paused},function(t){this._paused=t,t&&this.event("paused")}),a(0,s,"cacheFrameRateInterval",function(){return this._cacheFrameRateInterval}),a(0,s,"destroyed",function(){return this._destroyed}),e}(c),tt=function(t){function e(){e.__super.call(this),g.isConchNode&&(this.drawSkin=function(t){t.transform||(t.transform=y.EMPTY),this.setSkinMesh&&this.setSkinMesh(t._ps,t.mVBData,t.mEleNum,0,t.mTexture,t.transform)})}n(e,"laya.ani.GraphicsAni",t);var i=e.prototype;return i.drawSkin=function(t){var e=[t];this._saveToCmd(g._context._drawSkin,e)},e}(d),et=function(t){function e(){e.__super.call(this),this.mesh=new P}n(e,"laya.ani.bone.canvasmesh.SkinMeshCanvas",t);var i=e.prototype;return i.init2=function(t,e,i,s,n){this.transform&&(this.transform=null);var a;i?a=i:(a=[],a.push(0,1,3,3,1,2)),this.mesh.texture=t,this.mesh.indexes=a,this.mesh.vertices=s,this.mesh.uvs=n},i.render=function(t,i,s){this.mesh.texture&&(this.transform?(this.transform.translate(i,s),this.renderToContext(t),this.transform.translate(-i,-s)):(this.transform=e._tempMatrix,this.transform.identity(),this.transform.translate(i,s),this.renderToContext(t),this.transform.translate(-i,-s),this.transform=null))},s(e,["_tempMatrix",function(){return this._tempMatrix=new y}]),e}(B),it=function(t){function e(){this._aniMap={},this.unfixedLastAniIndex=-1,e.__super.call(this),this._anis=new Array}n(e,"laya.ani.AnimationTemplet",t);var s=e.prototype;return s.parse=function(t){var e=new l(t);this._aniVersion=e.readUTFString(),k.parse(this,e)},s._endLoaded=function(){this._loaded=!0,this.event("loaded",this)},s._calculateKeyFrame=function(t,e,i){var s=t.keyFrame;s[e]=s[0];for(var n=0;e>n;n++)for(var a=s[n],o=0;i>o;o++)a.dData[o]=0===a.duration?0:(s[n+1].data[o]-a.data[o])/a.duration,a.nextData[o]=s[n+1].data[o];s.length--},s.onAsynLoaded=function(t,e,i){var s=new l(e);switch(this._aniVersion=s.readUTFString(),this._aniVersion){case"LAYAANIMATION:02":E.parse(this,s);break;default:k.parse(this,s)}this._endLoaded()},s.getAnimationCount=function(){return this._anis.length},s.getAnimation=function(t){return this._anis[t]},s.getAniDuration=function(t){return this._anis[t].playTime},s.getNodes=function(t){return this._anis[t].nodes},s.getNodeIndexWithName=function(t,e){return this._anis[t].bone3DMap[e]},s.getNodeCount=function(t){return this._anis[t].nodes.length},s.getTotalkeyframesLength=function(t){return this._anis[t].totalKeyframeDatasLength},s.getPublicExtData=function(){return this._publicExtData},s.getAnimationDataWithCache=function(t,e,i,s){var n=e[i];if(n){var a=n[t];return a?a[s]:null}return null},s.setAnimationDataWithCache=function(t,e,i,s,n){var a=e[i]||(e[i]={}),o=a[t]||(a[t]=[]);o[s]=n},s.getOriginalData=function(t,i,s,n,a){for(var o=this._anis[t],r=o.nodes,h=0,l=0,c=r.length,d=0;c>l;l++){var u,p=r[l];u=p.keyFrame[s[l][n]],p.dataOffset=d;var _=a-u.startTime,f=p.lerpType;if(f)switch(f){case 0:case 1:for(h=0;h<p.keyframeWidth;)h+=p.interpolationMethod[h](p,h,i,d+h,u.data,_,u.dData,u.duration,u.nextData);break;case 2:var y=u.interpolationData,m=y.length,g=0;for(h=0;m>h;){var v=y[h];switch(v){case 6:h+=e.interpolation[v](p,g,i,d+g,u.data,_,u.dData,u.duration,u.nextData,y,h+1);break;case 7:h+=e.interpolation[v](p,g,i,d+g,u.data,_,u.dData,u.duration,u.nextData,y,h+1);break;default:h+=e.interpolation[v](p,g,i,d+g,u.data,_,u.dData,u.duration,u.nextData)}g++}}else for(h=0;h<p.keyframeWidth;)h+=p.interpolationMethod[h](p,h,i,d+h,u.data,_,u.dData,u.duration,u.nextData);d+=p.keyframeWidth}},s.getNodesCurrentFrameIndex=function(t,e){var i=this._anis[t],s=i.nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(s.length),this.unfixedCurrentTimes=new Float32Array(s.length),this.unfixedLastAniIndex=t);for(var n=0,a=s.length;a>n;n++){var o=s[n];for(e<this.unfixedCurrentTimes[n]&&(this.unfixedCurrentFrameIndexes[n]=0),this.unfixedCurrentTimes[n]=e;this.unfixedCurrentFrameIndexes[n]<o.keyFrame.length&&!(o.keyFrame[this.unfixedCurrentFrameIndexes[n]].startTime>this.unfixedCurrentTimes[n]);)this.unfixedCurrentFrameIndexes[n]++;this.unfixedCurrentFrameIndexes[n]--}return this.unfixedCurrentFrameIndexes},s.getOriginalDataUnfixedRate=function(t,i,s){var n=this._anis[t],a=n.nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(a.length),this.unfixedCurrentTimes=new Float32Array(a.length),this.unfixedKeyframes=o(a.length),this.unfixedLastAniIndex=t);for(var r=0,h=0,l=a.length,c=0;l>h;h++){var d=a[h];for(s<this.unfixedCurrentTimes[h]&&(this.unfixedCurrentFrameIndexes[h]=0),this.unfixedCurrentTimes[h]=s;this.unfixedCurrentFrameIndexes[h]<d.keyFrame.length&&!(d.keyFrame[this.unfixedCurrentFrameIndexes[h]].startTime>this.unfixedCurrentTimes[h]);)this.unfixedKeyframes[h]=d.keyFrame[this.unfixedCurrentFrameIndexes[h]],this.unfixedCurrentFrameIndexes[h]++;var u=this.unfixedKeyframes[h];d.dataOffset=c;var p=s-u.startTime,_=d.lerpType;if(_)switch(d.lerpType){case 0:case 1:for(r=0;r<d.keyframeWidth;)r+=d.interpolationMethod[r](d,r,i,c+r,u.data,p,u.dData,u.duration,u.nextData);break;case 2:var f=u.interpolationData,y=f.length,m=0;for(r=0;y>r;){var g=f[r];switch(g){case 6:r+=e.interpolation[g](d,m,i,c+m,u.data,p,u.dData,u.duration,u.nextData,f,r+1);break;case 7:r+=e.interpolation[g](d,m,i,c+m,u.data,p,u.dData,u.duration,u.nextData,f,r+1);break;default:r+=e.interpolation[g](d,m,i,c+m,u.data,p,u.dData,u.duration,u.nextData)}m++}}else for(r=0;r<d.keyframeWidth;)r+=d.interpolationMethod[r](d,r,i,c+r,u.data,p,u.dData,u.duration,u.nextData);c+=d.keyframeWidth}},s.dispose=function(){this.resourceManager&&this.resourceManager.removeResource(this),t.prototype.dispose.call(this)},e._LinearInterpolation_0=function(t,e,i,s,n,a,o,r,h,l){return i[s]=n[e]+a*o[e],1},e._QuaternionInterpolation_1=function(t,e,i,s,n,a,o,r,h,l){var c=0===r?0:a/r;return f.slerpQuaternionArray(n,e,h,e,c,i,s),4},e._AngleInterpolation_2=function(t,e,i,s,n,a,o,r,h,l){return 0},e._RadiansInterpolation_3=function(t,e,i,s,n,a,o,r,h,l){return 0},e._Matrix4x4Interpolation_4=function(t,e,i,s,n,a,o,r,h,l){for(var c=0;16>c;c++,e++)i[s+c]=n[e]+a*o[e];return 16},e._NoInterpolation_5=function(t,e,i,s,n,a,o,r,h,l){return i[s]=n[e],1},e._BezierInterpolation_6=function(t,e,i,s,n,a,o,r,h,l,c){return void 0===c&&(c=0),i[s]=n[e]+(h[e]-n[e])*$.getBezierRate(a/r,l[c],l[c+1],l[c+2],l[c+3]),5},e._BezierInterpolation_7=function(t,e,i,s,n,a,o,r,h,l,c){return void 0===c&&(c=0),i[s]=l[c+4]+l[c+5]*$.getBezierRate((.001*a+l[c+6])/l[c+7],l[c],l[c+1],l[c+2],l[c+3]),9},e.load=function(t){return i.loader.create(t,null,null,e)},e.interpolation=[e._LinearInterpolation_0,e._QuaternionInterpolation_1,e._AngleInterpolation_2,e._RadiansInterpolation_3,e._Matrix4x4Interpolation_4,e._NoInterpolation_5,e._BezierInterpolation_6,e._BezierInterpolation_7],e}(v),st=(function(t){function e(){this.isCached=!1,this.canvas=null,this.tex=null,this.rec=null,e.__super.call(this)}n(e,"laya.ani.bone.canvasmesh.CacheAbleSkinMesh",t);var i=e.prototype;return i.getCanvasPic=function(){var t=new u("2D"),i=t.getContext("2d");this.rec=this.mesh.getBounds(),t.size(this.rec.width,this.rec.height);var s;return s=this.transform,this.transform=e.tempMt,this.transform.identity(),this.transform.translate(-this.rec.x,-this.rec.y),this.renderToContext(i),this.transform.translate(+this.rec.x,+this.rec.y),this.transform=s,new b(t)},i.render=function(t,e,i){this.mesh.texture&&(this.isCached||(this.isCached=!0,this.tex=this.getCanvasPic()),this.transform?(this.transform.translate(e,i),this._renderTextureToContext(t),this.transform.translate(-e,-i)):(this.transform=et._tempMatrix,this.transform.identity(),this.transform.translate(e,i),this._renderTextureToContext(t),this.transform.translate(-e,-i),this.transform=null))},i._renderTextureToContext=function(t){this.context=t.ctx||t,t.save();var e;if(e=this.tex,this.transform){var i=this.transform;t.transform(i.a,i.b,i.c,i.d,i.tx,i.ty)}this.rec=this.mesh.getBounds(),t.translate(this.rec.x,this.rec.y),t.drawTexture(e,0,0,e.width,e.height,0,0),t.restore()},s(e,["tempMt",function(){return this.tempMt=new y}]),e}(et),function(t){function e(){this.cacheOK=!1,this.cacheCmdOK=!1,this.transformCmds=[],this.drawCmds=[],e.__super.call(this),this.tempMesh=new P}n(e,"laya.ani.bone.canvasmesh.SimpleSkinMeshCanvas",t);var i=e.prototype;return i.init2=function(e,i,s,n,a){t.prototype.init2.call(this,e,i,s,n,a),this.cacheOK=!1,this.cacheCmdOK=!1,this.transformCmds.length=6,this.drawCmds.length=9},i.renderToContext=function(t){if(this.context=t.ctx||t,this.mesh){if(this.mesh.uvs.length<=8)return void(0==this.mode?this._renderWithIndexes(this.mesh):this._renderNoIndexes(this.mesh));this.cacheOK||(this.tempMesh.texture=this.mesh.texture,this.tempMesh.uvs=this.mesh.texture.uv,this.tempMesh.vertices=G.solveMesh(this.mesh,this.tempMesh.vertices),this.cacheOK=!0),0==this.mode?this._renderWithIndexes(this.tempMesh):this._renderNoIndexes(this.tempMesh)}},i._renderWithIndexes=function(t){if(this.cacheCmdOK)return void this.renderByCache(t);var e=t.indexes,i=0,s=e.length;for(s>1&&(s=1),i=0;s>i;i+=3){var n=2*e[i],a=2*e[i+1],o=2*e[i+2];this._renderDrawTriangle(t,n,a,o)}this.cacheCmdOK=!0},i._renderDrawTriangle=function(t,e,i,s){var n=this.context,a=t.uvs,o=t.vertices,r=t.texture,h=r.bitmap,l=h.source,c=r.width,d=r.height,u=h.width,p=h.height,_=NaN,f=NaN,y=NaN,m=NaN,g=NaN,v=NaN;if(t.useUvTransform){var C=t.uvTransform;_=(a[e]*C.a+a[e+1]*C.c+C.tx)*u,f=(a[i]*C.a+a[i+1]*C.c+C.tx)*u,y=(a[s]*C.a+a[s+1]*C.c+C.tx)*u,m=(a[e]*C.b+a[e+1]*C.d+C.ty)*p,g=(a[i]*C.b+a[i+1]*C.d+C.ty)*p,v=(a[s]*C.b+a[s+1]*C.d+C.ty)*p}else _=a[e]*u,f=a[i]*u,y=a[s]*u,m=a[e+1]*p,g=a[i+1]*p,v=a[s+1]*p;var w=o[e],x=o[i],b=o[s],S=o[e+1],I=o[i+1],T=o[s+1],L=_*g+m*y+f*v-g*y-m*f-_*v,k=1/L,E=w*g+m*b+x*v-g*b-m*x-w*v,D=_*x+w*y+f*b-x*y-w*f-_*b,A=_*g*b+m*x*y+w*f*v-w*g*y-m*f*b-_*x*v,B=S*g+m*T+I*v-g*T-m*I-S*v,P=_*I+S*y+f*T-I*y-S*f-_*T,M=_*g*T+m*I*y+S*f*v-S*g*y-m*f*T-_*I*v;if(this.transformCmds[0]=E*k,this.transformCmds[1]=B*k,this.transformCmds[2]=D*k,this.transformCmds[3]=P*k,this.transformCmds[4]=A*k,this.transformCmds[5]=M*k,this.drawCmds[0]=l,this.drawCmds[1]=r.uv[0]*u,this.drawCmds[2]=r.uv[1]*p,this.drawCmds[3]=c,this.drawCmds[4]=d,this.drawCmds[5]=r.uv[0]*u,this.drawCmds[6]=r.uv[1]*p,this.drawCmds[7]=c,this.drawCmds[8]=d,n.save(),this.transform){var R=this.transform;n.transform(R.a,R.b,R.c,R.d,R.tx,R.ty)}n.transform.apply(n,this.transformCmds),n.drawImage.apply(n,this.drawCmds),n.restore()},i.renderByCache=function(t){var e=this.context;if(e.save(),this.transform){var i=this.transform;e.transform(i.a,i.b,i.c,i.d,i.tx,i.ty)}e.transform.apply(e,this.transformCmds),e.drawImage.apply(e,this.drawCmds),e.restore()},e}(et)),nt=function(t){function e(t,i){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!0,this._aniClipIndex=-1,this._clipIndex=-1,this._skinIndex=0,this._skinName="default",this._aniMode=0,this._graphicsCache=null,this._boneSlotDic=null,this._bindBoneBoneSlotDic=null,this._boneSlotArray=null,this._index=-1,this._total=-1,this._indexControl=!1,this._aniPath=null,this._texturePath=null,this._complete=null,this._loadAniMode=0,this._yReverseMatrix=null,this._ikArr=null,this._tfArr=null,this._pathDic=null,this._rootBone=null,this._boneList=null,this._aniSectionDic=null,this._eventIndex=0,this._drawOrderIndex=0,this._drawOrder=null,this._lastAniClipIndex=-1,this._lastUpdateAniClipIndex=-1,e.__super.call(this),void 0===i&&(i=0),t&&this.init(t,i)}n(e,"laya.ani.bone.Skeleton",t);var s=e.prototype;return s.init=function(t,e){void 0===e&&(e=0);var i=0,s=0;if(1==e)for(this._graphicsCache=[],i=0,s=t.getAnimationCount();s>i;i++)this._graphicsCache.push([]);if(this._yReverseMatrix=t.yReverseMatrix,this._aniMode=e,this._templet=t,this._player=new Z,this._player.cacheFrameRate=t.rate,this._player.templet=t,this._player.play(),this._parseSrcBoneMatrix(),this._boneList=t.mBoneArr,this._rootBone=t.mRootBone,this._aniSectionDic=t.aniSectionDic,t.ikArr.length>0)for(this._ikArr=[],i=0,s=t.ikArr.length;s>i;i++)this._ikArr.push(new U(t.ikArr[i],this._boneList));if(t.pathArr.length>0){var n,a;null==this._pathDic&&(this._pathDic={});var o;for(i=0,s=t.pathArr.length;s>i;i++)n=t.pathArr[i],a=new W(n,this._boneList),o=this._boneSlotDic[n.name],o&&(a=new W(n,this._boneList),a.target=o),this._pathDic[n.name]=a}if(t.tfArr.length>0)for(this._tfArr=[],i=0,s=t.tfArr.length;s>i;i++)this._tfArr.push(new Y(t.tfArr[i],this._boneList));if(t.skinDataArray.length>0){var r=this._templet.skinDataArray[this._skinIndex];this._skinName=r.name}this._player.on("played",this,this._onPlay),this._player.on("stopped",this,this._onStop),this._player.on("paused",this,this._onPause)},s.load=function(t,e,s){void 0===s&&(s=0),this._aniPath=t,this._complete=e,this._loadAniMode=s,i.loader.load([{url:t,type:"arraybuffer"}],p.create(this,this._onLoaded))},s._onLoaded=function(){var t=_.getRes(this._aniPath);if(null!=t){null==at.TEMPLET_DICTIONARY&&(at.TEMPLET_DICTIONARY={});var e;e=at.TEMPLET_DICTIONARY[this._aniPath],e?e.isParseFail?this._parseFail():this._parseComplete():(e=new at,e.url=this._aniPath,at.TEMPLET_DICTIONARY[this._aniPath]=e,e.on("complete",this,this._parseComplete),e.on("error",this,this._parseFail),e.parseData(null,t))}},s._parseComplete=function(){var t=at.TEMPLET_DICTIONARY[this._aniPath];t&&(this.init(t,this._loadAniMode),this.play(0,!0)),this._complete&&this._complete.runWith(this)},s._parseFail=function(){console.log("[Error]:"+this._aniPath+"解析失败")},s._onPlay=function(){this.event("played")},s._onStop=function(){var t,e=this._templet.eventAniArr,i=e[this._aniClipIndex];if(i&&this._eventIndex<i.length)for(;this._eventIndex<i.length;this._eventIndex++)t=i[this._eventIndex],t.time>=this._player.playStart&&t.time<=this._player.playEnd&&this.event("label",t);this._eventIndex=0,this._drawOrder=null,this.event("stopped")},s._onPause=function(){this.event("paused")},s._parseSrcBoneMatrix=function(){var t=0,e=0;for(e=this._templet.srcBoneMatrixArr.length,t=0;e>t;t++)this._boneMatrixArray.push(new y);if(0==this._aniMode)this._boneSlotDic=this._templet.boneSlotDic,this._bindBoneBoneSlotDic=this._templet.bindBoneBoneSlotDic,this._boneSlotArray=this._templet.boneSlotArray;else{null==this._boneSlotDic&&(this._boneSlotDic={}),null==this._bindBoneBoneSlotDic&&(this._bindBoneBoneSlotDic={}),null==this._boneSlotArray&&(this._boneSlotArray=[]);var i,s,n=this._templet.boneSlotArray;for(t=0,e=n.length;e>t;t++)i=n[t],s=this._bindBoneBoneSlotDic[i.parent],null==s&&(this._bindBoneBoneSlotDic[i.parent]=s=[]),this._boneSlotDic[i.name]=i=i.copy(),s.push(i),this._boneSlotArray.push(i)}},s._emitMissedEvents=function(t,e,i){void 0===i&&(i=0);var s=this._templet.eventAniArr,n=s[this._player.currentAnimationClipIndex];if(n){var a,o=0,r=0;for(r=n.length,o=i;r>o;o++)a=n[o],a.time>=this._player.playStart&&a.time<=this._player.playEnd&&this.event("label",a)}},s._update=function(t){if(void 0===t&&(t=!0),!(this._pause||t&&this._indexControl)){var e=i.timer.currTimer,s=this._player.currentKeyframeIndex,n=e-this._lastTime;if(t?this._player._update(n):s=-1,this._lastTime=e,this._player&&(this._index=this._clipIndex=this._player.currentKeyframeIndex,!(this._index<0||n>0&&this._clipIndex==s&&this._lastUpdateAniClipIndex==this._aniClipIndex))){this._lastUpdateAniClipIndex=this._aniClipIndex,s>this._clipIndex&&0!=this._eventIndex&&(this._emitMissedEvents(this._player.playStart,this._player.playEnd,this._eventIndex),this._eventIndex=0);var a,o=this._templet.eventAniArr,r=o[this._aniClipIndex];r&&this._eventIndex<r.length&&(a=r[this._eventIndex],a.time>=this._player.playStart&&a.time<=this._player.playEnd?this._player.currentPlayTime>=a.time&&(this.event("label",a),this._eventIndex++):this._eventIndex++);var h;if(0==this._aniMode){if(h=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=h&&(this.graphics=h));var l=0,c=0;for(c=this._clipIndex;!this._templet.getGrahicsDataWithCache(this._aniClipIndex,c-1)&&c>0;)c--;if(c<this._clipIndex)for(l=c;l<this._clipIndex;l++)this._createGraphics(l)}else if(1==this._aniMode){if(h=this._getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex))return void(this.graphics!=h&&(this.graphics=h));for(c=this._clipIndex;!this._getGrahicsDataWithCache(this._aniClipIndex,c-1)&&c>0;)c--;if(c<this._clipIndex)for(l=c;l<this._clipIndex;l++)this._createGraphics(l)}this._createGraphics()}}},s._createGraphics=function(t){void 0===t&&(t=-1),-1==t&&(t=this._clipIndex);var e,i=t*this._player.cacheFrameRateInterval,s=this._templet.drawOrderAniArr,n=s[this._aniClipIndex];if(n&&n.length>0)for(this._drawOrderIndex=0,e=n[this._drawOrderIndex];i>=e.time&&(this._drawOrder=e.drawOrder,this._drawOrderIndex++,!(this._drawOrderIndex>=n.length));)e=n[this._drawOrderIndex];var a;0==this._aniMode||1==this._aniMode?this.graphics=new tt:this.graphics instanceof laya.ani.GraphicsAni?this.graphics.clear():this.graphics=new tt,a=this.graphics;var o=this._templet.getNodes(this._aniClipIndex);this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._player._fullFrames[this._aniClipIndex],t,i);var r,h,c,d,u=this._aniSectionDic[this._aniClipIndex],p=0,_=0,f=0,m=0,g=0,v=this._templet.srcBoneMatrixArr.length;for(_=0,g=u[0];v>_;_++)d=this._boneList[_],c=this._templet.srcBoneMatrixArr[_],d.resultTransform.scX=c.scX*this._curOriginalData[p++],d.resultTransform.skX=c.skX+this._curOriginalData[p++],d.resultTransform.skY=c.skY+this._curOriginalData[p++],d.resultTransform.scY=c.scY*this._curOriginalData[p++],d.resultTransform.x=c.x+this._curOriginalData[p++],d.resultTransform.y=c.y+this._curOriginalData[p++],8===this._templet.tMatrixDataLen&&(d.resultTransform.skewX=c.skewX+this._curOriginalData[p++],d.resultTransform.skewY=c.skewY+this._curOriginalData[p++]);var C,w={},x={};for(g+=u[1];g>_;_++)C=o[_],w[C.name]=this._curOriginalData[p++],x[C.name]=this._curOriginalData[p++],this._curOriginalData[p++],this._curOriginalData[p++],this._curOriginalData[p++],this._curOriginalData[p++];var b={},S={};for(g+=u[2];g>_;_++)C=o[_],b[C.name]=this._curOriginalData[p++],S[C.name]=this._curOriginalData[p++],this._curOriginalData[p++],this._curOriginalData[p++],this._curOriginalData[p++],this._curOriginalData[p++];if(this._pathDic){var I;for(g+=u[3];g>_;_++)if(C=o[_],I=this._pathDic[C.name]){var T=new l(C.extenData);switch(T.getByte()){case 1:I.position=this._curOriginalData[p++];break;case 2:I.spacing=this._curOriginalData[p++];break;case 3:I.rotateMix=this._curOriginalData[p++],I.translateMix=this._curOriginalData[p++]}}}if(this._yReverseMatrix?this._rootBone.update(this._yReverseMatrix):this._rootBone.update(y.TEMP.identity()),this._ikArr){var L;for(_=0,g=this._ikArr.length;g>_;_++)L=this._ikArr[_],b.hasOwnProperty(L.name)&&(L.bendDirection=b[L.name]),S.hasOwnProperty(L.name)&&(L.mix=S[L.name]),L.apply()}if(this._pathDic)for(var k in this._pathDic)I=this._pathDic[k],
I.apply(this._boneList,a);if(this._tfArr){var E;for(_=0,m=this._tfArr.length;m>_;_++)E=this._tfArr[_],E.apply()}for(_=0,m=this._boneList.length;m>_;_++)if(d=this._boneList[_],h=this._bindBoneBoneSlotDic[d.name],d.resultMatrix.copyTo(this._boneMatrixArray[_]),h)for(f=0,g=h.length;g>f;f++)r=h[f],r&&r.setParentMatrix(d.resultMatrix);var D,A={},B=this._templet.deformAniArr;if(B&&B.length>0){if(this._lastAniClipIndex!=this._aniClipIndex)for(this._lastAniClipIndex=this._aniClipIndex,_=0,g=this._boneSlotArray.length;g>_;_++)r=this._boneSlotArray[_],r.deformData=null;var P=B[this._aniClipIndex];D=P["default"],this._setDeform(D,A,this._boneSlotArray,i);var M;for(M in P)"default"!=M&&M!=this._skinName&&(D=P[M],this._setDeform(D,A,this._boneSlotArray,i));D=P[this._skinName],this._setDeform(D,A,this._boneSlotArray,i)}var R,O,F;if(this._drawOrder)for(_=0,g=this._drawOrder.length;g>_;_++)r=this._boneSlotArray[this._drawOrder[_]],R=w[r.name],O=x[r.name],isNaN(O)||(a.save(),a.alpha(O)),isNaN(R)||-2==R||(this._templet.attachmentNames?r.showDisplayByName(this._templet.attachmentNames[R]):r.showDisplayByIndex(R)),A[this._drawOrder[_]]?(F=A[this._drawOrder[_]],r.currDisplayData&&F[r.currDisplayData.attachmentName]?r.deformData=F[r.currDisplayData.attachmentName]:r.deformData=null):r.deformData=null,isNaN(O)?r.draw(a,this._boneMatrixArray,2==this._aniMode):r.draw(a,this._boneMatrixArray,2==this._aniMode,O),isNaN(O)||a.restore();else for(_=0,g=this._boneSlotArray.length;g>_;_++)r=this._boneSlotArray[_],R=w[r.name],O=x[r.name],isNaN(O)||(a.save(),a.alpha(O)),isNaN(R)||-2==R||(this._templet.attachmentNames?r.showDisplayByName(this._templet.attachmentNames[R]):r.showDisplayByIndex(R)),A[_]?(F=A[_],r.currDisplayData&&F[r.currDisplayData.attachmentName]?r.deformData=F[r.currDisplayData.attachmentName]:r.deformData=null):r.deformData=null,isNaN(O)?r.draw(a,this._boneMatrixArray,2==this._aniMode):r.draw(a,this._boneMatrixArray,2==this._aniMode,O),isNaN(O)||a.restore();0==this._aniMode?this._templet.setGrahicsDataWithCache(this._aniClipIndex,t,a):1==this._aniMode&&this._setGrahicsDataWithCache(this._aniClipIndex,t,a)},s._setDeform=function(t,e,i,s){if(t){var n,a,o,r=0,h=0,l=0;if(t)for(r=0,h=t.deformSlotDataList.length;h>r;r++)for(n=t.deformSlotDataList[r],l=0;l<n.deformSlotDisplayList.length;l++)a=n.deformSlotDisplayList[l],o=i[a.slotIndex],a.apply(s,o),e[a.slotIndex]||(e[a.slotIndex]={}),e[a.slotIndex][a.attachment]=a.deformData}},s.getAnimNum=function(){return this._templet.getAnimationCount()},s.getAniNameByIndex=function(t){return this._templet.getAniNameByIndex(t)},s.getSlotByName=function(t){return this._boneSlotDic[t]},s.showSkinByName=function(t,e){void 0===e&&(e=!0),this.showSkinByIndex(this._templet.getSkinIndexByName(t),e)},s.showSkinByIndex=function(t,e){void 0===e&&(e=!0);for(var i=0;i<this._boneSlotArray.length;i++)this._boneSlotArray[i].showSlotData(null,e);if(this._templet.showSkinByIndex(this._boneSlotDic,t,e)){var s=this._templet.skinDataArray[t];this._skinIndex=t,this._skinName=s.name}this._clearCache()},s.showSlotSkinByIndex=function(t,e){if(0!=this._aniMode){var i=this.getSlotByName(t);i&&i.showDisplayByIndex(e),this._clearCache()}},s.showSlotSkinByName=function(t,e){if(0!=this._aniMode){var i=this.getSlotByName(t);i&&i.showDisplayByName(e),this._clearCache()}},s.replaceSlotSkinName=function(t,e,i){if(0!=this._aniMode){var s=this.getSlotByName(t);s&&s.replaceDisplayByName(e,i),this._clearCache()}},s.replaceSlotSkinByIndex=function(t,e,i){if(0!=this._aniMode){var s=this.getSlotByName(t);s&&s.replaceDisplayByIndex(e,i),this._clearCache()}},s.setSlotSkin=function(t,e){if(0!=this._aniMode){var i=this.getSlotByName(t);i&&i.replaceSkin(e),this._clearCache()}},s._clearCache=function(){if(1==this._aniMode)for(var t=0,e=this._graphicsCache.length;e>t;t++)this._graphicsCache[t].length=0},s.play=function(t,e,s,n,a,o){void 0===s&&(s=!0),void 0===n&&(n=0),void 0===a&&(a=0),void 0===o&&(o=!0),this._indexControl=!1;var r=-1,l=NaN;if(l=e?2147483647:0,"string"==typeof t)for(var c=0,d=this._templet.getAnimationCount();d>c;c++){var u=this._templet.getAnimation(c);if(u&&t==u.name){r=c;break}}else r=t;r>-1&&r<this.getAnimNum()&&(this._aniClipIndex=r,(s||this._pause||this._currAniIndex!=r)&&(this._currAniIndex=r,this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(r)),this._drawOrder=null,this._eventIndex=0,this._player.play(r,this._player.playbackRate,l,n,a),o&&this._templet.showSkinByIndex(this._boneSlotDic,this._skinIndex),this._pause&&(this._pause=!1,this._lastTime=h.now(),i.stage.frameLoop(1,this,this._update,null,!0)),this._update()))},s.stop=function(){this._pause||(this._pause=!0,this._player&&this._player.stop(!0),i.timer.clear(this,this._update))},s.playbackRate=function(t){this._player&&(this._player.playbackRate=t)},s.paused=function(){this._pause||(this._pause=!0,this._player&&(this._player.paused=!0),i.timer.clear(this,this._update))},s.resume=function(){this._indexControl=!1,this._pause&&(this._pause=!1,this._player&&(this._player.paused=!1),this._lastTime=h.now(),i.stage.frameLoop(1,this,this._update,null,!0))},s._getGrahicsDataWithCache=function(t,e){return this._graphicsCache[t][e]},s._setGrahicsDataWithCache=function(t,e,i){this._graphicsCache[t][e]=i},s.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._templet=null,this._player&&this._player.offAll(),this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,i.timer.clear(this,this._update)},a(0,s,"url",function(){return this._aniPath},function(t){this.load(t)}),a(0,s,"index",function(){return this._index},function(t){this.player&&(this._index=t,this._player.currentTime=1e3*this._index/this._player.cacheFrameRate,this._indexControl=!0,this._update(!1))}),a(0,s,"total",function(){return this._templet&&this._player?this._total=Math.floor(this._templet.getAniDuration(this._player.currentAnimationClipIndex)/1e3*this._player.cacheFrameRate):this._total=-1,this._total}),a(0,s,"player",function(){return this._player}),e.useSimpleMeshInCanvas=!1,e}(w),at=(function(t){function e(t){this._start=0,this._Pos=0,this._data=null,this._curIndex=0,this._preIndex=0,this._playIndex=0,this._playing=!1,this._ended=!0,this._count=0,this._ids=null,this._loadedImage={},this._idOfSprite=null,this._parentMovieClip=null,this._movieClipList=null,this._labels=null,this.basePath=null,this._atlasPath=null,this._url=null,this._isRoot=!1,this._completeHandler=null,this._endFrame=-1,this.interval=30,this.loop=!1,e.__super.call(this),this._ids={},this._idOfSprite=[],this._reset(),this._playing=!1,this._parentMovieClip=t,t?(this._isRoot=!1,this._movieClipList=t._movieClipList,this._movieClipList.push(this)):(this._movieClipList=[this],this._isRoot=!0,this._setUpNoticeType(1))}n(e,"laya.ani.swf.MovieClip",t);var s=e.prototype;return s.destroy=function(e){void 0===e&&(e=!0),this._clear(),t.prototype.destroy.call(this,e)},s._setDisplay=function(e){t.prototype._setDisplay.call(this,e),this._isRoot&&this._$3__onDisplay(e)},s._$3__onDisplay=function(t){t?i.timer.loop(this.interval,this,this.updates,null,!0):i.timer.clear(this,this.updates)},s.updates=function(){if(!this._parentMovieClip){var t=0,e=0;for(e=this._movieClipList.length,t=0;e>t;t++)this._movieClipList[t]&&this._movieClipList[t]._update()}},s.addLabel=function(t,e){this._labels||(this._labels={}),this._labels[e]=t},s.removeLabel=function(t){if(t){if(!this._labels)for(var e in this._labels)if(this._labels[e]===t){delete this._labels[e];break}}else this._labels=null},s._update=function(){if(this._data&&this._playing){if(this._playIndex++,this._playIndex>=this._count){if(!this.loop)return this._playIndex--,void this.stop();this._playIndex=0}if(this._parse(this._playIndex),this._labels&&this._labels[this._playIndex]&&this.event("label",this._labels[this._playIndex]),-1!=this._endFrame&&this._endFrame==this._playIndex){if(this._endFrame=-1,null!=this._completeHandler){var t=this._completeHandler;this._completeHandler=null,t.run()}this.stop()}}},s.stop=function(){this._playing=!1},s.gotoAndStop=function(t){this.index=t,this.stop()},s._clear=function(){if(this.stop(),this._idOfSprite.length=0,!this._parentMovieClip){i.timer.clear(this,this.updates);var t=0,e=0;for(e=this._movieClipList.length,t=0;e>t;t++)this._movieClipList[t]!=this&&this._movieClipList[t]._clear();this._movieClipList.length=0}this._atlasPath&&_.clearRes(this._atlasPath);var s;for(s in this._loadedImage)this._loadedImage[s]&&(_.clearRes(s),this._loadedImage[s]=!1);this.removeChildren(),this.graphics=null,this._parentMovieClip=null},s.play=function(t,e){void 0===t&&(t=0),void 0===e&&(e=!0),this.loop=e,this._playing=!0,this._data&&this._displayFrame(t)},s._displayFrame=function(t){void 0===t&&(t=-1),-1!=t&&(this._curIndex>t&&this._reset(),this._parse(t))},s._reset=function(t){void 0===t&&(t=!0),t&&1!=this._curIndex&&this.removeChildren(),this._preIndex=this._curIndex=-1,this._Pos=this._start},s._parse=function(t){var i,s,n,a=0,o=0,r=0,h=0,l=!1,c=this._idOfSprite,d=this._data;for(this._ended&&this._reset(),d.pos=this._Pos,this._ended=!1,this._playIndex=t,this._curIndex>t&&t<this._preIndex&&(this._reset(!0),d.pos=this._Pos);this._curIndex<=t&&!this._ended;)switch(o=d.getUint16()){case 12:if(a=d.getUint16(),r=this._ids[d.getUint16()],this._Pos=d.pos,d.pos=r,0==(h=d.getUint8())){var u=d.getUint16();if(s=c[a],!s){s=c[a]=new w;var p=new w;p.loadImage(this.basePath+u+".png"),this._loadedImage[this.basePath+u+".png"]=!0,s.addChild(p),p.size(d.getFloat32(),d.getFloat32());var _=d._getMatrix();p.transform=_}s.alpha=1}else 1==h&&(i=c[a],i||(c[a]=i=new e(this),i.interval=this.interval,i._ids=this._ids,i.basePath=this.basePath,i._setData(d,r),i._initState(),i.play(0)),i.alpha=1);d.pos=this._Pos;break;case 3:var f=c[d.getUint16()];f&&(this.addChild(f),f.zOrder=d.getUint16(),l=!0);break;case 4:f=c[d.getUint16()],f&&f.removeSelf();break;case 5:c[d.getUint16()][e._ValueList[d.getUint16()]]=d.getFloat32();break;case 6:c[d.getUint16()].visible=d.getUint8()>0;break;case 7:s=c[d.getUint16()];var m=s.transform||y.create();m.setTo(d.getFloat32(),d.getFloat32(),d.getFloat32(),d.getFloat32(),d.getFloat32(),d.getFloat32()),s.transform=m;break;case 8:c[d.getUint16()].setPos(d.getFloat32(),d.getFloat32());break;case 9:c[d.getUint16()].setSize(d.getFloat32(),d.getFloat32());break;case 10:c[d.getUint16()].alpha=d.getFloat32();break;case 11:c[d.getUint16()].setScale(d.getFloat32(),d.getFloat32());break;case 98:n=d.getString(),this.event(n),"stop"==n&&this.stop();break;case 99:this._curIndex=d.getUint16(),l&&this.updateZOrder();break;case 100:this._count=this._curIndex+1,this._ended=!0,this._playing&&(this.event("enterframe"),this.event("end"),this.event("complete")),this._reset(!1)}this._playing&&!this._ended&&this.event("enterframe"),this._Pos=d.pos},s._setData=function(t,e){this._data=t,this._start=e+3},s.load=function(t,e,s){void 0===e&&(e=!1),this._url=t=S.formatURL(t),e&&(this._atlasPath=s?s:t.split(".swf")[0]+".json"),this.stop(),this._clear(),this._movieClipList=[this];var n;n=[{url:t,type:"arraybuffer"}],this._atlasPath&&n.push({url:this._atlasPath,type:"atlas"}),i.loader.load(n,p.create(this,this._onLoaded))},s._onLoaded=function(){var t;return(t=_.getRes(this._url))?(this.basePath=this._atlasPath?_.getAtlas(this._atlasPath).dir:this._url.split(".swf")[0]+"/image/",void this._initData(t)):void this.event("error","file not find")},s._initState=function(){this._reset(),this._ended=!1;var t=this._playing;for(this._playing=!1,this._curIndex=0;!this._ended;)this._parse(++this._curIndex);this._playing=t},s._initData=function(t){this._data=new l(t);var e=0,s=this._data.getUint16();for(e=0;s>e;e++)this._ids[this._data.getInt16()]=this._data.getInt32();this.interval=1e3/this._data.getUint16(),this._setData(this._data,this._ids[32767]),this._initState(),this.play(0),this.event("loaded"),this._parentMovieClip||i.timer.loop(this.interval,this,this.updates,null,!0)},s.playTo=function(t,e,i){this._completeHandler=i,this._endFrame=e,this.play(t,!1)},a(0,s,"index",function(){return this._playIndex},function(t){this._playIndex=t,this._data&&this._displayFrame(this._playIndex),this._labels&&this._labels[t]&&this.event("label",this._labels[t])}),a(0,s,"count",function(){return this._count}),a(0,s,"playing",function(){return this._playing}),a(0,s,"url",null,function(t){this.load(t)}),e._ValueList=["x","y","width","height","scaleX","scaleY","rotation","alpha"],e}(w),function(t){function e(){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.ikArr=[],this.tfArr=[],this.pathArr=[],this.boneSlotDic={},this.bindBoneBoneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.skinDic={},this.subTextureDic={},this.isParseFail=!1,this.yReverseMatrix=null,this.drawOrderAniArr=[],this.eventAniArr=[],this.attachmentNames=null,this.deformAniArr=[],this._isDestroyed=!1,this._rate=30,this.aniSectionDic={},this._skBufferUrl=null,this._textureDic={},this._loadList=null,this._path=null,this.tMatrixDataLen=0,this.mRootBone=null,e.__super.call(this),this.skinSlotDisplayDataArr=[],this.mBoneArr=[]}n(e,"laya.ani.bone.Templet",t);var s=e.prototype;return s.loadAni=function(t){this._skBufferUrl=t,i.loader.load(t,p.create(this,this.onComplete),null,"arraybuffer")},s.onComplete=function(t){if(this._isDestroyed)return void this.destroy();var e=_.getRes(this._skBufferUrl);return e?(this._path=this._skBufferUrl.slice(0,this._skBufferUrl.lastIndexOf("/"))+"/",void this.parseData(null,e)):void this.event("error","load failed:"+this._skBufferUrl)},s.parseData=function(t,e,i){void 0===i&&(i=30),!this._path&&this.url&&(this._path=this.url.slice(0,this.url.lastIndexOf("/"))+"/"),this._mainTexture=t,this._mainTexture&&g.isWebGL&&t.bitmap&&(t.bitmap.enableMerageInAtlas=!1),this._rate=i,this.parse(e)},s.buildArmature=function(t){return void 0===t&&(t=0),t=2,new nt(this,t)},s.parse=function(i){t.prototype.parse.call(this,i),this._endLoaded(),this._aniVersion!=e.LAYA_ANIMATION_VISION&&(console.log("[Error] 版本不一致，请使用IDE版本配套的重新导出"+this._aniVersion+"->"+e.LAYA_ANIMATION_VISION),this._loaded=!1),this._loaded?this._mainTexture?this._parsePublicExtData():this._parseTexturePath():(this.event("error",this),this.isParseFail=!0)},s._parseTexturePath=function(){if(this._isDestroyed)return void this.destroy();var t=0;this._loadList=[];var e,s=new l(this.getPublicExtData()),n=0,a=0,o=0,r=0,h=0,c=0,d=0,u=0,_=0,f=s.getInt32(),y=s.readUTFString(),m=y.split("\n");for(t=0;f>t;t++)e=this._path+m[2*t],y=m[2*t+1],n=s.getFloat32(),a=s.getFloat32(),o=s.getFloat32(),r=s.getFloat32(),_=s.getFloat32(),h=isNaN(_)?0:_,_=s.getFloat32(),c=isNaN(_)?0:_,_=s.getFloat32(),d=isNaN(_)?o:_,_=s.getFloat32(),u=isNaN(_)?r:_,-1==this._loadList.indexOf(e)&&this._loadList.push(e);i.loader.load(this._loadList,p.create(this,this._textureComplete))},s._textureComplete=function(){for(var t,e,i=0,s=this._loadList.length;s>i;i++)e=this._loadList[i],t=this._textureDic[e]=_.getRes(e),g.isWebGL&&t&&t.bitmap&&(t.bitmap.enableMerageInAtlas=!1);this._parsePublicExtData()},s._parsePublicExtData=function(){var t=0,e=0,i=0,s=0,n=0;for(t=0,n=this.getAnimationCount();n>t;t++)this._graphicsCache.push([]);var a=!1;a="Dragon"!=this._aniClassName;var o,r,h=new l(this.getPublicExtData()),c=0,d=0,u=0,p=0,_=0,f=0,m=0,g=0,v=0,C=h.getInt32(),w=h.readUTFString(),x=w.split("\n");for(t=0;C>t;t++){if(o=this._mainTexture,r=this._path+x[2*t],w=x[2*t+1],null==this._mainTexture&&(o=this._textureDic[r]),c=h.getFloat32(),d=h.getFloat32(),u=h.getFloat32(),p=h.getFloat32(),v=h.getFloat32(),_=isNaN(v)?0:v,v=h.getFloat32(),f=isNaN(v)?0:v,v=h.getFloat32(),m=isNaN(v)?u:v,v=h.getFloat32(),g=isNaN(v)?p:v,!o)return this.event("error",this),void(this.isParseFail=!0);this.subTextureDic[w]=b.create(o,c,d,u,p,-_,-f,m,g)}this._mainTexture=o;var S,I=h.getUint16();for(t=0;I>t;t++)S=[],S.push(h.getUint16()),S.push(h.getUint16()),S.push(h.getUint16()),S.push(h.getUint16()),this.aniSectionDic[t]=S;var T,L,k,E,B,P=h.getInt16(),U={};for(t=0;P>t;t++)T=new D,0==t?B=T:T.root=B,T.d=a?-1:1,k=h.readUTFString(),E=h.readUTFString(),T.length=h.getFloat32(),1==h.getByte()&&(T.inheritRotation=!1),1==h.getByte()&&(T.inheritScale=!1),T.name=k,E&&(L=U[E],L?L.addChild(T):this.mRootBone=T),U[k]=T,this.mBoneArr.push(T);this.tMatrixDataLen=h.getUint16();var G,W=h.getUint16(),Y=Math.floor(W/this.tMatrixDataLen),J=this.srcBoneMatrixArr;for(t=0;Y>t;t++)G=new z,G.scX=h.getFloat32(),G.skX=h.getFloat32(),G.skY=h.getFloat32(),G.scY=h.getFloat32(),G.x=h.getFloat32(),G.y=h.getFloat32(),8===this.tMatrixDataLen&&(G.skewX=h.getFloat32(),G.skewY=h.getFloat32()),J.push(G),T=this.mBoneArr[t],T.transform=G;var Q,$=h.getUint16(),Z=0;for(t=0;$>t;t++){for(Q=new H,Z=h.getUint16(),e=0;Z>e;e++)Q.boneNames.push(h.readUTFString()),Q.boneIndexs.push(h.getInt16());Q.name=h.readUTFString(),Q.targetBoneName=h.readUTFString(),Q.targetBoneIndex=h.getInt16(),Q.bendDirection=h.getFloat32(),Q.mix=h.getFloat32(),Q.isSpine=a,this.ikArr.push(Q)}var tt,et=h.getUint16(),it=0;for(t=0;et>t;t++){for(tt=new q,it=h.getUint16(),e=0;it>e;e++)tt.boneIndexs.push(h.getInt16());tt.name=h.getUTFString(),tt.targetIndex=h.getInt16(),tt.rotateMix=h.getFloat32(),tt.translateMix=h.getFloat32(),tt.scaleMix=h.getFloat32(),tt.shearMix=h.getFloat32(),tt.offsetRotation=h.getFloat32(),tt.offsetX=h.getFloat32(),tt.offsetY=h.getFloat32(),tt.offsetScaleX=h.getFloat32(),tt.offsetScaleY=h.getFloat32(),tt.offsetShearY=h.getFloat32(),this.tfArr.push(tt)}var st,nt=h.getUint16(),at=0;for(t=0;nt>t;t++){for(st=new V,st.name=h.readUTFString(),at=h.getUint16(),e=0;at>e;e++)st.bones.push(h.getInt16());st.target=h.readUTFString(),st.positionMode=h.readUTFString(),st.spacingMode=h.readUTFString(),st.rotateMode=h.readUTFString(),st.offsetRotation=h.getFloat32(),st.position=h.getFloat32(),st.spacing=h.getFloat32(),st.rotateMix=h.getFloat32(),st.translateMix=h.getFloat32(),this.pathArr.push(st)}var ot,rt,ht,lt,ct,dt=0,ut=0,pt=0,_t=0,ft=NaN,yt=0,mt=h.getInt16();for(t=0;mt>t;t++){var gt=h.getUint8(),vt={};this.deformAniArr.push(vt);for(var Ct=0;gt>Ct;Ct++)for(rt=new M,rt.skinName=h.getUTFString(),vt[rt.skinName]=rt,dt=h.getInt16(),e=0;dt>e;e++)for(ht=new R,rt.deformSlotDataList.push(ht),ut=h.getInt16(),i=0;ut>i;i++)for(lt=new O,ht.deformSlotDisplayList.push(lt),lt.slotIndex=pt=h.getInt16(),lt.attachment=ot=h.getUTFString(),_t=h.getInt16(),s=0;_t>s;s++)for(1==h.getByte()?lt.tweenKeyList.push(!0):lt.tweenKeyList.push(!1),ft=h.getFloat32(),lt.timeList.push(ft),ct=[],lt.vectices.push(ct),yt=h.getInt16(),n=0;yt>n;n++)ct.push(h.getFloat32())}var wt,xt,bt=h.getInt16(),St=0,It=0;for(t=0;bt>t;t++){for(St=h.getInt16(),wt=[],e=0;St>e;e++){for(xt=new F,xt.time=h.getFloat32(),It=h.getInt16(),i=0;It>i;i++)xt.drawOrder.push(h.getInt16());wt.push(xt)}this.drawOrderAniArr.push(wt)}var Tt,Lt,kt=h.getInt16(),Et=0;for(t=0;kt>t;t++){for(Et=h.getInt16(),Tt=[],e=0;Et>e;e++)Lt=new N,Lt.name=h.getUTFString(),Lt.intValue=h.getInt32(),Lt.floatValue=h.getFloat32(),Lt.stringValue=h.getUTFString(),Lt.time=h.getFloat32(),Tt.push(Lt);this.eventAniArr.push(Tt)}var Dt=h.getInt16();if(Dt>0)for(this.attachmentNames=[],t=0;Dt>t;t++)this.attachmentNames.push(h.getUTFString());var At,Bt,Pt=h.getInt16();for(t=0;Pt>t;t++)At=new A,At.name=h.readUTFString(),At.parent=h.readUTFString(),At.attachmentName=h.readUTFString(),At.srcDisplayIndex=At.displayIndex=h.getInt16(),At.templet=this,this.boneSlotDic[At.name]=At,Bt=this.bindBoneBoneSlotDic[At.parent],null==Bt&&(this.bindBoneBoneSlotDic[At.parent]=Bt=[]),Bt.push(At),this.boneSlotArray.push(At);var Mt,Rt,Ot,Ft=h.readUTFString(),Nt=Ft.split("\n"),Ut=0,Ht=h.getUint8(),Gt=0,Wt=0,Vt=0,Kt=0,jt=0,Xt=0,Yt=0;for(t=0;Ht>t;t++){for(Mt=new K,Mt.name=Nt[Ut++],Gt=h.getUint8(),e=0;Gt>e;e++){for(Rt=new X,Rt.name=Nt[Ut++],At=this.boneSlotDic[Rt.name],Wt=h.getUint8(),i=0;Wt>i;i++){if(Ot=new j,this.skinSlotDisplayDataArr.push(Ot),Ot.name=Nt[Ut++],Ot.attachmentName=Nt[Ut++],Ot.transform=new z,Ot.transform.scX=h.getFloat32(),Ot.transform.skX=h.getFloat32(),Ot.transform.skY=h.getFloat32(),Ot.transform.scY=h.getFloat32(),Ot.transform.x=h.getFloat32(),Ot.transform.y=h.getFloat32(),Rt.displayArr.push(Ot),Ot.width=h.getFloat32(),Ot.height=h.getFloat32(),Ot.type=h.getUint8(),Ot.verLen=h.getUint16(),P=h.getUint16(),P>0)for(Ot.bones=[],s=0;P>s;s++){var qt=h.getUint16();Ot.bones.push(qt)}if(Vt=h.getUint16(),Vt>0)for(Ot.uvs=[],s=0;Vt>s;s++)Ot.uvs.push(h.getFloat32());if(Kt=h.getUint16(),Kt>0)for(Ot.weights=[],s=0;Kt>s;s++)Ot.weights.push(h.getFloat32());if(jt=h.getUint16(),jt>0)for(Ot.triangles=[],s=0;jt>s;s++)Ot.triangles.push(h.getUint16());if(Xt=h.getUint16(),Xt>0)for(Ot.vertices=[],s=0;Xt>s;s++)Ot.vertices.push(h.getFloat32());if(Yt=h.getUint16(),Yt>0)for(Ot.lengths=[],s=0;Yt>s;s++)Ot.lengths.push(h.getFloat32())}Mt.slotArr.push(Rt)}this.skinDic[Mt.name]=Mt,this.skinDataArray.push(Mt)}var zt=h.getUint8();1==zt?(this.yReverseMatrix=new y(1,0,0,-1,0,0),B&&B.setTempMatrix(this.yReverseMatrix)):B&&B.setTempMatrix(new y),this.showSkinByIndex(this.boneSlotDic,0),this.event("complete",this)},s.getTexture=function(t){var e=this.subTextureDic[t];return null==e?this._mainTexture:e},s.showSkinByIndex=function(t,e,i){if(void 0===i&&(i=!0),0>e&&e>=this.skinDataArray.length)return!1;var s,n,a=0,o=0,r=this.skinDataArray[e];if(r){for(a=0,o=r.slotArr.length;o>a;a++)n=r.slotArr[a],n&&(s=t[n.name],s&&(s.showSlotData(n,i),i&&"undefined"!=s.attachmentName&&"null"!=s.attachmentName?s.showDisplayByName(s.attachmentName):s.showDisplayByIndex(s.displayIndex)));return!0}return!1},s.getSkinIndexByName=function(t){for(var e,i=0,s=this.skinDataArray.length;s>i;i++)if(e=this.skinDataArray[i],e.name==t)return i;return-1},s.getGrahicsDataWithCache=function(t,e){return this._graphicsCache[t][e]},s.setGrahicsDataWithCache=function(t,e,i){this._graphicsCache[t][e]=i},s.destroy=function(){this._isDestroyed=!0;var t;for(var i in this.subTextureDic)t=this.subTextureDic[i],t&&t.destroy();var i;for(i in this._textureDic)t=this._textureDic[i],t&&t.destroy();for(var s,n=0,a=this.skinSlotDisplayDataArr.length;a>n;n++)s=this.skinSlotDisplayDataArr[n],s.destory();this.skinSlotDisplayDataArr.length=0,this.url&&delete e.TEMPLET_DICTIONARY[this.url],this.dispose()},s.getAniNameByIndex=function(t){var e=this.getAnimation(t);return e?e.name:null},a(0,s,"rate",function(){return this._rate},function(t){this._rate=t}),e.LAYA_ANIMATION_VISION="LAYAANIMATION:1.6.0",e.TEMPLET_DICTIONARY=null,e}(it))}(window,document,Laya),!function(t,e,i){var s=(i.un,i.uns,i["static"],i["class"]),n=i.getset,a=(i.__newvec,laya.webgl.canvas.BlendMode),o=(laya.utils.Browser,laya.utils.Color),r=laya.filters.ColorFilterAction,h=laya.filters.webgl.ColorFilterActionGL,l=laya.filters.Filter,c=laya.filters.webgl.FilterActionGL,d=laya.maths.Matrix,u=(laya.maths.Rectangle,laya.renders.Render),p=(laya.renders.RenderContext,laya.webgl.resource.RenderTarget2D),_=laya.utils.RunDriver,f=(laya.webgl.shader.d2.ShaderDefines2D,laya.display.Sprite,laya.webgl.submit.SubmitCMD),y=laya.resource.Texture,m=laya.webgl.shader.d2.value.Value2D,g=function(){function t(){this.data=null}s(t,"laya.filters.FilterAction");var e=t.prototype;return i.imps(e,{"laya.filters.IFilterAction":!0}),e.apply=function(t){return null},t}(),v=function(){function t(){}return s(t,"laya.filters.WebGLFilter"),t.enable=function(){t.isInit||(t.isInit=!0,u.isWebGL&&(_.createFilterAction=function(t){var e;switch(t){case 32:e=new h;break;case 16:e=new C;break;case 8:e=new w}return e}))},t.isInit=!1,t.__init$=function(){_.createFilterAction=function(t){var e;switch(t){case 16:e=new g;break;case 8:e=new g;break;case 32:e=new r}return e}},t}(),C=(function(t){function e(t){this.strength=NaN,e.__super.call(this),void 0===t&&(t=4),u.isWebGL&&v.enable(),this.strength=t,this._action=_.createFilterAction(16),this._action.data=this}s(e,"laya.filters.BlurFilter",t);var i=e.prototype;i.callNative=function(t){t.conchModel&&t.conchModel.blurFilter&&t.conchModel.blurFilter(this.strength)},n(0,i,"action",function(){return this._action}),n(0,i,"type",function(){return 16}),e}(l),function(t){function e(t,i,s,n){this._color=null,e.__super.call(this),this._elements=new Float32Array(9),void 0===i&&(i=4),void 0===s&&(s=6),void 0===n&&(n=6),u.isWebGL&&v.enable(),this._color=new o(t),this.blur=Math.min(i,20),this.offX=s,this.offY=n,this._action=_.createFilterAction(8),this._action.data=this}s(e,"laya.filters.GlowFilter",t);var i=e.prototype;i.getColor=function(){return this._color._color},i.callNative=function(t){t.conchModel&&t.conchModel.glowFilter&&t.conchModel.glowFilter(this._color.strColor,this._elements[4],this._elements[5],this._elements[6])},n(0,i,"type",function(){return 8}),n(0,i,"action",function(){return this._action}),n(0,i,"offY",function(){return this._elements[6]},function(t){this._elements[6]=t}),n(0,i,"offX",function(){return this._elements[5]},function(t){this._elements[5]=t}),n(0,i,"blur",function(){return this._elements[4]},function(t){this._elements[4]=t}),e}(l),function(t){function e(){this.data=null,e.__super.call(this)}s(e,"laya.filters.webgl.BlurFilterActionGL",t);var i=e.prototype;return i.setValueMix=function(t){t.defines.add(this.data.type)},i.apply3d=function(t,e,i,s,n){var a=t.getValue("bounds"),o=m.create(1,0);o.setFilters([this.data]),d.EMPTY.identity(),i.ctx.drawTarget(t,0,0,a.width,a.height,d.EMPTY,"src",o),o.setFilters(null)},i.setValue=function(t){t.strength=this.data.strength},n(0,i,"typeMix",function(){return 16}),e}(c)),w=function(t){function e(){this.data=null,this._initKey=!1,this._textureWidth=0,this._textureHeight=0,e.__super.call(this)}s(e,"laya.filters.webgl.GlowFilterActionGL",t);var o=e.prototype;return i.imps(o,{"laya.filters.IFilterActionGL":!0}),o.setValueMix=function(t){},o.apply3d=function(t,i,s,n,o){var r=t.getValue("bounds");t.addValue("color",this.data.getColor());var h=r.width,l=r.height;this._textureWidth=h,this._textureHeight=l;var c=f.create([t,i,s,0,0],e.tmpTarget);s.ctx.addRenderObject(c);var u,p=d.TEMP;return p.identity(),u=m.create(1,0),u.setFilters([this.data]),s.ctx.drawTarget(t,0,0,this._textureWidth,this._textureHeight,p,"src",u,null,a.TOINT.overlay),c=f.create([t,i,s,0,0],e.startOut),s.ctx.addRenderObject(c),u=m.create(1,0),s.ctx.drawTarget(t,0,0,this._textureWidth,this._textureHeight,p,"tmpTarget",u,y.INV_UV,a.TOINT.overlay),u=m.create(1,0),s.ctx.drawTarget(t,0,0,this._textureWidth,this._textureHeight,p,"src",u),c=f.create([t,i,s,0,0],e.recycleTarget),s.ctx.addRenderObject(c),null},o.setSpriteWH=function(t){this._textureWidth=t.width,this._textureHeight=t.height},o.setValue=function(t){t.u_offsetX=this.data.offX,t.u_offsetY=-this.data.offY,t.u_strength=1,t.u_blurX=this.data.blur,t.u_blurY=this.data.blur,t.u_textW=this._textureWidth,t.u_textH=this._textureHeight,t.u_color=this.data.getColor()},n(0,o,"typeMix",function(){return 8}),e.tmpTarget=function(t,e,i,s,n){var a=t.getValue("bounds");t.getValue("out").end();var o=p.create(a.width,a.height);o.start();var r=t.getValue("color");r&&o.clear(r[0],r[1],r[2],0),t.addValue("tmpTarget",o)},e.startOut=function(t,e,i,s,n){t.getValue("tmpTarget").end();var a=t.getValue("out");a.start();var o=t.getValue("color");o&&a.clear(o[0],o[1],o[2],0)},e.recycleTarget=function(t,e,i,s,n){t.getValue("src"),t.getValue("tmpTarget").recycle()},e}(c);i.__init([v])}(window,document,Laya),!function(window,document,Laya){var __un=Laya.un,__uns=Laya.uns,__static=Laya["static"],__class=Laya["class"],__getset=Laya.getset,__newvec=Laya.__newvec,Browser=laya.utils.Browser,CSSStyle=laya.display.css.CSSStyle,ClassUtils=laya.utils.ClassUtils,Event=laya.events.Event,HTMLChar=laya.utils.HTMLChar,Loader=laya.net.Loader,Node=laya.display.Node,Rectangle=laya.maths.Rectangle,Render=laya.renders.Render,RenderContext=laya.renders.RenderContext,RenderSprite=laya.renders.RenderSprite,Sprite=laya.display.Sprite,Stat=laya.utils.Stat,Texture=laya.resource.Texture,URL=laya.net.URL,Utils=laya.utils.Utils,HTMLParse=function(){function t(){}return __class(t,"laya.html.utils.HTMLParse"),t.parse=function(e,i,s){i=i.replace(/<br>/g,"<br/>"),i="<root>"+i+"</root>",i=i.replace(t.spacePattern,t.char255);var n=Utils.parseXMLFromString(i);t._parseXML(e,n.childNodes[0].childNodes,s)},t._parseXML=function(e,i,s,n){var a=0,o=0;if(i.join||i.item)for(a=0,o=i.length;o>a;++a)t._parseXML(e,i[a],s,n);else{var r,h;if(3==i.nodeType){var l;return void(e instanceof laya.html.dom.HTMLDivElement?(null==i.nodeName&&(i.nodeName="#text"),h=i.nodeName.toLowerCase(),l=i.textContent.replace(/^\s+|\s+$/g,""),l.length>0&&(r=ClassUtils.getInstance(h))&&(e.addChild(r),r.innerTEXT=l.replace(t.char255AndOneSpacePattern," "))):(l=i.textContent.replace(/^\s+|\s+$/g,""),l.length>0&&(e.innerTEXT=l.replace(t.char255AndOneSpacePattern," "))))}if("#comment"==(h=i.nodeName.toLowerCase()))return;if(r=ClassUtils.getInstance(h)){r=e.addChild(r),r.URI=s,r.href=n;var c=i.attributes;if(c&&c.length>0)for(a=0,o=c.length;o>a;++a){var d=c[a],u=d.nodeName,p=d.value;r._setAttributes(u,p)}t._parseXML(r,i.childNodes,s,r.href)}else t._parseXML(e,i.childNodes,s,n)}},t.char255=String.fromCharCode(255),t.spacePattern=/&nbsp;|&#160;/g,t.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),t}(),Layout=function(){function t(){}return __class(t,"laya.html.utils.Layout"),t.later=function(e){null==t._will&&(t._will=[],Laya.stage.frameLoop(1,null,function(){if(!(t._will.length<1)){for(var e=0;e<t._will.length;e++)laya.html.utils.Layout.layout(t._will[e]);t._will.length=0}})),t._will.push(e)},t.layout=function(e){if(!e||!e._style)return null;if(0==(512&e._style._type))return null;e.getStyle()._type&=-513;var i=t._multiLineLayout(e);return Render.isConchApp&&e.layaoutCallNative&&e.layaoutCallNative(),i},t._multiLineLayout=function(e){function i(){L.y=b,b+=L.h+p,L.mWidth=D,D=0,L=new LayoutLine,T.push(L),L.h=0,x=0,A=!0,k=!1}var s=new Array;e._addChildsToLayout(s);var n,a,o,r,h,l=0,c=s.length,d=e._getCSSStyle(),u=d.letterSpacing,p=d.leading,_=d.lineHeight,f=d._widthAuto()||!d.wordWrap,y=f?999999:e.width,m=(e.height,0),g=d.italic?d.fontSize/3:0,v=d._getAlign(),C=d._getValign(),w=0!==C||0!==v||0!=_,x=0,b=0,S=0,I=0,T=new Array,L=T[0]=new LayoutLine,k=!1,E=!1;L.h=0,d.italic&&(y-=d.fontSize/3);var D=0,A=!0;for(l=0;c>l;l++)if(null!=(n=s[l]))if(A=!1,n instanceof laya.html.dom.HTMLBrElement)i(),L.y=b,L.h=_;else{if(n._isChar()){if(r=n,r.isWord)k=E||"\n"===r["char"],L.wordStartIndex=L.elements.length;else{if(T.length>0&&x+S>y&&L.wordStartIndex>0){var B=0;B=L.elements.length-L.wordStartIndex+1,L.elements.length=L.wordStartIndex,l-=B,i();continue}k=!1,D+=r.width}S=r.width+u,I=r.height,E=!1,k=k||x+S>y,k&&i(),L.minTextHeight=Math.min(L.minTextHeight,n.height)}else a=n._getCSSStyle(),h=n,o=a.padding,0===a._getCssFloat()||(w=!0),k=E||a.lineElement,S=h.width*h._style._tf.scaleX+o[1]+o[3]+u,I=h.height*h._style._tf.scaleY+o[0]+o[2],E=a.lineElement,(k=k||x+S>y&&a.wordWrap)&&i();L.elements.push(n),L.h=Math.max(L.h,I),n.x=x,n.y=b,x+=S,L.w=x-u,L.y=b,m=Math.max(x+g,m)}else A||(x+=t.DIV_ELEMENT_PADDING),L.wordStartIndex=L.elements.length;if(b=L.y+L.h,w){var P=0,M=y;for(f&&e.width>0&&(M=e.width),l=0,c=T.length;c>l;l++)T[l].updatePos(0,M,l,P,v,C,_),P+=Math.max(_,T[l].h+p);b=P}return f&&(e.width=m),b>e.height&&(e.height=b),[m,b]},t._will=null,t.DIV_ELEMENT_PADDING=0,t}(),LayoutLine=function(){function t(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}return __class(t,"laya.html.utils.LayoutLine"),t.prototype.updatePos=function(t,e,i,s,n,a,o){var r,h=0;this.elements.length>0&&(r=this.elements[this.elements.length-1],h=r.x+r.width-this.elements[0].x);var l=0,c=NaN;1===n&&(l=(e-h)/2),2===n&&(l=e-h),0===o||0!=a||(a=1);for(var d=0,u=this.elements.length;u>d;d++){r=this.elements[d];var p=r._getCSSStyle();switch(0!==l&&(r.x+=l),p._getValign()){case 0:r.y=s;break;case 1:var _=0;99999!=this.minTextHeight&&(_=this.minTextHeight);var f=(_+o)/2;f=Math.max(f,this.h),laya.html.dom.HTMLImageElement,c=s+f-r.height,r.y=c;break;
case 2:r.y=s+(o-r.height)}}},t}(),HTMLElement=function(_super){function HTMLElement(){this.URI=null,this._href=null,HTMLElement.__super.call(this),this._text=HTMLElement._EMPTYTEXT,this.setStyle(new CSSStyle(this)),this._getCSSStyle().valign="middle",this.mouseEnabled=!0}__class(HTMLElement,"laya.html.dom.HTMLElement",_super);var __proto=HTMLElement.prototype;return __proto.layaoutCallNative=function(){var t=0;if(this._childs&&(t=this._childs.length)>0)for(var e=0;t>e;e++)this._childs[e].layaoutCallNative&&this._childs[e].layaoutCallNative();var i=this._getWords();i&&HTMLElement.fillWords(this,i,0,0,this.style.font,this.style.color)},__proto.appendChild=function(t){return this.addChild(t)},__proto._getWords=function(){var t=this._text.text;if(!t||0===t.length)return null;var e=this._text.words;if(e&&e.length===t.length)return e;null===e&&(this._text.words=e=[]),e.length=t.length;for(var i,s=this.style,n=s.font,a=0,o=t.length;o>a;a++){i=Utils.measureText(t.charAt(a),n);var r=e[a]=new HTMLChar(t.charAt(a),i.width,i.height||s.fontSize,s);if(this.href){var h=new Sprite;this.addChild(h),r.setSprite(h)}}return e},__proto.showLinkSprite=function(){var t=this._text.words;if(t)for(var e,i,s=[],n=0;n<t.length;n++)i=t[n],e=new Sprite,e.graphics.drawRect(0,0,i.width,i.height,"#ff0000"),e.width=i.width,e.height=i.height,this.addChild(e),s.push(e)},__proto._layoutLater=function(){var t=this.style;512&t._type||(t.widthed(this)&&(this._childs.length>0||null!=this._getWords())&&t.block?(Layout.later(this),t._type|=512):this.parent&&this.parent._layoutLater())},__proto._setAttributes=function(t,e){switch(t){case"style":return void this.style.cssText(e);case"class":return void(this.className=e)}_super.prototype._setAttributes.call(this,t,e)},__proto.updateHref=function(){if(null!=this._href){var t=this._getWords();if(t)for(var e,i,s=0;s<t.length;s++)if(e=t[s],i=e.getSprite()){var n=e.height-1,a=.5*e.style.letterSpacing;a||(a=0),i.graphics.drawLine(0-a,n,e.width+a,n,e._getCSSStyle().color),i.size(e.width,e.height),i.on("click",this,this.onLinkHandler)}}},__proto.onLinkHandler=function(t){switch(t.type){case"click":for(var e=this;e;)e.event("link",[this.href]),e=e.parent}},__proto.formatURL=function(t){return this.URI?URL.formatURL(t,this.URI?this.URI.path:null):t},__getset(0,__proto,"href",function(){return this._href},function(t){this._href=t,null!=t&&this.updateHref()}),__getset(0,__proto,"color",null,function(t){this.style.color=t}),__getset(0,__proto,"onClick",null,function(value){var fn;eval("fn=function(event){"+value+";}"),this.on("click",this,void 0)}),__getset(0,__proto,"id",null,function(t){HTMLDocument.document.setElementById(t,this)}),__getset(0,__proto,"innerTEXT",function(){return this._text.text},function(t){this.text=t}),__getset(0,__proto,"style",function(){return this._style}),__getset(0,__proto,"text",function(){return this._text.text},function(t){this._text==HTMLElement._EMPTYTEXT?this._text={text:t,words:null}:(this._text.text=t,this._text.words&&(this._text.words.length=0)),this._renderType|=2048,this.repaint(),this.updateHref()}),__getset(0,__proto,"parent",_super.prototype._$get_parent,function(t){if(t instanceof laya.html.dom.HTMLElement){var e=t;this.URI||(this.URI=e.URI),this.style.inherit(e.style)}_super.prototype._$set_parent.call(this,t)}),__getset(0,__proto,"className",null,function(t){this.style.attrs(HTMLDocument.document.styleSheets["."+t])}),HTMLElement.fillWords=function(t,e,i,s,n,a){t.graphics.clear();for(var o=0,r=e.length;r>o;o++){var h=e[o];t.graphics.fillText(h["char"],h.x+i,h.y+s,n,a,"left")}},HTMLElement._EMPTYTEXT={text:null,words:null},HTMLElement}(Sprite),HTMLBrElement=function(t){function e(){e.__super.call(this),this.style.lineElement=!0,this.style.block=!0}return __class(e,"laya.html.dom.HTMLBrElement",t),e}(HTMLElement),HTMLDivElement=function(t){function e(){this.contextHeight=NaN,this.contextWidth=NaN,e.__super.call(this),this.style.block=!0,this.style.lineElement=!0,this.style.width=200,this.style.height=200}__class(e,"laya.html.dom.HTMLDivElement",t);var i=e.prototype;return i.appendHTML=function(t){HTMLParse.parse(this,t,this.URI),this.layout()},i._addChildsToLayout=function(t){var e=this._getWords();if(null==e&&0==this._childs.length)return!1;e&&e.forEach(function(e){t.push(e)});for(var i=!0,s=0,n=this._childs.length;n>s;s++){var a=this._childs[s];i?i=!1:t.push(null),a._addToLayout(t)}return!0},i._addToLayout=function(t){this.layout()},i.layout=function(){this.style._type|=512;var t=Layout.layout(this);if(t){this._$P.mHtmlBounds||this._set$P("mHtmlBounds",new Rectangle);var e=this._$P.mHtmlBounds;e.x=e.y=0,e.width=this.contextWidth=t[0],e.height=this.contextHeight=t[1],this.setBounds(e)}},__getset(0,i,"height",function(){return this._height?this._height:this.contextHeight},t.prototype._$set_height),__getset(0,i,"innerHTML",null,function(t){this.destroyChildren(),this.appendHTML(t)}),__getset(0,i,"width",function(){return this._width?this._width:this.contextWidth},function(e){var i=!1;i=e!=this.width,t.prototype._$set_width.call(this,e),i&&this.layout()}),e}(HTMLElement),HTMLDocument=function(t){function e(){this.all=new Array,this.styleSheets=CSSStyle.styleSheets,e.__super.call(this)}__class(e,"laya.html.dom.HTMLDocument",t);var i=e.prototype;return i.getElementById=function(t){return this.all[t]},i.setElementById=function(t,e){this.all[t]=e},__static(e,["document",function(){return this.document=new e}]),e}(HTMLElement),HTMLImageElement=function(t){function e(){this._tex=null,this._url=null,this._renderArgs=[],e.__super.call(this),this.style.block=!0}__class(e,"laya.html.dom.HTMLImageElement",t);var i=e.prototype;return i._addToLayout=function(t){!this._style.absolute&&t.push(this)},i.render=function(t,e,i){!this._tex||!this._tex.loaded||!this._tex.loaded||this._width<1||this._height<1||(Stat.spriteCount++,this._renderArgs[0]=this._tex,this._renderArgs[1]=this.x,this._renderArgs[2]=this.y,this._renderArgs[3]=this.width||this._tex.width,this._renderArgs[4]=this.height||this._tex.height,t.ctx.drawTexture2(e,i,this.style.translateX,this.style.translateY,this.transform,this.style.alpha,this.style.blendMode,this._renderArgs))},__getset(0,i,"src",null,function(t){function e(){var t=i._style;t.widthed(i)||i._tex.width,t.heighted(i)||i._tex.height,t.widthed(i)||i._width==i._tex.width||(i.width=i._tex.width,i.parent&&i.parent._layoutLater()),t.heighted(i)||i._height==i._tex.height||(i.height=i._tex.height,i.parent&&i.parent._layoutLater()),Render.isConchApp&&(i._renderArgs[0]=i._tex,i._renderArgs[1]=i.x,i._renderArgs[2]=i.y,i._renderArgs[3]=i.width||i._tex.width,i._renderArgs[4]=i.height||i._tex.height,i.graphics.drawTexture(i._tex,0,0,i._renderArgs[3],i._renderArgs[4])),i.repaint(),i.parentRepaint()}var i=this;if(t=this.formatURL(t),this._url!=t){this._url=t;var s=this._tex=Loader.getRes(t);s||(this._tex=s=new Texture,s.load(t),Loader.cacheRes(t,s)),s.loaded?e():s.on("loaded",null,e)}}),e}(HTMLElement),HTMLLinkElement=function(t){function e(){this.type=null,e.__super.call(this),this.visible=!1}__class(e,"laya.html.dom.HTMLLinkElement",t);var i=e.prototype;return i._onload=function(t){switch(this.type){case"text/css":CSSStyle.parseCSS(t,this.URI)}},__getset(0,i,"href",t.prototype._$get_href,function(t){var e=this;t=this.formatURL(t),this.URI=new URL(t);var i=new Loader;i.once("complete",null,function(t){e._onload(t)}),i.load(t,"text")}),e._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g"),e}(HTMLElement),HTMLStyleElement=function(t){function e(){e.__super.call(this),this.visible=!1}return __class(e,"laya.html.dom.HTMLStyleElement",t),__getset(0,e.prototype,"text",t.prototype._$get_text,function(t){CSSStyle.parseCSS(t,null)}),e}(HTMLElement),HTMLIframeElement=function(t){function e(){e.__super.call(this),this._getCSSStyle().valign="middle"}return __class(e,"laya.html.dom.HTMLIframeElement",t),__getset(0,e.prototype,"href",t.prototype._$get_href,function(t){var e=this;t=this.formatURL(t);var i=new Loader;i.once("complete",null,function(i){var s=e.URI;e.URI=new URL(t),e.innerHTML=i,!s||(e.URI=s)}),i.load(t,"text")}),e}(HTMLDivElement)}(window,document,Laya),!function(t,e,i){var s=(i.un,i.uns,i["static"]),n=i["class"],a=i.getset,o=(i.__newvec,laya.resource.Bitmap),r=laya.utils.Browser,h=(laya.events.Event,laya.events.EventDispatcher),l=(laya.utils.Handler,laya.maths.Rectangle,laya.renders.Render),c=laya.display.Sprite,d=(laya.display.Stage,laya.resource.Texture),u=laya.utils.Utils,p=laya.webgl.WebGL,_=laya.webgl.WebGLContext,f=(function(){function t(){}n(t,"laya.device.geolocation.Geolocation"),t.getCurrentPosition=function(e,i){t.navigator.geolocation.getCurrentPosition(function(i){t.position.setPosition(i),e.runWith(t.position)},function(t){i.runWith(t)},{enableHighAccuracy:laya.device.geolocation.Geolocation.enableHighAccuracy,timeout:laya.device.geolocation.Geolocation.timeout,maximumAge:laya.device.geolocation.Geolocation.maximumAge})},t.watchPosition=function(e,i){return t.navigator.geolocation.watchPosition(function(i){t.position.setPosition(i),e.runWith(t.position)},function(t){i.runWith(t)},{enableHighAccuracy:t.enableHighAccuracy,timeout:t.timeout,maximumAge:t.maximumAge})},t.clearWatch=function(e){t.navigator.geolocation.clearWatch(e)},t.PERMISSION_DENIED=1,t.POSITION_UNAVAILABLE=2,t.TIMEOUT=3,t.enableHighAccuracy=!1,t.maximumAge=0,s(t,["navigator",function(){return this.navigator=r.window.navigator},"position",function(){return this.position=new f},"supported",function(){return this.supported=!!t.navigator.geolocation},"timeout",function(){return this.timeout=1e10}]),t}(),function(){function t(){this.pos=null,this.coords=null}n(t,"laya.device.geolocation.GeolocationInfo");var e=t.prototype;return e.setPosition=function(t){this.pos=t,this.coords=t.coords},a(0,e,"heading",function(){return this.coords.heading}),a(0,e,"latitude",function(){return this.coords.latitude}),a(0,e,"altitudeAccuracy",function(){return this.coords.altitudeAccuracy}),a(0,e,"longitude",function(){return this.coords.longitude}),a(0,e,"altitude",function(){return this.coords.altitude}),a(0,e,"accuracy",function(){return this.coords.accuracy}),a(0,e,"speed",function(){return this.coords.speed}),a(0,e,"timestamp",function(){return this.pos.timestamp}),t}()),y=function(){function t(){}return n(t,"laya.device.media.Media"),t.supported=function(){return!!r.window.navigator.getUserMedia},t.getMedia=function(t,e,i){r.window.navigator.getUserMedia&&r.window.navigator.getUserMedia(t,function(t){e.runWith(r.window.URL.createObjectURL(t))},function(t){i.runWith(t)})},t.__init$=function(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia},t}(),m=function(){function t(){this.x=NaN,this.y=NaN,this.z=NaN}return n(t,"laya.device.motion.AccelerationInfo"),t}(),g=function(){function t(){this.absolute=!1,this.alpha=NaN,this.beta=NaN,this.gamma=NaN,this.compassAccuracy=NaN}return n(t,"laya.device.motion.RotationInfo"),t}(),v=function(t){function e(t){e.__super.call(this),this.onDeviceOrientationChange=this.onDeviceOrientationChange.bind(this)}n(e,"laya.device.motion.Accelerator",t);var o=e.prototype;return o.on=function(e,i,s,n){return t.prototype.on.call(this,e,i,s,n),r.window.addEventListener("devicemotion",this.onDeviceOrientationChange),this},o.off=function(e,i,s,n){return void 0===n&&(n=!1),this.hasListener(e)||r.window.removeEventListener("devicemotion",this.onDeviceOrientationChange),t.prototype.off.call(this,e,i,s,n)},o.onDeviceOrientationChange=function(t){var i=t.interval;e.acceleration.x=t.acceleration.x,e.acceleration.y=t.acceleration.y,e.acceleration.z=t.acceleration.z,e.accelerationIncludingGravity.x=t.accelerationIncludingGravity.x,e.accelerationIncludingGravity.y=t.accelerationIncludingGravity.y,e.accelerationIncludingGravity.z=t.accelerationIncludingGravity.z,e.rotationRate.alpha=-1*t.rotationRate.gamma,e.rotationRate.beta=-1*t.rotationRate.alpha,e.rotationRate.gamma=t.rotationRate.beta,r.onAndriod?(e.onChrome&&(e.rotationRate.alpha*=180/Math.PI,e.rotationRate.beta*=180/Math.PI,e.rotationRate.gamma*=180/Math.PI),e.acceleration.x*=-1,e.accelerationIncludingGravity.x*=-1):r.onIOS&&(e.acceleration.y*=-1,e.acceleration.z*=-1,e.accelerationIncludingGravity.y*=-1,e.accelerationIncludingGravity.z*=-1,i*=1e3),this.event("change",[e.acceleration,e.accelerationIncludingGravity,e.rotationRate,i])},a(1,e,"instance",function(){return e._instance=e._instance||new e(0),e._instance},laya.events.EventDispatcher._$SET_instance),e.getTransformedAcceleration=function(t){e.transformedAcceleration=e.transformedAcceleration||new m,e.transformedAcceleration.z=t.z,90==r.window.orientation?(e.transformedAcceleration.x=t.y,e.transformedAcceleration.y=-t.x):-90==r.window.orientation?(e.transformedAcceleration.x=-t.y,e.transformedAcceleration.y=t.x):r.window.orientation?180==r.window.orientation&&(e.transformedAcceleration.x=-t.x,e.transformedAcceleration.y=-t.y):(e.transformedAcceleration.x=t.x,e.transformedAcceleration.y=t.y);var s=NaN;return-90==i.stage.canvasDegree?(s=e.transformedAcceleration.x,e.transformedAcceleration.x=-e.transformedAcceleration.y,e.transformedAcceleration.y=s):90==i.stage.canvasDegree&&(s=e.transformedAcceleration.x,e.transformedAcceleration.x=e.transformedAcceleration.y,e.transformedAcceleration.y=-s),e.transformedAcceleration},e._instance=null,e.transformedAcceleration=null,s(e,["acceleration",function(){return this.acceleration=new m},"accelerationIncludingGravity",function(){return this.accelerationIncludingGravity=new m},"rotationRate",function(){return this.rotationRate=new g},"onChrome",function(){return this.onChrome=r.userAgent.indexOf("Chrome")>-1}]),e}(h),C=(function(t){function e(t){e.__super.call(this),this.onDeviceOrientationChange=this.onDeviceOrientationChange.bind(this)}n(e,"laya.device.motion.Gyroscope",t);var i=e.prototype;i.on=function(e,i,s,n){return t.prototype.on.call(this,e,i,s,n),r.window.addEventListener("deviceorientation",this.onDeviceOrientationChange),this},i.off=function(e,i,s,n){return void 0===n&&(n=!1),this.hasListener(e)||r.window.removeEventListener("deviceorientation",this.onDeviceOrientationChange),t.prototype.off.call(this,e,i,s,n)},i.onDeviceOrientationChange=function(t){e.info.alpha=t.alpha,e.info.beta=t.beta,e.info.gamma=t.gamma,t.webkitCompassHeading&&(e.info.alpha=-1*t.webkitCompassHeading,e.info.compassAccuracy=t.webkitCompassAccuracy),this.event("change",[t.absolute,e.info])},a(1,e,"instance",function(){return e._instance=e._instance||new e(0),e._instance},laya.events.EventDispatcher._$SET_instance),e._instance=null,s(e,["info",function(){return this.info=new g}]),e}(h),function(t){function e(){this.throushold=0,this.shakeInterval=0,this.callback=null,this.lastX=NaN,this.lastY=NaN,this.lastZ=NaN,this.lastMillSecond=NaN,e.__super.call(this)}n(e,"laya.device.Shake",t);var i=e.prototype;i.start=function(t,e){this.throushold=t,this.shakeInterval=e,this.lastX=this.lastY=this.lastZ=NaN,v.instance.on("change",this,this.onShake)},i.stop=function(){v.instance.off("change",this,this.onShake)},i.onShake=function(t,e,i,s){if(isNaN(this.lastX))return this.lastX=e.x,this.lastY=e.y,this.lastZ=e.z,void(this.lastMillSecond=r.now());var n=Math.abs(this.lastX-e.x),a=Math.abs(this.lastY-e.y),o=Math.abs(this.lastZ-e.z);this.isShaked(n,a,o)&&r.now()-this.lastMillSecond>this.shakeInterval&&(this.event("change"),this.lastMillSecond=r.now()),this.lastX=e.x,this.lastY=e.y,this.lastZ=e.z},i.isShaked=function(t,e,i){return t>this.throushold&&e>this.throushold||t>this.throushold&&i>this.throushold||e>this.throushold&&i>this.throushold},a(1,e,"instance",function(){return e._instance=e._instance||new e,e._instance},laya.events.EventDispatcher._$SET_instance),e._instance=null,e}(h),function(t){function e(t,i){this.htmlVideo=null,this.videoElement=null,this.internalTexture=null,void 0===t&&(t=320),void 0===i&&(i=240),e.__super.call(this),l.isWebGL?this.htmlVideo=new x:this.htmlVideo=new w,this.videoElement=this.htmlVideo.getVideo(),this.videoElement.layaTarget=this,this.internalTexture=new d(this.htmlVideo),this.videoElement.addEventListener("abort",e.onAbort),this.videoElement.addEventListener("canplay",e.onCanplay),this.videoElement.addEventListener("canplaythrough",e.onCanplaythrough),this.videoElement.addEventListener("durationchange",e.onDurationchange),this.videoElement.addEventListener("emptied",e.onEmptied),this.videoElement.addEventListener("error",e.onError),this.videoElement.addEventListener("loadeddata",e.onLoadeddata),this.videoElement.addEventListener("loadedmetadata",e.onLoadedmetadata),this.videoElement.addEventListener("loadstart",e.onLoadstart),this.videoElement.addEventListener("pause",e.onPause),this.videoElement.addEventListener("play",e.onPlay),this.videoElement.addEventListener("playing",e.onPlaying),this.videoElement.addEventListener("progress",e.onProgress),this.videoElement.addEventListener("ratechange",e.onRatechange),this.videoElement.addEventListener("seeked",e.onSeeked),this.videoElement.addEventListener("seeking",e.onSeeking),this.videoElement.addEventListener("stalled",e.onStalled),this.videoElement.addEventListener("suspend",e.onSuspend),this.videoElement.addEventListener("timeupdate",e.onTimeupdate),this.videoElement.addEventListener("volumechange",e.onVolumechange),this.videoElement.addEventListener("waiting",e.onWaiting),this.videoElement.addEventListener("ended",this.onPlayComplete.bind(this)),this.size(t,i),r.onMobile&&(this.onDocumentClick=this.onDocumentClick.bind(this),r.document.addEventListener("touchend",this.onDocumentClick))}n(e,"laya.device.media.Video",t);var s=e.prototype;return s.onPlayComplete=function(t){i.timer.clear(this,this.renderCanvas),this.event("ended")},s.load=function(t){0==t.indexOf("blob:")?this.videoElement.src=t:this.htmlVideo.setSource(t,laya.device.media.Video.MP4)},s.play=function(){this.videoElement.play(),i.timer.frameLoop(1,this,this.renderCanvas)},s.pause=function(){this.videoElement.pause(),i.timer.clear(this,this.renderCanvas)},s.reload=function(){this.videoElement.load()},s.canPlayType=function(t){var e;switch(t){case laya.device.media.Video.MP4:e="video/mp4";break;case laya.device.media.Video.OGG:e="video/ogg";break;case laya.device.media.Video.WEBM:e="video/webm"}return this.videoElement.canPlayType(e)},s.renderCanvas=function(){0!==this.readyState&&(l.isWebGL&&this.htmlVideo.updateTexture(),this.graphics.clear(),this.graphics.drawTexture(this.internalTexture,0,0,this.width,this.height))},s.onDocumentClick=function(){this.videoElement.play(),this.videoElement.pause(),r.document.removeEventListener("touchend",this.onDocumentClick)},s.size=function(e,i){return t.prototype.size.call(this,e,i),this.videoElement.width=e/r.pixelRatio,this.paused&&this.renderCanvas(),this},s.destroy=function(i){void 0===i&&(i=!0),t.prototype.destroy.call(this,i),this.videoElement.removeEventListener("abort",e.onAbort),this.videoElement.removeEventListener("canplay",e.onCanplay),this.videoElement.removeEventListener("canplaythrough",e.onCanplaythrough),this.videoElement.removeEventListener("durationchange",e.onDurationchange),this.videoElement.removeEventListener("emptied",e.onEmptied),this.videoElement.removeEventListener("error",e.onError),this.videoElement.removeEventListener("loadeddata",e.onLoadeddata),this.videoElement.removeEventListener("loadedmetadata",e.onLoadedmetadata),this.videoElement.removeEventListener("loadstart",e.onLoadstart),this.videoElement.removeEventListener("pause",e.onPause),this.videoElement.removeEventListener("play",e.onPlay),this.videoElement.removeEventListener("playing",e.onPlaying),this.videoElement.removeEventListener("progress",e.onProgress),this.videoElement.removeEventListener("ratechange",e.onRatechange),this.videoElement.removeEventListener("seeked",e.onSeeked),this.videoElement.removeEventListener("seeking",e.onSeeking),this.videoElement.removeEventListener("stalled",e.onStalled),this.videoElement.removeEventListener("suspend",e.onSuspend),this.videoElement.removeEventListener("timeupdate",e.onTimeupdate),this.videoElement.removeEventListener("volumechange",e.onVolumechange),this.videoElement.removeEventListener("waiting",e.onWaiting),this.videoElement.removeEventListener("ended",this.onPlayComplete),this.pause(),this.videoElement=null},s.syncVideoPosition=function(){var t,e=i.stage;t=u.getGlobalPosAndScale(this);var s=e._canvasTransform.a,n=e._canvasTransform.d,a=t.x*e.clientScaleX*s+e.offset.x,o=t.y*e.clientScaleY*n+e.offset.y;this.videoElement.style.left=a+"px",this.videoElement.style.top=o+"px",this.videoElement.width=this.width/r.pixelRatio,this.videoElement.height=this.height/r.pixelRatio},a(0,s,"buffered",function(){return this.videoElement.buffered}),a(0,s,"videoWidth",function(){return this.videoElement.videoWidth}),a(0,s,"currentSrc",function(){return this.videoElement.currentSrc}),a(0,s,"currentTime",function(){return this.videoElement.currentTime},function(t){this.videoElement.currentTime=t,this.renderCanvas()}),a(0,s,"ended",function(){return this.videoElement.ended}),a(0,s,"volume",function(){return this.videoElement.volume},function(t){this.videoElement.volume=t}),a(0,s,"videoHeight",function(){return this.videoElement.videoHeight}),a(0,s,"readyState",function(){return this.videoElement.readyState}),a(0,s,"duration",function(){return this.videoElement.duration}),a(0,s,"error",function(){return this.videoElement.error}),a(0,s,"loop",function(){return this.videoElement.loop},function(t){this.videoElement.loop=t}),a(0,s,"playbackRate",function(){return this.videoElement.playbackRate},function(t){this.videoElement.playbackRate=t}),a(0,s,"muted",function(){return this.videoElement.muted},function(t){this.videoElement.muted=t}),a(0,s,"paused",function(){return this.videoElement.paused}),a(0,s,"preload",function(){return this.videoElement.preload},function(t){this.videoElement.preload=t}),a(0,s,"seekable",function(){return this.videoElement.seekable}),a(0,s,"seeking",function(){return this.videoElement.seeking}),a(0,s,"height",t.prototype._$get_height,function(e){t.prototype._$set_height.call(this,e),this.paused&&this.renderCanvas()}),a(0,s,"width",t.prototype._$get_width,function(e){this.videoElement.width=this.width/r.pixelRatio,t.prototype._$set_width.call(this,e),this.paused&&this.renderCanvas()}),e.onAbort=function(t){t.target.layaTarget.event("abort")},e.onCanplay=function(t){t.target.layaTarget.event("canplay")},e.onCanplaythrough=function(t){t.target.layaTarget.event("canplaythrough")},e.onDurationchange=function(t){t.target.layaTarget.event("durationchange")},e.onEmptied=function(t){t.target.layaTarget.event("emptied")},e.onError=function(t){t.target.layaTarget.event("error")},e.onLoadeddata=function(t){t.target.layaTarget.event("loadeddata")},e.onLoadedmetadata=function(t){t.target.layaTarget.event("loadedmetadata")},e.onLoadstart=function(t){t.target.layaTarget.event("loadstart")},e.onPause=function(t){t.target.layaTarget.event("pause")},e.onPlay=function(t){t.target.layaTarget.event("play")},e.onPlaying=function(t){t.target.layaTarget.event("playing")},e.onProgress=function(t){t.target.layaTarget.event("progress")},e.onRatechange=function(t){t.target.layaTarget.event("ratechange")},e.onSeeked=function(t){t.target.layaTarget.event("seeked")},e.onSeeking=function(t){t.target.layaTarget.event("seeking")},e.onStalled=function(t){t.target.layaTarget.event("stalled")},e.onSuspend=function(t){t.target.layaTarget.event("suspend")},e.onTimeupdate=function(t){t.target.layaTarget.event("timeupdate")},e.onVolumechange=function(t){t.target.layaTarget.event("volumechange")},e.onWaiting=function(t){t.target.layaTarget.event("waiting")},e.MP4=1,e.OGG=2,e.CAMERA=4,e.WEBM=8,e.SUPPORT_PROBABLY="probably",e.SUPPORT_MAYBY="maybe",e.SUPPORT_NO="",e}(c)),w=function(t){function e(){this.video=null,e.__super.call(this),this._w=1,this._h=1,this.createDomElement()}n(e,"laya.device.media.HtmlVideo",t);var i=e.prototype;return i.createDomElement=function(){var t=this;this._source=this.video=r.createElement("video");var e=this.video.style;e.position="absolute",e.top="0px",e.left="0px",this.video.addEventListener("loadedmetadata",function(){this._w=t.video.videoWidth,this._h=t.video.videoHeight}.bind(this))},i.setSource=function(t,e){for(;this.video.childElementCount;)this.video.firstChild.remove();e&C.MP4&&this.appendSource(t,"video/mp4"),e&C.OGG&&this.appendSource(t+".ogg","video/ogg")},i.appendSource=function(t,e){var i=r.createElement("source");i.src=t,i.type=e,this.video.appendChild(i)},i.getVideo=function(){return this.video},e.create=function(){return new e},e}(o),x=function(t){function e(){this.gl=null,this.preTarget=null,this.preTexture=null,e.__super.call(this),r.onIPhone||(this.gl=p.mainContext,this._source=this.gl.createTexture(),this.preTarget=_.curBindTexTarget,this.preTexture=_.curBindTexValue,_.bindTexture(this.gl,3553,this._source),this.gl.texParameteri(3553,10242,33071),this.gl.texParameteri(3553,10243,33071),this.gl.texParameteri(3553,10240,9729),this.gl.texParameteri(3553,10241,9729),this.preTarget&&this.preTexture&&_.bindTexture(this.gl,this.preTarget,this.preTexture))}return n(e,"laya.device.media.WebGLVideo",t),e.prototype.updateTexture=function(){r.onIPhone||(_.bindTexture(this.gl,3553,this._source),this.gl.texImage2D(3553,0,6407,6407,5121,this.video))},e}(w);i.__init([y])}(window,document,Laya),function(t,e,i){var s=(i.un,i.uns,i["static"]),n=i["class"],a=i.getset,o=(i.__newvec,laya.display.Animation),r=laya.utils.ClassUtils,h=laya.filters.ColorFilter,l=laya.utils.Ease,c=laya.events.Event,d=laya.display.css.Font,u=laya.display.FrameAnimation,p=laya.display.Graphics,_=laya.utils.Handler,f=laya.display.Input,y=laya.net.Loader,m=(laya.display.Node,laya.maths.Point),g=laya.maths.Rectangle,v=laya.renders.Render,C=laya.display.Sprite,w=laya.display.Text,x=laya.resource.Texture,b=laya.utils.Tween,S=laya.utils.Utils;i["interface"]("laya.ui.IItem"),i["interface"]("laya.ui.ISelect"),i["interface"]("laya.ui.IRender"),i["interface"]("laya.ui.IComponent"),i["interface"]("laya.ui.IBox","IComponent");var I=function(){function t(){this.enable=!1,this.top=NaN,this.bottom=NaN,this.left=NaN,this.right=NaN,this.centerX=NaN,this.centerY=NaN,this.anchorX=NaN,this.anchorY=NaN}return n(t,"laya.ui.LayoutStyle"),s(t,["EMPTY",function(){return this.EMPTY=new t}]),t}(),T=function(){function t(){}return n(t,"laya.ui.Styles"),t.labelColor="#000000",t.buttonStateNum=3,t.scrollBarMinNum=15,t.scrollBarDelayTime=500,s(t,["defaultSizeGrid",function(){return this.defaultSizeGrid=[4,4,4,4,0]},"labelPadding",function(){return this.labelPadding=[2,2,2,2]},"inputLabelPadding",function(){return this.inputLabelPadding=[1,1,1,3]},"buttonLabelColors",function(){return this.buttonLabelColors=["#32556b","#32cc6b","#ff0000","#C0C0C0"]},"comboBoxItemColors",function(){return this.comboBoxItemColors=["#5e95b6","#ffffff","#000000","#8fa4b1","#ffffff"]}]),t}(),L=function(){function t(){}return n(t,"laya.ui.UIUtils"),t.fillArray=function(t,e,i){var s=t.concat();if(e)for(var n=e.split(","),a=0,o=Math.min(s.length,n.length);o>a;a++){var r=n[a];s[a]="true"==r?!0:"false"==r?!1:r,null!=i&&(s[a]=i(r))}return s},t.toColor=function(t){return S.toHexColor(t)},t.gray=function(e,i){void 0===i&&(i=!0),i?t.addFilter(e,t.grayFilter):t.clearFilter(e,h)},t.addFilter=function(t,e){var i=t.filters||[];i.push(e),t.filters=i},t.clearFilter=function(t,e){var s=t.filters;if(null!=s&&s.length>0){for(var n=s.length-1;n>-1;n--){var a=s[n];i.__typeof(a,e)&&s.splice(n,1)}t.filters=s}},t._getReplaceStr=function(e){return t.escapeSequence[e]},t.adptString=function(e){return e.replace(/\\(\w)/g,t._getReplaceStr)},s(t,["grayFilter",function(){return this.grayFilter=new h([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])},"escapeSequence",function(){return this.escapeSequence={"\\n":"\n","\\t":"	"}}]),t}(),k=function(){function t(){}return n(t,"UIConfig"),t.touchScrollEnable=!0,t.mouseWheelEnable=!0,t.showButtons=!0,t.popupBgColor="#000000",t.popupBgAlpha=.5,t.closeDialogOnSide=!0,t}(),E=function(t){function e(){this.autoCacheCmd=!0,this._width=0,this._height=0,this._source=null,this._sizeGrid=null,this._isChanged=!1,this._offset=null,e.__super.call(this)}n(e,"laya.ui.AutoBitmap",t);var s=e.prototype;return s.destroy=function(){t.prototype.destroy.call(this),this._source=null,this._sizeGrid=null,this._offset=null},s._setChanged=function(){this._isChanged||(this._isChanged=!0,i.timer.callLater(this,this.changeSource))},s.changeSource=function(){e.cacheCount++>50&&e.clearCache(),this._isChanged=!1;var t=this._source;if(t&&t.bitmap){var i=this.width,s=this.height,n=this._sizeGrid,a=t.sourceWidth,o=t.sourceHeight;if(!n||a===i&&o===s)this.cleanByTexture(t,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,i,s);else{t.$_GID||(t.$_GID=S.getGID());var r=t.$_GID+"."+i+"."+s+"."+n.join(".");if(e.cmdCaches[r])return void(this.cmds=e.cmdCaches[r]);this.clear();var h=n[0],l=n[1],c=n[2],d=n[3],u=n[4],p=!1;if(d+l>i){var _=i;p=!0,i=d+l}p&&(this.save(),this.clipRect(0,0,_,s)),d&&h&&this.drawTexture(e.getTexture(t,0,0,d,h),0,0,d,h),l&&h&&this.drawTexture(e.getTexture(t,a-l,0,l,h),i-l,0,l,h),d&&c&&this.drawTexture(e.getTexture(t,0,o-c,d,c),0,s-c,d,c),l&&c&&this.drawTexture(e.getTexture(t,a-l,o-c,l,c),i-l,s-c,l,c),h&&this.drawBitmap(u,e.getTexture(t,d,0,a-d-l,h),d,0,i-d-l,h),c&&this.drawBitmap(u,e.getTexture(t,d,o-c,a-d-l,c),d,s-c,i-d-l,c),d&&this.drawBitmap(u,e.getTexture(t,0,h,d,o-h-c),0,h,d,s-h-c),l&&this.drawBitmap(u,e.getTexture(t,a-l,h,l,o-h-c),i-l,h,l,s-h-c),this.drawBitmap(u,e.getTexture(t,d,h,a-d-l,o-h-c),d,h,i-d-l,s-h-c),p&&this.restore(),this.autoCacheCmd&&!v.isConchApp&&(e.cmdCaches[r]=this.cmds)}this._repaint()}},s.drawBitmap=function(t,e,i,s,n,a){void 0===n&&(n=0),void 0===a&&(a=0),.1>n||.1>a||(!t||e.width==n&&e.height==a?this.drawTexture(e,i,s,n,a):this.fillTexture(e,i,s,n,a))},a(0,s,"sizeGrid",function(){return this._sizeGrid},function(t){this._sizeGrid=t,this._setChanged()}),a(0,s,"width",function(){return this._width?this._width:this._source?this._source.sourceWidth:0},function(t){this._width!=t&&(this._width=t,this._setChanged())}),a(0,s,"height",function(){return this._height?this._height:this._source?this._source.sourceHeight:0},function(t){this._height!=t&&(this._height=t,this._setChanged())}),a(0,s,"source",function(){return this._source},function(t){t?(this._source=t,this._setChanged()):(this._source=null,this.clear())}),e.getTexture=function(t,i,s,n,a){0>=n&&(n=1),0>=a&&(a=1),t.$_GID||(t.$_GID=S.getGID());var o=t.$_GID+"."+i+"."+s+"."+n+"."+a,r=e.textureCache[o];return r||(r=e.textureCache[o]=x.createFromTexture(t,i,s,n,a)),r},e.clearCache=function(){e.cacheCount=0,e.cmdCaches={},e.textureCache={}},e.setCache=function(t,i){e.cacheCount++,e.textureCache[t]=i},e.getCache=function(t){return e.textureCache[t]},e.cmdCaches={},e.cacheCount=0,e.textureCache={},e}(p),D=(function(t){function e(){e.__super.call(this)}return n(e,"laya.ui.UIEvent",t),e.SHOW_TIP="showtip",e.HIDE_TIP="hidetip",e}(c),function(t){function e(){this._comXml=null,this._dataSource=null,this._toolTip=null,this._tag=null,this._disabled=!1,this._gray=!1,this.layoutEnabled=!0,e.__super.call(this),this._layout=I.EMPTY,this.preinitialize(),this.createChildren(),this.initialize()}n(e,"laya.ui.Component",t);var s=e.prototype;return i.imps(s,{"laya.ui.IComponent":!0}),s.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._dataSource=this._layout=null,this._tag=null,this._toolTip=null},s.preinitialize=function(){},s.createChildren=function(){},s.initialize=function(){},s.callLater=function(t,e){i.timer.callLater(this,t,e)},s.runCallLater=function(t){i.timer.runCallLater(this,t)},s.commitMeasure=function(){},s.changeSize=function(){this.event("resize")},s.getLayout=function(){return this._layout===I.EMPTY&&(this._layout=new I),this._layout},s._setLayoutEnabled=function(t){this._layout&&this._layout.enable!=t&&(this._layout.enable=t,this.on("added",this,this.onAdded),
this.on("removed",this,this.onRemoved),this.parent&&this.onAdded())},s.onRemoved=function(){this.parent.off("resize",this,this.onCompResize)},s.onAdded=function(){this.parent.on("resize",this,this.onCompResize),this.resetLayoutX(),this.resetLayoutY()},s.onCompResize=function(){this._layout&&this._layout.enable&&(this.resetLayoutX(),this.resetLayoutY())},s.resetLayoutX=function(){var t=this._layout;if(isNaN(t.anchorX)||(this.pivotX=t.anchorX*this.width),this.layoutEnabled){var e=this.parent;e&&(isNaN(t.centerX)?isNaN(t.left)?isNaN(t.right)||(this.x=Math.round(e.width-this.displayWidth-t.right+this.pivotX*this.scaleX)):(this.x=Math.round(t.left+this.pivotX*this.scaleX),isNaN(t.right)||(this.width=(e._width-t.left-t.right)/(this.scaleX||.01))):this.x=Math.round(.5*(e.width-this.displayWidth)+t.centerX+this.pivotX*this.scaleX))}},s.resetLayoutY=function(){var t=this._layout;if(isNaN(t.anchorY)||(this.pivotY=t.anchorY*this.height),this.layoutEnabled){var e=this.parent;e&&(isNaN(t.centerY)?isNaN(t.top)?isNaN(t.bottom)||(this.y=Math.round(e.height-this.displayHeight-t.bottom+this.pivotY*this.scaleY)):(this.y=Math.round(t.top+this.pivotY*this.scaleY),isNaN(t.bottom)||(this.height=(e._height-t.top-t.bottom)/(this.scaleY||.01))):this.y=Math.round(.5*(e.height-this.displayHeight)+t.centerY+this.pivotY*this.scaleY))}},s.onMouseOver=function(t){i.stage.event("showtip",this._toolTip)},s.onMouseOut=function(t){i.stage.event("hidetip",this._toolTip)},a(0,s,"displayWidth",function(){return this.width*this.scaleX}),a(0,s,"width",function(){return this._width?this._width:this.measureWidth},function(t){this._width!=t&&(this._width=t,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerX)&&isNaN(this._layout.right)&&isNaN(this._layout.anchorX)||this.resetLayoutX())}),a(0,s,"measureWidth",function(){var t=0;this.commitMeasure();for(var e=this.numChildren-1;e>-1;e--){var i=this.getChildAt(e);i.visible&&(t=Math.max(i.x+i.width*i.scaleX,t))}return t}),a(0,s,"displayHeight",function(){return this.height*this.scaleY}),a(0,s,"height",function(){return this._height?this._height:this.measureHeight},function(t){this._height!=t&&(this._height=t,this.conchModel&&this.conchModel.size(this._width,this._height),this.callLater(this.changeSize),!this._layout.enable||isNaN(this._layout.centerY)&&isNaN(this._layout.bottom)&&isNaN(this._layout.anchorY)||this.resetLayoutY())}),a(0,s,"dataSource",function(){return this._dataSource},function(t){this._dataSource=t;for(var e in this._dataSource)this.hasOwnProperty(e)&&"function"!=typeof this[e]&&(this[e]=this._dataSource[e])}),a(0,s,"scaleY",t.prototype._$get_scaleY,function(e){t.prototype._$get_scaleY.call(this)!=e&&(t.prototype._$set_scaleY.call(this,e),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutY())}),a(0,s,"measureHeight",function(){var t=0;this.commitMeasure();for(var e=this.numChildren-1;e>-1;e--){var i=this.getChildAt(e);i.visible&&(t=Math.max(i.y+i.height*i.scaleY,t))}return t}),a(0,s,"scaleX",t.prototype._$get_scaleX,function(e){t.prototype._$get_scaleX.call(this)!=e&&(t.prototype._$set_scaleX.call(this,e),this.callLater(this.changeSize),this._layout.enable&&this.resetLayoutX())}),a(0,s,"top",function(){return this._layout.top},function(t){t!=this._layout.top&&(this.getLayout().top=t,this._setLayoutEnabled(!0),this.resetLayoutY())}),a(0,s,"bottom",function(){return this._layout.bottom},function(t){t!=this._layout.bottom&&(this.getLayout().bottom=t,this._setLayoutEnabled(!0),this.resetLayoutY())}),a(0,s,"left",function(){return this._layout.left},function(t){t!=this._layout.left&&(this.getLayout().left=t,this._setLayoutEnabled(!0),this.resetLayoutX())}),a(0,s,"right",function(){return this._layout.right},function(t){t!=this._layout.right&&(this.getLayout().right=t,this._setLayoutEnabled(!0),this.resetLayoutX())}),a(0,s,"centerX",function(){return this._layout.centerX},function(t){t!=this._layout.centerX&&(this.getLayout().centerX=t,this._setLayoutEnabled(!0),this.resetLayoutX())}),a(0,s,"centerY",function(){return this._layout.centerY},function(t){t!=this._layout.centerY&&(this.getLayout().centerY=t,this._setLayoutEnabled(!0),this.resetLayoutY())}),a(0,s,"anchorX",function(){return this._layout.anchorX},function(t){t!=this._layout.anchorX&&(this.getLayout().anchorX=t,this._setLayoutEnabled(!0),this.resetLayoutX())}),a(0,s,"anchorY",function(){return this._layout.anchorY},function(t){t!=this._layout.anchorY&&(this.getLayout().anchorY=t,this._setLayoutEnabled(!0),this.resetLayoutY())}),a(0,s,"tag",function(){return this._tag},function(t){this._tag=t}),a(0,s,"toolTip",function(){return this._toolTip},function(t){this._toolTip!=t&&(this._toolTip=t,null!=t?(this.on("mouseover",this,this.onMouseOver),this.on("mouseout",this,this.onMouseOut)):(this.off("mouseover",this,this.onMouseOver),this.off("mouseout",this,this.onMouseOut)))}),a(0,s,"comXml",function(){return this._comXml},function(t){this._comXml=t}),a(0,s,"gray",function(){return this._gray},function(t){t!==this._gray&&(this._gray=t,L.gray(this,t))}),a(0,s,"disabled",function(){return this._disabled},function(t){t!==this._disabled&&(this.gray=this._disabled=t,this.mouseEnabled=!t)}),e}(C)),A=function(t){function e(){this.lockLayer=null,this.popupEffect=function(t){t.scale(1,1),b.from(t,{x:i.stage.width/2,y:i.stage.height/2,scaleX:0,scaleY:0},300,l.backOut,_.create(this,this.doOpen,[t]))},this.closeEffect=function(t,e){b.to(t,{x:i.stage.width/2,y:i.stage.height/2,scaleX:0,scaleY:0},300,l.strongOut,_.create(this,this.doClose,[t,e]))},e.__super.call(this),this.maskLayer=new C,this.popupEffectHandler=new _(this,this.popupEffect),this.closeEffectHandler=new _(this,this.closeEffect),this.mouseEnabled=this.maskLayer.mouseEnabled=!0,this.zOrder=1e3,i.stage.addChild(this),i.stage.on("resize",this,this._onResize),k.closeDialogOnSide&&this.maskLayer.on("click",this,this._closeOnSide),this._onResize(null)}n(e,"laya.ui.DialogManager",t);var s=e.prototype;return s._closeOnSide=function(){var t=this.getChildAt(this.numChildren-1);t instanceof laya.ui.Dialog&&t.close("side")},s.setLockView=function(t){this.lockLayer||(this.lockLayer=new B,this.lockLayer.mouseEnabled=!0,this.lockLayer.size(i.stage.width,i.stage.height)),this.lockLayer.removeChildren(),t&&(t.centerX=t.centerY=0,this.lockLayer.addChild(t))},s._onResize=function(t){var e=this.maskLayer.width=i.stage.width,s=this.maskLayer.height=i.stage.height;this.lockLayer&&this.lockLayer.size(e,s),this.maskLayer.graphics.clear(),this.maskLayer.graphics.drawRect(0,0,e,s,k.popupBgColor),this.maskLayer.alpha=k.popupBgAlpha;for(var n=this.numChildren-1;n>-1;n--){var a=this.getChildAt(n);a.popupCenter&&this._centerDialog(a)}},s._centerDialog=function(t){t.x=Math.round((i.stage.width-t.width>>1)+t.pivotX),t.y=Math.round((i.stage.height-t.height>>1)+t.pivotY)},s.open=function(t,e){void 0===e&&(e=!1),e&&this.removeChildren(),t.popupCenter&&this._centerDialog(t),this.addChild(t),(t.isModal||this._$P.hasZorder)&&this.timer.callLater(this,this._checkMask),null!=t.popupEffect?t.popupEffect.runWith(t):this.doOpen(t),this.event("open")},s.doOpen=function(t){t.onOpened()},s.lock=function(t){this.lockLayer&&(t?this.addChild(this.lockLayer):this.lockLayer.removeSelf())},s.close=function(t,e){null!=t.closeEffect?t.closeEffect.runWith([t,e]):this.doClose(t),this.event("close")},s.doClose=function(t,e){t.removeSelf(),t.isModal&&this._checkMask(),t.closeHandler&&t.closeHandler.runWith(e),t.onClosed(e)},s.closeAll=function(){this.removeChildren(),this.event("close")},s.getDialogsByGroup=function(t){for(var e=[],i=this.numChildren-1;i>-1;i--){var s=this.getChildAt(i);s.group===t&&e.push(s)}return e},s.closeByGroup=function(t){for(var e=[],i=this.numChildren-1;i>-1;i--){var s=this.getChildAt(i);s.group===t&&(s.close(),e.push(s))}return e},s._checkMask=function(){this.maskLayer.removeSelf();for(var t=this.numChildren-1;t>-1;t--){var e=this.getChildAt(t);if(e&&e.isModal)return void this.addChildAt(this.maskLayer,t)}},e}(C),B=function(t){function e(){e.__super.call(this)}n(e,"laya.ui.Box",t);var s=e.prototype;return i.imps(s,{"laya.ui.IBox":!0}),a(0,s,"dataSource",t.prototype._$get_dataSource,function(t){this._dataSource=t;for(var e in t){var i=this.getChildByName(e);i?i.dataSource=t[e]:this.hasOwnProperty(e)&&"function"!=typeof this[e]&&(this[e]=t[e])}}),e}(D),P=function(t){function e(t,i){this.toggle=!1,this._bitmap=null,this._text=null,this._strokeColors=null,this._state=0,this._selected=!1,this._skin=null,this._autoSize=!0,this._sources=null,this._clickHandler=null,this._stateChanged=!1,e.__super.call(this),this._labelColors=T.buttonLabelColors,this._stateNum=T.buttonStateNum,void 0===i&&(i=""),this.skin=t,this.label=i}n(e,"laya.ui.Button",t);var o=e.prototype;return i.imps(o,{"laya.ui.ISelect":!0}),o.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._bitmap&&this._bitmap.destroy(),this._text&&this._text.destroy(e),this._bitmap=null,this._text=null,this._clickHandler=null,this._labelColors=this._sources=this._strokeColors=null},o.createChildren=function(){this.graphics=this._bitmap=new E},o.createText=function(){this._text||(this._text=new w,this._text.overflow=w.HIDDEN,this._text.align="center",this._text.valign="middle",this._text.width=this._width,this._text.height=this._height)},o.initialize=function(){1!==this._mouseEnableState&&(this.mouseEnabled=!0,this._setBit(2,!0)),this._createListener("mouseover",this,this.onMouse,null,!1,!1),this._createListener("mouseout",this,this.onMouse,null,!1,!1),this._createListener("mousedown",this,this.onMouse,null,!1,!1),this._createListener("mouseup",this,this.onMouse,null,!1,!1),this._createListener("click",this,this.onMouse,null,!1,!1)},o.onMouse=function(t){return this.toggle===!1&&this._selected?void 0:"click"===t.type?(this.toggle&&(this.selected=!this._selected),void(this._clickHandler&&this._clickHandler.run())):void(!this._selected&&(this.state=e.stateMap[t.type]))},o.changeClips=function(){var t=y.getRes(this._skin);if(!t)return void console.log("lose skin",this._skin);var e=t.sourceWidth,i=t.sourceHeight/this._stateNum;t.$_GID||(t.$_GID=S.getGID());var s=t.$_GID+"-"+this._stateNum,n=E.getCache(s);if(n)this._sources=n;else{if(this._sources=[],1===this._stateNum)this._sources.push(t);else for(var a=0;a<this._stateNum;a++)this._sources.push(x.createFromTexture(t,0,i*a,e,i));E.setCache(s,this._sources)}this._autoSize?(this._bitmap.width=this._width||e,this._bitmap.height=this._height||i,this._text&&(this._text.width=this._bitmap.width,this._text.height=this._bitmap.height)):this._text&&(this._text.x=e)},o.changeState=function(){this._stateChanged=!1,this.runCallLater(this.changeClips);var t=this._state<this._stateNum?this._state:this._stateNum-1;this._sources&&(this._bitmap.source=this._sources[t]),this.label&&(this._text.color=this._labelColors[t],this._strokeColors&&(this._text.strokeColor=this._strokeColors[t]))},o._setStateChanged=function(){this._stateChanged||(this._stateChanged=!0,this.callLater(this.changeState))},a(0,o,"labelStrokeColor",function(){return this.createText(),this._text.strokeColor},function(t){this.createText(),this._text.strokeColor=t}),a(0,o,"measureHeight",function(){return this.runCallLater(this.changeClips),this._text?Math.max(this._bitmap.height,this._text.height):this._bitmap.height}),a(0,o,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this.callLater(this.changeClips),this._setStateChanged())}),a(0,o,"state",function(){return this._state},function(t){this._state!=t&&(this._state=t,this._setStateChanged())}),a(0,o,"text",function(){return this.createText(),this._text}),a(0,o,"stateNum",function(){return this._stateNum},function(t){this._stateNum!=t&&(this._stateNum=1>t?1:t>3?3:t,this.callLater(this.changeClips))}),a(0,o,"strokeColors",function(){return this._strokeColors?this._strokeColors.join(","):""},function(t){this._strokeColors=L.fillArray(T.buttonLabelColors,t,String),this._setStateChanged()}),a(0,o,"labelColors",function(){return this._labelColors.join(",")},function(t){this._labelColors=L.fillArray(T.buttonLabelColors,t,String),this._setStateChanged()}),a(0,o,"measureWidth",function(){return this.runCallLater(this.changeClips),this._autoSize?this._bitmap.width:(this.runCallLater(this.changeState),this._bitmap.width+(this._text?this._text.width:0))}),a(0,o,"label",function(){return this._text?this._text.text:null},function(t){(this._text||t)&&(this.createText(),this._text.text!=t&&(t&&!this._text.parent&&this.addChild(this._text),this._text.text=(t+"").replace(/\\n/g,"\n"),this._setStateChanged()))}),a(0,o,"selected",function(){return this._selected},function(t){this._selected!=t&&(this._selected=t,this.state=this._selected?2:0,this.event("change"))}),a(0,o,"labelPadding",function(){return this.createText(),this._text.padding.join(",")},function(t){this.createText(),this._text.padding=L.fillArray(T.labelPadding,t,Number)}),a(0,o,"labelSize",function(){return this.createText(),this._text.fontSize},function(t){this.createText(),this._text.fontSize=t}),a(0,o,"labelStroke",function(){return this.createText(),this._text.stroke},function(t){this.createText(),this._text.stroke=t}),a(0,o,"labelBold",function(){return this.createText(),this._text.bold},function(t){this.createText(),this._text.bold=t}),a(0,o,"labelFont",function(){return this.createText(),this._text.font},function(t){this.createText(),this._text.font=t}),a(0,o,"labelAlign",function(){return this.createText(),this._text.align},function(t){this.createText(),this._text.align=t}),a(0,o,"clickHandler",function(){return this._clickHandler},function(t){this._clickHandler=t}),a(0,o,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(t){this._bitmap.sizeGrid=L.fillArray(T.defaultSizeGrid,t,Number)}),a(0,o,"width",t.prototype._$get_width,function(e){t.prototype._$set_width.call(this,e),this._autoSize&&(this._bitmap.width=e,this._text&&(this._text.width=e))}),a(0,o,"height",t.prototype._$get_height,function(e){t.prototype._$set_height.call(this,e),this._autoSize&&(this._bitmap.height=e,this._text&&(this._text.height=e))}),a(0,o,"dataSource",t.prototype._$get_dataSource,function(e){this._dataSource=e,"number"==typeof e||"string"==typeof e?this.label=e+"":t.prototype._$set_dataSource.call(this,e)}),a(0,o,"iconOffset",function(){return this._bitmap._offset?this._bitmap._offset.join(","):null},function(t){t?this._bitmap._offset=L.fillArray([1,1],t,Number):this._bitmap._offset=[]}),s(e,["stateMap",function(){return this.stateMap={mouseup:0,mouseover:1,mousedown:2,mouseout:0}}]),e}(D),M=function(t){function e(t,i,s){this._sources=null,this._bitmap=null,this._skin=null,this._clipX=1,this._clipY=1,this._clipWidth=0,this._clipHeight=0,this._autoPlay=!1,this._interval=50,this._complete=null,this._isPlaying=!1,this._index=0,this._clipChanged=!1,this._group=null,e.__super.call(this),void 0===i&&(i=1),void 0===s&&(s=1),this._clipX=i,this._clipY=s,this.skin=t}n(e,"laya.ui.Clip",t);var s=e.prototype;return s.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null,this._sources=null},s.dispose=function(){this.destroy(!0),i.loader.clearRes(this._skin)},s.createChildren=function(){this.graphics=this._bitmap=new E},s._onDisplay=function(t){this._isPlaying?this._displayedInStage?this.play():this.stop():this._autoPlay&&this.play()},s.changeClip=function(){if(this._clipChanged=!1,this._skin){var t=y.getRes(this._skin);t?this.loadComplete(this._skin,t):i.loader.load(this._skin,_.create(this,this.loadComplete,[this._skin]))}},s.loadComplete=function(t,e){if(t===this._skin&&e){var i=this._clipWidth||Math.ceil(e.sourceWidth/this._clipX),s=this._clipHeight||Math.ceil(e.sourceHeight/this._clipY),n=this._skin+i+s,a=E.getCache(n);if(a)this._sources=a;else{this._sources=[];for(var o=0;o<this._clipY;o++)for(var r=0;r<this._clipX;r++)this._sources.push(x.createFromTexture(e,i*r,s*o,i,s));E.setCache(n,this._sources)}this.index=this._index,this.event("loaded"),this.onCompResize()}},s.play=function(){this._isPlaying=!0,this.index=0,this._index++,i.timer.loop(this.interval,this,this._loop),this.on("display",this,this._onDisplay),this.on("undisplay",this,this._onDisplay)},s._loop=function(){this._style.visible&&this._sources&&(this.index=this._index,this._index++,this._index>=this._sources.length&&(this._index=0))},s.stop=function(){this._isPlaying=!1,i.timer.clear(this,this._loop)},s._setClipChanged=function(){this._clipChanged||(this._clipChanged=!0,this.callLater(this.changeClip))},a(0,s,"interval",function(){return this._interval},function(t){this._interval!=t&&(this._interval=t,this._isPlaying&&this.play())}),a(0,s,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,t?this._setClipChanged():this._bitmap.source=null)}),a(0,s,"sources",function(){return this._sources},function(t){this._sources=t,this.index=this._index,this.event("loaded")}),a(0,s,"clipX",function(){return this._clipX},function(t){this._clipX=t||1,this._setClipChanged()}),a(0,s,"clipY",function(){return this._clipY},function(t){this._clipY=t||1,this._setClipChanged()}),a(0,s,"total",function(){return this.runCallLater(this.changeClip),this._sources?this._sources.length:0}),a(0,s,"clipWidth",function(){return this._clipWidth},function(t){this._clipWidth=t,this._setClipChanged()}),a(0,s,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(t){this._bitmap.sizeGrid=L.fillArray(T.defaultSizeGrid,t,Number)}),a(0,s,"group",function(){return this._group},function(t){t&&this._skin&&y.setGroup(this._skin,t),this._group=t}),a(0,s,"clipHeight",function(){return this._clipHeight},function(t){this._clipHeight=t,this._setClipChanged()}),a(0,s,"width",t.prototype._$get_width,function(e){t.prototype._$set_width.call(this,e),this._bitmap.width=e}),a(0,s,"height",t.prototype._$get_height,function(e){t.prototype._$set_height.call(this,e),this._bitmap.height=e}),a(0,s,"measureWidth",function(){return this.runCallLater(this.changeClip),this._bitmap.width}),a(0,s,"measureHeight",function(){return this.runCallLater(this.changeClip),this._bitmap.height}),a(0,s,"index",function(){return this._index},function(t){this._index=t,this._bitmap&&this._sources&&(this._bitmap.source=this._sources[t]),this.event("change")}),a(0,s,"autoPlay",function(){return this._autoPlay},function(t){this._autoPlay!=t&&(this._autoPlay=t,t?this.play():this.stop())}),a(0,s,"isPlaying",function(){return this._isPlaying},function(t){this._isPlaying=t}),a(0,s,"dataSource",t.prototype._$get_dataSource,function(e){this._dataSource=e,"number"==typeof e&&Math.floor(e)==e||"string"==typeof e?this.index=parseInt(e):t.prototype._$set_dataSource.call(this,e)}),a(0,s,"bitmap",function(){return this._bitmap}),e}(D),R=function(t){function e(){this.changeHandler=null,this._gridSize=11,this._bgColor="#ffffff",this._borderColor="#000000",this._inputColor="#000000",this._inputBgColor="#efefef",this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=[],this._selectedColor="#000000",this._panelChanged=!1,e.__super.call(this)}n(e,"laya.ui.ColorPicker",t);var s=e.prototype;return s.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._colorPanel&&this._colorPanel.destroy(e),this._colorButton&&this._colorButton.destroy(e),this._colorPanel=null,this._colorTiles=null,this._colorBlock=null,this._colorInput=null,this._colorButton=null,this._colors=null,this.changeHandler=null},s.createChildren=function(){this.addChild(this._colorButton=new P),this._colorPanel=new B,this._colorPanel.size(230,166),this._colorPanel.addChild(this._colorTiles=new C),this._colorPanel.addChild(this._colorBlock=new C),this._colorPanel.addChild(this._colorInput=new f)},s.initialize=function(){this._colorButton.on("click",this,this.onColorButtonClick),this._colorBlock.pos(5,5),this._colorInput.pos(60,5),this._colorInput.size(60,20),this._colorInput.on("change",this,this.onColorInputChange),this._colorInput.on("keydown",this,this.onColorFieldKeyDown),this._colorTiles.pos(5,30),this._colorTiles.on("mousemove",this,this.onColorTilesMouseMove),this._colorTiles.on("click",this,this.onColorTilesClick),this._colorTiles.size(20*this._gridSize,12*this._gridSize),this._colorPanel.on("mousedown",this,this.onPanelMouseDown),this.bgColor=this._bgColor},s.onPanelMouseDown=function(t){t.stopPropagation()},s.changePanel=function(){this._panelChanged=!1;var t=this._colorPanel.graphics;t.clear(),t.drawRect(0,0,230,166,this._bgColor,this._borderColor),this.drawBlock(this._selectedColor),this._colorInput.borderColor=this._borderColor,this._colorInput.bgColor=this._inputBgColor,this._colorInput.color=this._inputColor,t=this._colorTiles.graphics,t.clear();for(var e=[0,3355443,6710886,10066329,13421772,16777215,16711680,65280,255,16776960,65535,16711935],i=0;12>i;i++)for(var s=0;20>s;s++){var n=0;n=0===s?e[i]:1===s?0:51*(((3*i+s/6)%3<<0)+3*(i/6<<0))<<16|s%6*51<<8|(i<<0)%6*51;var a=L.toColor(n);this._colors.push(a);var o=s*this._gridSize,r=i*this._gridSize;t.drawRect(o,r,this._gridSize,this._gridSize,a,"#000000")}},s.onColorButtonClick=function(t){this._colorPanel.parent?this.close():this.open()},s.open=function(){var t=this.localToGlobal(new m),e=t.x+this._colorPanel.width<=i.stage.width?t.x:i.stage.width-this._colorPanel.width,s=t.y+this._colorButton.height;s=s+this._colorPanel.height<=i.stage.height?s:t.y-this._colorPanel.height,this._colorPanel.pos(e,s),this._colorPanel.zOrder=1001,i._currentStage.addChild(this._colorPanel),i.stage.on("mousedown",this,this.removeColorBox)},s.close=function(){i.stage.off("mousedown",this,this.removeColorBox),this._colorPanel.removeSelf()},s.removeColorBox=function(t){this.close()},s.onColorFieldKeyDown=function(t){13==t.keyCode&&(this._colorInput.text?this.selectedColor=this._colorInput.text:this.selectedColor=null,this.close(),t.stopPropagation())},s.onColorInputChange=function(t){this._colorInput.text?this.drawBlock(this._colorInput.text):this.drawBlock("#FFFFFF")},s.onColorTilesClick=function(t){this.selectedColor=this.getColorByMouse(),this.close()},s.onColorTilesMouseMove=function(t){this._colorInput.focus=!1;var e=this.getColorByMouse();this._colorInput.text=e,this.drawBlock(e)},s.getColorByMouse=function(){var t=this._colorTiles.getMousePoint(),e=Math.floor(t.x/this._gridSize),i=Math.floor(t.y/this._gridSize);return this._colors[20*i+e]},s.drawBlock=function(t){var e=this._colorBlock.graphics;e.clear();var i=t?t:"#ffffff";e.drawRect(0,0,50,20,i,this._borderColor),t||e.drawLine(0,0,50,20,"#ff0000")},s.changeColor=function(){var t=this.graphics;t.clear();var e=this._selectedColor||"#000000";t.drawRect(0,0,this._colorButton.width,this._colorButton.height,e)},s._setPanelChanged=function(){this._panelChanged||(this._panelChanged=!0,this.callLater(this.changePanel))},a(0,s,"inputBgColor",function(){return this._inputBgColor},function(t){this._inputBgColor=t,this._setPanelChanged()}),a(0,s,"selectedColor",function(){return this._selectedColor},function(t){this._selectedColor!=t&&(this._selectedColor=this._colorInput.text=t,this.drawBlock(t),this.changeColor(),this.changeHandler&&this.changeHandler.runWith(this._selectedColor),this.event("change",c.EMPTY.setTo("change",this,this)))}),a(0,s,"skin",function(){return this._colorButton.skin},function(t){this._colorButton.skin=t,this.changeColor()}),a(0,s,"bgColor",function(){return this._bgColor},function(t){this._bgColor=t,this._setPanelChanged()}),a(0,s,"borderColor",function(){return this._borderColor},function(t){this._borderColor=t,this._setPanelChanged()}),a(0,s,"inputColor",function(){return this._inputColor},function(t){this._inputColor=t,this._setPanelChanged()}),e}(D),O=function(t){function e(t,i){this._visibleNum=6,this._button=null,this._list=null,this._isOpen=!1,this._itemSize=12,this._labels=[],this._selectedIndex=-1,this._selectHandler=null,this._itemHeight=NaN,this._listHeight=NaN,this._listChanged=!1,this._itemChanged=!1,this._scrollBarSkin=null,this._isCustomList=!1,this.itemRender=null,e.__super.call(this),this._itemColors=T.comboBoxItemColors,this.skin=t,this.labels=i}n(e,"laya.ui.ComboBox",t);var s=e.prototype;return s.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._button&&this._button.destroy(e),this._list&&this._list.destroy(e),this._button=null,this._list=null,this._itemColors=null,this._labels=null,this._selectHandler=null},s.createChildren=function(){this.addChild(this._button=new P),this._button.text.align="left",this._button.labelPadding="0,0,0,5",this._button.on("mousedown",this,this.onButtonMouseDown)},s._createList=function(){this._list=new X,this._scrollBarSkin&&(this._list.vScrollBarSkin=this._scrollBarSkin),this._setListEvent(this._list)},s._setListEvent=function(t){this._list.selectEnable=!0,this._list.on("mousedown",this,this.onListDown),this._list.mouseHandler=_.create(this,this.onlistItemMouse,null,!1),this._list.scrollBar&&this._list.scrollBar.on("mousedown",this,this.onScrollBarDown)},s.onListDown=function(t){t.stopPropagation()},s.onScrollBarDown=function(t){t.stopPropagation()},s.onButtonMouseDown=function(t){this.callLater(this.switchTo,[!this._isOpen])},s.changeList=function(){this._listChanged=!1;var t=this.width-2,e=this._itemColors[2];this._itemHeight=this._itemSize+6,this._list.itemRender=this.itemRender||{type:"Box",child:[{type:"Label",props:{name:"label",x:1,padding:"3,3,3,3",width:t,height:this._itemHeight,fontSize:this._itemSize,color:e}}]},this._list.repeatY=this._visibleNum,this._list.refresh()},s.onlistItemMouse=function(t,e){var i=t.type;if("mouseover"===i||"mouseout"===i){if(this._isCustomList)return;var s=this._list.getCell(e);if(!s)return;var n=s.getChildByName("label");n&&("mouseover"===i?(n.bgColor=this._itemColors[0],n.color=this._itemColors[1]):(n.bgColor=null,n.color=this._itemColors[2]))}else"click"===i&&(this.selectedIndex=e,this.isOpen=!1)},s.switchTo=function(t){this.isOpen=t},s.changeOpen=function(){this.isOpen=!this._isOpen},s.changeItem=function(){if(this._itemChanged=!1,this._listHeight=this._labels.length>0?Math.min(this._visibleNum,this._labels.length)*this._itemHeight:this._itemHeight,!this._isCustomList){var t=this._list.graphics;t.clear(),t.drawRect(0,0,this.width-1,this._listHeight,this._itemColors[4],this._itemColors[3])}var e=this._list.array||[];e.length=0;for(var i=0,s=this._labels.length;s>i;i++)e.push({label:this._labels[i]});this._list.height=this._listHeight,this._list.array=e},s.changeSelected=function(){this._button.label=this.selectedLabel},s.removeList=function(t){this.isOpen=!1},a(0,s,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this._selectedIndex=t,this._labels.length>0?this.changeSelected():this.callLater(this.changeSelected),this.event("change",[c.EMPTY.setTo("change",this,this)]),this._selectHandler&&this._selectHandler.runWith(this._selectedIndex))}),a(0,s,"measureHeight",function(){return this._button.height}),a(0,s,"skin",function(){return this._button.skin},function(t){this._button.skin!=t&&(this._button.skin=t,this._listChanged=!0)}),a(0,s,"measureWidth",function(){return this._button.width}),a(0,s,"width",t.prototype._$get_width,function(e){t.prototype._$set_width.call(this,e),this._button.width=this._width,this._itemChanged=!0,this._listChanged=!0}),a(0,s,"selectedLabel",function(){return this._selectedIndex>-1&&this._selectedIndex<this._labels.length?this._labels[this._selectedIndex]:null},function(t){this.selectedIndex=this._labels.indexOf(t)}),a(0,s,"labels",function(){return this._labels.join(",")},function(t){this._labels.length>0&&(this.selectedIndex=-1),t?this._labels=t.split(","):this._labels.length=0,this._itemChanged=!0}),a(0,s,"height",t.prototype._$get_height,function(e){t.prototype._$set_height.call(this,e),this._button.height=this._height}),a(0,s,"selectHandler",function(){return this._selectHandler},function(t){this._selectHandler=t}),a(0,s,"visibleNum",function(){return this._visibleNum},function(t){this._visibleNum=t,this._listChanged=!0}),a(0,s,"labelBold",function(){return this._button.text.bold},function(t){this._button.text.bold=t}),a(0,s,"itemColors",function(){return String(this._itemColors)},function(t){this._itemColors=L.fillArray(this._itemColors,t,String),this._listChanged=!0}),a(0,s,"itemSize",function(){return this._itemSize},function(t){this._itemSize=t,this._listChanged=!0}),a(0,s,"scrollBar",function(){return this.list.scrollBar}),a(0,s,"isOpen",function(){return this._isOpen},function(t){if(this._isOpen!=t)if(this._isOpen=t,this._button.selected=this._isOpen,this._isOpen){this._list||this._createList(),this._listChanged&&!this._isCustomList&&this.changeList(),this._itemChanged&&this.changeItem();var e=this.localToGlobal(m.TEMP.setTo(0,0)),s=e.y+this._button.height;s=s+this._listHeight<=i.stage.height?s:e.y-this._listHeight,this._list.pos(e.x,s),this._list.zOrder=1001,i._currentStage.addChild(this._list),i.stage.once("mousedown",this,this.removeList),this._list.selectedIndex=this._selectedIndex}else this._list&&this._list.removeSelf()}),a(0,s,"scrollBarSkin",function(){return this._scrollBarSkin},function(t){this._scrollBarSkin=t}),a(0,s,"sizeGrid",function(){return this._button.sizeGrid},function(t){this._button.sizeGrid=t}),a(0,s,"button",function(){return this._button}),a(0,s,"list",function(){return this._list||this._createList(),this._list},function(t){t&&(t.removeSelf(),this._isCustomList=!0,this._list=t,this._setListEvent(t),this._itemHeight=t.getCell(0).height+t.spaceY)}),a(0,s,"dataSource",t.prototype._$get_dataSource,function(e){this._dataSource=e,"number"==typeof e&&Math.floor(e)==e||"string"==typeof e?this.selectedIndex=parseInt(e):e instanceof Array?this.labels=e.join(","):t.prototype._$set_dataSource.call(this,e)}),a(0,s,"labelColors",function(){return this._button.labelColors},function(t){this._button.labelColors!=t&&(this._button.labelColors=t)}),a(0,s,"labelPadding",function(){return this._button.text.padding.join(",")},function(t){this._button.text.padding=L.fillArray(T.labelPadding,t,Number)}),a(0,s,"labelSize",function(){return this._button.text.fontSize},function(t){this._button.text.fontSize=t}),a(0,s,"labelFont",function(){return this._button.text.font},function(t){this._button.text.font=t}),a(0,s,"stateNum",function(){return this._button.stateNum},function(t){this._button.stateNum=t}),e}(D),F=function(t){function e(t){this.rollRatio=.95,this.changeHandler=null,this.scaleBar=!0,this.autoHide=!1,this.elasticDistance=0,this.elasticBackTime=500,this.upButton=null,this.downButton=null,this.slider=null,this._scrollSize=1,this._skin=null,this._thumbPercent=1,this._target=null,this._lastPoint=null,this._lastOffset=0,this._checkElastic=!1,this._isElastic=!1,this._value=NaN,this._hide=!1,this._clickOnly=!0,this._offsets=null,e.__super.call(this),this._showButtons=k.showButtons,this._touchScrollEnable=k.touchScrollEnable,this._mouseWheelEnable=k.mouseWheelEnable,this.skin=t,this.max=1}n(e,"laya.ui.ScrollBar",t);var s=e.prototype;return s.destroy=function(e){void 0===e&&(e=!0),this.stopScroll(),t.prototype.destroy.call(this,e),this.upButton&&this.upButton.destroy(e),this.downButton&&this.downButton.destroy(e),this.slider&&this.slider.destroy(e),this.upButton=this.downButton=null,this.slider=null,this.changeHandler=null,this._offsets=null},s.createChildren=function(){this.addChild(this.slider=new N),this.addChild(this.upButton=new P),this.addChild(this.downButton=new P)},s.initialize=function(){this.slider.showLabel=!1,this.slider.on("change",this,this.onSliderChange),this.slider.setSlider(0,0,0),this.upButton.on("mousedown",this,this.onButtonMouseDown),this.downButton.on("mousedown",this,this.onButtonMouseDown)},s.onSliderChange=function(){this.value=this.slider.value},s.onButtonMouseDown=function(t){var e=t.currentTarget===this.upButton;
this.slide(e),i.timer.once(T.scrollBarDelayTime,this,this.startLoop,[e]),i.stage.once("mouseup",this,this.onStageMouseUp)},s.startLoop=function(t){i.timer.frameLoop(1,this,this.slide,[t])},s.slide=function(t){t?this.value-=this._scrollSize:this.value+=this._scrollSize},s.onStageMouseUp=function(t){i.timer.clear(this,this.startLoop),i.timer.clear(this,this.slide)},s.changeScrollBar=function(){this.upButton.visible=this._showButtons,this.downButton.visible=this._showButtons,this._showButtons&&(this.upButton.skin=this._skin.replace(".png","$up.png"),this.downButton.skin=this._skin.replace(".png","$down.png")),this.slider.isVertical?this.slider.y=this._showButtons?this.upButton.height:0:this.slider.x=this._showButtons?this.upButton.width:0,this.resetPositions()},s.changeSize=function(){t.prototype.changeSize.call(this),this.resetPositions(),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value)},s.resetPositions=function(){this.slider.isVertical?this.slider.height=this.height-(this._showButtons?this.upButton.height+this.downButton.height:0):this.slider.width=this.width-(this._showButtons?this.upButton.width+this.downButton.width:0),this.resetButtonPosition()},s.resetButtonPosition=function(){this.slider.isVertical?this.downButton.y=this.slider.y+this.slider.height:this.downButton.x=this.slider.x+this.slider.width},s.setScroll=function(t,e,i){this.runCallLater(this.changeSize),this.slider.setSlider(t,e,i),this.slider.bar.visible=e>0,!this._hide&&this.autoHide&&(this.visible=!1)},s.onTargetMouseWheel=function(t){this.value-=t.delta*this._scrollSize,this.target=this._target},s.onTargetMouseDown=function(t){this._clickOnly=!0,this._lastOffset=0,this._checkElastic=!1,this._lastPoint||(this._lastPoint=new m),this._lastPoint.setTo(i.stage.mouseX,i.stage.mouseY),i.timer.clear(this,this.tweenMove),b.clearTween(this),i.stage.once("mouseup",this,this.onStageMouseUp2),i.stage.once("mouseout",this,this.onStageMouseUp2),i.timer.frameLoop(1,this,this.loop)},s.loop=function(){var t=i.stage.mouseY,e=i.stage.mouseX;if(this._lastOffset=this.isVertical?t-this._lastPoint.y:e-this._lastPoint.x,this._clickOnly){if(!(Math.abs(this._lastOffset*(this.isVertical?i.stage._canvasTransform.getScaleY():i.stage._canvasTransform.getScaleX()))>1))return;this._clickOnly=!1,this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event("start")}this._offsets.push(this._lastOffset),this._lastPoint.x=e,this._lastPoint.y=t,0!==this._lastOffset&&(this._checkElastic||(this.elasticDistance>0?this._checkElastic||0==this._lastOffset||(this._lastOffset>0&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):this._value>=this.max&&(this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance)):this.value-=this._lastOffset)},s.onStageMouseUp2=function(t){if(i.stage.off("mouseup",this,this.onStageMouseUp2),i.stage.off("mouseout",this,this.onStageMouseUp2),i.timer.clear(this,this.loop),!this._clickOnly)if(this._target.mouseEnabled=!0,this._isElastic)this._value<this.min?b.to(this,{value:this.min},this.elasticBackTime,l.sineOut,_.create(this,this.elasticOver)):this._value>this.max&&b.to(this,{value:this.max},this.elasticBackTime,l.sineOut,_.create(this,this.elasticOver));else{if(!this._offsets)return;this._offsets.length<1&&(this._offsets[0]=this.isVertical?i.stage.mouseY-this._lastPoint.y:i.stage.mouseX-this._lastPoint.x);for(var e=0,s=Math.min(this._offsets.length,3),n=0;s>n;n++)e+=this._offsets[this._offsets.length-1-n];if(this._lastOffset=e/s,e=Math.abs(this._lastOffset),2>e)return void this.event("end");e>60&&(this._lastOffset=this._lastOffset>0?60:-60),i.timer.frameLoop(1,this,this.tweenMove)}},s.elasticOver=function(){this._isElastic=!1,!this.hide&&this.autoHide&&b.to(this,{alpha:0},500),this.event("end")},s.tweenMove=function(){this._lastOffset*=this.rollRatio;var t=NaN;if(this.elasticDistance>0&&(this._lastOffset>0&&this.value<=this.min?(this._isElastic=!0,t=.5*-(this.min-this.elasticDistance-this.value),this._lastOffset>t&&(this._lastOffset=t)):this._lastOffset<0&&this.value>=this.max&&(this._isElastic=!0,t=.5*-(this.max+this.elasticDistance-this.value),this._lastOffset<t&&(this._lastOffset=t))),this.value-=this._lastOffset,Math.abs(this._lastOffset)<1){if(i.timer.clear(this,this.tweenMove),this._isElastic)return void(this._value<this.min?b.to(this,{value:this.min},this.elasticBackTime,l.sineOut,_.create(this,this.elasticOver)):this._value>this.max?b.to(this,{value:this.max},this.elasticBackTime,l.sineOut,_.create(this,this.elasticOver)):this.elasticOver());this.event("end"),!this.hide&&this.autoHide&&b.to(this,{alpha:0},500)}},s.stopScroll=function(){this.onStageMouseUp2(null),i.timer.clear(this,this.tweenMove),b.clearTween(this)},a(0,s,"measureHeight",function(){return this.slider.isVertical?100:this.slider.height}),a(0,s,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this.slider.skin=this._skin,this.callLater(this.changeScrollBar))}),a(0,s,"max",function(){return this.slider.max},function(t){this.slider.max=t}),a(0,s,"showButtons",function(){return this._showButtons},function(t){this._showButtons=t,this.callLater(this.changeScrollBar)}),a(0,s,"measureWidth",function(){return this.slider.isVertical?this.slider.width:100}),a(0,s,"min",function(){return this.slider.min},function(t){this.slider.min=t}),a(0,s,"value",function(){return this._value},function(t){t!==this._value&&(this._isElastic?this._value=t:(this.slider.value=t,this._value=this.slider.value),this.event("change"),this.changeHandler&&this.changeHandler.runWith(this.value))}),a(0,s,"isVertical",function(){return this.slider.isVertical},function(t){this.slider.isVertical=t}),a(0,s,"sizeGrid",function(){return this.slider.sizeGrid},function(t){this.slider.sizeGrid=t}),a(0,s,"scrollSize",function(){return this._scrollSize},function(t){this._scrollSize=t}),a(0,s,"dataSource",t.prototype._$get_dataSource,function(e){this._dataSource=e,"number"==typeof e||"string"==typeof e?this.value=Number(e):t.prototype._$set_dataSource.call(this,e)}),a(0,s,"thumbPercent",function(){return this._thumbPercent},function(t){this.runCallLater(this.changeScrollBar),this.runCallLater(this.changeSize),t=t>=1?.99:t,this._thumbPercent=t,this.scaleBar&&(this.slider.isVertical?this.slider.bar.height=Math.max(this.slider.height*t,T.scrollBarMinNum):this.slider.bar.width=Math.max(this.slider.width*t,T.scrollBarMinNum))}),a(0,s,"target",function(){return this._target},function(t){this._target&&(this._target.off("mousewheel",this,this.onTargetMouseWheel),this._target.off("mousedown",this,this.onTargetMouseDown)),this._target=t,t&&(this._mouseWheelEnable&&this._target.on("mousewheel",this,this.onTargetMouseWheel),this._touchScrollEnable&&this._target.on("mousedown",this,this.onTargetMouseDown))}),a(0,s,"hide",function(){return this._hide},function(t){this._hide=t,this.visible=!t}),a(0,s,"touchScrollEnable",function(){return this._touchScrollEnable},function(t){this._touchScrollEnable=t,this.target=this._target}),a(0,s,"mouseWheelEnable",function(){return this._mouseWheelEnable},function(t){this._mouseWheelEnable=t}),a(0,s,"tick",function(){return this.slider.tick},function(t){this.slider.tick=t}),e}(D),N=function(t){function e(t){this.changeHandler=null,this.isVertical=!0,this.showLabel=!0,this._allowClickBack=!1,this._max=100,this._min=0,this._tick=1,this._value=0,this._skin=null,this._bg=null,this._progress=null,this._bar=null,this._tx=NaN,this._ty=NaN,this._maxMove=NaN,this._globalSacle=null,e.__super.call(this),this.skin=t}n(e,"laya.ui.Slider",t);var o=e.prototype;return o.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._bg&&this._bg.destroy(e),this._bar&&this._bar.destroy(e),this._progress&&this._progress.destroy(e),this._bg=null,this._bar=null,this._progress=null,this.changeHandler=null},o.createChildren=function(){this.addChild(this._bg=new U),this.addChild(this._bar=new P)},o.initialize=function(){this._bar.on("mousedown",this,this.onBarMouseDown),this._bg.sizeGrid=this._bar.sizeGrid="4,4,4,4,0",this._progress&&(this._progress.sizeGrid=this._bar.sizeGrid),this.allowClickBack=!0},o.onBarMouseDown=function(t){this._globalSacle||(this._globalSacle=new m),this._globalSacle.setTo(this.globalScaleX||.01,this.globalScaleY||.01),this._maxMove=this.isVertical?this.height-this._bar.height:this.width-this._bar.width,this._tx=i.stage.mouseX,this._ty=i.stage.mouseY,i.stage.on("mousemove",this,this.mouseMove),i.stage.once("mouseup",this,this.mouseUp),this.showValueText()},o.showValueText=function(){if(this.showLabel){var t=laya.ui.Slider.label;this.addChild(t),t.textField.changeText(this._value+""),this.isVertical?(t.x=this._bar.x+20,t.y=.5*(this._bar.height-t.height)+this._bar.y):(t.y=this._bar.y-20,t.x=.5*(this._bar.width-t.width)+this._bar.x)}},o.hideValueText=function(){laya.ui.Slider.label&&laya.ui.Slider.label.removeSelf()},o.mouseUp=function(t){i.stage.off("mousemove",this,this.mouseMove),this.sendChangeEvent("changed"),this.hideValueText()},o.mouseMove=function(t){var e=this._value;this.isVertical?(this._bar.y+=(i.stage.mouseY-this._ty)/this._globalSacle.y,this._bar.y>this._maxMove?this._bar.y=this._maxMove:this._bar.y<0&&(this._bar.y=0),this._value=this._bar.y/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x+=(i.stage.mouseX-this._tx)/this._globalSacle.x,this._bar.x>this._maxMove?this._bar.x=this._maxMove:this._bar.x<0&&(this._bar.x=0),this._value=this._bar.x/this._maxMove*(this._max-this._min)+this._min,this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width)),this._tx=i.stage.mouseX,this._ty=i.stage.mouseY;var s=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*s)/s,this._value!=e&&this.sendChangeEvent(),this.showValueText()},o.sendChangeEvent=function(t){void 0===t&&(t="change"),this.event(t),this.changeHandler&&this.changeHandler.runWith(this._value)},o.setBarPoint=function(){this.isVertical?this._bar.x=Math.round(.5*(this._bg.width-this._bar.width)):this._bar.y=Math.round(.5*(this._bg.height-this._bar.height))},o.changeSize=function(){t.prototype.changeSize.call(this),this.isVertical?this._bg.height=this.height:this._bg.width=this.width,this.setBarPoint(),this.changeValue()},o.setSlider=function(t,e,i){this._value=-1,this._min=t,this._max=e>t?e:t,this.value=t>i?t:i>e?e:i},o.changeValue=function(){var t=Math.pow(10,(this._tick+"").length-1);this._value=Math.round(Math.round(this._value/this._tick)*this._tick*t)/t,this._value=this._value>this._max?this._max:this._value<this._min?this._min:this._value;var e=this._max-this._min;0===e&&(e=1),this.isVertical?(this._bar.y=(this._value-this._min)/e*(this.height-this._bar.height),this._progress&&(this._progress.height=this._bar.y+.5*this._bar.height)):(this._bar.x=(this._value-this._min)/e*(this.width-this._bar.width),this._progress&&(this._progress.width=this._bar.x+.5*this._bar.width))},o.onBgMouseDown=function(t){var e=this._bg.getMousePoint();this.isVertical?this.value=e.y/(this.height-this._bar.height)*(this._max-this._min)+this._min:this.value=e.x/(this.width-this._bar.width)*(this._max-this._min)+this._min},a(0,o,"measureHeight",function(){return Math.max(this._bg.height,this._bar.height)}),a(0,o,"skin",function(){return this._skin},function(t){if(this._skin!=t){this._skin=t,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png");var e=this._skin.replace(".png","$progress.png");y.getRes(e)&&(this._progress||(this.addChild(this._progress=new U),this._progress.sizeGrid=this._bar.sizeGrid,this.setChildIndex(this._progress,1)),this._progress.skin=e),this.setBarPoint(),this.callLater(this.changeValue)}}),a(0,o,"allowClickBack",function(){return this._allowClickBack},function(t){this._allowClickBack!=t&&(this._allowClickBack=t,t?this._bg.on("mousedown",this,this.onBgMouseDown):this._bg.off("mousedown",this,this.onBgMouseDown))}),a(0,o,"max",function(){return this._max},function(t){this._max!=t&&(this._max=t,this.callLater(this.changeValue))}),a(0,o,"measureWidth",function(){return Math.max(this._bg.width,this._bar.width)}),a(0,o,"tick",function(){return this._tick},function(t){this._tick!=t&&(this._tick=t,this.callLater(this.changeValue))}),a(0,o,"sizeGrid",function(){return this._bg.sizeGrid},function(t){this._bg.sizeGrid=t,this._bar.sizeGrid=t}),a(0,o,"min",function(){return this._min},function(t){this._min!=t&&(this._min=t,this.callLater(this.changeValue))}),a(0,o,"value",function(){return this._value},function(t){if(this._value!=t){var e=this._value;this._value=t,this.changeValue(),this._value!=e&&this.sendChangeEvent()}}),a(0,o,"dataSource",t.prototype._$get_dataSource,function(e){this._dataSource=e,"number"==typeof e||"string"==typeof e?this.value=Number(e):t.prototype._$set_dataSource.call(this,e)}),a(0,o,"bar",function(){return this._bar}),s(e,["label",function(){return this.label=new H}]),e}(D),U=function(t){function e(t){this._bitmap=null,this._skin=null,this._group=null,e.__super.call(this),this.skin=t,this.forceSkin=!1}n(e,"laya.ui.Image",t);var s=e.prototype;return s.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,!0),this._bitmap&&this._bitmap.destroy(),this._bitmap=null},s.dispose=function(){this.destroy(!0),i.loader.clearRes(this._skin)},s.createChildren=function(){this.graphics=this._bitmap=new E,this._bitmap.autoCacheCmd=!1},s.setSource=function(t,e){t===this._skin&&e&&(this.source=e,this.onCompResize())},a(0,s,"source",function(){return this._bitmap.source},function(t){this._bitmap&&(this._bitmap.source=t,this.event("loaded"),this.repaint())}),a(0,s,"dataSource",t.prototype._$get_dataSource,function(e){this._dataSource=e,"string"==typeof e?this.skin=e:t.prototype._$set_dataSource.call(this,e)}),a(0,s,"measureHeight",function(){return this._bitmap.height}),a(0,s,"skin",function(){return this._skin},function(t){if(this._skin!=t||this.forceSkin)if(this._skin=t,t){var e=y.getRes(t);e?(this.source=e,this.onCompResize()):i.loader.load(this._skin,_.create(this,this.setSource,[this._skin]),null,"image",1,!0,this._group)}else this.source=null}),a(0,s,"group",function(){return this._group},function(t){t&&this._skin&&y.setGroup(this._skin,t),this._group=t}),a(0,s,"sizeGrid",function(){return this._bitmap.sizeGrid?this._bitmap.sizeGrid.join(","):null},function(t){this._bitmap.sizeGrid=L.fillArray(T.defaultSizeGrid,t,Number)}),a(0,s,"measureWidth",function(){return this._bitmap.width}),a(0,s,"width",t.prototype._$get_width,function(e){t.prototype._$set_width.call(this,e),this._bitmap.width=0==e?1e-7:e}),a(0,s,"height",t.prototype._$get_height,function(e){t.prototype._$set_height.call(this,e),this._bitmap.height=0==e?1e-7:e}),e}(D),H=function(t){function e(t){this._tf=null,e.__super.call(this),void 0===t&&(t=""),d.defaultColor=T.labelColor,this.text=t}n(e,"laya.ui.Label",t);var i=e.prototype;return i.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._tf=null},i.createChildren=function(){this.addChild(this._tf=new w)},i.changeText=function(t){this._tf.changeText(t)},a(0,i,"padding",function(){return this._tf.padding.join(",")},function(t){this._tf.padding=L.fillArray(T.labelPadding,t,Number)}),a(0,i,"bold",function(){return this._tf.bold},function(t){this._tf.bold=t}),a(0,i,"align",function(){return this._tf.align},function(t){this._tf.align=t}),a(0,i,"text",function(){return this._tf.text},function(t){this._tf.text!=t&&(t&&(t=L.adptString(t+"")),this._tf.text=t,this.event("change"))}),a(0,i,"italic",function(){return this._tf.italic},function(t){this._tf.italic=t}),a(0,i,"wordWrap",function(){return this._tf.wordWrap},function(t){this._tf.wordWrap=t}),a(0,i,"font",function(){return this._tf.font},function(t){this._tf.font=t}),a(0,i,"dataSource",t.prototype._$get_dataSource,function(e){this._dataSource=e,"number"==typeof e||"string"==typeof e?this.text=e+"":t.prototype._$set_dataSource.call(this,e)}),a(0,i,"color",function(){return this._tf.color},function(t){this._tf.color=t}),a(0,i,"valign",function(){return this._tf.valign},function(t){this._tf.valign=t}),a(0,i,"leading",function(){return this._tf.leading},function(t){this._tf.leading=t}),a(0,i,"fontSize",function(){return this._tf.fontSize},function(t){this._tf.fontSize=t}),a(0,i,"bgColor",function(){return this._tf.bgColor},function(t){this._tf.bgColor=t}),a(0,i,"borderColor",function(){return this._tf.borderColor},function(t){this._tf.borderColor=t}),a(0,i,"stroke",function(){return this._tf.stroke},function(t){this._tf.stroke=t}),a(0,i,"strokeColor",function(){return this._tf.strokeColor},function(t){this._tf.strokeColor=t}),a(0,i,"textField",function(){return this._tf}),a(0,i,"measureWidth",function(){return this._tf.width}),a(0,i,"measureHeight",function(){return this._tf.height}),a(0,i,"width",function(){return this._width||this._tf.text?t.prototype._$get_width.call(this):0},function(e){t.prototype._$set_width.call(this,e),this._tf.width=e}),a(0,i,"height",function(){return this._height||this._tf.text?t.prototype._$get_height.call(this):0},function(e){t.prototype._$set_height.call(this,e),this._tf.height=e}),a(0,i,"overflow",function(){return this._tf.overflow},function(t){this._tf.overflow=t}),a(0,i,"underline",function(){return this._tf.underline},function(t){this._tf.underline=t}),a(0,i,"underlineColor",function(){return this._tf.underlineColor},function(t){this._tf.underlineColor=t}),e}(D),G=function(t){function e(t){this.changeHandler=null,this._bg=null,this._bar=null,this._skin=null,this._value=.5,e.__super.call(this),this.skin=t}n(e,"laya.ui.ProgressBar",t);var i=e.prototype;return i.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._bg&&this._bg.destroy(e),this._bar&&this._bar.destroy(e),this._bg=this._bar=null,this.changeHandler=null},i.createChildren=function(){this.addChild(this._bg=new U),this.addChild(this._bar=new U),this._bar._bitmap.autoCacheCmd=!1},i.changeValue=function(){if(this.sizeGrid){var t=this.sizeGrid.split(","),e=Number(t[3]),i=Number(t[1]),s=this.width-e-i,n=s*this._value;this._bar.width=e+i+n,this._bar.visible=this._bar.width>e+i}else this._bar.width=this.width*this._value},a(0,i,"measureHeight",function(){return this._bg.height}),a(0,i,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this._bg.skin=this._skin,this._bar.skin=this._skin.replace(".png","$bar.png"),this.callLater(this.changeValue))}),a(0,i,"measureWidth",function(){return this._bg.width}),a(0,i,"height",t.prototype._$get_height,function(e){t.prototype._$set_height.call(this,e),this._bg.height=this._height,this._bar.height=this._height}),a(0,i,"bar",function(){return this._bar}),a(0,i,"value",function(){return this._value},function(t){this._value!=t&&(t=t>1?1:0>t?0:t,this._value=t,this.callLater(this.changeValue),this.event("change"),this.changeHandler&&this.changeHandler.runWith(t))}),a(0,i,"bg",function(){return this._bg}),a(0,i,"sizeGrid",function(){return this._bg.sizeGrid},function(t){this._bg.sizeGrid=this._bar.sizeGrid=t}),a(0,i,"width",t.prototype._$get_width,function(e){t.prototype._$set_width.call(this,e),this._bg.width=this._width,this.callLater(this.changeValue)}),a(0,i,"dataSource",t.prototype._$get_dataSource,function(e){this._dataSource=e,"number"==typeof e||"string"==typeof e?this.value=Number(e):t.prototype._$set_dataSource.call(this,e)}),e}(D),W=(function(t){function e(){this._tipBox=null,this._tipText=null,this._defaultTipHandler=null,e.__super.call(this),this._tipBox=new D,this._tipBox.addChild(this._tipText=new w),this._tipText.x=this._tipText.y=5,this._tipText.color=e.tipTextColor,this._defaultTipHandler=this._showDefaultTip,i.stage.on("showtip",this,this._onStageShowTip),i.stage.on("hidetip",this,this._onStageHideTip),this.zOrder=1100}n(e,"laya.ui.TipManager",t);var s=e.prototype;return s._onStageHideTip=function(t){i.timer.clear(this,this._showTip),this.closeAll(),this.removeSelf()},s._onStageShowTip=function(t){i.timer.once(e.tipDelay,this,this._showTip,[t],!0)},s._showTip=function(t){if("string"==typeof t){var e=String(t);Boolean(e)&&this._defaultTipHandler(e)}else t instanceof laya.utils.Handler?t.run():"function"==typeof t&&t.apply();i.stage.on("mousemove",this,this._onStageMouseMove),i.stage.on("mousedown",this,this._onStageMouseDown),this._onStageMouseMove(null)},s._onStageMouseDown=function(t){this.closeAll()},s._onStageMouseMove=function(t){this._showToStage(this,e.offsetX,e.offsetY)},s._showToStage=function(t,e,s){void 0===e&&(e=0),void 0===s&&(s=0);var n=t.getBounds();t.x=i.stage.mouseX+e,t.y=i.stage.mouseY+s,t.x+n.width>i.stage.width&&(t.x-=n.width+e),t.y+n.height>i.stage.height&&(t.y-=n.height+s)},s.closeAll=function(){i.timer.clear(this,this._showTip),i.stage.off("mousemove",this,this._onStageMouseMove),i.stage.off("mousedown",this,this._onStageMouseDown),this.removeChildren()},s.showDislayTip=function(t){this.addChild(t),this._showToStage(this),i._currentStage.addChild(this)},s._showDefaultTip=function(t){this._tipText.text=t;var s=this._tipBox.graphics;s.clear(),s.drawRect(0,0,this._tipText.width+10,this._tipText.height+10,e.tipBackColor),this.addChild(this._tipBox),this._showToStage(this),i._currentStage.addChild(this)},a(0,s,"defaultTipHandler",function(){return this._defaultTipHandler},function(t){this._defaultTipHandler=t}),e.offsetX=10,e.offsetY=15,e.tipTextColor="#ffffff",e.tipBackColor="#111111",e.tipDelay=200,e}(D),function(t){function e(){this._idMap=null,this._aniList=null,e.__super.call(this)}n(e,"laya.ui.View",t);var a=e.prototype;return a.createView=function(t){if(t.animations&&!this._idMap&&(this._idMap={}),e.createComp(t,this,this),t.animations){var i,s,n=[],a=t.animations,o=0,r=a.length;for(o=0;r>o;o++){switch(i=new u,s=a[o],i._setUp(this._idMap,s),this[s.name]=i,i._setControlNode(this),s.action){case 1:i.play(0,!1);break;case 2:i.play(0,!0)}n.push(i)}this._aniList=n}this._width>0&&null==t.props.hitTestPrior&&!this.mouseThrough&&(this.hitTestPrior=!0)},a.loadUI=function(t){var i=e.uiMap[t];i&&this.createView(i)},a.destroy=function(t){void 0===t&&(t=!0),this._aniList&&(this._aniList.length=0),this._idMap=null,this._aniList=null,laya.ui.Component.prototype.destroy.call(this,t)},e._regs=function(){var t;for(t in e.uiClassMap)r.regClass(t,e.uiClassMap[t])},e.createComp=function(t,s,n){if(s=s||e.getCompInstance(t),!s)return console.warn("can not create:"+t.type),null;var a=t.child;if(a)for(var o=0,h=a.length;h>o;o++){var l=a[o];if(!s.hasOwnProperty("itemRender")||"render"!=l.props.name&&"render"!==l.props.renderType)if("Graphic"==l.type)r.addGraphicsToSprite(l,s);else if(r.isDrawType(l.type))r.addGraphicToSprite(l,s,!0);else{var c=e.createComp(l,null,n);"Script"==l.type?"owner"in c?c.owner=s:"target"in c&&(c.target=s):"mask"==l.props.renderType||"mask"==l.props.name?s.mask=c:c instanceof laya.display.Sprite&&s.addChild(c)}else s.itemRender=l}var d=t.props;for(var u in d){var p=d[u];e.setCompValue(s,u,p,n)}return i.__typeof(s,"laya.ui.IItem")&&s.initItems(),t.compId&&n&&n._idMap&&(n._idMap[t.compId]=s),s},e.setCompValue=function(t,e,i,s){"var"===e&&s?s[i]=t:t[e]="true"===i?!0:"false"===i?!1:i},e.getCompInstance=function(t){var s,n=t.props?t.props.runtime:null;return s=n?e.viewClassMap[n]||e.uiClassMap[n]||i.__classmap[n]:e.uiClassMap[t.type],t.props&&t.props.hasOwnProperty("renderType")&&"instance"==t.props.renderType?s.instance:s?new s:null},e.regComponent=function(t,i){e.uiClassMap[t]=i,r.regClass(t,i)},e.regViewRuntime=function(t,i){e.viewClassMap[t]=i},e.uiMap={},e.viewClassMap={},s(e,["uiClassMap",function(){return this.uiClassMap={ViewStack:Z,LinkButton:P,TextArea:ht,ColorPicker:R,Box:B,Button:P,CheckBox:V,Clip:M,ComboBox:O,Component:D,HScrollBar:q,HSlider:z,Image:U,Label:H,List:X,Panel:Y,ProgressBar:G,Radio:Q,RadioGroup:ot,ScrollBar:F,Slider:N,Tab:rt,TextInput:et,View:e,VScrollBar:tt,VSlider:it,Tree:$,HBox:nt,VBox:at,Sprite:C,Animation:o,Text:w,FontClip:j}}]),e.__init$=function(){e._regs()},e}(B)),V=function(t){function e(t,i){void 0===i&&(i=""),e.__super.call(this,t,i)}n(e,"laya.ui.CheckBox",t);var i=e.prototype;return i.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!0,this._autoSize=!1},i.initialize=function(){t.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0},a(0,i,"dataSource",t.prototype._$get_dataSource,function(e){this._dataSource=e,"boolean"==typeof e?this.selected=e:"string"==typeof e?this.selected="true"===e:t.prototype._$set_dataSource.call(this,e)}),e}(P),K=function(t){function e(){this._space=0,this._align="none",this._itemChanged=!1,e.__super.call(this)}n(e,"laya.ui.LayoutBox",t);var i=e.prototype;return i.addChild=function(t){return t.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChild.call(this,t)},i.onResize=function(t){this._setItemChanged()},i.addChildAt=function(t,e){return t.on("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.addChildAt.call(this,t,e)},i.removeChild=function(t){return t.off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChild.call(this,t)},i.removeChildAt=function(t){return this.getChildAt(t).off("resize",this,this.onResize),this._setItemChanged(),laya.display.Node.prototype.removeChildAt.call(this,t)},i.refresh=function(){this._setItemChanged()},i.changeItems=function(){this._itemChanged=!1},i.sortItem=function(t){t&&t.sort(function(t,e){return t.y-e.y})},i._setItemChanged=function(){this._itemChanged||(this._itemChanged=!0,this.callLater(this.changeItems))},a(0,i,"space",function(){return this._space},function(t){this._space=t,this._setItemChanged()}),a(0,i,"align",function(){return this._align},function(t){this._align=t,this._setItemChanged()}),e}(B),j=function(t){function e(t,i){this._valueArr=null,this._indexMap=null,this._sheet=null,this._direction="horizontal",this._spaceX=0,this._spaceY=0,e.__super.call(this),t&&(this.skin=t),i&&(this.sheet=i)}n(e,"laya.ui.FontClip",t);var i=e.prototype;return i.createChildren=function(){this._bitmap=new E,this.on("loaded",this,this._onClipLoaded)},i._onClipLoaded=function(){this.callLater(this.changeValue)},i.changeValue=function(){if(this._sources&&this._valueArr){this.graphics.clear();for(var t,e="horizontal"===this._direction,i=0,s=this._valueArr.length;s>i;i++){var n=this._indexMap[this._valueArr[i]];this.sources[n]&&(t=this.sources[n],e?this.graphics.drawTexture(t,i*(t.width+this.spaceX),0,t.width,t.height):this.graphics.drawTexture(t,0,i*(t.height+this.spaceY),t.width,t.height))}t&&(e?this.size(this._valueArr.length*(t.width+this.spaceX),t.height):this.size(t.width,(t.height+this.spaceY)*this._valueArr.length))}},i.destroy=function(e){void 0===e&&(e=!0),this._valueArr=null,this._indexMap=null,this._indexMap=null,this.graphics.clear(),this.removeSelf(),this.off("loaded",this,this._onClipLoaded),t.prototype.destroy.call(this,e)},a(0,i,"sheet",function(){return this._sheet},function(t){t+="",this._sheet=t;var e=t.split(" ");this._clipX=String(e[0]).length,this.clipY=e.length,this._indexMap={};for(var i=0;i<this._clipY;i++)for(var s=e[i].split(""),n=0,a=s.length;a>n;n++)this._indexMap[s[n]]=i*this._clipX+n}),a(0,i,"direction",function(){return this._direction},function(t){this._direction=t,this.callLater(this.changeValue)}),a(0,i,"value",function(){return this._valueArr?this._valueArr.join(""):""},function(t){t+="",this._valueArr=t.split(""),this.callLater(this.changeValue)}),a(0,i,"spaceX",function(){return this._spaceX},function(t){this._spaceX=t,"horizontal"===this._direction&&this.callLater(this.changeValue)}),a(0,i,"spaceY",function(){return this._spaceY},function(t){this._spaceY=t,"horizontal"!==this._direction&&this.callLater(this.changeValue)}),e}(M),X=function(t){function e(){this.selectHandler=null,this.renderHandler=null,this.mouseHandler=null,this.selectEnable=!1,this.totalPage=0,this._content=null,this._scrollBar=null,this._itemRender=null,this._repeatX=0,this._repeatY=0,this._repeatX2=0,this._repeatY2=0,this._spaceX=0,this._spaceY=0,this._array=null,this._startIndex=0,this._selectedIndex=-1,this._page=0,this._isVertical=!0,this._cellSize=20,this._cellOffset=0,this._isMoved=!1,this.cacheContent=!1,this._createdLine=0,this._cellChanged=!1,e.__super.call(this),this._cells=[],this._offset=new m}n(e,"laya.ui.List",t);var s=e.prototype;return i.imps(s,{"laya.ui.IRender":!0,"laya.ui.IItem":!0}),s.destroy=function(t){void 0===t&&(t=!0),this._content&&this._content.destroy(t),this._scrollBar&&this._scrollBar.destroy(t),laya.ui.Component.prototype.destroy.call(this,t),this._content=null,this._scrollBar=null,this._itemRender=null,this._cells=null,this._array=null,this.selectHandler=this.renderHandler=this.mouseHandler=null},s.createChildren=function(){this.addChild(this._content=new B)},s.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=t.prototype._$get_cacheAs.call(this)),t.prototype._$set_cacheAs.call(this,"none"),this._scrollBar.once("end",this,this.onScrollEnd)},s.onScrollEnd=function(){t.prototype._$set_cacheAs.call(this,this._$P.cacheAs)},s.changeCells=function(){if(this._cellChanged=!1,this._itemRender){this.scrollBar=this.getChildByName("scrollBar");var t=this._getOneCell(),e=t.width+this._spaceX||1,i=t.height+this._spaceY||1;this._width>0&&(this._repeatX2=this._isVertical?Math.round(this._width/e):Math.ceil(this._width/e)),this._height>0&&(this._repeatY2=this._isVertical?Math.ceil(this._height/i):Math.round(this._height/i));var s=this._width?this._width:e*this.repeatX-this._spaceX,n=this._height?this._height:i*this.repeatY-this._spaceY;this._cellSize=this._isVertical?i:e,this._cellOffset=this._isVertical?i*Math.max(this._repeatY2,this._repeatY)-n-this._spaceY:e*Math.max(this._repeatX2,this._repeatX)-s-this._spaceX,this._isVertical&&this._scrollBar?this._scrollBar.height=n:!this._isVertical&&this._scrollBar&&(this._scrollBar.width=s),this.setContentSize(s,n);var a=this._isVertical?this.repeatX:this.repeatY,o=(this._isVertical?this.repeatY:this.repeatX)+(this._scrollBar?1:0);this._createItems(0,a,o),this._createdLine=o,this._array&&(this.array=this._array,this.runCallLater(this.renderItems))}},s._getOneCell=function(){if(0===this._cells.length){var t=this.createItem();this._offset.setTo(t.x,t.y),this._cells.push(t)}return this._cells[0]},s._createItems=function(t,e,i){var s=this._content,n=this._getOneCell(),a=n.width+this._spaceX,o=n.height+this._spaceY;if(this.cacheContent){var r=new B;r.cacheAsBitmap=!0,r.pos((this._isVertical?0:t)*a,(this._isVertical?t:0)*o),this._content.addChild(r),this._content.optimizeScrollRect=!0,s=r}for(var h=[],l=this._cells.length-1;l>-1;l--){var c=this._cells[l];c.removeSelf(),h.push(c)}this._cells.length=0;for(var d=t;i>d;d++)for(var u=0;e>u;u++)n=h.length?h.pop():this.createItem(),n.x=(this._isVertical?u:d)*a-s.x,n.y=(this._isVertical?d:u)*o-s.y,n.name="item"+(d*e+u),s.addChild(n),this.addCell(n)},s.createItem=function(){return"function"==typeof this._itemRender?new this._itemRender:W.createComp(this._itemRender)},s.addCell=function(t){t.on("click",this,this.onCellMouse),t.on("rightclick",this,this.onCellMouse),t.on("mouseover",this,this.onCellMouse),t.on("mouseout",this,this.onCellMouse),t.on("mousedown",this,this.onCellMouse),t.on("mouseup",this,this.onCellMouse),this._cells.push(t)},s.initItems=function(){if(!this._itemRender&&null!=this.getChildByName("item0")){this.repeatX=1;var t=0;t=0;for(var e=0;1e4>e;e++){var i=this.getChildByName("item"+e);{if(!i)break;this.addCell(i),t++}}this.repeatY=t}},s.setContentSize=function(t,e){this._content.width=t,this._content.height=e,(this._scrollBar||0!=this._offset.x||0!=this._offset.y)&&(this._content.scrollRect||(this._content.scrollRect=new g),
this._content.scrollRect.setTo(-this._offset.x,-this._offset.y,t,e),this._content.conchModel&&this._content.conchModel.scrollRect(-this._offset.x,-this._offset.y,t,e)),this.event("resize")},s.onCellMouse=function(t){"mousedown"===t.type&&(this._isMoved=!1);var e=t.currentTarget,i=this._startIndex+this._cells.indexOf(e);0>i||("click"===t.type||"rightclick"===t.type?this.selectEnable&&!this._isMoved?this.selectedIndex=i:this.changeCellState(e,!0,0):"mouseover"!==t.type&&"mouseout"!==t.type||this._selectedIndex===i||this.changeCellState(e,"mouseover"===t.type,0),this.mouseHandler&&this.mouseHandler.runWith([t,i]))},s.changeCellState=function(t,e,i){var s=t.getChildByName("selectBox");s&&(this.selectEnable=!0,s.visible=e,s.index=i)},s.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this.width,this.height),this._scrollBar&&this.callLater(this.onScrollBarChange)},s.onScrollBarChange=function(t){this.runCallLater(this.changeCells);var e=this._scrollBar.value,i=this._isVertical?this.repeatX:this.repeatY,s=this._isVertical?this.repeatY:this.repeatX,n=Math.floor(e/this._cellSize);if(this.cacheContent)o=s+1,this._createdLine-n<o&&(this._createItems(this._createdLine,i,this._createdLine+o),this._createdLine+=o,this.renderItems(this._createdLine*i,0));else{var a=n*i,o=0;if(a>this._startIndex){o=a-this._startIndex;var r=!0,h=this._startIndex+i*(s+1);this._isMoved=!0}else a<this._startIndex&&(o=this._startIndex-a,r=!1,h=this._startIndex-1,this._isMoved=!0);for(var l=0;o>l;l++){if(r){var c=this._cells.shift();this._cells[this._cells.length]=c;var d=h+l}else c=this._cells.pop(),this._cells.unshift(c),d=h-l;var u=Math.floor(d/i)*this._cellSize;this._isVertical?c.y=u:c.x=u,this.renderItem(c,d)}this._startIndex=a,this.changeSelectStatus()}var p=this._content.scrollRect;this._isVertical?(p.y=e-this._offset.y,p.x=-this._offset.x):(p.y=-this._offset.y,p.x=e-this._offset.x),this._content.conchModel&&this._content.conchModel.scrollRect(p.x,p.y,p.width,p.height),this.repaint()},s.posCell=function(t,e){if(this._scrollBar){var i=this._isVertical?this.repeatX:this.repeatY,s=(this._isVertical?this.repeatY:this.repeatX,Math.floor(e/i)*this._cellSize);this._isVertical?t.y=s:t.x=s}},s.changeSelectStatus=function(){for(var t=0,e=this._cells.length;e>t;t++)this.changeCellState(this._cells[t],this._selectedIndex===this._startIndex+t,1)},s.renderItems=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);for(var i=t,s=e||this._cells.length;s>i;i++)this.renderItem(this._cells[i],this._startIndex+i);this.changeSelectStatus()},s.renderItem=function(t,e){this._array&&e>=0&&e<this._array.length?(t.visible=!0,t.dataSource=this._array[e],this.cacheContent||this.posCell(t,e),this.hasListener("render")&&this.event("render",[t,e]),this.renderHandler&&this.renderHandler.runWith([t,e])):(t.visible=!1,t.dataSource=null)},s.refresh=function(){this.startIndex=this._startIndex},s.getItem=function(t){return t>-1&&t<this._array.length?this._array[t]:null},s.changeItem=function(t,e){t>-1&&t<this._array.length&&(this._array[t]=e,t>=this._startIndex&&t<this._startIndex+this._cells.length&&this.renderItem(this.getCell(t),t))},s.setItem=function(t,e){this.changeItem(t,e)},s.addItem=function(t){this._array.push(t),this.array=this._array},s.addItemAt=function(t,e){this._array.splice(e,0,t),this.array=this._array},s.deleteItem=function(t){this._array.splice(t,1),this.array=this._array},s.getCell=function(t){return this.runCallLater(this.changeCells),t>-1&&this._cells?this._cells[(t-this._startIndex)%this._cells.length]:null},s.scrollTo=function(t){if(this._scrollBar){var e=this._isVertical?this.repeatX:this.repeatY;this._scrollBar.value=Math.floor(t/e)*this._cellSize}else this.startIndex=t},s.tweenTo=function(t,e,i){if(void 0===e&&(e=200),this._scrollBar){var s=this._isVertical?this.repeatX:this.repeatY;b.to(this._scrollBar,{value:Math.floor(t/s)*this._cellSize},e,null,i,0,!0)}else this.startIndex=t,i&&i.run()},s._setCellChanged=function(){this._cellChanged||(this._cellChanged=!0,this.callLater(this.changeCells))},s.commitMeasure=function(){this.runCallLater(this.changeCells)},a(0,s,"cacheAs",t.prototype._$get_cacheAs,function(e){t.prototype._$set_cacheAs.call(this,e),this._scrollBar&&(this._$P.cacheAs=null,"none"!==e?this._scrollBar.on("start",this,this.onScrollStart):this._scrollBar.off("start",this,this.onScrollStart))}),a(0,s,"content",function(){return this._content}),a(0,s,"height",t.prototype._$get_height,function(e){t.prototype._$set_height.call(this,e),this._setCellChanged()}),a(0,s,"itemRender",function(){return this._itemRender},function(t){if(this._itemRender!=t){this._itemRender=t;for(var e=this._cells.length-1;e>-1;e--)this._cells[e].destroy();this._cells.length=0,this._setCellChanged()}}),a(0,s,"vScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(t){this.removeChildByName("scrollBar");var e=new tt;e.name="scrollBar",e.right=0,t&&" "!=t&&(e.skin=t),this.scrollBar=e,this.addChild(e),this._setCellChanged()}),a(0,s,"page",function(){return this._page},function(t){this._page=t,this._array&&(this._page=t>0?t:0,this._page=this._page<this.totalPage?this._page:this.totalPage-1,this.startIndex=this._page*this.repeatX*this.repeatY)}),a(0,s,"hScrollBarSkin",function(){return this._scrollBar?this._scrollBar.skin:null},function(t){this.removeChildByName("scrollBar");var e=new q;e.name="scrollBar",e.bottom=0,t&&" "!=t&&(e.skin=t),this.scrollBar=e,this.addChild(e),this._setCellChanged()}),a(0,s,"repeatX",function(){return this._repeatX>0?this._repeatX:this._repeatX2>0?this._repeatX2:1},function(t){this._repeatX=t,this._setCellChanged()}),a(0,s,"scrollBar",function(){return this._scrollBar},function(t){this._scrollBar!=t&&(this._scrollBar=t,t&&(this._isVertical=this._scrollBar.isVertical,this.addChild(this._scrollBar),this._scrollBar.on("change",this,this.onScrollBarChange)))}),a(0,s,"width",t.prototype._$get_width,function(e){t.prototype._$set_width.call(this,e),this._setCellChanged()}),a(0,s,"repeatY",function(){return this._repeatY>0?this._repeatY:this._repeatY2>0?this._repeatY2:1},function(t){this._repeatY=t,this._setCellChanged()}),a(0,s,"spaceX",function(){return this._spaceX},function(t){this._spaceX=t,this._setCellChanged()}),a(0,s,"spaceY",function(){return this._spaceY},function(t){this._spaceY=t,this._setCellChanged()}),a(0,s,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this._selectedIndex=t,this.changeSelectStatus(),this.event("change"),this.selectHandler&&this.selectHandler.runWith(t),this.startIndex=this._startIndex)}),a(0,s,"selectedItem",function(){return-1!=this._selectedIndex?this._array[this._selectedIndex]:null},function(t){this.selectedIndex=this._array.indexOf(t)}),a(0,s,"length",function(){return this._array?this._array.length:0}),a(0,s,"selection",function(){return this.getCell(this._selectedIndex)},function(t){this.selectedIndex=this._startIndex+this._cells.indexOf(t)}),a(0,s,"startIndex",function(){return this._startIndex},function(t){this._startIndex=t>0?t:0,this.callLater(this.renderItems)}),a(0,s,"array",function(){return this._array},function(t){this.runCallLater(this.changeCells),this._array=t||[];var e=this._array.length;if(this.totalPage=Math.ceil(e/(this.repeatX*this.repeatY)),this._selectedIndex=this._selectedIndex<e?this._selectedIndex:e-1,this.startIndex=this._startIndex,this._scrollBar){this._scrollBar.stopScroll();var i=this._isVertical?this.repeatX:this.repeatY,s=this._isVertical?this.repeatY:this.repeatX,n=Math.ceil(e/i),a=this._cellOffset>0?this.totalPage+1:this.totalPage;a>1?(this._scrollBar.scrollSize=this._cellSize,this._scrollBar.thumbPercent=s/n,this._scrollBar.setScroll(0,(n-s)*this._cellSize+this._cellOffset,this._scrollBar.value),this._scrollBar.target=this._content):(this._scrollBar.setScroll(0,0,0),this._scrollBar.target=this._content)}}),a(0,s,"dataSource",t.prototype._$get_dataSource,function(e){this._dataSource=e,"number"==typeof e&&Math.floor(e)==e||"string"==typeof e?this.selectedIndex=parseInt(e):e instanceof Array?this.array=e:t.prototype._$set_dataSource.call(this,e)}),a(0,s,"cells",function(){return this.runCallLater(this.changeCells),this._cells}),e}(B),Y=function(t){function e(){this._content=null,this._vScrollBar=null,this._hScrollBar=null,this._scrollChanged=!1,e.__super.call(this),this.width=this.height=100,this._content.optimizeScrollRect=!0}n(e,"laya.ui.Panel",t);var i=e.prototype;return i.destroy=function(t){void 0===t&&(t=!0),laya.ui.Component.prototype.destroy.call(this,t),this._content&&this._content.destroy(t),this._vScrollBar&&this._vScrollBar.destroy(t),this._hScrollBar&&this._hScrollBar.destroy(t),this._vScrollBar=null,this._hScrollBar=null,this._content=null},i.destroyChildren=function(){this._content.destroyChildren()},i.createChildren=function(){laya.display.Node.prototype.addChild.call(this,this._content=new B)},i.addChild=function(t){return t.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChild(t)},i.onResize=function(){this._setScrollChanged()},i.addChildAt=function(t,e){return t.on("resize",this,this.onResize),this._setScrollChanged(),this._content.addChildAt(t,e)},i.removeChild=function(t){return t.off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChild(t)},i.removeChildAt=function(t){return this.getChildAt(t).off("resize",this,this.onResize),this._setScrollChanged(),this._content.removeChildAt(t)},i.removeChildren=function(t,e){void 0===t&&(t=0),void 0===e&&(e=2147483647);for(var i=this._content.numChildren-1;i>-1;i--)this._content.removeChildAt(i);return this._setScrollChanged(),this},i.getChildAt=function(t){return this._content.getChildAt(t)},i.getChildByName=function(t){return this._content.getChildByName(t)},i.getChildIndex=function(t){return this._content.getChildIndex(t)},i.changeScroll=function(){this._scrollChanged=!1;var t=this.contentWidth||1,e=this.contentHeight||1,i=this._vScrollBar,s=this._hScrollBar,n=i&&e>this._height,a=s&&t>this._width,o=n?this._width-i.width:this._width,r=a?this._height-s.height:this._height;i&&(i.x=this._width-i.width,i.y=0,i.height=this._height-(a?s.height:0),i.scrollSize=Math.max(.033*this._height,1),i.thumbPercent=r/e,i.setScroll(0,e-r,i.value)),s&&(s.x=0,s.y=this._height-s.height,s.width=this._width-(n?i.width:0),s.scrollSize=Math.max(.033*this._width,1),s.thumbPercent=o/t,s.setScroll(0,t-o,s.value))},i.changeSize=function(){laya.ui.Component.prototype.changeSize.call(this),this.setContentSize(this._width,this._height)},i.setContentSize=function(t,e){var i=this._content;i.width=t,i.height=e,i.scrollRect||(i.scrollRect=new g),i.scrollRect.setTo(0,0,t,e),i.conchModel&&i.conchModel.scrollRect(0,0,t,e)},i.onScrollBarChange=function(t){var e=this._content.scrollRect;if(e){var i=Math.round(t.value);t.isVertical?e.y=i:e.x=i,this._content.conchModel&&this._content.conchModel.scrollRect(e.x,e.y,e.width,e.height)}},i.scrollTo=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.vScrollBar&&(this.vScrollBar.value=e),this.hScrollBar&&(this.hScrollBar.value=t)},i.refresh=function(){this.changeScroll()},i.onScrollStart=function(){this._$P.cacheAs||(this._$P.cacheAs=t.prototype._$get_cacheAs.call(this)),t.prototype._$set_cacheAs.call(this,"none"),this._hScrollBar&&this._hScrollBar.once("end",this,this.onScrollEnd),this._vScrollBar&&this._vScrollBar.once("end",this,this.onScrollEnd)},i.onScrollEnd=function(){t.prototype._$set_cacheAs.call(this,this._$P.cacheAs)},i._setScrollChanged=function(){this._scrollChanged||(this._scrollChanged=!0,this.callLater(this.changeScroll))},a(0,i,"numChildren",function(){return this._content.numChildren}),a(0,i,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(t){null==this._hScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._hScrollBar=new q),this._hScrollBar.on("change",this,this.onScrollBarChange,[this._hScrollBar]),this._hScrollBar.target=this._content,this._setScrollChanged()),this._hScrollBar.skin=t}),a(0,i,"contentWidth",function(){for(var t=0,e=this._content.numChildren-1;e>-1;e--){var i=this._content.getChildAt(e);t=Math.max(i.x+i.width*i.scaleX,t)}return t}),a(0,i,"contentHeight",function(){for(var t=0,e=this._content.numChildren-1;e>-1;e--){var i=this._content.getChildAt(e);t=Math.max(i.y+i.height*i.scaleY,t)}return t}),a(0,i,"width",t.prototype._$get_width,function(e){t.prototype._$set_width.call(this,e),this._setScrollChanged()}),a(0,i,"hScrollBar",function(){return this._hScrollBar}),a(0,i,"content",function(){return this._content}),a(0,i,"height",t.prototype._$get_height,function(e){t.prototype._$set_height.call(this,e),this._setScrollChanged()}),a(0,i,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(t){null==this._vScrollBar&&(laya.display.Node.prototype.addChild.call(this,this._vScrollBar=new tt),this._vScrollBar.on("change",this,this.onScrollBarChange,[this._vScrollBar]),this._vScrollBar.target=this._content,this._setScrollChanged()),this._vScrollBar.skin=t}),a(0,i,"vScrollBar",function(){return this._vScrollBar}),a(0,i,"cacheAs",t.prototype._$get_cacheAs,function(e){t.prototype._$set_cacheAs.call(this,e),this._$P.cacheAs=null,"none"!==e?(this._hScrollBar&&this._hScrollBar.on("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.on("start",this,this.onScrollStart)):(this._hScrollBar&&this._hScrollBar.off("start",this,this.onScrollStart),this._vScrollBar&&this._vScrollBar.off("start",this,this.onScrollStart))}),e}(B),q=function(t){function e(){e.__super.call(this)}n(e,"laya.ui.HScrollBar",t);var i=e.prototype;return i.initialize=function(){t.prototype.initialize.call(this),this.slider.isVertical=!1},e}(F),z=function(t){function e(t){e.__super.call(this,t),this.isVertical=!1}return n(e,"laya.ui.HSlider",t),e}(N),J=function(t){function e(t,i){this.selectHandler=null,this._items=null,this._selectedIndex=-1,this._skin=null,this._direction="horizontal",this._space=0,this._labels=null,this._labelColors=null,this._labelFont=null,this._labelStrokeColor=null,this._strokeColors=null,this._labelStroke=NaN,this._labelSize=0,this._labelBold=!1,this._labelPadding=null,this._labelAlign=null,this._stateNum=0,this._labelChanged=!1,e.__super.call(this),this.skin=i,this.labels=t}n(e,"laya.ui.UIGroup",t);var s=e.prototype;return i.imps(s,{"laya.ui.IItem":!0}),s.preinitialize=function(){this.mouseEnabled=!0},s.destroy=function(t){void 0===t&&(t=!0),laya.ui.Component.prototype.destroy.call(this,t),this._items&&(this._items.length=0),this._items=null,this.selectHandler=null},s.addItem=function(t,e){void 0===e&&(e=!0);var i=t,s=this._items.length;if(i.name="item"+s,this.addChild(i),this.initItems(),e&&s>0){var n=this._items[s-1];"horizontal"==this._direction?i.x=n.x+n.width+this._space:i.y=n.y+n.height+this._space}else e&&(i.x=0,i.y=0);return s},s.delItem=function(t,e){void 0===e&&(e=!0);var i=this._items.indexOf(t);if(-1!=i){var s=t;this.removeChild(s);for(var n=i+1,a=this._items.length;a>n;n++){var o=this._items[n];o.name="item"+(n-1),e&&("horizontal"==this._direction?o.x-=s.width+this._space:o.y-=s.height+this._space)}if(this.initItems(),this._selectedIndex>-1){var r=0;r=this._selectedIndex<this._items.length?this._selectedIndex:this._selectedIndex-1,this._selectedIndex=-1,this.selectedIndex=r}}},s.initItems=function(){this._items||(this._items=[]),this._items.length=0;for(var t=0;1e4>t;t++){var e=this.getChildByName("item"+t);if(null==e)break;this._items.push(e),e.selected=t===this._selectedIndex,e.clickHandler=_.create(this,this.itemClick,[t],!1)}},s.itemClick=function(t){this.selectedIndex=t},s.setSelect=function(t,e){this._items&&t>-1&&t<this._items.length&&(this._items[t].selected=e)},s.createItem=function(t,e){return null},s.changeLabels=function(){if(this._labelChanged=!1,this._items)for(var t=0,e=0,i=this._items.length;i>e;e++){var s=this._items[e];this._skin&&(s.skin=this._skin),this._labelColors&&(s.labelColors=this._labelColors),this._labelSize&&(s.labelSize=this._labelSize),this._labelStroke&&(s.labelStroke=this._labelStroke),this._labelStrokeColor&&(s.labelStrokeColor=this._labelStrokeColor),this._strokeColors&&(s.strokeColors=this._strokeColors),this._labelBold&&(s.labelBold=this._labelBold),this._labelPadding&&(s.labelPadding=this._labelPadding),this._labelAlign&&(s.labelAlign=this._labelAlign),this._stateNum&&(s.stateNum=this._stateNum),this._labelFont&&(s.labelFont=this._labelFont),"horizontal"===this._direction?(s.y=0,s.x=t,t+=s.width+this._space):(s.x=0,s.y=t,t+=s.height+this._space)}this.changeSize()},s.commitMeasure=function(){this.runCallLater(this.changeLabels)},s._setLabelChanged=function(){this._labelChanged||(this._labelChanged=!0,this.callLater(this.changeLabels))},a(0,s,"labelStrokeColor",function(){return this._labelStrokeColor},function(t){this._labelStrokeColor!=t&&(this._labelStrokeColor=t,this._setLabelChanged())}),a(0,s,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this._setLabelChanged())}),a(0,s,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=t,this.setSelect(t,!0),this.event("change"),this.selectHandler&&this.selectHandler.runWith(this._selectedIndex))}),a(0,s,"labels",function(){return this._labels},function(t){if(this._labels!=t){if(this._labels=t,this.removeChildren(),this._setLabelChanged(),this._labels)for(var e=this._labels.split(","),i=0,s=e.length;s>i;i++){var n=this.createItem(this._skin,e[i]);n.name="item"+i,this.addChild(n)}this.initItems()}}),a(0,s,"strokeColors",function(){return this._strokeColors},function(t){this._strokeColors!=t&&(this._strokeColors=t,this._setLabelChanged())}),a(0,s,"labelColors",function(){return this._labelColors},function(t){this._labelColors!=t&&(this._labelColors=t,this._setLabelChanged())}),a(0,s,"labelStroke",function(){return this._labelStroke},function(t){this._labelStroke!=t&&(this._labelStroke=t,this._setLabelChanged())}),a(0,s,"labelSize",function(){return this._labelSize},function(t){this._labelSize!=t&&(this._labelSize=t,this._setLabelChanged())}),a(0,s,"stateNum",function(){return this._stateNum},function(t){this._stateNum!=t&&(this._stateNum=t,this._setLabelChanged())}),a(0,s,"labelBold",function(){return this._labelBold},function(t){this._labelBold!=t&&(this._labelBold=t,this._setLabelChanged())}),a(0,s,"labelFont",function(){return this._labelFont},function(t){this._labelFont!=t&&(this._labelFont=t,this._setLabelChanged())}),a(0,s,"labelPadding",function(){return this._labelPadding},function(t){this._labelPadding!=t&&(this._labelPadding=t,this._setLabelChanged())}),a(0,s,"direction",function(){return this._direction},function(t){this._direction=t,this._setLabelChanged()}),a(0,s,"space",function(){return this._space},function(t){this._space=t,this._setLabelChanged()}),a(0,s,"items",function(){return this._items}),a(0,s,"selection",function(){return this._selectedIndex>-1&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(t){this.selectedIndex=this._items.indexOf(t)}),a(0,s,"dataSource",t.prototype._$get_dataSource,function(e){this._dataSource=e,"number"==typeof e&&Math.floor(e)==e||"string"==typeof e?this.selectedIndex=parseInt(e):e instanceof Array?this.labels=e.join(","):t.prototype._$set_dataSource.call(this,e)}),e}(B),Q=function(t){function e(t,i){this._value=null,void 0===i&&(i=""),e.__super.call(this,t,i)}n(e,"laya.ui.Radio",t);var i=e.prototype;return i.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._value=null},i.preinitialize=function(){laya.ui.Component.prototype.preinitialize.call(this),this.toggle=!1,this._autoSize=!1},i.initialize=function(){t.prototype.initialize.call(this),this.createText(),this._text.align="left",this._text.valign="top",this._text.width=0,this.on("click",this,this.onClick)},i.onClick=function(t){this.selected=!0},a(0,i,"value",function(){return null!=this._value?this._value:this.label},function(t){this._value=t}),e}(P),$=function(t){function e(){this._list=null,this._source=null,this._renderHandler=null,this._spaceLeft=10,this._spaceBottom=0,this._keepStatus=!0,e.__super.call(this),this.width=this.height=200}n(e,"laya.ui.Tree",t);var s=e.prototype;return i.imps(s,{"laya.ui.IRender":!0}),s.destroy=function(t){void 0===t&&(t=!0),laya.ui.Component.prototype.destroy.call(this,t),this._list&&this._list.destroy(t),this._list=null,this._source=null,this._renderHandler=null},s.createChildren=function(){this.addChild(this._list=new X),this._list.renderHandler=_.create(this,this.renderItem,null,!1),this._list.repeatX=1,this._list.on("change",this,this.onListChange)},s.onListChange=function(t){this.event("change")},s.getArray=function(){var t,e=[];for(var i in this._source)t=this._source[i],this.getParentOpenStatus(t)&&(t.x=this._spaceLeft*this.getDepth(t),e.push(t));return e},s.getDepth=function(t,e){return void 0===e&&(e=0),null==t.nodeParent?e:this.getDepth(t.nodeParent,e+1)},s.getParentOpenStatus=function(t){var e=t.nodeParent;return null==e?!0:e.isOpen?null!=e.nodeParent?this.getParentOpenStatus(e):!0:!1},s.renderItem=function(t,e){var i=t.dataSource;if(i){t.left=i.x;var s=t.getChildByName("arrow");s&&(i.hasChild?(s.visible=!0,s.index=i.isOpen?1:0,s.tag=e,s.off("click",this,this.onArrowClick),s.on("click",this,this.onArrowClick)):s.visible=!1);var n=t.getChildByName("folder");n&&(2==n.clipY?n.index=i.isDirectory?0:1:n.index=i.isDirectory?i.isOpen?1:0:2),this._renderHandler&&this._renderHandler.runWith([t,e])}},s.onArrowClick=function(t){var e=t.currentTarget,i=e.tag;this._list.array[i].isOpen=!this._list.array[i].isOpen,this.event("open"),this._list.array=this.getArray()},s.setItemState=function(t,e){this._list.array[t]&&(this._list.array[t].isOpen=e,this._list.array=this.getArray())},s.fresh=function(){this._list.array=this.getArray(),this.repaint()},s.parseXml=function(t,e,i,s){var n,a=t.childNodes,o=a.length;if(!s){n={};var r,h=t.attributes;for(var l in h){r=h[l];var c=r.nodeName,d=r.nodeValue;n[c]="true"==d?!0:"false"==d?!1:d}n.nodeParent=i,o>0&&(n.isDirectory=!0),n.hasChild=o>0,e.push(n)}for(var u=0;o>u;u++){var p=a[u];this.parseXml(p,e,n,!1)}},s.parseOpenStatus=function(t,e){for(var i=0,s=e.length;s>i;i++){var n=e[i];if(n.isDirectory)for(var a=0,o=t.length;o>a;a++){var r=t[a];if(r.isDirectory&&this.isSameParent(r,n)&&n.label==r.label){n.isOpen=r.isOpen;break}}}},s.isSameParent=function(t,e){return null==t.nodeParent&&null==e.nodeParent?!0:null==t.nodeParent||null==e.nodeParent?!1:t.nodeParent.label==e.nodeParent.label?this.isSameParent(t.nodeParent,e.nodeParent):!1},s.filter=function(t){if(Boolean(t)){var e=[];this.getFilterSource(this._source,e,t),this._list.array=e}else this._list.array=this.getArray()},s.getFilterSource=function(t,e,i){i=i.toLocaleLowerCase();var s;for(var n in t)s=t[n],!s.isDirectory&&String(s.label).toLowerCase().indexOf(i)>-1&&(s.x=0,e.push(s)),s.child&&s.child.length>0&&this.getFilterSource(s.child,e,i)},a(0,s,"spaceBottom",function(){return this._list.spaceY},function(t){this._list.spaceY=t}),a(0,s,"keepStatus",function(){return this._keepStatus},function(t){this._keepStatus=t}),a(0,s,"itemRender",function(){return this._list.itemRender},function(t){this._list.itemRender=t}),a(0,s,"array",function(){return this._list.array},function(t){this._keepStatus&&this._list.array&&t&&this.parseOpenStatus(this._list.array,t),this._source=t,this._list.array=this.getArray()}),a(0,s,"mouseHandler",function(){return this._list.mouseHandler},function(t){this._list.mouseHandler=t}),a(0,s,"dataSource",t.prototype._$get_dataSource,function(e){this._dataSource=e,t.prototype._$set_dataSource.call(this,e)}),a(0,s,"source",function(){return this._source}),a(0,s,"scrollBar",function(){return this._list.scrollBar}),a(0,s,"list",function(){return this._list}),a(0,s,"scrollBarSkin",function(){return this._list.vScrollBarSkin},function(t){this._list.vScrollBarSkin=t}),a(0,s,"renderHandler",function(){return this._renderHandler},function(t){this._renderHandler=t}),a(0,s,"selectedIndex",function(){return this._list.selectedIndex},function(t){this._list.selectedIndex=t}),a(0,s,"spaceLeft",function(){return this._spaceLeft},function(t){this._spaceLeft=t}),a(0,s,"selectedItem",function(){return this._list.selectedItem},function(t){this._list.selectedItem=t}),a(0,s,"width",t.prototype._$get_width,function(e){t.prototype._$set_width.call(this,e),this._list.width=e}),a(0,s,"height",t.prototype._$get_height,function(e){t.prototype._$set_height.call(this,e),this._list.height=e}),a(0,s,"xml",null,function(t){var e=[];this.parseXml(t.childNodes[0],e,null,!0),this.array=e}),a(0,s,"selectedPath",function(){return this._list.selectedItem?this._list.selectedItem.path:null}),e}(B),Z=function(t){function e(){this._items=null,this._selectedIndex=0,e.__super.call(this),this._setIndexHandler=_.create(this,this.setIndex,null,!1)}n(e,"laya.ui.ViewStack",t);var s=e.prototype;return i.imps(s,{"laya.ui.IItem":!0}),s.setItems=function(t){this.removeChildren();for(var e=0,i=0,s=t.length;s>i;i++){var n=t[i];n&&(n.name="item"+e,this.addChild(n),e++)}this.initItems()},s.addItem=function(t){t.name="item"+this._items.length,this.addChild(t),this.initItems()},s.initItems=function(){this._items=[];for(var t=0;1e4>t;t++){var e=this.getChildByName("item"+t);if(null==e)break;this._items.push(e),e.visible=t==this._selectedIndex}},s.setSelect=function(t,e){this._items&&t>-1&&t<this._items.length&&(this._items[t].visible=e)},s.setIndex=function(t){this.selectedIndex=t},a(0,s,"dataSource",t.prototype._$get_dataSource,function(t){if(this._dataSource=t,"number"==typeof t&&Math.floor(t)==t||"string"==typeof t)this.selectedIndex=parseInt(t);else for(var e in this._dataSource)this.hasOwnProperty(e)&&(this[e]=this._dataSource[e])}),a(0,s,"selectedIndex",function(){return this._selectedIndex},function(t){this._selectedIndex!=t&&(this.setSelect(this._selectedIndex,!1),this._selectedIndex=t,this.setSelect(this._selectedIndex,!0))}),a(0,s,"selection",function(){return this._selectedIndex>-1&&this._selectedIndex<this._items.length?this._items[this._selectedIndex]:null},function(t){this.selectedIndex=this._items.indexOf(t)}),a(0,s,"items",function(){return this._items}),a(0,s,"setIndexHandler",function(){return this._setIndexHandler},function(t){this._setIndexHandler=t}),e}(B),tt=function(t){function e(){e.__super.call(this)}return n(e,"laya.ui.VScrollBar",t),e}(F),et=function(t){function e(t){this._bg=null,this._skin=null,e.__super.call(this),void 0===t&&(t=""),this.text=t,this.skin=this.skin}n(e,"laya.ui.TextInput",t);var i=e.prototype;return i.preinitialize=function(){this.mouseEnabled=!0},i.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._bg&&this._bg.destroy(),this._bg=null},i.createChildren=function(){this.addChild(this._tf=new f),this._tf.padding=T.inputLabelPadding,this._tf.on("input",this,this._onInput),this._tf.on("enter",this,this._onEnter),this._tf.on("blur",this,this._onBlur),this._tf.on("focus",this,this._onFocus)},i._onFocus=function(){this.event("focus",this)},i._onBlur=function(){this.event("blur",this)},i._onInput=function(){this.event("input",this)},i._onEnter=function(){this.event("enter",this)},i.initialize=function(){this.width=128,this.height=22},i.select=function(){this._tf.select()},i.setSelection=function(t,e){this._tf.setSelection(t,e)},a(0,i,"text",t.prototype._$get_text,function(t){this._tf.text!=t&&(t+="",this._tf.text=t,this.event("change"))}),a(0,i,"bg",function(){return this._bg},function(t){this.graphics=this._bg=t}),a(0,i,"inputElementYAdjuster",function(){return this._tf.inputElementYAdjuster},function(t){this._tf.inputElementYAdjuster=t}),a(0,i,"multiline",function(){return this._tf.multiline},function(t){this._tf.multiline=t}),a(0,i,"skin",function(){return this._skin},function(t){this._skin!=t&&(this._skin=t,this._bg||(this.graphics=this._bg=new E),this._bg.source=y.getRes(this._skin),this._width&&(this._bg.width=this._width),this._height&&(this._bg.height=this._height))}),a(0,i,"sizeGrid",function(){return this._bg&&this._bg.sizeGrid?this._bg.sizeGrid.join(","):null},function(t){this._bg||(this.graphics=this._bg=new E),this._bg.sizeGrid=L.fillArray(T.defaultSizeGrid,t,Number)}),a(0,i,"inputElementXAdjuster",function(){return this._tf.inputElementXAdjuster},function(t){this._tf.inputElementXAdjuster=t}),a(0,i,"width",t.prototype._$get_width,function(e){t.prototype._$set_width.call(this,e),this._bg&&(this._bg.width=e)}),a(0,i,"height",t.prototype._$get_height,function(e){t.prototype._$set_height.call(this,e),this._bg&&(this._bg.height=e)}),a(0,i,"editable",function(){return this._tf.editable},function(t){this._tf.editable=t}),a(0,i,"restrict",function(){return this._tf.restrict},function(t){this._tf.restrict=t}),a(0,i,"prompt",function(){return this._tf.prompt},function(t){this._tf.prompt=t}),a(0,i,"promptColor",function(){return this._tf.promptColor},function(t){this._tf.promptColor=t}),a(0,i,"maxChars",function(){return this._tf.maxChars},function(t){this._tf.maxChars=t}),a(0,i,"focus",function(){return this._tf.focus},function(t){this._tf.focus=t}),a(0,i,"type",function(){return this._tf.type},function(t){this._tf.type=t}),a(0,i,"asPassword",function(){return this._tf.asPassword},function(t){this._tf.asPassword=t}),e}(H),it=function(t){function e(){e.__super.call(this)}return n(e,"laya.ui.VSlider",t),e}(N),st=function(t){function e(){this.popupCenter=!0,this.closeHandler=null,this.popupEffect=null,this.closeEffect=null,this.group=null,this.isModal=!1,this._dragArea=null,e.__super.call(this)}n(e,"laya.ui.Dialog",t);var i=e.prototype;return i.initialize=function(){this.popupEffect=e.manager.popupEffectHandler,this.closeEffect=e.manager.closeEffectHandler,this._dealDragArea(),this.on("click",this,this._onClick)},i._dealDragArea=function(){var t=this.getChildByName("drag");t&&(this.dragArea=t.x+","+t.y+","+t.width+","+t.height,t.removeSelf())},i._onClick=function(t){var e=t.target;if(e)switch(e.name){case"close":case"cancel":case"sure":case"no":case"ok":case"yes":this.close(e.name)}},i.show=function(t){void 0===t&&(t=!1),this._open(!1,t)},i.popup=function(t){void 0===t&&(t=!1),this._open(!0,t)},i._open=function(t,i){e.manager.lock(!1),this.isModal=t,e.manager.open(this,i)},i.onOpened=function(){},i.close=function(t){e.manager.close(this,t)},i.onClosed=function(t){},i._onMouseDown=function(t){var e=this.getMousePoint();this._dragArea.contains(e.x,e.y)?this.startDrag():this.stopDrag()},a(0,i,"dragArea",function(){return this._dragArea?this._dragArea.toString():null},function(t){if(t){var e=L.fillArray([0,0,0,0],t,Number);this._dragArea=new g(e[0],e[1],e[2],e[3]),this.on("mousedown",this,this._onMouseDown)}else this._dragArea=null,this.off("mousedown",this,this._onMouseDown)}),a(0,i,"isPopup",function(){return null!=this.parent}),a(0,i,"zOrder",t.prototype._$get_zOrder,function(i){t.prototype._$set_zOrder.call(this,i),e.manager._checkMask()}),a(1,e,"manager",function(){return e._manager=e._manager||new A},function(t){e._manager=t}),e.setLockView=function(t){e.manager.setLockView(t)},e.lock=function(t){e.manager.lock(t)},e.closeAll=function(){e.manager.closeAll()},e.getDialogsByGroup=function(t){return e.manager.getDialogsByGroup(t)},e.closeByGroup=function(t){return e.manager.closeByGroup(t)},e.CLOSE="close",e.CANCEL="cancel",e.SURE="sure",e.NO="no",e.OK="ok",e.YES="yes",e._manager=null,e}(W),nt=function(t){function e(){e.__super.call(this)}n(e,"laya.ui.HBox",t);var i=e.prototype;return i.sortItem=function(t){t&&t.sort(function(t,e){return t.x-e.x})},i.changeItems=function(){this._itemChanged=!1;for(var t=[],e=0,i=0,s=this.numChildren;s>i;i++){var n=this.getChildAt(i);n&&n.layoutEnabled&&(t.push(n),e=this._height?this._height:Math.max(e,n.height*n.scaleY))}this.sortItem(t);var a=0;for(i=0,s=t.length;s>i;i++)n=t[i],n.x=a,a+=n.width*n.scaleX+this._space,"top"==this._align?n.y=0:"middle"==this._align?n.y=.5*(e-n.height*n.scaleY):"bottom"==this._align&&(n.y=e-n.height*n.scaleY);
this.changeSize()},a(0,i,"height",t.prototype._$get_height,function(e){this._height!=e&&(t.prototype._$set_height.call(this,e),this.callLater(this.changeItems))}),e.NONE="none",e.TOP="top",e.MIDDLE="middle",e.BOTTOM="bottom",e}(K),at=function(t){function e(){e.__super.call(this)}n(e,"laya.ui.VBox",t);var i=e.prototype;return i.changeItems=function(){this._itemChanged=!1;for(var t=[],e=0,i=0,s=this.numChildren;s>i;i++){var n=this.getChildAt(i);n&&n.layoutEnabled&&(t.push(n),e=this._width?this._width:Math.max(e,n.width*n.scaleX))}this.sortItem(t);var a=0;for(i=0,s=t.length;s>i;i++)n=t[i],n.y=a,a+=n.height*n.scaleY+this._space,"left"==this._align?n.x=0:"center"==this._align?n.x=.5*(e-n.width*n.scaleX):"right"==this._align&&(n.x=e-n.width*n.scaleX);this.changeSize()},a(0,i,"width",t.prototype._$get_width,function(e){this._width!=e&&(t.prototype._$set_width.call(this,e),this.callLater(this.changeItems))}),e.NONE="none",e.LEFT="left",e.CENTER="center",e.RIGHT="right",e}(K),ot=function(t){function e(){e.__super.call(this)}n(e,"laya.ui.RadioGroup",t);var i=e.prototype;return i.createItem=function(t,e){return new Q(t,e)},e}(J),rt=function(t){function e(){e.__super.call(this)}n(e,"laya.ui.Tab",t);var i=e.prototype;return i.createItem=function(t,e){return new P(t,e)},e}(J),ht=function(t){function e(t){this._vScrollBar=null,this._hScrollBar=null,void 0===t&&(t=""),e.__super.call(this,t)}n(e,"laya.ui.TextArea",t);var i=e.prototype;return i.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e),this._vScrollBar&&this._vScrollBar.destroy(),this._hScrollBar&&this._hScrollBar.destroy(),this._vScrollBar=null,this._hScrollBar=null},i.initialize=function(){this.width=180,this.height=150,this._tf.wordWrap=!0,this.multiline=!0},i.onVBarChanged=function(t){this._tf.scrollY!=this._vScrollBar.value&&(this._tf.scrollY=this._vScrollBar.value)},i.onHBarChanged=function(t){this._tf.scrollX!=this._hScrollBar.value&&(this._tf.scrollX=this._hScrollBar.value)},i.changeScroll=function(){var t=this._vScrollBar&&this._tf.maxScrollY>0,e=this._hScrollBar&&this._tf.maxScrollX>0,i=t?this._width-this._vScrollBar.width:this._width,s=e?this._height-this._hScrollBar.height:this._height,n=this._tf.padding||T.labelPadding;this._tf.width=i,this._tf.height=s,this._vScrollBar&&(this._vScrollBar.x=this._width-this._vScrollBar.width-n[2],this._vScrollBar.y=n[1],this._vScrollBar.height=this._height-(e?this._hScrollBar.height:0)-n[1]-n[3],this._vScrollBar.scrollSize=1,this._vScrollBar.thumbPercent=s/Math.max(this._tf.textHeight,s),this._vScrollBar.setScroll(1,this._tf.maxScrollY,this._tf.scrollY),this._vScrollBar.visible=t),this._hScrollBar&&(this._hScrollBar.x=n[0],this._hScrollBar.y=this._height-this._hScrollBar.height-n[3],this._hScrollBar.width=this._width-(t?this._vScrollBar.width:0)-n[0]-n[2],this._hScrollBar.scrollSize=Math.max(.033*i,1),this._hScrollBar.thumbPercent=i/Math.max(this._tf.textWidth,i),this._hScrollBar.setScroll(0,this.maxScrollX,this.scrollX),this._hScrollBar.visible=e)},i.scrollTo=function(t){this.commitMeasure(),this._tf.scrollY=t},a(0,i,"scrollY",function(){return this._tf.scrollY}),a(0,i,"width",t.prototype._$get_width,function(e){t.prototype._$set_width.call(this,e),this.callLater(this.changeScroll)}),a(0,i,"hScrollBar",function(){return this._hScrollBar}),a(0,i,"height",t.prototype._$get_height,function(e){t.prototype._$set_height.call(this,e),this.callLater(this.changeScroll)}),a(0,i,"maxScrollX",function(){return this._tf.maxScrollX}),a(0,i,"vScrollBarSkin",function(){return this._vScrollBar?this._vScrollBar.skin:null},function(t){null==this._vScrollBar&&(this.addChild(this._vScrollBar=new tt),this._vScrollBar.on("change",this,this.onVBarChanged),this._vScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._vScrollBar.skin=t}),a(0,i,"hScrollBarSkin",function(){return this._hScrollBar?this._hScrollBar.skin:null},function(t){null==this._hScrollBar&&(this.addChild(this._hScrollBar=new q),this._hScrollBar.on("change",this,this.onHBarChanged),this._hScrollBar.mouseWheelEnable=!1,this._hScrollBar.target=this._tf,this.callLater(this.changeScroll)),this._hScrollBar.skin=t}),a(0,i,"vScrollBar",function(){return this._vScrollBar}),a(0,i,"maxScrollY",function(){return this._tf.maxScrollY}),a(0,i,"scrollX",function(){return this._tf.scrollX}),e}(et);(function(t){function e(){this._uiView=null,this.isCloseOther=!1,e.__super.call(this)}n(e,"laya.ui.AsynDialog",t);var i=e.prototype;return i.createView=function(t){this._uiView=t},i._open=function(t,e){this.isModal=t,this.isCloseOther=e,st.manager.lock(!0),this._uiView?this.onCreated():this.onOpen()},i.onCreated=function(){this.createUI(),this.onOpen()},i.createUI=function(){laya.ui.View.prototype.createView.call(this,this._uiView),this._uiView=null,this._dealDragArea()},i.onOpen=function(){st.manager.open(this,this.isCloseOther),st.manager.lock(!1)},i.close=function(t){st.manager.close(this),this.onClose()},i.onClose=function(){},i.destroy=function(t){void 0===t&&(t=!0),laya.ui.View.prototype.destroy.call(this,t),this._uiView=null,this.onDestroy()},i.onDestroy=function(){},e})(st);i.__init([W])}(window,document,Laya);var hf={};window.hf=hf,function(t){var e=function(){function e(){this.mAstDic=new Object,this.completeH=null,this.progressH=null}return e.instance=function(){return null==e._instance&&(e._instance=new t.UpdateMgr),e._instance},e.prototype.LoadFile=function(t,e,i){this.completeH=e,this.progressH=i,Laya.loader.load(t,new Handler(this,this.onComplete),new Handler(this,this.getProgress),Loader.BUFFER)},e.prototype.onComplete=function(t){var i=new Laya.Byte(t),s=i.readUTFBytes(4);if("fst"==s){var n=i.getUint32();if(100==n){n=i.getUint32();for(var a,o,r=0;n>r;r++)a=i.getUint32(),o=i.getUint32(),this.mAstDic[a]=o;Laya.URL.customFormat=e.customUrl,this.completeH&&(this.completeH.run(),this.completeH.clear())}}},e.prototype.getProgress=function(t){this.progressH&&this.progressH.runWith(t)},e.customUrl=function(t,i){if(!t)return t;var s=e._instance.getFileModtime(t);return s&&(t=t+"?"+s),t},e.prototype.getFileModtime=function(t){var e=t.toLowerCase(),i=this.string_hash(e);return this.mAstDic[i]},e.prototype.string_hash=function(t){for(var e=0,i=0,s=0;s<t.length;s++)i=t.charCodeAt(s),e=(e<<5)-e+i;return e>>>=0},e.resArr=[{document:"ver001/header"},{document:"ver001/eye"},{document:"ver002/hand"}],e}();t.UpdateMgr=e}(hf||(hf={}));var hf;!function(t){function e(){var e=t.Sleep.singleton;return e}var i=function(){function e(){this.sleepList=new Array,this.isSleep=!1,this.sleepLater=1e5}return Object.defineProperty(e,"singleton",{get:function(){return null==t.Sleep._singleton&&(t.Sleep._singleton=new t.Sleep),t.Sleep._singleton},enumerable:!0,configurable:!0}),e.prototype.init=function(){t.JSUtils.onGameVisibilityChange(this,this.statusChange)},e.prototype.waitSleep=function(){Laya.timer.once(this.sleepLater,this,this.statusChange,[!1]),Laya.stage.on(laya.events.Event.CLICK,this,this.WakeUp)},e.prototype.WakeUp=function(){Laya.timer.clear(this,this.statusChange),Laya.stage.off(laya.events.Event.CLICK,this,this.WakeUp)},e.prototype.realSleep=function(){t.H5SDK.closeWindow()},e.prototype.AddFuc=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null),this.sleepList.push({thisobj:t,data:i,callBack:e})},e.prototype.RemoveFuc=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null)},e.prototype.statusChange=function(i){this.isSleep=i,this.checkList(i),Laya.stage.renderingEnabled=i,t.dispatch(e.Game_Visibilyty_Change,i)},e.prototype.checkList=function(t){for(var e=0;e<this.sleepList.length;e++)this.sleepList[e].callBack&&this.sleepList[e].callBack.apply(this.sleepList[e].thisobj,[t])},e.Game_Visibilyty_Change="Game_Visibilyty_Change",e._singleton=null,e}();t.Sleep=i,t.GameSleep=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(t){this._replayid=t,this._tempsource=[{url:"res/atlas/ui/beforeEnterGameLoading.json",type:Loader.ATLAS},{url:"res/atlas/ui/comp.json",type:Loader.ATLAS},{url:"res/atlas/ui/fight.json",type:Loader.ATLAS},{url:"res/atlas/ui/main.json",type:Loader.ATLAS},{url:"ui.json",type:Loader.JSON}],Laya.loader.load(this._tempsource,new Handler(this,this.init))}return e.prototype.init=function(){View.uiMap=Laya.loader.getRes("ui.json"),t.ProgressBar.bind(t.Facade.singleton.getPluginMgr(),t.Facade.singleton.getCommandMgr()),this._pluMgr=t.Facade.singleton.getPluginMgr(),t.Logger.log("开始启动框架："+t.ServerClock.getServerTime()),this._pluMgr.on("plugin",this,this.OnPluMgrReady),this._pluMgr.startup()},e.prototype.OnPluMgrReady=function(){t.Facade.singleton.retrievePlugin(Plugindef.PLUGIN_MANAGER).loadPlugin(t.PluginDef.PLUGIN_SOUND),t.Facade.callCommand(new t.FightReplayCommand(this._replayid,!0)),this.initSDK(),this._pluMgr.off("plugin",this,this.OnPluMgrReady)},e.prototype.initSDK=function(){var e="https://qzonestyle.gtimg.cn/qzone/hybrid/lib/qqapi.1470836255000.js?_offline=1&max_age=36000000",i="https://wximg.gtimg.com/wxgame/wegame-v2.js",s=t.Global.isWX,n=Browser.document.createElement("script");n.onload=function(){t.Logger.log("sdk script onload")},n.onerror=function(){t.Logger.log("sdk script error")},n.src=s?i:e,n.id="sdk";var a=Browser.document.getElementsByTagName("head")[0];a.appendChild(n)},e.closeWindow=function(){t.JSUtils.closeWebView()},e.enterGame=function(){var e=location.search,i=t.JSUtils.getQueryString("replay_id");e=e.replace("&replay_id="+i,""),e=e.replace("replay_id","hasreplay"),t.Global.isWB||t.Global.isSQ?location.href="https://res.ledou.qq.com/GameShare.html"+e:(t.JSUtils.setCookie("replayover","1"),t.Global.GameMain.reload(!0))},e}();t.ShowReplay=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.init=function(e){0==t.hasInit&&(t.hasInit=!0,t.initSererTime=e,t.initBrowserTime=Browser.now()),t.offTime=6e4*((new Date).getTimezoneOffset()+480)},t.getServerTime=function(){return t.initSererTime+Browser.now()-t.initBrowserTime},t.getServerNowDate=function(){return new Date(t.getServerTime()+t.offTime)},t.getServerDateByTime=function(e){return new Date(e+t.offTime)},t.getDay0HourTime=function(e){var i=t.getServerDateByTime(e);return e-=3600*i.getHours()*1e3+60*i.getMinutes()*1e3+1e3*i.getSeconds()},t.isNowWeek=function(e){var i;if(t.getServerTime()/1e3-e>=604800)i=!0;else{var s,n=t.getServerDateByTime(1e3*e);s=0==n.getDay()?new Date(n.getFullYear(),n.getMonth(),n.getDate(),6).getTime()+864e5-t.offTime:1==n.getDay()&&n.getHours()<6?new Date(n.getFullYear(),n.getMonth(),n.getDate(),6).getTime()-t.offTime:new Date(n.getFullYear(),n.getMonth(),n.getDate(),6).getTime()-t.offTime+864e5*(8-n.getDay()),i=t.getServerTime()>s}return!i},t.hasInit=!1,t}();t.ServerClock=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.init=function(){t._instance&&null!=t._instance||(t._resVersion=Laya.Browser.window.__res_version,t._resVersion&&null!=t._resVersion&&(t._instance=new t,Laya.URL.customFormat=t.handelVersionUrl))},t.handelVersionUrl=function(e,i){if(e&&null!=e&&t._resVersion){-1!=e.indexOf("/ledoures/config")&&(e=e.replace("/ledoures/","ledoures/"));var s=t._resVersion[e];if(s&&2==s.length){var n=s[1];n&&n.length>0&&-1==e.indexOf(n)&&(e="/"+n+"/"+e+"?_offine=1")}}return e},t}();t.ResVersionControl=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){}return e.rePeat=function(){if(Stat.FPS>0){var t=Math.floor(Stat.currentMemorySize/1048576*100)/100;e.drawCallMax=Stat.drawCall>e.drawCallMax?Stat.drawCall:e.drawCallMax,e.shaderMax=Stat.shaderCall>e.shaderMax?Stat.shaderCall:e.shaderMax,e.curmMax=t>e.curmMax?t:e.curmMax,e.fpsMin=Stat.FPS<e.fpsMin?Stat.FPS:e.fpsMin,e.curm=Math.floor((e.curm*e.repeatCount+t)/(e.repeatCount+1)),e.shader=Math.floor((e.shader*e.repeatCount+Stat.shaderCall)/(e.repeatCount+1)),e.drawCall=Math.floor((e.drawCall*e.repeatCount+Stat.drawCall)/(e.repeatCount+1)),e.fps=Math.round((e.fps*e.repeatCount+Stat.FPS)/(e.repeatCount+1)),e.repeatCount++}this.loopShareReport()},e.SpeedPoint=function(t){0==e.TimeList.length&&e.TimeList.push(window.starttime),e.TimeList[t]=Date.now(),t>1&&this.SpeedUpdate()},e.init=function(){e.BeaconReport({ua:window.navigator.userAgent},100,"client"),setTimeout(function(){Stat.enable()},5e3),Laya.stage.on("qmdld_FPS_report",this,this.rePeat)},e.SpeedUpdate=function(){var i=(t.Global.isWX?t.Global.UID:t.JSUtils.getCookie("uin"),laya.utils.Browser.onIOS?"ios":"android");i=laya.utils.Browser.onMobile?i:"pc";var s="flag1=21413&flag2=1&flag3=2";if(window.performance&&window.performance.timing){var n=window.performance.timing;s+="&1="+(n.unloadEventStart-n.navigationStart),s+="&2="+(n.unloadEventEnd-n.navigationStart),s+="&3="+n.redirectStart,s+="&4="+n.redirectEnd,s+="&5="+(n.fetchStart-n.navigationStart),s+="&6="+(n.domainLookupStart-n.fetchStart),s+="&7="+(n.domainLookupEnd-n.fetchStart),s+="&8="+(n.connectStart-n.fetchStart),s+="&9="+(n.connectEnd-n.fetchStart),s+="&10="+(n.requestStart-n.fetchStart),s+="&11="+(n.responseStart-n.fetchStart),s+="&12="+(n.responseEnd-n.fetchStart),s+="&13="+(n.domLoading-n.fetchStart),s+="&14="+(n.domInteractive-n.fetchStart),s+="&15="+(n.domContentLoadedEventStart-n.fetchStart),s+="&16="+(n.domContentLoadedEventEnd-n.fetchStart),s+="&17="+(n.domComplete-n.fetchStart),s+="&18="+(n.loadEventStart-n.fetchStart),s+="&19="+(n.loadEventEnd-n.fetchStart),s+="&25="+Stat.FPS,window.performance.memory&&(s+="&27="+window.performance.memory.usedJSHeapSize/1e3),e.TimeList[1]&&(s+="&28="+(e.TimeList[1]-n.fetchStart)),e.TimeList[2]&&(s+="&29="+(e.TimeList[2]-n.fetchStart)),e.TimeList[3]&&(s+="&30="+(e.TimeList[3]-n.fetchStart))}s=encodeURIComponent(s)},e.PointReport=function(t,e){if(window._point_report_flag){if(this.ReportImg1.length<=t)for(var i=this.ReportImg1.length;t>=i;i++)this.ReportImg1.push(new Image);for(var s=location.protocol+"//isdspeed.qq.com/cgi-bin/r.cgi?flag1=7718&flag2=257&flag3="+t,n=new Date,a=n-window.starttime,i=0;i<e.length;i++)s+="&"+e[i]+"="+a;this.ReportImg1[t]=null,this.ReportImg1[t]=new Image,this.ReportImg1[t].src=s}},e.PageReport=function(t,e,i){void 0===i&&(i=12),this.pagePoints[t]||(this.pagePoints[t]=[]),this.pagePoints[t][e]=i},e.unloadReport=function(){var t=new Image,e=7;if(window._point_report_flag)for(var i=0;i<this.pagePoints.length;i++)this.pagePoints[i]&&i!=e&&(this.ReportImg1[i]=new Image,""!=this.getReportUrl(i,this.pagePoints[i])&&(this.ReportImg1[i].src=this.getReportUrl(i,this.pagePoints[i])));""!=this.getReportUrl(e,this.pagePoints[e])&&(t.src=this.getReportUrl(e,this.pagePoints[e]))},e.getReportUrl=function(t,e){for(var i=location.protocol+"//isdspeed.qq.com/cgi-bin/r.cgi?flag1=7718&flag2=257&flag3="+t,s=!1,n=0;n<e.length;n++)e[n]&&(i+="&"+n+"="+e[n],s=!0);return s?i:""},e.CheckError=function(t,i,s,n,a){if(void 0===n&&(n=null),void 0===a&&(a=null),i){var o={};o.message=t,o.url=i,o.line=s,n&&(o.column=n),a&&(o.stack=a.stack),o.ua=window.navigator.userAgent,e.errorReport(o),location.reload()}},e.testRePort=function(i,s,n){void 0===n&&(n=0),e.XHR||(e.XHR=new laya.net.HttpRequest);var a=i+"|"+s,o=t.Global.BASE_FILE,r={},h=5;if(this._TestReportList.push(a),this._TestReportList.length>h||n){o=t.Global.WebHost+t.Global.WebPath+o;var r=e.getReportData("report");r.message=JSON.stringify(this._TestReportList),e.BeaconReport({message:r.message});var l=t.CMD().GetPost(r);this.XHR.send(o+"?"+l,l,"get"),this._TestReportList=[]}},e.errorReport=function(t){this.testRePort("error",JSON.stringify(t),1),this.BeaconReport(t,102,"error")},e.loopShareReport=function(){this._shareReportData&&(e.XHR.once(laya.events.Event.COMPLETE,this,function(e){e=JSON.parse(e),0==e.result?(e.hasOwnProperty("newhandtaskinfo")&&delete e.newhandtaskinfo,t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0,"分享奖励"))):t.WeakTips.show(e.msg)}),e.XHR.send(this._shareReportData.url,this._shareReportData.data,"post"),this._shareReportData=null)},e.shareReport=function(i,s,n,a){void 0===s&&(s=""),void 0===n&&(n=0),void 0===a&&(a=0);var o=t.Global.WebHost+t.Global.WebPath+t.Global.BASE_FILE,r=e.getReportData("task");r.subcmd="Report",r.id="252",r.otherOpenid=s,r.share_from=i,n&&(r.share_type=n),a&&(r.share_id=a),e.XHR||(e.XHR=new laya.net.HttpRequest);var h=t.CMD().GetPost(r);n?(this._shareReportData={},this._shareReportData.url=o,this._shareReportData.data=h):t.XHR().Post(r,this,null)},e.getReportData=function(e){var i={};return i.uid=t.Global.UID,i.cmd=e,i.h5openid=t.Global.H5OPENID,i.h5token=t.Global.H5TOKEN,t.Global.isWX?(i.openid=t.Global.OPENID,i.access_token=t.Global.TOKEN):(i.uin=t.Global.UIN,i.skey=t.Global.SKEY),i.pf=window.pathJson?"wx2":t.Global.PF,i},e.BeaconReport=function(t,e,i){void 0===e&&(e=101),void 0===i&&(i="timeout"),window.BeaconAction&&window.BeaconAction.onEvent&&window.BeaconAction.onEvent(e,i,t)},e.TimeList=[],e.ReportImg1=[],e.fps=30,e.fpsMin=30,e.drawCall=0,e.drawCallMax=0,e.curm=30,e.curmMax=30,e.shader=0,e.shaderMax=0,e.repeatCount=1,e.pagePoints=[],e._TestReportList=[],e}();t.Report=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this._type=e.TYPE_NONE}return Object.defineProperty(e.prototype,"netWorkType",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isWifi",{get:function(){return this._type==e.TYPE_WIFI},enumerable:!0,configurable:!0}),Object.defineProperty(e,"singleton",{get:function(){return null==t.NetEvn._singleton&&(t.NetEvn._singleton=new t.NetEvn),t.NetEvn._singleton},enumerable:!0,configurable:!0}),e.prototype.run=function(){Laya.timer.loop(e.RUN_FRE,this,this.checkNetEvn,null,!0),this.checkNetEvn()},e.prototype.checkNetEvn=function(){t.JSUtils.getNetWorkType(this.callBack)},e.prototype.callBack=function(i){var s=e.singleton,n=s._type;if(window.mqq)switch(i){case-1:s._type=e.TYPE_UNKNOW;break;case 1:s._type=e.TYPE_WIFI;break;case 2:s._type=e.TYPE_2G;break;case 3:s._type=e.TYPE_3G;break;case 4:s._type=e.TYPE_4G}else if(t.Global.isWX)switch(i){case 0:s._type=e.TYPE_WIFI;break;case 1:s._type=e.TYPE_UNKNOW;break;case 2:s._type=e.TYPE_2G;break;case 3:s._type=e.TYPE_3G;break;case 4:s._type=e.TYPE_4G}s._type!=n&&t.EventCenter.singleton.event(e.EVENT_NETWORK_CHANGE)},e.EVENT_NETWORK_CHANGE="eventNetworkChange",e.TYPE_NONE=-1,e.TYPE_UNKNOW=0,e.TYPE_WIFI=1,e.TYPE_2G=2,e.TYPE_3G=3,e.TYPE_4G=3,e.RUN_FRE=4e3,e._singleton=null,e}();t.NetEvn=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.getDotNum=function(t,e){var i,s=String(t);if(-1==s.indexOf("."))i=t;else{var n=s.split("."),a=n[0],o=n[1];o=o.substr(0,e),i=Number(a+"."+o)}return i},t}();t.MathUtils=e}(hf||(hf={}));var hf;!function(t){function e(){t.Facade.callCommand(new t.WanbaBuyStarSuccessCmd)}function i(){}function s(){}var n=Laya.Browser,a=laya.events.Event,o=function(){function e(){}return e.get_Wanba_Key=function(e){0==e.code&&e.data&&e.data.openid&&e.data.openkey&&(t.Global.OPENID=e.data.openid,t.Global.H5OPENID=e.data.openid,t.Global.H5TOKEN=e.data.openkey)},e.initSDK=function(i,s){void 0===s&&(s=null),t.Logger.log("init JS SDK");var a=(t.Global.protocol+"//zone3.ledou.qq.com/v.js",n.document.createElement("script"));if(a.onload=function(){t.Logger.log("sdk script onload"),t.H5SDK.initSDK(i,s),e.initPaySDK()},window.WXAPP)window.wx.login({success:function(e){e.code?(console.log(e.code),t.Global.WXCODE=e.code,s.apply(i,[])):console.log("获取用户登录态失败！"+e.errMsg)}});else if(t.Global.isWB)window.getOpenKey?window.getOpenKey(function(e){t.JSUtils.get_Wanba_Key(e),t.JSUtils.initWanba(),s.apply(i,[])}):setTimeout(function(){t.JSUtils.initwanbakey(),t.JSUtils.initWanba(),s.apply(i,[])},20);else{a.src=t.Global.protocol+"//h5sdk.qq.com/h5game/js/h5jssdk-1.1.4.min.js?id=1",a.id="1";var o=n.document.getElementsByTagName("head")[0];o.appendChild(a)}},e.initwanbakey=function(){t.JSUtils.saveCookie(t.JSUtils.getCookie("uin"),t.JSUtils.getCookie("skey")),t.Global.H5TOKEN=t.JSUtils.getQueryString("openkey"),t.Global.H5OPENID=t.JSUtils.getQueryString("openid"),t.Global.UIN=t.JSUtils.getCookie("uin"),t.Global.SKEY=t.JSUtils.getCookie("skey"),window.OPEN_DATA&&(t.Global.OPENID=window.OPEN_DATA.openid,t.Global.H5OPENID=window.OPEN_DATA.openid,t.Global.H5TOKEN=window.OPEN_DATA.openkey)},e.initWanba=function(){t.H5SDK.ShareConf.share_url="https://res.ledou.qq.com/GameShare.html?from=305&_wv=2147674919&pf="+t.Global.PF,window.OPEN_DATA&&window.OPEN_DATA.qua&&"SQ"==window.OPEN_DATA.qua.app&&"H5.DESKTOP"==window.OPEN_DATA.via,window.getOpenKey&&window.getOpenKey(function(e){t.JSUtils.get_Wanba_Key(e)}),window.reportLogin&&window.reportLogin(),window.mqq&&(window.mqq.invoke("ui","setOnAddShortcutHandler",{callback:function(){e.addShortcut()}},!1,!0),mqq.device&&mqq.device.setScreenStatus&&mqq.device.setScreenStatus({status:1},function(t,e){console.log(e)}),e.setShareInfo(t.H5SDK.ShareConf))},e.setShareInfo=function(e,i){t.Global.isWX&&wegame?wegame.invoke("setShareInfo",e,i):t.Global.isWB&&window.mqq&&mqq.invoke("data","setShareInfo",e)},e.shareMessage=function(e,i){if(window.mqq){e.back=!0,e.sourceName=t.Global.GameName,t.Global.isWB&&(e.sourceName="空间小游戏"),n.onIOS&&(e.toUin="");var s=i;e.share_url=e.share_url+"&shareStatus=10",t.Global.isWB&&!n.onIOS&&window.OPEN_DATA&&window.OPEN_DATA.qua&&"QZ"==window.OPEN_DATA.qua.app?(setTimeout(function(){s({retCode:0,iRet:0})},500),i=function(){}):1==e.share_type&&(setTimeout(function(){s({retCode:0,iRet:0})},500),i=function(){},e.share_url=e.share_url.replace("&shareStatus=10","&shareStatus=4")),mqq.ui.shareMessage(e,function(t){i(t)})}},e.showShareMenu=function(){window.mqq&&mqq.invoke("ui","showShareMenu")},e.shareMood=function(t,i){window.mqq&&window.mqq.device&&window.mqq.device.writeMood?window.mqq.invoke("Qzone","writeMood",{text:t.title,photoList:[{url:t.image_url,width:640,height:340}]}):e.shareMessage(t,i)},e.isFromShare=function(){return!!t.H5SDK.getUrlParams("invitor")},e.isFollow=function(t,e){window.mqq&&mqq.data.isFollowUin({uin:this._publicUin},function(i){e.apply(t,[i])})},e.openQQPublic=function(){window.mqq&&mqq.invoke("ui","openUrl",{url:"https://share.mp.qq.com/cgi/share.php?uin=2253115034&account_flag=33626388&jumptype=1&card_type=public_account",target:1,style:1})},e.openQQBuluo=function(){window.mqq&&mqq.invoke("ui","openUrl",{url:"https://buluo.qq.com/cgi-bin/bar/qqgame/handle_ticket?redirect_url=https%3A%2F%2Fbuluo.qq.com%2Fmobile%2Fbarindex.html%3F%26_wv%3D1027%26from%3Dgameblog_qmdld%26bid%3D356671&sourcetype=1",target:1,style:1})},e.wxParamsFomart=function(t){for(var e={},i=0;10>i;i++)t=decodeURIComponent(t);try{return JSON.parse(t)}catch(s){return e}},e.getChannel=function(){var i;if(t.Global.isWB)i=e.getQueryString("shareStatus")?"10"==e.getQueryString("shareStatus")?10028860:10028810:"303"==t.Global.FROM?10028861:window.OPEN_DATA&&window.OPEN_DATA.qua&&"QZ"==window.OPEN_DATA.qua.app?10028862:10028320;else if("333"==t.Global.FROM)i=10029421;else if(t.H5SDK.getUrlParams("h5channel"))i=t.H5SDK.getUrlParams("h5channel");else if(t.H5SDK.getShareChannel())i=t.H5SDK.getShareChannel();else{var s=e.getQueryString("wegame_ssid");i=s?"10"==s?11:"56"==s?10027566:10027565:t.Global.isWB?10028319:t.Global.isSQ?10027557:10027566}return i},e.getShareParams=function(){var i={};if(t.Global.isWX){var s=t.JSUtils.getQueryString("wegame_params");return s?e.wxParamsFomart(s):i}if(t.Global.isWXAPP){var n=window.wx.getLaunchOptionsSync();i=n&&n.query?n.query:i,console.log(i)}return i},e.getWBMaybeQua=function(){return t.Global.isWB&&window.OPEN_DATA&&window.OPEN_DATA.qua&&window.OPEN_DATA.qua.meybeQua?window.OPEN_DATA.qua.meybeQua:"V1_AND_QZ_4.9.3_148_RDM_T"},e.addFriend=function(e,i,s,n,a,o){void 0===o&&(o=null),window.mqq&&mqq.invoke("ui","addFriend",{openId:e,appId:t.Global.appID,nickName:i,msg:s,sourceId:1,callback:mqq.callback(function(t){o&&a?o.apply(a,[t]):o&&o(t)})})},e.checkFriend=function(){t.XHR().Post({cmd:"detail",op:"friends"},this,this.setFriend)},e.setFriend=function(t){this.friendList=t.friends,this.factionList=t.fac_friends},e.isFriend=function(t){var e=0;return t+="",this.friendList.indexOf(t)>-1?e=1:this.factionList.indexOf(t)>-1&&(e=2),e},e.deleteFriend=function(t){t+="";var e=this.friendList.indexOf(t);-1!=e&&this.friendList.splice(e,1)},e.addOneFriend=function(t){t+="";var e=this.friendList.indexOf(t);-1==e&&this.friendList.push(t)},e.sdkIsReady=function(){return e._sdkReady},e.getCookie=function(e){var i=n.window.localStorage;if(null!=i){var s=i.getItem(e);if(s&&s.length>0)return s}if(!t.Global.isWXAPP){return null}return null},e.setCookie=function(e,i){if(window.localStorage&&window.localStorage.setItem(e,i),!t.Global.isWXAPP){var s=new Date;s.setTime(s.getTime()+86400)}},e.saveCookie=function(t,e){var i=new Date;i.setTime(i.getTime()+86400)},e.getQueryString=function(e){if(t.Global.isWXAPP)return null;var i=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),s=n.window.location.search.substr(1).match(i);return null!=s?decodeURIComponent(s[2]):null},e.getUserPortraitUrlBy=function(e,i){e=e.replace(/^o0*/,"");var s=parseInt(e,10),n=t.Global.protocol+"//qlogo"+(s%4+1)+".store.qq.com/qzone/"+s+"/"+s+"/"+(isNaN(i)?50:i>50?100:30>=i?30:50);return n},Object.defineProperty(e,"bbsUrl",{get:function(){var i="https://bbs.g.qq.com/forum.php?mod=forumdisplay&fid=57627&ADTAG=game.app.qmdld",s=t.Global.isWX?2:1,n=e.base64(t.Global.OPENID+","+t.Global.TOKEN+","+t.Global.appID+","+s);return i=i+"&opencode="+n+"&openid="+t.Global.OPENID+"&acctype="+{wb:1,wx:2}[t.Global.PF]},enumerable:!0,configurable:!0}),e.openBBS=function(){window.mqq?mqq.invoke("ui","openUrl",{url:e.bbsUrl,target:1,style:1}):window.WeixinJSBridge?wegame.invokeJsapi("openUrlWithExtraWebview",{url:e.bbsUrl,openType:"1"},function(t){-1===t.err_msg.indexOf(":ok")&&(window.location.href=e.bbsUrl)}):e.openUrlBox(e.bbsUrl)},e.base64=function(t){var i,s,n,a,o,r,h,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",d=0;for(t=e._utf8_encode(t);d<t.length;)i=t.charCodeAt(d++),s=t.charCodeAt(d++),n=t.charCodeAt(d++),a=i>>2,o=(3&i)<<4|s>>4,r=(15&s)<<2|n>>6,h=63&n,isNaN(s)?r=h=64:isNaN(n)&&(h=64),c=c+l.charAt(a)+l.charAt(o)+l.charAt(r)+l.charAt(h);return c},e.pay=function(e,i){if(t.Global.isSQ)if(Laya.Browser.onIOS&&window.mqq){var s="abcd",a={};a.app_id="1450012795",a.pf="qq_m_qq-2001-iap-"+s,a.pfkey="pfkey",a.product_id="com.tencent.mqq.ldh5.consumable.doudou"+e.num,a.product_type=0,a.pay_item=e.num,a.quantity=1,a.is_deposit_game_coin=1,a.var_item="aid="+s+"&appid="+a.app_id+"&product_id="+a.product_id,mqq.pay.pay(a,this.ipaCallBack)}else e.pf="wechat-2001-html5-2011-1114",e.sessionid="openid",e.sessiontype="kp_actoken",e.openid=t.Global.OPENID,e.openkey=t.Global.H5PAYTOKEN,t.Logger.log("手Q支付openid："+t.Global.OPENID),t.Logger.log("手Q支付openkey："+t.Global.H5PAYTOKEN),Midas.buyGoods(e);else t.Global.isWB?(t.Logger.log("玩吧充值：",e.num,Number(e.num)),window.popPayTips({defaultScore:Number(e.num),appid:t.Global.appID})):t.Global.isWXAPP?n.onIOS?t.WeakTips.show("暂未开放，敬请期待"):window.wx.requestMidasPayment({mode:"game",offerId:"1450013229",buyQuantity:e.num,zoneId:1,env:0,platform:"android",currencyType:"CNY",success:function(){t.Facade.callCommand(new t.WXAppPaySuccessCmd)},fail:function(t){var e=t.errMsg,i=t.errCode;console.log(e,i)}}):(e.pf="wechat-2001-html5-2011-1114",e.openid=t.Global.OPENID,e.openkey=t.Global.H5TOKEN,e.sessionid="hy_gameid",e.sessiontype="wc_actoken",e.wxAppid2="wx1fc34edbe7d4c25c",t.Logger.log("微信支付openid："+t.Global.OPENID),t.Logger.log("微信支付h5openid："+t.Global.H5OPENID),t.Logger.log("微信支付openkey_H5TOKEN："+t.Global.H5TOKEN),t.Logger.log("微信支付wxAppid2：wx1fc34edbe7d4c25c"),Midas.buyGoods(e))},e.ipaCallBack=function(e,i){0==Number(e)?t.Facade.callCommand(new t.IPABuySuccessCmd):t.WeakTips.show(i)},e.wxappReport=function(t){window.wx.gameLoginReport({data:{roleName:t.name,roleId:t.uid,userLevel:t.lvl},success:function(t){console.log("成功",t)},fail:function(t){console.log("失败",t)}}),window.wx.onShow&&window.wx.onShow(function(e){window.wx.gameLoginReport({data:{roleName:t.name,roleId:t.uid,userLevel:t.lvl},success:function(t){console.log("成功",t)},fail:function(t){console.log("失败",t)}})}),window.wx.onHide&&window.wx.onHide(function(){window.wx.gameLogoutReport({data:{roleName:t.name,roleId:t.uid,userLevel:t.lvl},success:function(t){console.log("成功",t)},fail:function(t){console.log("失败",t)}})})},e.initPaySDK=function(){var e=t.Global.protocol+"//midas.gtimg.cn/h5pay/js/api/midas.js",i=t.Global.protocol+"//qzs.qq.com/open/mobile/h5gamesdk/build/sdk.js",s=t.Global.protocol+"//qzonestyle.gtimg.cn/qzone/mobilepage/gamesBar/common/pop_pay_tips.js";if(!t.Global.isWB){var a=n.document.createElement("script");a.src=t.Global.isYYB?i:t.Global.isWB?s:e,a.id="2";var o=n.document.getElementsByTagName("head")[0];o.appendChild(a)}},e.openUrlBox=function(e){if(window.mqq)mqq.invoke("ui","openUrl",{url:e,target:1,style:1});else if(t.Global.isWXAPP)t.WeakTips.show("即将开放，敬请期待");else{var i="";if(this._openbox)this._openbox.style.display="block";else{this._openbox=n.document.createElement("div");var s=n.document.getElementById("layaContainer")?n.document.getElementById("layaContainer"):n.document.body;s.appendChild(this._openbox),this._openbox.setAttribute("id","frameBox"),this._openbox.style.width="100%",this._openbox.style.position="absolute",this._openbox.style.zIndex=999,this._openbox.style.height=n.height+"px"}console.log(n.document.getElementById("frameBox")),i+="<h5 style='height:40px;line-height:40px;font-size:20px;margin:0;background:#ccc;border:2px solid #696' onclick='hf.JSUtils.closeUrlBox()'>返回游戏</h5>",i+="<iframe src='"+e+"' style='border:0;width:100%;height:"+(n.height-44)+"px'></iframe>",this._openbox.innerHTML=i}},e.foldGame=function(){window.mqq&&mqq.compare&&mqq.compare("7.1.5")>=0&&mqq.invoke("ui","switchToMsgList",{title:"全民大乐斗",icon:"http://res.ledou.qq.com/share_icon.png",callback:mqq.callback(function(){})})},e.closeUrlBox=function(){this._openbox.style.display="none"},e._utf8_encode=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",i=0;i<t.length;i++){var s=t.charCodeAt(i);128>s?e+=String.fromCharCode(s):s>127&&2048>s?(e+=String.fromCharCode(s>>6|192),e+=String.fromCharCode(63&s|128)):(e+=String.fromCharCode(s>>12|224),e+=String.fromCharCode(s>>6&63|128),e+=String.fromCharCode(63&s|128))}return e},e.addShortcut=function(e){t.Global.isWB?mqq.ui.addShortcut({action:"web",title:"全民大乐斗空间",icon:"http://res.ledou.qq.com/page/icon/"+t.Global.PF+"_icon180.png",url:"https://h5.qzone.qq.com/app/open/"+t.Global.appID+"/home?_proxy=1&_wv=145191&via=H5.DESKTOP&from=303",callback:e}):window.mqq&&n.onIOS?mqq.ui.addShortcut({action:"web",title:t.Global.GameName,icon:t.Global.protocol+"//res.ledou.qq.com/page/icon/"+t.Global.PF+"_icon180.png",url:t.Global.protocol+"//res.ledou.qq.com/login.html?pf="+t.Global.PF+"&_wv=2147674919&h5channel=10027559&from=103",callback:e}):window.mqq?t.H5SDK.addShortcut(e):t.WeakTips.show("暂不支持该功能！")},e.setOnAddShortcut=function(){window.mqq&&mqq.invoke("ui","setOnAddShortcutHandler",{callback:mqq.callback(function(){e.addShortcut()},!1,!0)})},e.copyToClipboard=function(t,e){window.mqq&&mqq.data.setClipboard(t,e)},e.getNetWorkType=function(e){window.mqq?window.mqq.device.getNetworkType&&mqq.device.getNetworkType(e):t.Global.isWX&&e(wegame.invoke("getNetworkType"))},e.getHeadUrl=function(e,i){return void 0===i&&(i=1),e&&e.length>0?(e.replace("http:",t.Global.protocol),t.Global.isWX?e+"/96":e=e.replace(/q4/,"q2")):1==i?"ui/comp/gg.png":"ui/comp/mm.png"},e.getWXVersion=function(){return wegame.invoke("getClientVersion",!1)},e.confirmExit=function(e){var i=new t.ConfirmBoxData({isShowCancelBtn:!0,contentStr:e,callBackHandler:new Handler(this,this.closeWebView)});t.ConfirmBox.show(i)},e.closeWebView=function(){"333"==e.getQueryString("from")?window.TenvideoJSBridge.invoke("close"):window.mqq?mqq.invoke("ui","popBack"):t.Global.isWXAPP?window.wx.exitMiniProgram():t.Global.isWX?wegame.invokeJsapi("closeWindow",{},function(t){}):window.open("about:blank","_self").close()},e.onGameVisibilityChange=function(i,s){e._thisobj=i,e._hideCallBack=s,t.Global.isWB&&mqq.addEventListener?window.OPEN_DATA&&window.OPEN_DATA.qua&&"SQ"==window.OPEN_DATA.qua.app?mqq.addEventListener("qbrowserVisibilityChange",function(i){
t.Logger.log("addEventListener：手Q屏幕最大化："+JSON.stringify(i)),e._hideCallBack.apply(e._thisobj,[!i.hidden])}):n.onIOS?mqq.addEventListener("pageVisibility",function(i){t.Logger.log("addEventListener：手Q屏幕最大化："+JSON.stringify(i)),e._hideCallBack.apply(e._thisobj,[!!i.data.visible])}):mqq.addEventListener("qbrowserVisibilityChange",function(i){t.Logger.log("addEventListener：手Q屏幕最大化："+JSON.stringify(i)),e._hideCallBack.apply(e._thisobj,[!i.hidden])}):t.Global.isSP?(window.TenvideoJSBridge.on("onAppEnterForeground",function(){e._hideCallBack.apply(e._thisobj,[!0])}),window.TenvideoJSBridge.on("onAppEnterBackground",function(){e._hideCallBack.apply(e._thisobj,[!1])})):window.mqq?(n.document.addEventListener("qbrowserVisibilityChange",function(i){t.Logger.log("手Q屏幕最大化："+!i.hidden),e._hideCallBack.apply(e._thisobj,[!i.hidden])}),document.addEventListener("onAppEnterForeground",function(){e._hideCallBack.apply(e._thisobj,[!0])}),document.addEventListener("onAppEnterBackground",function(){e._hideCallBack.apply(e._thisobj,[!1])})):t.Global.isWX?wegame.on("page_state_change",function(e){t.Logger.log("微信屏幕状态："+e),"onResume"==e||"onCreate"==e?s.apply(i,[!0]):"onPause"!=e&&"onDestroy"!=e||s.apply(i,[!1])}):t.Global.isWXAPP&&(window.wx.onShow(function(t){console.log("当前显示状态开。。。。"),setTimeout(function(){s.apply(i,[!0])},3e3)}),window.wx.onHide(function(t){console.log("当前显示状态关。。。。"),s.apply(i,[!1])}),window.wx.onNetworkStatusChange(function(e){e.isConnected||t.WeakTips.show("当前网络不好，可能会影响您的正常游戏体验"),console.log(e.networkType)}),window.wx.onAudioInterruptionBegin&&window.wx.onAudioInterruptionBegin(function(t){console.log("当前显示状态关。。。。"),s.apply(i,[!1])}),window.wx.onAudioInterruptionEnd&&window.wx.onAudioInterruptionEnd(function(t){console.log("当前显示状态关。。。。"),setTimeout(function(){s.apply(i,[!0])},3e3)}),n.onAndriod&&window.wx.onWindowResize&&window.wx.onWindowResize(function(e){t.dispatch("resize")}))},e.onAddWxShortStatus=function(e,i){if(t.Global.isWX&&window.wegame){wegame.on("add_short_status",function(s){t.Logger.log("添加到桌面快捷方式状态："+s),i.apply(e,[s])});var s={"switch":"true",title_cn:"是否需要退出游戏",title_eng:"tips",ok_cn:"确定",ok_eng:"comfirm",cancel_cn:"取消",cancel_eng:"cancel"};wegame.invokeJsapi("setCloseWindowConfirmDialogInfo",s,function(t){})}},e.sharePicture=function(e,i,s){if(window.mqq){var n=null;(e instanceof Laya.Image||e instanceof Laya.Sprite)&&(n=new t.ShareCanvas,n.on(a.COMPLETE,this,function(){var e=n.source.toDataURL("image/jpeg",.8);e=e.replace("data:image/jpeg;base64,","data:image/jpg;base64,"),mqq.invoke("Qzone","sharePicture",{type:i+"",base64:e},function(e){0!=e.retCode&&t.WeakTips.show(e.msg),s(e.retCode)}),n.offAll(),n.destory(),n=null}),n.createByDisplay(e))}},e.shareScreenshot=function(e,i,s){void 0===e&&(e="乐斗图片分享"),void 0===i&&(i=null),void 0===s&&(s=null),window.mqq&&mqq.invoke("ui","shareScreenshot",{briefMsg:e,appName:t.Global.GameName,iconUrl:t.Global.protocol+"//res.ledou.qq.com/share_icon.png",actionUrl:t.Global.protocol+"//res.ledou.qq.com/login.html?_wv=2147674919&pf="+t.Global.PF+"&invitor="+t.Global.UID+"&invite_openid="+t.Global.OPENID+"&from=2&share_from=2",callback:mqq.callback(function(t){i&&s?i.apply(s,[t]):i&&i(t)})})},e.getAPPUserInfo=function(){t.Global.isWXAPP&&window.wx.getUserInfo({success:function(e){var i=e.userInfo;i.nickName;t.XHR().Post({cmd:"refresh",sub:"wxinfo",nick:i.nickName,headurl:i.avatarUrl},this,null)}})},e.CheckLogin=function(){t.Global.isWB?window.getOpenKey&&window.getOpenKey(function(i){e.get_Wanba_Key(i),t.XHR().ReLoadRequest()}):t.Global.isWXAPP?window.wx.login({success:function(e){e.code?(t.Global.WXCODE=e.code,t.XHR().Post({cmd:"refresh",sub:"token",wxcode:t.Global.WXCODE},this,function(e){t.Global.H5OPENID=e.openid,t.Global.H5TOKEN=e.token})):console.log("获取用户登录态失败！"+e.errMsg)}}):window.H5jssdk&&window.H5jssdk.checkLogin(function(e){t.Global.H5OPENID=window.H5jssdk.getCookie("h5game_openid"),t.Global.H5TOKEN=window.H5jssdk.getCookie("h5game_accesstoken"),t.Global.H5PAYTOKEN=window.H5jssdk.getCookie("h5game_paytoken"),t.XHR().ReLoadRequest()},function(t){})},e.getGroupUserGameData=function(){t.Global.isWXAPP&&window.wx.getGroupUserGameData({success:function(e){t.dispatch("wx_getGroupUserGameData",{result:0,res:e})},fail:function(e){t.dispatch("wx_getGroupUserGameData",{result:1,res:e})}})},e.StrToFuc=function(t){for(var e=t.split("."),i=e.length,s=window,n=0;i>n;n++)s=s[e[n]];return s},e.StrToRun=function(t,e){void 0===e&&(e=null);var i=this.StrToFuc(t);return e?i(e):i()},e.loadtext=function(t){var e=document.getElementById("loadtext");e&&(e.innerHTML=t)},e.openWxStat=function(){return!0},e.getWxStatFPS=function(){return Stat.FPS},e.getWxStatSprite=function(){return Stat.spriteCount},e.getWxStatDrawcall=function(){return Stat.drawCall},e._sdkReady=!1,e.friendList=[],e.factionList=[],e._publicUin=2253115034,e._hideFlag=!0,e}();t.JSUtils=o,t.__paySuccess=e,t.__payError=i,t.__payClose=s,window.__paySuccess=e,window.__payError=i,window.__payClose=s,window.openWxStat=o.openWxStat,window.getWxStatFPS=o.getWxStatFPS,window.getWxStatSprite=o.getWxStatSprite,window.getWxStatDrawcall=o.getWxStatDrawcall}(hf||(hf={}));var hf;!function(t){var e=Laya.Browser,i=function(){function i(){}return i.initSDK=function(e,s){void 0===s&&(s=null);var n={qqappid:"1105748669",wxappid:"wx1fc34edbe7d4c25c",enbaleRightDragToGoBackParams:!1,isNeedPayToken:!0,isNeeduserInfo:!0,videoLoginType:"qq",orientation:!0,wxscope:["snsapi_userinfo","snsapi_friend","snsapi_message"],isDebug:!1};t.Global.isTest?s.apply(e,[]):window.H5jssdk.init(n,function(){window.mqq&&(mqq.device.setScreenStatus({status:1},function(t,e){console.log(e)}),!t.Global.isSQ||"103"!=t.JSUtils.getQueryString("from")&&"103"!=t.JSUtils.getQueryString("frome")||mqq.ui.closeWebViews({mode:0,exclude:!0})),window.H5jssdk.checkLogin(function(n){t.Global.H5OPENID=window.H5jssdk.getCookie("h5game_openid"),t.Global.OPENID=window.H5jssdk.getCookie("h5game_openid"),t.Global.H5TOKEN=window.H5jssdk.getCookie("h5game_accesstoken"),t.Global.H5PAYTOKEN=window.H5jssdk.getCookie("h5game_paytoken"),i.ShareConf.title=t.Global.GameName,i.ShareConf.sourceName=t.Global.GameName,i.ShareConf.desc="PK好友，统一武林，就来"+t.Global.GameName+"！",i.ShareConf.timelineTitle="PK好友，统一武林，就来"+t.Global.GameName+"！",window.H5jssdk.sendDesktop({title:t.Global.GameName,icon:t.Global.protocol+"//res.ledou.qq.com/page/icon/sq_icon180.png",url:t.Global.protocol+"//res.ledou.qq.com/login.html?pf=sq&_wv=2147674919&h5channel=10027559"},function(t){},function(t){}),s.apply(e,[])},function(t){})})},i.addShortcut=function(e){window.H5jssdk.addQQGameShortcut({title:t.Global.GameName,icon:"http://res.ledou.qq.com/page/icon/sq_icon180.png",url:t.Global.protocol+"//res.ledou.qq.com/login.html?pf=sq&_wv=2147674919&h5channel=10027559&from=103"},function(t){e&&e(t)},function(){})},i.creatGroup=function(i,s,n){var a=e.onIOS?2:1,o={guildId:i.faction_id,guildName:i.faction_name,zoneId:1,platid:a,roleid:i.uid};window.H5jssdk.createQQBindGroup(o,function(t){n.apply(s,[t])},function(e){t.WeakTips.show(e.sMsg)})},i.isInGroup=function(e,i,s){var n={gc:e};window.H5jssdk.getQQGroupInfo(n,function(t){s.apply(i,[t])},function(e){t.WeakTips.show(e.sMsg)})},i.joinGroup=function(i,s,n){var a=e.onIOS?2:1,o={gc:i.group_id,guildId:i.faction_id,zoneId:1,platid:a,roleid:i.uid};window.H5jssdk.joinQQGroup(o,function(t){n.apply(s,[t])},function(e){t.WeakTips.show(e.sMsg)})},i.InitShare=function(){t.Global.isTest||t.Global.isWB||t.Global.isWXAPP||(i.ShareConf.params.invitor=t.Global.UID,i.ShareConf.share_url="https://res.ledou.qq.com/GameShare.html?_wv=2147674919&pf="+t.Global.PF+"&invitor="+t.Global.UID+"&invite_openid="+t.Global.OPENID+"&from=1&share_from=0",i.setShareInfo(i.ShareConf))},i.setShareInfo=function(e,s){window.H5jssdk.share(i.ShareConf,function(e){t.ShareModule.calllBackFun({iRet:0,retCode:0})},function(t){})},i.shareMessage=function(e,i,s){void 0===s&&(s=null),t.Logger.log("分享内容：",e.title,e.desc,e.sourceName,e.share_type),e.serviceID=e.serviceID+"",delete e.serviceID;var n=4==e.shareType?0:1,a={fopenid:e.f_openid,thumb_url:e.image_url,title:e.title,description:e.desc,url:e.share_url,game_tag:n,serviceID:e.serviceID};t.Global.isWXAPP?window.wx.shareAppMessage({title:e.desc,imageUrl:e.image_url,withShareTicket:!0,query:"foo=bar&invitor="+t.Global.UID+"&invite_openid="+t.Global.H5OPENID,success:function(t){i({retCode:0})},fail:function(){}}):1==e.share_type||t.Global.isWB||108==e.serviceID?t.JSUtils.shareMessage(t.ShareModule.shareData,function(t){i(t)}):!e.f_openid&&t.Global.isSQ?window.H5jssdk.shareMessage({title:e.title,desc:e.desc,sourceName:e.sourceName,share_url:e.share_url,image_url:e.image_url,cusTxt:e.desc,toApp:4},function(t){i({retCode:0})},function(e){"string"==typeof e?t.WeakTips.show(e):e&&e.msg?t.WeakTips.show(e.msg):t.WeakTips.show("发送失败")}):(window.H5jssdk.sendMessageToFriend(a,function(t){window.mqq||(t.retCode=t.iRet,i(t))},function(e){t.WeakTips.show(e.msg)}),t.JSUtils.shareMessage(t.ShareModule.shareData,function(t){i(t)}))},i.showShareMenu=function(){window.mqq&&mqq.invoke("ui","showShareMenu")},i.getUrlParams=function(e){if(t.Global.isWX){var i=t.JSUtils.getShareParams();return i[e]}return t.JSUtils.getQueryString(e)},i.getShareParams=function(){var e={};return t.Global.isWX&&wegame&&(e=wegame.invoke("getShareParams")),e},i.getShareChannel=function(){return window.H5jssdk&&window.H5jssdk.getShareChannel?window.H5jssdk.getShareChannel():null},i.getShareOpenid=function(){return window.H5jssdk&&window.H5jssdk.getShareOpenid?window.H5jssdk.getShareOpenid():null},i.openWindow=function(e){window.mqq?mqq.invoke("ui","openUrl",{url:e,target:1,style:1}):t.Global.isWX?window.H5jssdk.openUrlWithExtraWebview({url:e,openType:1}):t.JSUtils.openUrlBox(e)},i.closeWindow=function(){window.H5jssdk.closeWindow(function(){})},i.getCookie=function(t){var i=e.window.localStorage;if(null!=i){var s=i.getItem(t);if(s&&s.length>0)return s}return null},i.setCookie=function(t,e){window.localStorage&&window.localStorage.setItem(t,e);var i=new Date;i.setTime(i.getTime()+86400)},i.getQueryString=function(t){var i=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),s=e.window.location.search.substr(1).match(i);return null!=s?decodeURIComponent(s[2]):null},i._sdkReady=!1,i.ShareConf={image_url:"http://res.ledou.qq.com/share_icon.png",title:"全民大乐斗",sourceName:"全民大乐斗",desc:"PK好友，统一武林，就来全民大乐斗！",timelineTitle:"PK好友，统一武林，就来全民大乐斗！",wx_share_url:location.protocol+"//res.ledou.qq.com/wxShare.html",share_url:location.protocol+"//res.ledou.qq.com/GameShare.html?_wv=2147674919&pf=sq&invitor=0&invite_openid=0&from=1&share_from=0",params:{}},i}();t.H5SDK=i}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.getGreyFilters=function(){return[new Laya.ColorFilter([.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0])]},t}();t.FiltersUtils=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){}return e.formate=function(e,i){void 0===i&&(i=1);var s="",n=t.ServerClock.getServerDateByTime(1e3*e);switch(i){case 1:s=n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate();break;case 2:s=n.getFullYear()+"年"+(n.getMonth()+1)+"月"+n.getDate()+"日";break;case 3:s=n.getFullYear()+"年"+(n.getMonth()+1)+"月"+n.getDate()+"日"+n.getHours()+"时"+n.getMinutes()+"分"+n.getSeconds()+"秒";break;case 4:s=n.getFullYear()+"."+(n.getMonth()+1)+"."+n.getDate();break;case 5:s=n.getMonth()+1+"月"+n.getDate()+"日";break;case 6:s=n.getFullYear()+"年"+(n.getMonth()+1)+"月"+n.getDate()+"日  "+n.getHours()+"时"+n.getMinutes()+"分"}return s},e.subTime=function(e,i,s){void 0===e&&(e=-1),void 0===i&&(i=-1),void 0===s&&(s=1);var n,a,o="";a=0>e?Math.floor(t.ServerClock.getServerTime()/1e3):e,n=0>i?Math.floor(t.ServerClock.getServerTime()/1e3):i;var r=n-a;0>r&&(r=0);var h=86400;switch(s){case 1:var l=Math.floor(r/h),c=Math.floor(r%h/3600);o=l>0&&c>0?l+"天"+c+"时":l>0&&0>=c?l+"天":0>=l&&c>0?c+"时":"";break;case 2:var l=Math.floor(r/h),c=Math.floor(r%h/3600);o=l>0?l+"天":c>0?c+"时":"";break;case 3:var l=Math.floor(r/h),c=Math.floor(r%h/3600),d=Math.floor(r%h%3600/60);l>0&&(o=l+"天"),c>0&&(o+=c+"小时"),d>0&&(o+=d+"分钟");break;case 4:var l=Math.floor(r/h);o=l+"天";break;case 5:var l=Math.floor(r/h),c=Math.floor(r%h/3600),d=Math.floor(r%h%3600/60);o=l>0?l+"天":"0天",o+=c>0?c+"小时":"0小时",o+=d>0?d+"分":"0分"}return o},e.getTimeFomateObj=function(t){var e=Math.floor(t/86400),i=Math.floor(t%86400/3600),s=Math.floor(t%86400%3600/60),n=Math.floor(t%86400%3600%60);return{day:e,hour:i,minute:s,second:n}},e.getStrByHours=function(t){var e;return e=0>t?"永久":t>=24?t%24==0?Math.floor(t/24)+"天":Math.floor(t/24)+"天"+t%24+"时":t+"时"},e.getDaysBySecond=function(t){var e,i=t/3600;return e=i>=24?Math.floor(i/24)+"天前":"刚刚"},e.getDaysBySecond2=function(e){var i=t.ServerClock.getServerNowDate();i.setHours(0,0,0);var s,n=Math.floor(i.getTime()/1e3);if(e>=n)return"今天";var a=n-e,o=a/3600;return s=24>=o?"昨天":Math.ceil(o/24)+"天前"},e.toTimeRemaining=function(t,e){if(void 0===e&&(e="HH:NN:SS"),t=Math.max(t,0),-1!=e.indexOf("D")){var i=Math.floor(t/24/60/60/1e3);t-=24*i*60*60*1e3}if(-1!=e.indexOf("H")){var s=Math.floor(t/60/60/1e3);t-=60*s*60*1e3}if(-1!=e.indexOf("N")){var n=Math.floor(t/60/1e3);t-=60*n*1e3}var a=t/1e3;return t-=1e3*a,e=e.replace("DDDD",String("000"+i).substr(-Math.max(String(i).length,4))),e=e.replace("DDD",String("00"+i).substr(-Math.max(String(i).length,3))),e=e.replace("DD",String("0"+i).substr(-Math.max(String(i).length,2))),e=e.replace("D",String(i)),e=e.replace("HH",String("0"+s).substr(Math.min(-2,-String(s).length))),e=e.replace("H",String(s)),e=e.replace("NN",String("0"+n).substr(-2)),e=e.replace("N",String(n)),e=e.replace("SS",String("0"+a).substr(-2)),e=e.replace("S",String(a))},e.timeStrAtToday=function(e){var i=t.ServerClock.getServerNowDate(),s=e.split(":"),n=parseInt(s[0]),a=parseInt(s[1]),o=3==s.length?parseInt(s[2]):0;return i.setHours(n,a,o),i},e}();t.DateUtils=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(t,e,i,s,n){void 0===i&&(i="@"),void 0===s&&(s=1),void 0===n&&(n=null),this._txt=t,this._countNum=e,this._curNum=e,this._retStr=i,this._timeType=s,this._handler=n,this.setString()}return t.prototype.destroy=function(){Laya.timer.clear(this,this.onTime),this._txt=null,this._handler&&(this._handler.recover(),this._handler=null)},t.prototype.start=function(){Laya.timer.loop(1e3,this,this.onTime)},t.prototype.stop=function(){Laya.timer.clear(this,this.onTime)},t.prototype.onTime=function(){if(this._curNum--,this._curNum<0&&(this._curNum=0),0==this._curNum){if(Laya.timer.clear(this,this.onTime),this._handler){var t=this._handler;this._handler=null,t.run(),t.recover()}return this.setString(),void this.destroy()}this.setString()},t.prototype.setString=function(){this._txt.text&&(this._txt.text=this._retStr.replace("@",this.formateTime()))},t.prototype.formateTime=function(){var t="",e=Math.floor(this._curNum/86400),i=Math.floor(this._curNum%86400/3600),s=Math.floor(this._curNum%86400%3600/60),n=Math.floor(this._curNum%86400%3600%60);switch(this._timeType){case 1:t=e+"天"+i+"时"+s+"分"+n+"秒";break;case 2:var a,o,r;a=10>i?"0"+i:""+i,o=10>s?"0"+s:""+s,r=10>n?"0"+n:""+n,t=a+":"+o+":"+r}return t},t}();t.CountDownUtils=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){}return Object.defineProperty(e,"singleton",{get:function(){return e._singleton||(e._singleton=new e),e._singleton},enumerable:!0,configurable:!0}),e.prototype.init=function(){this._baseCheckTime=14832e8,this._isActive=!0,this.writeCookie(),t.GameSleep().AddFuc(this,this.onGameSleep)},e.prototype.onGameSleep=function(t){this._isActive=t,t?Laya.timer.clear(this,this.checkCloseWebView):Laya.timer.loop(5e3,this,this.checkCloseWebView)},e.prototype.checkCloseWebView=function(){if(t.Logger.log("成功进入检测:"+this._isActive),!this._isActive){var e=parseInt(t.JSUtils.getCookie("HFClientDoubleOpen"));e>this._baseCheckTime&&e>this._openTime&&(Laya.timer.clear(this,this.checkCloseWebView),t.JSUtils.closeWebView())}},e.prototype.writeCookie=function(){this._openTime=t.ServerClock.getServerTime(),t.JSUtils.setCookie("HFClientDoubleOpen",this._openTime)},e}();t.ClientDoubleOpen=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(t){this._bitLen=t,this.init()}return e.prototype.init=function(){this._keyMap={},this._dataArr=[],this._dataArr[0]=0,this._curIndex=0,this._curDataLen=0},e.prototype.setKey=function(e,i){this._keyMap[e]?t.Logger.log("error:BitDataSaveUtils中已经存在key："+e):i>this._bitLen?t.Logger.log("error:BitDataSaveUtils长度设置超过限制："+i+">"+this._bitLen):this._curDataLen+i>this._bitLen?(this._curIndex++,this._dataArr[this._curIndex]=0,this._curDataLen=0,this._keyMap[e]={index:this._curIndex,start:this._curDataLen,len:i},this._curDataLen+=i):(this._keyMap[e]={index:this._curIndex,start:this._curDataLen,len:i},this._curDataLen+=i)},e.prototype.setValue=function(t,e){if(this.checkKey(t)){var i=this._keyMap[t],s=Math.floor(e);this.checkValue(i.len,s)&&this.setValueToArr(i.index,s,i.start,i.len)}},e.prototype.getValue=function(t){return this.checkKey(t)?this.getValueFromArr(this._keyMap[t].index,this._keyMap[t].start,this._keyMap[t].len):0},e.prototype.setData=function(t,e){this._dataArr[t]=Math.floor(e)},e.prototype.getData=function(t){return this._dataArr[t]},e.prototype.getDataArr=function(){return this._dataArr},e.prototype.getKeyDataIndex=function(t){return this.checkKey(t)?this._keyMap[t].index:0},e.prototype.checkKey=function(e){return this._keyMap[e]?!0:(t.Logger.log("error:BitDataSaveUtils不存在key："+e),!1)},e.prototype.checkValue=function(e,i){return i>Math.pow(2,e)&&t.Logger.log("error:BitDataSaveUtils的value值过大："+i),!0},e.prototype.setValueToArr=function(t,e,i,s){var n=this._dataArr[t].toString(2).split("");n.reverse();var a=e.toString(2).split("");a.reverse();for(var o=0;i+s>o;o++)o>=i?null!=a[o-i]?n[o]=a[o-i]:n[o]="0":n[o]||"0"==n[o]||(n[o]="0");n.reverse(),this._dataArr[t]=parseInt(n.join(""),2)},e.prototype.getValueFromArr=function(t,e,i){var s=this._dataArr[t].toString(2).split("");s.reverse();for(var n="",a=e+i-1;a>=e;a--)n+=null!=s[a]?s[a]:"0";return parseInt(n,2)},e}();t.BitDataSaveUtils=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this.mIndex=0,this.mTextureDic={}}return e.getInstance=function(){return null==e.mInstance&&(e.mInstance=new t.AthlasTools),e.mInstance},e.prototype.start=function(){null==this.mSprite&&(this.mSprite=new Sprite),Laya.stage.addChild(this.mSprite),this.showNext()},e.prototype.end=function(){this.mSprite&&Laya.stage.removeChild(this.mSprite)},e.prototype.showNext=function(){null==this.mSprite&&(this.mSprite=new Laya.Sprite),Laya.stage.addChild(this.mSprite),this.mIndex++;var t=Laya.AtlasResourceManager.instance.getAtlaserCount();this.mIndex>=t&&(this.mIndex=0);var e;if(this.mTextureDic[this.mIndex])e=this.mTextureDic[this.mIndex];else{var i=Laya.AtlasResourceManager.instance.getAtlaserByIndex(this.mIndex);i&&i.texture&&(e=Laya.Texture.create(i.texture,0,0,2048,2048),this.mTextureDic[this.mIndex]=e)}e&&(this.mSprite.graphics.clear(),this.mSprite.graphics.drawRect(0,0,1024,1024,"#000000"),this.mSprite.graphics.drawTexture(e,0,0,1024,1024),this.mSprite.graphics.fillText((this.mIndex+1).toString()+"/"+t.toString(),50,50,"40px Arial","#ff0000","left"))},e}();t.AthlasTools=e}(hf||(hf={}));var hf;!function(hf){function XHR(){var t=hf.Xhr.singleton;return t}function CMD(){var t=hf.XhrCmd.singleton;return t}var Event=laya.events.Event,Xhr=function(){function Xhr(){this.times=0,this.maxTimes=3,this.isWorking=!1,this.maxTime=5e3,this.sleepTime=18e6,this.xhrList=new Array,this.netArray=[],this._xhr=new laya.net.HttpRequest}return Object.defineProperty(Xhr,"singleton",{get:function(){return null==hf.Xhr._singleton&&(hf.Xhr._singleton=new hf.Xhr),hf.Xhr._singleton},enumerable:!0,configurable:!0}),Xhr.prototype.load=function(t,e,i,s,n,a,o,r){void 0===s&&(s=null),void 0===n&&(n=!1),void 0===a&&(a=null),void 0===o&&(o=null),void 0===r&&(r=null),this.xhrList.push({url:t,thisobj:e,data:i,callBack:s,showLoadding:n,type:o,method:a,datatype:"JSON",headers:r}),this.checkList()},Xhr.prototype.Get=function(t,e,i,s){void 0===i&&(i=null),void 0===s&&(s=!1),t.uid=hf.Global.UID,hf.Global.isWX?(t.openid=hf.Global.OPENID,t.access_token=hf.Global.TOKEN):(t.uin=hf.Global.UIN,t.skey=hf.Global.SKEY),t.pf=hf.Global.PF,this.GetJson(CMD().GetUrl(t),e,i,s)},Xhr.prototype.Post=function(t,e,i,s,n){void 0===i&&(i=null),void 0===s&&(s=!0),void 0===n&&(n="");var a=t.file?hf.Global.BASE_FILE:hf.Global.BASE_FILE;a=hf.Global.WebHost+hf.Global.WebPath+a,a+="?uid="+hf.Global.UID+"&cmd="+t.cmd,n&&(a=n),t.uid=hf.Global.UID,hf.Global.isWX?(t.openid=hf.Global.OPENID,t.access_token=hf.Global.TOKEN):(t.uin=hf.Global.UIN,t.skey=hf.Global.SKEY),t.h5openid=hf.Global.H5OPENID,t.h5token=hf.Global.H5TOKEN,t.pf=window.pathJson?"wx2":hf.Global.PF;var o=CMD().GetPost(t);this.xhrList.push({url:a,data:o,req:t,thisobj:e,callBack:i,type:"text",method:"post",datatype:"JSON",showLoadding:s}),this.checkList()},Xhr.prototype.GetJson=function(t,e,i,s){void 0===i&&(i=null),void 0===s&&(s=!1),this.xhrList.push({url:t,thisobj:e,callBack:i,showLoadding:s,type:"text",method:"get",datatype:"JSON"}),this.checkList()},Xhr.prototype.PushList=function(t,e,i,s){void 0===i&&(i=null),void 0===s&&(s=!1),this.xhrList.push({url:t,thisobj:e,callBack:i,showLoadding:s,type:"text",method:"get",datatype:"JSON"})},Xhr.prototype.getText=function(t,e,i,s){void 0===i&&(i=null),void 0===s&&(s=null),this.xhrList.push({url:t,thisobj:e,callBack:i,type:"text",method:"get",datatype:"Text",headers:s}),this.checkList()},Xhr.prototype.GetPath=function(t,e,i,s){void 0===i&&(i=null),void 0===s&&(s=!1),t=hf.Global.WebHost+hf.Global.WebPath+t,this.GetJson(t,e,i,s)},Xhr.prototype.checkList=function(){this.isWorking||(Laya.timer.clear(this,this.onTimeOut),Laya.timer.clear(this,this.onSleep),this.xhrList.length>0?(this._xhr.offAll(),this.xhrList[0].showLoadding&&hf.Loading.show(),this._xhr.once(Event.PROGRESS,this,this.onHttpRequestProgress),this._xhr.once(Event.COMPLETE,this,this.onHttpRequestComplete),this._xhr.once(Event.ERROR,this,this.onHttpRequestError),Laya.timer.once(this.maxTime,this,this.onTimeOut),this.netArray.unshift({req:this.xhrList[0].req}),this.isWorking=!0,this._xhr.send(this.xhrList[0].url,this.xhrList[0].data,this.xhrList[0].method,this.xhrList[0].type)):Laya.timer.once(this.sleepTime,this,this.onSleep))},Xhr.prototype.onSleep=function(){},Xhr.prototype.onTimeOut=function(){if(this.times=this.maxTimes+1,this._xhr.offAll(),this.xhrList[0].req&&this.xhrList[0].req.needreload)delete this.xhrList[0].req.needreload,this.isWorking=!1,this.checkList(),hf.Report.testRePort("Timeout",JSON.stringify(this.netArray[0].req));else{delete this.xhrList[0].req.needreload;var t=this.xhrList[0];this.onHttpRequestError({result:1e3,errormsg:"咦？刚刚消息没有到达乐斗江湖"}),"report"!=t.req.cmd&&hf.Report.testRePort("Timeout",JSON.stringify(this.netArray[0].req))}},Xhr.prototype.onHttpRequestError=function(t){if(this.times++,this.isWorking=!1,this.times<=this.maxTimes)this.checkList();else{var e={result:2e3,msg:"咦？网络君打了个盹~~"};t.result&&(e.result=t.result),t.errormsg&&(e.msg=t.errormsg),e.msg=e.msg;var i=this.xhrList[0].callBack,s=this.xhrList[0].thisobj,n=this.xhrList.shift();0!=this.xhrList.length&&0!=this.xhrList[0].showLoadding||hf.Loading.hide();var a=this.netArray[0];a.rsp=JSON.stringify(e),!s||!i||s.hasOwnProperty("destroyed")&&0!=s.destroyed||i.apply(s,[e]),this._xhr.offAll(),this.times=0,this.checkList(),1e3!=t.result&&"report"!=n.req.cmd&&hf.Report.testRePort("ResponseError",JSON.stringify(a.req))}},Xhr.prototype.onHttpRequestProgress=function(t){},Xhr.prototype.onHttpRequestComplete=function(t){Laya.timer.frameOnce(1,this,this.RequestComplete,[t])},Xhr.prototype.ReLoadRequest=function(){this._lastXHR&&(this.xhrList.push(this._lastXHR),this.checkList())},Xhr.prototype.RequestComplete=function(e){if(this.xhrList[0]&&null!=this.xhrList[0].callBack){var _callback=this.xhrList[0].callBack,_this=this.xhrList[0].thisobj,_data=this._xhr.data;if("JSON"==this.xhrList[0].datatype){if(this._xhr.data){try{_data=JSON.parse(this._xhr.data)}catch(e){_data=eval("("+this._xhr.data+")")}hf.Util.DecodeJSONProperty("name",_data),hf.Util.DecodeJSONProperty("content",_data),hf.Util.DecodeJSONProperty("feeds",_data),hf.Util.DecodeJSONProperty("text",_data)}else _data={result:-2,msg:"很抱歉，出错了"};if(110==_data.result){var logintimes=hf.JSUtils.getCookie("_checklogin")||"0";hf.Global.reLoginTimes++,hf.JSUtils.setCookie("_checklogin",parseInt(logintimes)+1),logintimes=parseInt(logintimes)>hf.Global.reLoginTimes?logintimes:hf.Global.reLoginTimes+"",parseInt(logintimes)<3?hf.JSUtils.CheckLogin():hf.Global.isWXAPP?hf.JSUtils.confirmExit("检测到您登录失败次数过多，是否退出游戏重试？"):_data.msg="登录失败次数过多，请退出游戏稍后再试！"}else hf.JSUtils.setCookie("_checklogin",0),hf.Global.reLoginTimes=0;0!=_data.result&&this.doErrorResult(_data.result,_data.msg)}this._lastXHR=this.xhrList.shift(),0!=this.xhrList.length&&0!=this.xhrList[0].showLoadding||hf.Loading.hide();var obj=this.netArray[0];obj.rsp=this._xhr.data,!_this||!_callback||_this.hasOwnProperty("destroyed")&&0!=_this.destroyed||_callback.apply(_this,[_data]),hf.Facade.singleton.retrievePlugin(hf.PluginDef.PLUGIN_COMMON)&&hf.Facade.callCommand(new hf.RefreshRedStatusCmds(_data))}else this.xhrList.shift(),0!=this.xhrList.length&&0!=this.xhrList[0].showLoadding||hf.Loading.hide();this.isWorking=!1,this.times=0,this.checkList()},Xhr.prototype.doErrorResult=function(t,e){switch(t){case 116:hf.WeakTips.show(e);break;case 113:var i=hf.Facade.retrieveModel(hf.ModelDef.SELF_USER_MODEL);i.faction.facID=1,hf.Facade.callCommand(new hf.FactionCommand);break;case 114:var i=hf.Facade.retrieveModel(hf.ModelDef.SELF_USER_MODEL);i.faction.facID=0;var s=hf.Facade.retrieveModel(hf.ModelDef.FACTION_MODEL_SELF);s.facID=0,hf.SceneMgr.current.getSceneName()==hf.SceneDef.FACTION_SCENE&&hf.Facade.callCommand(new hf.HomeCommand);break;case 117:hf.Facade.callCommand(new hf.RefreshFactionCmd)}},Xhr._singleton=null,Xhr}();hf.Xhr=Xhr;var XhrCmd=function(){function t(){}return Object.defineProperty(t,"singleton",{get:function(){return null==hf.XhrCmd._singleton&&(hf.XhrCmd._singleton=new hf.XhrCmd),hf.XhrCmd._singleton},enumerable:!0,configurable:!0}),t.prototype.GetPost=function(t){var e="";for(var i in t)"file"!=i&&(e+="&"+i+"="+t[i]);return e=e.replace("&","")},t.prototype.GetUrl=function(t){var e=hf.Global.WebHost+hf.Global.WebPath;e+=t.file?t.file:"petpk",e+=t.cmd?"?cmd="+t.cmd:"?cmd=index";for(var i in t)"cmd"!=i&&"file"!=i&&(e+="&"+i+"="+t[i]);return e},t._singleton=null,t}();hf.XhrCmd=XhrCmd,hf.XHR=XHR,hf.CMD=CMD}(hf||(hf={}));var hf;!function(t){var e=function(){function t(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null),this._socket=t,this._loadFun=e,this._endFun=i,this._msgSending=!1}return t.prototype.destroy=function(){this._loadFun=null,this._endFun=null},t.prototype.send=function(t,e,s){var n=new i(t,e,s);this._tailNode?(this._tailNode.nextNode=n,n.preNode=this._tailNode,this._tailNode=n):this._tailNode=this._headNode=n,this.sendNode()},t.prototype.sendNode=function(){this._headNode&&!this._msgSending&&(this._msgSending=!0,this._loadFun&&this._loadFun())},t.prototype.onTimeOut=function(){this._linkTime=1},t.prototype.onReconnet=function(){console.log("重连成功"),this._msgSending=!1,this.sendNode()},t.prototype.onConnetError=function(){console.log("重连失败"),this._linkTime<=2&&this._linkTime++},t.prototype.onMsgReceive=function(t){Laya.timer.clear(this,this.onTimeOut),this._headNode&&(this._msgSending=!1,this._headNode.caller&&this._headNode.listener&&this._headNode.listener.call(this._headNode.caller,t),this._headNode.nextNode?(this._headNode.nextNode.preNode=null,this._headNode=this._headNode.nextNode):(this._headNode=null,this._tailNode=null),this._endFun&&this._endFun()),this.sendNode()},t}();t.SocketJson=e;var i=function(){function t(t,e,i){this.data=t,this.caller=e,this.listener=i}return t}()}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){}return Object.defineProperty(e,"socketConnect",{get:function(){return!(!e._socket||!e._socket.isConnected())},enumerable:!0,configurable:!0}),e.init=function(){var i=t.Global.WebHost;i=i.replace("https","wss"),i=i.replace("http","wss");var s=0;if(s=Browser.onIOS?102:101,t.Global.isTest)e.connect(i+":8080?account_value="+t.Global.UID+"&account_type=1&appid="+t.Global.appID+"&token="+t.Global.H5TOKEN+"&client_type="+s,8080,e,e.onMsg,e.onConnet,e.onError);else{var n=1;t.Global.isWX?n=4098:t.Global.isSQ?n=4099:t.Global.isWB&&(n=4001),t.Global.isWXAPP?(n=4098,e.connect("wss://zonel4.ledou.qq.com/?account_value="+t.Global.H5OPENID+"&account_type="+n+"&appid="+t.Global.appID+"&token="+t.Global.H5TOKEN+"&client_type="+s,8080,e,e.onMsg,e.onConnet,e.onError)):e.connect(i+":8080?account_value="+t.Global.H5OPENID+"&account_type="+n+"&appid="+t.Global.appID+"&token="+t.Global.H5TOKEN+"&client_type="+s,8080,e,e.onMsg,e.onConnet,e.onError)}},e.connect=function(i,s,n,a,o,r){e._isConnetting||(e._isConnetting=!0,e._socket?e._socket.reconnect():(e._socket=new t.SocketConnector,e._socket.connect(i,s,n,a,o,r)))},e.onConnet=function(){console.log("SOCKET连成功"),Laya.timer.loop(3e4,e,e.socketHeartMsg),e._isConnetting=!1,t.Loading.hide(),e.tempData&&(e.sendData(e.tempData),e.tempData=null)},e.close=function(){e._socket&&e._socket.close()},e.onError=function(){e._isConnetting=!1,t.Loading.hide(),console.log("SOCKET连接错误")},e.onMsg=function(i){if("string"==typeof i)if("H"==i)e.heartMsgRet();else{try{var s=JSON.parse(i)}catch(n){t.Report.errorReport({title:"SOCKET--JSON解析错误",content:i});var s={result:-1,msg:"JSON解析错误"}}t.MessageDispather.DoMsg(s.protoid,s)}else t.Logger.log("SOCKET数据格式错误")},e.socketHeartMsg=function(){return e.socketConnect?(Laya.timer.once(3e3,e,e.onHeartTimeOut),void e._socket.send("H")):void console.log("SOCKET未连接")},e.onHeartTimeOut=function(){e._socket&&e._socket.close()},e.heartMsgRet=function(){Laya.timer.clear(e,e.onHeartTimeOut)},e.sendData=function(i){return e._isConnetting?void 0:e.socketConnect?void e._socket.send(JSON.stringify({params:i})):(e.tempData=i,t.Loading.show(),void e.init())},e}();t.SocketFacade=e}(hf||(hf={}));var hf;!function(t){var e=Laya.Event,i=Laya.Socket,s=function(){function t(){this._isConnected=!1,this.lastSendTime=0,this._socket=new i}return t.prototype.isConnected=function(){return this._isConnected},t.prototype.connect=function(t,i,s,n,a,o){this._OnConnectFunc=a,this._OnErrorFunc=o,this._OnMsg=n,this._callBackThis=s,this._url=t,this._port=i,this._socket.endian=Laya.Socket.LITTLE_ENDIAN,this._socket.on(e.OPEN,this,this.OnConnect),this._socket.on(e.CLOSE,this,this.onSocketClose),this._socket.on(e.MESSAGE,this,this.parseData),this._socket.on(e.ERROR,this,this.OnError),this._socket.connectByUrl(t)},t.prototype.reconnect=function(){this._url&&this._socket.connectByUrl(this._url)},t.prototype.onSocketClose=function(){this._isConnected=!1,console.log("关闭SOKET")},t.prototype.close=function(){null!=this._socket&&this._socket.connected&&this._socket.connected&&(this._socket.close(),this.onSocketClose())},t.prototype.send=function(t){return this._socket.connected?(this._socket.send(t),!0):(console.log("服务器连接已断开"),!1)},t.prototype.OnError=function(t){console.log("connect error_"+t.toString()),this._isConnected=!1,this._OnErrorFunc?this._OnErrorFunc.call(this._callBackThis,t):this._OnErrorFunc(t)},t.prototype.OnConnect=function(t){this._isConnected=!0,this._OnConnectFunc&&(this._callBackThis?this._OnConnectFunc.call(this._callBackThis):this._OnConnectFunc())},t.prototype.parseData=function(t){Laya.timer.frameOnce(1,this,this.delayCallBack,[t],!1)},t.prototype.delayCallBack=function(t){this._OnMsg&&(this._callBackThis?this._OnMsg.call(this._callBackThis,t):this._OnMsg(t))},t}();t.SocketConnector=s}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.MSG_FACTION_RECORD=1,t.MSG_FACTION_TALK_GET=2,t}();t.MsgId=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.prototype.Read=function(t){return!0},t.prototype.Write=function(t){return!0},
t}();t.BaseMessage=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){}return e.Register=function(e,i,s){if(null!=t.MessageDispather.protoDealTable[e])return console.log("注册同一个协议重复了！"),!1;var n={};return n.func=s,n.thisObj=i,t.MessageDispather.protoDealTable[e]=n,!0},e.Remove=function(e){t.MessageDispather.protoDealTable[e]=null},e.DoMsg=function(e,i){var s=t.MessageDispather.protoDealTable[e];return null==s?(console.log("ID为"+e+"的消息找不到对应的类处理"),!1):(s.func.call(s.thisObj,i),!0)},e.protoDealTable={},e}();t.MessageDispather=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(t,e){this.proto=0,this.proto=t,this.bytes=e}return t}();t.BufferNode=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){}return e.request=function(e,i,s,n){var a=t.RequestPool.gi().borrow();a.open(e,i,function(i){t.Logger.log("Servic,Succes:"+e),t.RequestPool.gi().free(a),s(i)},function(e){t.RequestPool.gi().free(a),null!=n&&n(e)})},e.USER_DATA="http://www.snowkit.cn/testuser.php",e}();t.Service=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this._list=[]}return e.prototype.borrow=function(){return t.Logger.log("borrow a request."),this._list.length<=0&&this._list.push(new t.Request),this._list.shift()},e.prototype.free=function(e){t.Logger.log("free a request."),this._list.push(e)},e.gi=function(){return null==t.RequestPool._instance&&(t.RequestPool._instance=new t.RequestPool),t.RequestPool._instance},e._instance=null,e}();t.RequestPool=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.prototype.initialize=function(){},t.prototype.SetShopData=function(t){this.m_shopMap=t},t.prototype.GetShopData=function(){return this.m_shopMap},t.prototype.getDouDou=function(){return this.m_shopMap.doudou},t.prototype.getShopGoods=function(t){for(var e=this.m_shopMap.commodity_info,i=e[0],s=0;s<e.length;s++)if(parseInt(e[s].id)==parseInt(t))return i=e[s];return i},t}();t.ShopMgr=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this._viewMap={},this._regMap={},this._curViews=[],this.regViews()}return e.prototype.regViews=function(){this._regMap[t.MarryViewType.TYPE_VIEW_MAIN]=t.MarryMainView,this._regMap[t.MarryViewType.TYPE_VIEW_QIU_HUN]=t.QiuHunView,this._regMap[t.MarryViewType.TYPE_VIEW_SONG_HUA]=t.SongHuaView},e.prototype.showView=function(t,e){void 0===e&&(e=null);var i=this._viewMap[t];if(!i){var s=this._regMap[t];i=new s,this._viewMap[t]=i}i.showWithData(e),this._curViews.push(i)},e.prototype.hideView=function(t){var e=this._viewMap[t];e&&(e.hide(),this._curViews.splice(this._curViews.indexOf(e),1)),0==this._curViews.length&&this.destroyRes()},e.prototype.updateView=function(t){var e=this._viewMap[t];e&&e.update()},e.prototype.destroyRes=function(){Laya.loader.clearRes("res/atlas/ui/marry.json"),Laya.loader.clearRes("ui/marry/img_ybk.png"),Laya.loader.clearRes("ui/marry/img_zbk.png"),Laya.loader.clearRes("ui/marry/img_bg.jpg")},Object.defineProperty(e.prototype,"module",{get:function(){return this._moduel||(this._moduel=t.Facade.singleton.retrievePlugin(t.PluginDef.PLUGIN_MARRY)),this._moduel},enumerable:!0,configurable:!0}),e}();t.MarryViewMrg=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this._queryCallBack=null,this._recodeCallBack=null,this._proposeCallBack=null,this._refuseCallBack=null,this._agreeCallBack=null,this._targetCallBack=null,this._titleCallBack=null}return e.prototype.query=function(e){void 0===e&&(e=null),t.XHR().Post({file:"petpk",cmd:"marry",op:"page",uid:t.Global.UID},this,this.onQuery),this._queryCallBack=e},e.prototype.onQuery=function(e){this.queryData=e,0==e.result?this._queryCallBack&&(this._queryCallBack.runWith(e),this._queryCallBack=null):t.WeakTips.show(e.msg)},e.prototype.record=function(e){void 0===e&&(e=null),t.XHR().Post({file:"petpk",cmd:"marry",op:"record",uid:t.Global.UID},this,this.onRecode),this._recodeCallBack=e},e.prototype.onRecode=function(e){this.recordData=e,0==e.result?this._recodeCallBack&&(this._recodeCallBack.runWith(e),this._recodeCallBack=null):t.WeakTips.show(e.msg)},e.prototype.propose=function(e,i){void 0===e&&(e=null),t.XHR().Post({file:"petpk",cmd:"marry",op:"propose",target_uid:i,uid:t.Global.UID},this,this.onPropose),this._proposeCallBack=e},e.prototype.onPropose=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),this._proposeCallBack&&(this._proposeCallBack.runWith(e),this._proposeCallBack=null)):t.WeakTips.show(e.msg)},e.prototype.refuse=function(e,i){void 0===e&&(e=null),t.XHR().Post({file:"petpk",cmd:"marry",op:"refuse",target_uid:i,uid:t.Global.UID},this,this.onRefuse),this._refuseCallBack=e},e.prototype.onRefuse=function(e){0==e.result?this._refuseCallBack&&(this._refuseCallBack.runWith(e),this._refuseCallBack=null):t.WeakTips.show(e.msg)},e.prototype.agree=function(e,i){void 0===e&&(e=null),t.XHR().Post({file:"petpk",cmd:"marry",op:"agree",target_uid:i,uid:t.Global.UID},this,this.onAgree),this._agreeCallBack=e},e.prototype.onAgree=function(e){if(0==e.result){var i=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);i.marryStatus=2,this._agreeCallBack&&(this._agreeCallBack.runWith(e),this._agreeCallBack=null)}else t.WeakTips.show(e.msg)},e.prototype.target=function(e,i){void 0===e&&(e=null),t.XHR().Post({file:"petpk",cmd:"marry",target_uid:i,uid:t.Global.UID},this,this.onTarget),this._targetCallBack=e},e.prototype.onTarget=function(e){this.targetData=e,0==e.result?this._targetCallBack&&(this._targetCallBack.runWith(e),this._targetCallBack=null):t.WeakTips.show(e.msg)},e.prototype.title=function(e){void 0===e&&(e=null),t.XHR().Post({file:"petpk",cmd:"marry",op:"conf",uid:t.Global.UID},this,this.onTitle),this._titleCallBack=e},e.prototype.onTitle=function(e){this.titleData=e,0==e.result?this._titleCallBack&&(this._titleCallBack.runWith(e),this._titleCallBack=null):t.WeakTips.show(e.msg)},e}();t.MarryDataMrg=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){}return e.setHead=function(e,i){e.img_icon.skin="",e.img_icon.skin=t.JSUtils.getHeadUrl(i.headimg,i.sex),e.tf_vip.text=i.vip_lvl+"",2==i.sex?(e.img_nv.visible=!0,e.img_nan.visible=!1):(e.img_nv.visible=!1,e.img_nan.visible=!0)},e}();t.MarryUtils=e}(hf||(hf={}));var hf;!function(t){var e=laya.utils.Dictionary,i=function(){function i(){}return i.prototype.initialize=function(){var i=t.Global.getRes(t.ConfigDef.LILIAN_CONF);this.m_sceneInfoMap=new e;for(var s,n=i.items.length,a=0;n>a;a++)s=new t.SceneInfo(i.items[a]),this.m_sceneInfoMap.set(s.id,s);this.m_gkMap=new e,this.mapData=new e},i.prototype.setLilianData=function(e){this._mode=e.userinfo.thisdup<1e3?0:1,t.Global.lilianMode=this._mode,0==this._mode?this.curDup=e.userinfo.curdup:this.maxHeroDup=e.userinfo.curdup,this.mapData.set(e.userinfo.thisdup,e.userinfo.info),this.max_energy=e.max_energy},i.prototype.getGkData=function(t){return this.mapData.get(Number(t))},i.prototype.isMaxGk=function(t,e){var i=this.mapData.get(t);return t==this.curDup&&i.curlevel==e},i.prototype.getStar=function(t,e){var i=this.mapData.get(t);if(i){var s=i.levelmap[e];return s?Number(s.star):0}return 0},i.prototype.changeGiftState=function(t,e){var i=this.mapData.get(t);i.giftstatus[e-1]=2},i.prototype.getSceneInfoById=function(t){return this.m_sceneInfoMap.get(t)},i.prototype.getGkInfo=function(t,e){return this.m_gkMap.get(t+"_"+e)},i.prototype.getNpcResId=function(e){if(0==e)return"";var i=t.configMgr().getNpcInfoById(e);return i.looks||""},i.prototype.setGkData=function(t,e,i){this.m_gkMap.set(t+"_"+e,i)},i.prototype.removeGkData=function(t,e){this.m_gkMap.remove(t+"_"+e)},Object.defineProperty(i.prototype,"mode",{get:function(){return this._mode},set:function(t){this._mode=t},enumerable:!0,configurable:!0}),i}();t.LilianMgr=i}(hf||(hf={}));var hf;!function(t){var e=function(){function t(t){this._data=t}return Object.defineProperty(t.prototype,"id",{get:function(){return this._data.id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._data.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scene",{get:function(){return this._data.scene},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"file",{get:function(){return this._data.file},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gift",{get:function(){return this._data.gift||[]},enumerable:!0,configurable:!0}),t.prototype.getStarByGiftIndex=function(t){var e=this.gift[t];return Number(e?e.star:0)},t}();t.SceneInfo=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(t){this._data=t}return Object.defineProperty(t.prototype,"id",{get:function(){return this._data.id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._data.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"desc",{get:function(){return this._data.desc||""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return Number(this._data.pos_x)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return Number(this._data.pos_y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"npcId",{get:function(){return this._data.npc_id.split(",")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBoss",{get:function(){return"1"==this._data.isboss},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"plotId",{get:function(){return this._data.plot_id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"giftbag",{get:function(){return this._data.giftbag},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stamina",{get:function(){return this._data.stamina},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lefthp",{get:function(){return this._data.lefthp},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"round",{get:function(){return this._data.round},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resId",{get:function(){return this._resId},set:function(t){this._resId=t},enumerable:!0,configurable:!0}),t}();t.GuankaInfo=e}(hf||(hf={}));var hf;!function(t){var e=laya.utils.Dictionary,i=function(){function i(){}return i.initialize=function(){this.m_actionMap=new e;for(var t,i=Laya.loader.getRes("config/change72.json"),s=0;s<i.length;s++)t=i[s],this.m_actionMap.set(t.id,t)},i.getNpcUrlByIndex=function(t){return this.m_actionMap.get(t)},i.getActNameById=function(t){return["","act_enter","act_cast","act_win","act_lose"][t]},i.getRandomWord=function(){var e=t.Global.isBoy?i.WORDS_B:i.WORDS_G,s=Math.floor(Math.random()*e.length);return e[s]},i.WORDS_B=["小样儿~来戳我啊！","今天天气好晴朗，处处好风光♫~","鄙鹅自幼习武，身手敏捷，你能抓住我？","蓝瘦~香菇~还不快来抱抱本宝宝！？","没事别找我，有事更不要找我~","本宝宝没吃饱，完全没力气减肥了~","我的鹅生追求就是武林大会！","要想升级快，好友加起来！","要想体力多，好友不嫌多！","经脉强劲才能百战百胜~","我觉得我的武器应该强化一下~","我觉得我很帅，但帅得还不明显。","钱不是问题，问题是没钱。","冰冻三尺非一日之寒，肚腩三层非一日之馋。"],i.WORDS_G=["小样儿~来戳我啊！","今天天气好晴朗，处处好风光♫~","鄙鹅自幼习武，身手敏捷，你能抓住我？","蓝瘦~香菇~还不快来抱抱本宝宝！？","没事别找我，有事更不要找我~","本宝宝没吃饱，完全没力气减肥了~","我的鹅生追求就是武林大会！","要想升级快，好友加起来！","要想体力多，好友不嫌多！","经脉强劲才能百战百胜~","我觉得我的武器应该强化一下~","别乱摸我，摸坏了你赔不起！","我人见人爱，花见花开，车见车爆胎！","瘦百搭，胖白搭。"],i}();t.Interactive=i}(hf||(hf={}));var hf;!function(t){var e=Laya.Dictionary,i=function(){function i(){}return i.show=function(e,s,n){void 0===n&&(n=null),i.tips||(i.tips=new ui.hangup.TipsUI),n?n.addChild(i.tips):t.LayerMgr.addChild(i.tips,t.Layer.WEAK_TIP);var a=e.item?e.item:e;i.tips.quality.skin="ui/hangup/quality_"+a.quality+".png",i.tips.icon.skin=t.ResPath().getHangupPic(a.itemid,a.level),i.tips.tfName.text=a.name,i.tips.tfLevel.text="等级："+a.level,i.tips.tfPower.text="战力："+a.fightpower,i.tips.tfType.text="类型："+i.NAMES[a.slotid],i.tips.tfQuality.text="品质："+i.QUALITY_WORDS[a.quality],i.tips.klB.visible=1==a.sex,i.tips.klG.visible=2==a.sex,i.tips.visible=!0,e.item||i.deal(e);for(var o,r=e.map0,h="",l=0;l<r.keys.length&&4>l;l++)o=r.keys[l],"挂机效率"!=o?h+=o+"+"+r.get(o)+"   ":i.tips.attr0.text=o+"+"+r.get(o);i.tips.attr1.text=h;var c=i.tips.tipsBox.height;i.tips.tipsBox.x=s.x+40-t.LayerMgr.offX,i.tips.tipsBox.y=s.y+40-t.LayerMgr.offY,i.tips.tipsBox.y+c>Laya.stage.height-50&&(i.tips.tipsBox.y-=i.tips.tipsBox.y+c-(Laya.stage.height-50)),i.tips.tipsBox.x+i.tips.tipsBox.width>Laya.stage.width-50&&(i.tips.tipsBox.x-=i.tips.tipsBox.x+i.tips.tipsBox.width-(Laya.stage.width-50)),i.nowTween&&(Laya.Tween.clear(i.nowTween),i.nowTween=null),i.tips.alpha=1,i.tips.visible=!0,i.nowTween=Laya.Tween.to(i.tips,{alpha:0},1e3,null,Handler.create(this,this.tweenComplete),5500)},i.deal=function(t){for(var i=new e,s=t.effect,n=""==s?[]:s.split(" "),a=0;a<n.length;a++){var o=n[a].split("+");i.set(o[0],o[1])}t.map0=i},i.tipsClose=function(){i.tips&&(i.tips.visible=!1,i.tips.removeSelf())},i.tweenComplete=function(){i.tips.alpha=1,i.tips.visible=!1,i.nowTween=null},i.NAMES=["","帽子","围巾","衣服","鞋子","武器","饰品"],i.QUALITY_WORDS=["","粗糙","普通","精良","稀有","极品"],i}();t.HangupTip=i}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){}return e.share=function(e,i,s,n,a){if(void 0===a&&(a=null),Browser.onIOS&&!t.Global.isWX&&!t.Global.isWB&&window.mqq&&mqq.support("mqq.Qzone.sharePicture"))t.JSUtils.sharePicture(s,i,function(e){0==e?t.WeakTips.show("分享成功！"):t.WeakTips.show("分享失败:"+e),a&&a(e)});else{var o=12==e||13==e?108:0;t.ShareModule.shareMessage({title:n.title,desc:n.desc,share_type:i,image_url:n.image_url,tips:n.tips,back:!0,serviceID:o,alertType:10},Handler.create(this,a),e)}},e.SHARE_CODE_JIAOSE=11,e.SHARE_CODE_CHANGJING=12,e.SHARE_CODE_LILIAN=13,e.SHARE_CODE_WUQI=14,e.SHARE_CODE_JINENG=15,e}();t.HandbookShareUtil=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this._queryCallBack=null,this._reportCallBack=null,this._unlockCallBack=null,this._awardCallBack=null,this._descCallBack=null}return Object.defineProperty(e,"singleton",{get:function(){return null==t.HandbookNet._singleton&&(t.HandbookNet._singleton=new t.HandbookNet),t.HandbookNet._singleton},enumerable:!0,configurable:!0}),e.prototype.query=function(e){void 0===e&&(e=null),t.XHR().Post({file:"petpk",cmd:"handbook",op:"page",uid:t.Global.UID},this,this.onQuery),this._queryCallBack=e},e.prototype.onQuery=function(e){0==e.result?(this.setQueryData(e),this._queryCallBack&&(this._queryCallBack(e),this._queryCallBack=null)):t.WeakTips.show(e.msg)},e.prototype.changjingReport=function(e,i,s){void 0===s&&(s=null),t.XHR().Post({file:"petpk",cmd:"handbook",op:"add",ext:e+"|"+i+"|0",uid:t.Global.UID},this,this.onReport),this._reportCallBack=s},e.prototype.onReport=function(e){0==e.result?(this.setQueryData(e),this._reportCallBack&&(this._reportCallBack(e),this._reportCallBack=null)):t.WeakTips.show(e.msg)},e.prototype.unlock=function(e,i,s){void 0===s&&(s=null),t.XHR().Post({file:"petpk",cmd:"handbook",op:"unlock",type:e,id:i,uid:t.Global.UID},this,this.onUnlock),this._unlockCallBack=s},e.prototype.onUnlock=function(e){0==e.result?this._unlockCallBack&&(this._unlockCallBack(e),this._unlockCallBack=null):t.WeakTips.show(e.msg)},e.prototype.award=function(e,i,s){void 0===s&&(s=null),t.XHR().Post({file:"petpk",cmd:"handbook",op:"award",type:e,id:i,uid:t.Global.UID},this,this.onAward),this._awardCallBack=s},e.prototype.onAward=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0,"分享奖励")),this._awardCallBack&&(this._awardCallBack(e),this._awardCallBack=null)):t.WeakTips.show(e.msg)},e.prototype.setQueryData=function(t){for(var e=t.lists,i=0;i<e.length;i++){var s=e[i],n=s.attrs;s.red=0,s.total=0,s.count=0;for(var a=0;a<n.length;a++){var o=n[a];o.red=0,1==o.status&&(s.red=1,o.red=1),o.status>=1&&(2==i&&1==o.star?s.count=s.count+2:s.count=s.count+1),2==i?s.total=s.total+2:s.total=s.total+1}}this.queryData=t},e.prototype.getStatus=function(t,e){for(var i=this.queryData.lists,s=0;s<i.length;s++){var n=i[s];if(n.type==t)for(var a=n.attrs,o=0;o<a.length;o++){var r=a[o];if(r.id==e)return r.status}}return 0},e.prototype.desc=function(e,i,s,n){void 0===e&&(e=null),t.XHR().Post({cmd:"cfgout",subcmd:i,lvl:n,id:s},this,this.onDesc),this._descCallBack=e},e.prototype.onDesc=function(e){0==e.result?this._descCallBack&&(this._descCallBack(e),this._descCallBack=null):t.WeakTips.show(e.msg)},e}();t.HandbookNet=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(e,i){this.url=t.Global.ResPath+"effect/effect_xuanzhong.sk",this.m_selected=!1,this.m_ui=e,this.m_index=i,this.m_ui.on(Laya.Event.CLICK,this,this.onClick),this.sk=new t.AnimationSKe(this.url),this.m_ui.back.addChild(this.sk),this.sk.x=this.sk.y=77}return e.prototype.setData=function(e,i){if(this.m_data=e,this.selected=i,this.m_ui.redDot.visible=!1,null==this.m_data)this.m_ui.lock.visible=!0,this.m_ui.bg.visible=!1,this.m_ui.btnAdd.visible=!1,this.m_ui.desc1.visible=!0,this.m_ui.desc2.visible=!1,this.m_ui.desc3.visible=!1,this.m_ui.desc4.visible=!1,this.m_ui.tfvalue1.text="40级开放",this.m_ui.tfvalue1.color="#c0ff33",this.m_ui.kuang_1.visible=1==this.m_index,this.m_ui.kuang_2.visible=3==this.m_index,this.m_ui.mouseEnabled=!1;else{if(this.m_ui.mouseEnabled=!0,this.m_ui.lock.visible=!1,this.m_ui.kuang_1.visible=1!=this.m_data.gem_type,this.m_ui.kuang_2.visible=1==this.m_data.gem_type,this.m_ui.bg.visible=this.m_selected,0==this.m_data.gem_id)this.m_ui.icon.skin="",this.m_ui.desc1.visible=!0,this.m_ui.desc2.visible=!1,this.m_ui.desc3.visible=!1,this.m_ui.desc4.visible=!1,this.m_ui.tfvalue1.text="可镶嵌"+(this.m_data.gem_type==t.GemConst.ATTACK?"进攻":"防守")+"魂珠",this.m_ui.tfvalue1.color="#c0ff33",this.m_ui.btnAdd.visible=!0;else{this.m_ui.icon.skin=t.ResPath().getPic(this.m_data.icon_id,t.ResourcePath.PATH_GOODS),this.m_ui.btnAdd.visible=!1;var s=this.m_data.gem_attr.split(" ");this.m_ui.tfvalue1.color="#f5e167",this.m_ui.tfvalue2.color="#f5e167",this.m_ui.tfvalue3.color="#f5e167",this.m_ui.tfvalue4.color="#f5e167";for(var n=1;n<=s.length;n++)this.m_ui["desc"+n].visible=!0,this.m_ui["tfvalue"+n].text=s[n-1];for(var n=s.length+1;4>=n;n++)this.m_ui["desc"+n].visible=!1}this.m_ui.redDot.visible=this.m_data.canUpgrade&&this.m_data.gem_level<10||this.m_data.canEquip}},e.prototype.onClick=function(){if(this.selected){if(0!=this.m_data.gem_id){var e=new t.GemOpCmd;e.op=e.TAKE_OFF,e.pos=this.m_ui.icon.localToGlobal(new laya.maths.Point(0,0)),t.Facade.callCommand(e)}}else{var e=new t.GemOpCmd;e.op=e.SLOT_SELECTED,e.params=[this.m_index,this.m_data],t.Facade.callCommand(e)}},Object.defineProperty(e.prototype,"selected",{get:function(){return this.m_selected},set:function(t){this.m_selected=t,this.m_ui.bg.visible=this.m_selected,this.m_selected?(this.sk.play(0,!0),this.sk.visible=!0):(this.sk.stop(),this.sk.visible=!1)},enumerable:!0,configurable:!0}),e.prototype.getPoint=function(){return this.m_ui.icon.localToGlobal(new laya.maths.Point(0,0))},e.prototype.destroy=function(){this.sk&&(this.sk.removeSelf(),this.sk.destroy()),this.m_ui.destroy(),this.m_ui=null},e}();t.SpotItem=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){}return e.getSkill=function(e,i,s,n,a){return 48==e?new t.StrikeLuckySkill(i,s,n,a):16==e?new t.ToppleMountainsSeaSkill(i,s,n,a):56==e?new t.FlyFairySkill(i,s,n,a):90==e?new t.QymmSkill(i,s,n,a):e>=97&&100>=e||e>=107&&110>=e||e>=112&&115>=e||10003==e||10004==e||10005==e?new t.MonsterSkill(i,s,n,a):200040==e?new t.LlhgWeaponSkill(i,s,n,a):new t.NormalSkill(i,s,n,a)},e}();t.SkillFactory=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(t,e,i,s){this._fighter=t,this._labelHandler=e,this._stopHandler=i,this._data=s}return t.prototype.destroy=function(){this._fighter=null,this._data=null},t}();t.BaseSkill=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){}return e.getFighter=function(e,i){return 0==e?new t.QQFighter(i,t.FightUIView.playerLayer):501==e||502==e||503==e||504==e?new t.SnakeBossFighter(i,t.FightUIView.bottomLayer,e):new t.NPCFighter(i,t.FightUIView.playerLayer)},e}();t.FighterFactory=e}(hf||(hf={}));var hf;!function(t){var e=laya.display.Text,i=laya.utils.Ease,s=laya.utils.Tween,n=function(){function n(){this.beginStr=["3","2","1","开"],this.soundArr=["fight_num","fight_num","fight_num","ready"],this.beginIndex=0,this._word=new t.ImageWord("assets/word/start/"),Laya.stage.addChild(this._word),this.setup()}return n.prototype.setup=function(){this._word.showWord(this.beginStr[this.beginIndex]),this._word.y=0,this._word.x=(t.LayerMgr.width-this._word.imgWidth)/2+t.LayerMgr.offX;var e=(t.LayerMgr.clientHeight-this._word.imgHeight)/2;s.to(this._word,{y:e},1e3/t.FightController.TIME_SCALE,i.elasticOut,Laya.Handler.create(this,this.completeCallBack))},n.prototype.completeCallBack=function(){this.beginIndex++,this.beginIndex<this.beginStr.length?this.setup():(Laya.stage.removeChild(this._word),t.dispatch(t.FightStaticStr.READY_FIGHT_START))},n.prototype.createLetter=function(i){var s=new e,n=350,a=t.LayerMgr.width-n>>1;return s.text=i,s.color="#FFFF00",s.width=350,s.x=a,s.align="center",s.font="Impact",s.fontSize=150,Laya.stage.addChild(s),s},n}();t.BeginText=n}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.TYPE_LILIAN=2,t.TYPE_CHAMPION=3,t}();t.FightType=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(t,e,i){void 0===i&&(i=0),this.id=0,this.level=0,this.name="",this._nameLv6="",this._nameLv10="",this.type=0,this.attack=0,this["throw"]=0,this.sourceUrl="",this.skillUrl="",this.action="",this.reactionFly=!1,this.update(t,e,i)}return e.prototype.update=function(i,s,n){void 0===n&&(n=0);var a=t.Config().GetWeapon(i+"");if(a||(a=t.Config().GetWeapon("1")),this.id=i+e.BASE_WEAPON_ID,this.level=s,this.type=parseInt(a.Type),this.attack=parseInt(a.Attack),this["throw"]=parseInt(a.Throw),this.sourceUrl=t.ResPath().getFightWeapon(this.id,s),this.reactionFly=!1,this.level<6?(this.name=a.Name,this.sound=a.Sound,this.reactionFly=!!a.fly,this.longSound=a.longSound):this.level<10?(this.name=a.NameLv6,this.sound=a.Sound6,this.longSound=a.longSound6,this.reactionFly=!!a.fly6):(this.name=a.NameLv10,this.sound=a.Sound10,this.longSound=a.longSound10,this.reactionFly=!!a.fly10),a.SkillID&&this.level<6?this.skillSource=a.SkillID:a.SkillIDLv6&&this.level>=6&&this.level<10?this.skillSource=a.SkillIDLv6:a.SkillIDLv10&&this.level>=10&&(this.skillSource=a.SkillIDLv10),this.skillSource){var o=new t.EffectData(this.skillSource);this.skillUrl=t.ResPath().getEffect(o.effect),this.action=o.action,this.effectType=o.type}t.Global.isRetrench&&(this.skillUrl=""),this.ballEffectType=0,n>=264&&1155>n?this.ballEffectType=1:n>=1155&&2640>n?this.ballEffectType=2:n>=2640&&(this.ballEffectType=3),this.reverse=a.reverse?a.reverse:""},e.prototype.getWeaponToSkillData=function(){var e=new t.SkillData(this.id,this.level);return e.sourceUrl=this.skillUrl,e.action=this.action,e.withRole=!1,e.type=this.effectType,e.sound=this.sound,e.reverse=this.reverse,e},e.BASE_WEAPON_ID=2e5,e}();t.WeaponData=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(t,e,i){void 0===i&&(i=0),this.id=0,this.name="",this.level=0,this.source="",this.type=0,this.withRole=!1,this.sourceUrl="",this.action="",this.action2="",this.sound="",this.withoutAttack=0,this.reactionFly=!1,this.isAssist=!1,this.rebound=0,this.update(t,e,i)}return e.prototype.update=function(e,i,s){void 0===s&&(s=0);var n=t.Config().GetSkill(e.toString());n||(n=t.Config().GetSkill("2")),this.isAssist=1==n.assist;var a=n.source;if(this.withoutAttack=n.withoutAttack?n.withoutAttack:0,6>i&&(this.reactionFly=!!n.fly,a=n.source),i>=6&&10>i?(this.reactionFly=!!n.fly6,n.source6&&(a=n.source6)):i>=10&&(this.reactionFly=!!n.fly10,n.source10&&(a=n.source10)),0!=s){var o=t.Config().GetNPC(s.toString());o&&o[e+""]&&(a=o[e+""])}t.Global.isRetrench&&(a="effect_guaji");var r=a.split("*");r[1]&&-1!=r[1].indexOf("|")?(this.action=r[1].split("|")[0],this.action2=r[1].split("|")[1]):this.action=r[1]?r[1]:"";var h=t.Config().GetEffect(r[0]);h||(h=t.Config().GetEffect("effect_hlb")),this.id=e,this.name=n.name,this.level=i,this.source=r[0],this.type=h.type,this.withRole=-1==[1,2].indexOf(this.type),this.level<6?(this.name=n.name,this.sound=n.Sound):this.level<10?(this.name=n.name6,this.sound=n.Sound6):(this.name=n.name10,this.sound=n.Sound10),""!=this.source?this.sourceUrl=t.ResPath().getEffect(this.source):this.sourceUrl="",this.rebound=n.rebound?n.rebound:0,this.reverse=n.reverse?n.reverse:""},e.TYPE_UP=0,e.TYPE_DOWN=1,e.TYPE_UP_WITHOUT_BODY=2,e.TYPE_UP_AND_DOWN=3,e.TYPE_X_SCALE=4,e}();t.SkillData=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this.isEndRound=!1,this.roundIndex=0}return Object.defineProperty(e.prototype,"actionNum",{get:function(){return this._actionNum},enumerable:!0,configurable:!0}),e.prototype.initData=function(e,i,s,n){var a=e.split(";");this._actionNum=parseInt(a[0]);var o=a.length;this.actionArr=new Array;for(var r,h=1;o-1>h;h++)r=new t.ActionData(a[h],i,s,n),r.roundIndex=this.roundIndex,this.actionArr.push(r),this.isEndRound&&h==o-2&&(r.isEndAction=!0);this._curAction=1},e.prototype.getNextAction=function(){var t=null;return this._curAction>this._actionNum?null:(t=this.actionArr[this._curAction-1],this._curAction++,t)},e.prototype.isActionOver=function(){return this._curAction>this._actionNum},e}();t.RoundData=e}(hf||(hf={}));var hf;!function(t){var e=laya.ani.bone.Templet,i=laya.events.Event,s=function(){function s(){}return s.iniRes=function(n,a){s.fighterMap={},s.skeletonResNumMap={},s.qqLoadOver=!1,s.qqTemple?(s.qqLoadOver=!0,s.loadFigherRes(n)):(s.qqTemple=t.AnimationSKe.getTemplet(s.qqUrl),s.qqTemple?(s.qqLoadOver=!0,s.loadFigherRes(n)):(s.qqTemple=new e,s.qqTemple.once(i.ERROR,null,s.onQQLoadedError),s.qqTemple.once(i.COMPLETE,null,s.onQQLoaded,[n]),s.qqTemple.loadAni(s.qqUrl))),s.fighterNum=0,s.rightLoadOver=!1,s.resLoadOver=!1,s.assetsArr=[];var o=t.ResPath().getFightScene(a);Loader.getRes(o)||s.assetsArr.push({url:o,type:Loader.IMAGE,needToRealese:!0}),s.curTipsIndex=0,s.tipsArr||(s.tipsArr=s.getTipsArr()),s.getResArr(n,s.assetsArr),s.assetsArr.length>0?(t.LoaderBar.singleton.visible=!0,t.LoaderBar.singleton.content=s.tipsArr[s.curTipsIndex],t.LoaderBar.singleton.load(s.assetsArr,Handler.create(null,s.onRedoaded)),Laya.timer.loop(3e3,null,s.onTimeTips,null,!1)):(s.resLoadOver=!0,s.checkDataLoaded())},s.onQQLoaded=function(e){t.AnimationSKe.inserTemplet(s.qqUrl,s.qqTemple),s.qqLoadOver=!0,s.checkDataLoaded(),s.loadFigherRes(e)},s.onQQLoadedError=function(){s.qqTemple.destroy(),s.qqTemple=null,t.WeakTips.show("战斗资源加载错误！"),t.dispatch(t.FightStaticStr.FIGHT_COMPLETE),t.dispatch(t.FightStaticStr.AFTER_FIGHT_COMPLETE)},s.onRightLoadedError=function(){s.rightTemple.destroy(),s.rightTemple=null,t.WeakTips.show("战斗资源加载错误！"),t.dispatch(t.FightStaticStr.FIGHT_COMPLETE),t.dispatch(t.FightStaticStr.AFTER_FIGHT_COMPLETE)},s.onRightLoaded=function(){s.rightLoadOver=!0,s.checkDataLoaded()},s.onRedoaded=function(){Laya.timer.clear(null,s.onTimeTips),s.resLoadOver=!0,s.checkDataLoaded()},s.loadFigherRes=function(e){for(var i=0;i<e.playerDataList.length;i++)0!=e.playerDataList[i].utype?s.fighterMap[e.playerDataList[i].id]=new t.AnimationSKe(e.playerDataList[i].npcData.sourceUrl,2):s.fighterMap[e.playerDataList[i].id]=new t.AnimationSKe(s.qqUrl,2),s.fighterMap[e.playerDataList[i].id].once(Laya.Event.COMPLETE,null,s.onFigherLoad,[e])},s.onFigherLoad=function(t){s.fighterNum++,s.fighterNum==t.playerDataList.length&&(s.rightLoadOver=!0,s.checkDataLoaded())},s.checkDataLoaded=function(){s.qqLoadOver&&s.rightLoadOver&&s.resLoadOver&&t.dispatch(t.FightStaticStr.FIGHT_RESDATA_LOADED)},s.onTimeTips=function(){!s.resLoadOver&&t.LoaderBar.singleton.parent?(s.curTipsIndex++,s.curTipsIndex>=s.tipsArr.length&&(s.curTipsIndex=0),t.LoaderBar.singleton.content=s.tipsArr[s.curTipsIndex]):Laya.timer.clear(null,s.onTimeTips)},s.onTimeTipsChange=function(){t.Logger.log(t.LoaderBar.singleton.content),!s.resLoadOver&&t.LoaderBar.singleton.parent&&(t.LoaderBar.singleton.content+=".")},s.getTipsArr=function(){for(var e=[],i=t.Global.getRes("{config}config/loadingTips.json"),s=i?i.length:0,n=0;s>n;n++)1==i[n].is_fight&&e.push(i[n].words);return 0==e.length&&(e=["后台演员正在化妆……","道具师正在准备道具……","灯光师正在调整灯光……","演员正在对台词……","正在调整内息……","正在冥想学会的武功招式……","正在擦拭装备的武器……","准备服用强力的属性药丸……"]),e},s.realeseRes=function(){s.skeletonResNumMap=null,s.rightTemple&&s.rightTemple!=s.qqTemple&&s.rightTemple.destroy(),s.rightTemple=null;for(var t in s.skeletonMap)if(s.skeletonMap[t]){for(var e=s.skeletonMap[t],i=0;i<e.length;i++)e[i].destroy(),e[i]=null;delete s.skeletonMap[t],s.skeletonMap[t]=null}for(var t in s.fighterMap)s.fighterMap[t]&&(s.fighterMap[t].destroy(),delete s.fighterMap[t],s.fighterMap[t]=null);for(var t in s.templetMap)s.templetMap[t]&&(s.templetMap[t].destroy(),delete s.templetMap[t],s.templetMap[t]=null);if(s.assetsArr)for(var n=s.assetsArr.length,i=0;n>i;i++)if(s.assetsArr[i].needToRealese){var a=s.assetsArr[i].url;Laya.loader.clearRes(a)}},s.realeseSkeleton=function(t){s.skeletonMap[t]&&s.templetMap[t]&&s.skeletonResNumMap[t]&&(s.skeletonResNumMap[t]<=1?(Laya.timer.frameOnce(1,this,s.delayRealese,[s.skeletonMap[t],s.templetMap[t]]),delete s.skeletonMap[t],delete s.templetMap[t],s.skeletonMap[t]=null,s.templetMap[t]=null):s.skeletonResNumMap[t]--)},s.delayRealese=function(t,e){for(var i=0;i<t.length;i++)t[i].destroy(),t[i]=null;e.destroy()},s.getResArr=function(t,e){for(var i=t.roundDataArr.length,n=0;i>n;n++)for(var a=t.roundDataArr[n].actionArr,o=a.length,r=0;o>r;r++)s.getResInAction(a[r],e,t);for(var n=0;n<t.playerDataList.length;n++)s.loadFactionRes(t.playerDataList[n].factionData,e),s.loadMonsterRes(t.playerDataList[n].monsterData,e)},s.getResInAction=function(e,i,n){var a,o=n.fightData.playerDataMap[e.actor],r=n.fightData.playerDataMap[e.effects[0].effector];if(e.weapon>0){var h=o.getWeaponData(e.weapon);i.push({url:h.sourceUrl,type:Loader.IMAGE,needToRealese:!1}),s.loadRes(h.skillUrl,i)}var l;if(e.skill>0&&!t.MonsterConfigData.monsterSkill[e.skill+""]&&(l=o.getSkillData(e.skill),s.loadRes(l.sourceUrl,i)),e.skillParam)for(var c=e.skillParam.length,d=1;c>d;d++)e.skillParam[d]&&(h=o.getWeaponData(parseInt(e.skillParam[d])),i.push({url:h.sourceUrl,type:Loader.IMAGE,needToRealese:!1}));if(e.assistantSkill>0&&(l=o.getSkillData(e.assistantSkill),s.loadRes(l.sourceUrl,i)),e.beBackDefenseSkill>0&&(l=o.getSkillData(e.beBackDefenseSkill),s.loadRes(l.sourceUrl,i)),e.defenseSkill>0&&(l=r.getSkillData(e.defenseSkill),s.loadRes(l.sourceUrl,i)),e.beAttackerSkill>0&&(l=r.getSkillData(e.beAttackerSkill),s.loadRes(l.sourceUrl,i)),e.buffObj)for(var u in e.buffObj)if(e.buffObj.hasOwnProperty(u)){var p=e.buffObj[u];if(p){var _=p[0][0],f=t.BuffData.buffMap[_];f&&(a=t.ResPath().getEffect(f.effect),i.push({url:a,type:Loader.BUFFER,needToRealese:!1}),i.push({url:a.replace(".sk",".png"),type:Loader.IMAGE,needToRealese:!1}))}}if(e.beAttackerBuffObj)for(var u in e.beAttackerBuffObj)if(e.beAttackerBuffObj.hasOwnProperty(u)){var p=e.beAttackerBuffObj[u];if(p){var _=p[0][0],f=t.BuffData.buffMap[_];f&&(a=t.ResPath().getEffect(f.effect),i.push({url:a,type:Loader.BUFFER,needToRealese:!1}),i.push({url:a.replace(".sk",".png"),type:Loader.IMAGE,needToRealese:!1}))}}},s.loadFactionRes=function(e,i){if(e.factionId>0){i.push({url:"ui/faction/factiontotem/picBig"+e.pic+".png",type:Loader.IMAGE,needToRealese:!1}),i.push({url:"ui/faction/factiontotem/flagBig"+e.flag+".png",type:Loader.IMAGE,needToRealese:!1}),i.push({url:"ui/faction/factiontotem/tableBig"+e.table+".png",type:Loader.IMAGE,needToRealese:!1});var s=t.ResPath().getEffect("effect_qi");i.push({url:s,type:Loader.BUFFER,needToRealese:!0}),i.push({url:s.replace(".sk",".png"),type:Loader.IMAGE,needToRealese:!0})}},s.loadMonsterRes=function(e,i){if(e&&e.monsterList)for(var s,n,a,o=0;o<e.monsterList.length;o++)if(s=t.MonsterConfigData.monster[e.monsterList[o].id]){n=t.ResPath().getEffect(s.effect+e.monsterList[o].type),a=n.replace(".sk",".png"),i.push({url:n,type:Loader.BUFFER,needToRealese:!0});for(var r=0;r<s.pic.length;r++)0==r?i.push({url:a,type:Loader.IMAGE,needToRealese:!0}):i.push({url:a.replace(".png",r+1+".png"),type:Loader.IMAGE,
needToRealese:!0})}if(e&&e.passiveList)for(var o=0;o<e.passiveList.length;o++)if(s=t.MonsterConfigData.monster[e.passiveList[o].id]){n=t.ResPath().getEffect(s.effect+e.passiveList[o].type),a=n.replace(".sk",".png"),i.push({url:n,type:Loader.BUFFER,needToRealese:!0});for(var r=0;r<s.pic.length;r++)0==r?i.push({url:a,type:Loader.IMAGE,needToRealese:!0}):i.push({url:a.replace(".png",r+1+".png"),type:Loader.IMAGE,needToRealese:!0})}},s.loadRes=function(t,e){t&&(s.skeletonResNumMap[t]?s.skeletonResNumMap[t]++:s.skeletonResNumMap[t]=1,e.push({url:t,type:Loader.BUFFER,needToRealese:!0}),e.push({url:t.replace(".sk",".png"),type:Loader.IMAGE,needToRealese:!0}))},s.templetMap={},s.skeletonMap={},s.qqLoadOver=!1,s.leftLoadOver=!1,s.rightLoadOver=!1,s.resLoadOver=!1,s.qqUrl="assets/skeleton/qq.sk",s}();t.ResData=s}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this.headUrl=""}return e.prototype.initData=function(e){this.curStateData=new t.CurStateData;var i=e.split(",");if(this.id=i[0].split(":")[0],this.uin=parseFloat(i[0].split(":")[1]),this.utype=t.Global.isRetrench?0:parseInt(i[1].split("|")[1]),this.isRole=0==parseInt(i[1].split("|")[0]),this.gender=parseInt(i[2]),this.title=i[3],this.name=i[4],this.level=parseInt(i[5]),this.vip=parseInt(i[6]),this.HP=parseInt(i[7].split("|")[0]),this.MAX_HP=parseInt(i[7].split("|")[1]),this.headUrl=decodeURIComponent(i[8]),this.statusArr=[],i[9]){var s=i[9].split("|");if(s)for(var n,a,o,r=s.length,h=0;r>h;h++)n=s[h].split("_"),a=parseInt(n[0]),o=parseInt(n[1]),this.statusArr.push({id:a,sort:o}),this.statusArr.sort(this.buffCompare)}if(this.weaponMap={},this.weaponMapCache={},i[10]){var l=i[10].split("|");if(l)for(var n,c,d,u,r=l.length,h=0;r>h;h++)n=l[h].split("_"),c=parseInt(n[0]),d=parseInt(n[1]),u=n[2]?parseInt(n[2]):0,this.weaponMap[c]={id:c,level:d,ballFight:u},this.weaponMapCache[c]={id:c,level:d,ballFight:u}}if(this.skillMap={},i[11]){var p=i[11].split("|");if(p)for(var n,_,f,r=p.length,h=0;r>h;h++)n=p[h].split("_"),_=parseInt(n[0]),f=parseInt(n[1]),this.skillMap[_]={id:_,level:f}}this.factionData=new t.FightFactionData(i[12]),this.monsterData=new t.MonsterData(i[13]),this.championData=new t.ChampionData(i[14]),0!=this.utype&&this.utype?this.npcData=new t.NPCData(this.uin,this.utype):(this.npcData=new t.NPCData(this.uin,1),this.npcData.top=140,this.npcData.middle=65),this.curStateData.maxHp=this.MAX_HP,this.curStateData.curHp=this.HP},e.prototype.buffCompare=function(t,e){var i=t.sort,s=e.sort;return i>s?1:s>i?-1:0},e.prototype.getWeaponData=function(e){var i=this.weaponMapCache[e];return i?new t.WeaponData(e,i.level,i.ballFight):(t.Logger.log("不存在武器："+e),new t.WeaponData(e,0))},e.prototype.getWeaponLevel=function(t){return this.weaponMapCache[t]?this.weaponMapCache[t].level:0},e.prototype.getSkillData=function(e){var i=this.skillMap[e];return i?new t.SkillData(e,i.level,this.utype):(t.Logger.log("不存在技能："+e),new t.SkillData(e,1,this.utype))},e.prototype.getSkillLevel=function(t){return this.skillMap[t]?this.skillMap[t].level:0},e.prototype.dataSave=function(){this.HP=this.curStateData.curHp},e}();t.PlayerData=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(t,e){this.id=0,this.npcType=0,this.name="",this.scale=1,this.sourceIdUp="",this.sourceUrl="",this.top=180,this.middle=90,this.bottom=0,this.skin="",this.update(t,e)}return e.prototype.update=function(e,i){var s=t.Config().GetNPC(i.toString());s&&(this.sourceIdUp=s.SourceId,this.top=s.top?s.top:180,this.middle=s.middle?s.middle:this.top/2,this.bottom=s.bottom?s.bottom:0,this.scale=s.scale?s.scale:1,this.skin=s.skin?s.skin:""),this.id=e,this.npcType=s&&s.source?s.source:i,this.sourceUrl=t.ResPath().getAnim(this.npcType,t.ResourcePath.PATH_NPC)},e}();t.NPCData=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(t){this._haveMonster=!1,this.monsterHaveShow=!1,this.haveShowPassive=!1,this.parseData(t)}return e.prototype.parseData=function(e){if(this.curIndex=0,e){this.monsterList=[],this.passiveList=[];for(var i,s=e.split("|"),n=0;n<s.length;n++)i=this.parseMonster(s[n]),t.MonsterConfigData.isPassiveSkill(i.skill)?this.passiveList.push(i):this.monsterList.push(i);this.monsterList.length>0&&(this._haveMonster=!0)}},e.prototype.getMonsterData=function(){return this._haveMonster&&this.curIndex<this.monsterList.length?this.monsterList[this.curIndex]:null},Object.defineProperty(e.prototype,"haveMonster",{get:function(){return this._haveMonster},enumerable:!0,configurable:!0}),e.prototype.parseMonster=function(e){var i=e.split("*");return{id:parseInt(i[0]),level:parseInt(i[1]),max:parseInt(i[2]),skill:i[3]?parseInt(i[3]):0,type:t.MonsterConfigData.getType(parseInt(i[1]))}},e.prototype.getMonsterShowType=function(e){var i=1;if(this.monsterList){var s=t.MonsterConfigData.monsterSkill[""+e];if(s)for(var n=0;n<this.monsterList.length;n++)if(this.monsterList[n].id==s){i=this.monsterList[n].type;break}}return i},e}();t.MonsterData=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.isPassiveSkill=function(e){return-1!=t.passiveSkill.indexOf(e)},t.getGrade=function(t){var e=Math.ceil((t+1)/10);return e>10&&(e=10),e},t.getType=function(e){return t.imgMap[e+1]},t.monster={1:{effect:"effect_summon_dragon",pic:["effect_summon_dragon","effect_summon_dragon"],show:10003},2:{effect:"effect_summon_tiger",pic:["effect_summon_tiger","effect_summon_tiger"],show:10004},3:{effect:"effect_summon_phoenix",pic:["effect_summon_phoenix","effect_summon_phoenix"],show:10005}},t.monsterSkill={97:1,98:1,99:1,100:1,10003:1,107:2,108:2,109:2,110:2,10004:2,112:3,113:3,114:3,115:3,10005:3},t.passiveSkill=[100,110,115],t.imgMap=[1,1,1,1,2,2,3,3,4,4,5,5,5],t}();t.MonsterConfigData=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.FIGHT_START="FIGHT_START",t.BEFORE_FIGHT_START="BEFORE_FIGHT_START",t.READY_FIGHT_START="READY_FIGHT_START",t.SCREEN_OVER="SCREEN_OVER",t.PLAY_FIGHT_SOUND="PLAY_FIGHT_SOUND",t.SKIP_FIGHT="SKIP_FIGHT",t.MONSTER_ACTION="MONSTER_ACTION",t.BEGIN_ACTION="BEGIN_ACTION",t.GET_DROP_WEAPON_ACTION="GET_DROP_WEAPON_ACTION",t.END_ALL_ACTION="END_ALL_ACTION",t.CHAIN_ACTION="CHAIN_ACTION",t.RUN_ACTION="RUN_ACTION",t.ATTACK_ACTION="ATTACK_ACTION",t.BE_ATTACK_ACTION="BE_ATTACK_ACTION",t.REBOUND_ACTION="REBOUND_ACTION",t.BEAT_BACK_ACTION="BEAT_BACK_ACTION",t.BEAT_BACK_REACTION_ACTION="BEAT_BACK_REACTION_ACTION",t.AFTER_ATTACK_ACTION="AFTER_ATTACK_ACTION",t.BUFF_ACTION="BUFF_ACTION",t.EFFECT_ACTION="EFFECT_ACTION",t.SKILL_PLAY_OVER="SKILL_PLAY_OVER",t.DROP_WEAPON_OVER="DROP_WEAPON_OVER",t.GET_WEAPON_OVER="GET_WEAPON_OVER",t.ATTACK_ANI_OVER="ATTACK_ANI_OVER",t.FIGHTER_REACTION_ANI_OVER="FIGHTER_REACTION_ANI_OVER",t.ATTACK_REACTION_ANI_OVER="ATTACK_REACTION_ANI_OVER",t.ASSIST_SKILL_ANI_OVER="ASSIST_SKILL_ANI_OVER",t.SHAM_DEAD_ANI_OVER="SHAM_DEAD_ANI_OVER",t.EVENT_HIT_END="EVENT_HIT_END",t.ACTION_LOST_END="ACTION_LOST_END",t.IS_FIGHT_COMPLETE="IS_FIGHT_COMPLETE",t.AFTER_FIGHT_COMPLETE="AFTER_FIGHT_COMPLETE",t.FIGHT_COMPLETE="FIGHT_COMPLETE",t.FIGHT_RESDATA_LOADED="FIGHT_RESDATA_LOADED",t.SUB_HP="SUB_HP",t.ADD_HP="ADD_HP",t.FLOAT_WORD="FLOAT_WORD",t.THROW_WEAPON="THROW_WEAPON",t.SHOW_ROUND="SHOW_ROUND",t.ADD_BUFF="ADD_BUFF",t.DELETE_BUFF="DELETE_BUFF",t.ADD_BUFF_ANIMATION="ADD_BUFF_ANIMATION",t.DELETE_BUFF_ANIMATION="DELETE_BUFF_ANIMATION",t.FIGHT_WORD_SHOW="FIGHT_WORD_SHOW",t.FIGHT_CHAIN_WORD="FIGHT_CHAIN_WORD",t.FIGHT_CHAIN_ANI="FIGHT_CHAIN_ANI",t.FIGHT_CHAIN_ANI_END="FIGHT_CHAIN_ANI_END",t.FIGHT_DRAMA_START="FIGHT_DRAMA_START",t.FIGHT_DRAMA_END="FIGHT_DRAMA_END",t.FIGHT_SHAM_DEAD_EFFECT="FIGHT_SHAM_DEAD_EFFECT",t.FIGHT_SHOW_MONSTER_LOGO="FIGHT_SHOW_MONSTER_LOGO",t.FIGHT_ADD_MONSTER_VALUE="FIGHT_ADD_MONSTER_VALUE",t.FIGHT_SPEED_CHANGE="FIGHT_SPEED_CHANGE",t.FIGHT_GET_ACTION_DATA="FIGHT_GET_ACTION_DATA",t.FIGHT_USE_SIMULATOR="FIGHT_USE_SIMULATOR",t.FIGHT_UPDATE_SIMULATOR_SKILL="FIGHT_UPDATE_SIMULATOR_SKILL",t.FIGHT_SELECT_ACTION="FIGHT_SELECT_ACTION",t.LEFT_SIDE="L",t.RIGHT_SIDE="R",t}();t.FightStaticStr=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(t){this.parseData(t)}return t.prototype.parseData=function(t){if(t){var e=t.split("|");this._factionId=parseInt(e[0]);var i=e[1].split("*");this._flag=parseInt(i[0]),this._table=parseInt(i[1]),this._pic=parseInt(i[2]),0==this._pic&&(this._pic=1),0==this._flag&&(this._flag=1),0==this._table&&(this._table=1),this._factionName=e[2],this._factionPosition=e[3]}},Object.defineProperty(t.prototype,"factionId",{get:function(){return this._factionId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"pic",{get:function(){return this._pic},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"flag",{get:function(){return this._flag},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"table",{get:function(){return this._table},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"factionName",{get:function(){return this._factionName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"factionPosition",{get:function(){return this._factionPosition},enumerable:!0,configurable:!0}),t}();t.FightFactionData=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this.winSide=""}return Object.defineProperty(e.prototype,"fightType",{get:function(){return this._fightType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fightMode",{get:function(){return this._fightMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bg",{get:function(){return this._bg},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"battleNum",{get:function(){return this._battleNum},enumerable:!0,configurable:!0}),e.prototype.clearData=function(){this.playerDataMap=null,this.battleArr=null},e.prototype.initData=function(i){this.playerDataMap={};var s=i.split("&");this.battleArr=new Array;var n,a,o,r;a=s.length;for(var h=1;a>h;h++)switch(o=s[h].substr(0,2)){case"V:":this._protoVersion=s[h];break;case"Ty":var l=s[h].split(":")[1].split("|");this._fightType=parseInt(l[0]),this._fightMode=l[1]?parseInt(l[1]):0;break;case"BG":this._bg=parseInt(s[3].split(":")[1]);break;case"TL":if(!e.isRealFight)for(var c=s[h].split(";"),d=c.length,u=1;d-1>u;u++)n=new t.PlayerData,n.initData(c[u]),n.sideType=t.FightStaticStr.LEFT_SIDE,n.positionX=e.leftPosition[0].x,n.positionY=e.leftPosition[0].y,this.playerDataMap[c[u].split(":")[0]]=n;break;case"TR":if(e.isRealFight)this.initPlayer();else for(var p=s[h].split(";"),d=p.length,u=1;d-1>u;u++)n=new t.PlayerData,n.initData(p[u]),n.sideType=t.FightStaticStr.RIGHT_SIDE,n.positionX=e.rightPosition[0].x,n.positionY=e.rightPosition[0].y,this.playerDataMap[p[u].split(":")[0]]=n;break;case"BN":this._battleNum=parseInt(s[h].split(":")[1]);break;case"BT":r=new t.BattleData(s[h],this),this.battleArr.push(r),r.fightData=this,this.battleArr.length==this._battleNum&&(r.isEndBattle=!0);break;case"RL":this.result=parseInt(s[h].split(":")[1]),this.winSide=this.result<=10?"L":"R"}},e.prototype.initPlayer=function(){var i,s;i="PL1:1,0|0,1,,rocke1,60,8,99867|99867,http%3A%2F%2Fthirdapp3.qlogo.cn%2Fqzopenapp%2F02421c7a7300de78225e4a427c644cb01e994b23085ef0cc3650fc0da69fa147%2F50,4_4|7_2|6_1|3_3|5_5,1_6_443|22_6_476|11_7_476|33_6_660|10_6_614|13_6_476|5_6_443|28_6_568|29_6_667|6_5_476|12_10_522|3_6_588|26_6_568|15_6_522|25_6_476|14_6_568|27_6_568|30_6_522|7_6_476|8_6_443|18_4_476|20_6_476|9_10_476|32_6_614|21_5_476,56_1|58_4|11_6|1_3|48_10|61_8|8_1,207741|4*8*4*1|大雪龙骑|精英,,22*7;",s=new t.PlayerData,s.initData(i),s.sideType=t.FightStaticStr.LEFT_SIDE,s.positionX=e.leftPosition[0].x,s.positionY=e.leftPosition[0].y,this.playerDataMap[i.split(":")[0]]=s,i="PL2:2,0|0,1,,rocke2,60,8,99867|99867,http%3A%2F%2Fthirdapp3.qlogo.cn%2Fqzopenapp%2F02421c7a7300de78225e4a427c644cb01e994b23085ef0cc3650fc0da69fa147%2F50,4_4|7_2|6_1|3_3|5_5,1_6_443|22_6_476|11_7_476|33_6_660|10_6_614|13_6_476|5_6_443|28_6_568|29_6_667|6_5_476|12_10_522|3_6_588|26_6_568|15_6_522|25_6_476|14_6_568|27_6_568|30_6_522|7_6_476|8_6_443|18_4_476|20_6_476|9_10_476|32_6_614|21_5_476,56_1|58_4|11_6|1_3|48_10|61_8|8_1,207741|4*8*4*1|大雪龙骑|精英,,22*7;",s=new t.PlayerData,s.initData(i),s.sideType=t.FightStaticStr.LEFT_SIDE,s.positionX=e.leftPosition[1].x,s.positionY=e.leftPosition[1].y,this.playerDataMap[i.split(":")[0]]=s,i="PL3:3,0|0,1,,rocke3,60,8,99867|99867,http%3A%2F%2Fthirdapp3.qlogo.cn%2Fqzopenapp%2F02421c7a7300de78225e4a427c644cb01e994b23085ef0cc3650fc0da69fa147%2F50,4_4|7_2|6_1|3_3|5_5,1_6_443|22_6_476|11_7_476|33_6_660|10_6_614|13_6_476|5_6_443|28_6_568|29_6_667|6_5_476|12_10_522|3_6_588|26_6_568|15_6_522|25_6_476|14_6_568|27_6_568|30_6_522|7_6_476|8_6_443|18_4_476|20_6_476|9_10_476|32_6_614|21_5_476,56_1|58_4|11_6|1_3|48_10|61_8|8_1,207741|4*8*4*1|大雪龙骑|精英,,22*7;",s=new t.PlayerData,s.initData(i),s.sideType=t.FightStaticStr.LEFT_SIDE,s.positionX=e.leftPosition[2].x,s.positionY=e.leftPosition[2].y,this.playerDataMap[i.split(":")[0]]=s,i="PR1:4,0|0,1,,rocke4,60,8,99867|99867,http%3A%2F%2Fthirdapp3.qlogo.cn%2Fqzopenapp%2F02421c7a7300de78225e4a427c644cb01e994b23085ef0cc3650fc0da69fa147%2F50,4_4|7_2|6_1|3_3|5_5,1_6_443|22_6_476|11_7_476|33_6_660|10_6_614|13_6_476|5_6_443|28_6_568|29_6_667|6_5_476|12_10_522|3_6_588|26_6_568|15_6_522|25_6_476|14_6_568|27_6_568|30_6_522|7_6_476|8_6_443|18_4_476|20_6_476|9_10_476|32_6_614|21_5_476,56_1|58_4|11_6|1_3|48_10|61_8|8_1,207741|4*8*4*1|大雪龙骑|精英,,22*7;",s=new t.PlayerData,s.initData(i),s.sideType=t.FightStaticStr.RIGHT_SIDE,s.positionX=e.rightPosition[0].x,s.positionY=e.rightPosition[0].y,this.playerDataMap[i.split(":")[0]]=s,i="PR2:5,0|0,1,,rocke5,60,8,99867|99867,http%3A%2F%2Fthirdapp3.qlogo.cn%2Fqzopenapp%2F02421c7a7300de78225e4a427c644cb01e994b23085ef0cc3650fc0da69fa147%2F50,4_4|7_2|6_1|3_3|5_5,1_6_443|22_6_476|11_7_476|33_6_660|10_6_614|13_6_476|5_6_443|28_6_568|29_6_667|6_5_476|12_10_522|3_6_588|26_6_568|15_6_522|25_6_476|14_6_568|27_6_568|30_6_522|7_6_476|8_6_443|18_4_476|20_6_476|9_10_476|32_6_614|21_5_476,56_1|58_4|11_6|1_3|48_10|61_8|8_1,207741|4*8*4*1|大雪龙骑|精英,,22*7;",s=new t.PlayerData,s.initData(i),s.sideType=t.FightStaticStr.RIGHT_SIDE,s.positionX=e.rightPosition[1].x,s.positionY=e.rightPosition[1].y,this.playerDataMap[i.split(":")[0]]=s,i="PR3:6,0|0,1,,rocke6,60,8,99867|99867,http%3A%2F%2Fthirdapp3.qlogo.cn%2Fqzopenapp%2F02421c7a7300de78225e4a427c644cb01e994b23085ef0cc3650fc0da69fa147%2F50,4_4|7_2|6_1|3_3|5_5,1_6_443|22_6_476|11_7_476|33_6_660|10_6_614|13_6_476|5_6_443|28_6_568|29_6_667|6_5_476|12_10_522|3_6_588|26_6_568|15_6_522|25_6_476|14_6_568|27_6_568|30_6_522|7_6_476|8_6_443|18_4_476|20_6_476|9_10_476|32_6_614|21_5_476,56_1|58_4|11_6|1_3|48_10|61_8|8_1,207741|4*8*4*1|大雪龙骑|精英,,22*7;",s=new t.PlayerData,s.initData(i),s.sideType=t.FightStaticStr.RIGHT_SIDE,s.positionX=e.rightPosition[2].x,s.positionY=e.rightPosition[2].y,this.playerDataMap[i.split(":")[0]]=s},e.leftFighterX=290,e.rightFighterX=1044,e.fighterY=640,e.leftMoveX=910,e.rightMoveX=424,e.figherScale=1.1,e.runTime=500,e.leftPosition=[{x:290,y:640},{x:320,y:590},{x:350,y:540},{x:240,y:640},{x:270,y:590},{x:300,y:540}],e.rightPosition=[{x:1044,y:640},{x:1074,y:590},{x:1104,y:540},{x:1094,y:640},{x:1124,y:590},{x:1154,y:540}],e.isRealFight=!1,e}();t.FightData=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(t){this.effect="",this.action="",this.sourceUrl="",this.type=0,this.withRole=!1,this.sound="",this.update(t)}return e.prototype.update=function(e){var i=e.split("*");this.effect=i[0],this.action=i[1]?i[1]:"";var s=t.Config().GetEffect(this.effect);s||(s=t.Config().GetEffect("effect_hlb")),this.type=s.type,this.withRole=-1==[2].indexOf(this.type),this.sourceUrl=t.ResPath().getEffect(this.effect),this.sound=s[this.action]?s[this.action]:this.effect},e}();t.EffectData=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){this.curHp=0,this.maxHp=0,this.curWeapon=0,this.hasDoubleAttack=!1,this.isDizzy=!1,this.isStick=!1,this.isDianxue=!1}return t.prototype.subHP=function(t){return this.curHp-=t,this.curHp<0&&(this.curHp=0),this.curHp},t.prototype.addHP=function(t){return this.curHp+=t,this.curHp>this.maxHp&&(this.curHp=this.maxHp),this.curHp},t}();t.CurStateData=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(t){this.parseData(t)}return t.prototype.parseData=function(t){if(t){var e=t.split("*");this._sid=e[0]?parseInt(e[0]):0,this._star=e[1]?parseInt(e[1]):0}else this._sid=0,this._star=0},Object.defineProperty(t.prototype,"sid",{get:function(){return this._sid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"star",{get:function(){return this._star},enumerable:!0,configurable:!0}),t}();t.ChampionData=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){this.curChainNum=0,this.playChainSkill=!1,this.skillLevel=0}return t.prototype.update=function(t,e){this._curSideType!=e&&this.clearData(),this._curSideType=e;var i=t.split("|");"1"==i[1]?"1"!=i[0]&&(this.curChainNum++,this.playChainSkill=!1):(this.curChainNum>0&&"2"==i[1]?(this.skillLevel=this.curChainNum-1,this.playChainSkill=!0):this.playChainSkill=!1,this.curChainNum=0)},t.prototype.clearData=function(){this.curChainNum=0,this.playChainSkill=!1,this.skillLevel=0},t}();t.ChainData=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.buffMap={2:{effect:"act_dizzy",position:"top"},5:{effect:"act_deceleration",position:"bottom"},10:{effect:"act_increasedattackpower",position:"top"},11:{effect:"act_increasehit",position:"top"},6:{effect:"act_reducedattackpower",position:"top"},9:{effect:"act_reducedefense",position:"top"},7:{effect:"act_reducedhit",position:"top"},4:{effect:"act_poison",position:"top"},17:{effect:"act_dingshizhadan",position:"top"},18:{effect:"act_poisoncloud",position:"top"},19:{effect:"act_zaisheng",position:"top"},20:{effect:"act_baonu",position:"top"},78:{effect:"effect_buff_zh",position:"top"},79:{effect:"effect_buff_zh",position:"top"},80:{effect:"effect_buff_zh",position:"top"},81:{effect:"dun",position:"top"},82:{effect:"dun",position:"top"},83:{effect:"dun",position:"top"},84:{effect:"effect_buff_cd",position:"top"},85:{effect:"effect_buff_cd",position:"top"},86:{effect:"effect_buff_cd",position:"top"},101:{effect:"effect_buff_disease",position:"top"},102:{effect:"effect_buff_disease",position:"top"},103:{effect:"effect_buff_disease",position:"top"},104:{effect:"effect_buff_gx",position:"top"},105:{effect:"effect_buff_gx",position:"top"},106:{effect:"effect_buff_gx",position:"top"},effect_buff_zy:{effect:"effect_buff_zy",position:"top"},effect_buff_cd:{effect:"effect_buff_cd",position:"top"}},t}();t.BuffData=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(t,e){this.isEndBattle=!1,this.fightData=e,this.initData(t)}return Object.defineProperty(e.prototype,"roundNum",{get:function(){return this._roundNum},enumerable:!0,configurable:!0}),e.prototype.initData=function(e){this.fighterMap={},this.fighterList=[];var i=e.split(";"),s=i[0].split(":")[1].split(",");i[0].split(/R[1-9]?[0-9]?[0-9]:/),this.leftPlayerIndex=parseInt(s[0]),this.rightPlayerIndex=parseInt(s[1]),this.playerDataList=[],t.FightData.isRealFight?(this.playerDataList.push(this.fightData.playerDataMap.PL1),this.playerDataList.push(this.fightData.playerDataMap.PL2),this.playerDataList.push(this.fightData.playerDataMap.PL3),this.playerDataList.push(this.fightData.playerDataMap.PR1),this.playerDataList.push(this.fightData.playerDataMap.PR2),this.playerDataList.push(this.fightData.playerDataMap.PR3)):(this.playerDataList.push(this.fightData.playerDataMap["PL"+this.leftPlayerIndex]),this.playerDataList.push(this.fightData.playerDataMap["PR"+this.rightPlayerIndex])),this._roundNum=parseInt(i[1].split(":")[1]),i=e.split(/R[1-9]?[0-9]?[0-9]:/);var n=i.length;this.roundDataArr=[];for(var a,o=1;n>o;o++)a=new t.RoundData,a.roundIndex=o,a.isEndRound=o==n-1&&this.isEndBattle,a.initData(i[o],this,"PL"+this.leftPlayerIndex,"PR"+this.rightPlayerIndex),this.roundDataArr.push(a);this._curRound=1},e.prototype.getNextAction=function(){var e=null;if(t.FightData.isRealFight)t.dispatch(t.FightStaticStr.FIGHT_USE_SIMULATOR);else{var e=null;if(this._curRound>this._roundNum)return t.dispatch(t.FightStaticStr.FIGHT_GET_ACTION_DATA,null),null;e=this.roundDataArr[this._curRound-1].getNextAction(),this.roundDataArr[this._curRound-1].isActionOver()&&this._curRound++,t.dispatch(t.FightStaticStr.FIGHT_GET_ACTION_DATA,e)}return e},e}();t.BattleData=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(t,e,i,s){this.actionType=0,this.actionId=0,this.actor="",this.isEndAction=!1,this.roundIndex=0,this.isDoubleHit=!1,this.haveShamDead=!1,this.beBackDefenseSkill=0,this.beShamDead=0,this.beAfterAttackSkill=0,this.defenseSkill=0,this.shamDead=0,this.afterAttackSkill=0,this.initData(t,e,i,s)}return Object.defineProperty(e.prototype,"attacker",{get:function(){return this.battleData.fighterMap[this.actor]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"beAttacker",{get:function(){return this.battleData.fighterMap[this.effects[0].effector]},enumerable:!0,configurable:!0}),e.prototype.initData=function(e,s,n,a){this.battleData=s;var o=e.split(",");this.attackSide=o[0].split(":")[1],this.beAttackSide=this.attackSide==t.FightStaticStr.LEFT_SIDE?t.FightStaticStr.RIGHT_SIDE:t.FightStaticStr.LEFT_SIDE;var r=e.split(this.beAttackSide),h=r[0].split(","),l=r[1].split(",");this.effects=[];var c=new i;this.attackSide==t.FightStaticStr.LEFT_SIDE?(this.actor=n,c.effector=a):(this.actor=a,c.effector=n),this.effects.push(c);for(var d=13,u=1;d>u;u++)switch(u){case 1:var o=h[u].split("|");this.isDoubleAttack=o[0]?parseInt(o[0]):0,this.chainStr=h[u];break;case 2:var o=h[u].split("|");"0"==o[0]?this.assistantSkill=0:this.assistantSkill=parseInt(o[0]);break;case 3:this.haveAction="0"!=h[u];break;case 5:this.haveAction?(this.attackType=h[u]?parseInt(h[u]):0,2==this.attackType?(this.skill=parseInt(h[4]),this.weapon=0,this.actionType=3):(this.skill=0,this.weapon=parseInt(h[4]),this.actionType=this.weapon>0?2:1),this.actionId=parseInt(h[4])):(this.attackType=h[u]?parseInt(h[u]):0,this.skill=2==this.attackType?parseInt(h[4]):0,this.weapon=2!=this.attackType?parseInt(h[4]):0,this.actionType=0);break;case 6:var o=h[u].split("*");this.beAttackerHpChange=o[0]?parseInt(o[0]):0,this.attackerAddHp=o[1]?parseInt(o[1]):0;break;case 7:var o=h[u].split("|");this.hitReaction=o.length>1?parseInt(o[1]):parseInt(o[0]);break;case 8:if(this.effectObj={},h[u])for(var p,o,_,f=h[u].split("|"),y=f.length,m=0;y>m;m++)p=f[m].split("*"),this.effectObj[p[0]]||(this.effectObj[p[0]]=[]),o=p[1].split("_"),_=p[2]?p[2]:this.attackSide.toLowerCase(),o.unshift(_),this.effectObj[p[0]].push(o),parseInt(p[0])>=6?("8"==o[1]&&(this.beShamDead=o[3]?parseInt(o[3]):14,this.beShamDeadParam=o),"11"==o[1]?(this.beBackDefenseSkill=55,this.beBackDefenseSkillParam=o):"12"==o[1]&&(this.beBackDefenseSkill=10002,this.beBackDefenseSkillParam=o),"6"==o[1]&&"2"==o[3]&&"90"==o[4]?(o[1]="600",this.beAfterAttackSkill=90,this.beAfterAttackSkillParam=o):"3"==o[1]&&"2"==o[3]&&"90"==o[4]&&(o[1]="600",this.beAfterAttackSkill=90,this.beAfterAttackSkillParam=o)):1==parseInt(p[0])&&"8"==o[1]&&(this.beforeActionSkill=o[3]?parseInt(o[3]):14,this.beforeActionSkillParam=o),"2"!=o[1]&&"1"!=o[1]||(this.skillParam=o);break;case 9:if(this.buffObj={},h[u])for(var p,g=h[u].split("|"),v=g.length,m=0;v>m;m++)p=g[m].split("*"),this.buffObj["buff"+p[0]]||(this.buffObj["buff"+p[0]]=[]),this.buffObj["buff"+p[0]].push(p);break;case 10:if(this.dBuffObj={},h[u])for(var p,g=h[u].split("|"),v=g.length,m=0;v>m;m++)p=g[m].split("*"),this.dBuffObj["buff"+p[0]]||(this.dBuffObj["buff"+p[0]]=[]),this.dBuffObj["buff"+p[0]].push(p);break;case 11:this.addRage=h[u]?parseInt(h[u]):0}for(var u=1;d>u;u++)switch(u){case 1:this.beatBack=l[u]?parseInt(l[u]):0;case 3:0==this.beatBack?(this.beAttackerAttackType=0,this.beAttackerSkill=0,this.beAttackerWeapon=0):(this.beAttackerAttackType=l[u]?parseInt(l[u]):0,2==this.beAttackerAttackType?(this.beAttackerSkill=l[2]?parseInt(l[2]):0,this.beAttackerWeapon=0):(this.beAttackerSkill=0,this.beAttackerWeapon=l[2]?parseInt(l[2]):0));break;case 4:var o=l[u].split("*");this.attackerHpChange=o[0]?parseInt(o[0]):0,this.beAttackerAddHp=o[1]?parseInt(o[1]):0;break;case 5:var o=l[u].split("|");this.beatBackReaction=o.length>1?parseInt(o[1]):parseInt(o[0]);break;case 6:if(this.beAttackerEffectObj={},l[u])for(var p,o,_,f=l[u].split("|"),y=f.length,m=0;y>m;m++)p=f[m].split("*"),this.beAttackerEffectObj[p[0]]||(this.beAttackerEffectObj[p[0]]=[]),o=p[1].split("_"),_=p[2]?p[2]:this.attackSide.toLowerCase(),o.unshift(_),this.beAttackerEffectObj[p[0]].push(o),"9"==o[1]&&(this.beAttackerSkill=parseInt(o[2]),this.attackerHpChange=parseInt(o[3]),this.beatBackReaction=2,this.reboundParam=o),parseInt(p[0])>=6&&("8"==o[1]&&(this.shamDead=o[3]?parseInt(o[3]):14,this.shamDeadParam=o),"11"==o[1]?(this.defenseSkill=55,this.defenseSkillParam=o):"12"==o[1]&&(this.defenseSkill=10002,this.defenseSkillParam=o),"6"==o[1]&&"2"==o[3]&&"90"==o[4]?(o[1]="600",this.afterAttackSkill=90,this.afterAttackSkillParam=o):"3"==o[1]&&"2"==o[3]&&"90"==o[4]&&(o[1]="600",this.afterAttackSkill=90,this.afterAttackSkillParam=o));break;case 7:if(this.beAttackerBuffObj={},l[u])for(var p,g=l[u].split("|"),v=g.length,m=0;v>m;m++)p=g[m].split("*"),this.beAttackerBuffObj["buff"+p[0]]||(this.beAttackerBuffObj["buff"+p[0]]=[]),this.beAttackerBuffObj["buff"+p[0]].push(p);break;case 8:if(this.beAttackerdBuffObj={},l[u])for(var p,g=l[u].split("|"),v=g.length,m=0;v>m;m++)p=g[m].split("*"),this.beAttackerdBuffObj["buff"+p[0]]||(this.beAttackerdBuffObj["buff"+p[0]]=[]),this.beAttackerdBuffObj["buff"+p[0]].push(p);break;case 9:this.beAttackerAddRage=l[u]?parseInt(l[u]):0}},e.chainData=new t.ChainData,e}();t.ActionData=e;var i=function(){function t(){}return t}();t.EffectObj=i;var s=function(){function t(){}return t}();t.BuffObj=s;var n=function(){function t(){}return t}();t.ReAction=n}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this.init()}return e.prototype.init=function(){t.addListener(t.FightStaticStr.IS_FIGHT_COMPLETE,this,this.onFightComplete)},e.prototype.destroy=function(){t.removeListener(t.FightStaticStr.IS_FIGHT_COMPLETE,this,this.onFightComplete)},e.prototype.onFightComplete=function(e){t.Facade.callCommand(new t.FightResultCommand(e))},e}();t.UIController=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.playAttackSound=function(){},t.playSkillAttackSound=function(){},t.playWeaponSound=function(t){},t.playThrowWeaponSound=function(t){},t.playBaojiSound=function(){},t.playShouShangSound=function(){},t.playLostSound=function(){},t.playWinSound=function(){},t.playRunSound=function(){},t.playMissSound=function(){},t.playBqhtSound=function(){},t}();t.SoundController=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this.init()}return e.prototype.init=function(){t.addListener(t.FightStaticStr.RUN_ACTION,this,this.onEvent)},e.prototype.destroy=function(){t.removeListener(t.FightStaticStr.RUN_ACTION,this,this.onEvent),this._curActionData=null},e.prototype.onEvent=function(t){this._curActionData=t;var e=this.getActionType();switch(e){case"run":this.playRun();break;case"runWithWeapon":this.playRunWithWeapon();break;case"none":this.gotoNextAction();break;default:this.gotoNextAction()}},e.prototype.getActionType=function(){var t="none";return this._curActionData.haveAction?this._curActionData.skill>0||1==this._curActionData.attackType?"none":this._curActionData.weapon>0?""!=this._curActionData.attacker.playerData.getWeaponData(this._curActionData.weapon).skillUrl?"none":"runWithWeapon":"run":t},e.prototype.playRun=function(){this._curActionData.attacker.playerData.curStateData.hasDoubleAttack||0!=this._curActionData.attacker.playerData.utype?this.gotoNextAction():(this._curActionData.attacker.playRun(),Laya.Tween.to(this._curActionData.attacker,{x:this._curActionData.attacker.moveX},t.FightData.runTime/t.FightController.TIME_SCALE,null,Laya.Handler.create(this,this.gotoNextAction)))},e.prototype.playRunWithWeapon=function(){this._curActionData.attacker.playerData.curStateData.hasDoubleAttack?this.gotoNextAction():(this._curActionData.attacker.playRunWithWeapon(),Laya.Tween.to(this._curActionData.attacker,{x:this._curActionData.attacker.moveX},t.FightData.runTime/t.FightController.TIME_SCALE,null,Laya.Handler.create(this,this.gotoNextAction)))},e.prototype.gotoNextAction=function(){t.dispatch(t.FightStaticStr.ATTACK_ACTION,this._curActionData)},e}();t.RunController=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this._isAttackPlayOver=!1,this._isBeAttackOver=!1,this.init()}return e.prototype.init=function(){t.addListener(t.FightStaticStr.REBOUND_ACTION,this,this.onEvent)},e.prototype.destroy=function(){t.removeListener(t.FightStaticStr.REBOUND_ACTION,this,this.onEvent),this._curActionData=null},e.prototype.onEvent=function(e){this._curActionData=e,this._isAttackPlayOver=!1,this._isBeAttackOver=!1;var i=this.getActionType();switch(i){case"rebound":this._curActionData.attacker.changeLayerDown(),t.once(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onAttackOver),t.once(t.FightStaticStr.ATTACK_REACTION_ANI_OVER,this,this.onBeAttakOver),this._curActionData.beAttacker.playReboundSkill(this._curActionData);break;case"none":this.gotoNextAction();break;default:this.gotoNextAction()}},e.prototype.getActionType=function(){var t="none";return this._curActionData.beAttackerSkill>0?"rebound":t},e.prototype.onAttackOver=function(){this._isBeAttackOver?this.gotoNextAction():this._isAttackPlayOver=!0},e.prototype.onBeAttakOver=function(){this._isAttackPlayOver?this.gotoNextAction():this._isBeAttackOver=!0},e.prototype.gotoNextAction=function(){t.dispatch(t.FightStaticStr.BEAT_BACK_ACTION,this._curActionData)},e}();t.ReboundController=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this.init()}return e.prototype.init=function(){t.addListener(t.FightStaticStr.MONSTER_ACTION,this,this.onEvent)},e.prototype.destroy=function(){t.removeListener(t.FightStaticStr.MONSTER_ACTION,this,this.onEvent),this._curActionData=null},e.prototype.onEvent=function(e){this._curActionData=e;var i=!1;this._leftShow=!1,this._rightShow=!1,this._curIndex=0;var s=this._curActionData.attacker.playerData.monsterData.getMonsterData();!t.Global.isRetrench&&this._curActionData.attacker.playerData.monsterData.haveMonster&&!this._curActionData.attacker.playerData.monsterData.monsterHaveShow&&s&&t.MonsterConfigData.monster[s.id+""]?(this._aniAttake=new t.AnimationSKe(t.ResPath().getEffect(t.MonsterConfigData.monster[s.id+""].effect+s.type),2),this._aniAttake.on(Laya.Event.STOPPED,this,this.onStopAttake,[s.id]),this._aniAttake.play("effect_show",!1),this._aniAttake.scaleX=this._curActionData.attacker.sideType==t.FightStaticStr.LEFT_SIDE?1:-1,this._aniAttake.x=this._curActionData.attacker.x,this._aniAttake.y=this._curActionData.attacker.y,t.FightUIView.playerLayer.addChild(this._aniAttake),this._aniAttake.playbackRate(t.FightController.TIME_SCALE),this._curActionData.attacker.playerData.monsterData.monsterHaveShow=!0,i=!0):this._leftShow=!0;var n=this._curActionData.beAttacker.playerData.monsterData.getMonsterData();!t.Global.isRetrench&&this._curActionData.beAttacker.playerData.monsterData.haveMonster&&!this._curActionData.beAttacker.playerData.monsterData.monsterHaveShow&&n&&t.MonsterConfigData.monster[n.id+""]?(this._aniBeattake=new t.AnimationSKe(t.ResPath().getEffect(t.MonsterConfigData.monster[n.id+""].effect+n.type),2),this._aniBeattake.on(Laya.Event.STOPPED,this,this.onStopBeattake,[n.id]),this._aniBeattake.play("effect_show",!1),this._aniBeattake.scaleX=this._curActionData.beAttacker.sideType==t.FightStaticStr.LEFT_SIDE?1:-1,this._aniBeattake.x=this._curActionData.beAttacker.x,this._aniBeattake.y=this._curActionData.beAttacker.y,t.FightUIView.playerLayer.addChild(this._aniBeattake),this._aniBeattake.playbackRate(t.FightController.TIME_SCALE),this._curActionData.beAttacker.playerData.monsterData.monsterHaveShow=!0,
i=!0):this._rightShow=!0,!t.Global.isRetrench&&2==this._curActionData.attackType&&s&&s.skill==this._curActionData.skill&&(this._curActionData.attacker.playerData.monsterData.monsterHaveShow=!1,this._curActionData.attacker.playerData.monsterData.curIndex++,t.dispatch(t.FightStaticStr.FIGHT_SHOW_MONSTER_LOGO,{type:this._curActionData.attacker.sideType,show:!1})),i||this.playPassiveSkill()},e.prototype.onStopAttake=function(e){this._leftShow=!0,this._curActionData.attacker.visible=!0,this._aniAttake.destroy(),this._aniAttake=null,t.dispatch(t.FightStaticStr.FIGHT_SHOW_MONSTER_LOGO,{id:e,type:this._curActionData.attacker.sideType,show:!0}),this._rightShow&&this.playPassiveSkill()},e.prototype.onStopBeattake=function(e){this._rightShow=!0,this._curActionData.beAttacker.visible=!0,this._aniBeattake.destroy(),this._aniBeattake=null,t.dispatch(t.FightStaticStr.FIGHT_SHOW_MONSTER_LOGO,{id:e,type:this._curActionData.beAttacker.sideType,show:!0}),this._leftShow&&this.playPassiveSkill()},e.prototype.playPassiveSkill=function(){if(this._passiveAttacker=!1,this._passiveBeAttacker=!1,!t.Global.isRetrench&&this._curActionData.attacker.playerData.monsterData.passiveList&&this._curActionData.attacker.playerData.monsterData.passiveList.length>0&&!this._curActionData.attacker.playerData.monsterData.haveShowPassive&&this._curIndex<this._curActionData.attacker.playerData.monsterData.passiveList.length){var e=this._curActionData.attacker.playerData.monsterData.passiveList[this._curIndex],i=this._curActionData.attacker.playerData.getSkillData(e.skill);this._aniAttake=new t.AnimationSKe(i.sourceUrl.replace(".sk",e.type+".sk"),2),this._aniAttake.on(Laya.Event.STOPPED,this,this.onPassiveAttacker),this._aniAttake.play(i.action,!1),this._aniAttake.scaleX=this._curActionData.attacker.sideType==t.FightStaticStr.LEFT_SIDE?1:-1,this._aniAttake.showSkinByName(1==this._curActionData.attacker.playerData.gender?"male":"female"),this._aniAttake.x=this._curActionData.attacker.x,this._aniAttake.y=this._curActionData.attacker.y,t.FightUIView.playerLayer.addChild(this._aniAttake),this._aniAttake.playbackRate(t.FightController.TIME_SCALE),this._aniAttake.scale(t.FightData.figherScale*this._aniAttake.scaleX,t.FightData.figherScale),this._curActionData.attacker.visible=!1}else this._curActionData.attacker.playerData.monsterData.haveShowPassive=!0,this._passiveAttacker=!0;if(!t.Global.isRetrench&&this._curActionData.beAttacker.playerData.monsterData.passiveList&&this._curActionData.beAttacker.playerData.monsterData.passiveList.length>0&&!this._curActionData.beAttacker.playerData.monsterData.haveShowPassive&&this._curIndex<this._curActionData.beAttacker.playerData.monsterData.passiveList.length){var e=this._curActionData.beAttacker.playerData.monsterData.passiveList[this._curIndex],i=this._curActionData.beAttacker.playerData.getSkillData(e.skill);this._aniBeattake=new t.AnimationSKe(i.sourceUrl.replace(".sk",e.type+".sk"),2),this._aniBeattake.on(Laya.Event.STOPPED,this,this.onPassiveBeAttacker),this._aniBeattake.play(i.action,!1),this._aniBeattake.scaleX=this._curActionData.beAttacker.sideType==t.FightStaticStr.LEFT_SIDE?1:-1,this._aniBeattake.showSkinByName(1==this._curActionData.beAttacker.playerData.gender?"male":"female"),this._aniBeattake.x=this._curActionData.beAttacker.x,this._aniBeattake.y=this._curActionData.beAttacker.y,t.FightUIView.playerLayer.addChild(this._aniBeattake),this._aniBeattake.playbackRate(t.FightController.TIME_SCALE),this._curActionData.beAttacker.visible=!1,this._aniBeattake.scale(t.FightData.figherScale*this._aniBeattake.scaleX,t.FightData.figherScale)}else this._curActionData.beAttacker.playerData.monsterData.haveShowPassive=!0,this._passiveBeAttacker=!0;this._passiveAttacker&&this._passiveBeAttacker&&this.gotoNextAction()},e.prototype.onPassiveAttacker=function(){this._passiveAttacker=!0,this._aniAttake.destroy(),this._aniAttake=null,this._passiveAttacker&&this._passiveBeAttacker&&(this._curIndex++,this.playPassiveSkill())},e.prototype.onPassiveBeAttacker=function(){this._passiveBeAttacker=!0,this._aniBeattake.destroy(),this._aniBeattake=null,this._passiveAttacker&&this._passiveBeAttacker&&(this._curIndex++,this.playPassiveSkill())},e.prototype.gotoNextAction=function(){this._curActionData.attacker.visible=!0,this._curActionData.beAttacker.visible=!0,t.dispatch(t.FightStaticStr.BEGIN_ACTION,this._curActionData)},e}();t.MonsterActionController=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this._delayTime=300,this._leftNeedDelay=0,this._rightNeedDelay=0,this.init()}return e.prototype.init=function(){t.addListener(t.FightStaticStr.FLOAT_WORD,this,this.onEvent)},e.prototype.destroy=function(){t.removeListener(t.FightStaticStr.FLOAT_WORD,this,this.onEvent)},e.prototype.onEvent=function(i){if(i.type!=e.WEAPON_FLOAT_WORD&&i.type!=e.ASSIST_SKILL_WORD){var s=0;s=i.target.sideType==t.FightStaticStr.LEFT_SIDE?this._leftNeedDelay:this._rightNeedDelay,s>0?(Laya.timer.once(s/t.FightController.TIME_SCALE,this,this.playFloat,[i],!1),s+=this._delayTime):(s+=this._delayTime,this.playFloat(i)),i.target.sideType==t.FightStaticStr.LEFT_SIDE?this._leftNeedDelay=s:this._rightNeedDelay=s}else this.playFloat(i)},e.prototype.playFloat=function(i){switch(i.type){case e.DAMAGE_FLOAT_WORD:var s=this.getDamageWord(),n=i.target.sideType==t.FightStaticStr.LEFT_SIDE?-1:1;t.FightUIView.flowLayer.addChild(s),s.showWord(""+Math.abs(i.num)),s.x=i.target.x+-1*n*s.imgWidth/2+(0>n?-1:0)*s.imgWidth,s.y=i.target.y-180;var a=new Laya.TimeLine;a.to(s,{y:s.y-1},300/t.FightController.TIME_SCALE).to(s,{y:s.y-100,alpha:0},1e3/t.FightController.TIME_SCALE).once(Laya.Event.COMPLETE,this,this.afterFloat,[s,i.target.sideType]),a.play();break;case e.ADD_FLOAT_WORD:var s=new t.ImageWord("assets/word/addhp/"),n=i.target.sideType==t.FightStaticStr.LEFT_SIDE?-1:1;t.FightUIView.flowLayer.addChild(s),s.showWord(""+Math.abs(i.num)),s.x=i.target.x+-1*n*s.imgWidth/2+(0>n?-1:0)*s.imgWidth,s.y=i.target.y-180;var a=new Laya.TimeLine;a.to(s,{y:s.y-1},300/t.FightController.TIME_SCALE).to(s,{y:s.y-100,alpha:0},1e3/t.FightController.TIME_SCALE).once(Laya.Event.COMPLETE,this,this.afterFloat,[s,i.target.sideType]),a.play();break;case e.MISS_FLOAT_WORD:var s=this.getDamageWord(),n=i.target.sideType==t.FightStaticStr.LEFT_SIDE?-1:1;t.FightUIView.flowLayer.addChild(s),s.showWord("闪"),s.x=i.target.x+-1*n*s.imgWidth/2+(0>n?-1:0)*s.imgWidth,s.y=i.target.y-180;var a=new Laya.TimeLine;a.to(s,{y:s.y-1},300/t.FightController.TIME_SCALE).to(s,{y:s.y-100,alpha:0},1e3/t.FightController.TIME_SCALE).once(Laya.Event.COMPLETE,this,this.afterFloat,[s,i.target.sideType]),a.play();break;case e.CRIT_FLOAT_WORD:var s=this.getCritWord(),n=i.target.sideType==t.FightStaticStr.LEFT_SIDE?-1:1;t.FightUIView.flowLayer.addChild(s),s.showWord(""+Math.abs(i.num),!1),s.x=i.target.x+(0>n?-1:0)*s.imgWidth,s.y=i.target.y-180;var o=Loader.getRes("assets/word/crit/bg.png");o&&(s.graphics.drawTexture(o,(s.imgWidth-o.width)/2,(s.imgHeight-o.height)/2),s.showWord(""+Math.abs(i.num),!1));var a=new Laya.TimeLine;a.to(s,{x:s.x-5},50/t.FightController.TIME_SCALE).to(s,{x:s.x+5},50/t.FightController.TIME_SCALE).to(s,{x:s.x-5},50/t.FightController.TIME_SCALE).to(s,{x:s.x+5},50/t.FightController.TIME_SCALE).to(s,{x:s.x-5},50/t.FightController.TIME_SCALE).to(s,{x:s.x+5},50/t.FightController.TIME_SCALE).to(s,{x:s.x-5},50/t.FightController.TIME_SCALE).to(s,{x:s.x+5},50/t.FightController.TIME_SCALE).to(s,{x:s.x-5},50/t.FightController.TIME_SCALE).to(s,{x:s.x+5},50/t.FightController.TIME_SCALE).to(s,{alpha:0},800/t.FightController.TIME_SCALE).once(Laya.Event.COMPLETE,this,this.afterFloat,[s,i.target.sideType]),a.play();break;case e.WEAPON_FLOAT_WORD:if(""==i.name)return;var s=this.getWeaponWord(),n=i.target.sideType==t.FightStaticStr.LEFT_SIDE?-1:1;t.FightUIView.flowLayer.addChild(s),s.showWord(""+i.name,!1,-10),s.x=i.target.x-s.imgWidth/2+250*n,s.y=i.target.y;var o=Loader.getRes("assets/word/weapon/di.png");o&&(s.graphics.drawTexture(o,(s.imgWidth-o.width)/2+20,(s.imgHeight-o.height)/2),s.showWord(""+i.name,!1,-10));var a=new Laya.TimeLine;a.to(s,{x:s.x-250*n},300/t.FightController.TIME_SCALE).to(s,{y:s.y+1},2e3/t.FightController.TIME_SCALE).to(s,{alpha:0},500/t.FightController.TIME_SCALE).on(Laya.Event.COMPLETE,this,this.afterFloat,[s,i.target.sideType,!1]),a.play();break;case e.ASSIST_SKILL_WORD:if(""==i.name)return;var s=this.getWeaponWord(),n=i.target.sideType==t.FightStaticStr.LEFT_SIDE?-1:1;t.FightUIView.flowLayer.addChild(s),s.showWord(""+i.name,!1,-10),s.x=i.target.x-s.imgWidth/2+250*n,s.y=i.target.y-170,s.scale(.6,.6);var a=new Laya.TimeLine;a.to(s,{x:s.x-160*n+30*(1+n)},300/t.FightController.TIME_SCALE).to(s,{y:s.y+1},2e3/t.FightController.TIME_SCALE).to(s,{alpha:0},500/t.FightController.TIME_SCALE).on(Laya.Event.COMPLETE,this,this.afterFloat,[s,i.target.sideType,!1]),a.play();break;case e.CHAIN_WORD:if(""==i.name)return;var s=this.getWeaponWord(),n=i.target.sideType==t.FightStaticStr.LEFT_SIDE?-1:1;t.FightUIView.flowLayer.addChild(s),s.showWord(""+i.name,!1,-10),s.x=i.target.x-s.imgWidth/2+250*n,s.y=i.target.y-300,s.scale(.6,.6);var a=new Laya.TimeLine;a.to(s,{x:s.x-160*n+30*(1+n)},300/t.FightController.TIME_SCALE).to(s,{y:s.y+1},2e3/t.FightController.TIME_SCALE).to(s,{alpha:0},500/t.FightController.TIME_SCALE).on(Laya.Event.COMPLETE,this,this.afterFloat,[s,i.target.sideType,!1]),a.play()}},e.prototype.afterFloat=function(e,i,s){void 0===s&&(s=!0),e&&e.parent&&(e.parent.removeChild(e),e.destroy()),s&&(i==t.FightStaticStr.LEFT_SIDE?this._leftNeedDelay-=this._delayTime:this._rightNeedDelay-=this._delayTime)},e.prototype.getDamageWord=function(){var e=new t.ImageWord("assets/word/damage/");return e},e.prototype.getCritWord=function(){var e=new t.ImageWord("assets/word/crit/");return e},e.prototype.getAddWord=function(){var e=new t.ImageWord("assets/word/addhp/");return e},e.prototype.getWeaponWord=function(){var e=new t.ImageWord("assets/word/weapon/");return e},e.prototype.getSkillWord=function(){var e=new t.ImageWord("assets/word/weapon/");return e},e.prototype.gotoNextAction=function(){},e.DAMAGE_FLOAT_WORD="DAMAGE_FLOAT_WORD",e.CRIT_FLOAT_WORD="CRIT_FLOAT_WORD",e.ADD_FLOAT_WORD="ADD_FLOAT_WORD",e.WEAPON_FLOAT_WORD="WEAPON_FLOAT_WORD",e.MISS_FLOAT_WORD="MISS_FLOAT_WORD",e.ASSIST_SKILL_WORD="ASSIST_SKILL_WORD",e.CHAIN_WORD="CHAIN_WORD",e}();t.FloatWordController=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this.init()}return Object.defineProperty(e.prototype,"curBattleData",{set:function(e){this._curBattleData=e,t.FightData.isRealFight&&this.updatePlayerData()},enumerable:!0,configurable:!0}),e.prototype.init=function(){t.addListener(t.FightStaticStr.FIGHT_USE_SIMULATOR,this,this.onUse),t.addListener(t.FightStaticStr.FIGHT_SELECT_ACTION,this,this.onSelect)},e.prototype.updatePlayerData=function(){this.leftPlayerDataList=[],this.rightPlayerDataList=[];for(var t in this._curBattleData.playerDataList[0].weaponMap){var e=this._curBattleData.playerDataList[0].weaponMap[t];this.leftPlayerDataList.push({id:2e5+e.id,level:e.level})}for(var t in this._curBattleData.playerDataList[0].skillMap){var e=this._curBattleData.playerDataList[0].skillMap[t];this.leftPlayerDataList.push({id:3e5+e.id,level:e.level})}for(var t in this._curBattleData.playerDataList[1].weaponMap){var e=this._curBattleData.playerDataList[1].weaponMap[t];this.rightPlayerDataList.push({id:2e5+e.id,level:e.level})}for(var t in this._curBattleData.playerDataList[1].skillMap){var e=this._curBattleData.playerDataList[1].skillMap[t];this.rightPlayerDataList.push({id:3e5+e.id,level:e.level})}},e.prototype.onUse=function(){var e=[];if(Math.random()>.5){this.attakeSide="L",this.beAttakeSide="R";for(var i=0;2>i;i++)this.leftPlayerDataList.length>0?e.push(this.leftPlayerDataList[Math.floor(Math.random()*this.leftPlayerDataList.length)]):e.push({id:0,level:1})}else{this.attakeSide="R",this.beAttakeSide="L";for(var i=0;2>i;i++)this.rightPlayerDataList.length>0?e.push(this.rightPlayerDataList[Math.floor(Math.random()*this.leftPlayerDataList.length)]):e.push({id:0,level:1})}t.dispatch(t.FightStaticStr.FIGHT_UPDATE_SIMULATOR_SKILL,[e])},e.prototype.onSelect=function(e){var i=Math.ceil(1e4*Math.random());if(e.id>3e5)var s="A2:"+this.attakeSide+",0|0,0,1,"+(e.id-3e5)+",2,"+i+",2,,,,0,"+this.beAttakeSide+",0,0,0,0,,,,,0";else var s="A2:"+this.attakeSide+",0|0,0,1,"+(e.id-2e5)+",0,"+i+",2,,,,0,"+this.beAttakeSide+",0,0,0,0,,,,,0";var n=new t.ActionData(s,this._curBattleData,"PL"+Math.ceil(3*Math.random()),"PR"+Math.ceil(3*Math.random()));t.dispatch(t.FightStaticStr.FIGHT_GET_ACTION_DATA,n)},e}();t.FightSimulator=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(e){this._fightUI=e,t.addListener(t.FightStaticStr.FIGHT_WORD_SHOW,this,this.onShowHideWord),this._faceSkeleton=new t.AnimationSKe("assets/skeleton/biaoqing.sk"),this._activeTalkMap={weapon_17_0:"让你尝尝厉害~",weapon_1_0:"镰刀镰刀，谁最厉害？！",weapon_1_6:"镰刀镰刀，谁最厉害？！",weapon_4_0:"瞧瞧，神弓发威了！",weapon_4_6:"瞧瞧，神弓发威了！",weapon_5_0:"颤抖吧，小虾米！",weapon_5_6:"颤抖吧，小虾米！",weapon_6_0:"铁铲铁铲，收了他！\n(>皿<)",weapon_6_6:"洛阳铲的滋味可不好受~",weapon_12_0:"吃我一板砖\n一 一+",weapon_12_6:"试试被土豪金砸的赶脚",weapon_13_0:"别拿水枪不当家伙！",weapon_14_0:"敢不敢尝尝我的汽水~嘿嘿",weapon_14_6:"敢不敢尝尝我的汽水~嘿嘿",weapon_15_0:"天灵灵地灵灵，飞刀快显灵~",weapon_15_6:"天灵灵地灵灵，飞刀快显灵~",weapon_16_0:"我的剑已经按耐不住了~",weapon_16_6:"我的剑已经按耐不住了~",weapon_20_0:"扳手可不是盖的~\n(ˋ＾ˊ) ",weapon_20_6:"扳手可不是盖的~\n(ˋ＾ˊ) ",weapon_27_0:"扇一扇，拿命来~",weapon_27_6:"扇一扇，拿命来~"},this._passiveTalkMap={weapon_8_0:"好多小星星\n@_@|||||.",weapon_8_6:"好多小星星\n@_@|||||.",weapon_9_0:"555，我的小心脏~",weapon_9_6:"555，我的小心脏~",weapon_10_0:"要不起~要不起~",weapon_10_6:"要不起~要不起~",weapon_13_6:"呃.....晕乎晕乎\n( >﹏< )",weapon_22_0:"居然被甩了一锅~\n+_+",weapon_22_6:"居然被甩了一锅~\n+_+"},this._beforeWord=[["皮皮虾,还不投降！","我已等你多时~"],["我会怕你吗！","小子，别废话，用实力说话吧！"],["我不做大哥好多年","那就让你涨涨新姿势吧！"],["跪地求饶我就不打脸~","哼！不要小看哥~"],["噜噜噜，你打不过我的！","我是来给你松松皮的"],["我要代表月亮消灭你！","呃....说人话！"]],this._winWordArr=["不要羡慕本宝宝!","这么菜，还敢跟我斗~","武林高手就是我！"],this._loseWordArr=["等我修炼回来报仇雪恨！","君子报仇，十年不晚~","今日一败，必将雪耻！","5555，等我换个姿势再战！"]}return e.prototype.destroy=function(){t.removeListener(t.FightStaticStr.FIGHT_WORD_SHOW,this,this.onShowHideWord),this._faceSkeleton&&this._faceSkeleton.destroy()},e.prototype.onShowHideWord=function(e){switch(e.type){case 0:this.hideAllWord();break;case 1:var i=Math.floor(Math.random()*this._beforeWord.length);this._fightUI.leftWord.visible=!0,this._fightUI.rightWord.visible=!0,this._fightUI.leftWordTxt.text=this._beforeWord[i][0],this._fightUI.rightWordTxt.text=this._beforeWord[i][1],this.changeTalkY(e.top1,"left"),this.changeTalkY(e.top2,"right"),Laya.timer.once(4e3/t.FightController.TIME_SCALE,this,this.hideAllWord);break;case 2:var s=e.win?this._winWordArr:this._loseWordArr,i=Math.floor(Math.random()*s.length);this._fightUI.leftWordTxt.text=s[i],this._fightUI.leftWord.visible=!0,this._fightUI.leftFace.visible=!1,this.changeTalkY(e.top,"left"),Laya.timer.once(2e3/t.FightController.TIME_SCALE,this,this.hideAllWord);break;case 3:var n=this.getActiveTalk(e.id,e.level,e.typeCode);if(n){var a=e.side==t.FightStaticStr.LEFT_SIDE?"left":"right";this._fightUI[a+"WordTxt"].text=n,this._fightUI[a+"Word"].visible=!0,this._fightUI[a+"Face"].visible=!1,this.changeTalkY(e.top,a),Laya.timer.once(2e3/t.FightController.TIME_SCALE,this,this.hideAllWord)}break;case 4:if(12==e.skill){var a=e.side==t.FightStaticStr.LEFT_SIDE?"left":"right";this._fightUI[a+"WordTxt"].text="我要发大招了！",this._fightUI[a+"Word"].visible=!0,this._fightUI[a+"Face"].visible=!1,this.changeTalkY(e.top,a),Laya.timer.once(2e3/t.FightController.TIME_SCALE,this,this.hideAllWord)}break;case 5:this._fightUI.leftFace.visible=!1,this._fightUI.leftWord.visible=!1,this._fightUI.rightFace.visible=!1,this._fightUI.rightWord.visible=!1;var a=e.side==t.FightStaticStr.LEFT_SIDE?"left":"right";this._fightUI[a+"Face"].visible=!0,this._fightUI[a+"Word"].visible=!1,this.changeTalkY(e.top,a),this._fightUI[a+"Face"].addChild(this._faceSkeleton),this._faceSkeleton.play("tushetou",!0),this._faceSkeleton.y=95,"left"==a?(this._faceSkeleton.scaleX=1,this._faceSkeleton.x=70):(this._faceSkeleton.scaleX=-1,this._faceSkeleton.x=70),Laya.timer.once(2e3/t.FightController.TIME_SCALE,this,this.hideAllWord);break;case 6:case 10:this._fightUI.leftFace.visible=!1,this._fightUI.leftWord.visible=!1,this._fightUI.rightFace.visible=!1,this._fightUI.rightWord.visible=!1;var a=e.side==t.FightStaticStr.LEFT_SIDE?"left":"right";this._fightUI[a+"Face"].visible=!0,this._fightUI[a+"Word"].visible=!1,this.changeTalkY(e.top,a),this._fightUI[a+"Face"].addChild(this._faceSkeleton),this._faceSkeleton.play("huaixiao",!0),this._faceSkeleton.y=95,"left"==a?(this._faceSkeleton.scaleX=1,this._faceSkeleton.x=70):(this._faceSkeleton.scaleX=-1,this._faceSkeleton.x=70),Laya.timer.once(2e3/t.FightController.TIME_SCALE,this,this.hideAllWord);break;case 7:var a=e.side==t.FightStaticStr.LEFT_SIDE?"left":"right";this._fightUI[a+"WordTxt"].text="呜呜~差点就没小命了",this._fightUI[a+"Word"].visible=!0,this._fightUI[a+"Face"].visible=!1,this.changeTalkY(e.top,a),Laya.timer.once(2e3/t.FightController.TIME_SCALE,this,this.hideAllWord);break;case 8:var a=e.side==t.FightStaticStr.LEFT_SIDE?"left":"right";this._fightUI[a+"WordTxt"].text="这是什么鬼！",this._fightUI[a+"Word"].visible=!0,this._fightUI[a+"Face"].visible=!1,this.changeTalkY(e.top,a),Laya.timer.once(2e3/t.FightController.TIME_SCALE,this,this.hideAllWord);break;case 9:var n=this.getPassiveTalk(e.id,e.level,e.typeCode);if(n){var a=e.side==t.FightStaticStr.LEFT_SIDE?"left":"right";this._fightUI[a+"WordTxt"].text=n,this._fightUI[a+"Word"].visible=!0,this._fightUI[a+"Face"].visible=!1,this.changeTalkY(e.top,a),Laya.timer.once(2e3/t.FightController.TIME_SCALE,this,this.hideAllWord)}}},e.prototype.changeTalkY=function(e,i){"left"==i?(this._fightUI.leftWord.y=t.FightData.fighterY-e-100-20,this._fightUI.leftFace.y=t.FightData.fighterY-e-120-20):(this._fightUI.rightWord.y=t.FightData.fighterY-e-100-20,this._fightUI.rightFace.y=t.FightData.fighterY-e-120-20)},e.prototype.hideAllWord=function(){this._fightUI.leftFace.visible=!1,this._fightUI.leftWord.visible=!1,this._fightUI.rightFace.visible=!1,this._fightUI.rightWord.visible=!1,this._faceSkeleton&&(this._faceSkeleton.stop(),this._faceSkeleton.parent&&this._faceSkeleton.parent.removeChild(this._faceSkeleton))},e.prototype.getActiveTalk=function(t,e,i){var s=i+"_"+t+"_"+(6>e?0:10>e?6:10);return this._activeTalkMap[s]?this._activeTalkMap[s]:""},e.prototype.getPassiveTalk=function(t,e,i){var s=i+"_"+t+"_"+(6>e?0:10>e?6:10);return this._passiveTalkMap[s]?this._passiveTalkMap[s]:""},e}();t.FightingTalkController=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this.init()}return e.prototype.init=function(){},e.prototype.destroy=function(){t.removeListener(t.FightStaticStr.BEGIN_ACTION,this,this.onEvent),t.removeListener(t.FightStaticStr.CHAIN_ACTION,this,this.onEvent),t.removeListener(t.FightStaticStr.RUN_ACTION,this,this.onEvent),t.removeListener(t.FightStaticStr.ATTACK_ACTION,this,this.onEvent),t.removeListener(t.FightStaticStr.SKILL_PLAY_OVER,this,this.onEvent),t.removeListener(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onEvent),t.removeListener(t.FightStaticStr.ATTACK_REACTION_ANI_OVER,this,this.onEvent),t.removeListener(t.FightStaticStr.REBOUND_ACTION,this,this.onEvent),t.removeListener(t.FightStaticStr.BEAT_BACK_ACTION,this,this.onEvent),t.removeListener(t.FightStaticStr.AFTER_ATTACK_ACTION,this,this.onEvent),t.removeListener(t.FightStaticStr.END_ALL_ACTION,this,this.onEnd)},e.prototype.onEvent=function(){Laya.timer.once(6e3,this,this.onFightTimeOver,null,!0)},e.prototype.onFightTimeOver=function(){var e=this.fightStr.replace(/&/g,"#");t.Report.errorReport({title:"战斗卡住:"+t.GameSleep().isSleep+"-"+t.Global.isRetrench,content:encodeURIComponent(e)})},e.prototype.onEnd=function(){Laya.timer.frameOnce(1,this,this.delayClear)},e.prototype.delayClear=function(){Laya.timer.clear(this,this.onFightTimeOver)},e}();t.FightCrashCheckController=e}(hf||(hf={}));var hf;!function(t){var e=laya.utils.Handler,i=function(){function i(){this._curBattleIndex=0,this._bg=0,this._leftOut=!1,this._rightOut=!1,this._skipFight=!1,this._screenView=new t.ScreenView,this._fightView=new t.FightUIView,this.initController()}return i.prototype.initController=function(){this._actionBegin=new t.ActionBeginController,this._floatWordC=new t.FloatWordController,this._fightData=new t.FightData,this._uiController=new t.UIController,this._buffC=new t.BuffController,this._effectC=new t.EffectController,this._simulator=new t.FightSimulator},i.prototype.destroy=function(){t.removeListener(t.FightStaticStr.AFTER_FIGHT_COMPLETE,this,this.onClose),t.removeListener(t.FightStaticStr.SKIP_FIGHT,this,this.onSkip),t.removeListener(t.FightStaticStr.END_ALL_ACTION,this,this.onActionEnd),this._actionBegin.destroy(),this._floatWordC.destroy(),this._uiController.destroy(),this._buffC.destroy(),this._effectC.destroy(),this._fightView&&this._fightView.destroy(),this._fightView=null},i.prototype.onClose=function(){t.removeListener(t.FightStaticStr.AFTER_FIGHT_COMPLETE,this,this.onClose),t.removeListener(t.FightStaticStr.SKIP_FIGHT,this,this.onSkip),t.removeListener(t.FightStaticStr.FIGHT_GET_ACTION_DATA,this,this.onGetAction),this._screenView&&this._screenView.parent&&this._screenView.parent.removeChild(this._screenView),this._fightView&&(this._fightView.parent&&this._fightView.parent.removeChild(this._fightView),this._fightView.clearUI());for(var e in this._curBattleData.fighterMap)this._curBattleData.fighterMap[e].destroy(),this._curBattleData.fighterMap[e]=null;this._curBattleData.fighterList.length=0,t.ResData.realeseRes();var s=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);s&&(s.fightSpeed=i.TIME_SCALE),t.LayerMgr.endFightshowOtherLayer(),t.dispatch(t.MainView.MAIN_VIEW_SOUND)},i.prototype.gotoFight=function(e,i,s,n){void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=!1),t.addListener(t.FightStaticStr.AFTER_FIGHT_COMPLETE,this,this.onClose),t.addListener(t.FightStaticStr.SKIP_FIGHT,this,this.onSkip),t.addListener(t.FightStaticStr.FIGHT_GET_ACTION_DATA,this,this.onGetAction),t.LayerMgr.enterFightHideOtherLayer(),this._awardData=i,this._fightCommand=s,this._isDayFirstWin=n,t.LayerMgr.addChild(this._screenView,t.Layer.FIGHT),this._skipFight=!1,this._fightView.init(),this.initData(e)},i.prototype.initData=function(e){t.dispatch(t.FightStaticStr.FIGHT_START),this._fightData.initData(e),this._curBattleIndex=0,this.startBattle()},i.prototype.loadRes=function(){this._bg=this._fightData.bg,t.once(t.FightStaticStr.FIGHT_RESDATA_LOADED,this,this.onResLoaded),t.ResData.iniRes(this._curBattleData,this._bg)},i.prototype.onResLoaded=function(){this._fightView.initBg(this._bg),t.LayerMgr.addChild(this._fightView,t.Layer.FIGHT),this._screenView.parent&&this._screenView.parent.addChild(this._screenView),0==this._curBattleIndex?(t.once(t.FightStaticStr.SCREEN_OVER,this,this.playDrama),this._screenView.playScreen()):(this.startReady(),Laya.timer.once(3e3/i.TIME_SCALE,this,this.playRounds))},i.prototype.playDrama=function(){if(this._fightCommand&&""!=this._fightCommand.plot_id_begin){var e=new t.PlayDramaCmd;e.id=this._fightCommand.plot_id_begin,e.on(this,this.onDramaOver),t.facade().callCommand(e),t.Logger.log("请求播放剧情")}else this.onDramaOver()},i.prototype.onDramaOver=function(e){void 0===e&&(e=null),e&&(t.Logger.log("播放剧情结束"),e.off()),t.once(t.FightStaticStr.READY_FIGHT_START,this,this.playRounds),new t.BeginText,this.startReady(),t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:1,top1:this._curBattleData.playerDataList[0].npcData.top,top2:this._curBattleData.playerDataList[1].npcData.top})},i.prototype.startReady=function(){t.dispatch(t.FightStaticStr.PLAY_FIGHT_SOUND),t.ActionData.chainData.clearData(),this._fightView.prepareBattle(this._curBattleData),this._fightView.updateFactionTom(this._curBattleData.playerDataList[0],this._curBattleData.playerDataList[1]);for(var e in this._curBattleData.fighterMap)this._curBattleData.fighterMap[e].visible=!0,this._curBattleData.fighterMap[e].playWarmUp()},i.prototype.startBattle=function(){this._curBattleIndex<this._fightData.battleArr.length?(this._lastBattleData=this._curBattleData,this._curBattleData=this._fightData.battleArr[this._curBattleIndex],this._simulator.curBattleData=this._curBattleData,0!=this._curBattleIndex?this.playOutBattle():(this._fightView.updateUI(this._curBattleData),this.loadRes())):this.playBattleOver()},i.prototype.playOutBattle=function(){this._leftOut=!1,this._rightOut=!1,this._lastBattleData.playerDataList[0].uin!=this._curBattleData.playerDataList[0].uin?Laya.Tween.to(this._lastBattleData.fighterList[0],{x:-200,y:-200,rotation:360},400/i.TIME_SCALE,null,e.create(this,this.onOutFinish,["L"])):this._leftOut=!0,this._lastBattleData.playerDataList[1].uin!=this._curBattleData.playerDataList[1].uin?Laya.Tween.to(this._lastBattleData.fighterList[1],{x:1534,y:-200,rotation:-360},400/i.TIME_SCALE,null,e.create(this,this.onOutFinish,["R"])):this._rightOut=!0},i.prototype.onOutFinish=function(t){if("L"==t&&(this._lastBattleData.fighterList[0].destroy(),this._lastBattleData.fighterList[0]=null,this._lastBattleData.fighterList.splice(0,1),this._leftOut=!0,this._fightView.clearBuff(t),1==this._fightData.fightMode&&this._fightView.clearBuff("R")),"R"==t&&(this._lastBattleData.fighterList[1].destroy(),this._lastBattleData.fighterList[1]=null,this._lastBattleData.fighterList.splice(1,1),this._rightOut=!0,this._fightView.clearBuff(t),1==this._fightData.fightMode&&this._fightView.clearBuff("L")),this._rightOut&&this._leftOut){this._fightView.updateUI(this._curBattleData),this.loadRes();for(var e=0;e<this._lastBattleData.fighterList.length;e++)this._lastBattleData.fighterList[e].destroy(),this._lastBattleData.fighterList[e]=null}},i.prototype.playRounds=function(){this._curBattleData.getNextAction()},i.prototype.onGetAction=function(e){if(null==e||this._skipFight)this.battleDataSave(),t.Logger.log("单场战斗结束"),this._curBattleIndex++,this.startBattle();else{this._fightView.showRound(e.roundIndex);for(var i=0;i<this._curBattleData.fighterList.length;i++)this._curBattleData.fighterList[i].curActionData=e;this.playOnceAction(e)}},i.prototype.battleDataSave=function(){for(var t=0;t<this._curBattleData.playerDataList.length;t++)this._curBattleData.playerDataList[t].dataSave()},i.prototype.playOnceAction=function(e){t.addListener(t.FightStaticStr.END_ALL_ACTION,this,this.onActionEnd),t.dispatch(t.FightStaticStr.BEGIN_ACTION,e)},i.prototype.onActionEnd=function(){t.removeListener(t.FightStaticStr.END_ALL_ACTION,this,this.onActionEnd),this._skipFight?this.playBattleOver():this.playRounds()},i.prototype.onSkip=function(){this._skipFight=!0},i.prototype.playBattleOver=function(){this._skipFight=!1,Math.random()>.5?t.SoundController.playLostSound():t.SoundController.playWinSound(),this._fightView.showEndWord(this._fightData.result);for(var e=0;e<this._curBattleData.fighterList.length;e++)this._curBattleData.fighterList[e].sideType==this._fightData.winSide?this._curBattleData.fighterList[e].playWin():this._curBattleData.fighterList[e].playLost();t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:2,win:this._fightData.winSide==t.FightStaticStr.LEFT_SIDE,top:this._curBattleData.playerDataList[0].npcData.top}),Laya.timer.once(2e3/i.TIME_SCALE,this,this.playEndDrama)},i.prototype.playEndDrama=function(){if(this._fightData.winSide==t.FightStaticStr.LEFT_SIDE&&this._fightCommand&&""!=this._fightCommand.plot_id_end){var e=new t.PlayDramaCmd;e.id=this._fightCommand.plot_id_end,e.on(this,this.battleOver),t.facade().callCommand(e),t.Logger.log("请求播放剧情")}else this.battleOver()},i.prototype.battleOver=function(e){void 0===e&&(e=null),e&&(t.Logger.log("播放剧情结束"),e.off());for(var i=0;i<this._curBattleData.fighterList.length;i++)this._curBattleData.fighterList[i].changeRate(1),this._curBattleData.fighterList[i].visible=!1,this._curBattleData.fighterList[i].playStand();t.Logger.log("战斗结束"),t.dispatch(t.FightStaticStr.IS_FIGHT_COMPLETE,{win:this._fightData.winSide==t.FightStaticStr.LEFT_SIDE,award:this._awardData,battleType:this._fightData.fightType,isDayFirstWin:this._isDayFirstWin})},i.TIME_SCALE=1,i.IS_REPLAY=!1,i}();t.FightController=i}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this.init()}return e.prototype.init=function(){t.addListener(t.FightStaticStr.EFFECT_ACTION,this,this.onEvent)},e.prototype.destroy=function(){t.removeListener(t.FightStaticStr.EFFECT_ACTION,this,this.onEvent)},e.prototype.onEvent=function(t){this._curActionData=t.action;var i;switch(t.type){case e.EFFECT_BEFORE_ACTION:i=["1"];break;case e.EFFECT_BEFORE_SELECT:i=["2"];break;case e.EFFECT_AFTER_SELECT:i=["3"];break;case e.EFFECT_BEFORE_ATTACK:i=["4"];break;case e.EFFECT_ATTACKING:i=["4","5","6","7","8","13","16"];break;case e.EFFECT_AFTER_ATTACKING:i=["10"];break;case e.EFFECT_AFTER_ACTION:i=["11","17"]}if(i)for(var s,n=i.length,a=0;n>a;a++){if(s=this._curActionData.effectObj[i[a]])for(var o=0;o<s.length;o++)-1!=t.side.indexOf(s[o][0])&&this.handleEffect(this._curActionData.attacker,this._curActionData.beAttacker,s[o]);if(s=this._curActionData.beAttackerEffectObj[i[a]])for(var o=0;o<s.length;o++)-1!=t.side.indexOf(s[o][0])&&this.handleEffect(this._curActionData.beAttacker,this._curActionData.attacker,s[o])}},e.prototype.handleEffect=function(t,e,i){switch(i[1]){case"1":this.hitDropWeapon(e,i);break;case"2":this.throwWeapon(t,i);break;case"3":this.addHP(t,parseInt(i[2]));break;case"4":this.addHP(t,parseInt(i[2]));break;case"6":this.subHP(t,parseInt(i[2]));break;case"7":this.addHP(t,parseInt(i[2]));break;case"10":this.subHP(t,parseInt(i[2]))}},e.prototype.addHP=function(e,i){if(i>0){e.playerData.curStateData.addHP(i);t.dispatch(t.FightStaticStr.ADD_HP,{addNum:i,type:e.sideType}),t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:e,type:t.FloatWordController.ADD_FLOAT_WORD,num:i})}},e.prototype.subHP=function(e,i){if(i>0){var s=e.playerData.curStateData.subHP(i);t.dispatch(t.FightStaticStr.SUB_HP,{subNum:i,type:e.sideType}),t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:e,type:t.FloatWordController.DAMAGE_FLOAT_WORD,num:i}),0>=s&&t.dispatch(t.FightStaticStr.FIGHT_SHAM_DEAD_EFFECT)}},e.prototype.hitDropWeapon=function(e,i){for(var s=i.length,n=[],a=0;s>a;a++)a>1&&(n.push(parseInt(i[a])),t.dispatch(t.FightStaticStr.THROW_WEAPON,{weaponId:parseInt(i[a]),sideType:e.sideType}));e.hitDropWeapon(n)},e.prototype.throwWeapon=function(e,i){for(var s=i.length,n=0;s>n;n++)n>1&&t.dispatch(t.FightStaticStr.THROW_WEAPON,{weaponId:parseInt(i[n]),sideType:e.sideType})},e.prototype.gotoNextAction=function(){},e.EFFECT_BEFORE_ACTION=1,e.EFFECT_BEFORE_SELECT=2,e.EFFECT_AFTER_SELECT=3,e.EFFECT_BEFORE_ATTACK=4,e.EFFECT_ATTACKING=5,e.EFFECT_AFTER_ATTACKING=6,e.EFFECT_AFTER_ACTION=7,e}();t.EffectController=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this.init()}return e.prototype.init=function(){t.addListener(t.FightStaticStr.CHAIN_ACTION,this,this.onEvent),t.addListener(t.FightStaticStr.FIGHT_DRAMA_START,this,this.onDrama)},e.prototype.destroy=function(){t.removeListener(t.FightStaticStr.CHAIN_ACTION,this,this.onEvent),t.removeListener(t.FightStaticStr.FIGHT_DRAMA_START,this,this.onDrama),this._curActionData=null},e.prototype.onDrama=function(e){var i=new t.PlayDramaCmd(e);i.on(this,this.onDramaFinish),t.Facade.callCommand(i)},e.prototype.onDramaFinish=function(e){e.off(),t.dispatch(t.FightStaticStr.FIGHT_DRAMA_END)},e.prototype.onEvent=function(e){this._curActionData=e,t.ActionData.chainData.playChainSkill?(t.addListener(t.FightStaticStr.FIGHT_CHAIN_ANI_END,this,this.onAniEnd),t.dispatch(t.FightStaticStr.FIGHT_CHAIN_ANI)):this.gotoNextAction()},e.prototype.onAniEnd=function(){t.removeListener(t.FightStaticStr.FIGHT_CHAIN_ANI_END,this,this.onAniEnd),this._skeAni=new t.AnimationSKe(t.ResPath().getEffect("effect_combo")),this._skeAni.on(Laya.Event.ERROR,this,this.onStop),this._skeAni.once(Laya.Event.STOPPED,this,this.onStop),1==t.ActionData.chainData.skillLevel?this._skeAni.play("effect_pos_l",!1):2==t.ActionData.chainData.skillLevel?this._skeAni.play("effect_pos_m",!1):this._skeAni.play("effect_pos_h",!1),
t.FightUIView.bottomSkillLayer.addChild(this._skeAni),this._skeAni.x=this._curActionData.attacker.x,this._skeAni.y=this._curActionData.attacker.y,this._skeAni.scaleX=this._curActionData.attacker.scaleX,this._skeAni.scaleY=this._curActionData.attacker.scaleY,1==this._curActionData.attacker.playerData.gender?this._skeAni.showSkinByName("male"):this._skeAni.showSkinByName("female"),this._curActionData.attacker.visible=!1},e.prototype.onStop=function(){t.FightUIView.bottomSkillLayer.removeChild(this._skeAni),this._skeAni.destroy(),this._skeAni=null,this._curActionData.attacker.visible=!0,t.FightModule.isChainDrama?(t.FightModule.isChainDrama=!1,t.once(t.FightStaticStr.FIGHT_DRAMA_END,this,this.gotoNextAction),t.dispatch(t.FightStaticStr.FIGHT_DRAMA_START,"1054")):this.gotoNextAction()},e.prototype.gotoNextAction=function(){t.dispatch(t.FightStaticStr.RUN_ACTION,this._curActionData)},e}();t.ChainSkillController=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this.init()}return e.prototype.init=function(){t.addListener(t.FightStaticStr.BUFF_ACTION,this,this.onEvent)},e.prototype.destroy=function(){t.removeListener(t.FightStaticStr.BUFF_ACTION,this,this.onEvent)},e.prototype.onEvent=function(t){this._curActionData=t.action,this._curData=t;var e;switch(t.type){case 0:e=[1,2];break;case 1:e=[3];break;case 2:e=[2];break;case 3:e=[3];break;case 4:e=[4];break;case 5:e=[5,6,7,8];break;case 9:e=[11,17];break;case 10:e=[10]}if(e)for(var i,s=e.length,n=0;s>n;n++){if(i=this._curActionData.buffObj["buff"+e[n]])for(var a=0;a<i.length;a++)this.handleBuff(this._curActionData.attacker,i[a]);if(i=this._curActionData.dBuffObj["buff"+e[n]])for(var a=0;a<i.length;a++)this.handleBuff(this._curActionData.attacker,i[a],0);if(i=this._curActionData.beAttackerBuffObj["buff"+e[n]])for(var a=0;a<i.length;a++)this.handleBuff(this._curActionData.beAttacker,i[a]);if(i=this._curActionData.beAttackerdBuffObj["buff"+e[n]])for(var a=0;a<i.length;a++)this.handleBuff(this._curActionData.beAttacker,i[a],0)}},e.prototype.handleBuff=function(e,i,s){if(void 0===s&&(s=1),!i[2]||-1!=this._curData.side.indexOf(i[2])){var n=parseInt(i[1]);1==s?t.dispatch(t.FightStaticStr.ADD_BUFF,{buffId:n,sideType:e.sideType}):t.dispatch(t.FightStaticStr.DELETE_BUFF,{buffId:n,sideType:e.sideType})}},e.prototype.gotoNextAction=function(){},e.BEFORE_GET_WEAPON=0,e.AFTER_GET_WEAPON=1,e.BEFORE_SKILL=2,e.AFTER_SKILL=3,e.BEFORE_ATTACKING=4,e.ATTACKING=5,e.AFTER_ATTACKING=6,e.BEAT_BACK_ATTACKING=7,e.BEAT_BACK_AFTER_ATTACKING=8,e.AFTER_ACTION=9,e.AFTER_ATTACK=10,e}();t.BuffController=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this._isAttackPlayOver=!1,this._isBeAttackOver=!1,this.init()}return e.prototype.init=function(){t.addListener(t.FightStaticStr.BEAT_BACK_ACTION,this,this.onEvent)},e.prototype.destroy=function(){t.removeListener(t.FightStaticStr.BEAT_BACK_ACTION,this,this.onEvent),this._curActionData=null},e.prototype.onEvent=function(t){switch(this._curActionData=t,this._type=this.getActionType(),"none"!=this._type&&this._curActionData.attacker.changeLayerDown(),this._type){case"beatBack":this.controlBeatBack();break;case"beatBacknpc":this.controlBeatBackNPC();break;case"npcBeatBack":this.controlNPCBeatBack();break;case"none":this.gotoNextAction();break;default:this.gotoNextAction()}},e.prototype.getActionType=function(){var t="none";return 1==this._curActionData.beatBack?0==this._curActionData.attacker.playerData.utype||this.checkWeaponEffect()?0!=this._curActionData.beAttacker.playerData.utype||this.getEffectWeaponBeatBack()?"npcBeatBack":"beatBack":"beatBacknpc":t},e.prototype.getEffectWeaponBeatBack=function(){return!(0!=this._curActionData.attacker.playerData.utype||!this.checkWeaponEffect())},e.prototype.checkWeaponEffect=function(){return!!(this._curActionData.beAttacker.playerData.curStateData.curWeapon>0&&this._curActionData.beAttacker.playerData.getWeaponData(this._curActionData.beAttacker.playerData.curStateData.curWeapon).skillUrl)},e.prototype.controlBeatBack=function(){t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this._curActionData.beAttacker,type:t.FloatWordController.ASSIST_SKILL_WORD,name:"反击"}),this._isAttackPlayOver=!1,this._isBeAttackOver=!1,t.once(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onAttackOver),t.once(t.FightStaticStr.ATTACK_REACTION_ANI_OVER,this,this.onBeAttakOver),this._curActionData.beAttacker.playerData.curStateData.curWeapon>0?this._curActionData.beAttacker.playWeaponAttack(this._curActionData,!0):this._curActionData.beAttacker.playNormalAttack(this._curActionData,!0)},e.prototype.controlBeatBackNPC=function(){t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this._curActionData.beAttacker,type:t.FloatWordController.ASSIST_SKILL_WORD,name:"反击"}),0==this._curActionData.beAttacker.playerData.utype?0==this._curActionData.beAttacker.playerData.curStateData.curWeapon?(this._curActionData.beAttacker.playRun(),Laya.Tween.to(this._curActionData.beAttacker,{x:this._curActionData.beAttacker.moveX},t.FightData.runTime/t.FightController.TIME_SCALE,null,Laya.Handler.create(this,this.onRunBack))):(this._curActionData.beAttacker.playRunWithWeapon(),Laya.Tween.to(this._curActionData.beAttacker,{x:this._curActionData.beAttacker.moveX},t.FightData.runTime/t.FightController.TIME_SCALE,null,Laya.Handler.create(this,this.onRunBack))):this.controlBeatBack()},e.prototype.controlNPCBeatBack=function(){t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this._curActionData.beAttacker,type:t.FloatWordController.ASSIST_SKILL_WORD,name:"反击"}),Laya.Tween.to(this._curActionData.attacker,{x:this._curActionData.attacker.srcX},t.FightData.runTime/t.FightController.TIME_SCALE,null,Laya.Handler.create(this,this.onRunBack))},e.prototype.onRunBack=function(){this._isAttackPlayOver=!1,this._isBeAttackOver=!1,t.once(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onAttackNPCOver),t.once(t.FightStaticStr.ATTACK_REACTION_ANI_OVER,this,this.onBeAttakNPCOver),this._curActionData.beAttacker.playerData.curStateData.curWeapon>0?this._curActionData.beAttacker.playWeaponAttack(this._curActionData,!0):this._curActionData.beAttacker.playNormalAttack(this._curActionData,!0)},e.prototype.onAttackNPCOver=function(){this._isBeAttackOver?"beatBacknpc"==this._type?Laya.Tween.to(this._curActionData.beAttacker,{x:this._curActionData.beAttacker.srcX},100/t.FightController.TIME_SCALE,null,Laya.Handler.create(this,this.gotoNextAction)):this.gotoNextAction():this._isAttackPlayOver=!0},e.prototype.onBeAttakNPCOver=function(){this._isAttackPlayOver?"beatBacknpc"==this._type?Laya.Tween.to(this._curActionData.beAttacker,{x:this._curActionData.beAttacker.srcX},100/t.FightController.TIME_SCALE,null,Laya.Handler.create(this,this.gotoNextAction)):this.gotoNextAction():this._isBeAttackOver=!0},e.prototype.onAttackOver=function(){this._isBeAttackOver?this.gotoNextAction():this._isAttackPlayOver=!0},e.prototype.onBeAttakOver=function(){this._isAttackPlayOver?this.gotoNextAction():this._isBeAttackOver=!0},e.prototype.gotoNextAction=function(){t.dispatch(t.FightStaticStr.AFTER_ATTACK_ACTION,this._curActionData)},e}();t.BeatBackController=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this._isBeAttack=!1,this._shamDead=0,this._afterAttackSkill=0,this.init()}return e.prototype.init=function(){t.addListener(t.FightStaticStr.BE_ATTACK_ACTION,this,this.attackReaction),t.addListener(t.FightStaticStr.BEAT_BACK_REACTION_ACTION,this,this.beBackReaction)},e.prototype.destroy=function(){t.removeListener(t.FightStaticStr.BE_ATTACK_ACTION,this,this.attackReaction),t.removeListener(t.FightStaticStr.BEAT_BACK_REACTION_ACTION,this,this.beBackReaction),this._curActionData=null},e.prototype.attackReaction=function(e){this._curActionData=e,this._isBeAttack=!1,this._subHp=this._curActionData.beAttackerHpChange,this._addHp=this._curActionData.attackerAddHp,this._reactionType=this._curActionData.hitReaction,this._attacker=this._curActionData.attacker,this._beAttacker=this._curActionData.beAttacker,this._buffAttackingType=t.BuffController.ATTACKING,this._buffAfterAttackingType=t.BuffController.AFTER_ATTACKING,this._defenseSkill=this._curActionData.defenseSkill,this._defenseSkillParam=this._curActionData.defenseSkillParam,this._shamDead=this._curActionData.shamDead,this._shamDeadParam=this._curActionData.shamDeadParam,this._afterAttackSkill=this._curActionData.afterAttackSkill,this._afterAttackSkillParam=this._curActionData.afterAttackSkillParam,this.onEvent()},e.prototype.beBackReaction=function(e){this._curActionData=e,this._isBeAttack=!0,this._subHp=this._curActionData.attackerHpChange,this._addHp=this._curActionData.beAttackerAddHp,this._reactionType=this._curActionData.beatBackReaction,this._attacker=this._curActionData.beAttacker,this._beAttacker=this._curActionData.attacker,this._buffAttackingType=t.BuffController.BEAT_BACK_ATTACKING,this._buffAfterAttackingType=t.BuffController.BEAT_BACK_AFTER_ATTACKING,this._defenseSkill=this._curActionData.beBackDefenseSkill,this._defenseSkillParam=this._curActionData.beBackDefenseSkillParam,this._shamDead=this._curActionData.beShamDead,this._shamDeadParam=this._curActionData.beShamDeadParam,this._afterAttackSkill=this._curActionData.beAfterAttackSkill,this._afterAttackSkillParam=this._curActionData.beAfterAttackSkillParam,this.onEvent()},e.prototype.onEvent=function(){t.addListener(t.FightStaticStr.FIGHTER_REACTION_ANI_OVER,this,this.onFighterPlayOver),t.dispatch(t.FightStaticStr.EFFECT_ACTION,{action:this._curActionData,type:t.EffectController.EFFECT_ATTACKING,side:this._attacker.sideType.toLowerCase()}),this.showHPAndFloatWord(),this.playAction()},e.prototype.showHPAndFloatWord=function(){if(0!=this._subHp){this._beAttacker.playerData.curStateData.subHP(this._subHp);t.dispatch(t.FightStaticStr.SUB_HP,{subNum:this._subHp,type:this._beAttacker.sideType}),4==this._reactionType?(t.SoundController.playBaojiSound(),t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:6,side:this._attacker.sideType,top:this._attacker.playerData.npcData.top}),t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this._beAttacker,type:t.FloatWordController.CRIT_FLOAT_WORD,num:this._subHp})):3==this._reactionType?(t.SoundController.playShouShangSound(),t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this._beAttacker,type:t.FloatWordController.DAMAGE_FLOAT_WORD,num:this._subHp})):(t.SoundController.playShouShangSound(),t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this._beAttacker,type:t.FloatWordController.DAMAGE_FLOAT_WORD,num:this._subHp}))}if(this._addHp>0){this._attacker.playerData.curStateData.addHP(this._subHp);t.dispatch(t.FightStaticStr.ADD_HP,{addNum:this._addHp,type:this._attacker.sideType}),t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this._attacker,type:t.FloatWordController.ADD_FLOAT_WORD,num:this._addHp})}},e.prototype.playAction=function(){if(t.once(t.FightStaticStr.EVENT_HIT_END,this,this.eventHitEnd),0!=this._defenseSkill)t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:this._buffAttackingType,side:this._attacker.sideType.toLowerCase()}),this._beAttacker.playReactionSkill(this._curActionData,this._defenseSkill),14==this._defenseSkill&&(t.dispatch(t.FightStaticStr.ADD_HP,{addNum:parseInt(this._defenseSkillParam[2]),type:this._beAttacker.sideType}),this._beAttacker.playerData.curStateData.addHP(parseInt(this._defenseSkillParam[2])),t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:7,side:this._beAttacker.sideType,top:this._beAttacker.playerData.npcData.top}));else switch(this._reactionType){case e.EVADE_REACTION:t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:5,side:this._beAttacker.sideType,top:this._beAttacker.playerData.npcData.top}),t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:this._buffAttackingType,side:this._attacker.sideType.toLowerCase()}),t.SoundController.playMissSound(),t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this._beAttacker,type:t.FloatWordController.MISS_FLOAT_WORD}),this._beAttacker.playAttackReaction(this._curActionData,this._reactionType);break;case e.NORMAL_HIT_REACTION:case e.BLOCK_REACTION:case e.CRIT_REACTION:this._isBeAttack||(this._curActionData.weapon>0&&t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:9,id:this._curActionData.weapon,level:this._attacker.playerData.getWeaponLevel(this._curActionData.weapon),typeCode:"weapon",side:this._beAttacker.sideType,top:this._beAttacker.playerData.npcData.top}),this._curActionData.skill>0&&t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:9,id:this._curActionData.skill,level:this._attacker.playerData.getSkillLevel(this._curActionData.skill),typeCode:"skill",side:this._beAttacker.sideType,top:this._beAttacker.playerData.npcData.top})),t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:this._buffAttackingType,side:this._attacker.sideType.toLowerCase()}),this._beAttacker.playAttackReaction(this._curActionData,this._reactionType);break;default:this.gotoNextAction()}},e.prototype.eventHitEnd=function(){this._beAttacker&&this._beAttacker.playReactionEnd()},e.prototype.onFighterPlayOver=function(){var e;this._shamDead?(e=this._shamDead,this._shamDead=0,this._beAttacker.playReactionSkill(this._curActionData,e),t.dispatch(t.FightStaticStr.ADD_HP,{addNum:parseInt(this._shamDeadParam[2]),type:this._beAttacker.sideType}),this._beAttacker.playerData.curStateData.addHP(parseInt(this._shamDeadParam[2])),t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:7,side:this._beAttacker.sideType,top:this._beAttacker.playerData.npcData.top})):this._afterAttackSkill?(e=this._afterAttackSkill,this._afterAttackSkill=0,this._beAttacker.playReactionSkill(this._curActionData,e)):this.gotoNextAction()},e.prototype.gotoNextAction=function(){t.removeListener(t.FightStaticStr.FIGHTER_REACTION_ANI_OVER,this,this.onFighterPlayOver),t.removeListener(t.FightStaticStr.EVENT_HIT_END,this,this.eventHitEnd),t.dispatch(t.FightStaticStr.ATTACK_REACTION_ANI_OVER,this._curActionData)},e.EVADE_REACTION=1,e.NORMAL_HIT_REACTION=2,e.BLOCK_REACTION=3,e.CRIT_REACTION=4,e}();t.AtkReactionController=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this._isAttackPlayOver=!1,this._isBeAttackOver=!1,this.init()}return e.prototype.init=function(){t.addListener(t.FightStaticStr.ATTACK_ACTION,this,this.onEvent)},e.prototype.destroy=function(){t.removeListener(t.FightStaticStr.ATTACK_ACTION,this,this.onEvent),t.removeListener(t.FightStaticStr.SKILL_PLAY_OVER,this,this.onAttackOver),t.removeListener(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onAttackOver),t.removeListener(t.FightStaticStr.ATTACK_REACTION_ANI_OVER,this,this.onBeAttakOver)},e.prototype.onEvent=function(e){this._curActionData=e,this._curActionData.beAttacker.changeLayerDown(),t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:t.BuffController.BEFORE_ATTACKING,side:this._curActionData.attacker.sideType.toLowerCase()});var i=this.getActionType();switch(i){case"skill":t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:t.BuffController.BEFORE_SKILL,side:this._curActionData.attacker.sideType.toLowerCase()}),this.playSkill();break;case"weapon":this.playWeapon();break;case"normal":this.playNormal();break;case"none":this.gotoNextAction();break;default:this.gotoNextAction()}},e.prototype.getActionType=function(){var t="none";return this._curActionData.haveAction?this._curActionData.skill>0?"skill":this._curActionData.weapon>0?"weapon":"normal":t},e.prototype.playSkill=function(){this._isAttackPlayOver=!1,this._isBeAttackOver=!1;var e=this._curActionData.attacker.playerData.getSkillData(this._curActionData.skill);t.once(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onAttackOver),t.once(t.FightStaticStr.ATTACK_REACTION_ANI_OVER,this,this.onBeAttakOver),this._curActionData.attacker.playSkill(this._curActionData),t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:3,id:this._curActionData.skill,level:e.level,typeCode:"skill",side:this._curActionData.attacker.sideType,top:this._curActionData.attacker.playerData.npcData.top}),1==e.withoutAttack&&t.dispatch(t.FightStaticStr.BE_ATTACK_ACTION,this._curActionData)},e.prototype.playWeapon=function(){this._isAttackPlayOver=!1,this._isBeAttackOver=!1,t.once(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onAttackOver),t.once(t.FightStaticStr.ATTACK_REACTION_ANI_OVER,this,this.onBeAttakOver),this._curActionData.attacker.playWeaponAttack(this._curActionData)},e.prototype.playNormal=function(){this._isAttackPlayOver=!1,this._isBeAttackOver=!1,t.once(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onAttackOver),t.once(t.FightStaticStr.ATTACK_REACTION_ANI_OVER,this,this.onBeAttakOver),this._curActionData.attacker.playNormalAttack(this._curActionData)},e.prototype.onAttackOver=function(){1==this._curActionData.attackType&&(this._curActionData.attacker.playerData.curStateData.curWeapon=0,this._curActionData.attacker.changeStand()),2==this._curActionData.attackType&&t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:t.BuffController.AFTER_SKILL,side:this._curActionData.attacker.sideType.toLowerCase()}),this._isBeAttackOver?this.gotoNextAction():this._isAttackPlayOver=!0},e.prototype.onBeAttakOver=function(){this._isAttackPlayOver?this.gotoNextAction():this._isBeAttackOver=!0},e.prototype.gotoNextAction=function(){t.dispatch(t.FightStaticStr.EFFECT_ACTION,{action:this._curActionData,type:t.EffectController.EFFECT_AFTER_ATTACKING,side:this._curActionData.attacker.sideType.toLowerCase()}),t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:t.BuffController.AFTER_ATTACK,side:this._curActionData.attacker.sideType.toLowerCase()}),t.removeListener(t.FightStaticStr.SKILL_PLAY_OVER,this,this.onAttackOver),t.removeListener(t.FightStaticStr.ATTACK_REACTION_ANI_OVER,this,this.onBeAttakOver),t.dispatch(t.FightStaticStr.REBOUND_ACTION,this._curActionData)},e}();t.AtkingController=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this._isNeedGetWeapon=!1,this.init()}return e.prototype.init=function(){t.addListener(t.FightStaticStr.GET_DROP_WEAPON_ACTION,this,this.onEvent)},e.prototype.destroy=function(){t.removeListener(t.FightStaticStr.GET_DROP_WEAPON_ACTION,this,this.onEvent),t.removeListener(t.FightStaticStr.DROP_WEAPON_OVER,this,this.onDropWeaponOver),t.removeListener(t.FightStaticStr.GET_WEAPON_OVER,this,this.onGetWeaponOver),this._curActionData=null},e.prototype.onEvent=function(e){this._curActionData=e,t.ActionData.chainData.update(this._curActionData.chainStr,this._curActionData.attacker.sideType),this.chainShow();var i=this.getActionType();switch(i){case"dropWeapon":t.once(t.FightStaticStr.DROP_WEAPON_OVER,this,this.onDropWeaponOver),this._curActionData.attacker.dropWeapon();break;case"getWeapon":this.getWeapon();break;case"dropAndGetWeapon":this._isNeedGetWeapon=!0,t.once(t.FightStaticStr.DROP_WEAPON_OVER,this,this.onDropWeaponOver),this._curActionData.attacker.dropWeapon();break;case"none":this._curActionData.assistantSkill>0?this.showAssistSkill():(t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:t.BuffController.BEFORE_GET_WEAPON,side:this._curActionData.attacker.sideType.toLowerCase()}),this.gotoNextAction());break;default:this.gotoNextAction()}},e.prototype.chainShow=function(){t.dispatch(t.FightStaticStr.FIGHT_CHAIN_WORD,{type:this._curActionData.attacker.sideType})},e.prototype.showAssistSkill=function(){t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:4,skill:this._curActionData.assistantSkill,side:this._curActionData.attacker.sideType,top:this._curActionData.attacker.playerData.npcData.top}),this._curActionData.attacker.playAssistSkill(this._curActionData),t.once(t.FightStaticStr.ASSIST_SKILL_ANI_OVER,this,this.assistSkillOver)},e.prototype.assistSkillOver=function(){t.dispatch(t.FightStaticStr.EFFECT_ACTION,{action:this._curActionData,type:t.EffectController.EFFECT_BEFORE_SELECT,side:this._curActionData.attacker.sideType.toLowerCase()}),t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:t.BuffController.BEFORE_GET_WEAPON,side:this._curActionData.attacker.sideType.toLowerCase()}),this.gotoNextAction()},e.prototype.getActionType=function(){var e="none",i=this._curActionData.weapon,s=this._curActionData.attacker.playerData.curStateData.curWeapon;return 0==this._curActionData.skill?i==s?"none":0==i&&s>0?"dropWeapon":i>0&&0==s?"getWeapon":t.ActionData.chainData.curChainNum>1?"getWeapon":"dropAndGetWeapon":e},e.prototype.onDropWeaponOver=function(){this._curActionData.attacker.playerData.curStateData.curWeapon;this._isNeedGetWeapon?(this._isNeedGetWeapon=!1,this.getWeapon()):(this._curActionData.attacker.playerData.curStateData.curWeapon=0,this._curActionData.assistantSkill>0?this.showAssistSkill():this.gotoNextAction())},e.prototype.getWeapon=function(){this._curActionData.assistantSkill>0?(t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:4,skill:this._curActionData.assistantSkill,side:this._curActionData.attacker.sideType,top:this._curActionData.attacker.playerData.npcData.top}),this._curActionData.attacker.playAssistSkill(this._curActionData),t.once(t.FightStaticStr.ASSIST_SKILL_ANI_OVER,this,function(){t.dispatch(t.FightStaticStr.EFFECT_ACTION,{action:this._curActionData,type:t.EffectController.EFFECT_BEFORE_SELECT,side:this._curActionData.attacker.sideType.toLowerCase()}),t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:t.BuffController.BEFORE_GET_WEAPON,side:this._curActionData.attacker.sideType.toLowerCase()}),t.once(t.FightStaticStr.GET_WEAPON_OVER,this,this.onGetWeaponOver),this._curActionData.attacker.getWeapon(this._curActionData.weapon)})):(t.dispatch(t.FightStaticStr.EFFECT_ACTION,{action:this._curActionData,type:t.EffectController.EFFECT_BEFORE_SELECT,side:this._curActionData.attacker.sideType.toLowerCase()}),t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:t.BuffController.BEFORE_GET_WEAPON,side:this._curActionData.attacker.sideType.toLowerCase()}),t.once(t.FightStaticStr.GET_WEAPON_OVER,this,this.onGetWeaponOver),this._curActionData.attacker.getWeapon(this._curActionData.weapon))},e.prototype.onGetWeaponOver=function(){this._curActionData.attacker.playerData.curStateData.curWeapon=this._curActionData.weapon,t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:t.BuffController.AFTER_GET_WEAPON,side:this._curActionData.attacker.sideType.toLowerCase()});var e=this._curActionData.attacker.playerData.curStateData.curWeapon;t.dispatch(t.FightStaticStr.THROW_WEAPON,{weaponId:e,sideType:this._curActionData.attacker.sideType}),this.gotoNextAction(),this._curActionData.weapon>0&&0==this._curActionData.skill&&t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:3,id:this._curActionData.weapon,level:this._curActionData.attacker.playerData.getWeaponLevel(this._curActionData.weapon),typeCode:"weapon",side:this._curActionData.attacker.sideType,top:this._curActionData.attacker.playerData.npcData.top})},e.prototype.gotoNextAction=function(){t.dispatch(t.FightStaticStr.EFFECT_ACTION,{action:this._curActionData,type:t.EffectController.EFFECT_AFTER_SELECT,side:this._curActionData.attacker.sideType.toLowerCase()}),t.FightModule.isChainDrama&&2==t.ActionData.chainData.curChainNum?(t.once(t.FightStaticStr.FIGHT_DRAMA_END,this,this.onDramaEnd),t.dispatch(t.FightStaticStr.FIGHT_DRAMA_START,"1053")):t.dispatch(t.FightStaticStr.CHAIN_ACTION,this._curActionData)},e.prototype.onDramaEnd=function(){t.dispatch(t.FightStaticStr.CHAIN_ACTION,this._curActionData)},e}();t.AtkBeforeController=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this.init()}return e.prototype.init=function(){t.addListener(t.FightStaticStr.AFTER_ATTACK_ACTION,this,this.onEvent)},e.prototype.destroy=function(){t.removeListener(t.FightStaticStr.AFTER_ATTACK_ACTION,this,this.onEvent)},e.prototype.onEvent=function(e){this._curActionData=e;var i=this.getActionType();switch(i){case"moveBack":this._curActionData.attacker.playRun(),Laya.Tween.to(this._curActionData.attacker,{x:this._curActionData.attacker.srcX},100/t.FightController.TIME_SCALE,null,Laya.Handler.create(this,this.gotoNextAction));break;case"none":this.gotoNextAction();break;case"endAction":this.gotoNextAction();break;default:this.gotoNextAction()}},e.prototype.getActionType=function(){var t="none";return this._curActionData.isEndAction?"endAction":0==this._curActionData.isDoubleAttack&&this._curActionData.attacker.srcX!=this._curActionData.attacker.x?"moveBack":t},e.prototype.gotoNextAction=function(){this._curActionData.attacker.playerData.curStateData.hasDoubleAttack=1==this._curActionData.isDoubleAttack,this._curActionData.attacker.playStand(),!this._curActionData.haveAction&&(this._curActionData.attacker.playerData.curStateData.isDizzy||this._curActionData.attacker.playerData.curStateData.isStick||this._curActionData.attacker.playerData.curStateData.isDianxue)?(t.addListener(t.FightStaticStr.ACTION_LOST_END,this,this.delayEnd),this._curActionData.attacker.playerData.curStateData.isDizzy&&0==this._curActionData.attacker.playerData.utype?(t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:10,side:this._curActionData.beAttacker.sideType,top:this._curActionData.beAttacker.playerData.npcData.top}),this._curActionData.attacker.playStun()):this._curActionData.attacker.playerData.curStateData.isStick&&0==this._curActionData.attacker.playerData.utype?(t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:10,side:this._curActionData.beAttacker.sideType,top:this._curActionData.beAttacker.playerData.npcData.top}),this._curActionData.attacker.playGlue()):this._curActionData.attacker.playerData.curStateData.isDianxue&&0==this._curActionData.attacker.playerData.utype?(t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:10,side:this._curActionData.beAttacker.sideType,top:this._curActionData.beAttacker.playerData.npcData.top}),this._curActionData.attacker.playSlient()):Laya.timer.once(1500/t.FightController.TIME_SCALE,this,this.delayEnd)):(t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:t.BuffController.AFTER_ACTION,side:"lr"}),t.dispatch(t.FightStaticStr.EFFECT_ACTION,{action:this._curActionData,type:t.EffectController.EFFECT_AFTER_ACTION,side:"lr"}),t.dispatch(t.FightStaticStr.FIGHT_ADD_MONSTER_VALUE,{type:this._curActionData.attacker.sideType,value:this._curActionData.addRage}),t.dispatch(t.FightStaticStr.FIGHT_ADD_MONSTER_VALUE,{type:this._curActionData.beAttacker.sideType,value:this._curActionData.beAttackerAddRage}),t.dispatch(t.FightStaticStr.END_ALL_ACTION))},e.prototype.delayEnd=function(){t.removeListener(t.FightStaticStr.ACTION_LOST_END,this,this.delayEnd),t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:t.BuffController.AFTER_ACTION,side:"lr"}),t.dispatch(t.FightStaticStr.EFFECT_ACTION,{action:this._curActionData,type:t.EffectController.EFFECT_AFTER_ACTION,side:"lr"}),t.dispatch(t.FightStaticStr.FIGHT_ADD_MONSTER_VALUE,{type:this._curActionData.attacker.sideType,value:this._curActionData.addRage}),t.dispatch(t.FightStaticStr.FIGHT_ADD_MONSTER_VALUE,{type:this._curActionData.beAttacker.sideType,value:this._curActionData.beAttackerAddRage}),t.dispatch(t.FightStaticStr.END_ALL_ACTION)},e}();t.AfterAtkController=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this.init()}return e.prototype.init=function(){t.addListener(t.FightStaticStr.BEGIN_ACTION,this,this.onEvent),this.actionMap={},this.actionMap.MonsterAction=new t.MonsterAction(this),this.actionMap.BuffAction=new t.BuffAction(this),this.actionMap.DropWeaponAction=new t.DropWeaponAction(this),this.actionMap.AssistantSkillAction=new t.AssistantSkillAction(this),this.actionMap.GetWeaponAction=new t.GetWeaponAction(this),this.actionMap.ChainAction=new t.ChainAction(this),this.actionMap.MoveAction=new t.MoveAction(this),this.actionMap.HitAction=new t.HitAction(this),this.actionMap.HitReaction=new t.HitReaction(this),this.actionMap.ReboundAction=new t.ReboundAction(this),this.actionMap.HitBackAction=new t.HitBackAction(this),this.actionMap.MoveBackAction=new t.MoveBackAction(this),this._sortAction=["MonsterAction","BuffAction","DropWeaponAction","AssistantSkillAction","GetWeaponAction","ChainAction","MoveAction","HitAction","ReboundAction","HitBackAction","MoveBackAction"]},e.prototype.destroy=function(){t.removeListener(t.FightStaticStr.BEGIN_ACTION,this,this.onEvent),this._curActionData=null},e.prototype.onEvent=function(t){this._curActionData=t,this._curIndex=0,this.dealAction()},e.prototype.dealAction=function(){if(this.checkActionEnd())t.dispatch(t.FightStaticStr.END_ALL_ACTION);else{var e=this._curIndex;this._curIndex++,this.actionMap[this._sortAction[e]].start(this._curActionData)}},e.prototype.gotoAction=function(t){var e=this._sortAction.indexOf(t);-1!=e?(this._curIndex=e,this.dealAction()):console.log("不存在动作")},e.prototype.checkActionEnd=function(){return this._curIndex>=this._sortAction.length},e}();t.ActionBeginController=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(t){this._controller=t}return t}();t.BaseAction=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(t){this.plugin=t}return e.prototype.doOpenFactionList=function(){this.openFactionListBox()},e.prototype.openFactionListBox=function(){this.factionListBox||(this.factionListBox=new t.FactionListBox,this.factionListBox.on(t.ViewEvent.BASE_DESTROY,this,this.factionListBoxDestroy),this.factionListBox.on("ENTER_FACTION_SCENE",this,this.enterFactionSceneFromFactionListBox),this.factionListBox.show())},e.prototype.enterFactionSceneFromFactionListBox=function(){this.factionListBox&&this.factionListBox.destroy(),t.BoxMgr.hasBox("FactionWarSceneBox")||t.Facade.callCommand(new t.EnterFactionSceneCmd(!0))},e.prototype.factionListBoxDestroy=function(e){this.factionListBox&&(this.factionListBox.off(t.ViewEvent.BASE_DESTROY,this,this.factionListBoxDestroy),this.factionListBox.off("ENTER_FACTION_SCENE",this,this.enterFactionSceneFromFactionListBox),this.factionListBox=null),this.plugin.unregisterCommand(new t.OpenFactionListBoxCmd)},e.prototype.doOpenCreateFactionBox=function(){this.createFacBox||(this.createFacBox=new t.CreateFactionBox,this.createFacBox.on(t.ViewEvent.BASE_DESTROY,this,this.createFacBoxDestroy),this.createFacBox.on("ENTER_FACTION_SCENE",this,this.enterFactionSceneFromCreateBox),this.createFacBox.show())},e.prototype.enterFactionSceneFromCreateBox=function(){this.createFacBox&&this.createFacBox.destroy(),this.factionListBox&&this.factionListBox.destroy(),t.BoxMgr.hasBox("FactionWarSceneBox")||t.Facade.callCommand(new t.EnterFactionSceneCmd(!0))},e.prototype.createFacBoxDestroy=function(){this.createFacBox&&(this.createFacBox.off(t.ViewEvent.BASE_DESTROY,this,this.createFacBoxDestroy),this.createFacBox.off("ENTER_FACTION_SCENE",this,this.enterFactionSceneFromCreateBox),this.createFacBox=null)},e.prototype.doOpenSearchFactionBox=function(){this.searchFacBox||(this.searchFacBox=new t.SearchFactionBox,this.searchFacBox.on("SEARCH_FAC_SUCCESS",this,this.searchFacSuccess),this.searchFacBox.on(t.ViewEvent.BASE_DESTROY,this,this.searchFacBoxDestroy),this.searchFacBox.show())},e.prototype.searchFacSuccess=function(t){this.searchFacBox&&this.searchFacBox.destroy(),this.factionListBox&&this.factionListBox.showSearchFac(t)},e.prototype.searchFacBoxDestroy=function(){this.searchFacBox&&(this.searchFacBox.off("SEARCH_FAC_SUCCESS",this,this.searchFacSuccess),this.searchFacBox.off(t.ViewEvent.BASE_DESTROY,this,this.searchFacBoxDestroy),this.searchFacBox=null)},e.prototype.doGetFacInfo=function(e){e.initPanelUI(),e.data?(this.fillFacInfoPanel(e.facInfoBox,e.data,e.fromRankView),e.ecode=0,e.finish()):(this._getFacInfoCmd=e,t.XHR().Post({file:"petpk",cmd:"faction",op:"query",facid:e.facID,uid:t.Global.UID},this,this.queryOtherFactionHandler))},e.prototype.queryOtherFactionHandler=function(e){this._getFacInfoCmd&&(0==e.result?(this.fillFacInfoPanel(this._getFacInfoCmd.facInfoBox,e.faction_appinfo,this._getFacInfoCmd.fromRankView),this._getFacInfoCmd.ecode=e.result,this._getFacInfoCmd.errorMsg=e.msg,this._getFacInfoCmd.finish()):t.WeakTips.show("查询帮派详细信息失败，"+e.msg),
this._getFacInfoCmd=null)},e.prototype.fillFacInfoPanel=function(t,e,i){t||(t=new ui.faction.noFac.FacInfoPanelUI),t.facInfo_idTxt.text=e.facid,t.facInfo_facOwnerNameTxt.text=e.wang_name,i?(t.memberBox.visible=!0,t.strengBox.visible=!1,t.facInfo_memberTxt.text=e.member_size+"/"+e.max_member):(t.memberBox.visible=!1,t.strengBox.visible=!0,t.facInfo_strengthTxt.text=e.fight_power);var s="1级";e.hasOwnProperty("pow_club")&&0!=Number(e.pow_club)&&(s=e.pow_club+"级");var n="1级";e.hasOwnProperty("phy_club")&&0!=Number(e.phy_club)&&(n=e.phy_club+"级");var a="1级";e.hasOwnProperty("spd_club")&&0!=Number(e.spd_club)&&(a=e.spd_club+"级"),t.facInfo_lvTxt1.text=s,t.facInfo_lvTxt2.text=n,t.facInfo_lvTxt3.text=a,t.facInfo_noticeTxt.text=e.notice,t.facInfo_bg.height=303+t.facInfo_noticeTxt.textHeight},e.prototype.destroy=function(){this.searchFacBoxDestroy(),this.createFacBoxDestroy(),this.factionListBoxDestroy(null),this.plugin=null},e}();t.NoFactionExecuter=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(t){this._maxBettingCount=0,this._hasJoin=!1,this.plugin=t}return e.prototype.doEnterWarScene=function(){if(t.SceneMgr.current.getSceneName()!=t.SceneDef.FACTION_SCENE){var e=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);if(0!=e.facID){var i=new t.RefreshFactionCmd;i.on(this,this.getFactionHandler),t.Facade.callCommand(i)}else 0==t.FactionConfig.hasLoadConfig?this.getFactionConfig():this.getFactionWarSceneData()}else this.getFactionWarSceneData()},e.prototype.getFactionHandler=function(e){e.off(),0==e.ecode?0==t.FactionConfig.hasLoadConfig?this.getFactionConfig():this.getFactionWarSceneData():t.WeakTips.show("查询帮派信息失败，"+e.errosMsg)},e.prototype.getFactionConfig=function(){t.XHR().Post({file:"petpk",cmd:"cfgout",subcmd:"get",type:"1|2|3|4|5",uid:t.Global.UID},this,this.getFactionConfigHandler)},e.prototype.getFactionConfigHandler=function(e){if(0==e.result)t.FactionConfig.setConfig(e),this.getFactionWarSceneData();else{var i=new t.ConfirmBoxData({isShowCancelBtn:!1,isShowXBtn:!1,contentStr:"拉取帮派配置失败，"+e.msg});t.ConfirmBox.show(i)}},e.prototype.getFactionWarSceneData=function(){var e=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);t.XHR().Post({file:"petpk",cmd:"faction",op:"challenge_query",fid:e.facID,group:-1,round:-1,uid:t.Global.UID},this,this.getFactionWarSceneDataHandler)},e.prototype.getFactionWarSceneDataHandler=function(e){if(0==e.result){this.enterFactionWarScene(e);var i=e.challenge;this._maxBettingCount=i.betting_count;var s=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);if(0!=s.facID){var n=t.ServerClock.getServerNowDate().getDay();this._hasJoin=i&&i.hasOwnProperty("rounds")&&i.rounds.length>0,n>=1&&n<=t.FactionWarScene.FIGHT_DAY-1&&this._hasJoin&&(this._warFightMemberObj=i.rounds[0],this.openFightMemberBox(i.rounds[0])),(0==n||n>=t.FactionWarScene.FIGHT_DAY)&&this.openChampionBox()}else this.openChampionBox()}else t.WeakTips.show("查询帮战信息失败，"+e.msg)},e.prototype.enterFactionWarScene=function(e,i,s){void 0===i&&(i=0),void 0===s&&(s=!1),this._factionWarScene||(this._factionWarScene=new t.FactionWarScene,this._factionWarScene.on(t.ViewEvent.BASE_DESTROY,this,this.factionWarSceneDestroy),this._factionWarScene.on("GET_WAR_DATA",this,this.getFactionWarSceneData),this._factionWarScene.on("SELF_FACTION_CLICK",this,this.selfFactionClickHandler),this._factionWarScene.on("SHOW_CHAMPION",this,this.openChampionBox),this._factionWarScene.on("SHOW_OR_HIDE_REWARD",this,this.showOrHideReward),this._factionWarScene.on("OPEN_REPLAY_BOX",this,this.openReplayBox),this._factionWarScene.show()),this._factionWarScene.setData(e,i,!0,s),t.SceneMgr.current.getSceneName()==t.SceneDef.FACTION_SCENE&&t.Facade.callCommand(new t.ShowOrHideFactionSceneCmd(!1))},e.prototype.selfFactionClickHandler=function(){var e=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);if(0==e.facID)t.Facade.callCommand(new t.OpenFactionListBoxCmd);else{var i=t.ServerClock.getServerNowDate().getDay();this._warChampionBox.getHistory()?this.showFacInfo({facID:t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF).facID,history:!0}):i>=1&&i<=t.FactionWarScene.FIGHT_DAY-1?(this.showJoinOrMemberBox(),this._warChampionBox.destroy()):this._warChampionBox.getFaction1()?this.showFacInfo({facID:t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF).facID,history:!1}):t.WeakTips.show("海选赛正在进行中...")}},e.prototype.factionWarSceneDestroy=function(e){this._factionWarScene&&(this._factionWarScene.off(t.ViewEvent.BASE_DESTROY,this,this.factionWarSceneDestroy),this._factionWarScene.off("GET_WAR_DATA",this,this.getFactionWarSceneData),this._factionWarScene.off("SELF_FACTION_CLICK",this,this.selfFactionClickHandler),this._factionWarScene.off("SHOW_CHAMPION",this,this.openChampionBox),this._factionWarScene.off("SHOW_OR_HIDE_REWARD",this,this.showOrHideReward),this._factionWarScene.off("OPEN_REPLAY_BOX",this,this.openReplayBox),this._factionWarScene=null),this._warChampionBox&&this._warChampionBox.destroy(),this._warFightMemberBox&&this._warFightMemberBox.destroy(),this._replayBox&&this._replayBox.destroy(),t.SceneMgr.current.getSceneName()==t.SceneDef.FACTION_SCENE?(this.plugin.unregisterCommand(new t.EnterFactionWarCmd),t.Facade.callCommand(new t.ShowOrHideFactionSceneCmd(!0))):this.plugin.unregisterPlugin()},e.prototype.showOrHideReward=function(t){this._factionWarBetBox&&(this._factionWarBetBox.visible=!t),this._warChampionBox&&(this._warChampionBox.visible=!t),this._warFightMemberBox&&(this._warFightMemberBox.visible=!t),this._replayBox&&(this._replayBox.visible=!t)},e.prototype.openFightMemberBox=function(e){this._warFightMemberBox||(this._warFightMemberBox=new t.WarFightMemberBox,this._warFightMemberBox.on(t.ViewEvent.BASE_DESTROY,this,this.warFightMemberBoxDestroy),this._warFightMemberBox.on("GET_WAR_DATA",this,this.getFactionWarSceneData)),this._warFightMemberBox.show(),this._factionWarScene&&(this._factionWarScene.showOrHideFightList(!1),this._factionWarScene.isShowReward&&(this._warFightMemberBox.visible=!1)),this._warFightMemberBox.setData(e)},e.prototype.warFightMemberBoxDestroy=function(e){this._warFightMemberBox&&(this._warFightMemberBox.off(t.ViewEvent.BASE_DESTROY,this,this.warFightMemberBoxDestroy),this._warFightMemberBox.off("GET_WAR_DATA",this,this.getFactionWarSceneData),this._warFightMemberBox=null)},e.prototype.openChampionBox=function(){this._warChampionBox||(this._warChampionBox=new t.WarChampionBox(this._hasJoin),this._warChampionBox.on(t.ViewEvent.BASE_DESTROY,this,this.warChampionBoxDestroy),this._warChampionBox.on("SHOW_SELF_FAC_INFO",this,this.showFacInfo),this._warChampionBox.on("OPEN_BET_BOX",this,this.openBetBox),this._warChampionBox.on("SHOW_JOIN_OR_MEMBER_BOX",this,this.showJoinOrMemberBox),this._warChampionBox.show()),this._replayBox&&this._replayBox.destroy(),this._factionWarScene&&(this._factionWarScene.showOrHideFightList(!1),this._factionWarScene.showOrHideChampionBtn(!1),this._factionWarScene.showTitle(1),this._factionWarScene.isShowReward&&(this._warChampionBox.visible=!1))},e.prototype.warChampionBoxDestroy=function(e){if(this._warChampionBox){this._warChampionBox.off(t.ViewEvent.BASE_DESTROY,this,this.warChampionBoxDestroy),this._warChampionBox.off("SHOW_SELF_FAC_INFO",this,this.showFacInfo),this._warChampionBox.off("OPEN_BET_BOX",this,this.openBetBox),this._warChampionBox.on("SHOW_JOIN_OR_MEMBER_BOX",this,this.showJoinOrMemberBox),this._warChampionBox=null,this._factionWarScene&&this._factionWarScene.showOrHideChampionBtn(!0);var i=t.ServerClock.getServerNowDate().getDay();i>=1&&i<=t.FactionWarScene.FIGHT_DAY-1&&this._hasJoin&&this._warFightMemberObj&&this.openFightMemberBox(this._warFightMemberObj)}},e.prototype.showFacInfo=function(t){this._warChampionBox&&this._warChampionBox.destroy(),this._warFightMemberBox&&this._warFightMemberBox.destroy(),this.getFactionRound(t)},e.prototype.getFactionRound=function(e){this._replayFacID=e.facID;var i={file:"petpk",cmd:"faction",op:"challenge_query",fid:this._replayFacID,group:-1,round:-1,uid:t.Global.UID};this._isHistory=e.history,1==e.history&&(i.history=1),t.XHR().Post(i,this,this.getFactionRoundHandler)},e.prototype.getFactionRoundHandler=function(e){if(0==e.result){this.enterFactionWarScene(e,this._replayFacID,this._isHistory);var i=e.challenge;this._maxBettingCount=i.betting_count}else t.WeakTips.show("查询录像信息失败，"+e.msg)},e.prototype.openBetBox=function(e){this._maxBettingCount=e.maxBettingCount,this._factionWarBetBox||(this._factionWarBetBox=new t.FactionWarBetBox(e.faction,Number(e.bettingID),e.isOver,this._maxBettingCount),this._factionWarBetBox.on(t.ViewEvent.BASE_DESTROY,this,this.betBoxDestroy),this._factionWarBetBox.on("SHOW_SELF_FAC_INFO",this,this.showFacInfo),this._factionWarBetBox.on("BET_SUCCESS",this,this.betSuccess),this._factionWarBetBox.show(),this._factionWarScene&&this._factionWarScene.isShowReward&&(this._factionWarBetBox.visible=!1))},e.prototype.betSuccess=function(t){this._warChampionBox&&this._warChampionBox.betSuccess(t.facID),this._factionWarBetBox&&this._factionWarBetBox.destroy()},e.prototype.betBoxDestroy=function(){this._factionWarBetBox&&(this._factionWarBetBox.off(t.ViewEvent.BASE_DESTROY,this,this.betBoxDestroy),this._factionWarBetBox.off("SHOW_SELF_FAC_INFO",this,this.showFacInfo),this._factionWarBetBox.off("BET_SUCCESS",this,this.betSuccess),this._factionWarBetBox=null)},e.prototype.showJoinOrMemberBox=function(){this._factionWarScene&&this._factionWarScene.showJoinBox(),this._hasJoin&&this.openFightMemberBox(this._warFightMemberObj)},e.prototype.openReplayBox=function(e){this._factionWarBetBox||(this._replayBox=new t.FactionWarReplayBox(e),this._replayBox.on(t.ViewEvent.BASE_DESTROY,this,this.replayBoxDestroy),this._replayBox.show(),this._factionWarScene&&this._factionWarScene.isShowReward&&(this._replayBox.visible=!1),this._factionWarScene&&(this._factionWarScene.showOrHideFightList(!1),this._factionWarScene.showTitle(2)))},e.prototype.replayBoxDestroy=function(){this._replayBox&&(this._replayBox.off(t.ViewEvent.BASE_DESTROY,this,this.replayBoxDestroy),this._replayBox=null,this._factionWarScene&&(this._factionWarScene.showOrHideFightList(!0,!0),this._factionWarScene.showTitle(3)))},e.prototype.destroy=function(){this._warFightMemberObj=null,this.plugin=null},e}();t.FactionWarExecuter=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(t){this.plugin=t}return e.prototype.doEnterFactionSecne=function(e){this.factionScene||(this.factionScene=new t.FactionScene,this.factionScene.on(t.ViewEvent.BASE_DESTROY,this,this.factionSceneDestroy),t.SceneMgr.changeScene(this.factionScene)),e?this.factionScene.initData():t.XHR().Post({file:"petpk",cmd:"faction",op:"query",need_member:1,uid:t.Global.UID},this,this.querySelfFactionHandler)},e.prototype.querySelfFactionHandler=function(e){if(0==e.result){var i=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);i.faction.facID=e.faction_base.facid;var s=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);s.setData(e),this.factionScene&&this.factionScene.initData()}else{var n=new t.ConfirmBoxData({isShowCancelBtn:!1,isShowXBtn:!1,contentStr:"查询帮派信息失败，"+e.msg,callBackHandler:Handler.create(this,this.querySelfFactionError)});t.ConfirmBox.show(n)}},e.prototype.querySelfFactionError=function(){t.Facade.callCommand(new t.HomeCommand)},e.prototype.factionSceneDestroy=function(e){this.factionScene.off(t.ViewEvent.BASE_DESTROY,this,this.factionSceneDestroy),this.factionScene=null,this.plugin.unregisterPlugin()},e.prototype.doOpenRecruitBox=function(){var e=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);e.memberCount>=t.FactionConfig.getBaseHallConfig(e.facLv).maxMember?t.WeakTips.show("人数已满不可招募，提高帮派等级可提高人数上限"):this._recuritBox||(this._recuritBox=new t.RecruitBox,this._recuritBox.on(t.ViewEvent.BASE_DESTROY,this,this.recruitBoxDestroy),this._recuritBox.show())},e.prototype.recruitBoxDestroy=function(){if(this._recuritBox){var e=this._recuritBox.hasDoRecruit,i=this._recuritBox._oriApplyCordition,s=this._recuritBox._applyCordition,n=this._recuritBox._oriApplyNeedLv,a=this._recuritBox._applyNeedLv;this._recuritBox.off(t.ViewEvent.BASE_DESTROY,this,this.recruitBoxDestroy),this._recuritBox=null,e&&this._baseHallBox&&this._baseHallBox.queryFacMember(),i==s&&n==a||(this._applyCordition=s,this._applyNeedLv=a,t.XHR().Post({file:"petpk",cmd:"faction",op:"setting",join_level:a,join_type:s,uid:t.Global.UID},this,this.dosettingHandler)),Laya.loader.clearRes("ui/faction/factionRecruit/img_shenqingliebiao.png")}},e.prototype.dosettingHandler=function(e){if(0==e.result){var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);i.applyCordition=this._applyCordition,i.applyNeedLv=this._applyNeedLv,i.updateFinish()}},e.prototype.doOpenBaseHallBox=function(e){this._baseHallBox||(this._baseHallBox=new t.BaseHallBox(e),this._baseHallBox.on(t.ViewEvent.BASE_DESTROY,this,this.baseHallBoxDestroy),this._baseHallBox.show())},e.prototype.baseHallBoxDestroy=function(){this._baseHallBox&&(this._baseHallBox.off(t.ViewEvent.BASE_DESTROY,this,this.baseHallBoxDestroy),this._baseHallBox=null)},e.prototype.doOpenEditIconBox=function(){this._editIconBox||(this._editIconBox=new t.EditIconBox,this._editIconBox.on(t.ViewEvent.BASE_DESTROY,this,this.editIconBoxDestroy),this._editIconBox.show())},e.prototype.editIconBoxDestroy=function(){this._editIconBox&&(this._editIconBox.off(t.ViewEvent.BASE_DESTROY,this,this.editIconBoxDestroy),this._editIconBox=null)},e.prototype.doOpenDonateBox=function(){this._donateBox||(this._donateBox=new t.DonateBox,this._donateBox.on(t.ViewEvent.BASE_DESTROY,this,this.donateBoxDestroy),this._donateBox.show())},e.prototype.donateBoxDestroy=function(){this._donateBox&&(this._donateBox.off(t.ViewEvent.BASE_DESTROY,this,this.donateBoxDestroy),this._donateBox=null)},e.prototype.doOpenUpdateBox=function(e,i){this._updateBox||(this._updateBox=new t.UpdateBox(e,i),this._updateBox.on(t.ViewEvent.BASE_DESTROY,this,this.updateBoxDestroy),this._updateBox.on("update_wushu",this,this.updateWushuHandler),this._updateBox.on("update_practice",this,this.updatePracticeHandler),this._updateBox.show(),this._factionWuguanScene&&(this._factionWuguanScene.canStageMove=!1))},e.prototype.updateWushuHandler=function(t){this._factionWuguanScene&&this._factionWuguanScene.refreshDataAfterUpdate(t)},e.prototype.updatePracticeHandler=function(t){this._practiceBox&&this._practiceBox.refreshDataAfterUpdate(t)},e.prototype.updateBoxDestroy=function(){if(this._updateBox){var e=this._updateBox.hasUpdateBaseHall;this._updateBox.off(t.ViewEvent.BASE_DESTROY,this,this.updateBoxDestroy),this._updateBox.off("update_wushu",this,this.updateWushuHandler),this._updateBox.off("update_practice",this,this.updatePracticeHandler),this._updateBox=null,e&&this._baseHallBox&&this._baseHallBox.queryFacMember(),this._factionWuguanScene&&(this._factionWuguanScene.canStageMove=!0),Laya.loader.clearRes("ui/faction/factionUpdate/img_dangqianxiaoguo.png"),Laya.loader.clearRes("ui/faction/factionUpdate/img_xiajixiaoguo.png")}},e.prototype.doOpenNoticeBox=function(){this._noticeBox||(this._noticeBox=new t.FactionNoticeBox,this._noticeBox.on(t.ViewEvent.BASE_DESTROY,this,this.noticeBoxDestroy),this._noticeBox.on("modify_fac_notice",this,this.modifyNotice),this._noticeBox.show())},e.prototype.modifyNotice=function(){var e=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);if(e.selfFactionUserModel.position>=t.FactionConfig.settingPos){var i=this._noticeBox.getNoticeStr();i!=e.facNotice&&(this._newNotice=i,t.XHR().Post({file:"petpk",cmd:"faction",op:"setting",notice:i,uid:t.Global.UID},this,this.modifyNoticeHandler))}this._noticeBox.destroy()},e.prototype.modifyNoticeHandler=function(e){if(0==e.result){t.WeakTips.show("修改公告成功");var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);i.facNotice=this._newNotice,this._newNotice=null,i.updateFinish()}else t.WeakTips.show("修改公告失败，"+e.msg)},e.prototype.noticeBoxDestroy=function(){this._noticeBox&&(this._noticeBox.off(t.ViewEvent.BASE_DESTROY,this,this.noticeBoxDestroy),this._noticeBox.off("modify_fac_notice",this,this.modifyNotice),this._noticeBox=null)},e.prototype.doOpenPracticeBox=function(){this._practiceBox||(this._practiceBox=new t.FactionPracticeBox,this._practiceBox.on(t.ViewEvent.BASE_DESTROY,this,this.practiceBoxDestroy),this._practiceBox.show())},e.prototype.practiceBoxDestroy=function(){this._practiceBox&&(this._practiceBox.off(t.ViewEvent.BASE_DESTROY,this,this.practiceBoxDestroy),this._practiceBox=null)},e.prototype.doOpenTotemBox=function(){this._totemBox||(this._totemBox=new t.FactionTotemBox,this._totemBox.on(t.ViewEvent.BASE_DESTROY,this,this.totemBoxDestroy),this._totemBox.show())},e.prototype.totemBoxDestroy=function(){this._totemBox&&(this._totemBox.off(t.ViewEvent.BASE_DESTROY,this,this.totemBoxDestroy),this._totemBox=null)},e.prototype.doEnterWuguanScene=function(){this._factionWuguanScene||(this._factionWuguanScene=new t.FactionWuguanScene,this._factionWuguanScene.on(t.ViewEvent.BASE_DESTROY,this,this.factionWuguanSceneDestroy),this._factionWuguanScene.show()),this.factionScene&&this.showOrHideFactionScene(!1)},e.prototype.factionWuguanSceneDestroy=function(e){this._factionWuguanScene.off(t.ViewEvent.BASE_DESTROY,this,this.factionWuguanSceneDestroy),this._factionWuguanScene=null,this.factionScene&&this.showOrHideFactionScene(!0),this.plugin.unregisterCommand(new t.EnterWuguanSceneCmd)},e.prototype.doOpenSmritiBox=function(){this._smritiBox||(this._smritiBox=new t.SmritiFactionBox,this._smritiBox.on(t.ViewEvent.BASE_DESTROY,this,this.smritiBoxDestroy),this._smritiBox.show())},e.prototype.smritiBoxDestroy=function(){this._smritiBox&&(this._smritiBox.off(t.ViewEvent.BASE_DESTROY,this,this.smritiBoxDestroy),this._smritiBox=null)},e.prototype.doEnterHoleScene=function(){this._factionHoleScene||(this._factionHoleScene=new t.FactionHoleScene,this._factionHoleScene.on(t.ViewEvent.BASE_DESTROY,this,this.factionHoleSceneDestroy),this._factionHoleScene.on("OPEN_NPC_BOX",this,this.openHoleNpcBox),this._factionHoleScene.on("OPEN_FIGHT_RECORD_BOX",this,this.openFightRecordBox),this._factionHoleScene.on("OPEN_FIGHT_RANK_BOX",this,this.openFightRankBox),this._factionHoleScene.show()),this.factionScene&&this.showOrHideFactionScene(!1)},e.prototype.factionHoleSceneDestroy=function(e){this._factionHoleScene.off(t.ViewEvent.BASE_DESTROY,this,this.factionHoleSceneDestroy),this._factionHoleScene.off("OPEN_NPC_BOX",this,this.openHoleNpcBox),this._factionHoleScene.off("OPEN_FIGHT_RECORD_BOX",this,this.openFightRecordBox),this._factionHoleScene.off("OPEN_FIGHT_RANK_BOX",this,this.openFightRankBox),this._factionHoleScene=null,this.factionScene&&this.showOrHideFactionScene(!0),Laya.loader.clearRes("ui/faction/factionHoleScene/rankBg1.jpg"),Laya.loader.clearRes("ui/faction/factionHoleScene/rankBg2.jpg"),Laya.loader.clearRes("ui/faction/factionHoleScene/rankBg3.jpg"),Laya.loader.clearRes("ui/faction/factionHoleScene/bossBaguaBg.png"),Laya.loader.clearRes("ui/faction/factionHoleScene/img_lianjiexian.png"),Laya.loader.clearRes("ui/faction/factionHoleScene/bgDown.png"),Laya.loader.clearRes("ui/faction/factionHoleScene/bgUp.png"),this.plugin.unregisterCommand(new t.EnterFactionHoleCmd)},e.prototype.openHoleNpcBox=function(e){this._seq=e.seq,this._holeNpcID=e.npcID,this._holeNpcHeadID=e.npcHeadID,this._holeNpcName=e.npcName,this._isBoss=e.isBoss,this._todayFightCount=e.todayFightCount,t.XHR().Post({file:"petpk",cmd:"faction",op:"cave_monster",seq:this._seq,monster:this._holeNpcID,uid:t.Global.UID},this,this.doOpenHoleNpcBox)},e.prototype.doOpenHoleNpcBox=function(e){if(0==e.result)this._holeNpcBox||(this._holeNpcBox=new t.FactionHoleNpcBox(e.monster,this._holeNpcHeadID,this._holeNpcName,this._isBoss,this._todayFightCount),this._holeNpcBox.on(t.ViewEvent.BASE_DESTROY,this,this.holeNpcBoxDestroy),this._holeNpcBox.on("DO_FIGHT",this,this.doFight),this._holeNpcBox.show());else if(120==e.result){var i=new t.ConfirmBoxData({isShowCancelBtn:!1,contentStr:"洞穴信息已更新。"});t.ConfirmBox.show(i,t.Layer.WEAK_TIP),this._factionHoleScene&&this._factionHoleScene.getFactionHoleInfo()}else t.WeakTips.show("查询怪物信息失败，"+e.msg)},e.prototype.holeNpcBoxDestroy=function(){this._holeNpcBox&&(this._holeNpcBox.off(t.ViewEvent.BASE_DESTROY,this,this.holeNpcBoxDestroy),this._holeNpcBox.off("DO_FIGHT",this,this.doFight),this._holeNpcBox=null)},e.prototype.doFight=function(){this._holeNpcBox&&this._holeNpcBox.destroy(),t.XHR().Post({file:"petpk",cmd:"faction",op:"cave_fight",seq:this._seq,monster:this._holeNpcID,uid:t.Global.UID},this,this.fightHandler)},e.prototype.fightHandler=function(e){if(0==e.result)if(this._fightData=e,!this._factionHoleScene.isJumpFight&&this._fightData.hasOwnProperty("replay"))t.addListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.fightComplete),t.SyncExecuter.constructObj(this._fightData,"fightHoleHp",this._fightData.deduct_hp),t.Facade.callCommand(new t.FightCommand(this._fightData));else{var i="";if(e.hasOwnProperty("award")){var s=e.award;if(s.hasOwnProperty("attrs")&&s.attrs.length>0)for(var n,a=0;a<s.attrs.length;a++){var o="";a>0?i+="，":o="获得",n=s.attrs[a],i+=o+this.getResourceName(n.id)+"*"+n.num}if(s.hasOwnProperty("items")&&s.items.length>0)for(var n,a=0;a<s.items.length;a++)i+="，",n=s.items[a],i+=n.name+"*"+n.num;var r=0==this._fightData.remain_hp?"，":"。";i+=r}var h=0==this._fightData.remain_hp?"成功击败！":"";t.WeakTips.show("您对【"+this._holeNpcName+"】造成了"+this._fightData.deduct_hp+"点伤害。"+i+h),this.fightComplete(),t.dispatch(t.BuffIcons.BUFF_ICONS_UPDATE)}else if(120==e.result){var l=new t.ConfirmBoxData({isShowCancelBtn:!1,contentStr:"洞穴信息已更新。"});t.ConfirmBox.show(l,t.Layer.WEAK_TIP),this._factionHoleScene&&this._factionHoleScene.getFactionHoleInfo()}else t.WeakTips.show("挑战失败，"+e.msg)},e.prototype.fightComplete=function(){t.removeListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.fightComplete),this._factionHoleScene&&(0==this._fightData.remain_hp?(this._isBoss?this._factionHoleScene.hitBoss(this._holeNpcID):this._factionHoleScene.addNpcSource(this._holeNpcID),this._factionHoleScene.getFactionHoleInfoHandler(this._fightData)):this._factionHoleScene.fightRefreshNpc(this._holeNpcID,Number(this._fightData.remain_hp))),t.Facade.callCommand(new t.SyncChangeCmd(this._fightData,!1)),this._fightData=null},e.prototype.getResourceName=function(t){switch(t){case"kContrib":return"帮贡";case"kCavePoint":return"洞穴积分";case"kStone":return"帮派石头";case"kWood":return"帮派木材";case"kIronOre":return"帮派铁矿";default:return""}},e.prototype.openFightRecordBox=function(){this._factionHoleFightRecordBox||(this._factionHoleFightRecordBox=new t.FactionHoleFightRecordBox,this._factionHoleFightRecordBox.on(t.ViewEvent.BASE_DESTROY,this,this.fightRecordBoxDestroy),this._factionHoleFightRecordBox.show())},e.prototype.fightRecordBoxDestroy=function(){this._factionHoleFightRecordBox&&(this._factionHoleFightRecordBox.off(t.ViewEvent.BASE_DESTROY,this,this.fightRecordBoxDestroy),this._factionHoleFightRecordBox=null)},e.prototype.openFightRankBox=function(e){this._factionHoleFightRankBox||(this._factionHoleFightRankBox=new t.FactionHoleFightRankBox(e.nowLv,e.nowSeq),this._factionHoleFightRankBox.on(t.ViewEvent.BASE_DESTROY,this,this.fightRankBoxDestroy),this._factionHoleFightRankBox.show())},e.prototype.fightRankBoxDestroy=function(){this._factionHoleFightRankBox&&(this._factionHoleFightRankBox.off(t.ViewEvent.BASE_DESTROY,this,this.fightRankBoxDestroy),this._factionHoleFightRankBox=null)},e.prototype.refreshFactionData=function(e){void 0===e&&(e=null),this._refreshFactionCmd=e,t.XHR().Post({file:"petpk",cmd:"faction",op:"query",need_member:1,uid:t.Global.UID},this,this.refreshFactionHandler)},e.prototype.refreshFactionHandler=function(e){if(0==e.result){var i=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);i.faction.facID=e.faction_base.facid;var s=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);s.setData(e)}this._refreshFactionCmd&&(this._refreshFactionCmd.ecode=Number(e.result),this._refreshFactionCmd.errosMsg=e.msg,this._refreshFactionCmd.finish(),this._refreshFactionCmd=null)},e.prototype.bindGroupCmd=function(e,i){t.XHR().Post({file:"petpk",cmd:"faction",op:"group",sub:e,groupid:i},this,this.bindGroupHandler)},e.prototype.bindGroupHandler=function(e){0==e.result?this.refreshFactionData():t.WeakTips.show(e.msg)},e.prototype.showOrHideFactionScene=function(t){this.factionScene&&(this.factionScene.getScene().visible=t,t?this.factionScene.reLoadBg():(Laya.loader.clearRes("ui/faction/factionScene/factionBg_1_1.jpg"),Laya.loader.clearRes("ui/faction/factionScene/factionBg_1_2.jpg"),Laya.loader.clearRes("ui/faction/factionScene/factionBg_2_1.jpg"),Laya.loader.clearRes("ui/faction/factionScene/factionBg_2_2.jpg")))},e.prototype.destroy=function(){this.plugin=null},e}();t.FactionExecuter=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){this.id=0,this.spotId=0,this.name="",this.num=0,this.pinzhi=0,this.type="",this.index=0}return t}();t.RewardModel=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){this.id=0,this.spotId=0,this.name="",this.desc="",this.nextDesc="",this.lv=0,this.pinzhi=0,this.strength=0,this.nexttrength=0,this.nextXiuwei=0}return t}();t.ChannelModel=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this._tempsource=[{url:"res/atlas/ui/beforeEnterGameLoading.json",type:Loader.ATLAS},{url:"res/atlas/ui/comp.json",type:Loader.ATLAS},{url:"res/atlas/ui/fight.json",type:Loader.ATLAS},{url:"res/atlas/ui/main.json",type:Loader.ATLAS}],Laya.loader.load(this._tempsource,new Handler(this,this.init))}return e.prototype.init=function(){window.speedReport&&window.speedReport.add&&window.speedReport.add(11),t.ProgressBar.bind(t.Facade.singleton.getPluginMgr(),t.Facade.singleton.getCommandMgr()),this._pluMgr=t.Facade.singleton.getPluginMgr(),t.Logger.log("开始启动框架："+t.ServerClock.getServerTime()),this._pluMgr.on("plugin",this,this.OnPluMgrReady),this._pluMgr.startup()},e.prototype.OnPluMgrReady=function(){t.JSUtils.setCookie("CGhasplay","1"),window.speedReport&&window.speedReport.add&&window.speedReport.add(12),this._cg=new t.CgCommand,t.Facade.callCommand(this._cg),t.EventCenter.singleton.on(t.CommandMgrEvent.COMMAND_LOAD_ERROR,this,this.loadCgError),this._cg.on(this,this.ready),t.Global.isWXAPP||t.Global.isWB||this.initSDK(),this._pluMgr.off("plugin",this,this.OnPluMgrReady)},e.prototype.ready=function(){t.EventCenter.singleton.off(t.CommandMgrEvent.COMMAND_LOAD_ERROR,this,this.loadCgError)},e.prototype.loadCgError=function(){window.speedReport&&window.speedReport.add&&window.speedReport.add(15),t.Global.GameMain.CGhasplay=!0,t.JSUtils.setCookie("CGhasplay","1"),t.JSUtils.setCookie("hasreg","1"),t.JSUtils.setCookie("gamereg","1"),t.Global.GameMain.reload(!0)},e.prototype.initSDK=function(){var e="https://qzonestyle.gtimg.cn/qzone/hybrid/lib/qqapi.1470836255000.js?_offline=1&max_age=36000000",i="https://wximg.gtimg.com/wxgame/wegame-v2.js",s=t.Global.isWX,n=Browser.document.createElement("script");n.onload=function(){t.Logger.log("window onload"),s&&wegame.ready(function(){wegame.config({appid:t.Global.appID,scope:["snsapi_userinfo","snsapi_friend","snsapi_message"],jsapiList:["menuitem:gameSendDesktop"]});var e={img_url:t.Global.protocol+"//res.ledou.qq.com/share_icon.png",title:"全民大乐斗",desc:"PK好友，统一武林，就来欢乐全民大乐斗！",timelineTitle:"PK好友，统一武林，就来欢乐全民大乐斗！",wx_share_url:t.Global.protocol+"//res.ledou.qq.com/wxShare.html",params:{invitor:t.Global.UID}};t.JSUtils.setShareInfo(e),t.GameSleep().init()})},n.onerror=function(){t.Logger.log("sdk script error")},n.src=s?i:e,n.id="sdk";var a=Browser.document.getElementsByTagName("head")[0];a.appendChild(n),Browser.window.onload=function(){t.Logger.log("window onload"),s&&wegame.ready(function(){wegame.config({appid:t.Global.appID,scope:["snsapi_userinfo","snsapi_friend","snsapi_message"],jsapiList:["menuitem:gameSendDesktop"]});var e={img_url:t.Global.protocol+"//res.ledou.qq.com/share_icon.png",title:"全民大乐斗",desc:"PK好友，统一武林，就来欢乐全民大乐斗！",timelineTitle:"PK好友，统一武林，就来欢乐全民大乐斗！",params:{invitor:t.Global.UID}};t.JSUtils.setShareInfo(e),t.GameSleep().init()})}},e.closeWindow=function(){window.mqq?mqq.invoke("ui","closeWebViews"):t.Global.isWX?wegame.invokeJsapi("closeWindow",{},function(t){}):window.open("about:blank","_self").close()},e.enterGame=function(){location.href="/enterGame.html"},e}();t.CgStart=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.IsClientRedotAct=function(t){return this.clientRedotAct.indexOf(t)>-1},t.getAct=function(t){for(var e=0;e<this.ActList.length;e++)if(this.ActList[e].id==t)return this.ActList[e];return null},t.getAllId=function(){for(var t=[],e=0;e<this.ActList.length;e++)t.push(this.ActList[e].id);return t},t.isTimeAct=function(t){var e=[5,7,19];return t?-1==e.indexOf(t):!1},t.ActList=[{id:5,ui:"hf.CaicaiCooking",source:[{url:"res/atlas/ui/act/caicaicooking.json",type:Laya.Loader.ATLAS},{url:"ui/act/caicaicooking/bg.jpg",type:Laya.Loader.IMAGE},{url:"ui/act/caicaicooking/frontBgNew.png",type:Laya.Loader.IMAGE},{url:"assets/skeleton/caicaicooking/skeleton.sk",type:Laya.Loader.BUFFER}]},{id:7,ui:"hf.BigClock",source:[{url:"res/atlas/ui/act/bigclock.json",type:Laya.Loader.ATLAS},{url:"ui/act/bigclock/bg.jpg",type:Laya.Loader.IMAGE},{url:"assets/skeleton/bigClock/nz.sk",type:Laya.Loader.BUFFER}]},{id:8,ui:"hf.Day7Gift",source:[{url:"res/atlas/ui/act/day7gift.json",type:Laya.Loader.ATLAS},{url:"ui/act/day7gift/bgNew.jpg",type:Laya.Loader.IMAGE}]},{id:9,ui:"hf.Chouqian",source:[{url:"res/atlas/ui/act/chouqian.json",type:Laya.Loader.ATLAS},{url:"ui/act/chouqian/bg.jpg",type:Laya.Loader.IMAGE},{url:"ui/act/chouqian/diaopai.png",type:Laya.Loader.IMAGE}]},{id:10,ui:"hf.FarmAct",source:[{url:"res/atlas/ui/act/farm.json",type:Laya.Loader.ATLAS},{url:"ui/act/farm/bg.jpg",type:Laya.Loader.IMAGE}]},{id:11,ui:"hf.MonthCard",source:[{url:"res/atlas/ui/act/monthcard.json",type:Laya.Loader.ATLAS},{url:"ui/act/monthcard/bg.jpg",type:Laya.Loader.IMAGE}]},{id:12,ui:"hf.LevelAct",source:[{url:"res/atlas/ui/act/levelact.json",type:Laya.Loader.ATLAS},{url:"ui/act/levelact/bg.jpg",type:Laya.Loader.IMAGE}]},{id:13,ui:"hf.Discount",source:[{url:"ui/act/discount/bg.jpg",type:Laya.Loader.IMAGE},{url:"ui/act/discount/bg_2.png",type:Laya.Loader.IMAGE},{url:"res/atlas/ui/act/discount.json",type:Laya.Loader.ATLAS}]},{id:14,ui:"hf.JianJunAct",source:[{url:"ui/act/jianjun/bg.jpg",type:Laya.Loader.IMAGE}]},{id:15,ui:"hf.DayCost",source:[{url:"res/atlas/ui/act/daycost.json",type:Laya.Loader.ATLAS},{url:"ui/act/daycost/bg.jpg",type:Laya.Loader.IMAGE}]},{id:16,ui:"hf.Punch",source:[{url:"ui/act/punch/bg.jpg",type:Laya.Loader.IMAGE}]},{id:17,ui:"hf.DayMoneyNew",source:[{url:"res/atlas/ui/act/dayMoneyNew.json",type:Laya.Loader.ATLAS},{url:"ui/act/dayMoneyNew/title.png",type:Laya.Loader.IMAGE},{url:"assets/skeleton/dayMoneyNew/rjdj.sk",type:Laya.Loader.BUFFER}]},{id:18,ui:"hf.Plan",source:[{url:"res/atlas/ui/act/plan.json",type:Laya.Loader.ATLAS}]},{id:19,ui:"hf.DayTiLi",source:[{url:"ui/act/daytili/bg_jt.jpg",type:Laya.Loader.IMAGE}]},{id:20,ui:"hf.ListenGift",source:[{url:"res/atlas/ui/act/listengift.json",type:Laya.Loader.ATLAS},{url:"ui/act/listengift/bg.jpg",type:Laya.Loader.IMAGE}]},{id:21,ui:"hf.ListenGift",source:[{url:"ui/act/listengift/bg1.jpg",type:Laya.Loader.IMAGE}]},{id:22,ui:"hf.BookWeChatPublic",source:[{url:"res/atlas/ui/act/bookwechatpublic.json",type:Laya.Loader.ATLAS},{url:"ui/act/bookwechatpublic/diban.jpg",type:Laya.Loader.IMAGE}]},{id:23,ui:"hf.Chongzhi500",source:[{url:"res/atlas/ui/act/chongzhi500.json",type:Laya.Loader.ATLAS},{url:"ui/act/chongzhi500/bg.jpg",type:Laya.Loader.IMAGE},{url:"assets/skeleton/act/scfl.sk",type:Laya.Loader.BUFFER}]},{id:24,ui:"hf.TurnTable",source:[{url:"res/atlas/ui/act/turntable.json",type:Laya.Loader.ATLAS},{url:"ui/act/turntable/bg.jpg",type:Laya.Loader.IMAGE},{url:"assets/skeleton/turntable/hj.sk",type:Laya.Loader.BUFFER}]},{id:25,ui:"hf.GoldHouse",source:[{url:"ui/act/gold/bg.jpg",type:Laya.Loader.IMAGE}]},{id:26,ui:"hf.JingHuaShop",source:[{url:"ui/act/jinghua/bg1.jpg",type:Laya.Loader.IMAGE
},{url:"res/atlas/ui/act/jinghua.json",type:Laya.Loader.ATLAS}]},{id:27,ui:"hf.DayRecharge",source:[{url:"ui/act/dayrecharge/bg.jpg",type:Laya.Loader.IMAGE},{url:"res/atlas/ui/act/dayrecharge.json",type:Laya.Loader.ATLAS}]},{id:28,ui:"hf.JointPicAct",source:[{url:"ui/act/jointPicMain/jointPic_act.jpg",type:Laya.Loader.IMAGE}]},{id:32,ui:"hf.GemHouse",source:[{url:"ui/act/hunzhu/bg.jpg",type:Laya.Loader.IMAGE}]},{id:33,ui:"hf.JointPicAct",source:[{url:"ui/act/jointPicMain/jointPic_act.jpg",type:Laya.Loader.IMAGE}]},{id:34,ui:"hf.KaiXue",source:[{url:"ui/act/kaixue/bg.jpg",type:Laya.Loader.IMAGE},{url:"res/atlas/ui/act/kaixue.json",type:Laya.Loader.ATLAS}]},{id:35,ui:"hf.Recall",source:[{url:"ui/act/recall/bg.jpg",type:Laya.Loader.IMAGE}]},{id:38,ui:"hf.OutLet",source:[{url:"ui/act/zhekou/bg.jpg",type:Laya.Loader.IMAGE}]},{id:40,ui:"hf.GemSell",source:[{url:"res/atlas/ui/act/gemSell.json",type:Laya.Loader.ATLAS},{url:"ui/act/gemSell/bg.jpg",type:Laya.Loader.IMAGE}]},{id:42,ui:"hf.SwShop",source:[{url:"ui/act/gemSell/bg.jpg",type:Laya.Loader.IMAGE}]},{id:44,ui:"hf.FishAct",source:[{url:"ui/act/fish/act.jpg",type:Laya.Loader.IMAGE}]},{id:46,ui:"hf.Hallowmas2017_1",source:[{url:"res/atlas/ui/act/hallowmas2017_1.json",type:Laya.Loader.ATLAS},{url:"ui/act/hallowmas2017_1/tu1.jpg",type:Laya.Loader.IMAGE},{url:"ui/act/hallowmas2017_1/bg1.jpg",type:Laya.Loader.IMAGE},{url:"ui/act/hallowmas2017_1/bg2.jpg",type:Laya.Loader.IMAGE}]},{id:47,ui:"hf.Hallowmas2017_2",source:[{url:"res/atlas/ui/act/hallowmas2017_2.json",type:Laya.Loader.ATLAS},{url:"ui/act/hallowmas2017_2/tu2.jpg",type:Laya.Loader.IMAGE},{url:"ui/act/hallowmas2017_2/bg1.jpg",type:Laya.Loader.IMAGE},{url:"ui/act/hallowmas2017_2/bg2.jpg",type:Laya.Loader.IMAGE}]},{id:51,ui:"hf.Pumpkin",source:[{url:"res/atlas/ui/act/pumpkin.json",type:Laya.Loader.ATLAS}]},{id:53,ui:"hf.PetGift",source:[{url:"res/atlas/ui/act/pet.json",type:Laya.Loader.ATLAS}]},{id:54,ui:"hf.CampAct",source:[{url:"res/atlas/ui/act/camp.json",type:Laya.Loader.ATLAS}]},{id:55,ui:"hf.Tehui2017Double11",source:[{url:"res/atlas/ui/act/tehui_2017double11.json",type:Laya.Loader.ATLAS}]},{id:57,ui:"hf.TurnTable_2017_11",source:[{url:"res/atlas/ui/act/turnTable_2017_11.json",type:Laya.Loader.ATLAS},{url:"ui/act/turnTable_2017_11/bg.png",type:Laya.Loader.IMAGE}]},{id:74,ui:"hf.CostPoint",source:[{url:"res/atlas/ui/act/costpoint.json",type:Laya.Loader.ATLAS},{url:"ui/act/costpoint/fengexian.jpg",type:Laya.Loader.IMAGE},{url:"ui/act/costpoint/fengexian2.jpg",type:Laya.Loader.IMAGE},{url:"ui/act/costpoint/title.jpg",type:Laya.Loader.IMAGE}]},{id:75,ui:"hf.DayRechargeDouble12_2017",source:[{url:"res/atlas/ui/act/dayrechargeDouble12_2017.json",type:Laya.Loader.ATLAS},{url:"ui/act/dayrechargeDouble12_2017/bg.jpg",type:Laya.Loader.IMAGE},{url:"ui/act/dayrechargeDouble12_2017/bg1.jpg",type:Laya.Loader.IMAGE},{url:"ui/act/dayrechargeDouble12_2017/bg2.jpg",type:Laya.Loader.IMAGE}]},{id:76,ui:"hf.NormalSellAct",source:[{url:"ui/act/normalsell/gembox.jpg",type:Laya.Loader.IMAGE}]},{id:77,ui:"hf.ZhaocaiAct",source:[{url:"res/atlas/ui/act/zhaocai.json",type:Laya.Loader.ATLAS},{url:"ui/act/zhaocai/bg.jpg",type:Laya.Loader.IMAGE}]},{id:88,ui:"hf.YearGift",source:[{url:"res/atlas/ui/act/yeargift.json",type:Laya.Loader.ATLAS},{url:"ui/act/yeargift/banner.png",type:Laya.Loader.IMAGE}]},{id:89,ui:"hf.YearSign",source:[{url:"res/atlas/ui/act/yearsign.json",type:Laya.Loader.ATLAS},{url:"ui/act/yearsign/banner.jpg",type:Laya.Loader.IMAGE}]}],t.clientRedotAct=[13,14,25,38,40],t}();t.ActConf=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){}return e.log=function(){for(var i=[],s=0;s<arguments.length;s++)i[s-0]=arguments[s];var n=i.join(" ");e.list.push(n),t.Global.isTest&&console.log(n)},e.list=[],e}();t.Logger=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.WEAPON=0,t.SKILL=1,t}();t.WSDef=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){}return e.getWords=function(i){return 0==i||i==Number(t.Global.UID)?e.SLEF_WORDS[Math.floor(Math.random()*e.SLEF_WORDS.length)]:e.OTHR_WORDS[Math.floor(Math.random()*e.OTHR_WORDS.length)]},e.SLEF_WORDS=["主人，我会好好工作，绝不偷懒！","主人，刚有个丫鬟在厨房偷吃…","我的主人是最靓的…","主人，我想家了，啥时候放我…","嘘！后面柱子有人…","我好友表哥的大舅子家隔壁王叔叔会来救我的…","隔壁二狗子家的狗来串门，被我轻松打回去了^_^！","红烧鸡翅，我最爱吃…","我本住在乐斗村，家中有屋又有田，生活乐无边…","我左青龙，右白虎，老牛在腰间，说，把馒头藏哪了…"],e.OTHR_WORDS=["嘘，趁主人不在，你赶紧救我出去吧…","天将降大任于斯人也，必先苦其心志，劳其筋骨，饿其体肤…","不想当护院的厨子，不是好门童…","内有恶犬，不得入内…","快来人哪，院子进来人了…","你是来砸场子的吗？快，我带路…","江湖！不相信眼泪…","鹅活在这个世上，有很多事无可奈何，愿不愿意都一样！","秋，残秋。黄昏，黄昏后。 风起，灯红，人别离……"],e}();t.ServentConst=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.TYPE_VIEW_MAIN="TYPE_VIEW_MAIN",t.TYPE_VIEW_QIU_HUN="TYPE_VIEW_QIU_HUN",t.TYPE_VIEW_SONG_HUA="TYPE_VIEW_SONG_HUA",t.TYPE_SUB_VIEW_BEI_QIU_HUN="TYPE_SUB_VIEW_BEI_QIU_HUN",t.TYPE_SUB_VIEW_TITLE="TYPE_SUB_VIEW_TITLE",t}();t.MarryViewType=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.MAIN=-1,t.JIAOSE=0,t.CHANGJING=1,t.LILIANG=2,t.WUQI=4,t.JINENG=5,t}();t.HandbookType=e}(hf||(hf={}));var hf;!function(t){var e=laya.utils.Dictionary,i=function(){function t(){}return t.ATTACK=0,t.DEFENCE=1,t.GEM_MIN_TYPE=1,t.GEM_MAX_TYPE=6,t.GEM_NUM=new e,t}();t.GemConst=i}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){this.updateNeedFanrong1=0,this.updateNeedFanrong2=0,this.updateNeedFanrong3=0}return t}();t.WuguanStruct=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t}();t.PracticeHallStruct=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t}();t.PositionStruct=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){}return e.setConfig=function(i){if(0==e.hasLoadConfig&&i){e.hasLoadConfig=!0,e.baseHallConfigMap=new laya.utils.Dictionary;var s=i.base_hall.items;e.MAX_BASEHALL_LV=s.length;for(var n=0;n<e.MAX_BASEHALL_LV;n++){var a=s[n],o=new t.BaseHallStruct;o.lv=a.id,o.dayNeed=a.hasOwnProperty("fee")?a.fee:0,o.updateNeedFanrong=a.hasOwnProperty("cost_glory")?a.cost_glory:0,o.updateNeedWood=a.hasOwnProperty("cost_wood")?a.cost_wood:0,o.updateNeedStone=a.hasOwnProperty("cost_stone")?a.cost_stone:0,o.updateNeedIron=a.hasOwnProperty("cost_iron_ore")?a.cost_iron_ore:0,o.maxMember=a.hasOwnProperty("max_member")?a.max_member:0,o.maxViceOnwer=a.hasOwnProperty("max_leader")?a.max_leader:0,o.maxElder=a.hasOwnProperty("max_elder")?a.max_elder:0,o.maxElite=a.hasOwnProperty("max_elite")?a.max_elite:0,o.desc=a.hasOwnProperty("desc")?a.desc:"",e.baseHallConfigMap.set(o.lv,o)}e.practiceHallConfigMap=new laya.utils.Dictionary;var r=i.pratic_hall.items;e.MAX_PRACTICE_LV=s.length;for(var n=0;n<e.MAX_PRACTICE_LV;n++){var h=r[n],l=new t.PracticeHallStruct;l.lv=h.id,l.updateNeedBaseHallLv=h.hasOwnProperty("base_hall_lvl")?h.base_hall_lvl:1,l.updateNeedFanrong=h.hasOwnProperty("cost_glory")?h.cost_glory:0,l.updateNeedWood=h.hasOwnProperty("cost_wood")?h.cost_wood:0,l.updateNeedStone=h.hasOwnProperty("cost_stone")?h.cost_stone:0,l.updateNeedIron=h.hasOwnProperty("cost_iron_ore")?h.cost_iron_ore:0,l.desc=h.hasOwnProperty("desc")?h.desc:"",e.practiceHallConfigMap.set(l.lv,l)}e.wuGuanConfigMap=new laya.utils.Dictionary;var c=i.martial_club.items;e.MAX_WUSHU_LV=s.length;for(var n=0;n<e.MAX_WUSHU_LV;n++){var d=c[n],u=new t.WuguanStruct;u.lv=d.id,u.updateNeedBaseHallLv=d.hasOwnProperty("base_hall_lvl")?d.base_hall_lvl:1,u.updateNeedExp=d.hasOwnProperty("exp")?d.exp:0;var p=d.martial_club_power;u.value1=p.hasOwnProperty("exattr")?p.exattr:0,u.updateNeedFanrong1=p.hasOwnProperty("cost_glory")?p.cost_glory:0,u.updateNeedWood1=p.hasOwnProperty("cost_wood")?p.cost_wood:0,u.updateNeedStone1=p.hasOwnProperty("cost_stone")?p.cost_stone:0,u.updateNeedIron1=p.hasOwnProperty("cost_iron_ore")?p.cost_iron_ore:0,u.desc1=p.hasOwnProperty("desc")?p.desc:"";var _=d.martial_club_phy;u.value2=_.hasOwnProperty("exattr")?_.exattr:0,u.updateNeedFanrong2=_.hasOwnProperty("cost_glory")?_.cost_glory:0,u.updateNeedWood2=_.hasOwnProperty("cost_wood")?_.cost_wood:0,u.updateNeedStone2=_.hasOwnProperty("cost_stone")?_.cost_stone:0,u.updateNeedIron2=_.hasOwnProperty("cost_iron_ore")?_.cost_iron_ore:0,u.desc2=_.hasOwnProperty("desc")?_.desc:"";var f=d.martial_club_speed;u.value3=f.hasOwnProperty("exattr")?f.exattr:0,u.updateNeedFanrong3=f.hasOwnProperty("cost_glory")?f.cost_glory:0,u.updateNeedWood3=f.hasOwnProperty("cost_wood")?f.cost_wood:0,u.updateNeedStone3=f.hasOwnProperty("cost_stone")?f.cost_stone:0,u.updateNeedIron3=f.hasOwnProperty("cost_iron_ore")?f.cost_iron_ore:0,u.desc3=f.hasOwnProperty("desc")?f.desc:"",e.wuGuanConfigMap.set(u.lv,u)}e.positionConfigMap=new laya.utils.Dictionary;for(var y=i.faction_postion.items,m=y.length,g={500:7,400:9,200:12,100:14},n=0;m>n;n++){var v=y[n],C=new t.PositionStruct;C.pos=v.postion,C.name=v.hasOwnProperty("name")?v.name:"",C.canUpdateBuilding=v.hasOwnProperty("lvlup_building")&&("true"==String(v.lvlup_building)||"1"==String(v.lvlup_building)),C.canAuditing=v.hasOwnProperty("auditing")&&("true"==String(v.auditing)||"1"==String(v.auditing)),C.canKick=v.hasOwnProperty("remove")&&("true"==String(v.remove)||"1"==String(v.remove)),C.canChangePos=v.hasOwnProperty("promote")&&("true"==String(v.promote)||"1"==String(v.promote)),C.canSetting=v.hasOwnProperty("setting")&&("true"==String(v.setting)||"1"==String(v.setting)),C.smritiDay=v.hasOwnProperty("inherit_time")?Number(v.inherit_time):Number(g[C.pos]),e.positionConfigMap.set(C.pos,C),C.canUpdateBuilding&&(0==e.updateBuildingPos||C.pos<e.updateBuildingPos)&&(e.updateBuildingPos=C.pos,e.updateBuildingName=C.name),C.canAuditing&&(0==e.auditingPos||C.pos<e.auditingPos)&&(e.auditingPos=C.pos,e.auditingName=C.name),C.canKick&&(0==e.kickPos||C.pos<e.kickPos)&&(e.kickPos=C.pos,e.kickName=C.name),C.canChangePos&&(0==e.changePos||C.pos<e.changePos)&&(e.changePos=C.pos,e.changeName=C.name),C.canSetting&&(0==e.settingPos||C.pos<e.settingPos)&&(e.settingPos=C.pos,e.settingName=C.name)}e.totemFlagArr=[],e.totemTableArr=[],e.totemPicArr=[],e.iconArr=[];var w=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF),x=i.faction_totem.items;x.sort(function(t,e){return t.totem_id-e.totem_id});for(var b=x.length,n=0;b>n;n++){var S=x[n],I=S.totem_type,T=S.hasOwnProperty("level_required")?Number(S.level_required):0;1==I?(e.totemFlagArr.push({totem_id:S.totem_id,icon_id:S.rcid,needLv:T}),1==e.totemFlagArr.length&&(e.DEFAULT_TOTEM_FLAG=S.totem_id,0==w.totem_flag&&(w.totem_flag=e.DEFAULT_TOTEM_FLAG))):2==I?(e.totemTableArr.push({totem_id:S.totem_id,icon_id:S.rcid,needLv:T}),1==e.totemTableArr.length&&(e.DEFAULT_TOTEM_TABLE=S.totem_id,0==w.totem_table&&(w.totem_table=e.DEFAULT_TOTEM_TABLE))):3==I?(e.totemPicArr.push({totem_id:S.totem_id,icon_id:S.rcid,needLv:T}),1==e.totemPicArr.length&&(e.DEFAULT_TOTEM_PIC=S.totem_id,0==w.totem_pic&&(w.totem_pic=e.DEFAULT_TOTEM_PIC))):(e.iconArr.push({totem_id:S.totem_id,icon_id:S.rcid,needLv:T}),1==e.iconArr.length&&(e.DEFAULT_ICON=S.totem_id,0==w.facIcon&&(w.facIcon=e.DEFAULT_ICON)))}}},e.getBaseHallConfig=function(t){return e.baseHallConfigMap.get(t)},e.getPracticeHallConfig=function(t){return e.practiceHallConfigMap.get(t)},e.getWuguanConfig=function(t){return e.wuGuanConfigMap.get(t)},e.getPositionConfig=function(t){return e.positionConfigMap.get(t)},e.getTotemObj=function(t,i){var s=1==t?e.totemFlagArr:2==t?e.totemTableArr:3==t?e.totemPicArr:e.iconArr;return s[i]},e.getTotemIndexByID=function(t,i){for(var s=0,n=1==t?e.totemFlagArr:2==t?e.totemTableArr:3==t?e.totemPicArr:e.iconArr,a=0;a<n.length;a++){var o=n[a];if(o.totem_id==i){s=o.icon_id;break}}return s},e.getTotemIndexValueByID=function(t,i){for(var s=0,n=1==t?e.totemFlagArr:2==t?e.totemTableArr:3==t?e.totemPicArr:e.iconArr,a=0;a<n.length;a++){var o=n[a];if(o.totem_id==i){s=a+1;break}}return s},e.getConfigByType=function(t,i){return 1==i?e.getPracticeHallConfig(t):2==i?e.getBaseHallConfig(t):3==i?e.getWuguanConfig(t):void 0},e.WOOD=33,e.STONE=32,e.IRON=34,e.BUILDING_PRACTICE=1,e.BUILDING_BASEHALL=2,e.BUILDING_WUSHU=3,e.hasLoadConfig=!1,e.DEFAULT_TOTEM_FLAG=0,e.DEFAULT_TOTEM_TABLE=0,e.DEFAULT_TOTEM_PIC=0,e.DEFAULT_ICON=0,e.OPEN_PRACTICE_HALL_NEED_LV=1,e.OPEN_WUGUAN_NEED_LV=1,e.OPEN_HOLE_NEED_LV=1,e.OPEN_WAR_NEED_LV=1,e.updateBuildingPos=0,e.updateBuildingName="",e.auditingPos=0,e.auditingName="",e.kickPos=0,e.kickName="",e.changePos=0,e.changeName="",e.settingPos=0,e.settingName="",e}();t.FactionConfig=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){this.updateNeedBaseHallLv=0}return t}();t.BaseHallStruct=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.XIANXIA_Load_OVER="xianxia_over",t}();t.CommonEvent=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.PLUGIN_MANAGER="IPluginManager",t.PLUGIN_COMMAND_MANAGER="ICommandManager",t.PLUGIN_COMMON="PLUGIN_COMMON",t.PLUGIN_HOME="PLUGIN_HOME",t.PLUGIN_USERINFO="PLUGIN_USERINFO",t.PLUGIN_FIGHT="PLUGIN_FIGHT",t.PLUGIN_LILIAN="PLUGIN_LILIAN",t.PLUGIN_FRIEND="PLUGIN_FRIEND",t.PLUGIN_INVITE_FRIEND="PLUGIN_INVITE_FRIEND",t.PLUGIN_BAG="PLUGIN_BAG",t.PLUGIN_MAIL="PLUGIN_MAIL",t.PLUGIN_WULIN="PLUGIN_WULIN",t.PLUGIN_STRENGTH="PLUGIN_STRENGTH",t.PLUGIN_UPGRADE="PLUGIN_UPGRADE",t.PLUGIN_SHOP="PLUGIN_SHOP",t.PLUGIN_CHANNELS="PLUGIN_CHANNELS",t.PLUGIN_TASK="PLUGIN_TASK",t.PLUGIN_SIGN="PLUGIN_SIGN",t.PLUGIN_GUIDE="PLUGIN_GUIDE",t.PLUGIN_SOUND="PLUGIN_SOUND",t.PLUGIN_CG="PLUGIN_CG",t.PLUGIN_BUFF="PLUGIN_BUFF",t.PLUGIN_VIP="PLUGIN_VIP",t.PLUGIN_RANK="PLUGIN_RANK",t.PLUGIN_GEM="PLUGIN_GEM",t.PLUGIN_CHANGE72="PLUGIN_CHANGE72",t.PLUGIN_ACT="PLUGIN_ACT",t.PLUGIN_SERVENT="PLUGIN_SERVENT",t.PLUGIN_COLLECT="PLUGIN_COLLECT",t.PLUGIN_SET="PLUGIN_SET",t.PLUGIN_TOWER="PLUGIN_TOWER",t.PLUGIN_FACTION="PLUGIN_FACTION",t.PLUGIN_SHARE="PLUGIN_SHARE",t.PLUGIN_SUBSCRIPTION="PLUGIN_SUBSCRIPTION",t.PLUGIN_HANDBOOK="PLUGIN_HANDBOOK",t.PLUGIN_CHAIN="PLUGIN_CHAIN",t.PLUGIN_MARRY="PLUGIN_MARRY",t.PLUGIN_TALK="PLUGIN_TALK",t.PLUGIN_MONSTER="PLUGIN_MONSTER",t.PLUGIN_CHAMPION="PLUGIN_CHAMPION",t.PLUGIN_CHAMPIONTEAM="PLUGIN_CHAMPIONTEAM",t.PLUGIN_SCHOOL_OPEN2017_TOTAL="PLUGIN_SCHOOL_OPEN2017_TOTAL",t.PLUGIN_NATIONAL_TOTAL="PLUGIN_NATIONAL_TOTAL",t.PLUGIN_RECALL="PLUGIN_RECALL",t.PLUGIN_MASTER="PLUGIN_MASTER",t.PLUGIN_REBATE="PLUGIN_REBATE",t.PLUGIN_HANGUP="PLUGIN_HANGUP",t.PLUGIN_CHRISTMAS="PLUGIN_CHRISTMAS",t.PLUGIN_CHRISTMASTOTAL="PLUGIN_CHRISTMASTOTAL",t.PLUGIN_MUSIC_MASTER="PLUGIN_MUSIC_MASTER",t}();t.PluginDef=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(t,e,i,s){void 0===e&&(e=null),void 0===i&&(i=null),void 0===s&&(s=null),this.type=t,this.key=e,this.oldValue=i,this.newValue=s}return t.REMOVE="remove",t.UPDATE="update",t.UPDATE_FINISH="updateFinish",t}();t.ModelEvent=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.SELF_USER_MODEL="self_user_model",t.PACK_MODEL="pack_model",t.PACK_Item_MODEL="pack_item_model",t.SHOP_MODEL="shop_model",t.SHOP_ITEM_MODEL="shop_item_model",t.WEOPEN_SKILL_MODEL="weopen_skill_model",t.GUIDE_MODEL="guide_model",t.ALL_STATUS_MODEL="all_status_model",t.STATUS_ITEM_MODEL="status_item_model",t.BUFF_MODEL="buff_model",t.SERVER_SET_DATA_MODEL="server_set_data_model",t.CHAMPION_TEAM_MODEL="champion_team_model",t.MASTER_MODEL="master_model",t.FACTION_BRIEF_MODEL="FACTION_BRIEF_MODEL",t.FACTION_MODEL_SELF="FACTION_MODEL_SELF",t.FACTION_USER_MODEL="FACTION_USER_MODEL",t.ACT_MODEL="ACT_MODEL",t.ACT_ITEM_MODEL="ACT_ITEM_MODEL",t}();t.ModelDef=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.LILIAN_CONF="{config}config/lilian/lilianconfig.json",t.PLOT="{config}config/lilian/plot.json",t.NPC_RES="{config}config/npcRes.json",t.SERVENT_BG="{config}scene/jd.jpg",t.ROBBED_BG="{config}scene/jd.jpg",t.CHAMPION_BG="{config}scene/champion.jpg",t}();t.ConfigDef=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.BOX_SHOW="boxShow",t.BOX_HIDE="boxHide",t.BASE_DESTROY="base_destroy",t}();t.ViewEvent=e}(hf||(hf={}));var hf;!function(t){var e=Laya.SoundManager,i=Laya.ColorFilter,s=function(){function t(){}return t.createObject=function(t){for(var e=t.split("."),i=e.length,s=window,n=0;i>n;n++)s=s[e[n]];return Object.create(s.prototype)},t.getWordByNum=function(t){return["零","一","二","三","四","五","六","七","八","九","十"][t]},t.toGrayAndDisabled=function(t){var e=[.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0],s=new i(e);t.filters=[s],t.mouseEnabled=!1},t.toGray=function(t){var e=[.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0],s=new i(e);t.filters=[s]},t.enable=function(t){t.filters=[],t.mouseEnabled=!0,t.mouseThrough=!1},t.playMusic=function(i,s){void 0===s&&(s=!0),t.stopMusic(),t._musicChannel=e.playMusic(i,s?0:1)},t.stopMusic=function(){t._musicChannel&&t._musicChannel.stop()},t.playEffect=function(i,s){t._effectChannel=e.playSound(i,1,s)},t.DecodeJSONProperty=function(t,e){if("object"==typeof e)if(e.length>0)for(var i=0;i<e.length;i++)this.DecodeJSONProperty(t,e[i]);else for(var s in e)if(s.indexOf(t)>-1&&"string"==typeof e[s])try{e[s]=decodeURIComponent(e[s])}catch(n){e[s]=e[s]}else this.DecodeJSONProperty(t,e[s])},t}();t.Util=s}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.replace=function(t,e){var i,s=t;if(e instanceof Array)for(var n=0;n<e.length;n++)i=e[n],s=s.replace("%"+(n+1)+"%",i);else if(e instanceof Object)for(var a in e)i=e[a],s=s.replace("%"+a+"%",i);else"string"==typeof e&&e.constructor==String&&(s=s.replace("%1%",e+""));return s},t}();t.StringUtil=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){}return e.setDivStyle=function(t,e,i,s,n,a){void 0===e&&(e="黑体"),void 0===i&&(i=24),void 0===s&&(s=!0),void 0===n&&(n="#7a583d"),void 0===a&&(a="left"),t.style.fontFamily=e,t.style.fontSize=i,t.style.bold=s,t.style.color=n,t.style.align=a},e.getStyleFont=function(e,i){void 0===i&&(i=null);var s="";i&&(s+='color="'+i+'"');var n=t.StringUtil.replace("<font %style%>%content%</font>",{content:e,style:s});return n},e.changeSpecialHtml=function(t){var e;return e=t.replace(/&lt;/g,"<"),e=e.replace(/&gt;/g,">"),e=e.replace(/&amp;/g,"&"),e=e.replace(/&#32;/g,"\\"),e=e.replace(/&quot;/g,'"'),e=e.replace(/&#64;/g,"@"),e=e.replace(/&#92;/g,"\\"),e=e.replace(/&#91;/g,"["),e=e.replace(/&#93;/g,"]"),e=e.replace(/&#40;/g,"("),e=e.replace(/&#41;/g,")"),e=e.replace(/&#123;/g,"{"),e=e.replace(/&#125;/g,"}"),e=e.replace(/&#59;/g,";"),e=e.replace(/&#44;/g,","),e=e.replace(/&#60;/g,"`"),e=e.replace(/&#46;/g,"."),e=e.replace(/&#58;/g,":"),e=e.replace(/&#47;/g,"/"),e=e.replace(/&#32;/g,"+"),e=e.replace(/[힤-]/g,"?")},e}();t.HTMLTextUtil=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){}return e.setTimeText=function(i,s,n,a){if(void 0===n&&(n="NN:SS"),void 0===a&&(a="{time}"),s=Math.ceil(s),s=Math.max(s,0),s>0){e.map||(e.map=new laya.utils.Dictionary);var o=e.map.get(i);o?(o.content=a,o.start=t.ServerClock.getServerTime(),o.sec=s,o.format=n):e.map.set(i,{content:a,start:t.ServerClock.getServerTime(),sec:s,format:n}),i.text=a.replace("{time}",t.DateUtils.toTimeRemaining(1e3*s,n)),e.isRun||Laya.timer.loop(1e3,e,e.run)}},e.run=function(){for(var i=e.map.keys,s=i.length,n=t.ServerClock.getServerTime(),a=s-1;a>=0;a--){var o=i[a],r=e.map.get(o),h=Math.round(r.sec-Number((n-r.start)/1e3));0>=h&&(h=0);var l=r.content,c=r.format||"NN:SS";o.text=l.replace("{time}",t.DateUtils.toTimeRemaining(1e3*h,c)),o.event(e.TIME_UPDATE,o),0>=h&&(e.removeTimeText(o),0==e.map.keys.length&&Laya.timer.clear(e,e.run),o.event(e.TIME_UP,o))}},e.removeTimeText=function(t){e.map&&e.map.remove(t)},e.hasTimeText=function(t){if(null==e.map)return!1;var i=e.map.get(t);return null!=i},e.TIME_UP="timeUp",e.TIME_UPDATE="timeUpdate",e}();t.TimeTextControl=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){this.url="",this.redUrl="",this.loadState=0}return t}();t.SlientlyLoadInfo=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){}return e.changeScene=function(i,s){void 0===s&&(s=!0);var n=!1;if(e.current!=i){if(e.current){e.current.getSceneName();e.current.getScene().parent&&e.current.getScene().parent.removeChild(e.current.getScene()),e.current.onHided()}e.current=null==i?e.defaultScene:i,e.current&&(s&&t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.SCENE_CHANGE,e.current.getSceneName())),n=!0,t.LayerMgr.addChild(e.current.getScene(),t.Layer.SCENE),e.current.onShowed())}!n&&e.current&&s&&t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.SCENE_CHANGE,e.current.getSceneName())),t.BoxMgr.hideAll();for(var a=e.change.concat(),o=0;o<a.length;o++){var r=a[o],h=r.caller,l=r.func;l.apply(h)}},e.addChangeSceneCallback=function(t,i){for(var s=!1,n=e.change.length,a=0;n>a;a++){var o=e.change[a];if(o.func==i){s=!0;break}}s||e.change.push({caller:t,func:i})},e.removeChangeSceneCallback=function(t,i){for(var s=e.change.length,n=0;s>n;n++){var a=e.change[n];if(a.func==i){a.caller=null,a.func=null,e.change.splice(n,1);break}}},e.registerDefaultScene=function(t){e.defaultScene=t},e.change=[],e}();t.SceneMgr=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.MAIN_SCENE="main_scene",t.LILIAN_SCENE="lilian_scene",t.SERVENT_SCENE="servent_scene",t.CG_SCENE="cg_scene",t.TOWER_SCENE="tower_scene",t.FACTION_SCENE="faction_scene",t.ChAIN_SCENE="chain_scene",t.MONSTER_SCENE="monster_scene",t.CHAMPION_SCENE="champion_scene",t.CHAMPIONTEAM_SCENE="championteam_scene",t.SCHOOL_OPEN2017_TOTAL="SCHOOL_OPEN2017_TOTAL",t.NATIONAL_TOTAL="NATIONAL_TOTAL",t.MASTER_SCENE="master_scene",t.REBATE_SCENE="REBATE_SCENE",t.MASTER_LILIAN_SCENE="master_lilian_scene",t.HANGUP_SCENE="HANGUP_SCENE",t.MUSIC_MASTER="MUSIC_MASTER",t}();t.SceneDef=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.PLUGIN_CONFIG_ERROR="pluginConfigError",t.PLUGIN_LOAD_START="pluginLoadStart",t.PLUGIN_LOAD_MISSION_COMPLETE="pluginLoadResourceComplete",t.PLUGIN_LOAD_COMPLETE="pluginLoadComplete",t.PLUGIN_LOAD_MISSION_ERROR="pluginLoadMissionError",t.PLUGIN_LOAD_PROGRESS="pluginLoadProgress",t.PLUGIN_LOAD_ERROR="pluginLoadError",t.PLUGIN_CREATE_ERROR="pluginCreateError",t.PLUGIN_REGISTER="pluginRegister",t.PLUGIN_REMOVE="pluginRemove",t}();t.PluginEvent=e}(hf||(hf={}));var hf;!function(t){var e=laya.ani.swf.MovieClip,i=function(){function i(){this.SWFPath="assets/swf/loading.swf",this.MCWidth=70,this.MCHeight=70,this.loadingUI=new Sprite,this.loadingUI.mouseEnabled=!0,this.loadingUI.hitTestPrior=!1;var i=new Sprite;i.graphics.drawRect(0,0,t.LayerMgr.width,t.LayerMgr.clientHeight,"#000000"),i.alpha=.4,i.y=-t.LayerMgr.offY,i.mouseEnabled=!0,i.size(t.LayerMgr.width,t.LayerMgr.clientHeight);var s=new e;s.load(this.SWFPath),s.x=(t.LayerMgr.width-this.MCWidth)/2,s.y=(t.LayerMgr.height-this.MCHeight)/2,this.loadingUI.addChild(i),this.loadingUI.addChild(s),this.loadingUI.size(t.LayerMgr.width,t.LayerMgr.clientHeight)}return Object.defineProperty(i,"instance",{get:function(){return null==t.Loading._instance&&(t.Loading._instance=new t.Loading),t.Loading._instance},enumerable:!0,configurable:!0}),i.show=function(){i.instance.loadingUI.parent||(t.LayerMgr.addChild(i.instance.loadingUI,t.Layer.LOADING),i.instance.loadingUI.alpha=0,i.hasDoTimer=!1,Laya.timer.once(500,this,i.showAlpha))},i.showAlpha=function(){i.hasDoTimer=!0,i.instance.loadingUI.alpha=1},i.hide=function(){0==i.hasDoTimer&&Laya.timer.clear(this,i.showAlpha),i.instance.loadingUI.parent&&t.LayerMgr.removeChild(i.instance.loadingUI)},i}();t.Loading=i}(hf||(hf={}));var hf;!function(t){var e=laya.display.Sprite,i=function(){function i(){}return i.setContainer=function(t,s,n){i.offY=0,i.parent=t,i.width=s,i.height=n,i.parent=new e,t.addChild(i.parent),Laya.stage.on(Laya.Event.RESIZE,this,this.onResize),this.onResize()},i.onResize=function(){var e,s;t.Logger.log("Browser.clientWidth:"+Laya.Browser.clientWidth+" Browser.clientHeight:"+Laya.Browser.clientHeight),Laya.Browser.clientWidth>Laya.Browser.clientHeight?(e=Laya.Browser.clientWidth,s=Laya.Browser.clientHeight):(e=Laya.Browser.clientHeight,s=Laya.Browser.clientWidth),s=s*i.width/e,Laya.Browser.clientWidth/Laya.Browser.clientHeight>i.width/i.height?(i.offY=0,i.offX=(Laya.Browser.clientWidth*i.height/Laya.Browser.clientHeight-i.width)/2,i.parent.x=i.offX,i.parent.y=0):(i.offY=(s-i.height)/2,i.offX=0,i.parent.x=0,i.parent.y=i.offY),i.offY>0?i.clientHeight=i.height+2*i.offY:i.clientHeight=i.height,i.parent.size(i.width,i.clientHeight),i.init()},i.init=function(){if(t.Logger.log("LayerMgr.init---"),!i.parent)return!1;if(0==i._hasInit&&(i.layerMap=new laya.utils.Dictionary,i.addLayer(t.Layer.SCENE_BG)),i.offY>0&&!i._hasSceneBgUp){i._hasSceneBgUp=!0;var e=new ui.common.SceneBgUI;i.addChild(e,t.Layer.SCENE_BG),e.y=-126;var s=new ui.common.SceneBgUI;i.addChild(s,t.Layer.SCENE_BG),s.rotation=180,s.x=i.width,s.y=i.height+126}if(0==i._hasInit&&(i.addLayer(t.Layer.SCENE),i.addLayer(t.Layer.BASE_UI,!1),i.addLayer(t.Layer.BOX,!0),i.addLayer(t.Layer.GUIDE,!0),i.addLayer(t.Layer.LV_UP,!0),i.addLayer(t.Layer.FIGHT,!0),i.addLayer(t.Layer.GUIDE_IN_FIGHT,!0),i.addLayer(t.Layer.STORY,!0),i.addLayer(t.Layer.TIP),i.addLayer(t.Layer.ALERT,!0),i.addLayer(t.Layer.LOADING,!0),i.addLayer(t.Layer.BEFORE_ENTER_GAME),i.addLayer(t.Layer.WEAK_TIP),i.addLayer(t.Layer.SCENE_BG_LONG)),Laya.Browser.clientWidth/Laya.Browser.clientHeight>i.width/i.height&&!i._hasSceneBgLeft){i._hasSceneBgLeft=!0;var n=new ui.common.SceneBgLongUI;i.addChild(n,t.Layer.SCENE_BG_LONG),n.x=-158;var a=new ui.common.SceneBgLongUI;i.addChild(a,t.Layer.SCENE_BG_LONG),a.rotation=180,a.y=i.height,a.x=i.width+158}i._hasInit=!0},i.getStage=function(){return Laya.stage},i.getLayerIndex=function(t){return i.layerMap.get(t).index},i.setDefaultLayer=function(t){i.defaultLayer=t},i.showLayer=function(t){var e=i.getLayer(t);e&&(e.visible=!0)},i.hideLayer=function(t){var e=i.getLayer(t);e&&(e.visible=!1)},i.addLayer=function(s,n,a){void 0===n&&(n=!1),void 0===a&&(a=!1);var o=i.parent.getChildByName(s);if(o)return void t.Logger.log("layer <"+s+"> 已创建!");var r=new e;a&&(r.cacheAs="bitmap"),r.visible=!1,n&&(r.mouseEnabled=n),r.name=s,i.parent.addChild(r),i.layerMap.set(s,{layer:r,index:i.parent.numChildren})},i.getLayer=function(t){return t?i.layerMap.get(t).layer:null},i.addChild=function(t,e){void 0===e&&(e=null);var s=i.getLayer(e||i.defaultLayer);return s&&(s.visible=!0,s.addChild(t)),t},i.addChildAt=function(t,e,s){void 0===s&&(s=null);var n=i.getLayer(s||i.defaultLayer);return n&&(n.visible=!0,n.addChildAt(t,e)),t},i.getChildByName=function(t,e){void 0===e&&(e=null);var s;if(e)return s=i.getLayer(e),s?s.getChildByName(t):null;for(var n=0;n<i.parent.numChildren;n++)if(s=i.parent.getChildAt(n)){var a=s.getChildByName(t);if(a)return a}return null},i.removeChild=function(t){return t?(t.parent&&t.parent.removeChild(t),t):t},i.setCenter=function(t){return t?(t.x=(i.width-t.width)/2,t.y=(i.height-t.height)/2,t):t},i.enterFightHideOtherLayer=function(){var e;e=i.getLayer(t.Layer.SCENE),e&&(i.sceneLayer=e,i.parent.removeChild(e)),e=i.getLayer(t.Layer.BASE_UI),e&&(i.baseLayer=e,i.parent.removeChild(e)),e=i.getLayer(t.Layer.BOX),e&&(i.boxLayer=e,i.parent.removeChild(e)),e=i.getLayer(t.Layer.LV_UP),e&&(e.visible=!1),e=i.getLayer(t.Layer.TIP),e&&(e.visible=!1),e=i.getLayer(t.Layer.ALERT),e&&(e.visible=!1),e=i.getLayer(t.Layer.WEAK_TIP),e&&(e.visible=!1),e=i.getLayer(t.Layer.LOADING),e&&(e.visible=!1)},i.endFightshowOtherLayer=function(){var e;i.boxLayer&&(i.parent.addChildAt(i.boxLayer,1),i.boxLayer=null),i.baseLayer&&(i.parent.addChildAt(i.baseLayer,1),i.baseLayer=null),i.sceneLayer&&(i.parent.addChildAt(i.sceneLayer,1),i.sceneLayer=null),e=i.getLayer(t.Layer.LV_UP),e&&(e.visible=!0),e=i.getLayer(t.Layer.TIP),e&&(e.visible=!0),e=i.getLayer(t.Layer.ALERT),e&&(e.visible=!0),e=i.getLayer(t.Layer.WEAK_TIP),e&&(e.visible=!0),e=i.getLayer(t.Layer.LOADING),e&&(e.visible=!0)},i.offX=0,i.offY=0,i._hasInit=!1,i._hasSceneBgUp=!1,i._hasSceneBgLeft=!1,i}();t.LayerMgr=i}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.SCENE_BG="scene_bg",t.SCENE="scene",t.BASE_UI="base_ui",t.BOX="box",t.FIGHT="fight",t.TIP="tip",t.ALERT="alert",t.WEAK_TIP="weakTip",t.LOADING="loading",t.GUIDE="guide",t.GUIDE_IN_FIGHT="guide_in_fight",t.LV_UP="lv_up",t.STORY="story",t.BEFORE_ENTER_GAME="before_enter_game",t.SCENE_BG_LONG="scene_bg_long",t}();t.Layer=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){}return Object.defineProperty(e,"GameName",{get:function(){return e.GAMENAME[e.PF]?e.GAMENAME[e.PF]:"全民大乐斗"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"isWX",{get:function(){return"wx"==e.PF},enumerable:!0,configurable:!0}),Object.defineProperty(e,"isSP",{get:function(){return e.isSQ&&10029421==t.JSUtils.getChannel()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"isWXAPP",{get:function(){return!!window.WXAPP},enumerable:!0,configurable:!0}),Object.defineProperty(e,"isYYB",{get:function(){return"yyb"==e.PF},enumerable:!0,configurable:!0}),Object.defineProperty(e,"isWB",{get:function(){return"wb"==e.PF},enumerable:!0,configurable:!0}),Object.defineProperty(e,"isSQ",{get:function(){return"sq"==e.PF},enumerable:!0,configurable:!0}),Object.defineProperty(e,"isTest",{get:function(){return"test"==e.PF},enumerable:!0,configurable:!0}),Object.defineProperty(e,"appID",{get:function(){return e.APPIDS[e.PF]},enumerable:!0,configurable:!0}),e.getRes=function(t){return t=t.replace("{config}",e.ResPath),Laya.loader.getRes(t)},e.getUrl=function(t){return t.replace("{config}",e.ResPath)},e.clearRes=function(t){Laya.loader.clearRes(e.getUrl(t))},Object.defineProperty(e,"netWorkType",{get:function(){return t.NetEvn.singleton.netWorkType},enumerable:!0,configurable:!0}),Object.defineProperty(e,"isWifi",{get:function(){return t.NetEvn.singleton.isWifi},enumerable:!0,configurable:!0}),Object.defineProperty(e,"isRetrench",{get:function(){return t.RetrenchMode.singleton.isRetrech},enumerable:!0,configurable:!0}),e.WIDTH=1334,e.HEIGHT=750,e.UID="",e.WebHost="http://ledou.qq.com",e.WebPath="/fcgi-bin/",e.ResPath="http://res.ledou.qq.com/ledoures/",e.ResHost="http://res.ledou.qq.com",e.BASE_URI="http://ledou.qq.com/fcgi-bin/petpk",e.CLIENT_PATH="",e.BASE_FILE="petpk",e.ReportType=3,e.FROM="0",e.INVITE_OPENID="",e.lilianMode=0,e.reLoginTimes=0,e.WXCODE="",e.PF="wb",e.protocol="https:",e.APPIDS={sq:"1105748669",wb:"1105748669",wx:"wx1fc34edbe7d4c25c",wxapp:"wxc7bdffeaa050ca4c"},e.GAMENAME={sq:"全民大乐斗",wb:"全民大乐斗",wx:"全民大乐斗",test:"全民大乐斗",wxapp:"全民大乐斗"},e.BOY=1,e.GIRL=2,e.WXAPP_SPECIAL_DEAL=!0,e.FLOAT_ICON_OFFSET=0,e.SCENE_ID_ARR=["1001","10001","10002","10003","10004","10005","10006","20001","30001","30002","30003","30004","30005","30006","30007","30009","30010","40001"],e.HandBook_bgs=[],e.elemPosMap=new laya.utils.Dictionary,e.skipCheckCostChanmpion=!1,e.skipCheckPlayBall=!1,e}();t.Global=e}(hf||(hf={}));var hf;!function(t){var e=laya.utils.Dictionary,i=function(){function i(){this.map=new e}return i.prototype.retrieveModel=function(t){return this.map.get(t)},i.prototype.hasModel=function(t){return null!=this.retrieveModel(t)},i.prototype.registerModel=function(e){return this.hasModel(e.getModelName())?void t.Logger.log("Model已存在!"):void this.map.set(e.getModelName(),e)},i.prototype.removeModel=function(e){return this.hasModel(e)?void this.map.remove(e):void t.Logger.log("Model不存在!")},i}();t.ModelMgr=i}(hf||(hf={}));var hf;!function(t){function e(){var e=t.ConfigMgr.singleton;return e}var i=laya.utils.Dictionary,s=function(){function e(){if(null!=e._singleton)throw Error("SINGLETON");e._singleton=this}return Object.defineProperty(e,"singleton",{get:function(){return null==e._singleton&&new e,e._singleton},enumerable:!0,configurable:!0}),e.prototype.initialize=function(){this.m_npcResMap=new i;for(var e,s=t.Global.getRes(t.ConfigDef.NPC_RES),n=s.items.length,a=0;n>a;a++)e=s.items[a],this.m_npcResMap.set(e.id,e)},e.prototype.getNpcInfoById=function(t){return this.m_npcResMap.get(t)},e}();t.ConfigMgr=s,t.configMgr=e}(hf||(hf={}));var hf;!function(t){var e=function(){
function t(){}return t.COMMAND_REQUEST="commandRequest",t.COMMAND_EXECUTE="commandExecute",t.COMMAND_LOAD_START="commandLoadStart",t.COMMAND_LOAD_COMPLETE="commandLoadComplete",t.COMMAND_LOAD_ERROR="commandLoadError",t.COMMAND_PLUGIN_ERROR="commandPluginError",t}();t.CommandMgrEvent=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.FINISH="finish",t.PROGRESS="progress",t}();t.CommandEvent=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this.ecode=e.ERR_COMMAND_ECODE_UNDEFINED}return e.prototype.init=function(t){void 0===t&&(t=null)},e.prototype.finish=function(){t.Logger.log("[command]","["+this.getPluginName()+"]","[finish]",this.getCommandName()),t.EventCenter.singleton.event(this.getCommandName())},e.prototype.on=function(e,i){t.EventCenter.singleton.on(this.getCommandName(),e,i,[this])},e.prototype.off=function(){t.EventCenter.singleton.offAll(this.getCommandName())},e.prototype.unregister=function(){t.Facade.unregisterCommand(this)},e.prototype.getPluginName=function(){throw new Error("请重写Command.getPluginName()，并返回该Command所属的插件名！")},e.prototype.getCommandName=function(){throw new Error("请重写Command.getCommandName()，并返回该Command的名字！")},e.SUCCESS=0,e.ERR_COMMAND_ECODE_UNDEFINED=1e3,e.ERR_LOAD_ERROR=1001,e}();t.Command=e}(hf||(hf={}));var hf;!function(t){var e=laya.events.Event,i=function(){function i(){}return i.show=function(e,i,s){void 0===i&&(i=null),void 0===s&&(s=-1),i||(i=t.Layer.BOX),e.skin.alpha=0,e.skin.visible=!0,-1==s?t.LayerMgr.addChild(e,i):t.LayerMgr.addChildAt(e,s,i),t.LayerMgr.setCenter(e),e.background?(e.background.alpha=1,e.skin.alpha=1,this.showed(e)):(e.skin.alpha=1,this.showed(e));for(var n=0;n<this.showFuncs.length;n++)this.showFuncs[n](e);return e.modal&&this.addBox(e,i),e},i.addBox=function(s,n){var a=1e3*t.LayerMgr.getLayerIndex(n);s.weight=a+ ++i.boxWeightIndex,this.boxs.push(s),s.on(e.REMOVED,this,i.onBoxRemove,[s]),this.updateBox()},i.onBoxRemove=function(t){t&&(t.off(e.REMOVED,this,i.onBoxRemove),this.removeBox(t))},i.removeBox=function(t){this.boxs.splice(this.boxs.indexOf(t),1),this.updateBox()},i.updateBox=function(){if(this.boxs.length<1)return void(i.bg&&(i.bg.parent&&i.bg.parent.removeChild(i.bg),i.bg.off(Laya.Event.CLICK,i,i.bgModelClickHandler),i.bg=null));this.boxs=this.boxs.sort(function(t,e){return t.weight-e.weight});var t=this.boxs[0];t.visible=!0,this.setModal(t,!0);var e=t.hideOtherBox;if(this.boxs.length>1)for(var s=1;s<this.boxs.length;s++)t=this.boxs[s],e?t.visible=!1:(t.visible=!0,e=t.hideOtherBox)},i.showed=function(t){t.skin.mouseEnabled=!0,t.onShowed()},i.hide=function(t){if(t.isShowed){t.isShowed=!1,t.skin.visible=!1,this.hided(t);for(var e=0;e<this.closeFuncs.length;e++)this.closeFuncs[e](t)}},i.hideAll=function(){for(var t=this.boxs.concat(),e=0;e<t.length;e++)this.hide(t[e])},i.hided=function(e){t.LayerMgr.removeChild(e),e.onHided()},i.setModal=function(e,s){var n=i.boxs[i.boxs.length-1];if(null==i.bg&&(i.bg=new Sprite,i.bg.on(Laya.Event.CLICK,i,i.bgModelClickHandler),i.bg.graphics.drawRect(0,0,t.LayerMgr.width,t.LayerMgr.clientHeight,"#000000"),i.bg.y=-t.LayerMgr.offY,i.bg.mouseEnabled=!0,i.bg.size(t.LayerMgr.width,t.LayerMgr.clientHeight)),i.bg.alpha=n.modelAlpha,i.bg.parent==n.parent){var a=n.parent.getChildIndex(n);a==n.parent.numChildren-1?n.parent.setChildIndex(i.bg,a-1):n.parent.setChildIndex(i.bg,a)}else n.parent.addChildAt(i.bg,n.parent.getChildIndex(n))},i.numBoxSHowed=function(){return i.boxs.length},i.hasBoxShow=function(t){for(var e=!1,s=i.boxs.length,n=0;s>n;n++)if(i.boxs[n].boxName==t){e=!0;break}return e},i.bgModelClickHandler=function(e){var s=e.stageX;if(0==t.LayerMgr.getLayer(t.Layer.GUIDE).numChildren&&i.boxs.length>0&&(200>=s||s>=1220||s>=t.LayerMgr.width-200&&(e.stageY>520+t.LayerMgr.offY||e.stageY<t.LayerMgr.offY))){var n=i.boxs[i.boxs.length-1];n&&n.canClickModelToClose&&t.ServerClock.getServerTime()>n.showTime+500&&n.hide()}},i.hasBox=function(t){for(var e=!1,s=i.boxs.length,n=0;s>n;n++)if(i.boxs[n].boxName==t){e=!0;break}return e},i.showFuncs=[],i.closeFuncs=[],i.boxs=[],i.boxWeightIndex=0,i}();t.BoxMgr=i}(hf||(hf={}));var hf;!function(t){function e(){var e=t.ResourcePath.singleton;return e}var i=function(){function e(){}return Object.defineProperty(e,"singleton",{get:function(){return null==t.ResourcePath._singleton&&(t.ResourcePath._singleton=new t.ResourcePath),t.ResourcePath._singleton},enumerable:!0,configurable:!0}),e.prototype.getFightWeapon=function(i,s){void 0===s&&(s=100);var n="";100>s&&(n="fight/"),s=this.lvFomart(s);var a=t.Global.ResPath+e.PATH_WEAPON+s+n+i+".png";return a},e.prototype.getLilianGkCfg=function(i){return t.Global.ResPath+e.PATH_LILIAN+i+".json"},e.prototype.getEffect=function(e){return t.Global.ResPath+"effect/"+e+".sk"},e.prototype.getFightScene=function(e,i){void 0===i&&(i="jpg");var s=t.Global.ResPath+"scene/"+e+"."+i;return s},e.prototype.getShareBg=function(e,i){if(void 0===i&&(i=".jpg"),t.Global.isWXAPP)var s=t.Global.ResPath+"share/wxapp/"+e+i;else var s=t.Global.ResPath+"share/"+e+i;return s},e.prototype.getTowerImage=function(e,i){return void 0===i&&(i="jpg"),t.Global.ResPath+"tower/"+e+"."+i},e.prototype.getSound=function(e){var i=t.Global.ResPath+"sound/"+e+".mp3";return i},e.prototype.getFightConfig=function(e){var i=t.Global.ResPath+"config/fight/"+e+".json";return i},e.prototype.getPic=function(i,s,n){void 0===n&&(n=100),s==e.PATH_GOODS&&(i>=200001&&3e5>=i?(s=e.PATH_WEAPON,n=0):i>=300001&&4e5>=i&&(s=e.PATH_SKILL,n=0));var a="";100>n&&(a="pic/"),n=this.lvFomart(n);var s=t.Global.ResPath+s+n+a+i+".png";return s},e.prototype.getHangupPic=function(i,s){return t.Global.ResPath+e.PATH_HANGUP+"equip/"+(1e5*i+100*s+1)+".png"},e.prototype.getHangupScene=function(i,s){return t.Global.ResPath+e.PATH_HANGUP+"scene/"+i+"_"+s+".jpg"},e.prototype.getLilianMap=function(i){return t.Global.ResPath+e.PATH_LILIAN_SCENE+i+".jpg"},e.prototype.getLilianShotcut=function(i){return t.Global.ResPath+e.PATH_LILIAN_SHORTCUT+i+".jpg"},e.prototype.getChannel=function(i,s){var n=t.Global.ResPath+e.PATh_CHANNEL+"channel"+i+"/"+s+".png";return n},e.prototype.getChampionRank=function(i){var s=t.Global.ResPath+e.PATH_CHAMPION_RANK+i+".png";return s},e.prototype.getChampionRankMin=function(i){var s=t.Global.ResPath+e.PATH_CHAMPION_RANK+"min2/"+i+".png";return s},e.prototype.getAnim=function(e,i,s){void 0===s&&(s=100);var n="";100>s&&(n="animation/"),s=this.lvFomart(s);var i=t.Global.ResPath+i+s+n+e+".sk";return i},e.prototype.getAnimPath=function(e,i,s){void 0===s&&(s=100);var n="";100>s&&(n="animation/"),s=this.lvFomart(s);var i=t.Global.ResPath+i+s+n+e;return i},e.prototype.lvFomart=function(t){var e=[0,0,0,0,0,0,6,6,6,6,10],i="";return 11>t?(t=parseInt(t),i="lv"+e[t]+"/"):100>t&&(i="lv0/"),i},e.PATH_WEAPON="weapon/",e.PATH_SKILL="skill/",e.PATH_GOODS="goods/",e.PATH_NPC="npc/animation/",e.PATH_NPC_HEAD="npc/head/",e.PATH_NPC_AVATAR="npc/avatar/",e.PATH_NPC_PIC="npc/pic/",e.PATh_CHANNEL="channel/",e.PATH_LILIAN="config/lilian/",e.PATH_TASK="task/",e.PATH_BUFF="buff/",e.PATH_STATUS="status/",e.PATH_HEAD="head/",e.PATH_MINE_BUFF="minebuff/",e.PATH_CHAIN="chain/",e.PATH_TIP="tips/",e.PATH_MONSTER="monster/",e.PATH_MASTER="master/",e.PATH_LILIAN_SCENE="lilian/map/",e.PATH_LILIAN_SHORTCUT="lilian/shortcut/",e.PATH_HANDBOOK_SCENEWORD="handbook/sceneWord/",e.PATH_HANDBOOK_SCENENPC="handbook/sceneNpc/",e.PATH_HANDBOOK_LILIANSTORY="handbook/lilianStory/",e.PATH_HANDBOOK_NPC_HEAD="handbook/npc/head/",e.PATH_HANDBOOK_NPC_CARD="handbook/npc/card/",e.PATH_HANDBOOK_WUQIWORD="handbook/wuqiWord/",e.PATH_CHAMPION_RANK="champion/rank/",e.PATH_HANGUP="hangup/",e}();t.ResourcePath=i,t.ResPath=e}(hf||(hf={}));var hf;!function(t){function e(){var e=t.Conf.singleton;return e}var i=function(){function e(){}return Object.defineProperty(e,"singleton",{get:function(){return null==t.Conf._singleton&&(t.Conf._singleton=new t.Conf),t.Conf._singleton},enumerable:!0,configurable:!0}),e.prototype.GetSourceByKey=function(e){return null!=this.assetConf[e]?(t.Logger.log(e),this.assetConf[e]):null},e.prototype.GetSkill=function(t){return this.skillConf[t]},e.prototype.GetEffect=function(t){return this.effectConf[t]},e.prototype.GetWeapon=function(t){if(this.weaponConf[t]){var e=this.weaponConf[t],i=this.GetSourceByKey(e.SourceId);return i&&(e.Source=i[0],e.Sound=i[1],e.SourceType=i[2]),e}return null},e.prototype.GetNPC=function(t){if(this.npcConf[t]){var e=this.npcConf[t];return e}return null},e.prototype.init=function(){t.Global.isWXAPP?this.initPath():Laya.loader.load("path.json",Handler.create(this,this.initPath))},e.prototype.initConf=function(){this.config=Laya.loader.getRes("config/ActionConf.json");var e=[];e.push({url:this.config.Asset,type:Loader.JSON}),e.push({url:t.ResPath().getFightConfig("effect"),type:Loader.JSON}),e.push({url:t.ResPath().getFightConfig("npc"),type:Loader.JSON}),e.push({url:t.ResPath().getFightConfig("SkillConf"),type:Loader.JSON}),e.push({url:t.ResPath().getFightConfig("WeaponConf"),type:Loader.JSON}),Laya.loader.load(e,Handler.create(this,this.onAssetsLoaded))},e.prototype.initPath=function(){var e=Laya.loader.getRes("path.json");t.Global.isWXAPP||"0"!=e.result||(t.Global.WebHost=e.WebHost,t.Global.WebPath=e.WebPath,t.Global.ResPath=e.ResPath,e.PF&&!t.Global.isWXAPP&&(t.Global.PF=e.PF),t.Global.isTest||(t.Global.ResPath="/ledoures/"),t.Global.CLIENT_PATH=e.ClientPath,t.Global.CLIENT_PATH=t.Global.CLIENT_PATH.replace("http:",t.Global.protocol),t.Global.WebHost=t.Global.WebHost.replace("http:",t.Global.protocol),t.Global.ResPath=t.Global.ResPath.replace("http:",t.Global.protocol),t.Global.ResHost=t.Global.ResHost.replace("http:",t.Global.protocol),t.Global.BASE_FILE=e.DefaultFile,e.UID&&(t.Global.UID=e.UID),t.JSUtils.getQueryString("pf")&&(t.Global.PF=t.JSUtils.getQueryString("pf"),"wanba_ts"==t.Global.PF&&(t.Global.PF="wb"))),t.Global.isTest||(window.WXAPP?t.Global.WebHost=t.Global.protocol+"//zone4.ledou.qq.com":t.Global.isWX?t.Global.WebHost=t.Global.protocol+"//zone2.ledou.qq.com":t.Global.isWB?t.Global.WebHost=t.Global.protocol+"//zone3.ledou.qq.com":t.Global.WebHost=t.Global.protocol+"//zone1.ledou.qq.com"),window.WXAPP&&window.pathJson&&(t.Global.WebHost=window.pathJson.WebHost,t.Global.WebPath=window.pathJson.WebPath,t.Global.ResPath=window.pathJson.ResPath,t.Global.UID=window.pathJson.UID,t.Global.H5OPENID=window.pathJson.H5OPENID,t.Global.H5TOKEN=window.pathJson.H5TOKEN,t.Global.PF=window.pathJson.PF),Laya.loader.load("config/ActionConf.json",Handler.create(this,this.initConf)),t.Logger.log("WebHost:"+t.Global.WebHost),t.Logger.log("WebPath:"+t.Global.WebPath),t.Logger.log("ResPath:"+t.Global.ResPath),t.Logger.log("ResHost:"+t.Global.ResHost),t.Logger.log("BASE_URI:"+t.Global.BASE_URI),t.Logger.log("CLIENT_PATH:"+t.Global.CLIENT_PATH),t.Logger.log("BASE_FILE:"+t.Global.BASE_FILE),t.Logger.log("FROM:"+t.Global.FROM),t.Logger.log("TOKEN:"+t.Global.TOKEN),t.Logger.log("OPENID:"+t.Global.OPENID),t.Logger.log("UIN:"+t.Global.UIN),t.Logger.log("SKEY:"+t.Global.SKEY),t.Logger.log("PF:"+t.Global.PF),t.Logger.log("appID:"+t.Global.appID)},e.prototype.onAssetsLoaded=function(){this.assetConf=Laya.loader.getRes(this.config.Asset),this.skillConf=Laya.loader.getRes(t.ResPath().getFightConfig("SkillConf")),this.effectConf=Laya.loader.getRes(t.ResPath().getFightConfig("effect")),this.weaponConf=Laya.loader.getRes(t.ResPath().getFightConfig("WeaponConf")),this.npcConf=Laya.loader.getRes(t.ResPath().getFightConfig("npc"))},e.prototype.loadAssetConf=function(){t.XHR().GetJson(this.config.Asset,this,function(t){this.assetConf=t})},e.prototype.loadSkillConf=function(){t.XHR().GetJson(this.config.Skill.Config,this,function(t){this.skillConf=t}),t.XHR().GetJson(this.config.Effect.Config,this,function(t){this.effectConf=t})},e.prototype.loadWeaponConf=function(){t.XHR().GetJson(this.config.Weapon.Config,this,function(t){this.weaponConf=t})},e.prototype.loadNPCConf=function(){t.XHR().GetJson(this.config.NPC.Config,this,function(t){this.npcConf=t})},e.prototype.csvToJson=function(e){e=e.replace(/\r/g,"");for(var i=e.split("\n"),s=i[0],n=s.split(","),a=new Array,o=new Object,r=1;r<i.length;r++)if(""!=i[r]){for(var h=this.csvFomart(i[r]),l=new Object,c=0;c<h.length;c++)l[n[c]]=h[c];o[l[n[0]]]=l,a.push(l)}return t.Logger.log(JSON.stringify(o)),a},e.prototype.csvFomart=function(t){for(var e=t.split('"'),i=t.split(","),s=0;s<e.length;s++)s%2==1&&e[s].replace(/,/g,"$-&-#-$");for(var n=0;n<e.length;n++)i[n].replace(/$-&-#-$/g,",");return i},e._singleton=null,e}();t.Conf=i,t.Config=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){}return e.show=function(i,s,n){void 0===s&&(s=!1),void 0===n&&(n="#ffec49"),i&&(t.Facade.singleton.retrievePlugin(t.PluginDef.PLUGIN_COMMON)&&0==s?t.Facade.callCommand(new t.ShowChangeRewardCmd([i],200,n)):(e.tips||(e.tips=new ui.common.WeakTipUIUI,e.tips.y=(t.LayerMgr.height-e.tips.height)/2),t.LayerMgr.addChild(e.tips,t.Layer.WEAK_TIP),e.tips.msgTxt.text=i,e.tips.bg.width=e.tips.msgTxt.textField.textWidth+30,e.tips.x=(t.LayerMgr.width-e.tips.bg.width)/2,e.nowTween&&(Laya.Tween.clear(e.nowTween),e.nowTween=null),e.tips.alpha=1,e.tips.visible=!0,e.nowTween=Laya.Tween.to(e.tips,{alpha:0},1e3,null,Handler.create(this,this.tweenComplete),2e3)))},e.tweenComplete=function(){e.tips.alpha=1,e.tips.visible=!1,e.nowTween=null},e}();t.WeakTips=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){}return e.show=function(i,s){e.tips||(e.tips=new ui.common.TipsUIUI,t.LayerMgr.addChild(e.tips,t.Layer.WEAK_TIP)),e.tips.tipsType.text="",e.tips.tipsDesc.text="",e.tips.tipsInfo.text="",i.name&&(e.tips.tipsName.text=i.name),i.typeDesc&&(e.tips.tipsType.text=i.typeDesc),i.desc&&(e.tips.tipsDesc.text=i.desc),i.info&&(e.tips.tipsInfo.text=i.info),e.tips.visible=!0;var n=this.tips.tipsName.textHeight;this.tips.tipsType.y=this.tips.tipsName.y+Math.ceil(1.6*n),this.tips.tipsInfo.y=this.tips.tipsType.y+Math.ceil(1.6*this.tips.tipsType.textHeight),n=this.tips.tipsInfo.textHeight>10?this.tips.tipsInfo.textHeight+10:0,this.tips.tipsDesc.y=this.tips.tipsInfo.y+n,n=this.tips.tipsDesc.y+this.tips.tipsDesc.textHeight+15,this.tips.tipsBox.height=n,this.tips.tipsBox.x=s.x+40-t.LayerMgr.offX,this.tips.tipsBox.y=s.y+40-t.LayerMgr.offY,this.tips.tipsBox.y+n>Laya.stage.height-50&&(this.tips.tipsBox.y-=this.tips.tipsBox.y+n-(Laya.stage.height-50)),this.tips.tipsBox.x+this.tips.tipsBox.width>Laya.stage.width-50&&(this.tips.tipsBox.x-=this.tips.tipsBox.x+this.tips.tipsBox.width-(Laya.stage.width-50)),e.nowTween&&(Laya.Tween.clear(e.nowTween),e.nowTween=null),e.tips.alpha=1,e.tips.visible=!0,e.nowTween=Laya.Tween.to(e.tips,{alpha:0},1e3,null,Handler.create(this,this.tweenComplete),5500)},e.tipsClose=function(){e.tips&&(e.tips.visible=!1)},e.tweenComplete=function(){e.tips.alpha=1,e.tips.visible=!1,e.nowTween=null},e}();t.Tips=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(t){this.plguin=t}return e.constructObj=function(t,e,i,s){void 0===s&&(s=1);var n=1==s?"award":"changed";if(t.hasOwnProperty(n)){var a=t[n];a.hasOwnProperty("attrs")?a.attrs.push({id:e,num:i}):a.attrs=[{id:e,num:i}]}else t[n]={},t[n].attrs=[{id:e,num:i}]},e.getObjNum=function(t,e,i){var s=0;if(t.hasOwnProperty("changed"))for(var n=1==i?t.changed.attrs||[]:t.changed.items||[],a=0;a<n.length;a++){var o=n[a];if(o.id==e){s=o.num;break}}return s},e.prototype.sync=function(e){if(e.jsonObj&&(!e.jsonObj.hasOwnProperty("hasSync")||0==e.jsonObj.hasSync)){e.jsonObj.hasSync=!0,this.syncNewHand(e);var i=e.changed;if(!i&&!e.jsonObj.hasOwnProperty("award"))return;var s=[],n=[];if(e.rewardStrArr=s,e.rewardBoxArr=n,e.jsonObj.hasOwnProperty("award")){var a=e.jsonObj.award;a?(this.doSync(i,s,n,!0,!1),this.doSync(a,s,n,!1,!0)):this.doSync(i,s,n,!0,!0)}else this.doSync(i,s,n,!0,!0);e.showReward?t.Facade.callCommand(new t.ShowChangeRewardCmd(s)):e.showRewardBox&&t.Facade.callCommand(new t.ShowRewardBoxCmd(e.rewardBoxMsg,n,e.handler))}},e.prototype.doSync=function(t,e,i,s,n){if(t){if(t.hasOwnProperty("items")){var a=t.items;a&&this.syncPackModel(a,e,i,s,n)}if(t.hasOwnProperty("attrs")){var o=t.attrs;o&&this.syncUserModel(o,e,i,s,n)}if(t.hasOwnProperty("attrs")){var r=t.attrs;r&&s&&this.syncBuffModel(r,e,s,n)}}},e.prototype.syncUserModel=function(e,i,s,n,a){for(var o=this.plguin.retrieveModel(t.ModelDef.SELF_USER_MODEL),r=e.length,h=!1,l=0;r>l;l++){var c=e[l],d=c.id,u=Number(c.num);switch(d){case"kCash":n&&(o.cash+=u);break;case"kDouBi":n&&(o.doubi+=u),u>0&&a&&(i.push("斗豆+"+u),s.push({id:d,name:"斗豆",num:u,itemObj:c}));break;case"kDouYu":n&&(o.douyu+=u),u>0&&a&&(i.push("斗鱼+"+u),s.push({id:d,name:"斗鱼",num:u,itemObj:c}));break;case"kExp":n&&(o.exp+=u),u>0&&a&&(i.push("经验+"+u),s.push({id:d,name:"经验",num:u,itemObj:c}));break;case"kVit":n&&(o.vit+=u),u>0&&a&&(i.push("体力+"+u),s.push({id:d,name:"体力",num:u,itemObj:c}));break;case"kEnergy":n&&(o.energy+=u),u>0&&a&&(i.push("江湖令+"+u),s.push({id:d,name:"江湖令",num:u,itemObj:c}));break;case"kHighEnergy":n&&(o.highEnergy+=u),u>0&&a&&(i.push("英雄江湖令+"+u),s.push({id:d,name:"英雄江湖令",num:u,itemObj:c}));break;case"kPrestige":n&&(o.prestige+=u),u>0&&a&&(i.push("威望+"+u),s.push({id:d,name:"威望",num:u,itemObj:c}));break;case"kSpirit":n&&(o.xiuWei+=u),u>0&&a&&(i.push("修为+"+u),s.push({id:d,name:"修为",num:u,itemObj:c}));break;case"kFightPower":if(n&&0!=u){var p=o.realAttackPower,_=o.realAttackPower+u;o.realAttackPower=_,t.Facade.callCommand(new t.ShowStrengthChangeCmd(p,u,_))}break;case"kServantCash":n&&(o.servantCash+=u),u>0&&a&&(i.push("家财+"+u),s.push({id:d,name:"家财",num:u,itemObj:c}));break;case"kWinPoint":n&&(o.winPoint+=u),u>0&&a&&(i.push("胜点+"+u),s.push({id:d,name:"胜点",num:u,itemObj:c}));break;case"kTowerPoint":a&&(i.push("妖塔状态点+"+u),s.push({id:d,name:"妖塔状态点",num:u,itemObj:c}));break;case"kContrib":if(n){var f=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF).selfFactionUserModel;f.banggong_now+=u,u>0&&(f.banggong_total+=u),h=!0}u>0&&a&&(i.push("帮贡+"+u),s.push({id:d,name:"帮贡",num:u,itemObj:c}));break;case"kCavePoint":if(n){var f=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF).selfFactionUserModel;f.holePoint+=u,h=!0}u>0&&a&&(i.push("洞穴积分+"+u),s.push({id:d,name:"洞穴积分",num:u,itemObj:c}));break;case"kClubExp":u>0&&a&&(i.push("武馆熟练度+"+u),s.push({id:d,name:"武馆熟练度",num:u,itemObj:c}));break;case"fightHoleHp":u>0&&a&&(i.push("造成伤害+"+u),s.push({id:d,name:"造成伤害",num:u,itemObj:c}));break;case"kWood":u>0&&a&&(i.push("帮派木材+"+u),s.push({id:d,name:"帮派木材",num:u,itemObj:c}));break;case"kStone":u>0&&a&&(i.push("帮派石头+"+u),s.push({id:d,name:"帮派石头",num:u,itemObj:c}));break;case"kIronOre":u>0&&a&&(i.push("帮派铁矿+"+u),s.push({id:d,name:"帮派铁矿",num:u,itemObj:c}));break;case"kKingMedal":n&&(o.kingMetal+=u),u>0&&a&&(i.push("王者勋章+"+u),s.push({id:d,name:"王者勋章",num:u,itemObj:c}));break;case"kKingTimes":u>0&&a&&(i.push("王者争霸+"+u),s.push({id:d,name:"王者争霸",num:u,itemObj:c}));break;case"kChampionStar":a&&(i.push("王者星火+"+u),s.push({id:d,name:"王者星火",num:u,itemObj:c}));break;case"kMHangupPoint":a&&(i.push("仙缘+"+u),s.push({id:d,name:"仙缘",num:u,itemObj:c}))}}n&&(o.exp>=o.maxExp?(this._newExp=o.exp-o.maxExp,t.XHR().Post({file:"petpk",cmd:"detail",op:"levelup",uid:t.Global.UID},this,this.getLvUpHandler)):o.updateFinish(),h&&t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF).updateFinish())},e.prototype.syncPackModel=function(e,i,s,n,a){for(var o=this.plguin.retrieveModel(t.ModelDef.PACK_MODEL),r=e.length,h=0;r>h;h++){var l=e[h],c=l.id;if(c>=200001&&4e5>=c){var d=0==Number(l.isage)?-1:Number(l.hours);if(0!=d&&a){var u=l.name?l.name:"未知物品";i.push("获得:"+u+"×"+t.DateUtils.getStrByHours(d));var p=l.hasOwnProperty("icon_id")?l.icon_id:l.id;s.push({id:p,name:u,hours:d,itemObj:l})}}else{var _=l.num;if(_>0){if(n){var f=o.addPackItemByCount(c,_,l);f&&(f.changeNum+=_)}if(a){var u=l.name?l.name:"未知物品";i.push("获得道具:"+u+"×"+_);var p=l.hasOwnProperty("icon_id")?l.icon_id:l.id;s.push({id:p,name:u,num:_,itemObj:l})}}else if(n){var y=o.removePackItemByCount(c,-_);y&&(y.changeNum-=-_)}}}n&&o.updateFinish()},e.prototype.syncBuffModel=function(e,i,s,n){for(var a,o,r,h=t.BuffView.idMap,l=this.plguin.retrieveModel(t.ModelDef.BUFF_MODEL),c=e.length,d=!1,u=0;c>u;u++)if(a=e[u].id,o=e[u].num,r=l.buffDiction["buff"+h[a]],r&&(s&&(1==r.type?r.lv+=3600*o:r.lv+=o,r.lv>0?r.has=1:(r.lv=0,r.has=0),d=!0),o>0&&n))switch(a){case"kStatusPower":i.push("大力状态+"+o);break;case"kStatusPhy":i.push("强健状态+"+o);break;case"kStatusSpeed":i.push("迅捷状态+"+o);break;case"kStatusExp":i.push("经验增强状态+"+o+"小时");break;case"kStatusHP":i.push("活血状态+"+o)}d&&l.updateFinish()},e.prototype.getLvUpHandler=function(e){if(0==e.result)if(e.levelup&&e.levelup.length>0){var i=new t.ShowLvUpBoxCmd(e.levelup);if(i.on(this,this.showLvUpBoxCmdFInish),t.Facade.callCommand(i),this._newLv=e.levelup[e.levelup.length-1].level,t.Global.isWXAPP)var s=[3,4,5,6,7,8,9,10,12,13,15,20,25,30];else var s=[3,4,5,6,7,8,9,10,11,12,13,14,15,20,25,30];if(-1!=s.indexOf(this._newLv)){var n=new t.ShowNewPowerBox(this._newLv);n.show(t.Layer.LV_UP,0),n.alpha=0}}else t.WeakTips.show("后台返回'levelup'为空");t.XHR().Post({file:"petpk",cmd:"index",lvlup:1,uid:t.Global.UID},this,this.getUserDataHandler)},e.prototype.showLvUpBoxCmdFInish=function(e){if(e.off(),0!=e.ecode)for(var i=t.BoxMgr.boxs.length,s=0;i>s;s++)"ShowNewPowerBox"==t.BoxMgr.boxs[s].name&&(t.BoxMgr.boxs[s].alpha=1)},e.prototype.getUserDataHandler=function(e){if(0==e.result){var i=this.plguin.retrieveModel(t.ModelDef.SELF_USER_MODEL);if(i.setData(e),i.updateFinish(),e.goods_info){var s=this.plguin.retrieveModel(t.ModelDef.PACK_MODEL);s.items=e.goods_info,s.updateFinish()}}else{var i=this.plguin.retrieveModel(t.ModelDef.SELF_USER_MODEL);i.level=this._newLv,i.exp=this._newExp,i.vit+=10*(Math.floor((this._newLv-1)/10)+1),i.updateFinish()}},e.prototype.decodeData=function(t){var e=[],i=[];t.rewardStrArr=e,t.rewardBoxArr=i,this.doSync(t.obj,e,i,!1,!0)},e.prototype.syncNewHand=function(e){if(e.jsonObj.hasOwnProperty("newhandtaskinfo")){var i=e.jsonObj.newhandtaskinfo;if(i){var s=this.plguin.retrieveModel(t.ModelDef.GUIDE_MODEL),n=0==i[0];s.isGuiding&&!n&&t.Facade.callCommand(new t.StopGuideCommand);var a=i[1];245==a&&2==t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).level&&(a=242,s.guidetaskID=242);var o=1==i[2],r=i[3],h=!1,l=!1;n==s.isGuiding&&a==s.guidetaskID&&o==s.hasGift&&r==s.nowStep||(h=!0),r!=s.nowStep&&(l=!0),s.isGuiding=n,s.guidetaskID=a,s.hasGift=o,s.nowStep=r,o&&n?t.Facade.callCommand(new t.OpenTaskCmd(1)):(l&&t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.STEP_CHANGE)),h&&s.updateFinish())}}},e}();t.SyncExecuter=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this._isTween=!1,this._arr=[],this._rewardUIArr=[],this._tweenUIArr=[]}return e.prototype.showChangeReward=function(t,e,i){if(void 0===e&&(e=200),void 0===i&&(i="#00FF00"),null!=t){for(var s=t.length,n=0;s>n;n++)this._arr.push({strMsg:t[n],color:i});this._isLoop||(this._isLoop=!0,300>e&&(e=300),Laya.timer.loop(e,this,this.show),this.show())}},e.prototype.show=function(){if(0==this._arr.length)return this._isLoop=!1,void Laya.timer.clear(this,this.show);var e=this._arr.shift(),i=this._rewardUIArr.length>0?this._rewardUIArr.shift():new ui.comp.ShowRewardUIUI;i.alpha=1;var i=new ui.comp.ShowRewardUIUI;i.txt.text=e.strMsg,i.txt.color=e.color,i.rewardBg.width=i.txt.textWidth+100<452?452:i.txt.textWidth+100,i.txt.x+=(i.rewardBg.width-i.txt.textWidth)/2,i.x=(t.LayerMgr.width-i.rewardBg.width)/2,i.y=t.LayerMgr.height/2,t.LayerMgr.addChild(i,t.Layer.WEAK_TIP),this._tweenUIArr.push(i),i.upCount=0,this._isTween||(this._isTween=!0,Laya.timer.loop(30,this,this.startTween),this.startTween())},e.prototype.startTween=function(){for(var t=this._tweenUIArr.length,e=t-1;e>=0;e--){var i=this._tweenUIArr[e],s=Number(i.upCount);if(30>s)i.y-=5,s++,i.upCount=s;else{var n=i.alpha;n-=.03,0>=n?(i.alpha=0,this._tweenUIArr.splice(e,1),i.parent&&i.parent.removeChild(i),this._rewardUIArr.push(i)):i.alpha=n}}0==this._tweenUIArr.length&&(this._isTween=!1,Laya.timer.clear(this,this.startTween))},e}();t.ShowChangeRewardExecuter=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(){}return t.guideData={task241:[{storyBefore:"1029",x:360,y:112,width:612,height:526,showCondition:1,showConditionParam:"CollectViewBox",hideCondition:18},{x:963,y:12,isCircle:1,width:72,height:70,showCondition:18,hideCondition:2,hideConditionParam:"CollectViewBox"},{storyBefore:"1001",isCircle:1,buttonName:"friendBtn",showCondition:3,showConditionParam:"main_scene",showCondition1:2,showConditionParam1:"CollectViewBox",showCondition2:2,showConditionParam2:"WeixinCollectViewBox",hideCondition:1,hideConditionParam:"FriendViewBox"},{storyBefore:"1002",x:964,y:160,width:100,height:100,isCircle:1,showCondition:1,showConditionParam:"FriendViewBox",hideCondition:6},{storyWaitFight:"1003",storyAfter:"1004",x:930,y:115,width:155,height:67,showCondition:1,showConditionParam:"TaskViewBox",hideCondition:7}],task242:[{storyBefore:"1005",x:1136,y:93,width:61,height:116,showCondition:7,needBox:"FriendViewBox",hideCondition:12},{storyBefore:"1026",x:485,y:68,width:140,height:64,showCondition:12,needBox:"FriendViewBox",hideCondition:2,hideConditionParam:"FriendViewBox"},{isCircle:1,buttonName:"friendBtn",showCondition:3,showConditionParam:"main_scene",showCondition1:2,showConditionParam1:"FriendViewBox",showCondition2:7,hideCondition:1,hideConditionParam:"FriendViewBox"},{storyBefore:"1002",x:964,y:285,width:100,height:100,isCircle:1,showCondition:1,showConditionParam:"FriendViewBox",hideCondition:38}],task243:[{storyBefore:"1005",x:1136,y:93,width:61,height:116,showCondition:7,needBox:"FriendViewBox",hideCondition:12},{storyBefore:"1026",x:485,y:68,width:140,height:64,showCondition:12,needBox:"FriendViewBox",hideCondition:2,hideConditionParam:"FriendViewBox"},{isCircle:1,buttonName:"friendBtn",showCondition:3,showConditionParam:"main_scene",showCondition1:2,showConditionParam1:"FriendViewBox",showCondition2:7,hideCondition:1,hideConditionParam:"FriendViewBox"},{storyBefore:"1002",x:964,y:410,width:100,height:100,isCircle:1,showCondition:1,showConditionParam:"FriendViewBox",hideCondition:38},{storyWaitFight:"1003",storyAfter:"1004",x:930,y:115,width:155,height:67,showCondition:1,showConditionParam:"TaskViewBox",hideCondition:7}],task245:[{needLv:3,isCircle:1,buttonName:"upLevelBtn",showCondition:3,showConditionParam:"main_scene",hideCondition:31},{needLv:3,isCircle:1,buttonName:"upgradeBtn",showCondition:31,hideCondition:1,hideConditionParam:"UpgradeBox"},{needLv:3,x:1134,y:230,width:62,height:133,showCondition:1,showConditionParam:"UpgradeBox",hideCondition:9,step:"3,4,5"},{needLv:3,storyBefore:"1009",x:241,y:166,width:100,height:100,showCondition:1,showConditionParam:"UpgradeBox",showCondition1:9,hideCondition:1,hideConditionParam:"WsOpBox"},{needLv:3,x:890,y:158,width:139,height:64,showCondition:1,showConditionParam:"WsOpBox"},{needLv:3,x:1048,y:62,width:72,height:70,isCircle:1,waitStep:"3",needBox:"WsOpBox",hideCondition:2,hideConditionParam:"WsOpBox"},{needLv:3,x:1134,y:230,width:62,height:133,showCondition:2,showConditionParam:"WsOpBox",hideCondition:9,step:"3,4,5"},{needLv:3,x:241,y:166,width:100,height:100,showCondition:1,showConditionParam:"UpgradeBox",showCondition1:9,hideCondition:1,hideConditionParam:"WsOpBox",step:"3,4,5"},{needLv:3,x:890,y:158,width:139,height:64,showCondition:1,showConditionParam:"WsOpBox"},{needLv:3,x:930,y:115,width:155,height:67,showCondition:1,showConditionParam:"TaskViewBox",hideCondition:7}],task246:[{needLv:3,storyBefore:"1010",isCircle:1,buttonName:"xkxBtn",showCondition:2,showConditionParam:"UpgradeBox",showCondition1:3,showConditionParam1:"main_scene",showCondition2:7,hideCondition:25},{needLv:3,buttonName:"copyBtn",isCircle:1,showCondition:25,hideCondition:3,hideConditionParam:"lilian_scene"},{needLv:3,storyBefore:"1011",x:255,y:187,width:80,height:80,isCircle:1,showCondition:3,showConditionParam:"lilian_scene",hideCondition:1,hideConditionParam:"LilianLevelView"},{needLv:3,x:853,y:431,width:207,height:70,showCondition:1,showConditionParam:"LilianLevelView",hideCondition:2,hideConditionParam:"LilianLevelView"},{needLv:3,x:930,y:115,width:155,height:67,showCondition:1,showConditionParam:"TaskViewBox",hideCondition:7}],task247:[{needLv:4,isCircle:1,buttonName:"btnBack",needScene:"lilian_scene",showCondition:7,hideCondition:3,hideConditionParam:"main_scene"},{needLv:4,storyBefore:"1012",isCircle:1,buttonName:"userBtn",showCondition:3,showConditionParam:"main_scene",showCondition1:7,hideCondition:32},{needLv:4,isCircle:1,buttonName:"channelBtn",showCondition:32,hideCondition:1,hideConditionParam:"ChannelsBox"},{needLv:4,storyBefore:"1013",x:955,y:501,width:135,height:58,showCondition:1,showConditionParam:"ChannelsBox"},{needLv:4,x:930,y:115,width:155,height:67,showCondition:1,showConditionParam:"TaskViewBox",hideCondition:7}],task249:[{needLv:4,isCircle:1,storyBefore:"1012",buttonName:"userBtn",showCondition:3,showConditionParam:"main_scene",showCondition1:7,notNeedBox:"ChannelsBox",hideCondition:32},{needLv:4,isCircle:1,buttonName:"channelBtn",showCondition:32,hideCondition:1,hideConditionParam:"ChannelsBox"},{needLv:4,storyBefore:"1014",x:262,y:295,width:135,height:58,showCondition:1,showConditionParam:"ChannelsBox",showCondition1:7,step:"0"},{needLv:4,x:575,y:578,width:184,height:68,showCondition:1,showConditionParam:"NewChannlesBox",hideCondition:2,hideConditionParam:"NewChannlesBox"},{needLv:4,storyBefore:"1015",x:262,y:295,width:135,height:58,showCondition:1,showConditionParam:"ChannelsBox",showCondition1:2,showConditionParam1:"NewChannlesBox",step:"1"},{needLv:4,x:930,y:115,width:155,height:67,showCondition:1,showConditionParam:"TaskViewBox",hideCondition:7}],task250:[{needLv:4,isCircle:1,storyBefore:"1012",buttonName:"userBtn",showCondition:3,showConditionParam:"main_scene",showCondition1:7,notNeedBox:"ChannelsBox",hideCondition:32},{needLv:4,isCircle:1,buttonName:"channelBtn",showCondition:32,hideCondition:1,hideConditionParam:"ChannelsBox"},{needLv:4,storyBefore:"1016",x:1135,y:235,width:60,height:132,showCondition:1,showConditionParam:"ChannelsBox",showCondition1:7,hideCondition:10},{needLv:4,x:814,y:594,width:228,height:79,showCondition:10},{needLv:4,storyAfter:"1017",x:930,y:115,width:155,height:67,showCondition:1,showConditionParam:"TaskViewBox",hideCondition:7}],task10000:[{x:1091,y:4,width:72,height:70,isCircle:1,showCondition:7,needBox:"ChannelsBox",hideCondition:2,hideConditionParam:"ChannelsBox"}],task50000:[{isCircle:1,buttonName:"activityBtn",showCondition:16,hideCondition:1,hideConditionParam:"ActCenterBox"}],task50001:[{storyBefore:"1033",x:220,y:658,width:50,height:50,showCondition:1,showConditionParam:"FriendViewBox",hideCondition:20}],task60001:[{needLv:6,storyBefore:"1045",x:5,y:154,width:46,height:46,showCondition:3,showConditionParam:"main_scene",hideCondition:1,hideConditionParam:"BuffViewBox"},{storyAfter:"1046",x:304,y:324,width:162,height:66,showCondition:1,showConditionParam:"BuffViewBox",hideCondition:24}],task70010:[{x:237,y:179,width:282,height:348,needAnd:1,showCondition:1,showConditionParam:"WeixinCollectViewBox",hideCondition:26},{x:526,y:179,width:282,height:348,needAnd:1,showCondition:26,hideCondition:27},{x:815,y:179,width:282,height:348,needAnd:1,showCondition:27,hideCondition:28},{x:1091,y:4,width:72,height:70,needAnd:1,isCircle:1,showCondition:28,hideCondition:2,hideConditionParam:"WeixinCollectViewBox"},{x:237,y:179,width:427,height:348,needIos:1,showCondition:1,showConditionParam:"WeixinCollectViewBox",hideCondition:29},{x:670,y:179,width:427,height:348,needIos:1,showCondition:29,hideCondition:30},{x:1091,y:4,width:72,height:70,needIos:1,isCircle:1,showCondition:30,hideCondition:2,hideConditionParam:"WeixinCollectViewBox"}],task70020:[{storyBefore:"1029",x:360,y:112,width:612,height:526,showCondition:1,showConditionParam:"CollectViewBox",hideCondition:18},{x:963,y:12,isCircle:1,width:72,height:70,showCondition:18,hideCondition:2,hideConditionParam:"CollectViewBox"}],task80001:[{storyBefore:"1020",x:591,y:138,width:494,height:174,
showCondition:1,showConditionParam:"SelfAttrBox",hideCondition:36}],task90000:[{isCircle:1,buttonName:"shejiaoBtn",showCondition:16,hideCondition:37},{isCircle:1,buttonName:"factionBtn",showCondition:37,hideCondition:1,hideConditionParam:"FactionListBox"}],task100000:[{storyBefore:"1024",isCircle:1,buttonName:"qyhBtn",showCondition:16,hideCondition:19},{isCircle:1,buttonName:"matchBtn",showCondition:19,hideCondition:1,hideConditionParam:"WulinBox"},{storyBefore:"1025",x:562,y:540,width:212,height:70,showCondition:1,showConditionParam:"WulinBox",hideCondition:15}],task110000:[{storyBefore:"1061",isCircle:1,buttonName:"shejiaoBtn",showCondition:16,hideCondition:37},{isCircle:1,buttonName:"masterBtn",showCondition:37,hideCondition:1,hideConditionParam:"MasterApply"}],task120000:[{storyBefore:"1030",isCircle:1,buttonName:"qyhBtn",showCondition:16,hideCondition:19},{isCircle:1,buttonName:"serventBtn",showCondition:19,hideCondition:3,hideConditionParam:"servent_scene"},{storyBefore:"1031",x:879,y:354,width:70,height:71,showCondition:3,showConditionParam:"servent_scene",hideCondition:1,hideConditionParam:"CaffBox"},{storyBefore:"1032",x:307,y:469,width:206,height:69,showCondition:1,showConditionParam:"CaffBox",hideCondition:6}],task130000:[{storyBefore:"1027",isCircle:1,buttonName:"upLevelBtn",showCondition:16,hideCondition:31},{isCircle:1,buttonName:"gemBtn",showCondition:31,hideCondition:1,hideConditionParam:"GemBox"},{storyBefore:"1028",x:535,y:559,width:83,height:82,showCondition:1,showConditionParam:"GemBox",hideCondition:17}],task140000:[{storyBefore:"1080",isCircle:1,buttonName:"xkxBtn",showCondition:16,hideCondition:25},{isCircle:1,buttonName:"copyBtn",showCondition:25,hideCondition:3,hideConditionParam:"lilian_scene"},{isCircle:1,buttonName:"heroModeBtn",showCondition:3,showConditionParam:"lilian_scene",hideCondition:42}],task150000:[{storyBefore:"1050",isCircle:1,buttonName:"upLevelBtn",showCondition:16,hideCondition:31},{isCircle:1,buttonName:"chainBtn",showCondition:31,hideCondition:3,hideConditionParam:"chain_scene"},{storyBefore:"1051",x:486,y:654,width:252,height:69,showCondition:3,showConditionParam:"chain_scene",hideCondition:1,hideConditionParam:"ChainSelectWeaponView"},{x:241,y:211,width:420,height:135,showCondition:1,showConditionParam:"ChainSelectWeaponView",hideCondition:34},{x:241,y:211,width:420,height:135,showCondition:34,hideCondition:34},{x:366,y:607,width:252,height:72,showCondition:34,hideCondition:35}],task200000:[{storyBefore:"1036",isCircle:1,buttonName:"xkxBtn",showCondition:16,hideCondition:25},{isCircle:1,buttonName:"towerBtn",showCondition:25,hideCondition:3,hideConditionParam:"tower_scene"}],task200001:[{storyBefore:"1037",x:158,y:620,width:296,height:113,showCondition:3,showConditionParam:"tower_scene",hideCondition:22,hideConditionParam:"monster"},{storyBefore:"1038",x:968,y:423,width:186,height:94,showCondition:22,hideCondition:22,hideConditionParam:"fight"}],task200002:[{storyBefore:"1039",x:964,y:116,width:192,height:289,showCondition:23,hideCondition:1},{storyBefore:"1040",x:282,y:157.5,width:776,height:210,showCondition:1,hideCondition:22,hideConditionParam:"buffItem"},{x:916,y:424.5,width:68,height:68,showCondition:22,hideCondition:22,hideConditionParam:"addBtn"},{x:749,y:536.5,width:200,height:65,showCondition:22,hideCondition:22,hideConditionParam:"saveBtn"}],task200003:[{storyBefore:"1041",x:158,y:620,width:296,height:113,showCondition:23,hideCondition:22,hideConditionParam:"monster"},{x:460,y:620,width:296,height:113,showCondition:22,hideCondition:22,hideConditionParam:"monster"},{storyBefore:"1042",x:158,y:620,width:587,height:113,showCondition:22,hideCondition:22,hideConditionParam:"monster"},{x:968,y:423,width:186,height:94,showCondition:22,hideCondition:22,hideConditionParam:"fight"}],task200004:[{storyBefore:"1043",x:158,y:620,width:296,height:113,showCondition:23,hideCondition:22,hideConditionParam:"monster"},{x:968,y:423,width:186,height:94,showCondition:22,hideCondition:22,hideConditionParam:"fight"}],task200005:[{storyBefore:"1043",x:460,y:620,width:296,height:113,showCondition:23,hideCondition:22,hideConditionParam:"monster"},{x:968,y:423,width:186,height:94,showCondition:22,hideCondition:22,hideConditionParam:"fight"}],task250000:[{storyBefore:"1058",isCircle:1,buttonName:"qyhBtn",showCondition:16,hideCondition:19},{isCircle:1,buttonName:"championBtn",showCondition:19,hideCondition:3,hideConditionParam:"champion_scene"},{storyBefore:"1059",x:1051,y:503,width:170,height:165,showCondition:3,showConditionParam:"champion_scene",hideCondition:39},{storyBefore:"1060",x:290,y:17,width:93,height:80,showCondition:5,showCondition1:40,hideCondition:1,hideConditionParam:"WinShop"}]},t}();t.GuideData=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(t,e,i,s){this.name="",this.name=t,this.pos=Number(e),this.npcId=i,this.speak=s}return e.getQueueByArray=function(i){for(var s=[],n=i.length,a=0;n>a;a++){var o=t.configMgr().getNpcInfoById(i[a].npc_id);s.push(new e(o.name,i[a].pos,o.looks,i[a].word))}return s},e}();t.RoleSpeakData=e}(hf||(hf={}));var hf;!function(t){var e=laya.utils.Dictionary,i=function(){function i(){this.isInit=!1,this._playDramaCmdArr=[],this.m_isRequesting=!1}return Object.defineProperty(i,"singleton",{get:function(){return null==i._singleton&&(i._singleton=new i),i._singleton},enumerable:!0,configurable:!0}),i.prototype.initialize=function(){var i=t.Global.getRes(t.ConfigDef.PLOT);this.mapData=new e;for(var s,n,a=i.items.length,o="",r=0;a>r;r++)n=i.items[r],o!=n.id&&(o=n.id,s=[],this.mapData.set(o,s)),s.push(n);this.isInit=!0},i.prototype.executeCmd=function(t){t&&(this._playDramaCmdArr.push(t),0==this.m_isRequesting&&this.playNextDrama())},i.prototype.playNextDrama=function(){if(this._playDramaCmdArr.length>0){var e=this._playDramaCmdArr[0];this.isInit||this.initialize(),this.m_isRequesting=!0;var i=e.id.split("_"),s=this.mapData.get(i[0]);if(s&&s.length>0&&i.length>=2){var n=s;s=[];for(var a,o=0;o<n.length;o++)a=n[o],a.type==i[1]&&s.push(a)}s&&s.length>0?(t.LayerMgr.getLayer(t.Layer.GUIDE).alpha=0,t.RoleSpeak.playQueue(t.RoleSpeakData.getQueueByArray(s),this.playEnd,this)):(e.ecode=t.PlayDramaCmd.ERR_NOT_EXIST,this.playEnd())}else this.dramaEnd()},i.prototype.playEnd=function(){if(this._playDramaCmdArr.length>0){var e=this._playDramaCmdArr.shift();e.ecode==t.Command.ERR_COMMAND_ECODE_UNDEFINED&&(e.ecode=t.PlayDramaCmd.SUCCESS),e.finish(),Laya.timer.frameOnce(1,this,this.dramaEnd)}},i.prototype.dramaEnd=function(){this.m_isRequesting=!1,this._playDramaCmdArr.length>0?this.playNextDrama():t.BoxMgr.hasBoxShow("LvUpBox")||(t.LayerMgr.getLayer(t.Layer.GUIDE).alpha=1)},i}();t.DramaMgr=i}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){this._loadCount=0,this._getUserDataErrorCount=0,this._isStartLoadGameRes=!1,this._hasEvent=!1,this._bgImage=new laya.ui.Image,this._bgImage.width=1334,this._bgImage.height=t.LayerMgr.clientHeight,this._bgImage.y-=t.LayerMgr.offY,this._bgImageURL=t.Global.isTest?"http://res.ledou.qq.com/tencent-logo.jpg":"/page/image/"+t.Global.PF+"_loading.jpg?_offine=1",this._bgImage.skin=this._bgImageURL,t.LayerMgr.addChild(this._bgImage,t.Layer.BEFORE_ENTER_GAME)}return e.prototype.init=function(){var t=[];t.push({url:"res/atlas/ui/beforeEnterGameLoading.json",type:Loader.ATLAS}),t.push({url:this._bgImageURL,type:Loader.IMAGE}),Laya.loader.load(t,Handler.create(this,this.onBeforeGameLoadingComplete))},e.prototype.onBeforeGameLoadingComplete=function(){window.speedReport&&window.speedReport.add&&window.speedReport.add(18),this._getUserDataErrorCount=0,this._beforeUI=new ui.BeforeEnterGameLoadingUI,t.LayerMgr.addChild(this._beforeUI,t.Layer.BEFORE_ENTER_GAME),this._barMaxWidth=this._beforeUI.bar.width,this._beforeUI.bar.width=0,this._beforeUI.bar.visible=!1,this.getUserData(),Browser.container.style.display="block"},e.prototype.getUserData=function(){var e="正在获取用户数据";0!=this._getUserDataErrorCount&&(e+="（"+this._getUserDataErrorCount+"）"),this._beforeUI.msgTxt.text=e;var i=t.JSUtils.getShareParams(),s=i.invitor?i.invitor:t.JSUtils.getQueryString("invitor")?t.JSUtils.getQueryString("invitor"):0,n=i.recaller?i.recaller:t.JSUtils.getQueryString("recaller")?t.JSUtils.getQueryString("recaller"):0,a={file:"petpk",cmd:"index",uid:t.Global.UID,inviter:s,wxcode:t.Global.WXCODE,from:t.Global.FROM,inviter_openid:t.Global.INVITE_OPENID,recaller:n};t.H5SDK.getShareChannel()&&(a.share_channel=t.H5SDK.getShareChannel()),t.JSUtils.getQueryString("share_from")&&(a.share_from=t.JSUtils.getQueryString("share_from")),a.h5channel=t.JSUtils.getChannel(),t.XHR().Post(a,this,this.getUserDataHandler)},e.prototype.getUserDataHandler=function(e){if(0!=e.result)this._beforeUI.msgTxt.text=e.msg,this._getUserDataErrorCount++,this._getUserDataErrorCount<4&&Laya.stage.once(Laya.Event.CLICK,this,this.getUserData);else{window.WXAPP&&e.openid&&(t.Global.H5OPENID=e.openid,t.Global.H5TOKEN=e.token,t.JSUtils.wxappReport(e)),window.speedReport&&window.speedReport.add&&window.speedReport.add(19),t.Global.UID=e.uid,e.hasOwnProperty("server_time")&&t.ServerClock.init(1e3*e.server_time),window.reportRegister&&t.Global.isWB&&1==e.new_player&&window.reportRegister();var i=new t.UserModel;i.setData(e),t.Facade.singleton.model.registerModel(i);var s=new t.FactionModel;t.Facade.singleton.model.registerModel(s),s.facID=i.faction.facID;var n=new t.PackModel;n.items=e.goods_info,t.Facade.singleton.model.registerModel(n);var a=new t.ShopModel;t.Facade.singleton.model.registerModel(a);var o=new t.AllStatusModel;o.setData(e.rodinfo),t.Facade.singleton.model.registerModel(o),o.setStatueFlagByName(t.AllStatusModel.FIGHTING_CHANNEL,e.prestige>=3e3?1:0),o.setStatueFlagByName(t.AllStatusModel.EENEGY,i.energy>1&&i.level<=10?1:0);var r=new t.ActModel;t.Facade.singleton.model.registerModel(r),o.setStatueFlagByName("kActCenter",0);var h=new t.BuffModel;h.buffs=e.status_info,t.Facade.singleton.model.registerModel(h);var l=new t.GuideModel;if(t.Facade.singleton.model.registerModel(l),e.hasOwnProperty("newhandtaskinfo")){var c=e.newhandtaskinfo;l.isGuiding=0==c[0],l.guidetaskID=c[1],245==l.guidetaskID&&2==i.level&&(l.guidetaskID=242),l.hasGift=1==c[2],l.nowStep=c[3]}else l.isGuiding=!1,l.guidetaskID=t.GuideModel.TASKID_END,l.hasGift=!1;if(t.Global.HandBook_bgs=[],e.hasOwnProperty("handbook_bg")&&e.handbook_bg.hasOwnProperty("hbinfo"))for(var d,u=0;u<e.handbook_bg.hbinfo.length;u++)d=e.handbook_bg.hbinfo[u],t.Global.HandBook_bgs.push(d.id);t.H5SDK.InitShare(),l.isGuiding&&241==l.guidetaskID&&!l.hasGift?this.getServerSetData():(this.loadGameRes(!1),this.getServerSetData()),t.JSUtils.getAPPUserInfo()}},e.prototype.getServerSetData=function(){var e=new t.ServerSetDataModel;t.Facade.singleton.model.registerModel(e),t.Logger.log("开始获取front数据。。。。。。"),t.XHR().Post({cmd:"front",op:"get"},this,this.onDataBack)},e.prototype.onDataBack=function(e){var i=t.Facade.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);if(0==e.result){i.initData(e.data);var s=i.getDailyDataValue(t.ServerSetDataModel.KEY_DAILY_ISFIRST_LOGIN);t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).firstLogin=0==s,0==s&&i.setDailyDataValue(t.ServerSetDataModel.KEY_DAILY_ISFIRST_LOGIN,1),t.Logger.log("获取front数据成功。。。。。。今日登录：",s)}else t.Logger.log("获取front数据失败，"+e.msg);t.Facade.retrieveModel(t.ModelDef.GUIDE_MODEL);this._isStartLoadGameRes||this.loadGameRes(!1),t.JSUtils.checkFriend()},e.prototype.loadGameRes=function(e){t.Logger.log("开始加载RES资源。。。。。。"),this._isStartLoadGameRes=!0,e&&(this._beforeUI&&(this._beforeUI.visible=!1),this._bgImage&&(this._bgImage.visible=!1)),this._loadArr=[],this._loadCount++,this._loadArr.push({url:"assets/ui/comp.json",type:Loader.ATLAS,msg:"正在加载通用UI"}),this._loadArr.push({url:"ui.json",type:Loader.JSON,msg:"正在加载UI的json数据"}),t.Global.MAIN_SCENE_BG_ID=t.Global.SCENE_ID_ARR[Math.floor(Math.random()*t.Global.SCENE_ID_ARR.length)],this._loadArr.push({url:t.ResPath().getFightScene(t.Global.MAIN_SCENE_BG_ID),type:Loader.IMAGE,msg:"正在加载主场景背景"}),this._beforeUI.bar.visible=!0,this._beforeUI.bar.width=this._barMaxWidth*this._loadCount/(this._loadArr.length+2),this._loadArrTotalLen=this._loadArr.length,this.nextLoad()},e.prototype.nextLoad=function(){if(this._loadArr)if(0==this._loadArr.length)t.Logger.log("加载RES资源完成。。。。。。"),View.uiMap=Laya.loader.getRes("ui.json"),this._loadArr=null,this._hasEvent?(this.destroy(),t.Facade.callCommand(new t.StartGuideCommand),t.Facade.callCommand(new t.StartCommonCmd),e.LOAD_COMPLETE=!0):(this._beforeUI.msgTxt.text="正在加载进入游戏前资源",t.EventCenter.singleton.event("GET_USER_DATA_OVER"));else{var i=this._loadArr.shift();this._beforeUI.msgTxt.text=i.msg;var s=[];s.push({url:i.url,type:i.type}),Laya.loader.load(s,Handler.create(this,this.onCompUIComplete))}},e.prototype.onCompUIComplete=function(){this._loadCount++,this._beforeUI&&(this._beforeUI.bar.width=this._barMaxWidth*this._loadCount/(this._loadArrTotalLen+2)),this.nextLoad()},e.prototype.destroy=function(){this._beforeUI&&Laya.timer.frameOnce(1,this,this.clearRes)},e.prototype.clearRes=function(){this._beforeUI.destroy(),this._beforeUI=null,this._bgImage&&(this._bgImage.parent&&this._bgImage.parent.removeChild(this._bgImage),Laya.loader.clearRes(this._bgImage.skin,!0),this._bgImage.dispose(),this._bgImage=null)},e.LOAD_COMPLETE=!1,e}();t.BeforeEnterGame=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.Event,i=laya.ui.View,s=function(s){function n(t,e,n,a,o,r){void 0===e&&(e=!0),void 0===n&&(n=!0),void 0===a&&(a=!0),void 0===o&&(o=!1),void 0===r&&(r=.4),s.call(this),this._isShowed=!1,this._skin=t||new i,this._skin.mouseThrough=!0,this.mouseThrough=!0,this.cacheAs="bitmap",this.addChild(this._skin),this.hasExeDestroy=!1,this._modal=e,this.destroyAfterHided=n,this.closeAfterChangeScene=a,this.hideOtherBox=o,this.modelAlpha=r,this.canClickModelToClose=!0}return __extends(n,s),n.prototype.fixAndroidCacheAs=function(){if(this.parent){var t=this.parent;this.parent.removeChild(this),t.addChild(this)}else if(this._skin.parent){var t=this._skin.parent;this._skin.parent.removeChild(this._skin),t.addChild(this._skin)}},Object.defineProperty(n.prototype,"skin",{get:function(){return this._skin},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"enabled",{get:function(){return this._enabled},set:function(t){this._enabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this.background?this.background.width:this.skin.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this.background?this.background.height:this.skin.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"background",{get:function(){return this._background},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"modal",{get:function(){return this._modal},enumerable:!0,configurable:!0}),n.prototype.setCloseButton=function(i,s){if(void 0===s&&(s=!1),this.closeButton&&(s&&this.closeButton.destroy(),this.closeButton.off(e.CLICK,this,this._closeClick),this.closeButton=null),i){var n=0,a=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL);if(t.Global.isWXAPP&&Browser.onAndriod&&a.level>3&&(n=-60),this.closeButton=i,this.closeButton.on(e.CLICK,this,this._closeClick),i.parent&&i.parent.parent){var o=i.parent instanceof ui.comp.PopSmallUI;if(o){var r=i.x+n,h=i.y,l=i.parent.x,c=i.parent.y;i.parent.parent.addChild(i),i.x=r+l,i.y=h+c}else{var d=i.parent instanceof ui.comp.PopMiddleUI;if(d){var r=i.x+n,h=i.y,l=i.parent.x,c=i.parent.y;i.parent.parent.addChild(i),i.x=r+l,i.y=h+c}}}}},n.prototype._closeClick=function(){this.hide()},Object.defineProperty(n.prototype,"isShowed",{get:function(){return this._isShowed},set:function(t){this._isShowed=t},enumerable:!0,configurable:!0}),n.prototype.close=function(){this.destroyed||(this.destroyAfterHided=!0,this.hide())},n.prototype.show=function(e,i){void 0===e&&(e=null),void 0===i&&(i=-1),-1==t.BoxMgr.boxs.indexOf(this)&&(this.showTime=t.ServerClock.getServerTime(),t.BoxMgr.show(this,e||t.Layer.BOX,i),t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.BOX_OPEN,this.boxName)),t.dispatch(t.ViewEvent.BOX_SHOW,this.boxName))},n.prototype.hide=function(){t.BoxMgr.hide(this),this._isShowed=!1},n.prototype.onShowed=function(){this._isShowed=!0,this.draw(),this.event(t.ViewEvent.BOX_SHOW,this)},n.prototype.draw=function(){},Object.defineProperty(n.prototype,"boxName",{get:function(){return this.name},enumerable:!0,configurable:!0}),n.prototype.onHided=function(){this.event(t.ViewEvent.BOX_HIDE,this),this.destroyAfterHided?this.hasExeDestroy||this.destroy():(t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.BOX_CLOSE,this.boxName)),t.dispatch(t.ViewEvent.BOX_HIDE,this.boxName))},n.prototype.destroy=function(){this.hasExeDestroy||(this.hasExeDestroy=!0,this.destroyed||(this._background=null,this.closeButton&&this.closeButton.destroy(),this.setCloseButton(null),t.BoxMgr.hide(this),this._skin=null,this.event(t.ViewEvent.BASE_DESTROY,this),t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.BOX_CLOSE,this.boxName)),t.dispatch(t.ViewEvent.BOX_HIDE,this.boxName),t.Tips.tipsClose(),s.prototype.destroy.call(this)))},Object.defineProperty(n.prototype,"weight",{get:function(){return this._weight},set:function(t){this._weight=t},enumerable:!0,configurable:!0}),n.prototype.resetImageSkin=function(t){if(t instanceof Laya.Image){var e=t.skin;if(e){var i=t.forceSkin;t.forceSkin=!0,t.skin=e,t.forceSkin=i}}for(var s=t.numChildren,n=0;s>n;n++)this.resetImageSkin(t.getChildAt(n))},n}(i);t.BaseBox=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.Event,i=function(i){function s(s){i.call(this,new ui.common.BeyondShareViewUI,!0,!0,!1,!1),this._display=this.skin,this._data=s,this.setCloseButton(this._display.btn_close),this._display.btn_share.on(e.CLICK,this,this.onShareClick),this.userModel=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL);for(var n=0;n<s.users.length;n++){if(n>2)return;var a=this._display["mc_item"+n],o=s.users[n];a.photo.skin=t.JSUtils.getHeadUrl(o.headimgurl),a.tf_name.text=o.name,a.tf_msg.text=o.msg,a.tf_lv.text=o.lv,2==o.sex?(a.femaleIcon.visible=!0,a.maleIcon.visible=!1):(a.femaleIcon.visible=!1,a.maleIcon.visible=!0)}s.users.length>2?(this._display.mc_item2.visible=!0,this._display.img_down.y=495):(this._display.mc_item2.visible=!1,this._display.img_down.y=341)}return __extends(s,i),s.prototype.destroy=function(){this._display&&(this._display.btn_share.off(e.CLICK,this,this.onShareClick),this._display=null,this._data=null,this.userModel=null,i.prototype.destroy.call(this))},s.prototype.onShareClick=function(){t.OpenBeyondShareBoxCmd.TYPE_SHARE_LILIANG==this._data.type?t.Global.isWXAPP?t.ShareModule.shareMessage({title:["历练模式赶超"],desc:["红红火火恍恍惚惚，我要领先你一步！","小姐姐小哥哥，你被我赶超啦~来挑战吧！","超越你了，当然是因为我棒棒啊！","有人说你菜，快来证明你的实力！"],uid:this._data.users[1].uid,alertType:1,image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(12)),command:1002},Handler.create(this,this.showCallBack),18):t.ShareModule.shareMessage({title:["历练模式赶超"],desc:["红红火火恍恍惚惚，我要领先你一步！","小姐姐小哥哥，你被我赶超啦~来挑战吧！","超越你了，当然是因为我棒棒啊！","有人说你菜，快来证明你的实力！"],uid:this._data.users[1].uid,alertType:1,command:1002},Handler.create(this,this.showCallBack),18):t.Global.isWXAPP?t.ShareModule.shareMessage({title:["爬塔模式超越"],desc:["动动指头就赶超你，无敌是多么寂寞啊！","快来膜拜我的新记录吧！","一步两步三步，我在蜜汁俯视着你~","啾啾啾~楼下的朋友你还听得到吗！"],uid:this._data.users[1].uid,alertType:1,image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(11)),command:1002},Handler.create(this,this.showCallBack),19):t.ShareModule.shareMessage({title:["爬塔模式超越"],desc:["动动指头就赶超你，无敌是多么寂寞啊！","快来膜拜我的新记录吧！","一步两步三步，我在蜜汁俯视着你~","啾啾啾~楼下的朋友你还听得到吗！"],uid:this._data.users[1].uid,alertType:1,command:1002},Handler.create(this,this.showCallBack),19)},s.prototype.showCallBack=function(e){e&&(0==e.retCode||e.result&&0==e.result.retCode)?(t.WeakTips.show("您的炫耀信息已经发送成功啦！"),this.destroy()):t.WeakTips.show("炫耀失败")},s}(t.BaseBox);t.BeyondShareBox=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},View=laya.ui.View,Dialog=laya.ui.Dialog,HFMapButton=hf.HFMapButton,SBtn1=hf.SBtn1,SBtn2=hf.SBtn2,SBtn3=hf.SBtn3,ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("act/ActCenter")},e}(View);t.ActCenterUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("act/ActItem")},e}(View);t.ActItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/ActMenuItem")},e}(View);t.ActMenuItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("act/BigClock")},e}(View);t.BigClockUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("act/BookWeChatPublic")},e}(View);t.BookWeChatPublicUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/CaiCaiCooking")},e}(View);t.CaiCaiCookingUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/Camp")},e}(View);t.CampUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.act.CampRankItemUI",t.act.CampRankItemUI),e.prototype.createChildren.call(this),this.loadUI("act/CampRank")},i}(View);e.CampRankUI=i}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/CampRankItem")},e}(View);t.CampRankItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/Chongzhi500")},e}(View);t.Chongzhi500UI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/Chongzhi500Reward")},e}(View);t.Chongzhi500RewardUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/Chouqian")},e}(View);t.ChouqianUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/CostPoint")},e}(View);t.CostPointUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/CostPointItem")},e}(View);t.CostPointItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/Day7Gift")},e}(View);t.Day7GiftUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("hf.DayCostListItem",hf.DayCostListItem),t.prototype.createChildren.call(this),this.loadUI("act/DayCost")},e}(View);t.DayCostUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("act/DayCostItem")},e}(View);t.DayCostItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/DayMondyNewItem")},e}(View);t.DayMondyNewItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("act/DayMoney")},e}(View);t.DayMoneyUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/DayMoneyNew")},e}(View);t.DayMoneyNewUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/DayRecharge")},e}(View);t.DayRechargeUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/DayRechargeDouble12_2017")},e}(View);t.DayRechargeDouble12_2017UI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/DayRechargeDouble12_2017Item")},e}(View);t.DayRechargeDouble12_2017ItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/DayRechargeItem")},e}(View);t.DayRechargeItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("act/DayTiLi")},e}(View);t.DayTiLiUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("HTMLDivElement",laya.html.dom.HTMLDivElement),t.prototype.createChildren.call(this),this.loadUI("act/Discount")},e}(View);t.DiscountUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/DiscountList")},e}(View);t.DiscountListUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/Farm")},e}(View);t.FarmUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/FishMain")},e}(View);t.FishMainUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("act/Fish_Act")},e}(View);t.Fish_ActUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("act/GemHouse")},e}(View);t.GemHouseUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/GemHouseItem")},e}(View);t.GemHouseItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/GemSell")},e}(View);t.GemSellUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/GemSellItem")},e}(View);t.GemSellItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.act.GoldHouseItemUI",t.act.GoldHouseItemUI),e.prototype.createChildren.call(this),this.loadUI("act/GoldHouse")},i}(View);e.GoldHouseUI=i}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/GoldHouseItem");
},e}(View);t.GoldHouseItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/Hallowmas2017_1")},e}(View);t.Hallowmas2017_1UI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/Hallowmas2017_1Item")},e}(View);t.Hallowmas2017_1ItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/Hallowmas2017_2")},e}(View);t.Hallowmas2017_2UI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/Hallowmas2017_2Item")},e}(View);t.Hallowmas2017_2ItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/JHItem")},e}(View);t.JHItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/JianJun")},e}(View);t.JianJunUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/JianJunItem")},e}(View);t.JianJunItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/JingHuaShop")},e}(View);t.JingHuaShopUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopMiddleUI",t.comp.PopMiddleUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("act/JointPicBox")},i}(View);e.JointPicBoxUI=i}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopMiddleUI",t.comp.PopMiddleUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("act/jointPicGetBox")},i}(View);e.jointPicGetBoxUI=i}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/JointPicMain")},e}(View);t.JointPicMainUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.PlayerInfoUI",t.PlayerInfoUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("act/JointPicSendItem")},i}(View);e.JointPicSendItemUI=i}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("act/JointPic_Act")},e}(View);t.JointPic_ActUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("act/KaiXue")},e}(View);t.KaiXueUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/KaiXueItem")},e}(View);t.KaiXueItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("act/LevelAct")},e}(View);t.LevelActUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/LevelActItem")},e}(View);t.LevelActItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/Listen")},e}(View);t.ListenUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("act/ListenWX")},e}(View);t.ListenWXUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/MonthCard")},e}(View);t.MonthCardUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/MonthCardItem")},e}(View);t.MonthCardItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/NormalSell")},e}(View);t.NormalSellUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/NormalSellItem")},e}(View);t.NormalSellItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("act/OutLet")},e}(View);t.OutLetUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/OutLetList")},e}(View);t.OutLetListUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.act.PetGiftItemUI",t.act.PetGiftItemUI),e.prototype.createChildren.call(this),this.loadUI("act/PetGift")},i}(View);e.PetGiftUI=i}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/PetGiftItem")},e}(View);t.PetGiftItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.act.PlanTabItem2UI",t.act.PlanTabItem2UI),View.regComponent("ui.act.PlanItemUI",t.act.PlanItemUI),View.regComponent("ui.act.PlanTabItemUI",t.act.PlanTabItemUI),e.prototype.createChildren.call(this),this.loadUI("act/Plan")},i}(View);e.PlanUI=i}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/PlanItem")},e}(View);t.PlanItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/PlanPopItem")},e}(View);t.PlanPopItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.act.PlanPopItemUI",t.act.PlanPopItemUI),e.prototype.createChildren.call(this),this.loadUI("act/PlanPopup")},i}(View);e.PlanPopupUI=i}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/PlanTabItem")},e}(View);t.PlanTabItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/PlanTabItem2")},e}(View);t.PlanTabItem2UI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.act.PumpkinItemUI",t.act.PumpkinItemUI),e.prototype.createChildren.call(this),this.loadUI("act/Pumpkin")},i}(View);e.PumpkinUI=i}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/PumpkinItem")},e}(View);t.PumpkinItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/Punch")},e}(View);t.PunchUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("hf.RecallPlayerItem",hf.RecallPlayerItem),View.regComponent("hf.RecallGoodsItem",hf.RecallGoodsItem),View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/Recall")},e}(View);t.RecallUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/RecallGoodsItem")},e}(View);t.RecallGoodsItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/RecallPlayerItem")},e}(View);t.RecallPlayerItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/Rechage")},e}(View);t.RechageUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("act/Recharge")},e}(View);t.RechargeUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/SWItem")},e}(View);t.SWItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/SWShop")},e}(View);t.SWShopUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/Tehui_2017Double11")},e}(View);t.Tehui_2017Double11UI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/TurnTable")},e}(View);t.TurnTableUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/TurnTable_2017_11")},e}(View);t.TurnTable_2017_11UI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/TurnTable_2017_11_Reward")},e}(View);t.TurnTable_2017_11_RewardUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/TurnTable_2017_11_RewardItem")},e}(View);t.TurnTable_2017_11_RewardItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/wbweekend/Gift")},e}(View);t.GiftUI=e}(e=t.wbweekend||(t.wbweekend={}))}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/wbweekend/GiftItem")},e}(View);t.GiftItemUI=e}(e=t.wbweekend||(t.wbweekend={}))}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/WeekActive1")},e}(View);t.WeekActive1UI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/WeekActive1Item")},e}(View);t.WeekActive1ItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/WeekActive2")},e}(View);t.WeekActive2UI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/WeekActive2Item")},e}(View);t.WeekActive2ItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.act.YearGiftItemUI",t.act.YearGiftItemUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("act/YearGift")},i}(View);e.YearGiftUI=i}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.act.YearGiftPropItemUI",t.act.YearGiftPropItemUI),e.prototype.createChildren.call(this),this.loadUI("act/YearGiftItem")},i}(View);e.YearGiftItemUI=i}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("act/YearGiftPropItem")},e}(View);t.YearGiftPropItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.act.YearSignItemUI",t.act.YearSignItemUI),e.prototype.createChildren.call(this),this.loadUI("act/YearSign")},i}(View);e.YearSignUI=i}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/YearSignItem")},e}(View);t.YearSignItemUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("act/Zhaocai")},e}(View);t.ZhaocaiUI=e}(e=t.act||(t.act={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("ui.bag.GoodsListItemUI",t.bag.GoodsListItemUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("bag/Bag")},i}(View);e.BagUI=i}(e=t.bag||(t.bag={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("bag/GoodsListItem")},e}(View);t.GoodsListItemUI=e}(e=t.bag||(t.bag={}))}(ui||(ui={}));var ui;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.createView(t.BeforeEnterGameLoadingUI.uiView)},i.uiView={type:"View",props:{width:1334,height:750},child:[{type:"Image",props:{y:0,x:0}},{type:"Image",props:{y:580,x:360,width:614,skin:"ui/beforeEnterGameLoading/barBg.png",sizeGrid:"0,33,0,26"}},{type:"Image",props:{y:587,x:367,width:600,"var":"bar",skin:"ui/beforeEnterGameLoading/bar.png",sizeGrid:"0,5,0,3",height:19}},{type:"Text",props:{y:615,x:167,width:1e3,"var":"msgTxt",text:"label",strokeColor:"#000000",stroke:3,height:39,fontSize:30,color:"#FFFFFF",bold:!0,align:"center"}}]},i}(View);t.BeforeEnterGameLoadingUI=e}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopMiddleUI",t.comp.PopMiddleUI),e.prototype.createChildren.call(this),this.loadUI("buff/Buff")},i}(View);e.BuffUI=i}(e=t.buff||(t.buff={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("buff/BuffItem")},e}(View);t.BuffItemUI=e}(e=t.buff||(t.buff={}))}(ui||(ui={}));var ui;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.friend.CommonMaskUI",t.friend.CommonMaskUI),e.prototype.createChildren.call(this),this.createView(t.CgDemoUI.uiView)},i.uiView={type:"View",props:{width:1334,height:750},child:[{type:"Image",props:{y:663,x:119,width:1096,"var":"wordBg",skin:"ui/cg/wordBg.png",height:56}},{type:"Text",props:{y:670,x:55,wordWrap:!0,width:1224,"var":"wordTxt",text:"曾经，在那个混沌的时代",stroke:2,height:52,fontSize:"30",font:"微软雅黑",color:"#ffffff",align:"center"}},{type:"Sprite",props:{y:0,x:0,"var":"playerLayer"}},{type:"Sprite",props:{y:0,x:112,"var":"leftSp"},child:[{type:"Image",props:{y:360,x:621,skin:"ui/drama/duihuakuang.png",scaleX:-1}},{type:"Label",props:{y:403,x:308,wordWrap:!0,width:283,"var":"txtL",valign:"middle",text:"呵呵～  你还是太年轻！！",skin:"ui/comp/label.png",leading:10,height:150,fontSize:28,color:"#030202",bold:!0,align:"center"}}]},{type:"Sprite",props:{y:0,x:-25,"var":"rightSp"},child:[{type:"Image",props:{y:360,x:623,skin:"ui/drama/duihuakuang.png"}},{type:"Label",props:{y:396,x:654,wordWrap:!0,width:288,"var":"txtR",valign:"middle",text:"今日一战，我要代替斗神再次将你封印",skin:"ui/comp/label.png",leading:10,height:128,fontSize:28,color:"#030202",bold:!0,align:"center"}}]},{type:"CommonMask",props:{y:-127,x:0,width:1334,"var":"blackScreen",height:1001,alpha:1,runtime:"ui.friend.CommonMaskUI"},compId:13},{type:"Text",props:{y:323,x:136,wordWrap:!0,width:1062,visible:!1,"var":"endWord",text:"为什么我每次做梦都会梦见斗神的惨败，这难道和千年一轮的邪神复活有什么关系吗？",stroke:2,leading:10,height:104,fontSize:"40",font:"微软雅黑",color:"#ffffff",align:"center"}},{type:"Image",props:{y:671,x:28,"var":"jumpBtn",skin:"ui/cg/jump.png",scaleY:1.1,scaleX:1.1}}],animations:[{nodes:[{target:13,keyframes:{alpha:[{value:.5,tweenMethod:"linearNone",tween:!0,target:13,key:"alpha",index:0},{value:1,tweenMethod:"linearNone",tween:!0,target:13,key:"alpha",index:30}]}}],name:"ani2",id:2,frameRate:24,action:0}]},i}(View);t.CgDemoUI=e}(ui||(ui={}));var ui;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.CgEndUI.uiView)},i.uiView={type:"View",props:{width:1334,height:750},child:[{type:"Image",props:{y:0,x:0,"var":"cg_bg"}},{type:"Button",props:{y:599,x:739,width:255,"var":"enterBtn",skin:"ui/comp/btn_style1.png",labelSize:28,label:"进入乐斗",height:80,labelColors:"#743100,#FFFFFF,#FFFFFF,#743100",labelBold:"true",labelStroke:2,strokeColors:"#ECC975,#771700,#771700,#000000",labelPadding:"15,20,20,20",labelFont:"微软雅黑",sizeGrid:"14,16,16,19"}},{type:"Button",props:{y:599,x:333,width:255,"var":"quitBtn",skin:"ui/comp/btn_style1.png",labelSize:28,label:"退   出",height:80,labelColors:"#743100,#FFFFFF,#FFFFFF,#743100",labelBold:"true",labelStroke:2,strokeColors:"#ECC975,#771700,#771700,#000000",labelPadding:"15,20,20,20",labelFont:"微软雅黑",sizeGrid:"14,16,16,19"}}]},i}(View);t.CgEndUI=e}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("hf.ChainStrengthenView",hf.ChainStrengthenView),View.regComponent("hf.ChainDetailView",hf.ChainDetailView),t.prototype.createChildren.call(this),this.loadUI("chain/Chain")},e}(View);t.ChainUI=e}(e=t.chain||(t.chain={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("chain/ChainChangeName")},e}(View);t.ChainChangeNameUI=e}(e=t.chain||(t.chain={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("hf.ChainWeaponIcon",hf.ChainWeaponIcon),t.prototype.createChildren.call(this),this.loadUI("chain/ChainDetail")},e}(View);t.ChainDetailUI=e}(e=t.chain||(t.chain={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("hf.ChainSmallWeaponIcon",hf.ChainSmallWeaponIcon),t.prototype.createChildren.call(this),this.loadUI("chain/ChainItem")},e}(View);t.ChainItemUI=e}(e=t.chain||(t.chain={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("hf.ChainSmallWeaponIcon",hf.ChainSmallWeaponIcon),t.prototype.createChildren.call(this),this.loadUI("chain/ChainProgramChain")},e}(View);t.ChainProgramChainUI=e}(e=t.chain||(t.chain={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("chain/ChainProgramItem")},e}(View);t.ChainProgramItemUI=e}(e=t.chain||(t.chain={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("hf.ChainProgramItem",hf.ChainProgramItem),e.prototype.createChildren.call(this),this.loadUI("chain/ChainProgramme")},i}(View);e.ChainProgrammeUI=i}(e=t.chain||(t.chain={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("hf.ChainWeaponItem",hf.ChainWeaponItem),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("chain/ChainSelectWeapon")},i}(View);e.ChainSelectWeaponUI=i}(e=t.chain||(t.chain={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("chain/ChainSkillDesc")},e}(View);t.ChainSkillDescUI=e}(e=t.chain||(t.chain={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("chain/ChainSmallWeaponIcon")},e}(View);t.ChainSmallWeaponIconUI=e}(e=t.chain||(t.chain={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("HTMLDivElement",laya.html.dom.HTMLDivElement),t.prototype.createChildren.call(this),this.loadUI("chain/ChainStrengthen")},e}(View);t.ChainStrengthenUI=e}(e=t.chain||(t.chain={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("chain/ChainWeaponDesc")},e}(View);t.ChainWeaponDescUI=e}(e=t.chain||(t.chain={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("chain/ChainWeaponIcon")},e}(View);t.ChainWeaponIconUI=e}(e=t.chain||(t.chain={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("chain/ChainWeaponItem")},e}(View);t.ChainWeaponItemUI=e}(e=t.chain||(t.chain={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.champion.FireItemUI",t.champion.FireItemUI),View.regComponent("ui.champion.TabItemUI",t.champion.TabItemUI),View.regComponent("ui.champion.RankItemUI",t.champion.RankItemUI),e.prototype.createChildren.call(this),this.loadUI("champion/Champion")},i}(View);e.ChampionUI=i}(e=t.champion||(t.champion={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("ui.champion.ChampionLogItemUI",t.champion.ChampionLogItemUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("champion/ChampionLog")},i}(View);e.ChampionLogUI=i}(e=t.champion||(t.champion={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("champion/ChampionLogItem")},e}(View);t.ChampionLogItemUI=e}(e=t.champion||(t.champion={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("champion/FireItem")},e}(View);t.FireItemUI=e}(e=t.champion||(t.champion={}))}(ui||(ui={}));var ui;!function(t){var e;
!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("champion/PopConfirm")},e}(View);t.PopConfirmUI=e}(e=t.champion||(t.champion={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("champion/RankItem")},e}(View);t.RankItemUI=e}(e=t.champion||(t.champion={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopTinyUI",t.comp.PopTinyUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("champion/Rule")},i}(View);e.RuleUI=i}(e=t.champion||(t.champion={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("champion/TabItem")},e}(View);t.TabItemUI=e}(e=t.champion||(t.champion={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("hf.ChampionFightPlayerInfo",hf.ChampionFightPlayerInfo),View.regComponent("hf.ChampionFightTeamFlag",hf.ChampionFightTeamFlag),View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("championteam/ChampionFightBox")},e}(View);t.ChampionFightBoxUI=e}(e=t.championteam||(t.championteam={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("championteam/ChampionFightInfo")},e}(View);t.ChampionFightInfoUI=e}(e=t.championteam||(t.championteam={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("championteam/ChampionFightPlayerInfo")},e}(View);t.ChampionFightPlayerInfoUI=e}(e=t.championteam||(t.championteam={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("championteam/ChampionFightTeamFlag")},e}(View);t.ChampionFightTeamFlagUI=e}(e=t.championteam||(t.championteam={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.champion.FireItemUI",t.champion.FireItemUI),e.prototype.createChildren.call(this),this.loadUI("championteam/ChampionFlagView")},i}(View);e.ChampionFlagViewUI=i}(e=t.championteam||(t.championteam={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("championteam/ChampionInviteRankItem")},e}(View);t.ChampionInviteRankItemUI=e}(e=t.championteam||(t.championteam={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.champion.TabItemUI",t.champion.TabItemUI),View.regComponent("ui.championteam.ChanpionTeamRankItemUI",t.championteam.ChanpionTeamRankItemUI),View.regComponent("hf.ChanpionTeamhRankItem",hf.ChanpionTeamhRankItem),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("championteam/ChampionRankBox")},i}(View);e.ChampionRankBoxUI=i}(e=t.championteam||(t.championteam={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("championteam/ChampionRewardView")},e}(View);t.ChampionRewardViewUI=e}(e=t.championteam||(t.championteam={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("hf.ChampionTeamSelectView",hf.ChampionTeamSelectView),View.regComponent("hf.ChampionFlagView",hf.ChampionFlagView),View.regComponent("hf.ChampionTeamLeftTopBox",hf.ChampionTeamLeftTopBox),View.regComponent("hf.ChampionTeamInfo",hf.ChampionTeamInfo),View.regComponent("hf.ChampionRewardView",hf.ChampionRewardView),View.regComponent("hf.ChampionRankView",hf.ChampionRankView),View.regComponent("hf.ChampionFightInfo",hf.ChampionFightInfo),t.prototype.createChildren.call(this),this.loadUI("championteam/ChampionTeam")},e}(View);t.ChampionTeamUI=e}(e=t.championteam||(t.championteam={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("championteam/ChampionTeamCreateTeam")},e}(View);t.ChampionTeamCreateTeamUI=e}(e=t.championteam||(t.championteam={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("hf.ChampionTeammateInfo2",hf.ChampionTeammateInfo2),View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("championteam/ChampionTeamInfo")},e}(View);t.ChampionTeamInfoUI=e}(e=t.championteam||(t.championteam={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.champion.TabItemUI",t.champion.TabItemUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("championteam/ChampionTeamInviteBox")},i}(View);e.ChampionTeamInviteBoxUI=i}(e=t.championteam||(t.championteam={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("hf.ChampionTeammateInfo",hf.ChampionTeammateInfo),t.prototype.createChildren.call(this),this.loadUI("championteam/ChampionTeamInviteInfo")},e}(View);t.ChampionTeamInviteInfoUI=e}(e=t.championteam||(t.championteam={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("championteam/ChampionTeamLeftTop")},e}(View);t.ChampionTeamLeftTopUI=e}(e=t.championteam||(t.championteam={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("championteam/ChampionTeammateInfo")},e}(View);t.ChampionTeammateInfoUI=e}(e=t.championteam||(t.championteam={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("championteam/ChampionTeamSelect")},e}(View);t.ChampionTeamSelectUI=e}(e=t.championteam||(t.championteam={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("hf.ChampionTeammateInfo3",hf.ChampionTeammateInfo3),t.prototype.createChildren.call(this),this.loadUI("championteam/ChanpionTeamRankItem")},e}(View);t.ChanpionTeamRankItemUI=e}(e=t.championteam||(t.championteam={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("change72/Change72Box")},e}(View);t.Change72BoxUI=e}(e=t.change72||(t.change72={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("change72/Change72Item")},e}(View);t.Change72ItemUI=e}(e=t.change72||(t.change72={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("change72/Change72NpcMovie")},e}(View);t.Change72NpcMovieUI=e}(e=t.change72||(t.change72={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("change72/Change72RewardItem")},e}(View);t.Change72RewardItemUI=e}(e=t.change72||(t.change72={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("channels/AllAttrs")},e}(View);t.AllAttrsUI=e}(e=t.channels||(t.channels={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("channels/AllAttrsRule")},e}(View);t.AllAttrsRuleUI=e}(e=t.channels||(t.channels={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("channels/ChannelsIconBox")},e}(View);t.ChannelsIconBoxUI=e}(e=t.channels||(t.channels={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("channels/ChannelsItemBox")},e}(View);t.ChannelsItemBoxUI=e}(e=t.channels||(t.channels={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),View.regComponent("ui.channels.ChannelsIconBoxUI",t.channels.ChannelsIconBoxUI),e.prototype.createChildren.call(this),this.loadUI("channels/ChannelsView")},i}(View);e.ChannelsViewUI=i}(e=t.channels||(t.channels={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("channels/NewChannelsBox")},e}(View);t.NewChannelsBoxUI=e}(e=t.channels||(t.channels={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("HTMLDivElement",laya.html.dom.HTMLDivElement),t.prototype.createChildren.call(this),this.loadUI("christmas/ChrismasView")},e}(View);t.ChrismasViewUI=e}(e=t.christmas||(t.christmas={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("christmas/ChristmasFeedItem")},e}(View);t.ChristmasFeedItemUI=e}(e=t.christmas||(t.christmas={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("christmas/ChristmasGiftItem")},e}(View);t.ChristmasGiftItemUI=e}(e=t.christmas||(t.christmas={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("hf.ChristmasGiftShow",hf.ChristmasGiftShow),e.prototype.createChildren.call(this),this.loadUI("christmas/ChristmasGifts")},i}(View);e.ChristmasGiftsUI=i}(e=t.christmas||(t.christmas={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("christmas/ChristmasGiftShow")},e}(View);t.ChristmasGiftShowUI=e}(e=t.christmas||(t.christmas={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("christmasTotal/ChristmasTotal")},e}(View);t.ChristmasTotalUI=e}(e=t.christmasTotal||(t.christmasTotal={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("christmasTotal/FirstChristmasPngBox")},e}(View);t.FirstChristmasPngBoxUI=e}(e=t.christmasTotal||(t.christmasTotal={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopTinyUI",t.comp.PopTinyUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("collect/Collect")},i}(View);e.CollectUI=i}(e=t.collect||(t.collect={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("collect/WeixinCollect")},i}(View);e.WeixinCollectUI=i}(e=t.collect||(t.collect={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("common/BeyondShareItem")},e}(View);t.BeyondShareItemUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.common.BeyondShareItemUI",t.common.BeyondShareItemUI),e.prototype.createChildren.call(this),this.loadUI("common/BeyondShareView")},i}(View);e.BeyondShareViewUI=i}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("common/BuffIcons")},e}(View);t.BuffIconsUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("hf.FriendListShowItem",hf.FriendListShowItem),t.prototype.createChildren.call(this),this.loadUI("common/FriendListShow")},e}(View);t.FriendListShowUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("common/FriendListShowItem")},e}(View);t.FriendListShowItemUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("common/FriendShowFrame")},e}(View);t.FriendShowFrameUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("common/LvUp")},e}(View);t.LvUpUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("common/LvUpBook")},e}(View);t.LvUpBookUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("common/LvUpShare")},e}(View);t.LvUpShareUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("common/LvUpShareList")},e}(View);t.LvUpShareListUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("HTMLDivElement",laya.html.dom.HTMLDivElement),t.prototype.createChildren.call(this),this.loadUI("common/NoticeBox")},e}(View);t.NoticeBoxUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("HTMLDivElement",laya.html.dom.HTMLDivElement),t.prototype.createChildren.call(this),this.loadUI("common/NoticeBoxItem")},e}(View);t.NoticeBoxItemUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("common/PopBox")},e}(View);t.PopBoxUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.common.RechargeItemUI",t.common.RechargeItemUI),e.prototype.createChildren.call(this),this.loadUI("common/Recharge")},i}(View);e.RechargeUI=i}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("common/RechargeItem")},e}(View);t.RechargeItemUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("common/RewardItem")},e}(View);t.RewardItemUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.common.SceneBgUI.uiView)},i.uiView={type:"View",props:{width:1334,height:126},child:[{type:"Image",props:{y:0,x:0,skin:"ui/comp/sceneBg.jpg"}}]},i}(View);e.SceneBgUI=i}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.common.SceneBgLongUI.uiView)},i.uiView={type:"View",props:{width:158,height:750},child:[{type:"Image",props:{y:0,x:158,skin:"ui/comp/sceneBgLong.jpg",scaleX:-1}}]},i}(View);e.SceneBgLongUI=i}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("common/ShowButtonOpenLevel")},e}(View);t.ShowButtonOpenLevelUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("common/ShowGetRewardNewItem")},e}(View);t.ShowGetRewardNewItemUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("common/ShowGetRewardView")},e}(View);t.ShowGetRewardViewUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("common/ShowGetRewardViewNew")},e}(View);t.ShowGetRewardViewNewUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("common/ShowNewPower")},e}(View);t.ShowNewPowerUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("common/ShowUpAnimation")},e}(View);t.ShowUpAnimationUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("common/StrengChange")},e}(View);t.StrengChangeUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("common/TipsUI")},e}(View);t.TipsUIUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("common/WbGift")},e}(View);t.WbGiftUI=e}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.common.WeakTipUIUI.uiView)},i.uiView={type:"View",props:{width:50,height:47},child:[{type:"Image",props:{y:0,x:0,width:50,"var":"bg",skin:"ui/comp/WeakTip.png",sizeGrid:"11,13,17,12"}},{type:"Label",props:{y:11,x:15,"var":"msgTxt",text:"窝",strokeColor:"#000000",stroke:2,fontSize:20,color:"#ffa000",bold:!0,align:"left"}}]},i}(View);e.WeakTipUIUI=i}(e=t.common||(t.common={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("comp/ConfirmBox")},e}(View);t.ConfirmBoxUI=e}(e=t.comp||(t.comp={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("comp/MiniBox")},e}(View);t.MiniBoxUI=e}(e=t.comp||(t.comp={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("comp/MsgBox")},e}(View);t.MsgBoxUI=e}(e=t.comp||(t.comp={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("comp/PayConFirm")},e}(View);t.PayConFirmUI=e}(e=t.comp||(t.comp={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("comp/PopBig")},e}(View);t.PopBigUI=e}(e=t.comp||(t.comp={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("comp/PopMiddle")},e}(View);t.PopMiddleUI=e}(e=t.comp||(t.comp={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("comp/PopSmall")},e}(View);t.PopSmallUI=e}(e=t.comp||(t.comp={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("comp/PopTiny")},e}(View);t.PopTinyUI=e}(e=t.comp||(t.comp={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopTinyUI",t.comp.PopTinyUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("comp/RulePanel")},i}(View);e.RulePanelUI=i}(e=t.comp||(t.comp={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("comp/ShowRewardUI")},e}(View);t.ShowRewardUIUI=e}(e=t.comp||(t.comp={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("comp/SubBottomMenu")},e}(View);t.SubBottomMenuUI=e}(e=t.comp||(t.comp={}))}(ui||(ui={}));var ui;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("Drama")},e}(View);t.DramaUI=e}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("faction/faction/BaseHall")},i}(View);e.BaseHallUI=i}(i=e.faction||(e.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.PlayerInfoUI",t.PlayerInfoUI),e.prototype.createChildren.call(this),this.loadUI("faction/faction/BaseHallItem")},i}(View);e.BaseHallItemUI=i}(i=e.faction||(e.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("faction/faction/BaseHallLogItem")},e}(View);t.BaseHallLogItemUI=e}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("faction/faction/Donate")},i}(View);e.DonateUI=i}(i=e.faction||(e.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("faction/faction/EditFacIconBox")},e}(View);t.EditFacIconBoxUI=e}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("faction/faction/FacIconItem")},e}(View);t.FacIconItemUI=e}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("faction/faction/FactionHoleBossHp")},e}(View);t.FactionHoleBossHpUI=e}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),e.prototype.createChildren.call(this),this.loadUI("faction/faction/FactionHoleFightRecord")},i}(View);e.FactionHoleFightRecordUI=i}(i=e.faction||(e.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),
e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("faction/faction/FactionHoleFightRecordItem")},e}(View);t.FactionHoleFightRecordItemUI=e}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("faction/faction/FactionHoleNpc")},e}(View);t.FactionHoleNpcUI=e}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("faction/faction/FactionHoleNpcBox")},e}(View);t.FactionHoleNpcBoxUI=e}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),View.regComponent("ui.faction.faction.FactionHoleRankItemUI",t.faction.faction.FactionHoleRankItemUI),e.prototype.createChildren.call(this),this.loadUI("faction/faction/FactionHoleRank")},i}(View);e.FactionHoleRankUI=i}(i=e.faction||(e.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("faction/faction/FactionHoleRankItem")},e}(View);t.FactionHoleRankItemUI=e}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.faction.faction.FactionHoleNpcUI",t.faction.faction.FactionHoleNpcUI),View.regComponent("Text",laya.display.Text),View.regComponent("HTMLDivElement",laya.html.dom.HTMLDivElement),View.regComponent("hf.BuffIcons",hf.BuffIcons),View.regComponent("ui.faction.faction.FactionHoleBossHpUI",t.faction.faction.FactionHoleBossHpUI),e.prototype.createChildren.call(this),this.loadUI("faction/faction/FactionHoleScene")},i}(View);e.FactionHoleSceneUI=i}(i=e.faction||(e.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("faction/faction/FactionNotice")},e}(View);t.FactionNoticeUI=e}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),View.regComponent("HTMLDivElement",laya.html.dom.HTMLDivElement),e.prototype.createChildren.call(this),this.loadUI("faction/faction/FactionPractice")},i}(View);e.FactionPracticeUI=i}(i=e.faction||(e.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("faction/faction/FactionPracticeItem")},e}(View);t.FactionPracticeItemUI=e}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("faction/faction/FactionScene")},e}(View);t.FactionSceneUI=e}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("faction/faction/FactionSceneItem")},e}(View);t.FactionSceneItemUI=e}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("faction/faction/FactionSceneRole")},e}(View);t.FactionSceneRoleUI=e}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("faction/faction/FactionTotem")},i}(View);e.FactionTotemUI=i}(i=e.faction||(e.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("faction/faction/FactionTotemItem")},e}(View);t.FactionTotemItemUI=e}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("faction/faction/factionWar/FactionWarBetBox")},e}(View);t.FactionWarBetBoxUI=e}(e=t.factionWar||(t.factionWar={}))}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("faction/faction/factionWar/FactionWarBgBox")},e}(View);t.FactionWarBgBoxUI=e}(e=t.factionWar||(t.factionWar={}))}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("faction/faction/factionWar/FactionWarChampion")},e}(View);t.FactionWarChampionUI=e}(e=t.factionWar||(t.factionWar={}))}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i;!function(e){var i;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.faction.faction.factionWar.FactionWarBgBoxUI",t.faction.faction.factionWar.FactionWarBgBoxUI),View.regComponent("ui.faction.faction.factionWar.FactionWarChampionUI",t.faction.faction.factionWar.FactionWarChampionUI),View.regComponent("ui.faction.faction.factionWar.FactionWarPlayerUI",t.faction.faction.factionWar.FactionWarPlayerUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("faction/faction/factionWar/FactionWarFront8Box")},i}(View);e.FactionWarFront8BoxUI=i}(i=e.factionWar||(e.factionWar={}))}(i=e.faction||(e.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("faction/faction/factionWar/FactionWarLine")},e}(View);t.FactionWarLineUI=e}(e=t.factionWar||(t.factionWar={}))}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("faction/faction/factionWar/FactionWarPlayer")},e}(View);t.FactionWarPlayerUI=e}(e=t.factionWar||(t.factionWar={}))}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i;!function(e){var i;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.faction.faction.factionWar.FactionWarBgBoxUI",t.faction.faction.factionWar.FactionWarBgBoxUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("faction/faction/factionWar/FactionWarReplayBox")},i}(View);e.FactionWarReplayBoxUI=i}(i=e.factionWar||(e.factionWar={}))}(i=e.faction||(e.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("faction/faction/factionWar/FactionWarReplayItem")},e}(View);t.FactionWarReplayItemUI=e}(e=t.factionWar||(t.factionWar={}))}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("faction/faction/factionWar/FactionWarReplayOnceItem")},e}(View);t.FactionWarReplayOnceItemUI=e}(e=t.factionWar||(t.factionWar={}))}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("HTMLDivElement",laya.html.dom.HTMLDivElement),t.prototype.createChildren.call(this),this.loadUI("faction/faction/factionWar/FactionWarScene")},e}(View);t.FactionWarSceneUI=e}(e=t.factionWar||(t.factionWar={}))}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i;!function(e){var i;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.PlayerInfoUI",t.PlayerInfoUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("faction/faction/factionWar/FightMemberItem")},i}(View);e.FightMemberItemUI=i}(i=e.factionWar||(e.factionWar={}))}(i=e.faction||(e.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i;!function(e){var i;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.PlayerInfoUI",t.PlayerInfoUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("faction/faction/factionWar/SceneFightMemberItem")},i}(View);e.SceneFightMemberItemUI=i}(i=e.factionWar||(e.factionWar={}))}(i=e.faction||(e.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i;!function(e){var i;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.faction.faction.factionWar.FactionWarBgBoxUI",t.faction.faction.factionWar.FactionWarBgBoxUI),View.regComponent("ui.PlayerInfoUI",t.PlayerInfoUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("faction/faction/factionWar/SelfFactioniWarBox")},i}(View);e.SelfFactioniWarBoxUI=i}(i=e.factionWar||(e.factionWar={}))}(i=e.faction||(e.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("hf.BuffIcons",hf.BuffIcons),t.prototype.createChildren.call(this),this.loadUI("faction/faction/FactionWuguanScene")},e}(View);t.FactionWuguanSceneUI=e}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("faction/faction/Recruit")},i}(View);e.RecruitUI=i}(i=e.faction||(e.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.PlayerInfoUI",t.PlayerInfoUI),e.prototype.createChildren.call(this),this.loadUI("faction/faction/RecruitItem")},i}(View);e.RecruitItemUI=i}(i=e.faction||(e.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("faction/faction/SmritiFactionBox")},e}(View);t.SmritiFactionBoxUI=e}(e=t.faction||(t.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),View.regComponent("HTMLDivElement",laya.html.dom.HTMLDivElement),e.prototype.createChildren.call(this),this.loadUI("faction/faction/Update")},i}(View);e.UpdateUI=i}(i=e.faction||(e.faction={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.faction.noFac.FacIconUI",t.faction.noFac.FacIconUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("faction/noFac/CreateFacBox")},i}(View);e.CreateFacBoxUI=i}(i=e.noFac||(e.noFac={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("faction/noFac/FacIcon")},e}(View);t.FacIconUI=e}(e=t.noFac||(t.noFac={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("faction/noFac/FacInfoPanel")},e}(View);t.FacInfoPanelUI=e}(e=t.noFac||(t.noFac={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),View.regComponent("ui.faction.noFac.FactionListItemUI",t.faction.noFac.FactionListItemUI),e.prototype.createChildren.call(this),this.loadUI("faction/noFac/FactionList")},i}(View);e.FactionListUI=i}(i=e.noFac||(e.noFac={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("faction/noFac/FactionListItem")},e}(View);t.FactionListItemUI=e}(e=t.noFac||(t.noFac={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("faction/noFac/SearchFacBox")},e}(View);t.SearchFacBoxUI=e}(e=t.noFac||(t.noFac={}))}(e=t.faction||(t.faction={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("fight/FightChain")},e}(View);t.FightChainUI=e}(e=t.fight||(t.fight={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("fight/FightChampion")},e}(View);t.FightChampionUI=e}(e=t.fight||(t.fight={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("fight/FightFactionTotem")},e}(View);t.FightFactionTotemUI=e}(e=t.fight||(t.fight={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("fight/FightMonster")},e}(View);t.FightMonsterUI=e}(e=t.fight||(t.fight={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("fight/FightPlayerInfo")},e}(View);t.FightPlayerInfoUI=e}(e=t.fight||(t.fight={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("fight/FightRound")},e}(View);t.FightRoundUI=e}(e=t.fight||(t.fight={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("fight/FightSkillItem")},e}(View);t.FightSkillItemUI=e}(e=t.fight||(t.fight={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("fight/FightSkip")},e}(View);t.FightSkipUI=e}(e=t.fight||(t.fight={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("fight/FightSpeed")},e}(View);t.FightSpeedUI=e}(e=t.fight||(t.fight={}))}(ui||(ui={}));var ui;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("FightResult")},e}(View);t.FightResultUI=e}(ui||(ui={}));var ui;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("hf.FightFrontScene",hf.FightFrontScene),View.regComponent("hf.FightMonsterView",hf.FightMonsterView),View.regComponent("hf.FightRoundView",hf.FightRoundView),View.regComponent("hf.FightPlayerInfoView",hf.FightPlayerInfoView),View.regComponent("hf.FightRightPlayerInfoView",hf.FightRightPlayerInfoView),View.regComponent("hf.FightBuffView",hf.FightBuffView),View.regComponent("hf.FightWeaponView",hf.FightWeaponView),View.regComponent("hf.FightFactionTotem",hf.FightFactionTotem),View.regComponent("hf.FightSpeedView",hf.FightSpeedView),View.regComponent("hf.FightSkipView",hf.FightSkipView),View.regComponent("Text",laya.display.Text),View.regComponent("hf.FightEndWord",hf.FightEndWord),View.regComponent("hf.FightChainView",hf.FightChainView),View.regComponent("hf.FightChampionView",hf.FightChampionView),View.regComponent("hf.FightHpUIView",hf.FightHpUIView),t.prototype.createChildren.call(this),this.loadUI("FightUI")},e}(View);t.FightUIUI=e}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("hf.AddGroupFriendItem",hf.AddGroupFriendItem),t.prototype.createChildren.call(this),this.loadUI("friend/AddGroupFriend")},e}(View);t.AddGroupFriendUI=e}(e=t.friend||(t.friend={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("friend/AddGroupFriendItem")},e}(View);t.AddGroupFriendItemUI=e}(e=t.friend||(t.friend={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("friend/CommonMask")},e}(View);t.CommonMaskUI=e}(e=t.friend||(t.friend={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("friend/Friend")},i}(View);e.FriendUI=i}(e=t.friend||(t.friend={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.friend.CommonMaskUI",t.friend.CommonMaskUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("friend/FriendAdd")},i}(View);e.FriendAddUI=i}(e=t.friend||(t.friend={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.PlayerInfoUI",t.PlayerInfoUI),e.prototype.createChildren.call(this),this.loadUI("friend/FriendListItem")},i}(View);e.FriendListItemUI=i}(e=t.friend||(t.friend={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("friend/FriendLogItem")},e}(View);t.FriendLogItemUI=e}(e=t.friend||(t.friend={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.friend.CommonMaskUI",t.friend.CommonMaskUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("friend/FriendTips")},i}(View);e.FriendTipsUI=i}(e=t.friend||(t.friend={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("friend/InviteFriend")},i}(View);e.InviteFriendUI=i}(e=t.friend||(t.friend={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("friend/InviteRewardItem")},e}(View);t.InviteRewardItemUI=e}(e=t.friend||(t.friend={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.friend.CommonMaskUI",t.friend.CommonMaskUI),View.regComponent("ui.comp.MsgBoxUI",t.comp.MsgBoxUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("friend/InviteRule")},i}(View);e.InviteRuleUI=i}(e=t.friend||(t.friend={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),View.regComponent("ui.gem.GemItemUI",t.gem.GemItemUI),View.regComponent("ui.gem.SpotItemUI",t.gem.SpotItemUI),View.regComponent("ui.gem.WeaponListItemUI",t.gem.WeaponListItemUI),e.prototype.createChildren.call(this),this.loadUI("gem/Gem")},i}(View);e.GemUI=i}(e=t.gem||(t.gem={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("gem/GemItem")},e}(View);t.GemItemUI=e}(e=t.gem||(t.gem={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("gem/SpotItem")},e}(View);t.SpotItemUI=e}(e=t.gem||(t.gem={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("HTMLDivElement",laya.html.dom.HTMLDivElement),t.prototype.createChildren.call(this),this.loadUI("gem/UpgradeConfirm")},e}(View);t.UpgradeConfirmUI=e}(e=t.gem||(t.gem={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("gem/WeaponListItem")},e}(View);t.WeaponListItemUI=e}(e=t.gem||(t.gem={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("guide/GuideCircle")},e}(View);t.GuideCircleUI=e}(e=t.guide||(t.guide={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("guide/GuideFiguireDown")},e}(View);t.GuideFiguireDownUI=e}(e=t.guide||(t.guide={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("guide/GuideFigure")},e}(View);t.GuideFigureUI=e}(e=t.guide||(t.guide={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this),this.createUI(t.guide.Image1UI.uiView)}return __extends(i,e),i.prototype.createUI=function(t){laya.utils.ClassUtils.createByJson(t,this,this)},i.uiView={type:"Image",props:{skin:"ui/handbook/img_dadi1.png",x:0,y:0}},i}(Laya.Image);e.Image1UI=i}(e=t.guide||(t.guide={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("handbook/ChangJingHandBook")},e}(View);t.ChangJingHandBookUI=e}(e=t.handbook||(t.handbook={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.handbook.LeDouHandBookUI",t.handbook.LeDouHandBookUI),View.regComponent("ui.handbook.JiaoSeHandBookUI",t.handbook.JiaoSeHandBookUI),View.regComponent("ui.handbook.ChangJingHandBookUI",t.handbook.ChangJingHandBookUI),View.regComponent("ui.handbook.LiLianHandBookUI",t.handbook.LiLianHandBookUI),View.regComponent("ui.handbook.WuQiHandBookUI",t.handbook.WuQiHandBookUI),View.regComponent("ui.handbook.JiNengHandBookUI",t.handbook.JiNengHandBookUI),e.prototype.createChildren.call(this),this.loadUI("handbook/HandBook")},i}(View);e.HandBookUI=i}(e=t.handbook||(t.handbook={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("handbook/HandbookJiaoseCard")},e}(View);t.HandbookJiaoseCardUI=e}(e=t.handbook||(t.handbook={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("handbook/HandbookWuqiCard")},e}(View);t.HandbookWuqiCardUI=e}(e=t.handbook||(t.handbook={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("handbook/JiaoSeHandBook")},e}(View);t.JiaoSeHandBookUI=e}(e=t.handbook||(t.handbook={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("handbook/JiaoseItem")},e}(View);t.JiaoseItemUI=e}(e=t.handbook||(t.handbook={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("handbook/JiNengHandBook")},e}(View);t.JiNengHandBookUI=e}(e=t.handbook||(t.handbook={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("handbook/LeDouHandBook")},e}(View);t.LeDouHandBookUI=e}(e=t.handbook||(t.handbook={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("handbook/LeDouItem")},e}(View);t.LeDouItemUI=e}(e=t.handbook||(t.handbook={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this);
}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("handbook/LiLianHandBook")},e}(View);t.LiLianHandBookUI=e}(e=t.handbook||(t.handbook={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("handbook/WuQiHandBook")},e}(View);t.WuQiHandBookUI=e}(e=t.handbook||(t.handbook={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("handbook/WuqiItem")},e}(View);t.WuqiItemUI=e}(e=t.handbook||(t.handbook={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.hangup.BagItemUI",t.hangup.BagItemUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("hangup/Bag")},i}(View);e.BagUI=i}(e=t.hangup||(t.hangup={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("hangup/BagItem")},e}(View);t.BagItemUI=e}(e=t.hangup||(t.hangup={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.hangup.DivineTroopsItemUI",t.hangup.DivineTroopsItemUI),e.prototype.createChildren.call(this),this.loadUI("hangup/DivineTroops")},i}(View);e.DivineTroopsUI=i}(e=t.hangup||(t.hangup={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("HTMLDivElement",laya.html.dom.HTMLDivElement),View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("hangup/DivineTroopsItem")},e}(View);t.DivineTroopsItemUI=e}(e=t.hangup||(t.hangup={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("hangup/Equip")},e}(View);t.EquipUI=e}(e=t.hangup||(t.hangup={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("hangup/Hangup")},e}(View);t.HangupUI=e}(e=t.hangup||(t.hangup={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopMiddleUI",t.comp.PopMiddleUI),e.prototype.createChildren.call(this),this.loadUI("hangup/HangupGiftBox")},i}(View);e.HangupGiftBoxUI=i}(e=t.hangup||(t.hangup={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("hangup/HangupGiftBoxItem")},e}(View);t.HangupGiftBoxItemUI=e}(e=t.hangup||(t.hangup={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("hangup/HangupScene")},e}(View);t.HangupSceneUI=e}(e=t.hangup||(t.hangup={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("hangup/Result")},e}(View);t.ResultUI=e}(e=t.hangup||(t.hangup={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("hangup/RewardItem")},e}(View);t.RewardItemUI=e}(e=t.hangup||(t.hangup={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("hangup/Tips")},e}(View);t.TipsUI=e}(e=t.hangup||(t.hangup={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("hangup/Upgrade")},e}(View);t.UpgradeUI=e}(e=t.hangup||(t.hangup={}))}(ui||(ui={}));var ui;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("HpUI")},e}(View);t.HpUIUI=e}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("hf.FriendShowFrame",hf.FriendShowFrame),t.prototype.createChildren.call(this),this.loadUI("lilian/BossItem")},e}(View);t.BossItemUI=e}(e=t.lilian||(t.lilian={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("hf.BuffIcons",hf.BuffIcons),t.prototype.createChildren.call(this),this.loadUI("lilian/Copy")},e}(View);t.CopyUI=e}(e=t.lilian||(t.lilian={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("lilian/LevelOp")},e}(View);t.LevelOpUI=e}(e=t.lilian||(t.lilian={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("lilian/Map")},e}(View);t.MapUI=e}(e=t.lilian||(t.lilian={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("lilian/Sweep")},e}(View);t.SweepUI=e}(e=t.lilian||(t.lilian={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("mail/Mail")},i}(View);e.MailUI=i}(e=t.mail||(t.mail={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("mail/MailItem")},e}(View);t.MailItemUI=e}(e=t.mail||(t.mail={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("mail/MailRewardItem")},e}(View);t.MailRewardItemUI=e}(e=t.mail||(t.mail={}))}(ui||(ui={}));var ui;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.PlayerInfo_mainUI",t.PlayerInfo_mainUI),View.regComponent("HTMLDivElement",laya.html.dom.HTMLDivElement),e.prototype.createChildren.call(this),this.loadUI("Main")},i}(View);t.MainUI=e}(ui||(ui={}));var ui;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.PlayerInfoUI",t.PlayerInfoUI),View.regComponent("HTMLDivElement",laya.html.dom.HTMLDivElement),e.prototype.createChildren.call(this),this.loadUI("Main_copy")},i}(View);t.Main_copyUI=e}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.marry.PlayerHeadUI",t.marry.PlayerHeadUI),e.prototype.createChildren.call(this),this.loadUI("marry/item/BeiQiuHunItem")},i}(View);e.BeiQiuHunItemUI=i}(i=e.item||(e.item={}))}(e=t.marry||(t.marry={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.marry.PlayerHeadUI",t.marry.PlayerHeadUI),e.prototype.createChildren.call(this),this.loadUI("marry/item/HunLiItem")},i}(View);e.HunLiItemUI=i}(i=e.item||(e.item={}))}(e=t.marry||(t.marry={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.marry.PlayerHeadUI",t.marry.PlayerHeadUI),e.prototype.createChildren.call(this),this.loadUI("marry/item/QiuHunItem")},i}(View);e.QiuHunItemUI=i}(i=e.item||(e.item={}))}(e=t.marry||(t.marry={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("HTMLDivElement",laya.html.dom.HTMLDivElement),t.prototype.createChildren.call(this),this.loadUI("marry/item/TitleItem")},e}(View);t.TitleItemUI=e}(e=t.item||(t.item={}))}(e=t.marry||(t.marry={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("marry/MarryMain")},e}(View);t.MarryMainUI=e}(e=t.marry||(t.marry={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.marry.PlayerHeadUI",t.marry.PlayerHeadUI),e.prototype.createChildren.call(this),this.loadUI("marry/Marry_88")},i}(View);e.Marry_88UI=i}(e=t.marry||(t.marry={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.marry.PlayerHeadUI",t.marry.PlayerHeadUI),View.regComponent("Text",laya.display.Text),View.regComponent("HTMLDivElement",laya.html.dom.HTMLDivElement),e.prototype.createChildren.call(this),this.loadUI("marry/MyMarrySub")},i}(View);e.MyMarrySubUI=i}(e=t.marry||(t.marry={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("marry/PlayerHead")},e}(View);t.PlayerHeadUI=e}(e=t.marry||(t.marry={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.marry.PlayerHeadUI",t.marry.PlayerHeadUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("marry/QiuHun")},i}(View);e.QiuHunUI=i}(e=t.marry||(t.marry={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("marry/RuleMarrySub")},e}(View);t.RuleMarrySubUI=e}(e=t.marry||(t.marry={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("marry/SongHua")},e}(View);t.SongHuaUI=e}(e=t.marry||(t.marry={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("marry/TitleMarrySub")},e}(View);t.TitleMarrySubUI=e}(e=t.marry||(t.marry={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("master/MasterApply")},i}(View);e.MasterApplyUI=i}(e=t.master||(t.master={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("master/MasterApplyItem")},e}(View);t.MasterApplyItemUI=e}(e=t.master||(t.master={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("master/MasterInfo")},e}(View);t.MasterInfoUI=e}(e=t.master||(t.master={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("hf.MasterLilianItem",hf.MasterLilianItem),t.prototype.createChildren.call(this),this.loadUI("master/MasterLilian")},e}(View);t.MasterLilianUI=e}(e=t.master||(t.master={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("master/MasterLilianItem")},e}(View);t.MasterLilianItemUI=e}(e=t.master||(t.master={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("master/MasterNotice")},e}(View);t.MasterNoticeUI=e}(e=t.master||(t.master={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("master/MasterPupilView")},e}(View);t.MasterPupilViewUI=e}(e=t.master||(t.master={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("master/MasterRecruit")},i}(View);e.MasterRecruitUI=i}(e=t.master||(t.master={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.PlayerInfoUI",t.PlayerInfoUI),e.prototype.createChildren.call(this),this.loadUI("master/MasterRecruitItem")},i}(View);e.MasterRecruitItemUI=i}(e=t.master||(t.master={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("master/MasterShowMonster")},e}(View);t.MasterShowMonsterUI=e}(e=t.master||(t.master={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("hf.MasterTaskItem",hf.MasterTaskItem),e.prototype.createChildren.call(this),this.loadUI("master/MasterTask")},i}(View);e.MasterTaskUI=i}(e=t.master||(t.master={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("master/MasterTaskItem")},e}(View);t.MasterTaskItemUI=e}(e=t.master||(t.master={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("master/MasterTreasureBox")},e}(View);t.MasterTreasureBoxUI=e}(e=t.master||(t.master={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.master.MasterTreasureBoxUI",t.master.MasterTreasureBoxUI),View.regComponent("hf.MasterInfo",hf.MasterInfo),View.regComponent("hf.PupilInfo",hf.PupilInfo),e.prototype.createChildren.call(this),this.loadUI("master/MasterView")},i}(View);e.MasterViewUI=i}(e=t.master||(t.master={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("master/PupilInfo")},e}(View);t.PupilInfoUI=e}(e=t.master||(t.master={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("master/SearchMasterBox")},e}(View);t.SearchMasterBoxUI=e}(e=t.master||(t.master={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.monster.MonsterAttItemUI",t.monster.MonsterAttItemUI),View.regComponent("hf.MonsterHead",hf.MonsterHead),View.regComponent("hf.MonsterSkillPanel",hf.MonsterSkillPanel),View.regComponent("hf.MonsterTabView",hf.MonsterTabView),e.prototype.createChildren.call(this),this.loadUI("monster/Monster")},i}(View);e.MonsterUI=i}(e=t.monster||(t.monster={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("monster/MonsterAttItem")},e}(View);t.MonsterAttItemUI=e}(e=t.monster||(t.monster={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("monster/MonsterBall")},e}(View);t.MonsterBallUI=e}(e=t.monster||(t.monster={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("HTMLDivElement",laya.html.dom.HTMLDivElement),View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("monster/MonsterEquipSkill")},e}(View);t.MonsterEquipSkillUI=e}(e=t.monster||(t.monster={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("hf.MonsterBall",hf.MonsterBall),t.prototype.createChildren.call(this),this.loadUI("monster/MonsterFengWord")},e}(View);t.MonsterFengWordUI=e}(e=t.monster||(t.monster={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("hf.MonsterBall",hf.MonsterBall),t.prototype.createChildren.call(this),this.loadUI("monster/MonsterGuiWord")},e}(View);t.MonsterGuiWordUI=e}(e=t.monster||(t.monster={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("monster/MonsterHead")},e}(View);t.MonsterHeadUI=e}(e=t.monster||(t.monster={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("hf.MonsterHolyItem",hf.MonsterHolyItem),t.prototype.createChildren.call(this),this.loadUI("monster/MonsterHoly")},e}(View);t.MonsterHolyUI=e}(e=t.monster||(t.monster={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("monster/MonsterHolyItem")},e}(View);t.MonsterHolyItemUI=e}(e=t.monster||(t.monster={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("hf.MonsterBall",hf.MonsterBall),t.prototype.createChildren.call(this),this.loadUI("monster/MonsterHuWord")},e}(View);t.MonsterHuWordUI=e}(e=t.monster||(t.monster={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("hf.MonsterBall",hf.MonsterBall),t.prototype.createChildren.call(this),this.loadUI("monster/MonsterLongWord")},e}(View);t.MonsterLongWordUI=e}(e=t.monster||(t.monster={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),View.regComponent("ui.monster.MonsterAttItemUI",t.monster.MonsterAttItemUI),View.regComponent("hf.MonsterLookUpTabView",hf.MonsterLookUpTabView),View.regComponent("hf.MonsterHead",hf.MonsterHead),e.prototype.createChildren.call(this),this.loadUI("monster/MonsterLookUp")},i}(View);e.MonsterLookUpUI=i}(e=t.monster||(t.monster={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("hf.MonsterHoly",hf.MonsterHoly),View.regComponent("hf.MonsterPotential",hf.MonsterPotential),View.regComponent("hf.MonsterStunt",hf.MonsterStunt),View.regComponent("hf.MonsterEquipSkill",hf.MonsterEquipSkill),t.prototype.createChildren.call(this),this.loadUI("monster/MonsterLookUpTab")},e}(View);t.MonsterLookUpTabUI=e}(e=t.monster||(t.monster={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.monster.MonsterLongWordUI",t.monster.MonsterLongWordUI),View.regComponent("ui.monster.MonsterHuWordUI",t.monster.MonsterHuWordUI),View.regComponent("ui.monster.MonsterGuiWordUI",t.monster.MonsterGuiWordUI),View.regComponent("ui.monster.MonsterFengWordUI",t.monster.MonsterFengWordUI),e.prototype.createChildren.call(this),this.loadUI("monster/MonsterPotential")},i}(View);e.MonsterPotentialUI=i}(e=t.monster||(t.monster={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("monster/MonsterSelectSkill")},e}(View);t.MonsterSelectSkillUI=e}(e=t.monster||(t.monster={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("monster/MonsterSkillItem")},e}(View);t.MonsterSkillItemUI=e}(e=t.monster||(t.monster={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("HTMLDivElement",laya.html.dom.HTMLDivElement),t.prototype.createChildren.call(this),this.loadUI("monster/MonsterStunt")},e}(View);t.MonsterStuntUI=e}(e=t.monster||(t.monster={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("hf.MonsterPotential",hf.MonsterPotential),View.regComponent("hf.MonsterEquipSkill",hf.MonsterEquipSkill),View.regComponent("hf.MonsterHoly",hf.MonsterHoly),View.regComponent("hf.MonsterStunt",hf.MonsterStunt),t.prototype.createChildren.call(this),this.loadUI("monster/MonsterTab")},e}(View);t.MonsterTabUI=e}(e=t.monster||(t.monster={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("hf.MusicMasterReward",hf.MusicMasterReward),t.prototype.createChildren.call(this),this.loadUI("musicmaster/MusicMaster")},e}(View);t.MusicMasterUI=e}(e=t.musicmaster||(t.musicmaster={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("musicmaster/MusicMasterReward")},e}(View);t.MusicMasterRewardUI=e}(e=t.musicmaster||(t.musicmaster={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.national.CollectItemUI",t.national.CollectItemUI),e.prototype.createChildren.call(this),this.loadUI("national/CollectBox")},i}(View);e.CollectBoxUI=i}(e=t.national||(t.national={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("national/CollectItem")},e}(View);t.CollectItemUI=e}(e=t.national||(t.national={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("national/DoubleJoyBox")},e}(View);t.DoubleJoyBoxUI=e}(e=t.national||(t.national={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("national/FirstEnterPngBox")},e}(View);t.FirstEnterPngBoxUI=e}(e=t.national||(t.national={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("national/NationalLoginGift")},e}(View);t.NationalLoginGiftUI=e}(e=t.national||(t.national={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("national/NationalLoginGiftItem")},e}(View);t.NationalLoginGiftItemUI=e}(e=t.national||(t.national={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("national/NationalPlanBox")},e}(View);t.NationalPlanBoxUI=e}(e=t.national||(t.national={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("national/NationalPlanItem")},e}(View);t.NationalPlanItemUI=e}(e=t.national||(t.national={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("national/NationalScene")},e}(View);t.NationalSceneUI=e}(e=t.national||(t.national={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("national/NationalWinshop")},e}(View);t.NationalWinshopUI=e}(e=t.national||(t.national={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("national/NationalWinShopGoodsItem")},e}(View);t.NationalWinShopGoodsItemUI=e}(e=t.national||(t.national={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("national/PlayBallBox")},e}(View);t.PlayBallBoxUI=e}(e=t.national||(t.national={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("national/PopConfirm")},e}(View);t.PopConfirmUI=e}(e=t.national||(t.national={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("net/NetBox")},e}(View);t.NetBoxUI=e}(e=t.net||(t.net={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),
this.loadUI("net/NetItem")},e}(View);t.NetItemUI=e}(e=t.net||(t.net={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("net/Plan")},e}(View);t.PlanUI=e}(e=t.net||(t.net={}))}(ui||(ui={}));var ui;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("Number")},e}(View);t.NumberUI=e}(ui||(ui={}));var ui;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("PlayerInfo")},e}(View);t.PlayerInfoUI=e}(ui||(ui={}));var ui;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("PlayerInfo_main")},e}(View);t.PlayerInfo_mainUI=e}(ui||(ui={}));var ui;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.createView(t.ProgressUI.uiView)},i.uiView={type:"View",props:{width:1334,height:750},child:[{type:"Label",props:{y:390,x:403,wordWrap:!0,width:528,"var":"contentTxt",text:"正在加载（经脉）相关资源...",strokeColor:"#000000",stroke:4,skin:"ui/comp/label.png",height:31,fontSize:24,color:"#ffffff",bold:!0,align:"center"}},{type:"Label",props:{y:340,x:250,width:834,"var":"percentTxt",text:"65%",strokeColor:"#000000",stroke:4,skin:"ui/comp/label.png",height:32,fontSize:22,color:"#ffffff",bold:!0,align:"center"}},{type:"Image",props:{y:367,x:400,width:535,skin:"ui/beforeEnterGameLoading/progressBg.png",sizeGrid:"0,25,0,25"}},{type:"ProgressBar",props:{y:370,x:402,width:530,"var":"progressBar",value:1,skin:"ui/beforeEnterGameLoading/progress_frameBar.png",sizeGrid:"0,6,0,6",height:14}}]},i}(View);t.ProgressUI=e}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("rank/Rank")},i}(View);e.RankUI=i}(e=t.rank||(t.rank={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("rank/RankItem")},e}(View);t.RankItemUI=e}(e=t.rank||(t.rank={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("rank/RankMenuItem")},e}(View);t.RankMenuItemUI=e}(e=t.rank||(t.rank={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.rebate.RebateItemUI",t.rebate.RebateItemUI),e.prototype.createChildren.call(this),this.loadUI("rebate/Rebate")},i}(View);e.RebateUI=i}(e=t.rebate||(t.rebate={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("rebate/RebateItem")},e}(View);t.RebateItemUI=e}(e=t.rebate||(t.rebate={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("ui.recall.RecallPrivilegeTabUI",t.recall.RecallPrivilegeTabUI),View.regComponent("ui.recall.RecallGiftTabUI",t.recall.RecallGiftTabUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("recall/RecallGift")},i}(View);e.RecallGiftUI=i}(e=t.recall||(t.recall={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("recall/RecallGiftItem")},e}(View);t.RecallGiftItemUI=e}(e=t.recall||(t.recall={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("hf.RecallGift",hf.RecallGift),t.prototype.createChildren.call(this),this.loadUI("recall/RecallGiftTab")},e}(View);t.RecallGiftTabUI=e}(e=t.recall||(t.recall={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("recall/RecallGoodsItem")},e}(View);t.RecallGoodsItemUI=e}(e=t.recall||(t.recall={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("hf.RecallGoods",hf.RecallGoods),t.prototype.createChildren.call(this),this.loadUI("recall/RecallPrivilegeTab")},e}(View);t.RecallPrivilegeTabUI=e}(e=t.recall||(t.recall={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.friend.CommonMaskUI",t.friend.CommonMaskUI),View.regComponent("ui.comp.PopBigUI",t.comp.PopBigUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("result/FightTest")},i}(View);e.FightTestUI=i}(e=t.result||(t.result={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("result/ResultGiftItem")},e}(View);t.ResultGiftItemUI=e}(e=t.result||(t.result={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("result/ResultGoodItem")},e}(View);t.ResultGoodItemUI=e}(e=t.result||(t.result={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("schoolOpen2017/Arrive100Score")},e}(View);t.Arrive100ScoreUI=e}(e=t.schoolOpen2017||(t.schoolOpen2017={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("schoolOpen2017/Buy")},e}(View);t.BuyUI=e}(e=t.schoolOpen2017||(t.schoolOpen2017={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("schoolOpen2017/ClassTableBox")},e}(View);t.ClassTableBoxUI=e}(e=t.schoolOpen2017||(t.schoolOpen2017={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("schoolOpen2017/ClassTableItem")},e}(View);t.ClassTableItemUI=e}(e=t.schoolOpen2017||(t.schoolOpen2017={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("schoolOpen2017/Day7GiftBox")},e}(View);t.Day7GiftBoxUI=e}(e=t.schoolOpen2017||(t.schoolOpen2017={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("schoolOpen2017/Day7GiftItem")},e}(View);t.Day7GiftItemUI=e}(e=t.schoolOpen2017||(t.schoolOpen2017={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("schoolOpen2017/FirstEnterPngBox")},e}(View);t.FirstEnterPngBoxUI=e}(e=t.schoolOpen2017||(t.schoolOpen2017={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.schoolOpen2017.PettyStoreItemUI",t.schoolOpen2017.PettyStoreItemUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("schoolOpen2017/PettyStoreBox")},i}(View);e.PettyStoreBoxUI=i}(e=t.schoolOpen2017||(t.schoolOpen2017={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("schoolOpen2017/PettyStoreItem")},e}(View);t.PettyStoreItemUI=e}(e=t.schoolOpen2017||(t.schoolOpen2017={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("schoolOpen2017/SchoolMateListBox")},e}(View);t.SchoolMateListBoxUI=e}(e=t.schoolOpen2017||(t.schoolOpen2017={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.PlayerInfoUI",t.PlayerInfoUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("schoolOpen2017/SchoolMateListItem")},i}(View);e.SchoolMateListItemUI=i}(e=t.schoolOpen2017||(t.schoolOpen2017={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("schoolOpen2017/SchoolOpen2017Scene")},e}(View);t.SchoolOpen2017SceneUI=e}(e=t.schoolOpen2017||(t.schoolOpen2017={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("schoolOpen2017/ShootArrowBox")},e}(View);t.ShootArrowBoxUI=e}(e=t.schoolOpen2017||(t.schoolOpen2017={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("schoolOpen2017/VipSchoolOpenBox")},e}(View);t.VipSchoolOpenBoxUI=e}(e=t.schoolOpen2017||(t.schoolOpen2017={}))}(ui||(ui={}));var ui;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("Screen")},e}(View);t.ScreenUI=e}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopMiddleUI",t.comp.PopMiddleUI),View.regComponent("Text",laya.display.Text),View.regComponent("ui.servent.CaffItemUI",t.servent.CaffItemUI),e.prototype.createChildren.call(this),this.loadUI("servent/Caff")},i}(View);e.CaffUI=i}(e=t.servent||(t.servent={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("servent/CaffItem")},e}(View);t.CaffItemUI=e}(e=t.servent||(t.servent={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),View.regComponent("ui.servent.HelpItemUI",t.servent.HelpItemUI),e.prototype.createChildren.call(this),this.loadUI("servent/Help")},i}(View);e.HelpUI=i}(e=t.servent||(t.servent={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("servent/HelpItem")},e}(View);t.HelpItemUI=e}(e=t.servent||(t.servent={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("servent/Info")},e}(View);t.InfoUI=e}(e=t.servent||(t.servent={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.servent.JxItemUI",t.servent.JxItemUI),e.prototype.createChildren.call(this),this.loadUI("servent/Jx")},i}(View);e.JxUI=i}(e=t.servent||(t.servent={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("servent/JxItem")},e}(View);t.JxItemUI=e}(e=t.servent||(t.servent={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.servent.RoleBoxUI",t.servent.RoleBoxUI),View.regComponent("ui.servent.RaceUI",t.servent.RaceUI),e.prototype.createChildren.call(this),this.loadUI("servent/Main")},i}(View);e.MainUI=i}(e=t.servent||(t.servent={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.servent.MsgItemUI",t.servent.MsgItemUI),e.prototype.createChildren.call(this),this.loadUI("servent/Msg")},i}(View);e.MsgUI=i}(e=t.servent||(t.servent={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("servent/MsgItem")},e}(View);t.MsgItemUI=e}(e=t.servent||(t.servent={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.servent.OpItemUI",t.servent.OpItemUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("servent/Op")},i}(View);e.OpUI=i}(e=t.servent||(t.servent={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("servent/OpItem")},e}(View);t.OpItemUI=e}(e=t.servent||(t.servent={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("HTMLDivElement",laya.html.dom.HTMLDivElement),t.prototype.createChildren.call(this),this.loadUI("servent/Race")},e}(View);t.RaceUI=e}(e=t.servent||(t.servent={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),View.regComponent("ui.servent.RankItemUI",t.servent.RankItemUI),e.prototype.createChildren.call(this),this.loadUI("servent/Rank")},i}(View);e.RankUI=i}(e=t.servent||(t.servent={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("servent/RankItem")},e}(View);t.RankItemUI=e}(e=t.servent||(t.servent={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopMiddleUI",t.comp.PopMiddleUI),View.regComponent("ui.servent.RobItemUI",t.servent.RobItemUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("servent/Rob")},i}(View);e.RobUI=i}(e=t.servent||(t.servent={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("servent/RobItem")},e}(View);t.RobItemUI=e}(e=t.servent||(t.servent={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("servent/RoleBox")},e}(View);t.RoleBoxUI=e}(e=t.servent||(t.servent={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("servent/SelfInfo")},e}(View);t.SelfInfoUI=e}(e=t.servent||(t.servent={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("set/ExchangeCode")},e}(View);t.ExchangeCodeUI=e}(e=t.set||(t.set={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopTinyUI",t.comp.PopTinyUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("set/RetrenchModeSet")},i}(View);e.RetrenchModeSetUI=i}(e=t.set||(t.set={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopTinyUI",t.comp.PopTinyUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("set/Set")},i}(View);e.SetUI=i}(e=t.set||(t.set={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("share/Share")},e}(View);t.ShareUI=e}(e=t.share||(t.share={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("share/ShareAlert")},e}(View);t.ShareAlertUI=e}(e=t.share||(t.share={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("share/ShareFriend")},i}(View);e.ShareFriendUI=i}(e=t.share||(t.share={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("share/ShareFriendItem")},e}(View);t.ShareFriendItemUI=e}(e=t.share||(t.share={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("share/ShareLilian")},e}(View);t.ShareLilianUI=e}(e=t.share||(t.share={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("share/ShareSQ")},e}(View);t.ShareSQUI=e}(e=t.share||(t.share={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("share/ShareWB")},e}(View);t.ShareWBUI=e}(e=t.share||(t.share={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),e.prototype.createChildren.call(this),this.loadUI("share/ShareWeixin")},i}(View);e.ShareWeixinUI=i}(e=t.share||(t.share={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("share/WbGift")},e}(View);t.WbGiftUI=e}(e=t.share||(t.share={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("shop/Buy")},e}(View);t.BuyUI=e}(e=t.shop||(t.shop={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopMiddleUI",t.comp.PopMiddleUI),e.prototype.createChildren.call(this),this.loadUI("shop/BuyUse")},i}(View);e.BuyUseUI=i}(e=t.shop||(t.shop={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("shop/GetGoodsItem")},e}(View);t.GetGoodsItemUI=e}(e=t.shop||(t.shop={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("shop/Shop")},e}(View);t.ShopUI=e}(e=t.shop||(t.shop={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("shop/ShopGoodsItem")},e}(View);t.ShopGoodsItemUI=e}(e=t.shop||(t.shop={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("shop/WinShop")},e}(View);t.WinShopUI=e}(e=t.shop||(t.shop={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("shop/WinShopGoodsItem")},e}(View);t.WinShopGoodsItemUI=e}(e=t.shop||(t.shop={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("sign/Gift_Item")},e}(View);t.Gift_ItemUI=e}(e=t.sign||(t.sign={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("ui.sign.NextLoginRewardItemUI",t.sign.NextLoginRewardItemUI),e.prototype.createChildren.call(this),this.loadUI("sign/NextLoginReward")},i}(View);e.NextLoginRewardUI=i}(e=t.sign||(t.sign={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("sign/NextLoginRewardItem")},e}(View);t.NextLoginRewardItemUI=e}(e=t.sign||(t.sign={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("sign/Sign")},e}(View);t.SignUI=e}(e=t.sign||(t.sign={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("sign/SignItem")},e}(View);t.SignItemUI=e}(e=t.sign||(t.sign={}))}(ui||(ui={}));var ui;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("Sleep")},e}(View);t.SleepUI=e}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("strength/StrengItem")},e}(View);t.StrengItemUI=e}(e=t.strength||(t.strength={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("strength/StrengthBox")},i}(View);e.StrengthBoxUI=i}(e=t.strength||(t.strength={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("subscription/Subscription")},i}(View);e.SubscriptionUI=i}(e=t.subscription||(t.subscription={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("talk/FactionTalk")},e}(View);t.FactionTalkUI=e}(e=t.talk||(t.talk={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.PlayerInfoUI",t.PlayerInfoUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("talk/FactionTalkItem")},i}(View);e.FactionTalkItemUI=i}(e=t.talk||(t.talk={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),View.regComponent("ui.task.TaskDailyItemUI",t.task.TaskDailyItemUI),View.regComponent("ui.task.TaskMasterItemUI",t.task.TaskMasterItemUI),e.prototype.createChildren.call(this),this.loadUI("task/Task")},i}(View);e.TaskUI=i}(e=t.task||(t.task={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("task/TaskDailyItem")},e}(View);t.TaskDailyItemUI=e}(e=t.task||(t.task={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("task/TaskMasterGiftItem")},e}(View);t.TaskMasterGiftItemUI=e}(e=t.task||(t.task={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("task/TaskMasterItem")},e}(View);t.TaskMasterItemUI=e}(e=t.task||(t.task={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("hf.FriendShowFrame",hf.FriendShowFrame),View.regComponent("hf.MonsterItem",hf.MonsterItem),View.regComponent("Text",laya.display.Text),View.regComponent("hf.BuffIcons",hf.BuffIcons),View.regComponent("HTMLDivElement",laya.html.dom.HTMLDivElement),t.prototype.createChildren.call(this),this.loadUI("tower/Tower")},e}(View);t.TowerUI=e}(e=t.tower||(t.tower={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("tower/TowerAward")},e}(View);t.TowerAwardUI=e}(e=t.tower||(t.tower={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("tower/TowerBuffItem")},e}(View);t.TowerBuffItemUI=e}(e=t.tower||(t.tower={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("tower/TowerMonsterItem")},e}(View);t.TowerMonsterItemUI=e}(e=t.tower||(t.tower={}))}(ui||(ui={}));
var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopMiddleUI",t.comp.PopMiddleUI),View.regComponent("hf.TowerBuffItem",hf.TowerBuffItem),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("tower/TowerMyStatus")},i}(View);e.TowerMyStatusUI=i}(e=t.tower||(t.tower={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("upgrade/ReplaceItem")},e}(View);t.ReplaceItemUI=e}(e=t.upgrade||(t.upgrade={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),View.regComponent("ui.upgrade.UpgradeListItemUI",t.upgrade.UpgradeListItemUI),View.regComponent("ui.upgrade.ReplaceItemUI",t.upgrade.ReplaceItemUI),e.prototype.createChildren.call(this),this.loadUI("upgrade/UpgradeList")},i}(View);e.UpgradeListUI=i}(e=t.upgrade||(t.upgrade={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("upgrade/UpgradeListItem")},e}(View);t.UpgradeListItemUI=e}(e=t.upgrade||(t.upgrade={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopMiddleUI",t.comp.PopMiddleUI),e.prototype.createChildren.call(this),this.loadUI("upgrade/UpgradeOp")},i}(View);e.UpgradeOpUI=i}(e=t.upgrade||(t.upgrade={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("upgrade/UpgradePopup")},e}(View);t.UpgradePopupUI=e}(e=t.upgrade||(t.upgrade={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("user/AddPoint")},e}(View);t.AddPointUI=e}(e=t.user||(t.user={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("user/AddPointKuang")},e}(View);t.AddPointKuangUI=e}(e=t.user||(t.user={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("user/InfoPanel")},i}(View);e.InfoPanelUI=i}(e=t.user||(t.user={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("user/User")},i}(View);e.UserUI=i}(e=t.user||(t.user={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("user/WeaponItem")},e}(View);t.WeaponItemUI=e}(e=t.user||(t.user={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("vip/ChongZhiBox")},e}(View);t.ChongZhiBoxUI=e}(e=t.vip||(t.vip={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("vip/ChongzhiItem")},e}(View);t.ChongzhiItemUI=e}(e=t.vip||(t.vip={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("vip/GiftBuyItem")},e}(View);t.GiftBuyItemUI=e}(e=t.vip||(t.vip={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("vip/GiftBuyItemIcon")},e}(View);t.GiftBuyItemIconUI=e}(e=t.vip||(t.vip={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),View.regComponent("HTMLDivElement",laya.html.dom.HTMLDivElement),t.prototype.createChildren.call(this),this.loadUI("vip/Vip")},e}(View);t.VipUI=e}(e=t.vip||(t.vip={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("vip/VipGift")},e}(View);t.VipGiftUI=e}(e=t.vip||(t.vip={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("vip/VipItem")},e}(View);t.VipItemUI=e}(e=t.vip||(t.vip={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.comp.PopSmallUI",t.comp.PopSmallUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("wulin/WuLin")},i}(View);e.WuLinUI=i}(e=t.wulin||(t.wulin={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("wulin/WuLinChampion")},e}(View);t.WuLinChampionUI=e}(e=t.wulin||(t.wulin={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.wulin.WuLinLineUI",t.wulin.WuLinLineUI),View.regComponent("ui.wulin.WuLinLine1UI",t.wulin.WuLinLine1UI),View.regComponent("ui.wulin.WuLinPlayerUI",t.wulin.WuLinPlayerUI),View.regComponent("Text",laya.display.Text),View.regComponent("ui.wulin.WuLinChampionUI",t.wulin.WuLinChampionUI),e.prototype.createChildren.call(this),this.loadUI("wulin/WuLinCourse")},i}(View);e.WuLinCourseUI=i}(e=t.wulin||(t.wulin={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("wulin/WuLinItem")},e}(View);t.WuLinItemUI=e}(e=t.wulin||(t.wulin={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("wulin/WuLinLine")},e}(View);t.WuLinLineUI=e}(e=t.wulin||(t.wulin={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadUI("wulin/WuLinLine1")},e}(View);t.WuLinLine1UI=e}(e=t.wulin||(t.wulin={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("wulin/WuLinListItem")},e}(View);t.WuLinListItemUI=e}(e=t.wulin||(t.wulin={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("wulin/WuLinMine")},e}(View);t.WuLinMineUI=e}(e=t.wulin||(t.wulin={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("wulin/WuLinPlayer")},e}(View);t.WuLinPlayerUI=e}(e=t.wulin||(t.wulin={}))}(ui||(ui={}));var ui;!function(t){var e;!function(e){var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.createChildren=function(){View.regComponent("ui.friend.CommonMaskUI",t.friend.CommonMaskUI),View.regComponent("ui.comp.MiniBoxUI",t.comp.MiniBoxUI),View.regComponent("Text",laya.display.Text),e.prototype.createChildren.call(this),this.loadUI("wulin/WuLinRule")},i}(View);e.WuLinRuleUI=i}(e=t.wulin||(t.wulin={}))}(ui||(ui={}));var ui;!function(t){var e;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.createChildren=function(){View.regComponent("Text",laya.display.Text),t.prototype.createChildren.call(this),this.loadUI("wulin/WuLinSignUp")},e}(View);t.WuLinSignUpUI=e}(e=t.wulin||(t.wulin={}))}(ui||(ui={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.on(Laya.Event.CLICK,this,this.onClick)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),t.removeListener(t.BuffView.BUFFVIEW_UPDATE_BUFF,this,this.onStatuInfo),t.removeListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.updateBuffs),t.removeListener(i.BUFF_ICONS_UPDATE,this,this.updateBuffs)},i.prototype.updateBuffs=function(){t.addListener(t.BuffView.BUFFVIEW_UPDATE_BUFF,this,this.onStatuInfo),t.addListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.updateBuffs),t.addListener(i.BUFF_ICONS_UPDATE,this,this.updateBuffs),t.XHR().Post({cmd:"detail",op:"status",needreload:"1"},this,this.onStatuInfo)},i.prototype.onClick=function(){t.Facade.callCommand(new t.BuffCommand),t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.CLICK_TOWER,"buff"))},i.prototype.onStatuInfo=function(e){if(0==e.result){if(this&&!this.destroyed){var i=e.status_info.filter(this.arrFilter);i.sort(this.sortCompare),this.updateMineBuff(i)}}else t.WeakTips.show("状态信息获取失败，"+e.msg)},i.prototype.updateMineBuff=function(e){for(var i=0;5>i;i++)if(e[i])switch(this["myBuff"+i].graphics.clear(),this["myBuff"+i].loadImage(t.ResPath().getPic(e[i].id+"",t.ResourcePath.PATH_MINE_BUFF),0,0,40,40),this["myBuff"+i].filters=t.FiltersUtils.getGreyFilters(),e[i].lv>0?this["myBuff"+i].filters=null:this["myBuff"+i].filters=t.FiltersUtils.getGreyFilters(),e[i].type){case 2:this["myBuffTxt"+i].text=e[i].lv+"";break;default:this["myBuffTxt"+i].text=""}},i.prototype.sortCompare=function(t,e){var i=t.sortid,s=e.sortid;return i>s?1:s>i?-1:0},i.prototype.arrFilter=function(t){return t.shop_id>0||1==t.has},i.BUFF_ICONS_UPDATE="BUFF_ICONS_UPDATE",i}(ui.common.BuffIconsUI);t.BuffIcons=e}(hf||(hf={}));var hf;!function(t){var e=function(){function e(){}return e.prototype.getPluginName=function(){return t.Logger.log("[APF]","Plugin未处理getPluginName()函数"),"Plugin"},e.prototype.hasPlugin=function(e){return t.Facade.singleton.hasPlugin(e)},e.prototype.retrievePlugin=function(e){return t.Facade.singleton.retrievePlugin(e)},e.prototype.unregisterPlugin=function(){return t.Facade.singleton.unregisterPlugin(this.getPluginName())},e.prototype.initialize=function(e){t.Logger.log("[APF]",this.getPluginName()+"未处理initialize()函数")},e.prototype.finalize=function(){t.Logger.log("[APF]",this.getPluginName()+"未处理finalize()函数")},e.prototype.callCommand=function(e){t.Facade.singleton.getCommandMgr().callCommand(e)},e.prototype.doCommand=function(t){},e.prototype.unregisterCommand=function(e){t.Facade.unregisterCommand(e)},e.prototype.retrieveModel=function(e){return t.Facade.singleton.model.retrieveModel(e)},e.prototype.hasModel=function(e){return t.Facade.singleton.model.hasModel(e)},e.prototype.registerModel=function(e){t.Facade.singleton.model.registerModel(e)},e.prototype.removeModel=function(e){t.Facade.singleton.model.removeModel(e)},e}();t.Plugin=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this._shareSource=[],this._beyondSource=[],this._attackPowerWillTo=0,this._loopCount=0}return __extends(i,e),i.prototype.initialize=function(e){this._syncExecuter=new t.SyncExecuter(this),this._showChangeRewardExecuter=new t.ShowChangeRewardExecuter,t.JSUtils.onAddWxShortStatus(this,this.onWeiXinShort),t.addListener(t.ShowRewardBoxNew.SHOW_REWARD_BOX_END,this,this.onRewardEnd),this._attackPowerWillTo=0},i.prototype.doCommand=function(e){switch(e.getCommandName()){case"SyncChangeCmd":this._syncExecuter.sync(e);break;case"DecodeDataCmd":this._syncExecuter.decodeData(e);break;case"RefreshRedStatusCmds":if(e.redArr){var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.ALL_STATUS_MODEL);i.updateData(e.redArr)}break;case"ShowChangeRewardCmd":var s=e;this._showChangeRewardExecuter.showChangeReward(s.rewardArr,s.deltaTime,s.color);break;case"OpenNoticeCommand":t.XHR().Post({file:"petpk",cmd:"notice",subcmd:"Get",uid:t.Global.UID},this,this.getNoticeHandler);break;case"RefreshUserInfoCmd":t.XHR().Post({file:"petpk",cmd:"index",lvlup:1,uid:t.Global.UID},this,this.getUserDataHandler);break;case"ShowLvUpBoxCmd":this.showLvUpBox(e.arr);break;case"ShowLvUpBookCmd":this.showLvUpBook(e);break;case"ShowUpAnimationCMD":this.showUpAnimation(e);break;case"ShowNetBoxCmd":this.showNetBox();break;case"OpenBeyondShareBoxCmd":this.loadBeyondShareBox(e.data);break;case"ShowStrengthChangeCmd":this.showStrengthChange(e.oldAttackPower,e.changeNum,e.newAttackPower);break;case"ShowRewardBoxCmd":var n=e;new t.ShowRewardBoxNew(n.rewardBoxMsg,n.rewardBoxArr,n.handler).show(t.Layer.LV_UP);break;case"SendWbGameBarCmd":this.sendWbGameBarMsg(e);break;case"ShowPopBoxCMD":this.showPopBox(e);break;case"CommonExchangeCmd":this.doExchange(e);break;case"OpenRechargeCmd":var a=new t.RechargeBox;a.show()}},i.prototype.showPopBox=function(e){var i=new t.PopBox(e._data,e.target);i.show()},i.prototype.sendWbGameBarMsg=function(e){t.XHR().Post({cmd:"share",touser:e.fuid,type:e.type,qua:t.JSUtils.getWBMaybeQua()},this,this.onSendWbGameBarMsg)},i.prototype.onSendWbGameBarMsg=function(){},i.prototype.onWeiXinShort=function(e){e&&t.XHR().Post({cmd:"addesk",subcmd:"AddDesk"},this,this.onAddBack)},i.prototype.onAddBack=function(e){0==e.result&&t.dispatch(t.CollectModule.COLLECT_WEIXIN_SHORT_CUT)},i.prototype.getUserDataHandler=function(e){if(0==e.result){var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL);i&&(i.setData(e),i.updateFinish())}},i.prototype.getNoticeHandler=function(e){0==e.result?(this._noticeBox=new t.NoticeBox(e.title,e.text),this._noticeBox.on(t.ViewEvent.BOX_HIDE,this,this.onHideNoticeBox),this._noticeBox.show()):t.WeakTips.show("拉取公告失败，"+e.msg)},i.prototype.onHideNoticeBox=function(){this._noticeBox.off(t.ViewEvent.BOX_HIDE,this,this.onHideNoticeBox),this._noticeBox=null,Laya.loader.clearRes("ui/notice/img_dadiban.png"),Laya.loader.clearRes("ui/notice/lineIcon.png"),t.dispatch(t.MainModule.OPENBOXEVENT),this.unregisterCommand(new t.OpenNoticeCommand(""))},i.prototype.showLvUpBox=function(e){for(var i=e.length-1;i>=0;i--){var s=new t.LvUpBox(e[i]);s.show(t.Layer.LV_UP),this.lvUpShare(e[i].level),t.LayerMgr.getLayer(t.Layer.GUIDE).alpha=0}},i.prototype.lvUpShare=function(e){t.FriendModule.getTranscendFriendList(e,this,this.lvShareDataCallBack)},i.prototype.lvShareDataCallBack=function(e){0==e.result&&(this._shareSource=[{url:"res/atlas/ui/lvupshare.json",type:Loader.ATLAS},{url:"ui/lvupshare/dadiban.jpg",type:Loader.IMAGE},{url:"ui/lvupshare/dadiban.jpg",type:Loader.IMAGE},{url:"assets/word/damage/damage.json",type:Loader.ATLAS}],Laya.loader.load(this._shareSource,new Handler(this,this.showLvShare,[e])),e.list.length>0&&t.Facade.callCommand(new t.SendWbGameBarCmd(e.list[0].uid,t.SendWbGameBarCmd.kSurpassLevel)))},i.prototype.showLvShare=function(e){var i=new t.LvUpShare(e.list);i.show(t.Layer.LV_UP),i.on(t.ViewEvent.BOX_HIDE,this,this.onHideLvShareBox)},i.prototype.showLvUpBook=function(e){var i=new t.LvUpBook(e);i.on(t.ViewEvent.BASE_DESTROY,this,this.lvUpBoxDestroy),i.show(t.Layer.LV_UP)},i.prototype.showUpAnimation=function(e){var i=new t.ShowUpAnimation(e);i.on(t.ViewEvent.BASE_DESTROY,this,this.upAnimationDestroy),i.show(t.Layer.LV_UP)},i.prototype.onHideLvShareBox=function(e){e.off(t.ViewEvent.BASE_DESTROY,this,this.onHideLvShareBox);for(var i=0;i<this._shareSource.length;i++)"assets/word/damage/damage.json"!=this._shareSource[i].url&&Laya.loader.clearRes(this._shareSource[i].url)},i.prototype.lvUpBoxDestroy=function(e){e.off(t.ViewEvent.BASE_DESTROY,this,this.lvUpBoxDestroy),t.BoxMgr.hasBoxShow("LvUpBox")||(t.LayerMgr.getLayer(t.Layer.GUIDE).alpha=1,Laya.loader.clearRes("ui/lvUp/img_dadi.png"))},i.prototype.upAnimationDestroy=function(e){e.off(t.ViewEvent.BASE_DESTROY,this,this.lvUpBoxDestroy),t.BoxMgr.hasBoxShow("LvUpBox")||(t.LayerMgr.getLayer(t.Layer.GUIDE).alpha=1,Laya.loader.clearRes("res/atlas/ui/upanimation.json"),Laya.loader.clearRes("res/atlas/ui/lvUp.json"),Laya.loader.clearRes("ui/upanimation/msg.png"))},i.prototype.showNetBox=function(){this._netBox||(this._netBox=new t.NetMsgBox,this._netBox.on(t.ViewEvent.BASE_DESTROY,this,this.netBoxDestroy),this._netBox.show(t.Layer.WEAK_TIP))},i.prototype.netBoxDestroy=function(){this._netBox&&(this._netBox.off(t.ViewEvent.BASE_DESTROY,this,this.netBoxDestroy),this._netBox=null)},i.prototype.loadBeyondShareBox=function(t){this._beyondSource=[{url:"res/atlas/ui/lvupshare.json",type:Loader.ATLAS},{url:"ui/lvupshare/dadiban2.jpg",type:Loader.IMAGE}],Laya.loader.load(this._beyondSource,new Handler(this,this.showBeyondShareBox,[t]))},i.prototype.showBeyondShareBox=function(e){var i=new t.BeyondShareBox(e);i.show(t.Layer.LV_UP),i.on(t.ViewEvent.BOX_HIDE,this,this.destroyBeyondShareBox)},i.prototype.destroyBeyondShareBox=function(e){e.off(t.ViewEvent.BASE_DESTROY,this,this.destroyBeyondShareBox);for(var i=0;i<this._beyondSource.length;i++)Laya.loader.clearRes(this._beyondSource[i].url)},i.prototype.onRewardEnd=function(e){var i=e.data;if(i&&i.length>0)for(var s=0;s<i.length;s++)if(i[s].id>2e5&&i[s].id<3e5){var n=new t.ShowSpecialWeapon(i[s].id,Number(i[s].hours));n.show(t.Layer.TIP);break}},i.prototype.showStrengthChange=function(e,i,s){Laya.timer.clear(this,this.firstDelay),Laya.timer.clear(this,this.lastDelay),Laya.timer.clear(this,this.loopChange);var n=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);if(0!=this._attackPowerWillTo&&(n.attackPower=this._attackPowerWillTo,n.updateFinish()),this._attackPowerWillTo=s,this._strengthChangeUI||(this._strengthChangeUI=new ui.common.StrengChangeUI),this._strengthChangeUI.oldTxt.text=e+"",i>0?(this._strengthChangeUI.addTxt.visible=!0,this._strengthChangeUI.delTxt.visible=!1,this._strengthChangeUI.addTxt.text="+"+i,this._strengthChangeUI.addTxt.x=this._strengthChangeUI.oldTxt.x+this._strengthChangeUI.oldTxt.textWidth+3):(this._strengthChangeUI.addTxt.visible=!1,this._strengthChangeUI.delTxt.visible=!0,this._strengthChangeUI.delTxt.text="-"+Math.abs(i),this._strengthChangeUI.delTxt.x=this._strengthChangeUI.oldTxt.x+this._strengthChangeUI.oldTxt.textWidth+3),this._strengthChangeUI.parent||(t.LayerMgr.addChild(this._strengthChangeUI,t.Layer.WEAK_TIP),this._strengthChangeUI.x=(t.LayerMgr.width-this._strengthChangeUI.width)/2,this._strengthChangeUI.y=100-t.LayerMgr.offY),0!=i){var a=i>0?1:-1,o=Math.floor(Math.abs(i)/15)*a,r=Math.abs(i)%15*a;this._loopArr=[];for(var h=1;15>=h;h++)this._loopArr.push(o);for(var l=0;0!=r;){var c=this._loopArr[l];c+=a,this._loopArr[l]=c,r-=a,l++}Laya.timer.once(300,this,this.firstDelay)}else n.attackPower=this._attackPowerWillTo,n.updateFinish()},i.prototype.firstDelay=function(){this._loopCount=0,Laya.timer.loop(30,this,this.loopChange)},i.prototype.loopChange=function(){var e=Number(this._strengthChangeUI.oldTxt.text),i=this._loopArr[this._loopCount];if(e+=i,this._strengthChangeUI.oldTxt.text=e+"",this._loopCount++,this._loopCount>=15){this._strengthChangeUI.oldTxt.text=String(this._attackPowerWillTo),Laya.timer.clear(this,this.loopChange),Laya.timer.once(400,this,this.lastDelay),this._strengthChangeUI.addTxt.visible=!1,this._strengthChangeUI.delTxt.visible=!1;var s=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);s.attackPower=this._attackPowerWillTo,s.updateFinish()}},i.prototype.lastDelay=function(){this._strengthChangeUI&&this._strengthChangeUI.parent&&this._strengthChangeUI.parent.removeChild(this._strengthChangeUI)},i.prototype.doExchange=function(e){null==this._exchangeCmd?(this._exchangeCmd=e,t.XHR().Post({cmd:"storage",op:"exchange",exid:e.exChangeID},this,this.doExchangeHandler)):t.WeakTips.show("正在处理其他兑换请求")},i.prototype.doExchangeHandler=function(e){if(0==e.result?t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0)):t.WeakTips.show("兑换失败，"+e.msg),this._exchangeCmd){var i=this._exchangeCmd;this._exchangeCmd=null,i.ecode=e.result,i.finish()}},i.prototype.getPluginName=function(){return t.PluginDef.PLUGIN_COMMON},i}(t.Plugin);t.CommonModule=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.comp.ConfirmBoxUI,!0,!0),this.display=this.skin,this.name="ConfirmBox",this.canClickModelToClose=!1,this.display.boxClose.on(Laya.Event.CLICK,this,this.goClose,[i.TYPE_CLOSE]),this.display.cancelBtn.on(Laya.Event.CLICK,this,this.goClose,[i.TYPE_CANCEL]),this.display.confirmBtn.on(Laya.Event.CLICK,this,this.onConfirm)}return __extends(i,e),i.prototype.destroy=function(){Laya.timer.clear(this,this.onTimeOut),this.display.boxClose.off(Laya.Event.CLICK,this,this.goClose),this.display.cancelBtn.off(Laya.Event.CLICK,this,this.goClose),this.display.confirmBtn.off(Laya.Event.CLICK,this,this.onConfirm),e.prototype.destroy.call(this)},i.show=function(e,s){void 0===s&&(s=t.Layer.ALERT);var n=new i;return n.confirmData=e,n.display.msgContent.text=e.contentStr,n.display.msgContent.align=e.align,n.display.msgTitile.text=e.title,n.display.confirmBtn.label=e.confirmStr,n.display.cancelBtn.label=e.cancleStr,n.display.boxClose.visible=e.isShowXBtn,n.display.confirmBtn.visible=e.isShowConfirmBtn,n.display.cancelBtn.visible=e.isShowCancelBtn,e.htmlStr&&(n.htmlTxt=new Laya.HTMLDivElement,n.htmlTxt.style.fontSize=n.display.msgContent.fontSize,n.htmlTxt.style.fontFamily="黑体",n.htmlTxt.style.leading=n.display.msgContent.leading,n.htmlTxt.style.bold=n.display.msgContent.bold,n.htmlTxt.width=n.display.msgContent.width,n.htmlTxt.height=n.display.msgContent.height,n.htmlTxt.style.align=n.display.msgContent.align,n.htmlTxt.style.valign=n.display.msgContent.valign,n.htmlTxt.style.stroke=n.display.msgContent.stroke,n.htmlTxt.style.lineHeight=23,n.htmlTxt.style.strokeColor=n.display.msgContent.strokeColor,n.htmlTxt.style.wordWrap=n.display.msgContent.wordWrap,n.htmlTxt.x=n.display.msgContent.x,n.htmlTxt.y=n.display.msgContent.y,n.htmlTxt.innerHTML=e.htmlStr,n.addChild(n.htmlTxt)),e.isShowConfirmBtn&&e.isShowCancelBtn?(n.display.confirmBtn.x=472,n.display.cancelBtn.x=707):e.isShowConfirmBtn?n.display.confirmBtn.x=588:e.isShowCancelBtn&&(n.display.cancelBtn.x=588),e.autoCloseTime>0&&Laya.timer.once(e.autoCloseTime,n,n.onTimeOut),n.show(s),n},i.prototype.onTimeOut=function(){this.goClose(i.TYPE_TIMEOUT,null)},i.prototype.goClose=function(t,e){if(this.confirmData&&this.confirmData.cancelCallBackHandler){var i=this.confirmData.cancelCallBackHandler;this.confirmData.cancelCallBackHandler=null,i.runWith({param:this.confirmData.param,type:t}),i.recover(),this.confirmData.deleteHandler()}this.confirmData=null,this.destroy()},i.prototype.onConfirm=function(){if(this.confirmData&&this.confirmData.callBackHandler){var t=this.confirmData.callBackHandler;this.confirmData.callBackHandler=null,this.confirmData.param?t.runWith(this.confirmData.param):t.run(),t.recover(),this.confirmData.deleteHandler()}this.destroy()},i.TYPE_CLOSE=1,i.TYPE_CANCEL=2,i.TYPE_TIMEOUT=3,i}(t.BaseBox);t.ConfirmBox=e;var i=function(){function t(t){void 0===t&&(t=null),this.title="消息提示",this.callBackHandler=null,this.cancelCallBackHandler=null,this.isShowXBtn=!0,this.contentStr="",this.align="center",this.htmlStr=null,this.param=null,this.confirmStr="确 定",this.cancleStr="取 消",this.isShowCancelBtn=!0,this.isShowConfirmBtn=!0,this.autoCloseTime=0;for(var e in t)this.hasOwnProperty(e)&&(this[e]=t[e])}return t.prototype.deleteHandler=function(){this.callBackHandler&&(this.callBackHandler.recover(),this.callBackHandler=null),this.cancelCallBackHandler&&(this.cancelCallBackHandler.recover(),this.cancelCallBackHandler=null)},t}();t.ConfirmBoxData=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.utils.Ease,i=laya.utils.Tween,s=Laya.ColorFilter,n=function(n){function a(){n.call(this),this.ROLE_L_ORIGIN_X=199,this.ROLE_R_ORIGIN_X=1267,this.ROLE_L_HIDE_X=-531,this.ROLE_R_HIDE_X=2100,this.m_isPlaying=!1,this.m_isSpeaking=!1,this.m_nextPlayPos=0,this.m_isInit=!1,this.m_currentSpeakPos=0,this.initialize()}return __extends(a,n),a.dispose=function(){a.m_instance&&(t.LayerMgr.removeChild(a.m_instance),a.m_instance=null)},a.prototype.initialize=function(){this.m_bg=new Sprite,this.m_bg.graphics.drawRect(0,0,t.LayerMgr.width,t.LayerMgr.clientHeight,"#000000"),this.m_bg.y=-t.LayerMgr.offY,this.m_bg.alpha=.2,this.m_bg.mouseEnabled=!0,this.m_bg.size(t.LayerMgr.width,t.LayerMgr.clientHeight),this.addChildAt(this.m_bg,0),this.m_isInit=!0,this.hitTestPrior=!1,this.mouseEnabled=!0},a.playQueue=function(t,e,i){void 0===e&&(e=null),a.getInstance().playQueue(t,e,i)},a.getInstance=function(){return null==a.m_instance&&(a.m_instance=new a),a.m_instance},a.stopPlay=function(){a.getInstance().m_playQueue=null,t.LayerMgr.removeChild(a.getInstance())},a.prototype.hide=function(){this.m_bg.visible=!1,i.to(this.leftC,{x:this.ROLE_L_HIDE_X},100,e.linearNone,Laya.Handler.create(this,this.end)),i.to(this.rightC,{x:this.ROLE_R_HIDE_X},100,e.linearNone)},a.prototype.end=function(){for(var e=0;e<this.m_npcIDs.length;e++)Laya.loader.clearRes(this.getUrlById(this.m_npcIDs[e]));this.roleL.skin="",this.roleR.skin="",this.m_onFinished&&this.m_onFinished.apply(this.m_thisObj),t.LayerMgr.removeChild(this)},a.prototype.applyEffect=function(t){t.filters=[]},a.prototype.cancelEffect=function(t){var e=[.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0],i=new s(e);t.filters=[i]},a.prototype.getUrlById=function(e){return t.ResPath().getPic(e,t.ResourcePath.PATH_NPC_AVATAR)},a.prototype.playQueue=function(s,n,o){if(s&&0!=s.length){this.m_playQueue=s,this.m_onFinished=n,this.m_thisObj=o,this.m_nextPlayPos=0,t.LayerMgr.addChild(this,t.Layer.STORY),this.m_npcIDs=[],this.L_RSD=null,this.R_RSD=null;for(var r,h=0;h<s.length&&(r=s[h],null==this.L_RSD&&r.pos==a.LEFT&&(this.L_RSD=r),null==this.R_RSD&&r.pos==a.RIGHT&&(this.R_RSD=r),null==this.L_RSD||null==this.R_RSD);h++)-1==this.m_npcIDs.indexOf(r.npcId)&&this.m_npcIDs.push(r.npcId);this.leftC.visible=null!=this.L_RSD,this.rightC.visible=null!=this.R_RSD,null!=this.L_RSD&&(this.roleL.skin=this.getUrlById(this.L_RSD.npcId),this.txtNameL.text=this.L_RSD.name),null!=this.R_RSD&&(this.roleR.skin=this.getUrlById(this.R_RSD.npcId),this.txtNameR.text=this.R_RSD.name),this.leftC.x=-689,this.rightC.x=2030,this.kuangL.visible=!1,this.txtL.visible=!1,this.txtL.text="",this.kuangR.visible=!1,this.txtR.visible=!1,this.txtR.text="";var l=s[0].pos;l==a.LEFT?(this.applyEffect(this.roleL),this.leftC.scaleX=1,this.leftC.scaleY=1,this.cancelEffect(this.roleR),this.rightC.scaleX=.8,this.rightC.scaleY=.8):(this.cancelEffect(this.roleL),this.leftC.scaleX=.8,this.leftC.scaleY=.8,this.applyEffect(this.roleR),this.rightC.scaleX=1,this.rightC.scaleY=1),this.m_bg.visible=!0,i.to(this.leftC,{x:this.ROLE_L_ORIGIN_X},1e3,e.elasticOut,Laya.Handler.create(this,this.playNext)),i.to(this.rightC,{x:this.ROLE_R_ORIGIN_X},1e3,e.elasticOut)}},a.prototype.playNext=function(){if(this.m_isInit&&!this.m_isPlaying){if(null==this.m_playQueue||this.m_nextPlayPos>=this.m_playQueue.length)return void this.hide();this.playOne(this.m_playQueue[this.m_nextPlayPos]),++this.m_nextPlayPos}},a.prototype.playOne=function(t,s){void 0===s&&(s=!0),this.m_isPlaying=!0,this.m_isSpeaking=!0,this.m_currentSpeakPos=0,this.m_currentSpeak=t.speak,0==t.pos?(this.m_currIsLeft=!0,this.leftC.visible=!0,t.npcId!=this.L_RSD.npcId&&(this.roleL.skin=this.getUrlById(t.npcId),this.txtNameL.text=t.name,this.L_RSD=t),this.applyEffect(this.roleL),this.cancelEffect(this.roleR),this.kuangL.visible=!0,this.txtL.visible=!0,this.kuangR.visible=!1,this.txtR.visible=!1,i.to(this.leftC,{scaleX:1,scaleY:1},200,e.backOut),i.to(this.rightC,{scaleX:.8,scaleY:.8},200,e.backOut)):(this.m_currIsLeft=!1,this.rightC.visible=!0,t.npcId!=this.R_RSD.npcId&&(this.roleR.skin=this.getUrlById(t.npcId),this.txtNameR.text=t.name,this.R_RSD=t),this.applyEffect(this.roleR),this.cancelEffect(this.roleL),this.kuangL.visible=!1,this.txtL.visible=!1,this.kuangR.visible=!0,this.txtR.visible=!0,i.to(this.leftC,{scaleX:.8,scaleY:.8},200,e.backOut),i.to(this.rightC,{scaleX:1,scaleY:1},200,e.backOut)),this.showSpeak(),this.on(Laya.Event.CLICK,this,this.onPlayingTouch)},a.prototype.onPlayingTouch=function(t){this.m_isSpeaking?this.m_currentSpeakPos=this.m_currentSpeak.length:(this.m_isPlaying=!1,Laya.timer.clear(this,this.playNext),this.playNext())},a.prototype.showSpeak=function(){if(this.m_isPlaying){var t=this.m_currentSpeak.substr(0,++this.m_currentSpeakPos);if(this.m_currIsLeft?this.txtL.text=t:this.txtR.text=t,this.m_currentSpeakPos>this.m_currentSpeak.length)return this.m_isSpeaking=!1,this.m_isPlaying=!1,void Laya.timer.once(2500,this,this.playNext);for(;this.m_currentSpeak.charAt(this.m_currentSpeakPos).match(/[\<\w\>\/\'\"\#]/);)this.m_currentSpeakPos++;Laya.timer.once(60,this,this.showSpeak)}},a.LEFT=0,a.RIGHT=1,a}(ui.DramaUI);t.RoleSpeak=n}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){function e(e,i){var s;s="kVit"==e?t.Global.elemPosMap.get("kVit"):"kCash"==e?t.Global.elemPosMap.get("kCash"):"kExp"==e?t.Global.elemPosMap.get("kExp"):"kPrestige"==e?t.Global.elemPosMap.get("kPrestige"):Number(e)>=200001&&Number(e)<=4e5?t.Global.elemPosMap.get("ws"):t.Global.elemPosMap.get("prop");
var a=new n(t.ResPath().getPic(e,t.ResourcePath.PATH_GOODS),i,s);t.LayerMgr.addChild(a,t.Layer.LOADING)}var i=laya.utils.Ease,s=laya.display.Sprite,n=function(t){function e(e,i,s){t.call(this),this.loadImage(e,0,0,70,70),this.width=70,this.height=70,this.pivotX=this.width/2,this.pivotY=this.height/2,this.x=i.x,this.y=i.y,this.dest=s,this.scaleX=1.5,this.scaleY=1.5,Laya.timer.once(0,this,this.disappear)}return __extends(e,t),e.prototype.disappear=function(){Laya.Tween.to(this,{x:this.dest.x,y:this.dest.y,scaleX:.5,scaleY:.5,rotation:720},600,i.linearOut,new Handler(this,this.complete))},e.prototype.complete=function(){this.removeSelf()},e}(s);t.DropFlyAniProvider=n,t.addDropAni=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.common.FriendListShowUI,!1,!1),this._display=this.skin,this.setCloseButton(this._display.closeBtn),this._pageSize=3,this._display.leftBtn.on(Laya.Event.CLICK,this,this.onClickLeft),this._display.rightBtn.on(Laya.Event.CLICK,this,this.onClickRight),t.SceneMgr.addChangeSceneCallback(this,this.closeBox)}return __extends(i,e),Object.defineProperty(i,"singleton",{get:function(){return i._singleton||(i._singleton=new i),i._singleton},enumerable:!0,configurable:!0}),i.prototype.showBox=function(e,i,s){this.show(t.Layer.BOX),this.checkPosition(i,s),this.updateBox(e)},i.prototype.closeBox=function(){this.hide()},i.prototype.updateBox=function(t){this._curDataList=t,this._curPage=1,this._maxPage=Math.ceil(this._curDataList.length/this._pageSize),this.showPage()},i.prototype.showPage=function(){this.showPageContent(),this.buttonShowHide()},i.prototype.showPageContent=function(){for(var t=0,e=(this._curPage-1)*this._pageSize;e<this._curPage*this._pageSize;e++)this._curDataList[e]?(this._display["item"+t].updateItem(this._curDataList[e]),this._display["item"+t].visible=!0):this._display["item"+t].visible=!1,t++},i.prototype.buttonShowHide=function(){this._curPage>1?this._display.leftBtn.visible=!0:this._display.leftBtn.visible=!1,this._curPage>=this._maxPage?this._display.rightBtn.visible=!1:this._display.rightBtn.visible=!0},i.prototype.checkPosition=function(e,i){e+this._display.width<t.LayerMgr.width&&i+this._display.height<t.LayerMgr.height?(this.x=e,this.y=i):e+this._display.width<t.LayerMgr.width&&i+this._display.height>t.LayerMgr.height?(this.x=e,this.y=i-this._display.height):e+this._display.width>t.LayerMgr.width&&i+this._display.height<t.LayerMgr.height?(this.x=e-this._display.width,this.y=i):e+this._display.width>t.LayerMgr.width&&i+this._display.height>t.LayerMgr.height&&(this.x=e-this._display.width,this.y=i-this._display.height)},i.prototype.onClickLeft=function(){this._curPage>1&&(this._curPage--,this.showPage())},i.prototype.onClickRight=function(){this._curPage<this._maxPage&&(this._curPage++,this.showPage())},i}(t.BaseBox);t.FriendListShowBox=e;var i=function(e){function i(){e.call(this),this.on(Laya.Event.CLICK,this,this.onClick)}return __extends(i,e),i.prototype.updateItem=function(e){e&&(this._curData=e,this.head.graphics.clear(),e.url?this.head.loadImage(t.JSUtils.getHeadUrl(e.url),0,0,87,87):1==e.sex?this.head.loadImage("ui/main/male.png",0,0,87,87):this.head.loadImage("ui/main/female.png",0,0,87,87),this.nameTxt.text=e.name)},i.prototype.onClick=function(){this._curData&&t.Facade.callCommand(new t.UserInfoCommand(this._curData.uid+""))},i}(ui.common.FriendListShowItemUI);t.FriendListShowItem=i;var s=function(i){function s(){i.call(this),this.on(Laya.Event.CLICK,this,this.onClick)}return __extends(s,i),s.prototype.setData=function(e){e?(this._curList=e,this._curList.length>0?(this.visible=!0,this.head.graphics.clear(),this._curList[0].url?this.head.loadImage(t.JSUtils.getHeadUrl(this._curList[0].url),0,0,51,51):1==this._curList[0].sex?this.head.loadImage("ui/main/male.png",0,0,51,51):this.head.loadImage("ui/main/female.png",0,0,51,51)):this.visible=!1):this.visible=!1},s.prototype.setBgScale=function(t){t>0?(this.bgFrame.scaleX=1,this.bgFrame.x=0):(this.bgFrame.scaleX=-1,this.bgFrame.x=69)},s.prototype.onClick=function(t){this._curList&&this._curList.length>0&&e.singleton.showBox(this._curList,t.stageX,t.stageY)},s}(ui.common.FriendShowFrameUI);t.FriendShowFrame=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this),this._isStartGuide=!1,this._nowIndex=0,this._nowHideCondition=0,this._nowTaskID=0}return __extends(s,i),s.prototype.initialize=function(t){this._nowIndex=0,this._nowHideCondition=0,this._nowHideParam=null,this._nowHideStep=null,this._scale=100,this._scaleStep=1},s.prototype.figuireMovie=function(){this._s&&(this._scale+=this._scaleStep,this._scaleStep>0?this._scale>=120&&(this._scaleStep=-1):this._scale<=100&&(this._scaleStep=1),this._figure&&(this._figure.scaleX=this._figure.scaleY=this._scale/100),this._figureDown&&(this._figureDown.scaleX=this._figureDown.scaleY=this._scale/100))},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"StartGuideCommand":this._isStartGuide||(this._isStartGuide=!0,this._guideConf=t.GuideData.guideData,this._figure=new ui.guide.GuideFigureUI,this._figureDown=new ui.guide.GuideFiguireDownUI,this._guideCircle=new laya.ui.Image("ui/comp/guideCircle.png"),this._scale=100,Laya.timer.loop(20,this,this.figuireMovie),Laya.stage.on(Laya.Event.RESIZE,this,this.onResize)),e.ecode=0,e.finish();break;case"StopGuideCommand":this.destroySprite();break;case"CheckShowGuideCommand":var i=this.retrieveModel(t.ModelDef.GUIDE_MODEL);if(i){i.guidetaskID!=this._nowTaskID&&(this._nowTaskID=i.guidetaskID,this._nowIndex=0);var s=e;if(null!=this._guideConf&&(i.isGuiding||i.guidetaskID>=1e4))if(s.condition==t.CheckShowGuideCommand.FIGHT_RESULT_OPEN);else{s.condition==t.CheckShowGuideCommand.FIGHT_CLOSE&&null!=this._storyWaitFight&&""!=this._storyWaitFight&&(this.playDrama(this._storyWaitFight),this._storyWaitFight="");var n=!0;n&&this.checkShowGuide(s)}}}},s.prototype.startGuide=function(){},s.prototype.checkShowGuide=function(e){this._storyWaitFight="";var i=this.retrieveModel(t.ModelDef.GUIDE_MODEL);this._nowHideCondition==e.condition&&(null!=this._nowHideParam&&this._nowHideParam!=e.param||null!=this._nowHideStep&&this._nowHideStep!=String(i.nowStep)||(this.destroySprite(),null!=this._nowHideStory&&""!=this._nowHideStory&&(this.playDrama(this._nowHideStory),this._nowHideStory="")));var s=i.guidetaskID,n=this._guideConf["task"+s];if(n&&n.length>0){var a=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).level,o=this._nowIndex;if(o<n.length){var r,h;do if(o++,h=!1,o<=n.length){r=n[o-1];var l=!0;if(r.hasOwnProperty("waitStep")&&(null==r.needBox||t.BoxMgr.hasBoxShow(r.needBox))&&(null==r.notNeedBox||!t.BoxMgr.hasBoxShow(r.notNeedBox))&&(null==r.needScene||t.SceneMgr.current.getSceneName()==r.needScene)&&(null==r.needLv||a>=Number(r.needLv))&&(null==r.needIos||Laya.Browser.onIOS)&&(null==r.needAnd||!Laya.Browser.onIOS)){if(r.waitStep==i.nowStep){h=!0;break}if(l=!1,i.nowStep<r.waitStep)break}if(r.hasOwnProperty("step")){var c=r.step.split(",");-1==c.indexOf(String(i.nowStep))&&(l=!1)}l&&(null!=r.needBox&&!t.BoxMgr.hasBoxShow(r.needBox)||null!=r.notNeedBox&&t.BoxMgr.hasBoxShow(r.notNeedBox)||null!=r.needScene&&t.SceneMgr.current.getSceneName()!=r.needScene||!(null==r.needLv||a>=Number(r.needLv))||null!=r.needIos&&!Laya.Browser.onIOS||null!=r.needAnd&&Laya.Browser.onIOS||(r.hasOwnProperty("showCondition")&&(h=r.showCondition==e.condition&&(null==r.showConditionParam||r.showConditionParam==e.param)),0==h&&r.hasOwnProperty("showCondition1")&&(h=r.showCondition1==e.condition&&(null==r.showConditionParam1||r.showConditionParam1==e.param)),0==h&&r.hasOwnProperty("showCondition2")&&(h=r.showCondition2==e.condition&&(null==r.showConditionParam2||r.showConditionParam2==e.param))))}while((!h||241==i.guidetaskID&&2>=o&&Laya.Browser.onIOS)&&o<n.length);if(o<=n.length&&h){this.destroySprite(),this._nowIndex=o,this._nowHideCondition=r.hideCondition,this._nowHideParam=r.hideConditionParam,this._nowHideStep=r.stepHide,this._storyWaitFight=r.storyWaitFight;var d=r.hasOwnProperty("buttonName")?r.buttonName:null,u=1031==r.storyBefore;this.showSprite(r.x,r.y,r.width,r.height,d,r.hasOwnProperty("isBoxButton"),r.hasOwnProperty("isCircle"),!1,u,s,o),r.hasOwnProperty("storyBefore")&&this.playDrama(r.storyBefore),r.hasOwnProperty("storyAfter")?this._nowHideStory=r.storyAfter:this._nowHideStory=""}}}},s.prototype.showSprite=function(e,i,s,n,a,o,r,h,l,c,d){if(void 0===a&&(a=null),void 0===o&&(o=!1),void 0===r&&(r=!1),void 0===h&&(h=!1),void 0===l&&(l=!1),void 0===c&&(c=-1),void 0===d&&(d=-1),this._nowXValue=e,this._nowYValue=i,this._nowWidthValue=s,this._nowHeightValue=n,this._nowButtonNameValue=a,this._nowIsBoxButton=o,this._nowIsCircleValue=r,this._nowNeedKuangValue=h,this._nowIsShowFigureDownValue=l,this._nowTaskIdValue=c,this._nowIndexValue=d,null!=a){var u,p,_;if(o){if(p=!1,t.BoxMgr.boxs.length>0){_=t.BoxMgr.boxs[t.BoxMgr.boxs.length-1];var f=[];this.pushAllChild(f,_);for(var y=0;y<f.length;y++)if(f[y].name==a){u=f[y];break}}}else{t.Facade.callCommand(new t.CheckMenuStatus(a));var m=t.SceneMgr.current.getScene();u=m[a],p=t.SceneMgr.current.getSceneName()==t.SceneDef.MAIN_SCENE,u||(u=t.Icon.MAIN_SCENE[a],m=t.Icon.MAIN_SCENE.skin,p=!0),_=m}if(u){e=u.x-u.pivotX,i=u.y-u.pivotY,s=u.width,n=u.height;for(var g=u.parent;g!=_;)e+=g.x-g.pivotX,i+=g.y-g.pivotY,g=g.parent;p&&u.parent&&u.parent.setChildIndex(u,u.parent.numChildren-1)}}this._s=new Sprite,this._s.mouseEnabled=!0,this._s.cacheAs="bitmap";var v;if(60001==c&&1==d&&(i-=t.LayerMgr.offY),v=new Sprite,v.graphics.drawRect(0,0,e,t.LayerMgr.clientHeight,"#000000"),v.y=-t.LayerMgr.offY,this._s.addChild(v),v=new Sprite,v.graphics.drawRect(e+s,0,t.LayerMgr.width-(e+s),t.LayerMgr.clientHeight,"#000000"),v.y=-t.LayerMgr.offY,this._s.addChild(v),r){var C=Math.max(s,n)/2;v=new Sprite,v.graphics.drawRect(e+s/2-C,0,2*C,i+n/2-C+t.LayerMgr.offY,"#000000"),v.y=-t.LayerMgr.offY,this._s.addChild(v),v=new Sprite,v.graphics.drawRect(e+s/2-C,i+n/2+C,2*C,t.LayerMgr.height-(i+n/2+C)+t.LayerMgr.offY,"#000000"),this._s.addChild(v),this._guideCircle.width=this._guideCircle.height=Math.max(s,n)+2,this._s.addChild(this._guideCircle),this._guideCircle.x=e+s/2-C-1,this._guideCircle.y=i+n/2-C-1}else v=new Sprite,v.graphics.drawRect(e,0,s,i+t.LayerMgr.offY,"#000000"),v.y=-t.LayerMgr.offY,this._s.addChild(v),v=new Sprite,v.graphics.drawRect(e,i+n,s,t.LayerMgr.height-(i+n)+t.LayerMgr.offY,"#000000"),this._s.addChild(v);var w=new Laya.HitArea;w.hit.drawRect(0,-t.LayerMgr.offY,t.LayerMgr.width,t.LayerMgr.clientHeight,"#000000"),r?w.unHit.drawCircle(e+s/2,i+n/2,Math.max(s,n)/2,"#000000"):w.unHit.drawRect(e,i,s,n,"#000000"),this._s.hitArea=w,this._s.alpha=.7,this._s.size(t.LayerMgr.width,t.LayerMgr.clientHeight),t.LayerMgr.addChild(this._s,t.Layer.GUIDE),t.LayerMgr.addChild(this._figure,t.Layer.GUIDE),this._figure.x=e+s/2-10,this._figure.y=i+n-20,t.LayerMgr.addChild(this._figureDown,t.Layer.GUIDE),this._figureDown.x=e+s/2-30,this._figureDown.y=i+20,241==c&&1==d?(this._figure.x=773,this._figure.y=541,this._figureDown.x=773,this._figureDown.y=541):70020==c&&1==d&&(this._figure.x+=135,this._figure.y-=30),this._figure.y+70>=t.LayerMgr.height+t.LayerMgr.offY||"copyBtn"==a||"xkxBtn"==a||"qyhBtn"==a||l?(this._figure.visible=!1,this._figureDown.visible=!0,"friendBtn"==a||"copyBtn"==a||"xkxBtn"==a||"qyhBtn"==a?(this._figureDown.rotation=-100,this._figureDown.x-=35,this._figureDown.y+=55):this._figureDown.rotation=0):(this._figure.visible=!0,this._figureDown.visible=!1)},s.prototype.destroySprite=function(){this._s&&(this._s.parent&&this._s.parent.removeChild(this._s),this._s=null),this._figure&&this._figure.parent&&this._figure.parent.removeChild(this._figure),this._figureDown&&this._figureDown.parent&&this._figureDown.parent.removeChild(this._figureDown),this._guideCircle&&this._guideCircle.parent&&this._guideCircle.parent.removeChild(this._guideCircle)},s.prototype.onResize=function(){t.LayerMgr.getLayer(t.Layer.GUIDE).numChildren>0&&(this.destroySprite(),this.showSprite(this._nowXValue,this._nowYValue,this._nowWidthValue,this._nowHeightValue,this._nowButtonNameValue,this._nowIsBoxButton,this._nowIsCircleValue,this._nowNeedKuangValue,this._nowIsShowFigureDownValue,this._nowTaskIdValue,this._nowIndexValue))},s.prototype.playDrama=function(e){this._dramaID=e,t.Facade.callCommand(new t.PlayDramaCmd(e))},s.prototype.pushAllChild=function(t,e){t.push(e);for(var i=0;i<e.numChildren;i++)this.pushAllChild(t,e.getChildAt(i))},s.prototype.getPluginName=function(){return e.PLUGIN_GUIDE},s}(t.Plugin);t.GuideModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){if(e.call(this),this._percent=0,this._content="",i._singleton)throw new Error("单例！！");var s=new Sprite;s.graphics.drawRect(0,0,t.LayerMgr.width,t.LayerMgr.clientHeight,"#000000"),s.alpha=.4,s.y=-t.LayerMgr.offY,s.mouseEnabled=!0,s.size(t.LayerMgr.width,t.LayerMgr.clientHeight),this.addChildAt(s,0),this.mouseEnabled=!0,this.hitTestPrior=!1,this.contentTxt.text=""}return __extends(i,e),Object.defineProperty(i,"singleton",{get:function(){return null==i._singleton&&(i._singleton=new t.LoaderBar),i._singleton},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"percent",{set:function(t){this._percent=Math.max(0,Math.min(1,t)),this.percentTxt.text=Number(100*this._percent).toFixed(1)+"%",this.progressBar.value=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"content",{get:function(){return this._content},set:function(t){this._content=t||"",this.contentTxt.text=this.content},enumerable:!0,configurable:!0}),i.prototype.load=function(e,i){this._complete=i,t.LayerMgr.addChildAt(this,0,t.Layer.LOADING),Laya.loader.load(e,Handler.create(this,this.onComplete),Handler.create(this,this.onProgress,null,!1)),Laya.loader.on(Laya.Event.ERROR,this,this.onError)},i.prototype.onComplete=function(){if(Laya.loader.off(Laya.Event.ERROR,this,this.onError),t.Logger.log("LoaderBar.加载完成"),this.percent=1,this._complete){var e=this._complete;this._complete=null,e.run(),e.recover(),e=null}t.LayerMgr.removeChild(this)},i.prototype.onProgress=function(e){t.Logger.log("LoaderBar.加载进度："+e),this.percent=e},i.prototype.onError=function(e){Laya.loader.off(Laya.Event.ERROR,this,this.onError),t.Logger.log("LoaderBar.加载失败"+e)},i}(ui.ProgressUI);t.LoaderBar=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,new ui.common.LvUpBookUI,!0,!0),this._index=0,this.display=this.skin,this.canClickModelToClose=!1,this.name="LvUpBook",this._cmd=t,this._data=t.arr,this._cmd.finish(),this.parseComplete2(),Laya.timer.once(15e3,this,this.destroy)}return __extends(i,e),i.prototype.parseComplete2=function(){this.m_djSk=new t.AnimationSKe("assets/skeleton/levelup/tianshu2.sk",2),this.m_djbgSk=new t.AnimationSKe("assets/skeleton/levelup/tianshu2.sk",2),this.m_djbgSk.play(2,!0),this.m_djSk.play(0,!1),this.display.addChildAt(this.m_djSk,1),this.display.addChildAt(this.m_djbgSk,1),this.m_djbgSk.x=660,this.m_djbgSk.y=360,this.m_djSk.x=660,this.m_djSk.y=560,this.m_djSk.on(laya.events.Event.STOPPED,this,this.showAnimData),this.display.bookArea.on(laya.events.Event.CLICK,this,this.playNext)},i.prototype.playNext=function(){0==this._index?(this._index=1,this.showAnimData()):this.destroy()},i.prototype.showAnimData=function(){this.m_djSk.off(laya.events.Event.STOPPED,this,this.showAnimData),this._index=1,this.m_djbgSk.play(3,!0),this.m_djSk.play(1,!1),this.m_djSk.on(laya.events.Event.STOPPED,this,this.destroy),this.display.goods.visible=!0,0==this._data.uptype?this.display.upIcon.skin=t.ResPath().getPic(1,t.ResourcePath.PATH_STATUS):1==this._data.uptype?this.display.upIcon.skin=t.ResPath().getPic(this._data.id,t.ResourcePath.PATH_WEAPON,this._data.level):this.display.upIcon.skin=t.ResPath().getPic(this._data.id,t.ResourcePath.PATH_SKILL,this._data.level)},i.prototype.destroy=function(){this.m_djSk&&(this.display.removeChild(this.m_djSk),this.m_djSk.destroy(),this.m_djSk=null),this.m_djbgSk&&(this.display.removeChild(this.m_djbgSk),this.m_djbgSk.destroy(),this.m_djbgSk=null),this.display&&this.display.bookArea.off(laya.events.Event.CLICK,this,this.playNext),Laya.timer.clear(this,this.destroy),t.Facade.callCommand(new t.ShowUpAnimationCMD(this._data,!0)),e.prototype.destroy.call(this)},i}(t.BaseBox);t.LvUpBook=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i){e.call(this,new ui.common.LvUpUI,!0,!0),this._stepValue=1,this.display=this.skin,this.name="LvUpBox",this.canClickModelToClose=!1,this.display.lvValueTxt.text=i.level+"",this.display.liLiangTxt.text="1",this.display.jingGuTxt.text="1",this.display.suDuTxt.text="1",this.display.freeTxt.text="2",this.display.vitTxt.text="您恢复了"+10*(Math.floor((Number(i.level)-1)/10)+1)+"点体力。",i.hasOwnProperty("skill")&&null!=i.skill&&""!=i.skill?(this.upBookData=i.skill,this.upBookData.uptype=2):i.hasOwnProperty("weapon")&&null!=i.weapon&&""!=i.weapon?(this.upBookData=i.weapon,this.upBookData.uptype=1):(this.upBookData=i.status,this.upBookData.uptype=0),this.m_djSk=new t.AnimationSKe("assets/skeleton/qieupgrade.sk"),this.m_djSk.play(0,!0),this.display.addChildAt(this.m_djSk,0),this.m_djSk.x=650,this.m_djSk.y=340,this.display.animBox.on(Laya.Event.CLICK,this,this.bookClickHandler),this._bookPngStartY=this.display.bookPng.y,Laya.timer.loop(100,this,this.loopHandler)}return __extends(i,e),i.prototype.bookClickHandler=function(){this.LvUpBookCmd=new t.ShowLvUpBookCmd(this.upBookData),this.LvUpBookCmd.on(this,this.destroy),t.Facade.callCommand(this.LvUpBookCmd)},i.prototype.loopHandler=function(){this.display.bookPng.y+=this._stepValue,this.display.clondPng.y+=this._stepValue,1==this._stepValue?this.display.bookPng.y>=this._bookPngStartY+10&&(this._stepValue=-1):this.display.bookPng.y==this._bookPngStartY&&(this._stepValue=1)},i.prototype.destroy=function(){Laya.timer.clear(this,this.loopHandler),this.m_djSk&&(this.m_djSk.destroy(),this.m_djSk=null),this.LvUpBookCmd&&(this.LvUpBookCmd.off(),this.LvUpBookCmd=null),this.display.animBox.off(Laya.Event.CLICK,this,this.bookClickHandler),e.prototype.destroy.call(this)},i}(t.BaseBox);t.LvUpBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(s){e.call(this,new ui.common.LvUpShareUI,!0,!0),this.display=this.skin,this.name="LvUpShare",this.canClickModelToClose=!1,this._data=s,this.userModel=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),this.parseComplete(),this.display.myRank.itemRender=i,this.display.rankList.itemRender=i,this.display.myRank.renderHandler=new Handler(this,this.onListRender),this.display.rankList.renderHandler=new Handler(this,this.onRankListRender),this.init(),this.display.bg.y=-t.LayerMgr.offY,this.display.bg.graphics.drawRect(0,0,t.LayerMgr.width,t.LayerMgr.clientHeight,"#333333")}return __extends(s,e),s.prototype.init=function(){this.display.rankList.array=this._data,this._myData={},this._myData.level=this.userModel.level-1,this._myData.vip_lvl=this.userModel.vipLevel,this._myData.name=this.userModel.name,this._myData.sex=this.userModel.sex,this._myData.power=this.userModel.attackPower,this._myData.uid=this.userModel.uid,this._myData.headimgurl=this.userModel.headimgurl,this._myData.rank=this._data[0].rank+this._data.length,this.display.myRank.array=[this._myData],this.display.backBtn.on(Laya.Event.CLICK,this,this.destroy),this.display.btnArea.on(Laya.Event.CLICK,this,this.onClickShow),Laya.Tween.to(this.display.rankList,{y:this.display.rankList.y+150,x:this.display.rankList.x+50},1e3,Laya.Ease.linearIn,new Handler(this,this.onChangePos)),Laya.Tween.to(this.display.myRank,{y:this.display.myRank.y-380,x:this.display.myRank.x-50},1e3,Laya.Ease.linearIn)},s.prototype.onChangePos=function(){this._myData.level=this.userModel.level,this._myData.rank=this._data[0].rank-1,this.display.myRank.array=[this._myData]},s.prototype.parseComplete=function(){this.m_djSk=new t.AnimationSKe("assets/skeleton/levelup/chaoyuehaoyou.sk",2),this.m_upSk=new t.AnimationSKe("assets/skeleton/levelup/chaoyuehaoyou.sk",1),this.m_downSk=new t.AnimationSKe("assets/skeleton/levelup/chaoyuehaoyou.sk",0),this.m_djSk.play(0,!0),this.m_upSk.play(1,!0),this.m_downSk.play(2,!0),this.display.animbox.addChildAt(this.m_upSk,0),this.display.animbox.addChildAt(this.m_downSk,0),this.display.animbox.addChildAt(this.m_djSk,2),this.m_djSk.x=1030,this.m_djSk.y=705,this.m_upSk.x=1290,this.m_upSk.y=140,this.m_downSk.x=720,this.m_downSk.y=550},s.prototype.onClickShow=function(){t.Global.isWXAPP?t.ShareModule.shareMessage({title:["等级超过你啦"],desc:["哼~你被本宝宝赶超了！蜜汁微笑~","轻轻松松超越你，不服来战撒","像我这么帅的全乐斗只有一个！怕不怕~","像我这种天资聪明还这么勤奋的，分分钟超越你！"],uid:this._data[0].uid,alertType:1,image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(10)),command:1002},Handler.create(this,this.showCallBack),17):t.ShareModule.shareMessage({title:["等级超过你啦"],desc:["哼~你被本宝宝赶超了！蜜汁微笑~","轻轻松松超越你，不服来战撒","像我这么帅的全乐斗只有一个！怕不怕~","像我这种天资聪明还这么勤奋的，分分钟超越你！"],uid:this._data[0].uid,alertType:1,command:1002},Handler.create(this,this.showCallBack),17)},s.prototype.showCallBack=function(e){e&&(0==e.retCode||e.result&&0==e.result.retCode)?(t.WeakTips.show("您的炫耀信息已经发送成功啦！"),this.destroy()):t.WeakTips.show("炫耀失败")},s.prototype.onListRender=function(t,e){t.setData(this.display.myRank.getItem(e),e)},s.prototype.onRankListRender=function(t,e){t.setData(this.display.rankList.getItem(e),e)},s.prototype.destroy=function(){this.display.backBtn.off(Laya.Event.CLICK,this,this.destroy),this.display.btnArea.off(Laya.Event.CLICK,this,this.onClickShow),this.m_djSk&&(this.m_djSk.parent&&this.m_djSk.parent.removeChild(this.m_djSk),this.m_djSk.destroy(),this.m_djSk=null),this.m_upSk&&(this.m_upSk.parent&&this.m_upSk.parent.removeChild(this.m_upSk),this.m_upSk.destroy(),this.m_upSk=null),this.m_downSk&&(this.m_downSk.parent&&this.m_downSk.parent.removeChild(this.m_downSk),this.m_downSk.destroy(),this.m_downSk=null),e.prototype.destroy.call(this)},s}(t.BaseBox);t.LvUpShare=e;var i=function(e){function i(){e.call(this),this._numPic=new t.ImageWord("assets/word/damage/")}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.setData=function(e,i){e&&(this._curData=e,this.photo.skin=t.JSUtils.getHeadUrl(e.headimgurl),this.nameTxt.text=e.name,this.fightTxt.text="战斗力："+e.power,this.tfVip.text=e.vip_lvl,this.tfLvl.text=e.level,2==e.sex?(this.femaleIcon.visible=!0,this.maleIcon.visible=!1):(this.femaleIcon.visible=!1,this.maleIcon.visible=!0),this.addChild(this._numPic),this._numPic.y=60,this._numPic.showWord(e.rank+""),this._numPic.x=45-this._numPic.imgWidth/2,t.Logger.log(e))},i}(ui.common.LvUpShareListUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.net.NetBoxUI,!0,!0),this.display=this.skin,this.name="NetMsgBox",this.canClickModelToClose=!1,this.setCloseButton(this.display.closeBtn),this.display.txt.disabled=!1,this.display.txt.mouseEnabled=!1,this.display.txt.editable=!0,this.display.txtLog.disabled=!1,this.display.txtLog.mouseEnabled=!1,this.display.txtLog.editable=!1,this.display.panel.vScrollBarSkin="ui/comp/vscroll.png",this.display.panel.vScrollBar.showButtons=!1,this.display.panel.vScrollBar.visible=!1,this.display.panelLog.vScrollBarSkin="ui/comp/vscroll.png",this.display.panelLog.vScrollBar.showButtons=!1,this.display.openCheckBox.on(Laya.Event.CHANGE,this,this.checkBoxChange),this.list=new laya.ui.List,this.list.vScrollBarSkin="ui/comp/vscroll.png",this.list.scrollBar.visible=!1,this.list.renderHandler=Handler.create(this,this.updateItem,null,!1),this.list.itemRender=i,this.display.addChild(this.list),this.list.x=238,this.list.y=100,this.list.repeatX=1,this.list.repeatY=10,this.list.spaceY=6,s.SELECT=0,this.netArr=[];for(var n=t.XHR().netArray.length,a=0;n>a;a++){var o=t.XHR().netArray[a],r=o.req;if(r){var h=r.cmd;"rollmsg"!=h&&"acthall"!=h&&this.netArr.push(o)}}this.list.array=this.netArr,s.LEN=this.list.array.length,this.setNetMsg(),t.EventCenter.singleton.on("NET_ITEM_CLICK",this,this.netItemClick);for(var l="",a=0;a<t.Logger.list.length;a++)l+=t.Logger.list[a]+"\n";this.display.txtLog.text=l,this.display.txtLog.height=this.display.txtLog.textField.textHeight,1==t.Global.JUMP_FIGHT&&(this.display.jumpFightCheckBox.selected=!0),1==t.Global.OPEN_LAYA_TEXT&&(this.display.opeLayaCheckBox.selected=!0),this.display.on(Laya.Event.CLICK,this,this.checkBoxClickHandler),this.display.menuTab.labels="网\n\n络,日\n\n志,工\n\n具",this.display.menuTab.selectHandler=new Handler(this,this.showTab),this.display.testLink.on(Laya.Event.CLICK,this,this.testGame),this.showTab(),Laya.timer.loop(1e3,this,this.setTimeTxt),this.setTimeTxt()}return __extends(s,e),s.prototype.setTimeTxt=function(){var e=t.ServerClock.getServerNowDate(),i=e.getMonth()+1<10?"0"+(e.getMonth()+1):String(e.getMonth()+1),s=e.getDate()<10?"0"+e.getDate():String(e.getDate()),n=e.getHours()<10?"0"+e.getHours():String(e.getHours()),a=e.getMinutes()<10?"0"+e.getMinutes():String(e.getMinutes()),o=e.getSeconds()<10?"0"+e.getSeconds():String(e.getSeconds());this.display.timeTxt.text=e.getFullYear()+"年"+i+"月"+s+"日 "+n+":"+a+":"+o,this.display.timeTxtMsg.text="服务器时间：周"+(0==e.getDay()?"日":e.getDay())},s.prototype.showTab=function(){var t=this.display.menuTab.selectedIndex;0==t?(this.display.panel.visible=!0,this.list.visible=!0,this.display.openCheckBox.visible=!0,this.display.timeTxt.visible=!0,this.display.timeTxtMsg.visible=!0,this.display.panelLog.visible=!1,this.display.page3Box.visible=!1,this.display.copyOneBtn.visible=!0,this.display.copyAllBtn.visible=!0,this.display.copyLogBtn.visible=!1):1==t?(this.display.panel.visible=!1,this.list.visible=!1,this.display.openCheckBox.visible=!1,this.display.timeTxt.visible=!1,this.display.timeTxtMsg.visible=!1,this.display.panelLog.visible=!0,this.display.page3Box.visible=!1,this.display.copyOneBtn.visible=!1,this.display.copyAllBtn.visible=!1,this.display.copyLogBtn.visible=!0):(this.display.panel.visible=!1,this.list.visible=!1,this.display.openCheckBox.visible=!1,this.display.timeTxt.visible=!1,this.display.timeTxtMsg.visible=!1,this.display.panelLog.visible=!1,this.display.page3Box.visible=!0,this.display.copyOneBtn.visible=!1,this.display.copyAllBtn.visible=!1,this.display.copyLogBtn.visible=!1)},s.prototype.testGame=function(){var t="/r11752";window.location.href=t+"/index.html"+location.search},s.prototype.checkBoxClickHandler=function(e){switch(e.target.name){case"jumpFightCheckBox":t.Global.JUMP_FIGHT=1==e.target.selected;break;case"opeLayaCheckBox":t.Global.OPEN_LAYA_TEXT=1==e.target.selected,t.Global.OPEN_LAYA_TEXT?Stat.show(0,Laya.Browser.clientHeight-100):Stat.hide();break;case"openFightTestBtn":t.Facade.callCommand(new t.FightTestCommand);break;case"friendBtn":t.Facade.callCommand(new t.InviteFriendCommand);break;case"copyOneBtn":t.JSUtils.copyToClipboard({text:this.display.txt.text},this.copyBack);break;case"copyAllBtn":t.JSUtils.copyToClipboard({text:this.netArr[this.netArr.length-1]},this.copyBack)}},s.prototype.copyBack=function(e){e?t.WeakTips.show("复制成功!"):t.WeakTips.show("复制失败!")},s.prototype.updateItem=function(t,e){e<=this.list.array.length-1&&t.doRender(this.list.array[e],e,this.netArr.length)},s.prototype.netItemClick=function(e){s.SELECT_BTN&&(s.SELECT_BTN.filters=t.FiltersUtils.getGreyFilters()),s.SELECT=e,this.setNetMsg()},s.prototype.setNetMsg=function(){var t;for(var e in this.netArr[s.SELECT].req)t+=e+"="+this.netArr[s.SELECT].req[e]+" ";t+="\n\n",t+="rsp:"+this.netArr[s.SELECT].rsp;var t="req:";for(var e in this.netArr[s.SELECT].req)t+=e+"="+this.netArr[s.SELECT].req[e]+" ";t+="\n\n",t+="rsp:"+this.netArr[s.SELECT].rsp,this.display.txt.text=t,this.display.txt.height=this.display.txt.textField.textHeight,this.display.panel.refresh(),this.display.panel.vScrollBar.value=0,this.display.panel.vScrollBar.stopScroll(),Laya.timer.frameOnce(3,this,this.check)},s.prototype.check=function(){0!=this.display.panel.vScrollBar.max?this.display.panel.vScrollBar.visible=!0:this.display.panel.vScrollBar.visible=!1},s.prototype.checkBoxChange=function(){this.display.txt.mouseEnabled=this.display.openCheckBox.selected},s.prototype.destroy=function(){Laya.timer.clear(this,this.setTimeTxt),this.netArr=null,s.SELECT_BTN=null,t.EventCenter.singleton.off("NET_ITEM_CLICK",this,this.netItemClick),this.display.off(Laya.Event.CLICK,this,this.checkBoxClickHandler),this.display.openCheckBox.off(Laya.Event.CHANGE,this,this.checkBoxChange),this.list&&(this.list.destroy(),this.list=null),e.prototype.destroy.call(this)},s}(t.BaseBox);t.NetMsgBox=e;var i=function(i){function s(){i.call(this),this.itemBtn.on(Laya.Event.CLICK,this,this.btnClick)}return __extends(s,i),s.prototype.doRender=function(i,s,n){this.index=s,this.itemBtn.label="("+(e.LEN-s)+")"+i.req.cmd,s==e.SELECT?(this.itemBtn.filters=null,e.SELECT_BTN=this.itemBtn):this.itemBtn.filters=t.FiltersUtils.getGreyFilters()},s.prototype.btnClick=function(){this.itemBtn.filters&&this.itemBtn.filters.length>0&&(t.EventCenter.singleton.event("NET_ITEM_CLICK",this.index),this.itemBtn.filters=null,e.SELECT_BTN=this.itemBtn)},s.prototype.destroy=function(){this.itemBtn.off(Laya.Event.CLICK,this,this.btnClick),i.prototype.destroy.call(this)},s}(ui.net.NetItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i){t.call(this,new ui.common.NoticeBoxUI,!0,!0),this.display=this.skin,this.setCloseButton(this.display.closeBtn),this.display.titleTxt.text=e,this.display.panel.vScrollBarSkin="ui/comp/vscroll.png",this.display.panel.vScrollBar.showButtons=!1,this.display.txt.style.fontFamily="黑体",this.display.txt.style.fontSize=26,this.display.txt.style.valign="top",this.display.txt.style.leading=10;for(var s=i.split("$"),n="",a=0;a<s.length;a++)n+=s[a],a!=s.length-1&&(n+="'");n+="<br>",this.display.txt.innerHTML=n,this.display.down.visible=!1,this.display.panel.vScrollBar.visible=!1,Laya.timer.frameOnce(3,this,this.check)}return __extends(e,t),e.prototype.check=function(){0!=this.display.panel.vScrollBar.max&&(this.display.panel.vScrollBar.visible=!0)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(t.BaseBox);t.NoticeBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.comp.PayConFirmUI,!0,!0),this.display=this.skin,this.name="ConfirmBox",this.canClickModelToClose=!1,
this.display.boxClose.on(Laya.Event.CLICK,this,this.goClose,[t.ConfirmBox.TYPE_CLOSE]),this.display.cancelBtn.on(Laya.Event.CLICK,this,this.goClose,[t.ConfirmBox.TYPE_CANCEL]),this.display.confirmBtn.on(Laya.Event.CLICK,this,this.onConfirm),this.display.payCheck.on(Laya.Event.CLICK,this,this.payCheck)}return __extends(i,e),i.prototype.payCheck=function(){i.PAY_CHECK=this.display.checkConfirm.selected?1:0},i.prototype.destroy=function(){Laya.timer.clear(this,this.onTimeOut),this.display.boxClose.off(Laya.Event.CLICK,this,this.goClose),this.display.cancelBtn.off(Laya.Event.CLICK,this,this.goClose),this.display.confirmBtn.off(Laya.Event.CLICK,this,this.onConfirm),e.prototype.destroy.call(this)},i.checkDouYu=function(e,s){var n=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL),a=t.Facade.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL),o=a.getDailyDataValue(t.ServerSetDataModel.KEY_BUY_CONFIRM);if(n.cash<e)t.WeakTips.show("您当前的货币不足啦~要不去充充值呀？");else if(n.douyu<e&&!o){var r=new t.ConfirmBoxData({isShowCancelBtn:!0,title:"支付提示",contentStr:"您当前操作消耗"+n.douyu+"斗鱼+"+(e-n.douyu)+"斗豆，是否继续？",callBackHandler:s});i.show(r)}else s.runWith(!0)},i.show=function(e,s){void 0===s&&(s=t.Layer.ALERT);var n=new i;return n.confirmData=e,n.display.msgContent.text=e.contentStr,n.display.msgTitile.text=e.title,n.display.confirmBtn.label=e.confirmStr,n.display.cancelBtn.label=e.cancleStr,n.display.boxClose.visible=e.isShowXBtn,n.display.confirmBtn.visible=e.isShowConfirmBtn,n.display.cancelBtn.visible=e.isShowCancelBtn,e.htmlStr&&(n.htmlTxt=new Laya.HTMLDivElement,n.htmlTxt.style.fontSize=n.display.msgContent.fontSize,n.htmlTxt.style.fontFamily="黑体",n.htmlTxt.style.leading=n.display.msgContent.leading,n.htmlTxt.style.bold=n.display.msgContent.bold,n.htmlTxt.width=n.display.msgContent.width,n.htmlTxt.height=n.display.msgContent.height,n.htmlTxt.style.align=n.display.msgContent.align,n.htmlTxt.style.valign=n.display.msgContent.valign,n.htmlTxt.style.stroke=n.display.msgContent.stroke,n.htmlTxt.style.lineHeight=23,n.htmlTxt.style.strokeColor=n.display.msgContent.strokeColor,n.htmlTxt.style.wordWrap=n.display.msgContent.wordWrap,n.htmlTxt.x=n.display.msgContent.x,n.htmlTxt.y=n.display.msgContent.y,n.htmlTxt.innerHTML=e.htmlStr,n.addChild(n.htmlTxt)),e.isShowConfirmBtn&&e.isShowCancelBtn?(n.display.confirmBtn.x=472,n.display.cancelBtn.x=707):e.isShowConfirmBtn?n.display.confirmBtn.x=588:e.isShowCancelBtn&&(n.display.cancelBtn.x=588),e.autoCloseTime>0&&Laya.timer.once(e.autoCloseTime,n,n.onTimeOut),n.show(s),n},i.prototype.onTimeOut=function(){this.goClose(t.ConfirmBox.TYPE_TIMEOUT,null)},i.prototype.goClose=function(t,e){if(this.confirmData&&this.confirmData.cancelCallBackHandler){var i=this.confirmData.cancelCallBackHandler;this.confirmData.cancelCallBackHandler=null,i.runWith({param:this.confirmData.param,type:t}),i.recover(),this.confirmData.deleteHandler()}this.confirmData=null,this.destroy()},i.prototype.onConfirm=function(){var e=t.Facade.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);if(1==i.PAY_CHECK&&e.setDailyDataValue(t.ServerSetDataModel.KEY_BUY_CONFIRM,1),this.confirmData&&this.confirmData.callBackHandler){var s=this.confirmData.callBackHandler;this.confirmData.callBackHandler=null,this.confirmData.param?s.runWith(this.confirmData.param):s.runWith(!0),s.recover(),this.confirmData.deleteHandler()}this.destroy()},i.PAY_CHECK=0,i}(t.BaseBox);t.PayConfirm=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t,i){e.call(this,new ui.common.PopBoxUI,!0,!0),this.display=this.skin,console.log(t),this.picData=t,this.target=i,this.init(),this.display.popPic.on(Laya.Event.CLICK,this,this.goTarget),this.display.boxClose.on(Laya.Event.CLICK,this,this.destroy)}return __extends(i,e),i.prototype.init=function(){this.display.popPic.skin=this.picData.url},i.prototype.goTarget=function(){t.Facade.callStrCommand(this.target),this.destroy()},i.prototype.destroy=function(){Laya.loader.clearRes("ui/comp/bg_front.png"),Laya.loader.clearRes("ui/comp/bg_behind.png"),this.display.popPic.off(Laya.Event.CLICK,this,this.goTarget),this.display.boxClose.off(Laya.Event.CLICK,this,this.destroy),Laya.loader.clearRes(this.picData.url),t.dispatch(t.MainModule.OPENBOXEVENT),e.prototype.destroy.call(this)},i}(t.BaseBox);t.PopBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.Event,i=function(i){function n(){i.call(this,new ui.common.RechargeUI,!0,!0,!0,!1),this._display=this.skin,this.setCloseButton(this._display.closeBtn),this._display.goBtn.on(e.CLICK,this,this.openShop),this._display.buyBtn.on(e.CLICK,this,this.buy),this._display.lst.itemRender=s,this._display.lst.renderHandler=new Handler(this,this.onListRender),t.Util.toGrayAndDisabled(this._display.buyBtn),this.updata()}return __extends(n,i),n.prototype.updata=function(){t.XHR().Post({cmd:"activity",aid:50},this,this.dataRet)},n.prototype.dataRet=function(e){this._data=e,0==e.result?(this._display.lst.array=e.details.items,this.setTime(),Laya.timer.loop(1e3,this,this.cutDown),0==this._data.status?t.Util.enable(this._display.buyBtn):t.Util.toGrayAndDisabled(this._display.buyBtn),this._display.bg_24.visible=0==e.type,this._display.bg_48.visible=1==e.type,this._display.buyBtn.label=0==e.type?"60斗豆购买":"120斗豆购买"):t.WeakTips.show(e.msg)},n.prototype.setTime=function(){var t=Math.floor(this._data.seconds/3600),e=Math.floor(this._data.seconds%3600/60);this._display.tfTime.text="剩余"+t+"小时"+e+"分"},n.prototype.cutDown=function(){this._data.seconds--,this._data.seconds<0?this.updata():this.setTime()},n.prototype.openShop=function(){var e=new t.OpenVipBoxCommand(1);t.Facade.callCommand(e),this.hide()},n.prototype.buy=function(){t.XHR().Post({cmd:"activity",aid:50,op:"buy"},this,function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),1==this._data.status,t.Util.toGrayAndDisabled(this._display.buyBtn),t.dispatch("Recharge_succ"),t.dispatch(t.ShareModule.SHARE_MODULE_EVENT,{type:101,id:this._data.type})):t.WeakTips.show(e.msg)})},n.prototype.onListRender=function(t,e){t.setData(this._display.lst.getItem(e))},n.prototype.destroy=function(){Laya.timer.clear(this,this.cutDown),this._display.buyBtn.off(e.CLICK,this,this.buy),this._display.goBtn.off(e.CLICK,this,this.openShop),i.prototype.destroy.call(this)},n}(t.BaseBox);t.RechargeBox=i;var s=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.setData=function(e){this.tfNum.text=e.num?"x"+e.num:"x"+e.hours+"小时",this.imgGift.skin=t.ResPath().getPic(e.icon_id,t.ResourcePath.PATH_GOODS)},i}(ui.common.RechargeItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){if(t.call(this,new ui.comp.RulePanelUI,!0,!1,!0,!1),e._singleton)throw new Error("单例！！！");this.m_ui=this.skin,this.setCloseButton(this.m_ui.btnClose),this.m_ui.contentBox.vScrollBar.showButtons=!1,this.m_ui.contentBox.vScrollBar.autoHide=!0,this.m_ui.backImg.forceSkin=!0}return __extends(e,t),Object.defineProperty(e,"singleton",{get:function(){return e._singleton||(e._singleton=new e),e._singleton},enumerable:!0,configurable:!0}),e.prototype.initWithHtml=function(t,e){this["final"](),this.p=new Laya.HTMLDivElement,this.m_ui.contentBox.addChild(this.p),this.p.style.fontSize=28,this.p.style.fontFamily="黑体",this.p.style.color="#7c5831",this.p.style.leading=10,this.p.style.width=506,this.p.style.valign="top",this.p.x=15,t+="<br>",this.p.innerHTML=t,this.m_ui.title.text=e},e.prototype.initWithDisplay=function(t,e){this["final"](),this.s=t,t.x=(this.m_ui.contentBox.width-t.width)/2,t.y=0,this.m_ui.contentBox.addChild(t),this.m_ui.title.text=e},e.showRule=function(t,i){var s=e.singleton;s.m_ui.contentBox.vScrollBar.value=0,s.initWithHtml(t,i),s.show()},e.showRule2=function(t,i){var s=e.singleton;s.m_ui.contentBox.vScrollBar.value=0,s.initWithDisplay(t,i),s.show()},e.prototype["final"]=function(){this.p&&(this.m_ui.contentBox.removeChild(this.p),this.p=null),this.s&&(this.m_ui.contentBox.removeChild(this.s),this.s=null)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e.prototype.onShowed=function(){t.prototype.onShowed.call(this),this.m_ui.backImg.skin="ui/rule/img_004.png"},e.prototype.onHided=function(){t.prototype.onHided.call(this),Laya.Loader.clearRes("ui/rule/img_004.png")},e}(t.BaseBox);t.RulePanel=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){function e(e,s,n){var a=t.Icon.MAIN_SCENE[s];if(a){var r=new o(e,n,a.localToGlobal(new i(a.width/2,a.height/2)));t.LayerMgr.addChild(r,t.Layer.LOADING)}}var i=laya.maths.Point,s=laya.utils.Ease,n=laya.display.Sprite,a=function(s){function n(t){s.call(this,new ui.common.ShowNewPowerUI,!0,!0),this.display=this.skin,this.name="ShowNewPowerBox",this.canClickModelToClose=!1,this._lv=t,this.display.queDingBtn.on(Laya.Event.CLICK,this,this.onClick);for(var e=this.display.allPngBox.numChildren,i=0;e>i;i++){var n=this.display.allPngBox.getChildAt(i);n.visible=!1,n.mouseEnabled=!1}}return __extends(n,s),n.prototype.onShowed=function(){s.prototype.onShowed.call(this),this._points=[],3==this._lv?(this.display.msgTxt.text="强化升星，武器技能大增强！",this.display.lv3Png_1.visible=!0,this._points.push(this.display.lv3Png_1.localToGlobal(new i(0,0)))):4==this._lv?(this.display.msgTxt.text="邀请好友，一起乐斗！",this.display.lv7Png_1.visible=!0,this._points.push(this.display.lv7Png_1.localToGlobal(new i(0,0)))):5==this._lv?(this.display.msgTxt.text="精彩活动，大量奖励拿不停！",this.display.lv5Png_1.visible=!0,this.display.lv5Png_2.visible=!0,this._points.push(this.display.lv5Png_1.localToGlobal(new i(0,0))),this._points.push(this.display.lv5Png_2.localToGlobal(new i(0,0)))):6==this._lv?(this.display.msgTxt.text="商城开启，强力道具买不停！",this.display.lv6Png_1.visible=!0,this._points.push(this.display.lv6Png_1.localToGlobal(new i(0,0)))):7==this._lv?(this.display.msgTxt.text="经脉贯通，历练江湖实力强！",this.display.lv3Png_2.visible=!0,this.display.lv4Png.visible=!0,this._points.push(this.display.lv4Png.localToGlobal(new i(0,0))),this._points.push(this.display.lv3Png_2.localToGlobal(new i(0,0)))):8==this._lv?(this.display.msgTxt.text="易容幻术，看我72变！",this.display.lv8Png.visible=!0,this._points.push(this.display.lv8Png.localToGlobal(new i(0,0)))):9==this._lv?(this.display.msgTxt.text="成帮立派，团结齐心共风雨！",this.display.lv9Png.visible=!0,this._points.push(this.display.lv9Png.localToGlobal(new i(0,0)))):10==this._lv?(this.display.msgTxt.text="武林大会，群英汇聚争第一！",this.display.lv10Png.visible=!0,this._points.push(this.display.lv10Png.localToGlobal(new i(0,0))),this.display.lv6Png_2.visible=!0,this._points.push(this.display.lv6Png_2.localToGlobal(new i(0,0)))):11==this._lv?(this.display.msgTxt.text="拜师学艺，师徒齐心升级快！",this.display.lv11Png.visible=!0,this._points.push(this.display.lv11Png.localToGlobal(new i(0,0)))):12==this._lv?(this.display.msgTxt.text="海纳百川，役众英杰为家丁！",this.display.lv12Png.visible=!0,this._points.push(this.display.lv12Png.localToGlobal(new i(0,0)))):13==this._lv?(this.display.msgTxt.text="魂珠现世，镶嵌魂珠武器强！",this.display.lv15Png_1.visible=!0,this._points.push(this.display.lv15Png_1.localToGlobal(new i(0,0)))):14==this._lv?(this.display.msgTxt.text="英雄试练，魂珠威望闯关拿！",this.display.lv14Png.visible=!0,this._points.push(this.display.lv14Png.localToGlobal(new i(0,0)))):15==this._lv?(this.display.msgTxt.text="装备密卷，武器连锁有奇效！",this.display.lv7Png_2.visible=!0,this.display.lv15Png_2.visible=!0,this._points.push(this.display.lv7Png_2.localToGlobal(new i(0,0))),this._points.push(this.display.lv15Png_2.localToGlobal(new i(0,0)))):20==this._lv?(this.display.msgTxt.text="千层妖塔，仗剑除魔任叱咤！",this.display.lv20Png_1.visible=!0,this.display.lv20Png_2.visible=!0,this.display.lv20Png_3.visible=!0,this._points.push(this.display.lv20Png_1.localToGlobal(new i(0,0))),this._points.push(this.display.lv20Png_2.localToGlobal(new i(0,0))),this._points.push(this.display.lv20Png_3.localToGlobal(new i(0,0)))):25==this._lv?(this.display.msgTxt.text="排位争霸，青铜王者大乱斗！",this.display.lv25Png.visible=!0,this.display.lv25Png_2.visible=!0,this.display.lv25Png_3.visible=!0,this._points.push(this.display.lv25Png.localToGlobal(new i(0,0))),this._points.push(this.display.lv25Png_2.localToGlobal(new i(0,0))),this._points.push(this.display.lv25Png_3.localToGlobal(new i(0,0)))):30==this._lv&&(this.display.msgTxt.text="开启新密卷，出战密卷数量提升！",this.display.lv30Png_1.visible=!0,this.display.lv30Png_2.visible=!0,this._points.push(this.display.lv30Png_1.localToGlobal(new i(0,0))),this._points.push(this.display.lv30Png_2.localToGlobal(new i(0,0))))},n.prototype.onClick=function(){var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.GUIDE_MODEL);3==this._lv?e.guidetaskID=245:6==this._lv&&(e.guidetaskID=60001),(5==this._lv||7==this._lv||this._lv>=9)&&(e.guidetaskID=1e4*this._lv,7==this._lv&&(e.guidetaskID=246),t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.LV_GUIDE)));var i=new t.HomeCommand;i.on(this,this.onCmd),t.Facade.callCommand(i)},n.prototype.onCmd=function(t){t.off(),3==this._lv?e("ui/main/sbtn1_upgrade.png","upLevelBtn",this._points[0]):4==this._lv?e("ui/main/sbtn1_addFriend.png","addFriendBtn",this._points[0]):5==this._lv?(e("ui/main/sbtn1_activity.png","activityBtn",this._points[0]),e("ui/main/sbtn1_weaponChip.png","taskBtn",this._points[1])):6==this._lv?e("ui/main/sbtn1_shop.png","shopBtn",this._points[0]):7==this._lv?(e("ui/main/sbtn1_channel.png","userBtn",this._points[0]),e("ui/main/sbtn1_lilian.png","xkxBtn",this._points[1])):8==this._lv?e("ui/main/sbtn1_change72.png","shoujiBtn",this._points[0]):9==this._lv?e("ui/main/sbtn1_faction.png","shejiaoBtn",this._points[0]):10==this._lv?(e("ui/main/sbtn1_match.png","qyhBtn",this._points[0]),e("ui/main/sbtn1_bag.png","bagBtn",this._points[1])):11==this._lv?e("ui/main/sbtn1_master.png","shejiaoBtn",this._points[0]):12==this._lv?e("ui/main/sbtn1_servent.png","qyhBtn",this._points[0]):13==this._lv?e("ui/main/sbtn1_gem.png","upLevelBtn",this._points[0]):14==this._lv?e("ui/main/sbtn1_hero.png","xkxBtn",this._points[0]):15==this._lv?(e("ui/main/sbtn1_chain.png","upLevelBtn",this._points[0]),e("ui/main/sbtn1_channel.png","userBtn",this._points[1])):20==this._lv?(e("ui/main/sbtn1_tower.png","xkxBtn",this._points[0]),e("ui/main/sbtn1_channel.png","userBtn",this._points[1]),e("ui/main/sbtn1_chain.png","upLevelBtn",this._points[2])):25==this._lv?(e("ui/main/sbtn1_channel.png","userBtn",this._points[0]),e("ui/main/sbtn1_champion.png","championBtn",this._points[1]),e("ui/main/sbtn1_monster.png","monsterBtn",this._points[2])):30==this._lv&&(e("ui/main/sbtn1_channel.png","userBtn",this._points[0]),e("ui/main/sbtn1_chain.png","upLevelBtn",this._points[1])),this._points=null},n.prototype.destroy=function(){this.display.queDingBtn.off(Laya.Event.CLICK,this,this.onClick),s.prototype.destroy.call(this),t.BoxMgr.hideAll()},n}(t.BaseBox);t.ShowNewPowerBox=a,t.addPowerFlyAni=e;var o=function(e){function i(i,n,a){e.call(this),this.w=104,this.h=88,this.loadImage(i,0,0,this.w,this.h),this.width=this.w,this.height=this.h,this.pivotX=this.w/2,this.pivotY=this.h/2,this.x=n.x+this.w/2,this.y=n.y+this.h/2,this.scaleX=1.5,this.scaleY=1.5,Laya.Tween.to(this,{x:a.x,y:a.y-t.LayerMgr.offY,scaleX:.8,scaleY:.8},800,s.linearOut,new Handler(this,this.destroy))}return __extends(i,e),i}(n);t.PowerFlyAniProvider=o}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Animation,i=laya.maths.Point,s=function(s){function n(i,n,a,o,r,h,l){void 0===o&&(o=!1),void 0===r&&(r=0),void 0===h&&(h=""),void 0===l&&(l=!1),s.call(this,new ui.common.ShowGetRewardViewNewUI,!0,!0),this.spWidth1=0,this.spWidth2=0,this._scaleCount=0,this._showSpeed=30,this.display=this.skin,this.cacheAs="none",this.display.mainLayer.cacheAs="bitmap",this.name="CommoRewardBox",this.canClickModelToClose=!1,this.sp1=new Sprite,this.display.sp.addChild(this.sp1),this.handler=a,this.setCloseButton(this.display.queDingBtn),this.display.msgContent.visible=!1,this.display.msgContent.text=i||"",this.display.againBtn.on(Laya.Event.CLICK,this,this.againBtnClickHandler),1==o?(this.display.againBtn.visible=!0,this.display.times.text=h,this.display.costValue.text=r+"",l&&(this.display.douYuPng.skin="ui/comp/kDouBi.png")):this.display.queDingBtn.x=552,this.listData=n;var c=this.listData.length,d=4>=c?1:2,u=8>=c?4:6;d>=2&&(this.sp2=new Sprite,this.display.sp.addChild(this.sp2));for(var p=0,_=1,f=0;c>f;f++){var y=new ui.common.ShowGetRewardNewItemUI;y.scaleX=y.scaleY=0,y.cacheAs="none",y.mainLayer.cacheAs="bitmap",y.nameTxt.visible=!1,y.idTxt.visible=!1;var m=this.listData[f];if(y.idTxt.text=m.id,y.icon.skin=t.ResPath().getPic(m.id,t.ResourcePath.PATH_GOODS),y.nameTxt.text=m.name,y.nameTxt1.text=m.name,y.nameTxt2.text=m.name,y.nameTxt.textWidth>128?(y.nameTxt1.visible=!1,y.nameTxt2.visible=!0):(y.nameTxt1.visible=!0,y.nameTxt2.visible=!1),m.id>=200001&&m.id<=4e5){y.numTxt.text=t.DateUtils.getStrByHours(m.hours);var g=new e;g.name="ani",g.scaleX=g.scaleY=1,g.loadAtlas("res/atlas/ui/item_movie.json"),g.interval=95,g.index=1,y.sp.addChild(g),g.x=-29,g.y=-55,g.visible=!0,g.play()}else y.numTxt.text="×"+m.num;!function(e,i){i.on(Laya.Event.CLICK,this,function(){var s,n={};s=i.localToGlobal(new laya.maths.Point(0,0)),n.name=e.name,n.desc=e.itemObj.desc?e.itemObj.desc:e.itemObj.effect_desc,t.Tips.show(n,s)})}(m,y),this["sp"+_].addChild(y),this["spWidth"+_]+=0==p?145:160,y.x=p,p+=160,(f+1)%u==0&&(p=0,_+=1)}this.sp1.x=(t.LayerMgr.width-this.spWidth1)/2+73,this.sp2?(this.sp1.y=(t.LayerMgr.height-this.sp1.height)/2-155,this.sp2.x=(t.LayerMgr.width-this.spWidth2)/2+73,this.sp2.y=this.sp1.y+155):(this.sp1.y=(t.LayerMgr.height-this.sp1.height)/2-105,this.display.msgContent.y+=15),""==this.display.msgContent.text&&(this.sp1.y-=20,this.sp2&&(this.sp2.y-=20));var v=-400,C=-400;this._movieLight=new t.AnimationSKe("assets/skeleton/hj.sk",1),this.display.spMovieBeh.addChild(this._movieLight),this._movieLight.x=t.LayerMgr.width/2+v,this._movieLight.y=340+C,this._movieLight.play(1,!0),this.display.maskMc.visible=!1,this._movieLight.scrollRect=new Laya.Rectangle(v,C,800,192),this._movieAll=new t.AnimationSKe("assets/skeleton/hj.sk",1),this._movieAll.showSkinByName("gxhd"),this.display.spMovieBeh.addChild(this._movieAll),this._movieAll.x=t.LayerMgr.width/2,this._movieAll.y=340,this._movieAll.play(0,!1);var w=new Sprite;w.graphics.drawRect(0,0,t.LayerMgr.width,t.LayerMgr.clientHeight,"#000000"),w.alpha=.8,w.y=-t.LayerMgr.offY,w.mouseEnabled=!0,w.size(t.LayerMgr.width,t.LayerMgr.clientHeight),this.display.addChildAt(w,0),this._scaleValueArr=[],this._scaleStepArr=[],this._scaleCount=0,Laya.timer.once(200,this,this.delaySetScale)}return __extends(n,s),n.prototype.delaySetScale=function(){this.display.msgContent.visible=!0,Laya.timer.loop(30,this,this.setScale)},n.prototype.setScale=function(){this._scaleCount++;var t=0,e=this.sp1.numChildren;this.sp2&&(e+=this.sp2.numChildren);var i=0;if(this.sp1)for(var s=this.sp1.numChildren,n=0;s>n;n++)if(t++,this._scaleCount>3*(t-1)){this._scaleValueArr.length<t&&(this._scaleValueArr[t-1]=0,this._scaleStepArr[t-1]=this._showSpeed);var a=this._scaleValueArr[t-1],o=this._scaleStepArr[t-1];if(o==this._showSpeed||a>100){a+=o,this._scaleValueArr[t-1]=a;var r=this.sp1.getChildAt(n);r.scaleX=r.scaleY=a/100,o==this._showSpeed&&a>=120&&(o=-4,this._scaleStepArr[t-1]=o)}else i++}if(this.sp2)for(var h=this.sp2.numChildren,n=0;h>n;n++)if(t++,this._scaleCount>3*(t-1)){this._scaleValueArr.length<t&&(this._scaleValueArr[t-1]=0,this._scaleStepArr[t-1]=this._showSpeed);var a=this._scaleValueArr[t-1],o=this._scaleStepArr[t-1];if(o==this._showSpeed||a>100){a+=o,this._scaleValueArr[t-1]=a;var r=this.sp2.getChildAt(n);r.scaleX=r.scaleY=a/100,o==this._showSpeed&&a>=120&&(o=-4,this._scaleStepArr[t-1]=o)}else i++}i==e&&Laya.timer.clear(this,this.setScale)},n.prototype.hide=function(){for(var t=this.sp1.numChildren,e=0;t>e;e++){var i=this.sp1.getChildAt(e);this.addDropAniByItem(i)}if(this.sp2)for(var n=this.sp2.numChildren,e=0;n>e;e++){var i=this.sp2.getChildAt(e);this.addDropAniByItem(i)}s.prototype.hide.call(this)},n.prototype.addDropAniByItem=function(e){var s=e.icon.localToGlobal(new i(e.icon.width/2,e.icon.height/2));s.y=s.y-t.LayerMgr.offY,t.addDropAni(e.idTxt.text,s)},n.prototype.againBtnClickHandler=function(){this.event("AGAIN")},n.prototype.destroy=function(){if(this.display.againBtn.off(Laya.Event.CLICK,this,this.againBtnClickHandler),Laya.timer.clear(this,this.delaySetScale),Laya.timer.clear(this,this.setScale),this._scaleValueArr=null,this._scaleStepArr=null,t.dispatch(n.SHOW_REWARD_BOX_END,{data:this.listData}),this.sp1){for(;this.sp1.numChildren>0;){var e=this.sp1.removeChildAt(0),i=e.getChildByName("ani");i&&i.stop()}this.sp1.destroy(),this.sp1=null}if(this.sp2){for(;this.sp2.numChildren>0;){var e=this.sp2.removeChildAt(0),i=e.getChildByName("ani");i&&i.stop()}this.sp2.destroy(),this.sp2=null}this._movieLight&&(this._movieLight.destroy(),this._movieLight=null),this._movieAll&&(this._movieAll.destroy(),this._movieAll=null),this.listData=null,this.handler&&(this.handler.run(),this.handler=null),this.display&&(this.display=null),Laya.loader.clearRes("assets/skeleton/hj.sk"),s.prototype.destroy.call(this)},n.SHOW_REWARD_BOX_END="SHOW_REWARD_BOX_END",n}(t.BaseBox);t.ShowRewardBoxNew=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i,s){e.call(this,new View,!0,!0),this.display=this.skin,this.display.width=600,this.display.height=600,this.cacheAs="none",this._ske=new t.AnimationSKe(t.ResPath().getEffect("effect_nbwq"),1),this._ske.play(0,!0),this._ske.x=300,this._ske.y=300,this._ske.setSlotSkin("guo",Laya.Loader.getRes("ui/comp/vscroll_empty.png")),this.display.addChild(this._ske),this._tips=new Laya.Image;var n=s>=0?"specialWeapon":"darenWeapon";this._tips.skin=t.ResPath().getPic(n,t.ResourcePath.PATH_TIP),this._tips.x=100,this._tips.y=400,this.display.addChild(this._tips),Laya.loader.load(t.ResPath().getPic(i,t.ResourcePath.PATH_WEAPON),Handler.create(this,this.onLoad))}return __extends(i,e),i.prototype.destroy=function(){this._ske&&(this._ske.parent&&this._ske.parent.removeChild(this._ske),this._ske.destroy(),this._ske=null),this._tips.destroy(),this._tips=null,Laya.stage.off(Laya.Event.CLICK,this,this.hide),e.prototype.destroy.call(this)},i.prototype.onLoad=function(t){Laya.stage.on(Laya.Event.CLICK,this,this.hide),this._ske.setSlotSkin("guo",t)},i}(t.BaseBox);t.ShowSpecialWeapon=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i){e.call(this,new ui.common.ShowUpAnimationUI,!0,!0),this.playerlevel=0,this._shareflag=!1,this.skillArr=[300003,300004,300005,300006,300007,300053,300059,300054,300060,300049,300050,300051,300052],this.display=this.skin,this.canClickModelToClose=!0,this.name="ShowUpAnimationUI",this._cmd=i,this._data=i.arr,this._shareflag=i.type,this.leveltype=[0,6,10],this.display.menu0.on(Laya.Event.CLICK,this,this.showTab,[0]),this.display.menu1.on(Laya.Event.CLICK,this,this.showTab,[1]),this.display.menu2.on(Laya.Event.CLICK,this,this.showTab,[2]),this.display.closeBtn.on(Laya.Event.CLICK,this,this.destroy),this.display.shareBtn.visible=!1,this.display.shareBtn.on(Laya.Event.CLICK,this,this.shareFriend),this.display.bgBox.skin="ui/upanimation/10002.jpg",this.display.bg.y=-t.LayerMgr.offY,this.display.bg.graphics.drawRect(0,0,t.LayerMgr.width,t.LayerMgr.clientHeight,"#333333"),this.init(),this.display.closeBtn.x-=t.Global.FLOAT_ICON_OFFSET}return __extends(i,e),i.prototype.init=function(){if(0==this._data.uptype)this._data.name="潜心修炼",this._data.desc="你在本级升级过程获得了潜心状态：力量，筋骨，速度额外提升1点，额外获得2点可分配点数。并使你下次升级时一定会获得武器或者技能。",this.display.qianxinIcon.skin=t.ResPath().getPic(1,t.ResourcePath.PATH_STATUS),this.display.animtionBox.visible=!1,this.display.skillBox.visible=!1,this.display.noSkill.visible=!0;else if(this.isPassiveSkill(this._data.id))this._data.uptype=0,t.XHR().Post({cmd:"cfgout",subcmd:"skill",lvl:"0|6|10",id:this._data.id},this,this.getName),this.display.animtionBox.visible=!1,this.display.skillBox.visible=!0,this.display.noSkill.visible=!1;else{var e=["","weapon","skill"];this.display.animtionBox.visible=!0,this.display.skillBox.visible=!1,this.display.noSkill.visible=!1,this.display.weaponName.text=this._data.name,this.display.weaponDesc.text=this._data.desc,this.animLevel0||(this.animLevel0=new t.ShowFighter),this.display.animBox.addChild(this.animLevel0),this.animLevel0.x=350,this.animLevel0.y=650,1==this._data.isage?(this.display.skillbg0.visible=!1,this.display.skillbg1.visible=!1,this.display.skillbg2.visible=!1):(this.display.skillbg0.skin="ui/upanimation/drxx-wuqixuanzhong.png",this.display.skillbg1.skin="ui/upanimation/drxx-wuqixuanzhong.png",this.display.skillbg2.skin="ui/upanimation/drxx-wuqixuanzhong.png"),t.XHR().Post({cmd:"cfgout",subcmd:e[this._data.uptype],lvl:"0|6|10",id:this._data.id},this,this.getName),this.showAnimData(),this.showUpAnimation()}},i.prototype.isPassiveSkill=function(t){for(var e=!1,i=0;i<this.skillArr.length;i++)if(t==this.skillArr[i])return!0;return e},i.prototype.getName=function(e){0==e.result&&(0==this._data.uptype?(this.leveldata=e.skill_config,this.display.skillIcon0.skin=t.ResPath().getPic(this._data.id,t.ResourcePath.PATH_SKILL,0),this.display.skillIcon1.skin=t.ResPath().getPic(this._data.id,t.ResourcePath.PATH_SKILL,6),this.display.skillIcon2.skin=t.ResPath().getPic(this._data.id,t.ResourcePath.PATH_SKILL,10),this.display.skillName0.text=this.leveldata[0].name,this.display.skillName1.text=this.leveldata[1].name,this.display.skillName2.text=this.leveldata[2].name,this.display.skillDesc0.text=this.leveldata[0].desc+this.leveldata[0].effect,this.display.skillDesc1.text=this.leveldata[1].desc+this.leveldata[1].effect,this.display.skillDesc2.text=this.leveldata[2].desc+this.leveldata[2].effect):(1==this._data.uptype?this.leveldata=e.weapon_config:this.leveldata=e.skill_config,this.display.nameTxt0.text=this.leveldata[0].name,this.display.nameTxt1.text=this.leveldata[1].name,this.display.nameTxt2.text=this.leveldata[2].name),1==e.existed&&0==e.shared?(this.display.shareBtn.visible=!0,t.Global.isWXAPP&&(this.display.shareBtn.label="点击分享")):1==e.existed&&(this.display.shareBtn.label="点击分享",this.display.shareBtn.x=this.display.shareBtn.x-85,this.display.shareBtn.visible=!0,this.display.doudouGift.visible=!1))},i.prototype.showAnimData=function(){this.animLevel0.on(Laya.Event.COMPLETE,this,this.playAnim)},i.prototype.showTab=function(t){this.playerlevel=t,this.display.menu0.skin="ui/upanimation/menu1.png",this.display.menu1.skin="ui/upanimation/menu1.png",this.display.menu2.skin="ui/upanimation/menu1.png",this.display.skillbg0.skin="ui/upanimation/drxx-wuqixuanzhong.png",this.display.skillbg1.skin="ui/upanimation/drxx-wuqixuanzhong.png",this.display.skillbg2.skin="ui/upanimation/drxx-wuqixuanzhong.png",this.display.nameTxt0.color="#999999",this.display.nameTxt1.color="#999999",this.display.nameTxt2.color="#999999",this.display["menu"+t].skin="ui/upanimation/menu2.png",this.display["skillbg"+t].skin="ui/upanimation/drxx-wuqimodi.png",this.display["nameTxt"+t].color="#FFFF00",this.leveldata&&(this.display.weaponName.text=this.leveldata[this.playerlevel].name,this.display.weaponDesc.text=this.leveldata[this.playerlevel].desc+"\n"+this.leveldata[this.playerlevel].effect),this.showUpAnimation()},i.prototype.playAnim=function(){1!=this._data.isage?(this.playerlevel<2?this.playerlevel++:this.playerlevel=0,this.showTab(this.playerlevel)):this.showUpAnimation()},i.prototype.showUpAnimation=function(){var e;1==this._data.uptype?(e=this._data.id%1e5,this.animLevel0.playWeapon(e,this.leveltype[this.playerlevel]),this.display.weaponIcon.skin=t.ResPath().getPic(this._data.id,t.ResourcePath.PATH_WEAPON,this.leveltype[this.playerlevel]),this.display.menu0.skin=t.ResPath().getPic(this._data.id,t.ResourcePath.PATH_WEAPON,0),this.display.menu1.skin=t.ResPath().getPic(this._data.id,t.ResourcePath.PATH_WEAPON,6),this.display.menu2.skin=t.ResPath().getPic(this._data.id,t.ResourcePath.PATH_WEAPON,10)):2==this._data.uptype&&(e=this._data.id%1e5,this.animLevel0.playSkill(e,this.leveltype[this.playerlevel]),this.display.weaponIcon.skin=t.ResPath().getPic(this._data.id,t.ResourcePath.PATH_SKILL,this.leveltype[this.playerlevel]),this.display.menu0.skin=t.ResPath().getPic(this._data.id,t.ResourcePath.PATH_SKILL,0),this.display.menu1.skin=t.ResPath().getPic(this._data.id,t.ResourcePath.PATH_SKILL,6),this.display.menu2.skin=t.ResPath().getPic(this._data.id,t.ResourcePath.PATH_SKILL,10))},i.prototype.shareFriend=function(){var e=1==this._data.uptype?4:5,i=1==this._data.uptype?20:21,s="";s=4==e?t.Global.isWXAPP?t.ShareModule.getWXAPPWeaponShareUrl(this._data.id,1):t.ResPath().getPic(this._data.id,t.ResourcePath.PATH_WEAPON,0):t.Global.isWXAPP?t.ShareModule.getWXAPPSkillShareUrl(this._data.id,1):t.ResPath().getPic(this._data.id,t.ResourcePath.PATH_SKILL,0),this.leveldata&&t.ShareModule.shareMessage({title:[this.leveldata[0].name],desc:[this.leveldata[0].desc+"我新得了"+this.leveldata[0].name+"，快来看看看吧!"],alertType:1,command:1002,param:e,image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(s),param2:this.leveldata[0].id},Handler.create(this,this.shareCallBack),i)},i.prototype.shareCallBack=function(t){0!=t.iRet&&0!=t.retCode||(this._shareflag=!1,this.display.shareBtn.visible=!1)},i.prototype.destroy=function(){this.display.closeBtn.off(Laya.Event.CLICK,this,this.destroy),this.animLevel0&&(this.animLevel0.off(Laya.Event.COMPLETE,this,this.playAnim),this.animLevel0.destroy()),Laya.loader.clearRes("ui/upanimation/10002.jpg"),e.prototype.destroy.call(this);for(var i=t.BoxMgr.boxs.length,s=0;i>s;s++)"ShowNewPowerBox"==t.BoxMgr.boxs[s].name&&(t.BoxMgr.boxs[s].alpha=1)},i}(t.BaseBox);t.ShowUpAnimation=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=Laya.SoundManager,s=function(s){function n(){s.call(this),this._isActive=!0}return __extends(n,s),n.prototype.initialize=function(e){this._isActive=!0,t.Logger.log("声音插件加载成功");var s=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);s&&s.severDataHasLoaded?this.onServerData():t.addListener(t.ServerSetDataModel.SERVER_SET_DATA_MODEL_RESULT,this,this.onServerData),t.addListener(t.MainView.MAIN_VIEW_SOUND,this,this.onMainView),t.addListener(t.FightStaticStr.PLAY_FIGHT_SOUND,this,this.onFightSound),t.addListener(n.PLAY_SOUND,this,this.onPlaySound),t.addListener(n.STOP_MUSIC,this,this.onStopMusic),t.addListener(t.RetrenchMode.EVENT_RETRENCH_MODE_CHANGE,this,this.onRetrenchChange),i.autoStopMusic=!1,t.GameSleep().AddFuc(this,this.onGameSleep)},n.prototype.onGameSleep=function(e){this._isActive=e,e?(t.Global.isRetrench||("main"==this._curMusicStr?this.onMainView():this.onFightSound()),
Laya.timer.once(500,this,this.resetWindow,null,!1),Laya.timer.once(1500,this,this.resetWindow,null,!1),Laya.timer.once(2500,this,this.resetWindow,null,!1)):this.onStopMusic()},n.prototype.onStopMusic=function(){this._musicChannel&&(this._musicChannel.stop(),i.removeChannel(this._musicChannel)),window.audioAutoPlay&&window.audioAutoPlay("")},n.prototype.resetWindow=function(){t.Global.isWXAPP||window.dispatchEvent(new Event("resize"))},n.prototype.onServerData=function(){var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);e&&(e.musicVol>50?this.onMainView():(this._musicChannel&&(this._musicChannel.stop(),i.removeChannel(this._musicChannel)),i.stopMusic()))},n.prototype.doCommand=function(t){switch(t.getCommandName()){case"BagCommand":}},n.prototype.getPluginName=function(){return e.PLUGIN_SOUND},n.prototype.onMainView=function(){this._curMusicStr="main";var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);!t.Global.isRetrench&&e&&e.severDataHasLoaded&&(e.musicVol>50?(Laya.SoundManager.playbackRate=1,this._musicChannel=i.playMusic(t.ResPath().getSound("main"))):this._musicChannel=i.playMusic("")),window.audioAutoPlay&&window.audioAutoPlay("")},n.prototype.onFightSound=function(){if(this._curMusicStr="fight",!t.Global.isRetrench){this._musicChannel&&this._musicChannel.stop();var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);!e||e.musicVol>50?t.Global.isWXAPP?this._musicChannel=i.playMusic(t.ResPath().getSound("fight")):window.audioAutoPlay&&window.audioAutoPlay(t.ResVersionControl.handelVersionUrl(t.ResPath().getSound("fight"))):this._musicChannel=i.playMusic("")}},n.prototype.onPlaySound=function(e){if(""!=e&&!t.Global.isRetrench&&this._isActive){var s=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);(!s||s.soundVol>50)&&i.playSound(t.ResPath().getSound(e))}},n.prototype.onRetrenchChange=function(){t.Global.isRetrench?this._musicChannel&&(this._musicChannel.stop(),i.removeChannel(this._musicChannel)):"main"==this._curMusicStr?this.onMainView():"fight"==this._curMusicStr&&this.onFightSound()},n.PLAY_SOUND="PLAY_SOUND",n.STOP_MUSIC="STOP_MUSIC",n}(t.Plugin);t.SoundModule=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.Event,i=function(i){function s(){i.call(this,new ui.common.WbGiftUI,!0,!0,!0,!1),this._display=this.skin,this.setCloseButton(this._display.closeBtn),this._display.getBtn.on(e.CLICK,this,this.getGift)}return __extends(s,i),s.prototype.getGift=function(){t.XHR().Post({cmd:"activity",aid:39,op:"reward"},this,function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),t.Util.toGrayAndDisabled(this._display.getBtn)):t.WeakTips.show(e.msg);var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);i.setLongDataValue(t.ServerSetDataModel.KEY_HAS_GOT_WB_GIFT,1)})},s.prototype.destroy=function(){Laya.loader.clearRes("ui/act/wb_gfit.jpg"),t.dispatch(t.MainModule.OPENBOXEVENT),this._display.getBtn.off(e.CLICK,this,this.getGift),i.prototype.destroy.call(this)},s}(t.BaseBox);t.WbGiftBox=i}(hf||(hf={}));var hf;!function(t){function e(){var e=t.Facade.singleton;return e}var i=laya.utils.Dictionary,s=t.ModelMgr,n=function(){function e(){if(null!=e._singleton)throw Error("SINGLETON");e._singleton=this,this.initializeFacade()}return Object.defineProperty(e,"singleton",{get:function(){return null==e._singleton&&new e,e._singleton},enumerable:!0,configurable:!0}),e.prototype.startup=function(){},e.prototype.initializeFacade=function(){this.model=new s,this.pluginMap=new i,this.commandMap=new i,this.registerPlugin(new t.PluginMgr,{}),this.registerPlugin(new t.CommandMgr,{})},e.prototype.registerPlugin=function(t,e){return this.hasPlugin(t.getPluginName())?null:(this.pluginMap.set(t.getPluginName(),t),t.initialize(e),t)},e.prototype.hasPlugin=function(t){return null!=this.retrievePlugin(t)},e.prototype.retrievePlugin=function(t){return this.pluginMap.get(t)},e.prototype.removePlugin=function(e){var i=this.pluginMap.get(e);return null!=i?(this.pluginMap.remove(e),i.finalize()):t.Logger.log("[APF]","此插件未注册"),i},e.prototype.unregisterPlugin=function(t){return this.getPluginMgr().unregisterPlugin(t)},e.prototype.unregisterCommand=function(t){return this.getPluginMgr().unregisterCommand(t.getPluginName(),t.getCommandName())},e.unregisterCommand=function(t){return e.singleton.unregisterCommand(t)},e.prototype.getPluginMgr=function(){return this.retrievePlugin(t.PluginDef.PLUGIN_MANAGER)},e.prototype.getCommandMgr=function(){return this.retrievePlugin(Plugindef.PLUGIN_COMMAND_MANAGER)},e.prototype.callCommand=function(t){this.getCommandMgr().callCommand(t)},e.callCommand=function(t){e.singleton.callCommand(t)},e.addCommandMap=function(t,i){e.singleton.commandMap.set(t,i)},e.prototype.executeStrCommand=function(e,i){void 0===i&&(i=null);var s,n=e.split("|");n.length>=2&&(s=n[1].split(","));var a;a=-1!=String(n[0]).indexOf("hf")?n[0]:this.commandMap.get(n[0]);var o=t.Util.createObject(a);o&&(s?o.init(s):o.init(),i&&o.on(i.caller,i.method),this.callCommand(o))},e.callStrCommand=function(t,i){void 0===i&&(i=null),null!=t&&""!=t&&e.singleton.executeStrCommand(t,i)},e.retrieveModel=function(t){return e.singleton.model.retrieveModel(t)},e}();t.Facade=n,t.facade=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i){e.call(this),this._hasOffY=0,this._skin=i||new View,this.skin.size(t.LayerMgr.width,t.LayerMgr.height),i.hitTestPrior=!1}return __extends(i,e),i.prototype.fixAndroidCacheAs=function(){if(this._skin.parent){var t=this._skin.parent;this._skin.parent.removeChild(this._skin),t.addChild(this._skin)}},Object.defineProperty(i.prototype,"skin",{get:function(){return this._skin},enumerable:!0,configurable:!0}),i.prototype.getScene=function(){return this._skin},i.prototype.destroy=function(){this.event(t.ViewEvent.BASE_DESTROY),this.destroyed||(this._skin=null,e.prototype.destroy.call(this))},i.prototype.resetImageSkin=function(t){if(t instanceof Laya.Image){var e=t.skin;if(e){var i=t.forceSkin;t.forceSkin=!0,t.skin=e,t.forceSkin=i}}for(var s=t.numChildren,n=0;s>n;n++)this.resetImageSkin(t.getChildAt(n))},i}(View);t.BaseScene=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.EventDispatcher,i=laya.events.Event,s=function(e){function s(){e.call(this),this.facade=t.Facade.singleton}return __extends(s,e),s.prototype.finalize=function(){},s.prototype.getPluginName=function(){return Plugindef.PLUGIN_COMMAND_MANAGER},s.prototype.initialize=function(e){this.waitCommands=[],this.readyCommands={},this.getPluginMgr().on(t.PluginEvent.PLUGIN_REGISTER,this,this.onPluginRegister),this.getPluginMgr().on(t.PluginEvent.PLUGIN_LOAD_ERROR,this,this.onPluginError),this.getPluginMgr().on(t.PluginEvent.PLUGIN_CREATE_ERROR,this,this.onPluginError),this.getPluginMgr().on(t.PluginEvent.PLUGIN_LOAD_MISSION_COMPLETE,this,this.onPluginEventHandler),this.getPluginMgr().on(t.PluginEvent.PLUGIN_LOAD_MISSION_ERROR,this,this.onPluginEventHandler)},s.prototype.onPluginError=function(e){this.loadingCommand&&e.plugin&&e.plugin.interfaceName==this.loadingCommand.getPluginName()&&(this.dispatch(t.CommandMgrEvent.COMMAND_PLUGIN_ERROR,this.loadingCommand),this.loadingCommand.ecode=t.Command.ERR_LOAD_ERROR,this.loadingCommand.finish(),this.loadingCommand=null,this.nextCommand())},s.prototype.onPluginEventHandler=function(e,i){if(this.loadingCommand&&this.loadingCommandLinks)switch(e.type){case t.PluginEvent.PLUGIN_LOAD_MISSION_COMPLETE:this.checkCommand(this.loadingCommand)&&(this.dispatch(t.CommandMgrEvent.COMMAND_LOAD_COMPLETE,this.loadingCommand),this.doCommand(this.loadingCommand),this.loadingCommand=null,this.nextCommand());break;case t.PluginEvent.PLUGIN_LOAD_MISSION_ERROR:this.dispatch(t.CommandMgrEvent.COMMAND_LOAD_ERROR,this.loadingCommand),this.loadingCommand.ecode=t.Command.ERR_LOAD_ERROR,this.loadingCommand.finish(),this.loadingCommand=null,this.nextCommand()}},s.prototype.onPluginRegister=function(e,i){this.loadingCommand&&this.loadingCommand.getPluginName()==e.plugin.interfaceName&&(this.checkCommand(this.loadingCommand)?(this.dispatch(t.CommandMgrEvent.COMMAND_LOAD_COMPLETE,this.loadingCommand),this.doCommand(this.loadingCommand),this.loadingCommand=null,this.nextCommand()):this.loadCommand())},s.prototype.getPluginMgr=function(){return this.facade.retrievePlugin(Plugindef.PLUGIN_MANAGER)},s.prototype.callCommand=function(e){var i=e.getPluginName();this.facade.retrievePlugin(i);return t.Logger.log("[command]","["+i+"]","[request]",e.getCommandName()),this.dispatch(t.CommandMgrEvent.COMMAND_REQUEST,e),this.checkCommand(e)?void this.doCommand(e):(this.waitCommands.push(e),t.Logger.log("[command]","["+i+"]","[wait]",e.getCommandName()),this.nextCommand(),void 0)},s.prototype.checkCommand=function(e){var i=e.getPluginName(),s=e.getCommandName();if(!this.facade.hasPlugin(i))return t.Logger.log("所在插件未注册====================================="),!1;var n=this.getPluginMgr().getPluginInfo(i),a=n.getLinksByCommand(s);if(!a||0==a.length)return this.readyCommands[s]=!0,!0;for(var o=0;o<a.length;o++)if(!Laya.loader.getRes(a[o].url))return t.Logger.log("有资源未加载====================================="),!1;return this.readyCommands[s]=!0,!0},s.prototype.nextCommand=function(){if(!this.loadingCommand&&(this.loadingCommand=this.waitCommands.shift(),t.Logger.log("[command]","[waiting]",this.waitCommands.length,this.waitCommands),this.loadingCommand)){if(this.checkCommand(this.loadingCommand))return this.doCommand(this.loadingCommand),this.loadingCommand=null,void this.nextCommand();var e=this.loadingCommand.getPluginName(),i=this.facade.retrievePlugin(e);i?this.loadCommand():(t.Logger.log("[command]","["+e+"]","[load]","[plugin]",this.loadingCommand.getCommandName()),this.getPluginMgr().loadPlugin(e))}},s.prototype.loadCommand=function(){if(!this.loadingCommand)throw new Error("currentCommand为空");var e=this.loadingCommand.getPluginName(),s=this.loadingCommand.getCommandName(),n=this.getPluginMgr().getPluginInfo(e);t.Logger.log("[command]","["+e+"]","[load]",this.loadingCommand.getCommandName());var a=n.getLinksByCommand(s);if(0==a.length)throw new Error("不存在Command["+s+"]对应的资源绑定");this.loadingCommandLinks=[],this.dispatch(t.CommandMgrEvent.COMMAND_LOAD_START,this.loadingCommand),Laya.loader.on(i.ERROR,this,this.onError),Laya.timer.once(1e4,this,this.onTooLang),Laya.loader.load(a,Handler.create(this,this.onLoaderComplete),Handler.create(this,this.onPluginProgress,null,!1)),this.checkCommand(this.loadingCommand)&&(this.dispatch(t.CommandMgrEvent.COMMAND_LOAD_COMPLETE,this.loadingCommand),this.doCommand(this.loadingCommand),this.loadingCommand=null,this.nextCommand())},s.prototype.onPluginProgress=function(e){this.event(t.PluginEvent.PLUGIN_LOAD_PROGRESS,{type:t.PluginEvent.PLUGIN_LOAD_PROGRESS,plugin:null,progress:e})},s.prototype.onTooLang=function(){Laya.timer.clear(this,this.onTooLang),Laya.loader.clearUnLoaded(),this.onError("onTooLang")},s.prototype.onLoaderComplete=function(){Laya.timer.clear(this,this.onTooLang),Laya.loader.off(i.ERROR,this,this.onError),this.loadingCommand&&this.checkCommand(this.loadingCommand)&&(this.dispatch(t.CommandMgrEvent.COMMAND_LOAD_COMPLETE,this.loadingCommand),this.doCommand(this.loadingCommand),this.loadingCommand=null,this.nextCommand())},s.prototype.onError=function(e){if(void 0===e&&(e=""),t.Logger.log("CommandMgrErr:",e),this.loadingCommand){var s="失败！",n=this.getPluginMgr().getPluginInfo(this.loadingCommand.getPluginName()),a=n.getLinksByCommand(this.loadingCommand.getCommandName()),o=!1;if("onTooLang"==e)s="超时！",o=!0;else for(var r=0;r<a.length;r++)if(-1!=e.indexOf(t.Global.getUrl(a[r].url))){o=!0;break}if(o){if(Laya.timer.clear(this,this.onTooLang),Laya.loader.off(i.ERROR,this,this.onError),null!=t.Facade.singleton.retrievePlugin(t.PluginDef.PLUGIN_HOME)){var h=new t.ConfirmBoxData({isShowCancelBtn:!1,contentStr:"加载资源"+s});t.ConfirmBox.show(h,t.Layer.WEAK_TIP)}else t.WeakTips.show("加载资源"+s);this.dispatch(t.CommandMgrEvent.COMMAND_LOAD_ERROR,this.loadingCommand),this.loadingCommand.ecode=t.Command.ERR_LOAD_ERROR,this.loadingCommand.finish(),this.loadingCommand=null,this.nextCommand()}}},s.prototype.doCommand=function(e){this.dispatch(t.CommandMgrEvent.COMMAND_EXECUTE,e);var i=e.getPluginName();t.Logger.log("[command]","["+i+"]","[execute]",e.getCommandName());var s=this.facade.retrievePlugin(i);s.doCommand(e)},s.prototype.dispatch=function(t,e){var i=e.getPluginName();this.event(t,{type:t,command:e,plugin:this.getPluginMgr().getPluginInfo(i)})},s}(e);t.CommandMgr=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){function e(t,e,i,s){o.singleton.on(t,e,i,s)}function i(t,e,i,s){o.singleton.once(t,e,i)}function s(t,e,i){o.singleton.off(t,e,i)}function n(e,i){void 0===i&&(i=null),t.Logger.log(e),o.singleton.event(e,i)}var a=laya.events.EventDispatcher,o=function(e){function i(){e.call(this)}return __extends(i,e),Object.defineProperty(i,"singleton",{get:function(){return null==t.EventCenter._singleton&&(t.EventCenter._singleton=new t.EventCenter),t.EventCenter._singleton},enumerable:!0,configurable:!0}),i}(a);t.EventCenter=o,t.addListener=e,t.once=i,t.removeListener=s,t.dispatch=n}(hf||(hf={}));var hf;!function(t){var e=laya.utils.Dictionary,i=function(){function i(t){this._status=i.UNDEFINED,this._status=i.DEFINE,this._info=t,this.analyze()}return Object.defineProperty(i.prototype,"info",{get:function(){return this._info},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"config",{get:function(){return this.info.config[0]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this.info.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"interfaceName",{get:function(){return this.info["interface"]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"entityName",{get:function(){return this.info.entity},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"moduleDirectory",{get:function(){return this.info.module},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rely",{get:function(){return this.info.rely||[]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"resource",{get:function(){return this.info.resource||[]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"status",{get:function(){return this._status},set:function(t){this._status=t},enumerable:!0,configurable:!0}),i.prototype.getLinksByCommand=function(t){return this.linkMap.get(t)},Object.defineProperty(i.prototype,"links",{get:function(){return this._links},enumerable:!0,configurable:!0}),i.prototype.analyze=function(){var i,s=0;if(this.info.resource&&this.info.resource.length>0)for(s=0;s<this.info.resource.length;s++)i=this.info.resource[s],i.url=i.url.replace("{config}",t.Global.ResPath);this.linkMap=new e,this._links=[];for(var n,a,o,r=this.info.link||{},h=this.info.command||[],s=0;s<h.length;s++)if(n=h[s],a=n.resources||[],a.length>0){o=[];for(var l,c=0;c<a.length;c++)l=r[a[c]],l.url=l.url.replace("{config}",t.Global.ResPath),l&&(o.push(l),this._links.push(l));o.length>0&&this.linkMap.set(n.name,o)}},Object.defineProperty(i.prototype,"commands",{get:function(){return this.info.command||[]},enumerable:!0,configurable:!0}),i.UNDEFINED=0,i.DEFINE=1,i.LOADING=4,i.REGISTERED=6,i.CREATE_ERROR=7,i}();t.PluginInfo=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(hf){var EventDispatcher=laya.events.EventDispatcher,LoaderManager=laya.net.LoaderManager,Event=laya.events.Event,PluginInfo=hf.PluginInfo,Loader=laya.net.Loader,PluginMgr=function(_super){function PluginMgr(){_super.call(this),this.facade=hf.Facade.singleton,this._moduleJsObj={},this.loader=new LoaderManager,this._isUnregisting=!1}return __extends(PluginMgr,_super),PluginMgr.prototype.finalize=function(){},PluginMgr.prototype.initialize=function(t){this.pluginInfoArray=[],this.waitArray=[]},PluginMgr.prototype.startup=function(){Laya.loader.load([{url:"config/plugin/plugin.json",type:Loader.JSON}],Handler.create(this,this.loadHomeConfig))},PluginMgr.prototype.loadHomeConfig=function(){for(var t,e=Laya.loader.getRes("config/plugin/plugin.json"),i=e.plugin,s=0;s<i.length;s++){var t=new PluginInfo(i[s]);this.pluginInfoArray.push(t)}this.event("plugin")},PluginMgr.prototype.getPluginName=function(){return hf.PluginDef.PLUGIN_MANAGER},PluginMgr.prototype.hasPlugin=function(t){return this.facade.hasPlugin(t)},PluginMgr.prototype.getPluginInfo=function(t){if(!t)throw new Error("plguinName不能为空");for(var e=this.pluginInfoArray.length,i=0;e>i;i++){var s=this.pluginInfoArray[i];if(s.interfaceName==t)return s}throw new Error("插件配置"+t+"不存在")},PluginMgr.prototype.loadPlugin=function(t){hf.Logger.log("[plugin]","[loadPlugin]","["+t+"]");var e=this.getPluginInfo(t);this.pushPlugin(e)},PluginMgr.prototype.pushPlugin=function(t){if(!t)throw new Error("插件配置不能为空");if(!t.interfaceName)throw new Error("插件名不能为空");switch(t.status){case PluginInfo.UNDEFINED:throw new Error("插件信息未定义");case PluginInfo.DEFINE:-1==this.waitArray.indexOf(t)&&(this.waitArray.push(t),this.nextPluginArray());break;case PluginInfo.LOADING:break;case PluginInfo.REGISTERED:break;case PluginInfo.CREATE_ERROR:this.dispatch(hf.PluginEvent.PLUGIN_CREATE_ERROR,t)}},PluginMgr.prototype.nextPluginArray=function(){if(!this.currentPluginArray){if(this.currentPlugin)throw new Error("当前不应有正在加载的插件");var t=this.waitArray.shift();if(t){if(this.hasPlugin(t.interfaceName))return void this.nextPluginArray();this.currentPluginArray=[],this.pushPluginArray(t),this.loadNextPluginResource()}}},PluginMgr.prototype.pushPluginArray=function(t){this.currentPluginArray.unshift(t);for(var e=0;e<t.rely.length;e++){var i=t.rely[e],s=this.getPluginInfo(i);this.hasPlugin(s.interfaceName)||(this.currentPluginArray.unshift(s),this.pushPluginArray(s))}},PluginMgr.prototype.loadNextPluginResource=function(){if(!this.currentPlugin){if(this.currentPlugin=this.currentPluginArray.shift(),!this.currentPlugin)return this.currentPluginArray=null,void this.nextPluginArray();if(this.hasPlugin(this.currentPlugin.interfaceName))return this.currentPlugin=null,void this.loadNextPluginResource();var t=this.currentPlugin,e=t.resource.concat();try{var i=hf.JSUtils.StrToFuc(t.entityName);new i}catch(s){e.push({name:"link100",url:"moduleJS/"+t.moduleDirectory+"Module.js",type:Loader.TEXT}),this._moduleJsObj[t.entityName]=1}e&&e.length>0?(t.status=PluginInfo.LOADING,this.dispatch(hf.PluginEvent.PLUGIN_LOAD_START,t),this.startLoad(e)):this.checkAndRegisterCurrentPlugin()}},PluginMgr.prototype.startLoad=function(t){this.dispatch(hf.PluginEvent.PLUGIN_LOAD_PROGRESS,null,0),this.loader.on(Event.ERROR,this,this.onPluginFailed),Laya.timer.once(1e4,this,this.onTooLang),this.loader.load(t,Handler.create(this,this.onPluginCompleted),Handler.create(this,this.onPluginProgress,null,!1))},PluginMgr.prototype.onPluginCompleted=function(){if(Laya.timer.clear(this,this.onTooLang),this.loader.off(Event.ERROR,this,this.onPluginFailed),this.currentPlugin){if(1==this._moduleJsObj[this.currentPlugin.entityName])try{eval(Laya.loader.getRes("moduleJS/"+this.currentPlugin.moduleDirectory+"Module.js")),Laya.loader.clearRes("moduleJS/"+this.currentPlugin.moduleDirectory+"Module.js"),this._moduleJsObj[this.currentPlugin.entityName]=0}catch(e){}this.checkAndRegisterCurrentPlugin()}},PluginMgr.prototype.onTooLang=function(){this.loader.clearUnLoaded(),this.onPluginFailed("onTooLang")},PluginMgr.prototype.onPluginProgress=function(t){this.dispatch(hf.PluginEvent.PLUGIN_LOAD_PROGRESS,null,t)},PluginMgr.prototype.onPluginFailed=function(t){void 0===t&&(t=""),hf.Logger.log("PluginMgronPluginFailed:",t),Laya.timer.clear(this,this.onTooLang),this.loader.off(Event.ERROR,this,this.onPluginFailed),this.loader.clearUnLoaded();var e="onTooLang"==t?"超时！":t.split("/").pop()+"失败！";if(""!=t&&null!=hf.Facade.singleton.retrievePlugin(hf.PluginDef.PLUGIN_HOME)){var i=new hf.ConfirmBoxData({isShowCancelBtn:!1,contentStr:"加载插件资源"+e});hf.ConfirmBox.show(i,hf.Layer.WEAK_TIP)}else hf.WeakTips.show("加载插件资源"+e);this.currentPlugin&&(hf.Logger.log("[plugin]","["+this.currentPlugin.interfaceName+"]","[loadError]",t),this.currentPlugin.status=PluginInfo.DEFINE,this.clearCurrentPluginArray(hf.PluginEvent.PLUGIN_LOAD_ERROR))},PluginMgr.prototype.checkAndRegisterCurrentPlugin=function(){this.isPluginReady(this.currentPlugin)&&(hf.Logger.log("[plugin]","["+this.currentPlugin.interfaceName+"]","[loadAll]"),this.dispatch(hf.PluginEvent.PLUGIN_LOAD_COMPLETE,this.currentPlugin),this.registerPlugin(this.currentPlugin.interfaceName)?(this.currentPlugin=null,this.loadNextPluginResource()):this.clearCurrentPluginArray(hf.PluginEvent.PLUGIN_CREATE_ERROR))},PluginMgr.prototype.registerPlugin=function(t){var e=this.getPluginInfo(t),i=hf.Util.createObject(e.entityName),s=i;return s?(this.facade.registerPlugin(s,e.info),hf.Logger.log("[plugin]","[registerPlugin]","["+e.interfaceName+"]"),e.status=PluginInfo.REGISTERED,hf.Logger.log("[plugin]","["+e.interfaceName+"]","[registered]"),this.dispatch(hf.PluginEvent.PLUGIN_REGISTER,e,null),-1!=this.waitArray.indexOf(e)&&this.waitArray.splice(this.waitArray.indexOf(e),1),!0):(e.status=PluginInfo.CREATE_ERROR,hf.Logger.log("[plugin]","["+e.interfaceName+"]","[createError]"),!1)},PluginMgr.prototype.unregisterPlugin=function(t){return t?(this._unregisterArr||(this._unregisterArr=[]),this._unregisterArr.push(t),this._isUnregisting||(this._isUnregisting=!0,Laya.timer.frameOnce(1,this,this.doUnregisterPlugin)),this.facade.removePlugin(t)):null},PluginMgr.prototype.doUnregisterPlugin=function(){if(this._unregisterArr)for(;this._unregisterArr.length>0;){var t=this._unregisterArr.shift();this.clearPluginRes(t)}this._isUnregisting=!1},PluginMgr.prototype.clearPluginRes=function(t){var e=this.getPluginInfo(t);e.status=PluginInfo.DEFINE;var i=e.resource;if(i&&i.length>0)for(var s=i.length,n=0;s>n;n++)hf.Logger.log("            clear:["+i[n].url+"]"),1!=i[n].keep&&Laya.loader.clearRes(i[n].url,!0);if(i=e.links,i&&i.length>0)for(var s=i.length,n=0;s>n;n++)hf.Logger.log("       cmd     clear:["+i[n].url+"]"),1!=i[n].keep&&Laya.loader.clearRes(i[n].url,!0);hf.Logger.log("[plugin]","[unregisterPlugin]","["+e.interfaceName+"]")},PluginMgr.prototype.unregisterCommand=function(t,e){t&&e&&Laya.timer.frameOnce(1,this,this.clearCommandRes,[t,e])},PluginMgr.prototype.clearCommandRes=function(t,e){var i=this.getPluginInfo(t);if(i){var s=i.getLinksByCommand(e);if(s&&s.length>0){for(var n=s.length,a=0;n>a;a++)hf.Logger.log("       cmd     clear:["+s[a].url+"]"),1!=s[a].keep&&Laya.loader.clearRes(s[a].url,!0);hf.Logger.log("[plugin]","[unregisterCommand]","["+e+"]")}}},PluginMgr.prototype.isPluginReady=function(t){var e=t.resource;if(!e||0==e.length)return!0;for(var i=e.length,s=0;i>s;s++)if(!Laya.loader.getRes(e[s].url))return!1;return!0},PluginMgr.prototype.dispatch=function(t,e,i){void 0===i&&(i=null),this.event(t,{type:t,plugin:e,progress:i})},PluginMgr.prototype.clearCurrentPluginArray=function(t){var e;e=this.currentPluginArray.length<1?this.currentPlugin:this.currentPluginArray.pop(),this.currentPlugin=null,this.currentPluginArray=null,this.dispatch(t,e,null),this.nextPluginArray()},PluginMgr.prototype.retrievePlugin=function(t){return t?this.facade.retrievePlugin(t):null},PluginMgr.prototype.getPluginInfos=function(){return this.pluginInfoArray},PluginMgr}(EventDispatcher);hf.PluginMgr=PluginMgr}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginEvent,i=t.CommandMgrEvent,s=function(s){function n(){s.call(this),this._percent=0,this._content="",this.loadedFileCount=0,this.maxFileCount=0;var e=new Sprite;e.graphics.drawRect(0,0,t.LayerMgr.width,t.LayerMgr.clientHeight,"#000000"),e.alpha=.4,e.y=-t.LayerMgr.offY,e.mouseEnabled=!0,e.size(t.LayerMgr.width,t.LayerMgr.clientHeight),this.mouseEnabled=!0,this.hitTestPrior=!1,this.addChildAt(e,0)}return __extends(n,s),Object.defineProperty(n,"singleton",{get:function(){return null==t.ProgressBar._singleton&&(t.ProgressBar._singleton=new t.ProgressBar),t.ProgressBar._singleton},enumerable:!0,configurable:!0}),n.bind=function(t,e){n.singleton.bind(t,e)},Object.defineProperty(n.prototype,"percent",{get:function(){return this._percent},set:function(t){this._percent=Math.max(0,Math.min(1,t)),this.percentTxt.text=this._loadMsg+Number(100*this.percent).toFixed(1)+"%",this.progressBar.value=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"content",{get:function(){return this._content},set:function(t){this._content=t||"",this.contentTxt.text=this.content},enumerable:!0,configurable:!0}),n.prototype.hide=function(){this.isShowed&&(this.isShowed=!1,0==n.hasDoTimer&&Laya.timer.clear(this,this.showAlpha),this.parent&&t.LayerMgr.removeChild(this),this.maxFileCount=0,this.loadedFileCount=0)},n.prototype.show=function(e,i){void 0===e&&(e=null),void 0===i&&(i=-1),e&&(this._loadMsg=e);var s=t.Global.getRes("{config}config/loadingTips.json"),a=[];if(s)for(var o=0;o<s.length;o++){var r=s[o];-1==String(r.is_fight).indexOf("1")&&a.push(r.words)}this.content=a.length>0?a[Math.floor(Math.random()*a.length)]:"小贴士：要想升级快，邀请好友斗起来！",-1!=this.percent&&(this.percent=i),this.isShowed||(this.isShowed=!0,this.parent||(t.LayerMgr.addChildAt(this,0,t.Layer.LOADING),this.alpha=0,n.hasDoTimer=!1,Laya.timer.once(500,this,this.showAlpha)))},n.prototype.showAlpha=function(){n.hasDoTimer=!0,this.alpha=1},n.prototype.bind=function(t,s){this.plugin=t,this.command=s,this.plugin.on(e.PLUGIN_LOAD_START,this,this.handlePluginEvent),this.plugin.on(e.PLUGIN_LOAD_COMPLETE,this,this.handlePluginEvent),this.plugin.on(e.PLUGIN_LOAD_MISSION_ERROR,this,this.handlePluginEvent),this.plugin.on(e.PLUGIN_LOAD_ERROR,this,this.handlePluginEvent),this.plugin.on(e.PLUGIN_LOAD_PROGRESS,this,this.handlePluginEvent),this.plugin.on(e.PLUGIN_LOAD_MISSION_COMPLETE,this,this.handlePluginEvent),this.plugin.on(e.PLUGIN_CREATE_ERROR,this,this.handlePluginEvent),this.plugin.on(e.PLUGIN_CONFIG_ERROR,this,this.handlePluginEvent),this.command.on(i.COMMAND_LOAD_START,this,this.handlePluginEvent),this.command.on(i.COMMAND_LOAD_COMPLETE,this,this.handlePluginEvent),this.command.on(i.COMMAND_LOAD_ERROR,this,this.handlePluginEvent),this.command.on(e.PLUGIN_LOAD_PROGRESS,this,this.handlePluginEvent)},n.prototype.handlePluginEvent=function(t){switch(t.type){case i.COMMAND_LOAD_START:this.show("正在加载["+t.plugin.name+"]相关资源...");break;case i.COMMAND_LOAD_COMPLETE:this.hide();break;case i.COMMAND_LOAD_ERROR:this.hide();break;case e.PLUGIN_CONFIG_ERROR:this.hide();break;case e.PLUGIN_LOAD_START:this.show("正在加载["+t.plugin.name+"]插件及相关资源...");break;case e.PLUGIN_LOAD_PROGRESS:this.percent=t.progress;break;case e.PLUGIN_LOAD_MISSION_COMPLETE:this.loadedFileCount++;break;case e.PLUGIN_LOAD_COMPLETE:this.hide();break;case e.PLUGIN_LOAD_MISSION_ERROR:this.hide();break;case e.PLUGIN_LOAD_ERROR:this.hide();break;case e.PLUGIN_CREATE_ERROR:this.hide()}},n}(ui.ProgressUI);t.ProgressBar=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.EventDispatcher,i=function(e){function i(){e.call(this),this._retrenchType=i.TYPE_RETRENCH_NONE}return __extends(i,e),Object.defineProperty(i,"singleton",{get:function(){return null==i._singleton&&(i._singleton=new i),i._singleton},enumerable:!0,configurable:!0}),i.prototype.run=function(){i.running=!0,t.EventCenter.singleton.on(t.NetEvn.EVENT_NETWORK_CHANGE,this,this.onNetChange),this.onNetChange()},i.prototype.onNetChange=function(){if(t.NetEvn.singleton.netWorkType>t.NetEvn.TYPE_WIFI){if(!t.Global.isTest){var e=new t.ConfirmBoxData({title:"精简模式",contentStr:"系统检测到您当前正在使用移动网络，是否需要切换到精简模式以节省移动流量，精简模式下，游戏的表现力会有所减弱。",confirmStr:"是，立即开启",cancleStr:"否，土豪任性",callBackHandler:Handler.create(this,this.onHandler),autoCloseTime:8e3});t.ConfirmBox.show(e,t.Layer.WEAK_TIP)}}else t.NetEvn.singleton.netWorkType==t.NetEvn.TYPE_WIFI&&(this._retrenchType==i.TYPE_RETRENCH_TRUE&&t.WeakTips.show("已切换到Wifi环境，精简模式已关闭"),this.retrench=i.TYPE_RETRENCH_FALSE)},i.prototype.onHandler=function(){t.WeakTips.show("精简模式已开启"),this.retrench=i.TYPE_RETRENCH_TRUE},Object.defineProperty(i.prototype,"retrench",{get:function(){return this._retrenchType},set:function(e){var s=this._retrenchType;this._retrenchType=e,this._retrenchType!=s&&t.EventCenter.singleton.event(i.EVENT_RETRENCH_MODE_CHANGE)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isRetrech",{get:function(){return this._retrenchType==i.TYPE_RETRENCH_TRUE},enumerable:!0,configurable:!0}),i.EVENT_RETRENCH_MODE_CHANGE="EVENT_RETRENCH_MODE_CHANGE",i.TYPE_RETRENCH_NONE=-1,i.TYPE_RETRENCH_TRUE=1,i.TYPE_RETRENCH_FALSE=0,i.running=!1,i}(e);t.RetrenchMode=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.utils.Dictionary,i=laya.events.EventDispatcher,s=t.ResVersionControl,n=function(i){function n(){i.call(this),this._curConcur=0,this._state=0,this.init()}return __extends(n,i),n.prototype.init=function(){this._preInfos=[],this._curInfos=[],this._infosMap=new e,t.EventCenter.singleton.on(t.NetEvn.EVENT_NETWORK_CHANGE,this,this.onNetChange)},Object.defineProperty(n,"singleton",{get:function(){return null==t.SlientlyLoadMrg._singleton&&(t.SlientlyLoadMrg._singleton=new t.SlientlyLoadMrg),t.SlientlyLoadMrg._singleton},enumerable:!0,configurable:!0}),n.prototype.run=function(){var e=t.JSUtils.getCookie(n.COOKIE_KEY),i=parseInt(e?e:"0"),s=(new Date).getTime();this.log("上次缓存时间："+t.DateUtils.formate(i/1e3,3)),s-i>n.COOKIE_TIME?(this.log("加载配置"+n.SLIENTLY_CONFIG_PATH),Laya.loader.load(n.SLIENTLY_CONFIG_PATH,Handler.create(this,this.onSlientlyLoadJson),null,Loader.JSON,0)):this.log("最近7天已缓存")},n.prototype.onSlientlyLoadJson=function(){this.log("解析配置"+n.SLIENTLY_CONFIG_PATH);var e=[],i=Laya.loader.getRes(n.SLIENTLY_CONFIG_PATH);for(var s in i)e.push(i[s]);this.log("共"+e.length+"个文件"),t.SlientlyLoadMrg.singleton.addLoadList(e),Laya.loader.load(n.PLUGIN_CONFIG_PATH,Handler.create(this,this.onPluginJson),null,Loader.JSON,0)},n.prototype.onPluginJson=function(){this.log("解析配置"+n.PLUGIN_CONFIG_PATH);for(var e=[],i=Laya.loader.getRes(n.PLUGIN_CONFIG_PATH),s=i.plugin,a=0;a<s.length;a++){var o=s[a];if(o.resource)for(var r=o.resource,h=0;h<r.length;h++)this.addUrlFromPluginItem(e,r[h]);if(o.link){var l=o.link;for(var c in l)this.addUrlFromPluginItem(e,l[c])}}this.log("共"+e.length+"个文件"),t.SlientlyLoadMrg.singleton.addLoadList(e),this.onResVersion()},n.prototype.addUrlFromPluginItem=function(t,e){t.push(e.url),"atlas"==e.type&&t.push(e.url.replace(".json",".png"))},n.prototype.onResVersion=function(){this.log("解析配置res_version_r_xxxx.js");
var e=[],i=Laya.Browser.window.__res_version;if(i)for(var s in i)this.isIgnoreURL(s)||e.push(s);this.log("共"+e.length+"个文件"),t.SlientlyLoadMrg.singleton.addLoadList(e),t.SlientlyLoadMrg.singleton.load()},n.prototype.onMD5Text=function(){this.log("解析配置"+n.SLIENTLY_CONFIG_PATH);for(var e=Laya.loader.getRes(n.MD5_CONFIG_PATH),i=/[a-zA-Z][0-9a-zA-Z_\-\/\.]*\.[0-9a-zA-Z_]+/g,s=e.match(i),a=s.length;a>0;a--){var o=s[a-1];this.isIgnoreURL(o)&&s.splice(a-1,1)}this.log("共"+s.length+"个文件"),t.SlientlyLoadMrg.singleton.addLoadList(s),t.SlientlyLoadMrg.singleton.load()},n.prototype.isIgnoreURL=function(t){for(var e=0;e<n.IGNORE_URL.length;e++)if(0==t.indexOf(n.IGNORE_URL[e]))return!0;return!1},n.prototype.addLoadList=function(e){for(var i=0;i<e.length;i++){var n=e[i];if(-1==this._infosMap.indexOf(n)){var a=new t.SlientlyLoadInfo;a.url=n,a.redUrl=s.handelVersionUrl(a.url),a.loadState=1,this._preInfos.push(a),this._infosMap.set(a.url,a)}}},n.prototype.load=function(){if(!t.Global.isWifi)return this.log("非WIFI环境下不进行静默加载。"),void this.stop();this._state=1;for(var e=this._curInfos.length;e<n.CONCUR_MAX;e++)if(this._preInfos.length>0){var i=this._preInfos.shift();i.loadState=1,this._curInfos.push(i),Laya.loader.load(i.redUrl,Handler.create(this,this.onLoad,[i]),null,Laya.Loader.BUFFER,4,!1,"SlientlyLoadMrg")}else{var s=(new Date).getTime();t.JSUtils.setCookie(n.COOKIE_KEY,s),this.log("加载完成！缓存时间："+t.DateUtils.formate(s/1e3,3))}},n.prototype.stop=function(){this._state=0;for(var t=0;t<this._curInfos.length;t++){var e=this._curInfos[t];this._preInfos.unshift(e)}this._curInfos.length=0},n.prototype.onLoad=function(t,e){Laya.loader.getRes(t.redUrl),0!=this._state&&(e?t.loadState=2:(t.loadState=3,this.log("[ERROR] "+t.redUrl)),this._curInfos.splice(this._curInfos.indexOf(t),1),this.load())},n.prototype.onNetChange=function(){t.Global.isWifi?(this.log("已切换到WIFI环境,进行静默加载。"),this.load()):(this.log("已切换到非WIFI环境,不进行静默加载。"),this.stop())},n.prototype.log=function(e){t.Logger.log("[SlientlyLoadMrg] "+e)},n.COOKIE_KEY="slientlyLoad",n.COOKIE_TIME=6048e5,n.CONCUR_MAX=1,n.SLIENTLY_CONFIG_PATH="config/SlientlyLoad.json",n.PLUGIN_CONFIG_PATH="config/plugin/plugin.json",n.MD5_CONFIG_PATH="res_md5_version.txt",n.IGNORE_URL=["js/","ledoures/actpic/","ledoures/buff/","ledoures/channel/","ledoures/config/","ledoures/goods/","ledoures/share/","ledoures/skill/","ledoures/weapon/","libs/","res_md5_version.txt"],n}(i);t.SlientlyLoadMrg=n}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.List,i=laya.events.Event,s=function(t){function e(){t.call(this),this.on(i.RENDER,this,this.onRender)}return __extends(e,t),e.prototype.setPageButtons=function(t,e){this.btn_pre=t,this.btn_next=e,this.btn_pre.on(i.CLICK,this,this.onBtnPer),this.btn_next.on(i.CLICK,this,this.onBtnNext)},e.prototype.destroy=function(e){void 0===e&&(e=!0),this.btn_pre&&this.btn_pre.off(i.CLICK,this,this.onBtnPer),this.btn_next&&this.btn_next.off(i.CLICK,this,this.onBtnNext),this.off(i.RENDER,this,this.onRender),t.prototype.destroy.call(this)},e.prototype.onBtnPer=function(){var t=this.page;this.page--,this.page!=t&&this.event(e.EVENT_PAGE_CHANG),this.updatePageBtn()},e.prototype.onBtnNext=function(){var t=this.page;this.page++,this.page!=t&&this.event(e.EVENT_PAGE_CHANG),this.updatePageBtn()},e.prototype.onRender=function(){this.updatePageBtn()},e.prototype.updatePageBtn=function(){0==this.page?(this.btn_pre.gray=!0,this.btn_pre.mouseEnabled=!1):(this.btn_pre.gray=!1,this.btn_pre.mouseEnabled=!0),this.page==this.totalPage-1?(this.btn_next.gray=!0,this.btn_next.mouseEnabled=!1):(this.btn_next.gray=!1,this.btn_next.mouseEnabled=!0)},e.EVENT_PAGE_CHANG="EVENT_PAGE_CHANG",e}(e);t.PageList=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t,i){void 0===i&&(i="comp/sbtn.png"),e.call(this,i,t),this.scaleTime=100,this.labelAlign="center",this.on(Laya.Event.MOUSE_DOWN,this,this.scaleSmall),this.on(Laya.Event.MOUSE_OUT,this,this.scaleBig)}return __extends(i,e),i.prototype.init=function(){this._isInit||(this._initWidth=this.width,this._initHeight=this.height,this._isInit=!0)},i.prototype.scaleSmall=function(){if(this.init(),!this._isSmall){this._isSmall=!0,this._initX=this.x,this._initY=this.y;var e=.92;this.width=this._initWidth*e,this.height=this._initHeight*e,this.x=this._initX+(1-e)*this._initWidth/2,this.y=this._initY+(1-e)*this._initHeight/2,t.LayerMgr.getStage().on(Laya.Event.MOUSE_UP,this,this.scaleBig),this._hitArea||(this._hitArea=new Laya.HitArea,this._hitArea.hit.drawRect(-(1-e)*this._initWidth/2,-(1-e)*this._initHeight/2,this._initWidth,this._initHeight,"#000000")),this.hitArea=this._hitArea}},i.prototype.scaleBig=function(){this._isSmall&&(this._isSmall=!1,this.width=this._initWidth,this.height=this._initHeight,this.x=this._initX,this.y=this._initY,t.LayerMgr.getStage().off(Laya.Event.MOUSE_UP,this,this.scaleBig),this.hitArea=null)},i.prototype.destroy=function(){this._hitArea=null,this.off(Laya.Event.MOUSE_DOWN,this,this.scaleSmall),this.off(Laya.Event.MOUSE_OUT,this,this.scaleBig),t.LayerMgr.getStage().off(Laya.Event.MOUSE_UP,this,this.scaleBig),e.prototype.destroy.call(this)},i}(laya.ui.Button);t.HFUIButton=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i){void 0===i&&(i="comp/sbtn.png"),t.call(this,e,i),this.stateNum=1}return __extends(e,t),e}(t.HFUIButton);t.HFMapButton=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i){void 0===i&&(i="comp/sbtn.png"),t.call(this,e,i),this.stateNum=1}return __extends(e,t),e}(t.HFUIButton);t.SBtn1=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i){void 0===i&&(i="comp/sbtn.png"),t.call(this,e,i),this.stateNum=2}return __extends(e,t),e}(t.HFUIButton);t.SBtn2=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i){void 0===i&&(i="comp/sbtn.png"),t.call(this,e,i),this.stateNum=3}return __extends(e,t),e}(t.HFUIButton);t.SBtn3=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){void 0===e&&(e=0),t.call(this),this.actid=e}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null),t&&(this.actid=Number(t[0]))},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_ACT},e.prototype.getCommandName=function(){return"ActCenterCMD"},e}(t.Command);t.ActCenterCMD=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){void 0===e&&(e=0),t.call(this),this.aid=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_ACT},e.prototype.getCommandName=function(){return"FishMainBoxCmd"},e}(t.Command);t.FishMainBoxCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){void 0===e&&(e=0),t.call(this),this.aid=e}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null),t&&(this.aid=Number(t[0]))},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_ACT},e.prototype.getCommandName=function(){return"OpenJointPicMainBoxCmd"},e}(t.Command);t.OpenJointPicMainBoxCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){void 0===e&&(e=0),t.call(this),this.aid=e}return __extends(e,t),e.prototype.init=function(t){this.aid=Number(t[0])},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_ACT},e.prototype.getCommandName=function(){return"WBWeekendCmd"},e}(t.Command);t.WBWeekendCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.EventDispatcher,i=function(e){function i(t){e.call(this),this.modelName=t}return __extends(i,e),i.prototype.getModelName=function(){return this.modelName},i.prototype.dispModelEvent=function(e,i,s,n){void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=null),this.event(e,new t.ModelEvent(e,i,s,n))},i.prototype.updateFinish=function(){this.event(t.ModelEvent.UPDATE_FINISH)},i}(e);t.BaseModel=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_BUFF},e.prototype.getCommandName=function(){return"BuffCommand"},e}(t.Command);t.BuffCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_CG},e.prototype.getCommandName=function(){return"CgCommand"},e}(t.Command);t.CgCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_CG},e.prototype.getCommandName=function(){return"CgEndCommand"},e}(t.Command);t.CgEndCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i){void 0===e&&(e="main"),void 0===i&&(i=null),t.call(this),this.type=e,this.data=i}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null),t?(this.type=t[0]?t[0]:"main",this.data=t[1]?t[1]:null):this.type="main"},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_CHAIN},e.prototype.getCommandName=function(){return"ChainCommand"},e}(t.Command);t.ChainCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_CHAMPION},e.prototype.getCommandName=function(){return"OpenChampionCmd"},e}(t.Command);t.OpenChampionCmd=e;var i=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_CHAMPION},e.prototype.getCommandName=function(){return"ChampionShareRewardCmd"},e}(t.Command);t.ChampionShareRewardCmd=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null)},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_CHAMPIONTEAM},e.prototype.getCommandName=function(){return"ChampionTeamCommand"},e}(t.Command);t.ChampionTeamCommand=e;var i=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null)},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_CHAMPIONTEAM},e.prototype.getCommandName=function(){return"ChampionTeamFightCommand"},e}(t.Command);t.ChampionTeamFightCommand=i;var s=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null)},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_CHAMPIONTEAM},e.prototype.getCommandName=function(){return"ChampionTeamLogCommand"},e}(t.Command);t.ChampionTeamLogCommand=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_CHANGE72},e.prototype.getCommandName=function(){return"OpenChange72BoxCmd"},e}(t.Command);t.OpenChange72BoxCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_CHANNELS},e.prototype.getCommandName=function(){return"OpenChannelsBoxCommand"},e}(t.Command);t.OpenChannelsBoxCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i,s,n,a,o,r,h,l,c,d){t.call(this),this.spotID=e,this.oldName=i,this.oldPinzhi=s,this.oldLv=n,this.oldStrength=a,this.oldDes=o,this.newName=r,this.newPinzhi=h,this.newLv=l,this.newStrength=c,this.newDes=d}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_CHANNELS},e.prototype.getCommandName=function(){return"OpenNewChannelsBoxCommand"},e}(t.Command);t.OpenNewChannelsBoxCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_CHRISTMAS},e.prototype.getCommandName=function(){return"ChristmasCommand"},e}(t.Command);t.ChristmasCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_CHRISTMASTOTAL},e.prototype.getCommandName=function(){return"ChristmasTotalCmd"},e}(t.Command);t.ChristmasTotalCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_COLLECT},e.prototype.getCommandName=function(){return"CollectCommand"},e}(t.Command);t.CollectCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_COLLECT},e.prototype.getCommandName=function(){return"WeixinCollectCommand"},e}(t.Command);t.WeixinCollectCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){void 0===e&&(e=0),t.call(this),this.exChangeID=e}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null),t&&(this.exChangeID=Number(t[0]))},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_COMMON},e.prototype.getCommandName=function(){return"CommonExchangeCmd"},e}(t.Command);t.CommonExchangeCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){t.call(this),this.obj=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_COMMON},e.prototype.getCommandName=function(){return"DecodeDataCmd"},e}(t.Command);t.DecodeDataCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){t.call(this),this.data=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_COMMON},e.prototype.getCommandName=function(){return"OpenBeyondShareBoxCmd"},e.TYPE_SHARE_LILIANG=1,e.TYPE_SHARE_QIANCENGTA=2,e}(t.Command);t.OpenBeyondShareBoxCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){t.call(this),this.str=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_COMMON},e.prototype.getCommandName=function(){return"OpenNoticeCommand"},e}(t.Command);t.OpenNoticeCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_COMMON},e.prototype.getCommandName=function(){return"OpenRechargeCmd"},e}(t.Command);t.OpenRechargeCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){t.call(this),this.redArr=e.hasOwnProperty("rodinfo")?e.rodinfo:null}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_COMMON},e.prototype.getCommandName=function(){return"RefreshRedStatusCmds"},e}(t.Command);t.RefreshRedStatusCmds=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_COMMON},e.prototype.getCommandName=function(){return"RefreshUserInfoCmd"},e}(t.Command);t.RefreshUserInfoCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i){void 0===i&&(i=3),t.call(this),this.fuid=e,this.type=i}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_COMMON},e.prototype.getCommandName=function(){return"SendWbGameBarCmd"},e.kSendVit=1,e.kServantRelease=2,e.kServantResist=3,e.kServantArrest=4,e.kServantRob=5,e.kMarryAgree=6,e.kMarryPropse=7,e.kMarryRefuse=8,e.kSurpassLevel=9,e.kSurpassMappush=10,e.kSurpassTower=11,e}(t.Command);t.SendWbGameBarCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i,s){void 0===i&&(i=200),void 0===s&&(s="#00FF00"),t.call(this),this.deltaTime=200,this.color="#00FF00",this.rewardArr=e,this.deltaTime=i,this.color=s}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_COMMON},e.prototype.getCommandName=function(){return"ShowChangeRewardCmd"},e}(t.Command);t.ShowChangeRewardCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){t.call(this),this.arr=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_COMMON},e.prototype.getCommandName=function(){return"ShowLvUpBookCmd"},e}(t.Command);t.ShowLvUpBookCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){t.call(this),this.arr=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_COMMON},e.prototype.getCommandName=function(){return"ShowLvUpBoxCmd"},e}(t.Command);t.ShowLvUpBoxCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_COMMON},e.prototype.getCommandName=function(){return"ShowNetBoxCmd"},e}(t.Command);t.ShowNetBoxCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i){t.call(this),this._data=e,this.target=i}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_COMMON},e.prototype.getCommandName=function(){return"ShowPopBoxCMD"},e}(t.Command);t.ShowPopBoxCMD=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i,s){t.call(this),this.rewardBoxMsg=e,this.rewardBoxArr=i,this.handler=s}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_COMMON},e.prototype.getCommandName=function(){return"ShowRewardBoxCmd"},e}(t.Command);t.ShowRewardBoxCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i,s){t.call(this),this.oldAttackPower=e,this.changeNum=i,this.newAttackPower=s}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_COMMON},e.prototype.getCommandName=function(){return"ShowStrengthChangeCmd"},e}(t.Command);t.ShowStrengthChangeCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i){void 0===i&&(i=!1),t.call(this),this.arr=e,this.type=i}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_COMMON},e.prototype.getCommandName=function(){return"ShowUpAnimationCMD"},e}(t.Command);t.ShowUpAnimationCMD=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_COMMON},e.prototype.getCommandName=function(){return"StartCommonCmd"},e}(t.Command);t.StartCommonCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i,s,n,a){void 0===i&&(i=!0),void 0===s&&(s=!1),void 0===n&&(n=null),void 0===a&&(a=null),t.call(this),this.jsonObj=e,e&&e.hasOwnProperty("changed")&&(this.changed=e.changed),this.showReward=i,this.showRewardBox=s,this.rewardBoxMsg=n,this.handler=a}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_COMMON},e.prototype.getCommandName=function(){return"SyncChangeCmd"},e}(t.Command);t.SyncChangeCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i){void 0===i&&(i="0"),t.call(this),this.type=0,this.groupid="0",this.type=e,this.groupid=i}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FACTION},e.prototype.getCommandName=function(){return"BindGroupCmd"},e}(t.Command);t.BindGroupCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FACTION},e.prototype.getCommandName=function(){return"EnterFactionHoleCmd"},e}(t.Command);t.EnterFactionHoleCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){void 0===e&&(e=!1),t.call(this),this.isFromCreate=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FACTION},e.prototype.getCommandName=function(){return"EnterFactionSceneCmd"},e}(t.Command);t.EnterFactionSceneCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FACTION},e.prototype.getCommandName=function(){return"EnterFactionWarCmd"},e}(t.Command);t.EnterFactionWarCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FACTION},e.prototype.getCommandName=function(){return"EnterWuguanSceneCmd"},e}(t.Command);t.EnterWuguanSceneCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FACTION},e.prototype.getCommandName=function(){return"FactionCommand"},e}(t.Command);t.FactionCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i,s,n,a){void 0===i&&(i=null),void 0===s&&(s=0),void 0===n&&(n=0),void 0===a&&(a=!1),t.call(this),this.facID=e,this.data=i,this.posX=s,this.posY=n,this.fromRankView=a}return __extends(e,t),e.prototype.setData=function(t,e,i,s){void 0===e&&(e=null),void 0===i&&(i=0),void 0===s&&(s=0),this.facID=t,this.data=e,this.posX=i,this.posY=s},e.prototype.initPanelUI=function(){this.facInfoBox||(this.facInfoBox=new ui.faction.noFac.FacInfoPanelUI)},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FACTION},e.prototype.getCommandName=function(){return"GetFacInfoPanelCmd"},e.prototype.destroy=function(){this.facInfoBox&&(this.facInfoBox.parent&&this.facInfoBox.parent.removeChild(this.facInfoBox),this.facInfoBox.destroy(),this.facInfoBox=null),this.off()},e}(t.Command);t.GetFacInfoPanelCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){void 0===e&&(e=0),t.call(this),this.index=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FACTION},e.prototype.getCommandName=function(){return"OpenBaseHallBoxCmd"},e}(t.Command);t.OpenBaseHallBoxCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FACTION},e.prototype.getCommandName=function(){return"OpenCreateFactionBoxCmd"},e}(t.Command);t.OpenCreateFactionBoxCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){
return Plugindef.PLUGIN_FACTION},e.prototype.getCommandName=function(){return"OpenDonateBoxCmd"},e}(t.Command);t.OpenDonateBoxCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FACTION},e.prototype.getCommandName=function(){return"openEditFacIconBoxCmd"},e}(t.Command);t.openEditFacIconBoxCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FACTION},e.prototype.getCommandName=function(){return"OpenFacPracticeBoxCmd"},e}(t.Command);t.OpenFacPracticeBoxCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FACTION},e.prototype.getCommandName=function(){return"OpenFactionListBoxCmd"},e}(t.Command);t.OpenFactionListBoxCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FACTION},e.prototype.getCommandName=function(){return"OpenFactionNotcieBoxCmd"},e}(t.Command);t.OpenFactionNotcieBoxCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FACTION},e.prototype.getCommandName=function(){return"OpenFactionTotemCmd"},e}(t.Command);t.OpenFactionTotemCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FACTION},e.prototype.getCommandName=function(){return"OpenRecruitBoxCmd"},e}(t.Command);t.OpenRecruitBoxCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FACTION},e.prototype.getCommandName=function(){return"OpenSearchFactionBoxCmd"},e}(t.Command);t.OpenSearchFactionBoxCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FACTION},e.prototype.getCommandName=function(){return"OpenSmritiBoxCmd"},e}(t.Command);t.OpenSmritiBoxCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i){void 0===i&&(i=null),t.call(this),this.type=e,this.data=i}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FACTION},e.prototype.getCommandName=function(){return"OpenUpdateBoxCmd"},e}(t.Command);t.OpenUpdateBoxCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FACTION},e.prototype.getCommandName=function(){return"RefreshFactionCmd"},e}(t.Command);t.RefreshFactionCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){t.call(this),this.isShow=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FACTION},e.prototype.getCommandName=function(){return"ShowOrHideFactionSceneCmd"},e}(t.Command);t.ShowOrHideFactionSceneCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(i,s,n,a){void 0===i&&(i=null),void 0===s&&(s=null),void 0===n&&(n=!1),void 0===a&&(a=!1),t.call(this),this.isReplay=!1,this.isDayFirstWin=!1,this.isRefight=!1,this.plot_id_begin="",this.plot_id_end="",this.jsonObj=i,this.isReplay=n,this.isDayFirstWin=a;var o;switch(e.testIndex++,e.testIndex){case 0:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,2,勇士,菜菜,50,5,300,5,5,1_10|2_10|3_10|4_10|5_10|6_10|7_10|8_10|9_10|10_10|11_10|12_10|13_10|14_10|15_10|16_10;&TR:1;PR1:100002,0,1,呆萌,糖糖,52,10,300,5,5,1_10|2_10|3_10|4_10|5_10|6_10|7_10|8_10|9_10|10_10|11_10|12_10|13_10|14_10|15_10|16_10;&BN:1;&BT1:1,1;RN:8;R1:2;A1:L,0,26,1,1,0,12,4,R,0,0,0,0,0;A2:R,0,27,1,2,0,12,2,L,0,0,0,0,0;R1:2;A1:L,0,0,1,3,0,12,4,R,0,0,0,0,0;A2:R,0,0,1,4,1,12,2,L,0,0,0,0,0;R1:2;A1:L,0,0,1,5,0,12,4,R,0,0,0,0,0;A2:R,0,0,1,6,0,12,2,L,0,0,0,0,0;R1:2;A1:L,0,0,1,7,0,12,4,R,0,0,0,0,0;A2:R,0,0,1,8,0,12,2,L,0,0,0,0,0;R1:2;A1:L,0,0,1,9,0,12,4,R,0,0,0,0,0;A2:R,0,0,1,10,1,12,2,L,0,0,0,0,0;R1:2;A1:L,0,0,1,11,0,12,4,R,0,0,0,0,0;A2:R,0,0,1,12,0,12,2,L,0,0,0,0,0;R1:2;A1:L,0,0,1,13,1,12,4,R,0,0,0,0,0;A2:R,0,0,1,14,1,12,2,L,0,0,0,0,0;R1:2;A1:L,0,0,1,15,1,12,4,R,0,0,0,0,0;A2:R,0,0,1,16,0,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";break;case 1:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,2,勇士,菜菜,50,5,300,5,5,1_10|2_10|3_10|4_10|5_10|6_10|7_10|8_10|9_10|10_10|11_10|12_10|13_10|14_10|15_10|16_10,1_10|2_10|8_10|9_10|10_10|11_10|12_10|13_10|16_10;&TR:1;PR1:100002,0,1,呆萌,糖糖,52,10,300,5,5,1_10|2_10|3_10|4_10|5_10|6_10|7_10|8_10|9_10|10_10|11_10|12_10|13_10|14_10|15_10|16_10,1_6|2_6|8_6|9_6|10_6|11_6|12_6|13_6|16_6;&BN:1;&BT1:1,1;RN:9;R1:2;A1:L,0,0,1,1,2,12,4,R,0,0,0,0,0;A2:R,0,0,1,1,2,12,2,L,0,0,0,0,0;R1:2;A1:L,0,0,1,2,2,12,4,R,0,0,0,0,0;A2:R,0,0,1,2,2,12,2,L,0,0,0,0,0;R1:2;A1:L,0,0,1,8,2,12,4,R,0,0,0,0,0;A2:R,0,0,1,8,2,12,2,L,0,0,0,0,0;R1:2;A1:L,0,0,1,9,2,12,4,R,0,0,0,0,0;A2:R,0,0,1,9,2,12,2,L,0,0,0,0,0;R1:2;A1:L,0,0,1,10,2,12,4,R,0,0,0,0,0;A2:R,0,0,1,10,2,12,2,L,0,0,0,0,0;R1:2;A1:L,0,0,1,11,2,12,4,R,0,0,0,0,0;A2:R,0,0,1,11,2,12,2,L,0,0,0,0,0;R1:2;A1:L,0,12,1,1,0,12,4,R,0,0,0,0,0;A2:R,0,12,1,1,0,12,2,L,0,0,0,0,0;R1:2;A1:L,0,13,1,2,0,12,4,R,0,0,0,0,0;A2:R,0,13,1,2,0,12,2,L,0,0,0,0,0;R1:2;A1:L,0,0,1,16,2,12,4,R,0,0,0,0,0;A2:R,0,0,1,16,2,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";break;case 2:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,2,勇士,菜菜,50,5,300,5,5,1_10|2_10|3_10|4_10|5_10|6_10|7_10|8_10|9_10|10_10|11_10|12_10|13_10|14_10|15_10|16_10;&TR:1;PR1:100002,0,1,呆萌,糖糖,52,10,300,5,5,1_10|2_10|3_10|4_10|5_10|6_10|7_10|8_10|9_10|10_10|11_10|12_10|13_10|14_10|15_10|16_10;&BN:1;&BT1:1,1;RN:2;R1:2;A1:L,0,0,1,2,2,12,4,R,0,0,0,0,0;A2:R,0,0,1,16,2,12,2,L,0,0,0,0,0;R1:2;A1:L,0,0,1,1,2,12,4,R,0,0,0,0,0;A2:R,0,0,1,9,2,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";break;case 6:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,1,勇士,菜菜,50,5,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&TR:1;PR1:100002,20,2,呆萌,糖糖,52,10,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&BN:1;&BT1:1,1;RN:3;R1:2;A1:R,0,26,1,0,0,12,2,L,0,0,0,0,0;A2:R,0,19,1,0,0,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,0,0,12,2,L,0,0,0,0,0;A2:R,0,0,1,0,0,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,0,0,12,2,L,0,0,0,0,0;A2:R,0,0,1,0,0,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";break;case 7:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,1,勇士,菜菜,50,5,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&TR:1;PR1:100002,7,2,呆萌,糖糖,52,10,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&BN:1;&BT1:1,1;RN:3;R1:2;A1:R,0,0,1,20,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,21,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,22,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,23,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,24,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,25,2,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";break;case 9:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,1,勇士,菜菜,50,5,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&TR:1;PR1:100002,9,2,呆萌,糖糖,52,10,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&BN:1;&BT1:1,1;RN:3;R1:2;A1:R,0,0,1,20,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,21,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,22,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,23,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,24,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,25,2,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";break;case 10:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,1,勇士,菜菜,50,5,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&TR:1;PR1:100002,10,2,呆萌,糖糖,52,10,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&BN:1;&BT1:1,1;RN:3;R1:2;A1:R,0,0,1,20,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,21,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,22,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,23,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,24,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,25,2,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";break;case 11:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,1,勇士,菜菜,50,5,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&TR:1;PR1:100002,11,2,呆萌,糖糖,52,10,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&BN:1;&BT1:1,1;RN:3;R1:2;A1:R,0,0,1,20,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,21,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,22,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,23,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,24,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,25,2,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";break;case 14:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,1,勇士,菜菜,50,5,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&TR:1;PR1:100002,14,2,呆萌,糖糖,52,10,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&BN:1;&BT1:1,1;RN:3;R1:2;A1:R,0,0,1,20,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,21,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,22,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,23,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,24,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,25,2,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";break;case 15:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,1,勇士,菜菜,50,5,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&TR:1;PR1:100002,15,2,呆萌,糖糖,52,10,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&BN:1;&BT1:1,1;RN:3;R1:2;A1:R,0,0,1,20,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,21,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,22,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,23,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,24,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,25,2,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";break;case 19:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,1,勇士,菜菜,50,5,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&TR:1;PR1:100002,19,2,呆萌,糖糖,52,10,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&BN:1;&BT1:1,1;RN:3;R1:2;A1:R,0,0,1,20,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,21,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,22,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,23,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,24,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,25,2,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";break;case 20:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,1,勇士,菜菜,50,5,300,5,5,1_0;&TR:1;PR1:100002,20,2,呆萌,糖糖,52,10,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&BN:1;&BT1:1,1;RN:3;R1:2;A1:R,0,0,1,20,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,21,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,22,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,23,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,24,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,25,2,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";break;case 21:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,1,勇士,菜菜,50,5,300,5,5,1_0;&TR:1;PR1:100002,21,2,呆萌,糖糖,52,10,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&BN:1;&BT1:1,1;RN:3;R1:2;A1:R,0,0,1,20,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,21,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,22,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,23,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,24,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,25,2,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";break;case 22:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,1,勇士,菜菜,50,5,300,5,5,1_0;&TR:1;PR1:100002,22,2,呆萌,糖糖,52,10,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&BN:1;&BT1:1,1;RN:3;R1:2;A1:R,0,0,1,20,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,21,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,22,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,23,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,24,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,25,2,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";break;case 23:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,1,勇士,菜菜,50,5,300,5,5,1_0;&TR:1;PR1:100002,23,2,呆萌,糖糖,52,10,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&BN:1;&BT1:1,1;RN:3;R1:2;A1:R,0,0,1,20,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,21,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,22,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,23,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,24,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,25,2,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";break;case 25:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,1,勇士,菜菜,50,5,300,5,5,1_0;&TR:1;PR1:100002,25,2,呆萌,糖糖,52,10,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&BN:1;&BT1:1,1;RN:3;R1:2;A1:R,0,0,1,20,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,21,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,22,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,23,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,24,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,25,2,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";break;case 26:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,1,勇士,菜菜,50,5,300,5,5,1_0;&TR:1;PR1:100002,26,2,呆萌,糖糖,52,10,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&BN:1;&BT1:1,1;RN:3;R1:2;A1:R,0,0,1,20,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,21,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,22,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,23,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,24,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,25,2,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";break;case 27:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,1,勇士,菜菜,50,5,300,5,5,1_0;&TR:1;PR1:100002,27,2,呆萌,糖糖,52,10,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&BN:1;&BT1:1,1;RN:3;R1:2;A1:R,0,0,1,20,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,21,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,22,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,23,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,24,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,25,2,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";break;case 28:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,1,勇士,菜菜,50,5,300,5,5,1_0;&TR:1;PR1:100002,28,2,呆萌,糖糖,52,10,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&BN:1;&BT1:1,1;RN:3;R1:2;A1:R,0,0,1,20,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,21,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,22,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,23,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,24,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,25,2,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";break;case 29:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,1,勇士,菜菜,50,5,300,5,5,1_0;&TR:1;PR1:100002,29,2,呆萌,糖糖,52,10,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&BN:1;&BT1:1,1;RN:3;R1:2;A1:R,0,0,1,20,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,21,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,22,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,23,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,24,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,25,2,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";break;case 30:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,1,勇士,菜菜,50,5,300,5,5,1_0;&TR:1;PR1:100002,30,2,呆萌,糖糖,52,10,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&BN:1;&BT1:1,1;RN:3;R1:2;A1:R,0,0,1,20,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,21,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,22,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,23,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,24,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,25,2,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";break;case 31:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,1,勇士,菜菜,50,5,300,5,5,1_0;&TR:1;PR1:100002,31,2,呆萌,糖糖,52,10,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0;&BN:1;&BT1:1,1;RN:3;R1:2;A1:R,0,0,1,20,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,21,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,22,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,23,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,24,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,25,2,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";break;case 32:o="&V:1;&Ty:1;&BG:10003;&TL:1;PL1:468240214,0,1,斗神,勿斗468240214玩我,33,0,783,,,,14_6;&TR:1;PR1:468240214,0,1,斗神,勿斗468240214玩我,33,0,783,,,,14_10;&BN:1;&BT1:1,1;RN:2;R1:2;A1:R,0,0,1,0,0,3375,2,,,,L,0,0,0,0,,7*8_1,,;A2:L,0,0,1,0,0,3212,2,,,,R,0,0,0,0,,7*8_1,,;R2:1;A1:R,0,0,1,0,0,3391,2,,,,L,0,0,0,0,,,,;&RLT:13;";break;default:o="&V:1;&Ty:1;&BG:30009;&TL:1;PL1:100001,0,1,勇士,菜菜,50,5,300,5,5,1_0,14_6;&TR:1;PR1:100002,31,2,呆萌,糖糖,52,10,300,5,5,1_0|2_0|3_0|4_0|5_0|6_0|7_0|8_0|9_0|10_0|11_0|12_0|13_0|14_0|15_0,14_10;&BN:1;&BT1:1,1;RN:3;R1:2;A1:R,0,0,1,20,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,21,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,22,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,23,2,12,2,L,0,0,0,0,0;R1:2;A1:R,0,0,1,24,2,12,2,L,0,0,0,0,0;A2:R,0,0,1,25,2,12,2,L,0,0,0,0,0;&RLT:1;&RW:0;"}e.testIndex++;var r=i?i.replay?i.replay:i:o;this.fightData=r,this.awardData=i.replay?i:null}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FIGHT},e.prototype.getCommandName=function(){return"FightCommand"},e.testIndex=5,e}(t.Command);t.FightCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i){void 0===e&&(e=0),void 0===i&&(i=!1),t.call(this),this.replayId=0,this.isShareReplay=!1,this.replayId=e,this.isShareReplay=i}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FIGHT},e.prototype.getCommandName=function(){return"FightReplayCommand"},e}(t.Command);t.FightReplayCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){t.call(this),this.resultData=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FIGHT},e.prototype.getCommandName=function(){return"FightResultCommand"},e}(t.Command);t.FightResultCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FIGHT},e.prototype.getCommandName=function(){return"FightRetryCommand"},e}(t.Command);t.FightRetryCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FIGHT},e.prototype.getCommandName=function(){return"FightTestCommand"},e}(t.Command);t.FightTestCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this),this.targerId=0,this.targerName=""}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FRIEND},e.prototype.getCommandName=function(){return"FriendAddCommand"},e}(t.Command);t.FriendAddCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this),this.tabIndex=1}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null),t?this.tabIndex=parseInt(t[0]):this.tabIndex=1},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FRIEND},e.prototype.getCommandName=function(){return"FriendCommand"},e}(t.Command);t.FriendCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_FRIEND},e.prototype.getCommandName=function(){return"FriendTipsCommand"},e}(t.Command);t.FriendTipsCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_GEM},e.prototype.getCommandName=function(){return"EquipGemCmd"},e}(t.Command);t.EquipGemCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this),this.SLOT_SELECTED=0,this.GEM_CLICK=1,this.TAKE_OFF=3}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_GEM},e.prototype.getCommandName=function(){return"GemOpCmd"},e}(t.Command);t.GemOpCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_GEM},e.prototype.getCommandName=function(){return"OpenGemCmd"},e}(t.Command);t.OpenGemCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_GEM},e.prototype.getCommandName=function(){return"TakeOffGemCmd"},e}(t.Command);t.TakeOffGemCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_GEM},e.prototype.getCommandName=function(){return"UpgradeGemCmd"},e}(t.Command);t.UpgradeGemCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i){void 0===i&&(i=null),t.call(this),this.condition=e,this.param=i}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_GUIDE},e.prototype.getCommandName=function(){return"CheckShowGuideCommand"},e.BOX_OPEN=1,e.BOX_CLOSE=2,e.SCENE_CHANGE=3,e.FIGHT_RESULT_OPEN=4,e.FIGHT_CLOSE=5,e.FIGHT_ENTER=6,e.GET_REWARD=7,e.STEP_CHANGE=8,e.SKILL_TAB_CHANGE=9,e.CHANNEL_TAB2=10,e.GET_WEAPON_INFO=11,e.FRIEND_TAB1=12,e.FRIEND_SEND=13,e.WULIN_SIGNUP=15,e.LV_GUIDE=16,e.GEM_CLICK=17,e.COLLECT_CLICK=18,e.QYHBTN_CLICK=19,e.JUMP_FRIEND_FIGHT=20,e.CLICK_WORK_BTN=21,e.CLICK_TOWER=22,e.CLICK_TOWER_SHOW=23,e.CLICK_USE_OR_BUY_BUFF=24,e.XKXBTN_CLICK=25,e.COLLECT_AND_GUIDE1_OVER=26,e.COLLECT_AND_GUIDE2_OVER=27,e.COLLECT_AND_GUIDE3_OVER=28,e.COLLECT_IOS_GUIDE1_OVER=29,e.COLLECT_IOS_GUIDE2_OVER=30,e.CLICK_UPLEVEL_BTN=31,e.CLICK_USER_BTN=32,e.CLICK_SHOUJI_BTN=33,e.CLICK_CHAIN_WEAPON=34,e.CLICK_CHAIN_SAVE_WEAPON=35,e.CLICK_SELFATTR=36,e.SHEJIAOBTN_CLICK=37,e.HIDE_FIGHT_GUIDE=38,e.CLICK_CHAMPION_START_BTN=39,e.CLICK_CHAMPION_CANCEL_BTN=40,e.COLLECT_WEIXIN_DESTROY=41,e.HERO_BTN_CLICK=42,e}(t.Command);t.CheckShowGuideCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_GUIDE},e.prototype.getCommandName=function(){return"StartGuideCommand"},e}(t.Command);t.StartGuideCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_GUIDE},e.prototype.getCommandName=function(){return"StopGuideCommand"},e}(t.Command);t.StopGuideCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_HANDBOOK},e.prototype.getCommandName=function(){return"CloseHandbookBoxCommand"},e}(t.Command);t.CloseHandbookBoxCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i,s,n){t.call(this),this.type=e,this.id=i,this.lv=s,this.handler=n}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_HANDBOOK},e.prototype.getCommandName=function(){return"GetHandbookAwardStatusCommand"},e}(t.Command);t.GetHandbookAwardStatusCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){void 0===e&&(e=0),t.call(this),this.viewType=0,this.viewType=e}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null),t&&(this.viewType=t[0])},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_HANDBOOK},e.prototype.getCommandName=function(){return"OpenHandbookBoxCommand"},e}(t.Command);t.OpenHandbookBoxCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_HANGUP},e.prototype.getCommandName=function(){return"HangupCmd"},e}(t.Command);t.HangupCmd=e;var i=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_HANGUP},e.prototype.getCommandName=function(){return"OpenHangupBagCmd"},e}(t.Command);t.OpenHangupBagCmd=i;var s=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_HANGUP},e.prototype.getCommandName=function(){return"ShowDivineTroopsCmd"},e}(t.Command);t.ShowDivineTroopsCmd=s;var n=function(t){function e(e){t.call(this),this.data=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_HANGUP},e.prototype.getCommandName=function(){return"ShowHandupUpgradeCmd"},e}(t.Command);t.ShowHandupUpgradeCmd=n;var a=function(t){function e(e){void 0===e&&(e=null),t.call(this),this.data=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_HANGUP},e.prototype.getCommandName=function(){return"RefreshHangupCmd"},e}(t.Command);t.RefreshHangupCmd=a;var o=function(t){function e(e){t.call(this),this.data=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_HANGUP},e.prototype.getCommandName=function(){return"ShowGiftBoxCmd"},e}(t.Command);t.ShowGiftBoxCmd=o;var r=function(t){function e(e){t.call(this),this.cost=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_HANGUP},e.prototype.getCommandName=function(){return"UpdatePointCmd"},e}(t.Command);t.UpdatePointCmd=r}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_HOME},e.prototype.getCommandName=function(){return"CheckAllStatusCommand"},e}(t.Command);t.CheckAllStatusCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){t.call(this),this.buttonName=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_HOME},e.prototype.getCommandName=function(){return"CheckMenuStatus"},e}(t.Command);t.CheckMenuStatus=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_HOME},e.prototype.getCommandName=function(){return"HideAllSubMenu"},e}(t.Command);t.HideAllSubMenu=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_HOME},e.prototype.getCommandName=function(){return"HomeBubbleCmd"},e}(t.Command);t.HomeBubbleCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,
new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_HOME},e.prototype.getCommandName=function(){return"HomeCommand"},e}(t.Command);t.HomeCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){t.call(this),this.id=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_HOME},e.prototype.getCommandName=function(){return"HomeEffectActiveCmd"},e}(t.Command);t.HomeEffectActiveCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){t.call(this),this.cmd=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_HOME},e.prototype.getCommandName=function(){return"HomeMenuCmd"},e}(t.Command);t.HomeMenuCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_HOME},e.prototype.getCommandName=function(){return"HomePreLoad"},e}(t.Command);t.HomePreLoad=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){void 0===e&&(e="0"),t.call(this),this.id=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_HOME},e.prototype.getCommandName=function(){return"PlayDramaCmd"},e.ERR_REPEAT_REQUEST=2e3,e.ERR_NOT_EXIST=2001,e}(t.Command);t.PlayDramaCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){t.call(this),this.id=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_HOME},e.prototype.getCommandName=function(){return"RollRefreshCmd"},e}(t.Command);t.RollRefreshCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i,s){void 0===s&&(s=null),t.call(this),this.uData=e,this._this=i,this._callback=s}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_USERINFO},e.prototype.getCommandName=function(){return"AddPointCommand"},e}(t.Command);t.AddPointCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_BAG},e.prototype.getCommandName=function(){return"BagCommand"},e}(t.Command);t.BagCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){t.call(this),this.goods=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_BAG},e.prototype.getCommandName=function(){return"GoodsUseCmd"},e}(t.Command);t.GoodsUseCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){void 0===e&&(e=null),t.call(this),this.puid=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_USERINFO},e.prototype.getCommandName=function(){return"SelfAttrCommand"},e}(t.Command);t.SelfAttrCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_USERINFO},e.prototype.getCommandName=function(){return"SelfInfoCommand"},e}(t.Command);t.SelfInfoCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i,s){void 0===e&&(e=null),void 0===i&&(i=0),void 0===s&&(s=null),t.call(this),this.puid=e,this.layerType=i,this.userData=s}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null),t&&(this.puid=null,this.layerType=Number(t[0]))},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_USERINFO},e.prototype.getCommandName=function(){return"UserInfoCommand"},e}(t.Command);t.UserInfoCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_INVITE_FRIEND},e.prototype.getCommandName=function(){return"InviteFriendCommand"},e}(t.Command);t.InviteFriendCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_INVITE_FRIEND},e.prototype.getCommandName=function(){return"InviteRuleCommand"},e}(t.Command);t.InviteRuleCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_LILIAN},e.prototype.getCommandName=function(){return"GetGiftCmd"},e}(t.Command);t.GetGiftCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i){void 0===e&&(e=0),void 0===i&&(i=0),t.call(this),this.sceneId=0,this["default"]=0,this.sceneId=e,this["default"]=i}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null),t&&t.length>0?(this.sceneId=t[0],this["default"]=1,t.length>1&&(this["default"]=t[1])):this.sceneId=0},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_LILIAN},e.prototype.getCommandName=function(){return"LilianCmd"},e}(t.Command);t.LilianCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_LILIAN},e.prototype.getCommandName=function(){return"OpenGuankaCmd"},e}(t.Command);t.OpenGuankaCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_LILIAN},e.prototype.getCommandName=function(){return"OpenMapCmd"},e}(t.Command);t.OpenMapCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_LILIAN},e.prototype.getCommandName=function(){return"ReqFightCmd"},e}(t.Command);t.ReqFightCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_LILIAN},e.prototype.getCommandName=function(){return"SweepCmd"},e}(t.Command);t.SweepCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_MAIL},e.prototype.getCommandName=function(){return"MailCommand"},e}(t.Command);t.MailCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_MARRY},e.prototype.getCommandName=function(){return"CloseMarryBoxCommand"},e}(t.Command);t.CloseMarryBoxCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_MARRY},e.prototype.getCommandName=function(){return"GetMarryDataCommand"},e.prototype.destroy=function(){this.queryData=null},e}(t.Command);t.GetMarryDataCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_MARRY},e.prototype.getCommandName=function(){return"OpenMarry88BoxCommand"},e}(t.Command);t.OpenMarry88BoxCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i){void 0===e&&(e=""),void 0===i&&(i=""),t.call(this),this.viewType=e,this.data=i}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_MARRY},e.prototype.getCommandName=function(){return"OpenMarryBoxCommand"},e}(t.Command);t.OpenMarryBoxCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null)},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_MASTER},e.prototype.getCommandName=function(){return"MasterCommand"},e}(t.Command);t.MasterCommand=e;var i=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null)},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_MASTER},e.prototype.getCommandName=function(){return"MasterLilianCommand"},e}(t.Command);t.MasterLilianCommand=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,t.ModelDef.ACT_ITEM_MODEL),this._id=0,this._reddot=0,this._tips=0,this._name="",this._default_num=0,this._max_num=0}return __extends(i,e),Object.defineProperty(i.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"reddot",{get:function(){return this._reddot},set:function(t){this._reddot=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"tips",{get:function(){return this._tips},set:function(t){this._tips=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"num",{get:function(){return this._default_num},set:function(t){this._default_num=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxnum",{get:function(){return this._max_num},set:function(t){this._max_num=t},enumerable:!0,configurable:!0}),i}(t.BaseModel);t.ActItemModel=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,t.ModelDef.ACT_MODEL),this._looptime=60,this._list=[],this._hasData=!1,this._redFlag=0,this._tipsList=[],this._showtipsList=[],this._list=[],this._hasData=!1,this._redFlag=0,this.loadAct()}return __extends(i,e),Object.defineProperty(i.prototype,"List",{get:function(){return this._list},set:function(e){var i=0;this._showtipsList=[],this._tipsList=[];for(var s=0;s<this._list.length;s++)this._list[s].hasClose&&this.getArrById(this._list[s].id,e)&&(this.getArrById(this._list[s].id,e).hasClose=this._list[s].hasClose),t.ActConf.IsClientRedotAct(this._list[s].frontid)&&this.getArrById(this._list[s].id,e)&&(this.getArrById(this._list[s].id,e).reddot=this._list[s].reddot);this._list=[];for(var s=0;s<e.length;s++)e[s].hasClose=!!e[s].hasClose,this._list[s]=e[s],"1"==e[s].special&&null==t.ActConf.getAct(e[s].frontid)&&(this._list[s].unshow=1),e[s].unshow_channel==t.JSUtils.getChannel()+""&&(this._list[s].unshow=1),1==e[s].reddot&&1!=e[s].unshow&&(i=1),this._list[s].todaylastsec<1&&1!=this._list[s].hasClose&&1==this._list[s].reddot&&this.addShowTips(this._list[s]);this.hasData=!0,this.redFlag=i,t.Facade.singleton.model.retrieveModel(t.ModelDef.ALL_STATUS_MODEL).setStatueFlagByName("kActCenter",this.redFlag),Laya.timer.clear(this,this.loadAct),Laya.timer.loop(1e3*this._looptime,this,this.loadAct),this.updateFinish()},enumerable:!0,configurable:!0}),i.prototype.getArrById=function(t,e){for(var i=0;i<e.length;i++)if(t==e[i].id)return e[i];return!1},i.prototype.reload=function(){Laya.timer.once(1e3,this,this.loadAct)},i.prototype.GetActById=function(t){for(var e=0;e<this._list.length;e++)if(this._list[e].id==t)return this._list[e];return this._list[0]},i.prototype.GetIndexById=function(t){for(var e=0,i=0;i<this._list.length;i++)if(0!=this._list[i].unshow&&e++,this._list[i].id==t)return i-e;return 0},i.prototype.GetActByFrontId=function(t){for(var e=0;e<this._list.length;e++)if(this._list[e].frontid==t)return this._list[e];return this._list[0]},i.prototype.ChangeKeyById=function(t,e,i){this.GetActById(t)[e]=i,this.List=this._list},i.prototype.loadAct=function(){var e={cmd:"acthall",subcmd:"Get",needreload:"0"};t.XHR().Post(e,this,function(t){0==t.result&&(this.List=t.acts)},!1)},i.prototype.hasActivity=function(t){if(!this.List)return!1;for(var e,i=0;i<this.List.length;i++)if(e=this.List[i],e.frontid==t)return!0;return!1},Object.defineProperty(i.prototype,"hasData",{get:function(){return this._hasData},set:function(t){this._hasData=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"redFlag",{get:function(){return this._redFlag},set:function(t){this._redFlag=t},enumerable:!0,configurable:!0}),i.prototype.addTips=function(t){this._tipsList.push(t)},Object.defineProperty(i.prototype,"tipsList",{get:function(){return this._tipsList},set:function(t){this._tipsList=t},enumerable:!0,configurable:!0}),i.prototype.addShowTips=function(t){for(var e=!1,i=0;i<this._showtipsList.length;i++)this._showtipsList[i].id==t.id&&(e=!0);e||this._showtipsList.push(t)},i.prototype.removeShowTips=function(){this._showtipsList.length>0&&(this.GetActById(this._showtipsList[0].id).hasClose=!0,this.List=this._list)},Object.defineProperty(i.prototype,"hasTips",{get:function(){return this._showtipsList.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"showTips",{get:function(){return this._showtipsList[0]},enumerable:!0,configurable:!0}),i}(t.BaseModel);t.ActModel=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,t.ModelDef.ALL_STATUS_MODEL),this.map=new laya.utils.Dictionary}return __extends(s,e),s.prototype.setData=function(t){if(t){for(var e=0;e<t.length;e++){var s=t[e],n=this.map.get(s.name);n||(n=new i,n.name=s.name,this.map.set(n.name,n)),n.flag=s.flag}this.updateFinish()}},s.prototype.updateData=function(t){if(t){var e,n,a=[s.LV_GIFT_STATE,s.LOGIN_GIFT_STATE,s.TASK_STATE,s.ROLE_STATE,s.COLLECT_STATE,s.SERVENGT_STATE,s.CHANGE72_STATE,s.FACTION_STAGE,s.HANDBOOK_STATE,s.FIGHTING_FACTION,s.FIGHTING_GEM,s.FIGHTING_UPGRADE,s.SCHOOL_OPEN_2017,s.NATIONAL_STATE];for(e=0;e<a.length;e++)n=this.map.get(a[e]),n&&(n.flag=0);for(e=0;e<t.length;e++){var o=t[e],n=this.map.get(o.name);n||(n=new i,n.name=o.name,this.map.set(n.name,n)),n.flag=1}this.updateFinish()}},s.prototype.getStatueFlagByName=function(t){var e=this.map.get(t);return e?e.flag:-1},s.prototype.setStatueFlagByName=function(t,e,s){void 0===s&&(s=!0);var n=this.map.get(t);n||(n=new i,n.name=t,this.map.set(n.name,n)),n.flag=e,s&&this.updateFinish()},s.LV_GIFT_STATE="kRedDotLevel",s.LOGIN_GIFT_STATE="kRedDotLogin",s.TASK_STATE="kRedDotTask",s.MAIL_STATE="kRedDotMail",s.ROLE_STATE="kRedDotRole",s.COLLECT_STATE="kRedDotAddDesk",s.CHANGE72_STATE="kRedDot72",s.FACTION_STAGE="kRedDotFaction",s.NATIONAL_STATE="kCollectWords",s.Act_STATE="kActCenter",s.SERVENGT_STATE="kRedDotServant",s.INVITE_STATE="inviteRedState",s.HANDBOOK_STATE="kRedDotHandBook",s.FIGHTING_CHANNEL="kRedDotSprit",s.FIGHTING_UPGRADE="kRedDotBagGlodNum",s.FIGHTING_GEM="kRedDotGem",s.FIGHTING_FACTION="kRedDotFactionSkill",s.FIGHTING_CHAIN="kRedDotBagSecretNum",s.DINGYUE="kRedDotDingyue",s.WULIN_STATE="kRedDotWulin",s.MASTER_STATE="kRedDotMaster",s.CHAMPION_STATE="kRedDotChampion",s.SCHOOL_OPEN_2017="kSchoolOpens",s.EENEGY="eEnegy",s}(t.BaseModel);t.AllStatusModel=e;var i=function(e){function i(){e.call(this,t.ModelDef.STATUS_ITEM_MODEL)}return __extends(i,e),i}(t.BaseModel);t.StatusItemModel=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,t.ModelDef.BUFF_MODEL),this.buffDiction={}}return __extends(i,e),Object.defineProperty(i.prototype,"buffs",{get:function(){return this._buffs},set:function(t){if(t){for(var e=t.length,i=0;e>i;i++)this.buffDiction["buff"+t[i].id]=t[i];this._buffs=t,this.updateFinish()}else this._buffs=[]},enumerable:!0,configurable:!0}),i.prototype.updateBuffData=function(){t.XHR().Post({cmd:"detail",op:"status"},this,this.onStatuInfo)},i.prototype.onStatuInfo=function(t){0==t.result&&(this.buffs=t.status_info)},i}(t.BaseModel);t.BuffModel=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,t.ModelDef.FACTION_BRIEF_MODEL),this.facID=0}return __extends(i,e),i}(t.BaseModel);t.FactionBriefModel=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,t.ModelDef.FACTION_MODEL_SELF),this.facID=0,this.facIcon=1,this.facLv=0,this.facName="",this.ownerName="",this.dayDonationTimes=0,this.facNotice="",this.applyNeedLv=1,this.applyCordition=0,this.fightPower=0,this.groupid="",this.members=[],this.res_fanrong=0,this.res_stone=0,this.res_wood=0,this.res_iron=0,this.viceOwnerCount=0,this.elderCount=0,this.eliteCount=0,this.memberCount=0,this.totem_flag=0,this.totem_table=0,this.totem_pic=0,this.totemsArr=[],this.reddotArr=[],this.selfFactionUserModel=new t.FactionUserModel}return __extends(i,e),i.prototype.setData=function(e){if(t.Util.DecodeJSONProperty("content",e),t.Util.DecodeJSONProperty("wang_name",e),e.hasOwnProperty("faction_base")){var i=e.faction_base;if(i.hasOwnProperty("facid")&&(this.facID=Number(i.facid)),i.hasOwnProperty("name")&&(this.facName=i.name),i.hasOwnProperty("donation_times")&&(this.dayDonationTimes=Number(i.donation_times)),i.hasOwnProperty("level")&&(this.facLv=Number(i.level)),i.hasOwnProperty("wang_name")&&(this.ownerName=i.wang_name),i.hasOwnProperty("notice")&&(this.facNotice=i.notice),i.hasOwnProperty("fight_power")&&(this.fightPower=Number(i.fight_power)),i.hasOwnProperty("groupid")&&(this.groupid=i.groupid),this.applyNeedLv=t.UserModel.NEED_USERLV_FACTION,i.hasOwnProperty("fac_option")){this.applyCordition=Number(i.fac_option.joinType);var s=Number(i.fac_option.joinLevel);this.applyNeedLv=s<t.UserModel.NEED_USERLV_FACTION?t.UserModel.NEED_USERLV_FACTION:s}if(i.hasOwnProperty("resource")){var n=i.resource;n.hasOwnProperty("glory")&&(this.res_fanrong=Number(n.glory)),n.hasOwnProperty("stone")&&(this.res_stone=Number(n.stone)),n.hasOwnProperty("wood")&&(this.res_wood=Number(n.wood)),n.hasOwnProperty("iron_ore")&&(this.res_iron=Number(n.iron_ore))}if(i.hasOwnProperty("using_totem")){var a=i.using_totem;this.totem_flag=0==a[0]?t.FactionConfig.DEFAULT_TOTEM_FLAG:a[0],this.totem_table=0==a[1]?t.FactionConfig.DEFAULT_TOTEM_TABLE:a[1],this.totem_pic=0==a[2]?t.FactionConfig.DEFAULT_TOTEM_PIC:a[2],this.facIcon=0==a[3]?t.FactionConfig.DEFAULT_ICON:a[3]}}if(this.totemsArr=[],e.hasOwnProperty("totems")&&(this.totemsArr=e.totems),this.viceOwnerCount=0,this.elderCount=0,this.eliteCount=0,e.hasOwnProperty("members")){this.members=e.members,this.members.sort(function(t,e){return 1e6*(e.pos-t.pos)+100*(e.fight_power-t.fight_power)+(e.level-t.level)}),this.memberCount=this.members.length;for(var o=0;o<this.memberCount;o++){var r=this.members[o];switch(Number(r.pos)){case t.FactionUserModel.POS_VICE_OWNER:this.viceOwnerCount++;break;case t.FactionUserModel.POS_ZHANGLAO:this.elderCount++;break;case t.FactionUserModel.POS_JINGYING:this.eliteCount++}}}if(e.hasOwnProperty("enable_level")){var h=e.enable_level;h.hasOwnProperty("pratic_hall")&&(t.FactionConfig.OPEN_PRACTICE_HALL_NEED_LV=Number(h.pratic_hall)),h.hasOwnProperty("club")&&(t.FactionConfig.OPEN_WUGUAN_NEED_LV=Number(h.club)),h.hasOwnProperty("cave")&&(t.FactionConfig.OPEN_HOLE_NEED_LV=Number(h.cave)),h.hasOwnProperty("challenge")&&(t.FactionConfig.OPEN_WAR_NEED_LV=Number(h.challenge))}for(;this.reddotArr.length>0;)this.reddotArr.shift();if(e.hasOwnProperty("faction_reddot"))for(var l=e.faction_reddot,o=0;o<l.length;o++)this.reddotArr.push(Number(l[o].id));this.setSelfData(e,!0),this.updateFinish()},i.prototype.setReddot=function(t,e){var i=this.reddotArr.indexOf(t);e?-1==i&&(this.reddotArr.push(t),this.updateFinish()):-1!=i&&(this.reddotArr.splice(i,1),this.updateFinish())},i.prototype.setSelfData=function(e,i){void 0===i&&(i=!1),this.selfFactionUserModel||(this.selfFactionUserModel=new t.FactionUserModel),e.hasOwnProperty("user_faction")&&this.selfFactionUserModel.setData(e.user_faction),0==i&&this.updateFinish()},Object.defineProperty(i.prototype,"isMaxLv",{get:function(){return this.facLv==t.FactionConfig.MAX_BASEHALL_LV},enumerable:!0,configurable:!0}),i}(t.BaseModel);t.FactionModel=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.kFactionRedDotTypeApply=0,e.kFactionRedDotTypeDonation=1,e.kFactionRedDotTypeFightClub=2,e.kFactionRedDotTypeFightCave=3,e.kFactionRedDotTypeReward=4,e.kFactionRedDotTypeApplicants=5,e.kFactionRedDotTypeHallUpgrade=6,e.kFactionRedDotTypeMClubUpgrade=7,e.kFactionRedDotTypeFactionWar=8,e}(t.BaseModel);t.FactionReddotEnum=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,t.ModelDef.FACTION_USER_MODEL),this.position=0,this.banggong_now=0,this.banggong_total=0,this.todayDonateFlag=0,this.todayRemainApplyCount=0,this.holePoint=0,this.position=100}return __extends(i,e),i.prototype.setData=function(t){t.hasOwnProperty("pos")&&(this.position=t.pos),t.hasOwnProperty("contrib")?this.banggong_now=Number(t.contrib):this.banggong_now=0,t.hasOwnProperty("history_contrib")?this.banggong_total=Number(t.history_contrib):this.banggong_total=0,t.hasOwnProperty("donation_flags")&&(this.todayDonateFlag=Number(t.donation_flags)),t.hasOwnProperty("join_times")&&(this.todayRemainApplyCount=Number(t.join_times)),t.hasOwnProperty("cave_point")?this.holePoint=Number(t.cave_point):this.holePoint=0,t.hasOwnProperty("join_time")?this.joinTime=Number(t.join_time):this.joinTime=0},i.prototype.isFirstDay=function(){var e;if(t.ServerClock.getServerTime()/1e3-this.joinTime>=86400)e=!0;else{var i=t.ServerClock.getServerDateByTime(1e3*this.joinTime),s=t.ServerClock.getServerNowDate();e=i.getHours()>=6?s.getFullYear()==i.getFullYear()&&s.getMonth()==i.getMonth()&&s.getDate()==i.getDate()?!1:s.getHours()>=6:s.getFullYear()!=i.getFullYear()||s.getMonth()!=i.getMonth()||s.getDate()!=i.getDate()||s.getHours()>=6}return!e},i.getPosStr=function(t){var e;return e=600==t?"帮主":500==t?"副帮主":400==t?"长老":300==t?"堂主":200==t?"精英":"帮众"},i.getUpPos=function(t){var e;return e=600==t?t:500==t?i.POS_OWNER:400==t?i.POS_VICE_OWNER:200==t?i.POS_ZHANGLAO:i.POS_JINGYING},i.POS_OWNER=600,i.POS_VICE_OWNER=500,i.POS_ZHANGLAO=400,i.POS_JINGYING=200,i.POS_NORMAL=100,i}(t.BaseModel);t.FactionUserModel=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,t.ModelDef.GUIDE_MODEL)}return __extends(i,e),Object.defineProperty(i.prototype,"isGuiding",{get:function(){return this._isGuiding},set:function(t){this._isGuiding=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasGift",{get:function(){return this._hasGift},set:function(t){this._hasGift=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"guidetaskID",{get:function(){return this._guidetaskID},set:function(e){this._guidetaskID=e;var i=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);i.level<7&&246==e&&(this._guidetaskID=0)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"nowStep",{get:function(){return this._nowStep},set:function(t){this._nowStep=t},enumerable:!0,configurable:!0}),i.prototype.isFirst=function(){var e,i=t.Facade.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);return e=t.Global.isWX?1!=i.getLongDataValue(t.ServerSetDataModel.KEY_HAS_SHOW_WEIXIN_COLLECT_GUIDE):1!=i.hasCollect,(null==i||e)&&this.isGuiding&&241==this.guidetaskID&&!this.hasGift},i.TASKID_BEGIN=241,i.TASKID_END=250,i}(t.BaseModel);t.GuideModel=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,t.ModelDef.PACK_Item_MODEL),this._id=0,this._subId=0,this._name="",this._num=0,this._changeNum=0,this._type=0,this._goods_type=0,this._effectDes="",this._des="",this._short_des="",this._url=""}return __extends(i,e),Object.defineProperty(i.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"subId",{get:function(){return this._subId},set:function(t){this._subId=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"num",{get:function(){return this._num},set:function(t){this._num=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"changeNum",{get:function(){return this._changeNum},set:function(t){this._changeNum=0>t?0:t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"type",{get:function(){return this._type},set:function(t){this._type=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"goods_type",{get:function(){return this._goods_type},set:function(t){this._goods_type=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"effectDes",{get:function(){return this._effectDes},set:function(t){this._effectDes=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"des",{get:function(){return this._des},set:function(t){this._des=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"short_des",{get:function(){return this._short_des},set:function(t){this._short_des=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"canUse",{get:function(){return this._canUse},set:function(t){this._canUse=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"canDrop",{get:function(){return this._canDrop},set:function(t){this._canDrop=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"url",{get:function(){return this._url},set:function(t){this._url=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"icon_id",{get:function(){return this._icon_id},set:function(t){this._icon_id=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"gem_level",{get:function(){return this._gem_level},set:function(t){
this._gem_level=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"gem_type",{get:function(){return this._gem_type},set:function(t){this._gem_type=t},enumerable:!0,configurable:!0}),i}(t.BaseModel);t.PackItemModel=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.utils.Dictionary,i=function(i){function s(){i.call(this,t.ModelDef.PACK_MODEL),this._itemDiction=new e}return __extends(s,i),Object.defineProperty(s.prototype,"items",{get:function(){return this._itemDiction.values.concat()},set:function(t){if(t){for(var e=t.length,i=0;e>i;i++){var s=t[i],n=s.id,a=this._itemDiction.get(n);a||(a=this.addPackItem(n,s.num,s)),a.num=s.num}this.updateFinish()}},enumerable:!0,configurable:!0}),s.prototype.getPackItem=function(t){return this._itemDiction.get(t)},s.prototype.getItemsByGoodType=function(t){for(var e,i=[],s=0;s<this._itemDiction.values.length;s++)e=this._itemDiction.values[s],e.goods_type==t&&i.push(e);return i},s.prototype.getItemsByType=function(t){for(var e,i=[],s=0;s<this._itemDiction.values.length;s++)e=this._itemDiction.values[s],e.type==t&&i.push(e);return i},s.prototype.removePackItemByCount=function(t,e){var i=this.getPackItem(t);return i?this.updataPackItem(t,Math.max(i.num-e,0)):null},s.prototype.addPackItemByCount=function(t,e,i){var s=this.getPackItem(t);return s?this.updataPackItem(t,s.num+e):this.addPackItem(t,e,i)},s.prototype.syncPackItemByCount=function(t,e,i){var s=this.getPackItem(t);return s?this.updataPackItem(t,e):this.addPackItem(t,e,i)},s.prototype.updataPackItem=function(t,e){var i=this.getPackItem(t);return i?(i.num=e,0==e&&this.removePackItem(t),i):this.addPackItem(t,e,null)},s.prototype.addPackItem=function(e,i,s){var n=new t.PackItemModel;return n.id=e,s&&(s.hasOwnProperty("subid")&&(n.subId=s.subid),s.hasOwnProperty("name")&&(n.name=s.name),s.hasOwnProperty("type")&&(n.type=s.type),s.hasOwnProperty("goods_type")&&(n.goods_type=s.goods_type),s.hasOwnProperty("effect_desc")&&(n.effectDes=s.effect_desc),s.hasOwnProperty("goods_desc")&&(n.des=s.goods_desc),s.hasOwnProperty("short_des")&&(n.short_des=s.short_des),s.hasOwnProperty("canuse")&&(n.canUse=0!=s.canuse),s.hasOwnProperty("canabandon")&&(n.canDrop=0!=s.canabandon),s.hasOwnProperty("target_url")&&(n.url=s.target_url),s.hasOwnProperty("icon_id")&&(n.icon_id=s.icon_id)),n.num=i,this._itemDiction.set(n.id,n),n},s.prototype.removePackItem=function(t){var e=this.getPackItem(t);return this._itemDiction.remove(t),e},s.prototype.getItemCount=function(t){var e=this.getPackItem(t);return e?e.num:0},s}(t.BaseModel);t.PackModel=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,t.ModelDef.SERVER_SET_DATA_MODEL),this._severDataHasLoaded=!1,this._fightSpeed=1,this._hasEnterRole=-1,this._musicVol=101,this._soundVol=101,this._hasCollect=-1,this._hasEnterFriend=-1,this._firstCatchServent=-1,this._towerGuide=6,this._hasShowBuffGuide=-1,this._lilianSkipFight=-1,this._longBitData=new t.BitDataSaveUtils(32),this._longBitData.setKey(i.KEY_Fight_SPEED,3),this._longBitData.setKey(i.KEY_HAS_ENTER_ROLE,1),this._longBitData.setKey(i.KEY_MUSICVOL,7),this._longBitData.setKey(i.KEY_SOUNDVOL,7),this._longBitData.setKey(i.KEY_HAS_COLLECT,1),this._longBitData.setKey(i.KEY_HAS_ENTERFRIEND,1),this._longBitData.setKey(i.KEY_FIRST_CATCH_SERVENT,1),this._longBitData.setKey(i.KEY_TOWERGUIDE,3),this._longBitData.setKey(i.KEY_HAS_SHOW_BUFF_GUIDE,1),this._longBitData.setKey(i.KEY_HAS_SHOW_WEIXIN_COLLECT_GUIDE,1),this._longBitData.setKey(i.KEY_HAS_JUMP_FACTION_HOLE_FIGHT,1),this._longBitData.setKey(i.KEY_CHAIN_GUIDE_FIGHT,1),this._longBitData.setKey(i.KEY_LILIAN_SKIP_FIGHT,1),this._longBitData.setKey(i.KEY_FIRST_NEILI_REWARD,1),this._longBitData.setKey(i.KEY_FIRST_RENSHEN_REWARD,1),this._longBitData.setKey(i.KEY_DINGYUE,1),this._longBitData.setKey(i.KEY_HAS_JUMP_CHAMPION_FIGHT,1),this._longBitData.setKey(i.KEY_HAS_GOT_WB_GIFT,1),this._longBitData.setKey(i.KEY_NEED_TO_HIDE_INVITE,1),this._longBitData.setKey(i.KEY_HAS_JUMP_CHAMPIONTEAM_FIGHT,1),this._longBitData.setKey(i.KEY_REALNAME_TIPS,1),this._dailyBitData=new t.BitDataSaveUtils(32),this._dailyBitData.setKey(i.KEY_DAILY_ISFIRST_LOGIN,1),this._dailyBitData.setKey(i.KEY_DAILY_ISFIRST_ENTER_FACTION,1),this._dailyBitData.setKey(i.KEY_DAILY_WULIN_REDDOT,1),this._dailyBitData.setKey(i.KEY_DAILY_CHAMPION_REDDOT,1),this._dailyBitData.setKey(i.KEY_RECALL_OPEN,1),this._dailyBitData.setKey(i.KEY_BUY_CONFIRM,1),this._dailyBitData.setKey(i.KEY_DAILY_UPGRADE_ISAGE,1),this._dailyBitData.setKey(i.KEY_DAILY_CHAMPIONTEAM_REDDOT,1),this._dailyBitData.setKey(i.KEY_WB_WEEKEND_GIFT,1),this._dailyBitData.setKey(i.KEY_DAILY_MASTER_REDDOT,1),this._dailyBitData.setKey(i.KEY_DAILY_MASTER_ADD_REDDOT,1),this._dailyBitData.setKey(i.KEY_DAILY_CHRISTMAS_FINGER,1)}return __extends(i,e),Object.defineProperty(i.prototype,"severDataHasLoaded",{get:function(){return this._severDataHasLoaded},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fightSpeed",{get:function(){return this._fightSpeed},set:function(t){this._fightSpeed!=t&&(this._fightSpeed=t,this.setLongDataValue(i.KEY_Fight_SPEED,t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasEnterRole",{get:function(){return this._hasEnterRole},set:function(t){this._hasEnterRole!=t&&(this._hasEnterRole=t,this.setLongDataValue(i.KEY_HAS_ENTER_ROLE,t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasCollect",{get:function(){return this._hasCollect},set:function(t){this._hasCollect!=t&&(this._hasCollect=t,this.setLongDataValue(i.KEY_HAS_COLLECT,t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"musicVol",{get:function(){return this._musicVol},set:function(t){this._musicVol!=t&&(this._musicVol=t,this.setLongDataValue(i.KEY_MUSICVOL,t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"soundVol",{get:function(){return this._soundVol},set:function(t){this._soundVol!=t&&(this._soundVol=t,this.setLongDataValue(i.KEY_SOUNDVOL,t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasEnterFriend",{get:function(){return this._hasEnterFriend},set:function(t){this._hasEnterFriend!=t&&(this._hasEnterFriend=t,this.setLongDataValue(i.KEY_HAS_ENTERFRIEND,t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"firstCatchServent",{get:function(){return this._firstCatchServent},set:function(t){this._firstCatchServent!=t&&(this._firstCatchServent=t,this.setLongDataValue(i.KEY_FIRST_CATCH_SERVENT,t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"towerGuide",{get:function(){return 0==this._towerGuide?1:this._towerGuide},set:function(t){this._towerGuide!=t&&(this._towerGuide=t,this.setLongDataValue(i.KEY_TOWERGUIDE,t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"hasShowBuffGuide",{get:function(){return this._hasShowBuffGuide},set:function(t){this._hasShowBuffGuide!=t&&(this._hasShowBuffGuide=t,this.setLongDataValue(i.KEY_HAS_SHOW_BUFF_GUIDE,t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lilianSkipFight",{get:function(){return this._lilianSkipFight},set:function(t){this._lilianSkipFight!=t&&(this._lilianSkipFight=t,this.setLongDataValue(i.KEY_LILIAN_SKIP_FIGHT,t))},enumerable:!0,configurable:!0}),i.prototype.initData=function(e){if(this._severDataHasLoaded=!0,e&&e.options&&(this._longBitData.setData(0,parseInt(e.options)),this._longBitData.setData(1,parseInt(e.options1))),e&&e.daily&&e.daily.value)for(var s=e.daily.value,n=0;n<s.length;n++)this._dailyBitData.setData(n,s[n]);this.parseData(),t.dispatch(i.SERVER_SET_DATA_MODEL_RESULT)},i.prototype.setDataToSever=function(){this._severDataHasLoaded&&(t.XHR().Post({cmd:"front",op:"set",field:"options",value:this.getSetValue()},this,this.setDataBack),t.XHR().Post({cmd:"front",op:"set",field:"options1",value:this.getSetValue(1)},this,this.setDataBack))},i.prototype.setDailyDataToSever=function(e){this._severDataHasLoaded&&t.XHR().Post({cmd:"front",op:"set",field:"daily",value:e},this,this.setDataBack)},i.prototype.setDataBack=function(t){},i.prototype.parseData=function(){this._fightSpeed=this._longBitData.getValue(i.KEY_Fight_SPEED),this._hasEnterRole=this._longBitData.getValue(i.KEY_HAS_ENTER_ROLE),this._musicVol=this._longBitData.getValue(i.KEY_MUSICVOL),this._soundVol=this._longBitData.getValue(i.KEY_SOUNDVOL),0==this._musicVol&&(this._musicVol=101),0==this._soundVol&&(this._soundVol=101),this._hasCollect=this._longBitData.getValue(i.KEY_HAS_COLLECT),this._hasEnterFriend=this._longBitData.getValue(i.KEY_HAS_ENTERFRIEND),this._firstCatchServent=this._longBitData.getValue(i.KEY_FIRST_CATCH_SERVENT),this._towerGuide=this._longBitData.getValue(i.KEY_TOWERGUIDE),this._hasShowBuffGuide=this._longBitData.getValue(i.KEY_HAS_SHOW_BUFF_GUIDE),this._lilianSkipFight=this._longBitData.getValue(i.KEY_LILIAN_SKIP_FIGHT)},i.prototype.getSetValue=function(t){return void 0===t&&(t=0),this._longBitData.getDataArr().length>t?this._longBitData.getDataArr()[t]:0},i.prototype.getLongDataValue=function(t){return this._longBitData.getValue(t)},i.prototype.setLongDataValue=function(t,e){var i=this._longBitData.getValue(t);i!=e&&(this._longBitData.setValue(t,e),this.setDataToSever())},i.prototype.getDailyDataValue=function(t){return this._dailyBitData.getValue(t)},i.prototype.setDailyDataValue=function(t,e){var i=this._dailyBitData.getValue(t);if(i!=e){this._dailyBitData.setValue(t,e);var s=this._dailyBitData.getKeyDataIndex(t);this.setDailyDataToSever(s+"_"+this._dailyBitData.getData(s))}},i.SERVER_SET_DATA_MODEL_RESULT="SERVER_SET_DATA_MODEL_RESULT",i.KEY_Fight_SPEED="KEY_Fight_SPEED",i.KEY_HAS_ENTER_ROLE="KEY_HAS_ENTER_ROLE",i.KEY_MUSICVOL="KEY_MUSICVOL",i.KEY_SOUNDVOL="KEY_SOUNDVOL",i.KEY_HAS_COLLECT="KEY_HAS_COLLECT",i.KEY_HAS_ENTERFRIEND="KEY_HAS_ENTERFRIEND",i.KEY_FIRST_CATCH_SERVENT="KEY_FIRST_CATCH_SERVENT",i.KEY_TOWERGUIDE="KEY_TOWERGUIDE",i.KEY_HAS_SHOW_BUFF_GUIDE="KEY_HAS_SHOW_BUFF_GUIDE",i.KEY_HAS_SHOW_WEIXIN_COLLECT_GUIDE="KEY_HAS_SHOW_WEIXIN_COLLECT_GUIDE",i.KEY_HAS_JUMP_FACTION_HOLE_FIGHT="KEY_HAS_JUMP_FACTION_HOLE_FIGHT",i.KEY_CHAIN_GUIDE_FIGHT="KEY_CHAIN_GUIDE_FIGHT",i.KEY_LILIAN_SKIP_FIGHT="KEY_LILIAN_SKIP_FIGHT",i.KEY_FIRST_NEILI_REWARD="KEY_FIRST_NEILI_REWARD",i.KEY_FIRST_RENSHEN_REWARD="KEY_FIRST_RENSHEN_REWARD",i.KEY_DINGYUE="KEY_DINGYUE",i.KEY_HAS_JUMP_CHAMPION_FIGHT="KEY_HAS_JUMP_CHAMPION_FIGHT",i.KEY_HAS_GOT_WB_GIFT="KEY_HAS_GOT_WB_GIFT",i.KEY_NEED_TO_HIDE_INVITE="KEY_NEED_TO_HIDE_INVITE",i.KEY_HAS_JUMP_CHAMPIONTEAM_FIGHT="KEY_HAS_JUMP_CHAMPIONTEAM_FIGHT",i.KEY_REALNAME_TIPS="KEY_REALNAME_TIPS",i.KEY_DAILY_ISFIRST_LOGIN="KEY_DAILY_ISFIRST_LOGIN",i.KEY_DAILY_ISFIRST_ENTER_FACTION="KEY_DAILY_ISFIRST_ENTER_FACTION",i.KEY_DAILY_WULIN_REDDOT="KEY_DAILY_WULIN_REDDOT",i.KEY_DAILY_CHAMPION_REDDOT="KEY_DAILY_CHAMPION_REDDOT",i.KEY_RECALL_OPEN="KEY_RECALL_OPEN",i.KEY_BUY_CONFIRM="KEY_BUY_CONFIRM",i.KEY_DAILY_UPGRADE_ISAGE="KEY_DAILY_UPGRADE_ISAGE",i.KEY_DAILY_CHAMPIONTEAM_REDDOT="KEY_DAILY_CHAMPIONTEAM_REDDOT",i.KEY_WB_WEEKEND_GIFT="KEY_WB_WEEKEND_GIFT",i.KEY_DAILY_MASTER_REDDOT="KEY_DAILY_MASTER_REDDOT",i.KEY_DAILY_MASTER_ADD_REDDOT="KEY_DAILY_MASTER_ADD_REDDOT",i.KEY_DAILY_CHRISTMAS_FINGER="KEY_DAILY_CHRISTMAS_FINGER",i}(t.BaseModel);t.ServerSetDataModel=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,t.ModelDef.SHOP_ITEM_MODEL),this._id=0,this._goodsId=0,this._iconId=0,this._name="",this._default_num=0,this._max_num=0,this._seq=0,this._effectDes="",this._des=""}return __extends(i,e),Object.defineProperty(i.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"goodsId",{get:function(){return this._goodsId},set:function(t){this._goodsId=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"iconId",{get:function(){return this._iconId},set:function(t){this._iconId=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"num",{get:function(){return this._default_num},set:function(t){this._default_num=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxnum",{get:function(){return this._max_num},set:function(t){this._max_num=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"seq",{get:function(){return this._seq},set:function(t){this._seq=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"effectDes",{get:function(){return this._effectDes},set:function(t){this._effectDes=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"des",{get:function(){return this._des},set:function(t){this._des=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"price",{get:function(){return this._price},set:function(t){this._price=t},enumerable:!0,configurable:!0}),i}(t.BaseModel);t.ShopItemModel=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.utils.Dictionary,i=function(i){function s(){i.call(this,t.ModelDef.SHOP_MODEL),this._itemDiction=new e}return __extends(s,i),Object.defineProperty(s.prototype,"items",{get:function(){return this._itemDiction.values.concat()},set:function(t){if(t){for(var e=t.length,i=0;e>i;i++){var s=t[i],n=s.id,a=this._itemDiction.get(n);a||(a=this.addShopItem(n,s.num,s)),a.num=s.num}this.updateFinish()}},enumerable:!0,configurable:!0}),s.prototype.getShopItems=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null),this.getIdlist=t;for(var s=[],n=[],a=0;a<t.length;a++){var o=this._itemDiction.get(t[a]);o?s.push(o):n.push(t[a])}0==n.length?i.apply(e,[s]):this.loadShopItems(t,e,i)},s.prototype.loadShopItems=function(e,i,s){void 0===i&&(i=null),void 0===s&&(s=null);for(var n="",a=0;a<this.getIdlist.length;a++)n+=this.getIdlist[a]+"",a<this.getIdlist.length-1&&(n+="|");var o={cmd:"shop",ids:n};t.XHR().Post(o,this,function(t){0==t.result&&(this.items=t.commodity_info,this.getShopItems(e,i,s))})},s.prototype.getShopItem=function(t){return this._itemDiction.get(t)},s.prototype.removeShopItemByCount=function(t,e){var i=this.getShopItem(t);return i?this.updataShopItem(t,Math.max(i.num-e,0)):null},s.prototype.addPackItemByCount=function(t,e,i){var s=this.getShopItem(t);return s?this.updataShopItem(t,s.num+e):this.addShopItem(t,e,i)},s.prototype.syncPackItemByCount=function(t,e,i){var s=this.getShopItem(t);return s?this.updataShopItem(t,e):this.addShopItem(t,e,i)},s.prototype.updataShopItem=function(t,e){var i=this.getShopItem(t);return i.num=e,i},s.prototype.addShopItem=function(e,i,s){var n=new t.ShopItemModel;return n.id=e,s.hasOwnProperty("iconId")&&(n.iconId=s.iconId),s.hasOwnProperty("goods_id")&&(n.goodsId=s.goods_id),s.hasOwnProperty("name")&&(n.name=s.name),s.hasOwnProperty("seq")&&(n.seq=s.seq),s.hasOwnProperty("effect_desc")&&(n.effectDes=s.effect_desc),s.hasOwnProperty("goods_desc")&&(n.des=s.goods_desc),s.hasOwnProperty("price")&&(n.price=s.price),s.hasOwnProperty("max_num")&&(n.maxnum=s.max_num),n.num=i,this._itemDiction.set(n.id,n),n},s.prototype.removeShopItem=function(t){var e=this.getShopItem(t);return this._itemDiction.remove(t),e},s.prototype.getItemCount=function(t){var e=this.getShopItem(t);return e?e.num:0},s}(t.BaseModel);t.ShopModel=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,t.ModelDef.SELF_USER_MODEL),this._uid=0,this._exp=0,this._maxExp=0,this._level=0,this._title="",this._name="",this._attackPower=0,this._realAttackPower=0,this._cash=0,this._doubi=0,this._douyu=0,this._vit=0,this._maxVit=0,this._energy=0,this._maxEnergy=0,this._highEnergy=0,this._maxHighEnergy=0,this._servantCash=0,this._kingMatal=0,this._vipLevel=0,this._prestige=0,this._xiuWei=0,this._winPoint=0,this._inviteNum=0,this._speedUp=1,this._lastAddVitTime=0,this._vitAddStep=0,this._halloweenFlag=0,this._mentor_uid="0",this._marryStatus=0,this._marryPropose=0,this._loginDays=1,this._uid=0,this._exp=0,this._maxExp=0,this._level=0,this._attackPower=0,this._realAttackPower=0,this._cash=0,this._doubi=0,this._douyu=0,this._vit=0,this._maxVit=0,this._energy=0,this._maxEnergy=0,this._vipLevel=0,this._sex=0,this._prestige=0,this._xiuWei=0,this._servantCash=0,this.actionIds=[]}return __extends(i,e),Object.defineProperty(i.prototype,"uid",{get:function(){return this._uid},set:function(t){this._uid=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"exp",{get:function(){return this._exp},set:function(t){this._exp=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxExp",{get:function(){return this._maxExp},set:function(t){this._maxExp=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"level",{get:function(){return this._level},set:function(t){this._level=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"title",{get:function(){return this._title},set:function(t){this._title=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"attackPower",{get:function(){return this._attackPower},set:function(t){this._attackPower=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"realAttackPower",{get:function(){return this._realAttackPower},set:function(t){this._realAttackPower=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"wbShare",{get:function(){return this._wb_share},set:function(t){this._wb_share=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cash",{get:function(){return this._cash},set:function(t){this._cash=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"doubi",{get:function(){return this._doubi},set:function(t){this._doubi=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"douyu",{get:function(){return this._douyu},set:function(t){this._douyu=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vit",{get:function(){return this._vit},set:function(e){0>e?e=0:e>=this.maxVit&&Laya.timer.clear(this,this.addVit);var i=this._vit;this._vit=e,i>=this.maxVit&&e<this.maxVit&&(this.lastAddVitTime=t.ServerClock.getServerTime(),this.checkVit())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxVit",{get:function(){return this._maxVit},set:function(t){this._maxVit=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"energy",{get:function(){return this._energy},set:function(t){this._energy=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxEnergy",{get:function(){return this._maxEnergy},set:function(t){this._maxEnergy=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"highEnergy",{get:function(){return this._highEnergy},set:function(t){this._highEnergy=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxHighEnergy",{get:function(){return this._maxHighEnergy},set:function(t){this._maxHighEnergy=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"servantCash",{get:function(){return this._servantCash},set:function(t){this._servantCash=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"kingMetal",{get:function(){return this._kingMatal},set:function(t){this._kingMatal=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vipLevel",{get:function(){return this._vipLevel},set:function(t){this._vipLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sex",{get:function(){return this._sex},set:function(e){t.Global.isBoy=1==e,this._sex=e},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"todayHasSign",{get:function(){return this._todayHasSign},set:function(t){this._todayHasSign=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isBoy",{get:function(){return 1==this._sex},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"firstLogin",{get:function(){return this._firstLogin},set:function(t){this._firstLogin=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"headimgurl",{get:function(){var e;return e=this._headimgurl&&this._headimgurl.length>0?this._headimgurl:this.isBoy?t.ResPath().getPic("gg",t.ResourcePath.PATH_HEAD):t.ResPath().getPic("mm",t.ResourcePath.PATH_HEAD)},set:function(e){e&&(t.Global.isWX?this._headimgurl=t.JSUtils.getHeadUrl(e):(this._headimgurl=e.replace(/q4/,"q2"),this._headimgurl=t.JSUtils.getHeadUrl(e)))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"prestige",{get:function(){return this._prestige},set:function(t){this._prestige=t>0?t:0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"xiuWei",{get:function(){return this._xiuWei},set:function(t){this._xiuWei=t>0?t:0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"winPoint",{get:function(){return this._winPoint},set:function(t){this._winPoint=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"inviteNum",{get:function(){return this._inviteNum},set:function(t){this._inviteNum=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"speedUp",{get:function(){return this._speedUp},set:function(t){this._speedUp=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastAddVitTime",{get:function(){return this._lastAddVitTime},set:function(t){this._lastAddVitTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"vitAddStep",{get:function(){return this._vitAddStep},set:function(t){this._vitAddStep=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"halloweenFlag",{get:function(){return this._halloweenFlag},set:function(t){this._halloweenFlag=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mentor_uid",{get:function(){return this._mentor_uid},set:function(t){this._mentor_uid=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"marryStatus",{get:function(){return this._marryStatus},set:function(t){this._marryStatus=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"marryPropose",{get:function(){return this._marryPropose},set:function(t){this._marryPropose=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"loginDays",{get:function(){return this._loginDays},set:function(t){this._loginDays=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"chainInfo",{get:function(){return this._chainInfo},set:function(t){this._chainInfo=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rebackEndtime",{get:function(){return this._rebackEndtime},enumerable:!0,configurable:!0}),i.prototype.setData=function(e){if(e.hasOwnProperty("uid")&&(this.uid=e.uid),e.hasOwnProperty("name")&&(this.name=e.name),e.hasOwnProperty("max_exp")&&(this.maxExp=e.max_exp),e.hasOwnProperty("exp")&&(this.exp=e.exp),e.hasOwnProperty("attack_power")&&(this.attackPower=e.attack_power,this.realAttackPower=this.attackPower),e.hasOwnProperty("cash_num")&&(this.cash=e.cash_num),e.hasOwnProperty("doubi_num")&&(this.doubi=e.doubi_num),e.hasOwnProperty("douyu_num")&&(this.douyu=e.douyu_num),e.hasOwnProperty("lvl")&&(this.level=e.lvl),e.hasOwnProperty("title")&&(this.title=e.title),e.hasOwnProperty("max_vit")&&(this.maxVit=e.max_vit),e.hasOwnProperty("vit")&&(this.vit=e.vit),e.hasOwnProperty("energy")&&(this.energy=e.energy),e.hasOwnProperty("max_energy")&&(this.maxEnergy=e.max_energy),e.hasOwnProperty("high_energy")&&(this.highEnergy=e.high_energy),e.hasOwnProperty("max_high_energy")&&(this.maxHighEnergy=e.max_high_energy),e.hasOwnProperty("vip_lvl")&&(this.vipLevel=e.vip_lvl),e.hasOwnProperty("headimgurl")&&(this.headimgurl=e.headimgurl),e.hasOwnProperty("sex")&&(this.sex=e.sex),e.hasOwnProperty("prestige")&&(this.prestige=e.prestige),e.hasOwnProperty("today_sign")&&(this.todayHasSign=1==e.today_sign),e.hasOwnProperty("spirit")&&(this.xiuWei=e.spirit),e.hasOwnProperty("create_time")&&(this.createTime=1e3*e.create_time),e.hasOwnProperty("server_time")&&(this.serverTime=1e3*e.server_time),e.hasOwnProperty("speed_up")&&(this.speedUp=e.speed_up),e.hasOwnProperty("vit_rtime")&&(this.lastAddVitTime=1e3*e.vit_rtime),e.hasOwnProperty("vit_interval")&&(this.vitAddStep=1e3*e.vit_interval),e.hasOwnProperty("winpoint")&&(this.winPoint=e.winpoint),e.hasOwnProperty("invite_num")&&(this.inviteNum=e.invite_num),e.hasOwnProperty("servant_cash")&&(this.servantCash=e.servant_cash),e.hasOwnProperty("king_medal")&&(this.kingMetal=e.king_medal),e.hasOwnProperty("enable_level")){var s=e.enable_level;s.hasOwnProperty("wulin")&&(i.NEED_USERLV_WULIN=s.wulin),s.hasOwnProperty("servant")&&(i.NEED_USERLV_SERVANT=s.servant),s.hasOwnProperty("faction")&&(i.NEED_USERLV_FACTION=s.faction),s.hasOwnProperty("gem")&&(i.NEED_USERLV_GEM=s.gem)}e.hasOwnProperty("marry_status")&&(this.marryStatus=e.marry_status),e.hasOwnProperty("marry_propose")&&(this.marryPropose=e.marry_propose),e.hasOwnProperty("login_days")&&(this.loginDays=Number(e.login_days)),e.hasOwnProperty("wb_share")&&(this.wbShare=e.wb_share),e.hasOwnProperty("chain_info")&&(this.chainInfo=e.chain_info),e.hasOwnProperty("reback_endtime")?this._rebackEndtime=e.reback_endtime:this._rebackEndtime=0,e.hasOwnProperty("halloween_flag")?this.halloweenFlag=e.halloween_flag:this.halloweenFlag=-1,e.hasOwnProperty("mentor_uid")?this.mentor_uid=e.mentor_uid:this.mentor_uid="0",this.faction=new t.FactionBriefModel,this.faction.facID=e.hasOwnProperty("facid")?Number(e.facid):0,this.checkVit()},i.prototype.checkVit=function(){if(Laya.timer.clear(this,this.addVit),this.vit<this.maxVit&&0!=this.vitAddStep){var e=this.lastAddVitTime+this.vitAddStep;e>t.ServerClock.getServerTime()&&Laya.timer.once(e-t.ServerClock.getServerTime(),this,this.addVit)}},i.prototype.addVit=function(){this.vit<this.maxVit&&(this.vit+=1,this.updateFinish(),this.lastAddVitTime=t.ServerClock.getServerTime(),this.vit<this._maxVit&&this.checkVit())},i.NEED_USERLV_WULIN=10,i.NEED_USERLV_SERVANT=12,i.NEED_USERLV_FACTION=9,i.NEED_USERLV_GEM=15,i}(t.BaseModel);t.UserModel=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,t.ModelDef.WEOPEN_SKILL_MODEL)}return __extends(i,e),Object.defineProperty(i.prototype,"weopens",{get:function(){return this._weopens},set:function(t){this._weopens=[];for(var e,i=0;i<t.length;i++)e=new WeopenSkillData(t[i]),e.type=0,this._weopens.push(e);this.isWeaponNew=!0,this.sortWeopen()},enumerable:!0,configurable:!0}),i.prototype.sortWeopen=function(){this._weopens.sort(function(t,e){return 1e5*(e.own-t.own)+1e4*(t.isLevelMax-e.isLevelMax)+1e3*(e.hot-t.hot)+100*(e.hc-t.hc)+10*(e.c-t.c)+(e.id>t.id?1:-1)})},Object.defineProperty(i.prototype,"skills",{get:function(){return this._skills},set:function(t){this._skills=[];for(var e,i=0;i<t.length;i++)e=new WeopenSkillData(t[i]),e.type=1,this._skills.push(e);this.isSkillNew=!0,this.sortSkill()},enumerable:!0,configurable:!0}),i.prototype.sortSkill=function(){this._skills.sort(function(t,e){return 1e5*(e.own-t.own)+1e4*(t.isLevelMax-e.isLevelMax)+1e3*(e.hot-t.hot)+100*(e.hc-t.hc)+10*(e.c-t.c)+(e.id>t.id?1:-1)})},i.prototype.getWeopenOrSkillById=function(t,e){if(0==e){for(var i=0;i<this._weopens.length;i++)if(this._weopens[i].id==t)return this._weopens[i];return null}for(var i=0;i<this._skills.length;i++)if(this._skills[i].id==t)return this._skills[i];return null},Object.defineProperty(i.prototype,"weapon_atk",{get:function(){return this._weapon_atk},set:function(t){this._weapon_atk=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"skill_atk",{get:function(){return this._skill_atk},set:function(t){this._skill_atk=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"weapon_top_num",{get:function(){return this._weapon_top_num},set:function(t){this._weapon_top_num=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"skill_top_num",{get:function(){return this._skill_top_num},set:function(t){this._skill_top_num=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"weapon_total_num",{get:function(){return this._weapon_total_num},set:function(t){this._weapon_total_num=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"skill_total_num",{get:function(){return this._skill_total_num},set:function(t){this._skill_total_num=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"exchange_times",{get:function(){return this._exchange_times},set:function(t){this._exchange_times=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"exchange_next_level",{get:function(){return this._exchange_next_level},set:function(t){this._exchange_next_level=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"exchange_reddot",{get:function(){return this._exchange_reddot},set:function(t){this._exchange_reddot=t},enumerable:!0,configurable:!0}),i.prototype.setUpgradeData=function(t){t.hasOwnProperty("weapon_atk")&&(this.weapon_atk=t.weapon_atk),t.hasOwnProperty("skill_atk")&&(this.skill_atk=t.skill_atk),t.hasOwnProperty("weapons")&&(this.weopens=t.weapons),t.hasOwnProperty("skills")&&(this.skills=t.skills),t.hasOwnProperty("weapon_top_num")&&(this.weapon_top_num=t.weapon_top_num),t.hasOwnProperty("weapon_total_num")&&(this.weapon_total_num=t.weapon_total_num),t.hasOwnProperty("skill_top_num")&&(this.skill_top_num=t.skill_top_num),t.hasOwnProperty("skill_total_num")&&(this.skill_total_num=t.skill_total_num),t.hasOwnProperty("exchange_times")&&(this.exchange_times=t.exchange_times),t.hasOwnProperty("exchange_next_level")&&(this.exchange_next_level=t.exchange_next_level),t.hasOwnProperty("exchange_reddot")&&(this.exchange_reddot=t.exchange_reddot)},i}(t.BaseModel);t.WeopenSkillModel=e}(hf||(hf={}));var WeopenSkillData=function(){function t(t){void 0===t&&(t=null),t&&(this.data=t)}return Object.defineProperty(t.prototype,"data",{set:function(e){e.hasOwnProperty("own")&&(this.own=e.own),e.hasOwnProperty("id")&&(this.id=e.id),e.hasOwnProperty("name")&&(this.name=e.name),e.hasOwnProperty("level")&&(this.level=e.level),e.hasOwnProperty("desc")&&(this.desc=e.desc),e.hasOwnProperty("hot")&&(this.hot=e.hot),e.hasOwnProperty("isage")&&(this.isage=e.isage),e.hasOwnProperty("isvip")&&(this.isvip=e.isvip),e.hasOwnProperty("returnnum")&&(this.returnnum=e.returnnum),this.hc=-1!=t.HC_Lst.indexOf(this.id)?1:0,this.c=-1!=t.C_Lst.indexOf(this.id)?1:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"own",{get:function(){return this._own},set:function(t){this._own=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isage",{get:function(){return this._isage},set:function(t){this._isage=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isHas",{get:function(){return 1==this._own},enumerable:!0,
configurable:!0}),Object.defineProperty(t.prototype,"isvip",{get:function(){return this._isvip},set:function(t){this._isvip=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this._level},set:function(t){this._level=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"returnnum",{get:function(){return this._returnnum},set:function(t){this._returnnum=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLevelMax",{get:function(){return 10==this.level?1:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"desc",{get:function(){return this._desc},set:function(t){this._desc=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hot",{get:function(){return this._hot},set:function(t){this._hot=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hc",{get:function(){return this._hc},set:function(t){this._hc=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"c",{get:function(){return this._c},set:function(t){this._c=t},enumerable:!0,configurable:!0}),t.HC_Lst=[200009,200012,300048],t.C_Lst=[300047,300056,300057,300061,200021,200022,200023],t}(),__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i){void 0===e&&(e="main"),void 0===i&&(i=""),t.call(this),this.type=e,this.uid=i}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null),t?(this.type=t[0],this.uid=t[1]):(this.type="main",this.uid="")},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_MONSTER},e.prototype.getCommandName=function(){return"MonsterCommand"},e}(t.Command);t.MonsterCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.init=function(){},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_MUSIC_MASTER},e.prototype.getCommandName=function(){return"MusicMasterCommand"},e}(t.Command);t.MusicMasterCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_NATIONAL_TOTAL},e.prototype.getCommandName=function(){return"EnterNationalTotalCmd"},e}(t.Command);t.EnterNationalTotalCmd=e;var i=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_NATIONAL_TOTAL},e.prototype.getCommandName=function(){return"OpenPlayBallCmd"},e}(t.Command);t.OpenPlayBallCmd=i;var s=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_NATIONAL_TOTAL},e.prototype.getCommandName=function(){return"OpenPlanCmd"},e}(t.Command);t.OpenPlanCmd=s;var n=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_NATIONAL_TOTAL},e.prototype.getCommandName=function(){return"OpenDoubleJoyCmd"},e}(t.Command);t.OpenDoubleJoyCmd=n;var a=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_NATIONAL_TOTAL},e.prototype.getCommandName=function(){return"OpenCollectWordCmd"},e}(t.Command);t.OpenCollectWordCmd=a;var o=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_NATIONAL_TOTAL},e.prototype.getCommandName=function(){return"OpenNationalLoginGiftCmd"},e}(t.Command);t.OpenNationalLoginGiftCmd=o;var r=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_NATIONAL_TOTAL},e.prototype.getCommandName=function(){return"OpenNationalShopCmd"},e}(t.Command);t.OpenNationalShopCmd=r;var h=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_NATIONAL_TOTAL},e.prototype.getCommandName=function(){return"FirstEnterNationalCmd"},e}(t.Command);t.FirstEnterNationalCmd=h}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){void 0===e&&(e=0),t.call(this),this._index=0,this._index=e}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null),t&&(this._index=Number(t[0]))},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_RANK},e.prototype.getCommandName=function(){return"RankCMD"},e}(t.Command);t.RankCMD=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_REBATE},e.prototype.getCommandName=function(){return"RebateCmd"},e}(t.Command);t.RebateCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null)},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_RECALL},e.prototype.getCommandName=function(){return"RecallCommand"},e}(t.Command);t.RecallCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SCHOOL_OPEN2017_TOTAL},e.prototype.getCommandName=function(){return"EnterSchoopOpen2017SceneCmd"},e}(t.Command);t.EnterSchoopOpen2017SceneCmd=e;var i=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SCHOOL_OPEN2017_TOTAL},e.prototype.getCommandName=function(){return"OpenVipSchoolOpenCmd"},e}(t.Command);t.OpenVipSchoolOpenCmd=i;var s=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SCHOOL_OPEN2017_TOTAL},e.prototype.getCommandName=function(){return"OpenClassTableCmd"},e}(t.Command);t.OpenClassTableCmd=s;var n=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SCHOOL_OPEN2017_TOTAL},e.prototype.getCommandName=function(){return"OpenDay7GiftCmd"},e}(t.Command);t.OpenDay7GiftCmd=n;var a=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SCHOOL_OPEN2017_TOTAL},e.prototype.getCommandName=function(){return"OpenShootArrowCmd"},e}(t.Command);t.OpenShootArrowCmd=a;var o=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SCHOOL_OPEN2017_TOTAL},e.prototype.getCommandName=function(){return"OpenSchoolmateListCmd"},e}(t.Command);t.OpenSchoolmateListCmd=o;var r=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SCHOOL_OPEN2017_TOTAL},e.prototype.getCommandName=function(){return"OpenPettyStoreCmd"},e}(t.Command);t.OpenPettyStoreCmd=r;var h=function(t){function e(e){t.call(this),this.goodsData=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SCHOOL_OPEN2017_TOTAL},e.prototype.getCommandName=function(){return"OpenPettyBuyCmd"},e}(t.Command);t.OpenPettyBuyCmd=h;var l=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SCHOOL_OPEN2017_TOTAL},e.prototype.getCommandName=function(){return"FirstEnterSchoolOpen2017Cmd"},e}(t.Command);t.FirstEnterSchoolOpen2017Cmd=l;var c=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SCHOOL_OPEN2017_TOTAL},e.prototype.getCommandName=function(){return"SchoolOpen2017ShareScoreBoxCmd"},e}(t.Command);t.SchoolOpen2017ShareScoreBoxCmd=c;var d=function(t){function e(e){t.call(this),this.score=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SCHOOL_OPEN2017_TOTAL},e.prototype.getCommandName=function(){return"SchoolOpenScoreChangeCmd"},e}(t.Command);t.SchoolOpenScoreChangeCmd=d}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SERVENT},e.prototype.getCommandName=function(){return"AskHelpCmd"},e}(t.Command);t.AskHelpCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this),this.charge=0,this.charge=0}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null),this.target_uid=t[0],this.target_owner=t[1],this.idx=t[2],t.length>3&&(this.charge=t[3])},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SERVENT},e.prototype.getCommandName=function(){return"CatchCmd"},e}(t.Command);t.CatchCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SERVENT},e.prototype.getCommandName=function(){return"GetRoleXCmd"},e}(t.Command);t.GetRoleXCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SERVENT},e.prototype.getCommandName=function(){return"OpBoxCmd"},e}(t.Command);t.OpBoxCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SERVENT},e.prototype.getCommandName=function(){return"OpenJxCmd"},e}(t.Command);t.OpenJxCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this),this.uid=0,this.hideAll=0,this.updateLevelLimit=!1}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null),this.uid=t[0]},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SERVENT},e.prototype.getCommandName=function(){return"OpenServentCmd"},e}(t.Command);t.OpenServentCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SERVENT},e.prototype.getCommandName=function(){return"OpenServentHelpCmd"},e}(t.Command);t.OpenServentHelpCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SERVENT},e.prototype.getCommandName=function(){return"OpenServentRankCmd"},e}(t.Command);t.OpenServentRankCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this),this.charge=0,this.charge=0}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null),this.target_owner=t[0],this.target_uid=t[1],t.length>2&&(this.charge=t[2])},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SERVENT},e.prototype.getCommandName=function(){return"ReleaseCmd"},e}(t.Command);t.ReleaseCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this),this.owner=0}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null),this.owner=t[0]},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SERVENT},e.prototype.getCommandName=function(){return"ResistCmd"},e}(t.Command);t.ResistCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this),this.target_uid=0}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null),this.target_uid=t[0]},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SERVENT},e.prototype.getCommandName=function(){return"RobCmd"},e}(t.Command);t.RobCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this),this.searchId=0}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null),this.op=Number(t[0])},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SERVENT},e.prototype.getCommandName=function(){return"ServentOpCmd"},e.OPEN_FEED_BOX=1,e.OPEN_CAFF_BOX=2,e.CLOSE_OP_BOX=5,e.OP_ACTIVE=3,e.OP_REWARD=4,e}(t.Command);t.ServentOpCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SERVENT},e.prototype.getCommandName=function(){return"ServentRefreshCmd"},e}(t.Command);t.ServentRefreshCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SERVENT},e.prototype.getCommandName=function(){return"TrainCmd"},e}(t.Command);t.TrainCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this),this.target_uid=0}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null),this.target_uid=t[0]},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SERVENT},e.prototype.getCommandName=function(){return"ViewRobCmd"},e}(t.Command);t.ViewRobCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SET},e.prototype.getCommandName=function(){return"ExchangeCodeCommand"},e}(t.Command);t.ExchangeCodeCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SET},e.prototype.getCommandName=function(){return"SetCommand"},e}(t.Command);t.SetCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SHARE},e.prototype.getCommandName=function(){return"ShareCommand"},e}(t.Command);t.ShareCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){void 0===e&&(e="friend"),t.call(this),this.type=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SHARE},e.prototype.getCommandName=function(){return"ShareFriendCommand"},e}(t.Command);t.ShareFriendCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SHARE},e.prototype.getCommandName=function(){return"ShareSQCommand"},e}(t.Command);t.ShareSQCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SHARE},e.prototype.getCommandName=function(){return"ShareWBCommand"},e}(t.Command);t.ShareWBCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SHARE},e.prototype.getCommandName=function(){return"ShareWeixinCommand"},e}(t.Command);t.ShareWeixinCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){t.call(this),this.id=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SHARE},e.prototype.getCommandName=function(){return"WBGiftCmd"},e}(t.Command);t.WBGiftCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i,s){void 0===i&&(i=0),void 0===s&&(s=1),t.call(this),this.count=1,this.GoodsId=e,this.type=i,this.count=s}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SHOP},e.prototype.getCommandName=function(){return"BuyCommand"},e}(t.Command);t.BuyCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){t.call(this),this.IDList=e}return __extends(e,t),e.prototype.init=function(t){this.IDList=t},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SHOP},e.prototype.getCommandName=function(){return"GetGoodsCommand"},e}(t.Command);t.GetGoodsCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){void 0===e&&(e=3),t.call(this),this.shoptype=3,this.shoptype=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SHOP},e.prototype.getCommandName=function(){return"OpenWinShopCmd"},e}(t.Command);t.OpenWinShopCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SHOP},e.prototype.getCommandName=function(){return"ShopCommand"},e}(t.Command);t.ShopCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i){void 0===i&&(i=3),t.call(this),this.goodsData=e,this.shoptype=i}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SHOP},e.prototype.getCommandName=function(){return"WinShopBuyCmd"},e}(t.Command);t.WinShopBuyCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){t.call(this),this.giftObj=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SIGN},e.prototype.getCommandName=function(){return"ShowNextLoginRewardCmd"},e}(t.Command);t.ShowNextLoginRewardCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){void 0===e&&(e=0),t.call(this),this.index=e}return __extends(e,t),e.prototype.init=function(t){this.index=Number(t[0])},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SIGN},e.prototype.getCommandName=function(){return"SignCommand"},e}(t.Command);t.SignCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_STRENGTH},e.prototype.getCommandName=function(){return"OpenStrengthBoxCommand"},e}(t.Command);t.OpenStrengthBoxCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_SUBSCRIPTION},e.prototype.getCommandName=function(){return"SubscriptionCommand"},e}(t.Command);t.SubscriptionCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_TALK},e.prototype.getCommandName=function(){return"TalkCloseCommand"},e}(t.Command);t.TalkCloseCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_TALK},e.prototype.getCommandName=function(){return"TalkCommand"},e}(t.Command);t.TalkCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.apply(this,arguments),this.id=0,this.isMaster=!1,this.isChip=!1}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_TASK},e.prototype.getCommandName=function(){return"GetTaskGiftCmd"},e}(t.Command);t.GetTaskGiftCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){t.call(this),this.strCmd=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_TASK},e.prototype.getCommandName=function(){return"GoCmd"},e}(t.Command);t.GoCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){void 0===e&&(e=0),t.call(this),this.tabIndex=0,this.tabIndex=e}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_TASK},e.prototype.getCommandName=function(){return"OpenTaskCmd"},e}(t.Command);t.OpenTaskCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){void 0===e&&(e="main"),t.call(this),this.panel="main",this.panel=e}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null),t&&(this.panel=t[0])},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_TOWER},e.prototype.getCommandName=function(){return"TowerCommand"},e}(t.Command);t.TowerCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_UPGRADE},e.prototype.getCommandName=function(){return"BuyUpCountCmd"},e}(t.Command);t.BuyUpCountCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(i){void 0===i&&(i=0),t.call(this),this.type=e.WEAPON,this.type=i}return __extends(e,t),e.prototype.init=function(t){this.type=Number(t[0])},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_UPGRADE},e.prototype.getCommandName=function(){return"OpenUpgradeCmd"},e.WEAPON=0,e.SKILL=1,e}(t.Command);t.OpenUpgradeCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_UPGRADE},e.prototype.getCommandName=function(){return"OpenUpOpCmd"},e}(t.Command);t.OpenUpOpCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_UPGRADE},e.prototype.getCommandName=function(){return"UpgradeCmd"},e}(t.Command);t.UpgradeCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i){t.call(this),this.value1=e,this.value2=i}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_VIP},e.prototype.getCommandName=function(){return"ChongzhiSuccessCmd"},e}(t.Command);t.ChongzhiSuccessCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_VIP},e.prototype.getCommandName=function(){return"IPABuySuccessCmd"},e}(t.Command);t.IPABuySuccessCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){t.call(this),this.index=e}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null),t&&(this.index=Number(t[0]))},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_VIP},e.prototype.getCommandName=function(){return"OpenVipBoxCommand"},e}(t.Command);t.OpenVipBoxCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);
t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_VIP},e.prototype.getCommandName=function(){return"WanbaBuyStarSuccessCmd"},e}(t.Command);t.WanbaBuyStarSuccessCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.getPluginName=function(){return Plugindef.PLUGIN_VIP},e.prototype.getCommandName=function(){return"WXAppPaySuccessCmd"},e}(t.Command);t.WXAppPaySuccessCmd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){void 0===e&&(e=0),t.call(this),this.tabIndex=e}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null),t&&(this.tabIndex=Number(t[0]))},e.prototype.getPluginName=function(){return Plugindef.PLUGIN_WULIN},e.prototype.getCommandName=function(){return"WuLinCommand"},e}(t.Command);t.WuLinCommand=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function n(){e.call(this,new ui.act.ActCenterUI,!0,!0,!1,!1),this.actData=[],this.tabIndex=0,this.nowActId=0,this.picList=[],this.display=this.skin,this.name="ActCenterBox",n.hasShowActCenter=!0,t.Global.isWXAPP&&(this.display.closeBtn.x-=30),this._actModel=t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL)}return __extends(n,e),n.prototype.init=function(e){if(this.display.menuList.selectEnable=!0,this.tabIndex=0,e.actid){var n=this._actModel.GetActByFrontId(e.actid).id;this.tabIndex=this._actModel.GetIndexById(n)}var a=[];this._actModel.hasData?a.length=this._actModel.List.length:this._actModel.loadAct(),this.display.menuList.array=a,this.display.menuList.selectedIndex=0,this.display.menuList.selectHandler=new Handler(this,this.showMenuList),this.display.menuList.selectedIndex=this.tabIndex,this.display.menuList.itemRender=s,this.display.menuList.renderHandler=new Handler(this,this.onMenuListRender),this.display.actList.itemRender=i,this.display.actList.renderHandler=new Handler(this,this.onActListRender),this.display.closeBtn.on(laya.events.Event.CLICK,this,this.destroy),this._actModel.on(t.ModelEvent.UPDATE_FINISH,this,this.showMenuList,[this.tabIndex,1]),0==this.tabIndex&&this.showMenuList()},n.prototype.isTimeAct=function(t){return t?5!=t&&7!=t&&19!=t:!1},n.prototype.showMenuList=function(e,i){void 0===e&&(e=0),void 0===i&&(i=0),1==i&&this.isTimeAct(this.nowActId)&&(e=this.tabIndex,e=this._actModel.GetIndexById(this._actModel.GetActByFrontId(this.nowActId).id)),this.tabIndex=e,this.display.menuList.selectedIndex=this.tabIndex,this.actData=[];for(var s=0;s<this._actModel.List.length;s++)0==this._actModel.List[s].unshow&&this.actData.push(this._actModel.List[s]);if(this.actData){if(this.actData[e]){this.nowActId!=this.actData[e].frontid&&1==i&&(i=0),this.nowActId=this.actData[e].frontid;for(var n=[],s=0;s<this.actData.length;s++)n.push(this.actData[s]);n.length=n.length<7?7:n.length,this.display.menuList.array=n,Laya.timer.once(500,this,this.scrollMenu),0==i&&(this.actData[e].special||34==this.actData[e].id?(this.display.actBox.visible=!0,this.display.actList.visible=!1,this.LoadSpecial(e),console.log(this.actData[e].id),t.ActConf.IsClientRedotAct(this.actData[e].frontid)&&1==this.actData[e].reddot&&this._actModel.ChangeKeyById(this.actData[e].id,"reddot",0)):(this.display.actList.visible=!0,this.display.actBox.visible=!1,this.showActivity(e),1==this.actData[e].reddot&&this._actModel.ChangeKeyById(this.actData[e].id,"reddot",0)))}}else this.loadAct()},n.prototype.scrollMenu=function(){!this.destroyed&&this.display.menuList&&this.display.menuList.scrollBar&&this.display.menuList.scrollBar.value<72*(this.tabIndex-6)&&(this.display.menuList.scrollBar.value=72*(this.tabIndex-6))},n.prototype.showActivity=function(t){var e=[];e.push(this.actData[t]),this.display.actList.itemRender=i,this.display.actList.array=e},n.prototype.LoadSpecial=function(e){var i=this.actData[e].frontid,s=t.ActConf.getAct(i);s?Laya.loader.load(s.source,new Handler(this,this.showSpecial,[i])):t.WeakTips.show("该活动配置有误，请稍后再试！")},n.prototype.showSpecial=function(e){if(!this.destroyed){if(this._nowID&&(this._oldID=this._nowID),this.display.actBox.numChildren>0){var i=this.display.actBox.getChildAt(0);i&&(i.parent&&i.parent.removeChild(i),i.destroy(),this._oldID!=this._nowID&&Laya.timer.frameOnce(1,this,this.destroyActRes))}var s,n=t.ActConf.getAct(e);if(!s){var a=this._actModel.GetActByFrontId(e).id,o=t.JSUtils.StrToFuc(n.ui);s=new o(a,n)}this.display.actBox.addChild(s),this._nowID=e}},n.prototype.destroyActRes=function(){var e=t.ActConf.getAct(this._oldID),i=e.source;if(i)for(var s=0;s<i.length;s++)Laya.loader.clearRes(i[s].url,!0)},n.prototype.loadAct=function(){var e={cmd:"acthall",subcmd:"Get",needreload:"1"};t.XHR().Post(e,this,this.showAct)},n.prototype.showAct=function(e){this.destroyed||0==e.result&&(this.actData=e.acts,this._actModel.List=this.actData,t.Logger.log("活动条数"+this.actData.length),this.showMenuList())},n.prototype.onActListRender=function(t,e){t.setData(this.display.actList.getItem(e),e,this.tabIndex)},n.prototype.onMenuListRender=function(t,e){t.setData(this.display.menuList.getItem(e),e,this.display.menuList.selectedIndex==e)},n.prototype.destroy=function(){this._actModel.off(t.ModelEvent.UPDATE_FINISH,this,this.showMenuList),Laya.timer.frameOnce(1,this,this.clear)},n.prototype.clear=function(){for(var i=0;i<this.actData.length;i++){t.Logger.log(this.actData[i]);var s=t.ResPath().getPic(this.actData[i].frontid,"actpic/");s=s.replace("png","jpg"),Laya.loader.clearRes(s)}this.destroyAllRes(),e.prototype.destroy.call(this),Laya.loader.clearRes("ui/act/swshop/bg.jpg"),Laya.loader.clearRes("ui/act/punch/bgNew.jpg"),Laya.loader.clearRes("ui/act/turnTable_2017_11/banner.png"),Laya.loader.clearRes("ui/act/bookwechatpublic/diban.png")},n.prototype.destroyAllRes=function(){for(var e=t.ActConf.getAllId(),i=0;i<e.length;i++){var s=t.ActConf.getAct(e[i]),n=s.source;if(n)for(var a=0;a<n.length;a++)Laya.loader.clearRes(n[a].url,!0)}},n.hasShowActCenter=!1,n}(t.BaseBox);t.ActCenter=e;var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),Laya.timer.frameOnce(1,this,this.clear)},i.prototype.clear=function(){e.prototype.destroy.call(this),Laya.loader.clearRes(this.actPic.skin)},i.prototype.setData=function(e,i,s,n){if(void 0===n&&(n=!1),e){if(this._curData=e,e.frontid){var a=t.ResPath().getPic(e.frontid,"actpic/");a=a.replace("png","jpg"),this.actPic.skin=a}e.link?this.on(Laya.Event.CLICK,this,this.openLink):e.target_id&&this.on(Laya.Event.CLICK,this,this.actLink,[e.target_id])}},i.prototype.openLink=function(){t.JSUtils.openUrlBox(this._curData.link)},i.prototype.actLink=function(e){t.facade().executeStrCommand(e)},Object.defineProperty(i.prototype,"selected",{set:function(t){},enumerable:!0,configurable:!0}),i}(ui.act.ActItemUI),s=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.setData=function(e,i,s){if(e){if(this.mouseEnabled=!0,36==e.frontid&&(this.height=0,console.log("-------------------36-------------")),this.listTitle.text=e.name,s?(this.listTitle.color="#ffc30b",this.listTitle.strokeColor="#310000",this.listBg.skin="ui/act/img_yeqian02.png"):(this.listTitle.color="#4c3725",this.listTitle.strokeColor="#f0e2ce",this.listBg.skin="ui/act/img_yeqian01.png"),0==e.reddot?this.redState.visible=!1:this.redState.visible=!0,e.last_seconds&&e.last_seconds<5e7){var n=t.DateUtils.getTimeFomateObj(e.last_seconds);this.leftTime.text=n.day+"天"+n.hour+"小时"+n.minute+"分"}else this.leftTime.text="";0!=e.lable?this.listIcon.skin="ui/act/menuicon"+e.lable+".png":this.listIcon.skin=""}else this.listIcon.skin="",this.listBg.skin="ui/act/img_yeqian03.png"},i.prototype.destroy=function(){e.prototype.destroy.call(this)},i}(ui.act.ActMenuItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"ActCenterCMD":this.actBox||(this.actBox=new t.ActCenter),this.actBox.init(e),t.Logger.log(e),this.actBox.on(t.ViewEvent.BOX_HIDE,this,this.onClosePanel),this.actBox.show(t.Layer.BOX),e.ecode=0,e.finish();break;case"OpenJointPicMainBoxCmd":this.showJointPicMainBox(e.aid),e.ecode=0,e.finish();break;case"FishMainBoxCmd":this.showFishMainBox(e.aid),e.ecode=0,e.finish();break;case"WBWeekendCmd":this.showWBWeekendBox(e.aid),e.ecode=0,e.finish()}},s.prototype.showJointPicMainBox=function(e){this._jointPicMainBox||(this._jointPicMainBox=new t.JointPicMainBox(e),this._jointPicMainBox.on(t.ViewEvent.BASE_DESTROY,this,this.jointPicMainBoxDestroy),this._jointPicMainBox.show())},s.prototype.jointPicMainBoxDestroy=function(){this._jointPicMainBox&&(this._jointPicMainBox.off(t.ViewEvent.BASE_DESTROY,this,this.jointPicMainBoxDestroy),this._jointPicMainBox=null),this.unregisterCommand(new t.OpenJointPicMainBoxCmd)},s.prototype.showFishMainBox=function(e){this._fishMainBox||(this._fishMainBox=new t.FishMainBox(e),this._fishMainBox.on(t.ViewEvent.BASE_DESTROY,this,this.fishMainBoxDestroy),this._fishMainBox.show())},s.prototype.fishMainBoxDestroy=function(){this._fishMainBox&&(this._fishMainBox.off(t.ViewEvent.BASE_DESTROY,this,this.fishMainBoxDestroy),this._fishMainBox=null),this.unregisterCommand(new t.OpenJointPicMainBoxCmd)},s.prototype.showWBWeekendBox=function(e){this._wbweekendbox||(console.log(e),this._wbweekendbox=new t.WBWeekend(e),this._wbweekendbox.on(t.ViewEvent.BASE_DESTROY,this,this.WBWeekendBoxDestroy),console.log(123),this._wbweekendbox.show())},s.prototype.WBWeekendBoxDestroy=function(){this._wbweekendbox&&(this._wbweekendbox.off(t.ViewEvent.BASE_DESTROY,this,this.fishMainBoxDestroy),this._wbweekendbox=null),this.unregisterCommand(new t.OpenJointPicMainBoxCmd)},s.prototype.onClosePanel=function(){this.actBox&&(this.actBox.off(t.ViewEvent.BOX_HIDE,this,this.onClosePanel),this.actBox=null,t.dispatch(t.MainModule.OPENBOXEVENT),this.unregisterPlugin())},s.prototype.getPluginName=function(){return e.PLUGIN_ACT},s}(t.Plugin);t.ActModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.ui.View,i=function(t){function i(i){t.call(this),this.aid=0,this.skin=i||new e,this.skin.mouseThrough=!0,this.mouseThrough=!0,this.cacheAs="bitmap",this.addChild(this.skin)}return __extends(i,t),i}(e);t.BaseAct=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i){e.call(this,new ui.act.BigClockUI),this.contentlist=new Array,this.actData=new Object,this.clockTime=0,this.loopTime=6e4,this.giftIdx=0,this._display=this.skin,this.cacheAs="none",this._display.mainLayer.cacheAs="bitmap",this.aid=i,this._clockMv=new t.AnimationSKe("assets/skeleton/bigClock/nz.sk",1),this._display.sp.addChild(this._clockMv),this._clockMv.x=-405,this._clockMv.y=625,this._clockMv.play(0,!0),this.init()}return __extends(i,e),i.prototype.init=function(){this._display.getBtn.on(laya.events.Event.CLICK,this,this.getGift),this.loadInfo()},i.prototype.loadInfo=function(){t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"Get"},this,this.showAct)},i.prototype.showAct=function(e){if(!this.destroyed)if(0==e.result){e.curtime&&(this.clockTime=parseInt(e.curtime)),this.setClock(),Laya.timer.clear(this,this.clockRun),Laya.timer.loop(this.loopTime,this,this.clockRun),this.giftFlag=e.infos;for(var i=0,s=0;s<e.infos.length;s++)1==e.infos[s].flag?(this._display["giftBag"+s].filters=null,this._display["bag"+s].filters=null,this._display["flagpic"+s].visible=!1,this.giftIdx=e.infos[s].idx,i++,this._display["giftBag"+s].on(laya.events.Event.CLICK,this,this.getGift),this._display["bag"+s].on(laya.events.Event.CLICK,this,this.getGift)):2==e.infos[s].flag?(this._display["flagpic"+s].visible=!0,this._display["giftBag"+s].filters=t.FiltersUtils.getGreyFilters(),this._display["bag"+s].filters=t.FiltersUtils.getGreyFilters()):(this._display["flagpic"+s].visible=!1,this._display["giftBag"+s].filters=t.FiltersUtils.getGreyFilters(),this._display["bag"+s].filters=t.FiltersUtils.getGreyFilters());0==i?(this._display.getBtn.filters=t.FiltersUtils.getGreyFilters(),this._clockMv.play(0,!0)):(this._display.getBtn.filters=null,this._clockMv.play(1,!0))}else t.WeakTips.show("查询活动信息失败，"+e.msg)},i.prototype.clockRun=function(){this.clockTime=this.clockTime+60,this.setClock()},i.prototype.setClock=function(){var e=-39,i=169,s=1e3*this.clockTime,n=new Date(s),a=n.getHours(),o=n.getMinutes();t.Logger.log(a+"时"+o);var r=30*a+o/60*30,h=6*o;r+=e,h+=i,r%=360,h%=360,t.Logger.log(r+"|"+h),this._display.shizhen.rotation=r,this._display.fenzhen.rotation=h},i.prototype.getGift=function(){!this.destroyed&&this.giftFlag&&1==this.giftFlag[this.giftIdx].flag&&t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"GetGift",idx:this.giftIdx},this,this.showClockgift)},i.prototype.showClockgift=function(e){this.destroyed||(0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),this.showAct(e),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).reload()):t.WeakTips.show("领取失败，"+e.msg))},i.prototype.destroy=function(){this._clockMv&&(this._clockMv.destroy(),this._clockMv=null),Laya.loader.clearRes("assets/skeleton/bigClock/nz.sk"),this._display.getBtn.off(laya.events.Event.CLICK,this,this.getGift),this._display["giftBag"+this.giftIdx].off(laya.events.Event.CLICK,this,this.getGift),this._display["bag"+this.giftIdx].off(laya.events.Event.CLICK,this,this.getGift),this._display=null,e.prototype.destroy.call(this)},i}(t.BaseAct);t.BigClock=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,new ui.act.BookWeChatPublicUI),this._giftFlag=!0,this._display=this.skin,this.aid=t,this.init()}return __extends(i,e),i.prototype.init=function(){this._display.on(Laya.Event.CLICK,this,this.onClick),this._display.scrollRect=new Laya.Rectangle(0,0,this._display.width,this._display.height),this._ani=new t.AnimationSKe("assets/skeleton/act/zytx.sk"),this._ani.x=360,this._ani.y=520,this._ani.play(0,!0),this._display.addChildAt(this._ani,1)},i.prototype.onClick=function(){t.facade().executeStrCommand("hf.SubscriptionCommand")},i.prototype.destroy=function(){this._display.off(Laya.Event.CLICK,this,this.onClick),this.destroyEffect(),this._display=null,e.prototype.destroy.call(this)},i.prototype.destroyEffect=function(){this._ani&&(this._display.removeChild(this._ani),this._ani.stop(),this._ani.destroy(),this._ani=null)},i}(t.BaseAct);t.BookWeChatPublic=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i){e.call(this,new ui.act.CaiCaiCookingUI),this.m_djPath="assets/skeleton/caicaicooking/skeleton.sk",this._isPlaying=!1,this.animReady=!1,this._beginHour1=11,this._endHour1=14,this._beginHour2=18,this._endHour2=21,this._display=this.skin,this.cacheAs="none",this.aid=i,this._display.mainLayer.cacheAs="bitmap",this._display.gaoxing.visible=!1,this._display.jiongpo.visible=!1,this._display.kuangxi.visible=!1,this._display.piezui.visible=!1,this._display.shiluo.visible=!1,this._display.zhengchang1.visible=!1,this._display.zhengchang2.visible=!1;for(var s=1;4>=s;s++)this["_imageInitY"+s]=this._display["image"+s].y;this._imageCanMove=!1,Laya.timer.loop(60,this,this.imageMove),this._nowImage=this._display.zhengchang1,this._nowImage.visible=!0,this._display.shouke.on(Laya.Event.CLICK,this,this.shoukeClickHandler),t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"Get",uid:t.Global.UID},this,this.getDataHandler),this._display.maskPng.visible=!1,this._display.maskPng.width=0,this._display.bar.scrollRect=new Laya.Rectangle(0,0,0,0)}return __extends(i,e),Object.defineProperty(i.prototype,"imageCanMove",{set:function(t){if(0==this._imageCanMove){if(1==t)for(var e=1;4>=e;e++){var i=Math.floor(11*Math.random())-5;this._display["image"+e].y=this["_imageInitY"+e]-i,this["_imageIsUp"+e]=Math.random()>.5}}else if(t===!1)for(var e=1;4>=e;e++)this._display["image"+e].y=this["_imageInitY"+e];this._imageCanMove=t},enumerable:!0,configurable:!0}),i.prototype.imageMove=function(){if(this._imageCanMove)for(var t=1;4>=t;t++)this["_imageIsUp"+t]?(this._display["image"+t].y-=1,this._display["image"+t].y<=this["_imageInitY"+t]-5&&(this["_imageIsUp"+t]=!1)):(this._display["image"+t].y+=1,this._display["image"+t].y>=this["_imageInitY"+t]+5&&(this["_imageIsUp"+t]=!0))},i.prototype.getDataHandler=function(e){if(!this.destroyed)if(0==e.result){this.meiwei=e.meiwei,this._isInTime=1==e.intime;var i=t.ServerClock.getServerNowDate();i.getHours()>=this._beginHour1&&i.getHours()<=this._endHour1-1?this._hasOutPan=1==e.flags[0]:this._hasOutPan=1==e.flags[1],!this._isInTime||this._hasOutPan?(this._display.image1.filters=t.FiltersUtils.getGreyFilters(),this._display.image2.filters=t.FiltersUtils.getGreyFilters(),this._display.image3.filters=t.FiltersUtils.getGreyFilters(),this._display.image4.filters=t.FiltersUtils.getGreyFilters(),this._display.pan.filters=t.FiltersUtils.getGreyFilters()):this.imageCanMove=!0,this._isInTime?this._display.wordTxt.text=this._hasOutPan?"已完成授课，请下次再来吧。":"点击下方图标来添加各类调料烹饪极致美味吧！":this._display.wordTxt.text="授课还没有开始呐~",this._display.image1.on(Laya.Event.CLICK,this,this.imageClickHandler),this._display.image2.on(Laya.Event.CLICK,this,this.imageClickHandler),this._display.image3.on(Laya.Event.CLICK,this,this.imageClickHandler),this._display.image4.on(Laya.Event.CLICK,this,this.imageClickHandler),this._display.pan.on(Laya.Event.CLICK,this,this.panClickHandler)}else t.WeakTips.show("查询活动信息失败，"+e.msg)},Object.defineProperty(i.prototype,"meiwei",{set:function(t){this._meiweiValue=t,this._display.bar.visible=0!=t;var e;e=50>=t?(this._display.jianTou1.x-this._display.bar.x+7)*t/50:70>=t?this._display.jianTou1.x-this._display.bar.x+7+(this._display.jianTou2.x-this._display.jianTou1.x)*(t-50)/20:90>=t?this._display.jianTou2.x-this._display.bar.x+7+(this._display.jianTou3.x-this._display.jianTou2.x)*(t-70)/20:100>=t?this._display.jianTou3.x-this._display.bar.x+7+(this._display.jianTou4.x-this._display.jianTou3.x)*(t-90)/10:this._display.bar.width,this._display.bar.scrollRect=new Laya.Rectangle(0,0,e,14)},enumerable:!0,configurable:!0}),i.prototype.loadAnim=function(){this.m_djSk=new t.AnimationSKe(this.m_djPath),this.m_djSk.once(Laya.Event.COMPLETE,this,this.parseComplete)},i.prototype.parseComplete=function(){this.destroyed||(this.animReady=!0,this.imageClickHandler(null))},i.prototype.animPlay=function(){this.destroyed||(this._isPlaying=!0,this._display.sp.addChild(this.m_djSk),this.m_djSk.x=360,this.m_djSk.y=515,this.m_djSk.play(this._index-1,!1),this.m_djSk.on(laya.events.Event.STOPPED,this,this.aniPlayOver))},i.prototype.aniPlayOver=function(){t.WeakTips.show("操作成功，美味度增加了"+(this._nextMeiwei-this._meiweiValue)),this.meiwei=this._nextMeiwei,this._isPlaying=!1,this.m_djSk.parent&&this.m_djSk.parent.removeChild(this.m_djSk)},i.prototype.imageClickHandler=function(e){if(this._isPlaying);else if(e&&(this._index=Number(e.target.name.split("image")[1])),this.animReady)if(this._isInTime){var i=t.ServerClock.getServerNowDate(),s=i.getHours();s>=this._beginHour1&&s<=this._endHour1-1||s>=this._beginHour2&&s<=this._endHour2-1?this._hasOutPan?(t.WeakTips.show("已完成授课，请下次再来吧"),this.imageCanMove=!1):t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"Add",uid:t.Global.UID},this,this.addMeiweiHandler):(t.WeakTips.show("还没到开课时间"),this._display.wordTxt.text="授课还没有开始呐~",this._isInTime=!1,this._display.image1.filters=t.FiltersUtils.getGreyFilters(),this._display.image2.filters=t.FiltersUtils.getGreyFilters(),this._display.image3.filters=t.FiltersUtils.getGreyFilters(),this._display.image4.filters=t.FiltersUtils.getGreyFilters(),this._display.pan.filters=t.FiltersUtils.getGreyFilters(),this.imageCanMove=!1)}else t.WeakTips.show("还没到开课时间"),this._display.wordTxt.text="授课还没有开始呐~",this.imageCanMove=!1;else this.loadAnim()},i.prototype.panClickHandler=function(){if(this._isPlaying);else if(this._isInTime){var e=t.ServerClock.getServerNowDate(),i=e.getHours();i>=this._beginHour1&&i<=this._endHour1-1||i>=this._beginHour2&&i<=this._endHour2-1?this._hasOutPan?(t.WeakTips.show("已完成授课，请下次再来吧"),this.imageCanMove=!1):t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"Make",uid:t.Global.UID},this,this.doPanHandler):(t.WeakTips.show("还没到开课时间"),this._display.wordTxt.text="授课还没有开始呐~",this._isInTime=!1,this._display.image1.filters=t.FiltersUtils.getGreyFilters(),this._display.image2.filters=t.FiltersUtils.getGreyFilters(),this._display.image3.filters=t.FiltersUtils.getGreyFilters(),this._display.image4.filters=t.FiltersUtils.getGreyFilters(),this._display.pan.filters=t.FiltersUtils.getGreyFilters(),this.imageCanMove=!1)}else t.WeakTips.show("还没到开课时间"),this._display.wordTxt.text="授课还没有开始呐~",this.imageCanMove=!1},i.prototype.addMeiweiHandler=function(e){0==e.result?(this._nextMeiwei=e.meiwei,this.animPlay()):t.WeakTips.show("操作失败，"+e.msg)},i.prototype.doPanHandler=function(e){if(0==e.result){this._hasOutPan=!0,this._display.image1.filters=t.FiltersUtils.getGreyFilters(),this._display.image2.filters=t.FiltersUtils.getGreyFilters(),this._display.image3.filters=t.FiltersUtils.getGreyFilters(),this._display.image4.filters=t.FiltersUtils.getGreyFilters(),this._display.pan.filters=t.FiltersUtils.getGreyFilters(),this.imageCanMove=!1,t.Facade.callCommand(new t.SyncChangeCmd(e)),this._nowImage.visible=!1;var i=this._meiweiValue;50>i?(this._nowImage=this._display.shiluo,this._display.wordTxt.text="这是我带过的最差的一届学生呢~"):70>i?(this._nowImage=this._display.piezui,this._display.wordTxt.text="还凑合能吃吧~"):90>i?(this._nowImage=this._display.gaoxing,this._display.wordTxt.text="味道还不错嘛！"):100>=i?(this._nowImage=this._display.kuangxi,this._display.wordTxt.text="你真是天赋异禀的厨神好苗子啊！"):(this._nowImage=this._display.jiongpo,this._display.wordTxt.text="你确定这个还能吃么？"),this.meiwei=e.meiwei,this._nowImage.visible=!0,t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).reload()}else t.WeakTips.show("操作失败，"+e.msg)},i.prototype.shoukeClickHandler=function(){var e="";e+="<img src='ui/comp/icon.png'></img> 1. 菜菜烹饪学校在周六和周日的"+this._beginHour1+":00-"+this._endHour1+":00以及"+this._beginHour2+":00-"+this._endHour2+":00开放。<br>",e+="<img src='ui/comp/icon.png'></img> 2. 在每个开放时间段，玩家可以通过活动界面进行烹饪相关操作，点击盐、糖、醋、油等图标可随机增加美味度数值，点出锅则完成本次烹饪过程。<br>",e+="<img src='ui/comp/icon.png'></img> 3. 根据出锅时的美味度，玩家将得到不等的体力值奖励。<br>",e+="<img src='ui/comp/icon.png'></img> 4. 初始状态下美味度为0，通过添加不同的调料可以逐渐增加美味度，美味度100为极致美味哦~ 美味度越接近100（不能超过哦）越能获得更多的体力奖励。",t.RulePanel.showRule(e,"")},i.prototype.destroy=function(){Laya.timer.clear(this,this.imageMove),this.m_djSk&&(this.m_djSk.destroy(),this.m_djSk=null),this._nowImage=null,this._display.shouke.off(Laya.Event.CLICK,this,this.shoukeClickHandler),this._display.image1.off(Laya.Event.CLICK,this,this.imageClickHandler),this._display.image2.off(Laya.Event.CLICK,this,this.imageClickHandler),this._display.image3.off(Laya.Event.CLICK,this,this.imageClickHandler),this._display.image4.off(Laya.Event.CLICK,this,this.imageClickHandler),this._display.pan.off(Laya.Event.CLICK,this,this.panClickHandler),this._display=null,e.prototype.destroy.call(this)},i}(t.BaseAct);t.CaicaiCooking=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Animation,i=function(i){function s(t){i.call(this,new ui.act.CampUI),this._display=this.skin,this.aid=t,this._display.startView.visible=!1,this._display.mainView.visible=!1,this._display.rankBtn.on(Laya.Event.CLICK,this,this.showRank),this._display.fightBtn_0.on(Laya.Event.CLICK,this,this.fight),this._display.fightBtn_1.on(Laya.Event.CLICK,this,this.fight),this._display.ruleBtn.on(Laya.Event.CLICK,this,this.showRule),this._display.on(Laya.Event.CLICK,this,this.hideTips),this._display.succAwardBtn.on(Laya.Event.CLICK,this,this.clickTips,[0]),this._display.failAwardBtn.on(Laya.Event.CLICK,this,this.clickTips,[1]),this._display.flag1.visible=!1,this._display.flag2.visible=!1,this.load()}return __extends(s,i),s.prototype.showRank=function(){var e=new t.CampRankBox(this.aid,3==this._data.side?12:13);e.show()},s.prototype.load=function(){t.XHR().Post({file:"petpk",cmd:"activity",aid:this.aid,op:"info"},this,this.queryRet)},s.prototype.hideTips=function(e){e.target!=this._display.succAwardBtn&&e.target!=this._display.failAwardBtn&&t.Tips.tipsClose()},s.prototype.clickTips=function(e){if(this._data){var i,s,n={};0==e?(i=this._display.succAwardBtn.localToGlobal(new laya.maths.Point(-30,0)),s=this._data.winner_award):(i=this._display.failAwardBtn.localToGlobal(new laya.maths.Point(-30,0)),s=this._data.loser_award);for(var a="",o=0;o<s.items.length;o++)a+=s.items[o].name+"x"+(s.items[o].num?s.items[o].num:s.items[o].hours/24+"天"),o!=s.items.length-1&&(a+="\n");var r;1==this._data.gift_status[e]?r="可领取":2==this._data.gift_status[e]&&(r="已领取"),n.name=0==e?"势不可挡礼包":"虽败犹荣礼包",null!=r&&""!=r&&(n.name+="  "+r),n.desc=a,t.Tips.show(n,i),1==this._data.gift_status[e]&&(this.rewardIndex=e,this.getReward())}},s.prototype.queryRet=function(e){this.destroyed||(this._data=e,0==e.result?0==e.side?this.showStartView():this.showMainView():101==e.result?(this.showStartView(),t.WeakTips.show(e.msg)):t.WeakTips.show(e.msg))},s.prototype.getReward=function(){t.XHR().Post({file:"petpk",cmd:"activity",aid:this.aid,op:"get_award"},this,this.rewardRet)},s.prototype.rewardRet=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0)),this._data.gift_status[this.rewardIndex]=2,this.showMainView(),this.clickTips(this.rewardIndex)):t.WeakTips.show(e.msg)},s.prototype.showStartView=function(){this._display.mainView.visible=!1,this._display.startView.visible=!0,this._display.leftK.visible=!1,this._display.rightK.visible=!1,this._display.leftBg.on(Laya.Event.CLICK,this,this.side,[3]),this._display.rightBg.on(Laya.Event.CLICK,this,this.side,[4])},s.prototype.showMainView=function(){this._display.mainView.visible=!0,this._display.startView.visible=!1,3==this._data.side?(this._display.leftRole.visible=!0,this._display.rightRole.visible=!1,this._display.tfCount_0.text=this._data.single_item_num):(this._display.leftRole.visible=!1,this._display.rightRole.visible=!0,this._display.tfCount_1.text=this._data.lovers_item_num),this._display.tfDamage_0.text=this._data.lovers_damage,this._display.tfDamage_1.text=this._data.single_damage,this._sk||(this._sk=new t.AnimationSKe(t.ResPath().getEffect("zhanchang")),this._display.mainView.addChild(this._sk)),this._sk.x=250,this._sk.y=420,this._sk.visible=!1,this._sk.on(Laya.Event.STOPPED,this,this.onMovieEnd),this.ani&&(this.ani.stop(),this.ani.removeSelf()),0==this._data.gift_status[0]&&0==this._data.gift_status[1]||(0==this._data.gift_status[0]&&t.Util.toGray(this._display.succAwardBtn),0==this._data.gift_status[1]&&t.Util.toGray(this._display.failAwardBtn),1!=this._data.gift_status[0]&&1!=this._data.gift_status[1]||(this.ani||(this.ani=new e,this.ani.name="ani",this.ani.scaleX=this.ani.scaleY=1,this.ani.loadAtlas("res/atlas/ui/item_movie.json"),this.ani.interval=95,this.ani.index=1,this.ani.x=-54,this.ani.y=-65),1==this._data.gift_status[0]&&this._display.succAwardBtn.addChild(this.ani),1==this._data.gift_status[1]&&this._display.failAwardBtn.addChild(this.ani),this.ani.visible=!0,this.ani.play()),this._display.flag1.visible=this._data.lovers_damage<this._data.single_damage,this._display.flag2.visible=this._data.lovers_damage>this._data.single_damage,this._data.lovers_damage==this._data.single_damage&&(this._display.flag1.visible=!0,this._display.flag2.visible=!0,this._display.flag1.skin="ui/act/camp/flag1.png",this._display.flag2.skin="ui/act/camp/flag1.png"))},s.prototype.side=function(e){this._display.leftK.visible=3==e,this._display.rightK.visible=4==e;var i=new t.ConfirmBoxData({isShowCancelBtn:!0,contentStr:"是否选择该阵营？",callBackHandler:new Handler(this,this.reallySide,[e])});t.ConfirmBox.show(i)},s.prototype.reallySide=function(e){t.XHR().Post({file:"petpk",cmd:"activity",aid:this.aid,op:"setside",side:e},this,function(i){0==i.result?Laya.timer.once(500,this,this.sideSucc,[e]):t.WeakTips.show(i.msg)})},s.prototype.sideSucc=function(e){t.WeakTips.show("成功加入"+(3==e?"挥金如土":"勤俭持家")+"阵营"),this.load()},s.prototype.fight=function(){this._display.fightBtn_0.mouseEnabled=!1,this._display.fightBtn_1.mouseEnabled=!1,t.XHR().Post({file:"petpk",cmd:"activity",aid:this.aid,op:"cost"},this,function(e){if(0==e.result){var i;i=3==this._data.side?e.damage>800?"baozha2":"baozha":e.damage>800?"taoxin":"taoxin2",this.resultData=e,this._sk.visible=!0,this._sk.play(i,!1)}else this._display.fightBtn_0.mouseEnabled=!0,this._display.fightBtn_1.mouseEnabled=!0,t.WeakTips.show(e.msg)})},s.prototype.onMovieEnd=function(){this._display.fightBtn_0.mouseEnabled=!0,this._display.fightBtn_1.mouseEnabled=!0,this._sk.visible=!1,this._data.lovers_item_num=this.resultData.lovers_item_num,this._data.single_item_num=this.resultData.single_item_num,this._data.lovers_damage=this.resultData.lovers_damage,this._data.single_damage=this.resultData.single_damage,t.WeakTips.show("造成"+this.resultData.damage+"伤害"),Laya.timer.once(500,this,this.showResult)},s.prototype.showResult=function(){t.Facade.callCommand(new t.SyncChangeCmd(this.resultData)),this.showMainView()},s.prototype.showRule=function(){var e="<img src='ui/comp/icon.png'></img>活动开启后，各位大侠首次进入活动需要选择自己喜欢的阵营；<br><img src='ui/comp/icon.png'></img>加入阵营后挑战斗友（包括好友、斗友、帮友）有一定概率获得阵营武器；<br><img src='ui/comp/icon.png'></img>使用阵营武器可以对对方阵营发起攻击，造成的伤害越高获得奖励越好哦；<br><img src='ui/comp/icon.png'></img>活动结束时，造成伤害高的阵营获得胜利，获胜阵营玩家将获得势不可挡礼包，另一方阵营获得虽败犹荣礼包，礼包活动结束后在主界面领取；<br><img src='ui/comp/icon.png'></img>活动期间每个阵营伤害排行前十的玩家将获得特别奖励，活动结束后在排行榜界面领取。";t.RulePanel.showRule(e,"")},s.prototype.destroy=function(){this._sk&&(this._sk.destroy(),this._sk=null),this.ani&&this.ani.destroy(),this._display.rankBtn.off(Laya.Event.CLICK,this,this.showRank),this._display.fightBtn_0.off(Laya.Event.CLICK,this,this.fight),this._display.fightBtn_1.off(Laya.Event.CLICK,this,this.fight),this._display.ruleBtn.off(Laya.Event.CLICK,this,this.showRule),this._display.off(Laya.Event.CLICK,this,this.hideTips),this._display.succAwardBtn.off(Laya.Event.CLICK,this,this.clickTips),this._display.failAwardBtn.off(Laya.Event.CLICK,this,this.clickTips),i.prototype.destroy.call(this)},s}(t.BaseAct);t.CampAct=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);
t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(t,s){e.call(this,new ui.act.CampRankUI),this._display=this.skin,this.aid=t,this.type=s,this.setCloseButton(this._display.closeBtn),this._display.lst.itemRender=i,this._display.lst.renderHandler=new Handler(this,this.onListRender),this._display.lst.array=[],this._display.lst.scrollBar.hide=!0,this._display.tab.labels="挥金\n\n如土,勤俭\n\n持家",this._display.tab.selectHandler=new Handler(this,this.tabChange),this.loadReward(),this._display.tab.selectedIndex=12==s?0:1}return __extends(s,e),s.prototype.loadReward=function(){t.XHR().Post({file:"petpk",cmd:"activity",aid:this.aid,op:"query_rank_award"},this,this.onGetRewardInfo)},s.prototype.onGetRewardInfo=function(e){0==e.result?(this.rewardInfo=e,this._display.tab.selectedIndex=12==this.type?0:1):t.WeakTips.show(e.msg)},s.prototype.tabChange=function(t){0==t?this.rankInfo1?(this.rankInfo=this.rankInfo1,this.updata()):this.loadRank(12):this.rankInfo2?(this.rankInfo=this.rankInfo2,this.updata()):this.loadRank(13)},s.prototype.loadRank=function(e){this.idx=e,t.XHR().Post({file:"petpk",cmd:"rank",subcmd:"GetRank",type:e,start:1,end:10},this,this.showRank)},s.prototype.showRank=function(e){0==e.result?(12==this.idx?this.rankInfo1=e.rankinfo:this.rankInfo2=e.rankinfo,this.rankInfo=e.rankinfo,this.updata()):t.WeakTips.show(e.msg)},s.prototype.updata=function(){this._display.lst.array=this.rankInfo;var e=0==this._display.tab.selectedIndex?12:13;if(e==this.type){this._display.self.visible=!0;for(var i,s=-1,n=0;n<this.rankInfo.length;n++){var a=Number(t.Global.UID);if(Number(this.rankInfo[n].id)==a){s=n,this._index=s,i=this.rankInfo[n];break}}this._display.numTxt.text=-1==s?"未上榜":""+(s+1);var o=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);this._display.listName.text=o.name,this._display.listLevel.text=""+o.level,this._display.listCombat.text=-1==s?"--":i.field4,this._display.box.visible=-1!=s,this._display.flag.visible=!1,this._display.flag1.visible=!1,-1!=s&&(1==this.rewardInfo.gift_status&&(this._display.flag.visible=!0,this._display.box.on(Laya.Event.CLICK,this,this.getReward)),2==this.rewardInfo.gift_status&&(this._display.flag1.visible=!0),this._display.box.on(Laya.Event.CLICK,this,this.clickTips))}else this._display.self.visible=!1},s.prototype.clickTips=function(){for(var e={},i=this._display.box.localToGlobal(new laya.maths.Point(-30,0)),s=this.rewardInfo.award[this._index],n="",a=0;a<s.items.length;a++)n+=s.items[a].name+"x"+(s.items[a].num?s.items[a].num:s.items[a].hours/24+"天"),a!=s.items.length-1&&(n+="\n");e.name="第"+(this._index+1)+"名 礼包",e.desc=n,t.Tips.show(e,i)},s.prototype.getReward=function(){this._display.box.off(Laya.Event.CLICK,this,this.getReward),t.XHR().Post({file:"petpk",cmd:"activity",aid:this.aid,op:"get_rank_award"},this,this.rewardRet)},s.prototype.rewardRet=function(e){0==e.result?(this.rewardInfo.gift_status=2,t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0)),this.updata()):t.WeakTips.show(e.msg)},s.prototype.onListRender=function(t,e){t.setData(this._display.lst.getItem(e),e,this.rewardInfo.award[e])},s.prototype.destroy=function(){t.Tips.tipsClose(),e.prototype.destroy.call(this)},s}(t.BaseBox);t.CampRankBox=e;var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.setData=function(e,i,s){this._award=s,this._index=i,t.Util.DecodeJSONProperty("field1",e),t.Util.DecodeJSONProperty("field3",e),this.numTxt.text=String(i+1),this.listName.text=e.field1,this.listLevel.text=e.field2,this.listCombat.text=e.field4,this.box.on(Laya.Event.CLICK,this,this.clickTips)},i.prototype.clickTips=function(){for(var e={},i=this.box.localToGlobal(new laya.maths.Point(-30,0)),s=this._award,n="",a=0;a<s.items.length;a++)n+=s.items[a].name+"x"+(s.items[a].num?s.items[a].num:s.items[a].hours/24+"天"),a!=s.items.length-1&&(n+="\n");e.name="第"+(this._index+1)+"名 礼包",e.desc=n,t.Tips.show(e,i)},i}(ui.act.CampRankItemUI);t.CampRankItem=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Animation,i=function(i){function n(e){i.call(this,new ui.act.Chongzhi500UI),this._allGiftStatus=0,this._canGetCount=0,this._display=this.skin,this.cacheAs="none",this._display.mainLayer.cacheAs="bitmap",this.aid=e,this._barMaxWidth=this._display.barMc.width,this._display.barMc.width=0,this._display.red1.visible=!1,this._display.red2.visible=!1,this._display.red3.visible=!1,this._display.red4.visible=!1,this._display.red5.visible=!1,this._display.red6.visible=!1,this._um=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL),this._um.on(t.ModelEvent.UPDATE_FINISH,this,this.userModelUpdate),this._cash=this._um.cash;var s=new t.AnimationSKe("assets/skeleton/act/scfl.sk",1);this._display.sp.addChild(s),s.x=197,s.y=174,s.play(0,!0),this._display.getDayGiftBtn.on(Laya.Event.CLICK,this,this.getDayGift),this._display.getAllGiftBtn.on(Laya.Event.CLICK,this,this.showRewardBox),this._display.allGiftIcon.on(Laya.Event.CLICK,this,this.openRewardBox);for(var n=1;5>=n;n++)this._display["iconBg"+n].on(Laya.Event.CLICK,this,this.iconBgClickHandler),this._display["hasGet"+n].visible=!1;t.EventCenter.singleton.on("GET_ALL_GIFT_SUCCESS",this,this.getAllGiftSuccess),this.getInfo()}return __extends(n,i),n.prototype.getInfo=function(e){void 0===e&&(e=!1),this._isRetry=e,this._canGetCount=0;var i={cmd:"activity",aid:this.aid,sub:0,needreload:"1"};t.XHR().Post(i,this,this.getInfoHandler)},n.prototype.getInfoHandler=function(e){if(this._isGoChongZhi=!1,0==e.result){this._infos=e.infos;for(var i=0;i<this._infos.length;i++){var s=this._infos[i];1==Number(s.flag)?(this._canGetCount++,this._display["red"+Number(s.idx)].visible=!0):this._display["red"+Number(s.idx)].visible=!1,6==Number(s.idx)?0==s.flag?(this._allGiftStatus=0,this._display.getAllGiftTxt.text="充  值",this._display.getAllGiftBtn.filters=null,this._isGoChongZhi=!0):1==s.flag?(this._allGiftStatus=1,this._display.getAllGiftTxt.text="领  取",this._display.getAllGiftBtn.filters=null):(this._allGiftStatus=2,this._display.getAllGiftTxt.text="已领取",this._display.getAllGiftBtn.filters=t.FiltersUtils.getGreyFilters()):this._display["hasGet"+Number(s.idx)].visible=2==Number(s.flag)}}else this._display.getAllGiftTxt.text="领  取",this._display.getAllGiftBtn.filters=t.FiltersUtils.getGreyFilters(),t.WeakTips.show("查询活动信息失败，"+e.msg),this._display.mouseEnabled=!1;this.setNowIndex(1),this._isRetry&&t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).reload()},n.prototype.iconBgClickHandler=function(t){var e=Number(t.target.name.split("iconBg")[1]);this.setNowIndex(e),this._display.lightBg.visible=!0,this._display.lightBg.x=t.target.x-5,this._display.lightBg.y=t.target.y-5},n.prototype.setNowIndex=function(i){if(this._infos){this._nowIndex=i;for(var s,n=0;n<this._infos.length;n++){var a=this._infos[n];Number(a.idx)==i&&(s=a)}if(s||(s=this._infos[this._infos.length-1]),s){0==s.flag?(this._display.getDayGiftTxt.text="领  取",this._display.getDayGiftBtn.filters=t.FiltersUtils.getGreyFilters()):1==s.flag?(this._display.getDayGiftTxt.text="领  取",this._display.getDayGiftBtn.filters=null):(this._display.getDayGiftTxt.text="已领取",this._display.getDayGiftBtn.filters=t.FiltersUtils.getGreyFilters());for(var o,r=0,n=0;n<s.giftdesc.attrs.length&&(r++,!(r>3));n++)o=s.giftdesc.attrs[n],this._display["icon"+r].visible=!0,this._display["icon"+r].skin=t.ResPath().getPic(o.id,t.ResourcePath.PATH_GOODS),this._display["numTxt"+r].text=o.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.desc,t.Tips.show(n,e)})}(r,o,this._display["icon"+r]);for(var h,l=0;l<s.giftdesc.items.length&&(r++,!(r>3));l++)h=s.giftdesc.items[l],this._display["icon"+r].visible=!0,this._display["icon"+r].skin=t.ResPath().getPic(h.icon_id,t.ResourcePath.PATH_GOODS),h.id>=200001&&h.id<=4e5?(this._display["numTxt"+r].text=t.DateUtils.getStrByHours(h.hours),this["ani"+r]||(this["ani"+r]=new e,this["ani"+r].loadAtlas("res/atlas/ui/item_movie.json"),this["ani"+r].interval=95,this["ani"+r].index=1,this._display.sp.addChild(this["ani"+r]),this["ani"+r].x=this["icon"+r+"Bg"].x-51,this["ani"+r].y=this["icon"+r+"Bg"].y-52),this["ani"+r].play(),this["ani"+r].visible=!0):(this._display["numTxt"+r].text=h.num,this["ani"+r]&&(this["ani"+r].stop(),this["ani"+r].visible=!1)),function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.goods_desc,n.info=i.effect_desc,t.Tips.show(n,e)})}(r,h,this._display["icon"+r]);this._display.thirdBx.visible=r>=3,this._display.giftBx.x=3>r?454:392}else this._display.getDayGiftTxt.text="领  取",this._display.getDayGiftBtn.filters=t.FiltersUtils.getGreyFilters()}},n.prototype.getDayGift=function(){if(null==this._display.getDayGiftBtn.filters){var e={cmd:"activity",aid:this.aid,sub:1,id:this._nowIndex,needreload:"1"};t.XHR().Post(e,this,this.getGiftHandler)}else"已领取"==this._display.getDayGiftTxt.text?t.WeakTips.show("您已经领取过该奖励了"):t.WeakTips.show("您还不满足领取条件")},n.prototype.getGiftHandler=function(e){if(0==e.result){t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0,"")),this._display.getDayGiftTxt.text="已领取",this._display.getDayGiftBtn.filters=t.FiltersUtils.getGreyFilters(),this.getOneGiftSuccess();for(var i=0;i<this._infos.length;i++){var s=this._infos[i];Number(s.idx)==this._nowIndex&&(s.flag=2,this._display["hasGet"+Number(s.idx)].visible=!0,this._display["red"+Number(s.idx)].visible=!1)}}else t.WeakTips.show("领取奖励失败，"+e.msg)},n.prototype.showRewardBox=function(){this._isGoChongZhi?t.Facade.callCommand(new t.OpenVipBoxCommand(1)):null==this._display.getAllGiftBtn.filters&&this.openRewardBox()},n.prototype.openRewardBox=function(){this._rewardUI||(this._rewardUI=new s(this._allGiftStatus,this.aid),this._rewardUI.on(t.ViewEvent.BASE_DESTROY,this,this.rewardBoxDestroyHandler),this._rewardUI.show())},n.prototype.rewardBoxDestroyHandler=function(){this._rewardUI&&(this._rewardUI.off(t.ViewEvent.BASE_DESTROY,this,this.rewardBoxDestroyHandler),this._rewardUI=null)},n.prototype.setBarValue=function(t){t>5&&(t=5),this._display.barMc.width=this._barMaxWidth*t/5},n.prototype.getAllGiftSuccess=function(){this._allGiftStatus=2,this._display.getAllGiftTxt.text="已领取",this._display.getAllGiftBtn.filters=t.FiltersUtils.getGreyFilters(),this._display.red6.visible=!1,this.getOneGiftSuccess();for(var e=0;e<this._infos.length;e++){var i=this._infos[e];6==Number(i.idx)&&(i.flag=2)}},n.prototype.getOneGiftSuccess=function(){this._canGetCount--,0==this._canGetCount&&t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).reload()},n.prototype.userModelUpdate=function(){this._um&&(this._um.cash>this._cash&&this.getInfo(!0),this._cash=this._um.cash)},n.prototype.destroy=function(){this._um&&(this._um.off(t.ModelEvent.UPDATE_FINISH,this,this.userModelUpdate),this._um=null),this._display.getDayGiftBtn.off(Laya.Event.CLICK,this,this.getDayGift),this._display.getAllGiftBtn.off(Laya.Event.CLICK,this,this.showRewardBox),this._display.allGiftIcon.off(Laya.Event.CLICK,this,this.openRewardBox),t.EventCenter.singleton.off("GET_ALL_GIFT_SUCCESS",this,this.getAllGiftSuccess),Laya.loader.clearRes("res/atlas/ui/item_movie.json"),this.ani1&&(this.ani1.destroy(),this.ani1=null),this.ani2&&(this.ani2.destroy(),this.ani2=null),this.ani3&&(this.ani3.destroy(),this.ani3=null),this.rewardBoxDestroyHandler(),i.prototype.destroy.call(this)},n}(t.BaseAct);t.Chongzhi500=i;var s=function(e){function i(i,s){e.call(this,new ui.act.Chongzhi500RewardUI),this.aid=0,this._iconIndex=0,this._display=this.skin,this._allGiftStatus=i,this.aid=s;var n=new Sprite;n.graphics.drawRect(0,0,t.LayerMgr.width,t.LayerMgr.clientHeight,"#000000"),n.alpha=.8,n.y=-t.LayerMgr.offY,n.mouseEnabled=!0,n.size(t.LayerMgr.width,t.LayerMgr.clientHeight),this._display.addChildAt(n,0),this._display.queDingBtn.on(Laya.Event.CLICK,this,this.getAllGift),this._display.lightBg.visible=!1;for(var a=1;6>=a;a++)this._display["iconBg"+a].on(Laya.Event.CLICK,this,this.iconBgClickHandler)}return __extends(i,e),i.prototype.iconBgClickHandler=function(t){this._iconIndex=Number(t.target.name.split("iconBg")[1]),this._display.lightBg.visible=!0,this._display.lightBg.x=t.target.x-6,this._display.lightBg.y=t.target.y-6},i.prototype.getAllGift=function(){if(0==this._allGiftStatus)t.WeakTips.show("您还不满足领取条件"),this.destroy();else if(2==this._allGiftStatus)t.WeakTips.show("您已经领取过该奖励了"),this.destroy();else if(this._iconIndex>0){var e={cmd:"activity",aid:this.aid,sub:2,id:this._iconIndex,needreload:"1"};t.XHR().Post(e,this,this.getAllHandler)}else t.WeakTips.show("请先选择一种魂珠")},i.prototype.getAllHandler=function(e){0==e.result?(t.EventCenter.singleton.event("GET_ALL_GIFT_SUCCESS"),t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0,"")),this.destroy()):t.WeakTips.show("领取奖励失败，"+e.msg)},i.prototype.destroy=function(){this._display.queDingBtn.off(Laya.Event.CLICK,this,this.getAllGift),e.prototype.destroy.call(this)},i}(t.BaseBox)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,new ui.act.ChouqianUI),this.leftTime=0,this.m_djPath="assets/skeleton/chouqian/ledoushangshangqian.sk",this.animReady=!1,this._display=this.skin,this.aid=t,this.init()}return __extends(i,e),i.prototype.init=function(){this.loadInfo(),this.addEvent()},i.prototype.loadInfo=function(){t.XHR().Post({cmd:"activity",aid:this.aid},this,this.showAct)},i.prototype.showAct=function(e){if(0==e.result&&!this.destroyed){if(this._display.chouqian0.visible=!1,this._display.chouqian1.visible=!1,this._display.chouqian2.visible=!1,this._display["chouqian"+e.status].visible=!0,this.goods=[],this.goods=e.award.items,0==e.status)for(var i=e.award.items,s=0;s<i.length;s++)this._display["icon"+s].skin=t.ResPath().getPic(i[s].icon_id,t.ResourcePath.PATH_GOODS),this._display["num"+s].text="X"+i[s].num;1==e.status&&(this.leftTime=e.seconds,this._display.goodsIcon.skin=t.ResPath().getPic(this.goods[e.choose_idx].icon_id,t.ResourcePath.PATH_GOODS),this._display.goodsIcon1.skin=t.ResPath().getPic(this.goods[e.choose_idx].icon_id,t.ResourcePath.PATH_GOODS),this.showStep(e,1)),2==e.status&&(this._display.goodsIcon1.skin=t.ResPath().getPic(this.goods[e.choose_idx].icon_id,t.ResourcePath.PATH_GOODS),this.actData=e.multiple,this.showAnimData())}},i.prototype.loadAnim=function(){this._animationsk||(this._animationsk=new t.AnimationSKe(this.m_djPath),this._display.animBox.addChild(this._animationsk)),this._animationsk.x=300,this._animationsk.y=300;var e=this.actData;e=e>5?0:e-1,this._animationsk.play(e,!1),this._display.qiantong.visible=!1,this._animationsk.on(laya.events.Event.STOPPED,this,this.showAnimData)},i.prototype.showAnimData=function(){this._display.chouqian0.visible=!1,this._display.chouqian1.visible=!1,this._display.chouqian2.visible=!0,this._display.num.skin="ui/act/chouqian/x"+this.actData+".png"},i.prototype.startAnim=function(){t.XHR().Post({cmd:"activity",aid:this.aid,sub:"2"},this,this.showAnim)},i.prototype.showAnim=function(e){0==e.result?(this.actData=e.multiple,this.loadAnim()):t.WeakTips.show(e.msg)},i.prototype.startRound=function(){this.chooseIndex>-1?t.XHR().Post({cmd:"activity",aid:this.aid,sub:"1",idx:this.chooseIndex},this,this.showStep):t.WeakTips.show("请选择物品")},i.prototype.chooseGift=function(t){this.chooseIndex=t;for(var e=0;5>e;e++)this._display["diaopai"+e].skin="ui/act/chouqian/diaopai0.png";this._display["diaopai"+t].skin="ui/act/chouqian/diaopai1.png",this.goods.length>=t&&this.showTips(this.goods[t],this._display["icon"+t])},i.prototype.showTips=function(e,i){var s,n={};s=i.localToGlobal(new laya.maths.Point(0,0)),n.name=e.name+"x"+e.num,n.desc=e.effect_desc,n.info=e.goods_desc,t.Tips.show(n,s)},i.prototype.getGift=function(){t.XHR().Post({cmd:"activity",aid:this.aid,sub:"3"},this,this.showGift)},i.prototype.showGift=function(e){"0"==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).reload(),this._display.animBox.visible=!1,this.actData=null,this.loadInfo()):t.WeakTips.show(e.msg)},i.prototype.showStep=function(e,i){if(void 0===i&&(i=0),0==e.result)if(this.loadAnim(),i||(t.Tips.tipsClose(),t.WeakTips.show("选择物品成功，等待明天来抽签吧！"),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).reload(),this.loadInfo()),this._display.chouqian0.visible=!1,this._display.chouqian1.visible=!0,this._display.chouqian2.visible=!1,this._display.qiantong.visible=!0,this.leftTime=e.seconds,0==this.leftTime)this._display.leftText.text="点击签筒开始抽签",this.actData=null;else{var s=t.DateUtils.getTimeFomateObj(this.leftTime);this.actData=null,t.Logger.log(s),this._display.leftText.text="还有"+s.hour+"小时"+s.minute+"分开签"}else t.WeakTips.show(e.msg)},i.prototype.addEvent=function(){for(var t=0;5>t;t++)this._display["diaopai"+t].on(laya.events.Event.CLICK,this,this.chooseGift,[t]);this._display.chooseBtn.on(laya.events.Event.CLICK,this,this.startRound),this._display.qiantong.on(laya.events.Event.CLICK,this,this.startAnim),this._display.chouqianBtn.on(laya.events.Event.CLICK,this,this.getGift)},i.prototype.removeEvent=function(){for(var t=0;5>t;t++)this._display["diaopai"+t].off(laya.events.Event.CLICK,this,this.chooseGift);this._display.chooseBtn.off(laya.events.Event.CLICK,this,this.startRound),this._display.qiantong.off(laya.events.Event.CLICK,this,this.startAnim),this._display.chouqianBtn.off(laya.events.Event.CLICK,this,this.getGift)},i.prototype.destroy=function(){this.removeEvent(),this._animationsk&&(this._animationsk.off(laya.events.Event.STOPPED,this,this.showAnimData),this._animationsk.destroy()),this._display=null,t.Tips.tipsClose(),e.prototype.destroy.call(this)},i}(t.BaseAct);t.Chouqian=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(s){e.call(this,new ui.act.CostPointUI),this._display=this.skin,this.aid=s,t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"query"},this,this.init),this._display.list.itemRender=i,this._display.list.renderHandler=new Handler(this,this.onListRender),this._display.list.array=[]}return __extends(s,e),s.prototype.init=function(e){if(0==e.result){this._curData=e,this._display.numTxt.text="积分："+this._curData.my_score;var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL),s=i.GetActById(this.aid),n=t.DateUtils.getTimeFomateObj(s.last_seconds);this._display.leftDay.text=n.day,this._display.leftHour.text=n.hour,this._display.list.array=e.data}else t.WeakTips.show(e.msg)},s.prototype.getCurPoint=function(){return this._curData.my_score},s.prototype.updateScore=function(t){this._curData.my_score=t,this._display.numTxt.text="积分："+this._curData.my_score,this._display.list.array=this._curData.data},s.prototype.onListRender=function(t,e){t.update(this._display.list.array[e],e,this)},s.prototype.destroy=function(){e.prototype.destroy.call(this),t.Tips.tipsClose()},s}(t.BaseAct);t.CostPoint=e;var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.update=function(e,i,s){e&&(this._curData=e,this._index=i,this._pointLayer=s,this.pointTxt.text=""+e.need_score,e.total_times>=1e4?this.numTxt.text=e.exchange_times+"/无限":this.numTxt.text=e.exchange_times+"/"+e.total_times,this.icon.skin=t.ResPath().getPic("gift"+(this._index+1),t.ResourcePath.PATH_GOODS),this.icon.on(Laya.Event.CLICK,this,this.showGiftTips),s.getCurPoint()>=e.need_score&&e.exchange_times<e.total_times?(this.exchangeBtn.gray=!1,this.exchangeBtn.on(Laya.Event.CLICK,this,this.onExchange)):(this.exchangeBtn.gray=!0,this.exchangeBtn.off(Laya.Event.CLICK,this,this.onExchange)))},i.prototype.showGiftTips=function(){for(var e="",i=this._curData.award.items,s=0;s<i.length;s++)e+=s<i.length-1?i[s].num?i[s].name+"*"+i[s].num+"\n":i[s].name+"*"+i[s].hours+"小时\n":i[s].num?i[s].name+"*"+i[s].num:i[s].name+"*"+i[s].hours+"小时\n";var n,a={};n=this.localToGlobal(new laya.maths.Point(this.icon.x,this.icon.y)),a.name="礼包",a.info="有概率开出以下道具：",a.desc=e,t.Tips.show(a,n)},i.prototype.onExchange=function(){t.XHR().Post({cmd:"activity",aid:this._pointLayer.aid,subcmd:"exchange",id:this._index},this,this.onExchangeRet)},i.prototype.onExchangeRet=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!0)),this._curData.exchange_times++,this._pointLayer.updateScore(e.my_score)):t.WeakTips.show(e.msg)},i}(ui.act.CostPointItemUI);t.CostPointItem=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i){e.call(this,new ui.act.Day7GiftUI),this._status1=0,this._status2=0,this._status3=0,this._status4=0,this._status5=0,this._status6=0,this._status7=0,this._idx1=0,this._idx2=0,this._idx3=0,this._idx4=0,this._idx5=0,this._idx6=0,this._idx7=0,this._selectIndex=0,this._display=this.skin,this.aid=i,this._display.infoBox.visible=!1,this._display.infoBox.mouseEnabled=!1,this._display.infoCloseBtn.visible=!1,this._display.infoCloseBtn.on(Laya.Event.CLICK,this,this.closeInfoBox),this._display.getBtn.on(Laya.Event.CLICK,this,this.getGift);for(var s=1;7>=s;s++)this._display["statusMc"+s].visible=!1,this._display["statusMc"+s].getChildByName("selecePng").visible=!1,this._display["clickMc"+s].alpha=0,this._display["clickMc"+s].on(Laya.Event.CLICK,this,this.clickHandler);t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"Get",uid:t.Global.UID},this,this.getDataHandler)}return __extends(i,e),i.prototype.getDataHandler=function(e){if(this.destroyed||0!=e.result)this.destroyed||(this._display.getBtn.filters=t.FiltersUtils.getGreyFilters()),t.WeakTips.show("查询活动信息失败，"+e.msg);else{var i=!1,s=e.infos;if(s)for(var n=0;n<s.length;n++){var a=s[n],o=Number(a.flag);this["_status"+(n+1)]=o,this["_idx"+(n+1)]=a.idx;var r=this._display["statusMc"+(Number(a.idx)+1)];r.visible=!0,0==o?(r.getChildByName("status_1").visible=!0,r.getChildByName("status_2").visible=!1,r.getChildByName("status_3").visible=!1):1==o?(i=!0,r.getChildByName("status_1").visible=!1,r.getChildByName("status_2").visible=!0,r.getChildByName("status_3").visible=!1):(r.getChildByName("status_1").visible=!1,r.getChildByName("status_2").visible=!1,r.getChildByName("status_3").visible=!0);var h=a.giftdesc;this["_msg"+(n+1)]="";for(var l=0;l<h.attrs.length;l++){var c=h.attrs[l];this["_msg"+(n+1)]+=c.name+"×"+c.num+"\n"}for(var l=0;l<h.items.length;l++){var d=h.items[l];this["_msg"+(n+1)]+=d.name+"×"+d.num+"\n"}}0==i&&(this._display.getBtn.filters=t.FiltersUtils.getGreyFilters())}},i.prototype.clickHandler=function(t){var e=Number(t.target.name.split("clickMc")[1]);this._selectIndex!=e&&(this._selectIndex>0&&(this._display["statusMc"+this._selectIndex].getChildByName("selecePng").visible=!1),this._selectIndex=e,this._display["statusMc"+this._selectIndex].getChildByName("selecePng").visible=!0,this._display.infoBox.visible=!0,this._display.infoBox.x=t.target.x-60<0?0:t.target.x-60,this._display.msgTxt.text=this["_msg"+this._selectIndex],this._display.info_bg.width=this._display.msgTxt.textWidth+78,this._display.info_bg.height=this._display.msgTxt.textHeight+76,this._display.infoCloseBtn.visible=!0,this._display.infoCloseBtn.x=this._display.infoBox.x+this._display.info_bg.width-72,this._display.infoCloseBtn.y=this._display.infoBox.y+8)},i.prototype.getGift=function(){this._getIndex=0;for(var e=1;7>=e;e++)if(1==this["_status"+e]){this._getIndex=e;break}this._getIndex>0&&t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"GetGift",idx:this["_idx"+this._getIndex],uid:t.Global.UID},this,this.getGiftHandler)},i.prototype.getGiftHandler=function(e){if(0==e.result){if(t.Facade.callCommand(new t.SyncChangeCmd(e)),!this.destroyed){this["_status"+this._getIndex]=2;var i=this._display["statusMc"+this._getIndex];i.getChildByName("status_1").visible=!1,i.getChildByName("status_2").visible=!1,i.getChildByName("status_3").visible=!0,this._display.getBtn.filters=t.FiltersUtils.getGreyFilters()}t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).reload()}else t.WeakTips.show("领取奖励失败，"+e.msg)},i.prototype.closeInfoBox=function(){this._display.infoCloseBtn.visible=!1,this._display.infoBox.visible=!1},i.prototype.destroy=function(){this._display.infoCloseBtn.off(Laya.Event.CLICK,this,this.closeInfoBox),this._display.getBtn.off(Laya.Event.CLICK,this,this.getGift);for(var t=1;7>=t;t++)this._display["clickMc"+t].off(Laya.Event.CLICK,this,this.clickHandler);this._display=null,e.prototype.destroy.call(this)},i}(t.BaseAct);t.Day7Gift=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(s){e.call(this,new ui.act.DayCostUI),this._display=this.skin,this.aid=s,this._display.progress.scrollRect=new Laya.Rectangle(0,0,567,27),this._display.infoBox.visible=!1,t.addListener(i.DAY_COST_SELECT_GIFT,this,this.onClickGift),t.addListener(i.DAY_COST_GET_GIFT_RET,this,this.updateBtn),this._display.bg.on(Laya.Event.CLICK,this,this.onClickPanel),t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"Get"},this,this.dataRet),this._curGetIndex=-1}return __extends(i,e),i.prototype.destroy=function(){t.removeListener(i.DAY_COST_SELECT_GIFT,this,this.onClickGift),t.removeListener(i.DAY_COST_GET_GIFT_RET,this,this.updateBtn),e.prototype.destroy.call(this)},i.prototype.dataRet=function(e){0==e.result?(this._curData=e,this.updatePanel(e)):t.WeakTips.show(e.msg)},i.prototype.updatePanel=function(t){for(var e,i,s,n,a=[0,150,256,362,470,576],o=[0,100,500,1e3,2e3,3e3],r=a.length-1,h=1;h<o.length;h++)if(t.daily_cost<=Number(o[h])){r=h;break}e=a[r-1],i=a[r],s=o[r-1],n=o[r],this._display.timesTxt.text=t.times+"%";var l=t.daily_cost>this.getMaxCost()?this.getMaxCost():t.daily_cost;this._display.costTxt.text=l+"/"+this.getMaxCost(),this._display.progress.scrollRect.width=e+(i-e)*((l-s)/(n-s)),t.gifts.sort(this.giftsListSort);for(var h=0;5>h;h++)t.gifts[h]&&this._display["gift"+h].setData(t.gifts[h],h,this.aid);this.updateBtn()},i.prototype.updateBtn=function(){this.checkHaveGifToGet()?(this._display.getBtn.filters=null,this._display.getBtn.on(Laya.Event.CLICK,this,this.onGetGift)):(this._display.getBtn.filters=t.FiltersUtils.getGreyFilters(),this._display.getBtn.off(Laya.Event.CLICK,this,this.onGetGift))},i.prototype.onGetGift=function(){if(-1==this._curGetIndex)for(var e=this._curData.gifts,i=0;5>i;i++)if(1==e[i].status){this._curGetIndex=i,t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"GetGift",index:e[i].index},this,this.getGiftRet);break}},i.prototype.getGiftRet=function(e){0==e.result?(this._curData.gifts[this._curGetIndex].status=2,this._display["gift"+this._curGetIndex].setData(this._curData.gifts[this._curGetIndex],this._curGetIndex),t.Facade.callCommand(new t.SyncChangeCmd(e,!0)),this.updateBtn(),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).reload()):t.WeakTips.show(e.msg),this._curGetIndex=-1},i.prototype.giftsListSort=function(t,e){var i=t.max_cost,s=e.max_cost;return i>s?1:s>i?-1:0},i.prototype.getMaxCost=function(){return this._curData.gifts.length>0?this._curData.gifts[this._curData.gifts.length-1].max_cost:0},i.prototype.onClickGift=function(e){if(e){this._display.infoBox.visible=!0;var i=new t.DecodeDataCmd(e.gift_info[0]);t.Facade.callCommand(i);for(var s,n=0;8>n;n++)s=i.rewardBoxArr[n],s?(this._display["item"+n].visible=!0,this._display["item"+n].text=s.name+"*"+s.num):this._display["item"+n].visible=!1}},i.prototype.onClickPanel=function(t){"gift"!=t.target.name&&(this._display.infoBox.visible=!1)},i.prototype.checkHaveGifToGet=function(){if(this._curData&&this._curData.gifts)for(var t=0;5>t;t++)if(1==this._curData.gifts[t].status)return!0;return!1},i.DAY_COST_SELECT_GIFT="DAY_COST_SELECT_GIFT",i.DAY_COST_GET_GIFT_RET="DAY_COST_GET_GIFT_RET",i}(t.BaseAct);t.DayCost=e;var i=function(i){function s(){i.call(this),this.aid=0,this.on(Laya.Event.CLICK,this,this.onClickGet)}return __extends(s,i),s.prototype.destroy=function(){this._sketon&&(this._sketon.parent&&this._sketon.parent.removeChild(this._sketon),this._sketon.destroy(),this._sketon=null),i.prototype.destroy.call(this)},s.prototype.setData=function(e,i,s){if(e){switch(this._curData=e,this.aid=s,e.status){case 0:this.haveGetIcon.visible=!1,this.icon.filters=t.FiltersUtils.getGreyFilters(),this.removeSk();break;case 1:this.haveGetIcon.visible=!1,this.icon.filters=null,this._sketon||(this._sketon=new t.AnimationSKe(t.ResPath().getEffect("effect_daizi")),this._sketon.x=38,this._sketon.y=58),this.addChild(this._sketon),this._sketon.play(0,!0);break;case 2:this.haveGetIcon.visible=!0,this.icon.filters=t.FiltersUtils.getGreyFilters(),this.removeSk()}this.icon.skin="ui/act/daycost/gift"+i+".png"}},s.prototype.onClickGet=function(){this._curData&&1==this._curData.status?t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"GetGift",index:this._curData.index},this,this.getGiftRet):this._curData&&t.dispatch(e.DAY_COST_SELECT_GIFT,this._curData)},s.prototype.removeSk=function(){this._sketon&&(this._sketon.stop(),this._sketon.parent&&this._sketon.parent.removeChild(this._sketon),this._sketon.destroy(),this._sketon=null)},s.prototype.getGiftRet=function(i){0==i.result?(t.Facade.callCommand(new t.SyncChangeCmd(i,!0)),this._curData.status=2,this.haveGetIcon.visible=!0,this.icon.filters=t.FiltersUtils.getGreyFilters(),this.removeSk(),t.dispatch(e.DAY_COST_GET_GIFT_RET),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).reload()):t.WeakTips.show(i.msg)},s}(ui.act.DayCostItemUI);t.DayCostListItem=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,new ui.act.DayMoneyUI),this._giftFlag=!0,this._aniPath="assets/skeleton/daymoney/RJDJ.sk",this._display=this.skin,this._display.tips.visible=!1,this.aid=t,this.init()}return __extends(i,e),i.prototype.init=function(){this.loadInfo()},i.prototype.loadInfo=function(){t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"Get"},this,this.showAct)},i.prototype.showAct=function(e){this.destroyed||0!=e.result||(e.infos&&e.infos[0]&&(this._giftFlag=!(e.infos[0].flag>=2)),this._display.getBtn.filters=this._giftFlag?[]:t.FiltersUtils.getGreyFilters(),this._display.rewardBox.filters=this._giftFlag?null:t.FiltersUtils.getGreyFilters(),this._giftFlag?(this._animationsk||(this._animationsk=new t.AnimationSKe(this._aniPath),this._display.addChild(this._animationsk),this._animationsk.x=365,this._animationsk.y=320,this._animationsk.play("rjdj1",!0)),this._display.getBtn.on(laya.events.Event.CLICK,this,this.getGift)):this._display.getBtn.off(laya.events.Event.CLICK,this,this.getGift))},i.prototype.getGift=function(){this.loadAnim(),!this.destroyed&&this._giftFlag&&t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"GetGift"},this,this.getGiftBack)},i.prototype.loadAnim=function(){this._animationsk||(this._animationsk=new t.AnimationSKe(this._aniPath),this._display.addChild(this._animationsk),this._animationsk.x=365,this._animationsk.y=320),this._animationsk.play("rjdj2",!1),this.playFlyWord()},i.prototype.playFlyWord=function(){this._display.addChild(this._display.tips),this._display.tips.visible=!0,Laya.Tween.to(this._display.tips,{y:this._display.tips.y-200},1500,null,Handler.create(this,this.onPlayEnd));
},i.prototype.onPlayEnd=function(){this&&!this.destroyed&&this._display&&(this._display.tips.visible=!1)},i.prototype.getGiftBack=function(e){this.destroyed||0!=e.result?t.WeakTips.show(e.msg):(t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!1)),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).reload(),this.loadAnim(),this.showAct(e))},i.prototype.destroy=function(){Laya.Tween.clearAll(this._display.tips),this._display.getBtn.off(laya.events.Event.CLICK,this,this.getGift),this._animationsk&&this._animationsk.destroy(),this._display=null,e.prototype.destroy.call(this)},i}(t.BaseAct);t.DayMoney=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(s){e.call(this,new ui.act.DayMoneyNewUI),this._display=this.skin,this.cacheAs="none",this._display.mainLayer.cacheAs="bitmap",this.aid=s,this._list=new laya.ui.List,this._list.vScrollBarSkin="ui/comp/vscroll.png",this._list.scrollBar.visible=!1,this._list.renderHandler=Handler.create(this,this.updateLogItem,null,!1),this._list.itemRender=i,this._display.sp.addChild(this._list),this._list.x=1,this._list.y=88,this._list.repeatX=5,this._list.repeatY=3,this._list.spaceX=5,this._list.spaceY=10,this._list.height=430,this._list.array=[],this._display.timeMsg.visible=this._display.timeTxt.visible=this._display.dayTxt.visible=!1;var n={cmd:"activity",aid:this.aid,subcmd:"Get",needreload:"1"};t.XHR().Post(n,this,this.getActDataHandler)}return __extends(s,e),s.prototype.getActDataHandler=function(e){if(0==e.result){this._nowDay=Number(e.day),this._nowDayStatus=Number(e.status),this._doudouArr=[];for(var i=0;i<e.infos.length;i++){var s=Number(e.infos[i]);if(-1==this._doudouArr.indexOf(s)&&(this._doudouArr.push(s),this._doudouArr.length>=5))break}this._doudouArr.sort(function(t,e){return t-e}),this._list.array=e.infos,this._isNew=e.isnew,this._display.newTitle.visible=this._isNew,this._display.oldTitle.visible=!this._isNew,this._display.timeMsg.visible=this._display.timeTxt.visible=this._display.dayTxt.visible=!0,this._endTime=t.ServerClock.getDay0HourTime(t.ServerClock.getServerTime())+86400*(15-this._nowDay)*1e3,this.setTime(),Laya.timer.loop(1e3,this,this.setTime)}else t.WeakTips.show("查询活动信息失败，"+e.msg)},s.prototype.setTime=function(){var e=this._endTime-t.ServerClock.getServerTime(),i=Math.floor(e/864e5)+"",s=e%864e5,n=Math.floor(s/36e5)+"";1==n.length&&(n="0"+n);var a=s%36e5,o=Math.floor(a/6e4)+"";1==o.length&&(o="0"+o),this._display.dayTxt.text=i+"",this._display.timeTxt.text="天"+n+"时"+o+"分"},s.prototype.updateLogItem=function(t,e){e<=this._list.array.length-1&&t.doRender(Number(this._list.array[e]),e,this._nowDay,this._nowDayStatus,this._doudouArr,this.aid,this._isNew)},s.prototype.destroy=function(){Laya.timer.clear(this,this.setTime),this._list&&(this._list.destroy(),this._list=null),this._doudouArr=null,e.prototype.destroy.call(this)},s}(t.BaseAct);t.DayMoneyNew=e;var i=function(e){function i(){e.call(this),this.aid=0,this.cacheAs="none",this.mainLayer.cacheAs="bitmap"}return __extends(i,e),i.prototype.doRender=function(e,i,s,n,a,o,r){this.guoQiTxt.visible=this.canGetTxt.visible=this.hasGetTxt.visible=this.waitGetTxt.visible=!1,this.cash1.visible=this.cash2.visible=this.cash3.visible=this.cash4.visible=this.cash5.visible=!1,this.cash1_new.visible=this.cash2_new.visible=this.cash3_new.visible=this.cash4_new.visible=this.cash5_new.visible=!1;var h=a.indexOf(e);this.aid=o,-1!=h&&(r?this["cash"+(h+1)+"_new"].visible=!0:this["cash"+(h+1)].visible=!0),this.dayTxt1.text=i+1+"",this.dayTxt2.text=i+1+"",this.doudouTxt.text=e+"",this.isNew=r,this.flag.visible=!r,this.flagNew.visible=r;var l=!1;s>i+1?(this.boxMc.filters=t.FiltersUtils.getGreyFilters(),l=!0,this.guoQiTxt.visible=!0,this.dayMc1.visible=!0,this.dayMc2.visible=!1):i+1>s?(this.waitGetTxt.visible=!0,this.dayMc1.visible=!1,this.dayMc2.visible=!0):(0==n?(this.canGetTxt.visible=!0,this.on(Laya.Event.CLICK,this,this.clickHandler)):(this.hasGetTxt.visible=!0,this.boxMc.filters=t.FiltersUtils.getGreyFilters(),l=!0),this.dayMc1.visible=!0,this.dayMc2.visible=!1),l||i+1!=s||this.showMv(),l||1!=i&&2!=i&&6!=i&&7!=i&&10!=i&&13!=i?this.lightBox.visible=!1:this.lightBox.visible=!0},i.prototype.clickHandler=function(){var e={cmd:"activity",aid:this.aid,subcmd:"GetGift",needreload:"1"};t.XHR().Post(e,this,this.getActGiftHandler)},i.prototype.getActGiftHandler=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),this.canGetTxt.visible=!1,this.hasGetTxt.visible=!0,this.boxMc.filters=t.FiltersUtils.getGreyFilters(),this.destroyMv(),this.off(Laya.Event.CLICK,this,this.clickHandler),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).reload()):t.WeakTips.show("领取失败，"+e.msg)},i.prototype.showMv=function(){this._movie||(this._movie=new t.AnimationSKe("assets/skeleton/dayMoneyNew/rjdj.sk",1),this.sp.addChild(this._movie),this._movie.x=72,this._movie.y=84,this._movie.play(0,!0))},i.prototype.destroyMv=function(){this._movie&&(this._movie.destroy(),this._movie=null)},i.prototype.destroy=function(){this.destroyMv(),this.off(Laya.Event.CLICK,this,this.clickHandler),e.prototype.destroy.call(this)},i}(ui.act.DayMondyNewItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(n){e.call(this,new ui.act.DayRechargeUI),this._display=this.skin,this.aid=n,this._display.list.itemRender=i,this._display.list.scrollBar.visible=!1,this._display.list.scrollBar.elasticDistance=100,this._display.list.renderHandler=new Handler(this,this.onListRender),this._display.list.array=[],this._display.on(Laya.Event.CLICK,this,this.onClickPanel),this._display.bg.on(Laya.Event.CLICK,this,this.onClickPanel),this._display.infoBox.visible=!1,t.addListener(s.DAYRECHARGE_GIFT_TIPS,this,this.onClickGift),t.XHR().Post({cmd:"activity",aid:this.aid},this,this.dataRet)}return __extends(s,e),s.prototype.destroy=function(){e.prototype.destroy.call(this),t.removeListener(s.DAYRECHARGE_GIFT_TIPS,this,this.onClickGift)},s.prototype.dataRet=function(e){0!=e.result||this.destroyed?t.WeakTips.show(e.msg):(this._curData=e,this.updatePanel(e))},s.prototype.updatePanel=function(t){if(t.list.length>0){var e=t.list[t.list.length-1].recharge,i=t.curCost>e?e:t.curCost;this._display.progressImg.width=243*(i/e),this._display.costTxt.text=i+"/"+e,t.list.sort(this.giftsListSort),this._display.list.array=t.list}},s.prototype.giftsListSort=function(t,e){var i=t.status,s=e.status;if(2==i&&2!=s)return 1;if(2!=i&&2==s)return-1;var n=t.index,a=e.index;return n>a?1:a>n?-1:0},s.prototype.onClickGift=function(e){if(e){this._display.infoBox.visible=!0;var i=new t.DecodeDataCmd(e);t.Facade.callCommand(i);for(var s,n=0;8>n;n++)s=i.rewardBoxArr[n],s?(this._display["item"+n].visible=!0,this._display["item"+n].text=s.name+"*"+s.num):this._display["item"+n].visible=!1}},s.prototype.onClickPanel=function(t){"gift"!=t.target.name&&(this._display.infoBox.visible=!1)},s.prototype.onListRender=function(t,e){t.setData(this._display.list.getItem(e),e,this.aid)},s.DAYRECHARGE_GIFT_TIPS="DAYRECHARGE_GIFT_TIPS",s}(t.BaseAct);t.DayRecharge=e;var i=function(i){function s(){i.call(this),this.aid=0,this.lingquBtn.on(Laya.Event.CLICK,this,this.onClickGet),this.giftIcon.on(Laya.Event.CLICK,this,this.onClickGift)}return __extends(s,i),s.prototype.destroy=function(){i.prototype.destroy.call(this)},s.prototype.setData=function(e,i,s){if(e)switch(this.aid=s,this._curData=e,this.rechargeTxt.text=""+e.recharge,this.incomeTxt.text=e.income+"%",e.status){case 0:this.lingquBtn.filters=t.FiltersUtils.getGreyFilters(),this.lingquBtn.visible=!0,this.haveGetIcon.visible=!1;break;case 1:this.lingquBtn.filters=null,this.lingquBtn.visible=!0,this.haveGetIcon.visible=!1;break;case 2:this.lingquBtn.filters=null,this.lingquBtn.visible=!1,this.haveGetIcon.visible=!0}},s.prototype.onClickGet=function(){this._curData&&1==this._curData.status&&t.XHR().Post({cmd:"activity",aid:this.aid,sub:1,id:this._curData.index},this,this.getGiftRet)},s.prototype.onClickGift=function(){this._curData&&t.dispatch(e.DAYRECHARGE_GIFT_TIPS,this._curData.award)},s.prototype.getGiftRet=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!0)),this._curData.status=2,this.lingquBtn.filters=null,this.lingquBtn.visible=!1,this.haveGetIcon.visible=!0,t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).loadAct()):t.WeakTips.show(e.msg)},s}(ui.act.DayRechargeItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Animation,i=function(e){function i(i){e.call(this,new ui.act.DayRechargeDouble12_2017UI),this._display=this.skin,this.aid=i,this.cacheAs="none",this._display.mainLayer.cacheAs="bitmap",this._maxBarWidth=this._display.barMc.width,this._display.barMc.width=0,this._display.msgBox.visible=!1,this._list=new laya.ui.List,this._list.vScrollBarSkin="ui/comp/vscroll.png",this._list.scrollBar.visible=!1,this._list.renderHandler=Handler.create(this,this.updateItem,null,!1),this._list.itemRender=s,this._display.sp.addChild(this._list),this._list.x=0,this._list.y=248,this._list.repeatX=1,this._list.repeatY=4,this._list.spaceY=-3,this._list.height=273,this._list.array=[];var n=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);n.on(t.ModelEvent.UPDATE_FINISH,this,this.userModelUpdate),this._cash=n.cash,this._display.timeBox.visible=!1,this._display.goChongzhiBtn.on(Laya.Event.CLICK,this,this.goCHongzhi),this.query()}return __extends(i,e),i.prototype.query=function(){t.XHR().Post({cmd:"activity",aid:this.aid},this,this.queryHandler)},i.prototype.queryHandler=function(e){if(0==e.result){this._curCost=e.hasOwnProperty("curCost")?Number(e.curCost):0;var i=[60,300,980,1980,3280,6480],s=0;this._display.barMc.width=this._maxBarWidth,this._display.msgBox.visible=!1;for(var n=0;n<i.length;n++){var a=i[n];if(this._curCost<a){0==n?this._display.barMc.width=(this._display.png1_1.x-this._display.barMc.x)*(this._curCost/a):this._display.barMc.width=this._display["png"+n+"_1"].x-this._display.barMc.x+(this._display["png"+(n+1)+"_1"].x-this._display["png"+n+"_1"].x)*(this._curCost-i[n-1])/(a-i[n-1]),this._display.msgBox.visible=!0,this._display.needTxt.text=String(a-this._curCost);break}s=n+1,this._display["png"+s+"_1"].visible=!0,this._display["png"+s+"_2"].visible=!1}for(var n=s+1;6>=n;n++)this._display["png"+n+"_1"].visible=!1,this._display["png"+n+"_2"].visible=!0;if(this._remainTime=Number(t.Facade.retrieveModel(t.ModelDef.ACT_MODEL).GetActById(this.aid).last_seconds),this._display.timeBox.visible=!0,this.setTime(),Laya.timer.loop(1e3,this,this.setTime),e.list&&e.list.length>0){var o=e.list;for(this._display.retTxt.text="112%";o.length>6;)o.pop();this._list.array=o}}else t.WeakTips.show("查询活动失败，"+e.msg)},i.prototype.setTime=function(){var t=Math.floor(this._remainTime/86400)+"",e=this._remainTime%86400,i=Math.floor(e/3600)+"";1==i.length&&(i="0"+i);var s=e%3600,n=Math.floor(s/60)+"";1==n.length&&(n="0"+n),this._display.dayTxt.text=t+"",this._display.timeTxt.text="天"+i+"时"+n+"分"},i.prototype.updateItem=function(t,e){e<=this._list.array.length-1&&t.doRender(this._list.array[e],e,this.aid,this._curCost)},i.prototype.goCHongzhi=function(){t.Facade.callCommand(new t.OpenVipBoxCommand(1))},i.prototype.userModelUpdate=function(){var e=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);e.cash>this._cash&&this.query(),this._cash=e.cash},i.prototype.destroy=function(){var i=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);i.off(t.ModelEvent.UPDATE_FINISH,this,this.userModelUpdate),this._display.goChongzhiBtn.off(Laya.Event.CLICK,this,this.goCHongzhi),Laya.timer.clear(this,this.setTime),this._list&&(this._list.destroy(),this._list=null),e.prototype.destroy.call(this)},i}(t.BaseAct);t.DayRechargeDouble12_2017=i;var s=function(i){function s(){i.call(this),this.cacheAs="none",this.mainLayer.cacheAs="bitmap",this.doBtn.on(Laya.Event.CLICK,this,this.doBtnClickHandler);for(var t=1;6>=t;t++)this["titlePng"+t].visible=!1}return __extends(s,i),s.prototype.doRender=function(i,s,n,a){this._aid=n,this._objIndex=i.index;var o=Number(i.status);0==o?(this.doBtn.visible=!0,this.doBtn.filters=t.FiltersUtils.getGreyFilters(),this.hasGet.visible=!1):1==o?(this.doBtn.visible=!0,this.doBtn.filters=null,this.hasGet.visible=!1):(this.doBtn.visible=!1,this.hasGet.visible=!0),this.bg1.visible=s%2==0,this.bg2.visible=!this.bg1.visible;for(var r=1;6>=r;r++)this["titlePng"+r].visible=!1;this["titlePng"+(s+1)].visible=!0,this.icon1.visible=this.icon2.visible=this.icon3.visible=this.icon4.visible=!1,this.icon1Bg.visible=this.icon2Bg.visible=this.icon3Bg.visible=this.icon4Bg.visible=!1,this.numTxt1.text=this.numTxt2.text=this.numTxt3.text=this.numTxt4.text="";for(var r=1;4>=r;r++)this["ani"+r]&&(this["ani"+r].stop(),this["ani"+r].visible=!1);for(var h,l=0,r=0;r<i.award.attrs.length&&(l++,!(l>4));r++)h=i.award.attrs[r],this["icon"+l].visible=!0,this["icon"+l+"Bg"].visible=!0,this["icon"+l].skin=t.ResPath().getPic(h.id,t.ResourcePath.PATH_GOODS),this["numTxt"+l].text=h.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.desc,t.Tips.show(n,e)})}(l,h,this["icon"+l]);for(var c,d=0;d<i.award.items.length&&(l++,!(l>4));d++)c=i.award.items[d],this["icon"+l].visible=!0,this["icon"+l+"Bg"].visible=!0,this["icon"+l].skin=t.ResPath().getPic(c.icon_id,t.ResourcePath.PATH_GOODS),c.id>=200001&&c.id<=4e5?(this["numTxt"+l].text=t.DateUtils.getStrByHours(c.hours),this["ani"+l]||(this["ani"+l]=new e,this["ani"+l].loadAtlas("res/atlas/ui/item_movie.json"),this["ani"+l].interval=95,this["ani"+l].index=1,this.sp.addChild(this["ani"+l]),this["ani"+l].x=this["icon"+l+"Bg"].x-51,this["ani"+l].y=this["icon"+l+"Bg"].y-52),this["ani"+l].play(),this["ani"+l].visible=!0):this["numTxt"+l].text=c.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.goods_desc,n.info=i.effect_desc,t.Tips.show(n,e)})}(l,c,this["icon"+l])},s.prototype.doBtnClickHandler=function(){this.doBtn.filters&&this.doBtn.filters.length>0?t.WeakTips.show("条件未达成"):t.XHR().Post({cmd:"activity",aid:this._aid,sub:1,id:this._objIndex},this,this.getHandler)},s.prototype.getHandler=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0)),this.doBtn.visible=!1,this.hasGet.visible=!0):t.WeakTips.show("领取失败，"+e.msg)},s.prototype.destroy=function(){this.doBtn.off(Laya.Event.CLICK,this,this.doBtnClickHandler);for(var t=1;4>=t;t++)this.ani+t&&(this.ani.stop(),this.ani.destroy(),this.ani=null);i.prototype.destroy.call(this)},s}(ui.act.DayRechargeDouble12_2017ItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,new ui.act.DayTiLiUI),this._giftFlag=!0,this._display=this.skin,this.aid=t,this.init()}return __extends(i,e),i.prototype.init=function(){this._display.btn_get0.on(laya.events.Event.CLICK,this,this.getGift),this._display.btn_get1.on(laya.events.Event.CLICK,this,this.getGift),this.loadInfo()},i.prototype.loadInfo=function(){t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"Get"},this,this.showAct)},i.prototype.showAct=function(e){var i=t.ServerClock.getServerNowDate().getHours();11>i?(this._display.btn_get0.label="领取便当",this._display.btn_get0.mouseEnabled=!1,this._display.btn_get0.gray=!0,this._display.btn_get1.label="领取便当",this._display.btn_get1.mouseEnabled=!1,this._display.btn_get1.gray=!0):i>=11&&14>i?(0==e.flag1?(this._display.btn_get0.label="领取便当",this._display.btn_get0.mouseEnabled=!0,this._display.btn_get0.gray=!1):1==e.flag1&&(this._display.btn_get0.label="已领取",this._display.btn_get0.mouseEnabled=!1,this._display.btn_get0.gray=!0),this._display.btn_get1.label="领取便当",this._display.btn_get1.mouseEnabled=!1,this._display.btn_get1.gray=!0):i>=14&&18>i?(0==e.flag1?(this._display.btn_get0.label="20斗豆补领",this._display.btn_get0.mouseEnabled=!0,this._display.btn_get0.gray=!1):1==e.flag1&&(this._display.btn_get0.label="已领取",this._display.btn_get0.mouseEnabled=!1,this._display.btn_get0.gray=!0),this._display.btn_get1.label="领取便当",this._display.btn_get1.mouseEnabled=!1,this._display.btn_get1.gray=!0):i>=18&&21>i?(0==e.flag1?(this._display.btn_get0.label="已过期",this._display.btn_get0.mouseEnabled=!1,this._display.btn_get0.gray=!0):1==e.flag1&&(this._display.btn_get0.label="已领取",this._display.btn_get0.mouseEnabled=!1,this._display.btn_get0.gray=!0),0==e.flag2?(this._display.btn_get1.label="领取便当",this._display.btn_get1.mouseEnabled=!0,this._display.btn_get1.gray=!1):1==e.flag2&&(this._display.btn_get1.label="已领取",this._display.btn_get1.mouseEnabled=!1,this._display.btn_get1.gray=!0)):i>=21&&(0==e.flag1?(this._display.btn_get0.label="已过期",this._display.btn_get0.mouseEnabled=!1,this._display.btn_get0.gray=!0):1==e.flag1&&(this._display.btn_get0.label="已领取",this._display.btn_get0.mouseEnabled=!1,this._display.btn_get0.gray=!0),0==e.flag2?(this._display.btn_get1.label="20斗豆补领",this._display.btn_get1.mouseEnabled=!0,this._display.btn_get1.gray=!1):1==e.flag2&&(this._display.btn_get1.label="已领取",this._display.btn_get1.mouseEnabled=!1,this._display.btn_get1.gray=!0))},i.prototype.getGift=function(e){var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL);"20斗豆补领"==e.currentTarget.label&&i.cash<20?t.WeakTips.show("您的斗豆数量不足"):!this.destroyed&&this._giftFlag&&t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"GetGift"},this,this.getGiftBack)},i.prototype.getGiftBack=function(e){0==e.result?(e.award_king&&e.changed&&e.changed.attrs&&e.changed.attrs.push({id:"kKingTimes",num:e.award_king}),t.Facade.callCommand(new t.SyncChangeCmd(e)),this.loadInfo(),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).reload()):t.WeakTips.show(e.msg)},i.prototype.destroy=function(){this._display.btn_get0.off(laya.events.Event.CLICK,this,this.getGift),this._display.btn_get1.off(laya.events.Event.CLICK,this,this.getGift),this._display=null,e.prototype.destroy.call(this)},i}(t.BaseAct);t.DayTiLi=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(s){e.call(this,new ui.act.DiscountUI),this._display=this.skin,this.aid=s,this._display.rechargeBtn.on(laya.events.Event.CLICK,this,this.onRecharge),this._display.giftList.itemRender=i,this._display.giftList.hScrollBarSkin="ui/comp/vscroll.png",this._display.giftList.scrollBar.visible=!1,this._display.giftList.renderHandler=new Handler(this,this.onListRender),this._display.giftList.array=[],this._display.infoBox.visible=!1,this._display.infoBox.mouseEnabled=!1,this._display.infoCloseBtn.visible=!1,this._display.infoCloseBtn.on(Laya.Event.CLICK,this,this.closeInfoBox),this._display.msgText.style.fontFamily="黑体",this._display.msgText.style.fontSize=20,this._display.msgText.style.lineHeight=28,this._display.msgText.style.wordWrap=!1,this._display.msgText.style.color="#FBFCC0",this._display.msgText.style.stroke=2,this._display.msgText.style.strokeColor="#200804",this._display.rechargeBtn.visible=!1,this._um=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL),this._um.on(t.ModelEvent.UPDATE_FINISH,this,this.userModelUpdate),this._cash=this._um.cash,this.update()}return __extends(s,e),s.prototype.destroy=function(){this._um.off(t.ModelEvent.UPDATE_FINISH,this,this.userModelUpdate),e.prototype.destroy.call(this)},s.prototype.userModelUpdate=function(){this._um.cash>this._cash&&this.update()},s.prototype.update=function(){t.XHR().Post({cmd:"activity",aid:this.aid},this,this.dataRet)},s.prototype.onRecharge=function(){t.Facade.callCommand(new t.OpenVipBoxCommand(1))},s.prototype.dataRet=function(e){0==e.result?(this.gifts=e.gift_array,this.activated=0!=e.activated,this._display.rechargeBtn.visible=!this.activated,this._display.giftList.array=this.gifts):t.WeakTips.show(e.msg)},s.prototype.clickHandler=function(e,i){this._index=i,this._display.infoBox.visible=!0,this._display.infoBox.x=e.target.x,this._display.infoBox.y=e.target.y;for(var s,n="",a=this.gifts[this._index].details.items,o=0,r=0;r<a.length;r++)s=a[r],n+=s.name+"*"+s.num+"<br>",o++;this._display.msgText.innerHTML=n,this._display.info_bg.height=28*o+106,this._display.infoCloseBtn.visible=!0,this._display.infoCloseBtn.x=this._display.infoBox.x+this._display.info_bg.width-72,this._display.infoCloseBtn.y=this._display.infoBox.y+8,this._display.infoBox.y+this._display.info_bg.height+100>t.LayerMgr.height+t.LayerMgr.offY&&(this._display.infoBox.y-=this._display.infoBox.y+this._display.info_bg.height+100-(t.LayerMgr.height+t.LayerMgr.offY))},s.prototype.closeInfoBox=function(){this._display.infoCloseBtn.visible=!1,this._display.infoBox.visible=!1},s.prototype.onListRender=function(t,e){t.setData(this.gifts[e],e,this.aid,this)},s}(t.BaseAct);t.Discount=e;var i=function(e){function i(){e.call(this),this.aid=0,this.gifttitle=["魂珠包","强化包","经验包","江湖包","怒火精华包","禅修精华包","鹰眼精华包","原水精华包","燃烧精华包","山岳精华包"]}return __extends(i,e),i.prototype.destroy=function(){this.btnBuy.off(Laya.Event.CLICK,this,this.buy),this.gift.off(Laya.Event.CLICK,this,this.showTips),e.prototype.destroy.call(this)},i.prototype.showTips=function(t){this._Dis.clickHandler(t,this._index)},i.prototype.setData=function(t,e,i,s){t&&(this.aid=i,this._curData=t,this._Dis=s,this._index=e,this.title.text=""+this.gifttitle[e],this.tfPrice.text=t.price,this.tfNow.text=t.discount_price,this.bg.skin="ui/act/discount/list"+e%4+".png",this.gift.on(Laya.Event.CLICK,this,this.showTips),this.btnBuy.label="特价购买",s.activated?0==t.flag?(this.btnBuy.on(Laya.Event.CLICK,this,this.buy),this.btnBuy.gray=!1):(this.btnBuy.off(Laya.Event.CLICK,this,this.buy),this.btnBuy.label="已购买",this.btnBuy.gray=!0):(this.btnBuy.off(Laya.Event.CLICK,this,this.buy),this.btnBuy.gray=!0))},i.prototype.buy=function(e){this._curData&&t.XHR().Post({cmd:"activity",aid:this.aid,op:"buy",idx:this._curData.idx},this,this.buyRet)},i.prototype.buyRet=function(e){0!=e.result||this.destroyed?t.WeakTips.show(e.msg):(t.Facade.callCommand(new t.SyncChangeCmd(e)),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).loadAct(),this.btnBuy.label="已购买",this.btnBuy.gray=!0,this._curData.flag=1)},i}(ui.act.DiscountListUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,new ui.act.FarmUI),this._levelstep=5,this._showAnim=-1,this.status=0,this.m_djPath="assets/skeleton/farm/ledounongzhuang.sk",this.animReady=!1,this.tipsarr=["点击开始种植按钮即可开始精心培育您的农场啦~","点击施肥按钮即可每日为果实注入养分，还能获得每日的劳作奖励哦！","不同的果实下面数字表示成熟度哦~，到了成熟期即可收获对应数量的作物啦！"],this.btnNames=["开始种植","点击施肥","点击收获"],this._shifeiIdx=10,this._display=this.skin,this.aid=t,this.init(),this._display.farmBtn.on(Laya.Event.CLICK,this,this.btnHandler),this._display.shifei.on(Laya.Event.CLICK,this,this.btnHandler),this._display.rulePic.on(Laya.Event.CLICK,this,this.showRule),this._display.on(Laya.Event.CLICK,this,this.showAwardTips)}return __extends(i,e),i.prototype.init=function(){t.XHR().Post({cmd:"activity",aid:this.aid},this,this.getDataHandler)},i.prototype.getDataHandler=function(e){if(0==e.result&&!this.destroyed){if(1==e.status?(this._display.shifei.visible=!0,this._display.farmBtn.visible=!1):(this._display.shifei.visible=!1,this._display.farmBtn.visible=!0),this._display.popTxt.text=this.tipsarr[e.status],this._display.farmBtn.label=this.btnNames[e.status],this.status=e.status,1==e.fertilize&&1==e.status&&(this._display.popTxt.text=this.tipsarr[2],this._display.shifei.filters=t.FiltersUtils.getGreyFilters()),0==this.status)this._display.leftTime.text="请点击种植按钮";else if(1==this.status){var i=t.DateUtils.getTimeFomateObj(e.seconds);this._display.leftTime.text=i.day+"天"+i.hour+"小时"+i.minute+"分"}else this._display.leftTime.text="请点击收获按钮";this.crop=e.crop.items,this.showCrop()}},i.prototype.showCrop=function(){if(!this.destroyed&&(this._display.animBox.visible=!1,this.crop))for(var t=0;t<this.crop.length;t++){var e=Math.ceil(this.crop[t].num/this._levelstep);this._display["icon"+t].visible=!0,this._display["icon"+t].skin="ui/act/farm/"+e+"-"+t+".png",this._display["icon"+t].y=this._display["txtBg"+t].y-20*(e>=3?1:0),this._display["txtBg"+t].visible=!0,this._display["text"+t].text="成熟+"+this.crop[t].num}},i.prototype.showAnimation=function(t){var e,i,s="成熟度+"+t.num;e=Math.ceil(this.crop[t.idx].num/this._levelstep),this.crop[t.idx].num+=parseInt(t.num),i=Math.ceil(this.crop[t.idx].num/this._levelstep),this.showTips(s,this._display["icon"+t.idx]),i>e?(this._showAnim=t.idx,this.animPlay()):this.showCrop()},i.prototype.showTips=function(t,e){this._tipsLabel||(this._tipsLabel=new laya.ui.Label,this._tipsLabel.width=150,this._tipsLabel.align="left",this._tipsLabel.color="#3ADF00",this._tipsLabel.strokeColor="#000000",this._tipsLabel.align="center",this._tipsLabel.stroke=4,this._tipsLabel.fontSize=24,this._display.addChild(this._tipsLabel)),this._tipsLabel.visible=!0,this._tipsLabel.x=0,this._tipsLabel.y=0,this._tipsLabel.text=t,this._tipsLabel.x=e.x,this._tipsLabel.y=e.y+70,Laya.Tween.to(this._tipsLabel,{y:this._tipsLabel.y-100,alpha:.4},1e3,null,Handler.create(this,this.tweenComplete))},i.prototype.tweenComplete=function(){this._tipsLabel.alpha=1,this._tipsLabel.visible=!1},i.prototype.animPlay=function(){var e=[[2,3],[0,1],[4,5],[6,7],[8,9]];this._display.animBox.visible=!0;var i=this._display["icon"+this._showAnim],s=this._display["txtBg"+this._showAnim];this._display.animBox.x=i.x+26,this._display.animBox.y=i.y+26;var n;n=Math.ceil(this.crop[this._showAnim].num/this._levelstep)-2,n=0>n?0:n;var a=e[this._showAnim][n];i.visible=!1,s.visible=!1,this._animationsk||(this._animationsk=new t.AnimationSKe(this.m_djPath),this._display.animBox.addChild(this._animationsk)),this._animationsk.play(a,!1),this._animationsk.on(laya.events.Event.STOPPED,this,this.showCrop)},i.prototype.btnHandler=function(){t.XHR().Post({cmd:"activity",aid:this.aid,sub:this.status+1},this,this.btnClickCallback)},i.prototype.btnClickCallback=function(e){0!=e.result||this.destroyed?t.WeakTips.show(e.msg):(0==this.status?(t.WeakTips.show("种植成功"),this.getDataHandler(e)):1==this.status?(this._shifeidata=e,this.shifeiAnim(),this._display.shifei.filters=t.FiltersUtils.getGreyFilters()):(t.WeakTips.show(e.msg),this.init()),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).loadAct())},i.prototype.shifeiAnim=function(){this._animationsk||(this._animationsk=new t.AnimationSKe(this.m_djPath),this._display.animBox.addChild(this._animationsk)),this._display.animBox.visible=!0,this._display.animBox.x=675,this._display.animBox.y=455,this._animationsk.on(laya.events.Event.STOPPED,this,this.shifeiPlay),this.shifeiPlay()},i.prototype.shifeiPlay=function(){this._shifeiIdx<12?(this._animationsk.play(this._shifeiIdx,!1),this._shifeiIdx++):(this._animationsk.off(laya.events.Event.STOPPED,this,this.shifeiPlay),t.Facade.callCommand(new t.SyncChangeCmd(this._shifeidata)),this._display.animBox.visible=!1,this._display.popTxt.text=this.tipsarr[2],this.showAnimation(this._shifeidata))},i.prototype.showRule=function(){var e="欢乐农庄规则",i="<br /> <br /><p>1.乐斗农庄分为种植期和收获期两部分。种植期和收获期依次循环：种植期→收获期→种植期→收获期</p>";i+="<br /><p>2.点击开始种植进入新的一轮种植期。进入种植期后，所有果实的成熟度均为1。种植期从点击种植开始计算，至第三天的0点前结束。在种植期内，每天都可以点击施肥按钮进行一次施肥操作。每天可施肥1次，共可施肥2次。</p>",i+="<br /><p>3.点击施肥按钮后，会随机为一个果实增加成熟度数值。</p>",i+="<br /><p>4.从第三天的0点开始，农庄进入成熟期，进入成熟期后不可以再进行施肥操作，点击收获后收取对应的道具奖励。</p>",i+="<br /><p>5.完成收获操作后，农场重置为初始状态进入新的循环。</p>",t.RulePanel.showRule(i,e)},i.prototype.showAwardTips=function(e){var i=-1!=e.target.name.indexOf("icon"),s=-1!=e.target.name.indexOf("txtBg");if(i||s){var n=-1;if(n=i?parseInt(e.target.name.replace("icon","")):parseInt(e.target.name.replace("txtBg","")),this.crop&&this.crop[n]){var a,o=this.crop[n],r={};a=e.target.localToGlobal(new laya.maths.Point(0,0)),r.name="收获",r.desc=o.name+" * "+o.num,t.Tips.show(r,a)}}},i.prototype.destroy=function(){this._display.farmBtn.off(Laya.Event.CLICK,this,this.btnHandler),this._display.shifei.off(Laya.Event.CLICK,this,this.btnHandler),this._animationsk&&(this._animationsk.offAll(),this._animationsk.destroy()),this._display=null,e.prototype.destroy.call(this)},i}(t.BaseAct);t.FarmAct=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,new ui.act.Fish_ActUI),this._display=this.skin,this._display.clickPng.on(Laya.Event.CLICK,this,this.clickHandler),this._display.click_btn.on(Laya.Event.CLICK,this,this.clickHandler),this._aid=t}return __extends(i,e),i.prototype.clickHandler=function(){t.Facade.callCommand(new t.FishMainBoxCmd(this._aid))},i.prototype.destroy=function(){this._display.clickPng.off(Laya.Event.CLICK,this,this.clickHandler),this._display.click_btn.off(Laya.Event.CLICK,this,this.clickHandler),e.prototype.destroy.call(this)},i}(t.BaseAct);t.FishAct=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i){e.call(this,new ui.act.FishMainUI),this.progressNum=0,this._fishSKPath="assets/skeleton/fish/qiebingyuan.sk",this._bonesType=0,this._fishnum=0,this._playType=0,this._display=this.skin,this.setCloseButton(this._display.backBtn),this.canClickModelToClose=!1,this._aid=i,this._actModel=t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL),this._userModel=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),this._curDou=this._userModel.doubi,this._bones=["鞭炮","手雷","炸药包","鱼雷"],this._display.share_btn.on(Laya.Event.CLICK,this,this.shareBtnClickHandler),this._display.cz_btn.on(Laya.Event.CLICK,this,this.czBtnClickHandler),this._display.Icon1.on(Laya.Event.CLICK,this,this.bonesFish,[0]),this._display.Icon2.on(Laya.Event.CLICK,this,this.bonesFish,[1]),this._display.Icon3.on(Laya.Event.CLICK,this,this.bonesFish,[2]),this._display.Icon4.on(Laya.Event.CLICK,this,this.bonesFish,[3]),this._display.progressIcon1.on(Laya.Event.CLICK,this,this.getBones,[0]),this._display.progressIcon2.on(Laya.Event.CLICK,this,this.getBones,[1]),this._display.progressIcon3.on(Laya.Event.CLICK,this,this.getBones,[2]),this._display.progressIcon4.on(Laya.Event.CLICK,this,this.getBones,[3]),this._display.progressIcon5.on(Laya.Event.CLICK,this,this.getBones,[4]),this._display.tipsClose.on(Laya.Event.CLICK,this,this.closeTips),this._userModel.on(t.ModelEvent.UPDATE_FINISH,this,this.onUserModelUpdate),this.showNpcMessage(1),this.init(),(t.Global.isWX||t.Global.isWXAPP)&&(this._display.backBtn.y+=100),this._fishSK=new t.AnimationSKe(this._fishSKPath),this._fishSK.x=-378,this._fishSK.y=520}return __extends(i,e),i.prototype.onUserModelUpdate=function(){this._userModel.doubi>this._curDou&&(this.init(),this._curDou=this._userModel.doubi)},i.prototype.init=function(){t.XHR().Post({cmd:"activity",sub:"query",aid:this._aid,uid:t.Global.UID},this,this.getDataHandler)},i.prototype.getDataHandler=function(e){if(0==e.result){this._display.aniBox.addChild(this._fishSK),
this._display.aniBox.visible=!0,this._fishSK.play(1,!1),this._fishSK.stop();var i=this._actModel.GetActById(this._aid);this._display.todayGetTxt.text=e.douyu_num,this.progressNum=e.recharge_num,this.showProgress(e);var s=t.DateUtils.getTimeFomateObj(i.last_seconds);this._display.leftDay.text=s.day,this._display.leftHour.text=s.hour}else t.WeakTips.show("查询活动信息失败，"+e.msg)},i.prototype.showProgress=function(e){var i=0;i=this.progressNum<1280?600*(this.progressNum/1280):600+(this.progressNum-1280)/600*200,i=i>800?800:i,this._display.progressValue.width=i;for(var s=0;s<e.infos.length;s++)1!=e.infos[s].status?t.Util.toGray(this._display["progressIcon"+(s+1)]):t.Util.enable(this._display["progressIcon"+(s+1)]);for(var s=0;4>s;s++)this._display["num"+(s+1)].text=e.propertys[s].count,0==e.propertys[s].count?t.Util.toGray(this._display["Icon"+(s+1)]):t.Util.enable(this._display["Icon"+(s+1)])},i.prototype.shareBtnClickHandler=function(){t.ShareModule.shareMessage({title:["炸了炸了~"],desc:["本鹅那么随手一扔的【"+this._bones[this._bonesType]+"】竟然炸鱼堆了，一下就获得了【"+this._fishnum+"】条斗鱼，赚翻啦！快来围观~"],alertType:1,command:1002})},i.prototype.czBtnClickHandler=function(e){t.Facade.callCommand(new t.OpenVipBoxCommand(1))},i.prototype.getBones=function(e){t.XHR().Post({cmd:"activity",aid:this._aid,sub:"get_gift",idx:e},this,this.getBonesHandler)},i.prototype.bonesFish=function(e){this._bonesType=e,this.showNpcMessage(1),t.XHR().Post({cmd:"activity",aid:this._aid,sub:"catch",idx:e},this,this.getSendDataHandler)},i.prototype.getBonesHandler=function(e){if(0==e.result){this.init();var i=["鞭炮*3","手雷*2","炸药包*1","鱼雷*1"];t.WeakTips.show("您获得了"+i[e.idx]+"!")}else t.WeakTips.show(e.msg)},i.prototype.getSendDataHandler=function(e){if(0==e.result){var i=100*(this._bonesType+1),s=[0,1,3,2];e.award&&e.award.attrs&&e.award.attrs[0].num>=i?(this._fishnum=e.award.attrs[0].num,this._fishSK.play(2*s[this._bonesType]+1,!1),Laya.timer.once(2e3,this,this.showReward,[e,!0])):(this._fishnum=e.award.attrs[0].num,this._fishSK.play(2*s[this._bonesType],!1),Laya.timer.once(2e3,this,this.showReward,[e,!1]))}else t.WeakTips.show(e.msg)},i.prototype.showReward=function(e,i){t.Facade.callCommand(new t.SyncChangeCmd(e)),i?(this.openTips("本鹅那么随手一扔的“"+this._bones[this._bonesType]+"”竟然炸鱼堆了，一下就获得了“"+this._fishnum+"”条斗鱼，赚翻啦！快来围观~"),this.showNpcMessage(3)):this.showNpcMessage(2),this.init()},i.prototype.openTips=function(t){this._display.tipsText.text=t,this._display.tipsBox.visible=!0},i.prototype.closeTips=function(){this._display.tipsBox.visible=!1},i.prototype.showNpcMessage=function(t){var e=["要是扔到鱼群里，暴击收益可不少哟！","小心呀！要爆炸啦~~","收益还不错嘛！够吃一阵子了。","哇哦~ 太令人羡慕了，这么多斗鱼！"];Laya.timer.clear(this,this.showNpcMessage),this._display.msgTxt.text=e[t],Laya.timer.once(5e3,this,this.showNpcMessage,[0])},i.prototype.destroy=function(){this._display.share_btn.off(Laya.Event.CLICK,this,this.shareBtnClickHandler),this._display.cz_btn.off(Laya.Event.CLICK,this,this.czBtnClickHandler),this._display.Icon1.off(Laya.Event.CLICK,this,this.bonesFish),this._display.Icon2.off(Laya.Event.CLICK,this,this.bonesFish),this._display.Icon3.off(Laya.Event.CLICK,this,this.bonesFish),this._display.Icon4.off(Laya.Event.CLICK,this,this.bonesFish),this._display.progressIcon1.off(Laya.Event.CLICK,this,this.getBones),this._display.progressIcon2.off(Laya.Event.CLICK,this,this.getBones),this._display.progressIcon3.off(Laya.Event.CLICK,this,this.getBones),this._display.progressIcon4.off(Laya.Event.CLICK,this,this.getBones),this._display.progressIcon5.off(Laya.Event.CLICK,this,this.getBones),this._display.tipsClose.off(Laya.Event.CLICK,this,this.closeTips),this._userModel.off(t.ModelEvent.UPDATE_FINISH,this,this.onUserModelUpdate),Laya.timer.clearAll(this),this._fishSK.destroy(),e.prototype.destroy.call(this)},i}(t.BaseBox);t.FishMainBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(t){e.call(this,new ui.act.GemHouseUI),this._display=this.skin,this.aid=t,this._display.list.itemRender=i,this._display.list.renderHandler=new Handler(this,this.onListRender),this._display.list.array=[],this._display.list.selectEnable=!1,this.load()}return __extends(s,e),s.prototype.load=function(){t.XHR().Post({file:"petpk",cmd:"activity",aid:this.aid,sub:"query"},this,this.queryRet)},s.prototype.queryRet=function(e){this.destroyed||(0==e.result?(this._display.list.array=e.infos,t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).reload()):t.WeakTips.show(e.msg))},s.prototype.onListRender=function(t,e){t.setData(this._display.list.getItem(e),e,this.aid,this)},s.prototype.destroy=function(){e.prototype.destroy.call(this)},s}(t.BaseAct);t.GemHouse=e;var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.setData=function(e,i,s,n){this._data=e,this._aid=s,this._gemhouse=n,this.goodsNum.text="原价："+e.org_price,this.buyNum.text=(0==e.price?"可领取":"可购买")+e.count+"/"+e.limit_count,e.count==e.limit_count?(this.getBtn.visible=!0,this.buyBtn.visible=!1,this.getBtn.label=0==e.price?"已领取":"已购买",t.Util.toGrayAndDisabled(this.getBtn)):0==e.price?(this.buyBtn.visible=!1,this.getBtn.visible=!0,this.getBtn.label="免费领取"):(this.buyBtn.visible=!0,this.getBtn.visible=!1,this.buyBtn.label=e.price),4==i?this.x=25:5==i?this.x=272:6==i&&(this.x=516),this.getBtn.on(Laya.Event.CLICK,this,this.getGift),this.buyBtn.on(Laya.Event.CLICK,this,this.getGift),this.goodsIcon.on(Laya.Event.CLICK,this,this.showTips,[i])},i.prototype.showTips=function(e){var i,s=["1级剑君攻魂*1+1级剑君守魂*1+1级帅帅暴魂*1+1级帅帅命魂*1+1级月敏反魂*1+1级月敏愈魂*1","2级剑君攻魂*3+2级剑君守魂*3+2级帅帅暴魂*3+2级帅帅命魂*3+2级月敏反魂*3+2级月敏愈魂*3","2级剑君攻魂*1+2级剑君守魂*1+2级帅帅暴魂*1+2级帅帅命魂*1+2级月敏反魂*1+2级月敏愈魂*1","2级剑君攻魂*5+2级剑君守魂*5+2级帅帅暴魂*5+2级帅帅命魂*5+2级月敏反魂*5+2级月敏愈魂*5","3级剑君攻魂*1+3级剑君守魂*1+3级帅帅暴魂*1+3级帅帅命魂*1+3级月敏反魂*1+3级月敏愈魂*1","4级剑君攻魂*1+4级剑君守魂*1+4级帅帅暴魂*1+4级帅帅命魂*1+4级月敏反魂*1+4级月敏愈魂*1","5级剑君攻魂*1+5级剑君守魂*1+5级帅帅暴魂*1+5级帅帅命魂*1+5级月敏反魂*1+5级月敏愈魂*1"],n={};i=this.goodsIcon.localToGlobal(new laya.maths.Point(0,0)),n.name="魂珠礼包"+(e+1),n.desc=s[e],t.Tips.show(n,i)},i.prototype.giftRet=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).reload(),this._gemhouse.load()):t.WeakTips.show(e.msg)},i.prototype.getGift=function(){t.XHR().Post({file:"petpk",cmd:"activity",aid:this._aid,sub:"buy",idx:this._data.idx},this,this.giftRet)},i.prototype.destroy=function(){this.getBtn.off(Laya.Event.CLICK,this,this.getGift),this.buyBtn.off(Laya.Event.CLICK,this,this.getGift),this.goodsIcon.off(Laya.Event.CLICK,this,this.showTips),e.prototype.destroy.call(this)},i}(ui.act.GemHouseItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(s){e.call(this,new ui.act.GemSellUI),this._totalBuyNum=0,this._display=this.skin,this.cacheAs="none",this.aid=s,this._list=new laya.ui.List,this._list.hScrollBarSkin="ui/comp/vscroll.png",this._list.scrollBar.visible=!1,this._list.renderHandler=Handler.create(this,this.updateItem,null,!1),this._list.itemRender=i,this._display.addChild(this._list),this._list.x=7,this._list.y=232,this._list.repeatX=4,this._list.repeatY=1,this._list.spaceX=6,this._list.width=708,this._list.array=[],this._display.timeMsg.visible=this._display.timeTxt.visible=this._display.dayTxt.visible=!1,this._totalBuyNum=0,t.EventCenter.singleton.on("GEM_SELL_ACTIVITY_BUY_SUCCESS",this,this.buySuccess),this._remainTime=Number(t.Facade.retrieveModel(t.ModelDef.ACT_MODEL).GetActById(this.aid).last_seconds),t.XHR().Post({file:"petpk",cmd:"shop",actid:this.aid,uid:t.Global.UID},this,this.getGemShopHandler)}return __extends(s,e),s.prototype.getGemShopHandler=function(e){if(0==e.result){if(e.commodity_info){for(var i=0;i<e.commodity_info.length;i++){var s=e.commodity_info[i];this._totalBuyNum+=s.hasOwnProperty("count")?Number(s.count):0}this._display.remainCountTxt.text="剩余高级魂珠："+(120-this._totalBuyNum),this._list.array=e.commodity_info}this._display.timeMsg.visible=this._display.timeTxt.visible=this._display.dayTxt.visible=!0,this.setTime(),Laya.timer.loop(1e3,this,this.setTime)}else t.WeakTips.show("拉取魂珠售卖信息失败，"+e.msg)},s.prototype.setTime=function(){var t=Math.floor(this._remainTime/86400)+"",e=this._remainTime%86400,i=Math.floor(e/3600)+"";1==i.length&&(i="0"+i);var s=e%3600,n=Math.floor(s/60)+"";1==n.length&&(n="0"+n),this._display.dayTxt.text=t+"",this._display.timeTxt.text="天"+i+"时"+n+"分"},s.prototype.updateItem=function(t,e){e<=this._list.array.length-1&&t.doRender(this._list.array[e],e,600-this._totalBuyNum)},s.prototype.buySuccess=function(t){for(var e=String(t.id),i=Number(t.num),s=this._list.array,n=0;n<s.length;n++){var a=s[n];if(String(a.id)==e){a.count=Number(a.count)+i;break}}this._totalBuyNum+=i,this._display.remainCountTxt.text="剩余高级魂珠："+(120-this._totalBuyNum),this._list.array=s},s.prototype.destroy=function(){t.EventCenter.singleton.off("GEM_SELL_ACTIVITY_BUY_SUCCESS",this,this.buySuccess),Laya.timer.clear(this,this.setTime),this._list&&(this._list.destroy(),this._list=null),e.prototype.destroy.call(this)},s}(t.BaseAct);t.GemSell=e;var i=function(e){function i(){e.call(this),this.icon.on(Laya.Event.CLICK,this,this.clickTips),this.buy10Btn.on(Laya.Event.CLICK,this,this.buy10),this.buy1Btn.on(Laya.Event.CLICK,this,this.buy1),this._remainNum=600}return __extends(i,e),i.prototype.doRender=function(e,i,s){this._obj=e,this.priceTxt1.text=e.price,this.priceTxt2.text=e.act_price,this.zheKouTxt.text="4折",this.icon.skin=t.ResPath().getPic(e.iconId,t.ResourcePath.PATH_GOODS),this._remainNum>=10?10>s&&(this.buy10Btn.filters=t.FiltersUtils.getGreyFilters()):s>=10&&(this.buy10Btn.filters=null),this._remainNum>=1?1>s&&(this.buy1Btn.filters=t.FiltersUtils.getGreyFilters()):s>=1&&(this.buy1Btn.filters=null),this._remainNum=s},i.prototype.clickTips=function(){var e,i={};e=this.localToGlobal(new laya.maths.Point(0,0)),i.name=this._obj.name,i.desc=this._obj.goods_des,i.info=this._obj.goods_effect,t.Tips.show(i,e)},i.prototype.buy10=function(){this.buy10Btn.filters&&this.buy10Btn.filters.length>0?t.WeakTips.show("剩余魂珠数量不足"):t.XHR().Post({file:"petpk",cmd:"shop",subtype:1,num:10,id:this._obj.id,price:10*Number(this._obj.act_price),uid:t.Global.UID},this,this.buy10Handler)},i.prototype.buy10Handler=function(e){0==e.result?(t.EventCenter.singleton.event("GEM_SELL_ACTIVITY_BUY_SUCCESS",{id:this._obj.id,num:10}),t.Facade.callCommand(new t.SyncChangeCmd(e))):-1!=e.msg.indexOf("设置活动标记失败")?t.WeakTips.show("购买失败，购买数量超过上限"):t.WeakTips.show("购买失败，"+e.msg)},i.prototype.buy1=function(){this.buy1Btn.filters&&this.buy1Btn.filters.length>0?t.WeakTips.show("剩余魂珠数量不足"):t.XHR().Post({file:"petpk",cmd:"shop",subtype:1,num:1,id:this._obj.id,price:this._obj.act_price,uid:t.Global.UID},this,this.buy1Handler)},i.prototype.buy1Handler=function(e){0==e.result?(t.EventCenter.singleton.event("GEM_SELL_ACTIVITY_BUY_SUCCESS",{id:this._obj.id,num:1}),t.Facade.callCommand(new t.SyncChangeCmd(e))):-1!=e.msg.indexOf("设置活动标记失败")?t.WeakTips.show("购买失败，购买数量超过上限"):t.WeakTips.show("购买失败，"+e.msg)},i.prototype.destroy=function(){this._obj=null,this.icon.off(Laya.Event.CLICK,this,this.clickTips),this.buy10Btn.off(Laya.Event.CLICK,this,this.buy10),this.buy1Btn.off(Laya.Event.CLICK,this,this.buy1),e.prototype.destroy.call(this)},i}(ui.act.GemSellItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(s){e.call(this,new ui.act.GoldHouseUI),this._display=this.skin,this.aid=s,this._display.list.itemRender=i,this._display.list.renderHandler=new Handler(this,this.onListRender),this._display.list.array=[],this._display.list.selectEnable=!1,t.XHR().Post({file:"petpk",cmd:"activity",aid:this.aid,sub:0},this,this.queryRet)}return __extends(s,e),s.prototype.queryRet=function(e){this.destroyed||(0==e.result?this._display.list.array=e.infos:t.WeakTips.show(e.msg))},s.prototype.onListRender=function(t,e){t.setData(this._display.list.getItem(e),e,this.aid)},s.prototype.destroy=function(){e.prototype.destroy.call(this)},s}(t.BaseAct);t.GoldHouse=e;var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.setData=function(e,i,s){this._data=e,this._aid=s;var n=e.award.items[0];this.goodsIcon.skin=t.ResPath().getPic(n.icon_id,t.ResourcePath.PATH_GOODS),this.goodsNum.text=n.num,2==e.flag?(this.getBtn.visible=!0,this.buyBtn.visible=!1,this.getBtn.label=0==e.price?"已领取":"已购买",t.Util.toGrayAndDisabled(this.getBtn)):0==e.price?(this.buyBtn.visible=!1,this.getBtn.visible=!0,this.getBtn.label="免费领取"):(this.buyBtn.visible=!0,this.getBtn.visible=!1,this.buyBtn.label=e.price),this.indexClip.skin="ui/act/gold_index_"+(i+1)+".png",this.tfTimes.text=e.limit_count>1?e.buy_count+"/"+e.limit_count:"",this.getBtn.on(Laya.Event.CLICK,this,this.getGift),this.buyBtn.on(Laya.Event.CLICK,this,this.getGift)},i.prototype.getGift=function(){t.XHR().Post({file:"petpk",cmd:"activity",aid:this._aid,sub:1,id:this._data.idx},this,this.dataRet)},i.prototype.dataRet=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).reload(),this._data.limit_count>1&&this._data.buy_count++,(1==this._data.limit_count||this._data.buy_count>=this._data.limit_count)&&(this._data.flag=2,this.getBtn.visible=!0,this.buyBtn.visible=!1,this.getBtn.label=0==this._data.price?"已领取":"已购买",t.Util.toGrayAndDisabled(this.getBtn)),this.tfTimes.text=this._data.limit_count>1?this._data.buy_count+"/"+this._data.limit_count:""):t.WeakTips.show(e.msg)},i}(ui.act.GoldHouseItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Animation,i=function(e){function i(i){e.call(this,new ui.act.Hallowmas2017_1UI),this._display=this.skin,this.aid=i,this.cacheAs="none",this._display.mainLayer.cacheAs="bitmap",this._list=new laya.ui.List,this._list.vScrollBarSkin="ui/comp/vscroll.png",this._list.scrollBar.visible=!1,this._list.renderHandler=Handler.create(this,this.updateItem,null,!1),this._list.itemRender=s,this._display.sp.addChild(this._list),this._list.x=0,this._list.y=185,this._list.repeatX=1,this._list.repeatY=4,this._list.spaceY=-3,this._list.height=336,this._list.array=[],this._display.timeBox.visible=!1,this._remainTime=Number(t.Facade.retrieveModel(t.ModelDef.ACT_MODEL).GetActById(this.aid).last_seconds),t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"querytask"},this,this.queryHandler)}return __extends(i,e),i.prototype.queryHandler=function(e){0==e.result?(this._display.timeBox.visible=!0,this.setTime(),Laya.timer.loop(1e3,this,this.setTime),this._list.array=e.tasks):t.WeakTips.show("查询活动失败，"+e.msg)},i.prototype.setTime=function(){var t=Math.floor(this._remainTime/86400)+"",e=this._remainTime%86400,i=Math.floor(e/3600)+"";1==i.length&&(i="0"+i);var s=e%3600,n=Math.floor(s/60)+"";1==n.length&&(n="0"+n),this._display.dayTxt.text=t+"",this._display.timeTxt.text="天"+i+"时"+n+"分"},i.prototype.updateItem=function(t,e){e<=this._list.array.length-1&&t.doRender(this._list.array[e],e,this.aid)},i.prototype.destroy=function(){Laya.timer.clear(this,this.setTime),this._list&&(this._list.destroy(),this._list=null),e.prototype.destroy.call(this)},i}(t.BaseAct);t.Hallowmas2017_1=i;var s=function(i){function s(){i.call(this),this.cacheAs="none",this.mainLayer.cacheAs="bitmap",this.doBtn.on(Laya.Event.CLICK,this,this.doBtnClickHandler)}return __extends(s,i),s.prototype.doRender=function(i,s,n){this.bg1.visible=s%2==0,this.bg2.visible=!this.bg1.visible,this._aid=n,this._id=i.id,13==this._id||14==this._id?this.nameTxt.text=i.name+":"+i.num+"/"+i.target+"元":15==this._id?this.nameTxt.text=i.name+":"+i.num+"/"+i.target+"斗豆":12==this._id?this.nameTxt.text=i.name+":"+i.num+"/"+i.target+"点":this.nameTxt.text=i.name+":"+i.num+"/"+i.target+"次",0==Number(i.status)?(this.doBtn.label="前  往",this.doBtn.filters=null):2==Number(i.status)?(this.doBtn.label="已领取",this.doBtn.filters=t.FiltersUtils.getGreyFilters()):(this.doBtn.label="领  取",this.doBtn.filters=null),this.icon1.visible=this.icon2.visible=this.icon3.visible=this.icon4.visible=!1,this.icon1Bg.visible=this.icon2Bg.visible=this.icon3Bg.visible=this.icon4Bg.visible=!1,this.numTxt1.text=this.numTxt2.text=this.numTxt3.text=this.numTxt4.text="";for(var a=1;4>=a;a++)this["ani"+a]&&(this["ani"+a].stop(),this["ani"+a].visible=!1);for(var o,r=0,a=0;a<i.rewards.attrs.length&&(r++,!(r>4));a++)o=i.rewards.attrs[a],this["icon"+r].visible=!0,this["icon"+r+"Bg"].visible=!0,this["icon"+r].skin=t.ResPath().getPic(o.id,t.ResourcePath.PATH_GOODS),this["numTxt"+r].text=o.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.desc,t.Tips.show(n,e)})}(r,o,this["icon"+r]);for(var h,l=0;l<i.rewards.items.length&&(r++,!(r>4));l++)h=i.rewards.items[l],this["icon"+r].visible=!0,this["icon"+r+"Bg"].visible=!0,this["icon"+r].skin=t.ResPath().getPic(h.icon_id,t.ResourcePath.PATH_GOODS),h.id>=200001&&h.id<=4e5?(this["numTxt"+r].text=t.DateUtils.getStrByHours(h.hours),this["ani"+r]||(this["ani"+r]=new e,this["ani"+r].loadAtlas("res/atlas/ui/item_movie.json"),this["ani"+r].interval=95,this["ani"+r].index=1,this.sp.addChild(this["ani"+r]),this["ani"+r].x=this["icon"+r+"Bg"].x-51,this["ani"+r].y=this["icon"+r+"Bg"].y-52),this["ani"+r].play(),this["ani"+r].visible=!0):this["numTxt"+r].text=h.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.goods_desc,n.info=i.effect_desc,t.Tips.show(n,e)})}(r,h,this["icon"+r])},s.prototype.doBtnClickHandler=function(){"前  往"==this.doBtn.label?-1!=this.nameTxt.text.indexOf("副本")?t.Facade.callCommand(new t.LilianCmd):-1!=this.nameTxt.text.indexOf("英雄")?t.Facade.callCommand(new t.LilianCmd(1e4,1)):-1!=this.nameTxt.text.indexOf("体力")?t.Facade.callCommand(new t.FriendCommand):-1!=this.nameTxt.text.indexOf("充值")?t.Facade.callCommand(new t.OpenVipBoxCommand(1)):-1!=this.nameTxt.text.indexOf("王者")?t.Facade.callCommand(new t.ChampionTeamCommand):-1!=this.nameTxt.text.indexOf("消费")&&t.WeakTips.show("左侧有好多活动优惠等着您，快去看看吧！"):"已领取"==this.doBtn.label?t.WeakTips.show("您已经领取过这个奖励了"):t.XHR().Post({cmd:"activity",aid:this._aid,subcmd:"getaward",idx:this._id},this,this.getHandler)},s.prototype.getHandler=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0)),this.doBtn.label="已领取",this.doBtn.filters=t.FiltersUtils.getGreyFilters()):t.WeakTips.show("领取失败，"+e.msg)},s.prototype.destroy=function(){this.doBtn.off(Laya.Event.CLICK,this,this.doBtnClickHandler);for(var t=1;4>=t;t++)this.ani+t&&(this.ani.stop(),this.ani.destroy(),this.ani=null);i.prototype.destroy.call(this)},s}(ui.act.Hallowmas2017_1ItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(s){e.call(this,new ui.act.Hallowmas2017_2UI),this._display=this.skin,this.aid=s,this._list=new laya.ui.List,this._list.vScrollBarSkin="ui/comp/vscroll.png",this._list.scrollBar.visible=!1,this._list.renderHandler=Handler.create(this,this.updateItem,null,!1),this._list.itemRender=i,this._display.addChildAt(this._list,this._display.getChildIndex(this._display.tipsBox)),this._list.x=0,this._list.y=185,this._list.repeatX=1,this._list.repeatY=4,this._list.spaceY=-3,this._list.height=336,this._list.array=[],this._display.tipsBox.visible=!1,t.EventCenter.singleton.on("SHOW_WEEKACTIVE2_TIPS",this,this.showTips),t.EventCenter.singleton.on("WEEKACTIVE2_EXCHANGE",this,this.exchangeHandler),this._display.timeBox.visible=!1,this._remainTime=Number(t.Facade.retrieveModel(t.ModelDef.ACT_MODEL).GetActById(this.aid).last_seconds),t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"query"},this,this.queryHandler)}return __extends(s,e),s.prototype.queryHandler=function(e){if(0==e.result){this._goodsID=Number(e.goods_id),this._display.iconPng.skin=t.ResPath().getPic(this._goodsID,t.ResourcePath.PATH_GOODS);var i=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL);i.on(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdateFinish),this.packModelUpdateFinish(),this._display.timeBox.visible=!0,this.setTime(),Laya.timer.loop(1e3,this,this.setTime),this._list.array=e.gifts}else t.WeakTips.show("查询活动失败，"+e.msg)},s.prototype.setTime=function(){var t=Math.floor(this._remainTime/86400)+"",e=this._remainTime%86400,i=Math.floor(e/3600)+"";1==i.length&&(i="0"+i);var s=e%3600,n=Math.floor(s/60)+"";1==n.length&&(n="0"+n),this._display.dayTxt.text=t+"",this._display.timeTxt.text="天"+i+"时"+n+"分"},s.prototype.updateItem=function(t,e){e<=this._list.array.length-1&&t.doRender(this._list.array[e],e,this.aid,this._goodsID)},s.prototype.packModelUpdateFinish=function(){var e=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL);this._display.numTxt.text="×"+e.getItemCount(this._goodsID)},s.prototype.showTips=function(t){Laya.timer.clear(this,this.hideTips),this._display.tipsBox.visible=!0,this._display.tipsBox.x=t.xValue-400,this._display.tipsBox.y=t.yValue-100,this._display.tipsMsg.text=t.str,this._display.tipsBg.height=this._display.tipsMsg.textHeight+10,Laya.timer.once(4e3,this,this.hideTips)},s.prototype.hideTips=function(){this._display.tipsBox.visible=!1},s.prototype.exchangeHandler=function(t){var e=this._list.array;e[t.index].exchange_num=Number(e[t.index].exchange_num)+1,this._list.array=e},s.prototype.destroy=function(){Laya.timer.clear(this,this.hideTips),t.EventCenter.singleton.off("SHOW_WEEKACTIVE2_TIPS",this,this.showTips),t.EventCenter.singleton.off("WEEKACTIVE2_EXCHANGE",this,this.exchangeHandler);var i=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL);i.off(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdateFinish),Laya.timer.clear(this,this.setTime),this._list&&(this._list.destroy(),this._list=null),e.prototype.destroy.call(this)},s}(t.BaseAct);t.Hallowmas2017_2=e;var i=function(e){function i(){e.call(this),this.icon2Bg.on(Laya.Event.CLICK,this,this.iconClickHandler),this.doBtn.on(Laya.Event.CLICK,this,this.doBtnClickHandler)}return __extends(i,e),i.prototype.doRender=function(e,i,s,n){if(this.bg1.visible=i%2==0,this.bg2.visible=!this.bg1.visible,this._obj=e,this._aid=s,this._index=i,this._goodsID=n,this.numTxt1.text="×"+e.target_num,this.exchangeCountTxt.text=e.exchange_num+"/"+e.total_num,this.icon1.skin=t.ResPath().getPic(n,t.ResourcePath.PATH_GOODS),1==this._obj.award.items.length?this.icon2.skin=t.ResPath().getPic(this._obj.award.items[0].icon_id,t.ResourcePath.PATH_GOODS):this.icon2.skin="ui/act/hallowmas2017_2/icon2.png",Number(this._obj.exchange_num)>=Number(this._obj.total_num))this.doBtn.filters=t.FiltersUtils.getGreyFilters();else{var a=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL);a.getItemCount(this._goodsID)<Number(this._obj.target_num)?this.doBtn.filters=t.FiltersUtils.getGreyFilters():this.doBtn.filters=null}},i.prototype.iconClickHandler=function(e){var i=e.stageX-t.LayerMgr.offX,s=e.stageY-t.LayerMgr.offY,n="";if(this._obj.award.attrs&&this._obj.award.attrs.length>0)for(var a=0;a<this._obj.award.attrs.length;a++)n+=this._obj.award.attrs[a].name+"×"+this._obj.award.items[a].num+"\n";if(this._obj.award.items&&this._obj.award.items.length>0)for(var a=0;a<this._obj.award.items.length;a++)if(this._obj.award.items[a].id>=200001&&this._obj.award.items[a].id<=4e5){var o=0==Number(this._obj.award.items[a].isage)?-1:Number(this._obj.award.items[a].hours);n+=this._obj.award.items[a].name+"×"+t.DateUtils.getStrByHours(o)+"\n"}else n+=this._obj.award.items[a].name+"×"+this._obj.award.items[a].num+"\n";t.EventCenter.singleton.event("SHOW_WEEKACTIVE2_TIPS",{xValue:i,yValue:s,str:n})},i.prototype.doBtnClickHandler=function(){if(Number(this._obj.exchange_num)>=Number(this._obj.total_num))t.WeakTips.show("兑换已达上限");else{var e=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL);e.getItemCount(this._goodsID)<Number(this._obj.target_num)?t.WeakTips.show("道具数量不足"):t.XHR().Post({cmd:"activity",aid:this._aid,subcmd:"exchange",idx:this._index},this,this.exchangeHandler)}},i.prototype.exchangeHandler=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0)),t.EventCenter.singleton.event("WEEKACTIVE2_EXCHANGE",{index:this._index})):t.WeakTips.show("兑换失败，"+e.msg)},i.prototype.destroy=function(){this._obj=null,this.icon2Bg.off(Laya.Event.CLICK,this,this.iconClickHandler),this.doBtn.off(Laya.Event.CLICK,this,this.doBtnClickHandler),e.prototype.destroy.call(this)},i}(ui.act.Hallowmas2017_2ItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(t){e.call(this,new ui.act.JianJunUI),this._display=this.skin,this.aid=t,this._display.goodsList.itemRender=i,this._display.goodsList.renderHandler=new Handler(this,this.onListRender),this._display.goodsList.array=[],this.init(),this._display.cacheAs="bitmap",this._display.reCache()}return __extends(s,e),s.prototype.init=function(){this._display.goodsList.array=[],t.XHR().Post({cmd:"activity",aid:this.aid},this,this.dataRet)},s.prototype.destroy=function(){Laya.timer.clear(this,this.updatePanel),t.Tips.tipsClose(),e.prototype.destroy.call(this)},s.prototype.dataRet=function(e){0==e.result?(Laya.timer.clear(this,this.updatePanel),this._curData=e,this.updatePanel(),Laya.timer.loop(1e3,this,this.updatePanel)):t.WeakTips.show(e.msg)},s.prototype.updatePanel=function(){var e=this._curData,i=t.DateUtils.getTimeFomateObj(e.seconds);this._display.leftTime.text="距下次刷新："+i.hour+"小时"+i.minute+"分"+i.second+"秒",this._display.goodsList.array=e.gift_array,this._curData.seconds=this._curData.seconds-1,this._curData.seconds<0&&this.init()},s.prototype.onListRender=function(t,e){t.setData(this._display.goodsList.getItem(e),e,this.aid)},s}(t.BaseAct);t.JianJunAct=e;var i=function(e){function i(){e.call(this),this.aid=0}return __extends(i,e),i.prototype.destroy=function(){this.buyBtn.off(Laya.Event.CLICK,this,this.onClickGet),this.goodsIcon.off(Laya.Event.CLICK,this,this.showTips),e.prototype.destroy.call(this)},i.prototype.setData=function(e,i,s){e&&(this.aid=s,this._curData=e,this.goodsIcon.loadImage(t.ResPath().getPic(e.icon_id,t.ResourcePath.PATH_GOODS),0,0,80,80),this.pricetext.text="市价："+e.price+"斗豆",this.buyPrice.text="现价："+e.discount_price,this.goodsNum.text="x"+e.num,this.goodsIcon.on(Laya.Event.CLICK,this,this.showTips),0==e.flag?this.buyBtn.on(Laya.Event.CLICK,this,this.onClickGet):this.buyBtn.filters=t.FiltersUtils.getGreyFilters())},i.prototype.showTips=function(){var e,i={};e=this.localToGlobal(new laya.maths.Point(0,0)),i.name=this._curData.name,t.Tips.show(i,e)},i.prototype.onClickGet=function(){t.XHR().Post({cmd:"activity",aid:this.aid,op:"buy",idx:this._curData.idx},this,this.getGiftRet)},i.prototype.getGiftRet=function(e){0==e.result?(t.Util.toGray(this.buyBtn),this.buyBtn.off(Laya.Event.CLICK,this,this.onClickGet),t.Facade.callCommand(new t.SyncChangeCmd(e,!0)),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).reload()):t.WeakTips.show(e.msg)},i}(ui.act.JianJunItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(t){e.call(this,new ui.act.JingHuaShopUI),this.canbuy=[],this._display=this.skin,this.aid=t,this._display.zk_List.itemRender=i,this._display.zk_List.renderHandler=new Handler(this,this.onSpecListRender),this._display.zk_List.array=[],this._display.zk_List.hScrollBarSkin="ui/comp/vscroll.png",this._display.zk_List.scrollBar.visible=!1,this._display.goods_List.itemRender=i,this._display.goods_List.renderHandler=new Handler(this,this.onListRender),this._display.goods_List.array=[],this._display.goods_List.hScrollBarSkin="ui/comp/vscroll.png",this._display.goods_List.scrollBar.visible=!1,this.init(),this._display.cacheAs="bitmap",this._display.reCache(),this._display.arrow_left1.on(Laya.Event.CLICK,this,this.listMove,[this._display.zk_List,-1]),this._display.arrow_left2.on(Laya.Event.CLICK,this,this.listMove,[this._display.goods_List,-1]),this._display.arrow_right1.on(Laya.Event.CLICK,this,this.listMove,[this._display.zk_List,1]),this._display.arrow_right2.on(Laya.Event.CLICK,this,this.listMove,[this._display.goods_List,1])}return __extends(s,e),s.prototype.init=function(){t.XHR().Post({cmd:"activity",aid:this.aid,op:"get"},this,this.dataRet)},s.prototype.destroy=function(){t.Tips.tipsClose(),e.prototype.destroy.call(this)},s.prototype.dataRet=function(e){0!=e.result||this.destroyed?t.WeakTips.show(e.msg):(this._display.limitNum2.text="限量礼包每日限购:"+e.normal_day+"/"+e.normal_max,this._display.limitNum1.text="折扣礼包每日限购:"+e.spec_day+"/"+e.spec_max,this.canbuy[0]=e.normal_max-e.normal_day,this.canbuy[1]=e.spec_max-e.spec_day,this._curData=e.gift_array_normal,this._display.zk_List.array=e.gift_array_spec,this._display.goods_List.array=e.gift_array_normal,this._display.leftDay.text=Math.floor(e.end_hour/24)+"",this._display.leftHour.text=e.end_hour%24+"")},s.prototype.listMove=function(t,e){if(!this.destroyed){var i=t.scrollBar.value;i+=230*e,i>t.scrollBar.max?i=t.scrollBar.max:i<t.scrollBar.min&&(i=t.scrollBar.min),t.scrollBar.value=i}},s.prototype.onSpecListRender=function(t,e){t.setData(this._display.zk_List.getItem(e),e,this,1)},s.prototype.onListRender=function(t,e){t.setData(this._display.goods_List.getItem(e),e,this,0)},s}(t.BaseAct);t.JingHuaShop=e;var i=function(e){function i(){e.call(this),this._type=0}return __extends(i,e),i.prototype.destroy=function(){this.buyBtn1.off(Laya.Event.CLICK,this,this.onClickGet),this.buyBtn2.off(Laya.Event.CLICK,this,this.onClickGet),this.Icon1.off(Laya.Event.CLICK,this,this.showTips),e.prototype.destroy.call(this)},i.prototype.setData=function(e,i,s,n){if(e){this._jhshop=s,this._curData=e,this._type=n,this.goods=e.details&&e.details.items&&e.details.items[0]?e.details.items[0]:e;var a=this.goods.icon_id?this.goods.icon_id:100104;this.price1.text="原价："+e.price+"斗豆",this.price2.text="折后："+e.discount_price+"斗豆",this.Icon1.skin=t.ResPath().getPic(a,t.ResourcePath.PATH_GOODS),this.Icon1.on(Laya.Event.CLICK,this,this.showTips),this._jhshop.canbuy[n]>0?this.buyBtn1.on(Laya.Event.CLICK,this,this.onClickGet,[1]):(this.buyBtn1.gray=!0,this.buyBtn1.off(Laya.Event.CLICK,this,this.onClickGet)),this._jhshop.canbuy[n]>9?this.buyBtn2.on(Laya.Event.CLICK,this,this.onClickGet,[10]):(this.buyBtn2.gray=!0,this.buyBtn2.off(Laya.Event.CLICK,this,this.onClickGet)),1==n?this.cornerText.text=e.discount_price/e.price*10+"折":this.cornerText.text="限量"}},i.prototype.showTips=function(){var e,i={};e=this.localToGlobal(new laya.maths.Point(0,0)),i.name=this.goods.name,i.desc=this.goods.effect_desc,i.info=this.goods.goods_desc,t.Tips.show(i,e)},i.prototype.onClickGet=function(e){void 0===e&&(e=0),t.XHR().Post({cmd:"activity",aid:this._jhshop.aid,op:"buy",num:e,type:this._type,idx:this._curData.idx},this,this.getGiftRet)},i.prototype.getGiftRet=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!0)),this._jhshop.init()):t.WeakTips.show(e.msg)},i}(ui.act.JHItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,
new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,new ui.act.JointPic_ActUI),this._display=this.skin,this._display.clickPng.on(Laya.Event.CLICK,this,this.clickHandler),this._aid=t}return __extends(i,e),i.prototype.clickHandler=function(){t.Facade.callCommand(new t.OpenJointPicMainBoxCmd(this._aid))},i.prototype.destroy=function(){this._display.clickPng.off(Laya.Event.CLICK,this,this.clickHandler),e.prototype.destroy.call(this)},i}(t.BaseAct);t.JointPicAct=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,s,n){if(t.call(this,new ui.act.jointPicGetBoxUI),this._display=this.skin,this.setCloseButton(this._display.bg.btnClose),e)for(var a=0;a<e.length;a++){var o=e[a];this._display["numTxt"+o.id].text=String(o.num)}if(s&&s.length>0&&(this._friendList=new laya.ui.List,this._friendList.vScrollBarSkin="ui/comp/vscroll.png",this._friendList.scrollBar.visible=!1,this._friendList.renderHandler=Handler.create(this,this.updateFriendItem,null,!1),this._friendList.itemRender=i,this._display.addChild(this._friendList),this._friendList.x=330,this._friendList.y=315,this._friendList.repeatX=1,this._friendList.repeatY=10,this._friendList.spaceX=0,this._friendList.spaceY=6,this._friendList.height=284,this._friendList.array=s),n&&n.length>0){for(var r=0;r<n.length;r++)console.log(n[r],"====");this._factionList=new laya.ui.List,this._factionList.vScrollBarSkin="ui/comp/vscroll.png",this._factionList.scrollBar.visible=!1,this._factionList.renderHandler=Handler.create(this,this.updateFactionItem,null,!1),this._factionList.itemRender=i,this._display.addChild(this._factionList),this._factionList.x=700,this._factionList.y=315,this._factionList.repeatX=1,this._factionList.repeatY=10,this._factionList.spaceX=0,this._factionList.spaceY=6,this._factionList.height=284,this._factionList.array=n}}return __extends(e,t),e.prototype.updateFriendItem=function(t,e){e<=this._friendList.array.length-1&&t.doRender(this._friendList.array[e],e)},e.prototype.updateFactionItem=function(t,e){e<=this._factionList.array.length-1&&t.doRender(this._factionList.array[e],e)},e.prototype.destroy=function(){this._friendList&&(this._friendList.destroy(),this._friendList=null),this._factionList&&(this._factionList.destroy(),this._factionList=null),t.prototype.destroy.call(this)},e}(t.BaseBox);t.JointPicGetBox=e;var i=function(t){function e(){t.call(this),this._txt=new laya.display.Text,this._txt.align="center",this._txt.color="#705341",this._txt.fontSize=22,this._txt.bold=!0,this._txt.width=302,this._txt.height=24,this.addChild(this._txt)}return __extends(e,t),e.prototype.doRender=function(t,e){this._txt.text=t.text},e.prototype.destroy=function(){this._txt=null,t.prototype.destroy.call(this)},e}(laya.ui.View)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i){e.call(this,new ui.act.JointPicMainUI),this._selectGiftIndex=0,this._display=this.skin,this.setCloseButton(this._display.backBtn),this.canClickModelToClose=!1,this._display.selectPng.visible=!1,this._aid=i,t.XHR().Post({cmd:"activity",aid:this._aid,uid:t.Global.UID},this,this.getDataHandler),this._display.askBtn.on(Laya.Event.CLICK,this,this.askBtnClickHandler),this._display.sendBtn.on(Laya.Event.CLICK,this,this.sendBtnClickHandler),this._display.exchangeBtn.on(Laya.Event.CLICK,this,this.doExchange),this._display.backBtn.y+=t.Global.FLOAT_ICON_OFFSET}return __extends(i,e),i.prototype.getDataHandler=function(e){if(0==e.result){i.nowGet=Number(e.get_num),i.maxGet=Number(e.give_num),this._display.todayGetTxt.text="今日获得："+e.day_num+"/"+e.day_max,this.setPicNum(e.piece_arr);for(var s=1;8>=s;s++)this._display["icon"+s].on(Laya.Event.CLICK,this,this.giftIconClickHandler);for(var n,a=0,s=0;s<e.award_arr.attrs.length&&(a++,!(a>8));s++)n=e.award_arr.attrs[s],this["_goodsID"+a]=Number(n.id),this._display["icon"+a].visible=!0,this._display["icon"+a].skin=t.ResPath().getPic(n.id,t.ResourcePath.PATH_GOODS),this._display["giftNumTxt"+a].text=n.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.desc,t.Tips.show(n,e)})}(a,n,this._display["icon"+a]);for(var o,r=0;r<e.award_arr.items.length&&(a++,!(a>8));r++)o=e.award_arr.items[r],this["_goodsID"+a]=Number(o.id),this._display["icon"+a].visible=!0,this._display["icon"+a].skin=t.ResPath().getPic(o.icon_id,t.ResourcePath.PATH_GOODS),this._display["giftNumTxt"+a].text=o.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.goods_desc,n.info=i.effect_desc,t.Tips.show(n,e)})}(a,o,this._display["icon"+a])}else t.WeakTips.show("查询活动信息失败，"+e.msg)},i.prototype.setPicNum=function(e){if(e&&e.length>0){for(var i=99999,s=0;s<e.length;s++){var n=e[s];this._display["numTxt"+n.id].text=String(n.num),this._display["png"+n.id].filters=0==Number(n.num)?t.FiltersUtils.getGreyFilters():null,i=Math.min(i,Number(n.num))}this._display.canExchangeNumTxt.text="可兑换次数："+i}else this._display.canExchangeNumTxt.text="可兑换次数：0"},i.prototype.askBtnClickHandler=function(){t.XHR().Post({cmd:"activity",aid:this._aid,sub:1,uid:t.Global.UID},this,this.getAskDataHandler)},i.prototype.getAskDataHandler=function(e){0==e.result?(this.setPicNum(e.piece_arr),this.openPicUIBox(e,1)):t.WeakTips.show("获取索取界面信息失败，"+e.msg)},i.prototype.sendBtnClickHandler=function(){t.XHR().Post({cmd:"activity",aid:this._aid,sub:4,type:0,uid:t.Global.UID},this,this.getSendDataHandler)},i.prototype.getSendDataHandler=function(e){if(0==e.result){e.piece_arr=[];for(var i=1;9>=i;i++){var s={id:i};s.num=this._display["numTxt"+i].text,e.piece_arr.push(s)}this.openPicUIBox(e,2)}else t.WeakTips.show("获取捐赠界面信息失败，"+e.msg)},i.prototype.openPicUIBox=function(e,i){this._jointPicUIBox||(this._jointPicUIBox=new t.JointPicUIBox(this._aid,e,i),this._jointPicUIBox.on(t.ViewEvent.BASE_DESTROY,this,this.jointPicUIBoxDestroy),this._jointPicUIBox.on("GET_SUCCESS",this,this.getSuccess),this._jointPicUIBox.on("SEND_SUCCESS",this,this.sendSuccess),this._jointPicUIBox.show())},i.prototype.jointPicUIBoxDestroy=function(){this._jointPicUIBox&&(this._jointPicUIBox.off(t.ViewEvent.BASE_DESTROY,this,this.jointPicUIBoxDestroy),this._jointPicUIBox.off("GET_SUCCESS",this,this.getSuccess),this._jointPicUIBox.off("SEND_SUCCESS",this,this.sendSuccess),this._jointPicUIBox=null)},i.prototype.getSuccess=function(e){var i=e.getArr;if(i){for(var s=99999,n=0;n<i.length;n++){var a=i[n];this._display["numTxt"+a.id].text=String(Number(this._display["numTxt"+a.id].text)+Number(a.num)),this._display["png"+a.id].filters=0==Number(this._display["numTxt"+a.id].text)?t.FiltersUtils.getGreyFilters():null,s=Math.min(s,Number(this._display["numTxt"+a.id].text))}this._display.canExchangeNumTxt.text="可兑换次数："+s}},i.prototype.sendSuccess=function(e){this._display["numTxt"+e].text=String(Number(this._display["numTxt"+e].text)-1),this._display["png"+e].filters=0==Number(this._display["numTxt"+e].text)?t.FiltersUtils.getGreyFilters():null;for(var i=99999,s=1;9>=s;s++)i=Math.min(i,Number(this._display["numTxt"+s].text));this._display.canExchangeNumTxt.text="可兑换次数："+i},i.prototype.getNum=function(t){var e=this._display["numTxt"+t];return""==e?0:Number(e)},i.prototype.giftIconClickHandler=function(t){var e=t.target;this._selectGiftIndex=Number(e.name.split("icon")[1]),this._display.selectPng.visible=!0,this._display.selectPng.x=e.x-6,this._display.selectPng.y=e.y-7},i.prototype.doExchange=function(){if(0==this._selectGiftIndex)t.WeakTips.show("请先选择您要兑换的奖品");else{for(var e=!1,i=1;9>=i;i++)if("0"==this._display["numTxt"+i].text){e=!0;break}e?t.WeakTips.show("您没有足够的拼图，加油收集拼图碎片吧！"):t.XHR().Post({cmd:"activity",aid:this._aid,sub:6,goods_id:this["_goodsID"+this._selectGiftIndex],uid:t.Global.UID},this,this.exchangeHandler)}},i.prototype.exchangeHandler=function(e){if(0==e.result){for(var i=1;9>=i;i++){var s=Number(this._display["numTxt"+i].text);this._display["numTxt"+i].text=String(s-1)}var n=Number(this._display.canExchangeNumTxt.text.split("可兑换次数：")[1]);this._display.canExchangeNumTxt.text="可兑换次数："+(n-1),t.Facade.callCommand(new t.SyncChangeCmd(e))}else t.WeakTips.show("兑换失败，"+e.msg)},i.prototype.destroy=function(){this._display.askBtn.off(Laya.Event.CLICK,this,this.askBtnClickHandler),this._display.sendBtn.off(Laya.Event.CLICK,this,this.sendBtnClickHandler),this._display.exchangeBtn.off(Laya.Event.CLICK,this,this.doExchange);for(var t=1;8>=t;t++)this._display["icon"+t].off(Laya.Event.CLICK,this,this.giftIconClickHandler);e.prototype.destroy.call(this)},i}(t.BaseBox);t.JointPicMainBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(s,n,a){if(e.call(this,new ui.act.JointPicBoxUI),this._isAsking=!1,this._display=this.skin,this.setCloseButton(this._display.bg.btnClose),this._aid=s,1==a){this._isAsking=0==Number(n.status),this._display.askBtn.label=this._isAsking?"完成索取":"开始索取",this._display.canAskNumTxt.visible=!this._isAsking,this._display.txtBox1.visible=!this._isAsking,this._display.txtBox2.visible=this._isAsking;for(var o=1;9>=o;o++)this._display["clickBg"+o].alpha=0,this._display["clickBg"+o].on(Laya.Event.CLICK,this,this.addAskPic),this._display["deleteBtn"+o].on(Laya.Event.CLICK,this,this.delAskPic);this._display.askBtn.on(Laya.Event.CLICK,this,this.askBtnClickHandler),this._display.shareBtn.on(Laya.Event.CLICK,this,this.shareBtnClickHandler),this._display.page2.visible=!1}else this._display.canAskNumTxt.visible=!1,t.EventCenter.singleton.on("SEND_SUCCESS",this,this.sendSuccess),this._listAllArr=n.hasOwnProperty("ask_arr")?n.ask_arr:[],this._display.upClickMc.alpha=this._display.downClickMc.alpha=0,this._display.upClickMc.on(Laya.Event.MOUSE_DOWN,this,this.upMouseDownHandler),this._display.upClickMc.on(Laya.Event.MOUSE_UP,this,this.upMouseUpHandler),this._display.downClickMc.on(Laya.Event.MOUSE_DOWN,this,this.downMouseDownHandler),this._display.downClickMc.on(Laya.Event.MOUSE_UP,this,this.downMouseUpHandler),this._display.attrTab.on(Laya.Event.CHANGE,this,this.attrTabChange),this._display.page1.visible=!1,this._list=new laya.ui.List,this._list.vScrollBarSkin="ui/comp/vscroll.png",this._list.scrollBar.visible=!1,this._list.renderHandler=Handler.create(this,this.updateListItem,null,!1),this._list.itemRender=i,this._display.addChild(this._list),this._list.x=275,this._list.y=290,this._list.repeatX=1,this._list.repeatY=4,this._list.spaceX=0,this._list.spaceY=-3,this._list.height=344,this.setIndex(3);this.setPicNum(n.piece_arr);var r=n.hasOwnProperty("get_num")?Number(n.get_num):t.JointPicMainBox.nowGet,h=n.hasOwnProperty("give_num")?Number(n.give_num):t.JointPicMainBox.maxGet;this.setGetNum(r,h),0==t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF).facID&&(this._display.attrTab.getChildAt(1).visible=!1)}return __extends(s,e),s.prototype.updateListItem=function(t,e){e<=this._list.array.length-1&&t.doRender(this._list.array[e],e,this._aid,this._display.attrTab.selectedIndex)},s.prototype.setGetNum=function(e,i){t.JointPicMainBox.nowGet=e,t.JointPicMainBox.maxGet=i,this._display.canAskNumTxt.text="我的索取次数：0/"+(i-e)+" 捐献碎片可额外获取次数"},s.prototype.setPicNum=function(t){if(t)for(var e=0;e<t.length;e++){var i=t[e];this._display["numTxt"+i.id].text=String(i.num),this._display["askNumTxt"+i.id].text=String(i.get_num)+"/"+String(i.ask_num)}},s.prototype.addAskPic=function(e){if(this._isAsking)t.WeakTips.show("您目前正在索取状态中，请先完成索取");else{for(var i,s=Number(e.target.name.split("clickBg")[1]),n=0,a=1;9>=a;a++){var o=this._display["askNumTxt"+a].text.split("/"),r=Number(o[1]);n+=r,a==s&&(i=r)}if(n>=t.JointPicMainBox.maxGet-t.JointPicMainBox.nowGet)t.WeakTips.show("可索取数量已达上限");else{this._display["askNumTxt"+s].text="0/"+(i+1);var h=this._display.canAskNumTxt.text.split("我的索取次数：")[1],l=h.split("/"),c=Number(l[0]),d=Number(String(l[1]).split(" 捐献碎片可额外获取次数")[0]);this._display.canAskNumTxt.text="我的索取次数："+(c+1)+"/"+d+" 捐献碎片可额外获取次数"}}},s.prototype.delAskPic=function(e){if(this._isAsking)t.WeakTips.show("您目前正在索取状态中，请先完成索取");else{var i=Number(e.target.name.split("deleteBtn")[1]),s=this._display["askNumTxt"+i].text.split("/"),n=Number(s[1]);if(0==n)t.WeakTips.show("不能再减少了");else{this._display["askNumTxt"+i].text="0/"+(n-1);var a=this._display.canAskNumTxt.text.split("我的索取次数：")[1],o=a.split("/"),r=Number(o[0]),h=Number(String(o[1]).split(" 捐献碎片可额外获取次数")[0]);this._display.canAskNumTxt.text="我的索取次数："+(r-1)+"/"+h+" 捐献碎片可额外获取次数"}}},s.prototype.askBtnClickHandler=function(){if(this._isAsking)t.XHR().Post({cmd:"activity",aid:this._aid,sub:3,uid:t.Global.UID},this,this.comPleteAskHandler);else{for(var e=!1,i="",s=1;9>=s;s++){var n=Number(this._display["askNumTxt"+s].text.split("/")[1]);0!=n&&(e=!0),i+=String(n),9!=s&&(i+="|")}e?t.XHR().Post({cmd:"activity",aid:this._aid,sub:2,list:i,uid:t.Global.UID},this,this.doAskHandler):t.WeakTips.show("至少索取1个以上")}},s.prototype.doAskHandler=function(e){0==e.result?(this._isAsking=!0,this._display.askBtn.label="完成索取",this._display.canAskNumTxt.visible=!this._isAsking,this._display.txtBox1.visible=!this._isAsking,this._display.txtBox2.visible=this._isAsking,t.WeakTips.show("索取成功，请等待其他玩家赠送")):t.WeakTips.show("索取失败，"+e.msg)},s.prototype.comPleteAskHandler=function(e){if(0==e.result){this._isAsking=!1,this._display.askBtn.label="开始索取",this._display.canAskNumTxt.visible=!this._isAsking,this._display.txtBox1.visible=!this._isAsking,this._display.txtBox2.visible=this._isAsking;for(var i=1;9>=i;i++)this._display["askNumTxt"+i].text="0/0";var s=e.hasOwnProperty("get_num")?Number(e.get_num):t.JointPicMainBox.nowGet,n=e.hasOwnProperty("give_num")?Number(e.give_num):t.JointPicMainBox.maxGet;this.setGetNum(s,n);var a=!1;if(e.get_arr){var o=e.get_arr.length;a=!0;for(var i=0;o>i;i++){var r=e.get_arr[i],h=Number(r.id),l=Number(this._display["numTxt"+h].text);this._display["numTxt"+h].text=String(l+Number(r.num))}this.event("GET_SUCCESS",{getArr:e.get_arr}),this.showGetPicBox(e.get_arr,e.friend_json,e.faction_json)}a||t.WeakTips.show("没有索取到任何图片")}else t.WeakTips.show("完成索取失败，"+e.msg)},s.prototype.showGetPicBox=function(e,i,s){this._getBox||(this._getBox=new t.JointPicGetBox(e,i,s),this._getBox.on(t.ViewEvent.BASE_DESTROY,this,this.getBoxDestroy),this._getBox.show())},s.prototype.getBoxDestroy=function(){this._getBox&&(this._getBox.off(t.ViewEvent.BASE_DESTROY,this,this.getBoxDestroy),this._getBox=null)},s.prototype.upMouseDownHandler=function(){this._nowSelectIndex>1&&(this.goUp(),Laya.timer.loop(100,this,this.goUp))},s.prototype.upMouseUpHandler=function(){Laya.timer.clear(this,this.goUp)},s.prototype.goUp=function(){this._nowSelectIndex>1?this.setIndex(this._nowSelectIndex-1):Laya.timer.clear(this,this.goUp)},s.prototype.downMouseDownHandler=function(){this._nowSelectIndex<9&&(this.goDown(),Laya.timer.loop(100,this,this.goDown))},s.prototype.downMouseUpHandler=function(){Laya.timer.clear(this,this.goDown)},s.prototype.goDown=function(){this._nowSelectIndex<9?this.setIndex(this._nowSelectIndex+1):Laya.timer.clear(this,this.goDown)},s.prototype.setIndex=function(e){this._nowSelectIndex=e,this._display.num1.text=String(e-2),this._display.num2.text=String(e-1),this._display.num3.text=String(e-0),this._display.num4.text=String(e+1),this._display.num5.text=String(e+2),this._display.num1.visible=e>=3,this._display.num2.visible=e>=2,this._display.num4.visible=8>=e,this._display.num5.visible=7>=e,1==e?this._display.upPng.filters=t.FiltersUtils.getGreyFilters():this._display.upPng.filters=null,9==e?this._display.downPng.filters=t.FiltersUtils.getGreyFilters():this._display.downPng.filters=null,this.setListData()},s.prototype.attrTabChange=function(){t.XHR().Post({cmd:"activity",aid:this._aid,sub:4,type:this._display.attrTab.selectedIndex,uid:t.Global.UID},this,this.getSendDataHandler)},s.prototype.getSendDataHandler=function(e){0==e.result?(this._listAllArr=e.hasOwnProperty("ask_arr")?e.ask_arr:[],this.setListData()):(t.WeakTips.show("查询列表失败，"+e.msg),this._list.array=[])},s.prototype.setListData=function(){for(var t=[],e=this._listAllArr.length,i=0;e>i;i++)for(var s=this._listAllArr[i],n=s.ask_info.length,a=0;n>a;a++){var o=s.ask_info[a];if(Number(o.id)==this._nowSelectIndex){s.id=this._nowSelectIndex,s.num=Number(o.num),t.push(s);break}}this._list.array=t},s.prototype.sendSuccess=function(){this._display["numTxt"+this._nowSelectIndex].text=String(Number(this._display["numTxt"+this._nowSelectIndex].text)-1),this.event("SEND_SUCCESS",this._nowSelectIndex),t.JointPicMainBox.maxGet++,this.setGetNum(t.JointPicMainBox.nowGet,t.JointPicMainBox.maxGet)},s.prototype.shareBtnClickHandler=function(){t.ShareModule.shareMessage({title:["拼图求助"],desc:["本宝宝的拼图眼看就要完成啦~还缺几块想看看你这里有没有呐？咱们互换一下吧！"]},null)},s.prototype.destroy=function(){t.EventCenter.singleton.off("SEND_SUCCESS",this,this.sendSuccess),this._list&&(this._list.destroy(),this._list=null),this._listAllArr=null,Laya.timer.clear(this,this.goUp),Laya.timer.clear(this,this.goDown);for(var i=1;9>=i;i++)this._display["clickBg"+i].off(Laya.Event.CLICK,this,this.addAskPic),this._display["deleteBtn"+i].off(Laya.Event.CLICK,this,this.delAskPic);this._display.askBtn.off(Laya.Event.CLICK,this,this.askBtnClickHandler),this._display.shareBtn.off(Laya.Event.CLICK,this,this.shareBtnClickHandler),this._display.upClickMc.off(Laya.Event.MOUSE_DOWN,this,this.upMouseDownHandler),this._display.upClickMc.off(Laya.Event.MOUSE_UP,this,this.upMouseUpHandler),this._display.downClickMc.off(Laya.Event.MOUSE_DOWN,this,this.downMouseDownHandler),this._display.downClickMc.off(Laya.Event.MOUSE_UP,this,this.downMouseUpHandler),this._display.attrTab.off(Laya.Event.CHANGE,this,this.attrTabChange),e.prototype.destroy.call(this)},s}(t.BaseBox);t.JointPicUIBox=e;var i=function(e){function i(){e.call(this),this.sendBtn.on(Laya.Event.CLICK,this,this.doSend),this.playerInfo.headBg.on(Laya.Event.CLICK,this,this.headBgClickHandler),this.playerInfo.maleIcon.visible=!1,this.playerInfo.femaleIcon.visible=!1}return __extends(i,e),i.prototype.doRender=function(e,i,s,n){this._aid=s,this._type=n,this._memberObj=e,this.bg1.visible=i%2==0,this.bg2.visible=!this.bg1.visible,this.playerInfo.photo.loadImage(t.JSUtils.getHeadUrl(this._memberObj.head_url),0,0,82,82),1==Number(this._memberObj.sex)?(this.playerInfo.maleIcon.visible=!0,this.playerInfo.femaleIcon.visible=!1,this.playerInfo.defaultHead.skin="ui/main/male.png"):(this.playerInfo.maleIcon.visible=!1,this.playerInfo.femaleIcon.visible=!0,this.playerInfo.defaultHead.skin="ui/main/female.png"),this.nameTxt.text=this._memberObj.name,this.playerInfo.tfLvl.text=this._memberObj.level,this.playerInfo.tfVip.text=""+this._memberObj.vip_level,this.numPng.skin="ui/act/jointPicMain/"+e.id+".png",this.numTxt.text=e.num},i.prototype.headBgClickHandler=function(){t.Facade.callCommand(new t.UserInfoCommand(this._memberObj.uid))},i.prototype.doSend=function(){t.XHR().Post({cmd:"activity",aid:this._aid,sub:5,type:this._type,target:this._memberObj.uid,id:this._memberObj.id,uid:t.Global.UID},this,this.doSendHandler)},i.prototype.doSendHandler=function(e){0==e.result?(this.numTxt.text=String(Number(this.numTxt.text)-1),t.WeakTips.show("捐赠成功"),t.EventCenter.singleton.event("SEND_SUCCESS")):t.WeakTips.show("捐赠失败，"+e.msg)},i.prototype.destroy=function(){this._memberObj=null,this.sendBtn.off(Laya.Event.CLICK,this,this.doSend),this.playerInfo.headBg.off(Laya.Event.CLICK,this,this.headBgClickHandler),e.prototype.destroy.call(this)},i}(ui.act.JointPicSendItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(s){e.call(this,new ui.act.KaiXueUI),this._giftFlag=0,this._display=this.skin,this.aid=s,this._userModel=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),this._curDou=this._userModel.cash,this._display.giftList.itemRender=i,this._display.giftList.renderHandler=new Handler(this,this.onListRender),this._display.giftList.array=[],this._display.giftList.selectEnable=!1,this._display.giftList.hScrollBarSkin="ui/comp/vscroll.png",this._display.giftList.scrollBar.visible=!1,this._display.mainBtn.on(Laya.Event.CLICK,this,this.btnClick),this._userModel.on(t.ModelEvent.UPDATE_FINISH,this,this.onUserModelUpdate),this.load()}return __extends(s,e),s.prototype.load=function(){t.XHR().Post({file:"petpk",cmd:"activity",aid:this.aid,op:"query"},this,this.queryRet)},s.prototype.queryRet=function(e){this.destroyed||(0==e.result?e.actinfo&&(this._giftFlag=e.actinfo.recharge+e.actinfo.buy,this._display.giftList.array=e.actinfo.gifts,this.showBtn()):t.WeakTips.show(e.msg))},s.prototype.showBtn=function(){var e=["赶紧充值","预定礼包","已预定"];this._display.mainBtn.label=e[this._giftFlag],2==this._giftFlag&&t.Util.toGrayAndDisabled(this._display.mainBtn)},s.prototype.onListRender=function(t,e){t.setData(this._display.giftList.getItem(e),e,this.aid,this)},s.prototype.btnClick=function(){0==this._giftFlag?t.Facade.callCommand(new t.OpenVipBoxCommand(1)):1==this._giftFlag&&t.XHR().Post({cmd:"shop",subtype:"1",num:1,id:100057,price:60},this,this.buyRet)},s.prototype.buyRet=function(e){this.destroyed||(0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!0)),this.load()):t.WeakTips.show(e.msg))},s.prototype.onUserModelUpdate=function(){this._userModel.cash>this._curDou&&this.load()},s.prototype.destroy=function(){this._display.mainBtn.off(Laya.Event.CLICK,this,this.btnClick),e.prototype.destroy.call(this)},s}(t.BaseAct);t.KaiXue=e;var i=function(e){function i(){e.call(this),this._tipdesc=[],this._tipname=[]}return __extends(i,e),i.prototype.setData=function(e,i,s,n){this._data=e,this._aid=s,this._kaixueAct=n,this._dayIndex=i;var a="",o=["8.31-9.28","9.7-9.28","9.14-9.28","9.21-9.28"],r=[200,200,240,240];if(this.getTime.text="领取时间："+o[i],this.giftPrice.text="价值："+r[i],e.items&&e.items.length>0)for(var h=e.items,l=0;l<h.length;l++)2>l&&(this["goodsIcon"+l].skin=t.ResPath().getPic(h[l].icon,t.ResourcePath.PATH_GOODS),this._tipdesc[l]=h[l].goods_desc+"\n"+h[l].effect_desc,this._tipname[l]=h[l].name,a+=h[l].name+"x"+h[l].num+"\n");e.state=n._giftFlag<2?3:e.state,0==e.state?(this.getBtn.label="待领取",t.Util.enable(this.getBtn)):1==e.state?(this.getBtn.label="领  取",t.Util.enable(this.getBtn),this.getBtn.on(Laya.Event.CLICK,this,this.getGift)):2==e.state?(this.getBtn.label="已领取",t.Util.toGrayAndDisabled(this.getBtn)):(this.getBtn.label="未激活",t.Util.toGrayAndDisabled(this.getBtn)),2>i&&(this.iconbg0.x=56,this.iconbg1.x=56),this.giftDesc.text=a,this.goodsIcon0.on(Laya.Event.CLICK,this,this.showTips,[0]),this.goodsIcon1.on(Laya.Event.CLICK,this,this.showTips,[1])},i.prototype.showTips=function(e){var i,s={};i=this["goodsIcon"+e].localToGlobal(new laya.maths.Point(0,0)),s.name=this._tipname[e],s.desc=this._tipdesc[e],t.Tips.show(s,i)},i.prototype.giftRet=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).reload(),this._kaixueAct.load()):t.WeakTips.show(e.msg)},i.prototype.getGift=function(){t.XHR().Post({file:"petpk",cmd:"activity",aid:this._aid,op:"receive",gift_index:this._dayIndex},this,this.giftRet)},i.prototype.destroy=function(){this.getBtn.off(Laya.Event.CLICK,this,this.getGift),this.goodsIcon1.off(Laya.Event.CLICK,this,this.showTips),this.goodsIcon0.on(Laya.Event.CLICK,this,this.showTips,[0]),e.prototype.destroy.call(this)},i}(ui.act.KaiXueItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(s){e.call(this,new ui.act.LevelActUI),this._display=this.skin,this.aid=s,this._display.list.itemRender=i,this._display.list.scrollBar.visible=!1,this._display.list.scrollBar.elasticDistance=100,this._display.list.renderHandler=new Handler(this,this.onListRender),this._display.list.array=[],this._display.buyBtn.on(Laya.Event.CLICK,this,this.onClickBuy),t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"Get"},this,this.dataRet)}return __extends(s,e),s.prototype.destroy=function(){e.prototype.destroy.call(this)},s.prototype.dataRet=function(e){0!=e.result||this.destroyed?t.WeakTips.show(e.msg):(this._curData=e,this.updatePanel(e))},s.prototype.updatePanel=function(e){0==e.status?(this._display.buyBtn.filters=null,this._display.buyBtn.visible=!0):(this._display.buyBtn.visible=!1,this._display.buyBtn.filters=t.FiltersUtils.getGreyFilters()),e.levels.length>0&&(e.levels.sort(this.giftsListSort),this._display.list.array=e.levels)},s.prototype.giftsListSort=function(t,e){var i=t.status,s=e.status;if(2==i&&2!=s)return 1;if(2!=i&&2==s)return-1;var n=t.level,a=e.level;return n>a?1:a>n?-1:0},s.prototype.onListRender=function(t,e){t.setData(this._display.list.getItem(e),e,this.aid)},s.prototype.onClickBuy=function(){this._curData&&0==this._curData.status&&(t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL).vipLevel>=2?t.XHR().Post({cmd:"activity",aid:"12",subcmd:"Buy"},this,this.onBuyRet):t.WeakTips.show("您的达人等级不足"))},s.prototype.onBuyRet=function(e){0==e.result?(t.WeakTips.show("购买成功"),t.Facade.callCommand(new t.SyncChangeCmd(e,!1)),this.dataRet(e)):t.WeakTips.show(e.msg)},s}(t.BaseAct);t.LevelAct=e;var i=function(e){function i(){e.call(this),this.aid=0,this.cash.loadImage(t.ResPath().getPic("kDouBi",t.ResourcePath.PATH_GOODS),0,0,40,40),this.lingquBtn.on(Laya.Event.CLICK,this,this.onClickGet)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.setData=function(e,i,s){if(e)switch(this.aid=s,this._curData=e,1==e.level?this.content.text="购买成长金后可立即获得":this.content.text="达到"+e.level+"级后即可领取",this.moneyTxt.text=""+e.income,this.moneyTxt.x=this.content.x+this.content.textWidth+10,this.cash.x=this.moneyTxt.x+this.moneyTxt.textWidth,e.status){case 0:this.lingquBtn.filters=t.FiltersUtils.getGreyFilters(),this.lingquBtn.visible=!0,this.haveGetIcon.visible=!1;break;case 1:this.lingquBtn.filters=null,this.lingquBtn.visible=!0,this.haveGetIcon.visible=!1;break;case 2:this.lingquBtn.filters=null,this.lingquBtn.visible=!1,this.haveGetIcon.visible=!0}},i.prototype.onClickGet=function(){this._curData&&1==this._curData.status&&t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"GetGift",index:this._curData.index},this,this.getGiftRet)},i.prototype.getGiftRet=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!0)),this._curData.status=2,this.lingquBtn.filters=null,this.lingquBtn.visible=!1,this.haveGetIcon.visible=!0,t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).loadAct()):t.WeakTips.show(e.msg)},i}(ui.act.LevelActItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(t){e.call(this,new ui.act.ListenUI),this._giftFlag=!1,this._followFlag=!1,this._display=this.skin,this.aid=t,this._icons=[],this.init()}return __extends(s,e),s.prototype.init=function(){t.addListener(t.Sleep.Game_Visibilyty_Change,this,this.onSleep),this._display.getBtn.on(laya.events.Event.CLICK,this,this.getGift),this.loadInfo()},s.prototype.loadInfo=function(){t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"Get"},this,this.showAct)},s.prototype.showAct=function(e){0==e.result?(this._xhrRet=e,this.updateButton(),this.createIcon()):(t.WeakTips.show("查询活动信息失败，"+e.msg),this._display.mouseEnabled=!1)},s.prototype.onSleep=function(t){t&&this.loadInfo()},s.prototype.updateButton=function(){this._xhrRet&&0==this._xhrRet.result&&(0==this._xhrRet.flags?(this._display.img_red.visible=!1,this._display.getBtn.label="关注部落",this._display.getBtn.mouseEnabled=!0,this._display.getBtn.gray=!1):1==this._xhrRet.flags?(this._display.img_red.visible=!0,this._display.getBtn.label="领取奖励",this._display.getBtn.mouseEnabled=!0,this._display.getBtn.gray=!1):(this._display.img_red.visible=!1,this._display.getBtn.label="已领取",this._display.getBtn.mouseEnabled=!1,this._display.getBtn.gray=!0))},s.prototype.getGift=function(){1==this._xhrRet.flags?t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"GetGift"},this,this.getGiftBack):0==this._xhrRet.flags&&(window.mqq&&t.JSUtils.openQQBuluo(),(t.Global.isWB||t.Global.isTest)&&Laya.timer.once(3e3,this,this.scribe))},s.prototype.scribe=function(){t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"SubScribe"},this,this.loadInfo)},s.prototype.getGiftBack=function(e){this.destroyed||0!=e.result?t.WeakTips.show(e.msg):(t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0,"")),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).reload(),this.showAct(e))},s.prototype.createIcon=function(){if(!(this._icons.length>0)){var t=270,e=325,s=110;if(this._xhrRet&&this._xhrRet.award.items.length>0)for(var n=0;n<this._xhrRet.award.items.length;n++){var a=this._xhrRet.award.items[n],o=new i(a.icon_id,a.num);o.x=t+n*s,o.y=e,this._icons.push(o),this._display.addChild(o)}}},s.prototype.destroyIcon=function(){if(this._display&&this._icons)for(var t=0;t<this._icons.length;t++){var e=this._icons[t];this._display.removeChild(e),e.destroy()}},s.prototype.destroy=function(){t.removeListener(t.Sleep.Game_Visibilyty_Change,this,this.onSleep),this._display.getBtn.off(laya.events.Event.CLICK,this,this.getGift),this.destroyIcon(),this._xhrRet=null,this._display=null,e.prototype.destroy.call(this)},s}(t.BaseAct);t.ListenGift=e;var i=function(e){function i(i,s){e.call(this),this._icon=new Laya.Image,this._icon.skin=t.ResPath().getPic(i,t.ResourcePath.PATH_GOODS),this.addChild(this._icon),this._text=new Laya.Text,this._text.text=s+"",this._text.align="right",this._text.width=80,this._text.y=65,this._text.fontSize=20,this._text.bold=!0,this._text.color="#FFFFFF",this.addChild(this._text),this.skin="ui/act/listengift/bg_icon.png"}return __extends(i,e),i.prototype.destroy=function(){this.removeChild(this._icon),this.removeChild(this._text),this._icon.destroy(),this._text.destroy(),e.prototype.destroy.call(this)},i}(Laya.Image)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i){e.call(this,new ui.act.MonthCardUI),this._display=this.skin,this._display.progress.scrollRect=new Laya.Rectangle(0,0,245,34),this._userModel=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),this._curDou=this._userModel.cash,this.aid=i,this._userModel.on(t.ModelEvent.UPDATE_FINISH,this,this.onUserModelUpdate),t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"Get"},this,this.dataRet),this._display.on(Laya.Event.CLICK,this,this.onClick),this._topX={4:{x:14,gap:102},3:{x:14,gap:154},2:{x:14,gap:154},1:{x:14,gap:71}}}return __extends(i,e),i.prototype.destroy=function(){this._userModel.off(t.ModelEvent.UPDATE_FINISH,this,this.onUserModelUpdate),this._userModel=null,this._display=null,e.prototype.destroy.call(this)},i.prototype.onUserModelUpdate=function(){this._userModel.cash>this._curDou&&(t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"Get"},this,this.dataRet),this._curDou=this._userModel.cash)},i.prototype.onClick=function(e){switch(e.target.name){case"btn0_0":this.btnClick(0);break;case"btn0_1":t.XHR().Post({
cmd:"activity",aid:this.aid,subcmd:"Buy",index:this._curData.cards[0].index},this,this.buyRet);break;case"btn1_0":this.btnClick(1);break;case"btn1_1":t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"Buy",index:this._curData.cards[1].index},this,this.buyRet);break;case"cz_btn":t.Facade.callCommand(new t.OpenVipBoxCommand(1));break;case"ruleBtn":var i="<img src='ui/comp/icon.png'></img>1.单日累积充值达到200斗豆和500斗豆可分别激活超值月卡和至尊月卡的购买资格。<br><img src='ui/comp/icon.png'></img>2.超值月卡售价为200斗豆，至尊月卡售价为300斗豆。<br><img src='ui/comp/icon.png'></img>3.购买月卡后，可连续领取30天的月卡奖励，期间未领取的奖励不可补领，30天结束后，月卡到期。<br><img src='ui/comp/icon.png'></img>4.月卡不可累积购买，在前一个月卡到期后，将开放新的月卡购买。";t.RulePanel.showRule(i,"")}},i.prototype.btnClick=function(e){var i=this._curData.cards[e];0==i.status?t.Facade.callCommand(new t.OpenVipBoxCommand(1)):1==i.gift_status&&t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"GetGift",index:this._curData.cards[e].index},this,this.getGiftRet)},i.prototype.buyRet=function(e){0==e.result?(t.WeakTips.show("购买成功"),t.Facade.callCommand(new t.SyncChangeCmd(e,!1)),t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"Get"},this,this.dataRet)):t.WeakTips.show(e.msg)},i.prototype.getGiftRet=function(e){0==e.result?(t.WeakTips.show("领取成功"),t.Facade.callCommand(new t.SyncChangeCmd(e,!0)),this.dataRet(e),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).loadAct()):t.WeakTips.show(e.msg)},i.prototype.dataRet=function(e){0==e.result?(this._curData=e,this.updatePanel(e)):t.WeakTips.show(e.msg)},i.prototype.updatePanel=function(t){t.cards.sort(this.lisSortCompare);for(var e=0;2>e;e++)t.cards[e]&&this.updateGift(t.cards[e],e);var i=(t.cards[0]?t.cards[0].gift_cost:300,500),s=t.curCost>i?i:t.curCost;this._display.progress.scrollRect.width=245*(s/i),this._display.costTxt.text=t.curCost+"/"+i},i.prototype.lisSortCompare=function(t,e){var i=t.index,s=e.index;return i>s?1:s>i?-1:0},i.prototype.updateGift=function(e,i){switch(this._display["btn"+i+"_0"].visible=!1,this._display["btn"+i+"_1"].visible=!1,1==e.status?this._display["btn"+i+"_1"].visible=!0:this._display["btn"+i+"_0"].visible=!0,e.status){case 0:this._display["leaveTips"+i].text="充值"+e.gift_cost+"斗豆可购买",this._display["leaveTips"+i].visible=!0,this._display["btn"+i+"_0"].label="充  值";break;case 1:this._display["leaveTips"+i].text=e.gift_cost+"斗豆购买",this._display["leaveTips"+i].visible=!0}switch(e.gift_status){case 1:this._display["leaveTips"+i].text="剩余领取"+e.gift_left+"次",this._display["leaveTips"+i].visible=!0,this._display["btn"+i+"_0"].label="领  取";break;case 2:this._display["leaveTips"+i].text="剩余领取"+e.gift_left+"次",this._display["leaveTips"+i].visible=!0,this._display["btn"+i+"_0"].label="已领取",this._display["reddot"+i+"_0"].visible=!1,t.Util.toGrayAndDisabled(this._display["btn"+i+"_0"])}},i}(t.BaseAct);t.MonthCard=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(t){e.call(this,new ui.act.OutLetUI),this._giftFlag=!0,this._display=this.skin,this._display.outLetCon.itemRender=i,this._display.outLetCon.renderHandler=new Handler(this,this.onListRender),this._display.outLetCon.array=[],this._display.outLetCon.hScrollBarSkin="ui/comp/vscroll.png",this._display.outLetCon.scrollBar.visible=!1,this.aid=t,this.loadInfo()}return __extends(s,e),s.prototype.loadInfo=function(){t.XHR().Post({cmd:"activity",aid:this.aid},this,this.showAct)},s.prototype.showAct=function(t){0!=t.result||this.destroyed?this._display.outLetCon.array=t.goods:this._display.outLetCon.array=t.goods},s.prototype.onListRender=function(t,e){t.setData(this._display.outLetCon.getItem(e),e,this)},s.prototype.destroy=function(){this._display=null,e.prototype.destroy.call(this)},s}(t.BaseAct);t.OutLet=e;var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.destroy=function(){this.pricebtn.off(Laya.Event.CLICK,this,this.onClickGet),this.goodsIcon.off(Laya.Event.CLICK,this,this.showTips),e.prototype.destroy.call(this)},i.prototype.setData=function(e,i,s){if(e){this._outlet=s,this._curData=e,this.goods=e.items&&e.items[0]?e.items[0]:e;var n=this.goods.icon?this.goods.icon:100104;this.goodsIcon.skin=t.ResPath().getPic(n,t.ResourcePath.PATH_GOODS),this.goodsName.text=this.goods.name,this.goodsNum.text=this.goods.num,this.pricebtn.label=e.discount_price,this.Price.text="原价："+e.price,this.outlet.text="特价"+e.discount_price/e.price*10+"折",this.goodsIcon.on(Laya.Event.CLICK,this,this.showTips),1==e.state?this.pricebtn.on(Laya.Event.CLICK,this,this.onClickGet):(this.pricebtn.gray=!0,this.pricebtn.off(Laya.Event.CLICK,this,this.onClickGet)),this._um=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL)}},i.prototype.showTips=function(){var e,i={};e=this.localToGlobal(new laya.maths.Point(0,0)),i.name=this.goods.name,i.desc=this.goods.effect_desc,i.info=this.goods.goods_desc,t.Tips.show(i,e)},i.prototype.onClickGet=function(){this._curData.discount_price>this._um.doubi?t.WeakTips.show("当前斗豆不足，请确认后再试！"):t.XHR().Post({cmd:"activity",aid:this._outlet.aid,goods:this._curData.id},this,this.getGiftRet)},i.prototype.getGiftRet=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!0)),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).loadAct(),this._outlet.loadInfo()):t.WeakTips.show(e.msg)},i}(ui.act.OutLetListUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(t){e.call(this,new ui.act.PetGiftUI),this._display=this.skin,this.aid=t,this._lst=[];for(var s,n=0;6>n;n++)s=new i(this._display["item_"+n]),s.setVisible(!1),this._lst.push(s);this.query()}return __extends(s,e),s.prototype.query=function(){t.XHR().Post({file:"petpk",cmd:"activity",aid:this.aid,subcmd:"query"},this,this.dataRet)},s.prototype.dataRet=function(e){this.destroyed||(0==e.result?(this._data=e,this.updata()):t.WeakTips.show(e.msg))},s.prototype.updata=function(){for(var t,e=0;6>e;e++)t=this._lst[e],t.setData(this._data.gifts[e],e,this.aid,this),t.setVisible(!0)},s.prototype.destroy=function(){for(var t,i=0;6>i;i++)t=this._lst[i],t.destroy();t=null,this._lst=null,e.prototype.destroy.call(this)},s}(t.BaseAct);t.PetGift=e;var i=function(){function e(t){this._ui=t}return e.prototype.setData=function(e,i,s,n){this._data=e,this._aid=s,this._owner=n,this._index=i,this._ui.tfCount.text="剩余："+e.remain_num,this._ui.tfDesc.text="省："+(e.org_price-e.now_price)+"斗豆",this._ui.title.skin="ui/act/pet/"+i+".png",this._ui.title.x=(164-this._ui.title.width)/2;for(var a,o=[],r=0;r<e.award.items.length;r++)a=e.award.items[r],o.push({icon1:t.ResPath().getPic(a.icon_id,t.ResourcePath.PATH_GOODS),numTxt1:a.num?"x"+a.num:"x"+a.hours+"时"});this._ui.lst.array=o,this._ui.lst.x=(164-(54*o.length+o.length-1))/2,e.remain_num>0?(this._ui.getBtn.label="立即秒杀",t.Util.enable(this._ui.getBtn)):(this._ui.getBtn.label="已秒杀",t.Util.toGrayAndDisabled(this._ui.getBtn)),this._ui.getBtn.on(Laya.Event.CLICK,this,this.getGift)},e.prototype.setVisible=function(t){this._ui.visible=t},e.prototype.getGift=function(){t.XHR().Post({file:"petpk",cmd:"activity",aid:this._aid,subcmd:"buy",id:this._index,num:1},this,this.dataRet)},e.prototype.dataRet=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),this._owner.query(),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).reload()):t.WeakTips.show(e.msg)},e.prototype.destroy=function(){this._ui.getBtn.off(Laya.Event.CLICK,this,this.getGift),this._ui.destroy(),this._ui=null},e}()}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function a(t){e.call(this,new ui.act.PlanUI),this._currTab=-1,this._display=this.skin,this.aid=t,this._display.list.itemRender=i,this._display.list.renderHandler=new Handler(this,this.onListRender),this._display.list.array=[],this._display.list.scrollBar.hide=!0,this._display.list.selectEnable=!1,this._display.tabList.itemRender=s,this._display.tabList.selectEnable=!0,this._display.tabList.selectHandler=new Handler(this,this.onTabSelect),this._display.tabList.renderHandler=new Handler(this,this.onTabListRender),this._display.tabList.array=[],this._display.tabList2.itemRender=n,this._display.tabList2.selectEnable=!0,this._display.tabList2.selectHandler=new Handler(this,this.onTab2Select),this._display.tabList2.renderHandler=new Handler(this,this.onTab2ListRender),this._display.tabList2.array=[],this._dayIndex=0,this._tabIndex=0,this._display.btnPopup.on(Laya.Event.CLICK,this,this.popup),this.update()}return __extends(a,e),a.prototype.popup=function(){if(this._data){var e=new t.PlanPopup(7-this._data.day,this._leftTime,this.aid);e.show()}},a.prototype.update=function(){t.XHR().Post({cmd:"activity",aid:this.aid,sub:0},this,this.dataRet)},a.prototype.dataRet=function(e){if(!this.destroyed)if(0==e.result){this._data=e,this._display.imgDay.skin="ui/act/plan/num_"+(7-this._data.day)+".png";var i=0,s=0;this._dataArr=[];for(var n,a=0;a<this._data.day_arr.length;a++){n=this._data.day_arr[a],n.title="第"+this.getNumWord(n.day)+"天",n.progress=0,n.all=0,n.tabArr=[],n.flag=!1;for(var o,r,h=0;h<n.task_arr.length;h++)r=n.task_arr[h],s++,n.all++,0!=r.status&&(n.progress++,i++),o&&o.type==r.type||(o={},o.title=r.name,o.type=r.type,o.flag=!1,o.arr=[],n.tabArr.push(o)),0==r.status&&r.progress>=r.cond&&(o.flag=!0,n.flag=!0),o.arr.push(r);for(var l=0;l<n.tabArr.length;l++)n.tabArr[l].arr.sort(function(t,e){return t.status-e.status});this._dataArr.push(n)}this._progress=i,this._all=s,this.updateProgress();var c=t.ServerClock.getServerNowDate();c.getHours()<6?(c.setHours(6,0,0,0),this._leftTime=(c.getTime()-t.ServerClock.getServerNowDate().getTime())/1e3):(c.setHours(23,59,59,0),this._leftTime=(c.getTime()-t.ServerClock.getServerNowDate().getTime())/1e3+21600),this.checkTime(),Laya.timer.loop(1e3,this,this.checkTime),this.callLater(this.refresh)}else t.WeakTips.show(e.msg)},a.prototype.updateProgress=function(){this._display.tfJindu.text=this._progress+"/"+this._all,this._display.progressBar.width=165*this._progress/this._all},a.prototype.onTabSelect=function(t){this._tabIndex!=t&&(this._tabIndex=t,this.callLater(this.refresh))},a.prototype.onTab2Select=function(t){this._dayIndex!=t&&(this._dayIndex=t,this._tabIndex=0,this._display.tabList.selectedIndex=0,this.callLater(this.refresh))},a.prototype.refresh=function(){if(this._data&&!this.destroyed){this._display.tabList2.array=this._dataArr;var e=this._dataArr[this._dayIndex];this._display.tabList.array=e.tabArr,this._display.list.array=e.tabArr[this._tabIndex].arr,this._data.day<this._dayIndex+1?t.Util.toGrayAndDisabled(this._display.list):t.Util.enable(this._display.list)}},a.prototype.checkTime=function(){this._leftTime--,this._display.tfTime.text="天"+Math.floor(this._leftTime/3600)+"时"+Math.floor(this._leftTime%3600/60)+"分",0==this._leftTime&&(Laya.timer.clear(this,this.checkTime),this.update())},a.prototype.completeItem=function(t){this._progress++,this._dataArr[t].progress++,this._display.tabList2.array=this._dataArr;var e=this._dataArr[this._dayIndex],i=e.tabArr[this._tabIndex];i.arr.sort(function(t,e){return t.status-e.status}),i.flag=!1,e.flag=!1;for(var t=0;t<e.tabArr.length;t++)for(var s,n=e.tabArr[t],a=0;a<n.arr.length;a++)s=n.arr[t],0==s.status&&s.progress>=s.cond&&(n.flag=!0,e.flag=!0);this._display.tabList.array=e.tabArr,this._display.list.array=i.arr,this.updateProgress()},a.prototype.onTabListRender=function(t,e){t.setData(this._display.tabList.getItem(e),e,this._tabIndex,this._dayIndex<this._data.day)},a.prototype.onTab2ListRender=function(t,e){t.setData(this._display.tabList2.getItem(e),e,this._dayIndex,this._data.day)},a.prototype.onListRender=function(t,e){t.setData(this._display.list.getItem(e),e,this,this._dayIndex,this.aid)},a.prototype.getNumWord=function(t){return["","一","二","三","四","五","六","七"][t]},a.prototype.destroy=function(){Laya.timer.clear(this,this.checkTime),e.prototype.destroy.call(this)},a}(t.BaseAct);t.Plan=e;var i=function(e){function i(){e.call(this),this.aid=0}return __extends(i,e),i.prototype.setData=function(e,i,s,n,a){this._data=e,this._owner=s,this._dayIndex=n,this.aid=a,this.tfTitle.text=e.desc,this.tfCount.text=e.progress+"/"+e.cond,this.gou.visible=e.progress>=e.cond;for(var o,r=[],h=0;h<e.details.attrs.length;h++)o=e.details.attrs[h],r.push({goodsIcon:{skin:t.ResPath().getPic(o.id,t.ResourcePath.PATH_GOODS)},goodsNum:"x"+o.num});for(var h=0;h<e.details.items.length;h++)o=e.details.items[h],r.push({goodsIcon:{skin:t.ResPath().getPic(o.icon_id,t.ResourcePath.PATH_GOODS)},goodsNum:"x"+o.num});this.giftList.array=r,0!=e.status?(this.getBtn.label="已领取",t.Util.toGrayAndDisabled(this.getBtn)):e.progress>=e.cond?(this.getBtn.label="领 取",t.Util.enable(this.getBtn)):(this.getBtn.label="未完成",t.Util.toGrayAndDisabled(this.getBtn)),this.getBtn.on(Laya.Event.CLICK,this,this.getGift)},i.prototype.getGift=function(){t.XHR().Post({cmd:"activity",aid:this.aid,sub:2,taskid:this._data.id},this,function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).loadAct(),this._data.status=1,this.getBtn.label="已领取",t.Util.toGrayAndDisabled(this.getBtn),this._owner.completeItem(this._dayIndex)):t.WeakTips.show(e.msg)})},i}(ui.act.PlanItemUI),s=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.setData=function(t,e,i,s){this.tfName.text=t.title,this.tfName_s.text=t.title,e==i?(this.tab_s.visible=!0,this.tab_o.visible=!1):(this.tab_s.visible=!1,this.tab_o.visible=!0),this.redDot.visible=1==t.flag&&e!=i&&s},e}(ui.act.PlanTabItemUI),n=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.setData=function(t,e,i,s){var n=t.title+"("+t.progress+"/"+t.all+")";this.tfTitle.text=n,this.bg_s.visible=e==i,this.bg.visible=e!=i,t.progress>=t.all?this.tfTitle.color="#4bf448":this.tfTitle.color="#ffffff",this.lock.visible=e>=s,this.redDot.visible=1==t.flag&&i!=e&&s>e},e}(ui.act.PlanTabItem2UI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(t,s,n){e.call(this,new ui.act.PlanPopupUI,!0,!0),this.aid=0,this.display=this.skin,this.name="PlanPopup",this.aid=n,this._day=t,this._leftTime=s,this.setCloseButton(this.display.boxClose),this.display.lst.itemRender=i,this.display.lst.renderHandler=new Handler(this,this.onListRender),this.display.lst.array=[],this.display.lst.scrollBar.hide=!0,this.display.lst.selectEnable=!1,this.update(),this.checkTime(),Laya.timer.loop(1e3,this,this.checkTime)}return __extends(s,e),s.prototype.update=function(){t.XHR().Post({cmd:"activity",aid:this.aid,sub:1},this,this.dataRet)},s.prototype.dataRet=function(e){this.destroyed||(0==e.result?(this._data=e,this.display.tf1.text="当前进度："+e.progress+"/"+e.total_num,this.display.lst.array=e.target_arr):t.WeakTips.show(e.msg))},s.prototype.checkTime=function(){this._leftTime--,this.display.tf2.text="剩余时间："+this._day+"天"+Math.floor(this._leftTime/3600)+"时"+Math.floor(this._leftTime%3600/60)+"分",0==this._leftTime&&Laya.timer.clear(this,this.checkTime)},s.prototype.onListRender=function(t,e){t.setData(this.display.lst.getItem(e),e,this._data.progress,this.aid)},s.prototype.destroy=function(){Laya.timer.clear(this,this.checkTime),e.prototype.destroy.call(this)},s}(t.BaseBox);t.PlanPopup=e;var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.setData=function(e,i,s,n){this._data=e,this._index=i,this._aid=n,this.tfTitle.text="积分"+e.cond;for(var a,o=[],r=0;r<e.details.attrs.length;r++)a=e.details.attrs[r],o.push({goodsIcon:{skin:t.ResPath().getPic(a.id,t.ResourcePath.PATH_GOODS)},goodsNum:"x"+a.num});for(var r=0;r<e.details.items.length;r++)a=e.details.items[r],o.push({goodsIcon:{skin:t.ResPath().getPic(a.icon_id,t.ResourcePath.PATH_GOODS)},goodsNum:"x"+a.num});this.giftList.array=o,0!=e.status?(this.getBtn.label="已领取",t.Util.toGrayAndDisabled(this.getBtn)):s>=e.cond?(this.getBtn.label="领 取",t.Util.enable(this.getBtn)):(this.getBtn.label="未达成",t.Util.toGrayAndDisabled(this.getBtn)),this.getBtn.on(Laya.Event.CLICK,this,this.getGift)},i.prototype.getGift=function(){t.XHR().Post({cmd:"activity",aid:this._aid,sub:3,idx:this._index},this,function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).loadAct(),this._data.status=1,this.getBtn.label="已领取",t.Util.toGrayAndDisabled(this.getBtn)):t.WeakTips.show(e.msg)})},i}(ui.act.PlanPopItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(s){e.call(this,new ui.act.PumpkinUI),this.cfg=[{word:[0,1,2],gift:"gift_3",num:0},{word:[0,1],gift:"gift_2",num:0},{word:[0],gift:"gift_1",num:0},{word:[1],gift:"gift_1",num:0},{word:[2],gift:"gift_1",num:0}],this._display=this.skin,this.name="Pumpkin",this._aid=s,this._display.lst.renderHandler=Handler.create(this,this.updateItem,null,!1),this._display.lst.itemRender=i,this._display.lst.array=[],this._display.lst.scrollBar.visible=!1,this._display.on(Laya.Event.CLICK,this,this.closeTips),t.XHR().Post({file:"petpk",cmd:"activity",aid:this._aid,op:"viewinfo",uid:t.Global.UID},this,this.getDataHandler)}return __extends(s,e),s.prototype.getDataHandler=function(e){0==e.result?(this._data=e.data,this._gifts=e.gifts,this.update()):t.WeakTips.show("查询活动信息失败，"+e.msg)},s.prototype.update=function(){this._display.tfNum_0.text=this._data.words_num[0],this._display.tfNum_1.text=this._data.words_num[1],this._display.tfNum_2.text=this._data.words_num[2],this._display.tfStatistics.text=this._data.pk_fall_num+"/10";for(var t=0;t<this.cfg.length;t++)this.cfg[t].num=this._data.pkg_exchange_num[t];this._display.lst.array=this.cfg},s.prototype.updateItem=function(t,e){e<=this._display.lst.array.length-1&&t.doRender(this._display.lst.array[e],e,this,this._gifts[e],this._data.words_num)},s.prototype.setData=function(t){this._data=t.data,this.update()},s.prototype.closeTips=function(e){"imgGift"!=e.target.name&&t.Tips.tipsClose()},s.prototype.hideRedDot=function(){this.event("HIDE_RED")},s.prototype.destroy=function(){this._display.lst&&this._display.lst.destroy(),this._display.off(Laya.Event.CLICK,this,this.closeTips),t.Tips.tipsClose(),e.prototype.destroy.call(this)},s}(t.BaseBox);t.Pumpkin=e;var i=function(e){function i(){e.call(this),this.IDS=[100145,100146,100147],this.MAX_COUNT=25,this.cacheAs="bitmap",this.getBtn.on(Laya.Event.CLICK,this,this.getBtnClickHandler)}return __extends(i,e),i.prototype.doRender=function(e,i,s,n,a){this._data=e,this._index=i,this._owner=s,this._gift=n,this.imgGift.skin="ui/act/pumpkin/"+e.gift+".png",this.tfTip.text="兑换次数："+e.num+"/"+this.MAX_COUNT,i>=2&&(this.tfTip.text="兑换次数：无限制"),this.bg_1.visible=i%2!=0,this.bg_1.visible=i%2==0;for(var o=!0,r=0;r<e.word.length;r++)this["iconBg"+r].visible=!0,this["icon"+r].skin=t.ResPath().getPic(this.IDS[e.word[r]],t.ResourcePath.PATH_GOODS),a[e.word[r]]<=0&&(o=!1);this._canGet=o,e.num>=this.MAX_COUNT&&1>=i?t.Util.toGray(this.getBtn):(t.Util.enable(this.getBtn),this._canGet?this.getBtn.label="兑  换":this.getBtn.label="前  往");for(var r=e.word.length;3>r;r++)this["iconBg"+r].visible=!1,this["icon"+r].skin="";this.imgGift.on(Laya.Event.CLICK,this,this.clickTips)},i.prototype.clickTips=function(){var e,i={};e=this.imgGift.localToGlobal(new laya.maths.Point(-30,0));for(var s="",n=0;n<this._gift.award.items.length;n++)s+=this._gift.award.items[n].name+"x"+this._gift.award.items[n].num,n!=this._gift.award.items.length&&(s+="\n");i.name="有概率掉落以下物品：",i.desc=s,t.Tips.show(i,e)},i.prototype.getBtnClickHandler=function(){this._data.num>=this.MAX_COUNT&&this._index<=1?t.WeakTips.show("已达到兑换上限"):this._canGet?t.XHR().Post({file:"petpk",cmd:"activity",aid:this._owner._aid,op:"exchange",index:this._index,uid:t.Global.UID},this,this.getHandler):t.Facade.callCommand(new t.LilianCmd)},i.prototype.getHandler=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!0)),this._owner.setData(e),0==e.flag&&this._owner.hideRedDot()):t.WeakTips.show("领取失败，"+e.msg)},i.prototype.destroy=function(){this.imgGift.off(Laya.Event.CLICK,this,this.clickTips),this.getBtn.off(Laya.Event.CLICK,this,this.getBtnClickHandler),e.prototype.destroy.call(this)},i}(ui.act.PumpkinItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i){e.call(this,new ui.act.PunchUI),this._display=this.skin,this.aid=i,this._display.btnRecharge.on(Laya.Event.CLICK,this,this.onRecharge),this._display.lingquBtn.on(Laya.Event.CLICK,this,this.getGift),this._display.btnRecharge.visible=!1,this._display.lingquBtn.visible=!1,this._um=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL),this._um.on(t.ModelEvent.UPDATE_FINISH,this,this.userModelUpdate),this._cash=this._um.cash,this._display.tipsBox.visible=!1,this._display.weaponClickPng.alpha=0,this._display.weaponClickPng.on(Laya.Event.CLICK,this,this.showTips),this.update()}return __extends(i,e),i.prototype.showTips=function(){var e={};e.uptype=1,e.name="轩辕剑",e.desc="尊贵达人的专属武器。造型精美，威力不凡。\n必中！造成自身等级×8点额外伤害。",e.id=200018,t.Facade.callCommand(new t.ShowUpAnimationCMD(e))},i.prototype.destroy=function(){this._display.weaponClickPng.alpha=1,this._display.weaponClickPng.off(Laya.Event.CLICK,this,this.showTips),this._um&&(this._um.off(t.ModelEvent.UPDATE_FINISH,this,this.userModelUpdate),this._um=null),e.prototype.destroy.call(this)},i.prototype.userModelUpdate=function(){this._um&&(this._um.cash>this._cash&&this.update(),this._cash=this._um.cash)},i.prototype.update=function(){t.XHR().Post({cmd:"activity",aid:this.aid},this,this.dataRet)},i.prototype.dataRet=function(e){0==e.result?0==e.flag?(this._display.btnRecharge.visible=!0,this._display.lingquBtn.visible=!1):1==e.flag?(this._display.btnRecharge.visible=!1,this._display.lingquBtn.visible=!0,this._display.lingquBtn.filters=t.FiltersUtils.getGreyFilters(),this._display.lingquBtn.label="已领取"):(this._display.btnRecharge.visible=!1,this._display.lingquBtn.visible=!0,this._display.lingquBtn.filters=null,this._display.lingquBtn.label="领取奖励"):t.WeakTips.show(e.msg)},i.prototype.onRecharge=function(){t.Facade.callCommand(new t.OpenVipBoxCommand(1))},i.prototype.getGift=function(e){t.XHR().Post({cmd:"activity",aid:this.aid,op:"reward"},this,function(e){0==e.result?(this._display.lingquBtn.filters=t.FiltersUtils.getGreyFilters(),this._display.lingquBtn.label="已领取",t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0)),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).loadAct()):t.WeakTips.show(e.msg)})},i}(t.BaseAct);t.Punch=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(s){e.call(this,new ui.act.RecallUI),this.aid=35,this._display=this.skin,this._display.on(Laya.Event.CLICK,this,this.onClickPanel),this._display.bg.on(Laya.Event.CLICK,this,this.onClickPanel),t.addListener(i.RECALL_GIFT_TIPS,this,this.onClickGift),this._display.infoBox.visible=!1,t.XHR().Post({cmd:"activity",aid:this.aid,sub:"query"},this,this.onQuery)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),t.removeListener(i.RECALL_GIFT_TIPS,this,this.onClickGift)},i.prototype.onClickFlush=function(){t.XHR().Post({cmd:"activity",aid:this.aid,sub:"query"},this,this.onQuery)},i.prototype.onQuery=function(e){this.destroyed||0!=e.result?t.WeakTips.show(e.msg):(this._curData=e,this.update())},i.prototype.update=function(){this._display.numberTxt.text="我已召唤好友："+this._curData.succ_count+"/5",this._display.activeTxt.text="召唤活跃度："+this._curData.total_active+"/1000",this._display.leaveTime.text=t.DateUtils.subTime(-1,this._curData.endtime),this.updateFriend(),this.updateGoods()},i.prototype.updateFriend=function(){this._curData.friend_array&&this._curData.friend_array.length>0?(this._display.tips.visible=!1,this._display.flushBtn.gray=!1,this._display.flushBtn.on(Laya.Event.CLICK,this,this.onClickFlush)):(this._display.tips.visible=!0,this._display.flushBtn.gray=!0);for(var t=0;4>t;t++)this._curData.friend_array[t]?(this._display["player"+t].visible=!0,this._display["player"+t].update(this._curData.friend_array[t],this.aid)):this._display["player"+t].visible=!1},i.prototype.updateGoods=function(){for(var t=0;6>t;t++)this._curData.infos[t]?(this._display["goods"+t].visible=!0,this._display["goods"+t].update(this._curData.infos[t],this.aid,t)):this._display["goods"+t].visible=!1},i.prototype.onClickGift=function(e){if(e){this._display.infoBox.x=e.x,this._display.infoBox.y=e.y-204,this._display.infoBox.visible=!0;var i=new t.DecodeDataCmd(e);t.Facade.callCommand(i);for(var s,n=0;6>n;n++)s=i.rewardBoxArr[n],s?(this._display["item"+n].visible=!0,this._display["item"+n].text=s.name+"*"+s.num):this._display["item"+n].visible=!1}},i.prototype.onClickPanel=function(t){"gift"!=t.target.name&&(this._display.infoBox.visible=!1)},i.RECALL_GIFT_TIPS="RECALL_GIFT_TIPS",i}(t.BaseAct);t.Recall=e;var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.update=function(e,i){e&&(this.recallBtn.on(Laya.Event.CLICK,this,this.onClickRecall),this._aid=i,this._curData=e,this.tfLvl.text=e.level,this.nameTxt.text=e.name,this.photo.skin=t.JSUtils.getHeadUrl(e.headimg),this.recallBtn.gray=!1)},i.prototype.onClickRecall=function(){var e=this.getMsg();t.ShareModule.shareMessage({title:[e.title],desc:[e.content],share_type:0,urlParam:[{key:"recaller",value:t.Global.UID}],back:!0},Handler.create(this,this.onCallBack),0)},i.prototype.getMsg=function(){var t=Math.ceil(3*Math.random());return 1>=t?{title:"许久不见，甚是想念",content:"自离别起已有时日，世事变迁望君归来一看~"}:2>=t?{title:"薄情寡义郎",content:"你这个薄情寡义郎，就这么抛弃本宝宝，你的良心不会痛嘛？！"}:{title:"约不约",content:"来啊，快活啊，反正有大把时光~"}},i.prototype.onCallBack=function(e){0!=e.retCode&&0!=e.iRet||(this.recallBtn.off(Laya.Event.CLICK,this,this.onClickRecall),this.recallBtn.gray=!0,t.XHR().Post({cmd:"activity",aid:this._aid,sub:"recall",target:this._curData.uid},this,null))},i}(ui.act.RecallPlayerItemUI);t.RecallPlayerItem=i;var s=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.update=function(e,i,s){e&&(this._aid=i,this._curData=e,this._index=s,0==e.flag?(this.getBtn.gray=!0,this.hasGetIcon.visible=!1):1==e.flag?(this.getBtn.gray=!1,this.hasGetIcon.visible=!1,this.getBtn.on(Laya.Event.CLICK,this,this.onClickGet)):(this.getBtn.gray=!0,this.hasGetIcon.visible=!0),this._index<3?(this.icon.skin=t.ResPath().getPic(e.items.items[0].icon_id,t.ResourcePath.PATH_GOODS),this.numTxt.text="X"+e.items.items[0].num):(this.icon.skin=t.ResPath().getPic("gift"+this._index,t.ResourcePath.PATH_GOODS),this.numTxt.visible=!1,this.icon.on(Laya.Event.CLICK,this,this.onClickIcon)))},s.prototype.onClickGet=function(){t.XHR().Post({cmd:"activity",aid:this._aid,sub:"get_gift",idx:this._curData.idx},this,this.onGetGiftRet)},s.prototype.onGetGiftRet=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!0)),this.getBtn.off(Laya.Event.CLICK,this,this.onClickGet),this.hasGetIcon.visible=!0,this.getBtn.gray=!0):t.WeakTips.show(e.msg)},s.prototype.onClickIcon=function(){this._curData&&(this._curData.items.x=this.x,this._curData.items.y=this.y,t.dispatch(e.RECALL_GIFT_TIPS,this._curData.items))},s}(ui.act.RecallGoodsItemUI);t.RecallGoodsItem=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i){e.call(this,new ui.act.RechageUI),this._display=this.skin,this._display.goBtn.on(Laya.Event.CLICK,this,this.go),this._aid=i,t.XHR().Post({cmd:"activity",aid:50},this,this.dataRet)}return __extends(i,e),i.prototype.dataRet=function(e){0==e.result?0==e.status:t.WeakTips.show(e.msg)},i.prototype.go=function(){var e=new t.RechargeBox;e.show()},i.prototype.destroy=function(){this._display.goBtn.off(Laya.Event.CLICK,this,this.go),e.prototype.destroy.call(this)},i}(t.BaseAct);t.RechargeAct=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(s){e.call(this,new ui.act.SWShopUI),this.canbuy=[],this._display=this.skin,this.aid=s,this._actModel=t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL),this.init(),this._display.cacheAs="bitmap",this._display.reCache(),this._display.goodsList.hScrollBarSkin="ui/comp/vscroll.png",this._display.goodsList.scrollBar.visible=!1,this._display.goodsList.itemRender=i,this._display.goodsList.renderHandler=new Handler(this,this.onListRender),this._display.goodsList.array=[],this._display.goodsList.selectEnable=!1}return __extends(s,e),s.prototype.init=function(){t.XHR().Post({file:"petpk",cmd:"shop",actid:this.aid},this,this.dataRet)},s.prototype.destroy=function(){t.Tips.tipsClose(),e.prototype.destroy.call(this)},s.prototype.dataRet=function(e){if(0!=e.result||this.destroyed)t.WeakTips.show(e.msg);else{this._curData=e;var i=e.commodity_info,s=this._actModel.GetActById(this.aid),n=t.DateUtils.getTimeFomateObj(s.last_seconds);this._display.leftDay.text=n.day,this._display.leftHour.text=n.hour,this._display.goodsList.array=i}},s.prototype.onListRender=function(t,e){t.setData(this._display.goodsList.getItem(e),e,this.aid,this)},s}(t.BaseAct);t.SwShop=e;var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.setData=function(e,i,s,n){this._data=e,this._swhop=n,this.Icon1.skin=t.ResPath().getPic(e.iconId,t.ResourcePath.PATH_GOODS),parseInt(e.price)>parseInt(e.act_price)?(this.price1.text="原价："+e.price,this.price2.text="折后："+e.act_price,this.giftName.text="折扣礼包",this.cornerText.text="折扣",this.price1.visible=!0):(this.price2.text="售价："+e.price,this.price1.visible=!1,this.giftName.text="限量礼包",this.cornerText.text="限量"),this.limitnum1.text="每日限购："+e.remain,0==e.remain&&(t.Util.toGrayAndDisabled(this.buyBtn1),t.Util.toGrayAndDisabled(this.buyBtn2)),this.buyBtn1.on(Laya.Event.CLICK,this,this.onClickGet,[1]),this.buyBtn2.on(Laya.Event.CLICK,this,this.onClickGet,[10]),this.Icon1.on(Laya.Event.CLICK,this,this.clickTips)},i.prototype.clickTips=function(){var e,i={};e=this.Icon1.localToGlobal(new laya.maths.Point(0,0)),i.name=this._data.name,i.desc=this._data.goods_des,i.info=this._data.goods_effect,t.Tips.show(i,e)},i.prototype.onClickGet=function(e){void 0===e&&(e=0);var i=this._data,s=i.act_price*e;t.XHR().Post({cmd:"shop",subtype:1,num:e,id:i.id,price:s},this,this.getGiftRet)},i.prototype.getGiftRet=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!0)),this._swhop.init()):t.WeakTips.show(e.msg)},i.prototype.destroy=function(){this.buyBtn1.off(Laya.Event.CLICK,this,this.onClickGet),this.buyBtn2.off(Laya.Event.CLICK,this,this.onClickGet),this.Icon1.off(Laya.Event.CLICK,this,this.clickTips),e.prototype.destroy.call(this)},i}(ui.act.SWItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){
this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,new ui.act.Tehui_2017Double11UI),this._display=this.skin,this.aid=t,this._display.oriPriceTxt1.visible=this._display.zhekouTxt1.visible=this._display.priceTxt1.visible=!1,this._display.oriDoudou1.visible=this._display.doudou1.visible=this._display.remainCountTxt1.visible=!1,this._display.oriPriceTxt2.visible=this._display.zhekouTxt2.visible=this._display.priceTxt2.visible=!1,this._display.oriDoudou2.visible=this._display.doudou2.visible=this._display.remainCountTxt2.visible=!1,this._display.buyBtn1.on(Laya.Event.CLICK,this,this.buyBtn1ClickHandler),this._display.buyBtn2.on(Laya.Event.CLICK,this,this.buyBtn2ClickHandler),this.hideAllPng(),this._display.attrTab.selectHandler=new Handler(this,this.tabChange),this.query()}return __extends(i,e),i.prototype.tabChange=function(){this.hideAllPng(),this._display["png"+(this._display.attrTab.selectedIndex+1)+"_1"].visible=!0,this._display["png"+(this._display.attrTab.selectedIndex+1)+"_2"].visible=!0;var e=[this._packets[2*this._display.attrTab.selectedIndex],this._packets[2*this._display.attrTab.selectedIndex+1]];this._display.icon1_1.skin=this._display.icon1_2.skin=this._display.icon2_1.skin=this._display.icon2_2.skin="",this._display.iconBg1_1.visible=this._display.iconBg1_2.visible=this._display.iconBg2_1.visible=this._display.iconBg2_2.visible=!1;for(var i=1;2>=i;i++){var s=e[i-1];this._display["oriPriceTxt"+i].text="原价："+s.price,this._display["priceTxt"+i].text="抢购价："+s.discount_price,this._display["zhekouTxt"+i].text="折扣："+Math.round(10*Number(s.discount_price)/Number(s.price)),this["_cayBuyNum"+i]=Number(s.limitnum)-Number(s.buynum),this._display["remainCountTxt"+i].text="（剩余："+this["_cayBuyNum"+i]+"）";for(var n,a=0,o=0;o<s.detail.attrs.length&&(a++,!(a>2));o++)n=s.detail.attrs[o],this._display["icon"+i+"_"+a].visible=!0,this._display["iconBg"+i+"_"+a].visible=!0,this._display["icon"+i+"_"+a].skin=t.ResPath().getPic(n.id,t.ResourcePath.PATH_GOODS),this._display["numTxt"+i+"_"+a].text=n.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.desc,t.Tips.show(n,e)})}(a,n,this._display["icon"+i+"_"+a]);for(var r,h=0;h<s.detail.items.length&&(a++,!(a>2));h++)r=s.detail.items[h],this._display["icon"+i+"_"+a].visible=!0,this._display["iconBg"+i+"_"+a].visible=!0,this._display["icon"+i+"_"+a].skin=t.ResPath().getPic(r.icon_id,t.ResourcePath.PATH_GOODS),this._display["numTxt"+i+"_"+a].text=r.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.goods_desc,n.info=i.effect_desc,t.Tips.show(n,e)})}(a,r,this._display["icon"+i+"_"+a])}this._display.attrTab.selectedIndex==this._curday-1?(this._display.buyBtn1.filters=this._cayBuyNum1>0?null:t.FiltersUtils.getGreyFilters(),this._display.buyBtn2.filters=this._cayBuyNum2>0?null:t.FiltersUtils.getGreyFilters()):(this._display.buyBtn1.filters=t.FiltersUtils.getGreyFilters(),this._display.buyBtn2.filters=t.FiltersUtils.getGreyFilters())},i.prototype.query=function(){t.XHR().Post({cmd:"activity",aid:this.aid},this,this.queryHandler)},i.prototype.queryHandler=function(e){if(0==e.result){this._display.oriPriceTxt1.visible=this._display.zhekouTxt1.visible=this._display.priceTxt1.visible=!0,this._display.oriDoudou1.visible=this._display.doudou1.visible=this._display.remainCountTxt1.visible=!0,this._display.oriPriceTxt2.visible=this._display.zhekouTxt2.visible=this._display.priceTxt2.visible=!0,this._display.oriDoudou2.visible=this._display.doudou2.visible=this._display.remainCountTxt2.visible=!0,this._packets=e.packets,this._dayNowBuy=Number(e.daynum),this._dayMaxBuy=Number(e.daymax),this._display.todayBuyCountTxt.text="今日购买数量："+this._dayNowBuy+"/"+this._dayMaxBuy,this._display.msgTxt.text="抢购精华只能使用斗豆购买，每人每天限购"+e.daymax+"个",this._curday=Number(e.curday);var i=this._display.attrTab.selectedIndex;this._display.attrTab.selectedIndex=this._curday-1,i==this._display.attrTab.selectedIndex&&this.tabChange();var s=0==Number(e.goodschange)?"存量":"礼包";this._display.refreshTimeTxt.on(t.TimeTextControl.TIME_UP,this,this.refreshTimeUp),t.TimeTextControl.setTimeText(this._display.refreshTimeTxt,Number(e.seconds)+1,"HH:NN:SS秒后刷新"+s)}else t.WeakTips.show("查询活动失败，"+e.msg)},i.prototype.refreshTimeUp=function(){this.query()},i.prototype.buyBtn1ClickHandler=function(){this._display.buyBtn1.filters&&this._display.buyBtn1.filters.length>0?this._display.attrTab.selectedIndex==this._curday-1?t.WeakTips.show("该礼包已售空"):t.WeakTips.show("该礼包目前不在时间范围内"):this._dayNowBuy==this._dayMaxBuy?t.WeakTips.show("您今日购买数量已达上限"):(this._buyIndex=1,t.XHR().Post({cmd:"activity",aid:this.aid,op:"buy",idx:this._buyIndex},this,this.buyHandler))},i.prototype.buyBtn2ClickHandler=function(){this._display.buyBtn2.filters&&this._display.buyBtn2.filters.length>0?this._display.attrTab.selectedIndex==this._curday-1?t.WeakTips.show("该礼包已售空"):t.WeakTips.show("该礼包目前不在时间范围内"):this._dayNowBuy==this._dayMaxBuy?t.WeakTips.show("您今日购买数量已达上限"):(this._buyIndex=2,t.XHR().Post({cmd:"activity",aid:this.aid,op:"buy",idx:this._buyIndex},this,this.buyHandler))},i.prototype.buyHandler=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0)),this._dayNowBuy++,this._display.todayBuyCountTxt.text="今日购买数量："+this._dayNowBuy+"/"+this._dayMaxBuy):t.WeakTips.show("购买失败，"+e.msg),this.query()},i.prototype.hideAllPng=function(){this._display.png1_1.visible=this._display.png2_1.visible=this._display.png3_1.visible=this._display.png4_1.visible=!1,this._display.png1_2.visible=this._display.png2_2.visible=this._display.png3_2.visible=this._display.png4_2.visible=!1},i.prototype.destroy=function(){this._display.buyBtn1.off(Laya.Event.CLICK,this,this.buyBtn1ClickHandler),this._display.buyBtn2.off(Laya.Event.CLICK,this,this.buyBtn2ClickHandler),this._display.refreshTimeTxt.off(t.TimeTextControl.TIME_UP,this,this.refreshTimeUp),t.TimeTextControl.removeTimeText(this._display.refreshTimeTxt),this._packets=null,e.prototype.destroy.call(this)},i}(t.BaseAct);t.Tehui2017Double11=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.utils.Tween,i=laya.utils.Ease,s=function(s){function n(e){s.call(this,new ui.act.TurnTableUI),this._djPath="assets/skeleton/turntable/hj.sk",this.count=0,this.index=1,this.NUMS=[1000131,1000141,1000132,10012020,1000065],this._display=this.skin,this.aid=e,this._display.turnBtn.on(Laya.Event.CLICK,this,this.turn),this._sk1=new t.AnimationSKe(this._djPath,1),this._sk2=new t.AnimationSKe(this._djPath,1),this._sk3=new t.AnimationSKe(this._djPath,1),this._display.addChild(this._sk1),this._sk1.x=257,this._sk1.y=253,this._sk1.play(0,!0),this._sk1.paused(),this._display.addChild(this._sk2),this._sk2.x=259,this._sk2.y=250,this._sk2.play(1,!0),this._sk2.paused(),this._sk3.x=359,this._sk3.y=450,this._sk3.play(2,!0),this._sk3.paused(),t.XHR().Post({cmd:"activity",aid:this.aid,sub:0},this,this.queryRet)}return __extends(n,s),n.prototype.queryRet=function(t){this.destroyed||(this._keynum=t.keynum,this._display.tfTimes.text=t.daynum+"/6",this._display.tfCount.text=""+this._keynum)},n.prototype.turn=function(){this._sk3.removeSelf(),this._sk3.paused(),this._display.turnBtn.mouseEnabled=!1,t.XHR().Post({cmd:"activity",aid:this.aid,sub:1},this,this.turnRet)},n.prototype.turnRet=function(e){if(!this.destroyed)if(0==e.result){this._data=e,this._keynum--,this._display.tfCount.text=""+this._keynum,t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).loadAct();var i=Number(String(e.award.items[0].id)+String(e.award.items[0].num));this.index=this.NUMS.indexOf(i),this.startTurn()}else t.WeakTips.show(e.msg),this._display.turnBtn.mouseEnabled=!0},n.prototype.startTurn=function(t){void 0===t&&(t=0),this._sk2.play(1,!1,!0,0),this._sk2.on(Laya.Event.STOPPED,this,this.turnPrase1End),Laya.timer.once(1e3,this,this.turnPrase2)},n.prototype.turnPrase1End=function(){this._sk2.play(1,!1),this._sk2.paused()},n.prototype.turnPrase2=function(){this.count++;var t=-(20+72*this.index+1440*this.count);e.to(this._display.table,{rotation:t},6e3,i.expoOut,new Handler(this,this.turnPrase3));this._sk1.resume()},n.prototype.turnPrase3=function(){this._sk1.paused(),this._sk3.play(2,!1),this._display.addChild(this._sk3),this._sk3.on(Laya.Event.STOPPED,this,this.turnEnd),this.sync(),this._display.turnBtn.mouseEnabled=!0},n.prototype.sync=function(){this._data&&(t.Facade.callCommand(new t.SyncChangeCmd(this._data)),this._data=null)},n.prototype.turnEnd=function(){this._sk3.removeSelf(),this._sk3.paused()},n.prototype.destroy=function(){this._sk1&&(this._sk1.destroy(),this._sk1=null),this._sk2&&(this._sk2.off(Laya.Event.STOPPED,this,this.turnPrase2),this._sk2.destroy(),this._sk2=null),this._sk3&&(this._sk3.off(Laya.Event.STOPPED,this,this.turnEnd),this._sk3.destroy(),this._sk3=null),this.tween&&this.tween.clear(),this.sync(),Laya.timer.clear(this,this.turnPrase2),s.prototype.destroy.call(this)},n}(t.BaseAct);t.TurnTable=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i){e.call(this,new ui.act.TurnTable_2017_11UI),this._needNum1=5,this._needNum2=20,this._needNum3=60,this._needNum4=120,this._needNum5=180,this._display=this.skin,this.cacheAs="none",this._display.mainLayer.cacheAs="bitmap",this.aid=i,this._nowIndex=1,this._display.tipsBox.visible=!1;for(var s=1;5>=s;s++)this._display["hasGet"+s].visible=!1,this._display["png"+s].on(Laya.Event.CLICK,this,this.pngClickHandler);for(var n=1;10>=n;n++)this._display["icon"+n].on(Laya.Event.CLICK,this,this.iconClickHandler);this._display.buyBtn1.on(Laya.Event.CLICK,this,this.butBtn1ClickHandler),this._display.buyBtn2.on(Laya.Event.CLICK,this,this.butBtn2ClickHandler),this.skeleton_light=new t.AnimationSKe("assets/skeleton/act/turnTable_2017_11/skeleton.sk"),this._display.sp.addChild(this.skeleton_light),this.skeleton_light.x=273,this.skeleton_light.y=604,this.skeleton_light.visible=!1,this.query()}return __extends(i,e),i.prototype.query=function(){t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"query"},this,this.queryHandler)},i.prototype.queryHandler=function(e){if(0==e.result){this._data=e,this._lotteryNum=Number(e.lottery_num),this._display.numTxt.text=this._lotteryNum+"",this.setPngStatus();for(var i=0;i<e.lottery_gifts.length;i++){var s=e.lottery_gifts[i];if(s.hasOwnProperty("items")&&s.items.length>0){var n=s.items[0];this._display["icon"+(i+1)].skin=t.ResPath().getPic(n.id,t.ResourcePath.PATH_GOODS),n.id>=200001&&n.id<=4e5?this._display["numTxt"+(i+1)].text=t.DateUtils.getStrByHours(n.hours):this._display["numTxt"+(i+1)].text="×"+n.num}else this._display["icon"+(i+1)].skin=t.ResPath().getPic(s.attrs[0].id,t.ResourcePath.PATH_GOODS),this._display["numTxt"+(i+1)].text="×"+s.attrs[0].num}}else t.WeakTips.show("查询活动失败，"+e.msg)},i.prototype.setPngStatus=function(){for(var e=0;e<this._data.extra_flags.length;e++){var i=Number(this._data.extra_flags[e]);2==i?(this._display["hasGet"+(e+1)].visible=!0,this._display["png"+(e+1)].filters=t.FiltersUtils.getGreyFilters()):this._lotteryNum>=this["_needNum"+(e+1)]?this._display["png"+(e+1)].filters=null:this._display["png"+(e+1)].filters=t.FiltersUtils.getGreyFilters()}},i.prototype.pngClickHandler=function(e){this._pngIndex=Number(e.target.name.split("png")[1]),Laya.timer.clear(this,this.hideTips),this._display.tipsBox.visible=!0,this._display.tipsBox.x=645,this._display.tipsBox.y=e.target.y+30;var i="",s=this._data.extra_gifts[this._pngIndex-1];if(s.hasOwnProperty("attrs")&&s.attrs.length>0)for(var n=0;n<s.attrs.length;n++){var a=s.attrs[n];i+=a.name+"×"+a.num+"\n"}if(s.hasOwnProperty("items")&&s.items.length>0)for(var o=0;o<s.items.length;o++){var a=s.items[o];i+=a.name+"×"+a.num+"\n"}this._display.tipsMsg.text=i,this._display.tipsBox.height=this._display.tipsMsg.textHeight+3;var r=this._display.tipsBox.localToGlobal(new laya.maths.Point(0,0));r.y-t.LayerMgr.offY+this._display.tipsBox.height>t.LayerMgr.height+t.LayerMgr.offY&&(this._display.tipsBox.y-=r.y-t.LayerMgr.offY+this._display.tipsBox.height-(t.LayerMgr.height+t.LayerMgr.offY)),Laya.timer.once(4e3,this,this.hideTips),0!=this._display["hasGet"+this._pngIndex].visible||null!=this._display["png"+this._pngIndex].filters&&0!=this._display["png"+this._pngIndex].filters.length||t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"get_gifts",id:this._pngIndex-1},this,this.getGiftHandler)},i.prototype.getGiftHandler=function(e){0==e.result?(this._display["hasGet"+this._pngIndex].visible=!0,this._display["png"+this._pngIndex].filters=t.FiltersUtils.getGreyFilters(),this._data.extra_flags[this._pngIndex-1]=2,t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0))):t.WeakTips.show("领取失败，"+e.msg)},i.prototype.iconClickHandler=function(e){var i=Number(e.target.name.split("icon")[1]);Laya.timer.clear(this,this.hideTips),this._display.tipsBox.visible=!0,this._display.tipsBox.x=e.target.x+30,this._display.tipsBox.y=e.target.y+50;var s="",n=this._data.lottery_gifts[i-1];if(n.hasOwnProperty("items")&&n.items.length>0){var a=this._data.lottery_gifts[i-1].items[0];s+=a.id>=200001&&a.id<=4e5?a.name+"×"+t.DateUtils.getStrByHours(a.hours)+"\n":a.name+"×"+a.num+"\n"}else{var o=this._data.lottery_gifts[i-1].attrs[0];s+=o.name+"×"+o.num+"\n"}this._display.tipsMsg.text=s,this._display.tipsBox.height=this._display.tipsMsg.textHeight+3;var r=this._display.tipsBox.localToGlobal(new laya.maths.Point(0,0));r.y-t.LayerMgr.offY+this._display.tipsBox.height>t.LayerMgr.height+t.LayerMgr.offY&&(this._display.tipsBox.y-=r.y-t.LayerMgr.offY+this._display.tipsBox.height-(t.LayerMgr.height+t.LayerMgr.offY)),Laya.timer.once(4e3,this,this.hideTips)},i.prototype.hideTips=function(){this._display.tipsBox.visible=!1},i.prototype.butBtn1ClickHandler=function(){null!=this._display.buyBtn1.filters&&0!=this._display.buyBtn1.filters.length||t.PayConfirm.checkDouYu(100,Handler.create(this,this.lottery1))},i.prototype.lottery1=function(){this._lotteryType=0,this._display.buyBtn1.filters=t.FiltersUtils.getGreyFilters(),this._display.buyBtn2.filters=t.FiltersUtils.getGreyFilters(),t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"draw_lott",id:this._lotteryType},this,this.lotteryHandler)},i.prototype.butBtn2ClickHandler=function(){null!=this._display.buyBtn2.filters&&0!=this._display.buyBtn2.filters.length||t.PayConfirm.checkDouYu(450,Handler.create(this,this.lottery5))},i.prototype.lottery5=function(){this._lotteryType=1,this._display.buyBtn1.filters=t.FiltersUtils.getGreyFilters(),this._display.buyBtn2.filters=t.FiltersUtils.getGreyFilters(),t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"draw_lott",id:this._lotteryType},this,this.lotteryHandler)},i.prototype.lotteryHandler=function(e){0==e.result?(this._rewardData=e,this.desIndex=this._rewardData.lott_id[0]):(this._display.buyBtn1.filters=null,this._display.buyBtn2.filters=null,t.WeakTips.show("操作失败，"+e.msg))},i.prototype.showRewardBox=function(e){if(this._rewardData){var i=new t.SyncChangeCmd(this._rewardData,!1,!1),s=[1,5],n=[100,450];t.Facade.callCommand(i),this._rewardBox||(this._rewardBox=new t.ShowRewardBoxNew("",i.rewardBoxArr,null,e,n[this._lotteryType],"再抽"+s[this._lotteryType]+"次"),this._rewardBox.on(t.ViewEvent.BASE_DESTROY,this,this.rewardBoxDestroy),this._rewardBox.on("AGAIN",this,this.againHandler),this._rewardBox.show()),this._rewardData=null}},i.prototype.againHandler=function(){0==this._lotteryType?t.PayConfirm.checkDouYu(100,Handler.create(this,this.lottery1)):t.PayConfirm.checkDouYu(450,Handler.create(this,this.lottery5)),this._rewardBox&&this._rewardBox.destroy()},i.prototype.rewardBoxDestroy=function(){this._rewardBox&&(this._rewardBox.off(t.ViewEvent.BASE_DESTROY,this,this.rewardBoxDestroy),this._rewardBox.off("AGAIN",this,this.againHandler),this._rewardBox=null)},Object.defineProperty(i.prototype,"desIndex",{set:function(t){this._timeNum=0,this._turnStatus=1,this._desIndex=t,this._preDesIndex=this._desIndex+5,this._preDesIndex>10&&(this._preDesIndex-=10),console.log(this._timeNum,this._turnStatus,this._desIndex,this._preDesIndex,"xxxx"),Laya.timer.loop(40,this,this.timeHandler),this.skeleton_light.play(0,!0),this.skeleton_light.visible=!0},enumerable:!0,configurable:!0}),i.prototype.timeHandler=function(){this._timeNum++,this._nowIndex++,this._nowIndex>10&&(this._nowIndex=1);var t=this._display["icon"+this._nowIndex];this._display.selectBox.x=t.x-22,this._display.selectBox.y=t.y-10,24==this._timeNum?(this._turnStatus=2,Laya.timer.clear(this,this.timeHandler),Laya.timer.loop(80,this,this.timeHandler)):36==this._timeNum?(this._turnStatus=3,Laya.timer.clear(this,this.timeHandler),Laya.timer.loop(160,this,this.timeHandler)):this._timeNum>=42&&(3==this._turnStatus?this._nowIndex==this._preDesIndex&&(this._turnStatus=4,Laya.timer.clear(this,this.timeHandler),Laya.timer.loop(320,this,this.timeHandler)):this._nowIndex==this._desIndex&&(Laya.timer.clear(this,this.timeHandler),Laya.timer.once(500,this,this.turnOver)))},i.prototype.turnOver=function(){this.skeleton_light.stop(),this.skeleton_light.visible=!1,this.showRewardBox(!0),this._display.buyBtn1.filters=null,this._display.buyBtn2.filters=null,this._lotteryNum+=0==this._lotteryType?1:5,this._display.numTxt.text=this._lotteryNum+"",this.setPngStatus()},i.prototype.destroy=function(){Laya.timer.clear(this,this.timeHandler),Laya.timer.clear(this,this.turnOver),this.showRewardBox(!1);for(var t=1;5>=t;t++)this._display["png"+t].off(Laya.Event.CLICK,this,this.pngClickHandler);for(var i=1;10>=i;i++)this._display["icon"+i].off(Laya.Event.CLICK,this,this.iconClickHandler);this._display.buyBtn1.off(Laya.Event.CLICK,this,this.butBtn1ClickHandler),this._display.buyBtn2.off(Laya.Event.CLICK,this,this.butBtn2ClickHandler),Laya.timer.clear(this,this.hideTips),this.skeleton_light&&(this.skeleton_light.destroy(),this.skeleton_light=null),this._data=null,e.prototype.destroy.call(this),Laya.loader.clearRes("ui/act/turnTable_2017_11/banner.jpg")},i}(t.BaseAct);t.TurnTable_2017_11=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Animation,i=laya.maths.Point,s=function(s){function n(i,n,a,o){s.call(this,new ui.act.TurnTable_2017_11_RewardUI,!0,!0),this.spWidth1=0,this.spWidth2=0,this._scaleCount=0,this._showSpeed=30,this.display=this.skin,this.cacheAs="none",this.display.mainLayer.cacheAs="bitmap",this.name="CommoRewardBox",this.canClickModelToClose=!1,this.sp1=new Sprite,this.display.sp.addChild(this.sp1),this.setCloseButton(this.display.queDingBtn),this.display.againBtn.on(Laya.Event.CLICK,this,this.againBtnClickHandler),this.display.word1.visible=0==a,this.display.word2.visible=1==a,0==o&&(this.display.againBtn.visible=!1,this.display.word1.visible=this.display.word2.visible=this.display.douYuPng.visible=!1,this.display.queDingBtn.x=552),this.display.msgContent.visible=!1,this.display.msgContent.text=i||"",this.listData=n;var r=this.listData.length,h=4>=r?1:2,l=8>=r?4:6;h>=2&&(this.sp2=new Sprite,this.display.sp.addChild(this.sp2));for(var c=0,d=1,u=0;r>u;u++){var p=new ui.act.TurnTable_2017_11_RewardItemUI;p.scaleX=p.scaleY=0,p.cacheAs="none",p.mainLayer.cacheAs="bitmap",p.nameTxt.visible=!1,p.idTxt.visible=!1;var _=this.listData[u];if(p.idTxt.text=_.id,p.icon.skin=t.ResPath().getPic(_.id,t.ResourcePath.PATH_GOODS),p.nameTxt.text=_.name,p.nameTxt1.text=_.name,p.nameTxt2.text=_.name,p.nameTxt.textWidth>128?(p.nameTxt1.visible=!1,p.nameTxt2.visible=!0):(p.nameTxt1.visible=!0,p.nameTxt2.visible=!1),_.id>=200001&&_.id<=4e5){p.numTxt.text=t.DateUtils.getStrByHours(_.hours);var f=new e;f.name="ani",f.scaleX=f.scaleY=1,f.loadAtlas("res/atlas/ui/item_movie.json"),f.interval=95,f.index=1,p.sp.addChild(f),f.x=-29,f.y=-55,f.visible=!0,f.play()}else p.numTxt.text="×"+_.num;!function(e,i){i.on(Laya.Event.CLICK,this,function(){var s,n={};s=i.localToGlobal(new laya.maths.Point(0,0)),n.name=e.name,n.desc=e.itemObj.desc?e.itemObj.desc:e.itemObj.effect_desc,t.Tips.show(n,s)})}(_,p),this["sp"+d].addChild(p),this["spWidth"+d]+=0==c?145:160,p.x=c,c+=160,(u+1)%l==0&&(c=0,d+=1)}this.sp1.x=(t.LayerMgr.width-this.spWidth1)/2+73,this.sp2?(this.sp1.y=(t.LayerMgr.height-this.sp1.height)/2-155,this.sp2.x=(t.LayerMgr.width-this.spWidth2)/2+73,this.sp2.y=this.sp1.y+155):(this.sp1.y=(t.LayerMgr.height-this.sp1.height)/2-105,this.display.msgContent.y+=15),""==this.display.msgContent.text&&(this.sp1.y-=20,this.sp2&&(this.sp2.y-=20));var y=-400,m=-400;this._movieLight=new t.AnimationSKe("assets/skeleton/hj.sk",1),this.display.spMovieBeh.addChild(this._movieLight),this._movieLight.x=t.LayerMgr.width/2+y,this._movieLight.y=340+m,this._movieLight.play(1,!0),this._movieLight.setBounds(new laya.maths.Rectangle(-200,-400,400,160)),this.display.maskMc.visible=!1,this._movieLight.scrollRect=new Laya.Rectangle(y,m,800,192),this._movieAll=new t.AnimationSKe("assets/skeleton/hj.sk",1),this._movieAll.showSkinByName("gxhd"),this.display.spMovieBeh.addChild(this._movieAll),this._movieAll.x=t.LayerMgr.width/2,this._movieAll.y=340,this._movieAll.play(0,!1);var g=new Sprite;g.graphics.drawRect(0,0,t.LayerMgr.width,t.LayerMgr.clientHeight,"#000000"),g.alpha=.8,g.y=-t.LayerMgr.offY,g.mouseEnabled=!0,g.size(t.LayerMgr.width,t.LayerMgr.clientHeight),this.display.addChildAt(g,0),this._scaleValueArr=[],this._scaleStepArr=[],this._scaleCount=0,Laya.timer.once(200,this,this.delaySetScale)}return __extends(n,s),n.prototype.delaySetScale=function(){this.display.msgContent.visible=!0,Laya.timer.loop(30,this,this.setScale)},n.prototype.setScale=function(){this._scaleCount++;var t=0,e=this.sp1.numChildren;this.sp2&&(e+=this.sp2.numChildren);var i=0;if(this.sp1)for(var s=this.sp1.numChildren,n=0;s>n;n++)if(t++,this._scaleCount>3*(t-1)){this._scaleValueArr.length<t&&(this._scaleValueArr[t-1]=0,this._scaleStepArr[t-1]=this._showSpeed);var a=this._scaleValueArr[t-1],o=this._scaleStepArr[t-1];if(o==this._showSpeed||a>100){a+=o,this._scaleValueArr[t-1]=a;var r=this.sp1.getChildAt(n);r.scaleX=r.scaleY=a/100,o==this._showSpeed&&a>=120&&(o=-4,this._scaleStepArr[t-1]=o)}else i++}if(this.sp2)for(var h=this.sp2.numChildren,n=0;h>n;n++)if(t++,this._scaleCount>3*(t-1)){this._scaleValueArr.length<t&&(this._scaleValueArr[t-1]=0,this._scaleStepArr[t-1]=this._showSpeed);var a=this._scaleValueArr[t-1],o=this._scaleStepArr[t-1];if(o==this._showSpeed||a>100){a+=o,this._scaleValueArr[t-1]=a;var r=this.sp2.getChildAt(n);r.scaleX=r.scaleY=a/100,o==this._showSpeed&&a>=120&&(o=-4,this._scaleStepArr[t-1]=o)}else i++}i==e&&Laya.timer.clear(this,this.setScale)},n.prototype.hide=function(){for(var t=this.sp1.numChildren,e=0;t>e;e++){var i=this.sp1.getChildAt(e);this.addDropAniByItem(i)}if(this.sp2)for(var n=this.sp2.numChildren,e=0;n>e;e++){var i=this.sp2.getChildAt(e);this.addDropAniByItem(i)}s.prototype.hide.call(this)},n.prototype.addDropAniByItem=function(e){var s=e.icon.localToGlobal(new i(e.icon.width/2,e.icon.height/2));s.y=s.y-t.LayerMgr.offY,t.addDropAni(e.idTxt.text,s)},n.prototype.againBtnClickHandler=function(){this.event("AGAIN")},n.prototype.destroy=function(){if(this.display.againBtn.off(Laya.Event.CLICK,this,this.againBtnClickHandler),Laya.timer.clear(this,this.delaySetScale),Laya.timer.clear(this,this.setScale),this._scaleValueArr=null,this._scaleStepArr=null,this.sp1){for(;this.sp1.numChildren>0;){var t=this.sp1.removeChildAt(0),e=t.getChildByName("ani");e&&e.stop()}this.sp1.destroy(),this.sp1=null}if(this.sp2){for(;this.sp2.numChildren>0;){var t=this.sp2.removeChildAt(0),e=t.getChildByName("ani");e&&e.stop()}this.sp2.destroy(),this.sp2=null}this._movieLight&&(this._movieLight.destroy(),this._movieLight=null),this._movieAll&&(this._movieAll.destroy(),this._movieAll=null),this.listData=null,this.display&&(this.display=null),Laya.loader.clearRes("assets/skeleton/hj.sk"),s.prototype.destroy.call(this)},n}(t.BaseBox);t.TurnTable_2017_11_Reward=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(s){e.call(this,new ui.act.wbweekend.GiftUI),this._display=this.skin,this._am=t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL),this.aid=this._am.GetActByFrontId(s).id,this.setCloseButton(this._display.closeBtn),this._display.closeBtn.x-=t.Global.FLOAT_ICON_OFFSET/2,this._display.taskList.itemRender=i,this._display.taskList.renderHandler=new Handler(this,this.onListRender),this._display.taskList.array=[],this._display.taskList.selectEnable=!1,this._display.rule.on(Laya.Event.CLICK,this,this.showRule),this._display.logintext.text="1.活动期间周六周日登录即可分别获得登录礼包。\n2.领取礼包后查看下周末礼包。",this._display.actTime.text="2017年12月22日6点-2018年1月1日6点",this.load()}return __extends(s,e),s.prototype.load=function(){t.XHR().Post({file:"petpk",cmd:"activity",aid:this.aid},this,this.queryRet)},s.prototype.queryRet=function(e){this.destroyed||(0==e.result?(this._lefttime=e.left_time,this._display.taskList.array=[],this._display.taskList.array=e.infos):t.WeakTips.show(e.msg))},s.prototype.showRule=function(){var e="活动规则",i="<br /> <br /><p>1.活动时间："+this._display.actTime.text+"本活动仅周末开放参与。</p>";i+="<br /><p>2.活动期间周六周日登录即可分别获得登录礼包，领取礼包后查看下周末礼包。</p>",i+="<br /><p>3.活动期间周六周日在线完成对应的活跃任务即可获得礼包，领取后查看下周末礼包。</p>",t.RulePanel.showRule(i,e)},s.prototype.onListRender=function(t,e){t.setData(this._display.taskList.getItem(e),e,this.aid,this)},s.prototype.destroy=function(){this._display.rule.off(Laya.Event.CLICK,this,this.showRule),e.prototype.destroy.call(this)},s}(t.BaseBox);t.WBWeekend=e;var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.setData=function(e,i,s,n){this._data=e,this._aid=s,this._wbWeekend=n,0==i?(this.x=10,this.y=250,this.getBtn.x=75,this.getBtn.y=150,this.height=250):(this.x=370,this.y=150*i-150);var a=["","每天挑战历练副本15次","每天消耗300点体力","进行任意一次分享"];if(0==n._lefttime)1==e.flag?(this.getBtn.label="领取",t.Util.enable(this.getBtn)):2==e.flag?(this.getBtn.label="已领取",t.Util.toGrayAndDisabled(this.getBtn)):(this.getBtn.label="领取",t.Util.toGrayAndDisabled(this.getBtn));else{var o=t.DateUtils.getTimeFomateObj(n._lefttime);this.getBtn.label=o.day+"天"+o.hour+"小时后开启",t.Util.toGrayAndDisabled(this.getBtn)}for(var r=0,h=0;h<e.giftdesc.attrs.length;h++)this["goodsIcon"+r].skin=t.ResPath().getPic(e.giftdesc.attrs[h].id,t.ResourcePath.PATH_GOODS),this["goodsNum"+r].text="x"+e.giftdesc.attrs[h].num,r++;for(var l=0;l<e.giftdesc.items.length;l++)this["goodsIcon"+r].skin=t.ResPath().getPic(e.giftdesc.items[l].icon_id,t.ResourcePath.PATH_GOODS),this["goodsNum"+r].text="x"+e.giftdesc.items[l].num,r++;""!=a[i]?this.taskName.text=a[i]+":"+e.curr_num+"/"+e.need_num:this.taskName.text="",this.getBtn.on(Laya.Event.CLICK,this,this.getGift)},i.prototype.showTips=function(e){var i,s=[],n={};i=this.goodsIcon0.localToGlobal(new laya.maths.Point(0,0)),n.name="魂珠礼包"+(e+1),n.desc=s[e],t.Tips.show(n,i)},i.prototype.giftRet=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).reload(),this._wbWeekend.load()):t.WeakTips.show(e.msg)},i.prototype.getGift=function(){t.XHR().Post({file:"petpk",cmd:"activity",aid:this._aid,op:"award",id:this._data.idx},this,this.giftRet)},i.prototype.destroy=function(){this.getBtn.off(Laya.Event.CLICK,this,this.getGift),e.prototype.destroy.call(this)},i}(ui.act.wbweekend.GiftItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Animation,i=function(e){function i(i){e.call(this,new ui.act.WeekActive1UI),this._display=this.skin,this.aid=i,this.cacheAs="none",this._display.mainLayer.cacheAs="bitmap",this._list=new laya.ui.List,this._list.vScrollBarSkin="ui/comp/vscroll.png",this._list.scrollBar.visible=!1,this._list.renderHandler=Handler.create(this,this.updateItem,null,!1),this._list.itemRender=s,this._display.addChild(this._list),this._list.x=2,this._list.y=145,this._list.repeatX=1,this._list.repeatY=4,this._list.spaceY=0,this._list.height=371,this._list.array=[],this._display.timeBox.visible=!1,this._remainTime=Number(t.Facade.retrieveModel(t.ModelDef.ACT_MODEL).GetActById(this.aid).last_seconds),t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"querytask"},this,this.queryHandler)}return __extends(i,e),i.prototype.queryHandler=function(e){0==e.result?(this._display.timeBox.visible=!0,this.setTime(),Laya.timer.loop(1e3,this,this.setTime),this._list.array=e.tasks):t.WeakTips.show("查询活动失败，"+e.msg)},i.prototype.setTime=function(){var t=Math.floor(this._remainTime/86400)+"",e=this._remainTime%86400,i=Math.floor(e/3600)+"";1==i.length&&(i="0"+i);var s=e%3600,n=Math.floor(s/60)+"";1==n.length&&(n="0"+n),this._display.dayTxt.text=t+"",this._display.timeTxt.text="天"+i+"时"+n+"分"},i.prototype.updateItem=function(t,e){e<=this._list.array.length-1&&t.doRender(this._list.array[e],e,this.aid)},i.prototype.destroy=function(){Laya.timer.clear(this,this.setTime),this._list&&(this._list.destroy(),this._list=null),e.prototype.destroy.call(this)},i}(t.BaseAct);t.WeekActive1=i;var s=function(i){function s(){i.call(this),this.cacheAs="none",this.mainLayer.cacheAs="bitmap",this.doBtn.on(Laya.Event.CLICK,this,this.doBtnClickHandler)}return __extends(s,i),s.prototype.doRender=function(i,s,n){this._aid=n,this._id=i.id,13==this._id||14==this._id?this.nameTxt.text=i.name+":"+i.num+"/"+i.target+"元":15==this._id?this.nameTxt.text=i.name+":"+i.num+"/"+i.target+"斗豆":this.nameTxt.text=i.name+":"+i.num+"/"+i.target+"次",0==Number(i.status)?(this.doBtn.label="前  往",this.doBtn.filters=null):2==Number(i.status)?(this.doBtn.label="已领取",this.doBtn.filters=t.FiltersUtils.getGreyFilters()):(this.doBtn.label="领  取",this.doBtn.filters=null),this.icon1.visible=this.icon2.visible=this.icon3.visible=this.icon4.visible=!1,this.icon1Bg.visible=this.icon2Bg.visible=this.icon3Bg.visible=this.icon4Bg.visible=!1,this.numTxt1.text=this.numTxt2.text=this.numTxt3.text=this.numTxt4.text="";for(var a=1;4>=a;a++)this["ani"+a]&&(this["ani"+a].stop(),this["ani"+a].visible=!1);for(var o,r=0,a=0;a<i.rewards.attrs.length&&(r++,!(r>4));a++)o=i.rewards.attrs[a],this["icon"+r].visible=!0,this["icon"+r+"Bg"].visible=!0,this["icon"+r].skin=t.ResPath().getPic(o.id,t.ResourcePath.PATH_GOODS),this["numTxt"+r].text=o.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.desc,t.Tips.show(n,e)})}(r,o,this["icon"+r]);for(var h,l=0;l<i.rewards.items.length&&(r++,!(r>4));l++)h=i.rewards.items[l],this["icon"+r].visible=!0,this["icon"+r+"Bg"].visible=!0,this["icon"+r].skin=t.ResPath().getPic(h.icon_id,t.ResourcePath.PATH_GOODS),h.id>=200001&&h.id<=4e5?(this["numTxt"+r].text=t.DateUtils.getStrByHours(h.hours),this["ani"+r]||(this["ani"+r]=new e,this["ani"+r].loadAtlas("res/atlas/ui/item_movie.json"),this["ani"+r].interval=95,this["ani"+r].index=1,this.sp.addChild(this["ani"+r]),this["ani"+r].x=this["icon"+r+"Bg"].x-51,this["ani"+r].y=this["icon"+r+"Bg"].y-52),this["ani"+r].play(),this["ani"+r].visible=!0):this["numTxt"+r].text=h.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.goods_desc,n.info=i.effect_desc,
t.Tips.show(n,e)})}(r,h,this["icon"+r])},s.prototype.doBtnClickHandler=function(){"前  往"==this.doBtn.label?8==this._id||9==this._id?t.Facade.callCommand(new t.ChampionTeamCommand):10==this._id?t.Facade.callCommand(new t.LilianCmd(1e4)):15==this._id?t.WeakTips.show("左侧有好多活动优惠等着您，快去看看吧！"):t.Facade.callCommand(new t.OpenVipBoxCommand(1)):"已领取"==this.doBtn.label?t.WeakTips.show("您已经领取过这个奖励了"):t.XHR().Post({cmd:"activity",aid:this._aid,subcmd:"getaward",idx:this._id},this,this.getHandler)},s.prototype.getHandler=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0)),this.doBtn.label="已领取",this.doBtn.filters=t.FiltersUtils.getGreyFilters()):t.WeakTips.show("领取失败，"+e.msg)},s.prototype.destroy=function(){this.doBtn.off(Laya.Event.CLICK,this,this.doBtnClickHandler);for(var t=1;4>=t;t++)this.ani+t&&(this.ani.stop(),this.ani.destroy(),this.ani=null);i.prototype.destroy.call(this)},s}(ui.act.WeekActive1ItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(s){e.call(this,new ui.act.WeekActive2UI),this._display=this.skin,this.aid=s,this._list=new laya.ui.List,this._list.vScrollBarSkin="ui/comp/vscroll.png",this._list.scrollBar.visible=!1,this._list.renderHandler=Handler.create(this,this.updateItem,null,!1),this._list.itemRender=i,this._display.addChildAt(this._list,this._display.getChildIndex(this._display.tipsBox)),this._list.x=2,this._list.y=145,this._list.repeatX=1,this._list.repeatY=4,this._list.spaceY=0,this._list.height=371,this._list.array=[],this._display.tipsBox.visible=!1,t.EventCenter.singleton.on("SHOW_WEEKACTIVE2_TIPS",this,this.showTips),t.EventCenter.singleton.on("WEEKACTIVE2_EXCHANGE",this,this.exchangeHandler);var n=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL);n.on(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdateFinish),this.packModelUpdateFinish(),this._display.timeBox.visible=!1,this._remainTime=Number(t.Facade.retrieveModel(t.ModelDef.ACT_MODEL).GetActById(this.aid).last_seconds),t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"query"},this,this.queryHandler)}return __extends(s,e),s.prototype.queryHandler=function(e){0==e.result?(this._display.timeBox.visible=!0,this.setTime(),Laya.timer.loop(1e3,this,this.setTime),this._list.array=e.gifts):t.WeakTips.show("查询活动失败，"+e.msg)},s.prototype.setTime=function(){var t=Math.floor(this._remainTime/86400)+"",e=this._remainTime%86400,i=Math.floor(e/3600)+"";1==i.length&&(i="0"+i);var s=e%3600,n=Math.floor(s/60)+"";1==n.length&&(n="0"+n),this._display.dayTxt.text=t+"",this._display.timeTxt.text="天"+i+"时"+n+"分"},s.prototype.updateItem=function(t,e){e<=this._list.array.length-1&&t.doRender(this._list.array[e],e,this.aid)},s.prototype.packModelUpdateFinish=function(){var e=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL);this._display.numTxt.text="×"+e.getItemCount(100142)},s.prototype.showTips=function(t){Laya.timer.clear(this,this.hideTips),this._display.tipsBox.visible=!0,this._display.tipsBox.x=t.xValue-400,this._display.tipsBox.y=t.yValue-100,this._display.tipsMsg.text=t.str,this._display.tipsBg.height=this._display.tipsMsg.textHeight+10,Laya.timer.once(4e3,this,this.hideTips)},s.prototype.hideTips=function(){this._display.tipsBox.visible=!1},s.prototype.exchangeHandler=function(t){var e=this._list.array;e[t.index].exchange_num=Number(e[t.index].exchange_num)+1,this._list.array=e},s.prototype.destroy=function(){Laya.timer.clear(this,this.hideTips),t.EventCenter.singleton.off("SHOW_WEEKACTIVE2_TIPS",this,this.showTips),t.EventCenter.singleton.off("WEEKACTIVE2_EXCHANGE",this,this.exchangeHandler);var i=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL);i.off(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdateFinish),Laya.timer.clear(this,this.setTime),this._list&&(this._list.destroy(),this._list=null),e.prototype.destroy.call(this)},s}(t.BaseAct);t.WeekActive2=e;var i=function(e){function i(){e.call(this),this.icon2Bg.on(Laya.Event.CLICK,this,this.iconClickHandler),this.doBtn.on(Laya.Event.CLICK,this,this.doBtnClickHandler)}return __extends(i,e),i.prototype.doRender=function(e,i,s){if(this._obj=e,this._aid=s,this._index=i,this.numTxt1.text="×"+e.target_num,this.exchangeCountTxt.text=e.exchange_num+"/"+e.total_num,1==this._obj.award.items.length?this.giftIcon.skin=t.ResPath().getPic(this._obj.award.items[0].icon_id,t.ResourcePath.PATH_GOODS):this.giftIcon.skin="ui/act/weekActive2/icon2.png",Number(this._obj.exchange_num)>=Number(this._obj.total_num))this.doBtn.filters=t.FiltersUtils.getGreyFilters();else{var n=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL);n.getItemCount(100142)<Number(this._obj.target_num)?this.doBtn.filters=t.FiltersUtils.getGreyFilters():this.doBtn.filters=null}},i.prototype.iconClickHandler=function(e){var i=e.stageX-t.LayerMgr.offX,s=e.stageY-t.LayerMgr.offY,n="";if(this._obj.award.attrs&&this._obj.award.attrs.length>0)for(var a=0;a<this._obj.award.attrs.length;a++)n+=this._obj.award.attrs[a].name+"×"+this._obj.award.items[a].num+"\n";if(this._obj.award.items&&this._obj.award.items.length>0)for(var a=0;a<this._obj.award.items.length;a++)if(this._obj.award.items[a].id>=200001&&this._obj.award.items[a].id<=4e5){var o=0==Number(this._obj.award.items[a].isage)?-1:Number(this._obj.award.items[a].hours);n+=this._obj.award.items[a].name+"×"+t.DateUtils.getStrByHours(o)+"\n"}else n+=this._obj.award.items[a].name+"×"+this._obj.award.items[a].num+"\n";t.EventCenter.singleton.event("SHOW_WEEKACTIVE2_TIPS",{xValue:i,yValue:s,str:n})},i.prototype.doBtnClickHandler=function(){if(Number(this._obj.exchange_num)>=Number(this._obj.total_num))t.WeakTips.show("兑换已达上限");else{var e=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL);e.getItemCount(100142)<Number(this._obj.target_num)?t.WeakTips.show("道具数量不足"):t.XHR().Post({cmd:"activity",aid:this._aid,subcmd:"exchange",idx:this._index},this,this.exchangeHandler)}},i.prototype.exchangeHandler=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0)),t.EventCenter.singleton.event("WEEKACTIVE2_EXCHANGE",{index:this._index})):t.WeakTips.show("兑换失败，"+e.msg)},i.prototype.destroy=function(){this._obj=null,this.icon2Bg.off(Laya.Event.CLICK,this,this.iconClickHandler),this.doBtn.off(Laya.Event.CLICK,this,this.doBtnClickHandler),e.prototype.destroy.call(this)},i}(ui.act.WeekActive2ItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(s){e.call(this,new ui.act.YearGiftUI),this._display=this.skin,this.aid=s,this._display.lst.renderHandler=Handler.create(this,this.updateItem,null,!1),this._display.lst.itemRender=i,this._display.lst.array=[],this.updataTime(),t.XHR().Post({file:"petpk",cmd:"activity",aid:this.aid,uid:t.Global.UID},this,this.getDataHandler)}return __extends(s,e),s.prototype.updataTime=function(){var e=t.Facade.retrieveModel(t.ModelDef.ACT_MODEL),i=e.GetActById(this.aid);this._leftTime=Number(i.last_seconds),this._leftTime<=0?this._display.tfDay.text=this._display.tfHour.text=this._display.tfMinute.text="0":(Laya.timer.loop(1e3,this,this.countDown),this.setTime())},s.prototype.countDown=function(){this._leftTime--,this.setTime()},s.prototype.setTime=function(){this._leftTime<=0&&(Laya.timer.clear(this,this.countDown),this._leftTime=0);var e=t.DateUtils.getTimeFomateObj(this._leftTime);this._display.tfDay.text=e.day,this._display.tfHour.text=e.hour,this._display.tfMinute.text=""+e.minute},s.prototype.getDataHandler=function(e){0==e.result?(this._data=e,this.updata()):t.WeakTips.show("查询活动信息失败，"+e.msg)},s.prototype.refresh=function(t){this._data=t,this.updata()},s.prototype.updata=function(){this._display.lst.array=this._data.award},s.prototype.updateItem=function(t,e){e<=this._display.lst.array.length-1&&t.doRender(this._display.lst.array[e],e,this._data,this.aid,this)},s.prototype.destroy=function(){this.list&&(this.list.destroy(),this.list=null),t.Tips.tipsClose(),Laya.timer.clear(this,this.countDown),e.prototype.destroy.call(this)},s}(t.BaseAct);t.YearGift=e;var i=function(e){function i(){e.call(this),this.getBtn.on(Laya.Event.CLICK,this,this.getBtnClickHandler),this.lst.hScrollBarSkin="ui/comp/hscroll.png",this.lst.scrollBar.visible=!1,this.lst.renderHandler=Handler.create(this,this.updateItem,null,!1),this.lst.itemRender=s,this.lst.array=[]}return __extends(i,e),i.prototype.doRender=function(t,e,i,s,n){this._data=t,this._index=e,this._ret=i,this._aid=s,this._owner=n,this.draw()},i.prototype.draw=function(){this.imgTile.skin="ui/act/yeargift/title"+(this._index+1)+".png";var e=this._ret.remain_times[this._index];this.tfCount.text="剩余："+e,0==this._ret.price[this._index].discount_price?(this.freeBx.visible=!0,this.costBx.visible=!1,this.tfPrice.text=this._ret.price[this._index].old_price,e>0?(this.getBtn.label="免费领取",t.Util.enable(this.getBtn)):(this.getBtn.label="已领取",t.Util.toGrayAndDisabled(this.getBtn))):(this.freeBx.visible=!1,this.costBx.visible=!0,this.tfOriginal.text=this._ret.price[this._index].old_price,this.tfNow.text=this._ret.price[this._index].discount_price,e>0?(this.getBtn.label="购 买",t.Util.enable(this.getBtn)):(this.getBtn.label="已购买",t.Util.toGrayAndDisabled(this.getBtn))),this.lst.array=this._data.items;var i=this._data.items.length>3?3:this._data.items.length;this.lst.x=(245-(70*i+i-1))/2},i.prototype.updateItem=function(t,e){e<=this.lst.array.length-1&&t.doRender(this.lst.array[e],e)},i.prototype.getBtnClickHandler=function(){t.XHR().Post({file:"petpk",cmd:"activity",aid:this._aid,subcmd:"get",index:this._index,uid:t.Global.UID},this,this.getHandler)},i.prototype.getHandler=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),this._ret.remain_times[this._index]--,this.draw()):t.WeakTips.show(e.msg)},i.prototype.destroy=function(){this.getBtn.off(Laya.Event.CLICK,this,this.getBtnClickHandler),e.prototype.destroy.call(this)},i}(ui.act.YearGiftItemUI),s=function(e){function i(){e.call(this),this.on(Laya.Event.CLICK,this,this.showTips)}return __extends(i,e),i.prototype.doRender=function(e,i){this._data=e,this.icon1.skin=t.ResPath().getPic(e.icon_id,t.ResourcePath.PATH_GOODS),this.numTxt1.text=e.num?"x"+e.num:"x"+e.hours+"时"},i.prototype.showTips=function(){var e,i={};e=this.localToGlobal(new laya.maths.Point(0,0)),i.name=this._data.name,i.desc=this._data.goods_desc,i.info=this._data.effect_desc,t.Tips.show(i,e)},i.prototype.destroy=function(){this.off(Laya.Event.CLICK,this,this.showTips),e.prototype.destroy.call(this)},i}(ui.act.YearGiftPropItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Animation,i=function(e){function i(i){e.call(this,new ui.act.YearSignUI),this._display=this.skin,this.aid=i,this._display.lst.renderHandler=Handler.create(this,this.updateItem,null,!1),this._display.lst.itemRender=s,this._display.lst.array=[],this._display.lst.scrollBar.hide=!0,this.updataTime(),t.XHR().Post({file:"petpk",cmd:"activity",aid:this.aid,uid:t.Global.UID},this,this.getDataHandler)}return __extends(i,e),i.prototype.updataTime=function(){var e=t.Facade.retrieveModel(t.ModelDef.ACT_MODEL),i=e.GetActById(this.aid);this._leftTime=Number(i.last_seconds),this._leftTime<=0?this._display.tfDay.text=this._display.tfHour.text=this._display.tfMinute.text="0":(Laya.timer.loop(1e3,this,this.countDown),this.setTime())},i.prototype.countDown=function(){this._leftTime--,this.setTime()},i.prototype.setTime=function(){this._leftTime<=0&&(Laya.timer.clear(this,this.countDown),this._leftTime=0);var e=t.DateUtils.getTimeFomateObj(this._leftTime);this._display.tfDay.text=e.day,this._display.tfHour.text=e.hour,this._display.tfMinute.text=""+e.minute},i.prototype.getDataHandler=function(e){0==e.result?(this._data=e,this.updata()):t.WeakTips.show("查询活动信息失败，"+e.msg)},i.prototype.updata=function(){var t,e=this._data.day-1;if(-1!=e&&e!=this._data.gifts.length){var i=this._data.gifts.slice(0,e),s=this._data.gifts.slice(e,this._data.gifts.length);t=s.concat(i)}else t=this._data.gifts;this._display.lst.array=t},i.prototype.updateItem=function(t,e){e<=this._display.lst.array.length-1&&t.doRender(this._display.lst.array[e],this._data.day,this._data.status,this.aid)},i.prototype.destroy=function(){this.list&&(this.list.destroy(),this.list=null),t.Tips.tipsClose(),Laya.timer.clear(this,this.countDown),e.prototype.destroy.call(this)},i}(t.BaseAct);t.YearSign=i;var s=function(i){function s(){i.call(this),this.getBtn.on(Laya.Event.CLICK,this,this.getBtnClickHandler)}return __extends(s,i),s.prototype.doRender=function(i,s,n,a){this._data=i,this._day=s,this._status=n,this._aid=a,this.imgDate.skin="ui/act/yearsign/"+i.idx+".png",i.idx<s?(this.getBtn.label="已过期",this.hasGet.visible=!1,this.getBtn.visible=!0,t.Util.toGrayAndDisabled(this.getBtn)):i.idx>s?(this.getBtn.label="领  取",this.hasGet.visible=!1,this.getBtn.visible=!0,t.Util.toGrayAndDisabled(this.getBtn)):0==n?(this.getBtn.label="领  取",this.hasGet.visible=!1,this.getBtn.visible=!0,t.Util.enable(this.getBtn)):(this.hasGet.visible=!0,this.getBtn.visible=!1),this.icon1.visible=this.icon2.visible=this.icon3.visible=this.icon4.visible=!1,this.icon1Bg.visible=this.icon2Bg.visible=this.icon3Bg.visible=this.icon4Bg.visible=!1,this.numTxt1.text=this.numTxt2.text=this.numTxt3.text=this.numTxt4.text="",this.txtBg1.visible=this.txtBg2.visible=this.txtBg3.visible=this.txtBg4.visible=!1;for(var o,r=0,h=0;h<i.detail.attrs.length&&(r++,!(r>4));h++)o=i.detail.attrs[h],this["icon"+r].visible=!0,this["icon"+r+"Bg"].visible=!0,this["txtBg"+r].visible=!0,this["icon"+r].skin=t.ResPath().getPic(o.id,t.ResourcePath.PATH_GOODS),this["numTxt"+r].text=o.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.desc,t.Tips.show(n,e)})}(r,o,this["icon"+r]);for(var l,c=0;c<i.detail.items.length&&(r++,!(r>4));c++)l=i.detail.items[c],this["icon"+r].visible=!0,this["icon"+r+"Bg"].visible=!0,this["txtBg"+r].visible=!0,this["icon"+r].skin=t.ResPath().getPic(l.icon_id,t.ResourcePath.PATH_GOODS),l.id>=200001&&l.id<=4e5?(this["numTxt"+r].text=t.DateUtils.getStrByHours(l.hours),this["ani"+r]||(this["ani"+r]=new e,this["ani"+r].loadAtlas("res/atlas/ui/item_movie.json"),this["ani"+r].interval=95,this["ani"+r].index=1,this.sp.addChild(this["ani"+r]),this["ani"+r].x=this["icon"+r+"Bg"].x-51,this["ani"+r].y=this["icon"+r+"Bg"].y-52),this["ani"+r].play(),this["ani"+r].visible=!0):this["numTxt"+r].text=l.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.goods_desc,n.info=i.effect_desc,t.Tips.show(n,e)})}(r,l,this["icon"+r])},s.prototype.getBtnClickHandler=function(){t.XHR().Post({file:"petpk",cmd:"activity",aid:this._aid,op:"award",uid:t.Global.UID},this,this.getHandler)},s.prototype.getHandler=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),this.getBtn.visible=!1,this.hasGet.visible=!0):t.WeakTips.show(e.msg)},s.prototype.destroy=function(){for(var t=1;4>=t;t++)this.ani+t&&(this.ani.stop(),this.ani.destroy(),this.ani=null);this.getBtn.off(Laya.Event.CLICK,this,this.getBtnClickHandler),i.prototype.destroy.call(this)},s}(ui.act.YearSignItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i){e.call(this,new ui.act.ZhaocaiUI),this._display=this.skin,this.aid=i,this._um=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),t.XHR().Post({cmd:"activity",aid:this.aid},this,this.init),this._display.chargeBtn.on(Laya.Event.CLICK,this,this.onCharge),this._rollNumbers=[];for(var s=[],n=0;10>n;n++)s.push("ui/act/zhaocai/"+n+".png");for(var n=0;4>n;n++){var a=new t.RollNumber(s,67,50);this._rollNumbers.push(a),this._display.addChild(a),a.x=86+79*n,a.y=297}this._dataSys=!1,this._canReward=!0}return __extends(i,e),i.prototype.destroy=function(){this._dataSys&&t.Facade.callCommand(new t.SyncChangeCmd(this._dataSys,!1)),e.prototype.destroy.call(this)},i.prototype.init=function(e){if(0==e.result){this._curData=e;var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL),s=i.GetActById(this.aid),n=t.DateUtils.getTimeFomateObj(s.last_seconds);this._display.leftDay.text=n.day,this._display.leftHour.text=n.hour;for(var a=0;10>a;a++)e.feeds[a]?(this._display["feed"+a].visible=!0,this._display["feed"+a].text=e.feeds[a]):this._display["feed"+a].visible=!1;this._display.timeTxt.text=e.my_times+"/"+e.total_times,this._display.cangetTxt.text=e.next_get+"",this._display.costTxt.text=e.next_cost+"",this._display.leaveTxt.text=this._um.doubi+"",this._display.rewardBtn.on(Laya.Event.CLICK,this,this.onReward)}else t.WeakTips.show(e.msg)},i.prototype.onCharge=function(){t.Facade.callCommand(new t.OpenVipBoxCommand(1))},i.prototype.onReward=function(){if(!this._canReward)return void t.WeakTips.show("正在抽奖！");if(this._curData.my_times<this._curData.total_times)t.ConfirmBox.show(new t.ConfirmBoxData({contentStr:"花费"+this._curData.next_cost+"斗豆进行招财",callBackHandler:new Handler(this,this.confirm)}));else if(this._curData.total_times<4){var e=0;this._um.vipLevel<1?e=1:this._um.vipLevel<4?e=4:this._um.vipLevel<6&&(e=6),t.WeakTips.show("请提升至达人"+e+"再来招财吧~")}else t.WeakTips.show("今日招财次数已经用完")},i.prototype.confirm=function(){this._um.doubi>=this._curData.next_cost?(this._canReward=!1,t.XHR().Post({cmd:"activity",aid:this.aid,subcmd:"lottery"},this,this.onLottery)):t.WeakTips.show("斗豆不足")},i.prototype.onLottery=function(e){if(0==e.result){this._dataSys=e;var i=e.award.attrs[0].num;i+=1e4;var s=Math.floor(i/1e3)-10,n=Math.floor(i/100)-100-10*s,a=Math.floor(i/10)-1e3-100*s-10*n,o=i%10;this._rollNumbers[0].play(4e3,s,Handler.create(this,this.onComp,[e])),this._rollNumbers[1].play(3e3,n),this._rollNumbers[2].play(2e3,a),this._rollNumbers[3].play(1500,o)}else t.WeakTips.show(e.msg),this._canReward=!0},i.prototype.onComp=function(e){this._canReward=!0,this._dataSys=null,t.Facade.callCommand(new t.SyncChangeCmd(e,!0)),this.init(e)},i}(t.BaseAct);t.ZhaocaiAct=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(s,n){e.call(this,new ui.act.NormalSellUI),this._totalBuyNum=0,this._display=this.skin,this.aid=s,console.log(s),this._list=new laya.ui.List,this._list.renderHandler=Handler.create(this,this.updateItem,null,!1),this._list.itemRender=i,this._display.addChild(this._list),this._list.x=7,this._list.y=82,this._list.repeatY=2,this._list.repeatX=3,this._list.spaceX=6,this._list.width=708,this._list.height=450,this._list.array=[],this._totalBuyNum=0,this._leftTime=Number(t.Facade.retrieveModel(t.ModelDef.ACT_MODEL).GetActById(this.aid).last_seconds),this.init(),t.EventCenter.singleton.on("SELL_ACTIVITY_BUY_SUCCESS",this,this.buySuccess)}return __extends(s,e),s.prototype.init=function(){t.XHR().Post({cmd:"activity",aid:this.aid,uid:t.Global.UID},this,this.getSellHandler)},s.prototype.getSellHandler=function(e){void 0===e&&(e=null),0==e.result?(e.award&&(this._list.array=e.award),this._display.timeMsg.visible=this._display.timeTxt.visible=this._display.dayTxt.visible=!0,this.setTime(),Laya.timer.loop(1e3,this,this.setTime)):t.WeakTips.show("拉取售卖信息失败，"+e.msg)},s.prototype.setTime=function(){var t=Math.floor(this._leftTime/86400)+"",e=this._leftTime%86400,i=Math.floor(e/3600)+"";1==i.length&&(i="0"+i);var s=e%3600,n=Math.floor(s/60)+"";1==n.length&&(n="0"+n),this._display.dayTxt.text=t+"",this._display.timeTxt.text="天"+i+"时"+n+"分"},s.prototype.updateItem=function(t,e){e<=this._list.array.length-1&&t.doRender(this._list.array[e],e,this)},s.prototype.buySuccess=function(t){this.init()},s.prototype.destroy=function(){t.EventCenter.singleton.off("GEM_SELL_ACTIVITY_BUY_SUCCESS",this,this.buySuccess),Laya.timer.clear(this,this.setTime),this._list&&(this._list.destroy(),this._list=null),e.prototype.destroy.call(this)},s}(t.BaseAct);t.NormalSellAct=e;var i=function(e){function i(){e.call(this),this._index=0,this._buyNum=1,this._boxNameArr=["剑君攻魂","剑君守魂","帅帅暴魂","帅帅命魂","月敏反魂","月敏愈魂"],this.icon.on(Laya.Event.CLICK,this,this.clickTips),this.buy10Btn.on(Laya.Event.CLICK,this,this.buyClickHandler,[10]),this.buy1Btn.on(Laya.Event.CLICK,this,this.buyClickHandler,[1]),this._remainNum=600,this.priceBox.visible=!1,this.itemBg.visible=!1,this.height=220,this.buy10Btn.y=130,this.buy1Btn.y=175}return __extends(i,e),i.prototype.doRender=function(t,e,i){this._obj=t,this._sellact=i,this._index=e,t.price&&t.act_price&&(this.priceTxt1.text=t.price,this.priceTxt2.text=t.act_price,this.zheKouTxt.text=parseInt(t.act_price)/parseInt(t.price)*10+"折")},i.prototype.clickTips=function(){var e,i={};e=this.localToGlobal(new laya.maths.Point(0,0)),i.desc="可随机获得以下物品之一：\n";for(var s=0;s<this._obj.items.length;s++)i.desc+=this._obj.items[s].name+"x"+this._obj.items[s].num+"\n";i.name=this._boxNameArr[this._index]+"礼盒",t.Tips.show(i,e)},i.prototype.buyClickHandler=function(t){this._buyNum=t,this.buy()},i.prototype.buy=function(){this._rewardBox&&this._rewardBox.destroy();var e="是否花费"+20*this._buyNum+"斗豆购买"+this._boxNameArr[this._index]+"礼盒*"+this._buyNum+"？",i=new t.ConfirmBoxData({isShowCancelBtn:!0,contentStr:e,callBackHandler:new Handler(this,this.actBuy,[this._buyNum])});t.ConfirmBox.show(i)},i.prototype.actBuy=function(e){t.XHR().Post({cmd:"activity",aid:this._sellact.aid,subcmd:"buy",num:e,type:this._index},this,this.buyHandler)},i.prototype.buyHandler=function(e){0==e.result?(t.EventCenter.singleton.event("SELL_ACTIVITY_BUY_SUCCESS",{id:this._obj.id,num:1}),this._rewardBox||(this._rewardBox=new t.ShowRewardBoxNew("",e.award.items,null,!0,20*this._buyNum,"再买"+this._buyNum+"个",!0),this._rewardBox.on(t.ViewEvent.BASE_DESTROY,this,this.rewardBoxDestroy),this._rewardBox.on("AGAIN",this,this.buy),this._rewardBox.show()),t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!1))):t.WeakTips.show("购买失败，"+e.msg)},i.prototype.rewardBoxDestroy=function(){this._rewardBox&&(this._rewardBox.off(t.ViewEvent.BASE_DESTROY,this,this.rewardBoxDestroy),this._rewardBox.off("AGAIN",this,this.buy),this._rewardBox=null)},i.prototype.destroy=function(){this._obj=null,this.icon.off(Laya.Event.CLICK,this,this.clickTips),this.buy1Btn.off(Laya.Event.CLICK,this,this.buyClickHandler),this.buy10Btn.off(Laya.Event.CLICK,this,this.buyClickHandler),e.prototype.destroy.call(this)},i}(ui.act.NormalSellItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.utils.Dictionary,i=function(i){function n(){i.call(this,new ui.bag.BagUI,!0,!0,!1,!1),this.goodsId=0,this.tabIndex=0,this.goodsIndex=0,this._hasGet1=!1,this._hasGet2=!1,this._hasGet3=!1,this._usedId=-1,this._isMouseDown=!1,this.display=this.skin,this.display.red1.visible=this.display.red2.visible=this.display.red3.visible=!1,this.bagMap=new e,this.display.goodsList.itemRender=s,this.init()}return __extends(n,i),n.prototype.init=function(){this.display.menuTab.labels="药\n\n水,强\n\n化,其\n\n它",this.display.back.derocation_left.skin="ui/comp/rope_xia.png",this.display.back.derocation_left.x=119,this.setCloseButton(this.display.back.closeBtn),this.display.goodsList.selectEnable=!0,this.display.menuTab.selectHandler=new Handler(this,this.tabChange),this.display.goodsList.selectHandler=new Handler(this,this.onSelect),this.display.goodsList.renderHandler=new Handler(this,this.onListRender),this.display.useBtn.on(Laya.Event.MOUSE_DOWN,this,this.onUseGoods),this.display.throwBtn.on(Laya.Event.CLICK,this,this.throwGoods),this.display.goodsList.array=[],this._pm=t.Facade.singleton.model.retrieveModel(t.ModelDef.PACK_MODEL),this._pm.on(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdate),this.packModelUpdate()},n.prototype.packModelUpdate=function(){this._hasGet1=!1,this._hasGet2=!1,this._hasGet3=!1,this._pm.off(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdate),this.getGoods(this.tabIndex+1);for(var e=1;3>=e;e++)for(var i=this._pm.getItemsByType(e),s=i.length,n=0;s>n;n++){var a=i[n];if(a&&a.changeNum>0){this.display["red"+e].visible=!0;break}}},n.prototype.getGoods=function(e){this._nowType=e,t.XHR().Post({file:"petpk",cmd:"storage",op:"view",uid:t.Global.UID,type:e},this,this.getGoodsHandler)},n.prototype.getGoodsHandler=function(e){this.destroyed||(0==e.result?(this._pm.off(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdate),this._pm.items=e.goods_info,this["_hasGet"+this._nowType]=!0,e.goods_info.sort(function(t,e){return t.subid-e.subid}),this.bagMap.set(this._nowType,e.goods_info),this.userBag=e,this.showTab(this.tabIndex)):t.WeakTips.show(e.msg))},n.prototype.onUseGoods=function(){if(this.currGood.target_url.length>0)if(5==this.currGood.goods_type){var e=new t.ConfirmBoxData({isShowCancelBtn:!0,contentStr:this.currGood.goods_desc+"确定购买吗？",callBackHandler:new Handler(this,this.sureToBuy)});t.ConfirmBox.show(e)}else-1==String(this.currGood.target_url).indexOf("CommonExchangeCmd")&&this.hide(),t.facade().executeStrCommand(this.currGood.target_url);else this.useGoods()},n.prototype.sureToBuy=function(){-1==String(this.currGood.target_url).indexOf("CommonExchangeCmd")&&this.hide(),t.XHR().Post({cmd:"storage",op:"exchange",exid:this.currGood.target_url.split("|")[1]},this,this.useRet)},n.prototype.useRet=function(e){0==e.result?t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0)):t.WeakTips.show("兑换失败，斗豆不足！")},n.prototype.useGoods=function(){if(this._isMouseDown=!0,Laya.stage.on(Laya.Event.MOUSE_UP,this,this.mouseUpHandler),100100==this.currGood.id){var e=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);if(0!=e.marryStatus)t.WeakTips.show("要先解除婚姻关系才能改变性别哦！");else{var i=new t.ConfirmBoxData({isShowCancelBtn:!0,contentStr:"点击确认后，你的小企鹅将改变当前的性别，确认继续吗？",callBackHandler:new Handler(this,this.doUse)});t.ConfirmBox.show(i)}}else if(100119==this.currGood.id){var s=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL);s.getItemCount(100119)<100?t.WeakTips.show("玻璃碎片数量不足，需要100个玻璃碎片来合成一天酱油瓶"):t.XHR().Post({cmd:"storage",op:"exchange",exid:1},this,this.doChipHandler)}else this.doUse()},n.prototype.doChipHandler=function(e){0==e.result?t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0)):t.WeakTips.show("合成失败，"+e.msg)},n.prototype.doUse=function(){this._lastDoTime=Browser.now(),t.XHR().Post({cmd:"storage",op:"use",id:this.currGood.id},this,this.doUseHandler)},n.prototype.doUseHandler=function(e){if(0==e.result){this._usedId=this.currGood.id,t.Facade.callCommand(new t.SyncChangeCmd(e));var i=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL).getItemCount(this._usedId);if(i>0&&this._isMouseDown){var s=Browser.now(),n=s-this._lastDoTime;n>=200?(this._lastDoTime=s,this.doUse()):Laya.timer.once(200-n,this,this.doUse)}e.usemsg&&""!=e.usemsg&&100100!=this.currGood.id&&t.WeakTips.show(e.usemsg),100143==this.currGood.id&&t.Facade.callCommand(new t.RefreshUserInfoCmd),100100==this.currGood.id&&(this.hide(),t.Icon.MAIN_SCENE.changeSex())}else this._isMouseDown=!1,t.WeakTips.show("使用失败"+e.msg)},n.prototype.mouseUpHandler=function(){this._isMouseDown=!1,Laya.timer.clear(this,this.doUse),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.mouseUpHandler),this.destroyed||(this.display.useBtn.state=1)},n.prototype.throwGoods=function(){if(1!=this.currGood.canabandon)t.Facade.callCommand(new t.GoodsUseCmd(this.currGood));else{var e=new t.ConfirmBoxData({isShowCancelBtn:!0,contentStr:"点击确认后，你将丢弃所有该物品，确认继续吗？",callBackHandler:new Handler(this,this.delGoods)});t.ConfirmBox.show(e)}},n.prototype.delGoods=function(){t.XHR().Post({file:"petpk",cmd:"storage",op:"abandon",uid:t.Global.UID,id:this.currGood.id},this,function(e){0==e.result&&t.Facade.callCommand(new t.SyncChangeCmd(e)),t.WeakTips.show(e.msg)})},n.prototype.showDetail=function(e){return t.Util.toGrayAndDisabled(this.display.throwBtn),t.Util.toGrayAndDisabled(this.display.useBtn),0>e||null==this.userBag?(this.display.goodsPic.skin="",this.display.goodsName.text="",this.display.goodsInfo.text="",this.display.goodsDesc.text="",void(this.display.goosNumber.text="")):(this.selectItem&&(this.selectItem.selected=!1),this.selectItem=this.display.goodsList.selection,this.selectItem&&(this.selectItem.selected=!0),e>=this.userBag.length-1&&(e=this.userBag.length-1),this.currGood=this.userBag[e],void(this.currGood?(this.display.goodsPic.skin=t.ResPath().getPic(this.currGood.icon_id,t.ResourcePath.PATH_GOODS),this.display.goodsName.text=this.currGood.name,this.display.goodsInfo.text=this.currGood.goods_desc,this.display.goodsDesc.text=this.currGood.effect_desc,this.display.goosNumber.text="数量："+this.currGood.num,this.goodsIndex=e,this.goodsId=this.currGood.id,1==this.currGood.canuse&&t.Util.enable(this.display.useBtn),1==this.currGood.canusebatch?(this.display.throwBtn.label="批量使用",t.Util.enable(this.display.throwBtn)):1==this.currGood.canabandon?(this.display.throwBtn.label="丢 弃",t.Util.enable(this.display.throwBtn)):(this.display.throwBtn.label="批量使用",t.Util.toGrayAndDisabled(this.display.throwBtn))):(this.display.goodsPic.skin="",this.display.goodsName.text="",this.display.goodsInfo.text="",this.display.goodsDesc.text="",this.display.goosNumber.text="")))},n.prototype.tabChange=function(t){this.showTab(t)},n.prototype.showTab=function(e){e!=this.tabIndex&&(this.goodsIndex=0),this.tabIndex=e;var i=this.bagMap.get([1,2,3][e]);if(this.userBag=i,null!=i&&this["_hasGet"+(e+1)]){if(-1!=this._usedId){for(var s=0;s<i.length;s++)i[s].id==this._usedId&&(this.goodsIndex=s);this._usedId=-1}this.goodsIndex>i.length-1&&(this.goodsIndex=i.length-1),this.setListData(i),this.display.goodsList.selectedIndex=this.goodsIndex,this.onSelect(this.goodsIndex)}else this.getGoods([1,2,3][e]);this._pm.on(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdate)},n.prototype.setListData=function(t){t.length=t.length<36?36:t.length,6*Math.ceil(t.length/6),this.display.goodsList.array=t,this.display.goodsList.scrollBar.value=0},n.prototype.onSelect=function(e){var i=this.bagMap.get([1,2,3][this.tabIndex]),s=t.Facade.singleton.model.retrieveModel(t.ModelDef.PACK_MODEL);if(i&&i[e]){var n=s.getPackItem(i[e].id);n&&(n.changeNum=0)}this.display["red"+(this.tabIndex+1)].visible=!1;for(var a=s.getItemsByType(this.tabIndex+1),o=a.length,r=0;o>r;r++){var h=a[r];if(h&&h.changeNum>0){this.display["red"+(this.tabIndex+1)].visible=!0;break}}this.showDetail(e)},n.prototype.onListRender=function(t,e){t.setData(this.display.goodsList.getItem(e),this.display.menuTab.selectedIndex,e,this.display.goodsList.selectedIndex==e)},n.prototype.destroy=function(){this.mouseUpHandler(),this.display.useBtn.off(Laya.Event.MOUSE_DOWN,this,this.onUseGoods),this.display.throwBtn.off(Laya.Event.CLICK,this,this.throwGoods),this._pm.off(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdate);for(var e=1;3>=e;e++)for(var s=this._pm.getItemsByType(e),n=0;n<s.length;n++){var a=s[n];a&&(a.changeNum=0)}this._pm=null,i.prototype.destroy.call(this)},n}(t.BaseBox);t.Bag=i;var s=function(e){function i(){e.call(this),this.red.visible=!1}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.setData=function(e,i,s,n){if(this.goodsIcon.skin="",e){this.bx.visible=!0;var a=t.Facade.singleton.model.retrieveModel(t.ModelDef.PACK_MODEL).getPackItem(e.id);a?this.red.visible=a.changeNum>0:this.red.visible=!1,this.bgEmpty.visible=!1,n?(this.bgNormal.visible=!1,this.bgSelected.visible=!0):(this.bgNormal.visible=!0,
this.bgSelected.visible=!1),this.mouseEnabled=!0,this._curData=e,this._curIndex=i,this.goodsNum.text=e.num>9999?"9999+":e.num,this.goodsIcon.skin=t.ResPath().getPic(e.icon_id,t.ResourcePath.PATH_GOODS)}else this.bx.visible=!1,this.red.visible=!1,this.bgEmpty.visible=!0,this.mouseEnabled=!1},Object.defineProperty(i.prototype,"selected",{set:function(t){t?(this.bgSelected.visible=!0,this.red.visible=!1,this.bgNormal.visible=!1):(this.bgSelected.visible=!1,this.bgNormal.visible=!0)},enumerable:!0,configurable:!0}),i}(ui.bag.GoodsListItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"BagCommand":var i=new t.Bag;i.show(),e.ecode=0,e.finish();break;case"GoodsUseCmd":var s=new t.UseGoods(e);s.show()}},s.prototype.getPluginName=function(){return e.PLUGIN_BAG},s}(t.Plugin);t.BagModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i){e.call(this,new ui.shop.BuyUI,!0,!0,!1,!1),this.goodsId=0,this.progressLength=0,this.canUseNum=0,this.display=this.skin,this.name="BuyBox",this.cmd=i,this.goodsData=i.goods,this.userModel=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),this.display.subDetail.text="",this.display.title.text="批量使用",this.display.confirmBtn.label="使 用",this.goodsId=i.goods.id,this.init()}return __extends(i,e),i.prototype.init=function(){this.showDetail(),this.display.cancelBtn.on(laya.events.Event.CLICK,this,this.destroy),this.display.confirmBtn.on(laya.events.Event.CLICK,this,this.use),this.display.subBtn.on(laya.events.Event.MOUSE_DOWN,this,this.doBtnKeyDown,[-1]),this.display.addBtn.on(laya.events.Event.MOUSE_DOWN,this,this.doBtnKeyDown,[1]),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.doBtnKeyUp),this.display.numSlider.changeHandler=new Handler(this,this.onStartDrag),this.display.numSlider.showLabel=!1},i.prototype.showDetail=function(){this.canUseNum=this.goodsData.num,this.display.goodsName.text=this.goodsData.name,this.display.goodsPic.skin=t.ResPath().getPic(this.goodsData.icon_id,t.ResourcePath.PATH_GOODS),this.display.goodsDesc.text=this.goodsData.goods_desc+this.goodsData.effect_desc,this.progressLength=this.display.numValue.width,this.display.numSlider.max=this.canUseNum,this.setNum(1)},i.prototype.doBtnKeyDown=function(t){this.numAdd(t),Laya.timer.loop(200,this,this.numAdd,[t])},i.prototype.doBtnKeyUp=function(){Laya.timer.clear(this,this.numAdd),this.destroyed||(this.display.subBtn.state=1,this.display.addBtn.state=1)},i.prototype.numAdd=function(t){var e=this.display.numSlider.value;e+=t,this.setNum(e)},i.prototype.setNum=function(t){console.log(t),t=0==t?1:t,this.display.numSlider.value=t,t=this.display.numSlider.value,this.display.numValue.value=t/this.canUseNum,this.display.numSlider.value=t,this.display.subDetail.text="已选择"+t+"个"},i.prototype.use=function(){this._useNum=this.display.numSlider.value,this._useId=this.goodsId+"",5==this.goodsData.goods_type?t.XHR().Post({cmd:"storage",op:"exchange",exid:this.goodsData.target_url.split("|")[1],times:this._useNum},this,this.useRet):t.XHR().Post({cmd:"storage",op:"batch",num:this._useNum,id:this._useId},this,this.useRet)},i.prototype.useRet=function(e){this.destroyed||0!=e.result?5==this.goodsData.goods_type&&-1!=e.msg.indexOf("不足")?t.WeakTips.show("兑换失败，斗豆不足！"):t.WeakTips.show("使用"+e.msg):(t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0,"获得物品")),this.cmd.ecode=0,this.cmd.finish(),this.destroy())},i.prototype.onStartDrag=function(t){this.setNum(t)},i.prototype.destroy=function(){this.cmd.off(),this.cmd=null,Laya.stage.off(Laya.Event.MOUSE_UP,this,this.doBtnKeyUp),e.prototype.destroy.call(this)},i}(t.BaseBox);t.UseGoods=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"BuffCommand":if(t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).level<6)t.WeakTips.show("玩家6级开启状态功能");else{var i=new t.BuffView;i.show()}}},s.prototype.getPluginName=function(){return e.PLUGIN_BUFF},s}(t.Plugin);t.BuffModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.buff.BuffUI,!0,!0),this._display=this.skin,this.setCloseButton(this._display.back.btnClose),this.name="BuffViewBox",this._display.list.itemRender=i,this._display.list.scrollBar.visible=!1,this._display.list.renderHandler=new Handler(this,this.onListRender)}return __extends(s,e),s.prototype.destroy=function(){e.prototype.destroy.call(this)},s.prototype.onShowed=function(){e.prototype.onShowed.call(this),t.XHR().Post({cmd:"detail",op:"status",needreload:"1"},this,this.onStatuInfo)},s.prototype.onStatuInfo=function(e){if(0==e.result){var i=new Date;s.curTime=Math.floor(i.getTime()/1e3);var n=e.status_info.filter(this.arrFilter);n.sort(this.sortCompare),this._display.list.array=n,t.dispatch(s.BUFFVIEW_UPDATE_BUFF,e)}else t.WeakTips.show(e.msg)},s.prototype.arrFilter=function(t){return t.shop_id>0||1==t.has},s.prototype.sortCompare=function(t,e){var i=t.sortid,s=e.sortid;return i>s?1:s>i?-1:0},s.prototype.onListRender=function(t,e){t.setData(this._display.list.getItem(e),this._display.list.array)},s.BUFFVIEW_UPDATE_BUFF="BUFFVIEW_UPDATE_BUFF",s.idMap={kStatusQianXin:1,kStatusKuangNu:2,kStatusPower:3,kStatusPhy:4,kStatusSpeed:5,kStatusExp:6,kStatusHP:7},s.curTime=0,s}(t.BaseBox);t.BuffView=e;var i=function(i){function s(){i.call(this),this.getBtn.on(Laya.Event.CLICK,this,this.onClickGet),this.icon.on(Laya.Event.CLICK,this,this.clickTips)}return __extends(s,i),s.prototype.destroy=function(){this.getBtn.off(Laya.Event.CLICK,this,this.onClickGet),this.icon.off(Laya.Event.CLICK,this,this.clickTips),t.Tips.tipsClose(),i.prototype.destroy.call(this)},s.prototype.setData=function(e,i){if(e){switch(this._listData=i,this._curData=e,this.icon.graphics.clear(),this.sellIcon.graphics.clear(),this.icon.loadImage(t.ResPath().getPic(e.id+"",t.ResourcePath.PATH_MINE_BUFF),0,0,90,90),this.iconName.text=e.name,e.type){case 1:this.sysTips.visible=!1,this.numTxt.text=t.DateUtils.subTime(0,e.lv,2),this.getBtn.visible=!0,this.needNum.visible=!0,this.sellIcon.visible=!0;break;case 2:this.sysTips.visible=!1,this.numTxt.text=e.lv+"次",this.getBtn.visible=!0,this.needNum.visible=!0,this.sellIcon.visible=!0;break;case 3:this.sysTips.visible=!0,this.getBtn.visible=!1,this.needNum.visible=!1,this.sellIcon.visible=!1,this.numTxt.text=""}if(8==e.id&&(this.sysTips.visible=!0,this.getBtn.visible=!1,this.needNum.visible=!1,this.sellIcon.visible=!1),0==e.has?(this.unactive.visible=!0,this.numTxt.visible=!1,this.numTxt.text="未激活"):(this.unactive.visible=!1,this.numTxt.visible=!0),e.shop_id>0){var s=t.Facade.singleton.model.retrieveModel(t.ModelDef.SHOP_MODEL);s.getShopItems([e.shop_id],this,this.onGoodsDataBack)}}},s.prototype.onGoodsDataBack=function(e){e&&e.length>0&&(this._goodsData=e[0],this._curData.goods_num>0?(this.sellIcon.loadImage(t.ResPath().getPic(this._goodsData.iconId,t.ResourcePath.PATH_GOODS),0,0,60,60),this.needNum.text=this._curData.goods_num+"/1",this.getBtn.label="     激 活"):(this.sellIcon.loadImage(t.ResPath().getPic("kDouYu",t.ResourcePath.PATH_GOODS),0,0,60,60),this.needNum.text=this._goodsData.price+"",this.getBtn.label="     购 买"))},s.prototype.clickTips=function(){var e,i={};e=this.localToGlobal(new laya.maths.Point(0,0)),i.name=this._curData.name,i.info="效果："+this._curData.desc,1==this._curData.type?0==this._curData.has?i.desc="有效期：未激活":this._curData.lv<60?i.desc="有效期：<一分钟":i.desc="有效期："+t.DateUtils.subTime(0,this._curData.lv,3):2==this._curData.type?i.desc="生效："+this.numTxt.text:i.desc=" ",t.Tips.show(i,e)},s.prototype.onClickGet=function(){if(this._curData)if(t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.CLICK_USE_OR_BUY_BUFF)),this._curData.goods_num>0)this._goodsData&&t.XHR().Post({file:"petpk",cmd:"storage",op:"use",id:this._goodsData.goodsId},this,this.onUseBack);else if(this._goodsData){var e=new t.BuyCommand(this._curData.shop_id);e.on(this,this.onBuyBack),t.Facade.callCommand(e)}},s.prototype.onBuyBack=function(i){i.off(),this._curData.goods_num+=i.num,this.setData(this._curData,this._listData),t.dispatch(e.BUFFVIEW_UPDATE_BUFF,{result:0,status_info:this._listData})},s.prototype.onUseBack=function(i){0==i.result?(t.WeakTips.show("消耗了"+this._goodsData.name+"，激活了"+this._curData.name),t.Facade.callCommand(new t.SyncChangeCmd(i,!1)),i.changed.attrs&&i.changed.attrs.length>0&&e.idMap[i.changed.attrs[0].id]&&(1==this._curData.type?this._curData.lv+=3600*i.changed.attrs[0].num:2==this._curData.type&&(this._curData.lv+=i.changed.attrs[0].num),this._curData.has=1,this._curData.goods_num--,this.setData(this._curData,this._listData),t.dispatch(e.BUFFVIEW_UPDATE_BUFF,{result:0,status_info:this._listData}))):t.WeakTips.show(i.msg)},s}(ui.buff.BuffItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.ani.bone.Templet,i=function(i){function s(e){i.call(this,new ui.CgDemoUI),this._wordIndex=0,this._resComplete=!1,this._dramaEnd=!1,this._enterGame=!1,this.m_ui=this.skin,this.m_ui.leftSp.visible=!1,this.m_ui.rightSp.visible=!1,this.m_ui.blackScreen.visible=!1,this.m_ui.endWord.visible=!1,this.m_ui.wordTxt.visible=!1,this.m_ui.wordBg.visible=!1,this._sex=t.Global.isBoy?"male":"female",this._monent=1,this._isActive=!0,this._cmd=e,this._skillArr=[],this._skillArr.push(new t.WeaponData(8,10)),this._skillArr.push(new t.SkillData(1,10)),this._skillArr.push(new t.SkillData(2,10)),this._skillArr.push(new t.SkillData(9,10)),this._skillArr.push(new t.SkillData(10,10)),this._curIndex=0,this._wordsArr=["曾经，在那个混沌的时代","斗、邪二神的激斗为乐斗世界赢来了千年的繁盛","时至今日，斗神遗宝“无字天书”依然下落不明","而邪神历经千年的轮回，即将破印而出","再临人间……"],this._timeArr=[4e3,6700,11500,5600],this._assets=[],this._assets.push({url:t.ResPath().getFightScene(30008),type:Loader.IMAGE}),this._assets.push({url:t.ResPath().getAnim("xieshen",t.ResourcePath.PATH_NPC),type:Loader.BUFFER}),this._assets.push({url:t.ResPath().getAnim("xieshen",t.ResourcePath.PATH_NPC).replace(".sk",".png"),type:Loader.IMAGE}),this._assets.push({url:t.ResPath().getEffect("54S"),type:Loader.BUFFER}),this._assets.push({url:t.ResPath().getEffect("54S").replace(".sk",".png"),type:Loader.IMAGE}),this._assets.push({url:"assets/skeleton/qq.sk",type:Loader.BUFFER,save:1}),this._assets.push({url:"assets/skeleton/qq.png",type:Loader.IMAGE,save:1}),this._assets.push({url:"assets/word/weapon/weapon.json",type:Loader.ATLAS}),this._assets.push({url:"assets/word/damage/damage.json",type:Loader.ATLAS,save:1}),this._assets.push({url:t.ResPath().getFightWeapon(200008,10),type:Loader.IMAGE,save:1}),this._assets.push({url:t.ResPath().getEffect("suiping"),type:Loader.BUFFER,save:1}),this._assets.push({url:t.ResPath().getEffect("suiping").replace(".sk",".png"),type:Loader.IMAGE,save:1});for(var s,n=0;n<this._skillArr.length;n++)s=this._skillArr[n].skillUrl?this._skillArr[n].skillUrl:this._skillArr[n].sourceUrl,this._assets.push({url:s,type:Loader.BUFFER}),this._assets.push({url:s.replace(".sk",".png"),type:Loader.IMAGE});t.Global.isTest?(t.LoaderBar.singleton.load(this._assets,Handler.create(this,this.onResComplete)),t.LoaderBar.singleton.visible=!1):this._resComplete=!0,this.m_ui.jumpBtn.on(Laya.Event.CLICK,this,this.jumpBtnClick),t.Report.PointReport(t.Global.ReportType,[11]),t.GameSleep().AddFuc(this,this.onGameSleep),window.speedReport&&window.speedReport.add&&window.speedReport.add(13),window.speedReport&&window.speedReport.add&&window.speedReport.add(14)}return __extends(s,i),s.prototype.onGameSleep=function(t){this._isActive=t,t?window.audioAutoPlay?window.audioAutoPlaymuted(t):Laya.SoundManager.playMusic(this._curMusic,1,null,0):window.audioAutoPlay?window.audioAutoPlaymuted(t):Laya.SoundManager.stopMusic()},s.prototype.showJumpBtn=function(){this.m_ui&&0==this.m_ui.jumpBtn.visible&&(this.m_ui.jumpBtn.visible=!0,Laya.timer.once(5e3,this,this.hideJumpBtn))},s.prototype.hideJumpBtn=function(){this.m_ui.jumpBtn.visible=!1},s.prototype.jumpBtnClick=function(){t.Global.isTest&&1==this._monent?(this._drama.stop(),this._isActive&&(window.audioAutoPlay?(this._curMusic=t.ResVersionControl.handelVersionUrl(t.ResPath().getSound("fight")),window.audioAutoPlay(this._curMusic)):(this._curMusic=t.ResPath().getSound("fight"),Laya.SoundManager.playMusic(this._curMusic,1,null,0)))):this.delayClose()},s.prototype.destroy=function(){this.m_ui.jumpBtn.off(Laya.Event.CLICK,this,this.jumpBtnClick),i.prototype.destroy.call(this),this._drama=null,this._dramaTem=null},s.prototype.onShowed=function(){this._dramaTem=new e,this._dramaTem.once(Laya.Event.COMPLETE,this,this.onDramaLoad),this._dramaTem.loadAni(t.ResPath().getEffect("kcdh"))},s.prototype.onDramaLoad=function(){this._cmd.finish(),this._drama=this._dramaTem.buildArmature(0),this._drama.x=667,this._drama.y=375,this._drama.playbackRate(.56),this.m_ui.addChildAt(this._drama,0),this._drama.play(0,!1),this._drama.once(Laya.Event.STOPPED,this,this.onStop),window.audioAutoPlay?(this._curMusic=t.ResVersionControl.handelVersionUrl("assets/sound/cg.mp3"),window.audioAutoPlay(this._curMusic)):(this._curMusic="assets/sound/cg.mp3",Laya.SoundManager.playMusic("assets/sound/cg.mp3",1,null,0)),Laya.timer.once(4e3,this,this.showWord)},s.prototype.showWord=function(){this.m_ui.wordTxt.visible=!0,this.m_ui.wordBg.visible=!0,this.m_ui.wordTxt.text=this._wordsArr[this._wordIndex],this._wordIndex++,this._wordIndex<this._wordsArr.length&&Laya.timer.once(this._timeArr[this._wordIndex-1],this,this.showWord)},s.prototype.playMusic=function(){Laya.SoundManager.playMusic("assets/sound/cg.mp3",1,null,0)},s.prototype.onResComplete=function(){t.Report.PointReport(t.Global.ReportType,[12]),t.LoaderBar.singleton.visible=!0,this._resComplete=!0,this._dramaEnd&&this.playAni()},s.prototype.onStop=function(){this._dramaEnd=!0,this._resComplete?t.Global.isTest?this.playAni():this.delayClose():t.LoaderBar.singleton.visible=!0},s.prototype.playAni=function(){t.Report.PointReport(t.Global.ReportType,[4]),this._monent=2,this.m_ui.removeChild(this._drama),Laya.timer.frameOnce(1,this,this.destroySke,[this._drama,this._dramaTem]);var i=new Laya.Sprite;this.m_ui.playerLayer.addChild(i),i.loadImage(t.ResPath().getFightScene(30008)),this._xieshenTemplet=new e,this._xieshenTemplet.once(Laya.Event.COMPLETE,this,this.onXieshenLoad),this._xieshenTemplet.loadAni(t.ResPath().getAnim("xieshen",t.ResourcePath.PATH_NPC)),this._doushenTemplet=new e,this._doushenTemplet.once(Laya.Event.COMPLETE,this,this.onDoushenLoad),this._doushenTemplet.loadAni("assets/skeleton/qq.sk")},s.prototype.onXieshenLoad=function(){this._xieshen=this._xieshenTemplet.buildArmature(1),this._xieshen.play(this._curXieshenAct="act_enter",!1),this._xieshen.x=290,this._xieshen.y=640,this.m_ui.playerLayer.addChildAt(this._xieshen,1),this._xieshen.on(Laya.Event.STOPPED,this,this.onXieshenAni),this._xieshen.on(Laya.Event.LABEL,this,this.onXieshenLabel)},s.prototype.onDoushenLoad=function(){this._doushen=this._doushenTemplet.buildArmature(1),this._doushen.showSkinByName(this._sex),this._doushen.play(this._curDoushenAct="act_breath_3",!1);var e=Laya.Loader.getRes(t.ResPath().getFightWeapon(200008,10));this._doushen.setSlotSkin("wuqi",e),this._doushen.x=1044,this._doushen.y=640,this._doushen.scaleX=-1,this.m_ui.playerLayer.addChild(this._doushen),this._doushen.on(Laya.Event.STOPPED,this,this.onDoushenAni),this._doushen.on(Laya.Event.LABEL,this,this.onDoushenLabel),this._doushen.visible=!1},s.prototype.onXieshenAni=function(){"act_enter"==this._curXieshenAct?this.playEnter():"act_cast"==this._curXieshenAct,this._xieshen.play(this._curXieshenAct="act_idle",!0)},s.prototype.playEnter=function(){this._doushen.visible=!0,this._doushen.x=1844,this._doushen.y=-160,Laya.Tween.to(this._doushen,{x:1044,y:640,rotation:360},500,null,Handler.create(this,this.onEnterEnd))},s.prototype.onEnterEnd=function(){this.m_ui.rightSp.visible=!0,Laya.timer.once(2500,this,this.talk1)},s.prototype.onDoushenAni=function(){"act_warmup"==this._curDoushenAct&&(this.m_ui.rightSp.visible=!0,Laya.timer.once(2500,this,this.talk1)),this._doushen.play(this._curDoushenAct="act_breath_3",!0)},s.prototype.talk1=function(){this.m_ui.leftSp.visible=!0,this.m_ui.rightSp.visible=!1,Laya.timer.once(2500,this,this.talk2)},s.prototype.talk2=function(){this.m_ui.leftSp.visible=!1,this.m_ui.rightSp.visible=!0,this.m_ui.txtR.text="多说无益，我就让你开开眼界～",Laya.timer.once(2e3,this,this.startFight)},s.prototype.talk3=function(){this.m_ui.playerLayer.addChild(this._xieshen),this.m_ui.leftSp.visible=!1,this._xieshen.playbackRate(.5),this._xieshen.play(this._curXieshenAct="act_cast",!1)},s.prototype.startFight=function(){this.m_ui.rightSp.visible=!1,this.playSlill()},s.prototype.onDoushenLabel=function(t){},s.prototype.onXieshenLabel=function(e){"event_effect"==e.name&&(this._xieshenSkill=new t.AnimationSKe(t.ResPath().getEffect("54S")),this._xieshenSkill.play(0,!1),this._xieshenSkill.x=290,this._xieshenSkill.y=640,this.m_ui.playerLayer.addChild(this._xieshenSkill),this._xieshenSkill.on(Laya.Event.LABEL,this,this.onXieshenSkillLabel),this._xieshenSkill.on(Laya.Event.STOPPED,this,this.onXieshenSkillEnd)),"event_hit_default"==e.name&&"event_hit"==this._curHitName&&Laya.timer.callLater(this,this.myCallLater)},s.prototype.onXieshenSkillLabel=function(t){"event_hit"==t.name&&this._doushen.play("act_injure_fly",!1)},s.prototype.onXieshenSkillEnd=function(){this.m_ui.blackScreen.visible=!0,this.m_ui.ani2.play(0,!1),this.m_ui.ani2.on(Laya.Event.COMPLETE,this,this.onEnd)},s.prototype.myCallLater=function(){this._xieshen&&this._xieshen.play(this._curXieshenAct="act_injure",!1,!0,140*(this._xieshen.player.cacheFrameRate/30)*1e3/this._xieshen.player.cacheFrameRate)},s.prototype.onEnd=function(){this.m_ui.endWord.visible=!0,Laya.timer.once(3e3,this,this.delayClose)},s.prototype.delayClose=function(){Laya.timer.clear(this,this.hideJumpBtn),this._drama.off(Laya.Event.STOPPED,this,this.onStop),this.m_ui.endWord.visible=!1,this._enterGame||(t.Report.PointReport(t.Global.ReportType,[5]),window.speedReport&&window.speedReport.add&&window.speedReport.add(15),t.Global.GameMain.CGhasplay=!0,t.JSUtils.setCookie("CGhasplay","1"),t.Global.GameMain.hasreg?(t.Facade.callCommand(new t.StartGuideCommand),t.Facade.callCommand(new t.StartCommonCmd),t.Facade.callCommand(new t.HomeCommand)):t.Global.isTest?t.Facade.callCommand(new t.CgEndCommand):(t.JSUtils.setCookie("hasreg","1"),t.JSUtils.setCookie("gamereg","1"),t.Global.GameMain.reload(!0)),this._enterGame=!0)},s.prototype.playSlill=function(){if(this._curIndex<this._skillArr.length){var i=this._skillArr[this._curIndex];i instanceof t.WeaponData?this._doushen.visible=!1:2==i.type?this._doushen.visible=!1:(this._doushen.visible=!0,this._doushen.play(this._curDoushenAct="act_cast_1",!1)),this._curName=i.name,this._curIndex++,this._skillTemplet=new e,this._skillTemplet.once(Laya.Event.COMPLETE,this,this.onSkillLoad,[i]),this._skillTemplet.loadAni(i.skillUrl?i.skillUrl:i.sourceUrl)}else this.m_ui.leftSp.visible=!0,this.m_ui.rightSp.visible=!1,this.m_ui.txtL.text="花拳绣腿，不值一提",Laya.timer.once(2e3,this,this.talk3)},s.prototype.onSkillLoad=function(t){this._skillSkelton=this._skillTemplet.buildArmature(1),this._skillSkelton.showSkinByName(this._sex),this._skillSkelton.x=1044,this._skillSkelton.y=640,this._skillSkelton.scaleX=-1,t.action?this._skillSkelton.play(t.action,!1):this._skillSkelton.play(0,!1),this.floatNameWord(this._curName),this.m_ui.playerLayer.addChild(this._skillSkelton),this._skillSkelton.on(Laya.Event.STOPPED,this,this.onSkillStop),this._skillSkelton.on(Laya.Event.LABEL,this,this.onSkillLabel)},s.prototype.onSkillLabel=function(t){this._curHitName=t.name,"event_hit"==t.name&&(this._xieshen.play(this._curXieshenAct="act_injure",!1),this.floatDemageWord()),"event_hit_start"==t.name&&(this._xieshen.play(this._curXieshenAct="act_injure",!1),this.floatDemageWord()),"event_hit_end"==t.name&&Laya.timer.callLater(this,this.myCallLater)},s.prototype.onSkillStop=function(){this._doushen.visible=!0,this._skillSkelton.parent.removeChild(this._skillSkelton),this._skillSkelton.off(Laya.Event.STOPPED,this,this.onSkillStop),this._skillSkelton.off(Laya.Event.LABEL,this,this.onSkillLabel),Laya.timer.frameOnce(1,this,this.destroySke,[this._skillSkelton,this._skillTemplet]),this._skillSkelton=null,this._skillTemplet=null,this.playSlill()},s.prototype.destroySke=function(t,e){t.destroy(),e.destroy()},s.prototype.floatNameWord=function(e){if(this._doushen){var i=new t.ImageWord("assets/word/weapon/"),s=-1;this._doushen.parent.parent.addChild(i),i.showWord(""+e,!1,-10),i.x=this._doushen.x-i.imgWidth/2+250*s,i.y=this._doushen.y;var n=Loader.getRes("assets/word/weapon/di.png");n&&(i.graphics.drawTexture(n,(i.imgWidth-n.width)/2+20,(i.imgHeight-n.height)/2),i.showWord(""+e,!1,-10));var a=new Laya.TimeLine;a.to(i,{x:i.x-250*s},300).to(i,{y:i.y+1},2e3).to(i,{alpha:0},500).on(Laya.Event.COMPLETE,this,this.afterFloat,[i]),a.play()}},s.prototype.floatDemageWord=function(){var e=new t.ImageWord("assets/word/damage/"),i=-1;this._xieshen.parent.addChild(e),e.showWord(""+(1e3+Math.floor(9e3*Math.random()))),e.x=this._xieshen.x+-1*i*e.imgWidth/2+(0>i?-1:0)*e.imgWidth,e.y=this._xieshen.y-180;var s=new Laya.TimeLine;s.to(e,{y:e.y-1},300/t.FightController.TIME_SCALE).to(e,{y:e.y-100,alpha:0},1e3/t.FightController.TIME_SCALE).once(Laya.Event.COMPLETE,this,this.afterFloat,[e]),s.play()},s.prototype.afterFloat=function(t){t&&t.parent&&(t.parent.removeChild(t),t.destroy())},s.prototype.onHided=function(){t.GameSleep().RemoveFuc(this,this.onGameSleep),this.releaseRes(),Laya.timer.frameOnce(2,this,this.destroy),window.audioAutoPlay&&window.audioAutoPlay("")},s.prototype.releaseRes=function(){this._xieshen&&this._doushen&&(this._doushen.stop(),this._xieshen.stop(),this._doushen.parent.removeChild(this._doushen),this._xieshen.parent.removeChild(this._xieshen)),Laya.timer.frameOnce(1,this,this.delayClear)},s.prototype.delayClear=function(){this._xieshen&&this._doushen&&(this._doushen.destroy(),this._xieshen.destroy(),this._xieshenTemplet.destroy(),this._doushenTemplet.destroy(),this._doushen=null,this._xieshen=null,this._xieshenTemplet=null,this._doushenTemplet=null),this._xieshenSkill&&(this._xieshenSkill.destroy(),this._xieshenSkill=null),this._drama&&this._dramaTem&&!this._drama.destroyed&&(this._drama.destroy(),this._dramaTem.destroy(),this._drama=null,this._dramaTem=null),this._skillSkelton&&this._skillTemplet&&(this._skillSkelton.destroy(),this._skillTemplet.destroy(),this._skillSkelton=null,this._skillTemplet=null),Laya.loader.clearRes("ui/cg/wordBg.png");for(var t=0;t<this._assets.length;t++)this._assets[t].save||Laya.loader.clearRes(this._assets[t].url)},s.prototype.getSceneName=function(){return t.SceneDef.CG_SCENE},s}(t.BaseScene);t.CgDemo=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.CgEndUI),this.m_ui=this.skin,this.m_ui.enterBtn.on(Laya.Event.CLICK,this,this.enterGame),this.m_ui.quitBtn.on(Laya.Event.CLICK,this,this.quitGame),this.m_ui.cg_bg.skin=t.Global.isTest?"http://res.ledou.qq.com/tencent-logo.jpg":"/page/image/"+t.Global.PF+"_loading.jpg?_offine=1",t.JSUtils.setCookie("hasreg","1"),t.JSUtils.setCookie("CGhasplay","1")}return __extends(i,e),i.prototype.enterGame=function(){t.JSUtils.setCookie("gamereg","1"),t.JSUtils.setCookie("policyplay","1"),t.Global.GameMain.reload(!0)},i.prototype.quitGame=function(){window.mqq?mqq.invoke("ui","closeWebViews"):t.Global.isWX?wegame.invokeJsapi("closeWindow",{},function(t){}):window.open("about:blank","_self").close()},i.prototype.destroy=function(){e.prototype.destroy.call(this)},i}(t.BaseBox);t.CgEnd=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){Laya.SoundManager.stopMusic()},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"CgCommand":var i=new t.CgDemo(e);t.SceneMgr.changeScene(i,!1),t.Logger.log("新手阶段-显示CG："+t.ServerClock.getServerTime()),e.ecode=0;break;case"CgEndCommand":var s=new t.CgEnd;s.show(),t.Logger.log("新手阶段-显示CG："+t.ServerClock.getServerTime()),e.ecode=0,e.finish()}},s.prototype.getPluginName=function(){return e.PLUGIN_CG},s}(t.Plugin);t.CgModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.chain.ChainChangeNameUI,!0,!1),this.m_ui=this.skin,this.setCloseButton(this.m_ui.boxClose),this._isFirst=!0,this.m_ui.confirmBtn.on(Laya.Event.CLICK,this,this.onClickConfirm)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.onShowed=function(){e.prototype.onShowed.call(this),this._isFirst?this._isFirst=!1:this.resetImageSkin(this),this.m_ui.inputTxt.text=""},i.prototype.onHided=function(){e.prototype.onHided.call(this)},i.prototype.update=function(t){this._curData=t},i.prototype.onClickConfirm=function(){""!=this.m_ui.inputTxt.text?t.XHR().Post({cmd:"chain",op:"setname",plan_idx:this._curData.idx,name:this.m_ui.inputTxt.text},this,this.onChangeName):t.WeakTips.show("名称不能为空")},i.prototype.onChangeName=function(e){0==e.result?(this._curData.name=this.m_ui.inputTxt.text,1==this._curData.status&&(t.ChainView.curData.plan_name=this._curData.name),t.WeakTips.show("修改成功"),t.dispatch(t.ChainView.CHAIN_VIEW_CHANGE_NAME),this.hide()):t.WeakTips.show(e.msg)},i}(t.BaseBox);t.ChainChangeNameView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.redIcon.visible=!1,t.addListener(t.ChainView.CHAIN_VIEW_CHAIN_UPDATE,this,this.updateChain)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),t.removeListener(t.ChainView.CHAIN_VIEW_CHAIN_UPDATE,this,this.updateChain)},i.prototype.update=function(e,i){i?(this._curChainData=i,this.updateChain(),this.demageTxt.text="连锁伤害:"+e.chain_view.damage):t.Logger.log("不存在chainData")},i.prototype.updateView=function(){},i.prototype.updateChain=function(){for(var e=0;5>e;e++)t.ChainView.curData.chain_view.attr[e]?(this["attr"+e].visible=!0,this["attr"+e].text=t.ChainView.curData.chain_view.attr[e].attr_desc):this["attr"+e].visible=!1;if(this._curChainData)for(var e=0;4>e;e++)this._curChainData.slot_array&&this._curChainData.slot_array[e]&&this["weapon"+e].update(this._curChainData.slot_array[e],this._curChainData.level,e)},i}(ui.chain.ChainDetailUI);t.ChainDetailView=e;var i=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.update=function(t,e,i){this.indexIcon.skin="ui/chain/"+i+".png",this.desc.text="【密卷技能:"+t.name+"  等级:"+e+"】"+t.desc,e>=t.open_level?0==t.trigger?this.levelTxt.text="（未解锁，装备武器不足)":this.levelTxt.text="【触发率："+t.trigger+"%】":this.levelTxt.text="（未解锁，密卷达到"+t.open_level+"级后解锁）"},e}(ui.chain.ChainSkillDescUI);t.ChainSkillDesc=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){s.shopIdMap={100096:100040,100097:100041,100098:100042,100099:100043,100114:100047,100116:100048,100134:100066,100136:100067}},s.prototype.doCommand=function(e){switch(e.type){case"main":var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL);i.level>=15?t.XHR().Post({cmd:"chain",op:"index",full:1},this,this.onSendResult):t.WeakTips.show("15级开放密卷！");break;case"program":t.XHR().Post({cmd:"chain",op:"viewplan"},this,this.onViewPlan);break;case"weapon":this._selectWeapon||(this._selectWeapon=new t.ChainSelectWeaponView),this._selectWeapon.show();break;case"name":this._changeName||(this._changeName=new t.ChainChangeNameView),this._changeName.show(),this._changeName.update(e.data)}},s.prototype.onSendResult=function(e){0==e.result?(this._panel&&!t.Global.isWXAPP||(this._panel=new t.ChainView),t.SceneMgr.changeScene(this._panel),this._panel.updatePanel(e)):t.WeakTips.show(e.msg)},s.prototype.onViewPlan=function(e){0==e.result?(this._program&&!t.Global.isWXAPP||(this._program=new t.ChainProgramView),this._program.show(),this._program.updatePanel(e)):t.WeakTips.show(e.msg)},s.prototype.getPluginName=function(){return e.PLUGIN_CHAIN},s}(t.Plugin);t.ChainModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.chain.ChainProgrammeUI,!0,!1),this.m_ui=this.skin,this.setCloseButton(this.m_ui.back.closeBtn),this._isFirst=!0}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.onShowed=function(){e.prototype.onShowed.call(this),this._isFirst?this._isFirst=!1:this.resetImageSkin(this)},i.prototype.onHided=function(){e.prototype.onHided.call(this);for(var i=0;3>i;i++)if(this._curData.plan_list&&this._curData.plan_list[i]&&1==this._curData.plan_list[i].status){this._curProgramIdx!=this._curData.plan_list[i].idx&&t.dispatch(t.ChainView.CHAIN_VIEW_UPDATE_INDEX);break}},i.prototype.updatePanel=function(t){this._curData=t;for(var e=0;3>e;e++)t.plan_list&&t.plan_list[e]&&(this.m_ui["item"+e].update(t.plan_list[e]),1==t.plan_list[e].status&&(this._curProgramIdx=t.plan_list[e].idx))},i}(t.BaseBox);t.ChainProgramView=e;var i=function(e){function i(){e.call(this),this.list.itemRender=s,this.list.scrollBar.visible=!1,this.tips.visible=!1,this.list.renderHandler=new Handler(this,this.onListRender),this.btn.on(Laya.Event.CLICK,this,this.onClick),this.changeBtn.on(Laya.Event.CLICK,this,this.onClickChange),t.addListener(t.ChainView.CHAIN_VIEW_SWITH_PROGRAM,this,this.onSwithProgram),t.addListener(t.ChainView.CHAIN_VIEW_CHANGE_NAME,this,this.updateChangeName)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),t.removeListener(t.ChainView.CHAIN_VIEW_SWITH_PROGRAM,this,this.onSwithProgram),t.removeListener(t.ChainView.CHAIN_VIEW_CHANGE_NAME,this,this.updateChangeName)},i.prototype.updateChangeName=function(){this._curData&&(this.planName.text="方案名称："+this._curData.name);
},i.prototype.update=function(t){this._curData=t,this.planName.text="方案名称："+t.name;var e=t.chain_list.filter(this.arrFilter);this.list.array=e,e.length>0?this.tips.visible=!1:this.tips.visible=!0,1==t.status?this.btn.label="使用中":this.btn.label="切 换"},i.prototype.arrFilter=function(t){if(t.weapons&&t.weapons.length>0)for(var e=0;e<t.weapons.length;e++)if(t.weapons[e].weapon_id>0)return!0;return t.chain_id>0},i.prototype.onClick=function(){"使用中"==this.btn.label?t.WeakTips.show("已在使用中"):t.XHR().Post({cmd:"chain",op:"switch",plan_idx:this._curData.idx},this,this.onSwitch)},i.prototype.onSwitch=function(e){0==e.result?(t.WeakTips.show("切换成功"),t.dispatch(t.ChainView.CHAIN_VIEW_SWITH_PROGRAM,this._curData.idx)):t.WeakTips.show(e.msg)},i.prototype.onSwithProgram=function(t){this._curData&&this._curData.idx==t?(this.btn.label="使用中",this._curData.status=1):(this.btn.label="切 换",this._curData.status=0)},i.prototype.onClickChange=function(){t.Facade.callCommand(new t.ChainCommand("name",this._curData))},i.prototype.onListRender=function(t,e){t.setData(this.list.getItem(e))},i}(ui.chain.ChainProgramItemUI);t.ChainProgramItem=i;var s=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.setData=function(e){this.skillIcon.graphics.clear(),e.chain_id>0&&this.skillIcon.loadImage(t.ResPath().getPic(e.chain_id,t.ResourcePath.PATH_CHAIN),0,0,80,80);var i=t.ChainView.volumeDataMap[e.chain_id];if(i?(this.volumeName.text=i.name,this.power.text=i.fightpower):(this.volumeName.text="",this.power.text=""),e.weapons)for(var s=0;4>s;s++)e.weapons&&e.weapons[s]&&this["weapon"+s].update(e.weapons[s],e.level)},i}(ui.chain.ChainProgramChainUI);t.ChainProgramVolume=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.chain.ChainSelectWeaponUI,!0,!1),this.m_ui=this.skin,this.setCloseButton(this.m_ui.back.closeBtn),this._isFirst=!0,this.name="ChainSelectWeaponView",this.m_ui.list.itemRender=s,this.m_ui.list.scrollBar.visible=!1,this.m_ui.list.renderHandler=new Handler(this,this.onListRender),t.addListener(t.ChainView.CHAIN_VIEW_SELECT_SLOT,this,this.onClickSlot),t.addListener(t.ChainView.CHAIN_VIEW_SELECT_WEAPON,this,this.onSelectWeapon),t.addListener(t.ChainView.CHAIN_VIEW_PUT_DOWN_WEAPON,this,this.onPutDownWepon)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),t.removeListener(t.ChainView.CHAIN_VIEW_SELECT_SLOT,this,this.onClickSlot),t.removeListener(t.ChainView.CHAIN_VIEW_SELECT_WEAPON,this,this.onSelectWeapon),t.removeListener(t.ChainView.CHAIN_VIEW_PUT_DOWN_WEAPON,this,this.onPutDownWepon)},i.prototype.onShowed=function(){e.prototype.onShowed.call(this),this._isFirst?this._isFirst=!1:this.resetImageSkin(this),this.updatePanel()},i.prototype.onHided=function(){e.prototype.onHided.call(this)},i.prototype.onListRender=function(t,e){t.setData(this.m_ui.list.getItem(e))},i.prototype.updatePanel=function(){this.m_ui.tips.visible=!1;var e=t.ChainView.volumeDataMap[t.ChainView.curChainId];if(this._tempUseWeapon={},e){if(e.slot_array)for(var i=0;4>i;i++)this.m_ui["weapon"+i].update(e.slot_array[i],e.level);this.m_ui.weapon0.onClickItem()}this.updateBtn()},i.prototype.updateBtn=function(){for(var e=0,i=0;4>i;i++)this.m_ui["weapon"+i].curWeaponId>0&&e++;e>=2?(this.m_ui.saveBtn.on(Laya.Event.CLICK,this,this.onSave),this.m_ui.saveBtn.filters=null):(this.m_ui.saveBtn.off(Laya.Event.CLICK,this,this.onSave),this.m_ui.saveBtn.filters=t.FiltersUtils.getGreyFilters());var s=t.ChainView.volumeDataMap[t.ChainView.curChainId];0==s.status?(this.m_ui.cancleBtn.off(Laya.Event.CLICK,this,this.onCancle),this.m_ui.cancleBtn.filters=t.FiltersUtils.getGreyFilters()):(this.m_ui.cancleBtn.on(Laya.Event.CLICK,this,this.onCancle),this.m_ui.cancleBtn.filters=null)},i.prototype.onClickSlot=function(e){this._curIndex=e.slot_idx,this._curSlotWeaponId=this.m_ui["weapon"+e.slot_idx].curWeaponId;for(var i=[],s=t.ChainView.weaponArr,n=0;n<s.length;n++)t.ChainView.useWeaponMap[s[n].id]&&2!=this._tempUseWeapon[s[n].id]||1==this._tempUseWeapon[s[n].id]||i.push(s[n]);this.m_ui.list.array=i,i.length>0?this.m_ui.tips.visible=!1:this.m_ui.tips.visible=!0},i.prototype.onCancle=function(){t.XHR().Post({cmd:"chain",op:"setplan",chain_id:t.ChainView.curChainId,type:1},this,this.onCancleRet)},i.prototype.onCancleRet=function(e){if(0==e.result){t.WeakTips.show("密卷已经卸载");var i=t.ChainView.volumeDataMap[t.ChainView.curChainId];if(i)for(var s=0;s<i.slot_array.length;s++)t.ChainView.useWeaponMap[i.slot_array[s].weapon_id]=!1,i.slot_array[s].weapon_id=0;i.status=0,this.updatePanel(),t.dispatch(t.ChainView.CHAIN_VIEW_CHAIN_UPDATE),this.hide()}else t.WeakTips.show(e.msg)},i.prototype.onSave=function(){t.XHR().Post({cmd:"chain",op:"setweapon",chain_id:t.ChainView.curChainId,weapons:this.getWeaponsStr()},this,this.onSaveRet)},i.prototype.getWeaponsStr=function(){for(var t="",e=0;4>e;e++)t+=3!=e?this.m_ui["weapon"+e].curWeaponId+"|":this.m_ui["weapon"+e].curWeaponId;return t},i.prototype.onSaveRet=function(e){if(0==e.result){t.WeakTips.show("配置成功");var i=t.ChainView.volumeDataMap[t.ChainView.curChainId];if(i)for(var s=0;s<i.slot_array.length;s++)t.ChainView.useWeaponMap[i.slot_array[s].weapon_id]=!1,t.ChainView.useWeaponMap[this.m_ui["weapon"+s].curWeaponId]=!0,i.slot_array[s].weapon_id=this.m_ui["weapon"+s].curWeaponId;i.status=1,e.chain_view&&(t.ChainView.curData.chain_view=e.chain_view),t.dispatch(t.ChainView.CHAIN_VIEW_CHAIN_UPDATE),t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.CLICK_CHAIN_SAVE_WEAPON)),this.showDemoFight(),this.hide()}else t.WeakTips.show(e.msg)},i.prototype.showDemoFight=function(){var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL);if(15==e.level){var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);if(0==i.getLongDataValue(t.ServerSetDataModel.KEY_CHAIN_GUIDE_FIGHT)){i.setLongDataValue(t.ServerSetDataModel.KEY_CHAIN_GUIDE_FIGHT,1);var s=new t.PlayDramaCmd("1052");s.on(this,this.onDramaFinish),t.Facade.callCommand(s)}}},i.prototype.onDramaFinish=function(e){if("1052"==e.id){e.off();for(var i=t.ChainView.volumeDataMap[t.ChainView.curChainId],s=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),n=t.ChainView.weaponArr,a="",o=0;o<n.length;o++)a+=o<n.length-1?n[o].id-2e5+"_"+n[o].level+"|":n[o].id-2e5+"_"+n[o].level;var r=i.slot_array[0].weapon_id-2e5,h=i.slot_array[1].weapon_id-2e5,l="&V:1;&Ty:1;&BG:30004;&TL:1;PL1:"+s.uid+",0|0,"+s.sex+",,"+s.name+","+s.level+",0,3450|3450,,,"+a+",11_0|2_0,;&TR:1;PR1:479881,0|0,2,,汪淑然,7,0,3690|3690,http%3A%2F%2Fqlogo1.store.qq.com%2Fqzone%2F490097307%2F490097307%2F100,,12_0|9_0,2_0|11_0|52_0,;&BN:1;&BT1:1,1;RN:2;R1:3;A1:L,0|1,0,1,"+r+",0,800,2,,,,R,0,0,0,0,,,,;A2:L,0|1,0,1,"+h+",0,750,2,,,,R,0,0,0,0,,,,;A3:L,0|2,0,1,78,2,0,,,4*78*l,,R,0,0,0,0,,,,;R2:1;A1:L,0|0,0,1,0,0,2200,2,,,,R,0,0,0,0,,,,;&RLT:1;";t.FightModule.isChainDrama=!0,t.once(t.FightStaticStr.FIGHT_COMPLETE,this,this.onFightEnd),t.Facade.callCommand(new t.FightCommand(l))}},i.prototype.onFightEnd=function(){var e=new t.PlayDramaCmd("1055");t.Facade.callCommand(e),t.Facade.callCommand(new t.HomeCommand)},i.prototype.onSelectWeapon=function(e){for(var i=this.m_ui.list.array,s=0;s<i.length;s++)if(i[s].id==e){this._tempUseWeapon[i[s].id]=1,i.splice(s,1);break}this._curSlotWeaponId>0&&t.ChainView.weaponMap[this._curSlotWeaponId]&&(this._tempUseWeapon[this._curSlotWeaponId]=2,i.push(t.ChainView.weaponMap[this._curSlotWeaponId])),this._curSlotWeaponId=e,this.m_ui.list.array=i;var n=this._curIndex+1;4>n&&this.m_ui["weapon"+n].onClickItem(),this.updateBtn()},i.prototype.onPutDownWepon=function(){var e=this.m_ui.list.array;this._curSlotWeaponId>0&&t.ChainView.weaponMap[this._curSlotWeaponId]&&(this._tempUseWeapon[this._curSlotWeaponId]=2,e.push(t.ChainView.weaponMap[this._curSlotWeaponId])),this._curSlotWeaponId=0,this.m_ui.list.array=e},i}(t.BaseBox);t.ChainSelectWeaponView=e;var i=function(e){function i(){e.call(this),this.curWeaponId=0,t.addListener(t.ChainView.CHAIN_VIEW_SELECT_SLOT,this,this.onClickSlot),t.addListener(t.ChainView.CHAIN_VIEW_SELECT_WEAPON,this,this.onSelectWeapon)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),t.removeListener(t.ChainView.CHAIN_VIEW_SELECT_SLOT,this,this.onClickSlot),t.removeListener(t.ChainView.CHAIN_VIEW_SELECT_WEAPON,this,this.onSelectWeapon)},i.prototype.update=function(e,i){if(this._curData=e,this.selectIcon.visible=!1,this.icon.graphics.clear(),e.weapon_id>0){var s=e.weapon_id,n=t.ChainView.weaponMap[s]?t.ChainView.weaponMap[s].level:1;this.icon.loadImage(t.ResPath().getPic(s,t.ResourcePath.PATH_WEAPON,n),0,0,70,70)}else i>=e.open_level||this.icon.loadImage("ui/chain/weaponlock.png",0,0,70,70);this.curWeaponId=e.weapon_id,i>=e.open_level?(this.weaponTxt.visible=!1,this.filters=null,this.on(Laya.Event.CLICK,this,this.onClickItem)):(this.weaponTxt.visible=!0,this.filters=t.FiltersUtils.getGreyFilters(),this.off(Laya.Event.CLICK,this,this.onClickItem),this.weaponTxt.text="密卷"+e.open_level+"级开放")},i.prototype.onClickItem=function(){!this._curData||this.selectIcon.visible||this.weaponTxt.visible?this._curData&&this.selectIcon.visible&&this.curWeaponId>0&&(this.curWeaponId=0,this.icon.graphics.clear(),t.dispatch(t.ChainView.CHAIN_VIEW_PUT_DOWN_WEAPON,this._curData)):t.dispatch(t.ChainView.CHAIN_VIEW_SELECT_SLOT,this._curData)},i.prototype.onClickSlot=function(t){this._curData&&this._curData.slot_idx==t.slot_idx?this.selectIcon.visible=!0:this.selectIcon.visible=!1},i.prototype.onSelectWeapon=function(e){if(this.selectIcon.visible){this.curWeaponId=e,this.icon.graphics.clear();var i=t.ChainView.weaponMap[this.curWeaponId]?t.ChainView.weaponMap[this.curWeaponId].level:1;this.icon.loadImage(t.ResPath().getPic(this.curWeaponId,t.ResourcePath.PATH_WEAPON,i),0,0,70,70)}},i}(ui.chain.ChainWeaponItemUI);t.ChainWeaponItem=i;var s=function(e){function i(){e.call(this),this.on(Laya.Event.CLICK,this,this.onClick)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.setData=function(e){if(e){this._curData=e,this.weaponName.text=e.name+"(等级："+e.level+")",this.icon.graphics.clear();var i=e.id,s=t.ChainView.weaponMap[i]?t.ChainView.weaponMap[i].level:1;this.icon.loadImage(t.ResPath().getPic(e.id,t.ResourcePath.PATH_WEAPON,s),0,0,80,80),this.descTxt.text=e.desc}},i.prototype.onClick=function(){this._curData&&(t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.CLICK_CHAIN_WEAPON)),t.dispatch(t.ChainView.CHAIN_VIEW_SELECT_WEAPON,this._curData.id))},i}(ui.chain.ChainWeaponDescUI);t.ChainWeaponDesc=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.update=function(e,i,s){if(this._curData=e,this.needRedTips=!1,this._status=s,this._curData)if(this.icon.graphics.clear(),e.weapon_id>0){var n=t.ChainView.weaponMap[e.weapon_id]?t.ChainView.weaponMap[e.weapon_id].level:1;this.icon.loadImage(t.ResPath().getPic(e.weapon_id,t.ResourcePath.PATH_WEAPON,n),0,0,37,37)}else i>=e.open_level?(this._status&&(this.needRedTips=!0),this.icon.loadImage("ui/chain/weapons1.png",0,0,37,37)):this.icon.loadImage("ui/chain/weaponlock.png",0,0,37,37)},i}(ui.chain.ChainSmallWeaponIconUI);t.ChainSmallWeaponIcon=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.chainBar.scrollRect=new Laya.Rectangle(0,0,this.chainBar.width,this.chainBar.height),this.skillBar.scrollRect=new Laya.Rectangle(0,0,this.skillBar.width,this.skillBar.height),this.chainUpBtn.on(Laya.Event.CLICK,this,this.onClickChainUp),this.chainUpBtn.on(Laya.Event.MOUSE_DOWN,this,this.onClickChainMouseDown),this.skillUpBtn.on(Laya.Event.CLICK,this,this.onClickSkillUp),this.skillUpBtn.on(Laya.Event.MOUSE_DOWN,this,this.onClickSkillMouseDown),t.addListener(t.ChainView.CHAIN_VIEW_CHAIN_UPDATE,this,this.updateChain),this.tab.labels="连 锁,技 能",this.tab.selectHandler=new Handler(this,this.onSelectTab),this.tab.selectedIndex=0,this.chainTab.labels="一连锁,二连锁,三连锁",this.chainTab.selectHandler=new Handler(this,this.onSelectChainTab),this.htmlDesc.style.color="#402d1f",this.htmlDesc.style.fontSize=18,this.htmlDesc.style.wordWrap=!0,this.htmlDesc.style.valign="top",this._fightPower=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).realAttackPower}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),t.removeListener(t.ChainView.CHAIN_VIEW_CHAIN_UPDATE,this,this.updateChain),Laya.timer.clear(this,this.onChainTime),Laya.timer.clear(this,this.onClickChainUp),Laya.timer.clear(this,this.onSkillTime),Laya.timer.clear(this,this.onClickSkillUp)},i.prototype.onSelectTab=function(t){0==t?(this.chainBox.visible=!0,this.skillBox.visible=!1):(this.chainBox.visible=!1,this.skillBox.visible=!0)},i.prototype.onSelectChainTab=function(){var e=t.ChainView.curData.chain_view.skill_arr[this.chainTab.selectedIndex];e&&(this.skillName.text=e.name+"（"+t.ChainView.curData.skill_info.level+"级）",this.htmlDesc.innerHTML=t.MonsterView.changeDecHtml(e.desc))},i.prototype.update=function(e,i,s,n){if(void 0===s&&(s=!0),void 0===n&&(n=!0),i){this._chainData=i,this.chainTab.selectedIndex=0,this.onSelectChainTab(),this.skillIcon.skin=t.ResPath().getPic(t.ChainView.curChainId,t.ResourcePath.PATH_CHAIN),this.levelAndName.text="等级："+e.chain_info.level,e.chain_info.level>=t.ChainView.maxLevel?(this.chainUpBtn.gray=!0,this.chainUpBtn.label="已满级"):(this.chainUpBtn.gray=!1,this.chainUpBtn.label="强  化"),s&&(this.chainPower.text=e.chain_info.fightpower),this.chainRate.text=e.chain_info.rate,"中"==e.chain_info.rate?this.chainRate.color="#ffe71c":"低"==e.chain_info.rate?this.chainRate.color="#f63624":this.chainRate.color="#4dc901",this.chainCostIcon0.graphics.clear(),this.chainCostIcon0.loadImage(t.ResPath().getPic(t.ChainView.goodsMap[e.chain_info.chain_id].icon_id,t.ResourcePath.PATH_GOODS),-13,-10,60,60),this.chainCostNum0.text="x"+e.chain_info.cost_num+"("+e.chain_info.goods_num+")",e.chain_info.extra_cost_num>0?(this.chainCostIcon1.graphics.clear(),this.chainCostIcon1.visible=!0,this.chainCostNum1.visible=!0,this.chainCostIcon1.loadImage(t.ResPath().getPic(t.ChainView.goodsMap[e.chain_info.chain_id].extra_icon_id,t.ResourcePath.PATH_GOODS),-13,-10,60,60),this.chainCostNum1.text="x"+e.chain_info.extra_cost_num+"("+e.chain_info.extra_goods_num+")"):(this.chainCostIcon1.visible=!1,this.chainCostNum1.visible=!1),e.chain_info.level<30?e.chain_info.level<15?(this.damageTxt0.text="连锁攻击造成40%伤害，与怪物战斗造成80%伤害",this.damageTxt1.text="（连锁达到15级后伤害提升至50%/100%）"):e.chain_info.level<25?(this.damageTxt0.text="连锁攻击造成50%伤害，与怪物战斗造成100%伤害",this.damageTxt1.text="（连锁达到25级后连锁伤害提升至60%/120%）"):(this.damageTxt0.text="连锁攻击造成60%伤害，与怪物战斗造成120%伤害",this.damageTxt1.text=""):(this.damageTxt0.text="连锁攻击造成60%伤害，与怪物战斗造成120%伤害",this.damageTxt1.text=""),this.updateProgress();for(var a=0;2>a;a++)if(e.chain_info.chain_attr[a])if(this["chainArrow"+a].visible=!0,this["chainAttr"+a].visible=!0,this["chainAttr"+(a+2)].visible=!0,e.chain_info.level<30){this["chainAttr"+a].text=e.chain_info.chain_attr[a].attr_desc;var o=this["chainAttr"+a].text.replace(/[0-9%\.]+/,"");this["chainAttr"+(a+2)].text=o+e.chain_info.chain_attr[a].next_attr_desc}else this["chainAttr"+a].text=e.chain_info.chain_attr[a].attr_desc,this["chainAttr"+(a+2)].text="已达上限";else this["chainArrow"+a].visible=!1,this["chainAttr"+a].visible=!1,this["chainAttr"+(a+2)].visible=!1;this._chainData.level<10?(this.chainTxt0.text="一连锁：100%",this.chainTxt1.text="二连锁：未开启",this.chainTxt2.text="三连锁：未开启",this.chainNextTxt0.text="一连锁：90%",this.chainNextTxt1.text="二连锁：10%",this.chainNextTxt2.text="三连锁：未开启",this.levelTips.text="10级"):this._chainData.level<15?(this.chainTxt0.text="一连锁：90%",this.chainTxt1.text="二连锁：10%",this.chainTxt2.text="三连锁：未开启",this.chainNextTxt0.text="一连锁：60%",this.chainNextTxt1.text="二连锁：40%",this.chainNextTxt2.text="三连锁：未开启",this.levelTips.text="15级"):this._chainData.level<20?(this.chainTxt0.text="一连锁：60%",this.chainTxt1.text="二连锁：40%",this.chainTxt2.text="三连锁：未开启",this.chainNextTxt0.text="一连锁：60%",this.chainNextTxt1.text="二连锁：30%",this.chainNextTxt2.text="三连锁：10%",this.levelTips.text="20级"):this._chainData.level<25?(this.chainTxt0.text="一连锁：60%",this.chainTxt1.text="二连锁：30%",this.chainTxt2.text="三连锁：10%",this.chainNextTxt0.text="一连锁：60%",this.chainNextTxt1.text="二连锁：25%",this.chainNextTxt2.text="三连锁：15%",this.levelTips.text="25级"):this._chainData.level<30?(this.chainTxt0.text="一连锁：60%",this.chainTxt1.text="二连锁：25%",this.chainTxt2.text="三连锁：15%",this.chainNextTxt0.text="一连锁：50%",this.chainNextTxt1.text="二连锁：25%",this.chainNextTxt2.text="三连锁：25%",this.levelTips.text="30级"):(this.chainTxt0.text="一连锁：50%",this.chainTxt1.text="二连锁：25%",this.chainTxt2.text="三连锁：25%",this.chainNextTxt0.text="已达上限",this.chainNextTxt1.text="已达上限",this.chainNextTxt2.text="已达上限",this.levelTips.text=""),this.updateChain(),this.skillAndLevel.text="等级："+e.skill_info.level,e.skill_info.level>=t.ChainView.maxLevel?(this.skillUpBtn.gray=!0,this.skillUpBtn.label="已满级"):(this.skillUpBtn.gray=!1,this.skillUpBtn.label="强  化"),n&&(this.skillPower.text=e.skill_info.fightpower+""),this.skillRate.text=e.skill_info.rate,"中"==e.skill_info.rate?this.skillRate.color="#ffe71c":"低"==e.skill_info.rate?this.skillRate.color="#f63624":this.skillRate.color="#4dc901",this.skillCostIcon0.graphics.clear(),this.skillCostIcon0.loadImage(t.ResPath().getPic(t.ChainView.goodsMap[e.chain_info.chain_id].icon_id,t.ResourcePath.PATH_GOODS),-13,-10,60,60),this.skillCostNum0.text="x"+e.skill_info.cost_num+"("+e.chain_info.goods_num+")",e.skill_info.extra_cost_num>0?(this.skillCostIcon1.graphics.clear(),this.skillCostIcon1.visible=!0,this.skillCostNum1.visible=!0,this.skillCostIcon1.loadImage(t.ResPath().getPic(t.ChainView.goodsMap[e.chain_info.chain_id].extra_icon_id,t.ResourcePath.PATH_GOODS),-13,-10,60,60),this.skillCostNum1.text="x"+e.skill_info.extra_cost_num+"("+e.chain_info.extra_goods_num+")"):(this.skillCostIcon1.visible=!1,this.skillCostNum1.visible=!1),this.updateSkillProgress();for(var a=0;2>a;a++)if(e.skill_info.skill_attr[a])if(this["skillAttr"+a].visible=!0,this["skillArrow"+a].visible=!0,this["skillAttr"+(a+2)].visible=!0,e.skill_info.level<30){this["skillAttr"+a].text=e.skill_info.skill_attr[a].attr_desc;var o=this["skillAttr"+a].text.replace(/[0-9%\.]+/,"");this["skillAttr"+(a+2)].text=o+e.skill_info.skill_attr[a].next_attr_desc}else this["skillAttr"+a].text=e.skill_info.skill_attr[a].attr_desc,this["skillAttr"+(a+2)].text="已达上限";else this["skillAttr"+a].visible=!1,this["skillArrow"+a].visible=!1,this["skillAttr"+(a+2)].visible=!1}else t.Logger.log("不存在chainData")},i.prototype.updateChain=function(){this._chainData},i.prototype.updateProgress=function(){this.chainProgress.text="祝福值:"+t.ChainView.curData.chain_info.bless+"/"+t.ChainView.curData.chain_info.max_bless,this.chainBar.scrollRect.width=this.chainBar.width*(t.ChainView.curData.chain_info.bless/t.ChainView.curData.chain_info.max_bless)},i.prototype.updateSkillProgress=function(){this.skillProgress.text="祝福值:"+t.ChainView.curData.skill_info.bless+"/"+t.ChainView.curData.skill_info.max_bless,this.skillBar.scrollRect.width=this.skillBar.width*(t.ChainView.curData.skill_info.bless/t.ChainView.curData.skill_info.max_bless)},i.prototype.onClickChainUp=function(){if(t.ChainView.curData)if(t.ChainView.curData.chain_info.goods_num>=t.ChainView.curData.chain_info.cost_num&&t.ChainView.curData.chain_info.extra_goods_num>=t.ChainView.curData.chain_info.extra_cost_num)t.XHR().Post({cmd:"chain",op:"upgrade",chain_id:t.ChainView.curData.chain_info.chain_id},this,this.onUpgradeChain);else if(t.ChainView.curData.chain_info.extra_goods_num<t.ChainView.curData.chain_info.extra_cost_num)t.WeakTips.show(t.ChainView.goodsMap[t.ChainView.curData.chain_info.chain_id].extra_name+"不足！");else{var e=new t.BuyCommand(t.ChainModule.shopIdMap[t.ChainView.goodsMap[t.ChainView.curData.chain_info.chain_id].goods_id]);e.on(this,this.onBuyFinish),t.Facade.callCommand(e),Laya.timer.clear(this,this.onChainTime),Laya.timer.clear(this,this.onClickChainUp)}else Laya.timer.clear(this,this.onChainTime),Laya.timer.clear(this,this.onClickChainUp)},i.prototype.onBuyFinish=function(e){e.off(),t.ChainView.checkChainCanStrength(this._chainData),t.ChainView.curData.chain_info.goods_num+=e.num,this.chainCostNum0.text="x"+t.ChainView.curData.chain_info.cost_num+"("+t.ChainView.curData.chain_info.goods_num+")",this.skillCostNum0.text="x"+t.ChainView.curData.skill_info.cost_num+"("+t.ChainView.curData.chain_info.goods_num+")",t.dispatch(t.ChainView.CHAIN_VIEW_CHAIN_UPDATE)},i.prototype.onClickChainMouseDown=function(){t.ChainView.curData&&(Laya.stage.on(Laya.Event.MOUSE_UP,this,this.onClickMouseUp),Laya.timer.once(400,this,this.onChainTime))},i.prototype.onChainTime=function(){Laya.timer.loop(200,this,this.onClickChainUp)},i.prototype.onClickSkillUp=function(){if(t.ChainView.curData)if(t.ChainView.curData.chain_info.goods_num>=t.ChainView.curData.skill_info.cost_num&&t.ChainView.curData.chain_info.extra_goods_num>=t.ChainView.curData.skill_info.extra_cost_num)t.XHR().Post({cmd:"chain",op:"upgradeskill",chain_id:t.ChainView.curData.chain_info.chain_id},this,this.onUpgradeSkill);else if(t.ChainView.curData.chain_info.extra_goods_num<t.ChainView.curData.skill_info.extra_cost_num)t.WeakTips.show(t.ChainView.goodsMap[t.ChainView.curData.chain_info.chain_id].extra_name+"不足！");else{var e=new t.BuyCommand(t.ChainModule.shopIdMap[t.ChainView.goodsMap[t.ChainView.curData.chain_info.chain_id].goods_id]);e.on(this,this.onBuyFinish),t.Facade.callCommand(e),Laya.timer.clear(this,this.onSkillTime),Laya.timer.clear(this,this.onClickSkillUp)}else Laya.timer.clear(this,this.onSkillTime),Laya.timer.clear(this,this.onClickSkillUp)},i.prototype.onClickSkillMouseDown=function(){t.ChainView.curData?(Laya.stage.on(Laya.Event.MOUSE_UP,this,this.onClickMouseUp),Laya.timer.once(400,this,this.onSkillTime)):(Laya.timer.clear(this,this.onSkillTime),Laya.timer.clear(this,this.onClickSkillUp))},i.prototype.onSkillTime=function(){Laya.timer.loop(200,this,this.onClickSkillUp)},i.prototype.onClickMouseUp=function(){Laya.stage.off(Laya.Event.MOUSE_UP,this,this.onClickMouseUp),Laya.timer.clear(this,this.onChainTime),Laya.timer.clear(this,this.onClickChainUp),Laya.timer.clear(this,this.onSkillTime),Laya.timer.clear(this,this.onClickSkillUp)},i.prototype.onUpgradeChain=function(e){if(0==e.result){t.Facade.callCommand(new t.SyncChangeCmd(e,!1));var i=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).realAttackPower;e.chain_info?(this.playSuccess(),t.ChainView.curData.chain_info=e.chain_info,this._chainData.level=e.chain_info.level,this._chainData.fightpower=e.chain_info.fightpower+t.ChainView.curData.skill_info.fightpower,this._chainData.cost_num=e.chain_info.cost_num,this._chainData.extra_cost_num=e.chain_info.extra_cost_num,t.ChainView.checkChainCanStrength(this._chainData),this.update(t.ChainView.curData,this._chainData,!0,!1),t.dispatch(t.ChainView.CHAIN_VIEW_UPDATE_DETAIL),t.dispatch(t.ChainView.CHAIN_VIEW_UPDATE_CURCHAIN)):(t.Facade.callCommand(new t.ShowChangeRewardCmd([e.msg],100,"#999999")),t.ChainView.curData.chain_info.goods_num-=t.ChainView.curData.chain_info.cost_num,t.ChainView.curData.chain_info.extra_goods_num-=t.ChainView.curData.chain_info.extra_cost_num,t.ChainView.curData.chain_info.bless=e.bless,e.chain_attr&&(t.ChainView.curData.chain_info.chain_attr=e.chain_attr),t.ChainView.curData.chain_view.attr=t.ChainView.curData.skill_info.skill_attr.concat(e.chain_attr),t.ChainView.checkChainCanStrength(this._chainData),this.update(t.ChainView.curData,this._chainData,!1,!1),this.chainPower.text=String(Number(this.chainPower.text)+(i-this._fightPower))),this._fightPower=i,t.dispatch(t.ChainView.CHAIN_VIEW_CHAIN_UPDATE)}else t.WeakTips.show(e.msg),Laya.timer.clear(this,this.onChainTime),Laya.timer.clear(this,this.onClickChainUp)},i.prototype.onUpgradeSkill=function(e){if(0==e.result){t.Facade.callCommand(new t.SyncChangeCmd(e,!1));var i=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).realAttackPower;e.skill_info?(this.playSuccess(),t.ChainView.curData.chain_info.goods_num-=t.ChainView.curData.skill_info.cost_num,t.ChainView.curData.chain_info.extra_goods_num-=t.ChainView.curData.skill_info.extra_cost_num,t.ChainView.curData.skill_info=e.skill_info,this._chainData.fightpower=e.skill_info.fightpower+t.ChainView.curData.chain_info.fightpower,this._chainData.skill_cost_num=e.skill_info.cost_num,this._chainData.skill_extra_cost_num=e.skill_info.extra_cost_num,t.ChainView.checkChainCanStrength(this._chainData),this.update(t.ChainView.curData,this._chainData,!1,!0),t.dispatch(t.ChainView.CHAIN_VIEW_UPDATE_DETAIL),t.dispatch(t.ChainView.CHAIN_VIEW_UPDATE_CURCHAIN)):(t.Facade.callCommand(new t.ShowChangeRewardCmd([e.msg],100,"#999999")),t.ChainView.curData.chain_info.goods_num-=t.ChainView.curData.skill_info.cost_num,t.ChainView.curData.chain_info.extra_goods_num-=t.ChainView.curData.skill_info.extra_cost_num,t.ChainView.curData.skill_info.bless=e.bless,e.skill_attr&&(t.ChainView.curData.skill_info.skill_attr=e.skill_attr),t.ChainView.curData.chain_view.attr=e.skill_attr.concat(t.ChainView.curData.chain_info.chain_attr),t.ChainView.checkChainCanStrength(this._chainData),this.update(t.ChainView.curData,this._chainData,!1,!1),this.skillPower.text=String(Number(this.skillPower.text)+(i-this._fightPower))),this._fightPower=i,t.dispatch(t.ChainView.CHAIN_VIEW_CHAIN_UPDATE)}else t.WeakTips.show(e.msg),Laya.timer.clear(this,this.onSkillTime),Laya.timer.clear(this,this.onClickSkillUp)},i.prototype.playSuccess=function(){this._aniSke||(this._aniSke=new t.AnimationSKe("assets/skeleton/upgrade_success.sk"),this._aniSke.x=235,this._aniSke.y=315,this._aniSke.on(Laya.Event.STOPPED,this,this.onAniStop)),this._aniSke.visible=!0,this._aniSke.play(0,!1),this.addChild(this._aniSke)},i.prototype.onAniStop=function(){this._aniSke&&(this._aniSke.visible=!1)},i.prototype.releaseAni=function(){this._aniSke&&(this.removeChild(this._aniSke),this._aniSke.destroy(),this._aniSke=null)},i}(ui.chain.ChainStrengthenUI);t.ChainStrengthenView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.chain.ChainUI),this.m_ui=this.skin,this._isFirst=!0,this.m_ui.cacheAs="bitmap",this._pm=t.Facade.singleton.model.retrieveModel(t.ModelDef.PACK_MODEL),this.m_ui.list.itemRender=i,this.m_ui.list.scrollBar.visible=!1,this.m_ui.list.renderHandler=new Handler(this,this.onListRender),this.m_ui.closeBtn.on(Laya.Event.CLICK,this,this.onClickBack),this.m_ui.closeBtn.x-=t.Global.FLOAT_ICON_OFFSET,t.Global.isWXAPP&&(this.m_ui.closeBtn.x=791),this.m_ui.tab.selectHandler=new Handler(this,this.onSelectTab),this.m_ui.ruleBtn.on(Laya.Event.CLICK,this,this.onClickRule),this.m_ui.program.on(Laya.Event.CLICK,this,this.onClickProgram),this.m_ui.attackRedIcon.visible=!1,this.m_ui.defenseRedIcon.visible=!1}return __extends(s,e),s.prototype.destroy=function(){e.prototype.destroy.call(this),t.removeListener(s.CHAIN_VIEW_SELECT_ITEM,this,this.onSelecteItem),t.removeListener(s.CHAIN_VIEW_UPDATE_INDEX,this,this.onUpdate),t.removeListener(s.CHAIN_VIEW_CHAIN_UPDATE,this,this.updateChain),t.removeListener(s.CHAIN_VIEW_UPDATE_DETAIL,this,this.detailNeedUpdate),t.removeListener(s.CHAIN_VIEW_CHANGE_NAME,this,this.onNameUpdate),t.removeListener(s.CHAIN_VIEW_UPDATE_CURCHAIN,this,this.updateAllChain)},s.prototype.onShowed=function(){this._isFirst?this._isFirst=!1:this.resetImageSkin(this.m_ui),this._detailUpdate=!1,t.addListener(s.CHAIN_VIEW_SELECT_ITEM,this,this.onSelecteItem),t.addListener(s.CHAIN_VIEW_UPDATE_INDEX,this,this.onUpdate),t.addListener(s.CHAIN_VIEW_CHAIN_UPDATE,this,this.updateChain),t.addListener(s.CHAIN_VIEW_UPDATE_DETAIL,this,this.detailNeedUpdate),t.addListener(s.CHAIN_VIEW_CHANGE_NAME,this,this.onNameUpdate),t.addListener(s.CHAIN_VIEW_UPDATE_CURCHAIN,this,this.updateAllChain)},s.prototype.getSceneName=function(){return t.SceneDef.ChAIN_SCENE},s.prototype.onHided=function(){Laya.loader.clearRes("res/atlas/ui/chain.json"),Laya.loader.clearRes("ui/chain/bg.jpg"),Laya.loader.clearRes("ui/chain/wordbg.png"),Laya.loader.clearRes("ui/chain/di_1.png"),Laya.loader.clearRes("ui/chain/di_2.png"),Laya.loader.clearRes("ui/chain/fengexian.png"),Laya.loader.clearRes("ui/chain/weaponbg.png"),this.m_ui.strength.releaseAni()},s.prototype.onUpdate=function(){t.XHR().Post({cmd:"chain",op:"index",full:1},this,this.updatePanel)},s.prototype.updatePanel=function(e){0==e.result?(s.curChainId=e.chain_view.chain_id,this.initData(e),0==this.m_ui.tab.selectedIndex?this.onSelectTab(0):this.m_ui.tab.selectedIndex=0,this.m_ui.detail.update(e,s.volumeDataMap[e.chain_view.chain_id]),t.XHR().Post({cmd:"chain",op:"viewupgrade",chain_id:s.curData.chain_view.chain_id},this,this.onViewUpgrade),this.updateLoadBtn(),this.m_ui.program.label=e.plan_name+"  "):t.WeakTips.show(e.msg)},s.prototype.updateLoadBtn=function(){s.curData.play_num>=s.curData.max_play_num&&s.volumeDataMap[s.curChainId]&&0==s.volumeDataMap[s.curChainId].status?(this.m_ui.loadBtn.label="装备密卷("+s.curData.play_num+"/"+s.curData.max_play_num+")",this.m_ui.loadBtn.off(Laya.Event.CLICK,this,this.onClickLoad),this.m_ui.loadBtn.filters=t.FiltersUtils.getGreyFilters()):(s.volumeDataMap[s.curChainId]&&0==s.volumeDataMap[s.curChainId].status?this.m_ui.loadBtn.label="装备密卷("+s.curData.play_num+"/"+s.curData.max_play_num+")":this.m_ui.loadBtn.label="卸 载 密 卷",this.m_ui.loadBtn.on(Laya.Event.CLICK,this,this.onClickLoad),this.m_ui.loadBtn.filters=null)},s.prototype.initData=function(t){if(s.curData=t,this._isInt=!0,this._attackVolumes=[],this._defenseVolumes=[],s.volumeDataMap={},s.useWeaponMap={},!s.goodsMap&&t.goods_array){s.goodsMap={};for(var e=0;e<t.goods_array.length;e++)s.goodsMap[t.goods_array[e].chain_id]=t.goods_array[e]}for(var e=0;e<t.chain_array.length;e++){1==t.chain_array[e].type?this._attackVolumes.push(t.chain_array[e]):this._defenseVolumes.push(t.chain_array[e]),s.checkChainCanStrength(t.chain_array[e]),s.volumeDataMap[t.chain_array[e].id]=t.chain_array[e];var i=t.chain_array[e].slot_array;if(i)for(var n=0;n<i.length;n++)i[n].weapon_id>0&&(s.useWeaponMap[i[n].weapon_id]=!0)}if(t.weapon_array){s.weaponArr=t.weapon_array,s.weaponMap={};for(var e=0;e<t.weapon_array.length;e++)s.weaponMap[t.weapon_array[e].id]=t.weapon_array[e]}},s.checkChainCanStrength=function(e){if(s.goodsMap&&e){var i=s.goodsMap[e.id],n=t.Facade.singleton.model.retrieveModel(t.ModelDef.PACK_MODEL);if(i){var a=n.getItemCount(i.goods_id),o=n.getItemCount(i.extra_goods_id);if(a>=e.cost_num&&o>=e.extra_cost_num&&e.level<s.maxLevel||a>=e.skill_cost_num&&o>=e.skill_extra_cost_num&&e.skill_level<s.maxLevel)return void(e.canStrength=!0)}}e.canStrength=!1},s.prototype.updateChain=function(){if(s.curData){for(var t=0,e=0;e<s.curData.chain_array.length;e++)s.curData.chain_array[e].status>0&&t++;s.curData.play_num=t}this.updateLoadBtn()},s.prototype.detailNeedUpdate=function(){this._detailUpdate=!0},s.prototype.onNameUpdate=function(){this.m_ui.program.label=s.curData.plan_name+"  "},s.prototype.onSelectTab=function(t){0==t?this.updateChainList(this._attackVolumes):this.updateChainList(this._defenseVolumes),
this.checkShowTabRedIcon()},s.prototype.checkShowTabRedIcon=function(){if(this.m_ui.attackRedIcon.visible=!1,this.m_ui.defenseRedIcon.visible=!1,0==this.m_ui.tab.selectedIndex){if(this._defenseVolumes&&this._defenseVolumes.length>0)for(var t=0;t<this._defenseVolumes.length;t++)if(this._defenseVolumes[t].canStrength||this.checkHaveEmptyWeapon(this._defenseVolumes[t])){this.m_ui.defenseRedIcon.visible=!0;break}}else if(this._attackVolumes&&this._attackVolumes.length>0)for(var t=0;t<this._attackVolumes.length;t++)if(this._attackVolumes[t].canStrength||this.checkHaveEmptyWeapon(this._attackVolumes[t])){this.m_ui.attackRedIcon.visible=!0;break}},s.prototype.checkHaveEmptyWeapon=function(t){for(var e=0;4>e;e++){if(!t.slot_array)return!1;if(t.slot_array[e].weapon_id<=0&&t.level>=t.slot_array[e].open_level&&t.status)return!0}return!1},s.prototype.onClickBack=function(){t.Facade.callCommand(new t.HomeCommand),t.Global.isWXAPP&&this.destroy()},s.prototype.onClickRule=function(){var e="<span style='font-weight:bold'>-------------密卷概况-------------</span><br><img src='ui/comp/icon.png'></img><span>1.把武器装备到密卷中使密卷装载生效，发挥密卷强大的武器连锁和密卷技能。</span><br><img src='ui/comp/icon.png'></img><span>2.密卷上的属性加成不需装载也可生效。</span><br><img src='ui/comp/icon.png'></img><span>3.随着等级提升，会开放更多的密卷和更多的密卷装载位置。</span><br><img src='ui/comp/icon.png'></img><span>4.一把武器只能装备到一个密卷中，但密卷上的武器可以随时调整。</span><br><img src='ui/comp/icon.png'></img><span>5.玩家可以预设3套密卷配置方案，在预设方案中快速切换。</span><br><span style='font-weight:bold'>-------------武器连锁-------------</span><br><img src='ui/comp/icon.png'></img><span>1.战斗中拿出密卷中任一武器，都有可能再使用此密卷中其他武器进行连锁攻击。</span><br><img src='ui/comp/icon.png'></img><span>2.密卷中最多可以装备4把武器，有可能在攻击后再进行3次连锁攻击。连锁攻击过程中的武器效果同样可以生效。</span><br><img src='ui/comp/icon.png'></img><span>3.提升密卷连锁等级可以获得更多被动属性加成，提升武器连锁造成的伤害，解锁更多的连锁武器槽。</span><br><span style='font-weight:bold'>-------------密卷技能-------------</span><br><img src='ui/comp/icon.png'></img><span>1.使用密卷中的武器进行武器连锁攻击后，就一定会触发对应的密卷技能。</span><br><img src='ui/comp/icon.png'></img><span>2.根据武器连锁触发次数，对应触发密卷技能的低级、中级或者高级版本。</span><br><img src='ui/comp/icon.png'></img><span>3.提升密卷技能等级可以获得更多被动属性加成，提升密卷技能的技能效果。</span><br>";t.RulePanel.showRule(e,"")},s.prototype.updateChainList=function(t){this._isInt?(this._isInt=!1,t.length>0&&(t[0].selected=!0)):t.length>0&&(t[0].clickItem=!0),this.m_ui.list.array=t},s.prototype.onClickProgram=function(){t.Facade.callCommand(new t.ChainCommand("program"))},s.prototype.onClickLoad=function(){"卸 载 密 卷"==this.m_ui.loadBtn.label?t.XHR().Post({cmd:"chain",op:"setplan",chain_id:s.curChainId,type:1},this,this.onCancleRet):t.Facade.callCommand(new t.ChainCommand("weapon"))},s.prototype.onCancleRet=function(e){if(0==e.result){t.WeakTips.show("密卷已经卸载");var i=s.volumeDataMap[s.curChainId];if(i)for(var n=0;n<i.slot_array.length;n++)s.useWeaponMap[i.slot_array[n].weapon_id]=!1,i.slot_array[n].weapon_id=0;i.status=0,t.dispatch(s.CHAIN_VIEW_CHAIN_UPDATE)}else t.WeakTips.show(e.msg)},s.prototype.onListRender=function(t,e){t.setData(this.m_ui.list.getItem(e))},s.prototype.onSelecteItem=function(e){t.XHR().Post({cmd:"chain",op:"index",full:0,chain_id:e},this,this.updateDetail)},s.prototype.updateAllChain=function(){t.XHR().Post({cmd:"chain",op:"index",full:0,chain_id:s.curChainId},this,this.updateDetail),t.XHR().Post({cmd:"chain",op:"viewupgrade",chain_id:s.curData.chain_view.chain_id},this,this.onViewUpgrade)},s.prototype.onViewUpgrade=function(e){0==e.result?(s.curData.chain_info=e.chain_info,s.curData.skill_info=e.skill_info,s.curChainId=e.chain_info.chain_id,this.m_ui.strength.update(e,s.volumeDataMap[e.chain_info.chain_id]),this.updateLoadBtn()):t.WeakTips.show(e.msg)},s.prototype.updateDetail=function(e){0==e.result?(this._detailUpdate=!1,s.curData.chain_view=e.chain_view,s.curChainId=e.chain_view.chain_id,t.XHR().Post({cmd:"chain",op:"viewupgrade",chain_id:s.curChainId},this,this.onViewUpgrade),this.m_ui.detail.update(e,s.volumeDataMap[e.chain_view.chain_id]),this.updateLoadBtn()):t.WeakTips.show(e.msg)},s.CHAIN_VIEW_SELECT_ITEM="CHAIN_VIEW_SELECT_ITEM",s.CHAIN_VIEW_UPDATE_DETAIL="CHAIN_VIEW_UPDATE_DETAIL",s.CHAIN_VIEW_SWITH_PROGRAM="CHAIN_VIEW_SWITH_PROGRAM",s.CHAIN_VIEW_UPDATE_INDEX="CHAIN_VIEW_UPDATE_INDEX",s.CHAIN_VIEW_SELECT_SLOT="CHAIN_VIEW_SELECT_SLOT",s.CHAIN_VIEW_CHAIN_UPDATE="CHAIN_VIEW_CHAIN_UPDATE",s.CHAIN_VIEW_SELECT_WEAPON="CHAIN_VIEW_SELECT_WEAPON",s.CHAIN_VIEW_CHANGE_NAME="CHAIN_VIEW_CHANGE_NAME",s.CHAIN_VIEW_PUT_DOWN_WEAPON="CHAIN_VIEW_PUT_DOWN_WEAPON",s.CHAIN_VIEW_UPDATE_CURCHAIN="CHAIN_VIEW_UPDATE_CURCHAIN",s.maxLevel=30,s}(t.BaseScene);t.ChainView=e;var i=function(i){function s(){i.call(this),t.addListener(e.CHAIN_VIEW_SELECT_ITEM,this,this.onSelecteItem),t.addListener(e.CHAIN_VIEW_CHAIN_UPDATE,this,this.update),t.addListener(e.CHAIN_VIEW_UPDATE_DETAIL,this,this.updateLevel),this.on(Laya.Event.CLICK,this,this.onClickItem)}return __extends(s,i),s.prototype.destroy=function(){i.prototype.destroy.call(this),t.removeListener(e.CHAIN_VIEW_SELECT_ITEM,this,this.onSelecteItem),t.removeListener(e.CHAIN_VIEW_CHAIN_UPDATE,this,this.update),t.removeListener(e.CHAIN_VIEW_UPDATE_DETAIL,this,this.updateLevel)},s.prototype.setData=function(e){if(e){this._curDta=e,this.volumeName.text=e.name,this.power.text=e.fightpower?e.fightpower:0,this.onFight.visible=!!e.status,this.selectIcon.visible=!!e.selected,this.skillIcon.loadImage(t.ResPath().getPic(e.id,t.ResourcePath.PATH_CHAIN),0,0,80,80);for(var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL).level,s=!1,n=0;4>n;n++)e.slot_array?(this["weapon"+n].visible=!0,this["weapon"+n].update(e.slot_array[n],e.level,e.status),(e.canStrength||this["weapon"+n].needRedTips&&e.status)&&(s=!0)):this["weapon"+n].visible=!1;this.redIcon.visible=s,e.clickItem&&(e.clickItem=!1,this.onClickItem()),i>=e.userlvl?(this.filters=null,this.tips.visible=!1):(this.tips.visible=!0,this.tips.text="角色"+e.userlvl+"级开放",this.filters=t.FiltersUtils.getGreyFilters(),this.redIcon.visible=!1)}},s.prototype.update=function(){this._curDta&&this.setData(this._curDta)},s.prototype.updateLevel=function(){this._curDta&&this._curDta.id==e.curChainId&&this.setData(this._curDta)},s.prototype.onClickItem=function(){if(this._curDta){var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL).level;i>=this._curDta.userlvl?t.dispatch(e.CHAIN_VIEW_SELECT_ITEM,this._curDta.id):t.WeakTips.show("角色"+this._curDta.userlvl+"级开放")}},s.prototype.onSelecteItem=function(t){this._curDta&&t==this._curDta.id?(this._curDta.selected=!0,this.selectIcon.visible=!0):(this._curDta&&(this._curDta.selected=!1),this.selectIcon.visible=!1)},s}(ui.chain.ChainItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.on(Laya.Event.CLICK,this,this.onClick)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),this.off(Laya.Event.CLICK,this,this.onClick)},i.prototype.update=function(e,i,s,n){if(void 0===s&&(s=0),void 0===n&&(n=0),this._curData=e,this.tips.visible=!1,this.detailIcon.visible=!1,this.needRedTips=!1,this._curData)if(e.weapon_id>0){this.icon.visible=!1,this.weapon.graphics.clear();var a=t.ChainView.weaponMap[e.weapon_id]?t.ChainView.weaponMap[e.weapon_id].level:1;this.weapon.loadImage(t.ResPath().getPic(e.weapon_id,t.ResourcePath.PATH_WEAPON,a),0,0,85,85),this.detailIcon.visible=!0}else this.weapon.graphics.clear(),this.icon.visible=!0,i>=e.open_level?(this.needRedTips=!0,this.icon.skin="ui/chain/weapon1.png"):1==n&&(2==s&&10==i+1||3==s&&20==i+1)?(this.tips.visible=!0,this.icon.skin="ui/chain/add.png",this.tips.text="升级开启"):this.icon.skin="ui/chain/weaponlock.png"},i.prototype.onClick=function(){this._curData&&t.ChainView.curData&&"ui/chain/weaponlock.png"!=this.icon.skin&&(t.ChainView.volumeDataMap[t.ChainView.curChainId]&&1==t.ChainView.volumeDataMap[t.ChainView.curChainId].status?t.Facade.callCommand(new t.ChainCommand("weapon")):t.ChainView.curData.play_num<t.ChainView.curData.max_play_num?t.Facade.callCommand(new t.ChainCommand("weapon")):t.WeakTips.show("不能装备更多密卷了"))},i}(ui.chain.ChainWeaponIconUI);t.ChainWeaponIcon=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.champion.ChampionLogUI,!0,!1),this._display=this.skin,this.setCloseButton(this._display.back.closeBtn),this._display.back.derocation_left.skin="ui/comp/rope_xia.png",this._display.back.derocation_left.x=125,this.name="ChampionLogView",this._display.list.itemRender=i,this._display.list.scrollBar.visible=!1,this._display.list.scrollBar.elasticDistance=100,this._display.list.renderHandler=new Handler(this,this.onListLogRender),this._display.list.array=[]}return __extends(s,e),s.prototype.destroy=function(){this._display.list&&(this._display.list.scrollBar.changeHandler=null,this._display.list.destroy()),e.prototype.destroy.call(this)},s.prototype.onShowed=function(){e.prototype.onShowed.call(this),t.XHR().Post({file:"petpk",cmd:"qualifying",op:"feeds"},this,function(e){0==e.result?this._display.list.array=e.feedslist:t.WeakTips.show(e.msg)},!1)},s.prototype.onListLogRender=function(t,e){t.setData(this._display.list.getItem(e))},s}(t.BaseBox);t.ChampionLogView=e;var i=function(e){function i(){e.call(this),this._word=new t.ImageWord("assets/word/small_result/"),this.addChild(this._word)}return __extends(i,e),i.prototype.destroy=function(){this.replayIcon.off(Laya.Event.CLICK,this,this.onClicReplay),this.shareBtn.off(Laya.Event.CLICK,this,this.onShare),this._word&&this._word.destroy(),e.prototype.destroy.call(this)},i.prototype.setData=function(e){if(e){this._curData=e,this.timeTxt.text=t.DateUtils.formate(e.time,6);var i=e.content,s=i.indexOf("，");this.contentTxt.text=i.substr(0,s)+"。",this.reward.text=i.substr(s+1),e.fight_result&&(this._word.showWordUnit(e.fight_result+""),this._word.x=495-this._word.imgWidth/2,this._word.y=65-this._word.imgHeight/2),e.fight_result<=3?t.Util.enable(this.shareBtn):t.Util.toGrayAndDisabled(this.shareBtn),this.replayIcon.on(Laya.Event.CLICK,this,this.onClicReplay),this.shareBtn.on(Laya.Event.CLICK,this,this.onShare)}},i.prototype.onClicReplay=function(){t.Facade.callCommand(new t.FightReplayCommand(this._curData.repid))},i.prototype.onShare=function(){var e="",i="";if(this._curData.content){var s=this._curData.content.indexOf("【"),n=this._curData.content.indexOf("】");e=this._curData.content.substr(s,n-s+1);var a=this._curData.content.indexOf("（"),o=this._curData.content.indexOf("）");i=this._curData.content.substr(a,o-a+1)}var r,h;3==this._curData.fight_result?(r="王者争霸【完胜】",h="完胜【"+e+"】！！！对方段位："+i+"；胜利原来如此简单…"):2==this._curData.fight_result?(r="王者争霸【秒杀】",h="秒杀【"+e+"】！！！对方段位："+i+"；讲真的，我只需要一招…"):(r="王者争霸【胜利】",h="击败【"+e+"】！！！对方段位："+i+"；对方很强，但我，更强…");var l="https://res.ledou.qq.com/show_replay.html?_wv=2147674919&pf="+t.Global.PF+"&replay_id="+this._curData.repid+"&invitor="+t.Global.UID+"&invite_openid="+t.Global.OPENID;t.ShareModule.shareMessage({title:[r],desc:[h],alertType:1,share_url:l},new Handler(this,this.getShareReward),16)},i.prototype.getShareReward=function(){t.Facade.callCommand(new t.ChampionShareRewardCmd)},i}(ui.champion.ChampionLogItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(t){switch(t.getCommandName()){case"OpenChampionCmd":this.qualify();break;case"ChampionShareRewardCmd":this.getShareReward()}},s.prototype.showChampionView=function(e){this._championView||(this._championView=new t.ChampionView,this._championView.on(t.ViewEvent.BASE_DESTROY,this,this.championDestroy),t.SceneMgr.changeScene(this._championView)),this._championView.setData(e)},s.prototype.championDestroy=function(){this._championView&&(this._championView.off(t.ViewEvent.BASE_DESTROY,this,this.championDestroy),this._championView.destroy(),this._championView=null,this.unregisterPlugin())},s.prototype.qualify=function(){t.XHR().Post({file:"petpk",cmd:"qualifying"},this,function(t){0==t.result&&(this._data=t,this.showChampionView(this._data))},!1)},s.prototype.getShareReward=function(){0==this._data.share_award&&t.XHR().Post({file:"petpk",cmd:"qualifying",op:"reward",idx:4},this,function(t){this.onGetShareAward(t)},!1)},s.prototype.onGetShareAward=function(e){0==e.result?(this._data.share_award=1,t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0,"恭喜获得王者争霸今日首次分享奖励："))):t.WeakTips.show(e.msg)},s.prototype.getPluginName=function(){return e.PLUGIN_CHAMPION},s}(t.Plugin);t.ChampionModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.utils.Tween,i=laya.utils.Ease,s=Laya.Image,n=function(n){function h(){n.call(this,new ui.champion.ChampionUI),this.TEXIAO=t.ResPath().getEffect("effect_tiantisai1"),this.LEVEL_UP=t.ResPath().getEffect("effect_shengji"),this._needToRed=!1,this._skinUrl="ui/champion/sbtn1_start.png",this._isShow=!1,this.needVipLv=6,this._display=this.skin,this._display.on(Laya.Event.CLICK,this,this.clickHandler),this._display.background.loadImage(t.Global.getUrl(t.ConfigDef.CHAMPION_BG)),this._um=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL),this._pm=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL),this._display.pageMain.visible=!0,this._display.pageRank.visible=!1,this._display.pageMatch.visible=!1,this._display.tabLst.selectEnable=!0,this._display.tabLst.itemRender=o,this._display.tabLst.renderHandler=new Handler(this,this.onMenuListRender),this._display.tabLst.array=[{title:"上届王者"},{title:"巅峰王者"},{title:"好友"}],this._display.tabLst.selectHandler=new Handler(this,this.onTabSelect),this._display.rankLst.selectEnable=!0,this._display.rankLst.itemRender=r,this._display.rankLst.renderHandler=new Handler(this,this.onRankListRender),this._display.rankLst.array=[],this._display.rankLst.scrollBar.hide=!0,this._display.starLst.itemRender=a,this._display.starLst.renderHandler=new Handler(this,this.onStarListRender),this._display.starLst.array=[],this._display.simpleLst.array=[],this._display.simpleLst.scrollBar.hide=!0,this._display.imgAwardFlag.skin=t.ResPath().getPic("kKingMedal",t.ResourcePath.PATH_GOODS),this._display.imgAwardFlag2.skin=t.ResPath().getPic("100120",t.ResourcePath.PATH_GOODS),this._myRank=new r,this._myRank.x=9,this._myRank.y=632,this._display.ranComp.addChild(this._myRank),this._display.topRect.x-=t.Global.FLOAT_ICON_OFFSET,this._display.checkBoxClick.alpha=0,this._display.checkBoxClick.on(Laya.Event.MOUSE_DOWN,this,this.checkBoxClickHandler);var e=t.Facade.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);this._display.jumpCheckBox.selected=1==e.getLongDataValue(t.ServerSetDataModel.KEY_HAS_JUMP_CHAMPION_FIGHT)}return __extends(h,n),h.prototype.onShowed=function(){},h.prototype.onHided=function(){this.destroy()},h.prototype.setData=function(e){this._data=e,this.startCutDown(),this._data.hasOwnProperty("pre_season")&&this._data.pre_season.hasOwnProperty("award_num")&&this._data.pre_season.award_num>0&&t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0,"获得上届排名奖励"));var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.ALL_STATUS_MODEL);if(1==i.getStatueFlagByName(t.AllStatusModel.CHAMPION_STATE)){this._needToRed=!0,i.setStatueFlagByName(t.AllStatusModel.CHAMPION_STATE,0);var s=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);s.setDailyDataValue(t.ServerSetDataModel.KEY_DAILY_CHAMPION_REDDOT,1)}this.callLater(this.draw)},h.prototype.draw=function(){Laya.timer.clear(this,this.startCutDown),Laya.timer.loop(1e3,this,this.startCutDown),this._data.free_times>0?(this._display.tfCost.text="消耗：免费（"+this._data.free_times+"）",this._display.costPropComp.visible=!1,this._display.tfCost2.text=""):this._data.goods_num>0?(this._display.tfCost.text="",this._display.costPropComp.visible=!0,this._display.fightPropSkin.skin=t.ResPath().getPic("100118",t.ResourcePath.PATH_GOODS),this._display.tfPropNum.text="x1("+this._data.goods_num+")",this._display.tfCost2.text=""):this._data.cash_times<this._data.total_cash_times?(this._display.tfCost.text="付费（"+(this._data.total_cash_times-this._data.cash_times)+"）："+this._data.cash_cost+"斗鱼",this._display.costPropComp.visible=!1,this._display.tfCost2.text=""):(this._display.tfCost.text="已达付费次数上限",this._display.costPropComp.visible=!1,this._display.tfCost2.text=""),this.checkStartBtnEffect(this._data.free_times>0),this._data.fight_times<5?(this._display.tfMax.text="还需完成"+(5-this._data.fight_times)+"场",this._display.realStar.visible=!1,this._display.tfStarNum.visible=!1):(this._display.tfMax.text=this._data.history_sname,this._display.realStar.visible=!0,this._display.tfStarNum.visible=!0),this._display.tfStarNum.text=this._data.history_star,this._display.flag.skin=t.ResPath().getChampionRank(this.getPicIndex(this._data.sid)),this._display.wordImg.skin=t.ResPath().getChampionRank("w1"+this.getPicIndex(this._data.sid)),this._display.numImg.skin=this.getNumSkin(this._data.sid),this._display.numImg.x=670-this._display.numImg.width/2;for(var e=[],i=0;i<this._data.full_star;i++)e.push({solid:i<this._data.star,empty:i>=this._data.star});this._display.starLst.array=e,this._display.starLst.x=545+37*(7-this._data.full_star)/2,this._display.showRankReddot.visible=this._needToRed,this.updateReward(),this.getRank(!1)},h.prototype.updateReward=function(){if(this._data.win_award){this._display.awardBox.visible=!0,this._display.imgAwardFlag2.visible=!0,this._display.awardTextBox.x=-229;var e=this._data.win_award;0==e[0].flag?(this._display.tfCondition.text="首胜奖励（"+Math.min(1,this._data.win_times)+"/1）：",this._display.tfNum.text=e[0].award,this._display.tfNum2.text=e[0].items.items[0].num,this._data.win_times>=1?this.setGetBtnEnable(!0):this.setGetBtnEnable(!1),this._rewardIndex=0):0==e[1].flag?(this._display.tfCondition.text="三胜奖励（"+Math.min(3,this._data.win_times)+"/3）：",this._display.tfNum.text=e[1].award,this._display.tfNum2.text=e[1].items.items[0].num,this._data.win_times>=3?this.setGetBtnEnable(!0):this.setGetBtnEnable(!1),this._rewardIndex=1):0==e[2].flag?(this._display.tfCondition.text="五胜奖励（"+Math.min(5,this._data.win_times)+"/5）：",this._display.tfNum.text=e[2].award,this._display.tfNum2.text=e[2].items.items[0].num,this._data.win_times>=5?this.setGetBtnEnable(!0):this.setGetBtnEnable(!1),this._rewardIndex=2):this._data.hasOwnProperty("ext_award")&&null!=this._data.ext_award?(this._display.awardTextBox.x=-135,this._display.tfCondition.text="晋升【"+this._data.record_sname+"】奖励:",this._display.tfNum.text=this._data.ext_award.attrs[0].num,this._display.imgAwardFlag2.visible=!1,this._display.tfNum2.text="",t.Util.toGray(this._display.getBtn),this._display.getReddot.visible=!1,this._rewardIndex=3):(this._display.awardBox.visible=!1,this._rewardIndex=-1)}},h.prototype.setGetBtnEnable=function(e){e?(t.Util.enable(this._display.getBtn),this._display.getReddot.visible=!0):(t.Util.toGrayAndDisabled(this._display.getBtn),this._display.getReddot.visible=!1)},h.prototype.getPicIndex=function(t){return 25>=t?Math.floor((t+4)/5):26==t?6:void 0},h.prototype.checkStartBtnEffect=function(t){this._isShow!=t&&(t?(this._helpImg||(this._helpImg=new s,this._helpImg.skin=this._skinUrl,this._helpImg.pivot(this._display.startBtn.width/2,this._display.startBtn.width/2),this._helpImg.alpha=.5),this._helpImg.scale(1,1),this._helpImg.x=this._display.startBtn.x+this._display.startBtn.width/2,this._helpImg.y=this._display.startBtn.y+this._display.startBtn.height/2,this._display.aniLayerDown.addChild(this._helpImg),this._tween1&&(this._tween1.clear(),this._tween1=null),this._tween2&&(this._tween2.clear(),this._tween2=null),this.effect1Duration(),this._isShow=!0):(this._tween1&&(this._tween1.clear(),this._tween1=null),this._tween2&&(this._tween2.clear(),this._tween2=null),this._helpImg&&(this._helpImg.destroy(),this._helpImg=null),this._isShow=!1))},h.prototype.effect1Duration=function(){this._tween1=e.to(this._helpImg,{scaleX:1.33,scaleY:1.33},1e3/30*8,i.linearNone,new Handler(this,this.effect2Duration))},h.prototype.effect2Duration=function(){this._tween2=e.to(this._helpImg,{scaleX:1,scaleY:1},1e3/30*16,i.linearNone,new Handler(this,this.effect1Duration))},h.prototype.getCiduan=function(t){var e=["Ⅴ","Ⅳ","Ⅲ","Ⅱ","Ⅰ"];return 25>=t?e[Math.floor((t-1)%5)]:""},h.prototype.getNumSkin=function(t){var e=["lv_5","lv_4","lv_3","lv_2","lv_1"];return 25>=t?"ui/champion/"+e[Math.floor((t-1)%5)]+".png":""},h.prototype.updateMySelfRank=function(){var e=0,i=this._display.tabLst.selectedIndex,s=-1,n=-1,a="";if(1==i)e=this._nowRankData.selfrank;else if(0==i){e=this._lastRankData.selfrank;for(var o=0;o<this._lastRankData.rankinfo.length;o++)this._lastRankData.rankinfo[o].uid==t.Global.UID&&(s=this._lastRankData.rankinfo[o].sid,n=this._lastRankData.rankinfo[o].star,a=this._lastRankData.rankinfo[o].sname)}else if(2==i)for(var o=0;o<this._friendRankData.friend_array.length;o++)this._friendRankData.friend_array[o].uid==t.Global.UID&&(e=o+1);var r={uid:t.Global.UID,name:this._um.name,headimgurl:this._um.headimgurl,vip_level:this._um.vipLevel,level:this._um.level,sex:this._um.sex,total_star:100,win:0,flag:0,sid:-1==s?this._data.sid:s,star:-1==n?this._data.star:n,sname:""==a?this._data.sname:a,rank:e};this._myRank.setData(r,0,3,this)},h.prototype.onTabSelect=function(){this.showRank(this._display.tabLst.selectedIndex)},h.prototype.showRank=function(t){this._display.tabLst.selectedIndex=t;for(var e=0;e<this._display.tabLst.length;e++)this._display.tabLst.getCell(e).selected=t==e;this.showRankList(t)},h.prototype.showRankList=function(t){this._display.rankLst.array=[],1==t?this._nowRankData?(this._display.rankLst.array=this._nowRankData.rankinfo,this.updateMySelfRank()):this.getRankPage(0):0==t?this._lastRankData?(this._display.rankLst.array=this._lastRankData.rankinfo,this.updateMySelfRank()):this.getRankPage(1):this._friendRankData?(this._display.rankLst.array=this._friendRankData.friend_array,this.updateMySelfRank()):this.getRank(!0)},h.prototype.friendListSort=function(t,e){var i=t.total_star,s=e.total_star;if(i>s)return-1;if(s>i)return 1;var n=t.attack_power,a=e.attack_power;return n>a?-1:a>n?1:0},h.prototype.rankListSort=function(t,e){if(t.sid>e.sid)return-1;if(t.sid<e.sid)return 1;if(t.sid==e.sid){if(t.star>=e.star)return-1;if(t.star<e.star)return 1}},h.prototype.updateNowRank=function(){this._display.rankLst.refresh()},h.prototype.updateFriendRank=function(){this._display.rankLst.refresh(),this.updateMySelfRank()},h.prototype.getRankPage=function(e,i,s){void 0===i&&(i=1),void 0===s&&(s=100),t.XHR().Post({file:"petpk",cmd:"qualifying",op:"rank",type:e,start:i,end:s},this,function(i){0==i.result?1==e?(this._lastRankData=i,this.showRankList(0)):0==e&&(this._nowRankData=i,this.showRankList(1)):t.WeakTips.show(i.msg)},!1)},h.prototype.startCutDown=function(){this._data.seconds>1&&this._data.seconds--;var t=Math.floor(this._data.seconds/86400),e=Math.floor(this._data.seconds/3600%24);this._display.tfTime.text=t+"天"+e+"小时"+Math.floor(Number(this._data.seconds)%3600/60)+"分",0==this._data.seconds&&Laya.timer.once(2e3,this,this.refresh)},h.prototype.refresh=function(){t.Facade.callCommand(new t.OpenChampionCmd)},h.prototype.getRank=function(e){this._friendRankData?(e&&this.showRankList(2),this.updateSimpleFriendRank()):t.XHR().Post({file:"petpk",cmd:"qualifying",op:"rank",type:2},this,function(i){0==i.result?(this._friendRankData=i,this._friendRankData.friend_array.sort(this.friendListSort),e&&this.showRankList(2),this.updateSimpleFriendRank()):t.WeakTips.show(i.msg)},!1)},h.prototype.updateSimpleFriendRank=function(){for(var e=[],i=0;i<this._friendRankData.friend_array.length;i++)e.push({defaultPhoto:{skin:t.JSUtils.getHeadUrl("",this._friendRankData.friend_array[i].sex)},photo:{skin:t.JSUtils.getHeadUrl(this._friendRankData.friend_array[i].headimgurl,this._friendRankData.friend_array[i].sex)}});this._display.simpleLst.array=e},h.prototype.clickHandler=function(e){switch(e.target){case this._display.ruleBtn:this.showRuleBox();break;case this._display.exitBtn:case this._display.closeBtn:t.Facade.callCommand(new t.HomeCommand);break;case this._display.getBtn:if(3==this._rewardIndex)return void t.WeakTips.show("个人争霸赛首次晋升到【"+this._data.record_sname+"】，可领取奖励！");-1!=this._rewardIndex&&this.getAward(this._rewardIndex);break;case this._display.startBtn:if(this._data.free_times>0||this._data.goods_num>0)this.startMatch(),t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.CLICK_CHAMPION_START_BTN));else if(this._data.cash_times<this._data.total_cash_times)if(this._data.cash_cost<=this._um.cash)if(t.Global.skipCheckCostChanmpion)this.checkStartFight(!0);else{var i=new t.PopConfirm(this._data.cash_cost,new Handler(this,this.checkStartFight));i.show()}else t.WeakTips.show("您当前的货币不足啦~要不去充充值呀？");else this._um.vipLevel<10?t.WeakTips.show("今日购买次数不足，提升达人可增加次数！"):t.WeakTips.show("今日购买次数不足！");break;case this._display.showBtn:this._needToRed=!1,this._display.showRankReddot.visible=!1,this.showRankPage();break;case this._display.hideBtn:this.hideRankPage();break;case this._display.cancelBtn:this.matchToMain();break;case this._display.shopBtn:t.Facade.callCommand(new t.OpenWinShopCmd(6));break;case this._display.logBtn:this._logView||(this._logView=new t.ChampionLogView),this._logView.show()}},h.prototype.checkStartFight=function(e){e&&(this.startMatch(),t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.CLICK_CHAMPION_START_BTN)))},h.prototype.showRankPage=function(){this._display.pageMain.visible=!1,this._display.pageRank.visible=!0,this._friendRankData=null,this._nowRankData=null,this._lastRankData=null,this._display.ranComp.x=-this._display.ranComp.width,e.to(this._display.ranComp,{x:0},500,i.expoOut),this.showRank(2)},h.prototype.hideRankPage=function(){this._display.pageMain.visible=!0,this._display.pageRank.visible=!1},h.prototype.getAward=function(e){t.XHR().Post({file:"petpk",cmd:"qualifying",op:"reward",idx:e},this,function(i){if(0==i.result){if(2>=e){var s=this._data.win_award;s[e].flag=1,this.updateReward()}t.Facade.callCommand(new t.SyncChangeCmd(i))}else t.WeakTips.show(i.msg)},!1)},h.prototype.startMatch=function(){this._display.pageMain.visible=!1,this._display.pageMatch.visible=!0,this._display.cancelBtn.visible=!0,this._display.matchFlag.skin=t.ResPath().getChampionRank(this.getPicIndex(this._data.sid)),this._display.tfMatchFlag.text=this.getCiduan(this._data.sid),this._display.f_name.text=this._um.name,this._display.f_level.text=""+this._um.level,this._display.f_defaultHead.skin=t.JSUtils.getHeadUrl("",this._um.sex),this._display.f_photo.skin=t.JSUtils.getHeadUrl(this._um.headimgurl,this._um.sex),this._display.o_desc.visible=!1,this._display.o_defaultHead.skin=t.JSUtils.getHeadUrl("",this._um.sex),this._display.fighter.x=-186,this._display.opponent.x=1046,e.to(this._display.fighter,{x:34},500,i.expoOut),e.to(this._display.opponent,{x:826},500,i.expoOut),Laya.timer.loop(100,this,this.updatePhoto),Laya.timer.once(2e3,this,this.startFight)},h.prototype.updatePhoto=function(){this._display.o_photo.skin="ui/champion/p_"+Math.ceil(23*Math.random())+".png"},h.prototype.matchToMain=function(){this._display.pageMatch.visible=!1,this._display.pageMain.visible=!0,Laya.timer.clear(this,this.updatePhoto),Laya.timer.clear(this,this.startFight),t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.CLICK_CHAMPION_CANCEL_BTN))},h.prototype.startFight=function(){t.XHR().Post({file:"petpk",cmd:"qualifying",op:"fight"},this,function(e){0==e.result?(this._fightData=e,this.matchEnd()):(this.matchToMain(),t.WeakTips.show(e.msg))})},h.prototype.matchEnd=function(){Laya.timer.clear(this,this.updatePhoto),this._display.cancelBtn.visible=!1,this._display.o_desc.visible=!0,this._display.o_name.text=this._fightData.oppinfo.name,this._display.o_photo.skin="",this._display.o_photo.skin=t.JSUtils.getHeadUrl(this._fightData.oppinfo.headimgurl,this._fightData.oppinfo.sex),this._display.o_level.text=this._fightData.oppinfo.level,Laya.timer.once(600,this,this.dealFightData)},h.prototype.dealFightData=function(){if(this._fightData.replay){var e=1==this._fightData.win,i=e?1:-1;t.SyncExecuter.constructObj(this._fightData,"kChampionStar",i);var s=0==this._data.share_award&&e;if(this._display.jumpCheckBox.selected){t.Facade.callCommand(new t.SyncChangeCmd(this._fightData,!1)),this.onFightEnd();var n=this._fightData.replay?this._fightData:null;t.Facade.callCommand(new t.FightResultCommand({win:e,award:n,battleType:9,isDayFirstWin:s}))}else{var a=new t.FightCommand(this._fightData,null,!1,s);t.addListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.onFightEnd),t.Facade.callCommand(a)}}else this.onFightEnd()},h.prototype.onFightEnd=function(){t.removeListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.onFightEnd);var e=this._fightData.sid>this._data.sid;if((this._fightData.sid>this._data.history_sid||this._fightData.sid==this._data.history_sid&&this._fightData.star>this._data.history_star)&&(this._data.history_sid=this._fightData.sid,this._data.history_star=this._fightData.star,this._data.history_sname=this._fightData.sname),this._data.sid=this._fightData.sid,this._data.star=this._fightData.star,this._data.full_star=this._fightData.full_star?this._fightData.full_star:this._data.full_star,this._data.cash_cost=this._fightData.cash_cost,this._data.sname=this._fightData.sname,this._data.free_times>0?this._data.free_times--:this._data.goods_num>0?this._data.goods_num--:this._data.cash_times++,this._data.fight_times++,0!=this._fightData.win&&this._data.win_times++,this.matchToMain(),this._fightData.hasOwnProperty("ext_award")){this._data.ext_award=null;var i={award:this._fightData.ext_award};t.Facade.callCommand(new t.SyncChangeCmd(i,!1,!0,"恭喜首次晋级到“"+this._fightData.sname+"”，获得奖励：",new Handler(this,this.refresh)))}e?this.addUpAni():this.callLater(this.draw)},h.prototype.addUpAni=function(){this.upSk||(this.upSk=new t.AnimationSKe(this.LEVEL_UP,0)),this.upSk.x=678,this.upSk.y=300,this._display.pageMain.addChild(this.upSk),this.upSk.play("effect_shengji",!1),this.upSk.on(Laya.Event.STOPPED,this,this.onLevelUpEffectEnd)},h.prototype.onLevelUpEffectEnd=function(){this.upSk.off(Laya.Event.STOPPED,this,this.onLevelUpEffectEnd),this.callLater(this.draw)},h.prototype.onMenuListRender=function(t,e){t.setData(this._display.tabLst.getItem(e),e,this._display.tabLst.selectedIndex==e)},h.prototype.onRankListRender=function(t,e){t.setData(this._display.rankLst.getItem(e),e,this._display.tabLst.selectedIndex,this)},h.prototype.onStarListRender=function(t,e){t.setData(this._display.starLst.getItem(e))},h.prototype.destroy=function(){this._display.checkBoxClick.off(Laya.Event.MOUSE_DOWN,this,this.checkBoxClickHandler),this.upSk&&(this.upSk.off(Laya.Event.STOPPED,this,this.onLevelUpEffectEnd),this.upSk.destroy(),this.upSk=null),this._myRank&&this._myRank.destroy(),this._logView&&(this._logView.destroy(),this._logView=null),this.checkStartBtnEffect(!1),Laya.timer.clear(this,this.refresh),Laya.timer.clear(this,this.startCutDown),Laya.timer.frameOnce(1,this,this.clear)},h.prototype.clear=function(){Laya.loader.clearRes(t.Global.getUrl(t.ConfigDef.CHAMPION_BG)),n.prototype.destroy.call(this)},h.prototype.checkBoxClickHandler=function(){var e=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);if(e.vipLevel<this.needVipLv&&e.level<45)t.WeakTips.show("45级以上或达人"+this.needVipLv+"以上可跳过战斗");else{this._display.jumpCheckBox.selected=!this._display.jumpCheckBox.selected;
var i=t.Facade.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL),s=this._display.jumpCheckBox.selected?1:0;i.setLongDataValue(t.ServerSetDataModel.KEY_HAS_JUMP_CHAMPION_FIGHT,s)}},h.prototype.showRuleBox=function(){var e="<img src='ui/comp/icon.png'></img>每周一6点进行赛季结算；<br><img src='ui/comp/icon.png'></img>每赛季需参与5场方会发放奖励；<br><img src='ui/comp/icon.png'></img>结算时按照本赛季最高的段位发放王者勋章奖励，段位越高，奖励勋章越多；<br><img src='ui/comp/icon.png'></img>排位前100名的玩家，可根据等级和名次，获得额外的王者勋章奖励；<br><img src='ui/comp/icon.png'></img>达到历史最高段位时，可获得一次性的王者勋章奖励；<br><img src='ui/comp/icon.png'></img>王者勋章可在王者商城兑换物品。",i=new t.RuleBox;i.initWithHtml(e,""),i.show()},h.prototype.getSceneName=function(){return t.SceneDef.CHAMPION_SCENE},h}(t.BaseScene);t.ChampionView=n;var a=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.setData=function(e){e&&(e.solid?(this._sk||(this._sk=new t.AnimationSKe(t.ResPath().getEffect("effect_tiantisai1"),1)),this.addChild(this._sk),this._sk.x=10,this._sk.y=30,this._sk.play("effect_huo",!0)):this._sk&&(this._sk.stop(),this.removeChild(this._sk)),this.empty.visible=e.empty)},i.prototype.destroy=function(){this._sk&&(this._sk.destroy(),this._sk=null),e.prototype.destroy.call(this)},i}(ui.champion.FireItemUI);t.FireItem=a;var o=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.setData=function(t,e,i){t&&(this.tfTab.text=t.title)},Object.defineProperty(e.prototype,"selected",{set:function(t){this.normalBg.visible=!t,this.selectBg.visible=t},enumerable:!0,configurable:!0}),e}(ui.champion.TabItemUI),r=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.setData=function(e,i,s,n){this._data=e,this._tab=s,this._cv=n,this._data&&(3!=s&&(this._data.rank=i+1),e.uid==t.Global.UID?this.rankListBg.skin="ui/champion/ranklistbg3.png":i%2==1?this.rankListBg.skin="ui/champion/ranklistbg1.png":this.rankListBg.skin="ui/champion/ranklistbg0.png",this.btnDianZan.visible=!1,this.btnShare.visible=!1,this.imgProp.skin="",this.tfCount.text="",this.btnReward.visible=!1,this.gotFlag.visible=!1,1==this._data.sex?this.sexIcon.skin="ui/main/img_nan.png":this.sexIcon.skin="ui/main/img_nv.png",0==s||1==s?(this.imgLevel.skin=t.ResPath().getChampionRankMin(this._cv.getPicIndex(this._data.sid)),this.tfTitle.text=this._data.sname,1==s&&(this.btnDianZan.visible=0==this._cv._nowRankData.reward_flag)):2==s?(this.imgLevel.skin=t.ResPath().getChampionRankMin(this._cv.getPicIndex(this._data.sid)),this.tfTitle.text=this._data.sname,this.btnReward.visible=this._data.uid!=t.Global.UID&&0!=this._data.win&&0==this._data.flag,this._data.uid!=t.Global.UID&&0==this._data.win?(t.Util.toGray(this.btnReward),this.btnReward.visible=!0):t.Util.enable(this.btnReward),this.gotFlag.visible=0!=this._data.flag):(this.imgLevel.skin=t.ResPath().getChampionRankMin(this._cv.getPicIndex(this._data.sid)),this.tfTitle.text=this._data.sname,this.propCom.visible=2==this._cv._display.tabLst.selectedIndex,this.imgProp.skin=t.ResPath().getPic("kKingMedal",t.ResourcePath.PATH_GOODS),this.tfCount.text=this._cv._friendRankData.award_num+"/"+this._cv._friendRankData.max_award),(this._data.uid==t.Global.UID&&2==s||3==s&&0==this._cv._display.tabLst.selectedIndex&&0!=this._data.rank||3==s&&1==this._cv._display.tabLst.selectedIndex)&&(this.btnShare.visible=!0),this.flagRank.visible=!1,this.flagUp.visible=!1,this.flagDown.visible=!1,parseInt(e.rank)>0&&parseInt(e.rank)<=3?(this.numIcon.skin="ui/champion/"+parseInt(e.rank)+".png",this.numTxt.text=""):3==s&&0==this._data.rank?(this.flagRank.visible=!0,this.numIcon.skin="",this.numTxt.text=""):(this.numIcon.skin="",this.numTxt.text=e.rank),3==s&&0==this._cv._display.tabLst.selectedIndex&&0==this._data.rank?(this.dataCom.visible=!1,this.tfDesc.visible=!0):(this.dataCom.visible=!0,this.tfDesc.visible=!1),0==s?(this.rewardBox.visible=!0,this.img1.skin=t.ResPath().getPic("kKingMedal",t.ResourcePath.PATH_GOODS),this.tfCount1.text=this._data.ext_award,this.img2.skin=t.ResPath().getPic("100120",t.ResourcePath.PATH_GOODS),this.tfCount2.text=this._data.ext_item):this.rewardBox.visible=!1,3==s&&0==this._data.rank&&(this.flagRank.visible=!0,this.numIcon.skin="",this.numTxt.text=""),this.tfName.text=2==s?this._data.name:this._data.name,this.defaultHead.skin=t.JSUtils.getHeadUrl("",this._data.sex),this.photo.loadImage(t.JSUtils.getHeadUrl(this._data.headimgurl,this._data.sex),0,0,74,74),this.tfLvl.text=this._data.level,this.viplevel.text=this._data.vip_level,this.tfStar.text=this._data.star,this.on(Laya.Event.CLICK,this,this.clickHandler))},i.prototype.clickHandler=function(e){switch(e.target){case this.btnDianZan:t.XHR().Post({file:"petpk",cmd:"qualifying",op:"reward",idx:3},this,function(t){this.onGetDianzanReward(t)},!1);break;case this.btnShare:this.share();break;case this.btnReward:if(0==this._data.win){var i=new t.ConfirmBoxData({isShowCancelBtn:!0,contentStr:"该好友今日尚未完成首胜，是否邀请其完成？",callBackHandler:new Handler(this,this.shareToFight)});t.ConfirmBox.show(i)}else t.XHR().Post({file:"petpk",cmd:"qualifying",op:"reward",idx:100,friuid:this._data.uid},this,function(t){this.onGetSuccReward(t)},!1);break;case this.photo:this._data&&t.Facade.callCommand(new t.UserInfoCommand(this._data.uid+""))}},i.prototype.shareToFight=function(){t.ShareModule.shareMessage({title:["王者争霸"],uid:this._data.uid,desc:["“每日胜利一场，成就王者梦想！"],share_type:0,back:!0},new Handler(this,this.onShareSucc),0)},i.prototype.onGetDianzanReward=function(e){0==e.result?(this._cv._nowRankData.reward_flag=1,this._cv.updateNowRank(),t.Facade.callCommand(new t.SyncChangeCmd(e))):t.WeakTips.show(e.msg)},i.prototype.onGetSuccReward=function(e){0==e.result?(this._cv._friendRankData.award_num+=15,this._data.flag=1,this._cv.updateFriendRank(),t.Facade.callCommand(new t.SyncChangeCmd(e))):t.WeakTips.show(e.msg)},i.prototype.share=function(){3==this._tab?0==this._cv._display.tabLst.selectedIndex?t.ShareModule.shareMessage({title:["王者争霸上届王者"],desc:["上届【"+this._data.sname+"】在此，排名"+this._data.rank+"，本届继续辉煌…"],image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(13)),share_type:0,back:!0},new Handler(this,this.onShareSucc),0):1==this._cv._display.tabLst.selectedIndex&&(0!=this._data.rank?t.ShareModule.shareMessage({title:["王者争霸本届快报！"],desc:["本届【"+this._data.sname+"】，排名"+this._data.rank+"，王者之路披荆斩棘…"],image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(13)),share_type:0,back:!0},new Handler(this,this.onShareSucc),0):t.ShareModule.shareMessage({title:["王者争霸本届快报！"],desc:["本届【"+this._data.sname+"】，未上榜，王者之路披荆斩棘…"],image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(13)),share_type:0,back:!0},null,0)):2==this._tab&&t.ShareModule.shareMessage({title:["王者争霸好友圈"],desc:["本鹅乃【"+this._data.sname+"】，好友排名第"+this._data.rank+"，还有谁？？"],image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(13)),share_type:0,back:!0},new Handler(this,this.onShareSucc),0)},i.prototype.onShareSucc=function(){0==this._cv._data.share_award&&t.Facade.callCommand(new t.ChampionShareRewardCmd)},i.prototype.destroy=function(){e.prototype.destroy.call(this),Laya.loader.clearRes("ui/champion/bg_1.png")},i}(ui.champion.RankItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t,i){e.call(this,new ui.champion.PopConfirmUI,!0,!0),this.display=this.skin,this.name="PopConfirm",this.canClickModelToClose=!1,this.setCloseButton(this.display.closeBtn),this.handler=i,this._cost=t,this.display.msgContent.text="今日免费次数已用完，是否使用"+t+"斗鱼挑战1次",this.display.cancelBtn.on(Laya.Event.CLICK,this,this.cancel),this.display.queDingBtn.on(Laya.Event.CLICK,this,this.onConfirm)}return __extends(i,e),i.prototype.destroy=function(){this.display.cancelBtn.off(Laya.Event.CLICK,this,this.cancel),this.display.queDingBtn.off(Laya.Event.CLICK,this,this.onConfirm),e.prototype.destroy.call(this)},i.prototype.onConfirm=function(){this.handler&&(t.PayConfirm.checkDouYu(this._cost,this.handler),this.display.myCheck.selected&&(t.Global.skipCheckCostChanmpion=!0)),this.destroy()},i.prototype.cancel=function(){this.handler&&this.handler.runWith(!1),this.destroy()},i}(t.BaseBox);t.PopConfirm=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this,new ui.champion.RuleUI,!0,!1,!0,!1),this.m_ui=this.skin,this.setCloseButton(this.m_ui.btnClose),this.m_ui.contentBox.vScrollBar.showButtons=!1,this.m_ui.contentBox.vScrollBar.autoHide=!0,this.m_ui.backImg.forceSkin=!0}return __extends(e,t),e.prototype.initWithHtml=function(t,e){this["final"](),this.m_ui.contentBox.vScrollBar.value=0,this.p=new Laya.HTMLDivElement,this.m_ui.contentBox.addChild(this.p),this.p.style.fontSize=27,this.p.style.fontFamily="黑体",this.p.style.color="#7c5831",this.p.style.leading=10,this.p.style.width=506,this.p.style.valign="top",this.p.x=25,t+="<br>",this.p.innerHTML=t,this.m_ui.title.text=e,this.m_ui.backImg.y=this.p.y+this.p.height+5},e.prototype["final"]=function(){this.p&&(this.m_ui.contentBox.removeChild(this.p),this.p=null)},e.prototype.destroy=function(){t.prototype.destroy.call(this)},e.prototype.onShowed=function(){t.prototype.onShowed.call(this),this.m_ui.backImg.skin="ui/rule/img_004.png"},e.prototype.setTeam=function(){this.m_ui.ruleImg.skin="ui/championteam/rule.jpg",this.m_ui.ruleImg.y=this.p.y+this.p.contextHeight},e.prototype.onHided=function(){t.prototype.onHided.call(this),Laya.loader.clearRes("ui/championteam/rule.jpg"),Laya.loader.clearRes("ui/champion/rule.jpg"),Laya.Loader.clearRes("ui/rule/img_004.png")},e}(t.BaseBox);t.RuleBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.championteam.ChampionTeamCreateTeamUI,!0,!0),this.m_ui=this.skin,this.setCloseButton(this.m_ui.boxClose),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.CHAMPION_TEAM_MODEL),this._model.on(t.ChampionTeamModel.CHAMPIONTEAM_CLOSE_PANEL,this,this.destroy),this.m_ui.cancelBtn.on(Laya.Event.CLICK,this,this.destroy),this.m_ui.confirmBtn.on(Laya.Event.CLICK,this,this.onClickSure)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),this._model.off(t.ChampionTeamModel.CHAMPIONTEAM_CLOSE_PANEL,this,this.destroy),this._model=null},i.prototype.onShowed=function(){e.prototype.onShowed.call(this),this.update()},i.prototype.onHided=function(){e.prototype.onHided.call(this)},i.prototype.update=function(){var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL);this.m_ui.costTxt.text=this._model.createTeamCost+"",this.m_ui.curTxt.text="(当前："+e.doubi+")",e.doubi>=this._model.createTeamCost?this.m_ui.costTxt.color="#7c583e":this.m_ui.costTxt.color="#ff0000"},i.prototype.onClickSure=function(){if(""!=this.m_ui.inputTxt.text){var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL);e.doubi>=this._model.createTeamCost?this._model.createTeam(this.m_ui.inputTxt.text):t.WeakTips.show("当前斗豆不足，请确认后重试！")}else t.WeakTips.show("请输入队伍名称！")},i}(t.BaseBox);t.ChampionCreateTeamPanel=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this._isShow=!1,this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.CHAMPION_TEAM_MODEL),this._model.on(t.ModelEvent.UPDATE_FINISH,this,this.update),this._um=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),this.startBtn.on(Laya.Event.CLICK,this,this.onClickFight),this.jumpImg.on(Laya.Event.CLICK,this,this.onClickJumpBox)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),this._model.off(t.ModelEvent.UPDATE_FINISH,this,this.update),this._model=null},i.prototype.hide=function(){},i.prototype.update=function(){if(this._model.isTeamFull&&this._model.haveTeam){this.visible=!0,this._model.freeTimes>0?(this.tfCost.text="消耗：免费（"+this._model.freeTimes+"）",this.costPropComp.visible=!1,this.tfCost2.text=""):this._model.goodsNum>0?(this.tfCost.text="",this.costPropComp.visible=!0,this.fightPropSkin.skin=t.ResPath().getPic("100118",t.ResourcePath.PATH_GOODS),this.tfPropNum.text="x1("+this._model.goodsNum+")",this.tfCost2.text=""):this._model.cashTimes<this._model.totalCashTimes?(this.tfCost.text="付费（"+(this._model.totalCashTimes-this._model.cashTimes)+"）："+this._model.cashCost+"斗鱼",this.costPropComp.visible=!1,this.tfCost2.text=""):(this.tfCost.text="已达付费次数上限",this.costPropComp.visible=!1,this.tfCost2.text=""),this.checkStartBtnEffect(this._model.freeTimes>0);var e=t.Facade.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);this.jumpCheckBox.selected=1==e.getLongDataValue(t.ServerSetDataModel.KEY_HAS_JUMP_CHAMPIONTEAM_FIGHT)}else this.visible=!1},i.prototype.onClickJumpBox=function(){if(this._um.level>=45||this._um.vipLevel>=6){var e=t.Facade.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);0==e.getLongDataValue(t.ServerSetDataModel.KEY_HAS_JUMP_CHAMPIONTEAM_FIGHT)?(e.setLongDataValue(t.ServerSetDataModel.KEY_HAS_JUMP_CHAMPIONTEAM_FIGHT,1),this.jumpCheckBox.selected=!0):(e.setLongDataValue(t.ServerSetDataModel.KEY_HAS_JUMP_CHAMPIONTEAM_FIGHT,0),this.jumpCheckBox.selected=!1)}else t.WeakTips.show("45级以上或者达人6可跳过战斗")},i.prototype.onClickFight=function(){if(this._model.fightSeconds>0)return void t.WeakTips.show("赛季组队时间，不可匹配！");if(this._model.freeTimes>0||this._model.goodsNum>0||this._model.oppteamid>0)this.checkStartFight(!0);else if(this._model.cashTimes<this._model.totalCashTimes)if(this._model.cashCost<=this._um.cash)if(t.Global.skipCheckCostChanmpion)this.checkStartFight(!0);else{var e=new t.PopConfirm(this._model.cashCost,Handler.create(this,this.checkStartFight));e.show()}else t.WeakTips.show("您当前的货币不足啦~要不去充充值呀？");else this._um.vipLevel<10?t.WeakTips.show("今日购买次数不足，提升达人可增加次数！"):t.WeakTips.show("今日购买次数不足！")},i.prototype.checkStartFight=function(e){e&&t.Facade.callCommand(new t.ChampionTeamFightCommand)},i.prototype.checkStartBtnEffect=function(t){this._isShow!=t&&(t?(this._helpImg||(this._helpImg=new Laya.Image,this._helpImg.skin="ui/championteam/fight.png",this._helpImg.pivot(this.startBtn.width/2,this.startBtn.width/2),this._helpImg.alpha=.5),this._helpImg.scale(1,1),this._helpImg.x=this.startBtn.x+this.startBtn.width/2,this._helpImg.y=this.startBtn.y+this.startBtn.height/2,this.addChildAt(this._helpImg,0),this._tween1&&(this._tween1.clear(),this._tween1=null),this._tween2&&(this._tween2.clear(),this._tween2=null),this.effect1Duration(),this._isShow=!0):(this._tween1&&(this._tween1.clear(),this._tween1=null),this._tween2&&(this._tween2.clear(),this._tween2=null),this._helpImg&&(this._helpImg.destroy(),this._helpImg=null),this._isShow=!1))},i.prototype.effect1Duration=function(){this._tween1=Laya.Tween.to(this._helpImg,{scaleX:1.33,scaleY:1.33},1e3/30*8,Laya.Ease.linearNone,new Handler(this,this.effect2Duration))},i.prototype.effect2Duration=function(){this._tween2=Laya.Tween.to(this._helpImg,{scaleX:1,scaleY:1},1e3/30*16,Laya.Ease.linearNone,new Handler(this,this.effect1Duration))},i}(ui.championteam.ChampionFightInfoUI);t.ChampionFightInfo=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),Object.defineProperty(i.prototype,"data",{get:function(){return this._curData},enumerable:!0,configurable:!0}),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.update=function(e){if(this._curData=e,this.stopRandomPhoto(),e){this.tfLvl.text=this._curData.level+"",this.viplevel.text=this._curData.vip_level+"",this.tfAtk.text=this._curData.attack_power+"",this.tfName.text=this._curData.name,1==this._curData.sex?this.sexIcon.skin="ui/main/img_nan.png":this.sexIcon.skin="ui/main/img_nv.png",this.defaultHead.skin=t.JSUtils.getHeadUrl("",this._curData.sex),this.photo.skin="",this.photo.skin=t.JSUtils.getHeadUrl(this._curData.headimgurl,this._curData.sex),this.on(Laya.Event.CLICK,this,this.onClick);var i=t.JSUtils.isFriend(this._curData.uid);i&&this._curData.uid!=t.Global.UID?(this.relation.visible=!0,1==i?this.relation.skin="ui/championteam/you.png":this.relation.skin="ui/championteam/bang.png"):this.relation.visible=!1}else this.tfName.text="",this.tfLvl.text="",this.viplevel.text="",this.tfAtk.text="",this.relation.visible=!1,this.sexIcon.skin="ui/main/img_nan.png",this.defaultHead.skin=t.JSUtils.getHeadUrl("",1),this.off(Laya.Event.CLICK,this,this.onClick)},i.prototype.onClick=function(){parseInt(this._curData.uid)>99999?t.Facade.callCommand(new t.UserInfoCommand(this._curData.uid)):t.WeakTips.show(" 青铜Ⅳ以上可查看对手详情！")},i.prototype.playRandomPhoto=function(){Laya.timer.loop(100,this,this.updatePhoto)},i.prototype.stopRandomPhoto=function(){Laya.timer.clear(this,this.updatePhoto)},i.prototype.updatePhoto=function(){this.photo.skin="ui/champion/p_"+Math.ceil(23*Math.random())+".png"},i}(ui.championteam.ChampionFightPlayerInfoUI);t.ChampionFightPlayerInfo=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.CHAMPION_TEAM_MODEL),this._model.on(t.ModelEvent.UPDATE_FINISH,this,this.update),this.starLst.itemRender=t.FireItem,this.starLst.renderHandler=new Handler(this,this.onStarListRender),this.starLst.array=[]}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),this._model.off(t.ModelEvent.UPDATE_FINISH,this,this.update),this._model=null},i.prototype.hide=function(){},i.prototype.update=function(){if(this._model.isTeamFull&&this._model.haveTeam){this.visible=!0,this.flag.skin=t.ResPath().getChampionRank(t.ChampionTeamView.getPicIndex(this._model.sid)),this.wordImg.skin=t.ResPath().getChampionRank("w1"+t.ChampionTeamView.getPicIndex(this._model.sid)),this.numImg.skin=t.ChampionTeamView.getNumSkin(this._model.sid),this.numImg.x=(930-this.numImg.width)/2;for(var e=[],i=0;i<this._model.fullStar;i++)e.push({solid:i<this._model.star,empty:i>=this._model.star});this.starLst.array=e,this.starLst.x=(930-29*this._model.fullStar-6*(this._model.fullStar-1))/2}else this.visible=!1},i.prototype.onStarListRender=function(t,e){t.setData(this.starLst.getItem(e))},i}(ui.championteam.ChampionFlagViewUI);t.ChampionFlagView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.championteam.ChampionTeamInviteInfoUI,!0,!0),this.m_ui=this.skin,this.setCloseButton(this.m_ui.boxClose),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.CHAMPION_TEAM_MODEL),this._model.on(t.ChampionTeamModel.CHAMPIONTEAM_INVITE_REFUSE_RET,this,this.update),this._model.on(t.ChampionTeamModel.CHAMPIONTEAM_CLOSE_PANEL,this,this.destroy),this.m_ui.leftBtn.on(Laya.Event.CLICK,this,this.onClickLeft),this.m_ui.rightBtn.on(Laya.Event.CLICK,this,this.onClickRight)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),this._model.off(t.ChampionTeamModel.CHAMPIONTEAM_INVITE_REFUSE_RET,this,this.update),this._model.off(t.ChampionTeamModel.CHAMPIONTEAM_CLOSE_PANEL,this,this.destroy),this._model=null},i.prototype.onShowed=function(){e.prototype.onShowed.call(this),this._curPage=1,this.update()},i.prototype.onHided=function(){e.prototype.onHided.call(this)},i.prototype.update=function(){this._maxPage=this._model.invites.length,0==this._maxPage?(this.m_ui.teammate0.visible=!1,this.m_ui.teammate1.visible=!1,this.m_ui.teammate2.visible=!1,this.m_ui.emptyTips.visible=!0,this.m_ui.teamTips.visible=!1,this.m_ui.pageTxt.text="0/0",this.m_ui.acceptBtn.gray=!0,this.m_ui.refuseBtn.gray=!0,this.m_ui.leftBtn.visible=!1,this.m_ui.rightBtn.visible=!1,this.m_ui.acceptBtn.off(Laya.Event.CLICK,this,this.onClickAccept),this.m_ui.refuseBtn.off(Laya.Event.CLICK,this,this.onClickRefuse),this.m_ui.teamName.text="组队邀请"):1==this._maxPage?(this.m_ui.teammate0.visible=!0,this.m_ui.teammate1.visible=!0,this.m_ui.teammate2.visible=!0,this.m_ui.emptyTips.visible=!1,this.m_ui.teamTips.visible=!0,this.m_ui.pageTxt.text="1/1",this.m_ui.acceptBtn.gray=!1,this.m_ui.refuseBtn.gray=!1,this.m_ui.leftBtn.visible=!1,this.m_ui.rightBtn.visible=!1,this.m_ui.acceptBtn.on(Laya.Event.CLICK,this,this.onClickAccept),this.m_ui.refuseBtn.on(Laya.Event.CLICK,this,this.onClickRefuse),this.showPage()):(this.m_ui.teammate0.visible=!0,this.m_ui.teammate1.visible=!0,this.m_ui.teammate2.visible=!0,this.m_ui.emptyTips.visible=!1,this.m_ui.teamTips.visible=!0,this.m_ui.acceptBtn.gray=!1,this.m_ui.refuseBtn.gray=!1,this.m_ui.leftBtn.visible=!0,this.m_ui.rightBtn.visible=!0,this.m_ui.acceptBtn.on(Laya.Event.CLICK,this,this.onClickAccept),this.m_ui.refuseBtn.on(Laya.Event.CLICK,this,this.onClickRefuse),this.showPage())},i.prototype.showPage=function(){this._curPage>this._maxPage&&(this._curPage=this._maxPage),this.m_ui.pageTxt.text=this._curPage+"/"+this._maxPage;var t=this._model.invites[this._curPage-1];if(t){this.m_ui.teamName.text="队伍："+t.name,this.m_ui.teamTips.text="【"+t.member[0].name+"】邀请您加入队伍，是否加入？";for(var e=0;e<this._model.maxTeammate;e++)this.m_ui["teammate"+e].update(t.member[e])}},i.prototype.onClickLeft=function(){this._curPage--,this._curPage<=0&&(this._curPage=this._maxPage),this.showPage()},i.prototype.onClickRight=function(){this._curPage++,this._curPage>this._maxPage&&(this._curPage=1),this.showPage()},i.prototype.onClickAccept=function(){this._model.acceptReq(this._model.invites[this._curPage-1])},i.prototype.onClickRefuse=function(){var t=this._model.invites[this._curPage-1];this._model.refuseReq(t.id,this._curPage-1)},i}(t.BaseBox);t.ChampionInviteTeamInfo=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function n(){e.call(this),this.hideBtn.on(Laya.Event.CLICK,this,this.hide),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.CHAMPION_TEAM_MODEL),this._um=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),this.tabLst.selectEnable=!0,this.tabLst.itemRender=i,this.tabLst.renderHandler=new Handler(this,this.onMenuListRender),this.tabLst.array=[{title:"上届王者"},{title:"巅峰王者"},{title:"好友"}],this.tabLst.selectHandler=new Handler(this,this.onTabSelect),this.rankLst.selectEnable=!0,this.rankLst.scrollBar.elasticDistance=50,this.rankLst.itemRender=s,this.rankLst.renderHandler=new Handler(this,this.onRankListRender),this.rankLst.scrollBar.changeHandler=new Handler(this,this.listChange),this.rankLst.array=[],this.rankLst.scrollBar.hide=!0}return __extends(n,e),n.prototype.destroy=function(){e.prototype.destroy.call(this),this._model=null,this._um=null},n.prototype.hide=function(){this.visible=!1},n.prototype.update=function(){this.visible=!0,this.hideBtn.skin="",this.hideBtn.skin="ui/champion/sbtn1_show.png",this._model.friendRank=null,this._hasSendMore=!1,this.loadTips.visible=!1,this.x=-this.width,Laya.Tween.to(this,{x:0},500,Laya.Ease.expoOut),this.tabLst.selectedIndex=2},n.prototype.onMenuListRender=function(t,e){t.setData(this.tabLst.getItem(e),e,this.tabLst.selectedIndex==e)},n.prototype.onTabSelect=function(){this.rankLst.scrollBar.value=0,0==this.tabLst.selectedIndex?this._model.lastChampionRank?this.showData(this._model.lastChampionRank.rankinfo):(this.tabLst.selectEnable=!1,t.XHR().Post({cmd:"teamqua",op:"rank",type:1,start:1,end:10},this,this.onDataRet)):1==this.tabLst.selectedIndex?this._model.curChampionRank?this.showData(this._model.curChampionRank.rankinfo):(this.tabLst.selectEnable=!1,t.XHR().Post({cmd:"teamqua",op:"rank",type:0,start:1,end:10},this,this.onDataRet)):this._model.friendRank?this.showData(this._model.friendRank.friend_array):(this.tabLst.selectEnable=!1,t.XHR().Post({cmd:"teamqua",op:"rank",type:2},this,this.onDataRet))},n.prototype.onDataRet=function(e){this.tabLst.selectEnable=!0,0==e.result?0==this.tabLst.selectedIndex?(this._model.lastChampionRank=e,this.showData(this._model.lastChampionRank.rankinfo)):1==this.tabLst.selectedIndex?(this._model.curChampionRank=e,this.showData(this._model.curChampionRank.rankinfo)):(this._model.friendRank=e,this._model.friendRank.friend_array.sort(this._model.lisSortCompare),this.showData(this._model.friendRank.friend_array)):t.WeakTips.show(e.msg)},n.prototype.showData=function(t){this.rankLst.array=t,this.updateSelf()},n.prototype.updateSelf=function(){if(this._model.haveTeam){var e=0;if(0==this.tabLst.selectedIndex)e=this._model.lastChampionRank.selfrank?this._model.lastChampionRank.selfrank:0;else if(1==this.tabLst.selectedIndex)e=this._model.curChampionRank.selfrank?this._model.curChampionRank.selfrank:0;else for(var i=0;i<this._model.friendRank.friend_array.length;i++)this._model.friendRank.friend_array[i].uid==t.Global.UID&&(e=i+1);if(0==this.tabLst.selectedIndex)if(e>0){var s=this._model.lastChampionRank.selfinfo;if(s){s.uid=t.Global.UID;var n=s}else{e=0;var n={uid:t.Global.UID,rank:1,teamid:0,teamname:"",last_win:0,sid:0,star:0,sname:"",members:[{uid:t.Global.UID,name:this._um.name,headimgurl:this._um.headimgurl,vip_level:this._um.vipLevel,level:this._um.level,sex:this._um.sex,attack_power:this._um.attackPower,win:0,flag:0,teamid:0}]}}}else var n={uid:t.Global.UID,rank:1,teamid:0,teamname:"",last_win:0,sid:0,star:0,sname:"",members:[{uid:t.Global.UID,name:this._um.name,headimgurl:this._um.headimgurl,vip_level:this._um.vipLevel,level:this._um.level,sex:this._um.sex,attack_power:this._um.attackPower,win:0,flag:0,teamid:0}]};else var n={uid:t.Global.UID,rank:1,teamid:this._model.teamId,teamname:this._model.teamName,last_win:1,sid:this._model.sid,star:this._model.star,sname:this._model.sname,members:this._model.teamMembers};this.selfItem.setData(n,e-1,3,this)}else{var n={uid:t.Global.UID,rank:1,teamid:0,teamname:0,last_win:1,sid:0,star:0,members:[{uid:t.Global.UID,name:this._um.name,headimgurl:this._um.headimgurl,vip_level:this._um.vipLevel,level:this._um.level,sex:this._um.sex,attack_power:this._um.attackPower,win:0,flag:0,teamid:0}]};this.selfItem.setData(n,-1,3,this)}},n.prototype.onRankListRender=function(t,e){t.setData(this.rankLst.getItem(e),e,this.tabLst.selectedIndex,this)},n.prototype.updateRank=function(){this.rankLst.refresh(),this.updateSelf()},n.prototype.listChange=function(){if(this.loadTips.visible=!1,(0==this.tabLst.selectedIndex||1==this.tabLst.selectedIndex)&&this.rankLst.array.length>=3&&this.rankLst.scrollBar.value>=this.rankLst.scrollBar.max+40&&!this._hasSendMore){var e,i;0==this.tabLst.selectedIndex?(e=this._model.lastChampionRank.rankinfo.length,i=this._model.lastChampionRank.totalrank,this.rankLst.length<i?(this._canLoadMore=!0,this._hasSendMore=!0,t.XHR().Post({cmd:"teamqua",op:"rank",type:1,start:e+1,end:i>=e+11?e+11:i},this,this.onLastRankRet)):this._canLoadMore=!1):1==this.tabLst.selectedIndex&&(e=this._model.curChampionRank.rankinfo.length,i=this._model.curChampionRank.totalrank,this.rankLst.length<i?(this._canLoadMore=!0,this._hasSendMore=!0,t.XHR().Post({cmd:"teamqua",op:"rank",type:0,start:e+1,end:i>=e+11?e+11:i},this,this.onCurRankRet)):this._canLoadMore=!1)}this.rankLst.scrollBar.value>=this.rankLst.scrollBar.max+30&&this._canLoadMore&&(this.loadTips.visible=!0)},n.prototype.onLastRankRet=function(e){this._hasSendMore=!1,0==e.result?(this._model.lastChampionRank.rankinfo=this._model.lastChampionRank.rankinfo.concat(e.rankinfo),this.showData(this._model.lastChampionRank.rankinfo)):t.WeakTips.show(e.msg)},n.prototype.onCurRankRet=function(e){this._hasSendMore=!1,0==e.result?(this._model.curChampionRank.rankinfo=this._model.curChampionRank.rankinfo.concat(e.rankinfo),this.showData(this._model.curChampionRank.rankinfo)):t.WeakTips.show(e.msg)},n}(ui.championteam.ChampionRankBoxUI);t.ChampionRankView=e;var i=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.setData=function(t,e,i){t&&(this.tfTab.text=t.title,this.selected=i)},Object.defineProperty(e.prototype,"selected",{set:function(t){this.normalBg.visible=!t,this.selectBg.visible=t},enumerable:!0,configurable:!0}),e}(ui.champion.TabItemUI),s=function(e){function i(){e.call(this),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.CHAMPION_TEAM_MODEL),this._um=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),this.viewTeam.on(Laya.Event.CLICK,this,this.onClickViewTeam)}return __extends(i,e),i.prototype.setData=function(e,i,s,n){if(this.btnShare.skin="",this.btnShare.skin="ui/champion/sbtn1_xuanrao.png",this.btnDianZan.skin="",this.btnDianZan.skin="ui/champion/sbtn1_dianzan.png",this.btnReward.skin="",this.btnReward.skin="ui/champion/sbtn1_reward.png",this._data=e,this._tab=s,this._cv=n,this._data){if(this.btnDianZan.visible=!1,this.btnShare.visible=!1,this.imgProp.skin="",this.tfCount.text="",this.btnReward.visible=!1,this.gotFlag.visible=!1,this.rewardBox.visible=!1,this.flagRank.visible=!1,this.flagUp.visible=!1,this.flagDown.visible=!1,this.viewTeam.visible=!1,this.lostTips.visible=!1,this._data.rank=i+1,e.uid==t.Global.UID?this.rankListBg.skin="ui/championteam/bk1.png":this._data.rank%2==0?this.rankListBg.skin="ui/championteam/bk0.png":this.rankListBg.skin="ui/championteam/bk2.png",e.rank>0&&e.rank<=3?(this.numIcon.skin="ui/champion/"+parseInt(e.rank)+".png",this.numTxt.text=""):(this.numIcon.skin="",this.numTxt.text=e.rank),0==this._data.teamid?(this.teamName.text="(未加入队伍)",this.fireIcon.visible=!1,this.tfStar.visible=!1):(this.teamName.text=this._data.teamname+"("+this._data.sname,this.fireIcon.visible=!0,this.tfStar.visible=!0,this.tfStar.text=this._data.star+")",this.fireIcon.x=this.teamName.x+this.teamName.textWidth,this.tfStar.x=this.fireIcon.x+24),0==s?(this.rewardBox.visible=!0,this.img1.skin=t.ResPath().getPic("kKingMedal",t.ResourcePath.PATH_GOODS),this.tfCount1.text=this._data.ext_award,this.img2.skin=t.ResPath().getPic("100120",t.ResourcePath.PATH_GOODS),this.tfCount2.text=this._data.ext_item):1==s?this.btnDianZan.visible=this._model.curChampionRank?0==this._model.curChampionRank.reward_flag:!1:2==s?(this.btnReward.visible=this._data.uid!=t.Global.UID&&0!=this._data.win&&0==this._data.flag,this._data.uid!=t.Global.UID&&0==this._data.win?(t.Util.toGray(this.btnReward),this.btnReward.visible=!0):t.Util.enable(this.btnReward),this.gotFlag.visible=0!=this._data.flag,this._data.uid==t.Global.UID&&2==s&&this._data.teamid>0&&(this.btnShare.visible=!0),this._data.members||(this._data.members=[this._data]),1==this._data.members.length&&0!=this._data.teamid?this.viewTeam.visible=!0:this.viewTeam.visible=!1):3==s&&(this.propCom.visible=2==this._cv.tabLst.selectedIndex,this.imgProp.skin=t.ResPath().getPic("kKingMedal",t.ResourcePath.PATH_GOODS),this._model.friendRank&&(this.tfCount.text=this._model.friendRank.award_num+"/"+this._model.friendRank.max_award),this._data.rank<=0&&(this.flagRank.visible=!0,this.numIcon.skin="",this.numTxt.text="",0==this._cv.tabLst.selectedIndex&&(this.teamName.text="",
this.lostTips.visible=!0)),2!=this._cv.tabLst.selectedIndex&&this._data.rank>0&&(this.btnShare.visible=!0)),this._data.members)for(var a=0;a<this._model.maxTeammate;a++)this["teammate"+a].update(this._data.members[a]);this.on(Laya.Event.CLICK,this,this.clickHandler)}},i.prototype.clickHandler=function(e){switch(e.target){case this.btnDianZan:t.XHR().Post({file:"petpk",cmd:"teamqua",op:"reward",idx:3},this,function(t){this.onGetDianzanReward(t)},!1);break;case this.btnShare:this.share();break;case this.btnReward:if(0==this._data.win){var i=new t.ConfirmBoxData({isShowCancelBtn:!0,contentStr:"该好友今日尚未完成首胜，是否邀请其完成？",callBackHandler:new Handler(this,this.shareToFight)});t.ConfirmBox.show(i)}else t.XHR().Post({file:"petpk",cmd:"teamqua",op:"reward",idx:100,friuid:this._data.uid},this,function(t){this.onGetSuccReward(t)},!1)}},i.prototype.shareToFight=function(){t.ShareModule.shareMessage({title:["王者组队争霸"],uid:this._data.uid,desc:["“每日胜利一场，成就王者梦想！"],image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(13)),share_type:0,back:!0},new Handler(this,this.onShareSucc),0)},i.prototype.onGetDianzanReward=function(e){0==e.result?(this._model.curChampionRank.reward_flag=1,this._cv.updateRank(),t.Facade.callCommand(new t.SyncChangeCmd(e))):t.WeakTips.show(e.msg)},i.prototype.onGetSuccReward=function(e){0==e.result?(this._model.friendRank.award_num+=15,this._data.flag=1,this._cv.updateRank(),t.Facade.callCommand(new t.SyncChangeCmd(e))):t.WeakTips.show(e.msg)},i.prototype.share=function(){3==this._tab?0==this._cv.tabLst.selectedIndex?t.ShareModule.shareMessage({title:["王者组队争霸上届王者"],desc:["上届【"+this._data.sname+"-"+this._data.star+"】在此，排名"+this._data.rank+"，本届继续辉煌…"],image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(13)),share_type:0,back:!0},new Handler(this,this.onShareSucc),0):1==this._cv.tabLst.selectedIndex&&t.ShareModule.shareMessage({title:["王者组队争霸本届快报！"],desc:["本届【"+this._data.sname+"-"+this._data.star+"】，排名"+this._data.rank+"，王者之路披荆斩棘…"],image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(13)),share_type:0,back:!0},new Handler(this,this.onShareSucc),0):2==this._tab&&t.ShareModule.shareMessage({title:["王者组队赛_好友圈"],desc:["本鹅队伍乃【"+this._data.sname+"-"+this._data.star+"】，好友排名第"+this._data.rank+"，出来混团队很重要！"],image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(13)),share_type:0,back:!0},new Handler(this,this.onShareSucc),0)},i.prototype.onShareSucc=function(){this._model.haveShareAward&&t.XHR().Post({file:"petpk",cmd:"teamqua",op:"reward",idx:4},this,function(t){this.onGetShareAward(t)},!1)},i.prototype.onGetShareAward=function(e){0==e.result?(this._model.haveShareAward=!1,t.Facade.callCommand(new t.SyncChangeCmd(e))):t.WeakTips.show(e.msg)},i.prototype.onClickViewTeam=function(){t.XHR().Post({cmd:"teamqua",op:"team",teamid:this._data.teamid},this,this.onViewRet)},i.prototype.onViewRet=function(e){if(0==e.result){this._data.members=e.team_member,this.viewTeam.visible=!1;for(var i=0;i<this._model.maxTeammate;i++)this["teammate"+i].update(this._data.members[i])}else t.WeakTips.show(e.msg)},i.prototype.destroy=function(){e.prototype.destroy.call(this)},i}(ui.championteam.ChanpionTeamRankItemUI);t.ChanpionTeamhRankItem=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.CHAMPION_TEAM_MODEL),this._model.on(t.ModelEvent.UPDATE_FINISH,this,this.update),this.imgAwardFlag.skin=t.ResPath().getPic("kKingMedal",t.ResourcePath.PATH_GOODS),this.imgAwardFlag2.skin=t.ResPath().getPic("100120",t.ResourcePath.PATH_GOODS)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),this._model.off(t.ModelEvent.UPDATE_FINISH,this,this.update),this._model=null},i.prototype.hide=function(){},i.prototype.update=function(){if(this._model.isTeamFull&&this._model.haveTeam){if(this._model.winAwards&&this._model.winAwards.length>0){this.visible=!0;var t=this._model.winAwards;0==t[0].flag?(this.tfCondition.text="首胜奖励（"+Math.min(1,this._model.winTimes)+"/1）：",this.tfNum.text=t[0].items.attrs[0].num,this.tfNum2.text=t[0].items.items[0].num,this._model.winTimes>=1?this.setGetBtnEnable(!0):this.setGetBtnEnable(!1),this._rewardIndex=0):0==t[1].flag?(this.tfCondition.text="三胜奖励（"+Math.min(3,this._model.winTimes)+"/3）：",this.tfNum.text=t[1].items.attrs[0].num,this.tfNum2.text=t[1].items.items[0].num,this._model.winTimes>=3?this.setGetBtnEnable(!0):this.setGetBtnEnable(!1),this._rewardIndex=1):0==t[2].flag?(this.tfCondition.text="五胜奖励（"+Math.min(5,this._model.winTimes)+"/5）：",this.tfNum.text=t[2].items.attrs[0].num,this.tfNum2.text=t[2].items.items[0].num,this._model.winTimes>=5?this.setGetBtnEnable(!0):this.setGetBtnEnable(!1),this._rewardIndex=2):(this.visible=!1,this._rewardIndex=-1)}}else this.visible=!1},i.prototype.setGetBtnEnable=function(t){t?(this.getBtn.gray=!1,this.getBtn.on(Laya.Event.CLICK,this,this.onClickGet)):(this.getBtn.gray=!0,this.getBtn.off(Laya.Event.CLICK,this,this.onClickGet))},i.prototype.onClickGet=function(){t.XHR().Post({cmd:"teamqua",op:"reward",idx:this._rewardIndex},this,this.onRewardRet)},i.prototype.onRewardRet=function(e){0==e.result?(t.WeakTips.show("领取成功"),t.Facade.callCommand(new t.SyncChangeCmd(e)),this._model.winAwards[this._rewardIndex].flag=1,this.update()):t.WeakTips.show(e.msg)},i}(ui.championteam.ChampionRewardViewUI);t.ChampionRewardView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.championteam.ChampionFightBoxUI,!0,!1),this.m_ui=this.skin,this.setCloseButton(this.m_ui.cancleBtn),this._isFirst=!0,this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.CHAMPION_TEAM_MODEL),this._model.on(t.ChampionTeamModel.CHAMPIONTEAM_CLOSE_PANEL,this,this.hide),this.m_ui.bg.skin=t.ResPath().getFightScene("10001"),this.m_ui.startBtn.on(Laya.Event.CLICK,this,this.startFight),this.m_ui.changBtn0.on(Laya.Event.CLICK,this,this.onClickChang0),this.m_ui.changBtn1.on(Laya.Event.CLICK,this,this.onClickChang1)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),this._model.off(t.ChampionTeamModel.CHAMPIONTEAM_CLOSE_PANEL,this,this.hide),this._model=null},i.prototype.onShowed=function(){e.prototype.onShowed.call(this),this._isShow=!0,this._isFirst?this._isFirst=!1:this.resetImageSkin(this),this.update()},i.prototype.onHided=function(){e.prototype.onHided.call(this),this._isShow=!1,this.matchData=null,Laya.timer.clear(this,this.onRandomStop),Laya.timer.clear(this,this.onTimeCountDown);for(var t=0;t<this._model.maxTeammate;t++)this.m_ui["enemy"+t].stopRandomPhoto()},i.prototype.update=function(){for(var e=0;e<this._model.maxTeammate;e++)this.m_ui["teammate"+e].update(this._model.teamMembers[e]),this.m_ui["enemy"+e].update(null),this.m_ui["enemy"+e].playRandomPhoto();this._sortArr=[0,1,2],this.m_ui.flag.skin=t.ResPath().getChampionRank(t.ChampionTeamView.getPicIndex(this._model.sid)),this.m_ui.numImg.skin=t.ChampionTeamView.getNumSkin(this._model.sid),this.m_ui.numImg.x=(240-this.m_ui.numImg.width)/2,this.m_ui.teamFlag.update(this._model),this.m_ui.enemyFlag.update(null),this.m_ui.startBtn.visible=!1,this.m_ui.cancleBtn.visible=!0,this.m_ui.timeTips.visible=!1,Laya.timer.once(2e3,this,this.onRandomStop)},i.prototype.onRandomStop=function(){t.XHR().Post({cmd:"teamqua",op:"match"},this,this.onMatchRet)},i.prototype.onMatchRet=function(e){if(0==e.result){if(t.Facade.callCommand(new t.SyncChangeCmd(e,!1)),this._model.freeTimes=e.free_times,this._model.cashTimes=e.cash_times,this._model.totalCashTimes=e.total_cash_times,this._model.cashCost=e.cash_cost,this._model.goodsNum=e.goods_num,this._model.oppteamid=1,this.matchData=e,this.matchData&&this._isShow){this.m_ui.startBtn.visible=!0,this.m_ui.cancleBtn.visible=!1,this.m_ui.timeTips.visible=!0,this._countTime=30,this.m_ui.timeTips.text=this._countTime+"秒后开始战斗...",Laya.timer.loop(1e3,this,this.onTimeCountDown),this.m_ui.enemyFlag.update({sid:this.matchData.sid,teamName:this.matchData.team_name});for(var i=0;i<this._model.maxTeammate;i++)this.m_ui["enemy"+i].update(this.matchData.team_member[i])}}else t.WeakTips.show(e.msg),this.hide()},i.prototype.onTimeCountDown=function(){this._countTime--,this._countTime<=0&&(Laya.timer.clear(this,this.onTimeCountDown),this.startFight()),this.m_ui.timeTips.text=this._countTime+"秒后开始战斗..."},i.prototype.onClickChang0=function(){var t=this.m_ui.teammate0.data;this.m_ui.teammate0.update(this.m_ui.teammate1.data),this.m_ui.teammate1.update(t);var e=this._sortArr[0];this._sortArr[0]=this._sortArr[1],this._sortArr[1]=e},i.prototype.onClickChang1=function(){var t=this.m_ui.teammate1.data;this.m_ui.teammate1.update(this.m_ui.teammate2.data),this.m_ui.teammate2.update(t);var e=this._sortArr[1];this._sortArr[1]=this._sortArr[2],this._sortArr[2]=e},i.prototype.startFight=function(){Laya.timer.clear(this,this.onTimeCountDown),this._model.fight(this._sortArr.join("|"))},i}(t.BaseBox);t.ChampionTeamFightBox=e;var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.hide=function(){},i.prototype.update=function(e){e?(this.visible=!0,this.flag.skin=t.ResPath().getChampionRank(t.ChampionTeamView.getPicIndex(e.sid)),this.numImg.skin=t.ChampionTeamView.getNumSkin(e.sid),this.numImg.scale(1/3,1/3),this.numImg.x=(80-this.numImg.width/3)/2,this.teamName.text=e.teamName):this.visible=!1},i}(ui.championteam.ChampionFightTeamFlagUI);t.ChampionFightTeamFlag=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.CHAMPION_TEAM_MODEL)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.hide=function(){},i.prototype.update=function(){if(this._model.haveTeam){this.visible=!0,this.teamName.text=this._model.teamName;for(var t=0;t<this._model.maxTeammate;t++)this["teammate"+t].update(this._model.teamMembers[t])}else this.visible=!1},i}(ui.championteam.ChampionTeamInfoUI);t.ChampionTeamInfo=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function n(){e.call(this,new ui.championteam.ChampionTeamInviteBoxUI,!0,!0),this.m_ui=this.skin,this.setCloseButton(this.m_ui.closeBtn),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.CHAMPION_TEAM_MODEL),this._um=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),this.m_ui.tabLst.selectEnable=!0,this.m_ui.tabLst.itemRender=i,this.m_ui.tabLst.renderHandler=new Handler(this,this.onMenuListRender),this.m_ui.tabLst.array=[{title:"好 友"},{title:"斗 友"},{title:"帮 友"}],this.m_ui.tabLst.selectHandler=new Handler(this,this.onTabSelect),this.m_ui.tabLst.selectedIndex=0,this.m_ui.rankLst.itemRender=s,this.m_ui.rankLst.renderHandler=new Handler(this,this.onRankListRender),this.m_ui.rankLst.array=[],this.m_ui.rankLst.scrollBar.hide=!0}return __extends(n,e),n.prototype.destroy=function(){e.prototype.destroy.call(this),this._model.off(t.ChampionTeamModel.CHAMPIONTEAM_UPDATE_INVITE_BOX,this,this.update),this._model=null},n.prototype.onShowed=function(){e.prototype.onShowed.call(this),this._model.on(t.ChampionTeamModel.CHAMPIONTEAM_UPDATE_INVITE_BOX,this,this.update),this.m_ui.closeBtn.skin="",this.m_ui.closeBtn.skin="ui/champion/sbtn1_show.png",this.update()},n.prototype.onHided=function(){e.prototype.onHided.call(this)},n.prototype.onMenuListRender=function(t,e){t.setData(this.m_ui.tabLst.getItem(e),e,this.m_ui.tabLst.selectedIndex==e)},n.prototype.onRankListRender=function(t,e){t.setData(this.m_ui.rankLst.getItem(e),e,this._curType)},n.prototype.update=function(){this.m_ui.tips.text="邀请消耗：5王者勋章/次（当前拥有"+this._um.kingMetal+"）"},n.prototype.onTabSelect=function(){0==this.m_ui.tabLst.selectedIndex?(this._curType=0,this._friendData?this.showData(this._friendData):(this.m_ui.tabLst.selectEnable=!1,t.XHR().Post({cmd:"teamqua",op:"friend",type:0},this,this.onDataRet)),this.m_ui.tips.visible=!1):1==this.m_ui.tabLst.selectedIndex?(this._curType=2,this.m_ui.tabLst.selectEnable=!1,t.XHR().Post({cmd:"teamqua",op:"friend",type:2},this,this.onDataRet),this.m_ui.tips.visible=!0):(this.m_ui.tips.visible=!1,this._curType=1,this._um.faction.facID>0?this._factionData?this.showData(this._factionData):(this.m_ui.tabLst.selectEnable=!1,t.XHR().Post({cmd:"teamqua",op:"friend",type:1},this,this.onDataRet)):(t.WeakTips.show("未加入帮派"),this.m_ui.rankLst.array=[]))},n.prototype.onDataRet=function(e){this.m_ui.tabLst.selectEnable=!0,0==e.result?(e.friendlist.sort(this._model.inviteSortCompare),0==this.m_ui.tabLst.selectedIndex?(this._friendData=e,this.showData(this._friendData)):1==this.m_ui.tabLst.selectedIndex?this.showData(e):(this._factionData=e,this.showData(this._factionData))):t.WeakTips.show(e.msg)},n.prototype.showData=function(t){this.m_ui.rankLst.array=t.friendlist},n}(t.BaseBox);t.ChampionTeamInviteBox=e;var i=function(t){function e(){t.call(this),this.tfTab.color="#a06f47",this.tfTab.bold=!0,this.tfTab.stroke=1,this.tfTab.strokeColor="#ffffff"}return __extends(e,t),e.prototype.setData=function(t,e,i){t&&(this.tfTab.text=t.title,this.selected=i)},Object.defineProperty(e.prototype,"selected",{set:function(t){this.normalBg.visible=!t,this.selectBg.visible=t},enumerable:!0,configurable:!0}),e}(ui.champion.TabItemUI),s=function(e){function i(){e.call(this),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.CHAMPION_TEAM_MODEL)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.setData=function(e,i,s){this._curData=e,e&&(this._type=s,this._curData.rank=i+1,i%2==1?this.rankListBg.skin="ui/champion/ranklistbg1.png":this.rankListBg.skin="ui/champion/ranklistbg0.png",1==this._curData.sex?this.sexIcon.skin="ui/main/img_nan.png":this.sexIcon.skin="ui/main/img_nv.png",this.imgLevel.skin=t.ResPath().getChampionRankMin(t.ChampionTeamView.getPicIndex(this._curData.sid)),this.tfTitle.text=this._curData.sname,this._curData.rank>0&&this._curData.rank<=3?(this.numIcon.skin="ui/champion/"+this._curData.rank+".png",this.numIcon.visible=!0,this.numTxt.visible=!1):(this.numTxt.text=this._curData.rank+"",this.numIcon.visible=!1,this.numTxt.visible=!0),this.tfName.text=this._curData.name,this.defaultHead.skin=t.JSUtils.getHeadUrl("",this._curData.sex),this.photo.skin="",this.photo.skin=t.JSUtils.getHeadUrl(this._curData.headimgurl,this._curData.sex),this.tfLvl.text=this._curData.level+"",this.viplevel.text=this._curData.vip_level+"",this.tfStar.text=this._curData.star,this.tfAtk.text=this._curData.attack_power+"",this.defaultHead.on(Laya.Event.CLICK,this,this.clickHandler),this._model.haveInviteUidMap[this._curData.uid]||this._curData.teamid>0?(this.inviteBtn.off(Laya.Event.CLICK,this,this.clickInvite),this.inviteBtn.gray=!0,this._model.haveInviteUidMap[this._curData.uid]?this.wordTxt.text="已邀请":this.wordTxt.text="已组队"):(this.inviteBtn.on(Laya.Event.CLICK,this,this.clickInvite),this.inviteBtn.gray=!1,this.wordTxt.text="邀请"))},i.prototype.clickHandler=function(){t.Facade.callCommand(new t.UserInfoCommand(this._curData.uid))},i.prototype.clickInvite=function(){t.XHR().Post({cmd:"teamqua",op:"invite",oppuid:this._curData.uid,type:this._type},this,this.onInviteRet)},i.prototype.onInviteRet=function(e){0==e.result?(t.WeakTips.show("邀请成功"),t.Facade.callCommand(new t.SyncChangeCmd(e,!1)),this._model.haveInviteUidMap[this._curData.uid]=1,this.inviteBtn.off(Laya.Event.CLICK,this,this.clickInvite),this.inviteBtn.gray=!0,this.wordTxt.text="已邀请",this._model.event(t.ChampionTeamModel.CHAMPIONTEAM_UPDATE_INVITE_BOX)):t.WeakTips.show(e.msg)},i}(ui.championteam.ChampionInviteRankItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.CHAMPION_TEAM_MODEL),this._model.on(t.ModelEvent.UPDATE_FINISH,this,this.update),this.shopBtn.on(Laya.Event.CLICK,this,this.onClickShop)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),this._model.off(t.ModelEvent.UPDATE_FINISH,this,this.update),this._model=null},i.prototype.hide=function(){Laya.timer.clear(this,this.startCutDown)},i.prototype.update=function(){this.shopBtn.skin="",this.shopBtn.skin="ui/champion/sbtn1_shop.png",Laya.timer.clear(this,this.startCutDown),this._model.haveTeam?(this.startCutDown(),Laya.timer.loop(1e3,this,this.startCutDown),this._model.fightTimes<5?(this.tfMax.text="还需完成"+(5-this._model.fightTimes)+"场",this.realStar.visible=!1,this.tfStarNum.visible=!1):(this.tfMax.text=this._model.bestSname,this.tfStarNum.text=this._model.bestStar+"",this.realStar.visible=!0,this.tfStarNum.visible=!0)):(this.tfMax.text="还需完成5场",this.tfTime.text="赛季结算:",this.realStar.visible=!1,this.tfStarNum.visible=!1)},i.prototype.startCutDown=function(){this._model.fightSeconds>0?(this.tfTime.text="赛季组队："+t.DateUtils.subTime(0,this._model.fightSeconds,5),this._model.fightSeconds--):this._model.seasonRemainTime<=0?(this.tfTime.text="赛季结算:",Laya.timer.clear(this,this.startCutDown)):(this.tfTime.text="赛季结算:"+t.DateUtils.subTime(0,this._model.seasonRemainTime,5),this._model.seasonRemainTime--)},i.prototype.onClickShop=function(){t.Facade.callCommand(new t.OpenWinShopCmd(6))},i}(ui.championteam.ChampionTeamLeftTopUI);t.ChampionTeamLeftTopBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.champion.ChampionLogUI,!0,!1),this._display=this.skin,this.setCloseButton(this._display.back.closeBtn),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.CHAMPION_TEAM_MODEL),this._display.back.derocation_left.skin="ui/comp/rope_xia.png",this._display.back.derocation_left.x=125,this._display.list.itemRender=i,this._display.list.scrollBar.visible=!1,this._display.list.scrollBar.elasticDistance=100,this._display.list.renderHandler=new Handler(this,this.onListLogRender),this._display.list.array=[]}return __extends(s,e),s.prototype.destroy=function(){this._display.list&&(this._display.list.scrollBar.changeHandler=null,this._display.list.destroy()),e.prototype.destroy.call(this)},s.prototype.onShowed=function(){e.prototype.onShowed.call(this),this.resetImageSkin(this),this._model.haveTeam&&this._model.isTeamFull?t.XHR().Post({cmd:"teamqua",op:"feeds",teamid:this._model.teamId},this,this.dataRet):this.dataRet({result:0,feedslist:[]})},s.prototype.dataRet=function(e){0==e.result?(this._display.list.array=e.feedslist,0==this._display.list.array.length?this._display.tips.visible=!0:this._display.tips.visible=!1):t.WeakTips.show(e.msg)},s.prototype.onListLogRender=function(t,e){t.setData(this._display.list.getItem(e))},s}(t.BaseBox);t.ChampionTeamLogView=e;var i=function(e){function i(){e.call(this),this._word=new t.ImageWord("assets/word/small_result/"),this.addChild(this._word),this.contentTxt.width=412,this.contentTxt.wordWrap=!0,this.contentTxt.leading=15,this.contentTxt.fontSize=18}return __extends(i,e),i.prototype.destroy=function(){this.replayIcon.off(Laya.Event.CLICK,this,this.onClicReplay),this.shareBtn.off(Laya.Event.CLICK,this,this.onShare),this._word&&this._word.destroy(),e.prototype.destroy.call(this)},i.prototype.setData=function(e){if(e){this._curData=e,this.timeTxt.text=t.DateUtils.formate(e.time,6);var i=e.content;i.indexOf("，");this.contentTxt.text=i,this.reward.text="",e.fight_result&&(this._word.showWordUnit(e.fight_result+""),this._word.x=495-this._word.imgWidth/2,this._word.y=65-this._word.imgHeight/2),e.fight_result<=3?t.Util.enable(this.shareBtn):t.Util.toGrayAndDisabled(this.shareBtn),this.replayIcon.on(Laya.Event.CLICK,this,this.onClicReplay),this.shareBtn.on(Laya.Event.CLICK,this,this.onShare)}},i.prototype.onClicReplay=function(){t.Facade.callCommand(new t.FightReplayCommand(this._curData.repid))},i.prototype.onShare=function(){var e="",i="";if(this._curData.content){var s=this._curData.content.indexOf("【"),n=this._curData.content.indexOf("】");s=-1==this._curData.content.indexOf("【",s+1)?s:this._curData.content.indexOf("【",s+1),n=-1==this._curData.content.indexOf("】",n+1)?n:this._curData.content.indexOf("】",n+1),e=this._curData.content.substr(s,n-s+1);var a=this._curData.content.indexOf("（"),o=this._curData.content.indexOf("）");i=this._curData.content.substr(a,o-a+1)}var r,h;3==this._curData.fight_result?(r="王者组队争霸【完胜】",h="完胜"+e+"！！！对方段位："+i+"；胜利原来如此简单…"):2==this._curData.fight_result?(r="王者组队争霸【秒杀】",h="秒杀"+e+"！！！对方段位："+i+"；讲真的，我只需要一招…"):(r="王者组队争霸【胜利】",h="击败"+e+"！！！对方段位："+i+"；对方很强，但我，更强…");var l="https://res.ledou.qq.com/show_replay.html?_wv=2147674919&pf="+t.Global.PF+"&replay_id="+this._curData.repid+"&invitor="+t.Global.UID+"&invite_openid="+t.Global.OPENID;t.Global.isWXAPP?t.ShareModule.shareMessage({title:[r],desc:[h],alertType:1,image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(13)),share_url:l},null,16):t.ShareModule.shareMessage({title:[r],desc:[h],alertType:1,share_url:l},null,16)},i}(ui.champion.ChampionLogItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.addIcon.visible=!1}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.update=function(e){if(this._curData=e,e){this.tfLvl.text=this._curData.level+"",this.viplevel.text=this._curData.vip_level+"",this.tfAtk.text=this._curData.attack_power+"",1==this._curData.sex?this.sexIcon.skin="ui/main/img_nan.png":this.sexIcon.skin="ui/main/img_nv.png",this.defaultHead.skin=t.JSUtils.getHeadUrl("",this._curData.sex),this.photo.skin="",this.photo.skin=t.JSUtils.getHeadUrl(this._curData.headimgurl,this._curData.sex),this.gray=!1;var i=t.JSUtils.isFriend(this._curData.uid);i&&this._curData.uid!=t.Global.UID?(this.relation.visible=!0,1==i?this.relation.skin="ui/championteam/you.png":this.relation.skin="ui/championteam/bang.png"):this.relation.visible=!1,this.on(Laya.Event.CLICK,this,this.onClick)}else this.tfLvl.text="",this.viplevel.text="",this.tfAtk.text="虚位以待",this.sexIcon.skin="ui/main/img_nan.png",this.defaultHead.skin=t.JSUtils.getHeadUrl("",1),this.gray=!0,this.relation.visible=!1,this.off(Laya.Event.CLICK,this,this.onClick)},i.prototype.onClick=function(){t.Facade.callCommand(new t.UserInfoCommand(this._curData.uid))},i}(ui.championteam.ChampionTeammateInfoUI);t.ChampionTeammateInfo=e;var i=function(e){function i(){e.call(this),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.CHAMPION_TEAM_MODEL)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.update=function(t){e.prototype.update.call(this,t),this.gray=!1,t?(this.levelBg.visible=!0,this.tfLvl.visible=!0,this.vipIcon.visible=!0,this.viplevel.visible=!0,this.sexIcon.visible=!0,this.fightBg.visible=!0,this.tfAtk.visible=!0,this.defaultHead.visible=!0,this.addIcon.visible=!1):(this.levelBg.visible=!1,this.tfLvl.visible=!1,this.vipIcon.visible=!1,this.viplevel.visible=!1,this.sexIcon.visible=!1,this.fightBg.visible=!1,this.tfAtk.visible=!1,this.defaultHead.visible=!1,this.relation.visible=!1,this.addIcon.visible=!0,this.on(Laya.Event.CLICK,this,this.onClick))},i.prototype.onClick=function(){this._curData?t.Facade.callCommand(new t.UserInfoCommand(this._curData.uid)):this._model.teamLeaderUid==t.Global.UID?(new t.ChampionTeamInviteBox).show():t.WeakTips.show("只有队长才可以邀请哦！")},i}(e);t.ChampionTeammateInfo2=i;var s=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this)},e.prototype.update=function(e){t.prototype.update.call(this,e),e?this.visible=!0:this.visible=!1},e}(e);t.ChampionTeammateInfo3=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,t.ModelDef.CHAMPION_TEAM_MODEL),this.createTeamCost=10,this.maxTeammate=3,this.haveInviteUidMap={}}return __extends(i,e),i.prototype.update=function(t){this.teamId=t.team_id,this.teamId?(this.teamName=t.team_name,this.teamMembers=t.team_member,this.teamLeaderUid=this.teamMembers[0].uid,this.isTeamFull=this.teamMembers.length>=this.maxTeammate,this.haveTeam=!0,this.seasonRemainTime=t.seconds,this.fightSeconds=t.fight_seconds?t.fight_seconds:0,this.bestSid=t.history_sid,this.bestStar=t.history_star,this.bestSname=t.history_sname,this.bestRank=t.history_rank,this.sid=t.sid,this.star=t.star,this.fullStar=t.full_star,this.sname=t.sname,this.rank=t.rank,this.fightTimes=t.fight_times,this.winTimes=t.win_times,this.freeTimes=t.free_times,this.cashTimes=t.cash_times,this.totalCashTimes=t.total_cash_times,this.cashCost=t.cash_cost,this.goodsNum=t.goods_num,this.haveKingAward=0==t.king_award,this.haveShareAward=0==t.share_award,this.winAwards=t.win_award,this.oppteamid=t.oppteamid?t.oppteamid:0):(this.haveTeam=!1,this.invites=t.invite?t.invite:[])},i.prototype.refuseReq=function(e,i){this._teamIndex=i,t.XHR().Post({cmd:"teamqua",op:"refuse",teamid:e},this,this.onRefuseRet)},i.prototype.onRefuseRet=function(e){0==e.result?(t.WeakTips.show("拒绝成功"),this.invites.splice(this._teamIndex,1),this.event(i.CHAMPIONTEAM_INVITE_REFUSE_RET)):t.WeakTips.show(e.msg)},i.prototype.acceptReq=function(e){for(var i=0,s=0;s<e.member.length;s++)i+=e.member[s].star;t.XHR().Post({cmd:"teamqua",op:"join",teamid:e.id,star:i},this,this.onAcceptRet)},i.prototype.onAcceptRet=function(e){0==e.result?(t.WeakTips.show("加入成功"),this.event(i.CHAMPIONTEAM_CLOSE_PANEL),this.event(i.CHAMPIONTEAM_SHOW_MAIN)):t.WeakTips.show(e.msg)},i.prototype.createTeam=function(e){t.XHR().Post({cmd:"teamqua",op:"create",name:e},this,this.onCreateRet)},i.prototype.onCreateRet=function(e){0==e.result?(t.WeakTips.show("创建成功"),t.Facade.callCommand(new t.SyncChangeCmd(e,!1)),this.event(i.CHAMPIONTEAM_CLOSE_PANEL),this.event(i.CHAMPIONTEAM_SHOW_MAIN)):t.WeakTips.show(e.msg)},i.prototype.leaveTeam=function(){t.XHR().Post({cmd:"teamqua",op:"quit"},this,this.onLeaveTeamRet)},i.prototype.onLeaveTeamRet=function(e){0==e.result?(t.WeakTips.show("离开成功"),this.event(i.CHAMPIONTEAM_SHOW_MAIN)):t.WeakTips.show(e.msg)},i.prototype.fight=function(e){t.XHR().Post({cmd:"teamqua",op:"fight",userlist:e},this,this.onFightRet)},i.prototype.onFightRet=function(e){if(0==e.result){this.updateData(e),this.oppteamid=0;var s=1==e.win,n=s?1:-1;t.SyncExecuter.constructObj(e,"kChampionStar",n);var a=t.Facade.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);if(1==a.getLongDataValue(t.ServerSetDataModel.KEY_HAS_JUMP_CHAMPIONTEAM_FIGHT)){t.Facade.callCommand(new t.SyncChangeCmd(e,!1)),this.onFightEnd();var o=e.replay?e:null;t.Facade.callCommand(new t.FightResultCommand({win:s,award:o,battleType:t.FightType.TYPE_CHAMPION}))}else{var r=new t.FightCommand(e);t.once(t.FightStaticStr.FIGHT_COMPLETE,this,this.onFightEnd),t.Facade.callCommand(r)}}else t.WeakTips.show(e.msg),this.event(i.CHAMPIONTEAM_CLOSE_PANEL)},i.prototype.updateData=function(t){t.sid>this.sid;(t.sid>this.bestSid||t.sid==this.bestSid&&t.star>this.bestStar)&&(this.bestSid=t.sid,this.bestStar=t.star,this.bestSname=t.sname),this.sid=t.sid,this.star=t.star,this.fullStar=t.full_star?t.full_star:this.fullStar,this.cashCost=t.cash_cost,this.sname=t.sname,this.fightTimes++,0!=t.win&&this.winTimes++},i.prototype.onFightEnd=function(){this.event(i.CHAMPIONTEAM_CLOSE_PANEL),this.updateFinish()},i.prototype.lisSortCompare=function(t,e){var i=t.teamid,s=e.teamid;if(i>0&&0>=s)return-1;if(0>=i&&s>0)return 1;var n=t.sid,a=e.sid;if(n>a)return-1;if(a>n)return 1;var o=t.star,r=e.star;return o>r?-1:r>o?1:0},i.prototype.inviteSortCompare=function(t,e){var i=t.sid,s=e.sid;if(i>s)return-1;if(s>i)return 1;var n=t.star,a=e.star;if(n>a)return-1;if(a>n)return 1;var o=t.attack_power,r=e.attack_power;return o>r?-1:r>o?1:0},i.CHAMPIONTEAM_SHOW_MAIN="CHAMPIONTEAM_SHOW_MAIN",i.CHAMPIONTEAM_INVITE_REFUSE_RET="CHAMPIONTEAM_INVITE_REFUSE_RET",i.CHAMPIONTEAM_CLOSE_PANEL="CHAMPIONTEAM_CLOSE_PANEL",i.CHAMPIONTEAM_UPDATE_INVITE_BOX="CHAMPIONTEAM_UPDATE_INVITE_BOX",i}(t.BaseModel);t.ChampionTeamModel=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(e){switch(this._model||(this._model=new t.ChampionTeamModel,t.Facade.singleton.model.registerModel(this._model)),e.getCommandName()){case"ChampionTeamCommand":this._panel||(this._panel=new t.ChampionTeamView(this._model)),t.SceneMgr.changeScene(this._panel);break;case"ChampionTeamFightCommand":this._fightBox||(this._fightBox=new t.ChampionTeamFightBox),this._fightBox.show();break;case"ChampionTeamLogCommand":this._logBox||(this._logBox=new t.ChampionTeamLogView),this._logBox.show()}},s.prototype.getPluginName=function(){return e.PLUGIN_CHAMPIONTEAM},s}(t.Plugin);t.ChampionTeamModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this._teamOpenLevel=35,this._userModel=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.CHAMPION_TEAM_MODEL),this.teamBtn.on(Laya.Event.CLICK,this,this.onClickTeam),this.singleBtn.on(Laya.Event.CLICK,this,this.onClickSingle),this.init()}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.update=function(){this.teamBtn.skin="",this.teamBtn.skin="ui/championteam/sbtn1_team.png",this.singleBtn.skin="",this.singleBtn.skin="ui/championteam/sbtn1_single.png"},i.prototype.init=function(){this._userModel.level<this._teamOpenLevel?(this.openTips.visible=!0,this.teamBox.gray=!0):(this.openTips.visible=!1,this.teamBox.gray=!1),this._userModel.level<25?this.singleBox.gray=!0:this.singleBox.gray=!1},i.prototype.onClickTeam=function(){this._userModel.level<this._teamOpenLevel?t.WeakTips.show("王者组队赛35级开启"):this._model.event(t.ChampionTeamModel.CHAMPIONTEAM_SHOW_MAIN)},i.prototype.onClickSingle=function(){this._userModel.level<25?t.WeakTips.show("个人争霸赛25级开启"):t.Facade.callCommand(new t.OpenChampionCmd)},i}(ui.championteam.ChampionTeamSelectUI);t.ChampionTeamSelectView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);
t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i){e.call(this,new ui.championteam.ChampionTeamUI),this.m_ui=this.skin,this._isFirst=!0,this.m_ui.cacheLayer.cacheAs="bitmap",this.m_ui.closeBtn.on(Laya.Event.CLICK,this,this.onClickBack),this.m_ui.ruleBtn.on(Laya.Event.CLICK,this,this.showRuleBox),this.m_ui.logBtn.on(Laya.Event.CLICK,this,this.showLogBox),this.m_ui.createBtn.on(Laya.Event.CLICK,this,this.onClickCreate),this.m_ui.inviteBtn.on(Laya.Event.CLICK,this,this.onClickInvite),this.m_ui.leaveBtn.on(Laya.Event.CLICK,this,this.onClickLeaveTeam),this.m_ui.showBtn.on(Laya.Event.CLICK,this,this.onClickShowRank),this._model=i,this.m_ui.simpleLst.array=[],this.m_ui.simpleLst.scrollBar.hide=!0,this.m_ui.closeBtn.y+=t.Global.FLOAT_ICON_OFFSET}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.onShowed=function(){this._isFirst?this._isFirst=!1:this.resetImageSkin(this.m_ui),this._model.on(t.ChampionTeamModel.CHAMPIONTEAM_SHOW_MAIN,this,this.onShowMain),this.update()},i.prototype.getSceneName=function(){return t.SceneDef.CHAMPIONTEAM_SCENE},i.prototype.onHided=function(){this._model.off(t.ChampionTeamModel.CHAMPIONTEAM_SHOW_MAIN,this,this.onShowMain),this._needToClearBg&&Laya.loader.clearRes(t.ResPath().getFightScene("champion")),Laya.loader.clearRes("ui/championteam/dadiban.png"),Laya.loader.clearRes("ui/championteam/mengban.png"),Laya.loader.clearRes("ui/championteam/rule.jpg"),Laya.loader.clearRes("ui/championteam/bk0.png"),Laya.loader.clearRes("ui/championteam/bk1.png"),Laya.loader.clearRes("ui/championteam/bk2.png"),Laya.loader.clearRes("res/atlas/ui/championteam.json")},i.prototype.onClickBack=function(){this._needToClearBg=!0,Laya.loader.clearRes("res/atlas/ui/champion.json"),Laya.loader.clearRes("ui/champion/bg_1.png"),Laya.loader.clearRes("ui/champion/img_diban3.png"),Laya.loader.clearRes("ui/champion/img_diban2.png"),t.Facade.callCommand(new t.HomeCommand)},i.prototype.update=function(){this._needToClearBg=!1,this.m_ui.logBtn.skin="",this.m_ui.logBtn.skin="ui/champion/sbtn1_log.png",this.m_ui.showBtn.skin="",this.m_ui.showBtn.skin="ui/champion/sbtn1_show.png",this.m_ui.bg.skin=t.ResPath().getFightScene("champion"),this.m_ui.selectPanel.visible=!0,this.m_ui.selectPanel.update(),this.m_ui.main.visible=!1,this.m_ui.rankBox.visible=!1},i.prototype.onShowMain=function(){this.m_ui.main.visible=!1,this.m_ui.teamBtns.visible=!1,t.XHR().Post({file:"petpk",cmd:"teamqua"},this,this.onDataRet)},i.prototype.onDataRet=function(e){if(0==e.result){this._model.friendRank||t.XHR().Post({cmd:"teamqua",op:"rank",type:2},this,this.onRankRet),e.pre_season&&e.pre_season.items&&e.pre_season.items.items&&e.pre_season.items.attrs&&(e.pre_season.items.items.length>0||e.pre_season.items.attrs.length>0)&&t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0,"获得上届排名奖励")),this._model.update(e),this.m_ui.main.visible=!0,this.m_ui.selectPanel.visible=!1,this.m_ui.leftTop.update(),this.m_ui.teamInfo.update(),this.m_ui.flagView.update(),this.m_ui.rewardView.update(),this.m_ui.fightView.update(),this.updateLeaveBox(),this.m_ui.teamBtns.visible=!this._model.haveTeam,this.m_ui.inviteReddot.visible=this._model.invites?this._model.invites.length>0:!1;var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);this.m_ui.showRankReddot.visible=0==i.getDailyDataValue(t.ServerSetDataModel.KEY_DAILY_CHAMPIONTEAM_REDDOT)}else t.WeakTips.show(e.msg)},i.prototype.onRankRet=function(e){if(0==e.result){this._model.friendRank=e,this._model.friendRank.friend_array.sort(this._model.lisSortCompare);for(var i=[],s=0;s<this._model.friendRank.friend_array.length;s++)i.push({defaultPhoto:{skin:t.JSUtils.getHeadUrl("",this._model.friendRank.friend_array[s].sex)},photo:{skin:t.JSUtils.getHeadUrl(this._model.friendRank.friend_array[s].headimgurl,this._model.friendRank.friend_array[s].sex)}});this.m_ui.simpleLst.array=i}},i.prototype.updateLeaveBox=function(){this._model.isTeamFull||!this._model.haveTeam?this.m_ui.leaveBtn.visible=!1:this.m_ui.leaveBtn.visible=!0},i.prototype.showRuleBox=function(){var e="<img src='ui/comp/icon.png'></img>1、赛季开始后，队长创建队伍，并邀请玩家进行组队；<br><img src='ui/comp/icon.png'></img>2、队伍满3人则组队成功，成功后本赛季内不可退出；<br><img src='ui/comp/icon.png'></img>3、队伍的初始段位为青铜菜鸟Ⅴ；<br><img src='ui/comp/icon.png'></img>4、每两周赛季结算一次，结算时间为周一的5点到7点；<br><img src='ui/comp/icon.png'></img>5、每赛季第一天为筹备组队期，期间可组队不可参赛；<br><img src='ui/comp/icon.png'></img>6、每赛季至少胜利5场（个人单独计算）方可领取奖励；<br><img src='ui/comp/icon.png'></img>7、赛季结算按本赛季队伍达到的最高段位发放奖励；<br><img src='ui/comp/icon.png'></img>8、排名前100的巅峰王者队伍，赛季结算后根据排名可获得额外奖励；<br><img src='ui/comp/icon.png'></img>9、各段位赛季结算时，获得的奖励如下。",i=new t.RuleBox;i.initWithHtml(e,""),i.setTeam(),i.show()},i.prototype.onClickShowRank=function(){var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);e.setDailyDataValue(t.ServerSetDataModel.KEY_DAILY_CHAMPIONTEAM_REDDOT,1),this.m_ui.showRankReddot.visible=!1,this.m_ui.rankBox.update()},i.prototype.showLogBox=function(){t.Facade.callCommand(new t.ChampionTeamLogCommand)},i.prototype.onClickCreate=function(){(new t.ChampionCreateTeamPanel).show()},i.prototype.onClickInvite=function(){this.m_ui.inviteReddot.visible=!1,(new t.ChampionInviteTeamInfo).show()},i.prototype.onClickLeaveTeam=function(){t.ConfirmBox.show(new t.ConfirmBoxData({contentStr:"确定要离开队伍吗？",title:"提 示",isShowXBtn:!1,callBackHandler:Handler.create(this,this.onSureToLeave)}))},i.prototype.onSureToLeave=function(){this._model.leaveTeam()},i.getPicIndex=function(t){return 25>=t?Math.floor((t+4)/5):26==t?6:void 0},i.getCiduan=function(t){var e=["Ⅴ","Ⅳ","Ⅲ","Ⅱ","Ⅰ"];return 25>=t?e[Math.floor((t-1)%5)]:""},i.getNumSkin=function(t){var e=["lv_5","lv_4","lv_3","lv_2","lv_1"];return 25>=t?"ui/champion/"+e[Math.floor((t-1)%5)]+".png":""},i}(t.BaseScene);t.ChampionTeamView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Animation,i=function(e){function i(){e.call(this,new ui.change72.Change72BoxUI,!0,!0),this._remainCanLiveCount=0,this._nextLiveIndex=0,this.display=this.skin,this.cacheAs="none",this.display.mainLayer.cacheAs="bitmap",this.setCloseButton(this.display.closeBtn),this.name="Change72Box",this.display.menuTab.labels="七\n十\n二\n变,奖\n\n励",this.display.menuTab.selectHandler=new Handler(this,this.showTab),this.display.redState.visible=!1,this.list=new laya.ui.List,this.list.vScrollBarSkin="ui/comp/vscroll.png",this.list.scrollBar.visible=!1,this.list.renderHandler=Handler.create(this,this.updateItem,null,!1),this.list.itemRender=s,this.display.mainLayer.addChildAt(this.list,this.display.mainLayer.getChildIndex(this.display.doNext)),this.list.x=107,this.list.y=107,this.list.repeatX=4,this.list.repeatY=2,this.list.spaceX=0,this.list.spaceY=11,this.rewardList=new laya.ui.List,this.rewardList.vScrollBarSkin="ui/comp/vscroll.png",this.rewardList.scrollBar.visible=!1,this.rewardList.renderHandler=Handler.create(this,this.updateRewardItem,null,!1),this.rewardList.itemRender=n,this.display.sp.addChild(this.rewardList),this.rewardList.x=242,this.rewardList.y=103,this.rewardList.repeatX=1,this.rewardList.repeatY=4,this.rewardList.spaceX=0,this.rewardList.spaceY=5,this.showTab(),t.EventCenter.singleton.on("GET_CHANGE72_GIFT_SUCCESS",this,this.getGiftSuccess),t.EventCenter.singleton.on("LIVE_CHANGE72_SUCCESS",this,this.liveSuccess),this.display.ruleBtn.on(Laya.Event.CLICK,this,this.showRule),this.display.doNext.on(Laya.Event.CLICK,this,this.liveNext)}return __extends(i,e),i.prototype.getGiftSuccess=function(t){for(var e=0;e<this._data.gifts_desc.length;e++){var s=this._data.gifts_desc[e];if(s.value==t){s.hasGet=2,s.sortV=1;break}}this._data.gifts_desc.sort(function(t,e){return 1e4*(e.sortV-t.sortV)+(t.value-e.value)}),this.rewardList.array=this._data.gifts_desc,this._hasGetRewardCount++;var n=Math.floor(i.liveCount/8);this.display.redState.visible=n>this._hasGetRewardCount},i.prototype.liveSuccess=function(t){this._nextLiveIndex--;for(var e=0;e<this._data.pet_actions.action_ids.length;e++){var i=this._data.pet_actions.action_ids[e];if(i.id==t){i.status=1;break}}this.setData(this._data,!0)},i.prototype.setData=function(e,s){void 0===s&&(s=!1),this._data=e;for(var n=t.ServerClock.getServerDateByTime(t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL).createTime-216e5),a=t.ServerClock.getServerDateByTime(t.ServerClock.getServerTime()-216e5),o=8;;){if(n.getFullYear()==a.getFullYear()&&n.getMonth()==a.getMonth()&&n.getDate()==a.getDate())break;if(o+=8,120==o)break;n.setDate(n.getDate()+1)}var r=[];this._remainCanLiveCount=0;for(var h=[],l=0;l<e.pet_actions.action_ids.length;l++){var c=e.pet_actions.action_ids[l];0==c.status?(r.push(c.id),this._remainCanLiveCount++):h.push(c.id)}this.display.doNext.visible=0==this.display.menuTab.selectedIndex?this._remainCanLiveCount>0:!1,this.display.liveTxt.text=h.length+"/"+o,i.liveCount=h.length;for(var d=Laya.loader.getRes("config/change72.json"),u=[],l=0;l<d.length;l++){var p=d[l],_={};_.id=p.position,_.act_id=p.id,_.npc_id=p.icon,_.index=p.type,_.pos=p.pos,-1!=r.indexOf(p.position)?_.status=1:-1!=h.indexOf(p.position)?_.status=2:_.status=0,u.push(_)}if(this.list.array=u,s)this.rewardList.array=this.rewardList.array;else{this._hasGetRewardCount=0;for(var l=0;l<e.gifts_desc.length;l++){var f=e.gifts_desc[l];f.value=l,f.hasGet=e.pet_actions.gifts[l],1==f.hasGet?f.sortV=3:0==f.hasGet?f.sortV=2:(f.sortV=1,this._hasGetRewardCount++)}e.gifts_desc.sort(function(t,e){return 1e4*(e.sortV-t.sortV)+(t.value-e.value)}),this.rewardList.array=e.gifts_desc}var y=Math.floor(i.liveCount/8);this.display.redState.visible=y>this._hasGetRewardCount},i.prototype.showTab=function(){var t=this.display.menuTab.selectedIndex;0==t?(this.list.visible=!0,this.rewardList.visible=!1,this.display.doNext.visible=this._remainCanLiveCount>0):(this.list.visible=!1,this.rewardList.visible=!0,this.display.doNext.visible=!1)},i.prototype.updateItem=function(t,e){e<=this.list.array.length-1&&t.doRender(this.list.array[e],e)},i.prototype.updateRewardItem=function(t,e){e<=this.rewardList.array.length-1&&t.doRender(this.rewardList.array[e])},i.prototype.showRule=function(){var e="";e+="<img src='ui/rule/icon.png'></img> 1. 点击首页的企鹅互动即可唤出企鹅气泡，依次点击气泡即可触发变身效果啦~<br>",e+="<img src='ui/rule/icon.png'></img> 2. 每日可以激活最多8个全新的变身效果，共有120组炫酷的变身特效等你探索和收集哦！<br>",e+="<img src='ui/rule/icon.png'></img> 3. 累积激活的变身效果达到指定数量还可以额外领取丰厚奖励！",t.RulePanel.showRule(e,"")},i.prototype.liveNext=function(){(this._nextLiveIndex>=this._remainCanLiveCount||this._nextLiveIndex<0)&&(this._nextLiveIndex=0);for(var t=this.list.array.length,e=0,i=0;t>i;i++){var s=this.list.array[i];if(1==s.status){if(e==this._nextLiveIndex){var n=Math.floor(i/4)+1;this.list.scrollBar.value=(n-1)*this.list.scrollBar.max/28,this._nextLiveIndex++;break}e++}}},i.prototype.destroy=function(){Laya.loader.clearRes("res/atlas/ui/item_movie.json"),this._data=null,t.EventCenter.singleton.off("GET_CHANGE72_GIFT_SUCCESS",this,this.getGiftSuccess),t.EventCenter.singleton.off("LIVE_CHANGE72_SUCCESS",this,this.liveSuccess),this.display.ruleBtn.off(Laya.Event.CLICK,this,this.showRule),this.display.doNext.off(Laya.Event.CLICK,this,this.liveNext),this.list&&(this.list.destroy(),this.list=null),this.rewardList&&(this.rewardList.destroy(),this.rewardList=null),e.prototype.destroy.call(this)},i}(t.BaseBox);t.Change72Box=i;var s=function(e){function i(){e.call(this),this.word1Gray.visible=this.word1Light.visible=!1,this.word2Gray.visible=this.word2Light.visible=!1,this.word3Gray.visible=this.word3Light.visible=!1,this.word4Gray.visible=this.word4Light.visible=!1,this.on(Laya.Event.CLICK,this,this.toLive)}return __extends(i,e),i.prototype.doRender=function(e,i){if(this.icon1.visible=this.icon2.visible=this.icon3.visible=this.icon4.visible=this.icon5.visible=this.icon6.visible=!1,this.index=i,this.npcID=e.npc_id,this.npcType=e.index,this.needScaleX=1==Number(e.pos),this.nowWord&&(this.nowWord.visible=!1),this.npcIcon.skin="ui/change72/"+e.npc_id+".png",2==e.status){this.lightBg.visible=!0,this.grayBg.visible=!1,this.npcIcon.filters=null,this["word"+e.index+"Light"].visible=!0,this.nowWord=this["word"+e.index+"Light"];for(var s=[29,85,141],n=[213,210,212],a=0;3>a;a++){var i=Number(String(e.act_id).charAt(a));this["icon"+i].visible=!0,this["icon"+i].x=s[a],this["icon"+i].y=n[a]}}else this.lightBg.visible=!1,this.grayBg.visible=!0,this.npcIcon.filters=t.FiltersUtils.getGreyFilters(),this["word"+e.index+"Gray"].visible=!0,this.nowWord=this["word"+e.index+"Gray"];this.status=e.status,this.clickToLive.visible=1==this.status},i.prototype.toLive=function(){1==this.status?t.XHR().Post({file:"petpk",cmd:"unlock",op:"active",action_id:this.index+1,uid:t.Global.UID},this,this.liveHandler):2==this.status&&this.showNpcMovie()},i.prototype.liveHandler=function(e){0==e.result?(t.EventCenter.singleton.event("LIVE_CHANGE72_SUCCESS",this.index+1),this.showNpcMovie()):t.WeakTips.show("激活失败，"+e.msg)},i.prototype.showNpcMovie=function(){var e=new t.NpcMovieBox(this.npcID,this.npcType,this.needScaleX);e.show()},i.prototype.destroy=function(){this.off(Laya.Event.CLICK,this,this.toLive),this.nowWord=null,e.prototype.destroy.call(this)},i}(ui.change72.Change72ItemUI),n=function(s){function n(){s.call(this),this.cacheAs="none",this.mainLayer.cacheAs="bitmap",this.icon1.visible=this.icon2.visible=this.icon3.visible=this.icon4.visible=this.icon5.visible=!1,this.icon1Bg.visible=this.icon2Bg.visible=this.icon3Bg.visible=this.icon4Bg.visible=this.icon5Bg.visible=!1,this.numTxt1.text=this.numTxt2.text=this.numTxt3.text=this.numTxt4.text=this.numTxt5.text="",this.getBtn.on(Laya.Event.CLICK,this,this.getBtnClickHandler)}return __extends(n,s),n.prototype.doRender=function(s){this.value=s.value,this.numTxt.text=8*(this.value+1)+"";for(var n=1;5>=n;n++)this["ani"+n]&&(this["ani"+n].stop(),this["ani"+n].visible=!1);for(var a,o=0,n=0;n<s.attrs.length&&(o++,!(o>5));n++)a=s.attrs[n],this["icon"+o].visible=!0,this["icon"+o+"Bg"].visible=!0,this["icon"+o].skin=t.ResPath().getPic(a.id,t.ResourcePath.PATH_GOODS),this["numTxt"+o].text=a.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.desc,t.Tips.show(n,e)})}(o,a,this["icon"+o]);for(var r,h=0;h<s.items.length&&(o++,!(o>5));h++)r=s.items[h],this["icon"+o].visible=!0,this["icon"+o+"Bg"].visible=!0,this["icon"+o].skin=t.ResPath().getPic(r.icon_id,t.ResourcePath.PATH_GOODS),r.id>=200001&&r.id<=4e5?(this["numTxt"+o].text=t.DateUtils.getStrByHours(r.hours),this["ani"+o]||(this["ani"+o]=new e,this["ani"+o].loadAtlas("res/atlas/ui/item_movie.json"),this["ani"+o].interval=95,this["ani"+o].index=1,this.sp.addChild(this["ani"+o]),this["ani"+o].x=this["icon"+o+"Bg"].x-51,this["ani"+o].y=this["icon"+o+"Bg"].y-52),this["ani"+o].play(),this["ani"+o].visible=!0):this["numTxt"+o].text=r.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.goods_desc,n.info=i.effect_desc,t.Tips.show(n,e)})}(o,r,this["icon"+o]);2==s.hasGet?(this.getBtn.label="已领取",this.getBtn.filters=t.FiltersUtils.getGreyFilters()):i.liveCount>=8*(this.value+1)?(this.getBtn.label="领取",this.getBtn.filters=null):(this.getBtn.label="领取",this.getBtn.filters=t.FiltersUtils.getGreyFilters())},n.prototype.getBtnClickHandler=function(){null!=this.getBtn.filters&&this.getBtn.filters!=[]||t.XHR().Post({file:"petpk",cmd:"unlock",op:"award",gift_id:this.value,uid:t.Global.UID},this,this.getGiftHandler)},n.prototype.getGiftHandler=function(e){0==e.result?(t.EventCenter.singleton.event("GET_CHANGE72_GIFT_SUCCESS",this.value),t.Facade.callCommand(new t.SyncChangeCmd(e))):t.WeakTips.show("领取失败，"+e.msg)},n.prototype.destroy=function(){for(var t=1;5>=t;t++)this.ani+t&&(this.ani.stop(),this.ani.destroy(),this.ani=null);this.getBtn.off(Laya.Event.CLICK,this,this.getBtnClickHandler),s.prototype.destroy.call(this)},n}(ui.change72.Change72RewardItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.initialize=function(t){},i.prototype.doCommand=function(e){switch(e.getCommandName()){case"OpenChange72BoxCmd":t.XHR().Post({file:"petpk",cmd:"unlock",op:"page",uid:t.Global.UID},this,this.getChange72InfoHandler)}},i.prototype.getChange72InfoHandler=function(e){0!=e.result?t.WeakTips.show("获取72变信息失败，"+e.msg):this.showChange72Box(e)},i.prototype.showChange72Box=function(e){this.change72Box||(this.change72Box=new t.Change72Box,this.change72Box.on(t.ViewEvent.BASE_DESTROY,this,this.change72BoxDestroy),this.change72Box.show(),this.change72Box.setData(e))},i.prototype.change72BoxDestroy=function(e){this.change72Box.off(t.ViewEvent.BASE_DESTROY,this,this.change72BoxDestroy),this.change72Box=null,this.unregisterPlugin()},i.prototype.getPluginName=function(){return t.PluginDef.PLUGIN_CHANGE72},i}(t.Plugin);t.Change72Module=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t,i,s){e.call(this,new ui.change72.Change72NpcMovieUI,!0,!0,!0,!1,.7),this.display=this.skin,this.canClickModelToClose=!1,this.npcID=String(t),this.npcType=i,this.needScaleX=s,this.loadNpc(),Laya.timer.frameOnce(1,this,this.addEvent)}return __extends(i,e),i.prototype.addEvent=function(){this.destroyed||Laya.stage.on(Laya.Event.CLICK,this,this.destroy)},i.prototype.loadNpc=function(){this._npcAni=new t.AnimationSKe(t.ResPath().getAnimPath(this.npcID,t.ResourcePath.PATH_NPC)+".sk",0),this._npcAni.x=t.LayerMgr.width/2,this._npcAni.y=460,this.addChild(this._npcAni),this.needScaleX&&(this._npcAni.scaleX*=-1),this._npcAni.play(t.Interactive.getActNameById(this.npcType),!1)},i.prototype.destroy=function(){Laya.stage.off(Laya.Event.CLICK,this,this.destroy),this._npcAni&&this._npcAni.removeSelf(),this.display=null,Laya.timer.frameOnce(1,this,this.clear)},i.prototype.clear=function(){this._npcAni&&(this._npcAni.destroy(),this._npcAni=null),e.prototype.destroy.call(this)},i}(t.BaseBox);t.NpcMovieBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){t.call(this,new ui.channels.AllAttrsUI,!0,!0),this.display=this.skin,this.setCloseButton(this.display.closeBtn);for(var i=e.keys.length,s=0;i>s;s++){var n=e.keys[s],a=e.get(n);this.display["txt"+(s+1)].text=n+"+"+a}}return __extends(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(t.BaseBox);t.AllAttrsBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this,new ui.channels.AllAttrsRuleUI,!0,!0),this.display=this.skin,this.setCloseButton(this.display.closeBtn)}return __extends(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(t.BaseBox);t.AllAttrsRuleBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(s,n){e.call(this,new ui.channels.ChannelsViewUI,!0,!0),this.m_djPath="assets/skeleton/channels/light_square.sk",this.m_djPath2="assets/skeleton/channels/skeleton.sk",this._doBtnDownTimer=0,this._is5Times=!1,this.display=this.skin,this.cacheAs="none",this.display.mainLayer.cacheAs="bitmap",this.display.channelBox.cacheAs="bitmap",this.display.IconBox.cacheAs="bitmap",this.setCloseButton(this.display.back.closeBtn),this.display.back.derocation_left.skin="ui/comp/rope_xia.png",this.display.back.derocation_left.x=125,this.name="ChannelsBox",this.display.menuTab.labels="求\n\n教,经\n\n脉",this.display.menuTab.selectHandler=new Handler(this,this.showTab),this.display.channelBox.visible=!1,this._labelArr=[],this.list=new laya.ui.List,this.list.vScrollBarSkin="ui/comp/vscroll.png",this.list.scrollBar.visible=!1,this.list.renderHandler=Handler.create(this,this.updateItem,null,!1),this.list.itemRender=i,this.display.page1.addChild(this.list),this.list.x=7,this.list.y=14,this.list.repeatX=5,this.list.repeatY=1,this.list.spaceX=-6,this.display.page2.visible=!1,1==n.sex?(this.display.man.visible=!0,this.display.woman.visible=!1):(this.display.man.visible=!1,this.display.woman.visible=!0),this._um=n,this._um&&(this._um.on(t.ModelEvent.UPDATE_FINISH,this,this.userModelUpdate),this.userModelUpdate(null));for(var a=1;12>=a;a++){var o=this.display["channelIcon"+a];o.name="channelIcon"+a,o.on(Laya.Event.CLICK,this,this.channelIconClickHandler),o.getChildByName("bg").visible=!1,o.getChildByName("lvTxt").visible=!1,o.getChildByName("lightIcon").visible=!1,o.getChildByName("jianTou").visible=!1,o.getChildByName("jianTou").mouseEnabled=!1}this.display.checkBox.selected=1==s.auto,this.display.checkBoxClick.alpha=0,this.display.checkBoxClick.on(Laya.Event.MOUSE_DOWN,this,this.checkBoxClick),this.setData(s),this.display.on(Laya.Event.CLICK,this,this.clickHandler),this.display.doBtn.on(Laya.Event.MOUSE_DOWN,this,this.doBtnKeyDown),this.display.doBtn.on(Laya.Event.CLICK,this,this.doBtnClick),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.doBtnKeyUp),this.display.allAttrs.on(Laya.Event.CLICK,this,this.allAttrsClickHandler),this.display.allAttrsRule.on(Laya.Event.CLICK,this,this.allAttrsRuleClickHandler),this.display.npcIcon1.on(Laya.Event.CLICK,this,this.npcIconClick),this.display.npcIcon2.on(Laya.Event.CLICK,this,this.npcIconClick),this.display.npcIcon3.on(Laya.Event.CLICK,this,this.npcIconClick),this.display.npcIcon4.on(Laya.Event.CLICK,this,this.npcIconClick),this.display.npcIcon5.on(Laya.Event.CLICK,this,this.npcIconClick),this.loadAnim()}return __extends(s,e),s.prototype.loadAnim=function(){this.m_djSk=new t.AnimationSKe(this.m_djPath),this.display.movieContainer.addChild(this.m_djSk),this.m_djSk.x=this.display["npcIcon"+this._current].x+38+this.display.IconBox.x,this.m_djSk.y=this.display["npcIcon"+this._current].y+38+this.display.IconBox.y,this.m_djSk.play(0,!0),this.m_djSk3=new t.AnimationSKe(this.m_djPath2),this.display.movieContainer.addChild(this.m_djSk3),this.m_djSk3.x=this.display.channelIcon1.x+37+this.display.channelBox.x,this.m_djSk3.y=this.display.channelIcon1.y+38+this.display.channelBox.y,this.m_djSk3.play(1,!0),this.m_djSk3.visible=!1,this.m_djSk2=new t.AnimationSKe(this.m_djPath2),this.display.movieContainer1.addChild(this.m_djSk2),this.m_djSk2.x=this.display.channelIcon1.x+37+this.display.channelBox.x,this.m_djSk2.y=this.display.channelIcon1.y+38+this.display.channelBox.y,this.m_djSk2.play(0,!0),this.m_djSk2.visible=!1},s.prototype.checkBoxClick=function(){if(this._um.vipLevel<5)t.WeakTips.show("该功能仅对达人5以上玩家开放");else{var e=this.display.checkBox.selected?0:1;t.XHR().Post({file:"petpk",cmd:"meridian",op:"set_auto",value:e,uid:t.Global.UID},this,this.setCheckBoxHandler)}},s.prototype.setCheckBoxHandler=function(e){0==e.result?this.display.checkBox.selected=!this.display.checkBox.selected:t.WeakTips.show("设置自动服用失败，"+e.msg)},s.prototype.userModelUpdate=function(e){if(this._xiuWeiCount=this._um.xiuWei,this._weiWangCount=this._um.prestige,this.display.weiWangCountTxt.text=this._um.prestige+"",this.display.xiuWeiCountTxt.text=this._um.xiuWei+"",this.display.allXiuWeiTxt.text=this._um.xiuWei+"",this._soulsArr){this._canUp=!1;for(var i=0;i<this._soulsArr.keys.length;i++){var s=this._soulsArr.get(this._soulsArr.keys[i]);s.nextXiuwei>0&&this._xiuWeiCount>=s.nextXiuwei&&(this._canUp=!0)}this._canUp?this.display.jianTou.visible=!0:this.display.jianTou.visible=!1,this._selectChannleModle&&this._xiuWeiCount>=this._selectChannleModle.nextXiuwei?(this.display.lvUpBtn.filters=null,this.display.allXiuWeiTxt.color="#25262A"):(this.display.lvUpBtn.filters=t.FiltersUtils.getGreyFilters(),this.display.allXiuWeiTxt.color="#FF0000")}},s.prototype.setData=function(e){if(this._data=e,e.hasOwnProperty("spirit")&&(this._xiuWeiCount=Number(e.spirit)>0?Number(e.spirit):0,this.display.xiuWeiCountTxt.text=this._xiuWeiCount+"",this.display.allXiuWeiTxt.text=this._xiuWeiCount+""),e.hasOwnProperty("prestige")&&(this._weiWangCount=Number(e.prestige)>0?Number(e.prestige):0,this.display.weiWangCountTxt.text=this._weiWangCount+""),e.hasOwnProperty("act_npc")&&(this.current=e.act_npc),e.hasOwnProperty("awards")){this._rewardArr=new laya.utils.Dictionary;for(var i=0;i<e.awards.length;i++){var s=e.awards[i],n=new t.RewardModel;n.id=s.id,n.spotId=s.spot_id,n.name=s.name,n.num=s.num,n.pinzhi=s.quality,n.type=s.type,n.index=s.index,this._rewardArr.set(n.index,n)}}if(this._canUp=!1,e.hasOwnProperty("souls")){this._soulsArr=new laya.utils.Dictionary;for(var a=0;a<e.souls.length;a++){var s=e.souls[a],o=new t.ChannelModel;o.id=s.id,o.spotId=s.spot_id,o.name=s.name,o.desc=s.desc,o.nextDesc=s.next_desc,o.lv=s.level,o.pinzhi=s.quality,o.strength=s.atk,o.nexttrength=s.next_atk,s.hasOwnProperty("next_spirit")&&""!=s.next_spirit?(o.nextXiuwei=s.next_spirit,this._xiuWeiCount>=o.nextXiuwei&&(this._canUp=!0)):o.nextXiuwei=0,this._soulsArr.set(o.spotId,o)}}if(e.hasOwnProperty("levels"))for(var a=0;a<e.levels.length;a++){var r=e.levels[a],h=this.display["channelIcon"+r.spot_id];h.getChildByName("needLvTxt").text=r.spot_level+"级开放"}for(var i=0;i<this._soulsArr.keys.length;i++){var l=this._soulsArr.get(this._soulsArr.keys[i]),h=this.display["channelIcon"+l.spotId],c=!1;l.nextXiuwei>0&&this._xiuWeiCount>=l.nextXiuwei&&(c=!0),h.getChildByName("jianTou").visible=c,h.getChildByName("bg").visible=!0,h.getChildByName("lvTxt").visible=!0,h.getChildByName("lvTxt").text="等级："+l.lv,h.getChildByName("needLvTxt").visible=!1,h.getChildByName("lockIcon").visible=!1,h.getChildByName("lightIcon").visible=!0,h.getChildByName("lightIcon").skin=t.ResPath().getChannel(l.spotId,l.pinzhi),null==this._selectChannleModle?1==l.spotId&&(this.selectChannleModle=l):l.spotId==this.selectChannleModle.spotId&&(this.selectChannleModle=l),l.nextXiuwei>0&&this._xiuWeiCount>=l.nextXiuwei&&(this._canUp=!0)}this._canUp?this.display.jianTou.visible=!0:this.display.jianTou.visible=!1,this.list.array=new Array(this._rewardArr.keys.length)},Object.defineProperty(s.prototype,"selectChannleModle",{get:function(){return this._selectChannleModle},set:function(e){this._selectChannleModle=e,this.display.selectNameTxt.text=e.name,this.display.selectIcon.skin=t.ResPath().getChannel(e.spotId,e.pinzhi),this.display.selectLvTxt.text=e.lv+"",this.display.selectPinzhiTxt.text=["普通","良好","优秀","稀有","极品"][e.pinzhi-1],this.display.strengthTxt.text=e.strength+"",this.display.needXiuWeiTxt.text=e.nextXiuwei+"";var i=e.desc.split("|"),s=i[0];if(s.length>0&&(this.display.attrName1Txt.text=s.split(":")[0],this.display.attrValue1Txt.text="+"+s.split(":")[1]),i.length>1){var n=i[1];n.length>0?(this.display.attrName2Txt.visible=!0,this.display.attrName2Txt.text=n.split(":")[0],this.display.attrValue2Txt.visible=!0,this.display.attrValue2Txt.text="+"+n.split(":")[1]):(this.display.attrName2Txt.visible=!1,this.display.attrValue2Txt.visible=!1)}else this.display.attrName2Txt.visible=!1,this.display.attrValue2Txt.visible=!1;if(0==e.nextXiuwei)this.display.maxLvMsg.visible=!0,this.display.nextStrengthBg.visible=!1,this.display.nextStrengthTxt.visible=!1,this.display.nextAttrName1Txt.visible=!1,this.display.nextAttrBg1.visible=!1,this.display.nextAttrName2Txt.visible=!1,this.display.nextAttrBg2.visible=!1,this.display.nextAttrValue1Txt.visible=!1,this.display.nextAttrValue2Txt.visible=!1,this.display.icon1.visible=!1,this.display.needXiuWeiTxtMsg.visible=!1,this.display.needXiuWeiTxt.visible=!1,this.display.lvUpBtn.visible=!1;else{this.display.maxLvMsg.visible=!1,this.display.nextStrengthBg.visible=!0,this.display.nextStrengthTxt.visible=!0,this.display.nextStrengthTxt.text=e.nexttrength+"",this.display.nextAttrName1Txt.visible=!0,this.display.nextAttrBg1.visible=!0,this.display.nextAttrName2Txt.visible=!0,this.display.nextAttrBg2.visible=!0,this.display.nextAttrValue1Txt.visible=!0,this.display.nextAttrValue2Txt.visible=!0,this.display.icon1.visible=!0,this.display.needXiuWeiTxtMsg.visible=!0,this.display.needXiuWeiTxt.visible=!0,this.display.lvUpBtn.visible=!0,this._selectChannleModle&&this._xiuWeiCount>=this._selectChannleModle.nextXiuwei?(this.display.lvUpBtn.filters=null,this.display.allXiuWeiTxt.color="#25262A"):(this.display.lvUpBtn.filters=t.FiltersUtils.getGreyFilters(),this.display.allXiuWeiTxt.color="#FF0000");var a=e.nextDesc.split("|"),o=a[0];if(o.length>0&&(this.display.nextAttrName1Txt.text=o.split(":")[0],this.display.nextAttrValue1Txt.text="+"+o.split(":")[1]),a.length>1){var r=a[1];r.length>0?(this.display.nextAttrName2Txt.visible=!0,this.display.nextAttrName2Txt.text=r.split(":")[0],this.display.nextAttrValue2Txt.visible=!0,this.display.nextAttrValue2Txt.text="+"+r.split(":")[1]):(this.display.nextAttrName2Txt.visible=!1,this.display.nextAttrValue2Txt.visible=!1)}else this.display.nextAttrName2Txt.visible=!1,this.display.nextAttrValue2Txt.visible=!1}},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"current",{get:function(){return this._current},set:function(t){this._current=t,this.m_djSk&&(this.m_djSk.x=this.display["npcIcon"+this._current].x+38+this.display.IconBox.x,this.m_djSk.y=this.display["npcIcon"+this._current].y+38+this.display.IconBox.y);for(var e=1;5>=e;e++)this.display["iconBgGray"+e].visible=this._current!=e,this.display["iconBgLight"+e].visible=this._current==e},enumerable:!0,configurable:!0}),s.prototype.clickHandler=function(e){var i=e.target.name;switch(i){case"autoDoBtn":this._um.vipLevel<3?t.WeakTips.show("该功能仅对达人3以上玩家开放"):this._rewardArr.keys.length<5?this._weiWangCount<Number(this.display["needWeiWangTxt"+this._current].text)?(t.WeakTips.show("威望不足"),t.Facade.callCommand(new t.GetGoodsCommand([100012,100013,100014]))):null!=this._visitRewardArr&&0!=this._visitRewardArr.length||(this._isAuto=!0,t.XHR().Post({file:"petpk",cmd:"meridian",op:"visit",id:0,uid:t.Global.UID},this,this.visitHandler)):t.WeakTips.show("奖励栏已满");break;case"useAwardBtn":var s=e.target.dataSource;this._nowUseIsItem="Item"==s[1],t.dispatch(t.ShareModule.SHARE_MODULE_EVENT,{type:3,dataType:s[1],isRenshen:s[2],quality:s[3]}),null!=this._visitRewardArr&&0!=this._visitRewardArr.length||t.XHR().Post({file:"petpk",cmd:"meridian",op:"award",index:s[0],uid:t.Global.UID},this,this.awardHandler);break;case"lvUpBtn":this._canUp&&t.XHR().Post({file:"petpk",cmd:"meridian",op:"upgrade",soulid:this.selectChannleModle.id,uid:t.Global.UID},this,this.upgradeHandler);break;case"jianTou":this._canUp&&(this.display.menuTab.selectedIndex=1,this.showTab());break;case"buyBtn":null!=this._visitRewardArr&&0!=this._visitRewardArr.length||t.Facade.callCommand(new t.GetGoodsCommand([100012,100013,100014]));break;case"guize":var n="";n+="<img src='ui/comp/icon.png'></img> 1. 造访客栈中的武林高人，有机会获得更高品质内力、修为和稀有修为道具。<br>",n+="<img src='ui/comp/icon.png'></img> 2. 造访需要消耗威望，并有机会遇到更高级的武林高人，需要消耗的威望更多，但获得的奖励会更好。<br>",n+="<img src='ui/comp/icon.png'></img> 3. 获得的修为会进入角色的修为池中，在“经脉”页签中可以消耗修为池中的修为给选定的内力升级。内力升级后可以提升内力加成的属性值。<br>",n+="<img src='ui/comp/icon.png'></img> 4. 造访时有可能获得稀有修为道具，服用道具后会获得大量修为。<br>",n+="<img src='ui/comp/icon.png'></img> 5. 注入更高品质内力后，之前同系列的内力中积攒的修为值会全部转移到更高品质的新内力中。",t.RulePanel.showRule(n,"");
}},s.prototype.allAttrsClickHandler=function(){var e=new laya.utils.Dictionary,i=this._soulsArr.keys.concat();i.sort(function(t,e){return t-e});for(var s=i.length,n=0;s>n;n++){var a=this._soulsArr.get(i[n]),o=a.desc.split("|"),r=o[0];if(r.length>0){var h=r.split(":")[0],l=r.split(":")[1];if(e.get(h)){var c=-1!=l.indexOf("%"),d=c?Number(l.split("%")[0]):Number(l),u=e.get(h);c?e.set(h,Number(u.split("%")[0])+d+"%"):e.set(h,String(Number(u)+Number(d)))}else e.set(h,l)}if(o.length>1){var p=o[1];if(p.length>0){var _=p.split(":")[0],f=p.split(":")[1];if(e.get(_)){var y=-1!=f.indexOf("%"),m=y?Number(f.split("%")[0]):Number(f),g=e.get(_);y?e.set(_,Number(g.split("%")[0])+m+"%"):e.set(_,String(Number(g)+Number(m)))}else e.set(_,f)}}}new t.AllAttrsBox(e).show()},s.prototype.allAttrsRuleClickHandler=function(){(new t.AllAttrsRuleBox).show()},s.prototype.channelIconClickHandler=function(t){var e=t.target.name,i=Number(e.split("channelIcon")[1]),s=this._soulsArr.get(i);s&&this.m_djSk2&&(this.m_djSk2.x=this.display["channelIcon"+i].x+37+this.display.channelBox.x,this.m_djSk2.y=this.display["channelIcon"+i].y+38+this.display.channelBox.y,this.m_djSk3.x=this.display["channelIcon"+i].x+37+this.display.channelBox.x,this.m_djSk3.y=this.display["channelIcon"+i].y+38+this.display.channelBox.y,this.selectChannleModle=s)},s.prototype.doBtnClick=function(){this._rewardArr.keys.length<5&&Browser.now()-this._doBtnDownTimer<300&&this.doVisitCurrent(1)},s.prototype.doBtnKeyDown=function(e){if(null==this._visitRewardArr||0==this._visitRewardArr.length)if(this._doBtnDownTimer=Browser.now(),this._rewardArr.keys.length>=5)t.WeakTips.show("奖励栏已满");else{var i=t.Facade.retrieveModel(t.ModelDef.GUIDE_MODEL);247!=i.guidetaskID&&Laya.timer.once(500,this,this.mouseDown500)}},s.prototype.doBtnKeyUp=function(t){this.destroyed||(this._is5Times=!1,Laya.timer.clear(this,this.mouseDown500),this._doBtnKeyDown=!1,this.display.doBtn.state=1)},s.prototype.mouseDown500=function(){this._is5Times=!0,this.doVisitCurrent(5)},s.prototype.npcIconClick=function(e){var i=Number(e.target.name.split("npcIcon")[1]);i==this._current&&(this._rewardArr.keys.length<5?this.doVisitCurrent():t.WeakTips.show("奖励栏已满"))},s.prototype.doVisitCurrent=function(e){if(void 0===e&&(e=1),!(null!=this._visitRewardArr&&0!=this._visitRewardArr.length||1==e&&this._is5Times))if(this._rewardArr.keys.length>=5)t.WeakTips.show("奖励栏已满");else if(this._weiWangCount<Number(this.display["needWeiWangTxt"+this._current].text))t.WeakTips.show("威望不足"),t.Facade.callCommand(new t.GetGoodsCommand([100012,100013,100014]));else{var i={file:"petpk",cmd:"meridian",op:"visit",id:this._current,uid:t.Global.UID};1!=e&&(i.times=e),t.XHR().Post(i,this,this.visitHandler)}},s.prototype.visitHandler=function(e){if(!this.destroyed)if(0!=e.result)t.WeakTips.show("拜访失败，"+e.msg),this._doBtnKeyDown=!1,this._isAuto=!1;else if(e.hasOwnProperty("results")){this._visitRewardArr=[];for(var i=this._current,s=this._weiWangCount,n=this._xiuWeiCount,a=0;a<e.results.length;a++){var o={},r=e.results[a];o.result=0,o.awards=r.awards,o.line1=r.line1,o.line2=r.line2,o.strong=r.strong,o.act_npc=r.id;var h=Number(this.display["needWeiWangTxt"+i].text),l=-1!=String(r.line1).indexOf("修为")?Number(String(r.line1).split("+")[1]):0;s-=h,n+=l,a==e.results.length-1?(this._rewardWillTo5=o.awards&&5==o.awards.length,o.spirit=e.hasOwnProperty("spirit")?Number(e.spirit)>0?Number(e.spirit):0:n,o.prestige=e.hasOwnProperty("prestige")?Number(e.prestige)>0?Number(e.prestige):0:s):(o.spirit=n,o.prestige=s),o.strong=r.strong,o.changed={attrs:[{id:"kPrestige",num:-h},{id:"kSpirit",num:l}]},this._visitRewardArr.push(o),i=Number(r.id)}this.showVisitRewardArr()}else{if(t.Facade.callCommand(new t.SyncChangeCmd(e,!1)),this._showWordNpcID=this._current,this.setData(e),this._isAuto){this._isAuto=!1;var c=e.msg.split(" "),d="啥都没获得。。。";if(c){d="";for(var a=0;a<c.length;a++)d+=c[a],a!=c.length-1&&(d+="\n")}var u=new t.ConfirmBoxData({isShowCancelBtn:!1,contentStr:d});t.ConfirmBox.show(u)}else this.showOnceLineReward(e.line1,e.strong,e.line2,this._showWordNpcID);e.hasOwnProperty("rollmsg_id")&&t.Facade.callCommand(new t.RollRefreshCmd(e.rollmsg_id))}},s.prototype.showVisitRewardArr=function(){if(this._visitRewardArr&&this._visitRewardArr.length>0){var t=this._visitRewardArr.shift();this.visitHandler(t),Laya.timer.once(200,this,this.showVisitRewardArr)}else this._is5Times&&this.doVisitCurrent(5)},s.prototype.showOnceLineReward=function(t,e,i,s){if(t&&""!=t){var n="#00FF00";if(-1!=t.indexOf("人参"))n="#FFDE00";else if(-1!=t.indexOf("雪莲"))n="#F713FF";else{var a=t.split("倍)")[0].split("(");if(a&&a.length>1){var o=Number(a[1]);switch(o){case 1:n="#FFFFFF";break;case 5:n="#3ADF00";break;case 10:n="#26DBF0"}}}var r=this.display["npcIcon"+s],h=this._labelArr.length>0?this._labelArr.shift():new laya.ui.Label;if(h.text=t,h.width=300,h.color=n,h.fontSize=e&&1==Number(e)?26:20,h.align="center",h.stroke=4,h.strokeColor="#000000",this.display.labelContainer.addChild(h),h.x=r.x+this.display.IconBox.x+r.width/2-h.width/2,h.y=r.y+this.display.IconBox.y,Laya.Tween.to(h,{y:h.y-100,alpha:.4},1e3,null,Handler.create(this,this.tweenComplete,[h])),i&&""!=i){var l=this._labelArr.length>0?this._labelArr.shift():new laya.ui.Label;l.text=i,l.width=300,l.color="#00FF00",l.fontSize=20,l.align="center",l.stroke=4,l.strokeColor="#000000",l.x=r.x+this.display.IconBox.x+r.width/2-l.width/2,l.y=r.y+this.display.IconBox.y,Laya.timer.once(400,this,function(t){this.display.labelContainer.addChild(t),Laya.Tween.to(t,{y:t.y-100,alpha:.4},1e3,null,Handler.create(this,this.tweenComplete,[t]))},[l])}}},s.prototype.awardHandler=function(e){if(0!=e.result)t.WeakTips.show("操作失败，"+e.msg);else{if(t.Facade.callCommand(new t.SyncChangeCmd(e)),e.hasOwnProperty("spirit")&&e.spirit>this._xiuWeiCount);else if(!this._nowUseIsItem){var i=e.spot_id,s=this._soulsArr.get(i);if(s){var n;if(e.hasOwnProperty("souls"))for(var a=0;a<e.souls.length;a++){var o=e.souls[a];if(o.spot_id==i){n=o;break}}n&&t.Facade.callCommand(new t.OpenNewChannelsBoxCommand(i,s.name,s.pinzhi,s.lv,s.strength,s.desc,n.name,n.quality,n.level,n.atk,n.desc))}}this.setData(e)}},s.prototype.upgradeHandler=function(e){0!=e.result?t.WeakTips.show("升级失败，"+e.msg):(t.Facade.callCommand(new t.ShowChangeRewardCmd(["升级成功！"],200,"#ffec49")),t.Facade.callCommand(new t.SyncChangeCmd(e)),this.setData(e))},s.prototype.tweenComplete=function(t){t.alpha=1,t.parent&&t.parent.removeChild(t),this._labelArr.push(t)},s.prototype.updateItem=function(t,e){e<=this._rewardArr.keys.length-1&&t.doRender(this._rewardArr.get(this._rewardArr.keys[e]))},s.prototype.showTab=function(){var e=this.display.menuTab.selectedIndex;0==e?(this.display.page1.visible=!0,this.display.page2.visible=!1,this.display.IconBox.visible=!0,this.display.channelBox.visible=!1,this.m_djSk&&(this.m_djSk.visible=!0),this.m_djSk2&&(this.m_djSk2.visible=!1),this.m_djSk3&&(this.m_djSk3.visible=!1)):(this.display.page1.visible=!1,this.display.page2.visible=!0,this.display.IconBox.visible=!1,this.display.channelBox.visible=!0,this.m_djSk&&(this.m_djSk.visible=!1),this.m_djSk2&&(this.m_djSk2.visible=!0),this.m_djSk3&&(this.m_djSk3.visible=!0),t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.CHANNEL_TAB2)))},s.prototype.destroy=function(){if(Laya.timer.clear(this,this.mouseDown500),Laya.timer.clear(this,this.showVisitRewardArr),this._visitRewardArr){for(;this._visitRewardArr.length>0;){var i=this._visitRewardArr.shift();t.Facade.callCommand(new t.SyncChangeCmd(i,!1))}this._visitRewardArr=null}this.m_djSk&&(this.m_djSk.destroy(),this.m_djSk=null),this.m_djSk2&&(this.m_djSk2.destroy(),this.m_djSk2=null),this.m_djSk3&&(this.m_djSk3.destroy(),this.m_djSk3=null),this._labelArr=null,this._data=null,this._um&&(this._um.off(t.ModelEvent.UPDATE_FINISH,this,this.userModelUpdate),this._um=null);for(var s=1;12>=s;s++){var n=this.display["channelIcon"+s];n.off(Laya.Event.CLICK,this,this.channelIconClickHandler)}this.display.npcIcon1.off(Laya.Event.CLICK,this,this.npcIconClick),this.display.npcIcon2.off(Laya.Event.CLICK,this,this.npcIconClick),this.display.npcIcon3.off(Laya.Event.CLICK,this,this.npcIconClick),this.display.npcIcon4.off(Laya.Event.CLICK,this,this.npcIconClick),this.display.npcIcon5.off(Laya.Event.CLICK,this,this.npcIconClick),this.display.off(Laya.Event.CLICK,this,this.clickHandler),this.display.doBtn.off(Laya.Event.MOUSE_DOWN,this,this.doBtnKeyDown),this.display.doBtn.off(Laya.Event.CLICK,this,this.doBtnClick),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.doBtnKeyUp),this.display.allAttrs.off(Laya.Event.CLICK,this,this.allAttrsClickHandler),this.display.allAttrsRule.off(Laya.Event.CLICK,this,this.allAttrsRuleClickHandler),this.display.checkBoxClick.off(Laya.Event.MOUSE_DOWN,this,this.checkBoxClick),this.display.menuTab.selectHandler=null,this.display=null,e.prototype.destroy.call(this)},s}(t.BaseBox);t.ChannelsBox=e;var i=function(e){function i(){e.call(this),this.pinZhi.visible=this.xiuWeiTxt.visible=!1,this.iconXueLian.visible=this.iconRenShen.visible=!1}return __extends(i,e),i.prototype.doRender=function(e){this.nameTxt.text=e.name,"Item"==e.type?(this.btn.label="服用",this.xiuWeiTxt.visible=!0,this.xiuWeiTxt.text="修为+"+e.num,this.pinZhi.visible=!1,-1!=e.name.indexOf("人参")?(this.iconXueLian.visible=!1,this.iconRenShen.visible=!0):(this.iconXueLian.visible=!0,this.iconRenShen.visible=!1),this.getChildByName("lightIcon").visible=!1):(this.btn.label="注入经脉",this.xiuWeiTxt.visible=!1,this.pinZhi.visible=!0,this.pinZhiTxt.text=["普通","良好","优秀","稀有","极品"][e.pinzhi-1],this.getChildByName("lightIcon").skin=t.ResPath().getChannel(e.spotId,e.pinzhi),this.getChildByName("lightIcon").visible=!0,this.iconXueLian.visible=this.iconRenShen.visible=!1),this.btn.dataSource=[e.index,e.type,this.iconRenShen.visible,e.pinzhi]},i.prototype.destroy=function(){this.btn.dataSource=null,e.prototype.destroy.call(this)},i}(ui.channels.ChannelsItemBoxUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.initialize=function(t){},i.prototype.doCommand=function(e){switch(e.getCommandName()){case"OpenChannelsBoxCommand":t.XHR().Post({file:"petpk",cmd:"meridian",op:"visitpage",uid:t.Global.UID},this,this.getChannelsDataHandler);break;case"OpenNewChannelsBoxCommand":var i=e;new t.NewChannlesBox(i.spotID,i.oldName,i.oldPinzhi,i.oldLv,i.oldStrength,i.oldDes,i.newName,i.newPinzhi,i.newLv,i.newStrength,i.newDes).show()}},i.prototype.getChannelsDataHandler=function(e){0!=e.result?t.WeakTips.show("获取经脉信息失败，"+e.msg):this.showChannelsBox(e)},i.prototype.showChannelsBox=function(e){if(!this.channelsBox){var i=this.retrieveModel(t.ModelDef.SELF_USER_MODEL);this.channelsBox=new t.ChannelsBox(e,i),this.channelsBox.on(t.ViewEvent.BASE_DESTROY,this,this.channelsBoxDestroy),this.channelsBox.show()}},i.prototype.channelsBoxDestroy=function(e){this.channelsBox.off(t.ViewEvent.BASE_DESTROY,this,this.channelsBoxDestroy),this.channelsBox=null,this.unregisterPlugin()},i.prototype.getPluginName=function(){return t.PluginDef.PLUGIN_CHANNELS},i}(t.Plugin);t.ChannelsModule=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Animation,i=function(i){function s(s,n,a,o,r,h,l,c,d,u,p){i.call(this,new ui.channels.NewChannelsBoxUI,!0,!0),this.display=this.skin,this.setCloseButton(this.display.closeBtn),this.name="NewChannlesBox",this.display.queDingBtn.on(Laya.Event.CLICK,this,this.queDingBtnClick),this.cacheAs="none",this.display.mainLayer.cacheAs="bitmap",this.display.name1.text=n,this.display.pinzhi1.text=["普通","良好","优秀","稀有","极品"][a-1],this.display.lv1.text=String(o),this.display.strengthTxt1.text=String(r);var _=h.split(":");this.display.attrName1.text="【"+_[0]+"】",this.display.attr1.x=this.display.attrName1.x+this.display.attrName1.textWidth,this.display.attr1.text=_[1].split("|")[0],this.display.icon1.skin=t.ResPath().getChannel(s,a),this.display.name2.text=l,this.display.pinzhi2.text=["普通","良好","优秀","稀有","极品"][c-1],this.display.lv2.text=String(d),this.display.strengthTxt2.text=String(u);var f=p.split(":");this.display.attrName2.text="【"+f[0]+"】",this.display.attr2.x=this.display.attrName2.x+this.display.attrName2.textWidth,this.display.attr2.text=f[1].split("|")[0],this.display.icon2.skin=t.ResPath().getChannel(s,c),this.ani=new e,this.ani.loadAtlas("res/atlas/ui/channelsNewMovie.json"),this.ani.interval=45,this.ani.index=1,this.ani.play(),this.display.sp.addChild(this.ani),this.ani.x=668,this.ani.y=163,this.ani.scaleX=1.12,this.ani.scaleY=1.2}return __extends(s,i),s.prototype.queDingBtnClick=function(){this.destroy()},s.prototype.destroy=function(){this.display.queDingBtn.off(Laya.Event.CLICK,this,this.queDingBtnClick),this.ani&&(this.ani.destroy(),this.ani=null),i.prototype.destroy.call(this)},s}(t.BaseBox);t.NewChannlesBox=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function n(){e.call(this,new ui.christmas.ChrismasViewUI,!0,!0),this._display=this.skin,this.setCloseButton(this._display.closeBtn),this._um=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),this.cacheAs="none",this._display.cacheLayer.cacheAs="bitmap",this._display.list.itemRender=i,this._display.list.scrollBar.visible=!1,this._display.list.renderHandler=new Laya.Handler(this,this.onRenderList),this._display.feeds.itemRender=s,this._display.feeds.scrollBar.visible=!1,this._display.feeds.renderHandler=new Laya.Handler(this,this.onRenderFeed),this._display.weaponIcon.skin=t.ResPath().getPic("200041",t.ResourcePath.PATH_WEAPON,10),this._display.weaponIcon.on(Laya.Event.CLICK,this,this.onViewWeapon),this._curCanRewardTiems=0,this._display.tree.on(Laya.Event.CLICK,this,this.onClickTree),this._display.tfRace.style.fontFamily="黑体",this._display.tfRace.scrollRect=new Laya.Rectangle(0,0,563,28),this._display.tfRace.style.fontSize=24,this._display.tfRace.style.wordWrap=!1,this._display.tfRace.style.color="#fff836",this._display.tfRace.style.stroke=2,this._display.tfRace.style.valign="top",this._display.raceComp.visible=!1;var n=t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL);this._aid=n.GetActByFrontId(78).id}return __extends(n,e),n.prototype.destroy=function(){this._xiaxueAni&&(this._xiaxueAni.destroy(),this._xiaxueAni=null),e.prototype.destroy.call(this),Laya.loader.clearRes("ui/christmas/bg.png"),Laya.loader.clearRes("ui/christmas/shu.png"),Laya.loader.clearRes("ui/christmas/guanggao.png")},n.prototype.onShowed=function(){e.prototype.onShowed.call(this),t.XHR().Post({cmd:"activity",aid:this._aid},this,this.init)},n.prototype.onHided=function(){e.prototype.onHided.call(this)},n.prototype.init=function(e){if(0==e.result){t.Util.DecodeJSONProperty("msg",e),this._curData=e;var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL),s=i.GetActById(this._aid),n=t.DateUtils.getTimeFomateObj(s.last_seconds);this._display.timeTips.text="活动结束剩余："+n.day+"天"+n.hour+"时",e.times_award.reverse(),this._display.list.array=e.times_award,this._display.feeds.array=e.msginfo,this._display.feeds.scrollBar.value=this._display.feeds.scrollBar.max,this.updatePanel(e),this.checkShowRace()}else t.WeakTips.show(e.msg)},n.prototype.updatePanel=function(t){this._display.rewadBtn.label="领奖("+t.totaltimes+")",this.checkCanReward(),t.daytimes<t.free_times?(this._display.wishBtn.label="免费("+(t.free_times-t.daytimes)+")",this._display.cost.visible=!1):(this._display.wishBtn.label="许愿("+(t.cash_times-t.daytimes+t.free_times)+")",this._display.cost.visible=!0,this._display.costTxt.text=t.cost_cash+"/",this._display.costTxt2.x=this._display.costTxt.x+this._display.costTxt.textWidth,this._display.costTxt2.text=""+this._um.doubi,this._um.doubi<t.cost_cash?this._display.costTxt2.color="#ff0000":this._display.costTxt2.color="#ffffff"),this._display.wishBtn.on(Laya.Event.CLICK,this,this.onWish)},n.prototype.checkShowRace=function(){if(this._curData.msginfo&&this._curData.msginfo.length>0)for(var t=this._curData.msginfo.length-1;t>=0;t--)if(-1!=this._curData.msginfo[t].msg.indexOf("特级")){this.showXiaxue(),this.playRace(this._curData.msginfo[t].msg);break}},n.prototype.onWish=function(){this._curData.cash_times+this._curData.free_times-this._curData.daytimes>0?this._um.doubi>=this._curData.cost_cash||this._curData.free_times>this._curData.daytimes?t.XHR().Post({cmd:"activity",aid:this._aid,op:"lottery"},this,this.onLottery):t.WeakTips.show("当前剩余斗豆存量不足"):t.WeakTips.show("今日许愿次数已达上限")},n.prototype.onLottery=function(e){if(0==e.result){var i=1==e.type?"特级大礼":2==e.type?"高级大礼":"幸运礼品";if(t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0,"恭喜向圣诞树许愿获得【"+i+"】")),1==e.type||2==e.type){var s="";e.award.items&&e.award.items.length>0&&(s=e.award.items[0].num?e.award.items[0].name+"+"+e.award.items[0].num:e.award.items[0].name+"+"+e.award.items[0].hours/24+"天");var n="恭喜【"+this._um.name+"】许愿获得（圣诞"+i+"）："+s+"！",a={timestamp:Math.floor(t.ServerClock.getServerTime()/1e3),msg:n};this._curData.msginfo.length>20&&this._curData.msginfo.shift(),this._curData.msginfo.push(a),this._display.feeds.array=this._curData.msginfo,this._display.feeds.scrollBar.value=this._display.feeds.scrollBar.max,1==e.type&&(this.showXiaxue(),this.playRace(n))}this._curData.totaltimes++,this._curData.daytimes++,this.updatePanel(this._curData)}else t.WeakTips.show(e.msg)},n.prototype.onViewWeapon=function(){var e={};e.uptype=1,e.name="无尽雪球",e.desc="必中！造成自身等级*18点额外伤害。50%概率令对方眩晕，持续1次行动。",e.id=200041,e.isage=1,t.Facade.callCommand(new t.ShowUpAnimationCMD(e))},n.prototype.checkCanReward=function(){this._display.rewadBtn.on(Laya.Event.CLICK,this,this.onGetReward),this._display.rewadBtn.gray=!0,this._showIndex=this._curData.times_award.length-1;for(var t=this._curData.times_award.length-1;t>=0;t--){if(this._curData.times_award[t].times>this._curData.awardtimes&&this._curData.times_award[t].times<=this._curData.totaltimes){this._curCanRewardTiems=this._curData.times_award[t].times,this._display.rewadBtn.gray=!1;break}this._curData.times_award[t].times==this._curData.awardtimes&&(this._showIndex=t)}this._showIndex<=2||this._curData.times_award.length<=3?this._display.list.scrollBar.value=0:this._showIndex>=this._curData.times_award.length-1?this._display.list.scrollBar.value=this._display.list.scrollBar.max:this._display.list.scrollBar.value=this._display.list.scrollBar.max-120*(this._curData.times_award.length-1-this._showIndex)},n.prototype.onGetReward=function(){this._display.rewadBtn.gray?t.WeakTips.show("当前无奖励可领取"):t.XHR().Post({cmd:"activity",aid:this._aid,op:"award"},this,this.onRewardRet)},n.prototype.showXiaxue=function(){this._xiaxueAni||(this._xiaxueAni=new t.AnimationSKe(t.ResPath().getEffect("xiaxue")),this._xiaxueAni.x=this._display.width/2,this._xiaxueAni.y=this._display.height/2,this._xiaxueAni.on(Laya.Event.STOPPED,this,this.onXiaxueStop)),this._display.addChild(this._xiaxueAni),this._xiaxueAni.play(0,!1)},n.prototype.onXiaxueStop=function(){this._display.removeChild(this._xiaxueAni)},n.prototype.onRewardRet=function(e){0==e.result?(this._curData.awardtimes=this._curCanRewardTiems,this._display.list.array=this._curData.times_award,this.checkCanReward(),t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0,"恭喜获得许愿"+this._curCanRewardTiems+"次的额外大礼"))):t.WeakTips.show(e.msg)},n.prototype.playRace=function(t){this._display.raceComp.visible=!0,this._display.tfRace.innerHTML=t,this._display.tfRace.scrollRect.width=this._display.tfRace.contextWidth,this._display.tfRace.width=this._display.tfRace.contextWidth,this._display.tfRace.scrollRect.x=0,Laya.timer.frameLoop(1,this,this.startRace)},n.prototype.startRace=function(){this._display.tfRace.scrollRect.x+=2,this._display.tfRace.width-this._display.tfRace.scrollRect.x<0&&this.hideRaceComp()},n.prototype.hideRaceComp=function(){Laya.timer.clear(this,this.startRace),this._display.raceComp.visible=!1},n.prototype.onRenderList=function(t,e){t.update(this._display.list.getItem(e),e,this._curData)},n.prototype.onRenderFeed=function(t,e){t.update(this._display.feeds.getItem(e),e,this._curData)},n.prototype.onClickTree=function(){t.Tips.tipsClose(),new t.ChristmasGift(this._curData).show()},n}(t.BaseBox);t.ChristmasBox=e;var i=function(e){function i(){e.call(this),this.on(Laya.Event.CLICK,this,this.onClickItem)}return __extends(i,e),i.prototype.update=function(e,i,s){this._curData=e,this.gift.skin=t.ResPath().getPic("gift"+(7-i),t.ResourcePath.PATH_GOODS),e.times<=s.awardtimes?(this.giftTxt.text="已领取",this.gray=!0):(this.giftTxt.text=e.times+"次",this.gray=!1)},i.prototype.onClickItem=function(){var e="",i=new t.DecodeDataCmd(this._curData.detail);t.Facade.callCommand(i);for(var s,n=0;n<i.rewardBoxArr.length;n++)s=i.rewardBoxArr[n],e+=s.num?s.name+"*"+s.num+";\n":s.name+"*"+s.hours/24+"天;\n";var a,o={};a=this.localToGlobal(new laya.maths.Point(0,0)),o.name="礼包",o.info="将获得以下道具：",o.desc=e,t.Tips.show(o,a)},i}(ui.christmas.ChristmasGiftItemUI);t.ChristmasGiftItem=i;var s=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.update=function(t,e,i){if(t){var s=new Date;s.setTime(1e3*t.timestamp),this.feed.text=s.getHours()+":"+(s.getMinutes()>=10?s.getMinutes():"0"+s.getMinutes())+" "+t.msg,-1!=t.msg.indexOf("特级")?this.feed.color="#fd420b":this.feed.color="#d556ff"}},e}(ui.christmas.ChristmasFeedItemUI);t.ChristmasFeedItem=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){t.call(this,new ui.christmas.ChristmasGiftsUI,!0,!0),this._curData=e,this._display=this.skin,this.setCloseButton(this._display.back.closeBtn),this.update()}return __extends(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this)},e.prototype.onShowed=function(){t.prototype.onShowed.call(this)},e.prototype.onHided=function(){t.prototype.onHided.call(this)},e.prototype.update=function(){if(this._curData.lottery_award)for(var t=0;3>t;t++)this._curData.lottery_award[t]&&this.updateGift(this._curData.lottery_award[t].detail,t)},e.prototype.updateGift=function(t,e){var i;i=t.attrs?t.attrs.concat(t.items):t.items;for(var s=0;7>s;s++)i[s]?(this._display["gift"+e+"_"+s].visible=!0,this._display["gift"+e+"_"+s].update(i[s])):this._display["gift"+e+"_"+s].visible=!1},e}(t.BaseBox);t.ChristmasGift=e;var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.update=function(e){this.on(Laya.Event.CLICK,this,this.onClick),this._curData=e,e.icon_id?this.icon.skin=t.ResPath().getPic(e.icon_id,t.ResourcePath.PATH_GOODS):this.icon.skin=t.ResPath().getPic(e.id,t.ResourcePath.PATH_GOODS),e.num?this.giftTxt.text=""+e.num:this.giftTxt.text=""+e.hours/24+"天"},i.prototype.onClick=function(){t.Tips.tipsClose();var e,i={};e=this.localToGlobal(new Laya.Point(0,0)),i.name=this._curData.name,this._curData.goods_desc?i.desc=this._curData.goods_desc:i.desc=this._curData.desc,t.Tips.show(i,e)},i}(ui.christmas.ChristmasGiftShowUI);t.ChristmasGiftShow=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"ChristmasCommand":(new t.ChristmasBox).show()}},s.prototype.getPluginName=function(){return e.PLUGIN_CHRISTMAS},s}(t.Plugin);t.ChristmasModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(t){switch(t.getCommandName()){case"ChristmasTotalCmd":this.showMainScene()}},s.prototype.showMainScene=function(){this._christmasTotalScene||(this._christmasTotalScene=new t.ChristmasTotalScene,this._christmasTotalScene.on(t.ViewEvent.BASE_DESTROY,this,this.christmasTotalSceneDestroy),t.SceneMgr.changeScene(this._christmasTotalScene))},s.prototype.christmasTotalSceneDestroy=function(e){this._christmasTotalScene&&(this._christmasTotalScene.off(t.ViewEvent.BASE_DESTROY,this,this.christmasTotalSceneDestroy),this._christmasTotalScene=null),this.unregisterPlugin()},s.prototype.getPluginName=function(){return e.PLUGIN_CHRISTMASTOTAL},s}(t.Plugin);t.ChristmasTotalModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.christmasTotal.ChristmasTotalUI),this.LVS=[76,52,25,83,53,56,55],this._display=this.skin,this._display.on(Laya.Event.CLICK,this,this.clickHandler),this._display.backBtn.x-=t.Global.FLOAT_ICON_OFFSET,this.cacheAs="none",Browser.onIOS&&(this._display.btn1.visible=!1,this._display.btn2.visible=!1,this._display.btn3.visible=!1,this._display.btn4.visible=!1,this._display.btn7.visible=!1,this._display.label_1.visible=!1,this._display.label_2.visible=!1,this._display.label_3.visible=!1,this._display.label_4.visible=!1,this._display.label_7.visible=!1);for(var i=t.Facade.retrieveModel(t.ModelDef.ACT_MODEL),s=0;s<this.LVS.length;s++)i.hasActivity(this.LVS[s])||83==this.LVS[s]?(this._display["btn"+(s+1)].visible=!0,this._display["label_"+(s+1)].visible=!0):(this._display["btn"+(s+1)].visible=!1,this._display["label_"+(s+1)].visible=!1)}return __extends(i,e),i.prototype.onShowed=function(){},i.prototype.clickHandler=function(e){switch(e.target.name){case"backBtn":t.Facade.callCommand(new t.HomeCommand);break;case"btn1":t.Facade.callCommand(new t.ActCenterCMD(76));break;case"btn2":t.Facade.callCommand(new t.RebateCmd);break;case"btn3":t.Facade.callCommand(new t.ActCenterCMD(25));break;case"btn4":t.Facade.callCommand(new t.MusicMasterCommand);break;case"btn5":t.Facade.callCommand(new t.ActCenterCMD(53));break;case"btn6":t.Facade.callCommand(new t.ActCenterCMD(56));break;case"btn7":t.Facade.callCommand(new t.ActCenterCMD(55))}},i.prototype.onHided=function(){this.destroy()},i.prototype.getSceneName=function(){return t.SceneDef.NATIONAL_TOTAL},i.prototype.destroy=function(){this._display.off(Laya.Event.CLICK,this,this.clickHandler),e.prototype.destroy.call(this)},i}(t.BaseScene);t.ChristmasTotalScene=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.christmasTotal.FirstChristmasPngBoxUI,!0,!0),this._display=this.skin,this.canClickModelToClose=!1,this.setCloseButton(this._display.closeBtn),this.name="FirstChristmasPngBox",this._display.clickPng.on(Laya.Event.CLICK,this,this.clickHandler)}return __extends(i,e),i.prototype.clickHandler=function(){t.Facade.callCommand(new t.ChristmasTotalCmd)},i.prototype.destroy=function(){Laya.loader.clearRes("ui/christmasTotal/ad.jpg"),Laya.loader.clearRes("ui/national/firstEnterPng/bg.png"),Laya.loader.clearRes("ui/national/firstEnterPng/down.png"),this._display.clickPng.off(Laya.Event.CLICK,this,this.clickHandler),t.dispatch(t.MainModule.OPENBOXEVENT),e.prototype.destroy.call(this)},i}(t.BaseBox);t.FirstChristmasPngBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"CollectCommand":this._collectView||(this._collectView=new t.CollectView);var i=this.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);if(1!=i.hasCollect){i.hasCollect=1;var s=t.Facade.singleton.model.retrieveModel(t.ModelDef.GUIDE_MODEL);s.guidetaskID=70020}this._collectView.on(t.ViewEvent.BOX_HIDE,this,this.onClosePanel),this._collectView.show();break;case"WeixinCollectCommand":this._weixinCollect||(this._weixinCollect=new t.WeixinCollectView),this._weixinCollect.on(t.ViewEvent.BASE_DESTROY,this,this.onCloseWeixin);var n=this.checkIsFirstEnter();this._weixinCollect.showGuide=n,this._weixinCollect.show()}},s.prototype.onClosePanel=function(){this._collectView&&(this._collectView.off(t.ViewEvent.BOX_HIDE,this,this.onClosePanel),Laya.loader.clearRes("ui/collect/bg.jpg"))},s.prototype.onCloseWeixin=function(){this._weixinCollect&&(this._weixinCollect.off(t.ViewEvent.BASE_DESTROY,this,this.onCloseWeixin),this._weixinCollect=null),Laya.loader.clearRes("ui/collect/weixinbg.jpg")},s.prototype.getPluginName=function(){return e.PLUGIN_COLLECT},s.prototype.checkIsFirstEnter=function(){var e=!1,i=this.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL),s=i.getLongDataValue(t.ServerSetDataModel.KEY_HAS_SHOW_WEIXIN_COLLECT_GUIDE);if(0==s&&!t.Global.isWXAPP){e=!0,i.setLongDataValue(t.ServerSetDataModel.KEY_HAS_SHOW_WEIXIN_COLLECT_GUIDE,1);var n=t.Facade.singleton.model.retrieveModel(t.ModelDef.GUIDE_MODEL);n.guidetaskID=70010}return e},s.COLLECT_WEIXIN_SHORT_CUT="COLLECT_WEIXIN_SHORT_CUT",s}(t.Plugin);t.CollectModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.collect.CollectUI,!0,!1),this._display=this.skin,this.name="CollectViewBox",this._display.back.di.visible=!1,this.setCloseButton(this._display.closeBtn),t.Global.isSQ&&(this._display.iconBtn.skin="ui/collect/iconq.png",this._display.imgBtn.skin="ui/collect/iconq.png")}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.onShowed=function(){e.prototype.onShowed.call(this),this.resetImageSkin(this._display),this._display.addBtn.on(Laya.Event.CLICK,this,this.onClickAddDesk),t.XHR().Post({cmd:"addesk",subcmd:"Get",needreload:"1"},this,this.onResult)},i.prototype.onClickGet=function(){t.XHR().Post({cmd:"addesk",subcmd:"GetGift"},this,this.onGetGiftResult)},i.prototype.onGetGiftResult=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!0)),this._curData.flag=2,this.updateBtn()):t.WeakTips.show(e.msg)},i.prototype.onClickAddDesk=function(){var e=t.Facade.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);return e.hasCollect=1,t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.COLLECT_CLICK)),t.Global.isWX?void t.XHR().Post({cmd:"addesk",subcmd:"AddDesk"},this,this.onAddDeskBack):(t.JSUtils.addShortcut(this.addCallBack),void((Laya.Browser.onIOS||t.Global.isWB)&&t.XHR().Post({cmd:"addesk",subcmd:"AddDesk"},this,this.onAddDeskBack)))},i.prototype.addCallBack=function(e){0==e.result?(t.WeakTips.show("收藏成功"),this._curData&&(0==this._curData.flag&&(this._curData.flag=1),this.updateBtn()),t.XHR().Post({cmd:"addesk",subcmd:"AddDesk"},this,this.onAddDeskBack)):4==e.result?(t.WeakTips.show("已收藏"),this._curData&&(0==this._curData.flag&&(this._curData.flag=1),
this.updateBtn()),t.XHR().Post({cmd:"addesk",subcmd:"AddDesk"},this,this.onAddDeskBack)):t.WeakTips.show("收藏失败:可能是您的手机限制了创建桌面快键方式，请到手机的软件权限管理中，设置允许QQ创建快键方式，然后重试")},i.prototype.onAddDeskBack=function(e){0==e.result?this._curData&&(0==this._curData.flag&&(this._curData.flag=1),this.updateBtn()):t.WeakTips.show(e.msg)},i.prototype.onResult=function(e){0==e.result?(this._curData=e,this._curData.flag=parseInt(this._curData.flag),this.updatePanel(e)):t.WeakTips.show(e.msg)},i.prototype.updatePanel=function(e){var i=e.award.items;i||(i=[]);for(var s=0;4>s;s++)i[s]?(this._display["reward"+s].visible=!0,this._display["reward"+s].graphics.clear(),this._display["reward"+s].loadImage(t.ResPath().getPic(i[s].icon_id,t.ResourcePath.PATH_GOODS),0,0,90,90),this._display["num"+s].text=i[s].num+""):this._display["reward"+s].visible=!1;this.updateBtn()},i.prototype.updateBtn=function(){switch(this._curData.flag){case 0:this._display.getRewardBtn.label="领取奖励",this._display.getRewardBtn.filters=null,this._display.getRewardBtn.on(Laya.Event.CLICK,this,this.onClickGet),this._display.redTips.visible=!1;break;case 1:this._display.getRewardBtn.label="领取奖励",this._display.getRewardBtn.filters=null,this._display.getRewardBtn.on(Laya.Event.CLICK,this,this.onClickGet),this._display.redTips.visible=!0;break;case 2:this._display.getRewardBtn.label="已 领 取",this._display.getRewardBtn.filters=t.FiltersUtils.getGreyFilters(),this._display.getRewardBtn.off(Laya.Event.CLICK,this,this.onClickGet),this._display.redTips.visible=!1}},i}(t.BaseBox);t.CollectView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.collect.WeixinCollectUI,!0,!0),this._display=this.skin,this.name="WeixinCollectViewBox",t.Global.isWXAPP&&Browser.onAndriod&&(this._display.back.closeBtn.x-=40),this._display.back.closeBtn.on(Laya.Event.CLICK,this,this.closeBtnClickHandler),this._display.btn0_0.on(Laya.Event.CLICK,this,this.onClickCourseBtn),this._display.btn0_1.on(Laya.Event.CLICK,this,this.onClickCourseBtn),this._display.btn1_0.on(Laya.Event.CLICK,this,this.onClickCourseBtn),this._display.btn1_1.on(Laya.Event.CLICK,this,this.onClickCourseBtn),this._display.btn1_2.on(Laya.Event.CLICK,this,this.onClickCourseBtn),t.Global.isWXAPP?(this._display.ios1.skin="ui/collect/wxapp.jpg",this._display.ios2.skin="ui/collect/wxapp1.jpg"):(this._display.ios1.skin="ui/collect/ios1.png",this._display.ios2.skin="ui/collect/ios.png")}return __extends(i,e),Object.defineProperty(i.prototype,"showGuide",{get:function(){return this._showGuide},set:function(e){this._showGuide=e,e?Laya.Browser.onIOS||Laya.Browser.onAndriod&&t.Global.isWXAPP?(this._display.iosMask1.visible=!0,this._display.iosMask1.on(Laya.Event.CLICK,this,this.iosMaskClickHandler),this._display.iosMask2.visible=!0,this._display.iosMask2.on(Laya.Event.CLICK,this,this.iosMaskClickHandler)):(this._display.andMask1.visible=!0,this._display.andMask1.on(Laya.Event.CLICK,this,this.andMaskClickHandler),this._display.andMask2.visible=!0,this._display.andMask2.on(Laya.Event.CLICK,this,this.andMaskClickHandler),this._display.andMask3.visible=!0,this._display.andMask3.on(Laya.Event.CLICK,this,this.andMaskClickHandler)):Laya.Browser.onIOS||Laya.Browser.onAndriod&&t.Global.isWXAPP?(this._display.iosMask1.visible=!1,this._display.iosMask1.off(Laya.Event.CLICK,this,this.iosMaskClickHandler),this._display.iosMask2.visible=!1,this._display.iosMask2.off(Laya.Event.CLICK,this,this.iosMaskClickHandler)):(this._display.andMask1.visible=!1,this._display.andMask1.off(Laya.Event.CLICK,this,this.andMaskClickHandler),this._display.andMask2.visible=!1,this._display.andMask2.off(Laya.Event.CLICK,this,this.andMaskClickHandler),this._display.andMask3.visible=!1,this._display.andMask3.off(Laya.Event.CLICK,this,this.andMaskClickHandler))},enumerable:!0,configurable:!0}),i.prototype.iosMaskClickHandler=function(e){e.target==this._display.iosMask1?t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.COLLECT_IOS_GUIDE1_OVER)):t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.COLLECT_IOS_GUIDE2_OVER))},i.prototype.andMaskClickHandler=function(e){e.target==this._display.andMask1?this._display.course0_0.visible?this.showCourse(0,1):(this.showCourse(0,0),t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.COLLECT_AND_GUIDE1_OVER))):e.target==this._display.andMask2?this._display.course1_0.visible?this.showCourse(1,1):this._display.course1_1.visible?this.showCourse(1,2):(this.showCourse(1,0),t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.COLLECT_AND_GUIDE2_OVER))):t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.COLLECT_AND_GUIDE3_OVER))},i.prototype.closeBtnClickHandler=function(){if(this._showGuide&&1==t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).level){var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.GUIDE_MODEL);e.guidetaskID=241}this.destroy()},i.prototype.destroy=function(){this._display.back.closeBtn.off(Laya.Event.CLICK,this,this.closeBtnClickHandler),e.prototype.destroy.call(this)},i.prototype.onShowed=function(){e.prototype.onShowed.call(this),t.addListener(t.CollectModule.COLLECT_WEIXIN_SHORT_CUT,this,this.onUpdateWeixin),this.resetImageSkin(this._display),t.XHR().Post({cmd:"addesk",subcmd:"Get",needreload:"1"},this,this.onResult)},i.prototype.onUpdateWeixin=function(){t.XHR().Post({cmd:"addesk",subcmd:"Get",needreload:"1"},this,this.onResult)},i.prototype.onHided=function(){e.prototype.onHided.call(this),t.removeListener(t.CollectModule.COLLECT_WEIXIN_SHORT_CUT,this,this.onUpdateWeixin),(Laya.Browser.onIOS||Laya.Browser.onAndriod&&t.Global.isWXAPP)&&t.XHR().Post({cmd:"addesk",subcmd:"AddDesk"},this,null)},i.prototype.onResult=function(e){0==e.result?(this._curData=e,this._curData.flag=parseInt(this._curData.flag),this.updatePanel()):t.WeakTips.show(e.msg)},i.prototype.updatePanel=function(){this.updateCourse(),this.updateReward(),this.updateBtn()},i.prototype.updateCourse=function(){Laya.Browser.onIOS||Laya.Browser.onAndriod&&t.Global.isWXAPP?(this._display.ios.visible=!0,this._display.and.visible=!1):(this._display.ios.visible=!1,this._display.and.visible=!0),this.showCourse(0,0),this.showCourse(1,0)},i.prototype.updateReward=function(){var e=this._curData.award.items;e||(e=[]);for(var i=0;4>i;i++)e[i]?(this._display["reward"+i].visible=!0,this._display["reward"+i].graphics.clear(),this._display["reward"+i].loadImage(t.ResPath().getPic(e[i].icon_id,t.ResourcePath.PATH_GOODS),0,0,75,75),this._display["num"+i].text=e[i].num+""):this._display["reward"+i].visible=!1},i.prototype.updateBtn=function(){switch(this._curData.flag){case 0:this._display.getRewardBtn.label="领  取",this._display.getRewardBtn.filters=t.FiltersUtils.getGreyFilters(),this._display.getRewardBtn.off(Laya.Event.CLICK,this,this.onClickGet);break;case 1:this._display.getRewardBtn.label="领  取",this._display.getRewardBtn.filters=null,this._display.getRewardBtn.on(Laya.Event.CLICK,this,this.onClickGet);break;case 2:this._display.getRewardBtn.label="已领取",this._display.getRewardBtn.filters=t.FiltersUtils.getGreyFilters(),this._display.getRewardBtn.off(Laya.Event.CLICK,this,this.onClickGet)}},i.prototype.onClickGet=function(){t.XHR().Post({cmd:"addesk",subcmd:"GetGift"},this,this.onGetGiftResult)},i.prototype.onGetGiftResult=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!0)),this._curData.flag=2,this.updateBtn()):t.WeakTips.show(e.msg)},i.prototype.showCourse=function(t,e){0==t?(this._display.course0_0.visible=!1,this._display.course0_1.visible=!1,this._display["course0_"+e].visible=!0):(this._display.course1_0.visible=!1,this._display.course1_1.visible=!1,this._display.course1_2.visible=!1,this._display["course1_"+e].visible=!0)},i.prototype.onClickCourseBtn=function(t){switch(t.target.name){case"btn0_0":this.showCourse(0,1);break;case"btn0_1":this.showCourse(0,0);break;case"btn1_0":this.showCourse(1,1);break;case"btn1_1":this.showCourse(1,2);break;case"btn1_2":this.showCourse(1,0)}},i}(t.BaseBox);t.WeixinCollectView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.initialize=function(e){this._noFactionExecuter=new t.NoFactionExecuter(this),this._factionExecuter=new t.FactionExecuter(this),this._factionWarExecuter=new t.FactionWarExecuter(this)},i.prototype.finalize=function(){this._noFactionExecuter&&(this._noFactionExecuter.destroy(),this._noFactionExecuter=null),this._factionExecuter&&(this._factionExecuter.destroy(),this._factionExecuter=null),this._factionWarExecuter&&(this._factionWarExecuter.destroy(),this._factionWarExecuter=null)},i.prototype.doCommand=function(e){switch(e.getCommandName()){case"FactionCommand":t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).level<t.UserModel.NEED_USERLV_FACTION?t.WeakTips.show(t.UserModel.NEED_USERLV_FACTION+"级开启帮派"):0==t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).faction.facID?this.callCommand(new t.OpenFactionListBoxCmd):this.callCommand(new t.EnterFactionSceneCmd);break;case"OpenFactionListBoxCmd":this._noFactionExecuter.doOpenFactionList();break;case"OpenCreateFactionBoxCmd":this._noFactionExecuter.doOpenCreateFactionBox();break;case"OpenSearchFactionBoxCmd":this._noFactionExecuter.doOpenSearchFactionBox();break;case"GetFacInfoPanelCmd":this._noFactionExecuter.doGetFacInfo(e);break;case"EnterFactionSceneCmd":this._factionExecuter.doEnterFactionSecne(e.isFromCreate);break;case"OpenRecruitBoxCmd":this._factionExecuter.doOpenRecruitBox();break;case"OpenBaseHallBoxCmd":this._factionExecuter.doOpenBaseHallBox(e.index);break;case"openEditFacIconBoxCmd":this._factionExecuter.doOpenEditIconBox();break;case"OpenDonateBoxCmd":this._factionExecuter.doOpenDonateBox();break;case"OpenUpdateBoxCmd":this._factionExecuter.doOpenUpdateBox(e.type,e.data);break;case"OpenFactionNotcieBoxCmd":this._factionExecuter.doOpenNoticeBox();break;case"OpenFacPracticeBoxCmd":this._factionExecuter.doOpenPracticeBox();break;case"OpenFactionTotemCmd":this._factionExecuter.doOpenTotemBox();break;case"EnterWuguanSceneCmd":this._factionExecuter.doEnterWuguanScene();break;case"OpenSmritiBoxCmd":this._factionExecuter.doOpenSmritiBox();break;case"RefreshFactionCmd":this._factionExecuter&&this._factionExecuter.refreshFactionData(e);break;case"EnterFactionHoleCmd":this._factionExecuter.doEnterHoleScene();break;case"ShowOrHideFactionSceneCmd":this._factionExecuter.showOrHideFactionScene(e.isShow);break;case"BindGroupCmd":this._factionExecuter.bindGroupCmd(e.type,e.groupid);break;case"EnterFactionWarCmd":this._factionWarExecuter.doEnterWarScene()}},i.prototype.getPluginName=function(){return t.PluginDef.PLUGIN_FACTION},i}(t.Plugin);t.FactionPlugin=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function n(n){e.call(this,new ui.faction.faction.BaseHallUI,!0,!0),this._display=this.skin,this.name="FactionBaseHallBox",this.setCloseButton(this._display.back.closeBtn),this._display.back.derocation_left.skin="ui/comp/rope_xia.png",this._display.back.derocation_left.x=125,this._display.menuTab.selectHandler=new Handler(this,this.showTab),this._display.page2.visible=!1,this._display.executerBox.visible=!1,this._executerBgHeight=this._display.executer_bg.height,this.setQunBtnVisible(!1),this._display.on(Laya.Event.CLICK,this,this.displayClickHandler),this._display.exitFac.on(Laya.Event.CLICK,this,this.exitFac),this._display.qunBtn.on(Laya.Event.CLICK,this,this.onQunBtn),t.EventCenter.singleton.on("SHOW_EXECUTER_BOX",this,this.showExecuterBox),this.list=new laya.ui.List,this.list.vScrollBarSkin="ui/comp/vscroll.png",this.list.scrollBar.visible=!1,this.list.scrollBar.on(Laya.Event.CHANGE,this,this.scrollBarChange),this.list.renderHandler=Handler.create(this,this.updateItem,null,!1),this.list.itemRender=i,this._display.page2.addChildAt(this.list,this._display.page2.getChildIndex(this._display.executerBox)),this.list.x=9,this.list.y=60,this.list.repeatX=1,this.list.repeatY=5,this.list.spaceX=0,this.list.spaceY=4,this.list.height=479,this.list.array=[],this.loglist=new laya.ui.List,this.loglist.vScrollBarSkin="ui/comp/vscroll.png",this.loglist.scrollBar.visible=!1,this.loglist.renderHandler=Handler.create(this,this.updateLogItem,null,!1),this.loglist.itemRender=s,this._display.page1.addChild(this.loglist),this.loglist.x=18,this.loglist.y=202,this.loglist.repeatX=1,this.loglist.repeatY=8,this.loglist.spaceX=0,this.loglist.spaceY=0,this.loglist.height=330,this.loglist.array=[],this._btnStep=this._display.page1_updateBtn.x-this._display.page1_goRecruitBtn.x,this.setBtnState();var a=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);a.on(t.ModelEvent.UPDATE_FINISH,this,this.facModelUpdate),this.queryFacMember(),this._display.editIconBtn.on(Laya.Event.CLICK,this,this.openEidtIconBox),this._display.iconPng.on(Laya.Event.CLICK,this,this.openEidtIconBox),this._display.iconBg.on(Laya.Event.CLICK,this,this.openEidtIconBox),this._display.ruleImage.on(Laya.Event.CLICK,this,this.showRule),this._display.menuTab.selectedIndex=n,this.hideAllRed()}return __extends(n,e),n.prototype.setLog=function(e){if(e){for(var i,s=0,n=0,a=0,o=[],r=0;r<e.length;r++){var h=e[r],l=1e3*Number(h.time),c=t.ServerClock.getServerDateByTime(l);if(c.getFullYear()!=s||c.getMonth()!=n||c.getDate()!=a){s=c.getFullYear(),n=c.getMonth(),a=c.getDate();for(var d=["今天","昨天","前天"],u=null,p=0;2>=p;p++){var _=t.ServerClock.getServerDateByTime(t.ServerClock.getServerTime()-864e5*p);if(_.getFullYear()==s&&_.getMonth()==n&&_.getDate()==a){u=d[p];break}}null==u&&(u=s+"年"+(n+1)+"月"+a+"日"),o.push({isTimeTitle:!0,timeStr:u}),i=0}i++;var f=c.getHours()<10?"0"+c.getHours():""+c.getHours(),y=c.getMinutes()<10?"0"+c.getMinutes():""+c.getMinutes();o.push({isTimeTitle:!1,content:"【"+f+":"+y+"】"+h.content,feedsIndex:i})}this.loglist.array=o}},n.prototype.facModelUpdate=function(){var e=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);this.list.array=e.members;for(var i=0;i<e.members.length;i++){var s=e.members[i];if(s.uid==t.Global.UID){this._selfValue7Day=s.hasOwnProperty("day7_contrib")?Number(s.day7_contrib):0;break}}this._selfPos=e.selfFactionUserModel.position,this._display.executerBox.visible=!1,this._display.executerBtn_chuanwei.visible=!1,this._display.executerBtn_kick.visible=!1,this._display.executerBtn_up.visible=!1,this._display.executerBtn_down.visible=!1;var n=[];this._display.iconPng.skin="ui/faction/factionScene/facIcon"+t.FactionConfig.getTotemIndexByID(4,e.facIcon)+".png",this._selfPos==t.FactionUserModel.POS_OWNER&&(this._display.executerBtn_chuanwei.visible=!0,n.push(this._display.executerBtn_chuanwei)),this._selfPos>=t.FactionConfig.kickPos&&(this._display.executerBtn_kick.visible=!0,n.push(this._display.executerBtn_kick)),this._selfPos>=t.FactionConfig.changePos&&(this._display.executerBtn_up.visible=!0,n.push(this._display.executerBtn_up),this._display.executerBtn_down.visible=!0,n.push(this._display.executerBtn_down)),n.push(this._display.executerBtn_close);var a=n.length;this._display.executer_bg.height=this._executerBgHeight-70*(5-a);for(var i=0;a>i;i++)n[i].y=this._display.executerBtn_chuanwei.y+70*i;this._display.nameTxt.text=e.facName+"（"+e.facLv+"级）",this._display.facOwnerTxt.text=e.ownerName,this._display.idTxt.text="编号："+e.facID,this._display.myFacPosTxt.text=t.FactionUserModel.getPosStr(this._selfPos),this._display.editIconBtn.visible=this._selfPos>=t.FactionConfig.settingPos;var o=t.FactionConfig.getBaseHallConfig(e.facLv);this._display.memberCountTxt.text="成员："+e.memberCount+"/"+o.maxMember,this._display.totalPowerTxt.text="总战力："+e.fightPower,this._display.fanRongCountTxt.text="繁荣度："+e.res_fanrong,this._display.dayNeedTxt.text="维护消耗："+o.dayNeed+"繁荣度/日",this._display.nowValueTxt.text="当前帮贡："+e.selfFactionUserModel.banggong_now,this._display.totalValueTxt.text="历史帮贡："+e.selfFactionUserModel.banggong_total,this._display.page2_memberCountTxt.text="成员："+e.memberCount+"/"+o.maxMember,this._display.page2_viceOwnerCountTxt.text="副帮主："+e.viceOwnerCount+"/"+o.maxViceOnwer,this._display.page2_elderCountTxt.text="长老："+e.elderCount+"/"+o.maxElder,this._display.page2_eliteCountTxt.text="精英："+e.eliteCount+"/"+o.maxElite,this.setBtnState(),this.hideAllRed();var r=-1!=e.reddotArr.indexOf(t.FactionReddotEnum.kFactionRedDotTypeDonation);r&&(this._display.red_donation.visible=!0);var h=e.selfFactionUserModel.position>=t.FactionConfig.settingPos&&-1!=e.reddotArr.indexOf(t.FactionReddotEnum.kFactionRedDotTypeApplicants);h&&(this._display.red_recruit.visible=!0,this._display.red_recruit2.visible=!0);var l=t.FactionConfig.getBaseHallConfig(e.facLv),c=e.facLv<t.FactionConfig.MAX_BASEHALL_LV&&e.res_fanrong>=l.updateNeedFanrong&&e.res_wood>=l.updateNeedWood&&e.res_stone>=l.updateNeedStone&&e.res_iron>=l.updateNeedIron;c&&(this._display.red_update.visible=!0),this.updateBangQun()},n.prototype.setQunBtnVisible=function(e){this._display.qunBtn.visible=e,t.Global.isSQ||(this._display.qunBtn.visible=!1)},n.prototype.updateBangQun=function(){var e=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF),i=this;this.setQunBtnVisible(!1),t.Global.isWX?this.setQunBtnVisible(!1):"0"==e.groupid?this._selfPos==t.FactionUserModel.POS_OWNER?(this.setQunBtnVisible(!0),i._display.qunBtn.mouseEnabled=!0,this._display.qunBtn.label="创建帮群"):this.setQunBtnVisible(!1):t.H5SDK.isInGroup(e.groupid,this,function(s){i._display&&(4!=s.list.relation?i._selfPos==t.FactionUserModel.POS_OWNER?(i.setQunBtnVisible(!0),i._display.qunBtn.mouseEnabled=!1,i._display.qunBtn.label="已创建帮群"):(i.setQunBtnVisible(!0),i._display.qunBtn.mouseEnabled=!1,i._display.qunBtn.label="已加入帮群"):i._selfPos==t.FactionUserModel.POS_OWNER?(i.setQunBtnVisible(!1),t.Facade.callCommand(new t.BindGroupCmd(1,e.groupid))):(i.setQunBtnVisible(!0),i._display.qunBtn.mouseEnabled=!0,i._display.qunBtn.label="加入帮群"))}),"test"==t.Global.PF&&this.setQunBtnVisible(!1)},n.prototype.onQunBtn=function(){var e=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF),i=this,s={};"0"==e.groupid&&this._selfPos==t.FactionUserModel.POS_OWNER?(s={faction_id:e.facID,faction_name:e.facName,uid:t.Global.UID},t.H5SDK.creatGroup(s,this,function(e){i._display&&(t.Facade.callCommand(new t.BindGroupCmd(0,e.list.gc)),i.setQunBtnVisible(!0),i._display.qunBtn.mouseEnabled=!1,i._display.qunBtn.label="已创建帮群",t.WeakTips.show("帮群创建成功！"))})):"0"!=e.groupid&&this._selfPos!=t.FactionUserModel.POS_OWNER&&(s={faction_id:e.facID,group_id:e.groupid,uid:t.Global.UID},t.H5SDK.joinGroup(s,this,function(t){i._display&&(i.setQunBtnVisible(!0),i._display.qunBtn.mouseEnabled=!1,i._display.qunBtn.label="已加入帮群")}))},n.prototype.setBtnState=function(){var e=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);e.selfFactionUserModel.position>=Math.min(t.FactionConfig.auditingPos,t.FactionConfig.settingPos)?(this._display.page1_goRecruitBtn.visible=!0,this._display.page2_goRecruitBtn.visible=!0,this._display.page1_updateBtn.x=this._display.page1_goRecruitBtn.x+this._btnStep,this._display.page1_rankBtn.x=this._display.page1_updateBtn.x+this._btnStep,this._display.page1_juanXianBtn.x=this._display.page1_rankBtn.x+this._btnStep):(this._display.page1_goRecruitBtn.visible=!1,this._display.page2_goRecruitBtn.visible=!1,this._display.page1_updateBtn.x=this._display.page1_goRecruitBtn.x+this._btnStep/2,this._display.page1_rankBtn.x=this._display.page1_updateBtn.x+this._btnStep,this._display.page1_juanXianBtn.x=this._display.page1_rankBtn.x+this._btnStep)},n.prototype.hideAllRed=function(){this._display.red_recruit.visible=!1,this._display.red_recruit2.visible=!1,this._display.red_donation.visible=!1,this._display.red_update.visible=!1},n.prototype.updateItem=function(t,e){e<=this.list.array.length-1&&t.doRender(this.list.array[e],e,this._selfPos,this._selfValue7Day)},n.prototype.updateLogItem=function(t,e){e<=this.loglist.array.length-1&&t.doRender(this.loglist.array[e],e)},n.prototype.showTab=function(){var t=this._display.menuTab.selectedIndex;0==t?(this._display.page1.visible=!0,this._display.page2.visible=!1):(this._display.page1.visible=!1,this._display.page2.visible=!0,this._display.executerBox.visible=!1)},n.prototype.queryFacMember=function(){t.XHR().Post({file:"petpk",cmd:"faction",op:"query",need_member:1,need_feeds:1,uid:t.Global.UID},this,this.queryFacMemberHandler)},n.prototype.queryFacMemberHandler=function(e){if(0==e.result){var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);i.setData(e),this.setLog(e.feedslist)}else t.WeakTips.show("拉取帮派成员失败，"+e.msg)},n.prototype.displayClickHandler=function(e){switch(e.target){case this._display.page1_goRecruitBtn:case this._display.page2_goRecruitBtn:t.Facade.callCommand(new t.OpenRecruitBoxCmd);break;case this._display.page1_rankBtn:t.Facade.callCommand(new t.RankCMD(5));break;case this._display.page1_juanXianBtn:t.Facade.callCommand(new t.OpenDonateBoxCmd);break;case this._display.page1_updateBtn:var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);i.isMaxLv?t.Facade.callCommand(new t.ShowChangeRewardCmd(["聚义厅已经是最高等级"],200,"#ffec49")):t.Facade.callCommand(new t.OpenUpdateBoxCmd(t.FactionConfig.BUILDING_BASEHALL,{lv:i.facLv}));break;case this._display.executerBtn_chuanwei:if(this._ppos!=t.FactionUserModel.POS_VICE_OWNER)t.Facade.callCommand(new t.ShowChangeRewardCmd(["只能传位给副帮主"],200,"#ffec49"));else{var s=new t.ConfirmBoxData({isShowCancelBtn:!0,contentStr:"您确定要将本帮帮主的职位传给【"+this._pname+"】吗？",callBackHandler:Handler.create(this,this.alertToChuanwei)});t.ConfirmBox.show(s,t.Layer.WEAK_TIP)}this._display.executerBox.visible=!1;break;case this._display.executerBtn_kick:if(this._selfPos<=this._ppos)t.Facade.callCommand(new t.ShowChangeRewardCmd(["只能对职位比您低的玩家进行此操作"],200,"#ffec49"));else if(this._notPass3Day)if(t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF).res_fanrong<50)t.Facade.callCommand(new t.ShowChangeRewardCmd(["帮派繁荣度不足，需要消耗50繁荣度"],200,"#ffec49"));else{var s=new t.ConfirmBoxData({isShowCancelBtn:!0,contentStr:"将【"+this._pname+"】请离本帮，本帮繁荣度-50，是否确认？",callBackHandler:Handler.create(this,this.alertToKick)});t.ConfirmBox.show(s,t.Layer.WEAK_TIP)}else{var s=new t.ConfirmBoxData({isShowCancelBtn:!0,contentStr:"将【"+this._pname+"】请离本帮，其3天内无登录，不需要扣除本帮繁荣度，是否确认？",callBackHandler:Handler.create(this,this.alertToKick)});t.ConfirmBox.show(s,t.Layer.WEAK_TIP)}this._display.executerBox.visible=!1;break;case this._display.executerBtn_up:this._selfPos<=this._ppos?t.Facade.callCommand(new t.ShowChangeRewardCmd(["只能对职位比您低的玩家进行此操作"],200,"#ffec49")):this._ppos==t.FactionUserModel.POS_VICE_OWNER?t.Facade.callCommand(new t.ShowChangeRewardCmd(["该玩家已经是副帮主了，不能再升职了"],200,"#ffec49")):this._selfPos<=t.FactionUserModel.getUpPos(this._ppos)?t.Facade.callCommand(new t.ShowChangeRewardCmd(["您的职位权限不足"],200,"#ffec49")):t.XHR().Post({file:"petpk",cmd:"faction",op:"promote",puid:this._puid,uid:t.Global.UID},this,this.changePosHandler),this._display.executerBox.visible=!1;break;case this._display.executerBtn_down:this._selfPos<=this._ppos?t.Facade.callCommand(new t.ShowChangeRewardCmd(["只能对职位比您低的玩家进行此操作"],200,"#ffec49")):this._ppos==t.FactionUserModel.POS_NORMAL?t.Facade.callCommand(new t.ShowChangeRewardCmd(["该玩家已经是帮众了，不能再降级了"],200,"#ffec49")):t.XHR().Post({file:"petpk",cmd:"faction",op:"demote",puid:this._puid,uid:t.Global.UID},this,this.changePosHandler),this._display.executerBox.visible=!1;break;case this._display.executerBtn_close:this._display.executerBox.visible=!1}},n.prototype.alertToKick=function(){t.XHR().Post({file:"petpk",cmd:"faction",op:"remove",puid:this._puid,uid:t.Global.UID},this,this.kickHandler)},n.prototype.kickHandler=function(e){if(0==e.result){if(t.WeakTips.show("请离成功！"),this._notPass3Day){var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF).res_fanrong-50;0>i&&(i=0),t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF).res_fanrong=i}this.queryFacMember()}else t.WeakTips.show("请离失败，"+e.msg)},n.prototype.alertToChuanwei=function(){t.XHR().Post({file:"petpk",cmd:"faction",op:"demise",puid:this._puid,uid:t.Global.UID},this,this.chuanweiHandler)},n.prototype.chuanweiHandler=function(e){0==e.result?(t.WeakTips.show("传位成功！"),this.queryFacMember()):t.WeakTips.show("传位失败，"+e.msg)},n.prototype.changePosHandler=function(e){0==e.result?(t.WeakTips.show("操作成功！"),this.queryFacMember()):t.WeakTips.show("操作失败，"+e.msg)},n.prototype.exitFac=function(){var e=this._selfPos==t.FactionUserModel.POS_OWNER?"解散帮派后当前帮贡不变，历史帮贡会被清空，是否确认？":"退出帮派后当前帮贡不变，历史帮贡会被清空，是否确认？",i=new t.ConfirmBoxData({contentStr:e,callBackHandler:Handler.create(this,this.doExitFac)});t.ConfirmBox.show(i)},n.prototype.doExitFac=function(){t.XHR().Post({file:"petpk",cmd:"faction",op:"quit",uid:t.Global.UID},this,this.exitFactionHandler)},n.prototype.exitFactionHandler=function(e){if(0==e.result){var i=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);i.faction.facID=0;var s=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);s.facID=0,t.Facade.callCommand(new t.SyncChangeCmd(e)),t.Facade.callCommand(new t.HomeCommand)}else t.WeakTips.show("退出失败，"+e.msg)},n.prototype.showExecuterBox=function(e){this._puid==e.puid?this._display.executerBox.visible=!this._display.executerBox.visible:this._display.executerBox.visible=!0,this._display.executerBox.visible&&(this._puid=e.puid,this._ppos=e.ppos,this._pname=e.pname,this._notPass3Day=e.notPass3Day,this._display.executerBox.y=e.posY-t.LayerMgr.offY-this._display.page2.y,this._display.executerBox.y+this._display.executer_bg.height>t.LayerMgr.height+t.LayerMgr.offY-30&&(this._display.executerBox.y-=this._display.executerBox.y+this._display.executer_bg.height-(t.LayerMgr.height+t.LayerMgr.offY-30)))},n.prototype.scrollBarChange=function(){this._display.executerBox.visible=!1},n.prototype.openEidtIconBox=function(){this._selfPos>=t.FactionConfig.settingPos&&t.Facade.callCommand(new t.openEditFacIconBoxCmd)},n.prototype.showRule=function(){var e="";e+="<img src='ui/comp/icon.png'></img> 1. 帮派职位分为帮主、副帮主、长老、精英和帮众；<br>",e+="<img src='ui/comp/icon.png'></img> 2. 聚义厅等级越高，则帮派等级越高，成员上限越高，部分职位也会有相应的增加；<br>",e+="<img src='ui/comp/icon.png'></img> 3. 升级聚义厅，需消耗帮派繁荣度、帮派木材、帮派石头和帮派铁矿等资源；<br>",e+="<img src='ui/comp/icon.png'></img> 4. 【帮派捐献】可获得帮派繁荣度和个人帮贡，繁荣度用于帮派建设、日常维护和开启特定玩法；<br>",e+="<img src='ui/comp/icon.png'></img> 5. 帮派维护需消耗繁荣度，等级越高，维护消耗的繁荣度越高；<br>",e+="<img src='ui/comp/icon.png'></img> 6. 帮派捐献和日常活动可产出帮贡，用于修炼馆永久提升个人修炼技能；<br>",e+="<img src='ui/comp/icon.png'></img> 7. 当前帮贡表示当前可使用的个人帮贡，退出帮派不清空；<br>",e+="<img src='ui/comp/icon.png'></img> 8. 历史帮贡表示在本帮内获得的总帮贡，退出帮派时会清空；<br>",e+="<img src='ui/comp/icon.png'></img> 9. 帮主和副帮主可设定帮派的招募信息；<br>",e+="<img src='ui/comp/icon.png'></img> 10. 请离3天内登录过的成员，则帮派繁荣度减少50/人；<br>",e+="<img src='ui/comp/icon.png'></img> 11. 帮主7日无登录则其他职位成员可依次申请【传承】，继位帮主位置；",t.RulePanel.showRule(e,"")},n.prototype.destroy=function(){t.EventCenter.singleton.off("SHOW_EXECUTER_BOX",this,this.showExecuterBox);var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);i.off(t.ModelEvent.UPDATE_FINISH,this,this.facModelUpdate),this._display.menuTab.selectHandler=null,this._display.off(Laya.Event.CLICK,this,this.displayClickHandler),this._display.exitFac.off(Laya.Event.CLICK,this,this.exitFac),this._display.editIconBtn.off(Laya.Event.CLICK,this,this.openEidtIconBox),this._display.iconPng.off(Laya.Event.CLICK,this,this.openEidtIconBox),this._display.iconBg.off(Laya.Event.CLICK,this,this.openEidtIconBox),this._display.ruleImage.off(Laya.Event.CLICK,this,this.showRule),this.list&&(this.list.scrollBar.off(Laya.Event.CHANGE,this,this.scrollBarChange),this.list.destroy(),this.list=null),this.loglist&&(this.loglist.destroy(),this.loglist=null),this._display=null,e.prototype.destroy.call(this)},n}(t.BaseBox);t.BaseHallBox=e;var i=function(e){function i(){e.call(this),this.bg.on(Laya.Event.CLICK,this,this.bgClickHandler),this.playerInfo.headBg.on(Laya.Event.CLICK,this,this.headBgClickHandler),this.playerInfo.maleIcon.visible=!1,this.playerInfo.femaleIcon.visible=!1,this.smritiBox.visible=!1,this.doSmritiBox.visible=!1,this.smritiBtn.on(Laya.Event.CLICK,this,this.smritiBtnClickHandler)}return __extends(i,e),i.prototype.doRender=function(e,i,s,n){this._memberObj=e,this._selfPos=s,this._selfValue7Day=n,this._isSelf=this._memberObj.uid==t.Global.UID,this._isSelf?(this.bgSelf.visible=!0,this.bg.visible=!1):(this.bgSelf.visible=!1,this.bg.visible=!0),this.playerInfo.photo.loadImage(t.JSUtils.getHeadUrl(this._memberObj.head_url),0,0,82,82),1==Number(this._memberObj.sex)?(this.playerInfo.maleIcon.visible=!0,this.playerInfo.femaleIcon.visible=!1,this.playerInfo.defaultHead.skin="ui/main/male.png"):(this.playerInfo.maleIcon.visible=!1,this.playerInfo.femaleIcon.visible=!0,this.playerInfo.defaultHead.skin="ui/main/female.png"),this.valueTotalTxt.text=this._memberObj.hasOwnProperty("total_contrib")?this._memberObj.total_contrib:"0",this.value7DayTxt.text=this._memberObj.hasOwnProperty("day7_contrib")?this._memberObj.day7_contrib:"0",this.valueTodayTxt.text=this._memberObj.hasOwnProperty("daily_contrib")?this._memberObj.daily_contrib:"0",this.loginTxt.text="XXX",this.nameTxt.text=this._memberObj.name,this.positionTxt.text=t.FactionUserModel.getPosStr(this._memberObj.pos),this.playerInfo.tfLvl.text=this._memberObj.level,this.playerInfo.tfVip.text=""+this._memberObj.vip_level,this.strengTxt.text=this._memberObj.fight_power;var a=["今天","昨天","前天","3天前","4天前","5天前","6天前","7天前","7天+"],o=Number(this._memberObj.login_time2)>8?8:Number(this._memberObj.login_time2),r=0>o?"未来":a[o];if(this._notPass3Day=2>=o,this.loginTxt.text=r,!this._isSelf&&this._memberObj.pos!=t.FactionUserModel.POS_OWNER&&this._selfPos>=t.FactionConfig.changePos?this.jianTou.visible=!0:this.jianTou.visible=!1,this._memberObj.pos==t.FactionUserModel.POS_OWNER){this._ownerLoginTime=Number(1e3*this._memberObj.login_time);var h=t.ServerClock.getServerTime()-this._ownerLoginTime;h>=432e6?(this.loginTxt.visible=!1,this.smritiNeedTxt.color=this.smritiNeedTxt1.color=this._selfValue7Day>=2e3?"#7D5845":"#FF0000",this.setSmriti()):(this.loginTxt.visible=!0,this.smritiBox.visible=!1,this.doSmritiBox.visible=!1,t.TimeTextControl.removeTimeText(this.smritiTimeTxt),this.smritiTimeTxt.off(t.TimeTextControl.TIME_UP,this,this.timeUp))}else this.loginTxt.visible=!0,this.smritiBox.visible=!1,this.doSmritiBox.visible=!1,t.TimeTextControl.removeTimeText(this.smritiTimeTxt),this.smritiTimeTxt.off(t.TimeTextControl.TIME_UP,this,this.timeUp)},i.prototype.setSmriti=function(){var e,i,s=t.ServerClock.getServerTime(),n=s-this._ownerLoginTime,a=t.FactionConfig.getPositionConfig(t.FactionUserModel.POS_VICE_OWNER).smritiDay,o=t.FactionConfig.getPositionConfig(t.FactionUserModel.POS_ZHANGLAO).smritiDay,r=t.FactionConfig.getPositionConfig(t.FactionUserModel.POS_JINGYING).smritiDay,h=t.FactionConfig.getPositionConfig(t.FactionUserModel.POS_NORMAL).smritiDay;864e5*a>n?(this.smritiPositionTxt.text="【副帮主】",this.smritiMsg.text="以上可传承",e=99999999,i=this._ownerLoginTime+864e5*a-s):864e5*o>n?(this.smritiPositionTxt.text="【长老】",this.smritiMsg.text="以上可传承",e=t.FactionUserModel.POS_VICE_OWNER,i=this._ownerLoginTime+864e5*o-s):864e5*r>n?(this.smritiPositionTxt.text="【精英】",this.smritiMsg.text="以上可传承",e=t.FactionUserModel.POS_ZHANGLAO,i=this._ownerLoginTime+864e5*r-s):864e5*h>n?(this.smritiPositionTxt.text="【所有成员】",this.smritiMsg.text="可传承",e=t.FactionUserModel.POS_JINGYING,i=this._ownerLoginTime+864e5*h-s):(this.smritiPositionTxt.text="【所有成员】",this.smritiMsg.text="可传承",e=t.FactionUserModel.POS_NORMAL,i=this._ownerLoginTime+864e5*h-s),this._selfPos>=e?(this.smritiBox.visible=!1,this.doSmritiBox.visible=!0):(this.smritiBox.visible=!0,
this.doSmritiBox.visible=!1,this.smritiTimeTxt.on(t.TimeTextControl.TIME_UP,this,this.timeUp),t.TimeTextControl.setTimeText(this.smritiTimeTxt,i/1e3,"HH时NN分SS秒后"))},i.prototype.timeUp=function(){this.setSmriti()},i.prototype.bgClickHandler=function(){if(this.jianTou.visible){var e;e=this.bg.localToGlobal(new laya.maths.Point(0,0)),t.EventCenter.singleton.event("SHOW_EXECUTER_BOX",{puid:this._memberObj.uid,ppos:this._memberObj.pos,pname:this._memberObj.name,notPass3Day:this._notPass3Day,posY:e.y})}},i.prototype.headBgClickHandler=function(){t.Facade.callCommand(new t.UserInfoCommand(this._memberObj.uid))},i.prototype.smritiBtnClickHandler=function(){"#FF0000"==this.smritiNeedTxt1.color?t.WeakTips.show("您的七日帮贡不足2000"):t.Facade.callCommand(new t.OpenSmritiBoxCmd)},i.prototype.smritiHandler=function(e){if(0==e.result){var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);i.setData(e)}else t.WeakTips.show("传承失败，"+e.msg)},i.prototype.destroy=function(){this.bg.off(Laya.Event.CLICK,this,this.bgClickHandler),this.playerInfo.headBg.off(Laya.Event.CLICK,this,this.headBgClickHandler),t.TimeTextControl.removeTimeText(this.smritiTimeTxt),this.smritiTimeTxt.off(t.TimeTextControl.TIME_UP,this,this.timeUp),this.smritiBtn.off(Laya.Event.CLICK,this,this.smritiBtnClickHandler),e.prototype.destroy.call(this)},i}(ui.faction.faction.BaseHallItemUI),s=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.doRender=function(t,e){t.isTimeTitle?(this.bg1.visible=!1,this.bg2.visible=!1,this.contentTxt.visible=!1,this.timeTxt.visible=!0,this.timeTxt.text=t.timeStr):(this.contentTxt.visible=!0,this.timeTxt.visible=!1,this.contentTxt.text=t.content,t.feedsIndex%2!=0?(this.bg1.visible=!0,this.bg2.visible=!1):(this.bg1.visible=!1,this.bg2.visible=!0))},e}(ui.faction.faction.BaseHallLogItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.faction.faction.DonateUI,!0,!0),this._display=this.skin,this.name="FactionDonateBox",this.setCloseButton(this._display.back.closeBtn),this._maxBarWidth=this._display.fanrongBar.width;var s=13;this._display.windPng.scrollRect=new Laya.Rectangle(0,s,205,76),this._display.windPng.y+=s,this._display.maskPng.visible=!1,this._display.donateBtn1.on(Laya.Event.CLICK,this,this.donateBtn1Click),this._display.donateBtn2.on(Laya.Event.CLICK,this,this.donateBtn2Click),this._display.donateBtn3.on(Laya.Event.CLICK,this,this.donateBtn3Click),this._display.resClickPng.on(Laya.Event.CLICK,this,this.showResMsg),this._display.red_donation.visible=!1;var n=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);n.on(t.ModelEvent.UPDATE_FINISH,this,this.facModelUpdateFinish);var a=n.dayDonationTimes,o=255&a,r=a>>8&255,h=a>>16&255;o>=t.FactionConfig.getBaseHallConfig(n.facLv).maxMember&&(this._display.addFanrong1.text="繁荣度：+0"),r>=t.FactionConfig.getBaseHallConfig(n.facLv).maxMember&&(this._display.addFanrong2.text="繁荣度：+0"),h>=t.FactionConfig.getBaseHallConfig(n.facLv).maxMember&&(this._display.addFanrong3.text="繁荣度：+0"),this._display.addBanggong1.text="个人帮贡：+"+i._banggongConf[0],this._display.addBanggong2.text="个人帮贡：+"+i._banggongConf[1],this._display.addBanggong3.text="个人帮贡：+"+i._banggongConf[2],t.XHR().Post({file:"petpk",cmd:"faction",op:"query",uid:t.Global.UID},this,this.queryFactionHandler)}return __extends(i,e),i.prototype.queryFactionHandler=function(e){var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);0==e.result?i.setData(e):this.facModelUpdateFinish()},i.prototype.facModelUpdateFinish=function(){var e=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);this._display.woodNumTxt.text=String(e.res_wood),this._display.stoneNumTxt.text=String(e.res_stone),this._display.ironNumTxt.text=String(e.res_iron),this._display.LvTxt.text=e.facLv+"级",this._display.iconPng.skin="ui/faction/factionScene/facIcon"+t.FactionConfig.getTotemIndexByID(4,e.facIcon)+".png",this.fanrongValue=e.res_fanrong;for(var i=1;3>=i;i++){var s=Math.pow(2,i-1);(e.selfFactionUserModel.todayDonateFlag&s)==s?(this._display["donateBtn"+i].filters=t.FiltersUtils.getGreyFilters(),this._display["donateBtn"+i].label="今日已捐献"):1==i&&(this._display.red_donation.visible=!0)}},Object.defineProperty(i.prototype,"fanrongValue",{set:function(e){var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF),s=t.FactionConfig.getBaseHallConfig(i.facLv),n=i.isMaxLv?"当前已是最高等级":String(s.updateNeedFanrong);this._display.fanrongValue.text=e+"/"+n;var a;i.isMaxLv?a=this._maxBarWidth:(a=this._maxBarWidth*e/s.updateNeedFanrong,a>this._maxBarWidth&&(a=this._maxBarWidth)),this._display.fanrongBar.width=a,this._display.fanrongBar.visible=0!=a},enumerable:!0,configurable:!0}),i.prototype.donateBtn1Click=function(){this.doDonate(1)},i.prototype.donateBtn2Click=function(){var e=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);e.vipLevel<3?t.WeakTips.show("该捐献仅对达人3以上玩家开放"):t.PayConfirm.checkDouYu(Number(this._display.donate2NeedTxt.text),Handler.create(this,this.checkDoDonate2))},i.prototype.checkDoDonate2=function(){this.doDonate(2)},i.prototype.donateBtn3Click=function(){var e=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);e.vipLevel<5?t.WeakTips.show("该捐献仅对达人5以上玩家开放"):t.PayConfirm.checkDouYu(Number(this._display.donate3NeedTxt.text),Handler.create(this,this.checkDoDonate3))},i.prototype.checkDoDonate3=function(){this.doDonate(3)},i.prototype.doDonate=function(e){var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF),s=Math.pow(2,e-1);if((i.selfFactionUserModel.todayDonateFlag&s)==s)t.WeakTips.show("今日已捐献");else{this._index=e;var n=this._display["addBanggong"+this._index].text,a=Number(n.split("+")[1]);t.XHR().Post({file:"petpk",cmd:"faction",op:"donation",type:e-1,contrib:a,uid:t.Global.UID},this,this.donateHandler)}},i.prototype.donateHandler=function(e){if(0==e.result){t.Facade.callCommand(new t.SyncChangeCmd(e));var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);i.selfFactionUserModel.todayDonateFlag|=Math.pow(2,this._index-1),this._display["donateBtn"+this._index].filters=t.FiltersUtils.getGreyFilters(),this._display["donateBtn"+this._index].label="今日已捐献",1==this._index&&(i.setReddot(t.FactionReddotEnum.kFactionRedDotTypeDonation,!1),this._display.red_donation.visible=!1);var s=e.hasOwnProperty("glory")?Number(e.glory):0;i.res_fanrong+=s,this.fanrongValue=i.res_fanrong;var n=this._display["addBanggong"+this._index].text;Number(n.split("+")[1]);s>0&&(i.updateFinish(),t.WeakTips.show("帮派繁荣度+"+s,!1,"#00FF00"))}else t.WeakTips.show("捐献失败，"+e.msg)},i.prototype.showResMsg=function(){t.WeakTips.show("击败【神秘洞穴】的矿兽可获得帮派材料")},i.prototype.destroy=function(){var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);i.off(t.ModelEvent.UPDATE_FINISH,this,this.facModelUpdateFinish),this._display.donateBtn1.off(Laya.Event.CLICK,this,this.donateBtn1Click),this._display.donateBtn2.off(Laya.Event.CLICK,this,this.donateBtn2Click),this._display.donateBtn3.off(Laya.Event.CLICK,this,this.donateBtn3Click),this._display.resClickPng.off(Laya.Event.CLICK,this,this.showResMsg),e.prototype.destroy.call(this)},i._banggongConf=[3e3,3e3,9e3],i}(t.BaseBox);t.DonateBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.faction.faction.EditFacIconBoxUI,!0,!0),this._display=this.skin,this.setCloseButton(this._display.btnClose),this.name="FactionEditFacIconBox";var n=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);s.selectIndex=n.facIcon,this.list=new laya.ui.List,this.list.vScrollBarSkin="ui/comp/vscroll.png",this.list.scrollBar.visible=!1,this.list.selectEnable=!0,this.list.renderHandler=Handler.create(this,this.updateItem,null,!1),this.list.itemRender=i,this._display.addChild(this.list),this.list.x=316,this.list.y=200,this.list.repeatX=5,this.list.repeatY=2,this.list.spaceX=-26,this.list.spaceY=36,this.list.array=new Array(10),this.list.selectHandler=new Handler(this,this.onSelect),this._display.editIconBtn.on(Laya.Event.CLICK,this,this.editIcon)}return __extends(s,e),s.prototype.onSelect=function(){var e=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF),i=t.FactionConfig.getTotemObj(4,this.list.selectedIndex);i.needLv<=e.facLv&&(s.selectIndex=this.list.selectedIndex+1,this.list.array=this.list.array)},s.prototype.updateItem=function(t,e){e<=this.list.array.length-1&&t.doRender(this.list.array[e],e)},s.prototype.editIcon=function(){t.XHR().Post({file:"petpk",cmd:"faction",op:"totem",icon:t.FactionConfig.getTotemObj(4,s.selectIndex-1).totem_id,uid:t.Global.UID},this,this.editIconHandler)},s.prototype.editIconHandler=function(e){if(0==e.result){t.Facade.callCommand(new t.ShowChangeRewardCmd(["设置帮派图标成功！"],200,"#ffec49"));var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);i.facIcon=s.selectIndex,i.updateFinish(),this.destroy()}else t.WeakTips.show("设置帮派图标失败，"+e.msg)},s.prototype.destroy=function(){this._display.editIconBtn.off(Laya.Event.CLICK,this,this.editIcon),this.list&&(this.list.renderHandler=null,this.list.destroy(),this.list=null),e.prototype.destroy.call(this)},s}(t.BaseBox);t.EditIconBox=e;var i=function(i){function s(){i.call(this),this.needHallLvBg.visible=!1,this.needHallLvTxt.visible=!1}return __extends(s,i),s.prototype.doRender=function(i,s){var n=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);this.iconPng.skin="ui/faction/factionScene/facIcon"+(s+1)+".png";var a=t.FactionConfig.getTotemObj(4,s);a.needLv<=n.facLv?(this.needHallLvBg.visible=!1,this.needHallLvTxt.visible=!1,this.bg_light.visible=s+1==e.selectIndex):(this.needHallLvBg.visible=!0,this.needHallLvTxt.visible=!0,this.needHallLvTxt.text="聚义厅"+a.needLv+"级",this.bg_light.visible=!1)},s.prototype.destroy=function(){i.prototype.destroy.call(this)},s}(ui.faction.faction.FacIconItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(n,a){e.call(this,new ui.faction.faction.FactionHoleRankUI,!0,!0),this._bossIsNowWeek=!1,this._display=this.skin,this.setCloseButton(this._display.back.closeBtn),this.name="FactionHoleFightRankBox",this._display.menuTab.selectHandler=new Handler(this,this.showTab),this._nowLv=n,this._nowSeq=a,this.ranklist=new laya.ui.List,this.ranklist.vScrollBarSkin="ui/comp/vscroll.png",this.ranklist.scrollBar.visible=!1,this.ranklist.renderHandler=Handler.create(this,this.updateLogItem,null,!1),this.ranklist.itemRender=i,this._display.addChild(this.ranklist),this.ranklist.x=243,this.ranklist.y=128,this.ranklist.repeatX=1,this.ranklist.repeatY=8,this.ranklist.spaceX=0,this.ranklist.spaceY=4,this.ranklist.height=475,this.ranklist.array=[],s.nameBoxInitX=this._display.selfRankBox.nameBox.x,s.nameTxtInitWidth=this._display.selfRankBox.nameTxt.width,this._display.selfRankBox.visible=!1;var o=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);this._display.selfRankBox.tfVip.text=String(o.vipLevel),this._display.selfRankBox.nameTxt.overflow="hidden",this._display.selfRankBox.nameTxt.text=o.name,this._display.selfRankBox.line.width=this._display.selfRankBox.nameTxt.textWidth,this._display.selfRankBox.bg1.visible=this._display.selfRankBox.bg2.visible=!1,this._display.selfRankBox.rankBg.skin="ui/faction/factionHoleScene/ranklistbg3.png",this._display.selfRankBox.rankBg.on(Laya.Event.CLICK,this,this.bgClickHandler),this._display.selfRankBox.bg1.on(Laya.Event.CLICK,this,this.bgClickHandler),this._display.selfRankBox.bg2.on(Laya.Event.CLICK,this,this.bgClickHandler),this._display.notMsgTxt.visible=!1,this.getRank(!1)}return __extends(s,e),s.prototype.showTab=function(){0==this._display.menuTab.selectedIndex?(this._display.notMsgTxt.visible=!1,this.ranklist.visible=!0,this._display.selfRankBox.visible=!0,1!=this._nowSeq?this.getRank(!1):this._bossIsNowWeek?t.WeakTips.show("本周已通关，下周一6点将发放本周排行榜奖励",!1,"#00FF00"):t.WeakTips.show("本周尚未通关，通关后下周一6点将发放排行奖励",!1,"#FF0000")):1==this._nowSeq?(this._display.notMsgTxt.visible=!0,this.ranklist.visible=!1,this._display.selfRankBox.visible=!1):this.getRank(!0)},s.prototype.getRank=function(e){var i={file:"petpk",cmd:"faction",op:"cave_rank",uid:t.Global.UID};e&&(i.history=1),t.XHR().Post(i,this,this.getFightRecordHandler)},s.prototype.getFightRecordHandler=function(e){if(0==e.result){var i=e.rank||[];s.total=i.length,this.ranklist.array=i;for(var n,a,o=0;o<i.length;o++){var r=i[o];if(r.uid==t.Global.UID){n=r,a=o+1;break}}if(n){this._display.selfRankBox.rankTxt.text=String(a),this._display.selfRankBox.maxTxt.text=n.hasOwnProperty("max_damage")?n.max_damage:0,this._display.selfRankBox.allTxt.text=n.damage;var h,l=s.getRankValue(a),c=s.getPersonNumValue(s.total);h=n.hasOwnProperty("reward")&&Number(n.reward)>0?Number(n.reward):Math.floor(8750*l*Math.pow(1.035,this._nowLv-1)*c);var d;d=n.hasOwnProperty("point")&&Number(n.point)>0?Number(n.point):Math.floor(400*l*7*.5*Math.pow(1.0164,this._nowLv-1)*c),this._display.selfRankBox.rankRewardTxt.text=String(h)+"/"+String(d)}else this._display.selfRankBox.rankTxt.text="未参战",this._display.selfRankBox.maxTxt.text="未参战",this._display.selfRankBox.allTxt.text="未参战",this._display.selfRankBox.rankRewardTxt.text="未参战";this._display.selfRankBox.visible=!0,0==this._display.menuTab.selectedIndex&&(this._bossIsNowWeek=e.hasOwnProperty("weekly_rtime")?t.ServerClock.isNowWeek(Number(e.weekly_rtime)):!1,this._bossIsNowWeek?t.WeakTips.show("本周已通关，下周一6点将发放本周排行榜奖励",!1,"#00FF00"):t.WeakTips.show("本周尚未通关，通关后下周一6点将发放排行奖励",!1,"#FF0000"))}else t.WeakTips.show("查询排行失败，"+e.msg),this.ranklist.array=[],this._display.selfRankBox.visible=!1},s.prototype.updateLogItem=function(t,e){e<=this.ranklist.array.length-1&&t.doRender(this.ranklist.array[e],e,this._nowLv)},s.prototype.bgClickHandler=function(){t.Facade.callCommand(new t.UserInfoCommand(t.Global.UID))},s.prototype.destroy=function(){this._display.selfRankBox.rankBg.off(Laya.Event.CLICK,this,this.bgClickHandler),this._display.selfRankBox.bg1.off(Laya.Event.CLICK,this,this.bgClickHandler),this._display.selfRankBox.bg2.off(Laya.Event.CLICK,this,this.bgClickHandler),this._display.menuTab.selectHandler=null,e.prototype.destroy.call(this)},s.getRankValue=function(t){var e=.4;return 1==t?e=.8:2==t?e=.72:3==t?e=.68:5>=t?e=.64:10>=t?e=.6:20>=t?e=.56:30>=t&&(e=.48),e},s.getPersonNumValue=function(t){var e=1.5;return 4>=t?e=1:9>=t?e=1.1:14>=t?e=1.2:19>=t?e=1.3:24>=t&&(e=1.4),e},s}(t.BaseBox);t.FactionHoleFightRankBox=e;var i=function(i){function s(){i.call(this),this.bg1.on(Laya.Event.CLICK,this,this.bgClickHandler),this.bg2.on(Laya.Event.CLICK,this,this.bgClickHandler)}return __extends(s,i),s.prototype.doRender=function(t,i,s){this._uid=t.uid,this.bg1.visible=i%2==0,this.bg2.visible=i%2!=0,this.tfVip.text=t.vip_level,this.nameTxt.overflow="hidden",this.nameTxt.text=t.name,this.line.width=this.nameTxt.textWidth,this.maxTxt.text=t.max_damage,this.allTxt.text=t.damage;var n,a=e.getRankValue(i+1),o=e.getPersonNumValue(e.total);n=t.hasOwnProperty("reward")&&Number(t.reward)>0?Number(t.reward):Math.floor(8750*a*Math.pow(1.035,s-1)*o);var r;r=t.hasOwnProperty("point")&&Number(t.point)>0?Number(t.point):Math.floor(400*a*7*.5*Math.pow(1.0164,s-1)*o),this.rankRewardTxt.text=String(n)+"/"+String(r),2>=i?(this.rankTxt.visible=!1,this.rankBg.visible=!0,this.rankBg.skin="ui/faction/factionHoleScene/rankBg"+(i+1)+".jpg"):(this.rankTxt.visible=!0,this.rankTxt.text=String(i+1),this.rankBg.visible=!1)},s.prototype.bgClickHandler=function(){t.Facade.callCommand(new t.UserInfoCommand(this._uid))},s.prototype.destroy=function(){this.bg1.off(Laya.Event.CLICK,this,this.bgClickHandler),this.bg2.off(Laya.Event.CLICK,this,this.bgClickHandler),i.prototype.destroy.call(this)},s}(ui.faction.faction.FactionHoleRankItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.faction.faction.FactionHoleFightRecordUI,!0,!0),this._display=this.skin,this.setCloseButton(this._display.back.closeBtn),this.name="FactionHoleFightRecordBox",this.loglist=new laya.ui.List,this.loglist.vScrollBarSkin="ui/comp/vscroll.png",this.loglist.scrollBar.visible=!1,this.loglist.renderHandler=Handler.create(this,this.updateLogItem,null,!1),this.loglist.itemRender=i,this._display.addChild(this.loglist),this.loglist.x=241,this.loglist.y=79,this.loglist.repeatX=1,this.loglist.repeatY=6,this.loglist.spaceX=0,this.loglist.spaceY=5,this.loglist.height=595,this.loglist.array=[],t.XHR().Post({file:"petpk",cmd:"faction",op:"cave_feeds",uid:t.Global.UID},this,this.getFightRecordHandler)}return __extends(s,e),s.prototype.getFightRecordHandler=function(e){0==e.result?this.setLog(e.feedslist||[]):t.WeakTips.show("查询挑战记录失败，"+e.msg)},s.prototype.setLog=function(e){if(e){for(var i=0,s=0,n=0,a=[],o=0;o<e.length;o++){var r=e[o],h=1e3*Number(r.time),l=t.ServerClock.getServerDateByTime(h),c={isFirst:!1,content:r.content,repid:r.repid};a.push(c),l.getFullYear()==i&&l.getMonth()==s&&l.getDate()==n||(i=l.getFullYear(),s=l.getMonth(),n=l.getDate(),c.isFirst=!0);for(var d=["今天","昨天","前天"],u=null,p=0;2>=p;p++){var _=t.ServerClock.getServerDateByTime(t.ServerClock.getServerTime()-864e5*p);if(_.getFullYear()==i&&_.getMonth()==s&&_.getDate()==n){u=d[p];break}}null==u&&(u=s+1+"月"+n+"日"),c.dayTxt=u;var f=l.getHours()<10?"0"+l.getHours():""+l.getHours(),y=l.getMinutes()<10?"0"+l.getMinutes():""+l.getMinutes();c.timeTxt=f+"时"+y+"分"}this.loglist.array=a}},s.prototype.updateLogItem=function(t,e){e<=this.loglist.array.length-1&&t.doRender(this.loglist.array[e],e)},s}(t.BaseBox);t.FactionHoleFightRecordBox=e;var i=function(e){function i(){e.call(this),this.replayBtn.on(Laya.Event.CLICK,this,this.onClicReplay),this._initY=this.contenctTxt.y,this._initTextHeight=this.contenctTxt.textHeight}return __extends(i,e),i.prototype.doRender=function(t,e){this._repid=t.repid,this.dayTxtNotFirst.visible=!0,this.dayTxtFirst.visible=!1,this.contenctTxt.text=t.content,this.contenctTxt.y=this._initY-(this.contenctTxt.textHeight-this._initTextHeight)/2,this.dayTxtNotFirst.text=t.dayTxt,this.dayTxtFirst.text=t.dayTxt,this.hourAndMinuteTxt.text=t.timeTxt},i.prototype.onClicReplay=function(){t.Facade.callCommand(new t.FightReplayCommand(this._repid))},i.prototype.destroy=function(){this.replayBtn.off(Laya.Event.CLICK,this,this.onClicReplay),e.prototype.destroy.call(this)},i}(ui.faction.faction.FactionHoleFightRecordItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i,s,n,a,o){e.call(this,new ui.faction.faction.FactionHoleNpcBoxUI,!0,!0),this._display=this.skin,this.setCloseButton(this._display.boxClose),this.name="FactionHoleNpcBox",this.cacheAs="none",this._display.mainLayer.cacheAs="bitmap",this._display.hpBox.cacheAs="bitmap",this._display.movieContainer.scrollRect=new Laya.Rectangle(0,0,476,205),this._display.fightBtn.label="挑战（"+(3-o)+"）",this._display.fightBtn.on(Laya.Event.CLICK,this,this.fightBtnClickHandler),this._display.npcNameTxt.text=n;var r=i.hp/i.maxhp;r>1&&(r=1),this._display.barMc.width=this._display.barMc.width*r,this._display.npcHpTxt.text=i.hp+"/"+i.maxhp;var h;if(i.hasOwnProperty("des_stauts"))h=i.des_stauts;else{for(var l="",c=Math.floor(5*Math.random())+1,d=1;c>=d;d++)l+="XXXXXXXXXXXXXXXXXXXXXXXX";h=l}var u;if(i.hasOwnProperty("des_weak"))u=i.des_weak;else{for(var l="",c=Math.floor(5*Math.random())+1,d=1;c>=d;d++)l+="XXXXXXXXXXXXXXXXXXXXXXXX";u=l}var p;if(i.hasOwnProperty("des_info"))p=i.des_info;else{for(var l="",c=Math.floor(5*Math.random())+1,d=1;c>=d;d++)l+="XXXXXXXXXXXXXXXXXXXXXXXX";p=l}this._display.stateTxt.text=h,this._display.ruoDianTxt.text=u,this._display.qingBaoTxt.text=p,this._display.line2.y=this._display.stateTxt.y+this._display.stateTxt.textHeight+5,this._display.stateMc.y=(this._display.line2.y+this._display.line1.y)/2-this._display.stateMc.height/2,this._display.stateTxt.textHeight<50&&(this._display.line2.y+=20,this._display.stateTxt.y+=10,this._display.stateMc.y+=10),this._display.ruoDianTxt.y=this._display.line2.y+11,this._display.line3.y=this._display.ruoDianTxt.y+this._display.ruoDianTxt.textHeight+5,this._display.ruoDIanMc.y=(this._display.line3.y+this._display.line2.y)/2-this._display.ruoDIanMc.height/2,this._display.ruoDianTxt.textHeight<50&&(this._display.line3.y+=20,this._display.ruoDianTxt.y+=10,this._display.ruoDIanMc.y+=10),this._display.qingBaoTxt.y=this._display.line3.y+11,this._display.line4.y=this._display.qingBaoTxt.y+this._display.qingBaoTxt.textHeight+5,this._display.qingBaoMc.y=(this._display.line4.y+this._display.line3.y)/2-this._display.qingBaoMc.height/2,this._display.qingBaoTxt.textHeight<50&&(this._display.line4.y+=20,this._display.qingBaoTxt.y+=10,this._display.qingBaoMc.y+=10),this._display.fightBtn.y=this._display.line4.y+14;var _=this._display.bg.height;this._display.bg.height=this._display.fightBtn.y+85,this._display.mainLayer.y-=(this._display.bg.height-_)/2,this._display.hpBox.y-=(this._display.bg.height-_)/2;var f=new t.NPCData(1,s);this.skeleton_nowNpc=new t.AnimationSKe(f.sourceUrl,2),this.skeleton_nowNpc.x=234,this.skeleton_nowNpc.y=171,f.skin&&this.skeleton_nowNpc.showSkinByName(f.skin),this._display.movieContainer.addChild(this.skeleton_nowNpc),this.skeleton_nowNpc.play("act_idle",!0),a?(this.skeleton_nowNpc.scaleX=this.skeleton_nowNpc.scaleY=.4,this.skeleton_nowNpc.y+=94):this.skeleton_nowNpc.scaleX=this.skeleton_nowNpc.scaleY=.7}return __extends(i,e),i.prototype.fightBtnClickHandler=function(){var e=Number(this._display.npcHpTxt.text.split("/")[0]);0>=e?t.WeakTips.show("该boss已被击败"):this.event("DO_FIGHT")},i.prototype.destroy=function(){this.skeleton_nowNpc&&(this.skeleton_nowNpc.destroy(),this.skeleton_nowNpc=null),this._display.fightBtn.off(Laya.Event.CLICK,this,this.fightBtnClickHandler),e.prototype.destroy.call(this)},i}(t.BaseBox);t.FactionHoleNpcBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.faction.faction.FactionHoleSceneUI),this._isOpen=!1,this._fightIndex=-1,this._isOverdue=!1,this._nowSeq=0,this._nowLv=1,this._npcIsNowWeekArr=[],this.moviePath_fight="assets/skeleton/lilian.sk",this.moviePath_reward="assets/skeleton/faction/factionHole/effect_bpbx.sk",this.moviePath_scene="assets/skeleton/faction/factionHole/star.sk",this.moviePath_baGua="assets/skeleton/faction/factionHole/effect_baguaqiu.sk",this.needVipLv=6,this._bossMoviePathObj={boss1:"monster_dashe"},this._bossAddWood=0,this._bossAddStone=0,this._bossAddIron=0,this._reliveBossIndexArr=[],this._figureStep=1,this._hasOffY=0,this._setWordIndex=0,this._display=this.skin,this.setCloseButton(this._display.backBtn),this.canClickModelToClose=!1,this.name="FactionHoleSceneBox",this.cacheAs="none",this._display.mainLayer.cacheAs="bitmap",this._display.bossLayer.cacheAs="bitmap",this._initFigureDownY=this._display.figureDown.y,this.skeleton_fight=new t.AnimationSKe(this.moviePath_fight),this._display.movieContainer.addChild(this.skeleton_fight),this.skeleton_fight.play(0,!0),this.skeleton_fight.visible=!1,this.skeleton_baGua=new t.AnimationSKe(this.moviePath_baGua),this._display.baGuaMovieContainer.addChild(this.skeleton_baGua),this.skeleton_baGua.x=667,this.skeleton_baGua.y=388,this.skeleton_baGua.play(0,!0),this.skeleton_reward_bg=new t.AnimationSKe(this.moviePath_reward,1),this._display.movieContainer.addChild(this.skeleton_reward_bg),this.skeleton_reward_bg.x=this._display.rewardBox.x+100,this.skeleton_reward_bg.y=this._display.rewardBox.y+100,this.skeleton_reward_bg.play(1,!0),this.skeleton_reward=new t.AnimationSKe(this.moviePath_reward),this.skeleton_reward.scaleX=this.skeleton_reward.scaleY=1.5,this._display.movieContainer.addChild(this.skeleton_reward),this.skeleton_reward.x=this._display.rewardBox.x+100,this.skeleton_reward.y=this._display.rewardBox.y+100,this.skeleton_reward.play(0,!1),this.skeleton_reward.index=1,this.skeleton_reward.on(Laya.Event.STOPPED,this,this.rewardMoviePlayOver),this.skeleton_scene=new t.AnimationSKe(this.moviePath_scene),this._display.starContainer.addChild(this.skeleton_scene),this.skeleton_scene.x=667,this.skeleton_scene.y=375,this.skeleton_scene.play(0,!0),this._display.needFanrongTxt.style.fontSize=26,this._display.needFanrongTxt.style.color="#FFFF00",this._display.needFanrongTxt.style.align="center",this._display.needFanrongTxt.style.valign="top",this._display.needFanrongTxt.style.bold=!0,this._display.needFanrongTxt.style.stroke=4,this._display.needFanrongTxt.style.strokeColor="#000000",this._display.needFanrongTxt.on(Laya.Event.CLICK,this,this.showFanrongTips),this._bossInfoInitX=this._display.bossInfoBox.x,this._bossInfoBgInitWidth=this._display.bossInfoBg.width,this._bossInfoWidthStep=this._display.bossInfoRewardIcon2.x-this._display.bossInfoRewardIcon1.x,this._bossHpMaskInitHeight=this._display.boss1.hp.height,this._display.bosshasGetTxt.visible=!1;for(var i=1;6>=i;i++){var s=this._display["npc"+i];s.fengImg.visible=s.grayBg.visible=s.hasBitPng.visible=!1,s.npcHpBox.visible=s.npcRewardImg.visible=s.npcHeadImg.visible=!1,s.npchasGetTxt.visible=!1;var n=i%3==1?"wood":i%3==2?"stone":"iron";s.npcRewardImg.skin="ui/faction/factionScene/"+n+".png",s.npcRewardImgBox.skin="ui/faction/factionScene/"+n+".png",s.on(Laya.Event.CLICK,this,this.npcClickHandler)}this._display.npcBoss.on(Laya.Event.CLICK,this,this.npcBossClickHandler);for(var i=1;8>=i;i++){var a=this._display["boss"+i];a.hpTxt.visible=!1,a.on(Laya.Event.CLICK,this,this.bossClickHandler);var o=new t.AnimationSKe(this.moviePath_baGua,1);this._display.bossBuaGuaContainer.addChild(o),o.name="bossBaguaQiu"+i,o.x=a.x+this._display.bossLayer.x+34,o.y=a.y+this._display.bossLayer.y+34,o.play(1,!0)}this._hpBarMaxWidth=this._display.npc1.npcHpBar.width,this.showNpc(!1),this.showBoss(!1),this.setOpenBoxVisible(!1),this.setRewardBoxVisible(!1),this._display.fightRecordBtn.on(Laya.Event.CLICK,this,this.openFightRecordBox),this._display.rankBtn.on(Laya.Event.CLICK,this,this.openFightRankBox),this._display.openBtn.on(Laya.Event.CLICK,this,this.openBtnClickHandler),this._display.shopBtn.on(Laya.Event.CLICK,this,this.shopBtnClickHandler),this._display.getRewardBtn.on(Laya.Event.CLICK,this,this.getRewardClickHandler),this._display.getRewardBtn.alpha=0,this._display.ruleImage.on(Laya.Event.CLICK,this,this.showRule),this._display.titleBox.on(Laya.Event.CLICK,this,this.titleBoxClickHandler),this._display.checkBoxClick.alpha=0,this._display.checkBoxClick.on(Laya.Event.MOUSE_DOWN,this,this.checkBoxClickHandler);var r=t.Facade.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);this._display.jumpCheckBox.selected=1==r.getLongDataValue(t.ServerSetDataModel.KEY_HAS_JUMP_FACTION_HOLE_FIGHT),this._initJump=this._display.jumpCheckBox.selected,this.getFactionHoleInfo(),this._display.buffView.updateBuffs(),Laya.stage.on(Laya.Event.RESIZE,this,this.setOffY),this.setOffY(),Laya.timer.loop(1e3,this,this.setWord),this._display.backBtn.x-=t.Global.FLOAT_ICON_OFFSET,this._display.ruleImage.x-=t.Global.FLOAT_ICON_OFFSET,this._display.shopBtn.x-=t.Global.FLOAT_ICON_OFFSET,this._display.titleBox.x-=t.Global.FLOAT_ICON_OFFSET}return __extends(i,e),i.prototype.getFactionHoleInfo=function(){t.XHR().Post({file:"petpk",cmd:"faction",op:"cave_query",uid:t.Global.UID},this,this.getFactionHoleInfoHandler)},i.prototype.getFactionHoleInfoHandler=function(e){if(0==e.result&&e.hasOwnProperty("cave")){var i=e.cave;i.hasOwnProperty("fighter")?(this._hasReward=i.fighter.reward>0,this._todayFightCount=i.fighter.times>3?3:i.fighter.times,this._display.fightCountTxt.text="今日剩余挑战次数："+(3-this._todayFightCount)+"/3"):(this._hasReward=!1,this._todayFightCount=0,this._display.fightCountTxt.text="今日剩余挑战次数：3/3");var s=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);s.setReddot(t.FactionReddotEnum.kFactionRedDotTypeFightCave,this._todayFightCount<3),s.setReddot(t.FactionReddotEnum.kFactionRedDotTypeReward,this._hasReward),this._nowLv=0==i.level?1:i.level,this._display.holeLvTxt.text="神秘洞穴："+this._nowLv+"级",this._nowLv<20&&t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).vipLevel<this.needVipLv&&(this._display.jumpCheckBox.selected=!1),this._nowSeq=i.seq;var n=i.hasOwnProperty("ctime")?i.ctime:0;if(0!=n){this._isOpen=!0;var a=Math.max(t.ServerClock.getServerTime()/1e3-n,0);this._isOverdue=a>=604800,this._isOverdue?(this._display.holeMsgTxt.text=1==this._nowLv?"通关后不升级":"通关后降级",t.TimeTextControl.removeTimeText(this._display.holeMsgTxt)):0==t.TimeTextControl.hasTimeText(this._display.holeMsgTxt)&&(this._display.holeMsgTxt.on(t.TimeTextControl.TIME_UP,this,this.timeUp),t.TimeTextControl.setTimeText(this._display.holeMsgTxt,604800-a,"D天HH时NN分SS秒")),this._hasReward?(this.showNpc(!1),this.showBoss(!1),this.setOpenBoxVisible(!1),this.setRewardBoxVisible(!0)):(this.setOpenBoxVisible(!1),this.setRewardBoxVisible(!1),this.setNpcData(i.monster),this.setBossData(i.boss))}else{this._isOpen=!1,this._isOverdue=!1,t.TimeTextControl.removeTimeText(this._display.holeMsgTxt),this._display.holeMsgTxt.text="7天内通关可自动升级",this._openNeedFanrong=i.open_cost;var o=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF).res_fanrong;o<this._openNeedFanrong?this._display.needFanrongTxt.innerHTML="消耗繁荣度:"+this._openNeedFanrong+"(当前:<font color='#FF0000'>"+o+"</font>)":this._display.needFanrongTxt.innerHTML="消耗繁荣度:"+this._openNeedFanrong+"(当前:"+o+")",this.showNpc(!1),this.showBoss(!1),this._hasReward?(this.setOpenBoxVisible(!1),this.setRewardBoxVisible(!0)):(this.setOpenBoxVisible(!0),this.setRewardBoxVisible(!1))}}else t.WeakTips.show("获取洞穴信息失败，"+e.msg)},i.prototype.setNpcData=function(e){var i=0,s=e.length;this._npcIDArr=[],this._npcIsNowWeekArr=[],this._npcHeadIDArr=[];for(var n=0;s>n;n++){var a=e[n];this._npcIDArr.push(a.id),this._npcHeadIDArr.push(a.head),this._npcIsNowWeekArr.push(a.hasOwnProperty("weekly_rtime")?t.ServerClock.isNowWeek(Number(a.weekly_rtime)):!1);var o=this._display["npc"+(n+1)];if(o.npcHeadImg.skin="ui/faction/factionHoleScene/"+a.head+".png",0==i)if(o.npcNameTxt.text=a.hasOwnProperty("name")?a.name:"未知矿兽",o.npcNameTxtBox.text=a.hasOwnProperty("name")?a.name:"未知矿兽",o.fengImg.visible=!1,a.hp>0){this._nowFightNpcHeadID=a.head,i=n+1,o.fengImg.visible=!1,o.grayBg.visible=!1,o.hasBitPng.visible=!1,o.npcRewardImg.visible=!1,o.npcNameTxt.visible=!1,o.npcHeadImg.visible=!1,o.npcHpBox.visible=!0,o.npcRewardValueTxt.text=this._npcIsNowWeekArr[n]?0:a.res_val;var r=Number(a.hp),h=Number(a.maxhp);o.npcHpTxt.text=r+"/"+h;var l=r>h?1:r/h;o.npcHpBar.width=this._hpBarMaxWidth*l}else o.fengImg.visible=!1,o.grayBg.visible=!0,o.hasBitPng.visible=!0,o.npcRewardImg.visible=!0,o.npcNameTxt.visible=!0,o.npcHeadImg.scaleX=o.npcHeadImg.scaleY=1.2,o.npcHeadImg.visible=!0,o.npcHeadImg.filters=t.FiltersUtils.getGreyFilters(),o.npcHpBox.visible=!1;else o.fengImg.visible=!0,o.grayBg.visible=!1,o.hasBitPng.visible=!1,o.npcRewardImg.visible=!0,o.npcNameTxt.visible=!0,o.npcNameTxt.text="未知矿兽",o.npcHeadImg.visible=!1,o.npcHpBox.visible=!1}this._fightIndex=i,this._fightIndex>0?(this.showNpc(!0),this.showBoss(!1)):(this.showNpc(!1),this.showBoss(!0))},i.prototype.setBossData=function(e){for(var i=1;8>=i;i++)this._display["boss"+i].visible=!1,this._display.bossBuaGuaContainer.getChildByName("bossBaguaQiu"+i).visible=!1;
this._bossIsNowWeek=e.hasOwnProperty("weekly_rtime")?t.ServerClock.isNowWeek(Number(e.weekly_rtime)):!1;var s=e.monster,n=s.length;this._bossIDArr=[0,0,0,0,0,0,0,0],this._bossHeadIDArr=[0,0,0,0,0,0,0,0],this._bossHitTimeArr=[0,0,0,0,0,0,0,0];var a,o=0;this._bossAddWood=0,this._bossAddStone=0,this._bossAddIron=0;for(var i=0;n>i;i++){o++;var r=s[i];r.res_type==t.FactionConfig.WOOD?this._bossAddWood+=Number(r.res_val):r.res_type==t.FactionConfig.STONE?this._bossAddStone+=Number(r.res_val):r.res_type==t.FactionConfig.IRON&&(this._bossAddIron+=Number(r.res_val));var h,l,c=r.name,d=c.split("_");d.length>1?(h=Number(d[2]),l=d[1],a=d[0]):(h=o,l=c,a=c),this._bossIDArr[h-1]=r.id,this._bossHeadIDArr[h-1]=r.head;var u=this._display["boss"+h];u.visible=!0,u.nameTxt.text=l,u.hpTxt.text=r.hp+"/"+r.maxhp;var p=t.MathUtils.getDotNum(100*Number(r.hp)/Number(r.maxhp),1);u.retTxt.text=0==p?"0.1%":p+"%",0==Number(r.hp)?(u.retTxt.visible=!1,u.hpBg.visible=!0,this._display.bossBuaGuaContainer.getChildByName("bossBaguaQiu"+h).visible=!1):(u.retTxt.visible=!0,u.hpBg.visible=!1,this._display.bossBuaGuaContainer.getChildByName("bossBaguaQiu"+h).visible=!0),u.hasBitPng.visible=Number(r.hp)<=0;var _=this._bossHpMaskInitHeight*Number(r.hp)/Number(r.maxhp),f=this._bossHpMaskInitHeight-_;if(u.hp.scrollRect=new Laya.Rectangle(0,f,68,_),u.hp.y=f,u.hp.visible=Number(r.hp)>0,u.reliveTimeTxt.visible=!1,r.hasOwnProperty("beat_time")&&Number(r.beat_time)>0){var y=t.ServerClock.getServerTime()/1e3;if(Number(r.beat_time)+86400>y&&(u.reliveTimeTxt.visible=!0,Number(this._bossHitTimeArr[h-1])!=Number(r.beat_time))){this._bossHitTimeArr[h-1]=Number(r.beat_time),u.reliveTimeTxt.on(t.TimeTextControl.TIME_UP,this,this.bossTimeUp);var m=Math.round(Number(r.beat_time)+86400-y);86400>m&&(m+=1),t.TimeTextControl.setTimeText(u.reliveTimeTxt,m,"HH:NN:SS","{time}后复活")}}}this._display.bossInfoName.text=a;var g=0;if(this._bossAddWood>0&&(g++,this._display["bossInfoRewardIcon"+g].visible=!0,this._display["bossInfoRewardIcon"+g].skin="ui/faction/factionScene/wood.png",this._display["bossInfoRewardTxt"+g].visible=!0,this._display["bossInfoRewardTxt"+g].text=String(this._bossAddWood)),this._bossAddStone>0&&(g++,this._display["bossInfoRewardIcon"+g].visible=!0,this._display["bossInfoRewardIcon"+g].skin="ui/faction/factionScene/stone.png",this._display["bossInfoRewardTxt"+g].visible=!0,this._display["bossInfoRewardTxt"+g].text=String(this._bossAddStone)),this._bossAddIron>0&&(g++,this._display["bossInfoRewardIcon"+g].visible=!0,this._display["bossInfoRewardIcon"+g].skin="ui/faction/factionScene/iron.png",this._display["bossInfoRewardTxt"+g].visible=!0,this._display["bossInfoRewardTxt"+g].text=String(this._bossAddIron)),3>g)for(var i=g+1;3>=i;i++)this._display["bossInfoRewardIcon"+i].visible=!1,this._display["bossInfoRewardTxt"+i].visible=!1;if(this._display.bossInfoBg.width=this._bossInfoBgInitWidth-this._bossInfoWidthStep*(3-g),this._display.bossInfoBox.x=1>=g?this._bossInfoInitX+56:this._bossInfoInitX,0==this._fightIndex){var v=!0,C="assets/skeleton/faction/factionHole/"+this._bossMoviePathObj["boss"+e.id]+".sk";this.skeleton_boss&&(this.skeleton_boss.url==C?v=!1:(this.skeleton_boss.destroy(),this.skeleton_boss=null)),v&&(this.skeleton_boss=new t.AnimationSKe(C),this._display.movieContainer.addChildAt(this.skeleton_boss,0),this.skeleton_boss.play(0,!0),this.skeleton_boss.x=667,this.skeleton_boss.y=540)}},i.prototype.bossTimeUp=function(e){var i=Number(e.parent.name.split("boss")[1]);this._reliveBossIndexArr.push(i),t.XHR().Post({file:"petpk",cmd:"faction",op:"cave_monster",seq:this._nowSeq,monster:this._bossIDArr[i-1],uid:t.Global.UID},this,this.getBossInfoHandler)},i.prototype.getBossInfoHandler=function(e){var i=this._reliveBossIndexArr.shift();if(0==e.result){var s=this._display["boss"+i];s.reliveTimeTxt.visible=!1,s.hasBitPng.visible=!1;var n=e.monster,a=t.MathUtils.getDotNum(100*Number(n.hp)/Number(n.maxhp),1);s.retTxt.text=0==a?"0.1%":a+"%",0==Number(n.hp)?(s.retTxt.visible=!1,s.hpBg.visible=!0,this._display.bossBuaGuaContainer.getChildByName("bossBaguaQiu"+i).visible=!1):(s.retTxt.visible=!0,s.hpBg.visible=!1,this._display.bossBuaGuaContainer.getChildByName("bossBaguaQiu"+i).visible=!0),s.hp.visible=!0,s.hpTxt.text=Number(n.hp)+"/"+Number(n.maxhp);var o=this._bossHpMaskInitHeight*Number(n.hp)/Number(n.maxhp),r=this._bossHpMaskInitHeight-o;s.hp.scrollRect=new Laya.Rectangle(0,r,68,o),s.hp.y=r,s.hp.visible=Number(n.hp)>0}else t.WeakTips.show("查询怪物信息失败，"+e.msg)},i.prototype.openBtnClickHandler=function(){var e=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);e.selfFactionUserModel.position<t.FactionConfig.updateBuildingPos?t.WeakTips.show("仅"+t.FactionConfig.updateBuildingName+"以上能开启矿洞"):e.res_fanrong<this._openNeedFanrong?t.WeakTips.show("帮派繁荣度不足"):t.XHR().Post({file:"petpk",cmd:"faction",op:"cave_open",uid:t.Global.UID},this,this.openFactionHoleHandler)},i.prototype.openFactionHoleHandler=function(e){if(0==e.result){t.WeakTips.show("开启洞穴成功！");var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF),s=i.res_fanrong,n=s>this._openNeedFanrong?s-this._openNeedFanrong:0;i.res_fanrong=n,i.updateFinish(),this.getFactionHoleInfoHandler(e)}else if(120==e.result){var a=new t.ConfirmBoxData({isShowCancelBtn:!1,contentStr:"洞穴信息已更新。"});t.ConfirmBox.show(a,t.Layer.WEAK_TIP),this.getFactionHoleInfo()}else t.WeakTips.show("开启洞穴失败，"+e.msg)},i.prototype.getRewardClickHandler=function(){this._hasReward&&this.skeleton_reward.resLoaded&&t.XHR().Post({file:"petpk",cmd:"faction",op:"cave_reward",uid:t.Global.UID},this,this.getRewardHandler)},i.prototype.getRewardHandler=function(e){if(0==e.result){this._hasReward=!1;var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);i.setReddot(t.FactionReddotEnum.kFactionRedDotTypeReward,this._hasReward),this.destroyed?this.alertToShowRankReward(e):(this._getRewardData=e,this._display.getRewardBtn.visible=!1,this._display.figureDown.visible=!1,this.skeleton_reward.play(0,!1))}else t.WeakTips.show("领取奖励失败，"+e.msg)},i.prototype.shopBtnClickHandler=function(){t.Facade.callCommand(new t.OpenWinShopCmd(5))},i.prototype.rewardMoviePlayOver=function(){t.Facade.callCommand(new t.SyncChangeCmd(this._getRewardData,!1)),this._getRewardData&&(this.alertToShowRankReward(this._getRewardData),this.destroyed||this.getFactionHoleInfoHandler(this._getRewardData),this._getRewardData=null)},i.prototype.alertToShowRankReward=function(e){var i=e.cave.fighter.rankPos,s=t.SyncExecuter.getObjNum(e,"kContrib",1),n=t.SyncExecuter.getObjNum(e,"kCavePoint",1),a="恭喜您在上轮洞穴探索中伤害排行第"+i+"名，获得"+s+"个人帮贡奖励，"+n+"洞穴积分奖励。",o=new t.ConfirmBoxData({isShowCancelBtn:!1,contentStr:a});t.ConfirmBox.show(o,t.Layer.WEAK_TIP)},i.prototype.timeUp=function(){this._display.holeMsgTxt.text="通关后降级"},i.prototype.showNpc=function(e){for(var i=1;6>=i;i++)this._display["npc"+i].visible=e;if(this._display.npcBoss.visible=e,this._display.npcLine.visible=e,e){this.skeleton_fight.visible=!0,this.skeleton_fight.x=this._display["npc"+this._fightIndex].x,this.skeleton_fight.y=this._display["npc"+this._fightIndex].y-110;var s=t.ResPath().getAnimPath(this._nowFightNpcHeadID,t.ResourcePath.PATH_NPC)+".sk",n=!0;this.skeleton_nowNpc&&(this.skeleton_nowNpc.url==s?n=!1:(this.skeleton_nowNpc.destroy(),this.skeleton_nowNpc=null)),n&&(this.skeleton_nowNpc=new t.AnimationSKe(t.ResPath().getAnimPath(this._nowFightNpcHeadID,t.ResourcePath.PATH_NPC)+".sk"),this.skeleton_nowNpc.scaleX=this.skeleton_nowNpc.scaleY=.7,this._display.movieContainer.addChildAt(this.skeleton_nowNpc,0),this.skeleton_nowNpc.play("act_idle",!0),this.skeleton_nowNpc.x=this._display["npc"+this._fightIndex].x,this.skeleton_nowNpc.y=this._display["npc"+this._fightIndex].y+50)}else this.skeleton_fight.visible=!1,this.skeleton_nowNpc&&(this.skeleton_nowNpc.destroy(),this.skeleton_nowNpc=null)},i.prototype.showBoss=function(t){this._display.bossInfoBox.visible=t,this.skeleton_baGua.visible=t,this._display.bossLayer.visible=t,this._display.bossBuaGuaContainer.visible=t,!t&&this.skeleton_boss&&(this.skeleton_boss.destroy(),this.skeleton_boss=null)},i.prototype.checkBoxClickHandler=function(){if(t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).vipLevel<this.needVipLv&&this._nowLv<20)t.WeakTips.show("矿洞20级以上或者达人"+this.needVipLv+"以上开启战斗跳过");else{this._display.jumpCheckBox.selected=!this._display.jumpCheckBox.selected;var e=t.Facade.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL),i=this._display.jumpCheckBox.selected?1:0;e.setLongDataValue(t.ServerSetDataModel.KEY_HAS_JUMP_FACTION_HOLE_FIGHT,i)}},i.prototype.showFanrongTips=function(){t.Facade.callCommand(new t.ShowChangeRewardCmd(["神秘洞穴等级越高，开启需要的繁荣度越高"],200,"#ffec49"))},Object.defineProperty(i.prototype,"isJumpFight",{get:function(){return this._display.jumpCheckBox.selected},enumerable:!0,configurable:!0}),i.prototype.setOpenBoxVisible=function(e){this._display.openBox.visible=e,e&&(this.newBgModel(),this._display.openBox.addChildAt(this._bgModel,0),this._bgModel.x=0-this._display.openBox.x,this._bgModel.y=-t.LayerMgr.offY-this._display.openBox.y)},i.prototype.setRewardBoxVisible=function(e){this._display.rewardBox.visible=e,this.skeleton_reward.visible=e,this.skeleton_reward_bg.visible=e,e?(this.newBgModel(),this._display.rewardBox.addChildAt(this._bgModel,0),this._display.figureDown.visible=!0,this._display.movieContainer.setChildIndex(this._display.figureDown,this._display.movieContainer.numChildren-1),this._bgModel.x=0-this._display.rewardBox.x,this._bgModel.y=-t.LayerMgr.offY-this._display.rewardBox.y,this.skeleton_reward.play(0,!1),this.skeleton_reward.index=1,Laya.timer.loop(30,this,this.setFigureDown),this._display.getRewardBtn.visible=!0):(this._display.figureDown.visible=!1,Laya.timer.clear(this,this.setFigureDown))},i.prototype.newBgModel=function(){this._bgModel||(this._bgModel=new Sprite,this._bgModel.graphics.drawRect(0,0,t.LayerMgr.width,t.LayerMgr.clientHeight,"#000000"),this._bgModel.mouseEnabled=!0,this._bgModel.size(t.LayerMgr.width,t.LayerMgr.clientHeight),this._bgModel.alpha=.4)},i.prototype.setFigureDown=function(){this._display.figureDown.y+=this._figureStep,this._display.figureDown.y!=this._initFigureDownY&&this._display.figureDown.y!=this._initFigureDownY+20||(this._figureStep*=-1)},i.prototype.npcClickHandler=function(e){var i=Number(e.target.name.split("npc")[1]),s=this._display["npc"+i].npcNameTxt.text;i==this._fightIndex?this.event("OPEN_NPC_BOX",{seq:this._nowSeq,todayFightCount:this._todayFightCount,isBoss:!1,npcID:this._npcIDArr[this._fightIndex-1],npcHeadID:this._npcHeadIDArr[this._fightIndex-1],npcName:s}):i<this._fightIndex?t.WeakTips.show("【"+s+"】已被本帮众英雄降服！"):t.WeakTips.show("该矿兽正在沉睡……")},i.prototype.npcBossClickHandler=function(){t.WeakTips.show("击败所有矿兽方可唤醒终极首领……")},i.prototype.bossClickHandler=function(e){var i=Number(e.target.name.split("boss")[1]),s=this._display["boss"+i];0==Number(s.hpTxt.text.split("/")[0])?t.WeakTips.show("该部位已被击败"):0==this._fightIndex&&this.event("OPEN_NPC_BOX",{seq:this._nowSeq,todayFightCount:this._todayFightCount,isBoss:!0,npcID:this._bossIDArr[i-1],npcHeadID:this._bossHeadIDArr[i-1],npcName:s.nameTxt.text})},i.prototype.fightRefreshNpc=function(e,i){for(var s=0,n=0;n<this._npcIDArr.length;n++)if(this._npcIDArr[n]==e){s=n+1;break}if(s>0){var a=this._display["npc"+s],o=a.npcHpTxt.text,r=Number(o.split("/")[1]);a.npcHpTxt.text=i+"/"+r;var h=i>r?1:i/r;a.npcHpBar.width=this._hpBarMaxWidth*h}else{for(var n=0;n<this._bossIDArr.length;n++)if(this._bossIDArr[n]==e){s=n+1;break}if(s>0){var l=this._display["boss"+s],o=l.hpTxt.text,r=Number(o.split("/")[1]);l.hpTxt.text=i+"/"+r;var c=t.MathUtils.getDotNum(100*i/r,1);l.retTxt.text=0==c?"0.1%":c+"%",0==i?(l.retTxt.visible=!1,l.hpBg.visible=!0,this._display.bossBuaGuaContainer.getChildByName("bossBaguaQiu"+s).visible=!1):(l.retTxt.visible=!0,l.hpBg.visible=!1,this._display.bossBuaGuaContainer.getChildByName("bossBaguaQiu"+s).visible=!0);var d=this._bossHpMaskInitHeight*i/r,u=this._bossHpMaskInitHeight-d;l.hp.scrollRect=new Laya.Rectangle(0,u,68,d),l.hp.y=u,l.hp.visible=i>0}}this._todayFightCount++,this._todayFightCount>3&&(this._todayFightCount=3);var p=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);p.setReddot(t.FactionReddotEnum.kFactionRedDotTypeFightCave,this._todayFightCount<3),this._display.fightCountTxt.text="今日剩余挑战次数："+(3-this._todayFightCount)+"/3"},i.prototype.addNpcSource=function(e){for(var i=0,s=0;s<this._npcIDArr.length;s++)if(this._npcIDArr[s]==e){i=s+1;break}if(i>0){var n=this._display["npc"+i],a=Number(n.npcRewardValueTxt.text),o=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);i%3==1?o.res_wood+=a:i%3==2?o.res_stone+=a:o.res_iron+=a,o.updateFinish()}},i.prototype.hitBoss=function(e){for(var i=!1,s=0;s<this._bossIDArr.length;s++){var n=Number(this._bossIDArr[s]);if(0!=n&&n!=e&&0==this._display["boss"+(s+1)].hasBitPng.visible){i=!0;break}}if(0==i){var a=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);a.res_wood+=this._bossAddWood,a.res_stone+=this._bossAddStone,a.res_iron+=this._bossAddIron,a.updateFinish()}},i.prototype.openFightRecordBox=function(){this.event("OPEN_FIGHT_RECORD_BOX")},i.prototype.openFightRankBox=function(){0==this._nowSeq?t.WeakTips.show("您的帮派还未曾打过矿洞"):this.event("OPEN_FIGHT_RANK_BOX",{nowLv:this._nowLv,nowSeq:this._nowSeq})},i.prototype.setOffY=function(){var e=t.LayerMgr.offY-this._hasOffY;this._hasOffY=t.LayerMgr.offY;var i=(t.LayerMgr.height+2*t.LayerMgr.offY)/t.LayerMgr.height;1>i&&(i=1),this._display.background.scaleX=this._display.background.scaleY=i,this._display.background.x=-(t.LayerMgr.width*(i-1))/2,this._display.background.y-=e,this._display.fightCountTxt.y-=e,this._display.buffView.y-=e,this._display.titleBox.y-=e,this._display.ruleImage.y-=e,this._display.backBtn.y-=e,this._display.shopBtn.y-=e,this._display.fightRecordBtn.y+=e,this._display.rankBtn.y+=e,this._display.bossInfoBox.y+=e,this._display.jumpBox.y+=e},i.prototype.showRule=function(){var e="";e+="<img src='ui/comp/icon.png'></img> 1. 神秘洞穴自动开启探索；<br>",e+="<img src='ui/comp/icon.png'></img> 2. 开启后所有成员依次击败6个矿兽和1个首领，即视为本轮通关；<br>",e+="<img src='ui/comp/icon.png'></img> 3. 每天可挑战3次，每天凌晨6点次数重置；<br>",e+="<img src='ui/comp/icon.png'></img> 4. 伤害排行统计1周内成员对矿兽和首领造成的伤害总和；<br>",e+="<img src='ui/comp/icon.png'></img> 5. 每周一6点根据上周的伤害排行发放帮贡和积分奖励（需上周至少通关1次方会发放）；<br>",e+="<img src='ui/comp/icon.png'></img> 6. 对矿兽最后一击的成员可获得额外帮贡和积分奖励；<br>",e+="<img src='ui/comp/icon.png'></img> 7. 七天内通关，则洞穴自动升级，否则通关后洞穴会降级；<br>",e+="<img src='ui/comp/icon.png'></img> 8. 攻击首领不同部位，击败可能会更轻松！<br>",e+="<img src='ui/comp/icon.png'></img> 9. 每个矿兽点每周只能获得一次通关帮派资源奖励；",t.RulePanel.showRule(e,"")},i.prototype.titleBoxClickHandler=function(){var e;e=this._isOverdue?1==this._nowLv?"通关后不升级":"通关后降级":1==this._nowLv?this._display.holeMsgTxt.text+"内通关升级":this._display.holeMsgTxt.text+"内通关升级，未通关下轮降级",t.WeakTips.show(e)},i.prototype.setWord=function(){this._setWordIndex++;for(var t=0;6>t;t++)if(this._npcIsNowWeekArr.length>=t+1&&this._npcIsNowWeekArr[t]){var e=this._display["npc"+(t+1)];e.npcNameTxtBox.visible=this._setWordIndex%2==0,e.npchasGetTxt.visible=this._setWordIndex%2!=0}this._bossIsNowWeek&&(this._display.bossInfoName.visible=this._setWordIndex%2==0,this._display.bosshasGetTxt.visible=this._setWordIndex%2!=0)},i.prototype.destroy=function(){Laya.timer.clear(this,this.setFigureDown),Laya.timer.clear(this,this.setWord),this._bossMoviePathObj=null,this._getRewardData&&(this.alertToShowRankReward(this._getRewardData),this._getRewardData=null),Laya.stage.off(Laya.Event.RESIZE,this,this.setOffY),this._npcIDArr=null,this._npcHeadIDArr=null,this._npcIsNowWeekArr=null,this._bossIDArr=null,this._bossHeadIDArr=null,this._bossHitTimeArr=null;for(var i=1;6>=i;i++){var s=this._display["npc"+i];s.off(Laya.Event.CLICK,this,this.npcClickHandler)}this._display.npcBoss.off(Laya.Event.CLICK,this,this.npcBossClickHandler);for(var i=1;8>=i;i++){var n=this._display["boss"+i];n.off(Laya.Event.CLICK,this,this.bossClickHandler),n.reliveTimeTxt.off(t.TimeTextControl.TIME_UP,this,this.bossTimeUp),t.TimeTextControl.removeTimeText(n.reliveTimeTxt);var a=this._display.bossBuaGuaContainer.getChildByName("bossBaguaQiu"+i);a&&a.destroy()}this._display.fightRecordBtn.off(Laya.Event.CLICK,this,this.openFightRecordBox),this._display.rankBtn.off(Laya.Event.CLICK,this,this.openFightRankBox),this._display.openBtn.off(Laya.Event.CLICK,this,this.openBtnClickHandler),this._display.shopBtn.off(Laya.Event.CLICK,this,this.shopBtnClickHandler),this._display.getRewardBtn.off(Laya.Event.CLICK,this,this.getRewardClickHandler),this._display.ruleImage.off(Laya.Event.CLICK,this,this.showRule),this._display.titleBox.off(Laya.Event.CLICK,this,this.titleBoxClickHandler),this._display.checkBoxClick.off(Laya.Event.MOUSE_DOWN,this,this.checkBoxClickHandler),this._display.holeMsgTxt.off(t.TimeTextControl.TIME_UP,this,this.timeUp),t.TimeTextControl.removeTimeText(this._display.holeMsgTxt),this.skeleton_baGua&&(this.skeleton_baGua.destroy(),this.skeleton_baGua=null),this.skeleton_fight&&(this.skeleton_fight.destroy(),this.skeleton_fight=null),this.skeleton_reward&&(this.skeleton_reward.off(Laya.Event.STOPPED,this,this.rewardMoviePlayOver),this.skeleton_reward.destroy(),this.skeleton_reward=null),this.skeleton_reward_bg&&(this.skeleton_reward_bg.destroy(),this.skeleton_reward_bg=null),this.skeleton_scene&&(this.skeleton_scene.destroy(),this.skeleton_scene=null),this.skeleton_nowNpc&&(this.skeleton_nowNpc.destroy(),this.skeleton_nowNpc=null),this.skeleton_boss&&(this.skeleton_boss.destroy(),this.skeleton_boss=null),this._bgModel&&(this._bgModel.removeSelf(),this._bgModel=null),e.prototype.destroy.call(this)},i}(t.BaseBox);t.FactionHoleScene=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.faction.faction.FactionNoticeUI,!0,!0),this._noticeStr="",this._display=this.skin,this.setCloseButton(this._display.boxClose),this.name="FactionNoticeBox",this._display.queDingBtn.on(Laya.Event.CLICK,this,this.modifyNotice),this._display.inputTxt.maxChars=40,this._display.inputTxt.on(Laya.Event.FOCUS,this,this.onFocusIN),this._display.inputTxt.on(Laya.Event.BLUR,this,this.onFocusOUT),this._display.inputTxt.on(Laya.Event.INPUT,this,this.facNameTxtChange);var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);i.facNotice?(this._display.inputTxt.color="#4A2507",this._display.inputTxt.text=i.facNotice):(this._display.inputTxt.color="#999999",this._display.inputTxt.text="暂无公告"),i.selfFactionUserModel.position<t.FactionConfig.settingPos&&(this._display.inputTxt.mouseEnabled=!1,this._display.msgTxt.visible=!1)}return __extends(i,e),i.prototype.onFocusOUT=function(t){},i.prototype.onFocusIN=function(t){"#999999"==this._display.inputTxt.color&&(this._display.inputTxt.color="#4A2507",this._display.inputTxt.text="",this._noticeStr="")},i.prototype.facNameTxtChange=function(t){this._noticeStr=this._display.inputTxt.text},i.prototype.modifyNotice=function(){this.event("modify_fac_notice")},i.prototype.getNoticeStr=function(){return"#999999"==this._display.inputTxt.color?"":this._display.inputTxt.text},i.prototype.destroy=function(){this._display.queDingBtn.off(Laya.Event.CLICK,this,this.modifyNotice),this._noticeStr=null,this._display.inputTxt.off(Laya.Event.FOCUS,this,this.onFocusIN),this._display.inputTxt.off(Laya.Event.BLUR,this,this.onFocusOUT),this._display.inputTxt.off(Laya.Event.INPUT,this,this.facNameTxtChange),e.prototype.destroy.call(this)},i}(t.BaseBox);t.FactionNoticeBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.faction.faction.FactionPracticeUI,!0,!0),this._isPracticeBtnMouseDown=!1,this.m_djPath="assets/skeleton/faction/shengji.sk",this._display=this.skin,this.setCloseButton(this._display.back.closeBtn),this.name="FactionPracticeBox",this._display.nowTxt.style.fontSize=22,this._display.nowTxt.style.color="#7D5845",this._display.nowTxt.style.align="left",this._display.nowTxt.style.valign="top",this._display.nowTxt.style.bold=!0,this._display.nowTxt.style.fontFamily="黑体",this.list=new laya.ui.List,this.list.vScrollBarSkin="ui/comp/vscroll.png",this.list.scrollBar.visible=!1,this.list.renderHandler=Handler.create(this,this.updateItem,null,!1),this.list.selectEnable=!0,this.list.selectHandler=new Handler(this,this.onSelect),this.list.itemRender=i,this._display.addChild(this.list),this.list.x=587,this.list.y=182,this.list.repeatX=4,this.list.repeatY=4,this.list.spaceX=-4,this.list.spaceY=-4,this.list.array=[],this._display.practiceBtn.on(Laya.Event.MOUSE_DOWN,this,this.practiceBtnMouseDownHandler),this._display.practiceIcon.on(Laya.Event.CLICK,this,this.updateBtnClickHandler),s.selectIndex=1,t.XHR().Post({file:"petpk",cmd:"faction",op:"pratic_hall",uid:t.Global.UID},this,this.getPracticeInfoHandler),this._display.red_update.visible=this._display.red_practice.visible=!1}return __extends(s,e),s.prototype.getPracticeInfoHandler=function(e){if(0==e.result){this._practiceHallLv=e.hasOwnProperty("level")?e.level:1;var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF),n=t.FactionConfig.getPracticeHallConfig(this._practiceHallLv),a=this._practiceHallLv<t.FactionConfig.MAX_PRACTICE_LV&&i.facLv>=n.updateNeedBaseHallLv&&i.res_fanrong>=n.updateNeedFanrong&&i.res_wood>=n.updateNeedWood&&i.res_stone>=n.updateNeedStone&&i.res_iron>=n.updateNeedIron;this._display.red_update.visible=a,this._display.lvTxt.text=this._practiceHallLv+"级";var o=e.hasOwnProperty("total_power")?e.total_power:0;this._display.powerTxt.text=o+"",this._skillArr=e.skills,this.list.array=this._skillArr,this.nowSelect=s.selectIndex}else{var r=new t.ConfirmBoxData({isShowCancelBtn:!1,isShowXBtn:!1,contentStr:"查询失败，"+e.msg,callBackHandler:Handler.create(this,this.queryError)});t.ConfirmBox.show(r)}},s.prototype.queryError=function(){this.destroy()},s.prototype.onSelect=function(){this.nowSelect=this.list.selectedIndex+1,this.list.array=this.list.array},Object.defineProperty(s.prototype,"nowSelect",{set:function(e){s.selectIndex=e,this._display.iconPng.skin="ui/faction/factionPractice/icon"+e+".png";var i=this._skillArr[e-1];this._display.nameTxt.text=i.name,this._display.nowMsgTxt.text=0==i.level?"当前：尚未修炼":"当前："+i.effect,this._display.nowValueTxt.text=String(i.fightpower);i.hasOwnProperty("curmaxlevel")?i.curmaxlevel:i.maxlevel;if(i.level==i.maxlevel)this._display.nextMsgTxt.text="当前已是最高等级",this._display.nextValueTxt.text="满级",this._display.needTxt.text="",this._display.nowTxt.innerHTML="",this._display.corditionTxt.text="",this._display.red_practice.visible=!1,null==this._display.practiceBtn.filters&&(this._display.practiceBtn.filters=t.FiltersUtils.getGreyFilters());else if(i.level==i.curmaxlevel)this._display.nextMsgTxt.text="下级："+i.next_effect,this._display.nextValueTxt.text=i.next_fightpower,this._display.needTxt.text="",this._display.nowTxt.innerHTML="",this._display.corditionTxt.text="等级已达当前上限",this._display.red_practice.visible=!1,null==this._display.practiceBtn.filters&&(this._display.practiceBtn.filters=t.FiltersUtils.getGreyFilters());else{this._display.nextMsgTxt.text="下级："+i.next_effect,this._display.nextValueTxt.text=i.next_fightpower;var n=this._practiceHallLv>=i.level_require;if(n){this._display.practiceBtn.filters=null;var a=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);this._display.needTxt.text="消耗帮贡："+i.cost_contrib,a.selfFactionUserModel.banggong_now<i.cost_contrib?(this._display.nowTxt.innerHTML="当前帮贡：<font color='#FF0000'>"+a.selfFactionUserModel.banggong_now+"</font>",this._display.red_practice.visible=!1):(this._display.nowTxt.innerHTML="当前帮贡："+a.selfFactionUserModel.banggong_now,this._display.red_practice.visible=!0),this._display.corditionTxt.text=""}else this._display.nowTxt.innerHTML="",this._display.needTxt.text="",this._display.corditionTxt.text="修炼馆"+i.level_require+"级开启",this._display.red_practice.visible=!1,null==this._display.practiceBtn.filters&&(this._display.practiceBtn.filters=t.FiltersUtils.getGreyFilters())}},enumerable:!0,configurable:!0}),s.prototype.updateItem=function(t,e){e<=this.list.array.length-1&&t.doRender(this.list.array[e],e,this._practiceHallLv,this._skillArr[e].cost_contrib)},s.prototype.practiceBtnMouseDownHandler=function(){this._display.corditionTxt.visible&&""!=this._display.corditionTxt.text?t.WeakTips.show("修炼馆等级不足"):(this._isPracticeBtnMouseDown=!0,Laya.stage.on(Laya.Event.MOUSE_UP,this,this.mouseUpHandler),this.doSkill())},s.prototype.mouseUpHandler=function(){this._isPracticeBtnMouseDown=!1,Laya.timer.clear(this,this.doSkill),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.mouseUpHandler)},s.prototype.doSkill=function(){this._lastDoTime=Browser.now();var e=this._skillArr[s.selectIndex-1];if(e.level==e.maxlevel)t.Facade.callCommand(new t.ShowChangeRewardCmd(["当前已是最高等级"],200,"#ffec49"));else if(e.level==e.curmaxlevel)t.Facade.callCommand(new t.ShowChangeRewardCmd(["提升修炼馆等级后可继续升级"],200,"#ffec49"));else{var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);if(i.selfFactionUserModel.banggong_now<Number(e.cost_contrib))t.WeakTips.show("帮贡不足");else{var n=0==this._skillArr[s.selectIndex-1].level?"learn":"lvlupskill";t.XHR().Post({file:"petpk",cmd:"faction",op:"pratic_hall",type:n,skill_id:e.id,uid:t.Global.UID},this,this.doSkillHandler)}}},s.prototype.doSkillHandler=function(e){if(0==e.result){if(t.Facade.callCommand(new t.SyncChangeCmd(e)),this.getPracticeInfoHandler(e),this.loadAnim(),t.WeakTips.show("修炼技能成功！"),null==this._display.practiceBtn.filters&&this._isPracticeBtnMouseDown){var i=Browser.now(),s=i-this._lastDoTime;s>=200?(this._lastDoTime=i,this.doSkill()):Laya.timer.once(200-s,this,this.doSkill)}}else this._isPracticeBtnMouseDown=!1,t.WeakTips.show("修炼失败，"+e.msg)},s.prototype.updateBtnClickHandler=function(){t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);this._practiceHallLv>=t.FactionConfig.MAX_PRACTICE_LV?t.Facade.callCommand(new t.ShowChangeRewardCmd(["修炼馆当前已是最高等级"],200,"#ffec49")):t.Facade.callCommand(new t.OpenUpdateBoxCmd(t.FactionConfig.BUILDING_PRACTICE,{lv:this._practiceHallLv}))},s.prototype.refreshDataAfterUpdate=function(t){this.getPracticeInfoHandler(t)},s.prototype.loadAnim=function(){this.m_djSk?(this._display.addChild(this.m_djSk),this.m_djSk.play(0,!1,!0)):(this.m_djSk=new t.AnimationSKe(this.m_djPath),this.m_djSk.on(Laya.Event.STOPPED,this,this.moviePlayOver),this._display.addChild(this.m_djSk),this.m_djSk.x=415,this.m_djSk.y=624,this.m_djSk.play(0,!1))},s.prototype.moviePlayOver=function(){this.m_djSk.parent&&this.m_djSk.parent.removeChild(this.m_djSk)},s.prototype.destroy=function(){this.mouseUpHandler(),this.m_djSk&&(this.m_djSk.off(Laya.Event.STOPPED,this,this.moviePlayOver),this.m_djSk.destroy(),this.m_djSk=null),this.list&&(this.list.selectHandler=null,this.list.destroy(),this.list=null),Laya.loader.clearRes("assets/skeleton/faction/shengji.sk"),this._skillArr=null,this._display.practiceBtn.off(Laya.Event.MOUSE_DOWN,this,this.practiceBtnMouseDownHandler),this._display.practiceIcon.off(Laya.Event.CLICK,this,this.updateBtnClickHandler),e.prototype.destroy.call(this)},s}(t.BaseBox);t.FactionPracticeBox=e;var i=function(i){function s(){i.call(this),this.red.visible=!1}return __extends(s,i),s.prototype.doRender=function(i,s,n,a){this.iconPng.skin="ui/faction/factionPractice/icon"+(s+1)+".png",this._practiceHallLv=n;var o=i.hasOwnProperty("curmaxlevel")?i.curmaxlevel:i.maxlevel;if(this._practiceHallLv<i.level_require)this.selectPng.visible=!1,this.corditionTxt.text=""+i.level_require+"级开启",this.lvTxt.visible=!1,this.corditionTxt.visible=!0,this.needLvBg.visible=!0,this.red.visible=!1;else{this.lvTxt.visible=!0,this.corditionTxt.visible=!1,this.needLvBg.visible=!1,this.selectPng.visible=!0,0==i.level?this.lvTxt.text="未修炼":this.lvTxt.text=i.level+"/"+o;var r=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);this.red.visible=r.selfFactionUserModel.banggong_now>=a}i.level>=o&&(this.red.visible=!1),this.selectPng.visible=s+1==e.selectIndex},s}(ui.faction.faction.FactionPracticeItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.faction.faction.FactionSceneUI),this._moveSpeed=0,this._display=this.skin,this.cacheAs="none",this._display.mainLayer.cacheAs="bitmap",this._display.on(Laya.Event.MOUSE_DOWN,this,this.displayMouseDownHandler),this._display.on(Laya.Event.CLICK,this,this.displayClickHandler),this._display.leftBtn.on(Laya.Event.MOUSE_DOWN,this,this.leftBtnMouseDownHandler),this._display.rightBtn.on(Laya.Event.MOUSE_DOWN,this,this.rightBtnMouseDownHandler),this._display.showMemberBtn.visible=!1,this._display.mainLayer.mouseThrough=!0,this._display.bgBox.x=-490,this._list=new laya.ui.List,this._list.hScrollBarSkin="ui/comp/vscroll.png",this._list.scrollBar.visible=!1,this._list.itemRender=i,this._display.addChildAt(this._list,this._display.getChildIndex(this._display.mainLayer)),this._list.x=0,this._list.y=0,this._list.repeatX=1,this._list.repeatY=1,this._list.array=new Array(2),this._list.scrollBar.value=this._list.scrollBar.max*Math.abs(this._display.bgBox.x)/t.LayerMgr.width,this._list.scrollBar.on(Laya.Event.CHANGE,this,this.scrollBarChange),t.addListener(t.ViewEvent.BOX_HIDE,this,this.boxHideHandler),t.addListener(t.ViewEvent.BOX_SHOW,this,this.boxShowHandler),this._display.donatePng.visible=!1,this._display.holePng.visible=!1,this._display.warPng.visible=!1,this._display.warGrayPng.visible=!1,this._display.noticePng.visible=!1,this._display.hallPng.visible=!1,this._display.wushuPng.visible=!1,this._display.wushuGrayPng.visible=!1,this._display.practicePng.visible=!1,this.showScaleObj("hallPng"),this._display.flagLightIcon.visible=!1,this._display.tableLightIcon.visible=!1,this._display.noticeBox.visible=!1,this.hideAllRed(),this._display.owner.visible=this._display.viceOwner1.visible=this._display.viceOwner2.visible=!1,this._display.zhanglao1.visible=this._display.zhanglao2.visible=this._display.zhanglao3.visible=this._display.zhanglao4.visible=!1,this._display.viceOwnerUidTxt1.visible=this._display.viceOwnerUidTxt2.visible=!1,this._display.zhanglaoUidTxt1.visible=this._display.zhanglaoUidTxt2.visible=this._display.zhanglaoUidTxt3.visible=this._display.zhanglaoUidTxt4.visible=!1,this._display.backBtn.x-=t.Global.FLOAT_ICON_OFFSET}return __extends(s,e),s.prototype.hideAllRed=function(){this._display.red_baseHall.visible=!1,this._display.red_donation.visible=!1,this._display.red_hole.visible=!1,this._display.red_wuguan.visible=!1,this._display.red_war.visible=!1},s.prototype.showNoticePanel=function(){this._display.noticeBox.visible=!0,Laya.timer.once(4e3,this,this.hideNoticePanel)},s.prototype.hideNoticePanel=function(){this._display.noticeBox.visible=!1},s.prototype.boxHideHandler=function(){this.checkShowBg()},s.prototype.boxShowHandler=function(){this.checkShowBg()},s.prototype.checkShowBg=function(){0==t.BoxMgr.boxs.length||1==t.BoxMgr.boxs.length&&"FactionTalk"==t.BoxMgr.boxs[0].boxName?(this._display.bgGround.visible=!0,this._display.bgVagueGround.visible=!1):(this._display.bgGround.visible=!1,this._display.bgVagueGround.visible=!0)},s.prototype.scrollBarChange=function(){this._display.bgBox.x=-t.LayerMgr.width*this._list.scrollBar.value/this._list.scrollBar.max,0==this._display.bgBox.x?null==this._display.leftBtn.filters&&(this._display.leftBtn.filters=t.FiltersUtils.getGreyFilters()):null!=this._display.leftBtn.filters&&(this._display.leftBtn.filters=null),this._display.bgBox.x<=-this._list.scrollBar.max?null==this._display.rightBtn.filters&&(this._display.rightBtn.filters=t.FiltersUtils.getGreyFilters()):null!=this._display.rightBtn.filters&&(this._display.rightBtn.filters=null);
},s.prototype.displayMouseDownHandler=function(t){this._oriBgX=t.stageX,this._oriBgY=t.stageY},s.prototype.displayClickHandler=function(e){if(!this.destroyed&&t.FactionConfig.hasLoadConfig)if(e.target==this._display.backBtn)t.Facade.callCommand(new t.HomeCommand);else if(e.target!=this._display.leftBtn&&e.target!=this._display.rightBtn&&Math.sqrt((this._oriBgX-e.stageX)*(this._oriBgX-e.stageX)+(this._oriBgY-e.stageY)*(this._oriBgY-e.stageY))<=60)for(var i=e.stageX-this._display.bgBox.x-t.LayerMgr.offX,s=e.stageY-t.LayerMgr.offY,n=[{name:"donateClickPng",cmd:"OpenDonateBoxCmd",scaleObj:"donatePng"},{name:"noticeClickPng",cmd:"OpenFactionNotcieBoxCmd",scaleObj:"noticePng"},{name:"hallClickPng",cmd:"OpenBaseHallBoxCmd",scaleObj:"hallPng"},{name:"wushuClickPng",cmd:"EnterWuguanSceneCmd",scaleObj:"wushuPng"},{name:"practiceClickPng",cmd:"OpenFacPracticeBoxCmd",scaleObj:"practicePng"},{name:"totemClickPng",cmd:"OpenFactionTotemCmd",scaleObj:"flagLightIcon,tableLightIcon"},{name:"holeClickPng",cmd:"EnterFactionHoleCmd",scaleObj:"holePng"},{name:"warClickPng",cmd:"EnterFactionWarCmd",scaleObj:"warPng"}],a=n.length,o=0;a>o;o++){var r=n[o],h=r.name,l=this._display[h];if(i>=l.x&&i<=l.x+l.width&&s>=l.y&&s<=l.y+l.height){if("practiceClickPng"==h){if(t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF).facLv<t.FactionConfig.OPEN_PRACTICE_HALL_NEED_LV){t.Facade.callCommand(new t.ShowChangeRewardCmd(["帮派"+t.FactionConfig.OPEN_PRACTICE_HALL_NEED_LV+"级开启修炼馆"],200,"#ffec49"));break}}else if("wushuClickPng"==h&&t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF).facLv<t.FactionConfig.OPEN_WUGUAN_NEED_LV){t.Facade.callCommand(new t.ShowChangeRewardCmd(["帮派"+t.FactionConfig.OPEN_WUGUAN_NEED_LV+"级开启武馆"],200,"#ffec49"));break}this.showScaleObj(r.scaleObj);var c=t.JSUtils.StrToFuc("hf."+r.cmd);t.Facade.callCommand(new c);break}}},s.prototype.showScaleObj=function(t){if(this._nowSelectName!=t){if(this._nowSelectName)for(var e=this._nowSelectName.split(","),i=0;i<e.length;i++)this._display[e[i]]&&(this._display[e[i]].visible=!1);if(this._nowSelectName=t,this._nowSelectName)for(var e=this._nowSelectName.split(","),i=0;i<e.length;i++)this._display[e[i]]&&(this._display[e[i]].visible=!0)}},s.prototype.initData=function(){var e=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);e.on(t.ModelEvent.UPDATE_FINISH,this,this.facModelUpdateFinish),this.facModelUpdateFinish();t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);this.setSceneMember(),0==t.FactionConfig.hasLoadConfig&&t.XHR().Post({file:"petpk",cmd:"cfgout",subcmd:"get",type:"1|2|3|4|5",uid:t.Global.UID},this,this.getFactionConfigHandler);var i=t.Facade.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);0==i.getDailyDataValue(t.ServerSetDataModel.KEY_DAILY_ISFIRST_ENTER_FACTION)&&(i.setDailyDataValue(t.ServerSetDataModel.KEY_DAILY_ISFIRST_ENTER_FACTION,1),t.Facade.callCommand(new t.OpenFactionNotcieBoxCmd)),Laya.timer.loop(15e3,this,this.showNoticePanel),this.showNoticePanel()},s.prototype.getFactionConfigHandler=function(e){if(0==e.result)t.FactionConfig.setConfig(e),this.setTotem(),this.facModelUpdateFinish();else{var i=new t.ConfirmBoxData({isShowCancelBtn:!1,isShowXBtn:!1,contentStr:"拉取帮派配置失败，"+e.msg,callBackHandler:Handler.create(this,this.getFactionConfigError)});t.ConfirmBox.show(i)}},s.prototype.getFactionConfigError=function(){t.Facade.callCommand(new t.HomeCommand)},s.prototype.facModelUpdateFinish=function(){t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);this.setSceneMember();var e=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);if(this._display.facNameTxt.text=e.facName,this._display.noticeTxt.text=e.facNotice,this._display.noticeBg.height=92+this._display.noticeTxt.textHeight,this._display.wushuGrayPng.visible=e.facLv<t.FactionConfig.OPEN_WUGUAN_NEED_LV,t.FactionConfig.hasLoadConfig&&this.setTotem(),this.hideAllRed(),t.FactionConfig.hasLoadConfig){var i=e.selfFactionUserModel.isFirstDay();(-1!=e.reddotArr.indexOf(t.FactionReddotEnum.kFactionRedDotTypeFightCave)&&!i||-1!=e.reddotArr.indexOf(t.FactionReddotEnum.kFactionRedDotTypeReward))&&(this._display.red_hole.visible=!0);var s=-1!=e.reddotArr.indexOf(t.FactionReddotEnum.kFactionRedDotTypeDonation);s&&(this._display.red_donation.visible=!0);var n=e.selfFactionUserModel.position>=t.FactionConfig.settingPos&&-1!=e.reddotArr.indexOf(t.FactionReddotEnum.kFactionRedDotTypeApplicants),a=t.FactionConfig.getBaseHallConfig(e.facLv),o=e.facLv<t.FactionConfig.MAX_BASEHALL_LV&&e.res_fanrong>=a.updateNeedFanrong&&e.res_wood>=a.updateNeedWood&&e.res_stone>=a.updateNeedStone&&e.res_iron>=a.updateNeedIron;(n||s||o)&&(this._display.red_baseHall.visible=!0),e.facLv>=t.FactionConfig.OPEN_WUGUAN_NEED_LV&&(-1!=e.reddotArr.indexOf(t.FactionReddotEnum.kFactionRedDotTypeMClubUpgrade)||-1!=e.reddotArr.indexOf(t.FactionReddotEnum.kFactionRedDotTypeFightClub)&&!i)&&(this._display.red_wuguan.visible=!0)}},s.prototype.setTotem=function(){var e=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);this._display.picIcon.skin="ui/faction/factiontotem/picBig"+t.FactionConfig.getTotemIndexByID(3,e.totem_pic)+".png",this._display.flagIcon.skin="ui/faction/factiontotem/flagBig"+t.FactionConfig.getTotemIndexByID(1,e.totem_flag)+".png",this._display.flagLightIcon.skin="ui/faction/factiontotem/flagBigLight"+t.FactionConfig.getTotemIndexByID(1,e.totem_flag)+".png",this._display.tableIcon.skin="ui/faction/factiontotem/tableBig"+t.FactionConfig.getTotemIndexByID(2,e.totem_table)+".png",this._display.tableLightIcon.skin="ui/faction/factiontotem/tableBigLight"+t.FactionConfig.getTotemIndexByID(2,e.totem_table)+".png"},s.prototype.setSceneMember=function(){this._display.owner.visible=this._display.viceOwner1.visible=this._display.viceOwner2.visible=!1,this._display.zhanglao1.visible=this._display.zhanglao2.visible=this._display.zhanglao3.visible=this._display.zhanglao4.visible=!1;for(var e=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF),i=e.members.length,s=0,n=0,a=[1,2],o=[1,2,3,4],r=0;i>r;r++){var h=e.members[r],l=t.ServerClock.getServerDateByTime(1e3*h.login_time),c=t.ServerClock.getServerNowDate();if(h.pos>=t.FactionUserModel.POS_ZHANGLAO&&l.getFullYear()==c.getFullYear()&&l.getMonth()==c.getMonth()&&l.getDate()==c.getDate())if(h.pos==t.FactionUserModel.POS_OWNER)this._display.owner.visible=!0,this._display.ownerNameTxt.text=h.name,1==Number(h.sex)?(this._display.owner.getChildAt(0).visible=!0,this._display.owner.getChildAt(1).visible=!1):(this._display.owner.getChildAt(0).visible=!1,this._display.owner.getChildAt(1).visible=!0);else if(h.pos==t.FactionUserModel.POS_VICE_OWNER){if(s++,2>=s){for(var d=0,u=1;2>=u;u++)if(this._display["viceOwnerUidTxt"+u].text==String(h.uid)){d=u;break}if(0==d){var p=Math.floor(Math.random()*a.length);d=a[p]}a.splice(a.indexOf(d),1),this._display["viceOwner"+d].visible=!0,this._display["viceOwnerNameTxt"+d].text=h.name,this._display["viceOwnerUidTxt"+d].text=String(h.uid),1==Number(h.sex)?(this._display["viceOwner"+d].getChildAt(0).visible=!0,this._display["viceOwner"+d].getChildAt(1).visible=!1):(this._display["viceOwner"+d].getChildAt(0).visible=!1,this._display["viceOwner"+d].getChildAt(1).visible=!0)}}else if(n++,4>=n){for(var _=0,u=1;4>=u;u++)if(this._display["zhanglaoUidTxt"+u].text==String(h.uid)){_=u;break}if(0==_){var f=Math.floor(Math.random()*o.length);_=o[f]}o.splice(o.indexOf(_),1),this._display["zhanglao"+_].visible=!0,this._display["zhangLaoNameTxt"+_].text=h.name,this._display["zhanglaoUidTxt"+_].text=String(h.uid),1==Number(h.sex)?(this._display["zhanglao"+_].getChildAt(0).visible=!0,this._display["zhanglao"+_].getChildAt(1).visible=!1):(this._display["zhanglao"+_].getChildAt(0).visible=!1,this._display["zhanglao"+_].getChildAt(1).visible=!0)}}},s.prototype.leftBtnMouseDownHandler=function(){this.destroyed||(this._moveSpeed=-10,this.bgMove(),Laya.timer.loop(30,this,this.bgMove),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.stageMouseUpHandler))},s.prototype.rightBtnMouseDownHandler=function(){this.destroyed||(this._moveSpeed=10,this.bgMove(),Laya.timer.loop(30,this,this.bgMove),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.stageMouseUpHandler))},s.prototype.stageMouseUpHandler=function(){this._moveSpeed=0,Laya.stage.off(Laya.Event.MOUSE_UP,this,this.stageMouseUpHandler),Laya.timer.clear(this,this.bgMove)},s.prototype.bgMove=function(){if(!this.destroyed){var t=this._list.scrollBar.value;t+=this._moveSpeed,t>this._list.scrollBar.max?t=this._list.scrollBar.max:t<this._list.scrollBar.min&&(t=this._list.scrollBar.min),this._list.scrollBar.value=t}},s.prototype.reLoadBg=function(){this._display.sceneBg1_1.skin="",this._display.sceneBg1_1.skin="ui/faction/factionScene/factionBg_1_1.jpg",this._display.sceneBg1_2.skin="",this._display.sceneBg1_2.skin="ui/faction/factionScene/factionBg_1_2.jpg",this._display.sceneBg2_1.skin="",this._display.sceneBg2_1.skin="ui/faction/factionScene/factionBg_2_1.jpg",this._display.sceneBg2_2.skin="",this._display.sceneBg2_2.skin="ui/faction/factionScene/factionBg_2_2.jpg"},s.prototype.onShowed=function(){t.Facade.callCommand(new t.TalkCommand)},s.prototype.onHided=function(){t.Facade.callCommand(new t.TalkCloseCommand),this.destroy()},s.prototype.getSceneName=function(){return t.SceneDef.FACTION_SCENE},s.prototype.destroy=function(){Laya.timer.clear(this,this.showNoticePanel),Laya.timer.clear(this,this.hideNoticePanel),this._nowSelectName=null,t.removeListener(t.ViewEvent.BOX_HIDE,this,this.boxHideHandler),t.removeListener(t.ViewEvent.BOX_SHOW,this,this.boxShowHandler);var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);i.off(t.ModelEvent.UPDATE_FINISH,this,this.facModelUpdateFinish),this._list&&(this._list.scrollBar&&this._list.scrollBar.off(Laya.Event.CHANGE,this,this.scrollBarChange),this._list.destroy(),this._list=null),this._display.off(Laya.Event.MOUSE_DOWN,this,this.displayMouseDownHandler),this._display.off(Laya.Event.CLICK,this,this.displayClickHandler),this._display.leftBtn.off(Laya.Event.MOUSE_DOWN,this,this.leftBtnMouseDownHandler),this._display.rightBtn.off(Laya.Event.MOUSE_DOWN,this,this.rightBtnMouseDownHandler),this.stageMouseUpHandler(),e.prototype.destroy.call(this)},s}(t.BaseScene);t.FactionScene=e;var i=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e}(ui.faction.faction.FactionSceneItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.faction.faction.FactionTotemUI,!0,!0),this._display=this.skin,this.name="FactionTotemBox",this.setCloseButton(this._display.back.closeBtn),this._display.back.derocation_left.skin="ui/comp/rope_xia.png",this._display.back.derocation_left.x=125,s.numArr=[8,9,9],this._display.menuTab.selectedIndex=0,s.tabIndex=this._display.menuTab.selectedIndex,this._display.menuTab.selectHandler=new Handler(this,this.showTab);var n=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);this._flagIcon=t.FactionConfig.getTotemIndexByID(1,n.totem_flag),this._tableIcon=t.FactionConfig.getTotemIndexByID(2,n.totem_table),this._picIcon=t.FactionConfig.getTotemIndexByID(3,n.totem_pic),this._flagIndex=t.FactionConfig.getTotemIndexValueByID(1,n.totem_flag),this._tableIndex=t.FactionConfig.getTotemIndexValueByID(2,n.totem_table),this._picIndex=t.FactionConfig.getTotemIndexValueByID(3,n.totem_pic),this.nowSelect=this._flagIndex,this._display.flagIcon.skin="ui/faction/factiontotem/flagBig"+this._flagIcon+".png",this._display.tableIcon.skin="ui/faction/factiontotem/tableBig"+this._tableIcon+".png",this._display.picIcon.skin="ui/faction/factiontotem/picBig"+this._picIcon+".png",this.list=new laya.ui.List,this.list.vScrollBarSkin="ui/comp/vscroll.png",this.list.scrollBar.visible=!1,this.list.selectEnable=!0,this.list.selectHandler=new Handler(this,this.onSelect),this.list.renderHandler=Handler.create(this,this.updateItem,null,!1),this.list.itemRender=i,this._display.addChild(this.list),this.list.x=584,this.list.y=167,this.list.repeatX=4,this.list.repeatY=4,this.list.spaceX=-8,this.list.spaceY=-4,this.list.array=new Array(16),this._display.keepBtn.on(Laya.Event.CLICK,this,this.keepTotem);var a=new Sprite;a.graphics.drawRect(0,0,290,8,"#EBE0C4"),this._display.addChildAt(a,this._display.getChildIndex(this._display.tableIcon)),a.x=260,a.y=438}return __extends(s,e),s.prototype.onSelect=function(){if(this.list.selectedIndex+1<=s.numArr[this._display.menuTab.selectedIndex]){var e=t.FactionConfig.getTotemObj(s.tabIndex+1,this.list.selectedIndex),i=!0,n=0;if(Number(e.icon_id)>=100){i=!1;for(var a=Number(e.totem_id),o=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF),r=0;r<o.totemsArr.length;r++){var h=o.totemsArr[r];if(Number(h.id)==a){i=!0,n=Number(h.expire_time);break}}}if(i)if(0!=n)if(t.ServerClock.getServerTime()>=1e3*n)t.WeakTips.show("已过期");else{var l=n-Math.floor(t.ServerClock.getServerTime()/1e3),c="";l>=86400&&(c=Math.floor(l/86400)+"天",l%=86400);var d="0时";l>=3600&&(d=Math.floor(l/3600)+"时",l%=3600);var u="0分";l>=60&&(u=Math.floor(l/60)+"分",l%=60);var p=l+"秒";t.WeakTips.show("剩余时间："+c+d+u+p),this.nowSelect=this.list.selectedIndex+1,this.list.array=this.list.array}else e.needLv<=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF).facLv&&(this.nowSelect=this.list.selectedIndex+1,this.list.array=this.list.array)}},Object.defineProperty(s.prototype,"nowSelect",{set:function(e){s.selectIndex=e,0==this._display.menuTab.selectedIndex?(this._flagIndex=s.selectIndex,this._display.flagIcon.skin="ui/faction/factiontotem/flagBig"+t.FactionConfig.getTotemObj(1,this._flagIndex-1).icon_id+".png"):1==this._display.menuTab.selectedIndex?(this._tableIndex=s.selectIndex,this._display.tableIcon.skin="ui/faction/factiontotem/tableBig"+t.FactionConfig.getTotemObj(2,this._tableIndex-1).icon_id+".png"):(this._picIndex=s.selectIndex,this._display.picIcon.skin="ui/faction/factiontotem/picBig"+t.FactionConfig.getTotemObj(3,this._picIndex-1).icon_id+".png")},enumerable:!0,configurable:!0}),s.prototype.updateItem=function(e,i){i<=this.list.array.length-1&&e.doRender(t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF).facLv,this.list.array[i],i)},s.prototype.showTab=function(){s.tabIndex=this._display.menuTab.selectedIndex,s.selectIndex=0==s.tabIndex?this._flagIndex:1==s.tabIndex?this._tableIndex:this._picIndex,this._display.nameTxt.text=0==s.tabIndex?"旗  帜":1==s.tabIndex?"图  案":"配  饰",this.list.selectedIndex=s.selectIndex-1,this.list.array=this.list.array},s.prototype.keepTotem=function(){if(t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF).selfFactionUserModel.position<t.FactionConfig.settingPos)t.Facade.callCommand(new t.ShowChangeRewardCmd(["仅"+t.FactionConfig.settingName+"以上能保存图案"],200,"#ffec49"));else{var e=t.FactionConfig.getTotemObj(1,this._flagIndex-1),i=t.FactionConfig.getTotemObj(2,this._tableIndex-1),s=t.FactionConfig.getTotemObj(3,this._picIndex-1);t.XHR().Post({file:"petpk",cmd:"faction",op:"totem",banner:e.totem_id,pattern:i.totem_id,accessories:s.totem_id,uid:t.Global.UID},this,this.keepTotemHandler)}},s.prototype.keepTotemHandler=function(e){if(0==e.result){var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);i.totem_flag=t.FactionConfig.getTotemObj(1,this._flagIndex-1).totem_id,i.totem_table=t.FactionConfig.getTotemObj(2,this._tableIndex-1).totem_id,i.totem_pic=t.FactionConfig.getTotemObj(3,this._picIndex-1).totem_id,i.updateFinish(),this.destroy(),t.Facade.callCommand(new t.ShowChangeRewardCmd(["保存图案成功！"],200,"#ffec49"))}else t.WeakTips.show("保存图案失败，"+e.msg)},s.prototype.destroy=function(){s.numArr=null,this._display.keepBtn.off(Laya.Event.CLICK,this,this.keepTotem),this._display.menuTab.selectHandler=null,this.list&&(this.list.selectHandler=null,this.list.destroy(),this.list=null),e.prototype.destroy.call(this)},s}(t.BaseBox);t.FactionTotemBox=e;var i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.doRender=function(i,s,n){var a=e.numArr[e.tabIndex];if(a>=n+1){var o=!0,r=t.FactionConfig.getTotemObj(e.tabIndex+1,n);if(Number(r.icon_id)>=100){o=!1;for(var h=Number(r.totem_id),l=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF),c=0;c<l.totemsArr.length;c++){var s=l.totemsArr[c];if(Number(s.id)==h){o=!0;break}}}if(o){r.needLv<=i?(this.selectPng.visible=n+1==e.selectIndex,this.needHallLvBg.visible=!1,this.needHallLvTxt.text=""):(this.selectPng.visible=!1,this.needHallLvBg.visible=!0,this.needHallLvTxt.text="聚义厅"+r.needLv+"级");var d=0==e.tabIndex?"flagSmall":1==e.tabIndex?"tableSmall":"picSmall";this.icon.skin="ui/faction/factiontotem/"+d+r.icon_id+".png",this.suoPng.visible=!1}else this.needHallLvBg.visible=!1,this.needHallLvTxt.text="",this.selectPng.visible=!1,this.icon.skin="",this.suoPng.visible=!0}else this.needHallLvBg.visible=!1,this.needHallLvTxt.text="",this.selectPng.visible=!1,this.icon.skin="",this.suoPng.visible=!0},s}(ui.faction.faction.FactionTotemItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i,s,n,a){e.call(this,new ui.faction.faction.factionWar.FactionWarBetBoxUI,!0,!0),this._display=this.skin,this.setCloseButton(this._display.boxClose),this.name="FactionWarBetBox",this._facID=Number(i.id),this._faction=i,this._isOver=n,n?this._display.betBtn.filters=t.FiltersUtils.getGreyFilters():this._facID==s&&(this._display.betBtn.label="已支持",this._display.betBtn.filters=t.FiltersUtils.getGreyFilters()),this._display.replayBtn.on(Laya.Event.CLICK,this,this.replayBtnClickhandler),this._display.betBtn.on(Laya.Event.CLICK,this,this.betBtnClickhandler),this._display.iconPng.skin="ui/faction/factionScene/facIcon"+i.totem[3]+".png",this._display.facNameTxt.text=i.name,this._display.idTxt.text="编号："+i.id,this._display.championCountTxt.text="冠军次数："+i.champion_times,this._display.facOwnerNameTxt.text="帮主："+i.wang_name,this._display.strengTxt.text=""+i.power;var o=0==a?0:t.MathUtils.getDotNum(100*Number(i.betting_times)/a,2);this._display.betTxt.text="支持率："+(0==o?"0%":o+"%")}return __extends(i,e),i.prototype.replayBtnClickhandler=function(){this.event("SHOW_SELF_FAC_INFO",{facID:this._facID,history:!1}),this.destroy()},i.prototype.betBtnClickhandler=function(){null==this._display.betBtn.filters?1==Number(this._faction.dismissed)?t.WeakTips.show("该帮派已解散"):t.XHR().Post({file:"petpk",cmd:"faction",op:"challenge_betting",fid:this._facID,uid:t.Global.UID},this,this.bettingHandler):this._isOver&&t.WeakTips.show("当前不在押注时间段")},i.prototype.bettingHandler=function(e){0==e.result?(t.WeakTips.show("支持成功！"),this._faction.betting_times=Number(this._faction.betting_times)+1,this.event("BET_SUCCESS",{facID:this._facID})):t.WeakTips.show("支持失败，"+e.msg)},i.prototype.destroy=function(){this._faction=null,this._display.replayBtn.off(Laya.Event.CLICK,this,this.replayBtnClickhandler),this._display.betBtn.off(Laya.Event.CLICK,this,this.betBtnClickhandler),e.prototype.destroy.call(this)},i}(t.BaseBox);t.FactionWarBetBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,new ui.faction.faction.factionWar.FactionWarReplayBoxUI,!1,!0),this._display=this.skin,this.canClickModelToClose=!1,this.name="FactionWarBetBox",this.setCloseButton(this._display.closeBtn),this._display.panel.vScrollBarSkin="ui/comp/vscroll.png",this._display.panel.vScrollBar.showButtons=!1,this._display.panel.height=462,this._display.leftFacNameTxt.text=t.leftFacName,this._display.rightFacNameTxt.text=t.rightFacName;for(var i=t.leftMembers,s=t.rightMembers.concat(),n=0,a=s[0],o=t.leftReplay,r=o.length,h=0,l=0,c=0;r>c;c++){var d=o[c],u=i[c].name,p=Number(d.win_times),_=Number(d.lose_times),f=p+_,y=new ui.faction.faction.factionWar.FactionWarReplayItemUI;y.bg1.visible=c%2==0,y.bg2.visible=c%2!=0,y.bg1.height=y.bg2.height=54*f,y.height=y.bg1.height,y.bg1.mouseEnabled=y.bg2.mouseEnabled=!0,y.lineShu1.height=y.lineShu2.height=y.lineShu3.height=54*f;var m=y.leftPlayerNameTxt.y;y.leftPlayerNameTxt.text=u,y.leftPlayerNameTxt.y=y.leftPlayerNameTxt.y+27*(f-1),y.lineHeng1.visible=f>=2,y.lineHeng1.y=54,y.lineHeng2.visible=f>=3,y.lineHeng2.y=108,y.rightPlayerNameTxt1.y=m,y.rightPlayerNameTxt2.visible=f>=2,y.rightPlayerNameTxt2.y=y.rightPlayerNameTxt1.y+54,y.rightPlayerNameTxt3.visible=f>=3,y.rightPlayerNameTxt3.y=y.rightPlayerNameTxt1.y+108;var g=y.watchBox.y;y.watchPng.visible=f>=2,y.watchBox.y=1==f?g:2==f?6:32,y.watchPng.dataSource=d.replay,y.watchBg.dataSource=d.replay,y.watchPng.on(Laya.Event.CLICK,this,this.watchReplayClick),y.watchBg.on(Laya.Event.CLICK,this,this.watchReplayClick),this._display.panel.addChild(y),y.y=h+(0==l?0:l+4),h=y.y,l=y.bg1.height;for(var v=1;f>=v;v++){var C=new ui.faction.faction.factionWar.FactionWarReplayOnceItemUI;C.leftLose.visible=C.leftWin1.visible=C.leftWin2.visible=C.leftWin3.visible=!1,C.rightLose.visible=C.rightWin1.visible=C.rightWin2.visible=C.rightWin3.visible=!1,y.addChild(C),C.x=233,C.y=54*(v-1),y["rightPlayerNameTxt"+v].text=a.name,f>v||0==_?(n=0,s.shift(),a=s[0],C["leftWin"+v].visible=!0,C.rightLose.visible=!0):(C.leftLose.visible=!0,n++,C["rightWin"+n].visible=!0,3==n&&(n=0,s.shift(),a=s[0]))}}}return __extends(i,e),i.prototype.watchReplayClick=function(e){var i=e.target.dataSource;t.Facade.callCommand(new t.FightReplayCommand(i))},i.prototype.destroy=function(){for(;this._display.panel.numChildren>0;){var t=this._display.panel.removeChildAt(0);t.watchPng.dataSource=null,t.watchBg.dataSource=null,t.watchPng.off(Laya.Event.CLICK,this,this.watchReplayClick),t.watchBg.off(Laya.Event.CLICK,this,this.watchReplayClick)}e.prototype.destroy.call(this)},i}(t.BaseBox);t.FactionWarReplayBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.faction.faction.factionWar.FactionWarSceneUI),this._fightingRound=0,this._bettingRound=0,this.moviePath_reward="assets/skeleton/faction/factionHole/effect_bpbx.sk",this.joinNeed=0,this._nowReplayRound=-1,this._maxReplayRound=-1,this._totalRound=-1,this._nowReplayFacID=0,this._hasAddTotem=!1,this.isShowReward=!1,this._figureStep=1,this._display=this.skin,this.setCloseButton(this._display.backBtn),this.cacheAs="none",this._display.bgLayer.cacheAs="bitmap",this._display.mainLayer.cacheAs="bitmap",this.canClickModelToClose=!1,this.name="FactionWarSceneBox",this._leftMemberList=new laya.ui.List,this._leftMemberList.vScrollBarSkin="ui/comp/vscroll.png",this._leftMemberList.scrollBar.visible=!1,this._leftMemberList.renderHandler=Handler.create(this,this.updateLeftItem,null,!1),this._leftMemberList.itemRender=i,this._display.leftBox.addChildAt(this._leftMemberList,this._display.leftBox.getChildIndex(this._display.leftKuang)),this._leftMemberList.x=10,this._leftMemberList.y=95,this._leftMemberList.repeatX=1,this._leftMemberList.repeatY=5,this._leftMemberList.spaceX=0,this._leftMemberList.spaceY=-4,this._leftMemberList.height=498,this._rightMemberList=new laya.ui.List,this._rightMemberList.vScrollBarSkin="ui/comp/vscroll.png",this._rightMemberList.scrollBar.visible=!1,this._rightMemberList.renderHandler=Handler.create(this,this.updateRightItem,null,!1),this._rightMemberList.itemRender=i,this._display.rightBox.addChildAt(this._rightMemberList,this._display.rightBox.getChildIndex(this._display.rightKuang)),this._rightMemberList.x=10,this._rightMemberList.y=95,this._rightMemberList.repeatX=1,this._rightMemberList.repeatY=5,this._rightMemberList.spaceX=0,this._rightMemberList.spaceY=-4,this._rightMemberList.height=498,this._display.joinBtn.on(Laya.Event.CLICK,this,this.joinFactionWar),this._display.championBtn.on(Laya.Event.CLICK,this,this.showChamion),this._display.ruleImage.on(Laya.Event.CLICK,this,this.showRule),this._display.leftBtn.on(Laya.Event.CLICK,this,this.leftBtnClickHandler),this._display.rightBtn.on(Laya.Event.CLICK,this,this.rightBtnClickHandler),this._display.selfFacInfoBtn.on(Laya.Event.CLICK,this,this.selfFacBtnClickHandler);var s=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);this._display.red_join.visible=s.facLv>=2&&s.selfFactionUserModel.position>=t.FactionUserModel.POS_VICE_OWNER,this._nowFacID=s.facID,s.on(t.ModelEvent.UPDATE_FINISH,this,this.factionUpdateFinish),this._initFigureDownY=this._display.figureDown.y,this.skeleton_reward_bg=new t.AnimationSKe(this.moviePath_reward,1),this._display.movieContainer.addChild(this.skeleton_reward_bg),this.skeleton_reward_bg.x=this._display.rewardBox.x+100,this.skeleton_reward_bg.y=this._display.rewardBox.y+100,this.skeleton_reward_bg.play(1,!0),this.skeleton_reward=new t.AnimationSKe(this.moviePath_reward),this.skeleton_reward.scaleX=this.skeleton_reward.scaleY=1.5,this._display.movieContainer.addChild(this.skeleton_reward),this.skeleton_reward.x=this._display.rewardBox.x+100,this.skeleton_reward.y=this._display.rewardBox.y+100,this.skeleton_reward.play(0,!1),this.skeleton_reward.index=1,this.skeleton_reward.on(Laya.Event.STOPPED,this,this.rewardMoviePlayOver),this._display.getRewardBtn.on(Laya.Event.CLICK,this,this.getRewardClickHandler),this._display.getRewardBtn.alpha=0,this.setRewardBoxVisible(!1),this._display.replayBtn.visible=!1,this._display.replayBtn.on(Laya.Event.CLICK,this,this.replayBtnClickHandler),this.showTitle(1),this._display.needFanrongTxt.style.fontSize=26,this._display.needFanrongTxt.style.color="#FFFF00",this._display.needFanrongTxt.style.align="center",this._display.needFanrongTxt.style.valign="top",this._display.needFanrongTxt.style.fontFamily="黑体",this._display.needFanrongTxt.style.bold=!0,this._display.needFanrongTxt.style.stroke=4,this._display.needFanrongTxt.style.strokeColor="#000000",this._display.backBtn.x-=t.Global.FLOAT_ICON_OFFSET}return __extends(s,e),s.prototype.updateLeftItem=function(t,e){e<=this._leftMemberList.array.length-1&&t.doRender(this._leftMemberList.array[e],e)},s.prototype.updateRightItem=function(t,e){e<=this._rightMemberList.array.length-1&&t.doRender(this._rightMemberList.array[e],e)},s.prototype.setData=function(e,i,n,a){if(void 0===n&&(n=!0),void 0===a&&(a=!1),this._isHistory=a,e){var o=e.challenge;if(o.hasOwnProperty("group_num")&&(s.groupNum=Number(o.group_num)>4?4:Number(o.group_num)<1?1:Number(o.group_num)),0==a&&o.hasOwnProperty("signup_group")&&(s.groupSelf=Number(o.signup_group)),o.hasOwnProperty("signup_cost")){this.joinNeed=Number(o.signup_cost);var r=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF).res_fanrong;r<this.joinNeed?this._display.needFanrongTxt.innerHTML="消耗繁荣度:"+this.joinNeed+"(当前:<font color='#FF0000'>"+r+"</font>)":this._display.needFanrongTxt.innerHTML="消耗繁荣度:"+this.joinNeed+"(当前:"+r+")"}if(this._totalRound=-1,o.hasOwnProperty("max_round")&&(this._totalRound=Number(o.max_round)),this._fightingRound=0,o.hasOwnProperty("fighting_round")&&(this._fightingRound=Number(o.fighting_round)),this._bettingRound=0,o.hasOwnProperty("betting_round")&&(this._bettingRound=Number(o.betting_round),this._bettingRound>4&&(this._bettingRound=0)),this.checkShowReward(),0!=i)if(Number(o.max_round)-Number(o.cur_round)>3&&!a)this.noRoundReplay(o,a),t.WeakTips.show("海选赛正在进行中...");else if(this._display.joinBox.visible=!1,this._nowReplayFacID=i,o.hasOwnProperty("rounds")&&o.rounds.length>0){var h=o.rounds[0];n&&(this._maxReplayRound=Number(h.id)),this.nowReplayRound=Number(h.id);var l=h.arenas[0],c=l.faction_1,d=l.faction_2,u=c&&c.hasOwnProperty("id")&&Number(c.id)==this._nowReplayFacID?c:d;if(1==Number(u.dismissed))t.WeakTips.show("该帮已解散，无相应战报查看！");else if(u.fighters&&0!=u.fighters.length){var p=c?Number(c.id):0,_=d?Number(d.id):0,f=0!=p&&Number(l.winner)==p,y=0!=_&&Number(l.winner)==_;this._display.replayBtn.visible=(f||y)&&0!=p&&0!=_,c&&c.hasOwnProperty("id")&&Number(c.id)==this._nowReplayFacID?this.setList(c,l.left_replay,f,y,d,l.right_replay,y,f):this.setList(d,l.right_replay,y,f,c,l.left_replay,f,y),this.showTitle(3),this._display.leftBox.visible=this._display.rightBox.visible=!0}else t.WeakTips.show("无成员参战，无相应战报查看！")}else this.noRoundReplay(o,a),t.WeakTips.show("很遗憾，您的帮派未报名参加该届帮派争霸！");else this.noRoundReplay(o,a)}else this._display.leftBox.visible=this._display.rightBox.visible=!1,this._display.joinBox.visible=!1;if(!this._hasAddTotem){this._hasAddTotem=!0;for(var m=null,g=1;g<=s.groupNum;g++){var v=new laya.ui.Image("ui/faction/factionWar/totem.png");this._display.imageBox.addChild(v),v.x=m?m.x+m.width+20:0,m=v;var C=new laya.ui.Image("ui/faction/factionWar/groupPng"+g+".png");this._display.imageBox.addChild(C),C.x=v.x+110,C.y=250}this._display.imageBox.x=(t.LayerMgr.width-this._display.imageBox.width)/2}},s.prototype.noRoundReplay=function(e,i){if(this._display.leftBox.visible=this._display.rightBox.visible=!1,i)this._display.joinBox.visible=!1;else{this._hasJoin=e&&e.hasOwnProperty("rounds")&&e.rounds.length>0;var n=t.ServerClock.getServerNowDate().getDay();n>=1&&n<=s.FIGHT_DAY-1&&!this._hasJoin?this._display.joinBox.visible=!0:this._display.joinBox.visible=!1}this.showTitle(1)},Object.defineProperty(s.prototype,"nowReplayRound",{set:function(e){this._nowReplayRound=e,this._nowReplayRound==this._maxReplayRound?null==this._display.rightBtn.filters&&(this._display.rightBtn.filters=t.FiltersUtils.getGreyFilters()):null!=this._display.rightBtn.filters&&(this._display.rightBtn.filters=null),0==this._nowReplayRound?null==this._display.leftBtn.filters&&(this._display.leftBtn.filters=t.FiltersUtils.getGreyFilters()):null!=this._display.leftBtn.filters&&(this._display.leftBtn.filters=null)},enumerable:!0,configurable:!0}),s.prototype.setList=function(e,i,s,n,a,o,r,h){if(this._display.leftWinTitlePng.visible=s,this._display.leftLoseTitlePng.visible=n,this._display.leftWinPng.visible=!n,this._display.leftLosePng.visible=n,this._display.rightWinTitlePng.visible=r,this._display.rightLoseTitlePng.visible=h,this._display.rightWinPng.visible=!h,this._display.rightLosePng.visible=h,e&&Number(e.id)>0){this._leftMembers=e.fighters,this._leftReplay=i,this._leftFacName=e.name;var l=1==Number(e.dismissed)?"（已解散）":"";this._display.leftNameTxt.text="帮派名称："+e.name+"（"+e.level+"级）"+l;for(var c=0,d=e.fighters.length,u=0;d>u;u++)c+=Number(e.fighters[u].power);if(this._display.leftCountTxt.text="参战人数："+d+"/"+t.FactionConfig.getBaseHallConfig(Number(e.level)).maxMember,this._display.leftPowerTxt.text="总战力："+c,i)for(var u=0;u<i.length;u++){var p=i[u],_=e.hasOwnProperty("fighters")?e.fighters[u]:null;_&&(_.replayID=p.replay,_.winCount=p.win_times,_.loseCount=p.lose_times)}this._leftMemberList.array=e.fighters}else this._leftMembers=null,this._leftReplay=null,this._leftFacName=null,this._display.leftNameTxt.text="",this._display.leftCountTxt.text="",this._display.leftPowerTxt.text="",this._leftMemberList.array=[],this._display.leftWinTitlePng.visible=!1,this._display.leftLoseTitlePng.visible=!1,this._display.leftWinPng.visible=!0,this._display.leftLosePng.visible=!1;if(0==this._leftMemberList.array.length,a&&Number(a.id)>0){this._rightMembers=a.fighters,this._rightReplay=o,this._rightFacName=a.name;var f=1==Number(a.dismissed)?"（已解散）":"";this._display.rightNameTxt.text="帮派名称："+a.name+"（"+a.level+"级）"+f;for(var y=0,m=a.fighters.length,u=0;m>u;u++)y+=Number(a.fighters[u].power);if(this._display.rightCountTxt.text="参战人数："+m+"/"+t.FactionConfig.getBaseHallConfig(Number(a.level)).maxMember,this._display.rightPowerTxt.text="总战力："+y,o)for(var u=0;u<o.length;u++){var g=o[u],v=a.hasOwnProperty("fighters")?a.fighters[u]:null;v&&(v.replayID=g.replay,v.winCount=g.win_times,v.loseCount=g.lose_times)}this._rightMemberList.array=a.fighters}else this._rightMembers=null,this._rightReplay=null,this._rightFacName=null,
this._display.rightNameTxt.text="",this._display.rightCountTxt.text="",this._display.rightPowerTxt.text="",this._rightMemberList.array=[],this._display.rightWinTitlePng.visible=!1,this._display.rightLoseTitlePng.visible=!1,this._display.rightWinPng.visible=!0,this._display.rightLosePng.visible=!1;0==this._rightMemberList.array.length},s.prototype.joinFactionWar=function(){var e=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);e.selfFactionUserModel.position<t.FactionConfig.updateBuildingPos?t.WeakTips.show("仅"+t.FactionConfig.updateBuildingName+"以上能报名"):e.facLv<t.FactionConfig.OPEN_WAR_NEED_LV?t.WeakTips.show("帮派"+t.FactionConfig.OPEN_WAR_NEED_LV+"级开启帮战"):e.res_fanrong<this.joinNeed?t.WeakTips.show("帮派繁荣度不足"):t.XHR().Post({file:"petpk",cmd:"faction",op:"challenge_sigup",uid:t.Global.UID},this,this.joinFactionWarHandler)},s.prototype.joinFactionWarHandler=function(e){if(0==e.result){var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);i.res_fanrong-=this.joinNeed,i.updateFinish(),this._display.joinBox.visible=!1,t.WeakTips.show("加入争霸战成功！"),this.event("GET_WAR_DATA")}else t.WeakTips.show("加入争霸战失败，"+e.msg)},s.prototype.showOrHideFightList=function(e,i){if(void 0===i&&(i=!1),this._display.joinBox.visible)this._display.leftBox.visible=this._display.rightBox.visible=!1;else if(i)this._display.leftBox.visible=this._display.rightBox.visible=!0;else if(e){var n=t.ServerClock.getServerNowDate().getDay();0==n||n>=s.FIGHT_DAY?this._display.leftBox.visible=this._display.rightBox.visible=!0:this._display.leftBox.visible=this._display.rightBox.visible=!1}else this._display.leftBox.visible=this._display.rightBox.visible=!1},s.prototype.showOrHideChampionBtn=function(t){this._display.championBtn.visible=t},s.prototype.showTitle=function(t){if(this._display.title_main.visible=1==t,console.log(),this._display.title_rank.visible=3==t,3==t)if(this._nowReplayRound>=this._totalRound-2)this._display.title_final.visible=!0,this._display.title_qiang.visible=!1,this._display.banPng.visible=this._nowReplayRound==this._totalRound-2,this._display.zongPng.visible=this._nowReplayRound==this._totalRound-1;else{this._display.title_final.visible=!1,this._display.title_qiang.visible=!0;for(var e=String(Math.pow(2,this._totalRound-this._nowReplayRound)),i=e.length,s=0;i>s;s++){var n=e.charAt(s);this._display["num"+(s+1)].visible=!0,this._display["num"+(s+1)].skin="ui/faction/factionWar/front_"+n+".png",s==i-1&&(this._display.numQiang.x=this._display["num"+(s+1)].x+30)}if(6>i)for(var s=i+1;6>=s;s++)this._display["num"+s].visible=!1;this._display.title_qiang.x=5+14*(6-i)}},s.prototype.showChamion=function(){t.ServerClock.getServerNowDate().getDay();this.event("SHOW_CHAMPION")},s.prototype.leftBtnClickHandler=function(){if(null==this._display.leftBtn.filters){this.nowReplayRound=this._nowReplayRound-1;var e={file:"petpk",cmd:"faction",op:"challenge_query",fid:this._nowReplayFacID,group:-1,round:this._nowReplayRound,uid:t.Global.UID};this._isHistory&&(e.history=1),t.XHR().Post(e,this,this.getFactionRoundHandler)}},s.prototype.rightBtnClickHandler=function(){if(null==this._display.rightBtn.filters){this.nowReplayRound=this._nowReplayRound+1;var e={file:"petpk",cmd:"faction",op:"challenge_query",fid:this._nowReplayFacID,group:-1,round:this._nowReplayRound,uid:t.Global.UID};this._isHistory&&(e.history=1),t.XHR().Post(e,this,this.getFactionRoundHandler)}},s.prototype.getFactionRoundHandler=function(e){0==e.result?this.setData(e,this._nowReplayFacID,!1,this._isHistory):t.WeakTips.show("查询录像信息失败，"+e.msg)},s.prototype.showRule=function(){var e="";e+="<img src='ui/comp/icon.png'></img> 1. 每周一0点到周四24点，帮主和副帮主可报名本帮参赛；<br>",e+="<img src='ui/comp/icon.png'></img> 2. 本帮参赛后，所有帮众可选择参战并进行鼓舞；<br>",e+="<img src='ui/comp/icon.png'></img> 3. 【战斗规则】参战成员按战力从高到低进行战斗，最后胜利的帮派获胜，每人最多可连胜3场；<br>",e+="<img src='ui/comp/icon.png'></img> 4. 【奖励规则】所有参战成员均可获得帮贡和密卷强化材料，本帮战绩越好，则奖励数量越高，参战成员等级越高，帮贡数量也越高；<br>",e+="<img src='ui/comp/icon.png'></img> 5. 【特殊奖励】冠军帮派可获得冠军图腾奖励（含旗帜、图腾和配饰），持续1周可选择使用该图腾作为本帮图腾；<br>",e+="<img src='ui/comp/icon.png'></img> 6. 周五凌晨1点开始海选赛，系统匹配参赛帮派进行战斗，直到决出八强；<br>",e+="<img src='ui/comp/icon.png'></img> 7. 周日凌晨1点开始冠军赛，按照匹配八强帮派进行战斗；<br>",e+="<img src='ui/comp/icon.png'></img> 8. 支持冠军：八强帮派诞生后，所有玩家可选择支持相应的帮派，根据该帮派在总决赛中的战绩，可获得相应数量的密卷强化材料，参与即可获奖。",t.RulePanel.showRule(e,"")},s.prototype.factionUpdateFinish=function(){var e=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);if(0==this._nowFacID&&e.facID>0){var i=t.ServerClock.getServerNowDate().getDay();i>=1&&i<=s.FIGHT_DAY-1&&(this._display.joinBox.visible=!0)}this._nowFacID=e.facID},s.prototype.getRewardClickHandler=function(){this.skeleton_reward.resLoaded&&(0!=this._fightingRound?t.XHR().Post({file:"petpk",cmd:"faction",op:"challenge_reward",uid:t.Global.UID},this,this.getRewardHandler):0!=this._bettingRound&&t.XHR().Post({file:"petpk",cmd:"faction",op:"challenge_reward",betting:1,uid:t.Global.UID},this,this.getRewardHandler))},s.prototype.getRewardHandler=function(e){0==e.result?this.destroyed?this.alertToShowRankReward(e):(this._getRewardData=e,this._display.getRewardBtn.visible=!1,this._display.figureDown.visible=!1,this.skeleton_reward.play(0,!1)):t.WeakTips.show("领取奖励失败，"+e.msg)},s.prototype.rewardMoviePlayOver=function(){this._getRewardData&&(this.alertToShowRankReward(this._getRewardData),this._getRewardData=null)},s.prototype.alertToShowRankReward=function(e){if(0!=this._fightingRound){var i;i=1==this._fightingRound?"获得冠军":2==this._fightingRound?"获得亚军":"晋级"+(Math.pow(2,this._fightingRound-1)+"强"),this._getRewardData.hasOwnProperty("stone")&&0!=this._getRewardData.stone&&t.SyncExecuter.constructObj(this._getRewardData,"kStone",this._getRewardData.stone,0),this._getRewardData.hasOwnProperty("wood")&&0!=this._getRewardData.wood&&t.SyncExecuter.constructObj(this._getRewardData,"kWood",this._getRewardData.wood,0),this._getRewardData.hasOwnProperty("iron_ore")&&0!=this._getRewardData.iron_ore&&t.SyncExecuter.constructObj(this._getRewardData,"kIronOre",this._getRewardData.iron_ore,0),t.Facade.callCommand(new t.SyncChangeCmd(this._getRewardData,!1,!0,"恭喜本帮"+i+"，参战获得奖励："))}else{var i;i=1==this._bettingRound?"获得冠军":2==this._bettingRound?"获得亚军":"晋级"+(Math.pow(2,this._bettingRound-1)+"强"),t.Facade.callCommand(new t.SyncChangeCmd(this._getRewardData,!1,!0,"您支持的帮派"+i+"，您获得奖励："))}t.addListener(t.ViewEvent.BOX_HIDE,this,this.confirmBoxClickHandler),0!=this._fightingRound?this._fightingRound=0:0!=this._bettingRound&&(this._bettingRound=0)},s.prototype.confirmBoxClickHandler=function(){t.removeListener(t.ViewEvent.BOX_HIDE,this,this.confirmBoxClickHandler),this.checkShowReward()},s.prototype.checkShowReward=function(){0!=this._fightingRound||0!=this._bettingRound?this.setRewardBoxVisible(!0):this.setRewardBoxVisible(!1)},s.prototype.setRewardBoxVisible=function(t){this.isShowReward=t,this._display.rewardBox.visible=t,this.skeleton_reward.visible=t,this.skeleton_reward_bg.visible=t,this.event("SHOW_OR_HIDE_REWARD",t),t?(this.newBgModel(),this._display.rewardBox.addChildAt(this._bgModel,0),this._display.figureDown.visible=!0,this._display.movieContainer.setChildIndex(this._display.figureDown,this._display.movieContainer.numChildren-1),this._bgModel.x=-this._display.rewardBox.x,this._bgModel.y=-this._display.rewardBox.y,this.skeleton_reward.play(0,!1),this.skeleton_reward.index=1,Laya.timer.loop(30,this,this.setFigureDown),this._display.getRewardBtn.visible=!0):(this._display.figureDown.visible=!1,Laya.timer.clear(this,this.setFigureDown))},s.prototype.newBgModel=function(){this._bgModel||(this._bgModel=new Sprite,this._bgModel.graphics.drawRect(0,0,t.LayerMgr.width,t.LayerMgr.height,"#000000"),this._bgModel.mouseEnabled=!0,this._bgModel.size(t.LayerMgr.width,t.LayerMgr.height),this._bgModel.alpha=.4)},s.prototype.setFigureDown=function(){this._display.figureDown.y+=this._figureStep,this._display.figureDown.y!=this._initFigureDownY&&this._display.figureDown.y!=this._initFigureDownY+20||(this._figureStep*=-1)},s.prototype.replayBtnClickHandler=function(){this.event("OPEN_REPLAY_BOX",{leftMembers:this._leftMembers,leftReplay:this._leftReplay,leftFacName:this._leftFacName,rightMembers:this._rightMembers,rightReplay:this._rightReplay,rightFacName:this._rightFacName})},s.prototype.showJoinBox=function(){this._hasJoin||(this._display.joinBox.visible=!0)},s.prototype.selfFacBtnClickHandler=function(){this.event("SELF_FACTION_CLICK")},s.prototype.destroy=function(){t.removeListener(t.ViewEvent.BOX_HIDE,this,this.confirmBoxClickHandler),this._leftMembers=null,this._leftReplay=null,this._leftFacName=null,this._rightMembers=null,this._rightReplay=null,this._rightFacName=null,this.skeleton_reward&&(this.skeleton_reward.off(Laya.Event.STOPPED,this,this.rewardMoviePlayOver),this.skeleton_reward.destroy(),this.skeleton_reward=null),this.skeleton_reward_bg&&(this.skeleton_reward_bg.destroy(),this.skeleton_reward_bg=null),this._display.getRewardBtn.off(Laya.Event.CLICK,this,this.getRewardClickHandler),this._getRewardData&&(this.alertToShowRankReward(this._getRewardData),this._getRewardData=null),this._bgModel&&(this._bgModel.removeSelf(),this._bgModel=null),this._display.joinBtn.off(Laya.Event.CLICK,this,this.joinFactionWar),this._display.championBtn.off(Laya.Event.CLICK,this,this.showChamion),this._display.ruleImage.off(Laya.Event.CLICK,this,this.showRule),this._display.leftBtn.off(Laya.Event.CLICK,this,this.leftBtnClickHandler),this._display.rightBtn.off(Laya.Event.CLICK,this,this.rightBtnClickHandler),this._display.selfFacInfoBtn.off(Laya.Event.CLICK,this,this.selfFacBtnClickHandler),this._display.replayBtn.off(Laya.Event.CLICK,this,this.replayBtnClickHandler),this._leftMemberList&&(this._leftMemberList.destroy(),this._leftMemberList=null),this._rightMemberList&&(this._rightMemberList.destroy(),this._rightMemberList=null);var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);i.off(t.ModelEvent.UPDATE_FINISH,this,this.factionUpdateFinish),e.prototype.destroy.call(this)},s.FIGHT_DAY=5,s.groupNum=1,s.groupSelf=0,s}(t.BaseBox);t.FactionWarScene=e;var i=function(e){function i(){e.call(this),this.playerInfo.headBg.on(Laya.Event.CLICK,this,this.headBgClickHandler),this.playerInfo.maleIcon.visible=!1,this.playerInfo.femaleIcon.visible=!1,this.resultBox.visible=!1}return __extends(i,e),i.prototype.doRender=function(e,i){this.bg1.visible=i%2==0,this.bg2.visible=i%2!=0,this._uid=e.uid,this.nameTxt.text=e.name;var s=e.hasOwnProperty("inspire")?Number(e.inspire):0;this.inspireTxt.text=s+"级鼓舞",this.strengTxt.text=e.power,this.playerInfo.photo.loadImage(t.JSUtils.getHeadUrl(e.head_url),0,0,82,82),1==Number(e.sex)?(this.playerInfo.maleIcon.visible=!0,this.playerInfo.femaleIcon.visible=!1,this.playerInfo.defaultHead.skin="ui/main/male.png"):(this.playerInfo.maleIcon.visible=!1,this.playerInfo.femaleIcon.visible=!0,this.playerInfo.defaultHead.skin="ui/main/female.png"),this.playerInfo.tfLvl.text=e.level,this.playerInfo.tfVip.text=""+(e.hasOwnProperty("vip_level")?e.vip_level:0),e.hasOwnProperty("replayID")?(this.resultBox.visible=!0,this._replayID=e.replayID,this.win0.visible=0==Number(e.winCount),this.win1.visible=1==Number(e.winCount),this.win2.visible=2==Number(e.winCount),this.win3.visible=3==Number(e.winCount),this.firePng.visible=this.win3.visible,this.lose0.visible=0==Number(e.loseCount),this.lose1.visible=1==Number(e.loseCount)):this.resultBox.visible=!1},i.prototype.headBgClickHandler=function(){t.Facade.callCommand(new t.UserInfoCommand(this._uid))},i.prototype.showReplay=function(){t.Facade.callCommand(new t.FightReplayCommand(this._replayID))},i.prototype.destroy=function(){this.playerInfo.headBg.off(Laya.Event.CLICK,this,this.headBgClickHandler),e.prototype.destroy.call(this),Laya.loader.clearRes("ui/faction/factionWar/img_zoumadengdi.png")},i}(ui.faction.faction.factionWar.SceneFightMemberItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i){e.call(this,new ui.faction.faction.factionWar.FactionWarFront8BoxUI,!1,!0),this._isHistory=!1,this._hasJoin=!1,this._maxBettingCount=0,this._bettingID=-1,this._clickIndex=0,this._clickType=0,this._display=this.skin,this.canClickModelToClose=!1,this.name="WarChampionBox",this._hasJoin=i,this._display.bg.scrollRect=new Laya.Rectangle(0,0,876,535),this.resetAll(),this._clickType=0,1==t.FactionWarScene.groupNum&&(this._display.leftBtn.visible=this._display.rightBtn.visible=!1),this.nowGroup=t.FactionWarScene.groupSelf>=0&&t.FactionWarScene.groupSelf<=3?t.FactionWarScene.groupSelf:0;for(var s=1;8>=s;s++)this._display["player"+s].on(Laya.Event.CLICK,this,this.playerClickHandler);this._display.final1.on(Laya.Event.CLICK,this,this.playerClickHandler),this._display.final2.on(Laya.Event.CLICK,this,this.playerClickHandler),this._display.champion.on(Laya.Event.CLICK,this,this.playerClickHandler),this._display.leftBtn.on(Laya.Event.CLICK,this,this.leftBtnClickHandler),this._display.rightBtn.on(Laya.Event.CLICK,this,this.rightBtnClickHandler),this._display.msgTxt.text="",this._display.menuTab.selectHandler=new Handler(this,this.showTab)}return __extends(i,e),i.prototype.getChampionHandler=function(e){if(0==e.result){this._data=e,this.resetAll();var i=e.challenge;if(this._maxBettingCount=i.betting_count,!this._isHistory&&i.hasOwnProperty("betting_fid")&&(this._bettingID=0==Number(i.betting_fid)?-1:Number(i.betting_fid)),i.hasOwnProperty("rounds")&&i.rounds.length>0){for(var s=i.rounds,n=s[0],a=n.arenas,o=1;4>=o;o++){var r=a[o-1];if(r){var h=r.faction_1;if(0!=Number(h.id)){Number(h.id)==this._bettingID&&(this._display["figure"+(2*o-1)].visible=!0),this["_faction"+(2*o-1)]=h;var l=this._display["player"+(2*o-1)];l.nameTxt.text=h.name,l.head.visible=!0,l.head.loadImage("ui/faction/factionScene/facIcon"+h.totem[3]+".png",0,0,90,90),r.winner==h.id&&(this._display["line"+(2*o-1)].visible=!0)}var c=r.faction_2;if(0!=Number(c.id)){Number(c.id)==this._bettingID&&(this._display["figure"+2*o].visible=!0),this["_faction"+2*o]=c;var l=this._display["player"+2*o];l.nameTxt.text=c.name,l.head.visible=!0,l.head.loadImage("ui/faction/factionScene/facIcon"+c.totem[3]+".png",0,0,90,90),r.winner==c.id&&(this._display["line"+2*o].visible=!0)}}}if(s.length>1)for(var n=s[1],a=n.arenas,o=1;2>=o;o++){var r=a[o-1];if(r){var l=this._display["final"+o];this["_faction"+(4*o-3)]&&r.winner==this["_faction"+(4*o-3)].id?(this["_factionFinal"+o]=this["_faction"+(4*o-3)],this._display["lineFinal"+(4*o-3)].visible=!0,l.nameTxt.text=this["_factionFinal"+o].name,l.head.visible=!0,l.head.loadImage("ui/faction/factionScene/facIcon"+this["_factionFinal"+o].totem[3]+".png",0,0,90,90)):this["_faction"+(4*o-2)]&&r.winner==this["_faction"+(4*o-2)].id?(this["_factionFinal"+o]=this["_faction"+(4*o-2)],this._display["lineFinal"+(4*o-2)].visible=!0,l.nameTxt.text=this["_factionFinal"+o].name,l.head.visible=!0,l.head.loadImage("ui/faction/factionScene/facIcon"+this["_factionFinal"+o].totem[3]+".png",0,0,90,90)):this["_faction"+(4*o-1)]&&r.winner==this["_faction"+(4*o-1)].id?(this["_factionFinal"+o]=this["_faction"+(4*o-1)],this._display["lineFinal"+(4*o-1)].visible=!0,l.nameTxt.text=this["_factionFinal"+o].name,l.head.visible=!0,l.head.loadImage("ui/faction/factionScene/facIcon"+this["_factionFinal"+o].totem[3]+".png",0,0,90,90)):this["_faction"+4*o]&&r.winner==this["_faction"+4*o].id&&(this["_factionFinal"+o]=this["_faction"+4*o],this._display["lineFinal"+4*o].visible=!0,l.nameTxt.text=this["_factionFinal"+o].name,l.head.visible=!0,l.head.loadImage("ui/faction/factionScene/facIcon"+this["_factionFinal"+o].totem[3]+".png",0,0,90,90)),this["_factionFinal"+o]&&Number(this["_factionFinal"+o].id)==this._bettingID&&(this._display["figureFinal"+o].visible=!0)}}if(s.length>2){var n=s[2],a=n.arenas,r=a[0];if(r){var l=this._display.champion;this._factionFinal1&&r.winner==this._factionFinal1.id?(this._factionChampion=this._factionFinal1,this._display.lineLeft.visible=!0,l.nameTxt.text=this._factionFinal1.name,l.head.visible=!0,l.head.loadImage("ui/faction/factionScene/facIcon"+this._factionFinal1.totem[3]+".png",0,0,90,90)):this._factionFinal2&&r.winner==this._factionFinal2.id&&(this._factionChampion=this._factionFinal2,this._display.lineRight.visible=!0,l.nameTxt.text=this._factionFinal2.name,l.head.visible=!0,l.head.loadImage("ui/faction/factionScene/facIcon"+this._factionFinal2.totem[3]+".png",0,0,90,90)),this._factionChampion&&Number(this._factionChampion.id)==this._bettingID&&(this._display.figureChampion.visible=!0)}}}this.setMsgTxt(),0!=this._clickType&&(1==this._clickType?this["_faction"+this._clickIndex]&&this.event("OPEN_BET_BOX",{faction:this["_faction"+this._clickIndex],bettingID:this._bettingID,maxBettingCount:this._maxBettingCount,isOver:null!=this._factionChampion}):2==this._clickType?this["_factionFinal"+this._clickIndex]&&this.event("OPEN_BET_BOX",{faction:this["_factionFinal"+this._clickIndex],bettingID:this._bettingID,maxBettingCount:this._maxBettingCount,isOver:null!=this._factionChampion}):this._factionChampion&&this.event("OPEN_BET_BOX",{faction:this._factionChampion,bettingID:this._bettingID,maxBettingCount:this._maxBettingCount,isOver:null!=this._factionChampion}))}else this.resetAll(),t.WeakTips.show("查询8强信息失败，"+e.msg)},i.prototype.resetAll=function(){this._bettingID=-1;for(var t=1;8>=t;t++){this["_faction"+t]=null,this._display["line"+t].visible=!1,this._display["lineFinal"+t].visible=!1;var e=this._display["player"+t];e.nameTxt.text="虚位以待",e.head.visible=!1}var e=this._display.final1;e.nameTxt.text="虚位以待",e.head.visible=!1;var e=this._display.final2;e.nameTxt.text="虚位以待",e.head.visible=!1;var e=this._display.champion;e.nameTxt.text="虚位以待",e.head.visible=!1,this._factionFinal1=null,this._factionFinal2=null,this._factionChampion=null,this._display.lineLeft.visible=this._display.lineRight.visible=!1;for(var i=this._display.figureBox.numChildren,t=0;i>t;t++)this._display.figureBox.getChildAt(t).visible=!1},i.prototype.playerClickHandler=function(e){var i=e.target.name;-1!=i.indexOf("player")?(this._clickIndex=Number(i.split("player")[1]),this._clickType=1,this["_faction"+this._clickIndex]&&(this._isHistory?this.event("SHOW_SELF_FAC_INFO",{facID:this["_faction"+this._clickIndex].id,history:this._isHistory}):t.XHR().Post({file:"petpk",cmd:"faction",op:"challenge_query",group:this._nowGroup,uid:t.Global.UID},this,this.getChampionHandler))):-1!=i.indexOf("final")?(this._clickIndex=Number(i.split("final")[1]),this._clickType=2,this["_factionFinal"+this._clickIndex]&&(this._isHistory?this.event("SHOW_SELF_FAC_INFO",{facID:this["_factionFinal"+this._clickIndex].id,history:this._isHistory}):t.XHR().Post({file:"petpk",cmd:"faction",op:"challenge_query",group:this._nowGroup,uid:t.Global.UID},this,this.getChampionHandler))):(this._clickType=3,this._factionChampion&&(this._isHistory?this.event("SHOW_SELF_FAC_INFO",{facID:this._factionChampion.id,history:this._isHistory}):t.XHR().Post({file:"petpk",cmd:"faction",op:"challenge_query",group:this._nowGroup,uid:t.Global.UID},this,this.getChampionHandler)))},i.prototype.leftBtnClickHandler=function(){this._display.leftBtn.filters&&0!=this._display.leftBtn.filters.length||(this._clickType=0,this.nowGroup=this._nowGroup-1)},i.prototype.rightBtnClickHandler=function(){this._display.rightBtn.filters&&0!=this._display.rightBtn.filters.length||(this._clickType=0,this.nowGroup=this._nowGroup+1)},i.prototype.setMsgTxt=function(){if(this._isHistory)this._display.msgTxt.off(t.TimeTextControl.TIME_UP,this,this.timeUp),t.TimeTextControl.removeTimeText(this._display.msgTxt),this._display.msgTxt.text=this._factionChampion?"恭喜帮派【"+this._factionChampion.name+"】获得上届冠军":"上届8强";else{var e=t.ServerClock.getServerNowDate(),i=e.getDay();if(i>=1&&i<=t.FactionWarScene.FIGHT_DAY-1){var s=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0).getTime();s+=864e5*(t.FactionWarScene.FIGHT_DAY-i),t.TimeTextControl.setTimeText(this._display.msgTxt,(s-t.ServerClock.getServerTime())/1e3,"D天HH时NN分SS秒开始海选赛")}else if(i>=t.FactionWarScene.FIGHT_DAY)if(this._faction1){var s=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0).getTime();s+=864e5*(7-i),t.TimeTextControl.setTimeText(this._display.msgTxt,(s-t.ServerClock.getServerTime())/1e3,"D天HH时NN分SS秒开始冠军赛")}else this._display.msgTxt.off(t.TimeTextControl.TIME_UP,this,this.timeUp),t.TimeTextControl.removeTimeText(this._display.msgTxt),this._display.msgTxt.text="海选赛进行中……";else this._display.msgTxt.off(t.TimeTextControl.TIME_UP,this,this.timeUp),t.TimeTextControl.removeTimeText(this._display.msgTxt),this._display.msgTxt.text=this._factionChampion?"恭喜帮派【"+this._factionChampion.name+"】获得本届冠军":"冠军赛进行中……"}},i.prototype.timeUp=function(){this.setMsgTxt()},i.prototype.betSuccess=function(t){this._bettingID=t;var e=this._data.challenge;e.betting_fid=this._bettingID,this._clickType=0,this.getChampionHandler(this._data)},i.prototype.showTab=function(){0==this._display.menuTab.selectedIndex?(this._isHistory=!1,this._clickType=0,t.XHR().Post({file:"petpk",cmd:"faction",op:"challenge_query",group:this._nowGroup,uid:t.Global.UID},this,this.getChampionHandler)):(this._isHistory=!0,this._display.msgTxt.text="",this._display.msgTxt.off(t.TimeTextControl.TIME_UP,this,this.timeUp),t.TimeTextControl.removeTimeText(this._display.msgTxt),this._clickType=0,t.XHR().Post({file:"petpk",cmd:"faction",op:"challenge_query",group:this._nowGroup,history:1,uid:t.Global.UID},this,this.getChampionHandler))},Object.defineProperty(i.prototype,"nowGroup",{set:function(e){this._display.titlePng1.visible=this._display.titlePng2.visible=this._display.titlePng3.visible=this._display.titlePng4.visible=!1,this._nowGroup=e,this._display["titlePng"+(this._nowGroup+1)].visible=!0,0==e?this._display.leftBtn.filters&&0!=this._display.leftBtn.filters.length||(this._display.leftBtn.filters=t.FiltersUtils.getGreyFilters()):this._display.leftBtn.filters&&this._display.leftBtn.filters.length>0&&(this._display.leftBtn.filters=null),e==t.FactionWarScene.groupNum-1?this._display.rightBtn.filters&&0!=this._display.rightBtn.filters.length||(this._display.rightBtn.filters=t.FiltersUtils.getGreyFilters()):this._display.rightBtn.filters&&this._display.rightBtn.filters.length>0&&(this._display.rightBtn.filters=null);var i={file:"petpk",cmd:"faction",op:"challenge_query",group:this._nowGroup,uid:t.Global.UID};1==this._display.menuTab.selectedIndex&&(i.history=1),t.XHR().Post(i,this,this.getChampionHandler)},enumerable:!0,configurable:!0}),i.prototype.getHistory=function(){return this._isHistory},i.prototype.getFaction1=function(){return this._faction1},i.prototype.destroy=function(){this._display.menuTab.selectHandler=null,this._display.msgTxt.off(t.TimeTextControl.TIME_UP,this,this.timeUp),t.TimeTextControl.removeTimeText(this._display.msgTxt),this._faction1=null,this._faction2=null,this._faction3=null,this._faction4=null,this._faction5=null,this._faction6=null,this._faction7=null,this._faction8=null,this._factionFinal1=null,this._factionFinal2=null,this._factionChampion=null;for(var i=1;8>=i;i++)this._display["player"+i].off(Laya.Event.CLICK,this,this.playerClickHandler);this._display.final1.off(Laya.Event.CLICK,this,this.playerClickHandler),this._display.final2.off(Laya.Event.CLICK,this,this.playerClickHandler),this._display.champion.off(Laya.Event.CLICK,this,this.playerClickHandler),this._display.leftBtn.off(Laya.Event.CLICK,this,this.leftBtnClickHandler),this._display.rightBtn.off(Laya.Event.CLICK,this,this.rightBtnClickHandler),e.prototype.destroy.call(this)},i}(t.BaseBox);t.WarChampionBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.faction.faction.factionWar.SelfFactioniWarBoxUI,!1,!0),this._display=this.skin,this.name="WarFightMemberBox",this.canClickModelToClose=!1,this._display.titlePng1.visible=this._display.titlePng2.visible=this._display.titlePng3.visible=this._display.titlePng4.visible=!1,this._display["titlePng"+(t.FactionWarScene.groupSelf+1)].visible=!0,this.fightMemberlist=new laya.ui.List,this.fightMemberlist.vScrollBarSkin="ui/comp/vscroll.png",this.fightMemberlist.scrollBar.visible=!1,this.fightMemberlist.renderHandler=Handler.create(this,this.updateLogItem,null,!1),this.fightMemberlist.itemRender=i,this._display.addChildAt(this.fightMemberlist,this._display.getChildIndex(this._display.bgKuang)),this.fightMemberlist.x=228,this.fightMemberlist.y=179,this.fightMemberlist.repeatX=2,this.fightMemberlist.repeatY=4,this.fightMemberlist.spaceX=0,this.fightMemberlist.spaceY=-1,this.fightMemberlist.height=418;var s=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);this._display.nameTxt.text=s.name,this._display.inspireTxt.text="0级鼓舞",this._display.strengTxt.text=String(s.attackPower),this._display.inspireBox.visible=!1,this._display.joinBtn.on(Laya.Event.CLICK,this,this.joinFactionWar),this._display.inspireBtn.on(Laya.Event.CLICK,this,this.inspireBtnClickHandler),this._display.inspire1Btn.on(Laya.Event.CLICK,this,this.inspireFactionWar),this._display.closeInspireBtn.on(Laya.Event.CLICK,this,this.hideInspireBox),this._display.playerInfo.headBg.on(Laya.Event.CLICK,this,this.headBgClickHandler)}return __extends(s,e),s.prototype.setData=function(e){var i,s=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL),n=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF),a=n.facID,o=e.arenas[0],r=o.faction_1,h=o.faction_2;i=r&&r.hasOwnProperty("id")&&Number(r.id)==a?r.fighters.concat():h.fighters.concat();for(var l=n.members.concat(),c=l.length,d=!1,u=s.uid,p=0;c>p;p++){var _=l[p],f=Number(_.uid),y=i.length;_.hasJoin=0;for(var m=0;y>m;m++){var g=i[m];if(Number(g.uid)==f){_.hasJoin=100,_.fight_power=g.power,_.inspire=g.hasOwnProperty("inspire")?g.inspire:0,i.splice(m,1),f==u&&(d=!0,this._selfInspireLv=g.hasOwnProperty("inspire")?Number(g.inspire):0,this._display.inspireTxt.text=this._selfInspireLv+"级鼓舞",this._selfInspireErrorCount=g.hasOwnProperty("inspire_failure")?Number(g.inspire_failure):0,this._display.playerInfo.photo.loadImage(t.JSUtils.getHeadUrl(_.head_url),0,0,82,82),1==Number(_.sex)?(this._display.playerInfo.maleIcon.visible=!0,this._display.playerInfo.femaleIcon.visible=!1,this._display.playerInfo.defaultHead.skin="ui/main/male.png"):(this._display.playerInfo.maleIcon.visible=!1,this._display.playerInfo.femaleIcon.visible=!0,this._display.playerInfo.defaultHead.skin="ui/main/female.png"),this._display.playerInfo.tfLvl.text=_.level,this._display.playerInfo.tfVip.text=""+_.vip_level);break}}}if(this.fightMemberlist.array=l,d){this._display.joinBtn.visible=!1,this._display.selfBox.visible=!0;for(var p=0;p<l.length;p++)if(Number(l[p].uid)==u){10>p+1?(this._display.num1.x=-32,this._display.num2.visible=!1,this._display.num1.skin="ui/faction/factionWar/"+(p+1)+".png"):(this._display.num1.x=-45,this._display.num2.visible=!0,this._display.num1.skin="ui/faction/factionWar/"+String(p+1).charAt(0)+".png",this._display.num2.skin="ui/faction/factionWar/"+String(p+1).charAt(1)+".png");break}}else this._display.joinBtn.visible=!0,this._display.selfBox.visible=!1},s.prototype.updateLogItem=function(t,e){e<=this.fightMemberlist.array.length-1&&t.doRender(this.fightMemberlist.array[e],e)},s.prototype.joinFactionWar=function(){t.XHR().Post({file:"petpk",cmd:"faction",op:"challenge_sigup",uid:t.Global.UID},this,this.joinFactionWarHandler)},s.prototype.joinFactionWarHandler=function(e){0==e.result?(t.WeakTips.show("加入争霸战成功！"),this._display.joinBtn.visible=!1,this._display.selfBox.visible=!0,this.event("GET_WAR_DATA")):t.WeakTips.show("加入争霸战失败，"+e.msg)},s.prototype.inspireFactionWar=function(){t.PayConfirm.checkDouYu(this._needDoudou,new Handler(this,this.inspireDoFactionWar))},s.prototype.inspireDoFactionWar=function(){t.XHR().Post({file:"petpk",cmd:"faction",op:"challenge_inspire",uid:t.Global.UID},this,this.inspireWarHandler)},s.prototype.inspireWarHandler=function(e){if(0==e.result)if(t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!1)),0!=e.success){t.WeakTips.show("鼓舞成功！"),this._selfInspireLv++,this._selfInspireErrorCount=0,this._display.inspireTxt.text=this._selfInspireLv+"级鼓舞",this.showInspireBox();for(var i=this.fightMemberlist.array,s=0;s<i.length;s++)if(i[s].uid==t.Global.UID){i[s].inspire=this._selfInspireLv;break}this.fightMemberlist.array=i}else t.WeakTips.show("鼓舞失败，成功率+5%"),this._selfInspireErrorCount++,this.showInspireBox();else t.WeakTips.show("操作失败，"+e.msg)},s.prototype.inspireBtnClickHandler=function(){this._display.inspireBox.visible?this.hideInspireBox():this.showInspireBox()},s.prototype.showInspireBox=function(){this._display.inspireBox.visible=!0,this._display.inspireNameTxt.text=this._selfInspireLv+"级鼓舞";var e=["生命、伤害、防御和速度提升2%","生命、伤害、防御和速度提升4%","生命、伤害、防御和速度提升6%","生命、伤害、防御和速度提升8%","生命、伤害、防御和速度提升10%"];if(this._display.desTxt.text=0==this._selfInspireLv?"无":e[this._selfInspireLv-1],this._display.line1.y=this._display.desTxt.y+this._display.desTxt.textHeight+5,5==this._selfInspireLv)this._display.maxLvMsg.visible=!0,this._display.nextDesTxt.visible=!1,this._display.line2.visible=!1,this._display.sucRetTxt.visible=!1,this._display.addSucRetTxt.visible=!1,this._display.needTxt.visible=!1,this._display.line3.visible=!1,this._display.inspire1Btn.visible=!1,this._display.doudouTxt.visible=!1,this._display.maxLvMsg.y=this._display.line1.y+40,this._display.inspireBoxBg.height=270;else{this._display.maxLvMsg.visible=!1,this._display.nextDesTxt.visible=!0,this._display.line2.visible=!0,this._display.sucRetTxt.visible=!0,this._display.addSucRetTxt.visible=!0,this._display.needTxt.visible=!0,this._display.line3.visible=!0,this._display.inspire1Btn.visible=!0,this._display.doudouTxt.visible=!0,this._display.nextDesTxt.y=this._display.line1.y+10,this._display.nextDesTxt.text="下级："+e[this._selfInspireLv],this._display.line2.y=this._display.nextDesTxt.y+this._display.nextDesTxt.textHeight+5;var i=["100%","80%","50%","30%","10%"];this._display.sucRetTxt.y=this._display.line2.y+10,this._display.sucRetTxt.text="成功率："+i[this._selfInspireLv],this._display.addSucRetTxt.x=this._display.sucRetTxt.x+this._display.sucRetTxt.textWidth,this._display.addSucRetTxt.y=this._display.line2.y+10,this._display.addSucRetTxt.text=0==this._selfInspireErrorCount?"":"+"+5*this._selfInspireErrorCount+"%",this._display.needTxt.y=this._display.addSucRetTxt.y+32,this._needDoudou=[5,10,15,20,25][this._selfInspireLv],this._display.needTxt.text="消耗："+this._needDoudou+"斗鱼",this._display.line3.y=this._display.needTxt.y+this._display.needTxt.textHeight+5,this._display.inspire1Btn.y=this._display.line3.y+14,this._display.doudouTxt.y=this._display.inspire1Btn.y+74,this._display.doudouTxt.text="当前斗鱼："+t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).douyu,this._display.doudouTxt.visible=!1,this._display.inspireBoxBg.height=this._display.doudouTxt.y+26}},s.prototype.hideInspireBox=function(){this._display.inspireBox.visible=!1},s.prototype.headBgClickHandler=function(){t.Facade.callCommand(new t.UserInfoCommand(t.Global.UID))},s.prototype.destroy=function(){this.fightMemberlist&&(this.fightMemberlist.destroy(),this.fightMemberlist=null),this._display.joinBtn.off(Laya.Event.CLICK,this,this.joinFactionWar),this._display.inspireBtn.off(Laya.Event.CLICK,this,this.inspireBtnClickHandler),this._display.inspire1Btn.off(Laya.Event.CLICK,this,this.inspireFactionWar),this._display.closeInspireBtn.off(Laya.Event.CLICK,this,this.hideInspireBox),this._display.playerInfo.headBg.off(Laya.Event.CLICK,this,this.headBgClickHandler),e.prototype.destroy.call(this)},s}(t.BaseBox);t.WarFightMemberBox=e;var i=function(e){function i(){e.call(this),this.playerInfo.headBg.on(Laya.Event.CLICK,this,this.headBgClickHandler),this.playerInfo.maleIcon.visible=!1,this.playerInfo.femaleIcon.visible=!1}return __extends(i,e),i.prototype.doRender=function(e,i){
this._uid=e.uid,this.nameTxt.text=e.name,this.strengTxt.text=e.fight_power;var s=e.hasOwnProperty("inspire")?Number(e.inspire):0;this.inspireTxt.text=s+"级鼓舞";var n=i+1;10>n?(this.num1.x=25,this.num2.visible=!1,this.num1.skin="ui/faction/factionWar/"+n+".png"):(this.num1.x=12,this.num2.visible=!0,this.num1.skin="ui/faction/factionWar/"+String(n).charAt(0)+".png",this.num2.skin="ui/faction/factionWar/"+String(n).charAt(1)+".png"),this.playerInfo.photo.loadImage(t.JSUtils.getHeadUrl(e.head_url),0,0,82,82),1==Number(e.sex)?(this.playerInfo.maleIcon.visible=!0,this.playerInfo.femaleIcon.visible=!1,this.playerInfo.defaultHead.skin="ui/main/male.png"):(this.playerInfo.maleIcon.visible=!1,this.playerInfo.femaleIcon.visible=!0,this.playerInfo.defaultHead.skin="ui/main/female.png"),this.playerInfo.tfLvl.text=e.level,this.playerInfo.tfVip.text=""+e.vip_level,this.notJoinPng.visible=0==Number(e.hasJoin)},i.prototype.headBgClickHandler=function(){t.Facade.callCommand(new t.UserInfoCommand(this._uid))},i.prototype.destroy=function(){this.playerInfo.headBg.off(Laya.Event.CLICK,this,this.headBgClickHandler),e.prototype.destroy.call(this)},i}(ui.faction.faction.factionWar.FightMemberItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.maths.Point,i=function(i){function s(){i.call(this,new ui.faction.faction.FactionWuguanSceneUI),this.moviePath_fight="assets/skeleton/lilian.sk",this.moviePath_Npc1="assets/skeleton/faction/factionWuguan/monster_lixiaolong.sk",this.moviePath_Npc2="assets/skeleton/faction/factionWuguan/monster_yewen.sk",this.moviePath_Npc3="assets/skeleton/faction/factionWuguan/monster_yongcun.sk",this.npcBack_djPath="assets/skeleton/faction/effect_jiapu.sk",this._offRotation=0,this.canStageMove=!0,this._firstQuery=!0,this._isStageDown=!1,this._skillNameArr=["意气风发","濒死本能","修身养性"],this._canClickStageToCloseInfo=!1,this._learnPngScaleValue=100,this._learnPngScaleStep=1,this._setBarMcWordIndex=0,this._display=this.skin,this.setCloseButton(this._display.backBtn),this.canClickModelToClose=!1,this.name="FactionWuguanSceneBox",this._maxWidth=this._display.barMc1.width,this.cacheAs="none",this._display.mainLayer1.cacheAs="bitmap",this._display.mainLayer2.cacheAs="bitmap",this._display.npc1MainLayer1.cacheAs="bitmap",this._display.npc1MainLayer2.cacheAs="bitmap",this._display.npc2MainLayer1.cacheAs="bitmap",this._display.npc2MainLayer2.cacheAs="bitmap",this._display.npc3MainLayer1.cacheAs="bitmap",this._display.npc3MainLayer2.cacheAs="bitmap",this._lvArr=[1,1,1],this._expArr=[0,0,0],this._effectArr=["","",""],this._nextEffectArr=["","",""],this._powerArr=[0,0,0],this._nextPowerArr=[0,0,0],this._typeArr=["","",""],this._skillLvArr=[1,1,1],this._skillMaxLvArr=[1,1,1],this._fightCount=0,this._fightMaxCount=0,this.skeleton_fight=new t.AnimationSKe(this.moviePath_fight),this._display.fightMcContainer.addChild(this.skeleton_fight),this.skeleton_fight.play(0,!0),this.skeleton_fight.x=666,this.skeleton_fight.y=440,this.skeleton_fight.scaleX=this.skeleton_fight.scaleY=1.5;for(var e=1;3>=e;e++)this["skeleton_npc"+e]=new t.AnimationSKe(this["moviePath_Npc"+e]),this["skeleton_npc"+e].name="skeletonNpc"+e,this._display["npc"+e+"MovieContainer"].addChildAt(this["skeleton_npc"+e],0),this["skeleton_npc"+e].on(Laya.Event.STOPPED,this,this.npcActioinStop,[this["skeleton_npc"+e]]),this.npcActioinStop(this["skeleton_npc"+e]),this["skeleton_npc"+e].x=150,this["skeleton_npc"+e].y=220;this.npcBackParseComplete(),this._radiusX=(this._display.npc3.x-this._display.npc1.x)/2,this._radiusY=this._display.npc2.y-this._display.npc1.y,this._ellipseCenterPointX=(this._display.npc3.x+this._display.npc1.x)/2,this._ellipseCenterPointY=this._display.npc1.y,this._isTweening=!1,this._angel1=180,this._angel2=90,this._angel3=0,this._display.modelArea1.on(Laya.Event.CLICK,this,this.modelAreaClickHandler),this._display.modelArea2.on(Laya.Event.CLICK,this,this.modelAreaClickHandler),this._display.modelArea3.on(Laya.Event.CLICK,this,this.modelAreaClickHandler),Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.stageMouseDownHandler),Laya.stage.on(Laya.Event.CLICK,this,this.stageClickHandler),this.getWushuHallInfo(),this._display.ruleImage.on(Laya.Event.CLICK,this,this.showRule),this._display.updatePng1.on(Laya.Event.CLICK,this,this.updatePngClick),this._display.updatePng2.on(Laya.Event.CLICK,this,this.updatePngClick),this._display.updatePng3.on(Laya.Event.CLICK,this,this.updatePngClick),this._display.learnPng1.on(Laya.Event.CLICK,this,this.learnPngClick),this._display.learnPng2.on(Laya.Event.CLICK,this,this.learnPngClick),this._display.learnPng3.on(Laya.Event.CLICK,this,this.learnPngClick),this._display.skillBg1.on(Laya.Event.CLICK,this,this.skillBgClick),this._display.skillBg2.on(Laya.Event.CLICK,this,this.skillBgClick),this._display.skillBg3.on(Laya.Event.CLICK,this,this.skillBgClick),this._display.learnPng1.visible=this._display.learnPng2.visible=this._display.learnPng3.visible=!1,this._display.red1.visible=this._display.red2.visible=this._display.red3.visible=!1,Laya.timer.loop(30,this,this.setLearnPngScale),Laya.timer.loop(1e3,this,this.setBarMcWord),this._display.skillInfo.visible=!1,this._display.skillInfo.mouseEnabled=!1,this._display.buffView.updateBuffs(),this._display.backBtn.x-=t.Global.FLOAT_ICON_OFFSET}return __extends(s,i),s.prototype.npcActioinStop=function(t){var e,i=Number(t.name.split("skeletonNpc")[1]);e=90==this["_angel"+i]?Math.floor(3*Math.random())+1:2==i?2:1,t.play(e,!1)},s.prototype.getWushuHallInfo=function(){t.XHR().Post({file:"petpk",cmd:"faction",op:"getclub",uid:t.Global.UID},this,this.queryWushuHallHandler)},s.prototype.queryWushuHallHandler=function(e){if(this._lvArr=[1,1,1],this._expArr=[0,0,0],this._effectArr=["","",""],this._nextEffectArr=["","",""],this._powerArr=[0,0,0],this._nextPowerArr=[0,0,0],this._typeArr=["","",""],this._skillLvArr=[1,1,1],this._skillMaxLvArr=[1,1,1],this._fightCount=0,this._fightMaxCount=0,0==e.result){if(e.hasOwnProperty("fight_count")&&(this._fightCount=e.fight_count),e.hasOwnProperty("fight_maxcount")&&(this._fightMaxCount=e.fight_maxcount),e.hasOwnProperty("club")){var i=e.club;if(i.hasOwnProperty("power")){var s=i.power;if(this._lvArr[0]=Number(s.lvl),0==this._lvArr[0]&&(this._lvArr[0]=1),this._expArr[0]=s.exp,this._display.skillNameTxt1.text="李小龙（"+this._lvArr[0]+"级）",s.hasOwnProperty("skill")){var n=Number(s.skill.level);this._display.skillLvTxt1.text=n>0?String(n)+"级":"未学习",this._display.learnPng1.visible=n>=0&&n<s.lvl,this._effectArr[0]=s.skill.effect,this._nextEffectArr[0]=s.skill.next_effect,this._powerArr[0]=s.skill.fightpower,this._nextPowerArr[0]=s.skill.next_fightpower,this._typeArr[0]=s.skill.type,this._skillLvArr[0]=n,this._skillMaxLvArr[0]=s.skill.maxlevel}else this._display.learnPng1.visible=!1,this._display.skillLvTxt1.text="未学习"}if(this._display.red1.visible=this._display.learnPng1.visible,this._display.skillLvTxt1.visible=!this._display.learnPng1.visible,i.hasOwnProperty("phy")){var a=i.phy;this._lvArr[1]=Number(a.lvl),0==this._lvArr[1]&&(this._lvArr[1]=1),this._expArr[1]=a.exp;var o=t.FactionConfig.getWuguanConfig(this._lvArr[1]);if(this._firstQuery&&this._expArr[1]>=o.updateNeedExp&&t.WeakTips.show("当前熟练度已满，帮主和副帮主可进行升级"),this._display.skillNameTxt2.text="叶问（"+this._lvArr[1]+"级）",a.hasOwnProperty("skill")){var n=Number(a.skill.level);this._display.skillLvTxt2.text=n>0?String(n)+"级":"未学习",this._display.learnPng2.visible=n>=0&&n<a.lvl,this._effectArr[1]=a.skill.effect,this._nextEffectArr[1]=a.skill.next_effect,this._powerArr[1]=a.skill.fightpower,this._nextPowerArr[1]=a.skill.next_fightpower,this._typeArr[1]=a.skill.type,this._skillLvArr[1]=n,this._skillMaxLvArr[1]=a.skill.maxlevel}else this._display.learnPng2.visible=!1,this._display.skillLvTxt2.text="未学习"}if(this._display.red2.visible=this._display.learnPng2.visible,this._display.skillLvTxt2.visible=!this._display.learnPng2.visible,i.hasOwnProperty("speed")){var r=i.speed;if(this._lvArr[2]=Number(r.lvl),0==this._lvArr[2]&&(this._lvArr[2]=1),this._expArr[2]=r.exp,this._display.skillNameTxt3.text="严咏春（"+this._lvArr[2]+"级）",r.hasOwnProperty("skill")){var n=Number(r.skill.level);this._display.skillLvTxt3.text=n>0?String(n)+"级":"未学习",this._display.learnPng3.visible=n>=0&&n<r.lvl,this._effectArr[2]=r.skill.effect,this._nextEffectArr[2]=r.skill.next_effect,this._powerArr[2]=r.skill.fightpower,this._nextPowerArr[2]=r.skill.next_fightpower,this._typeArr[2]=r.skill.type,this._skillLvArr[2]=n,this._skillMaxLvArr[2]=r.skill.maxlevel}else this._display.learnPng3.visible=!1,this._display.skillLvTxt3.text="未学习"}if(this._display.red3.visible=this._display.learnPng3.visible,this._display.skillLvTxt3.visible=!this._display.learnPng3.visible,!this._display.red1.visible&&!this._display.red2.visible&&!this._display.red3.visible){var h=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);h.setReddot(t.FactionReddotEnum.kFactionRedDotTypeMClubUpgrade,!1)}}}else t.WeakTips.show("查询武馆信息失败，"+e.msg);for(var l=1;3>=l;l++){var o=t.FactionConfig.getWuguanConfig(this._lvArr[l-1]);this._display["expTxt"+l].text=this._expArr[l-1]+"/"+o.updateNeedExp;var c;this._expArr[l-1]>=o.updateNeedExp?c=this._maxWidth:(c=this._maxWidth*this._expArr[l-1]/o.updateNeedExp,c>this._maxWidth&&(c=this._maxWidth)),this._display["barMc"+l].width=c,this._display["barMc"+l].visible=0!=c}var d=this._fightMaxCount>this._fightCount?this._fightMaxCount-this._fightCount:0;this._display.fightCountTxt.text="今日剩余次数："+d+"/"+this._fightMaxCount,this._firstQuery=!1},s.prototype.getPointByAngel=function(t){t*=Math.PI/180;var i=Math.cos(t)*this._radiusX,s=Math.sin(t)*this._radiusY,n=this._ellipseCenterPointX+i*Math.cos(this._offRotation)-s*Math.sin(this._offRotation),a=this._ellipseCenterPointY+i*Math.sin(this._offRotation)+s*Math.cos(this._offRotation);return new e(n,a)},s.prototype.npcBackParseComplete=function(){this.npcBack_select__djSk=new t.AnimationSKe(this.npcBack_djPath,1),this.npcBack_select__djSk.play(0,!0),this._display.groundContainer1.addChildAt(this.npcBack_select__djSk,0),this.npcBack_select__djSk.x=this._display.npc2.x+142,this.npcBack_select__djSk.y=this._display.npc2.y+410;for(var e=1;3>=e;e++)this["npcBack_djSk"+e]=new t.AnimationSKe(this.npcBack_djPath,1),this["npcBack_djSk"+e].play(1,!0),this._display.groundContainer.addChildAt(this["npcBack_djSk"+e],0),this["npcBack_djSk"+e].x=this._display["npc"+e].x+142,this["npcBack_djSk"+e].y=this._display["npc"+e].y+346},s.prototype.modelAreaClickHandler=function(e){if(!this._isTweening){var i=Number(e.target.name.split("modelArea")[1]);if(90==this["_angel"+i])this._fightCount==this._fightMaxCount?t.Facade.callCommand(new t.ShowChangeRewardCmd(["今日训练次数已达上限"],200,"#ffec49")):t.XHR().Post({file:"petpk",cmd:"faction",op:"clubfight",club_type:this.nowSelectIndex-1,uid:t.Global.UID},this,this.fightHandler);else{for(var s=[this._angel1,this._angel2,this._angel3],n=180==this["_angel"+i]?1:-1,a=1;3>=a;a++){var o=a+n>3?1:1>a+n?3:a+n;this["_angelDes"+a]=s[o-1],this["_angelStep"+a]=Math.abs((this["_angelDes"+a]-s[a-1])/15)*-n}this._isTweening=!0,Laya.timer.loop(30,this,this.changeAngel)}}},s.prototype.changeAngel=function(){for(var e=1;3>=e;e++){this["_angel"+e]+=this["_angelStep"+e],this["_angel"+e]>=360?this["_angel"+e]-=360:this["_angel"+e]<0&&(this["_angel"+e]+=360);var i=this.getPointByAngel(this["_angel"+e]),s=this._display["npc"+e];s.x=i.x,s.y=i.y}if(this.sortNpc(),this._angel1==this._angelDes1){this._isTweening=!1,Laya.timer.clear(this,this.changeAngel);var n=t.FactionConfig.getWuguanConfig(this._lvArr[this.nowSelectIndex-1]);this._expArr[this.nowSelectIndex-1]>=n.updateNeedExp&&t.WeakTips.show("当前熟练度已满，帮主和副帮主可进行升级")}},s.prototype.sortNpc=function(){var t=[this._display.npc1,this._display.npc2,this._display.npc3];t.sort(function(t,e){return t.y-e.y});for(var e=1;3>=e;e++)this._display.npcBox.setChildIndex(t[e-1],e-1)},s.prototype.stageMouseDownHandler=function(e){this._isStageDown||this._isTweening||!this.canStageMove||(this._isStageDown=!0,this._stageDownMouseX=e.stageX,this._stageDownTime=t.ServerClock.getServerTime(),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.stageMouseUpHandler))},s.prototype.stageMouseUpHandler=function(e){if(Laya.stage.off(Laya.Event.MOUSE_UP,this,this.stageMouseUpHandler),this._isStageDown&&(this._isStageDown=!1,!this._isTweening&&t.ServerClock.getServerTime()-this._stageDownTime<600&&(e.stageX<=this._stageDownMouseX-80||e.stageX>=this._stageDownMouseX+80))){for(var i=[this._angel1,this._angel2,this._angel3],s=e.stageX>=this._stageDownMouseX+100?1:-1,n=1;3>=n;n++){var a=n+s>3?1:1>n+s?3:n+s;this["_angelDes"+n]=i[a-1],this["_angelStep"+n]=Math.abs((this["_angelDes"+n]-i[n-1])/15)*-s}this._isTweening=!0,Laya.timer.loop(30,this,this.changeAngel)}},s.prototype.showRule=function(){var e="";e+="<img src='ui/comp/icon.png'></img> 1. 帮派武馆有3大武师，对应传授相应的武馆技能；<br>",e+="<img src='ui/comp/icon.png'></img> 2. 所有成员均可挑战武师，结束后可获得帮贡奖励，并增加对应武师的熟练度；<br>",e+="<img src='ui/comp/icon.png'></img> 3. 熟练度满了则可由帮主或副帮主进行升级；<br>",e+="<img src='ui/comp/icon.png'></img> 4. 升级后所有成员均可免费学习此技能，并应用到日常战斗中；<br>",e+="<img src='ui/comp/icon.png'></img> 5. 新加入帮派需重新学习武馆技能；",t.RulePanel.showRule(e,"")},s.prototype.updatePngClick=function(e){if(!this._isTweening){var i=Number(e.target.name.split("updatePng")[1]),s=t.FactionConfig.getWuguanConfig(this._lvArr[i-1]);this._lvArr[i-1]>=t.FactionConfig.MAX_WUSHU_LV?t.Facade.callCommand(new t.ShowChangeRewardCmd(["该训练效果已满级"],200,"#ffec49")):this._expArr[i-1]<s.updateNeedExp?t.WeakTips.show("熟练度满后，帮主和副帮主可升级，提升技能可学习的等级"):t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF).selfFactionUserModel.position<t.FactionConfig.updateBuildingPos?t.WeakTips.show("仅"+t.FactionConfig.updateBuildingName+"以上能升级"):t.Facade.callCommand(new t.OpenUpdateBoxCmd(t.FactionConfig.BUILDING_WUSHU,{index:i,lv:this._lvArr[i-1],exp:this._expArr[i-1]}))}},s.prototype.learnPngClick=function(e){this._isTweening||(this._nowLearnSkillIndex=Number(e.target.name.split("learnPng")[1]),t.XHR().Post({file:"petpk",cmd:"faction",op:"clubupskill",club_type:this._nowLearnSkillIndex-1,uid:t.Global.UID},this,this.updateSkillHandler))},s.prototype.updateSkillHandler=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),this.queryWushuHallHandler(e),t.Facade.callCommand(new t.ShowChangeRewardCmd(["恭喜成功学习"+this._lvArr[this._nowLearnSkillIndex-1]+"级【"+this._skillNameArr[this._nowLearnSkillIndex-1]+"】"],200,"#ffec49"))):t.WeakTips.show("学习技能失败，"+e.msg)},Object.defineProperty(s.prototype,"nowSelectIndex",{get:function(){for(var t=1,e=1;3>=e;e++)if(90==this["_angel"+e]){t=e;break}return t},enumerable:!0,configurable:!0}),s.prototype.fightHandler=function(e){0==e.result?(this._fightData=e,t.addListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.fightComplete),t.Facade.callCommand(new t.FightCommand(e))):t.WeakTips.show("训练失败，"+e.msg)},s.prototype.fightComplete=function(){if(t.removeListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.fightComplete),!this.destroyed){if(this._fightCount++,this._fightCount>=this._fightMaxCount){var e=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);e.setReddot(t.FactionReddotEnum.kFactionRedDotTypeFightClub,!1)}if(this._display.fightCountTxt.text="今日剩余次数："+(this._fightMaxCount-this._fightCount)+"/"+this._fightMaxCount,this._fightData.hasOwnProperty("exp")){var i=t.FactionConfig.getWuguanConfig(this._lvArr[this.nowSelectIndex-1]);this._display["expTxt"+this.nowSelectIndex].text=this._fightData.exp+"/"+i.updateNeedExp,this._expArr[this.nowSelectIndex-1]=Number(this._fightData.exp),this._expArr[this.nowSelectIndex-1]>=i.updateNeedExp&&t.WeakTips.show("当前熟练度已满，帮主和副帮主可进行升级");var s;this._lvArr[this.nowSelectIndex-1]==t.FactionConfig.MAX_WUSHU_LV?s=this._maxWidth:(s=this._maxWidth*this._expArr[this.nowSelectIndex-1]/i.updateNeedExp,s>this._maxWidth&&(s=this._maxWidth)),this._display["barMc"+this.nowSelectIndex].width=s,this._display["barMc"+this.nowSelectIndex].visible=0!=s}this._fightData=null}},s.prototype.skillBgClick=function(e){var i=Number(e.target.name.split("skillBg")[1]);this._nowShowSkillIndex==i?(this._nowShowSkillIndex=0,this._display.skillInfo.visible=!1):(this._nowShowSkillIndex=i,this._display.skillInfo.visible=!0,this._display.skillInfo.x=this._display["npc"+i].x+44,this._display.skillInfo.y=this._display["npc"+i].y+72,this._display.infoSkillIcon.skin="ui/faction/factionWuguanScene/skillIcon"+i+".jpg",this._display.nameTxt.text=this._skillNameArr[i-1]+"（"+this._display["skillLvTxt"+i].text+"）",this._display.typeTxt.text=this._typeArr[i-1],this._display.effectTxt.text=this._effectArr[i-1],this._display.powerTxt.y=this._display.effectTxt.y+this._display.effectTxt.textHeight+2,this._display.powerTxt.text="当前战力："+this._powerArr[i-1],this._display.line.y=this._display.powerTxt.y+this._display.powerTxt.textHeight+12,this._display.nextTxt.y=this._display.line.y+14,this._display.nextEffectTxt.y=this._display.nextTxt.y+37,this._display.nextEffectTxt.text=this._skillLvArr[i-1]<this._skillMaxLvArr[i-1]?this._nextEffectArr[i-1]:"当前已是最高等级",this._skillLvArr[i-1]<this._skillMaxLvArr[i-1]?(this._display.nextPowerTxt.y=this._display.nextEffectTxt.y+this._display.nextEffectTxt.textHeight+2,this._display.nextPowerTxt.text="下级战力："+this._nextPowerArr[i-1],this._display.closeTxt.y=this._display.nextPowerTxt.y+this._display.nextPowerTxt.textHeight+8):(this._display.nextPowerTxt.text="",this._display.closeTxt.y=this._display.nextEffectTxt.y+this._display.nextEffectTxt.textHeight+8),this._display.infoBg.height=this._display.closeTxt.y+70,this._display.skillInfo.y+this._display.infoBg.height>t.LayerMgr.height+t.LayerMgr.offY&&(this._display.skillInfo.y-=this._display.skillInfo.y+this._display.infoBg.height-(t.LayerMgr.height+t.LayerMgr.offY)),this._canClickStageToCloseInfo||Laya.timer.frameOnce(1,this,this.liveStageClick))},s.prototype.liveStageClick=function(){this._canClickStageToCloseInfo=!0},s.prototype.stageClickHandler=function(t){this._canClickStageToCloseInfo&&t.target!=this._display.skillBg1&&t.target!=this._display.skillBg2&&t.target!=this._display.skillBg3&&(this._display.skillInfo.visible=!1,this._canClickStageToCloseInfo=!1,this._nowShowSkillIndex=0)},s.prototype.refreshDataAfterUpdate=function(t){this.queryWushuHallHandler(t)},s.prototype.setLearnPngScale=function(){(this._display.learnPng1.visible||this._display.learnPng2.visible||this._display.learnPng3.visible)&&(this._learnPngScaleValue+=this._learnPngScaleStep,130!=this._learnPngScaleValue&&100!=this._learnPngScaleValue||(this._learnPngScaleStep*=-1),this._display.learnPng1.scaleX=this._display.learnPng1.scaleY=this._learnPngScaleValue/100,this._display.learnPng2.scaleX=this._display.learnPng2.scaleY=this._learnPngScaleValue/100,this._display.learnPng3.scaleX=this._display.learnPng3.scaleY=this._learnPngScaleValue/100)},s.prototype.setBarMcWord=function(){this._setBarMcWordIndex++;for(var e=1;3>=e;e++){var i=t.FactionConfig.getWuguanConfig(this._lvArr[e-1]);this._expArr[e-1]<i.updateNeedExp?this._display["expTxt"+e].text=this._expArr[e-1]+"/"+i.updateNeedExp:this._lvArr[e-1]>=t.FactionConfig.MAX_WUSHU_LV?this._display["expTxt"+e].text="已满级":this._display["expTxt"+e].text=this._setBarMcWordIndex%2==0?this._expArr[e-1]+"/"+i.updateNeedExp:"可升级"}},s.prototype.destroy=function(){this._fightData=null,t.removeListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.fightComplete),this._skillNameArr=null,this._display.modelArea1.off(Laya.Event.CLICK,this,this.modelAreaClickHandler),this._display.modelArea2.off(Laya.Event.CLICK,this,this.modelAreaClickHandler),this._display.modelArea3.off(Laya.Event.CLICK,this,this.modelAreaClickHandler),this._display.ruleImage.off(Laya.Event.CLICK,this,this.showRule),this._display.updatePng1.off(Laya.Event.CLICK,this,this.updatePngClick),this._display.updatePng2.off(Laya.Event.CLICK,this,this.updatePngClick),this._display.updatePng3.off(Laya.Event.CLICK,this,this.updatePngClick),this._display.learnPng1.off(Laya.Event.CLICK,this,this.learnPngClick),this._display.learnPng2.off(Laya.Event.CLICK,this,this.learnPngClick),this._display.learnPng3.off(Laya.Event.CLICK,this,this.learnPngClick),this._display.skillBg1.off(Laya.Event.CLICK,this,this.skillBgClick),this._display.skillBg2.off(Laya.Event.CLICK,this,this.skillBgClick),this._display.skillBg3.off(Laya.Event.CLICK,this,this.skillBgClick),Laya.timer.clear(this,this.changeAngel),Laya.timer.clear(this,this.setLearnPngScale),Laya.timer.clear(this,this.setBarMcWord),Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.stageMouseDownHandler),Laya.stage.off(Laya.Event.CLICK,this,this.stageClickHandler),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.stageMouseUpHandler),this.skeleton_fight&&(this.skeleton_fight.destroy(),this.skeleton_fight=null),this.npcBack_djSk1&&(this.npcBack_djSk1.destroy(),this.npcBack_djSk1=null),this.npcBack_djSk2&&(this.npcBack_djSk2.destroy(),this.npcBack_djSk2=null),this.npcBack_djSk3&&(this.npcBack_djSk3.destroy(),this.npcBack_djSk3=null),this.npcBack_select__djSk&&(this.npcBack_select__djSk.destroy(),this.npcBack_select__djSk=null),this.skeleton_npc1&&(this.skeleton_npc1.off(Laya.Event.STOPPED,this,this.npcActioinStop),this.skeleton_npc1.destroy(),this.skeleton_npc1=null),this.skeleton_npc2&&(this.skeleton_npc2.off(Laya.Event.STOPPED,this,this.npcActioinStop),this.skeleton_npc2.destroy(),this.skeleton_npc2=null),this.skeleton_npc3&&(this.skeleton_npc3.off(Laya.Event.STOPPED,this,this.npcActioinStop),this.skeleton_npc3.destroy(),this.skeleton_npc3=null),this._lvArr=null,this._expArr=null,this._typeArr=null,this._effectArr=null,this._nextEffectArr=null,this._skillLvArr=null,this._skillMaxLvArr=null,this._powerArr=null,this._nextPowerArr=null,i.prototype.destroy.call(this)},s}(t.BaseBox);t.FactionWuguanScene=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.faction.faction.RecruitUI,!0,!0),this._applyCordition=-1,this._pubCDTime=0,this._facMemberNum=0,this._isLeftDown=!1,this._isRightDown=!1,this.hasDoRecruit=!1,this.display=this.skin,this.name="FactionRecruitBox",this.setCloseButton(this.display.back.closeBtn),this.display.roleBox.visible=!1,this.list=new laya.ui.List,this.list.vScrollBarSkin="ui/comp/vscroll.png",this.list.scrollBar.visible=!1,this.list.renderHandler=Handler.create(this,this.updateItem,null,!1),this.list.itemRender=i,this.display.addChild(this.list),this.list.x=508,this.list.y=136,this.list.repeatX=1,this.list.repeatY=4,this.list.spaceX=0,this.list.spaceY=5,this.list.array=[];var n=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);if(this.applyCordition=n.applyCordition,this.applyNeedLv=n.applyNeedLv,this._oriApplyCordition=n.applyCordition,this._oriApplyNeedLv=n.applyNeedLv,this._facMemberNum=n.members.length,this.display.settingBtn.on(Laya.Event.CLICK,this,this.settingRecruit),this.display.clearAllBtn.on(Laya.Event.CLICK,this,this.clearAllApply),this.display.checkBox0.clickHandler=new Handler(this,this.checkBoxChange,[this.display.checkBox0]),this.display.checkBox1.clickHandler=new Handler(this,this.checkBoxChange,[this.display.checkBox1]),this.display.checkBox2.clickHandler=new Handler(this,this.checkBoxChange,[this.display.checkBox2]),this.display.leftBtn.on(Laya.Event.MOUSE_DOWN,this,this.leftBtnDownHandler),this.display.rightBtn.on(Laya.Event.MOUSE_DOWN,this,this.rightBtnDownHandler),this.getApplyList(),t.EventCenter.singleton.on("DEL_OR_AGREE_FAC_APPLY",this,this.delOrAgreeFacApply),0!=s.lastPubTime){var a=Math.round(t.ServerClock.getServerTime()/1e3);s.lastPubTime-a>1&&(this._pubCDTime=s.lastPubTime-a,this.display.settingBtn.label="发布招募（"+this._pubCDTime+"）",Laya.timer.loop(1e3,this,this.cdPubTime),this.display.settingBtn.filters=t.FiltersUtils.getGreyFilters())}}return __extends(s,e),s.prototype.updateItem=function(t,e){e<=this.list.array.length-1&&t.doRender(this.list.array[e],e)},s.prototype.checkBoxChange=function(t){switch(t){case this.display.checkBox0:this.applyCordition=0;break;case this.display.checkBox1:this.applyCordition=1;break;case this.display.checkBox2:this.applyCordition=2}},Object.defineProperty(s.prototype,"applyCordition",{set:function(t){this._applyCordition!=t?(this._applyCordition>=0&&(this.display["checkBox"+this._applyCordition].selected=!1),this._applyCordition=t,this.display["checkBox"+this._applyCordition].selected=!0):this.display["checkBox"+this._applyCordition].selected=!0},enumerable:!0,configurable:!0}),s.prototype.leftBtnDownHandler=function(){this.delNeedLv(),this._isLeftDown=!0,Laya.timer.loop(50,this,this.timeLoop),t.LayerMgr.getStage().on(Laya.Event.MOUSE_UP,this,this.stageMouseUpHandler)},s.prototype.delNeedLv=function(){this._applyNeedLv>t.UserModel.NEED_USERLV_FACTION&&(this.applyNeedLv=this._applyNeedLv-1)},s.prototype.rightBtnDownHandler=function(){this.addNeedLv(),this._isRightDown=!0,Laya.timer.loop(50,this,this.timeLoop),t.LayerMgr.getStage().on(Laya.Event.MOUSE_UP,this,this.stageMouseUpHandler)},s.prototype.addNeedLv=function(){this._applyNeedLv<100&&(this.applyNeedLv=this._applyNeedLv+1)},s.prototype.stageMouseUpHandler=function(){this._isLeftDown=!1,this._isRightDown=!1},s.prototype.timeLoop=function(){this._isLeftDown?this.delNeedLv():this._isRightDown&&this.addNeedLv()},Object.defineProperty(s.prototype,"applyNeedLv",{set:function(e){this._applyNeedLv=e,this.display.needLvTxt.text=e+"级",this.display.leftBtn.filters=e==t.UserModel.NEED_USERLV_FACTION?t.FiltersUtils.getGreyFilters():null,this.display.rightBtn.filters=100==e?t.FiltersUtils.getGreyFilters():null},enumerable:!0,configurable:!0}),s.prototype.getApplyList=function(){t.XHR().Post({file:"petpk",cmd:"faction",op:"applylist",uid:t.Global.UID},this,this.getApplyListHandler)},s.prototype.getApplyListHandler=function(e){this.destroyed||(0==e.result?(this.list.array=e.applicants,0==this.list.array.length?(this.display.clearAllBtn.filters=t.FiltersUtils.getGreyFilters(),this.display.roleBox.visible=!0):(this.display.clearAllBtn.filters=null,this.display.roleBox.visible=!1)):(t.WeakTips.show("获取申请列表失败，"+e.msg),this.display.clearAllBtn.filters=t.FiltersUtils.getGreyFilters()))},s.prototype.settingRecruit=function(){if(0==this._pubCDTime){var e=new t.ConfirmBoxData({callBackHandler:Handler.create(this,this.doPub),contentStr:"发布招募后，七天内其他玩家可在帮派列表内找到本帮，是否确认？"});t.ConfirmBox.show(e)}},s.prototype.doPub=function(){t.XHR().Post({file:"petpk",cmd:"faction",op:"setting",join_level:this._applyNeedLv,join_type:this._applyCordition,pub:1,uid:t.Global.UID},this,this.doPubHandler)},s.prototype.doPubHandler=function(e){if(!this.destroyed)if(0==e.result){t.WeakTips.show("发布招募信息成功，七天内本帮将会出现在推荐列表内");var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);i.applyCordition=this._applyCordition,i.applyNeedLv=this._applyNeedLv,this._oriApplyCordition=this._applyCordition,this._oriApplyNeedLv=this._applyNeedLv,i.updateFinish(),s.lastPubTime=Math.round(t.ServerClock.getServerTime()/1e3)+60,this.destroy()}else t.WeakTips.show("发布失败，"+e.msg)},s.prototype.delOrAgreeFacApply=function(e){if(!this.destroyed){1==e.isAgree?this._facMemberNum++:this._facMemberNum--;var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);if(this._facMemberNum>=t.FactionConfig.getBaseHallConfig(i.facLv).maxMember)t.WeakTips.show("帮派人数已满"),this.destroy();else{this.hasDoRecruit=!0;for(var s=this.list.array,n=s.length,a=0;n>a;a++){var o=s[a];if(o.uid==e.uid){s.splice(a,1);break}}this.list.array=s,0==this.list.array.length?(this.display.clearAllBtn.filters=t.FiltersUtils.getGreyFilters(),this.display.roleBox.visible=!0):(this.display.clearAllBtn.filters=null,this.display.roleBox.visible=!1)}}},s.prototype.clearAllApply=function(){if(null==this.display.clearAllBtn.filters){var e=new t.ConfirmBoxData({contentStr:"确定要清空所有吗？",callBackHandler:Handler.create(this,this.doClearAllApply)});t.ConfirmBox.show(e)}},s.prototype.doClearAllApply=function(){t.XHR().Post({file:"petpk",cmd:"faction",op:"auditing",type:"refuse",puid:0,uid:t.Global.UID},this,this.clearAllApplyHandler)},s.prototype.clearAllApplyHandler=function(e){this.destroyed||(0==e.result?(t.WeakTips.show("操作成功"),this.list.array=[],this.display.clearAllBtn.filters=t.FiltersUtils.getGreyFilters(),this.display.roleBox.visible=!0):t.WeakTips.show("操作失败，"+e.msg))},s.prototype.cdPubTime=function(){this._pubCDTime--,this._pubCDTime>0?this.display.settingBtn.label="发布招募（"+this._pubCDTime+"）":(this.display.settingBtn.label="发布招募",Laya.timer.clear(this,this.cdPubTime),this.display.settingBtn.filters=null)},s.prototype.destroy=function(){Laya.timer.clear(this,this.cdPubTime),t.EventCenter.singleton.off("DEL_OR_AGREE_FAC_APPLY",this,this.delOrAgreeFacApply),this.display.settingBtn.off(Laya.Event.CLICK,this,this.settingRecruit),this.display.clearAllBtn.off(Laya.Event.CLICK,this,this.clearAllApply),this.display.checkBox0.clickHandler=null,this.display.checkBox1.clickHandler=null,this.display.checkBox2.clickHandler=null,this.display.leftBtn.off(Laya.Event.MOUSE_DOWN,this,this.leftBtnDownHandler),this.display.rightBtn.off(Laya.Event.MOUSE_DOWN,this,this.rightBtnDownHandler),t.LayerMgr.getStage().off(Laya.Event.MOUSE_UP,this,this.stageMouseUpHandler),Laya.timer.clear(this,this.timeLoop),this.list&&(this.list.destroy(),this.list=null),this.display=null,e.prototype.destroy.call(this)},s.lastPubTime=0,s}(t.BaseBox);t.RecruitBox=e;var i=function(e){function i(){e.call(this),this.deleteBtn.on(Laya.Event.CLICK,this,this.delItem),this.agreeBtn.on(Laya.Event.CLICK,this,this.agreeItem),this.playerInfo.headBg.on(Laya.Event.CLICK,this,this.headBgClickHandler),this.playerInfo.maleIcon.visible=!1,this.playerInfo.femaleIcon.visible=!1}return __extends(i,e),i.prototype.doRender=function(e,i){this._uid=e.uid,this.nameTxt.text=e.name,this.playerInfo.tfLvl.text=e.level,this.playerInfo.tfVip.text=""+e.viplvl,this.strengTxt.text=e.power,this.playerInfo.photo.loadImage(t.JSUtils.getHeadUrl(e.headurl),0,0,82,82),1==Number(e.sex)?(this.playerInfo.maleIcon.visible=!0,this.playerInfo.femaleIcon.visible=!1,this.playerInfo.defaultHead.skin="ui/main/male.png"):(this.playerInfo.maleIcon.visible=!1,this.playerInfo.femaleIcon.visible=!0,this.playerInfo.defaultHead.skin="ui/main/female.png")},i.prototype.delItem=function(){this._isAgree=!1,t.XHR().Post({file:"petpk",cmd:"faction",op:"auditing",type:"refuse",puid:this._uid,uid:t.Global.UID},this,this.doHandler)},i.prototype.agreeItem=function(){this._isAgree=!0,t.XHR().Post({file:"petpk",cmd:"faction",op:"auditing",type:"agree",puid:this._uid,uid:t.Global.UID},this,this.doHandler)},i.prototype.doHandler=function(e){0==e.result?t.EventCenter.singleton.event("DEL_OR_AGREE_FAC_APPLY",{uid:this._uid,isAgree:this._isAgree}):t.WeakTips.show("操作失败，"+e.msg)},i.prototype.headBgClickHandler=function(){t.Facade.callCommand(new t.UserInfoCommand(this._uid))},i.prototype.destroy=function(){this.deleteBtn.off(Laya.Event.CLICK,this,this.delItem),this.agreeBtn.off(Laya.Event.CLICK,this,this.agreeItem),this.playerInfo.headBg.off(Laya.Event.CLICK,this,this.headBgClickHandler),e.prototype.destroy.call(this)},i}(ui.faction.faction.RecruitItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.faction.faction.SmritiFactionBoxUI,!0,!0),this._facNameStr="",this._display=this.skin,this.name="CreateFactionBox",this.setCloseButton(this._display.closeBtn);var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);this._facIconMax=10;for(var s=1;10>=s;s++){var n=t.FactionConfig.getTotemObj(4,s-1);if(n.needLv>i.facLv){this._facIconMax=s-1;break}}this._display.facNameTxt.text=i.facName,this._display.smritiBtn.on(Laya.Event.CLICK,this,this.smritiBtnClickHandler),
this.facIconIndex=i.facIcon,this._display.leftImage.on(Laya.Event.CLICK,this,this.leftClickHandler),this._display.rightImage.on(Laya.Event.CLICK,this,this.rightClickHandler);var a=100;this._display.createNeedTxt.text=String(a)+"（当前：";var o=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).doubi;o>=a?(this._display.writeTxt.visible=!0,this._display.redTxt.visible=!1,this._display.writeTxt.text=o+"",this._display.writeTxt.x=this._display.createNeedTxt.x+this._display.createNeedTxt.textWidth+3,this._display.kuoHaoTxt.x=this._display.writeTxt.x+this._display.writeTxt.textWidth+3):(this._display.writeTxt.visible=!1,this._display.redTxt.visible=!0,this._display.redTxt.text=o+"",this._display.redTxt.x=this._display.createNeedTxt.x+this._display.createNeedTxt.textWidth+3,this._display.kuoHaoTxt.x=this._display.redTxt.x+this._display.redTxt.textWidth+3)}return __extends(i,e),i.prototype.smritiBtnClickHandler=function(e){t.XHR().Post({file:"petpk",cmd:"faction",op:"inherit",need_member:1,icon:this._facIconIndex,uid:t.Global.UID},this,this.smritiFactionHandler)},i.prototype.smritiFactionHandler=function(e){if(0==e.result){t.WeakTips.show("传承帮派成功！"),t.Facade.callCommand(new t.SyncChangeCmd(e));var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);i.setData(e),this.destroy()}else t.WeakTips.show("传承帮派失败，"+e.msg)},i.prototype.leftClickHandler=function(){this.facIconIndex=this._facIconIndex>1?this._facIconIndex-1:this._facIconMax},i.prototype.rightClickHandler=function(){this.facIconIndex=this._facIconIndex<this._facIconMax?this._facIconIndex+1:1},Object.defineProperty(i.prototype,"facIconIndex",{set:function(t){this._facIconIndex=t;for(var e=1;3>=e;e++)this._display.facIconPng.skin="ui/faction/factionScene/facIcon"+this._facIconIndex+".png"},enumerable:!0,configurable:!0}),i.prototype.destroy=function(){this._display.smritiBtn.off(Laya.Event.CLICK,this,this.smritiBtnClickHandler),this._display.leftImage.off(Laya.Event.CLICK,this,this.leftClickHandler),this._display.rightImage.off(Laya.Event.CLICK,this,this.rightClickHandler),e.prototype.destroy.call(this)},i}(t.BaseBox);t.SmritiFactionBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i,s){e.call(this,new ui.faction.faction.UpdateUI,!0,!0),this.moviePath_shengji="assets/skeleton/faction/juyiting_shengji.sk",this.hasUpdateBaseHall=!1,this._display=this.skin,this.name="FactionUpdateBox",this.setCloseButton(this._display.back.closeBtn),this.cacheAs="none",this._display.mainLayer.cacheAs="bitmap",this._display.expTxt.style.fontSize=20,this._display.expTxt.style.color="#FFFFFF",this._display.expTxt.style.align="center",this._display.expTxt.style.bold=!0,this._display.expTxt.style.stroke=4,this._display.expTxt.style.strokeColor="#000000",this._display.baseHallPng.visible=!1,this._display.practicePng.visible=!1,this._display.updateBtn.on(Laya.Event.CLICK,this,this.updateBtnClick),this._maxWidth=this._display.barMc.width,this._type=i,this._nowLv=s.lv,this._data=s,i==t.FactionConfig.BUILDING_WUSHU&&(this._wushuIndex=s.index);var n=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);n.on(t.ModelEvent.UPDATE_FINISH,this,this.facModelUpdateFinish),t.XHR().Post({file:"petpk",cmd:"faction",op:"query",uid:t.Global.UID},this,this.queryFactionHandler)}return __extends(i,e),i.prototype.setData=function(){var e,i,s,n=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);if(this._type==t.FactionConfig.BUILDING_PRACTICE){this._display.practicePng.visible=!0,this._maxLv=t.FactionConfig.MAX_PRACTICE_LV,this._display.expName.text="繁荣",this._display.lvTxt.text="修炼馆"+this._nowLv+"级";var a=t.FactionConfig.getPracticeHallConfig(this._nowLv);this._display.updateCorditionTxt.text=this._nowLv==this._maxLv?"无":"聚义厅"+a.updateNeedBaseHallLv+"级",this._display.updateCorditionTxt.color=this._nowLv<this._maxLv&&a.updateNeedBaseHallLv>n.facLv?"#FF0000":"#7D5845",this.setBar(n.res_fanrong,a.updateNeedFanrong),e=a.updateNeedWood,i=a.updateNeedStone,s=a.updateNeedIron,this._display.nowMsgTxt.text=a.desc,this._display.nextMsgTxt.text=this._nowLv==this._maxLv?"当前已是最高等级":t.FactionConfig.getPracticeHallConfig(this._nowLv+1).desc}if(this._type==t.FactionConfig.BUILDING_BASEHALL){this._display.baseHallPng.visible=!0,this._maxLv=t.FactionConfig.MAX_BASEHALL_LV,this._display.expName.text="繁荣",this._nowLv=n.facLv,this._display.lvTxt.text="聚义厅"+this._nowLv+"级",this._display.updateCorditionTxt.text="无",this._display.updateCorditionTxt.color="#7D5845";var o=t.FactionConfig.getBaseHallConfig(this._nowLv);this.setBar(n.res_fanrong,o.updateNeedFanrong),e=o.updateNeedWood,i=o.updateNeedStone,s=o.updateNeedIron,this._display.nowMsgTxt.text=o.desc,this._display.nextMsgTxt.text=this._nowLv==this._maxLv?"当前已是最高等级":t.FactionConfig.getBaseHallConfig(this._nowLv+1).desc}else if(this._type==t.FactionConfig.BUILDING_WUSHU){if(!this.skeleton_wuguanNpc){var r=1==this._wushuIndex?"monster_lixiaolong":2==this._wushuIndex?"monster_yewen":"monster_yongcun";this.skeleton_wuguanNpc=new t.AnimationSKe("assets/skeleton/faction/factionWuguan/"+r+".sk"),this._display.movieContainer.addChild(this.skeleton_wuguanNpc),this.skeleton_wuguanNpc.on(Laya.Event.STOPPED,this,this.npcActioinStop,[this.skeleton_wuguanNpc]),this.npcActioinStop(this.skeleton_wuguanNpc),this.skeleton_wuguanNpc.x=412,this.skeleton_wuguanNpc.y=450}this._maxLv=t.FactionConfig.MAX_WUSHU_LV,this._display.expName.text="繁荣",this._display.lvTxt.text=["力量武馆","筋骨武馆","速度武馆"][this._wushuIndex-1]+this._nowLv+"级";var h=t.FactionConfig.getWuguanConfig(this._nowLv);this._display.updateCorditionTxt.text=this._nowLv==this._maxLv?"无":"聚义厅"+h.updateNeedBaseHallLv+"级",this._display.updateCorditionTxt.color=this._nowLv<this._maxLv&&h.updateNeedBaseHallLv>n.facLv?"#FF0000":"#7D5845",this.setBar(n.res_fanrong,h["updateNeedFanrong"+this._wushuIndex]),e=h["updateNeedWood"+this._wushuIndex],i=h["updateNeedStone"+this._wushuIndex],s=h["updateNeedIron"+this._wushuIndex],this._display.nowMsgTxt.text=h["desc"+this._wushuIndex],this._display.nextMsgTxt.text=this._nowLv==this._maxLv?"当前已是最高等级":t.FactionConfig.getWuguanConfig(this._nowLv+1)["desc"+this._wushuIndex]}this._display.needWoodTxt.text=""+e,this._display.needStoneTxt.text=""+i,this._display.needIronTxt.text=""+s;var n=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);this._display.woodNumTxt.color=e>n.res_wood?"#FF0000":"#7D5845",this._display.stoneNumTxt.color=i>n.res_stone?"#FF0000":"#7D5845",this._display.ironNumTxt.color=s>n.res_iron?"#FF0000":"#7D5845"},i.prototype.npcActioinStop=function(t){var e=Math.floor(3*Math.random())+1;t.play(e,!1)},i.prototype.setBar=function(t,e){if(0==e)this._display.expTxt.innerHTML=t+"/"+e,this._display.barMc.width=this._maxWidth,this._display.barMc.visible=!0;else{e>t?this._display.expTxt.innerHTML="<font color='#FF0000'>"+t+"</font>/"+e:this._display.expTxt.innerHTML=t+"/"+e;var i=this._maxWidth*t/e;i>=this._maxWidth?(i=this._maxWidth,this._canUpdate=!0):this._canUpdate=!1,this._display.barMc.width=i,this._display.barMc.visible=0!=i}},i.prototype.queryFactionHandler=function(e){var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);0==e.result?i.setData(e):this.facModelUpdateFinish()},i.prototype.facModelUpdateFinish=function(){var e=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);this._display.woodNumTxt.text=String(e.res_wood),this._display.stoneNumTxt.text=String(e.res_stone),this._display.ironNumTxt.text=String(e.res_iron),this.setData()},i.prototype.updateBtnClick=function(){var e=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);if(e.selfFactionUserModel.position>=t.FactionConfig.updateBuildingPos)if(this._canUpdate){var i=t.FactionConfig.getConfigByType(this._nowLv,this._type),s=3==this._type?i["updateNeedFanrong"+this._wushuIndex]:i.updateNeedFanrong,n=3==this._type?i["updateNeedWood"+this._wushuIndex]:i.updateNeedWood,a=3==this._type?i["updateNeedStone"+this._wushuIndex]:i.updateNeedStone,o=3==this._type?i["updateNeedIron"+this._wushuIndex]:i.updateNeedIron;this._nowLv>=this._maxLv?t.WeakTips.show("当前已经是最高等级了"):i.updateNeedBaseHallLv>e.facLv?t.WeakTips.show("帮派聚义厅等级不足"):s>e.res_fanrong?t.WeakTips.show("帮派繁荣度不足"):n>e.res_wood?t.WeakTips.show("帮派木材不足"):a>e.res_stone?t.WeakTips.show("帮派石头不足"):o>e.res_iron?t.WeakTips.show("帮派铁矿不足"):this.updateBuilding()}else{var r=this._type==t.FactionConfig.BUILDING_WUSHU?"该武馆经验值不足":"帮派繁荣度不足";t.WeakTips.show(r)}else t.Facade.callCommand(new t.ShowChangeRewardCmd(["仅"+t.FactionConfig.updateBuildingName+"以上能升级"],200,"#ffec49"))},i.prototype.updateBuilding=function(){var e=this._type==t.FactionConfig.BUILDING_WUSHU?this._type+this._wushuIndex-1:this._type;t.XHR().Post({file:"petpk",cmd:"faction",op:"lvlupbuilding",type:e,uid:t.Global.UID},this,this.updateBuildingHandler)},i.prototype.updateBuildingHandler=function(e){if(0==e.result){t.WeakTips.show("升级成功"),t.Facade.callCommand(new t.SyncChangeCmd(e));var i=t.FactionConfig.getConfigByType(this._nowLv,this._type),s=3==this._type?i["updateNeedFanrong"+this._wushuIndex]:i.updateNeedFanrong,n=3==this._type?i["updateNeedWood"+this._wushuIndex]:i.updateNeedWood,a=3==this._type?i["updateNeedStone"+this._wushuIndex]:i.updateNeedStone,o=3==this._type?i["updateNeedIron"+this._wushuIndex]:i.updateNeedIron,r=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);r.res_fanrong-=s,r.res_stone-=a,r.res_wood-=n,r.res_iron-=o,this._type==t.FactionConfig.BUILDING_PRACTICE&&this.event("update_practice",e),this._type==t.FactionConfig.BUILDING_BASEHALL?(r.facLv++,this.hasUpdateBaseHall=!0):this._type==t.FactionConfig.BUILDING_WUSHU&&(this._data.exp=0,this.event("update_wushu",e),r.setReddot(t.FactionReddotEnum.kFactionRedDotTypeMClubUpgrade,!0)),this._nowLv++,this.setData(),r.updateFinish(),this.skeleton_shengji||(this.skeleton_shengji=new t.AnimationSKe(this.moviePath_shengji),this._display.movieContainer.addChild(this.skeleton_shengji),this.skeleton_shengji.on(Laya.Event.STOPPED,this,this.moviePlayOver),this.skeleton_shengji.x=415,this.skeleton_shengji.y=516),this.skeleton_shengji.visible=!0,this.skeleton_shengji.play(0,!1)}else t.WeakTips.show("升级失败，"+e.msg)},i.prototype.moviePlayOver=function(){this.skeleton_shengji&&(this.skeleton_shengji.visible=!1)},i.prototype.destroy=function(){var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);i.off(t.ModelEvent.UPDATE_FINISH,this,this.facModelUpdateFinish),this.skeleton_shengji&&(this.skeleton_shengji.off(Laya.Event.STOPPED,this,this.moviePlayOver),this.skeleton_shengji.destroy(),this.skeleton_shengji=null),this.skeleton_wuguanNpc&&(this.skeleton_wuguanNpc.off(Laya.Event.STOPPED,this,this.npcActioinStop),this.skeleton_wuguanNpc.destroy(),this.skeleton_wuguanNpc=null),this._data=null,this._display.updateBtn.off(Laya.Event.CLICK,this,this.updateBtnClick),Laya.loader.clearRes("assets/skeleton/faction/juyiting_shengji.sk"),e.prototype.destroy.call(this)},i}(t.BaseBox);t.UpdateBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.faction.noFac.CreateFacBoxUI,!0,!0),this._facNameStr="",this._display=this.skin,this.name="CreateFactionBox",this.setCloseButton(this._display.closeBtn),this._display.facNameTxt.maxChars=7,this._display.facNameTxt.text="请输入帮派名称",this._display.facNameTxt.on(Laya.Event.FOCUS,this,this.onFocusIN),this._display.facNameTxt.on(Laya.Event.BLUR,this,this.onFocusOUT),this._display.facNameTxt.on(Laya.Event.INPUT,this,this.facNameTxtChange),this._display.createBtn.on(Laya.Event.CLICK,this,this.createBtnClickHandler),this.facIconIndex=1,this._display.leftImage.on(Laya.Event.CLICK,this,this.leftClickHandler),this._display.rightImage.on(Laya.Event.CLICK,this,this.rightClickHandler),this._display.createNeedTxt.text=String(i.create_cost)+"（当前：";var s=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).douyu;s>=i.create_cost?(this._display.writeTxt.visible=!0,this._display.redTxt.visible=!1,this._display.writeTxt.text=s+"",this._display.writeTxt.x=this._display.createNeedTxt.x+this._display.createNeedTxt.textWidth+3,this._display.kuoHaoTxt.x=this._display.writeTxt.x+this._display.writeTxt.textWidth+3):(this._display.writeTxt.visible=!1,this._display.redTxt.visible=!0,this._display.redTxt.text=s+"",this._display.redTxt.x=this._display.createNeedTxt.x+this._display.createNeedTxt.textWidth+3,this._display.kuoHaoTxt.x=this._display.redTxt.x+this._display.redTxt.textWidth+3)}return __extends(i,e),i.prototype.onFocusOUT=function(t){""==this._facNameStr&&(this._display.facNameTxt.color="#999999",this._display.facNameTxt.text="请输入帮派名称")},i.prototype.onFocusIN=function(t){"#999999"==this._display.facNameTxt.color&&(this._display.facNameTxt.color="#FFFFFF",this._display.facNameTxt.text="",this._facNameStr="")},i.prototype.facNameTxtChange=function(t){this._facNameStr=this._display.facNameTxt.text},i.prototype.CreateFactionBox=function(){t.XHR().Post({file:"petpk",cmd:"faction",op:"create",need_member:1,name:this._facNameStr,icon:this._facIconIndex,uid:t.Global.UID},this,this.createFactionHandler)},i.prototype.createBtnClickHandler=function(e){"#999999"==this._display.facNameTxt.color||""==this._display.facNameTxt.text?t.WeakTips.show("请先输入帮派名称"):t.PayConfirm.checkDouYu(i.create_cost,new Handler(this,this.CreateFactionBox))},i.prototype.createFactionHandler=function(e){if(0==e.result){t.WeakTips.show("创建帮派成功！！！"),t.Facade.callCommand(new t.SyncChangeCmd(e));var i=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);i.faction.facID=e.faction_base.facid;var s=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);s.setData(e),this.event("ENTER_FACTION_SCENE")}else t.WeakTips.show("创建失败，"+e.msg)},i.prototype.leftClickHandler=function(){this.facIconIndex=this._facIconIndex>1?this._facIconIndex-1:3},i.prototype.rightClickHandler=function(){this.facIconIndex=this._facIconIndex<3?this._facIconIndex+1:1},Object.defineProperty(i.prototype,"facIconIndex",{set:function(t){this._facIconIndex=t;for(var e=1;3>=e;e++)this._display.facIcon["facIcon"+e].visible=t==e},enumerable:!0,configurable:!0}),i.prototype.destroy=function(){this._display.facNameTxt.off(Laya.Event.FOCUS,this,this.onFocusIN),this._display.facNameTxt.off(Laya.Event.BLUR,this,this.onFocusOUT),this._display.facNameTxt.off(Laya.Event.INPUT,this,this.facNameTxtChange),this._display.createBtn.off(Laya.Event.CLICK,this,this.createBtnClickHandler),this._display.leftImage.off(Laya.Event.CLICK,this,this.leftClickHandler),this._display.rightImage.off(Laya.Event.CLICK,this,this.rightClickHandler),e.prototype.destroy.call(this)},i.create_cost=0,i}(t.BaseBox);t.CreateFactionBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.faction.noFac.FactionListUI,!0,!0),this._dragDirec=0,this._lastScrollValue=0,this._posY=-1,this.display=this.skin,this.name="FactionListBox",this.setCloseButton(this.display.back.closeBtn),this.display.searchFac.visible=!1,this.display.searchFac.downLoadingTxt.visible=this.display.searchFac.upLoadingTxt.visible=!1,this.display.searchFac.bg1.on(Laya.Event.CLICK,this,this.shoWSearchFacInfo),this.display.searchFac.bg2.on(Laya.Event.CLICK,this,this.shoWSearchFacInfo),this.display.searchFac.applyBtn.on(Laya.Event.CLICK,this,this.joinSearchFac),this.display.backToListBtn.visible=!1,this._getFacInfoPanelCmd=new t.GetFacInfoPanelCmd(0),this._getFacInfoPanelCmd.on(this,this.getFacInfoFinish),this.list=new laya.ui.List,this.list.vScrollBarSkin="ui/comp/vscroll.png",this.list.scrollBar.visible=!1,this.list.scrollBar.on(Laya.Event.CHANGE,this,this.scrollBarChange),this.list.scrollBar.elasticDistance=50,this.list.scrollBar.elasticBackTime=2e3,this.list.renderHandler=Handler.create(this,this.updateItem,null,!1),this.list.itemRender=i,this.display.addChild(this.list),this.list.x=242,this.list.y=125,this.list.repeatX=1,this.list.repeatY=5,this.list.spaceX=0,this.list.spaceY=2,this.list.height=446,this.list.array=[],this.list.visible=!1,this.display.createBtn.on(Laya.Event.CLICK,this,this.createBtnClickHandler),this.display.searchBtn.on(Laya.Event.CLICK,this,this.searchBtnClickHandler),this.display.backToListBtn.on(Laya.Event.CLICK,this,this.backToListBtnClickHandler),this.display.quickJoinBtn.on(Laya.Event.CLICK,this,this.quickJoinHandler),t.EventCenter.singleton.on("SHOW_FACINFO_BOX",this,this.showFacListInfo),t.EventCenter.singleton.on("JOIN_FACLIST_SUCCESS",this,this.joinFacListSueecss),t.EventCenter.singleton.on("JOIN_FACLIST_WAIT_APPLY",this,this.joinFacListWaitApply),this.getFacList(1e3*t.ServerClock.getServerTime(),1),this.display.red_quickJoin.visible=!1}return __extends(s,e),s.prototype.getFacList=function(e,i,s,n){void 0===s&&(s=20),void 0===n&&(n=!1),this._startGetTime=n?t.ServerClock.getServerTime():0,t.XHR().Post({file:"petpk",cmd:"faction",op:"recommand",ctime:e,direction:i,count:s,uid:t.Global.UID},this,this.getFacListHandler)},s.prototype.getFacListHandler=function(e){if(0==e.result&&e.hasOwnProperty("create_cash")&&(t.CreateFactionBox.create_cost=Number(e.create_cash)),!this.destroyed){var i=!1;if(0!=this._startGetTime){var s=t.ServerClock.getServerTime()-this._startGetTime;500>s&&(i=!0,this._bgModel||(this._bgModel=new Sprite,this._bgModel.graphics.drawRect(0,0,t.LayerMgr.width,t.LayerMgr.clientHeight,"#000000"),this._bgModel.alpha=0,this._bgModel.y=-t.LayerMgr.offY,this._bgModel.mouseEnabled=!0,this._bgModel.size(t.LayerMgr.width,t.LayerMgr.clientHeight)),this.display.addChild(this._bgModel),Laya.timer.once(500-s,this,this.showFacListData,[e]))}0==i&&this.showFacListData(e)}},s.prototype.showFacListData=function(e){if(this._bgModel&&this._bgModel.parent&&this.display.removeChild(this._bgModel),0==e.result){var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);i.setSelfData(e),0!=this._dragDirec&&0==e.recommend.length&&t.WeakTips.show("当前已无更多帮派信息");var n=this._dragDirec;this._dragDirec=0;var a=this.list.array;if(-1!=n)a=a.concat(e.recommend);else for(var o=0;o<e.recommend.length;o++)e.recommend[o].facid!=this._upFacID&&a.unshift(e.recommend[o]);this.list.array=a,this.list.visible=0!=a.length,this._lastScrollValue=this.list.scrollBar.value,this.list.scrollBar.stopScroll();var r=e.user_faction;s.selfApplyList=r.hasOwnProperty("applylist")?r.applylist:[],this.display.red_quickJoin.visible=0==s.selfApplyList.length,0==this.list.array.length&&(this.display.red_quickJoin.visible=!1)}else this._dragDirec=0,s.selfApplyList=[],113!=e.result&&t.WeakTips.show("获取推荐帮派列表失败，"+e.msg)},s.prototype.updateItem=function(t,e){e<=this.list.array.length-1&&t.doRender(this.list.array[e],e)},s.prototype.scrollBarChange=function(){if(this._posY=-1,this._getFacInfoPanelCmd.facInfoBox&&(this._getFacInfoPanelCmd.facInfoBox.visible=!1),0==this._dragDirec){if(this.list.scrollBar.value>this.list.scrollBar.max+20){if(this.list.scrollBar.value>this._lastScrollValue)for(var t=this.list.array[this.list.array.length-1].facid,e=0;e<this.list.cells.length;e++){var i=this.list.cells[e];if(i.getFacID()==t){i.showDownLoading(),this._dragDirec=1,this.getFacList(i.getCTime(),1,20,!0);break}}}else if(this.list.scrollBar.value<this.list.scrollBar.min-20&&this.list.scrollBar.value<this._lastScrollValue){var s=this.list.array[0].facid;this._upFacID=s;for(var e=0;e<this.list.cells.length;e++){var i=this.list.cells[e];if(i.getFacID()==s){i.showUpLoading(),this._dragDirec=-1,this.getFacList(i.getCTime(),2,20,!0);break}}}}else 1==this._dragDirec?this._lastScrollValue>this.list.scrollBar.value&&this._lastScrollValue<this.list.scrollBar.max+30&&(this.list.scrollBar.value=this._lastScrollValue):this._lastScrollValue<this.list.scrollBar.value&&this._lastScrollValue>this.list.scrollBar.min-30&&(this.list.scrollBar.value=this._lastScrollValue);this._lastScrollValue=this.list.scrollBar.value},s.prototype.createBtnClickHandler=function(e){this._getFacInfoPanelCmd.facInfoBox&&(this._getFacInfoPanelCmd.facInfoBox.visible=!1),t.Facade.callCommand(new t.OpenCreateFactionBoxCmd)},s.prototype.searchBtnClickHandler=function(e){this._getFacInfoPanelCmd.facInfoBox&&(this._getFacInfoPanelCmd.facInfoBox.visible=!1),t.Facade.callCommand(new t.OpenSearchFactionBoxCmd)},s.prototype.backToListBtnClickHandler=function(){this._getFacInfoPanelCmd.facInfoBox&&(this._getFacInfoPanelCmd.facInfoBox.visible=!1),this.display.searchFac.visible=!1,this.display.backToListBtn.visible=!1,this.list.visible=!0},s.prototype.showSearchFac=function(e){if(this._showFacData=e,this.display.searchFac.visible=!0,this.display.searchFac.facId.text=e.facid,this.display.searchFac.facName.text=e.name+"（"+e.level+"级）",this.display.searchFac.facNum.text="人员："+e.member_size+"/"+e.max_member,e.hasOwnProperty("fac_option")){var i=e.fac_option;this._searchJoinLevel=i.hasOwnProperty("join_level")?i.join_level:t.UserModel.NEED_USERLV_FACTION,this._searchJoinType=i.hasOwnProperty("join_type")?i.join_type:0}else this._searchJoinLevel=t.UserModel.NEED_USERLV_FACTION,this._searchJoinType=0;this._searchJoinLevel<t.UserModel.NEED_USERLV_FACTION&&(this._searchJoinLevel=t.UserModel.NEED_USERLV_FACTION),this.display.searchFac.facNeedLv.text=this._searchJoinLevel+"级",this.display.searchFac.facNeedApply.text=["自动通过","需审批通过","拒绝申请"][this._searchJoinType],this.display.backToListBtn.visible=!0,this.list.visible=!1,-1!=s.selfApplyList.indexOf(this.display.searchFac.facId.text)?(this.display.searchFac.applyBtn.label="已申请",this.display.searchFac.applyBtn.filters=t.FiltersUtils.getGreyFilters()):2==this._searchJoinType?(this.display.searchFac.applyBtn.label="拒绝申请",this.display.searchFac.applyBtn.filters=t.FiltersUtils.getGreyFilters()):e.member_size>=e.max_member?(this.display.searchFac.applyBtn.label="人员已满",this.display.searchFac.applyBtn.filters=t.FiltersUtils.getGreyFilters()):t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).level<this._searchJoinLevel?(this.display.searchFac.applyBtn.label="等级不足",this.display.searchFac.applyBtn.filters=t.FiltersUtils.getGreyFilters()):(this.display.searchFac.applyBtn.label="申请加入",this.display.searchFac.applyBtn.filters=null);var n=e.hasOwnProperty("using_totem")?e.using_totem:[],a=1;n.length>=4&&(a=0==n[3]?1:n[3]),this.display.searchFac.iconPng.skin="ui/faction/factionScene/facIcon"+a+".png"},s.prototype.shoWSearchFacInfo=function(){var e;e=this.display.searchFac.bg2.localToGlobal(new laya.maths.Point(0,0)),this._getFacInfoPanelCmd.setData(0,this._showFacData,0,e.y),t.Facade.callCommand(this._getFacInfoPanelCmd)},s.prototype.showFacListInfo=function(e){this._getFacInfoPanelCmd.facInfoBox&&this._getFacInfoPanelCmd.facInfoBox.visible&&this._posY==e.posY?this._getFacInfoPanelCmd.facInfoBox.visible=!1:(this._getFacInfoPanelCmd.setData(e.facid,null,0,e.posY),t.Facade.callCommand(this._getFacInfoPanelCmd))},s.prototype.getFacInfoFinish=function(e){0==e.ecode?this.showFactionBox(e.posY):(t.WeakTips.show("查询帮派详细信息失败，"+e.errorMsg),this._getFacInfoPanelCmd.facInfoBox.visible=!1)},s.prototype.showFactionBox=function(e){this._getFacInfoPanelCmd.facInfoBox&&this._getFacInfoPanelCmd.facInfoBox.visible&&this._posY==e?this._getFacInfoPanelCmd.facInfoBox.visible=!1:(this._getFacInfoPanelCmd.facInfoBox.visible=!0,this.display.addChild(this._getFacInfoPanelCmd.facInfoBox),this._getFacInfoPanelCmd.facInfoBox.x=300,this._posY=e),this._getFacInfoPanelCmd.facInfoBox.y=e-t.LayerMgr.offY,this._getFacInfoPanelCmd.facInfoBox.y+this._getFacInfoPanelCmd.facInfoBox.facInfo_bg.height>t.LayerMgr.height+t.LayerMgr.offY&&(this._getFacInfoPanelCmd.facInfoBox.y-=this._getFacInfoPanelCmd.facInfoBox.y+this._getFacInfoPanelCmd.facInfoBox.facInfo_bg.height-(t.LayerMgr.height+t.LayerMgr.offY))},s.prototype.joinSearchFac=function(){null!=this.display.searchFac.applyBtn.filters&&this.display.searchFac.applyBtn.filters!=[]||(2==this._searchJoinType?t.WeakTips.show("该帮派拒绝加入"):this.joinFac(this.display.searchFac.facId.text))},s.prototype.joinFac=function(e){var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);if(0==i.selfFactionUserModel.todayRemainApplyCount)t.WeakTips.show("您今日【申请加入】已达10次，【快速加入】不受限制！");else{var s=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);s.level<this._searchJoinLevel?t.WeakTips.show("您的等级不够"):t.XHR().Post({file:"petpk",cmd:"faction",op:"join",need_member:1,facid:e,uid:t.Global.UID},this,this.joinFactionHandler)}},s.prototype.quickJoinHandler=function(){t.XHR().Post({file:"petpk",cmd:"faction",op:"fastjoin",need_member:1,uid:t.Global.UID},this,this.joinFactionHandler)},s.prototype.joinFactionHandler=function(e){if(0==e.result){this.display.red_quickJoin.visible=!1;var i=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);if(e.hasOwnProperty("faction_base")){t.WeakTips.show("申请入帮成功！");var n=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);n.faction.facID=e.faction_base.facid,i.setData(e),t.Facade.callCommand(new t.SyncChangeCmd(e)),this.event("ENTER_FACTION_SCENE")}else i.selfFactionUserModel.todayRemainApplyCount--,t.WeakTips.show("申请成功，您今日还能申请"+i.selfFactionUserModel.todayRemainApplyCount+"次"),s.selfApplyList.push(this.display.searchFac.facId.text),this.list.array=this.list.array,this.display.searchFac.applyBtn.label="已申请",this.display.searchFac.applyBtn.filters=t.FiltersUtils.getGreyFilters()}else t.WeakTips.show("申请加入失败，"+e.msg)},s.prototype.joinFacListSueecss=function(t){this.event("ENTER_FACTION_SCENE")},s.prototype.joinFacListWaitApply=function(){this.display.red_quickJoin.visible=!1},s.prototype.destroy=function(){this._showFacData=null,s.selfApplyList=null,Laya.timer.clear(this,this.showFacListData),this._bgModel&&(this._bgModel.parent&&this.display.removeChild(this._bgModel),this._bgModel.destroy(),this._bgModel=null),this._getFacInfoPanelCmd&&(this._getFacInfoPanelCmd.off(),this._getFacInfoPanelCmd.destroy(),this._getFacInfoPanelCmd=null),t.EventCenter.singleton.off("SHOW_FACINFO_BOX",this,this.showFacListInfo),t.EventCenter.singleton.off("JOIN_FACLIST_SUCCESS",this,this.joinFacListSueecss),t.EventCenter.singleton.off("JOIN_FACLIST_WAIT_APPLY",this,this.joinFacListWaitApply),this.display.createBtn.off(Laya.Event.CLICK,this,this.createBtnClickHandler),this.display.searchBtn.off(Laya.Event.CLICK,this,this.searchBtnClickHandler),this.display.backToListBtn.off(Laya.Event.CLICK,this,this.backToListBtnClickHandler),this.display.quickJoinBtn.off(Laya.Event.CLICK,this,this.quickJoinHandler),this.display.searchFac.bg1.off(Laya.Event.CLICK,this,this.shoWSearchFacInfo),this.display.searchFac.bg2.off(Laya.Event.CLICK,this,this.shoWSearchFacInfo),this.display.searchFac.applyBtn.off(Laya.Event.CLICK,this,this.joinSearchFac),this.list&&(this.list.scrollBar&&this.list.scrollBar.off(Laya.Event.CHANGE,this,this.scrollBarChange),this.list.destroy(),this.list=null),this.display=null,e.prototype.destroy.call(this)},s}(t.BaseBox);t.FactionListBox=e;var i=function(i){function s(){i.call(this),this.bg1.on(Laya.Event.CLICK,this,this.showFacInfo),this.bg2.on(Laya.Event.CLICK,this,this.showFacInfo),this.applyBtn.on(Laya.Event.CLICK,this,this.joinFac)}return __extends(s,i),s.prototype.getFacID=function(){return this._obj?this._obj.facid:""},s.prototype.getCTime=function(){return Number(this._obj.ctime)},s.prototype.showDownLoading=function(){this.downLoadingTxt.visible=!0},s.prototype.showUpLoading=function(){this.upLoadingTxt.visible=!0},s.prototype.doRender=function(i,s){if(this.upLoadingTxt.visible=!1,this.downLoadingTxt.visible=!1,this._obj=i,s%2==0?(this.bg1.visible=!1,this.bg2.visible=!0):(this.bg2.visible=!1,this.bg1.visible=!0),this.facId.text=i.facid,this.facName.text=i.name+"（"+i.level+"级）",this.facNum.text="人员："+i.member_size+"/"+i.max_member,i.hasOwnProperty("fac_option")){var n=i.fac_option;this._joinLevel=n.hasOwnProperty("join_level")?n.join_level:t.UserModel.NEED_USERLV_FACTION,this._joinType=n.hasOwnProperty("join_type")?n.join_type:0}else this._joinLevel=t.UserModel.NEED_USERLV_FACTION,this._joinType=0;this._joinLevel<t.UserModel.NEED_USERLV_FACTION&&(this._joinLevel=t.UserModel.NEED_USERLV_FACTION),this.facNeedLv.text=this._joinLevel+"级",this.facNeedApply.text=["自动通过","需审批通过","拒绝申请"][this._joinType],-1!=e.selfApplyList.indexOf(this.facId.text)?(this.applyBtn.label="已申请",this.applyBtn.filters=t.FiltersUtils.getGreyFilters()):2==this._joinType?(this.applyBtn.label="拒绝申请",this.applyBtn.filters=t.FiltersUtils.getGreyFilters()):i.member_size>=i.max_member?(this.applyBtn.label="人员已满",this.applyBtn.filters=t.FiltersUtils.getGreyFilters()):t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).level<this._joinLevel?(this.applyBtn.label="等级不足",this.applyBtn.filters=t.FiltersUtils.getGreyFilters()):(this.applyBtn.label="申请加入",this.applyBtn.filters=null);var a=i.hasOwnProperty("using_totem")?i.using_totem:[],o=1;a.length>=4&&(o=0==a[3]?1:a[3]),this.iconPng.skin="ui/faction/factionScene/facIcon"+o+".png"},s.prototype.showFacInfo=function(){var e;e=this.bg1.localToGlobal(new laya.maths.Point(0,0)),t.EventCenter.singleton.event("SHOW_FACINFO_BOX",{facid:this._obj.facid,posY:e.y})},s.prototype.joinFac=function(){if(null==this.applyBtn.filters||this.applyBtn.filters==[]){var e=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);0==e.selfFactionUserModel.todayRemainApplyCount?t.WeakTips.show("您今日【申请加入】已达10次，【快速加入】不受限制！"):t.XHR().Post({file:"petpk",cmd:"faction",op:"join",need_member:1,facid:this._obj.facid,uid:t.Global.UID},this,this.joinFactionHandler)}},s.prototype.joinFactionHandler=function(i){if(0==i.result){var s=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);if(i.hasOwnProperty("faction_base")){t.WeakTips.show("申请加入成功。");var n=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);n.faction.facID=i.faction_base.facid,s.setData(i),t.Facade.callCommand(new t.SyncChangeCmd(i)),t.EventCenter.singleton.event("JOIN_FACLIST_SUCCESS")}else s.selfFactionUserModel.todayRemainApplyCount--,t.WeakTips.show("申请成功，您今日还能申请"+s.selfFactionUserModel.todayRemainApplyCount+"次"),e.selfApplyList.push(String(this._obj.facid)),this.applyBtn.label="已申请",this.applyBtn.filters=t.FiltersUtils.getGreyFilters(),t.EventCenter.singleton.event("JOIN_FACLIST_WAIT_APPLY")}else t.WeakTips.show("申请加入失败，"+i.msg)},s.prototype.destroy=function(){this.bg1.off(Laya.Event.CLICK,this,this.showFacInfo),this.bg2.off(Laya.Event.CLICK,this,this.showFacInfo),this.applyBtn.off(Laya.Event.CLICK,this,this.joinFac),i.prototype.destroy.call(this)},s}(ui.faction.noFac.FactionListItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.faction.noFac.SearchFacBoxUI,!0,!0),this.facIDStr="",this._display=this.skin,this.name="SearchFactionBox",this.setCloseButton(this._display.closeBtn),this._display.facIDTxt.restrict="0-9",this._display.facIDTxt.maxChars=12,this._display.facIDTxt.text="请输入帮派编号",this._display.facIDTxt.on(Laya.Event.FOCUS,this,this.onFocusIN),this._display.facIDTxt.on(Laya.Event.BLUR,this,this.onFocusOUT),this._display.facIDTxt.on(Laya.Event.INPUT,this,this.facIDTxtChange),this._display.searchBtn.on(Laya.Event.CLICK,this,this.searchBtnClickHandler)}return __extends(i,e),i.prototype.onFocusOUT=function(t){""==this.facIDStr&&(this._display.facIDTxt.color="#999999",this._display.facIDTxt.text="请输入帮派编号")},i.prototype.onFocusIN=function(t){"#999999"==this._display.facIDTxt.color&&(this._display.facIDTxt.color="#FFFFFF",this._display.facIDTxt.text="",this.facIDStr="")},i.prototype.facIDTxtChange=function(t){this.facIDStr=this._display.facIDTxt.text},i.prototype.searchBtnClickHandler=function(e){var i=this._display.facIDTxt.text;"#999999"==this._display.facIDTxt.color||""==i?t.WeakTips.show("请先输入帮派编号"):i.length<5?t.WeakTips.show("查无此帮，请确认帮派编号后重试！"):t.XHR().Post({
file:"petpk",cmd:"faction",op:"query",facid:i,uid:t.Global.UID},this,this.queryOtherFactionHandler)},i.prototype.queryOtherFactionHandler=function(e){0==e.result?this.event("SEARCH_FAC_SUCCESS",e.faction_appinfo):t.WeakTips.show("查询失败，"+e.msg)},i.prototype.destroy=function(){this._display.facIDTxt.off(Laya.Event.FOCUS,this,this.onFocusIN),this._display.facIDTxt.off(Laya.Event.BLUR,this,this.onFocusOUT),this._display.facIDTxt.off(Laya.Event.INPUT,this,this.facIDTxtChange),this._display.searchBtn.off(Laya.Event.CLICK,this,this.searchBtnClickHandler),e.prototype.destroy.call(this)},i}(t.BaseBox);t.SearchFactionBox=e}(hf||(hf={}));var hf;!function(t){var e=function(){function t(t){this._controller=t}return t}();t.BaseAction=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,t)}return __extends(i,e),i.prototype.start=function(t){this._curActionData=t,this._curActionData.assistantSkill>0?this.showAssistSkill():this.end()},i.prototype.showAssistSkill=function(){t.once(t.FightStaticStr.ASSIST_SKILL_ANI_OVER,this,this.end),t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:4,skill:this._curActionData.assistantSkill,side:this._curActionData.attacker.sideType,top:this._curActionData.attacker.playerData.npcData.top}),this._curActionData.attacker.playAssistSkill(this._curActionData)},i.prototype.end=function(){this._controller.dealAction()},i}(t.BaseAction);t.AssistantSkillAction=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,t)}return __extends(i,e),i.prototype.start=function(e){this._curActionData=e,this._curActionData.beforeActionSkill&&t.addListener(t.FightStaticStr.FIGHT_SHAM_DEAD_EFFECT,this,this.onShamDead),t.dispatch(t.FightStaticStr.EFFECT_ACTION,{action:this._curActionData,type:t.EffectController.EFFECT_BEFORE_ACTION,side:this._curActionData.attacker.sideType.toLowerCase()}),this._curActionData.beforeActionSkill||this.end()},i.prototype.onShamDead=function(){t.removeListener(t.FightStaticStr.FIGHT_SHAM_DEAD_EFFECT,this,this.onShamDead),t.addListener(t.FightStaticStr.FIGHTER_REACTION_ANI_OVER,this,this.end),this._curActionData.attacker.playReactionSkill(this._curActionData,this._curActionData.beforeActionSkill),t.dispatch(t.FightStaticStr.ADD_HP,{addNum:parseInt(this._curActionData.beforeActionSkillParam[2]),type:this._curActionData.attacker.sideType}),this._curActionData.attacker.playerData.curStateData.addHP(parseInt(this._curActionData.beforeActionSkillParam[2])),t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:7,side:this._curActionData.attacker.sideType,top:this._curActionData.attacker.playerData.npcData.top})},i.prototype.end=function(){t.removeListener(t.FightStaticStr.FIGHT_SHAM_DEAD_EFFECT,this,this.onShamDead),t.removeListener(t.FightStaticStr.FIGHTER_REACTION_ANI_OVER,this,this.end),this._controller.dealAction()},i}(t.BaseAction);t.BuffAction=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,t)}return __extends(i,e),i.prototype.start=function(e){t.addListener(t.FightStaticStr.FIGHT_DRAMA_START,this,this.onDrama),this._curActionData=e,t.ActionData.chainData.playChainSkill?(t.addListener(t.FightStaticStr.FIGHT_CHAIN_ANI_END,this,this.onAniEnd),t.dispatch(t.FightStaticStr.FIGHT_CHAIN_ANI)):this.end()},i.prototype.onDrama=function(e){var i=new t.PlayDramaCmd(e);i.on(this,this.onDramaFinish),t.Facade.callCommand(i)},i.prototype.onDramaFinish=function(e){e.off(),t.dispatch(t.FightStaticStr.FIGHT_DRAMA_END)},i.prototype.onAniEnd=function(){t.removeListener(t.FightStaticStr.FIGHT_CHAIN_ANI_END,this,this.onAniEnd),this._skeAni=new t.AnimationSKe(t.ResPath().getEffect("effect_combo")),this._skeAni.on(Laya.Event.ERROR,this,this.onStop),this._skeAni.once(Laya.Event.STOPPED,this,this.onStop),1==t.ActionData.chainData.skillLevel?this._skeAni.play("effect_pos_l",!1):2==t.ActionData.chainData.skillLevel?this._skeAni.play("effect_pos_m",!1):this._skeAni.play("effect_pos_h",!1),t.FightUIView.bottomSkillLayer.addChild(this._skeAni),this._skeAni.x=this._curActionData.attacker.x,this._skeAni.y=this._curActionData.attacker.y,this._skeAni.scaleX=this._curActionData.attacker.scaleX,this._skeAni.scaleY=this._curActionData.attacker.scaleY,1==this._curActionData.attacker.playerData.gender?this._skeAni.showSkinByName("male"):this._skeAni.showSkinByName("female"),this._curActionData.attacker.visible=!1},i.prototype.onStop=function(){t.FightUIView.bottomSkillLayer.removeChild(this._skeAni),this._skeAni.destroy(),this._skeAni=null,this._curActionData.attacker.visible=!0,t.FightModule.isChainDrama?(t.FightModule.isChainDrama=!1,t.once(t.FightStaticStr.FIGHT_DRAMA_END,this,this.end),t.dispatch(t.FightStaticStr.FIGHT_DRAMA_START,"1054")):this.end()},i.prototype.end=function(){this._controller.dealAction()},i}(t.BaseAction);t.ChainAction=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,t)}return __extends(i,e),i.prototype.start=function(e){this._curActionData=e,t.ActionData.chainData.update(this._curActionData.chainStr,this._curActionData.attacker.sideType),this.chainShow();var i=this._curActionData.weapon,s=this._curActionData.attacker.playerData.curStateData.curWeapon;0==this._curActionData.skill&&i!=s&&s>0&&t.ActionData.chainData.curChainNum<=1?(t.once(t.FightStaticStr.DROP_WEAPON_OVER,this,this.onDropWeaponOver),this._curActionData.attacker.dropWeapon()):this.end()},i.prototype.chainShow=function(){t.dispatch(t.FightStaticStr.FIGHT_CHAIN_WORD,{type:this._curActionData.attacker.sideType})},i.prototype.onDropWeaponOver=function(){this._curActionData.attacker.playerData.curStateData.curWeapon=0,this.end()},i.prototype.end=function(){this._controller.dealAction()},i}(t.BaseAction);t.DropWeaponAction=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,t)}return __extends(i,e),i.prototype.start=function(e){this._curActionData=e,t.dispatch(t.FightStaticStr.EFFECT_ACTION,{action:this._curActionData,type:t.EffectController.EFFECT_BEFORE_SELECT,side:this._curActionData.attacker.sideType.toLowerCase()}),t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:t.BuffController.BEFORE_GET_WEAPON,side:this._curActionData.attacker.sideType.toLowerCase()});var i=this._curActionData.weapon,s=this._curActionData.attacker.playerData.curStateData.curWeapon;i>0&&i!=s&&0==this._curActionData.skill?(t.once(t.FightStaticStr.GET_WEAPON_OVER,this,this.onGetWeaponOver),this._curActionData.attacker.getWeapon(this._curActionData.weapon)):this.end()},i.prototype.onGetWeaponOver=function(){this._curActionData.attacker.playerData.curStateData.curWeapon=this._curActionData.weapon,t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:t.BuffController.AFTER_GET_WEAPON,side:this._curActionData.attacker.sideType.toLowerCase()});var e=this._curActionData.attacker.playerData.curStateData.curWeapon;t.dispatch(t.FightStaticStr.THROW_WEAPON,{weaponId:e,sideType:this._curActionData.attacker.sideType}),this.end(),this._curActionData.weapon>0&&0==this._curActionData.skill&&t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:3,id:this._curActionData.weapon,level:this._curActionData.attacker.playerData.getWeaponLevel(this._curActionData.weapon),typeCode:"weapon",side:this._curActionData.attacker.sideType,top:this._curActionData.attacker.playerData.npcData.top})},i.prototype.end=function(){t.dispatch(t.FightStaticStr.EFFECT_ACTION,{action:this._curActionData,type:t.EffectController.EFFECT_AFTER_SELECT,side:this._curActionData.attacker.sideType.toLowerCase()}),t.FightModule.isChainDrama&&2==t.ActionData.chainData.curChainNum?(t.once(t.FightStaticStr.FIGHT_DRAMA_END,this,this.onDramaEnd),t.dispatch(t.FightStaticStr.FIGHT_DRAMA_START,"1053")):this._controller.dealAction()},i.prototype.onDramaEnd=function(){this._controller.dealAction()},i}(t.BaseAction);t.GetWeaponAction=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,t),this._isAttackPlayOver=!1,this._isBeAttackOver=!1}return __extends(i,e),i.prototype.start=function(e){this._curActionData=e,this._curActionData.beAttacker.changeLayerDown(),this._curActionData.attacker.opposeFighter=this._curActionData.beAttacker,this._curActionData.beAttacker.opposeFighter=this._curActionData.attacker,t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:t.BuffController.BEFORE_ATTACKING,side:this._curActionData.attacker.sideType.toLowerCase()});var i=this.getActionType();switch(i){case"skill":t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:t.BuffController.BEFORE_SKILL,side:this._curActionData.attacker.sideType.toLowerCase()}),this.playSkill();break;case"weapon":this.playWeapon();break;case"normal":this.playNormal();break;case"none":this.end();break;default:this.end()}},i.prototype.getActionType=function(){var t="none";return this._curActionData.haveAction?this._curActionData.skill>0?"skill":this._curActionData.weapon>0?"weapon":"normal":t},i.prototype.playSkill=function(){this._isAttackPlayOver=!1,this._isBeAttackOver=!1;var e=this._curActionData.attacker.playerData.getSkillData(this._curActionData.skill);t.addListener(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onAttackOver),t.addListener(t.FightStaticStr.ATTACK_REACTION_ANI_OVER,this,this.onBeAttakOver),this._curActionData.attacker.playSkill(this._curActionData),t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:3,id:this._curActionData.skill,level:e.level,typeCode:"skill",side:this._curActionData.attacker.sideType,top:this._curActionData.attacker.playerData.npcData.top}),1==e.withoutAttack&&t.dispatch(t.FightStaticStr.BE_ATTACK_ACTION,this._curActionData)},i.prototype.playWeapon=function(){this._isAttackPlayOver=!1,this._isBeAttackOver=!1,t.addListener(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onAttackOver),t.addListener(t.FightStaticStr.ATTACK_REACTION_ANI_OVER,this,this.onBeAttakOver),this._curActionData.attacker.playWeaponAttack(this._curActionData)},i.prototype.playNormal=function(){this._isAttackPlayOver=!1,this._isBeAttackOver=!1,t.addListener(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onAttackOver),t.addListener(t.FightStaticStr.ATTACK_REACTION_ANI_OVER,this,this.onBeAttakOver),this._curActionData.attacker.playNormalAttack(this._curActionData)},i.prototype.onAttackOver=function(){t.removeListener(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onAttackOver),1==this._curActionData.attackType&&(this._curActionData.attacker.playerData.curStateData.curWeapon=0,this._curActionData.attacker.changeStand()),2==this._curActionData.attackType&&t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:t.BuffController.AFTER_SKILL,side:this._curActionData.attacker.sideType.toLowerCase()}),this._isBeAttackOver?this.end():this._isAttackPlayOver=!0},i.prototype.onBeAttakOver=function(){t.removeListener(t.FightStaticStr.ATTACK_REACTION_ANI_OVER,this,this.onBeAttakOver),this._isAttackPlayOver?this.end():this._isBeAttackOver=!0},i.prototype.end=function(){t.dispatch(t.FightStaticStr.EFFECT_ACTION,{action:this._curActionData,type:t.EffectController.EFFECT_AFTER_ATTACKING,side:this._curActionData.attacker.sideType.toLowerCase()}),t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:t.BuffController.AFTER_ATTACK,side:this._curActionData.attacker.sideType.toLowerCase()}),t.removeListener(t.FightStaticStr.SKILL_PLAY_OVER,this,this.onAttackOver),t.removeListener(t.FightStaticStr.ATTACK_REACTION_ANI_OVER,this,this.onBeAttakOver),this._controller.dealAction()},i}(t.BaseAction);t.HitAction=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,t),this._isAttackPlayOver=!1,this._isBeAttackOver=!1}return __extends(i,e),i.prototype.start=function(t){switch(this._curActionData=t,this._type=this.getActionType(),"none"!=this._type&&this._curActionData.attacker.changeLayerDown(),this._type){case"beatBack":this.controlBeatBack();break;case"beatBacknpc":this.controlBeatBackNPC();break;case"npcBeatBack":this.controlNPCBeatBack();break;case"none":this.end();break;default:this.end()}},i.prototype.getActionType=function(){var t="none";return 1==this._curActionData.beatBack?0==this._curActionData.attacker.playerData.utype||this.checkWeaponEffect()?0!=this._curActionData.beAttacker.playerData.utype||this.getEffectWeaponBeatBack()?"npcBeatBack":"beatBack":"beatBacknpc":t},i.prototype.getEffectWeaponBeatBack=function(){return!(0!=this._curActionData.attacker.playerData.utype||!this.checkWeaponEffect())},i.prototype.checkWeaponEffect=function(){return!!(this._curActionData.beAttacker.playerData.curStateData.curWeapon>0&&this._curActionData.beAttacker.playerData.getWeaponData(this._curActionData.beAttacker.playerData.curStateData.curWeapon).skillUrl)},i.prototype.controlBeatBack=function(){t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this._curActionData.beAttacker,type:t.FloatWordController.ASSIST_SKILL_WORD,name:"反击"}),this._isAttackPlayOver=!1,this._isBeAttackOver=!1,t.once(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onAttackOver),t.once(t.FightStaticStr.ATTACK_REACTION_ANI_OVER,this,this.onBeAttakOver),this._curActionData.beAttacker.playerData.curStateData.curWeapon>0?this._curActionData.beAttacker.playWeaponAttack(this._curActionData,!0):this._curActionData.beAttacker.playNormalAttack(this._curActionData,!0)},i.prototype.controlBeatBackNPC=function(){t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this._curActionData.beAttacker,type:t.FloatWordController.ASSIST_SKILL_WORD,name:"反击"}),0==this._curActionData.beAttacker.playerData.utype?0==this._curActionData.beAttacker.playerData.curStateData.curWeapon?(this._curActionData.beAttacker.playRun(),Laya.Tween.to(this._curActionData.beAttacker,{x:this._curActionData.attacker.playerData.positionX+this._curActionData.beAttacker.moveX},t.FightData.runTime/t.FightController.TIME_SCALE,null,Laya.Handler.create(this,this.onRunBack))):(this._curActionData.beAttacker.playRunWithWeapon(),Laya.Tween.to(this._curActionData.beAttacker,{x:this._curActionData.attacker.playerData.positionX+this._curActionData.beAttacker.moveX},t.FightData.runTime/t.FightController.TIME_SCALE,null,Laya.Handler.create(this,this.onRunBack))):this.controlBeatBack()},i.prototype.controlNPCBeatBack=function(){t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this._curActionData.beAttacker,type:t.FloatWordController.ASSIST_SKILL_WORD,name:"反击"}),Laya.Tween.to(this._curActionData.attacker,{x:this._curActionData.attacker.srcX},t.FightData.runTime/t.FightController.TIME_SCALE,null,Laya.Handler.create(this,this.onRunBack))},i.prototype.onRunBack=function(){this._isAttackPlayOver=!1,this._isBeAttackOver=!1,t.once(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onAttackNPCOver),t.once(t.FightStaticStr.ATTACK_REACTION_ANI_OVER,this,this.onBeAttakNPCOver),this._curActionData.beAttacker.playerData.curStateData.curWeapon>0?this._curActionData.beAttacker.playWeaponAttack(this._curActionData,!0):this._curActionData.beAttacker.playNormalAttack(this._curActionData,!0)},i.prototype.onAttackNPCOver=function(){this._isBeAttackOver?"beatBacknpc"==this._type?Laya.Tween.to(this._curActionData.beAttacker,{x:this._curActionData.beAttacker.srcX},100/t.FightController.TIME_SCALE,null,Laya.Handler.create(this,this.end)):this.end():this._isAttackPlayOver=!0},i.prototype.onBeAttakNPCOver=function(){this._isAttackPlayOver?"beatBacknpc"==this._type?Laya.Tween.to(this._curActionData.beAttacker,{x:this._curActionData.beAttacker.srcX},100/t.FightController.TIME_SCALE,null,Laya.Handler.create(this,this.end)):this.end():this._isBeAttackOver=!0},i.prototype.onAttackOver=function(){this._isBeAttackOver?this.end():this._isAttackPlayOver=!0},i.prototype.onBeAttakOver=function(){this._isAttackPlayOver?this.end():this._isBeAttackOver=!0},i.prototype.end=function(){this._controller.dealAction()},i}(t.BaseAction);t.HitBackAction=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i){e.call(this,i),this._isBeAttack=!1,this._shamDead=0,this._afterAttackSkill=0,t.addListener(t.FightStaticStr.BE_ATTACK_ACTION,this,this.attackReaction),t.addListener(t.FightStaticStr.BEAT_BACK_REACTION_ACTION,this,this.beBackReaction)}return __extends(i,e),i.prototype.start=function(t){},i.prototype.end=function(){},i.prototype.attackReaction=function(e){this._curActionData=e,this._isBeAttack=!1,this._subHp=this._curActionData.beAttackerHpChange,this._addHp=this._curActionData.attackerAddHp,this._reactionType=this._curActionData.hitReaction,this._attacker=this._curActionData.attacker,this._beAttacker=this._curActionData.beAttacker,this._buffAttackingType=t.BuffController.ATTACKING,this._buffAfterAttackingType=t.BuffController.AFTER_ATTACKING,this._defenseSkill=this._curActionData.defenseSkill,this._defenseSkillParam=this._curActionData.defenseSkillParam,this._shamDead=this._curActionData.shamDead,this._shamDeadParam=this._curActionData.shamDeadParam,this._afterAttackSkill=this._curActionData.afterAttackSkill,this._afterAttackSkillParam=this._curActionData.afterAttackSkillParam,this.onEvent()},i.prototype.beBackReaction=function(e){this._curActionData=e,this._isBeAttack=!0,this._subHp=this._curActionData.attackerHpChange,this._addHp=this._curActionData.beAttackerAddHp,this._reactionType=this._curActionData.beatBackReaction,this._attacker=this._curActionData.beAttacker,this._beAttacker=this._curActionData.attacker,this._buffAttackingType=t.BuffController.BEAT_BACK_ATTACKING,this._buffAfterAttackingType=t.BuffController.BEAT_BACK_AFTER_ATTACKING,this._defenseSkill=this._curActionData.beBackDefenseSkill,this._defenseSkillParam=this._curActionData.beBackDefenseSkillParam,this._shamDead=this._curActionData.beShamDead,this._shamDeadParam=this._curActionData.beShamDeadParam,this._afterAttackSkill=this._curActionData.beAfterAttackSkill,this._afterAttackSkillParam=this._curActionData.beAfterAttackSkillParam,this.onEvent()},i.prototype.onEvent=function(){t.addListener(t.FightStaticStr.FIGHTER_REACTION_ANI_OVER,this,this.onFighterPlayOver),t.dispatch(t.FightStaticStr.EFFECT_ACTION,{action:this._curActionData,type:t.EffectController.EFFECT_ATTACKING,side:this._attacker.sideType.toLowerCase()}),this.showHPAndFloatWord(),this.playAction()},i.prototype.showHPAndFloatWord=function(){if(0!=this._subHp){this._beAttacker.playerData.curStateData.subHP(this._subHp);t.dispatch(t.FightStaticStr.SUB_HP,{subNum:this._subHp,type:this._beAttacker.sideType}),4==this._reactionType?(t.SoundController.playBaojiSound(),t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:6,side:this._attacker.sideType,top:this._attacker.playerData.npcData.top}),t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this._beAttacker,type:t.FloatWordController.CRIT_FLOAT_WORD,num:this._subHp})):3==this._reactionType?(t.SoundController.playShouShangSound(),t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this._beAttacker,type:t.FloatWordController.DAMAGE_FLOAT_WORD,num:this._subHp})):(t.SoundController.playShouShangSound(),t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this._beAttacker,type:t.FloatWordController.DAMAGE_FLOAT_WORD,num:this._subHp}))}if(this._addHp>0){this._attacker.playerData.curStateData.addHP(this._subHp);t.dispatch(t.FightStaticStr.ADD_HP,{addNum:this._addHp,type:this._attacker.sideType}),t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this._attacker,type:t.FloatWordController.ADD_FLOAT_WORD,num:this._addHp})}},i.prototype.playAction=function(){if(this._attacker.opposeFighter=this._beAttacker,this._beAttacker.opposeFighter=this._attacker,t.once(t.FightStaticStr.EVENT_HIT_END,this,this.eventHitEnd),0!=this._defenseSkill)t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:this._buffAttackingType,side:this._attacker.sideType.toLowerCase()}),this._beAttacker.playReactionSkill(this._curActionData,this._defenseSkill),14==this._defenseSkill&&(t.dispatch(t.FightStaticStr.ADD_HP,{addNum:parseInt(this._defenseSkillParam[2]),type:this._beAttacker.sideType}),this._beAttacker.playerData.curStateData.addHP(parseInt(this._defenseSkillParam[2])),t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:7,side:this._beAttacker.sideType,top:this._beAttacker.playerData.npcData.top}));else switch(this._reactionType){case t.AtkReactionController.EVADE_REACTION:t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:5,side:this._beAttacker.sideType,top:this._beAttacker.playerData.npcData.top}),t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:this._buffAttackingType,side:this._attacker.sideType.toLowerCase()}),t.SoundController.playMissSound(),t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this._beAttacker,type:t.FloatWordController.MISS_FLOAT_WORD}),this._beAttacker.playAttackReaction(this._curActionData,this._reactionType);break;case t.AtkReactionController.NORMAL_HIT_REACTION:case t.AtkReactionController.BLOCK_REACTION:case t.AtkReactionController.CRIT_REACTION:this._isBeAttack||(this._curActionData.weapon>0&&t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:9,id:this._curActionData.weapon,level:this._attacker.playerData.getWeaponLevel(this._curActionData.weapon),typeCode:"weapon",side:this._beAttacker.sideType,top:this._beAttacker.playerData.npcData.top}),this._curActionData.skill>0&&t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:9,id:this._curActionData.skill,level:this._attacker.playerData.getSkillLevel(this._curActionData.skill),typeCode:"skill",side:this._beAttacker.sideType,top:this._beAttacker.playerData.npcData.top})),t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:this._buffAttackingType,side:this._attacker.sideType.toLowerCase()}),this._beAttacker.playAttackReaction(this._curActionData,this._reactionType);break;default:this.gotoNextAction()}},i.prototype.eventHitEnd=function(){this._beAttacker&&this._beAttacker.playReactionEnd()},i.prototype.onFighterPlayOver=function(){var e;this._shamDead?(e=this._shamDead,this._shamDead=0,this._beAttacker.playReactionSkill(this._curActionData,e),t.dispatch(t.FightStaticStr.ADD_HP,{addNum:parseInt(this._shamDeadParam[2]),type:this._beAttacker.sideType}),this._beAttacker.playerData.curStateData.addHP(parseInt(this._shamDeadParam[2])),t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:7,side:this._beAttacker.sideType,top:this._beAttacker.playerData.npcData.top})):this._afterAttackSkill?(e=this._afterAttackSkill,this._afterAttackSkill=0,this._beAttacker.playReactionSkill(this._curActionData,e)):this.gotoNextAction()},i.prototype.gotoNextAction=function(){t.removeListener(t.FightStaticStr.FIGHTER_REACTION_ANI_OVER,this,this.onFighterPlayOver),t.removeListener(t.FightStaticStr.EVENT_HIT_END,this,this.eventHitEnd),t.dispatch(t.FightStaticStr.ATTACK_REACTION_ANI_OVER,this._curActionData)},i.EVADE_REACTION=1,i.NORMAL_HIT_REACTION=2,i.BLOCK_REACTION=3,i.CRIT_REACTION=4,i}(t.BaseAction);t.HitReaction=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,t)}return __extends(i,e),i.prototype.start=function(e){this._curActionData=e;var i=!1;this._leftShow=!1,this._rightShow=!1,this._curIndex=0;var s=this._curActionData.attacker.playerData.monsterData.getMonsterData();!t.Global.isRetrench&&this._curActionData.attacker.playerData.monsterData.haveMonster&&!this._curActionData.attacker.playerData.monsterData.monsterHaveShow&&s&&t.MonsterConfigData.monster[s.id+""]?(t.addListener(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onStopAttake),this._curActionData.attacker.playSkillEffect(t.MonsterConfigData.monster[s.id+""].show),this._curActionData.attacker.playerData.monsterData.monsterHaveShow=!0,i=!0):this._leftShow=!0;var n=this._curActionData.beAttacker.playerData.monsterData.getMonsterData();!t.Global.isRetrench&&this._curActionData.beAttacker.playerData.monsterData.haveMonster&&!this._curActionData.beAttacker.playerData.monsterData.monsterHaveShow&&n&&t.MonsterConfigData.monster[n.id+""]?(t.addListener(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onStopBeattake),this._curActionData.beAttacker.playSkillEffect(t.MonsterConfigData.monster[n.id+""].show),this._curActionData.beAttacker.playerData.monsterData.monsterHaveShow=!0,i=!0):this._rightShow=!0,!t.Global.isRetrench&&2==this._curActionData.attackType&&s&&s.skill==this._curActionData.skill&&(this._curActionData.attacker.playerData.monsterData.monsterHaveShow=!1,this._curActionData.attacker.playerData.monsterData.curIndex++,t.dispatch(t.FightStaticStr.FIGHT_SHOW_MONSTER_LOGO,{type:this._curActionData.attacker.sideType,show:!1})),i||this.playPassiveSkill()},i.prototype.onStopAttake=function(e){if(e==this._curActionData.attacker.sideType){t.removeListener(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onStopAttake),this._leftShow=!0;var i=this._curActionData.attacker.playerData.monsterData.getMonsterData();t.dispatch(t.FightStaticStr.FIGHT_SHOW_MONSTER_LOGO,{id:i.id,type:this._curActionData.attacker.sideType,show:!0}),this._rightShow&&this.playPassiveSkill()}},i.prototype.onStopBeattake=function(e){if(e==this._curActionData.beAttacker.sideType){t.removeListener(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onStopBeattake),this._rightShow=!0;var i=this._curActionData.beAttacker.playerData.monsterData.getMonsterData();t.dispatch(t.FightStaticStr.FIGHT_SHOW_MONSTER_LOGO,{id:i.id,type:this._curActionData.beAttacker.sideType,show:!0}),this._leftShow&&this.playPassiveSkill()}},i.prototype.playPassiveSkill=function(){if(this._passiveAttacker=!1,this._passiveBeAttacker=!1,!t.Global.isRetrench&&this._curActionData.attacker.playerData.monsterData.passiveList&&this._curActionData.attacker.playerData.monsterData.passiveList.length>0&&!this._curActionData.attacker.playerData.monsterData.haveShowPassive&&this._curIndex<this._curActionData.attacker.playerData.monsterData.passiveList.length){var e=this._curActionData.attacker.playerData.monsterData.passiveList[this._curIndex];t.addListener(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onPassiveAttacker),this._curActionData.attacker.playSkillEffect(e.skill)}else this._curActionData.attacker.playerData.monsterData.haveShowPassive=!0,this._passiveAttacker=!0;if(!t.Global.isRetrench&&this._curActionData.beAttacker.playerData.monsterData.passiveList&&this._curActionData.beAttacker.playerData.monsterData.passiveList.length>0&&!this._curActionData.beAttacker.playerData.monsterData.haveShowPassive&&this._curIndex<this._curActionData.beAttacker.playerData.monsterData.passiveList.length){var e=this._curActionData.beAttacker.playerData.monsterData.passiveList[this._curIndex];t.addListener(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onPassiveBeAttacker),this._curActionData.beAttacker.playSkillEffect(e.skill)}else this._curActionData.beAttacker.playerData.monsterData.haveShowPassive=!0,this._passiveBeAttacker=!0;this._passiveAttacker&&this._passiveBeAttacker&&this.end()},i.prototype.onPassiveAttacker=function(e){e==this._curActionData.attacker.sideType&&(t.removeListener(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onPassiveAttacker),this._passiveAttacker=!0,this._passiveAttacker&&this._passiveBeAttacker&&(this._curIndex++,this.playPassiveSkill()))},i.prototype.onPassiveBeAttacker=function(e){e==this._curActionData.beAttacker.sideType&&(t.removeListener(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onPassiveBeAttacker),this._passiveBeAttacker=!0,this._passiveAttacker&&this._passiveBeAttacker&&(this._curIndex++,this.playPassiveSkill()))},i.prototype.end=function(){this._controller.dealAction()},i}(t.BaseAction);t.MonsterAction=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,t)}return __extends(i,e),i.prototype.start=function(t){this._curActionData=t;var e=this.getActionType();switch(e){case"run":this.playRun();break;case"runWithWeapon":this.playRunWithWeapon();break;case"none":this.end();break;default:this.end()}},i.prototype.getActionType=function(){var t="none";return this._curActionData.haveAction?this._curActionData.skill>0||1==this._curActionData.attackType?"none":this._curActionData.weapon>0?""!=this._curActionData.attacker.playerData.getWeaponData(this._curActionData.weapon).skillUrl?"none":"runWithWeapon":"run":t},i.prototype.playRun=function(){if(this._curActionData.attacker.playerData.curStateData.hasDoubleAttack||0!=this._curActionData.attacker.playerData.utype)this.end();else{this._curActionData.attacker.playRun();var e=this._curActionData.battleData.fightData.playerDataMap[this._curActionData.effects[0].effector];Laya.Tween.to(this._curActionData.attacker,{x:e.positionX+this._curActionData.attacker.moveX,y:e.positionY},t.FightData.runTime/t.FightController.TIME_SCALE,null,Laya.Handler.create(this,this.end))}},i.prototype.playRunWithWeapon=function(){if(this._curActionData.attacker.playerData.curStateData.hasDoubleAttack)this.end();else{this._curActionData.attacker.playRunWithWeapon();var e=this._curActionData.battleData.fightData.playerDataMap[this._curActionData.effects[0].effector];Laya.Tween.to(this._curActionData.attacker,{x:e.positionX+this._curActionData.attacker.moveX,y:e.positionY},t.FightData.runTime/t.FightController.TIME_SCALE,null,Laya.Handler.create(this,this.end))}},i.prototype.end=function(){this._controller.dealAction()},i}(t.BaseAction);t.MoveAction=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,t)}return __extends(i,e),i.prototype.start=function(e){this._curActionData=e;var i=this.getActionType();switch(i){case"moveBack":this._curActionData.attacker.playRun();var s=this._curActionData.battleData.fightData.playerDataMap[this._curActionData.actor];Laya.Tween.to(this._curActionData.attacker,{x:s.positionX,y:s.positionY},100/t.FightController.TIME_SCALE,null,Laya.Handler.create(this,this.end));break;case"none":this.end();break;case"endAction":this.end();break;default:this.end()}},i.prototype.getActionType=function(){var t="none";return this._curActionData.isEndAction?"endAction":0==this._curActionData.isDoubleAttack&&this._curActionData.attacker.srcX!=this._curActionData.attacker.x?"moveBack":t},i.prototype.end=function(){this._curActionData.attacker.playerData.curStateData.hasDoubleAttack=1==this._curActionData.isDoubleAttack,
this._curActionData.attacker.playStand(),!this._curActionData.haveAction&&(this._curActionData.attacker.playerData.curStateData.isDizzy||this._curActionData.attacker.playerData.curStateData.isStick||this._curActionData.attacker.playerData.curStateData.isDianxue)?(t.addListener(t.FightStaticStr.ACTION_LOST_END,this,this.delayEnd),this._curActionData.attacker.playerData.curStateData.isDizzy&&0==this._curActionData.attacker.playerData.utype?(t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:10,side:this._curActionData.beAttacker.sideType,top:this._curActionData.beAttacker.playerData.npcData.top}),this._curActionData.attacker.playStun()):this._curActionData.attacker.playerData.curStateData.isStick&&0==this._curActionData.attacker.playerData.utype?(t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:10,side:this._curActionData.beAttacker.sideType,top:this._curActionData.beAttacker.playerData.npcData.top}),this._curActionData.attacker.playGlue()):this._curActionData.attacker.playerData.curStateData.isDianxue&&0==this._curActionData.attacker.playerData.utype?(t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:10,side:this._curActionData.beAttacker.sideType,top:this._curActionData.beAttacker.playerData.npcData.top}),this._curActionData.attacker.playSlient()):Laya.timer.once(1500/t.FightController.TIME_SCALE,this,this.delayEnd)):(t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:t.BuffController.AFTER_ACTION,side:"lr"}),t.dispatch(t.FightStaticStr.EFFECT_ACTION,{action:this._curActionData,type:t.EffectController.EFFECT_AFTER_ACTION,side:"lr"}),t.dispatch(t.FightStaticStr.FIGHT_ADD_MONSTER_VALUE,{type:this._curActionData.attacker.sideType,value:this._curActionData.addRage}),t.dispatch(t.FightStaticStr.FIGHT_ADD_MONSTER_VALUE,{type:this._curActionData.beAttacker.sideType,value:this._curActionData.beAttackerAddRage}),this._controller.dealAction())},i.prototype.delayEnd=function(){t.removeListener(t.FightStaticStr.ACTION_LOST_END,this,this.delayEnd),t.dispatch(t.FightStaticStr.BUFF_ACTION,{action:this._curActionData,type:t.BuffController.AFTER_ACTION,side:"lr"}),t.dispatch(t.FightStaticStr.EFFECT_ACTION,{action:this._curActionData,type:t.EffectController.EFFECT_AFTER_ACTION,side:"lr"}),t.dispatch(t.FightStaticStr.FIGHT_ADD_MONSTER_VALUE,{type:this._curActionData.attacker.sideType,value:this._curActionData.addRage}),t.dispatch(t.FightStaticStr.FIGHT_ADD_MONSTER_VALUE,{type:this._curActionData.beAttacker.sideType,value:this._curActionData.beAttackerAddRage}),this._controller.dealAction()},i}(t.BaseAction);t.MoveBackAction=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,t),this._isAttackPlayOver=!1,this._isBeAttackOver=!1}return __extends(i,e),i.prototype.start=function(e){this._curActionData=e,this._isAttackPlayOver=!1,this._isBeAttackOver=!1;var i=this.getActionType();switch(i){case"rebound":this._curActionData.attacker.changeLayerDown(),t.once(t.FightStaticStr.ATTACK_ANI_OVER,this,this.onAttackOver),t.once(t.FightStaticStr.ATTACK_REACTION_ANI_OVER,this,this.onBeAttakOver),this._curActionData.beAttacker.playReboundSkill(this._curActionData);break;case"none":this.end();break;default:this.end()}},i.prototype.getActionType=function(){var t="none";return this._curActionData.beAttackerSkill>0?"rebound":t},i.prototype.onAttackOver=function(){this._isBeAttackOver?this.end():this._isAttackPlayOver=!0},i.prototype.onBeAttakOver=function(){this._isAttackPlayOver?this.end():this._isBeAttackOver=!0},i.prototype.end=function(){this._controller.dealAction()},i}(t.BaseAction);t.ReboundAction=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this),this._replayMapCache={},s.isShareReplay=!1,s.isChainDrama=!1}return __extends(s,i),s.prototype.initialize=function(e){this._replayMapCache={},this._fightc=new t.FightController},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"FightCommand":this._retryCommad=e,t.FightController.IS_REPLAY=this._retryCommad.isReplay,1==t.Global.JUMP_FIGHT?(t.WeakTips.show("战斗结束~~~~~~~~~~~~~~~~~~~~~~~~~~"),t.Facade.callCommand(new t.SyncChangeCmd(e.jsonObj,!1)),t.dispatch(t.FightStaticStr.FIGHT_COMPLETE)):this.gotoFight(e.fightData,e.awardData,this._retryCommad,e.isDayFirstWin),s.isShareReplay||t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.FIGHT_ENTER));break;case"FightResultCommand":var i=e.resultData,n=i&&i.award?i.award.replay:null;if(n&&(this._lastFightData=n,this._lastAward=i.award),s.isShareReplay){var a=new t.ReplayResultView(e.resultData);t.LayerMgr.addChild(a,t.Layer.FIGHT)}else this._retryCommad&&t.Facade.callCommand(new t.SyncChangeCmd(this._retryCommad.jsonObj,!1)),this._resultView||(this._resultView=new t.ResultView),this._resultView.show(t.Layer.FIGHT),this._resultView.updatePanel(e.resultData),t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.FIGHT_RESULT_OPEN));break;case"FightReplayCommand":(e.isShareReplay||s.isShareReplay)&&(s.isShareReplay=!0),this._lastFightData&&0==e.replayId?(t.FightController.IS_REPLAY=!0,this._fightc.gotoFight(this._lastFightData,this._lastAward)):this._replayMapCache[e.replayId+""]?this.onReplay(this._replayMapCache[e.replayId+""]):t.XHR().Post({cmd:"replay",uid:"10001",op:"get",repid:e.replayId},this,this.onReplay);break;case"FightTestCommand":var o=new t.FightTestView;o.show();break;case"FightRetryCommand":this._retryCommad&&(this._retryCommad.isRefight=!0,this._retryCommad.finish())}},s.prototype.gotoFight=function(t,e,i,s){void 0===e&&(e=null),void 0===i&&(i=null),void 0===s&&(s=!1),this._lastFightData=t,this._lastAward=e,this._fightc.gotoFight(t,e,i,s)},s.prototype.onReplay=function(e){0==parseInt(e.result)?""!=e.replay?(this._replayMapCache[e.repid+""]=e,e.repid&&!t.Global.isWX&&(e.repalyid=e.repid),t.Facade.callCommand(new t.FightCommand(e,null,!0))):t.WeakTips.show("录像失效！"):t.WeakTips.show(e.msg)},s.prototype.getPluginName=function(){return e.PLUGIN_FIGHT},s}(t.Plugin);t.FightModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this),t.addListener(t.FightStaticStr.ADD_BUFF,this,this.addBuff),t.addListener(t.FightStaticStr.DELETE_BUFF,this,this.deleteBuff),this._buffArr=[],this._buffIcons=[],this._sideType=t.FightStaticStr.LEFT_SIDE,this._align="left"}return __extends(s,e),s.prototype.destroy=function(){e.prototype.destroy.call(this),t.removeListener(t.FightStaticStr.ADD_BUFF,this,this.addBuff),t.removeListener(t.FightStaticStr.DELETE_BUFF,this,this.deleteBuff)},Object.defineProperty(s.prototype,"align",{set:function(t){this._align=t},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"sideType",{set:function(t){this._sideType=t},enumerable:!0,configurable:!0}),s.prototype.clearBuffs=function(){this._buffArr.length=0,this.updateBuffs()},s.prototype.addMineBuff=function(t){for(var e=0;e<t.length;e++)this._buffArr.push(new i({id:"mine"+t[e].id,iconId:t[e].id,num:1,isFight:!1})),this.updateBuffIcon(this._buffArr[this._buffArr.length-1],this._buffArr.length)},s.prototype.addBuff=function(e){if(e.sideType==this._sideType){var s=this.getBuffData(e.buffId);s?s.num++:(this._buffArr.push(new i({id:e.buffId,iconId:e.buffId,num:1,isFight:!0})),this.updateBuffIcon(this._buffArr[this._buffArr.length-1],this._buffArr.length),t.dispatch(t.FightStaticStr.ADD_BUFF_ANIMATION,e))}},s.prototype.deleteBuff=function(e){if(e.sideType==this._sideType)for(var i=0;i<this._buffArr.length;i++)if(this._buffArr[i].id==e.buffId){this._buffArr[i].num>1?this._buffArr[i].num--:(this._buffArr.splice(i,1),this.updateBuffs(),t.dispatch(t.FightStaticStr.DELETE_BUFF_ANIMATION,e));break}},s.prototype.updateBuffs=function(){for(var t=0;t<this._buffIcons.length;t++)this._buffArr[t]?this.updateBuffIcon(this._buffArr[t],t+1):(this._buffIcons[t].graphics.clear(),this._buffIcons[t].visible=!1)},s.prototype.updateBuffIcon=function(e,i){if(this._buffIcons.length<i){var s=new Sprite;this._buffIcons.push(s),this.addChild(s),"left"==this._align?s.x=40*(i-1):s.x=this.width-30-40*(i-1)}this._buffIcons[i-1].visible=!0,this._buffIcons[i-1].graphics.clear(),e.isFight?this._buffIcons[i-1].loadImage(t.ResPath().getPic(e.iconId,t.ResourcePath.PATH_BUFF),0,0,30,30):this._buffIcons[i-1].loadImage(t.ResPath().getPic(e.iconId,t.ResourcePath.PATH_MINE_BUFF),0,0,30,30,Handler.create(this,this.onBuffLoad,[this._buffIcons[i-1]]))},s.prototype.onBuffLoad=function(e){e.loadImage(t.ResPath().getPic("big_frame",t.ResourcePath.PATH_MINE_BUFF),0,0,30,30)},s.prototype.getBuffData=function(t){for(var e=0;e<this._buffArr.length;e++)if(this._buffArr[e].id==t)return this._buffArr[e];return null},s}(Laya.Sprite);t.FightBuffView=e;var i=function(){function t(t){this._id=t.id,this._num=t.num,this._iconId=t.iconId,this._isFight=t.isFight}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"iconId",{get:function(){return this._iconId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"num",{get:function(){return this._num},set:function(t){this._num=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isFight",{get:function(){return this._isFight},enumerable:!0,configurable:!0}),t}();t.BuffIconData=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this._type="L",this._dotNap=30,t.addListener(t.FightStaticStr.FIGHT_CHAIN_WORD,this,this.onEvent),t.addListener(t.FightStaticStr.FIGHT_CHAIN_ANI,this,this.playAni)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),t.removeListener(t.FightStaticStr.FIGHT_CHAIN_WORD,this,this.onEvent),t.removeListener(t.FightStaticStr.FIGHT_CHAIN_ANI,this,this.playAni)},Object.defineProperty(i.prototype,"type",{set:function(t){this._type=t,"R"==t&&(this.bg.scaleX=-1,this.bg.x=334,this.lian.x=this.lian.x+144,this.suo.x=this.suo.x+144,this.numIcon.x=this.numIcon.x+144)},enumerable:!0,configurable:!0}),i.prototype.onEvent=function(e){t.ActionData.chainData.curChainNum>=2&&e.type==this._type?(this.visible=!0,this.addLightDot()):this.clearView()},i.prototype.addLightDot=function(){this._aniDot||(this._aniDot=new t.AnimationSKe(t.ResPath().getEffect("effect_combo")),this.addChild(this._aniDot),this._aniDot.y=59,this.playEnter()),2==t.ActionData.chainData.curChainNum?(this._aniDot.play("effect_point",!0),this.numIcon.skin="ui/fight/1.png"):3==t.ActionData.chainData.curChainNum?(this._aniDot.play("effect_point2",!0),this.playNumAni(2)):(this._aniDot.play("effect_point3",!0),this.playNumAni(3)),"L"==this._type?(this._aniDot.x=196,this._aniDot.scaleX=1):(this._aniDot.x=this.width-196,this._aniDot.scaleX=-1)},i.prototype.playNumAni=function(t){this.numIcon.skin="ui/fight/"+t+".png",this.numIcon.scale(1.5,1.5),Laya.Tween.to(this.numIcon,{scaleX:1,scaleY:1},300)},i.prototype.playEnter=function(){"L"==this._type?(this.x=-334,Laya.Tween.to(this,{x:0},300)):(this.x=1334,Laya.Tween.to(this,{x:1e3},300))},i.prototype.playAni=function(){this.clearView(),t.dispatch(t.FightStaticStr.FIGHT_CHAIN_ANI_END)},i.prototype.clearView=function(){this.visible=!1,this._aniDot&&(this.removeChild(this._aniDot),this._aniDot.destroy(),this._aniDot=null)},i}(ui.fight.FightChainUI);t.FightChainView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.visible=!1}return __extends(i,e),i.prototype.update=function(e){if(e.level<25||e.utype>0||0==e.championData.sid)this.visible=!1;else{this.visible=!0;var i=this.getPicIndex(e.championData.sid);this.icon.skin=t.ResPath().getChampionRankMin(i),6!=i?this.grade.text=this.getCiduan(e.championData.sid):this.grade.text=""+e.championData.star}},i.prototype.getPicIndex=function(t){return 25>=t?Math.floor((t+4)/5):26==t?6:void 0},i.prototype.getCiduan=function(t){var e=["Ⅴ","Ⅳ","Ⅲ","Ⅱ","Ⅰ"];return 25>=t?e[Math.floor((t-1)%5)]:""},i}(ui.fight.FightChampionUI);t.FightChampionView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.show=function(t){this.visible=!0,this.loadImage("assets/word/result/"+t+".png",0,0,0,0,Handler.create(this,this.onEndWordLoader))},e.prototype.clear=function(){this.visible=!1,this.graphics.clear()},e.prototype.onEndWordLoader=function(){this.x=(this.parent.width-this.width)/2,this.y=(this.parent.height-this.height)/2},e}(Laya.Sprite);t.FightEndWord=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){t.call(this),this.moveX=0,this._fighter=e}return __extends(e,t),Object.defineProperty(e.prototype,"body",{get:function(){return this._fighter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"srcX",{get:function(){return this._srcX},enumerable:!0,configurable:!0}),e.EVENT_HIT="event_hit",e.EVENT_HIT_DEFAULT="event_hit_default",e.EVENT_HIT_START="event_hit_start",e.EVENT_HIT_END="event_hit_end",e.EVENT_EFFECT="event_effect",e}(Laya.Sprite);t.Fighter=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.Event,i=laya.ani.bone.Templet,s=function(s){function n(i,n){s.call(this,i),this.ANI_WARM_UP="act_warmup",this.ANI_NORMAL_STAND="act_breath_0",this.ANI_STAND_WITH_WEAPON="ANI_STAND_WITH_WEAPON",this.ANI_DROP_WEAPON="act_drop",this.ANI_GET_WEAPON="act_choose",this.ANI_GET_WEAPON_GEM1="act_choose_gem1",this.ANI_GET_WEAPON_GEM2="act_choose_gem2",this.ANI_GET_WEAPON_GEM3="act_choose_gem3",this.ANI_GET_WEAPON_COMBO="act_choose_combo",this.ANI_GET_WEAPON_COMBO_GEM1="act_choose_combo_gem1",this.ANI_GET_WEAPON_COMBO_GEM2="act_choose_combo_gem2",this.ANI_GET_WEAPON_COMBO_GEM3="act_choose_combo_gem3",this.ANI_RUN="act_move_0",this.ANI_RUN_WITH_WEAPON="act_move_1",this.ANI_NORMAL_ATTACK="act_attack_0",this.ANI_WEAPON_ATTACK="ANI_WEAPON_ATTACK",this.ANI_ATTACK_REACTION="ANI_ATTACK_REACTION",this.ANI_SKILL_ATTACK="ANI_SKILL_ATTACK",this.ANI_SKILL_ASSIST="ANI_SKILL_ASSIST",this.ANI_INJURE_BQHT="ANI_INJURE_BQHT",this.ANI_DIZZY="act_breath_dizzy",this.ANI_JS="act_breath_js",this.ANI_ACTION_LOST="act_trapped_silence",this._isBeatBack=!1,this._curAttackType=0,this.setData(),this._fighter=i,this._fighter.on(e.STOPPED,this,this.onAnimationFinish),this._fighter.on(e.LABEL,this,this.onEvent),this._fighter.play(this.currAction=this.ANI_NORMAL_STAND,!0),this.setWeaponEmpty(),this.addChild(this._fighter),this._buffEffectMap={},t.addListener(t.FightStaticStr.ADD_BUFF_ANIMATION,this,this.onAddBuff),t.addListener(t.FightStaticStr.DELETE_BUFF_ANIMATION,this,this.onDeleteBuff),n.addChild(this)}return __extends(n,s),n.prototype.destroy=function(){t.removeListener(t.FightStaticStr.ADD_BUFF_ANIMATION,this,this.onAddBuff),t.removeListener(t.FightStaticStr.DELETE_BUFF_ANIMATION,this,this.onDeleteBuff),this._fighter.off(e.STOPPED,this,this.onAnimationFinish),this._fighter.off(e.LABEL,this,this.onEvent),this._fighter.destroy(),this._fighter=null;for(var i in this._buffEffectMap){var n=this._buffEffectMap[i];n&&(n.destroy(),delete this._buffEffectMap[i])}this._buffEffectMap=null,s.prototype.destroy.call(this)},n.prototype.setData=function(){this.reactuionTypeArr=["act_evade","act_evade","act_injure_0","act_block","act_injure_1"],this._standActionMap={"2-0":"act_breath_1","1-0":"act_breath_2","0-0":"act_breath_3","2-1":"act_breath_3","1-1":"act_breath_3","0-1":"act_breath_3","2-2":"act_breath_3","1-2":"act_breath_3","0-2":"act_breath_3"},this._attackActionMap={"2-0":"act_attack_1_2","2-1":"act_attack_1_1","1-0":"act_attack_2_2","1-1":"act_attack_2_1","0-0":"act_attack_2_2","0-1":"act_attack_2_1"},this._throwAttackActionMap={"2-0":"act_throw_1","1-0":"act_throw_1","0-0":"act_throw_1","2-1":"act_throw_1","1-1":"act_throw_1","0-1":"act_throw_1","2-2":"act_throw_2","1-2":"act_throw_2","0-2":"act_throw_2","2-3":"act_throw_3","1-3":"act_throw_3","0-3":"act_throw_3"}},n.prototype.setSkin=function(){1==this.playerData.gender?this._fighter.showSkinByName("male"):this._fighter.showSkinByName("female")},n.prototype.changeRate=function(t){this._fighter.playbackRate(t)},n.prototype.onEvent=function(e){switch(t.Logger.log(e.name),e.name){case t.Fighter.EVENT_HIT:this.curHitType=t.Fighter.EVENT_HIT,this.ANI_NORMAL_ATTACK==this.currAction&&t.dispatch(t.SoundModule.PLAY_SOUND,"kongshou"),this.eventAttactRaction();break;case t.Fighter.EVENT_HIT_DEFAULT:t.Fighter.EVENT_HIT==this.opposeFighter.curHitType&&this.playReactionEnd();break;case t.Fighter.EVENT_HIT_START:this.curHitType=t.Fighter.EVENT_HIT_START,this.eventAttactRaction();break;case t.Fighter.EVENT_HIT_END:t.dispatch(t.FightStaticStr.EVENT_HIT_END)}},n.prototype.playReactionEnd=function(){Laya.timer.callLater(this,function(){this._fighter.play(this._curAni,!1,!0,150*(this._fighter.player.cacheFrameRate/30)*1e3/this._fighter.player.cacheFrameRate)})},n.prototype.onAnimationFinish=function(e){switch(this.currAction){case this.ANI_WARM_UP:this.play(this.currAction=this.ANI_NORMAL_STAND,!0);break;case this.ANI_DROP_WEAPON:this.playStand(),this.setWeaponEmpty(),t.dispatch(t.FightStaticStr.DROP_WEAPON_OVER);break;case this.ANI_GET_WEAPON:case this.ANI_GET_WEAPON_GEM1:case this.ANI_GET_WEAPON_GEM2:case this.ANI_GET_WEAPON_GEM3:case this.ANI_GET_WEAPON_COMBO_GEM1:case this.ANI_GET_WEAPON_COMBO_GEM2:case this.ANI_GET_WEAPON_COMBO_GEM3:case this.ANI_GET_WEAPON_COMBO:this.playStand(),t.dispatch(t.FightStaticStr.GET_WEAPON_OVER);break;case this.ANI_NORMAL_ATTACK:this.playStand(),t.dispatch(t.FightStaticStr.ATTACK_ANI_OVER);break;case this.ANI_WEAPON_ATTACK:this.playStand(),t.dispatch(t.FightStaticStr.ATTACK_ANI_OVER);break;case this.ANI_SKILL_ATTACK:this.playStand();break;case this.ANI_SKILL_ATTACK:this.playStand();break;case this.ANI_SKILL_ASSIST:this.playStand(),t.dispatch(t.FightStaticStr.ASSIST_SKILL_ANI_OVER);break;case this.ANI_ATTACK_REACTION:this.playStand(),t.dispatch(t.FightStaticStr.FIGHTER_REACTION_ANI_OVER);break;case this.ANI_ACTION_LOST:this.playStand(),t.dispatch(t.FightStaticStr.ACTION_LOST_END)}},n.prototype.play=function(t,e,i,s){void 0===i&&(i=!0),void 0===s&&(s=!1),this._curAni=t,this._fighter.play(t,e,i),s||this.hideBuffEffect()},n.prototype.changeWeapon=function(t){var e=this._fighter.getSlotByName("wuqi");if(e){var i=Laya.Loader.getRes(t);this._fighter.setSlotSkin("wuqi",i)}},n.prototype.setSrcPos=function(t,e){this._srcX=t,this.pos(t,e)},n.prototype.playWarmUp=function(){this.play(this.currAction=this.ANI_WARM_UP,!1)},n.prototype.playStand=function(){if(this.playerData.curStateData.isDizzy||this.playerData.curStateData.isStick)this.playerData.curStateData.isDizzy?this.play(this.currAction=this.ANI_DIZZY,!0):this.playerData.curStateData.isStick&&this.play(this.currAction=this.ANI_JS,!0);else{var t=this.playerData.curStateData.curWeapon;if(t>0){var e=this.playerData.getWeaponData(t);this.currAction=this.ANI_STAND_WITH_WEAPON,this.play(this._standActionMap[e.type+"-"+e["throw"]],!0)}else this.play(this.currAction=this.ANI_NORMAL_STAND,!0)}this.showBuffEffect()},n.prototype.showBuffEffect=function(){for(var t in this._buffEffectMap){var e=this._buffEffectMap[t];e&&(e.visible=!0)}},n.prototype.hideBuffEffect=function(){for(var t in this._buffEffectMap){var e=this._buffEffectMap[t];e&&(e.visible=!1)}},n.prototype.playSkill=function(t){this.curActionData=t,this.currAction=this.ANI_SKILL_ATTACK,this.play("act_cast_1",!1),this.playSkillEffect(this.curActionData.skill)},n.prototype.playReboundSkill=function(e){this.curActionData=e,this.currAction=this.ANI_SKILL_ATTACK,this.play("act_cast_1",!1),this._isBeatBack=!0;var i=this.playerData.getSkillData(this.curActionData.beAttackerSkill);if(i.rebound)var s=this.playerData.getSkillData(i.rebound);else var s=this.playerData.getSkillData(15);this.showSkillDetail(s),t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this,type:t.FloatWordController.WEAPON_FLOAT_WORD,name:i.name})},n.prototype.playSkillEffect=function(e){var i=this.playerData.getSkillData(e);this.showSkillDetail(i),t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this,type:t.FloatWordController.WEAPON_FLOAT_WORD,name:i.name})},n.prototype.showSkillDetail=function(e){if(""!=e.sourceUrl){var i=t.SkillFactory.getSkill(e.id,this,Handler.create(this,this.onEvent,null,!1),Handler.create(this,this.onSkillFinish),null);i.play(e)}else t.dispatch(t.FightStaticStr.ATTACK_ANI_OVER)},n.prototype.onSkillFinish=function(){t.dispatch(t.FightStaticStr.ATTACK_ANI_OVER,this.sideType)},n.prototype.onReactionSillFinish=function(){t.dispatch(t.FightStaticStr.FIGHTER_REACTION_ANI_OVER)},n.prototype.onAssistSkillFinish=function(){t.dispatch(t.FightStaticStr.ASSIST_SKILL_ANI_OVER)},n.prototype.playAssistSkill=function(e){this.curActionData=e,this.currAction=this.ANI_SKILL_ATTACK;var i=this.playerData.getSkillData(this.curActionData.assistantSkill);if(i.withRole&&this.play("act_cast_2",!1),""!=i.sourceUrl){var s=t.SkillFactory.getSkill(i.id,this,null,Handler.create(this,this.onAssistSkillFinish),null);s.play(i)}else this.currAction=this.ANI_SKILL_ASSIST;t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this,type:t.FloatWordController.ASSIST_SKILL_WORD,name:i.name})},n.prototype.playReactionSkill=function(e,i){var s=this.playerData.getSkillData(i),n=t.SkillFactory.getSkill(s.id,this,null,Handler.create(this,this.onReactionSillFinish),this.curActionData);n.play(s),t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this,type:t.FloatWordController.ASSIST_SKILL_WORD,name:s.name})},n.prototype.dropWeapon=function(){this.play(this.currAction=this.ANI_DROP_WEAPON,!1)},n.prototype.setWeaponEmpty=function(){var t=this._fighter.getSlotByName("wuqi");if(t){var e=Laya.Loader.getRes("ui/comp/vscroll_empty.png");this._fighter.setSlotSkin("wuqi",e)}},n.prototype.getWeapon=function(e){var i=this.playerData.getWeaponData(e);t.ActionData.chainData.curChainNum>1?i.ballEffectType>0&&i.ballEffectType<=3?this.play(this.currAction=this["ANI_GET_WEAPON_COMBO_GEM"+i.ballEffectType],!1):this.play(this.currAction=this.ANI_GET_WEAPON_COMBO,!1):i.ballEffectType>0&&i.ballEffectType<=3?this.play(this.currAction=this["ANI_GET_WEAPON_GEM"+i.ballEffectType],!1):this.play(this.currAction=this.ANI_GET_WEAPON,!1),i.longSound&&t.dispatch(t.SoundModule.PLAY_SOUND,i.longSound),this.changeWeapon(i.sourceUrl),t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this,type:t.FloatWordController.WEAPON_FLOAT_WORD,name:i.name})},n.prototype.playRun=function(){t.SoundController.playRunSound(),this.play(this.currAction=this.ANI_RUN,!0)},n.prototype.playRunWithWeapon=function(){t.SoundController.playRunSound(),this.play(this.currAction=this.ANI_RUN_WITH_WEAPON,!0)},n.prototype.playWeaponAttack=function(i,s){void 0===s&&(s=!1),this.curActionData=i,this._isBeatBack=s,this.currAction=this.ANI_WEAPON_ATTACK,this._curAttackType=s?i.beAttackerAttackType:i.attackType;var n="",a=this.playerData.getWeaponData(this.playerData.curStateData.curWeapon);if(a.skillUrl){var o=t.SkillFactory.getSkill(a.id,this,Handler.create(this,this.onEvent,null,!1),Handler.create(this,this.onSkillFinish),null);o.play(a.getWeaponToSkillData())}else 0==this._curAttackType?(t.SoundController.playWeaponSound(1),n=this._attackActionMap[a.type+"-"+a.attack]):(t.SoundController.playThrowWeaponSound(1),n=this._throwAttackActionMap[a.type+"-"+a["throw"]]),this._fighter.once(e.LABEL,this,this.onWeaponEvent,[a]),this.play(n,!1)},n.prototype.onWeaponEvent=function(e,i){switch(i.name){case t.Fighter.EVENT_HIT:this.curHitType=t.Fighter.EVENT_HIT,e.sound&&t.dispatch(t.SoundModule.PLAY_SOUND,e.sound);break;case t.Fighter.EVENT_HIT_START:this.curHitType=t.Fighter.EVENT_HIT_START,e.sound&&t.dispatch(t.SoundModule.PLAY_SOUND,e.sound)}},n.prototype.playNormalAttack=function(t,e){void 0===e&&(e=!1),this.curActionData=t,this._isBeatBack=e,this.play(this.currAction=this.ANI_NORMAL_ATTACK,!1)},n.prototype.playAttackReaction=function(t,e){this.currAction=this.ANI_ATTACK_REACTION,1!=e&&this.checkFlyReaction()?this.play("act_injure_fly",!1):this.play(this.reactuionTypeArr[e],!1)},n.prototype.checkFlyReaction=function(){return this.curActionData.skill>0?this.curActionData.attacker.playerData.getSkillData(this.curActionData.skill).reactionFly:this.curActionData.weapon>0?this.curActionData.attacker.playerData.getWeaponData(this.curActionData.weapon).reactionFly:!1},n.prototype.eventAttactRaction=function(){this.curActionData?(this._isBeatBack?t.dispatch(t.FightStaticStr.BEAT_BACK_REACTION_ACTION,this.curActionData):t.dispatch(t.FightStaticStr.BE_ATTACK_ACTION,this.curActionData),this._isBeatBack=!1):t.Logger.log("不存在curActionData数据！！")},n.prototype.playWin=function(){var t=Math.ceil(2*Math.random());this.play("act_win_"+t,!0)},n.prototype.playLost=function(){var t=Math.ceil(3*Math.random());this.play("act_lose_"+t,!0)},n.prototype.playSlient=function(){this.currAction=this.ANI_ACTION_LOST,this.play("act_trapped_silence",!1)},n.prototype.playStun=function(){this.currAction=this.ANI_ACTION_LOST,this.play("act_trapped_stun",!1)},n.prototype.playGlue=function(){this.currAction=this.ANI_ACTION_LOST,this.play("act_trapped_glue",!1)},n.prototype.changeLayerDown=function(){t.FightData.isRealFight||this.parent.setChildIndex(this,0)},n.prototype.changeLayerUp=function(){this.parent.setChildIndex(this,this.parent.numChildren-1)},n.prototype.playBuffEffect=function(s){var n=t.BuffData.buffMap[s];if(n&&!this._buffEffectMap["buff"+s]){var a=t.ResPath().getEffect(n.effect);if(t.ResData.templetMap[a]){var o=t.ResData.templetMap[a].buildArmature(0);this._buffEffectMap["buff"+s]=o,o.play(0,!0),o.visible=!1,o.y=-this.playerData.npcData[n.position],this.addChild(o),this.changeStand()}else{var r=new i;r.once(e.COMPLETE,this,this.onEffectLoaded,[r,a,s]),r.loadAni(a)}}},n.prototype.onEffectLoaded=function(e,i,s){if(this._buffEffectMap){var n=t.BuffData.buffMap[s];t.ResData.templetMap[i]=e;var a=e.buildArmature(0);this._buffEffectMap["buff"+s]=a,a.play(0,!0),a.visible=!1,a.y=-this.playerData.npcData[n.position],this.addChild(a),this.changeStand()}},n.prototype.deleteBuffEffect=function(t){this._buffEffectMap["buff"+t]&&(this._buffEffectMap["buff"+t].stop(),this.removeChild(this._buffEffectMap["buff"+t]),Laya.timer.frameOnce(1,this,this.delayDestroySke,[this._buffEffectMap["buff"+t]]),delete this._buffEffectMap["buff"+t])},n.prototype.delayDestroySke=function(t){t.destroy()},n.prototype.onAddBuff=function(e){if(e.sideType==this.sideType){switch(e.buffId){case 1:this.playerData.curStateData.isStick=!0,t.dispatch(t.FightStaticStr.FIGHT_WORD_SHOW,{type:8,side:this.sideType,top:this.playerData.npcData.top}),this.currAction!=this.ANI_NORMAL_STAND&&this.currAction!=this.ANI_STAND_WITH_WEAPON||this.playStand();break;case 2:this.playerData.curStateData.isDizzy=!0,this.currAction!=this.ANI_NORMAL_STAND&&this.currAction!=this.ANI_STAND_WITH_WEAPON||this.playStand();break;case 47:this.playerData.curStateData.isDianxue=!0}this.playBuffEffect(e.buffId)}},n.prototype.onDeleteBuff=function(t){if(t.sideType==this.sideType){switch(t.buffId){case 1:this.playerData.curStateData.isStick=!1,this.currAction==this.ANI_JS&&this.playStand();break;case 2:this.playerData.curStateData.isDizzy=!1,this.currAction==this.ANI_DIZZY&&this.playStand();break;case 47:this.playerData.curStateData.isDianxue=!1}this.deleteBuffEffect(t.buffId)}},n.prototype.changeStand=function(){this.currAction!=this.ANI_NORMAL_STAND&&this.currAction!=this.ANI_STAND_WITH_WEAPON||this.playStand()},n.prototype.setFighterScale=function(t,e){this._fighter.scale(t,e)},n.prototype.hitDropWeapon=function(t){t.length>0&&this.playDropWeapon(t[0]),t.length>1&&Laya.timer.once(200,this,this.playDropWeapon,[t[1]]),t.length>2&&Laya.timer.once(400,this,this.playDropWeapon,[t[2]],!1)},n.prototype.playDropWeapon=function(e){var i=this.playerData.getWeaponData(e),s=Laya.Loader.getRes(t.ResPath().getFightWeapon(i.id,i.level));if(s){var n=t.ResData.qqTemple.buildArmature(2);n.on(Laya.Event.STOPPED,this,this.onDropEnd,[n]),n.scale(this._fighter.scaleX,this._fighter.scaleY),n.showSkinByName("default"),n.play("act_drop",!1),n.setSlotSkin("wuqi",s),n.visible=!1,Laya.timer.frameOnce(5,this,this.delayVisible,[n]),this.addChildAt(n,0)}},n.prototype.delayVisible=function(t){t.visible=!0},n.prototype.onDropEnd=function(t){t.parent&&t.parent.removeChild(t),Laya.timer.frameOnce(1,this,this.delayDestroySke,[t])},n}(t.Fighter);t.QQFighter=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t,i){e.call(this,t,i),this.ANI_WARM_UP="act_enter",this.ANI_NORMAL_STAND="act_idle",this.ANI_NORMAL_ATTACK="act_attack",this.reactuionTypeArr=["act_evade","act_evade","act_injure","act_injure","act_injure"]}return __extends(i,e),i.prototype.onEvent=function(e){switch(e.name){case t.Fighter.EVENT_HIT:this.curHitType=t.Fighter.EVENT_HIT,this.eventAttactRaction();break;case t.Fighter.EVENT_HIT_DEFAULT:t.Fighter.EVENT_HIT==this.opposeFighter.curHitType&&this.playReactionEnd();break;case t.Fighter.EVENT_HIT_START:this.curHitType=t.Fighter.EVENT_HIT_START,this.eventAttactRaction();break;case t.Fighter.EVENT_HIT_END:t.dispatch(t.FightStaticStr.EVENT_HIT_END)}e.name==t.Fighter.EVENT_EFFECT&&this.curActionData.skill>0&&this.playSkillEffect(this.curActionData.skill)},i.prototype.setWeaponEmpty=function(){},i.prototype.playStand=function(){this.playerData.curStateData.isDizzy||this.playerData.curStateData.isStick?this.play(this.currAction=this.ANI_NORMAL_STAND,!0,!1,!0):this.play(this.currAction=this.ANI_NORMAL_STAND,!0),this.showBuffEffect()},i.prototype.setSkin=function(){this.playerData.npcData.skin&&this._fighter.showSkinByName(this.playerData.npcData.skin)},i.prototype.playSkill=function(t){this.curActionData=t,this.currAction=this.ANI_SKILL_ATTACK,this.play("act_cast",!1)},i.prototype.playAssistSkill=function(e){this.curActionData=e,this.currAction=this.ANI_SKILL_ATTACK;var i=this.playerData.getSkillData(this.curActionData.assistantSkill);if(this.play("act_cast",!1),""!=i.sourceUrl){var s=new t.NormalSkill(this,null,Handler.create(this,this.onAssistSkillFinish),null);s.play(i)}else this.currAction=this.ANI_SKILL_ASSIST;t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this,type:t.FloatWordController.ASSIST_SKILL_WORD,name:i.name})},i.prototype.playAttackReaction=function(t,e){this.currAction=this.ANI_ATTACK_REACTION,this.play(this.reactuionTypeArr[e],!1)},i.prototype.playWin=function(){this.play("act_win",!0)},i.prototype.playLost=function(){this.play("act_lose",!0)},i}(t.QQFighter);t.NPCFighter=e;
}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i,s,n){e.call(this,i,s),this.reactuionTypeArr=["act_injure","act_injure","act_injure","act_injure","act_injure"];var a=[501,502,503,504],o=0;this._screen=new Sprite,t.FightUIView.bottomLayer.addChildAt(this._screen,0),this._screen.loadImage(t.ResPath().getFightScene("50001_1","png"),0,-t.LayerMgr.offY,1334,t.LayerMgr.clientHeight);for(var r=0;r<a.length;r++){var h=new t.NPCData(1,a[r]);if(a[r]!=n)var l=new t.AnimationSKe(h.sourceUrl,2);else var l=new t.AnimationSKe(t.ResPath().getAnim("dffect_ds",t.ResourcePath.PATH_NPC),2);l.showSkinByName(h.skin),l.scaleX=-1,a[r]!=n?(t.FightUIView.bottomLayer.addChildAt(l,0),this["_snake"+o]=l,l.play("act_ leisure"+(o+1),!0),o++):(l.visible=!1,t.FightUIView.playerLayer.addChild(l),this._upSnake=l,this._upSnake.on(Laya.Event.STOPPED,this,this.onUpStop))}}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),this._snake0&&this._snake0.destroy(),this._snake1&&this._snake1.destroy(),this._snake2&&this._snake2.destroy(),this._upSnake&&this._upSnake.destroy(),this._snake0=null,this._snake1=null,this._snake2=null,this._upSnake=null,this._screen&&this._screen.parent&&(this._screen.parent.removeChild(this._screen),this._screen.destroy()),this._screen=null},i.prototype.onUpStop=function(){this._upSnake.visible=!1},i.prototype.changeLayerDown=function(){},i.prototype.play=function(t,i,s,n){void 0===s&&(s=!0),void 0===n&&(n=!1),e.prototype.play.call(this,t,i,s,n),"act_cast"==t&&(this._upSnake.visible=!0,this._upSnake.play("act_cast_up",!1)),"act_attack"==t&&(this._upSnake.visible=!0,this._upSnake.play("act_attack_up",!1)),"act_lose"==t&&(this._upSnake.visible=!0,this._upSnake.play("act_lose_up",!1)),"act_win"==t&&(this._upSnake.visible=!0,this._upSnake.play("act_win_up",!1))},i.prototype.setSrcPos=function(t,i){e.prototype.setSrcPos.call(this,t,i),this._snake0&&(this._snake0.x=t,this._snake0.y=i),this._snake1&&(this._snake1.x=t,this._snake1.y=i),this._snake2&&(this._snake2.x=t,this._snake2.y=i),this._upSnake&&(this._upSnake.x=t,this._upSnake.y=i)},i.prototype.changeRate=function(t){e.prototype.changeRate.call(this,t),this._upSnake&&this._upSnake.playbackRate(t),this._snake0&&this._snake0.playbackRate(.3*t),this._snake1&&this._snake1.playbackRate(.3*t),this._snake2&&this._snake2.playbackRate(.3*t)},i}(t.NPCFighter);t.SnakeBossFighter=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.update=function(t){this.picIcon.skin="ui/faction/factiontotem/picBig"+t.pic+".png",this.flagIcon.skin="ui/faction/factiontotem/flagBig"+t.flag+".png",this.tableIcon.skin="ui/faction/factiontotem/tableBig"+t.table+".png",this.onLoadComplete(),this.cacheAs="none"},i.prototype.onLoadComplete=function(){this.effectSke&&(this.removeChild(this.effectSke),this.effectSke.destroy(),this.effectSke=null),this.effectSke=new t.AnimationSKe(t.ResPath().getEffect("effect_qi"),2),this.effectSke.on(Laya.Event.STOPPED,this,this.onSkeStop),this.addChildAt(this.effectSke,0),this.effectSke.x=150,this.effectSke.y=456,this.playAni()},i.prototype.onSkeStop=function(){this.effectSke&&(this.removeChild(this.effectSke),this.effectSke.destroy(),this.effectSke=null)},i.prototype.playAni=function(){this.y-=200,Laya.Tween.to(this,{y:this.y+200},100,null,Handler.create(this,this.onStep1))},i.prototype.onStep1=function(){this.effectSke&&this.effectSke.play(0,!1),Laya.Tween.to(this,{rotation:-3},25,null,Handler.create(this,this.onStep2))},i.prototype.onStep2=function(){Laya.Tween.to(this,{rotation:3},50,null,Handler.create(this,this.onStep3))},i.prototype.onStep3=function(){Laya.Tween.to(this,{rotation:1},15,null,Handler.create(this,this.onStep4))},i.prototype.onStep4=function(){Laya.Tween.to(this,{rotation:-1},30,null,Handler.create(this,this.onStep5))},i.prototype.onStep5=function(){Laya.Tween.to(this,{rotation:0},15,null,Handler.create(this,this.onEnd))},i.prototype.onEnd=function(){this.cacheAs="bitmap"},i}(ui.fight.FightFactionTotemUI);t.FightFactionTotem=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.clear=function(){this.graphics.clear()},i.prototype.init=function(e){50001==e&&this.loadImage(t.ResPath().getFightScene("50001_0","png"),0,462)},i}(Laya.Sprite);t.FightFrontScene=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.type=t.FightStaticStr.LEFT_SIDE,t.addListener(t.FightStaticStr.SUB_HP,this,this.onSubHp),t.addListener(t.FightStaticStr.ADD_HP,this,this.onAddHp)}return __extends(i,e),i.prototype.destroy=function(){t.removeListener(t.FightStaticStr.SUB_HP,this,this.onSubHp),t.removeListener(t.FightStaticStr.ADD_HP,this,this.onAddHp),e.prototype.destroy.call(this)},Object.defineProperty(i.prototype,"type",{set:function(e){this._type=e,t.FightStaticStr.RIGHT_SIDE==this._type?(this.hp1.visible=!1,this.hp2.visible=!1,this.hp3.visible=!0,this.hp4.visible=!0,this.hp3.scrollRect=new Laya.Rectangle(0,0,this.width,20),this.hp4.scrollRect=new Laya.Rectangle(0,0,this.width,20)):(this.hp1.visible=!0,this.hp2.visible=!0,this.hp3.visible=!1,this.hp4.visible=!1,this.hp1.scrollRect=new Laya.Rectangle(0,0,this.width,20),this.hp2.scrollRect=new Laya.Rectangle(0,0,this.width,20))},enumerable:!0,configurable:!0}),i.prototype.setHP=function(e,i){this._curHP=e,this._maxHP=i,this.hpTxt.text=e+"/"+i,t.FightStaticStr.RIGHT_SIDE==this._type?(Laya.Tween.clearTween(this.hp3),Laya.Tween.clearTween(this.hp4),Laya.Tween.clearTween(this.hp3.scrollRect),Laya.Tween.clearTween(this.hp4.scrollRect),this.hp3.x=this.width*(1-this._curHP/this._maxHP),this.hp4.x=this.width*(1-this._curHP/this._maxHP),this.hp3.scrollRect.x=this.width*(1-this._curHP/this._maxHP),this.hp4.scrollRect.x=this.width*(1-this._curHP/this._maxHP)):(Laya.Tween.clearTween(this.hp1.scrollRect),Laya.Tween.clearTween(this.hp2.scrollRect),this.hp1.scrollRect.width=this.width*(this._curHP/this._maxHP),this.hp2.scrollRect.width=this.width*(this._curHP/this._maxHP))},i.prototype.subHP=function(e){this._curHP-=e,this._curHP<0&&(this._curHP=0),this.hpTxt.text=this._curHP+"/"+this._maxHP,t.FightStaticStr.RIGHT_SIDE==this._type?(Laya.Tween.to(this.hp3,{x:this.width*(1-this._curHP/this._maxHP)},1500/t.FightController.TIME_SCALE),Laya.Tween.to(this.hp4,{x:this.width*(1-this._curHP/this._maxHP)},500/t.FightController.TIME_SCALE),Laya.Tween.to(this.hp3.scrollRect,{x:this.width*(1-this._curHP/this._maxHP)},1500/t.FightController.TIME_SCALE),Laya.Tween.to(this.hp4.scrollRect,{x:this.width*(1-this._curHP/this._maxHP)},500/t.FightController.TIME_SCALE)):(Laya.Tween.to(this.hp1.scrollRect,{width:this.width*(this._curHP/this._maxHP)},500/t.FightController.TIME_SCALE),Laya.Tween.to(this.hp2.scrollRect,{width:this.width*(this._curHP/this._maxHP)},1500/t.FightController.TIME_SCALE))},i.prototype.addHP=function(e){this._curHP+=e,this._curHP>this._maxHP&&(this._curHP=this._maxHP),this.hpTxt.text=this._curHP+"/"+this._maxHP,t.FightStaticStr.RIGHT_SIDE==this._type?(Laya.Tween.to(this.hp3,{x:this.width*(1-this._curHP/this._maxHP)},1500/t.FightController.TIME_SCALE),Laya.Tween.to(this.hp4,{x:this.width*(1-this._curHP/this._maxHP)},500/t.FightController.TIME_SCALE),Laya.Tween.to(this.hp3.scrollRect,{x:this.width*(1-this._curHP/this._maxHP)},1500/t.FightController.TIME_SCALE),Laya.Tween.to(this.hp4.scrollRect,{x:this.width*(1-this._curHP/this._maxHP)},500/t.FightController.TIME_SCALE)):(Laya.Tween.to(this.hp1.scrollRect,{width:this.width*(this._curHP/this._maxHP)},500/t.FightController.TIME_SCALE),Laya.Tween.to(this.hp2.scrollRect,{width:this.width*(this._curHP/this._maxHP)},1500/t.FightController.TIME_SCALE))},i.prototype.onSubHp=function(t){this._type==t.type&&this.subHP(t.subNum)},i.prototype.onAddHp=function(t){this._type==t.type&&this.addHP(t.addNum)},i}(ui.HpUIUI);t.FightHpUIView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.visible=!1,this._maxValue=1e4,this.maskSp.gray=!0,this.icon.scrollRect=new Laya.Rectangle(0,0,this.width,this.height),t.addListener(t.FightStaticStr.FIGHT_SHOW_MONSTER_LOGO,this,this.onShowMonster),t.addListener(t.FightStaticStr.FIGHT_ADD_MONSTER_VALUE,this,this.onAddVlue)}return __extends(i,e),i.prototype.onShowMonster=function(e){e.type==this.sideType&&(this.visible=e.show,this.visible&&(this.icon.skin=t.ResPath().getPic("logo"+e.id,t.ResourcePath.PATH_MONSTER),this.maskSp.skin=t.ResPath().getPic("logo"+e.id,t.ResourcePath.PATH_MONSTER)),this._curValue=0,this._fullRageAni&&(this._fullRageAni.stop(),this._fullRageAni.visible=!1),this.updateLogo())},i.prototype.onAddVlue=function(e){e.type==this.sideType&&this.visible&&e.value&&(this._curValue+=e.value,this._curValue>this._maxValue&&(this._curValue=this._maxValue),this._curValue==this._maxValue&&(this._fullRageAni||(this._fullRageAni=new t.AnimationSKe(t.ResPath().getEffect("effect_fullrage"))),this._fullRageAni.play(0,!0),this._fullRageAni.visible=!0,this._fullRageAni.x=this.width/2,this._fullRageAni.y=this.height/2,this.addChildAt(this._fullRageAni,0)),this.updateLogo())},i.prototype.updateLogo=function(){this.numTxt.text=Math.floor(this._curValue/this._maxValue*100)+"%",this.icon.scrollRect.y=(1-this._curValue/this._maxValue)*this.height,this.icon.y=(1-this._curValue/this._maxValue)*this.height},i}(ui.fight.FightMonsterUI);t.FightMonsterView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.headHit.on(Laya.Event.CLICK,this,this.onClickHead)}return __extends(i,e),i.prototype.update=function(e){t.Util.DecodeJSONProperty("name",e),this._curData=e,this.level.text=e.level+"",e.factionData.factionId?this.playerTxt.text=e.name+"【帮:"+e.factionData.factionName+"】("+e.factionData.factionPosition+")":this.playerTxt.text=e.name,this.vip.text=e.vip+"",1==e.gender?this.headHit.skin="ui/fight/NPC1.png":this.headHit.skin="ui/fight/NPC2.png",0!=e.utype?(this.head.loadImage(t.ResPath().getPic(e.utype,t.ResourcePath.PATH_NPC_HEAD),0,0,77,77),this.head.visible=!0,this.vip.visible=!1,this.vipIcon.visible=!1):(e.headUrl?(this.head.loadImage(t.JSUtils.getHeadUrl(e.headUrl),0,0,77,77),this.head.visible=!0):this.head.visible=!1,this.vip.visible=!0,this.vipIcon.visible=!0)},i.prototype.clearUI=function(){this.head.graphics.clear()},i.prototype.onClickHead=function(){this._curData.isRole&&!t.FightModule.isShareReplay&&t.Facade.callCommand(new t.UserInfoCommand(this._curData.uin+"",1))},i}(ui.fight.FightPlayerInfoUI);t.FightPlayerInfoView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.hpBg.x=396,this.hpBg.scaleX=-1,this.headHit.x=402,this.headFrame.x=395,this.levelBg.x=533,this.levelBg.scaleX=-1,this.level.x=464,this.vip.x=404,this.playerTxt.x=0,this.playerTxt.align="right",this.vipIcon.x=491,this.vipIcon.scaleX=-.7}return __extends(i,e),i.prototype.update=function(i){t.Util.DecodeJSONProperty("name",i),e.prototype.update.call(this,i),i.factionData.factionId?this.playerTxt.text="("+i.factionData.factionPosition+")【帮:"+i.factionData.factionName+"】"+i.name:this.playerTxt.text=i.name},i}(t.FightPlayerInfoView);t.FightRightPlayerInfoView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this._roundWord=new t.ImageWord("assets/word/round/"),this._roundWord.y=42,this.addChild(this._roundWord)}return __extends(i,e),i.prototype.destory=function(){e.prototype.destroy.call(this),this._roundWord=null},i.prototype.update=function(t){this._curRound!=t&&(this._curRound=t,this._roundWord.showWord(""+t),this._roundWord.x=(this.width-this._roundWord.imgWidth)/2)},i}(ui.fight.FightRoundUI);t.FightRoundView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.on(Laya.Event.CLICK,this,this.onClick)}return __extends(i,e),i.prototype.update=function(e){this._curData=e,e.id<3e5?this.icon.skin=t.ResPath().getPic(e.id,t.ResourcePath.PATH_WEAPON,e.level):this.icon.skin=t.ResPath().getPic(e.id,t.ResourcePath.PATH_SKILL,e.level)},i.prototype.onClick=function(){t.dispatch(t.FightStaticStr.FIGHT_SELECT_ACTION,this._curData)},i}(ui.fight.FightSkillItemUI);t.FightSkillItem=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.btn.on(laya.events.Event.CLICK,this,this.onClickSkip),t.Global.isTest?this.visible=!0:this.visible=!1}return __extends(i,e),i.prototype.init=function(){t.Global.isTest||(this.visible=t.FightController.IS_REPLAY)},i.prototype.onClickSkip=function(){t.dispatch(t.FightStaticStr.SKIP_FIGHT)},i}(ui.fight.FightSkipUI);t.FightSkipView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this._maxSpeed=1,this._speedWord=new t.ImageWord("assets/word/speed/"),this._speedWord.showWord("x1"),this.addChild(this._speedWord),this._speedWord.y=(this.height-this._speedWord.imgHeight)/2,this._speedWord.x=(this.width-this._speedWord.imgWidth)/2,this.btn.on(Laya.Event.CLICK,this,this.onClickSpeed)}return __extends(i,e),i.prototype.initSpeed=function(){var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL);e?this._maxSpeed=e.speedUp>=2?e.speedUp:e.level>=15?2:e.speedUp:this._maxSpeed=3;var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);if(i)var s=i.fightSpeed>this._maxSpeed?this._maxSpeed:i.fightSpeed;else var s=1;s=Math.floor(s),t.FightController.TIME_SCALE=0>=s?1:s,this._speedWord.showWord("x"+t.FightController.TIME_SCALE),Laya.SoundManager.playbackRate=t.FightController.TIME_SCALE,1==t.FightController.TIME_SCALE&&(t.FightController.TIME_SCALE=1.3)},i.prototype.onClickSpeed=function(){var e=Math.floor(t.FightController.TIME_SCALE);e++,e>this._maxSpeed&&(e=1,1==this._maxSpeed&&t.Facade.callCommand(new t.ShowChangeRewardCmd(["15级开启2倍速度，达人3开启3倍速度"],200,"#ffec49")),2==this._maxSpeed&&t.Facade.callCommand(new t.ShowChangeRewardCmd(["达人3开启3倍速度"],200,"#ffec49"))),this._speedWord.showWord("x"+e),Laya.SoundManager.playbackRate=e,1==e&&(e=1.3),t.FightController.TIME_SCALE=e,t.dispatch(t.FightStaticStr.FIGHT_SPEED_CHANGE,e)},i}(ui.fight.FightSpeedUI);t.FightSpeedView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.Event,i=laya.ani.bone.Templet,s=function(s){function n(){s.call(this,new ui.result.FightTestUI,!0,!0,!0,!1),this._curAction="act_attack",this._skillId=0,this._skillLevel=0,this._weaponId=0,this._weaponLevel=0,this._assistSkill=0,this._assistSkillLevel=0,this._bgId=30010,this._NPCId=0,this.m_ui=this.skin,this.setCloseButton(this.m_ui.back.closeBtn),this.setCloseButton(this.m_ui.btnClose),this.m_ui.tab.labels="战\n斗,查看\nNPC,查看\n特效,模拟\n战斗",this.m_ui.tab.selectHandler=new Handler(this,this.onSelectTab),this.m_ui.tab.selectedIndex=0,this.m_ui.fightBtn.on(Laya.Event.CLICK,this,this.onClickFight),this.m_ui.viewBtn.on(Laya.Event.CLICK,this,this.onClickView),this.m_ui.viewBtn2.on(Laya.Event.CLICK,this,this.onClickViewBuff),this.m_ui.act_attack.on(Laya.Event.CLICK,this,this.onChangeAction),this.m_ui.act_cast.on(Laya.Event.CLICK,this,this.onChangeAction),this.m_ui.act_enter.on(Laya.Event.CLICK,this,this.onChangeAction),this.m_ui.act_evade.on(Laya.Event.CLICK,this,this.onChangeAction),this.m_ui.act_idle.on(Laya.Event.CLICK,this,this.onChangeAction),this.m_ui.act_injure.on(Laya.Event.CLICK,this,this.onChangeAction),this.m_ui.act_lose.on(Laya.Event.CLICK,this,this.onChangeAction),this.m_ui.act_win.on(Laya.Event.CLICK,this,this.onChangeAction),this.m_ui.viewEffect.on(Laya.Event.CLICK,this,this.onClickViewEffect),this.m_ui.moFight.on(Laya.Event.CLICK,this,this.onClickMofight),this.m_ui.actionBox.selectHandler=Handler.create(this,this.onSelectActionBox,null,!1),this.m_ui.sexBox.selectHandler=Handler.create(this,this.onSelectSexBox,null,!1),this.m_ui.speedBox.selectHandler=Handler.create(this,this.onSelectSpeedBox,null,!1)}return __extends(n,s),n.prototype.onClickFight=function(){var e=this.m_ui.txt.text;-1==e.indexOf("{")&&-1==e.indexOf("}")?-1==e.indexOf("&V")?t.Facade.callCommand(new t.FightReplayCommand(e)):t.Facade.callCommand(new t.FightCommand(e)):t.Facade.callCommand(new t.FightCommand(JSON.parse(e)))},n.prototype.destroy=function(){this._npc&&(this._npc.destroy(),this._npc=null),s.prototype.destroy.call(this)},n.prototype.onSelectTab=function(t){switch(this.m_ui.codeSp.visible=!1,this.m_ui.npcSp.visible=!1,this.m_ui.effectSp.visible=!1,this.m_ui.fightSp.visible=!1,t){case 0:this.m_ui.codeSp.visible=!0;break;case 1:this.m_ui.npcSp.visible=!0;break;case 2:this.m_ui.effectSp.visible=!0;break;case 3:this.m_ui.fightSp.visible=!0}},n.prototype.onClickView=function(){return this._curNPC=this.m_ui.npcIdTxt.text,this._curNPC?(Laya.loader.on(Laya.Event.ERROR,this,this.onError),void Laya.loader.load(t.ResPath().getAnim(this._curNPC,t.ResourcePath.PATH_NPC),Handler.create(this,function(){var s=new i;s.once(e.COMPLETE,this,function(t){this._npc&&(this._npc.destroy(),this._npc=null),this._npc=t.buildArmature(2),this._npc.x=290,this._npc.y=640,this._npc.on(e.LABEL,this,this.onNPCEvent),this.m_ui.npcSp.addChild(this._npc),this.playNPC()},[s]),s.loadAni(t.ResPath().getAnim(this._curNPC,t.ResourcePath.PATH_NPC))}),null,Loader.BUFFER)):void t.WeakTips.show("请输入NPCID")},n.prototype.onClickViewBuff=function(){return this.buffId=parseInt(this.m_ui.buffTxt.text),this.buffId?t.BuffData.buffMap[this.buffId]?(this.buffTemplet=new i,this.buffTemplet.once(e.COMPLETE,this,this.playBuff),void this.buffTemplet.loadAni(t.ResPath().getEffect(t.BuffData.buffMap[this.buffId].effect))):void t.WeakTips.show("没有此buff配置"):void t.WeakTips.show("请输入BUFFID")},n.prototype.delayDestroy=function(t,e){t.destroy(),e.destroy()},n.prototype.playBuff=function(){this.buffEffect=this.buffTemplet.buildArmature(2),this.buffEffect.x=290,this.buffEffect.y=640,this.m_ui.npcSp.addChild(this.buffEffect);var e=t.BuffData.buffMap[this.buffId];if(this._curNPC)var i=new t.NPCData(1,parseInt(this._curNPC));i&&(this.buffEffect.y-=i[e.position]),this.buffEffect.play(0,!0)},n.prototype.onNPCEvent=function(e){t.Logger.log(e.name),t.WeakTips.show(e.name)},n.prototype.onError=function(){t.WeakTips.show("不存在NPC："+this._curNPC+"的资源")},n.prototype.onError2=function(){t.WeakTips.show("不存在buff："+this.buffId+"的资源")},n.prototype.playNPC=function(){this._npc&&this._npc.play(this._curAction,!0)},n.prototype.onChangeAction=function(t){this._curAction=t.target.name,this.m_ui.actionTxt.text=this._curAction,this.playNPC()},n.prototype.onClickViewEffect=function(){if(this._curEffect=this.m_ui.effectTxt.text,!this._curEffect)return void t.WeakTips.show("请输入特效名字");this.m_ui.actionBox.labels="",Laya.loader.on(Laya.Event.ERROR,this,this.onErrorEffect);var s=this.m_ui.resNPC.selected?t.ResPath().getAnim(this._curEffect,t.ResourcePath.PATH_NPC):t.ResPath().getEffect(this._curEffect);Laya.loader.load(s,Handler.create(this,function(){var s=new i;s.once(e.COMPLETE,this,function(t){this._effect&&(this._effect.stop(),this._effect.destroy(),this._effect=null),this._effect=t.buildArmature(2),this._effect.x=290,this._effect.y=640,this._effect.on(e.LABEL,this,this.onEffectEvent),this.m_ui.effectSp.addChildAt(this._effect,1);var i=s._anis;if(i){for(var n="",a=0;a<i.length;a++)n+=a!=i.length-1?i[a].name+",":i[a].name;this.m_ui.actionBox.labels=n}if(t.skinDataArray){for(var n="",a=0;a<t.skinDataArray.length;a++)n+=a!=t.skinDataArray.length-1?t.skinDataArray[a].name+",":t.skinDataArray[a].name;this.m_ui.sexBox.labels=n}this.playEffect()},[s]);var n=this.m_ui.resNPC.selected?t.ResPath().getAnim(this._curEffect,t.ResourcePath.PATH_NPC):t.ResPath().getEffect(this._curEffect);s.loadAni(n)}),null,Loader.BUFFER)},n.prototype.playEffect=function(t){void 0===t&&(t=null),this._effect&&(t?this._effect.play(t,!0):this._effect.play(0,!0))},n.prototype.onEffectEvent=function(e){t.WeakTips.show(e.name)},n.prototype.onErrorEffect=function(){t.WeakTips.show("不存在特效："+this._curEffect)},n.prototype.onSelectActionBox=function(t){this.m_ui.actionBox.selectedLabel&&this.playEffect(this.m_ui.actionBox.selectedLabel)},n.prototype.onSelectSexBox=function(t){this.m_ui.sexBox.selectedLabel&&this._effect&&this._effect.showSkinByName(this.m_ui.sexBox.selectedLabel)},n.prototype.onSelectSpeedBox=function(){this._effect&&this._effect.playbackRate(parseFloat(this.m_ui.speedBox.selectedLabel))},n.prototype.onClickMofight=function(){if(this.m_ui.skillId.text?this._skillId=parseInt(this.m_ui.skillId.text):this._skillId=0,this.m_ui.skillLevel.text?this._skillLevel=parseInt(this.m_ui.skillLevel.text):this._skillLevel=0,this.m_ui.weaponId.text?this._weaponId=parseInt(this.m_ui.weaponId.text):this._weaponId=0,this.m_ui.weaponLevel.text?this._weaponLevel=parseInt(this.m_ui.weaponLevel.text):this._weaponLevel=0,this.m_ui.bgID.text?this._bgId=parseInt(this.m_ui.bgID.text):this._bgId=30010,this.m_ui.NPCId.text?this._NPCId=parseInt(this.m_ui.NPCId.text):this._NPCId=0,this.m_ui.assistSkill.text?this._assistSkill=parseInt(this.m_ui.assistSkill.text):this._assistSkill=0,this.m_ui.assistSkillLevel.text?this._assistSkillLevel=parseInt(this.m_ui.assistSkillLevel.text):this._assistSkillLevel=0,this._weaponId>0)var e=new t.WeaponData(this._weaponId,this._weaponLevel),i=e["throw"]>0?1:0;else var i=0;var s="&V:1;&Ty:1;&BG:"+this._bgId+";&TL:1;PL1:100001,0|0,2,,机器人,50,5,300,5,5,1_10|2_10|3_10|4_10|5_10|6_10|7_10;&TR:1;PR1:100002,1|"+this._NPCId+",1,呆萌,机器人2,52,10,300,5,5,"+this._weaponId+"_"+this._weaponLevel+","+this._skillId+"_"+this._skillLevel+"|"+this._assistSkill+"_"+this._assistSkillLevel+";&BN:1;&BT1:1,1;RN:1;R1:2;A1:R,0,"+this._assistSkill+",1,"+this._skillId+","+(this._skillId>0?2:0)+",12,4,L,0,0,0,0,0;A2:R,0,0,1,"+this._weaponId+","+i+",12,2,L,0,0,0,0,0;&RLT:1;&RW:0;";t.Facade.callCommand(new t.FightCommand(s))},n}(t.BaseBox);t.FightTestView=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this._hasOffY=0,this.hitTestPrior=!1,this["static"].cacheAs="bitmap",this.skipEnd.cacheAs="bitmap",this.speed.cacheAs="bitmap",this.leftWord.cacheAs="bitmap",this.rightWord.cacheAs="bitmap",i.bottomLayer=this.bottomLayer,i.frontScene=this.frontScene,i.bottomSkillLayer=this.bottomSkillLayer,i.playerLayer=this.playerLayer,i.skillLayer=this.skillLayer,i.flowLayer=this.flowWord,this.rightHp.type=t.FightStaticStr.RIGHT_SIDE,this.rightWeapon.align=t.FightStaticStr.RIGHT_SIDE,this.leftFace.visible=!1,this.leftWord.visible=!1,this.rightFace.visible=!1,this.rightWord.visible=!1,this.rightBuff.align="right",this.rightBuff.sideType=t.FightStaticStr.RIGHT_SIDE,this._talkController=new t.FightingTalkController(this),this.chainSkillRight.type=t.FightStaticStr.RIGHT_SIDE,this.leftMonster.sideType=t.FightStaticStr.LEFT_SIDE,this.rightMonster.sideType=t.FightStaticStr.RIGHT_SIDE,this.leftInfo.x+=t.Global.FLOAT_ICON_OFFSET,this.rightInfo.x-=t.Global.FLOAT_ICON_OFFSET,this.leftBuff.x+=t.Global.FLOAT_ICON_OFFSET,this.rightBuff.x-=t.Global.FLOAT_ICON_OFFSET,this.leftHp.x+=t.Global.FLOAT_ICON_OFFSET,this.rightHp.x-=t.Global.FLOAT_ICON_OFFSET,this.leftChampion.x+=t.Global.FLOAT_ICON_OFFSET,this.rightChampion.x-=t.Global.FLOAT_ICON_OFFSET,t.addListener(t.FightStaticStr.FIGHT_SPEED_CHANGE,this,this.changeSpeed),t.addListener(t.FightStaticStr.FIGHT_UPDATE_SIMULATOR_SKILL,this,this.updateSimulatorSkill)}return __extends(i,e),i.prototype.changeSpeed=function(t){if(this._curBattleData)for(var e=0;e<this._curBattleData.fighterList.length;e++)this._curBattleData.fighterList[e].changeRate(t)},i.prototype.init=function(){this.leftBuff.clearBuffs(),this.rightBuff.clearBuffs(),this.leftWeapon.clearWeapon(),this.rightWeapon.clearWeapon(),this.showRound(1),this.speed.initSpeed(),this.skipEnd.init(),this.leftTotem.visible=!1,this.rightTotem.visible=!1,this.chainSkillRight.visible=!1,this.chainSkillLeft.visible=!1,this.onResize()},i.prototype.initBg=function(e){t.Global.isRetrench&&50001!=e?(this.background.loadImage(t.ResPath().getFightScene(30001)),this.frontScene.init(30001)):(this.background.loadImage(t.ResPath().getFightScene(e)),this.frontScene.init(e))},i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.clearUI=function(){this.leftInfo.clearUI(),this.rightInfo.clearUI(),this.leftBuff.clearBuffs(),this.rightBuff.clearBuffs(),this.leftWeapon.clearWeapon(),this.rightWeapon.clearWeapon(),this.background.graphics.clear(),this.endWord.clear(),this.frontScene.clear(),this.leftChampion.visible=!1,this.rightChampion.visible=!1,this.rightMonster.visible=!1,this.leftMonster.visible=!1},i.prototype.prepareBattle=function(e){for(var i=e.playerDataList.length-1;i>=0;i--){var s=e.playerDataList[i];if(!e.fighterMap[s.id]){var n=t.FighterFactory.getFighter(s.utype,t.ResData.fighterMap[s.id]);e.fighterMap[s.id]=n,e.fighterList.push(n),n.sideType=s.sideType,s.sideType==t.FightStaticStr.LEFT_SIDE?(n.setSrcPos(s.positionX,s.positionY),n.moveX=-134,0==s.utype?(n.setFighterScale(1,1),n.scale(t.FightData.figherScale,t.FightData.figherScale)):(n.setFighterScale(Math.abs(s.npcData.scale),Math.abs(s.npcData.scale)),n.scale(s.npcData.scale>0?1:-1,1))):(n.setSrcPos(s.positionX,s.positionY),n.moveX=134,0==s.utype?(n.setFighterScale(1,1),n.scale(-t.FightData.figherScale,t.FightData.figherScale)):(n.setFighterScale(Math.abs(s.npcData.scale),Math.abs(s.npcData.scale)),n.scale(-1*(s.npcData.scale>0?1:-1),1))),n.changeRate(t.FightController.TIME_SCALE),n.playerData=s,n.setSkin()}}this.updateMineBuff(e),this.chainSkillRight.clearView(),this.chainSkillLeft.clearView()},i.prototype.updateMineBuff=function(t){this.leftBuff.addMineBuff(t.playerDataList[0].statusArr),this.rightBuff.addMineBuff(t.playerDataList[1].statusArr),t.playerDataList[0].statusArr=[],t.playerDataList[1].statusArr=[]},i.prototype.updateUI=function(t){this._curBattleData=t,this.leftHp.setHP(t.playerDataList[0].HP,t.playerDataList[0].MAX_HP),this.rightHp.setHP(t.playerDataList[1].HP,t.playerDataList[1].MAX_HP),this.leftInfo.update(t.playerDataList[0]),this.rightInfo.update(t.playerDataList[1]),this.addWeaponIcon(t),this.leftChampion.update(t.playerDataList[0]),this.rightChampion.update(t.playerDataList[1])},i.prototype.onResize=function(){if(t.LayerMgr.offY>0){var e=t.LayerMgr.offY-this._hasOffY;this._hasOffY=t.LayerMgr.offY;var i=(t.LayerMgr.height+2*t.LayerMgr.offY)/t.LayerMgr.height;this.background.scaleX=this.background.scaleY=i,this.background.x=-(t.LayerMgr.width*(i-1))/2,this.background.y-=e,this.leftInfo.y-=e,this.rightInfo.y-=e,this.speed.y+=e,this.skipEnd.y+=e,this.round.y-=e,this.leftHp.y-=e,this.rightHp.y-=e,this.leftWeapon.y-=e,this.rightWeapon.y-=e,this.leftBuff.y-=e,this.rightBuff.y-=e,this.frontScene.y+=e,this.leftChampion.y-=e,this.rightChampion.y-=e,this.leftMonster.y-=e,this.rightMonster.y-=e}},i.prototype.showRound=function(t){this.round.update(t)},i.prototype.addWeaponIcon=function(t){0==t.fightData.fightMode?(this.leftWeapon.addWeapons(t.playerDataList[0].weaponMap),this.rightWeapon.addWeapons(t.playerDataList[1].weaponMap)):(this.leftWeapon.clearWeapon(),this.rightWeapon.clearWeapon(),this.leftWeapon.addWeapons(t.playerDataList[0].weaponMapCache),this.rightWeapon.addWeapons(t.playerDataList[1].weaponMapCache)),t.playerDataList[0].weaponMap={},t.playerDataList[1].weaponMap={}},i.prototype.clearBuff=function(e){e==t.FightStaticStr.LEFT_SIDE?this.leftBuff.clearBuffs():this.rightBuff.clearBuffs()},i.prototype.updateFactionTom=function(t,e){t.factionData.factionId>0&&(this.leftTotem.visible=!0,this.leftTotem.update(t.factionData)),e.factionData.factionId>0&&(this.rightTotem.visible=!0,this.rightTotem.update(e.factionData))},i.prototype.showEndWord=function(t){this.endWord.show(t)},i.prototype.updateSimulatorSkill=function(e){this._skillItem||(this._skillItem=[new t.FightSkillItem,new t.FightSkillItem],this["static"].addChild(this._skillItem[0]),this["static"].addChild(this._skillItem[1]),this._skillItem[0].x=564,this._skillItem[0].y=660,this._skillItem[1].x=689,this._skillItem[1].y=660);for(var i=0;2>i;i++)this._skillItem[i].update(e[i])},i}(ui.FightUIUI);t.FightUIView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this._weaponArr=[],this._weaponIcons=[],this._align=t.FightStaticStr.LEFT_SIDE,t.addListener(t.FightStaticStr.THROW_WEAPON,this,this.onThrowWeapon)}return __extends(i,e),i.prototype.destroy=function(){t.removeListener(t.FightStaticStr.THROW_WEAPON,this,this.onThrowWeapon),e.prototype.destroy.call(this)},Object.defineProperty(i.prototype,"align",{set:function(t){this._align=t},enumerable:!0,configurable:!0}),i.prototype.clearWeapon=function(){this._weaponArr.length=0,this.update()},i.prototype.addWeapons=function(t){for(var e in t)t.hasOwnProperty(e)&&this._weaponArr.push({id:parseInt(t[e].id),level:parseInt(t[e].level)});this.update()},i.prototype.update=function(){for(var e=0;e<this._weaponArr.length;e++)this._weaponIcons[e]||(this._weaponIcons.push(new Sprite),this._weaponIcons[e].y=50*Math.floor(e/7),this._align==t.FightStaticStr.LEFT_SIDE?this._weaponIcons[e].x=e%7*60:this._weaponIcons[e].x=this.width-50-e%7*60,this.addChild(this._weaponIcons[e])),this._weaponIcons[e].visible=!0,this._weaponIcons[e].graphics.clear(),this._weaponIcons[e].loadImage(t.ResPath().getPic(t.WeaponData.BASE_WEAPON_ID+this._weaponArr[e].id,t.ResourcePath.PATH_WEAPON,this._weaponArr[e].level),0,0,50,50);for(;e<this._weaponIcons.length;e++)this._weaponIcons[e].visible=!1,this._weaponIcons[e].graphics.clear()},i.prototype.onThrowWeapon=function(t){
if(t.sideType==this._align)for(var e=0;e<this._weaponArr.length;e++)if(this._weaponArr[e].id==t.weaponId){this._weaponArr.splice(e,1),this.update();break}},i}(Laya.Sprite);t.FightWeaponView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i){e.call(this),this._hasShow=!1,this._resultData=i;var s=new Sprite;s.graphics.drawRect(0,0,t.LayerMgr.width,t.LayerMgr.clientHeight,"#000000"),s.alpha=.4,s.y=-t.LayerMgr.offY,s.mouseEnabled=!0,s.size(t.LayerMgr.width,t.LayerMgr.clientHeight),this.addChildAt(s,0),this.resultList.scrollBar.visible=!1,this.endBtn.label="退 出",this.retryBtn.label="进入游戏",this.shareReplayBtn.visible=!1,this.replayBtn.on(Laya.Event.CLICK,this,this.replay),this.endBtn.on(Laya.Event.CLICK,this,this.endClick),this.retryBtn.on(Laya.Event.CLICK,this,this.clickEnter),this.strongBtn.visible=!1,this.showBtn.visible=!1,this._hasShow=!1,this.dayFirstWinBox.visible=!1;var n=3;if(this._resultData.win){this.winTitle.visible=!0,this.loseTitle.visible=!1;this._resultData.award;this.showStar(n)}else this.winTitle.visible=!1,this.loseTitle.visible=!0,this.showStar(0);this.lostTips.visible=!1,this.init(),this.setBgEffectVisible()}return __extends(i,e),i.prototype.destroy=function(){this.replayBtn.off(Laya.Event.CLICK,this,this.replay),this.endBtn.off(Laya.Event.CLICK,this,this.endClick),this.m_djSk&&(this.m_djSk.parent&&this.m_djSk.parent.removeChild(this.m_djSk),this.m_djSk.destroy()),e.prototype.destroy.call(this)},i.prototype.init=function(){t.LayerMgr.addChild(this,t.Layer.FIGHT)},i.prototype.showStar=function(e){this.winBg.visible=0!=e;for(var i=1;3>=i;i++)e>=i?this["star"+i].filters=[]:this["star"+i].filters=t.FiltersUtils.getGreyFilters()},i.prototype.replay=function(){this.onFightAfter(),t.Facade.callCommand(new t.FightReplayCommand(0,!0))},i.prototype.endClick=function(){this.onFightAfter(),t.ShowReplay.closeWindow()},i.prototype.clickEnter=function(){t.FightModule.isShareReplay=!1,this.onFightAfter(),t.ShowReplay.enterGame()},i.prototype.onFightAfter=function(){t.dispatch(t.FightStaticStr.AFTER_FIGHT_COMPLETE),this.parent&&this.parent.removeChild(this),this.destroy()},i.prototype.setBgEffectVisible=function(){this._resultData&&this._resultData.win&&(this.m_djSk=new t.AnimationSKe("assets/skeleton/qieupgrade.sk"),this.addChildAt(this.m_djSk,0),this.m_djSk.play(0,!0),this.m_djSk.x=650,this.m_djSk.y=340)},i}(ui.FightResultUI);t.ReplayResultView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.FightResultUI,!0,!1),this._hasShow=!1,this.m_ui=this.skin,this._isFirst=!0,this.cacheAs="none",this.m_ui.cacheLayer.cacheAs="bitmap",this.canClickModelToClose=!1,this.m_ui.replayBtn.on(Laya.Event.CLICK,this,this.replay),this.m_ui.endBtn.on(Laya.Event.CLICK,this,this.endClick),this.m_ui.retryBtn.on(Laya.Event.CLICK,this,this.retryClick),this.m_ui.strongBtn.on(Laya.Event.CLICK,this,this.strongClick),this.m_ui.showBtn.on(Laya.Event.CLICK,this,this.showClick),this.m_ui.shareReplayBtn.on(Laya.Event.CLICK,this,this.onClickShare),this.m_ui.resultList.itemRender=i,this.m_ui.resultList.scrollBar.visible=!1,this.m_ui.resultList.renderHandler=Handler.create(this,this.renderList2,null,!1)}return __extends(s,e),s.prototype.updatePanel=function(e){this._resultData=e,this.m_ui.retryBtn.x=198,this.m_ui.shareReplayBtn.visible=!1,this.m_ui.showBtn.visible=!1,this._hasShow=!1;var i=3;if(this._resultData.win){t.Logger.log(this._resultData),this.m_ui.winTitle.visible=!0,this.m_ui.loseTitle.visible=!1,this.m_ui.strongBtn.visible=!1;var s=this._resultData.award;s&&s.hasOwnProperty("star")&&2==this._resultData.battleType?(i=s.star,this.showStar(i)):this.showStar(i),s&&this._resultData.award.award&&this._resultData.award.award.showBtn&&(this.m_ui.showBtn.visible=!0)}else this.m_ui.winTitle.visible=!1,this.m_ui.loseTitle.visible=!0,this.m_ui.strongBtn.visible=!0,this.showStar(0);this._resultData.award&&this._resultData.award.repalyid&&(this.m_ui.shareReplayBtn.visible=!0),2==this._resultData.battleType?this._resultData.win?(3>i?this.m_ui.retryBtn.visible=!0:this.m_ui.retryBtn.visible=!1,this.m_ui.lostTips.visible=!1):(this.m_ui.retryBtn.visible=!0,this.m_ui.lostTips.visible=!0):(this.m_ui.retryBtn.visible=!1,this.m_ui.lostTips.visible=!1),9==this._resultData.battleType&&(this.m_ui.retryBtn.visible=!1),1==this._resultData.isDayFirstWin?(this.m_ui.showBtn.visible=!1,this.m_ui.strongBtn.visible=!1,this.m_ui.lostTips.visible=!1,this.m_ui.replayBtn.visible=!1,this.m_ui.shareReplayBtn.visible=!0,this.m_ui.shareReplayBtn.label="分   享",this.m_ui.shareReplayBtn.x=198,9==this._resultData.battleType?(this.m_ui.dayChampionFirstWinBox.visible=!0,this.m_ui.dayFirstWinBox.visible=!1,this.m_ui.replayBtn.visible=!0,this.m_ui.replayBtn.x=397):(this.m_ui.dayFirstWinBox.visible=!0,this.m_ui.dayChampionFirstWinBox.visible=!1)):(this.m_ui.replayBtn.x=198,this.m_ui.replayBtn.visible=!0,this.m_ui.shareReplayBtn.label="分享录像",this.m_ui.shareReplayBtn.x=this.m_ui.retryBtn.x,this.m_ui.dayFirstWinBox.visible=!1,this.m_ui.dayChampionFirstWinBox.visible=!1),this.init(),this.setBgEffectVisible()},s.prototype.destroy=function(){this.m_ui.replayBtn.off(Laya.Event.CLICK,this,this.replay),this.m_ui.endBtn.off(Laya.Event.CLICK,this,this.endClick),this.m_ui.retryBtn.off(Laya.Event.CLICK,this,this.retryClick),this.m_ui.strongBtn.off(Laya.Event.CLICK,this,this.strongClick),e.prototype.destroy.call(this)},s.prototype.onShowed=function(){e.prototype.onShowed.call(this),this._isFirst?this._isFirst=!1:this.resetImageSkin(this)},s.prototype.onHided=function(){e.prototype.onHided.call(this),Laya.loader.clearRes("res/atlas/ui/result.json"),Laya.loader.clearRes("ui/result/rbg.jpg"),Laya.loader.clearRes("ui/result/img_shengli.png"),Laya.loader.clearRes("ui/result/img_shibai.png"),this._winAni&&(this._winAni.destroy(),this._winAni=null)},s.prototype.init=function(){this.changeReward(),this.renderGiftList()},s.prototype.changeReward=function(){},s.prototype.renderGiftList=function(){var e=this._resultData.award?this._resultData.award.award:null;if(e)if(e){var i=new t.DecodeDataCmd(e);t.Facade.callCommand(i),this.setListArray(i.rewardBoxArr)}else this.setListArray([]);else this.setListArray([])},s.prototype.setListArray=function(t){1==this._resultData.isDayFirstWin&&(9==this._resultData.battleType?t.unshift({id:"kKingMedal",name:"王者勋章",num:50,dayFirstWin:!0}):t.unshift({id:100013,name:"中威望旗",num:2,dayFirstWin:!0})),this.m_ui.resultList.array=t},s.prototype.showStar=function(e){this.m_ui.winBg.visible=0!=e;for(var i=1;3>=i;i++)e>=i?this.m_ui["star"+i].filters=[]:this.m_ui["star"+i].filters=t.FiltersUtils.getGreyFilters()},s.prototype.replay=function(){this.onFightAfter(),t.Facade.callCommand(new t.FightReplayCommand)},s.prototype.endClick=function(){t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.FIGHT_CLOSE)),t.dispatch(t.FightStaticStr.FIGHT_COMPLETE),this.onFightAfter()},s.prototype.retryClick=function(){t.Facade.callCommand(new t.FightRetryCommand),this.onFightAfter()},s.prototype.strongClick=function(){t.Facade.callCommand(new t.OpenStrengthBoxCommand),this.onFightAfter()},s.prototype.showClick=function(){this._hasShow?t.WeakTips.show("只能发送一次炫耀哦！"):t.Global.isWXAPP?t.ShareModule.shareMessage({title:["成王败寇","欧耶~","我打败你啦~"],desc:["本鹅轻轻松松就战胜了你，要不要打回来呀？","可以给自己先制定一个小目标，那就是战胜本鹅一次嘛！","本鹅似乎才发挥了50%的实力就战胜了你呐！","本鹅似乎才发挥了50%的实力就战胜了你呐！"],toUin:this._resultData.award.award.uin,uid:this._resultData.award.award.uid,image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(7)),alertType:1,command:1002},Handler.create(this,this.showCallBack),2):t.ShareModule.shareMessage({title:["成王败寇","欧耶~","我打败你啦~"],desc:["本鹅轻轻松松就战胜了你，要不要打回来呀？","可以给自己先制定一个小目标，那就是战胜本鹅一次嘛！","本鹅似乎才发挥了50%的实力就战胜了你呐！","本鹅似乎才发挥了50%的实力就战胜了你呐！"],toUin:this._resultData.award.award.uin,uid:this._resultData.award.award.uid,alertType:1,command:1002},Handler.create(this,this.showCallBack),2)},s.prototype.onClickShare=function(){if(1==this._resultData.isDayFirstWin){if(9==this._resultData.battleType){var e,i;e="王者争霸【胜利】",i="击败【"+this._resultData.award.oppinfo.name+"】！！！对方很强，但我，更强…",t.ShareModule.shareMessage({title:[e],desc:[i]},new Handler(this,this.getChampionShareReward),16)}else{var s=["游戏就要轻松玩","斗天斗地斗空气"],n=["唉！现在的男人不提也罢，连我都斗不过！","唉！现在的女人不提也罢，连我都斗不过！","你有freestyle吗？要不要我秀给你看看？","天王盖地虎，本鹅一米五！"];t.Global.isWXAPP?t.ShareModule.shareMessage({title:[s[Math.floor(Math.random()*s.length)]],desc:[n[Math.floor(Math.random()*n.length)]],image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(14)),param:101},null,2):t.ShareModule.shareMessage({title:[s[Math.floor(Math.random()*s.length)]],desc:[n[Math.floor(Math.random()*n.length)]],param:101},null,2)}this.endClick()}else{var a="https://res.ledou.qq.com/show_replay.html?_wv=2147674919&pf="+t.Global.PF+"&replay_id="+this._resultData.award.repalyid+"&invitor="+t.Global.UID+"&invite_openid="+t.Global.OPENID;t.ShareModule.shareMessage({title:[t.Global.GameName],desc:["精彩战斗分享"],alertType:1,share_url:a},null,16),t.XHR().Post({cmd:"saverep",repid:this._resultData.award.repalyid},null,null)}},s.prototype.getChampionShareReward=function(){t.Facade.callCommand(new t.ChampionShareRewardCmd)},s.prototype.showCallBack=function(e){e&&0==e.retCode?(this._hasShow=!0,t.Logger.log("分享成功：showCallBack")):t.Logger.log("分享失败：showCallBack")},s.prototype.onFightAfter=function(){t.dispatch(t.FightStaticStr.AFTER_FIGHT_COMPLETE),this.parent&&this.parent.removeChild(this),this.hide()},s.prototype.renderList2=function(t,e){t.setData(this.m_ui.resultList.getItem(e))},s.prototype.setBgEffectVisible=function(){this._resultData&&this._resultData.win&&(this._winAni=new t.AnimationSKe("assets/skeleton/qieupgrade.sk"),this.m_ui.addChildAt(this._winAni,0),this._winAni.play(0,!0),this._winAni.x=650,this._winAni.y=340)},s}(t.BaseBox);t.ResultView=e;var i=function(e){function i(){e.call(this),this.dayFirstWinPng.visible=!1}return __extends(i,e),i.prototype.setData=function(e){e&&(this.icon.graphics.clear(),this.icon.loadImage(t.ResPath().getPic(e.id,t.ResourcePath.PATH_GOODS),0,0,85,85),e.num>=0?this.txt.text="+"+e.num:this.txt.text=e.num,this.nameTxt.text=e.name,this.dayFirstWinPng.visible=1==e.dayFirstWin)},i}(ui.result.ResultGiftItemUI);(function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.setData=function(e){e&&(this.goodsNum.text="X"+e.num,this.icon.loadImage(t.ResPath().getPic(e.id,t.ResourcePath.PATH_GOODS)),this.goodsName.text=e.name)},i})(ui.result.ResultGoodItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.playScreen=function(){this.leftScreen.x=1,this.rightScreen.x=1333,Laya.Tween.to(this.leftScreen,{x:this.leftScreen.x-668},500),Laya.Tween.to(this.rightScreen,{x:this.rightScreen.x+668},500,null,Laya.Handler.create(this,this.onScreenEnd))},i.prototype.onScreenEnd=function(){this.leftScreen.x=1,this.rightScreen.x=1333,this.parent&&this.parent.removeChild(this),t.dispatch(t.FightStaticStr.SCREEN_OVER)},i}(ui.ScreenUI);t.ScreenView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.Event,i=laya.ani.bone.Templet,s=function(s){function n(){s.call(this),this._qqLoadComplete=!0,n.attackActionMap={"2-0":"act_attack_1_2","2-1":"act_attack_1_1","1-0":"act_attack_2_2","1-1":"act_attack_2_1","0-0":"act_attack_2_2","0-1":"act_attack_2_1"},n.throwAttackActionMap={"2-0":"act_throw_1","1-0":"act_throw_1","0-0":"act_throw_1","2-1":"act_throw_1","1-1":"act_throw_1","0-1":"act_throw_1","2-2":"act_throw_2","1-2":"act_throw_2","0-2":"act_throw_2","2-3":"act_throw_3","1-3":"act_throw_3","0-3":"act_throw_3"},n.standActionMap={"2-0":"act_breath_1","1-0":"act_breath_2","0-0":"act_breath_3","2-1":"act_breath_3","1-1":"act_breath_3","0-1":"act_breath_3","2-2":"act_breath_3","1-2":"act_breath_3","0-2":"act_breath_3"}}return __extends(n,s),n.prototype.destroy=function(){this.parent&&this.parent.removeChild(this),this._fighter&&this._fighter.stop(),this._skillSkelton&&this._skillSkelton.stop(),this._enemyFighter&&this._enemyFighter.stop(),t.ResData.qqTemple&&(t.ResData.qqTemple.off(Laya.Event.COMPLETE,this,this.onQQLoad),t.ResData.qqTemple.off(Laya.Event.ERROR,this,this.onQQLoadError),this._qqLoadComplete||(t.ResData.qqTemple.destroy(),t.ResData.qqTemple=null)),Laya.timer.frameOnce(1,this,this.delayDestroy)},n.prototype.delayDestroy=function(){this._fighter&&this._fighter.destroy(),this._enemyFighter&&this._enemyFighter.destroy(),this._skillSkelton&&this._skillSkelton.destroy(),this._skillTemplet&&this._skillTemplet.destroy(),this._weaponTemplet&&this._weaponTemplet.destroy(),this._fighter=null,this._skillSkelton=null,this._skillTemplet=null,this._weaponTemplet=null,this._enemyFighter=null,s.prototype.destroy.call(this)},n.prototype.checkFighter=function(){return this._fighter?!0:!this._fighter&&t.ResData.qqTemple&&this._qqLoadComplete?(this._fighter=t.ResData.qqTemple.buildArmature(2),this._fighter.scale(1.1,1.1),this._fighter.showSkinByName(t.Global.isBoy?"male":"female"),this._fighter.on(e.STOPPED,this,this.onFighterAnimationFinish),this._fighter.on(e.LABEL,this,this.onEvent),this._fighter.visible=!1,this.addChild(this._fighter),!0):(t.ResData.qqTemple||(t.ResData.qqTemple=new Laya.Templet,this._qqLoadComplete=!1,t.ResData.qqTemple.once(Laya.Event.COMPLETE,this,this.onQQLoad),t.ResData.qqTemple.on(Laya.Event.ERROR,this,this.onQQLoadError),t.ResData.qqTemple.loadAni(t.ResData.qqUrl)),!1)},n.prototype.onQQLoad=function(){this._qqLoadComplete=!0,t.AnimationSKe.inserTemplet(t.ResData.qqUrl,t.ResData.qqTemple),this._fighter=t.ResData.qqTemple.buildArmature(2),this._fighter.showSkinByName(t.Global.isBoy?"male":"female"),this._fighter.on(e.STOPPED,this,this.onFighterAnimationFinish),this._fighter.on(e.LABEL,this,this.onEvent),this._fighter.visible=!1,this.addChild(this._fighter),this._curFun(this._curId,this._curLevel)},n.prototype.onQQLoadError=function(){t.ResData.qqTemple.off(Laya.Event.COMPLETE,this,this.onQQLoad),t.ResData.qqTemple.off(Laya.Event.ERROR,this,this.onQQLoadError),t.ResData.qqTemple.destroy(),t.ResData.qqTemple=null},n.prototype.onFighterAnimationFinish=function(t){switch(this._curAct){case"act_cast_1":this._fighter.play(this._curAct="act_breath_0",!0);break;case"act_cast_2":this._fighter.play(this._curAct="act_breath_0",!0);break;default:this._fighter.play(this._curAct=this._standStr,!0)}},n.prototype.onEvent=function(e){switch(this._curHitType=e.name,e.name){case t.Fighter.EVENT_HIT:this._enemyFighter.play(this._curEnemyAct="act_injure_0",!1);break;case t.Fighter.EVENT_HIT_DEFAULT:Laya.timer.callLater(this,function(){this._enemyFighter.play(this._curEnemyAct="act_injure_0",!1,!0,150*(this._enemyFighter.player.cacheFrameRate/30)*1e3/this._enemyFighter.player.cacheFrameRate)})}},n.prototype.playSkill=function(e,s){if(this._curFun=this.playSkill,this._curId=e,this._curLevel=s,this._isSendEvent=!1,this.checkFighter()){var n=new t.SkillData(e,s);this._skillSkelton&&this._skillTemplet&&this._curSkill!=n.sourceUrl&&(Laya.timer.frameOnce(1,this,this.delayRealse,[this._skillSkelton,this._skillTemplet]),this._skillSkelton=null,this._skillTemplet=null),this._skillSkelton&&this._weaponTemplet&&(Laya.timer.frameOnce(1,this,this.delayRealse,[this._skillSkelton,this._weaponTemplet]),this._skillSkelton=null,this._weaponTemplet=null),this._skillSkelton?this.onSkillLoad(n):(this._skillTemplet&&(this._skillTemplet.off(Laya.Event.COMPLETE,this,this.onSkillLoad),this._skillTemplet.destroy(),this._skillTemplet=null),this._skillTemplet=new i,this._skillTemplet.once(Laya.Event.COMPLETE,this,this.onSkillLoad,[n]),this._skillTemplet.loadAni(n.sourceUrl),this._curSkill=n.sourceUrl)}},n.prototype.delayRealse=function(t,e){t.destroy(),e.destroy()},n.prototype.onSkillLoad=function(i){this._skillTemplet&&(this._skillSkelton||(this._skillSkelton=this._skillTemplet.buildArmature(0)),this._enemyFighter&&(this._enemyFighter.visible=!1),this.showEnemy(),this._skillSkelton.scale(1.1,1.1),this._skillSkelton.visible=!0,2==i.type||1==i.type?(this._fighter.visible=!1,this._skillSkelton.showSkinByName(t.Global.isBoy?"male":"female")):(this._fighter.visible=!0,i.isAssist?this._fighter.play(this._curAct="act_cast_2",!1):this._fighter.play(this._curAct="act_cast_1",!1)),i.action?this._skillSkelton.play(i.action,!1):this._skillSkelton.play(0,!1),this.addChild(this._skillSkelton),this._skillSkelton.on(Laya.Event.STOPPED,this,this.onSkillFinish),this._skillSkelton.on(e.LABEL,this,this.onSkillEvent))},n.prototype.playWeapon=function(e,s){if(this._curFun=this.playWeapon,this._curId=e,this._curLevel=s,this._isSendEvent=!1,this._enemyFighter&&(this._enemyFighter.visible=!1),this.checkFighter()){var n=new t.WeaponData(e,s);this._skillSkelton&&this._skillTemplet&&(Laya.timer.frameOnce(1,this,this.delayRealse,[this._skillSkelton,this._skillTemplet]),this._skillSkelton=null,this._skillTemplet=null),this._skillSkelton&&this._weaponTemplet&&n.skillUrl!=this._curWeaponUrl&&(Laya.timer.frameOnce(1,this,this.delayRealse,[this._skillSkelton,this._weaponTemplet]),this._skillSkelton=null,this._weaponTemplet=null),""==n.skillUrl?(this.showEnemy(),Laya.loader.load(n.sourceUrl,Handler.create(this,this.onComplete,[n]),null,Loader.IMAGE)):this._skillSkelton?this.onWeaponLoad(n):(this._weaponTemplet&&(this._weaponTemplet.off(Laya.Event.COMPLETE,this,this.onWeaponLoad),this._weaponTemplet.destroy(),this._weaponTemplet=null),this._weaponTemplet=new i,this._weaponTemplet.once(Laya.Event.COMPLETE,this,this.onWeaponLoad,[n]),this._weaponTemplet.loadAni(n.skillUrl),this._curWeaponUrl=n.skillUrl)}},n.prototype.onWeaponLoad=function(i){this._weaponTemplet&&(this._skillSkelton||(this._skillSkelton=this._weaponTemplet.buildArmature(2)),this.showEnemy(),this._skillSkelton.visible=!0,this._skillSkelton.scale(1.1,1.1),this._skillSkelton.showSkinByName(t.Global.isBoy?"male":"female"),this._fighter.visible=!1,this._skillSkelton.once(e.STOPPED,this,this.onSkillFinish),this._skillSkelton.on(e.LABEL,this,this.onSkillEvent),i.action?this._skillSkelton.play(i.action,!1):this._skillSkelton.play(0,!1),this.addChild(this._skillSkelton))},n.prototype.onSkillEvent=function(i){switch(this._curHitType=i.name,i.name){case t.Fighter.EVENT_HIT:this._skillSkelton&&this._skillSkelton.off(e.LABEL,this,this.onSkillEvent),this._enemyFighter&&this._enemyFighter.play(this._curEnemyAct="act_injure_0",!1);break;case t.Fighter.EVENT_HIT_START:this._enemyFighter&&this._enemyFighter.play(this._curEnemyAct="act_injure_0",!1);break;case t.Fighter.EVENT_HIT_END:this._skillSkelton&&this._skillSkelton.off(e.LABEL,this,this.onSkillEvent),Laya.timer.callLater(this,function(){this._enemyFighter&&this._enemyFighter.play(this._curEnemyAct="act_injure_0",!1,!0,150*(this._enemyFighter.player.cacheFrameRate/30)*1e3/this._enemyFighter.player.cacheFrameRate)})}},n.prototype.onSkillFinish=function(){this._skillSkelton&&(this._skillSkelton.visible=!1),this._fighter&&(this._fighter.visible=!0,this._fighter.play(this._curAct="act_breath_0",!0)),this.sendEvent()},n.prototype.onComplete=function(t){if(this._fighter){var e=Laya.Loader.getRes(t.sourceUrl);this._fighter.setSlotSkin("wuqi",e),this._fighter.visible=!0,this._standStr=n.standActionMap[t.type+"-"+t.attack],0==t["throw"]?(this._fighter.play(this._curAct="act_move_1",!0,!0),Laya.Tween.to(this._fighter,{x:620},500,null,Laya.Handler.create(this,this.playAttack,[t]))):Laya.timer.frameOnce(1,this,this.playAttack,[t])}},n.prototype.playAttack=function(t){if(this._fighter){var e;e=0==t["throw"]?n.attackActionMap[t.type+"-"+t.attack]:n.throwAttackActionMap[t.type+"-"+t["throw"]],this._fighter.play(this._curAct=e,!1,!0)}},n.prototype.showEnemy=function(){!this._enemyFighter&&t.ResData.qqTemple&&!t.ResData.qqTemple.isParseFail&&this._qqLoadComplete&&(this._enemyFighter=t.ResData.qqTemple.buildArmature(2),this._enemyFighter.showSkinByName(t.Global.isBoy?"male":"female"),this._enemyFighter.x=754,this._enemyFighter.scale(-1.1,1.1),this._enemyFighter.on(e.STOPPED,this,this.onEnemyAnimationFinish),this._enemyFighter.on(e.LABEL,this,this.onEnemyEvent),this.addChildAt(this._enemyFighter,0)),this._enemyFighter&&t.ResData.qqTemple&&this._qqLoadComplete&&!t.ResData.qqTemple.isParseFail&&(this._enemyFighter.visible=!0,this._enemyFighter.play(this._curEnemyAct="act_breath_0",!0))},n.prototype.onEnemyEvent=function(e){switch(e.name){case t.Fighter.EVENT_HIT_DEFAULT:t.Fighter.EVENT_HIT==this._curHitType&&Laya.timer.callLater(this,function(){this._enemyFighter.play(this._curEnemyAct="act_injure_0",!1,!0,150*(this._enemyFighter.player.cacheFrameRate/30)*1e3/this._enemyFighter.player.cacheFrameRate)})}},n.prototype.runBackEnd=function(){this.sendEvent()},n.prototype.onEnemyAnimationFinish=function(){switch(this._curEnemyAct){case"act_injure_0":this._enemyFighter.play("act_breath_0",!0),this._skillTemplet||(this._fighter.play(this._curAct="act_move_1",!0),0!=this._fighter.x?Laya.Tween.to(this._fighter,{x:0},100,null,Laya.Handler.create(this,this.runBackEnd)):this.runBackEnd())}},n.prototype.sendEvent=function(){this._isSendEvent||(this._isSendEvent=!0,Laya.timer.frameOnce(1,this,this.delayComplete))},n.prototype.delayComplete=function(){this.event(Laya.Event.COMPLETE)},n}(Laya.Sprite);t.ShowFighter=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.Event,i=function(i){function s(t,e,s,n){i.call(this,t,e,s,n)}return __extends(s,i),s.prototype.play=function(i){if(t.ResData.templetMap[i.sourceUrl])this.onSkillLoaded(t.ResData.templetMap[i.sourceUrl],i,!1);else{var s=new Laya.Templet;s.on(e.ERROR,this,this.onLoadedError,[s]),s.once(e.COMPLETE,this,this.onSkillLoaded,[s,i,!0]),s.loadAni(i.sourceUrl)}},s.prototype.onSkillLoaded=function(i,s,n){switch(void 0===n&&(n=!0),!t.ResData.skeletonMap[s.sourceUrl]||t.Global.isRetrench||t.ResData.skeletonMap[s.sourceUrl][0].parent?this.skill=i.buildArmature(2):this.skill=t.ResData.skeletonMap[s.sourceUrl][0],n&&(t.ResData.templetMap[s.sourceUrl]=i),t.ResData.skeletonMap[s.sourceUrl]||(t.ResData.skeletonMap[s.sourceUrl]=[]),-1==t.ResData.skeletonMap[s.sourceUrl].indexOf(this.skill)&&t.ResData.skeletonMap[s.sourceUrl].push(this.skill),s.withRole||Laya.timer.frameOnce(2,this,this.delayHideFighter),this.skill.once(e.STOPPED,this,this.onSkillFinish,[s.sourceUrl]),this.skill.on(e.LABEL,this,this.onEvent),this.skill.playbackRate(t.FightController.TIME_SCALE),s.action?this._fighter.scaleX<0&&s.reverse?this.skill.play(s.reverse,!1):this.skill.play(s.action,!1):this.skill.play(0,!1),i.skinDataArray.length>=3&&this.skill.showSkinByName(1==this._fighter.playerData.gender?"male":"female"),this.skill.scaleX=Math.abs(this._fighter.scaleX)*(this._fighter.sideType==t.FightStaticStr.LEFT_SIDE?1:-1),this.skill.scaleY=this._fighter.scaleY,this.skill.x=this._fighter.x,this.skill.y=this._fighter.y,s.type){case t.SkillData.TYPE_UP:case t.SkillData.TYPE_UP_WITHOUT_BODY:t.FightUIView.skillLayer.addChild(this.skill);break;case t.SkillData.TYPE_DOWN:t.FightUIView.bottomSkillLayer.addChildAt(this.skill,0);break;case t.SkillData.TYPE_X_SCALE:this.skill.scaleX=-1*this.skill.scaleX,t.FightUIView.skillLayer.addChild(this.skill)}s.sound&&t.dispatch(t.SoundModule.PLAY_SOUND,s.sound)},s.prototype.onLoadedError=function(i){if(i.destroy(),t.Logger.log("加载资源出错"),this._labelHandler){var s=new e;s.name=t.Fighter.EVENT_HIT,this._labelHandler.runWith(s)}Laya.timer.frameOnce(5,this,this.stopEvent)},s.prototype.stopEvent=function(){this._stopHandler&&(this._stopHandler.run(),this._stopHandler=null,this._labelHandler&&(this._labelHandler.recover(),this._labelHandler=null))},s.prototype.onSkillFinish=function(i){this._fighter.visible=!0,this.skill.off(e.STOPPED,this,this.onSkillFinish),this.skill.off(e.LABEL,this,this.onEvent),this.skill.parent&&this.skill.parent.removeChild(this.skill),this.skill=null,t.ResData.realeseSkeleton(i),this.stopEvent()},s.prototype.onEvent=function(t){this._labelHandler&&this._labelHandler.runWith(t)},s.prototype.delayHideFighter=function(){this._fighter.visible=!1},s}(t.BaseSkill);t.NormalSkill=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t,i,s,n){e.call(this,t,i,s,n)}return __extends(i,e),i.prototype.onSkillLoaded=function(i,s,n){void 0===n&&(n=!0),e.prototype.onSkillLoaded.call(this,i,s,n),t.FightUIView.bottomSkillLayer.addChild(this.skill)},i.prototype.onEvent=function(i){e.prototype.onEvent.call(this,i),t.FightUIView.skillLayer.addChild(this.skill)},i}(t.NormalSkill);t.FlyFairySkill=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t,i,s,n){e.call(this,t,i,s,n)}return __extends(i,e),i.prototype.onSkillLoaded=function(i,s,n){void 0===n&&(n=!0),e.prototype.onSkillLoaded.call(this,i,s,n),t.FightUIView.bottomSkillLayer.addChild(this.skill)},i.prototype.onEvent=function(e){switch(e.name){case"event_center_start":this._fighter.opposeFighter.x=667;break;case"event_center_end":this._fighter.opposeFighter.sideType==t.FightStaticStr.LEFT_SIDE?this._fighter.opposeFighter.x=t.FightData.leftFighterX:this._fighter.opposeFighter.x=t.FightData.rightFighterX;break;default:this._labelHandler&&this._labelHandler.runWith(e)}},i}(t.NormalSkill);t.LlhgWeaponSkill=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i,s,n){t.call(this,e,i,s,n)}return __extends(e,t),e.prototype.play=function(e){e.sourceUrl=e.sourceUrl.replace(".sk",this._fighter.playerData.monsterData.getMonsterShowType(e.id)+".sk"),t.prototype.play.call(this,e)},e}(t.NormalSkill);t.MonsterSkill=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t,i,s,n){e.call(this,t,i,s,n)}return __extends(i,e),i.prototype.onEvent=function(e){if(t.Fighter.EVENT_HIT==e.name&&this._data){if(90==this._data.afterAttackSkill&&this._data.afterAttackSkillParam&&this._data.afterAttackSkillParam[2]){var i=parseInt(this._data.afterAttackSkillParam[2]);this._fighter.playerData.curStateData.addHP(i),t.dispatch(t.FightStaticStr.ADD_HP,{addNum:i,type:this._fighter.sideType}),t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this._fighter,type:t.FloatWordController.ADD_FLOAT_WORD,num:i})}if(90==this._data.beAfterAttackSkill&&this._data.beAfterAttackSkillParam&&this._data.beAfterAttackSkillParam[2]){var i=parseInt(this._data.beAfterAttackSkillParam[2]);this._fighter.playerData.curStateData.addHP(i),t.dispatch(t.FightStaticStr.ADD_HP,{addNum:i,type:this._fighter.sideType}),t.dispatch(t.FightStaticStr.FLOAT_WORD,{target:this._fighter,type:t.FloatWordController.ADD_FLOAT_WORD,num:i})}}},i}(t.NormalSkill);t.QymmSkill=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i,s,n){t.call(this,e,i,s,n)}return __extends(e,t),e.prototype.onSkillLoaded=function(e,i,s){void 0===s&&(s=!0),t.prototype.onSkillLoaded.call(this,e,i,s),this._fighter.curActionData.beAttackerEffectObj[4]&&"3"==this._fighter.curActionData.beAttackerEffectObj[4][0][1]&&(i.action2?this.skill.play(i.action2,!1):this.skill.play(0,!1))},e}(t.NormalSkill);t.StrikeLuckySkill=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i,s,n){t.call(this,e,i,s,n)}return __extends(e,t),e.prototype.onSkillLoaded=function(e,i,s){if(void 0===s&&(s=!0),t.prototype.onSkillLoaded.call(this,e,i,s),this._fighter.curActionData.skillParam)for(var n,a,o=1,r=2;4>=r;r++)this._fighter.curActionData.skillParam[r]?(n=this._fighter.curActionData.attacker.playerData.getWeaponData(parseInt(this._fighter.curActionData.skillParam[r])),a=Laya.Loader.getRes(n.sourceUrl),this.skill.setSlotSkin("wuqi"+o,a)):this.skill.setSlotSkin("wuqi"+o,Laya.Loader.getRes("ui/comp/vscroll_empty.png")),o++},e}(t.NormalSkill);t.ToppleMountainsSeaSkill=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"FriendCommand":var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.GUIDE_MODEL);i.isGuiding?t.XHR().Post({cmd:"sns",op:"query",needreload:"1",type:2},this,this.onFriendDataResult,!0):(this._friendView||(this._friendView=new t.FriendView(t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL))),this.checkIsFirstEnter(),this._friendView.tabIndex=e.tabIndex,this._friendView.show());break;case"FriendTipsCommand":var s=new t.FriendTipsView;t.LayerMgr.addChild(s,t.Layer.BOX);break;case"FriendAddCommand":var n=new t.FriendAddView(e.targerId,e.targerName);n.show()}},s.prototype.checkIsFirstEnter=function(){var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL);if(e.level>=5){var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.GUIDE_MODEL);if(i.isGuiding){var s=this.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);0==s.hasEnterFriend&&(s.hasEnterFriend=1,i.guidetaskID=50001)}}},s.prototype.onFriendDataResult=function(e){0==e.result?(this._friendView||(this._friendView=new t.FriendView(t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL))),this._friendView.setGuideData(e),this.checkIsFirstEnter(),this._friendView.show()):t.WeakTips.show(e.msg)},s.prototype.getPluginName=function(){return e.PLUGIN_FRIEND},s.getTranscendFriendList=function(e,i,n){this._callBack=Handler.create(i,n),e>=10?t.XHR().Post({cmd:"sns",op:"query",access_token:"abcdefg",type:0},this,s.onFriendDataResult):(this._callBack.runWith({result:1,msg:"不是提示等级"}),this._callBack=null)},s.onFriendDataResult=function(e){0==e.result?(e.friendlist.sort(s.lisSortCompare),s.retrunResult(e.friendlist)):(t.WeakTips.show(e.msg),this._callBack.runWith({result:3,msg:"请求错误"}))},s.retrunResult=function(e){if(this._callBack){for(var i,s,n=[],a=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL).uid,o=-1,r=0,h=0;h<e.length&&(a==e[h].uid&&(i=e[h].level,o=h,s=e[h].power),-1!=o&&o!=h&&(e[h].level==i||e[h].level==i-1&&e[h].power>=s-110)&&(e[h].name=e[h].name,
n.push(e[h]),e[h].rank=h+1,r++),!(r>=2||e[h].level<i-1));h++);n.length>0?this._callBack.runWith({result:0,msg:"OK",list:n}):this._callBack.runWith({result:2,msg:"没有匹配的好友列表"})}},s.lisSortCompare=function(t,e){var i=t.level,s=e.level;if(i>s)return-1;if(s>i)return 1;var n=t.power,a=e.power;return n>a?-1:a>n?1:0},s.lisSortComparePower=function(t,e){var i=t.power,s=e.power;return i>s?1:s>i?-1:0},s.askMap={},s}(t.Plugin);t.FriendModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.friend.AddGroupFriendUI,!0,!0),this._display=this.skin,this.setCloseButton(this._display.boxClose);for(var t=0;3>t;t++)this._display["item"+t].visible=!1;this._display.flashBtn.visible=!1,this._maxreq=10,this._cacheIndex=0,this._cacheList=[]}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),t.removeListener("wx_getGroupUserGameData",this,this.update)},i.prototype.onShowed=function(){e.prototype.onShowed.call(this),t.addListener("wx_getGroupUserGameData",this,this.update),t.JSUtils.getGroupUserGameData()},i.prototype.onHided=function(){e.prototype.onHided.call(this)},i.prototype.update=function(t){0==t.result&&t.res&&t.res.data&&t.res.data.length>0&&(this._curShowIndex=0,this._srcList=t.res.data,this.showItem())},i.prototype.showItem=function(){if(this._curShowIndex<this._srcList.length){if(this._curShowIndex+this._maxreq<this._srcList.length-1){var e=this._srcList.slice(this._curShowIndex,this._curShowIndex+this._maxreq);this._curShowIndex+=this._maxreq}else{var e=this._srcList.slice(this._curShowIndex);this._curShowIndex=this._srcList.length}if(e){for(var i="",s=0;s<e.length;s++)i+=s<e.length-1?e.openId+"|":e.openId;""!=i&&t.XHR().Post({cmd:"sns",op:"group_fri",openids:i},this,this.onAddBackRet)}}else this.showCacheData()},i.prototype.onAddBackRet=function(e){0==e.result?e.friendlist&&e.friendlist.length>0?(this.showPlayer(e.friendlist),this._cacheList=this._cacheList.concat(e.friendlist)):this.showCacheData():t.WeakTips.show(e.msg)},i.prototype.showCacheData=function(){if(this._cacheList.length>0){if(this._cacheIndex+3<this._cacheList.length-1){var t=this._cacheList.slice(this._cacheIndex,this._cacheIndex+3);this._cacheIndex+=3}else{var t=this._cacheList.slice(this._cacheIndex);this._cacheIndex=0}this.showPlayer(t)}},i.prototype.showPlayer=function(t){for(var e=0;3>e;e++)t[e]?(this._display["item"+e].visible=!0,this._display["item"+e].update(t[e],e)):this._display["item"+e].visible=!1},i}(t.BaseBox);t.AddGroupFriend=e;var i=function(e){function i(){e.call(this),this._word=new t.ImageWord("assets/word/friend/"),this.addChild(this._word)}return __extends(i,e),i.prototype.update=function(e,i){this._curdata=e,this._word.showWord(""+(i+1)),this._word.x=30-this._word.imgWidth/2,this._word.y=60-this._word.imgHeight/2,this.tfLvl.text=""+e.level,this.nameTxt.text=""+e.name;var s=t.SelfInfo.getTitle(e.level);this.titleTxt.color=s.color,this.titleTxt.text=s.text,this.sexIcon.skin=1==e.sex?"ui/main/img_nan.png":"ui/main/img_nv.png",this.tfAtk.text=""+e.power,this.viplevel.text=""+e.vip_lvl,1==e.sex?this.defaultHead.skin="ui/main/male.png":this.defaultHead.skin="ui/main/female.png",this.photo.skin=t.JSUtils.getHeadUrl(e.headimgurl,e.sex),1==t.JSUtils.isFriend(e.uid)?(this.flashBtn.label="已为好友",this.flashBtn.gray=!0,this.flashBtn.off(Laya.Event.CLICK,this,this.onClickFlash)):(this.flashBtn.label="加为好友",this.flashBtn.gray=!1,this.flashBtn.on(Laya.Event.CLICK,this,this.onClickFlash))},i.prototype.onClickFlash=function(){t.XHR().Post({cmd:"sns",op:"add_in_fri",target_uid:this._curdata.uid},this,this.onAddBackRet)},i.prototype.onAddBackRet=function(e){0==e.result?(t.JSUtils.addOneFriend(this._curdata.uid),this.flashBtn.label="已为好友",this.flashBtn.gray=!0,this.flashBtn.off(Laya.Event.CLICK,this,this.onClickFlash)):t.WeakTips.show(e.msg)},i}(ui.friend.AddGroupFriendItemUI);t.AddGroupFriendItem=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i,s){e.call(this,new ui.friend.FriendAddUI,!0,!0),this._display=this.skin,this.setCloseButton(this._display.closeBtn),this._targetId=i,this._display.sendBtn.on(Laya.Event.CLICK,this,this.onclickAdd),this._p=new Laya.HTMLDivElement,this._p.style.fontSize=20,this._p.style.fontFamily="黑体",this._p.style.leading=5,this._p.style.bold=!0,this._p.style.width=this._display.content.width,this._display.addChildAt(this._p,2),this._p.x=this._display.content.x,this._p.y=this._display.content.y,this._display.content.text="",t.Global.isWX||t.Global.isWXAPP?this._p.innerHTML="<span>你希望成为 </span><span color='#ff0000'>"+s+"</span><span> 的微信好友，请在下方填写您的微信帐号，并点击发送按钮，即可给该玩家发送邮件推送消息。</span>":this._p.innerHTML="<span>你希望成为 </span><span color='#ff0000'>"+s+"</span><span> 的QQ好友，请在下方填写您的QQ帐号，并点击发送按钮，即可给该玩家发送邮件推送消息。</span>"}return __extends(i,e),i.prototype.destroy=function(){this._display.sendBtn.off(Laya.Event.CLICK,this,this.onclickAdd),e.prototype.destroy.call(this)},i.prototype.onclickAdd=function(){""!=this._display.inputTxt.text?t.XHR().Post({cmd:"sns",op:"add_friend",target_uid:this._targetId,wechat:this._display.inputTxt.text},this,this.onAddResult):t.WeakTips.show("请输入内容")},i.prototype.onAddResult=function(e){0==e.result?(t.WeakTips.show("邮件发送成功"),t.dispatch(t.FriendView.FRIEND_ADD_RET),this.hide()):t.WeakTips.show(e.msg)},i}(t.BaseBox);t.FriendAddView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),t.Global.isWX||t.Global.isWXAPP?(this.weixin.visible=!0,this.qq.visible=!1,this.tips.text="是否微信告诉TA？"):(this.weixin.visible=!1,this.qq.visible=!0,this.tips.text="是否QQ告诉TA？"),this.closeBtn.once(Laya.Event.CLICK,this,this.onClose),this.nextBtn.once(Laya.Event.CLICK,this,this.onClose),this.talkBtn.once(Laya.Event.CLICK,this,this.onClose)}return __extends(i,e),i.prototype.onClose=function(){this.parent.removeChild(this),this.destroy()},i}(ui.friend.FriendTipsUI);t.FriendTipsView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function n(s){e.call(this,new ui.friend.FriendUI,!0,!1),this._curPage=0,this._maxPage=0,this._tabNum=4,this._display=this.skin,this.setCloseButton(this._display.back.closeBtn),this._um=s,this.tabIndex=1,n.canSupportAddFriend=!1,window.mqq&&mqq.compare&&mqq.compare("7.1.5")>=0&&(n.canSupportAddFriend=!0),t.Global.isWXAPP&&(n.canSupportAddFriend=!0),this._display.back.derocation_left.skin="ui/comp/rope_xia.png",this._display.back.derocation_left.x=125,this._canListChange=!0,this.name="FriendViewBox",n.instance=this,this._display.list.itemRender=i,this._display.list.scrollBar.visible=!1,this._display.list.scrollBar.elasticDistance=100,this._display.list.renderHandler=new Handler(this,this.onListRender),this._display.list.array=[],this._display.list.scrollBar.changeHandler=new Handler(this,this.listChange),this._display.winpointIcon.skin=t.ResPath().getPic("kWinPoint",t.ResourcePath.PATH_GOODS),this._display.keyIcon.skin=t.ResPath().getPic("100105",t.ResourcePath.PATH_GOODS),this._display.moreTips.visible=!1,t.Global.isWX?this._display.tab.labels="微\n信\n好\n友,斗\n\n友,帮\n\n友,战\n斗\n记\n录":t.Global.isWXAPP?this._display.tab.labels="好\n\n友,斗\n\n友,帮\n\n友,战\n斗\n记\n录":this._display.tab.labels="Q\nQ\n好\n友,斗\n\n友,帮\n\n友,战\n斗\n记\n录",this._display.tab.selectHandler=new Handler(this,this.onSelectTab),this._display.leftBtn.on(Laya.Event.CLICK,this,this.onLeftBtn),this._display.rightBtn.on(Laya.Event.CLICK,this,this.onRightBtn),this._display.sendBtn.on(Laya.Event.CLICK,this,this.onSendBtn),this._display.winPointBtn.on(Laya.Event.CLICK,this,this.onwinPointBtn),this._display.getBtn.on(Laya.Event.CLICK,this,this.onGetBtn),this._display.flashBtn.on(Laya.Event.CLICK,this,this.onFlashBtn),this._display.addVit.on(Laya.Event.CLICK,this,this.onClickAddVit),this._display.checkB.clickHandler=new Handler(this,this.onClickCheckBox),this._display.checkAdd.clickHandler=new Handler(this,this.onClickCheckAdd),this._display.groupFriend.on(Laya.Event.CLICK,this,this.onGroupBtn),this._um.on(t.ModelEvent.UPDATE_FINISH,this,this.onUserModelUpdate)}return __extends(n,e),n.prototype.destroy=function(){this._display.list&&(this._display.list.scrollBar.changeHandler=null,this._display.list.destroy()),this._display.leftBtn.off(Laya.Event.CLICK,this,this.onLeftBtn),this._display.rightBtn.off(Laya.Event.CLICK,this,this.onRightBtn),this._display.sendBtn.off(Laya.Event.CLICK,this,this.onSendBtn),this._display.winPointBtn.off(Laya.Event.CLICK,this,this.onwinPointBtn),this._display.getBtn.off(Laya.Event.CLICK,this,this.onGetBtn),this._display.flashBtn.off(Laya.Event.CLICK,this,this.onFlashBtn),this._display.addVit.off(Laya.Event.CLICK,this,this.onClickAddVit),this._um.off(t.ModelEvent.UPDATE_FINISH,this,this.onUserModelUpdate),n.instance=null,e.prototype.destroy.call(this)},n.prototype.onShowed=function(){e.prototype.onShowed.call(this),t.addListener(n.FRIEND_UPDATE_VIEW,this,this.updateVit),t.addListener(n.FROEND_UPDATE_PANEL,this,this.onDataUpdate),this._enterFriend=!0,this._lastIndex=0;var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.GUIDE_MODEL);i.guidetaskID==t.GuideModel.TASKID_BEGIN?(this._preData&&(this.onFriendDataResult(this._preData),this._preData=null),this._display.tab.selectedIndex=1):this._display.tab.selectedIndex=this.tabIndex},n.prototype.onHided=function(){e.prototype.onHided.call(this),t.removeListener(n.FRIEND_UPDATE_VIEW,this,this.updateVit),t.removeListener(n.FROEND_UPDATE_PANEL,this,this.onDataUpdate),this._weiXinCache=null,this._douYouCache=null,this._bangPaiCacae=null,this._display.tab.selectedIndex=-1,t.dispatch(t.MainModule.OPENBOXEVENT)},n.prototype.onDataUpdate=function(e){var i=0,s=0;if(e.attrs)for(var n=0;n<e.attrs.length;n++)if("kWinPoint"==e.attrs[n].id){i=e.attrs[n].num;break}if(e.items)for(var n=0;n<e.items.length;n++)if(100105==e.items[n].id){s=e.items[n].num;break}this._curData&&(this._curData.getwinpoints+=i,this._curData.getkey+=s,s>0&&t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).loadAct(),this._display.winpointsTxt.text=this._curData.getwinpoints+"/"+this._curData.maxwinpoints,this._display.keyTxt.text=this._curData.getkey+"/"+this._curData.maxkey,this.updateTxtColor())},n.prototype.onClickAddMoney=function(){t.Facade.callCommand(new t.OpenVipBoxCommand(1)),t.Logger.log("")},n.prototype.onClickAddVit=function(){t.Facade.callCommand(new t.GetGoodsCommand(["100001","100002","100003"]))},n.prototype.onUserModelUpdate=function(){this._display.vitTxt.text=this._um.vit+"/"+this._um.maxVit},n.prototype.onSendBtn=function(){t.XHR().Post({cmd:"sns",op:"sendvit",target_uid:0},this,this.onSendResult)},n.prototype.onGetBtn=function(){t.XHR().Post({cmd:"sns",op:"getvit",target_uid:0},this,this.onSendResult)},n.prototype.onFlashBtn=function(){t.XHR().Post({cmd:"sns",op:"query",access_token:"abcdefg",type:2},this,this.onFriendDataResult)},n.prototype.onGroupBtn=function(){(new t.AddGroupFriend).show()},n.prototype.onwinPointBtn=function(){t.Facade.callCommand(new t.OpenWinShopCmd)},n.prototype.onSendResult=function(e){"0"==e.result?(t.WeakTips.show(e.msg),t.Facade.callCommand(new t.SyncChangeCmd(e,!1)),this.queryFriendCGI(0)):t.WeakTips.show(e.msg);var i=t.Facade.retrieveModel(t.ModelDef.GUIDE_MODEL);242==i.guidetaskID&&this.hide()},n.prototype.setGuideData=function(t){this._preData=t},n.prototype.onSelectTab=function(e){if(!(0>e)){this._display.moreTips.visible=!1,this._display.title.visible=!1,this._display.title4.visible=!1;for(var a=0;a<this._tabNum;a++)this._display["title"+a].visible=!1;switch(0==e?t.Global.isWX?this._display.title0.visible=!0:t.Global.isWXAPP?this._display.title4.visible=!0:this._display.title.visible=!0:this._display["title"+e].visible=!0,this._display.groupFriend.visible=!1,e){case 0:if(this._display.list.itemRender=i,this._display.list.renderHandler=new Handler(this,this.onListRender),this._display.list.array=[],this._weiXinCache&&!n.friendNeedFlush?this.showPage(this._weiXinCache,1):(n.friendNeedFlush=!1,this.queryFriendCGI(0)),this._display.pageSp.visible=!1,this._display.addSp.visible=!1,this._display.checkSp.visible=!0,this._display.sendBtn.visible=!0,this._display.winPointBtn.visible=!0,this._display.getBtn.visible=!0,this._display.flashBtn.visible=!1,this._display.getBox.visible=!0,t.LayerMgr.getLayer(t.Layer.GUIDE).numChildren>0){var o=t.Facade.retrieveModel(t.ModelDef.GUIDE_MODEL);o.guidetaskID=242,t.Logger.log(o.guidetaskID,"点好友页签时的taskID"),t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.FRIEND_TAB1))}break;case 1:this._display.list.itemRender=i,this._display.list.renderHandler=new Handler(this,this.onListRender),this._display.list.array=[],this._douYouCache?this.showPage(this._douYouCache,1):this.queryFriendCGI(2),this._display.pageSp.visible=!1,t.Global.isSQ&&n.canSupportAddFriend?this._display.addSp.visible=!0:this._display.addSp.visible=!1,this._display.checkSp.visible=!0,this._display.sendBtn.visible=!1,this._display.winPointBtn.visible=!1,this._display.getBtn.visible=!1,this._display.flashBtn.visible=!0,this._display.getBox.visible=!1;break;case 2:if(this._um.level<t.UserModel.NEED_USERLV_FACTION||0==this._um.faction.facID)return t.Facade.callCommand(new t.ShowChangeRewardCmd([t.UserModel.NEED_USERLV_FACTION+"级加入帮派后，即可挑战帮友"],200,"#ff0000")),void(2!=this._lastIndex&&(this._display.tab.selectedIndex=this._lastIndex));this._display.list.itemRender=i,this._display.list.renderHandler=new Handler(this,this.onListRender),this._bangPaiCacae?this.showPage(this._bangPaiCacae,1):this.queryFriendCGI(1),this._display.pageSp.visible=!1,this._display.addSp.visible=!1,this._display.checkSp.visible=!0,this._display.getBtn.visible=!1,this._display.sendBtn.visible=!1,this._display.flashBtn.visible=!1,this._display.getBox.visible=!0,this._display.winPointBtn.visible=!0;break;case 3:this._display.list.itemRender=s,this._display.list.renderHandler=new Handler(this,this.onListLogRender),this._display.list.array=[],this._display.pageSp.visible=!1,this._display.checkSp.visible=!1,this._display.sendBtn.visible=!1,this._display.winPointBtn.visible=!1,this._display.getBtn.visible=!1,this._display.flashBtn.visible=!1,this._display.getBox.visible=!1,t.XHR().Post({cmd:"sns",op:"viewfeeds"},this,this.onLogResult)}this._lastIndex=e}},n.prototype.queryFriendCGI=function(e){t.XHR().Post({cmd:"sns",op:"query",needreload:"1",type:e},this,this.onFriendDataResult,!0)},n.prototype.onLogResult=function(e){0==parseInt(e.result)?this.setListData(e.feedslist):t.WeakTips.show(e.msg)},n.prototype.onFriendDataResult=function(e){if(e.result+""=="0"){switch(e.type+""){case"0":this._weiXinCache=e.friendlist,e.friendlist.sort(t.FriendModule.lisSortCompare);break;case"1":this._bangPaiCacae=e.friendlist,e.friendlist.sort(t.FriendModule.lisSortCompare);break;case"2":this._douYouCache=e.friendlist,this._um.level>=2&&e.friendlist.sort(t.FriendModule.lisSortComparePower)}this.updatePanel(e)}else t.WeakTips.show(e.msg)},n.prototype.updatePanel=function(t){this._curData=t,this.showPage(t.friendlist,this.getPage()),this._display.checkB.selected="1"==t.can_skip,this._display.checkAdd.selected=0!=this._curData.allow_add_friend,this._display.wordTip.text="达人"+this._um.vipLevel+"今日已获得：",this._display.vitHaveGet.text=t.getvit+"/"+t.maxvit,this._display.winpointsTxt.text=t.getwinpoints+"/"+t.maxwinpoints,this._display.keyTxt.text=t.getkey+"/"+t.maxkey,this.updateTxtColor(),this.onUserModelUpdate()},n.prototype.updateTxtColor=function(){+this._curData.getvit>=+this._curData.maxvit?this._display.vitHaveGet.color="#ff4f26":this._display.vitHaveGet.color="#4dc901",+this._curData.getwinpoints>=+this._curData.maxwinpoints?this._display.winpointsTxt.color="#ff4f26":this._display.winpointsTxt.color="#4dc901",+this._curData.getkey>=+this._curData.maxkey?this._display.keyTxt.color="#ff4f26":this._display.keyTxt.color="#4dc901"},n.prototype.updateVit=function(){this._curData&&(this._curData.getvit+=5,this._display.vitHaveGet.text=this._curData.getvit+"/"+this._curData.maxvit,this.updateTxtColor())},n.prototype.getPage=function(){if(0==this._display.tab.selectedIndex&&this._enterFriend&&this._weiXinCache)for(var t=0;t<this._weiXinCache.length;t++)if(this._weiXinCache[t].uid==this._um.uid)return this._cacheIndex=t,Math.ceil((t+1)/n.PAGE_NUM);return 1},n.prototype.showPage=function(t,e){this._curArr=t,this._curPage=e,this._maxPage=Math.ceil(t.length/n.PAGE_NUM),this.setListData(t)},n.prototype.setListData=function(e){this._display.list.array=e;var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.GUIDE_MODEL);if(244==i.guidetaskID)this._display.list.scrollBar.value=1e3;else if(0==this._display.tab.selectedIndex&&this._enterFriend){this._enterFriend=!1;var s=this._cacheIndex%n.PAGE_NUM+1,a=(this._curPage-1)*n.PAGE_NUM*126;2>=s?this._display.list.scrollBar.value=a:12>=s?this._display.list.scrollBar.value=126*(s-2)+a:this._display.list.scrollBar.value=1386+a}else this._display.list.scrollBar.value=0},n.prototype.listChange=function(){if(this._canListChange){var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.GUIDE_MODEL);e.isGuiding&&(e.guidetaskID!=t.GuideModel.TASKID_BEGIN&&242!=e.guidetaskID||(this._canListChange=!1,this._display.list.scrollBar.value=0,this._canListChange=!0))}this._display.list.array&&this._display.list.array.length>=4&&this._display.list.scrollBar.value>this._display.list.scrollBar.max?this._display.moreTips.visible=!0:this._display.moreTips.visible=!1},n.prototype.onListRender=function(t,e){t.setData(this._display.list.getItem(e),this._display.tab.selectedIndex,e,this._curPage,this._um.uid,this._display.list.length)},n.prototype.onListLogRender=function(t,e){t.setData(this._display.list.getItem(e))},n.prototype.onLeftBtn=function(){this._curArr&&this._curPage>1&&(this._curPage--,this.showPage(this._curArr,this._curPage))},n.prototype.onRightBtn=function(){this._curArr&&this._curPage<this._maxPage&&(this._curPage++,this.showPage(this._curArr,this._curPage))},n.prototype.onClickCheckBox=function(){this._um.level>=5?(t.XHR().Post({cmd:"sns",op:"setskip"},this,this.onSetskip),t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.JUMP_FRIEND_FIGHT))):(t.Facade.callCommand(new t.ShowChangeRewardCmd(["达到5级才能跳过战斗"],200,"#ff0000")),this._display.checkB.selected=!1)},n.prototype.onSetskip=function(e){this._curData||(this._curData={}),"0"==e.result?(this._display.checkB.selected="1"==e.can_skip,this._curData.can_skip=e.can_skip):(this._display.checkB.selected="1"==this._curData.can_skip,t.WeakTips.show(e.msg))},n.prototype.onClickCheckAdd=function(){t.XHR().Post({cmd:"sns",op:"setaddfriend"},this,this.onSetAdd)},n.prototype.onSetAdd=function(e){0==e.result?(this._display.checkAdd.selected=0!=e.allow_add_friend,this._curData.allow_add_friend=e.allow_add_friend):(this._display.checkAdd.selected=0!=this._curData.allow_add_friend,t.WeakTips.show(e.msg))},n.PAGE_NUM=15,n.FRIEND_VIEW_AFTER_FIGHT="FRIEND_VIEW_AFTER_FIGHT",n.FRIEND_UPDATE_VIEW="FRIEND_UPDATE_VIEW",n.FRIEND_ADD_RET="FRIEND_ADD_RET",n.FROEND_UPDATE_PANEL="FROEND_UPDATE_PANEL",n.friendNeedFlush=!1,n}(t.BaseBox);t.FriendView=e;var i=function(i){function s(){i.call(this),this._word=new t.ImageWord("assets/word/friend/"),this.addChild(this._word),this.addIcon.on(Laya.Event.CLICK,this,this.onClicAdd),this.addBox.on(Laya.Event.CLICK,this,this.onClicAdd),this.back.on(Laya.Event.CLICK,this,this.onClickItem),this.fightIcon.on(Laya.Event.CLICK,this,this.onClicFight),this.replayIcon.on(Laya.Event.CLICK,this,this.onClicReplay),this.vitIcon.on(Laya.Event.CLICK,this,this.onClicVit),this.getVitIcon.on(Laya.Event.CLICK,this,this.onClicGetVit),this.askForBtn.on(Laya.Event.CLICK,this,this.onClickAskFor)}return __extends(s,i),s.prototype.destroy=function(){t.removeListener(t.FightStaticStr.FIGHT_START,this,this.onFightStart),t.removeListener(e.FRIEND_ADD_RET,this,this.onAddBack),this.replayIcon.off(Laya.Event.CLICK,this,this.onClicReplay),this.fightIcon.off(Laya.Event.CLICK,this,this.onClicFight),this.vitIcon.off(Laya.Event.CLICK,this,this.onClicVit),this.getVitIcon.off(Laya.Event.CLICK,this,this.onClicGetVit),this.addIcon.off(Laya.Event.CLICK,this,this.onClicAdd),this.back.off(Laya.Event.CLICK,this,this.onClickItem),i.prototype.destroy.call(this)},s.prototype.setData=function(i,n,a,o,r,h){if(t.removeListener(e.FRIEND_ADD_RET,this,this.onAddBack),this.fightIcon.on(Laya.Event.CLICK,this,this.onClicFight),this.replayIcon.on(Laya.Event.CLICK,this,this.onClicReplay),this.addIcon.on(Laya.Event.CLICK,this,this.onClicAdd),this.vitGuide.visible=!1,i){this._curData=i,this._curIndex=n,this._uid=r,this.fightTxt.text="战斗力："+i.power,2==this._curIndex?this.nameTxt.text="("+s.positionMap[i.facpos]+")"+i.name:this.nameTxt.text=i.name;var l=t.SelfInfo.getTitle(i.level);this.titleTxt.color=l.color,this.titleTxt.text=l.text,this.playerInfo.tfLvl.text=i.level,this.playerInfo.maleIcon.visible=i.sex+""=="1",this.playerInfo.femaleIcon.visible=i.sex+""=="2",this.playerInfo.tfVip.text=i.hasOwnProperty("vip_lvl")?String(i.vip_lvl):"0",1==i.sex?this.playerInfo.defaultHead.skin="ui/main/male.png":this.playerInfo.defaultHead.skin="ui/main/female.png",i.headimgurl&&""!=i.headimgurl?(this.playerInfo.photo.graphics.clear(),this.playerInfo.photo.loadImage(t.JSUtils.getHeadUrl(i.headimgurl),0,0,80,80),this.playerInfo.photo.visible=!0):this.playerInfo.photo.visible=!1;var c=a+1;switch(this._curIndex){case 0:1==c?this._word.showWord("a"):2==c?this._word.showWord("b"):3==c?this._word.showWord("c"):this._word.showWord(""+c),this.addIcon.visible=!1,this.addBox.visible=!1,this.getVitIcon.visible=!0,this.vitIcon.visible=!1,this.askForBtn.visible=!1,this.showBtn.visible=!1,this._queryType=0;break;case 1:this._word.showWord(""+c),this.addIcon.visible=!1,t.Global.isSQ&&e.canSupportAddFriend?this.addBox.visible=!0:t.Global.isWXAPP?this.addBox.visible=!0:this.addBox.visible=!1,this.getVitIcon.visible=!1,this.vitIcon.visible=!1,this.askForBtn.visible=!1,this.showBtn.visible=!1,this._queryType=2;break;case 2:1==c?this._word.showWord("a"):2==c?this._word.showWord("b"):3==c?this._word.showWord("c"):this._word.showWord(""+c),i.uid+""==r+""||0!=i.is_friend||t.Global.isWX?this.addBox.visible=!1:t.Global.isSQ||t.Global.isWXAPP?this.addBox.visible=!0:this.addBox.visible=!1,this.addIcon.visible=!1,this.getVitIcon.visible=!1,this.vitIcon.visible=!1,this.askForBtn.visible=!1,this.showBtn.visible=!1,this._queryType=1}if(this._word.x=48-this._word.imgWidth/2,this._word.y=60-this._word.imgHeight/2,i.can_fight>0?(this.fightIcon.filters=[],this.fightIcon.visible=!0):this.fightIcon.visible=!1,i.repid?this.replayIcon.visible=!0:(this.replayIcon.visible=!1,this.fightIcon.visible||(this.fightIcon.filters=t.FiltersUtils.getGreyFilters(),this.fightIcon.visible=!0,this.fightIcon.off(Laya.Event.CLICK,this,this.onClicFight))),this._curData.show&&0==this._curIndex?(this.showBtn.visible=!0,this.showBtn.on(Laya.Event.CLICK,this,this.onClickShow),this.replayIcon.visible=!1,this.fightIcon.visible=!1):this.showBtn.visible=!1,i.can_sendvit>0&&i.uid+""!=r+""?this.vitIcon.filters=[]:this.vitIcon.filters=t.FiltersUtils.getGreyFilters(),i.can_getvit>0?(this.getVitIcon.visible=!0,this.getVitIcon.filters=[]):(this.getVitIcon.filters=t.FiltersUtils.getGreyFilters(),0==i.getvit_status&&i.uid+""!=r+""?(this.getVitIcon.visible=!1,this.askForBtn.visible=!0,this.checkCanAskFor()?(this.askForBtn.on(Laya.Event.CLICK,this,this.onClickAskFor),this.askForBtn.filters=null):(this.askForBtn.off(Laya.Event.CLICK,this,this.onClickAskFor),this.askForBtn.filters=t.FiltersUtils.getGreyFilters())):(0==this._curIndex&&(this.getVitIcon.visible=!0),this.askForBtn.visible=!1)),i.can_add_friend&&i.allow_add_friend||t.Global.isWXAPP&&0!=this._curIndex&&1!=t.JSUtils.isFriend(i.uid)?(this.addBox.filters=null,this.addWordAdd.visible=!0,this.addWordSend.visible=!1,this.addBox.on(Laya.Event.CLICK,this,this.onClicAdd)):(this.addBox.filters=t.FiltersUtils.getGreyFilters(),this.addBox.off(Laya.Event.CLICK,this,this.onClicAdd),0==i.can_add_friend&&i.allow_add_friend?(this.addWordAdd.visible=!1,this.addWordSend.visible=!0):(this.addWordAdd.visible=!0,this.addWordSend.visible=!1)),t.Global.isWXAPP&&0==this._curIndex&&i.uid+""==r+""){this.addBox.visible=!0,this.getVitIcon.visible=!1,this.addBox.filters=null,this.addWordAdd.visible=!0,this.addWordSend.visible=!1,this.addBox.on(Laya.Event.CLICK,this,this.onClicAdd);var d=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL);50>h&&d.level<20&&(this.ani1.play(),this.vitGuide.visible=!0)}else this.ani1.stop(),this.vitGuide.visible=!1}},s.prototype.checkCanAskFor=function(){return t.FriendModule.askMap[this._curData.uid]=="askfor"+t.DateUtils.formate((new Date).getTime()/1e3,1)?!1:t.JSUtils.getCookie(this._curData.uid)!="askfor"+t.DateUtils.formate((new Date).getTime()/1e3,1)},s.prototype.onClicReplay=function(){if(this._curData.repid)if(this._curData.repaly){var e=new t.FightCommand(this._curData.repaly,null,!0);t.Facade.callCommand(e)}else t.Facade.callCommand(new t.FightReplayCommand(this._curData.repid))},s.prototype.onClicFight=function(){this._curData.can_fight?t.XHR().Post({cmd:"sns",op:"fight",target_uid:this._curData.uid,type:this._queryType},this,this.onFight):t.WeakTips.show("无法挑战："+this._curData.can_fight)},s.prototype.onClicVit=function(){this._curData.can_sendvit&&t.XHR().Post({cmd:"sns",op:"sendvit",target_uid:this._curData.uid},this,this.onSendResult)},s.prototype.onClicGetVit=function(){this._curData.can_getvit&&t.XHR().Post({cmd:"sns",op:"getvit",target_uid:this._curData.uid},this,this.onGetResult)},s.prototype.onClickAskFor=function(){t.ShareModule.shareMessage({title:["滴水之恩涌泉相报"],desc:["本鹅体力不足咯~ 求助亲来帮忙送点体力呀！感谢您啦~"],share_type:0,toUin:this._curData.uin,uid:this._curData.uid,image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(5)),back:!0},Handler.create(this,this.shareCallBack),4)},s.prototype.onSureToSend=function(){t.XHR().Post({cmd:"share",op:"vit",touser:this._curData.uid,title:t.ShareModule.getRandomStr(["求求你求求你","可以帮帮我么","本鹅需要你的帮助"]),desc:"本鹅体力不足咯~ 求助亲来帮忙送点体力呀！感谢您啦~"},this,this.onAskResult,!0)},s.prototype.onAskResult=function(e){0==e.result?(this.askForBtn.filters=t.FiltersUtils.getGreyFilters(),this.askForBtn.off(Laya.Event.CLICK,this,this.onClickAskFor),t.FriendModule.askMap[this._curData.uid]="askfor"+t.DateUtils.formate((new Date).getTime()/1e3,1),t.JSUtils.setCookie(this._curData.uid,"askfor"+t.DateUtils.formate((new Date).getTime()/1e3,1)),t.WeakTips.show("您的索取消息已发送成功啦！")):t.WeakTips.show(e.msg)},s.prototype.shareCallBack=function(e){0==e.retCode&&(this.askForBtn.filters=t.FiltersUtils.getGreyFilters(),this.askForBtn.off(Laya.Event.CLICK,this,this.onClickAskFor),t.FriendModule.askMap[this._curData.uid]="askfor"+t.DateUtils.formate((new Date).getTime()/1e3,1),t.JSUtils.setCookie(this._curData.uid,"askfor"+t.DateUtils.formate((new Date).getTime()/1e3,1)),t.WeakTips.show("您的索取消息已发送成功啦！"))},s.prototype.onClicAdd=function(){t.Global.isWXAPP?this._curData.uid==t.Global.UID?t.ShareModule.shareMessage({title:[t.Global.GameName],desc:["游戏就要轻轻松松~企鹅会武功，斗斗狠轻松！","本鹅在此郑重的向你发起挑战，求虐求虐！你敢应战吗？","见过企鹅打架嘛？没见过还不来看看！"],share_type:0,image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(8)),back:!0},null,1):t.ConfirmBox.show(new t.ConfirmBoxData({contentStr:"确定要添加好友吗？",title:"提 示",isShowXBtn:!1,confirmStr:"确 定",callBackHandler:Handler.create(this,this.onSureToAdd)})):t.ConfirmBox.show(new t.ConfirmBoxData({contentStr:"确定要发送添加好友消息吗？",title:"提 示",isShowXBtn:!1,confirmStr:"发 送",callBackHandler:Handler.create(this,this.onSureToAdd)}))},s.prototype.onSureToAdd=function(){t.Global.isWXAPP?t.XHR().Post({cmd:"sns",op:"add_in_fri",target_uid:this._curData.uid},this,this.onAddBackRet):t.ShareModule.openIdMap[this._curData.uid]?(Browser.onIOS&&t.XHR().Post({cmd:"sns",op:"add_friend",target_uid:this._curData.uid},this,this.onAddBackRet),t.JSUtils.addFriend(t.ShareModule.openIdMap[this._curData.uid].openid,this._curData.name,t.Global.GameName,"1",this,this.onAddFriendCallback)):t.XHR().Post({cmd:"detail",op:"simple",puid:this._curData.uid},this,this.onQueryOpenId)},s.prototype.onAddFriendCallback=function(e){e&&0==e.code&&e.result&&(t.WeakTips.show("发送成功"),t.XHR().Post({cmd:"sns",op:"add_friend",target_uid:this._curData.uid},this,this.onAddBackRet))},s.prototype.onQueryOpenId=function(e){0==e.result?(t.ShareModule.openIdMap[e.uid]={openid:e.openid,uin:e.uin},this.onSureToAdd()):t.WeakTips.show(e.msg)},s.prototype.onAddBackRet=function(i){0==i.result?(t.Global.isWXAPP&&(t.JSUtils.addOneFriend(this._curData.uid),e.friendNeedFlush=!0),this._curData.can_add_friend=0,this.addBox.filters=t.FiltersUtils.getGreyFilters(),this.addBox.off(Laya.Event.CLICK,this,this.onClicAdd),this.addWordAdd.visible=!1,this.addWordSend.visible=!0):t.WeakTips.show(i.msg)},s.prototype.onAddBack=function(){this._curData.can_addfriend=0,this.addIcon.filters=t.FiltersUtils.getGreyFilters(),this.addIcon.off(Laya.Event.CLICK,this,this.onClicAdd),t.removeListener(e.FRIEND_ADD_RET,this,this.onAddBack)},s.prototype.onClickItem=function(){t.Facade.callCommand(new t.UserInfoCommand(this._curData.uid,0,this._curData))},s.prototype.onSendResult=function(e){"0"==e.result?(t.WeakTips.show("赠送体力成功"),this._curData.can_sendvit=0,this.vitIcon.filters=t.FiltersUtils.getGreyFilters()):t.WeakTips.show(e.msg)},s.prototype.onGetResult=function(i){"0"==i.result?(t.Facade.callCommand(new t.SyncChangeCmd(i,!1)),t.WeakTips.show(i.msg),this._curData.can_getvit=0,this.getVitIcon.filters=t.FiltersUtils.getGreyFilters(),t.dispatch(e.FRIEND_UPDATE_VIEW)):t.WeakTips.show(i.msg)},s.prototype.onFight=function(i){if(0==i.result){var s=1==Number(i.first_win);if(e.instance._display.checkB.selected)if(t.Facade.callCommand(new t.SyncChangeCmd(i,!1)),this.onFightStart(i),s){var n=i.replay?i:null;t.Facade.callCommand(new t.FightResultCommand({win:!0,award:n,battleType:0,isDayFirstWin:s}))}else t.WeakTips.show(decodeURIComponent(i.msg));else t.addListener(t.FightStaticStr.FIGHT_START,this,this.onFightStart,[i]),this._fightcmd&&(this._fightcmd.off(),this._fightcmd=null),this._fightcmd=new t.FightCommand(i,null,!1,s),this._fightcmd.on(this,this.fightCommandFinish),t.Facade.callCommand(this._fightcmd),t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.HIDE_FIGHT_GUIDE))}else t.WeakTips.show(i.msg),10021!=i.result&&-1==i.msg.indexOf("体力不足")||t.Facade.callCommand(new t.GetGoodsCommand(["100001","100002","100003"]))},s.prototype.fightCommandFinish=function(){this._fightcmd.off(),this._fightcmd.ecode==t.Command.ERR_LOAD_ERROR&&(t.WeakTips.show("战斗资源加载错误"),t.Facade.callCommand(new t.SyncChangeCmd(this._fightcmd.jsonObj,!1)),this.onFightStart(this._fightcmd.jsonObj))},s.prototype.onFightStart=function(i){t.removeListener(t.FightStaticStr.FIGHT_START,this,this.onFightStart),this._curData.can_fight=0,this._curData.repid=i.repid?i.repid:"1_11",this.fightIcon.visible=!1,this.fightIcon.off(Laya.Event.CLICK,this,this.onClicFight),0==this._curIndex&&-1!=i.msg.indexOf("战胜")&&this._curData.uid+""!=this._uid+""?(this.showBtn.visible=!0,this.replayIcon.visible=!1,this._curData.show=1,this.showBtn.on(Laya.Event.CLICK,this,this.onClickShow)):(this.showBtn.visible=!1,this.replayIcon.visible=!0,this.replayIcon.on(Laya.Event.CLICK,this,this.onClicReplay)),this._curData.repaly=i,0==this._curIndex&&i.award&&(i.award.showBtn=1,
i.award.uin=this._curData.uin?this._curData.uin:0,i.award.uid=this._curData.uid,t.dispatch(e.FROEND_UPDATE_PANEL,i.award)),2==this._curIndex&&i.award&&t.dispatch(e.FROEND_UPDATE_PANEL,i.award),i.repid&&!t.Global.isWX&&(i.repalyid=i.repid)},s.prototype.onClickShow=function(){t.Global.isWXAPP?t.ShareModule.shareMessage({title:["成王败寇","欧耶~","我打败你啦~"],desc:["本鹅轻轻松松就战胜了你，要不要打回来呀？","可以给自己先制定一个小目标，那就是战胜本鹅一次嘛！","本鹅似乎才发挥了50%的实力就战胜了你呐！"],toUin:this._curData.uin,uid:this._curData.uid,alertType:1,image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(7)),command:1002},Handler.create(this,this.showCallBack),2):t.ShareModule.shareMessage({title:["成王败寇","欧耶~","我打败你啦~"],desc:["本鹅轻轻松松就战胜了你，要不要打回来呀？","可以给自己先制定一个小目标，那就是战胜本鹅一次嘛！","本鹅似乎才发挥了50%的实力就战胜了你呐！"],toUin:this._curData.uin,uid:this._curData.uid,alertType:1,command:1002},Handler.create(this,this.showCallBack),2)},s.prototype.showCallBack=function(e){e&&0==e.retCode?(this.showBtn.visible=!1,this.replayIcon.visible=!0,this._curData.show=0,t.WeakTips.show("您的炫耀信息已经发送成功啦！")):t.WeakTips.show("炫耀失败")},s.positionMap={100:"帮众",200:"精英",300:"堂主",400:"长老",500:"副帮主",600:"帮主"},s}(ui.friend.FriendListItemUI),s=function(e){function i(){e.call(this),this._word=new t.ImageWord("assets/word/small_result/"),this.addChild(this._word)}return __extends(i,e),i.prototype.destroy=function(){this.replayIcon.off(Laya.Event.CLICK,this,this.onClicReplay),this.fightIcon.off(Laya.Event.CLICK,this,this.onClicFight),e.prototype.destroy.call(this)},i.prototype.setData=function(e){if(e){if(this._curData=e,this.timeTxt.text=e.time,this.contentTxt.text=e.content,this.reward.text="",e.award){var i=new t.DecodeDataCmd(e.award);t.Facade.callCommand(i),this.reward.text=this.getAwardStr(i.rewardStrArr)}e.fight_result&&(this._word.showWordUnit(e.fight_result+""),this._word.x=430-this._word.imgWidth/2,this._word.y=65-this._word.imgHeight/2),this.replayIcon.off(Laya.Event.CLICK,this,this.onClicReplay),this.fightIcon.off(Laya.Event.CLICK,this,this.onClicFight),parseInt(this._curData.can_fight)>0?(this.fightIcon.filters=[],this.fightIcon.on(Laya.Event.CLICK,this,this.onClicFight)):this.fightIcon.filters=t.FiltersUtils.getGreyFilters(),this._curData.repid?(this.replayIcon.filters=[],this.replayIcon.on(Laya.Event.CLICK,this,this.onClicReplay)):this.replayIcon.filters=t.FiltersUtils.getGreyFilters()}},i.prototype.onClicReplay=function(){if(this._repaly){var e=new t.FightCommand(this._repaly);t.Facade.callCommand(e)}else t.Facade.callCommand(new t.FightReplayCommand(this._curData.repid))},i.prototype.onClicFight=function(){t.XHR().Post({cmd:"sns",op:"fight",target_uid:this._curData.opp_uid},this,this.onFight)},i.prototype.onFight=function(e){if("0"==e.result){this.fightIcon.visible=!1,this.fightIcon.off(Laya.Event.CLICK,this,this.onClicFight),this.replayIcon.visible=!0,this.replayIcon.on(Laya.Event.CLICK,this,this.onClicReplay),e.repid&&!t.Global.isWX&&(e.repalyid=e.repid);var i=new t.FightCommand(e);t.Facade.callCommand(i)}else t.WeakTips.show(e.msg)},i.prototype.getAwardStr=function(t){var e="";if(t)for(var i=t.length,s=0;i>s;s++)e+=t[s].replace("获得道具:","")+"  ";return e},i}(ui.friend.FriendLogItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.initialize=function(t){},i.prototype.doCommand=function(t){switch(t.getCommandName()){case"OpenGemCmd":this.getGemInfo();break;case"GemOpCmd":this.operate(t);break;case"EquipGemCmd":this.equipGem(t);break;case"TakeOffGemCmd":this.takeOffGem(t);break;case"UpgradeGemCmd":this.upgradeGem(t)}},i.prototype.operate=function(t){switch(t.op){case t.SLOT_SELECTED:this.gemBox&&this.gemBox.showSpot(t.params[0]);break;case t.GEM_CLICK:this.gemBox&&this.gemBox.equip(t.pim);break;case t.TAKE_OFF:this.gemBox&&this.gemBox.takeOff(t)}},i.prototype.showGemBox=function(e){this.gemBox||(this.gemBox=new t.GemBox(this.retrieveModel(t.ModelDef.PACK_MODEL)),this.gemBox.on(t.ViewEvent.BOX_HIDE,this,this.onGemBoxHide)),this.gemBox.show(),this.gemBox.weapons=e,this.gemBox.updateBagGem()},i.prototype.onGemBoxHide=function(){this.gemBox.off(t.ViewEvent.BOX_HIDE,this,this.onGemBoxHide),this.gemBox=null,this.unregisterPlugin()},i.prototype.getGemInfo=function(){t.XHR().Post({file:"petpk",cmd:"gem",uid:t.Global.UID,op:"gemspage",value:1,d:t.Global.GEMS_CONF?0:2},this,function(e){0==e.result?(e.gems_conf&&(t.Global.GEMS_CONF=e.gems_conf,t.Global.GOODS_CONF=e.goods_conf),this.showGemBox(e.weapons)):t.WeakTips.show(e.msg)})},i.prototype.equipGem=function(e){t.XHR().Post({file:"petpk",cmd:"gem",uid:t.Global.UID,op:"equip",type:e.type,spot_id:e.spot_id,gem_level:e.gem_level,gem_id:e.gem_id,weapon_id:e.weapon_id},this,function(i){0==i.result?(t.Facade.callCommand(new t.SyncChangeCmd(i,!1)),this.gemBox&&this.gemBox.updateWeapon(i.weapons[0]),e.finish(),t.WeakTips.show(i.msg)):t.WeakTips.show(i.msg)})},i.prototype.takeOffGem=function(e){t.XHR().Post({file:"petpk",cmd:"gem",uid:t.Global.UID,op:"unload",type:e.type,spot_id:e.spot_id,weapon_id:e.weapon_id},this,function(i){0==i.result?(t.Facade.callCommand(new t.SyncChangeCmd(i,!1)),this.gemBox&&this.gemBox.updateWeapon(i.weapons[0]),e.finish(),t.WeakTips.show(i.msg)):t.WeakTips.show(i.msg)})},i.prototype.upgradeGem=function(e){t.XHR().Post({file:"petpk",cmd:"gem",uid:t.Global.UID,op:"upgrade",type:e.type,spot_id:e.spot_id,weapon_id:e.weapon_id},this,function(i){this.ugc=e,0==i.result?(t.Facade.callCommand(new t.SyncChangeCmd(i,!1)),this.gemBox&&this.gemBox.updateWeapon(i.weapons[0]),i.hasOwnProperty("rollmsg_id")&&t.Facade.callCommand(new t.RollRefreshCmd(i.rollmsg_id)),t.WeakTips.show(i.msg)):10017==i.result?this.gemBox&&this.gemBox.promptUpgrade():t.WeakTips.show(i.msg)})},i.prototype.getPluginName=function(){return t.PluginDef.PLUGIN_GEM},i}(t.Plugin);t.GemModule=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.utils.Ease,i=laya.utils.Tween,s=laya.utils.Dictionary,n=laya.ui.Image,a=function(a){function o(e){a.call(this,new ui.gem.GemUI,!0,!0,!0,!1),this.SHOP_ID=[0,100016,100017,100018,100019,100020,100021],this.TYPE_GEM=4,this.ATTACK_GEM_IDS=[1,3,5],this.DEFENCE_GEM_IDS=[2,4,6],this.tabIndex=0,this.m_ui=this.skin,this.name="GemBox",this.pm=e,this.pm.on(t.ModelEvent.UPDATE_FINISH,this,this.updateBagGem),this.cacheAs="none",this.m_ui["static"].cacheAs="bitmap",this.m_ui.menuTab.labels="远\n\n程,近\n\n程",this.m_ui.menuTab.selectHandler=new Handler(this,this.showTab),this.m_ui.weaponList.itemRender=t.WeaponListItem,this.m_ui.weaponList.selectEnable=!0,this.m_ui.weaponList.selectHandler=new Handler(this,this.onSelect),this.m_ui.weaponList.renderHandler=new Handler(this,this.onListRender),this.m_ui.weaponList.array=[],this.m_ui.weaponList.scrollBar.hide=!0,this._canListChange=!0,this.m_ui.gemList.itemRender=t.BagGemItem,this.m_ui.gemList.selectEnable=!0,this.m_ui.gemList.renderHandler=new Handler(this,this.onGemListRender),this.m_ui.gemList.array=[],this.m_ui.gemList.scrollBar.hide=!0,this.m_ui.gemList.scrollBar.changeHandler=new Handler(this,this.listChange),this.setCloseButton(this.m_ui.bg.closeBtn);var i;this.spotList=[];var n;for(i=0;4>i;i++)n=new t.SpotItem(this.m_ui["spotItem_"+i],i),this.spotList.push(n);this.type_0_tabData=[],this.type_1_tabData=[],this.m_bagGems=new s;var i;for(i=t.GemConst.GEM_MIN_TYPE;i<=t.GemConst.GEM_MAX_TYPE;i++)this.m_bagGems.set(i,[]);var o;for(i=t.GemConst.GEM_MIN_TYPE;i<=t.GemConst.GEM_MAX_TYPE;i++)o=t.Global.GEMS_CONF[String(i)],o&&(o.type=i,o.gem_type==t.GemConst.ATTACK?this.type_0_tabData.push(o):this.type_1_tabData.push(o));this.m_ui.btnRule.on(Laya.Event.CLICK,this,this.onOpenRule),this.m_ui.btnBuy.on(Laya.Event.CLICK,this,this.buyGood),this.m_ui.btnUpgrade.on(Laya.Event.CLICK,this,this.upgrade),this.m_ui.spiritBtn.on(Laya.Event.CLICK,this,this.onSpirit),this.m_ui.on(Laya.Event.CLICK,this,this.closeTips),this.m_ui.redDotUpgrade.visible=!1}return __extends(o,a),o.prototype.listChange=function(){this._canListChange&&t.LayerMgr.getLayer(t.Layer.GUIDE).numChildren>0&&(this._canListChange=!1,this.m_ui.gemList.scrollBar.value=0,this._canListChange=!0)},o.prototype.destroy=function(){a.prototype.destroy.call(this),this.spiritSk&&(this.spiritSk.destroy(),this.spiritSk=null),this.closeTips(),this.pm.off(t.ModelEvent.UPDATE_FINISH,this,this.updateBagGem),Laya.loader.clearRes("ui/gem/img_fengexian.png"),Laya.loader.clearRes("ui/gem/bg.jpg"),Laya.loader.clearRes("ui/gem/bg_2.png")},o.prototype.closeTips=function(e){void 0===e&&(e=null),e&&e.target==this.m_ui.spiritBtn||t.Tips.tipsClose()},Object.defineProperty(o.prototype,"weapons",{set:function(e){this.m_weapons=[[],[]];for(var i,s=0;s<e.length;s++)i=e[s],this.m_weapons[this.getTabIndexByWeaponType(i.mode)].push(i);for(s=0;s<this.m_weapons.length;s++)this.m_weapons[s].sort(function(t,e){return e.id-t.id});var n=0;for(s=0;s<this.m_weapons.length;s++)0==this.m_weapons[s].length?(t.Util.toGrayAndDisabled(this.m_ui.menuTab.getChildAt(s)),n==s&&n++):t.Util.enable(this.m_ui.menuTab.getChildAt(s));this.m_ui.menuTab.selectedIndex=n,this.firstShowWeapon()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"gems_total_level",{set:function(t){},enumerable:!0,configurable:!0}),o.prototype.firstShowWeapon=function(){this.tabIndex=this.m_ui.menuTab.selectedIndex,this.m_ui.weaponList.array=this.m_weapons[this.tabIndex],this.m_ui.weaponList.selectedIndex=0,this.showDetail(0)},o.prototype.getTabIndexByWeaponType=function(t){return 2==t?0:1},o.prototype.updateWeapon=function(t){for(var e=this.m_weapons[this.getTabIndexByWeaponType(t.mode)],i=0;i<e.length;i++)e[i].id==t.id&&(e[i]=t);this.calcultateWeaponRedDot(t),this.selectItem.setData(t,!0),this.showSpot(this.selectPlotIndex)},o.prototype.updateBagGem=function(){var t=this.pm.getItemsByGoodType(this.TYPE_GEM);this.bagGems=t},Object.defineProperty(o.prototype,"bagGems",{set:function(e){var i;for(i=t.GemConst.GEM_MIN_TYPE;i<=t.GemConst.GEM_MAX_TYPE;i++)this.m_bagGems.set(i,[]);var s,n;for(i=0;i<e.length;i++)s=e[i],n=t.Global.GOODS_CONF[s.id],n&&(s.gem_level=n.gem_level,s.gem_type=n.gem_id,this.m_bagGems.get(s.gem_type).push(s));for(i=t.GemConst.GEM_MIN_TYPE;i<=t.GemConst.GEM_MAX_TYPE;i++)this.m_bagGems.get(i).sort(function(t,e){return e.gem_level-t.gem_level});this.calculateRedDot(),this.showSpot(this.selectPlotIndex)},enumerable:!0,configurable:!0}),o.prototype.showTab=function(t){this.tabIndex=t,this.calculateRedDot(),this.m_ui.weaponList.array=this.m_weapons[t],this.m_ui.weaponList.selectedIndex=0,this.showDetail(0)},o.prototype.onSelect=function(t){this.showDetail(t)},o.prototype.showDetail=function(t){this.selectItem&&(this.selectItem.selected=!1),this.selectItem=this.m_ui.weaponList.selection,this.selectItem&&(this.selectItem.selected=!0),this.m_ui.tfDesc.text=this.m_ui.weaponList.selectedItem.desc,this.callLater(this.showSpot)},o.prototype.onSpirit=function(){var e,i={},s=this.m_ui.weaponList.selectedItem.gems_total_level;s>0?(i.name="【活力之魂】（生效中）",i.info="活力之魂可以根据魂珠总等级提供额外的生命上限。",i.desc="魂珠总等级："+s+"\n生命上限提升：角色等级×"+t.MathUtils.getDotNum(.2*s,1)):(i.name="【活力之魂】（未激活）",i.info="活力之魂可以根据魂珠总等级提供额外的生命上限。",i.desc="需要镶嵌攻、防魂珠各1枚才能激活效果。"),e=this.m_ui.spiritBtn.localToGlobal(new laya.maths.Point(40,-20)),t.Tips.show(i,e)},o.prototype.addSpiritMovie=function(){this.spiritSk||(this.spiritSk=new t.AnimationSKe(t.ResPath().getEffect("effect_hlzh"),0)),this.m_ui.flag.addChild(this.spiritSk),this.spiritSk.x=38,this.spiritSk.y=64,this.spiritSk.play(0,!0)},o.prototype.removeSpiritMovie=function(){this.spiritSk&&(this.spiritSk.stop(),this.spiritSk.removeSelf())},o.prototype.showSpot=function(e){void 0===e&&(e=0),this.selectPlotIndex=e;var i=this.m_weapons[this.tabIndex][this.m_ui.weaponList.selectedIndex].gems,s=this.m_ui.weaponList.selectedItem.fight_power,n=-1;264>s?n=264:1155>s?n=1155:2640>s&&(n=2640),this.m_ui.tfvalue1.text=-1==n?""+s:s+"/"+n,this.m_ui.tfTip.text=-1==n?"":"（战力达标后特效升级）";var a=this.m_ui.weaponList.selectedItem.gems_total_level;a>0?this.m_ui.tfExtra1.text="已激活":this.m_ui.tfExtra1.text="未激活";for(var o,r=0,h=0;h<i.length;h++)o=i[h],0==o.gem_type&&0!=o.gem_id&&(r=1|r),1==o.gem_type&&0!=o.gem_id&&(r=2|r);if(this.removeSpiritMovie(),0==r?this.m_ui.flag.skin="ui/gem/flag_0.png":1==r?this.m_ui.flag.skin="ui/gem/flag_1.png":2==r?this.m_ui.flag.skin="ui/gem/flag_2.png":(this.m_ui.flag.skin="",this.addSpiritMovie()),2==i.length)this.spotList[0].setData(i[0],0==e),this.spotList[2].setData(i[1],2==e),this.spotList[1].setData(null,!1),this.spotList[3].setData(null,!1),this.spot_gem=i[0==e?0:1],this.other_gem_type=-1;else{for(var l,h=0;h<i.length;h++)l=this.spotList[h],l.setData(i[h],e==h);this.spot_gem=i[e];var c;c=1>=e?1==e?0:1:2==e?3:2;var d=i[c];0==d.gem_id?this.other_gem_type=-1:this.other_gem_type=d.gem_id}this.spot_gem.canUpgrade&&this.spot_gem.gem_level<10?this.m_ui.redDotUpgrade.visible=!0:this.m_ui.redDotUpgrade.visible=!1,this.callLater(this.drawGemList),0!=this.spot_gem.gem_id&&this.spot_gem.gem_level<10?t.Util.enable(this.m_ui.btnUpgrade):t.Util.toGrayAndDisabled(this.m_ui.btnUpgrade)},o.prototype.drawGemList=function(){var t=0==this.spot_gem.gem_type?this.ATTACK_GEM_IDS:this.DEFENCE_GEM_IDS;t=t.concat(),0==this.m_ui.menuTab.selectedIndex&&(0==this.spot_gem.gem_type?t.splice(t.indexOf(5),1):t.splice(t.indexOf(2),1)),-1!=this.other_gem_type&&t.splice(t.indexOf(this.other_gem_type),1);var e,i=[];for(e=0;e<t.length;e++)i=i.concat(this.m_bagGems.get(t[e]));if(i.length>0){for(e=i.length;12>e;e++)i.push(null);this.m_ui.gemList.array=i,this.m_ui.gemBag.visible=!0,this.m_ui.gemBagNone.visible=!1}else this.m_ui.gemBag.visible=!1,this.m_ui.gemBagNone.visible=!0},o.prototype.calculateRedDot=function(){var t=this.m_weapons[this.tabIndex];if(t&&t.length>0)for(var e,i=0;i<t.length;i++)e=t[i],this.calcultateWeaponRedDot(e);this.m_ui.weaponList.refresh()},o.prototype.calcultateWeaponRedDot=function(e){var i,s,n=!1,a=!1,o=e.gems,r=this.ATTACK_GEM_IDS.concat(),h=this.DEFENCE_GEM_IDS.concat();for(0==this.m_ui.menuTab.selectedIndex&&(r.splice(r.indexOf(5),1),h.splice(h.indexOf(2),1)),s=0;s<o.length;s++)if(i=o[s],0!=i.gem_id){var l;i.gem_type==t.GemConst.ATTACK?(l=r.indexOf(i.gem_id),r.splice(l,1)):(l=h.indexOf(i.gem_id),h.splice(l,1))}e.defenceCanEquip=h,e.attackCanEquip=r;for(var s=0;s<o.length;s++)if(i=o[s],0==i.gem_id){for(var c=i.gem_type==t.GemConst.ATTACK?r:h,d=!1,u=0;u<c.length;u++){var p=this.m_bagGems.get(c[u]);p&&p.length>0&&null!=p[0]&&(d=!0)}d?(i.canEquip=!0,n=!0):i.canEquip=!1}else{var _=this.calculateGemNum(i.gem_id,i.gem_level),f=Math.pow(2,i.gem_level-1);_>=f?(i.canUpgrade=!0,a=!0):i.canUpgrade=!1}e.canUpgrade=a,e.canEquip=n},o.prototype.calculateGemNum=function(t,e){for(var i,s=0,n=this.m_bagGems.get(t),a=0;a<n.length;a++)i=n[a],i&&i.gem_level<=e&&(s+=Math.pow(2,i.gem_level-1)*i.num);return s},o.prototype.equip=function(e){var i=this.m_ui.weaponList.selectedItem,s=new t.EquipGemCmd;s.weapon_id=i.id,s.gem_id=e.gem_type,s.gem_level=e.gem_level,s.spot_id=this.spot_gem.spot_id,s.type=this.spot_gem.gem_type,s.icon_id=this.spot_gem.icon_id,s.on(this,this.onEquip),t.Facade.callCommand(s)},o.prototype.takeOff=function(e){var i=this.m_ui.weaponList.selectedItem,s=new t.TakeOffGemCmd;s.weapon_id=i.id,s.spot_id=this.spot_gem.spot_id,s.type=this.spot_gem.gem_type,s.pos=e.pos,s.icon_id=this.spot_gem.icon_id,s.on(this,this.onTakeOff),t.Facade.callCommand(s)},o.prototype.upgrade=function(){this.spot_gem.canUpgrade&&this.spot_gem.gem_level<10?this.requestUpgrade():this.promptUpgrade()},o.prototype.requestUpgrade=function(){var e=new t.UpgradeConfirmBox(new Handler(this,this.reallyUpgrade),this.checkUpgrade());e.show()},o.prototype.checkUpgrade=function(){for(var e,i="魂珠可升级到"+(this.spot_gem.gem_level+1)+"级"+t.Global.GEMS_CONF[String(this.spot_gem.gem_id)].gem_name,s=[],n=Math.pow(2,this.spot_gem.gem_level-1),a=this.m_bagGems.get(this.spot_gem.gem_id),o=0;o<a.length;o++)if(e=a[o],e&&e.gem_level<=this.spot_gem.gem_level){var r=Math.pow(2,e.gem_level-1)*e.num;if(!(n>r)){s.push(e.name+"*"+n/Math.pow(2,e.gem_level-1));break}s.push(e.name+"*"+e.num),n-=r}for(var h="",l=0,c=0;c<s.length;c++)c%2==0?(h+=s[c],l++):h+=","+s[c]+"<br>";var d="需要消耗";return[i,h,d,"确     定",l]},o.prototype.promptUpgrade=function(){var e=this.calculateGemNum(this.spot_gem.gem_id,this.spot_gem.gem_level),i=Math.pow(2,this.spot_gem.gem_level-1);if(i>e){var s=new t.UpgradeConfirmBox(new Handler(this,this.buyByType,[i-e]),["升级魂珠所需的材料不足","1级"+t.Global.GEMS_CONF[String(this.spot_gem.gem_id)].gem_name+" * "+(i-e),"需要购买","购     买"]);s.show()}else this.requestUpgrade()},o.prototype.reallyUpgrade=function(){var e=this.m_ui.weaponList.selectedItem,i=new t.UpgradeGemCmd;i.weapon_id=e.id,i.spot_id=this.spot_gem.spot_id,i.type=this.spot_gem.gem_type,i.gem_type=this.spot_gem.gem_id,t.Facade.callCommand(i)},o.prototype.buyByType=function(e){var i=new t.BuyCommand(this.SHOP_ID[this.spot_gem.gem_id],0,e);i.on(this,this.onBuyFinish),t.Facade.callCommand(i)},o.prototype.onBuyFinish=function(e){e.off();var i=this.calculateGemNum(this.spot_gem.gem_id,this.spot_gem.gem_level),s=Math.pow(2,this.spot_gem.gem_level-1);if(s>i){var n=new t.UpgradeConfirmBox(new Handler(this,this.buyByType,[s-i]),["升级魂珠所需的材料不足","1级"+t.Global.GEMS_CONF[String(this.spot_gem.gem_id)].gem_name+" * "+(s-i),"需要购买","购     买"]);n.show()}else this.reallyUpgrade()},o.prototype.gemNoneClick=function(){t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.GEM_CLICK)),this.buyGood()},o.prototype.buyGood=function(){t.Facade.callCommand(new t.ShopCommand)},o.prototype.onEquip=function(t){if(t.off(),0!=t.gem_id){var e=this.spotList[this.selectPlotIndex];this.playGemOffMovie(t.icon_id,e.getPoint())}},o.prototype.onTakeOff=function(t){t.off(),this.playGemOffMovie(t.icon_id,t.pos)},o.prototype.playGemOffMovie=function(s,a){var o=new n;o.x=a.x,o.y=a.y,o.width=81,o.height=81,o.skin=t.ResPath().getPic(s,t.ResourcePath.PATH_GOODS),this.m_ui.addChild(o),i.to(o,{y:this.m_ui.gemList.y+50,scaleX:.5,scaleY:.5},500,e.linearNone,Laya.Handler.create(this,this.takeOffMovieEnd,[o])),Laya.timer.once(300,this,this.erer,[o])},o.prototype.erer=function(t){t&&i.to(t,{alpha:.3},200,e.linearNone)},o.prototype.takeOffMovieEnd=function(t){t&&(t.removeSelf(),t.destroy())},o.prototype.onListRender=function(t,e){t.setData(this.m_ui.weaponList.getItem(e),this.m_ui.weaponList.selectedIndex==e)},o.prototype.onGemListRender=function(t,e){t.setData(this.m_ui.gemList.getItem(e))},o.prototype.onOpenRule=function(){var e="<img src='ui/comp/icon.png'></img>魂珠分为进攻魂珠和防守魂珠，两种魂珠需要镶嵌到对应的魂珠孔中。<br><img src='ui/comp/icon.png'></img>同一把武器上不能镶嵌两个属性类型相同的魂珠。<br><img src='ui/comp/icon.png'></img>被镶嵌的魂珠可以升级，升级时需消耗另1个同等级同类型魂珠。<br><img src='ui/comp/icon.png'></img>升级时会自动扣除所需的背包中同等级或低级的魂珠。<br><img src='ui/comp/icon.png'></img>已经镶嵌了其他魂珠的魂珠孔也可以进行镶嵌，镶嵌成功后会替换原魂珠。<br><img src='ui/comp/icon.png'></img>已经镶嵌的魂珠也可以被卸下。被替换或者被卸下的魂珠会完全保留，返回玩家的背包中。";t.RulePanel.showRule(e,"")},o}(t.BaseBox);t.GemBox=a}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.setData=function(e){Laya.timer.clear(this,this.showTips),this.pim=e,this.pim?(this.icon.skin=t.ResPath().getPic(this.pim.icon_id,t.ResourcePath.PATH_GOODS),this.tfNum.text=""+this.pim.num,this.on(Laya.Event.MOUSE_DOWN,this,this.mouseDown),this.on(Laya.Event.MOUSE_UP,this,this.mouseUp)):(this.icon.skin="",this.tfNum.text="",this.off(Laya.Event.MOUSE_DOWN,this,this.mouseDown),this.off(Laya.Event.MOUSE_UP,this,this.mouseUp))},i.prototype.mouseDown=function(){this.downTime=(new Date).getTime(),Laya.timer.once(530,this,this.showTips)},i.prototype.mouseUp=function(){var t=(new Date).getTime()-this.downTime;Laya.timer.clear(this,this.showTips),500>t&&this.onClick()},i.prototype.onClick=function(){if(this.pim){var e=new t.GemOpCmd;e.op=e.GEM_CLICK,e.pim=this.pim,t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.GEM_CLICK)),t.Facade.callCommand(e)}},i.prototype.showTips=function(){if(this.pim){for(var e=this.localToGlobal(new laya.maths.Point(this.width/2,this.height/2)),i="",s=this.pim.short_des.split(" "),n=0;n<s.length;n++)i+=s[n],n!=s.length-1&&(i+="\n");t.Tips.show({name:this.pim.name,info:i},e),t.LayerMgr.getStage().on(Laya.Event.CLICK,this,this.hideTips)}},i.prototype.hideTips=function(e){e.target!=this&&(t.LayerMgr.getStage().off(Laya.Event.CLICK,this,this.hideTips),t.Tips.tipsClose())},i.prototype.destroy=function(){Laya.timer.clear(this,this.showTips),this.pim=null,e.prototype.destroy.call(this)},i}(ui.gem.GemItemUI);t.BagGemItem=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.setData=function(e,i){if(this.data=e,this.data){this.icon.skin=t.ResPath().getPic(this.data.id,t.ResourcePath.PATH_WEAPON,this.data.level),this.tfName.text=this.data.weapon_name;for(var s,n=[],a=0;a<this.data.gems.length;a++)s=this.data.gems[a],n.push({icon:0==s.gem_id?"":"ui/gem/"+s.gem_id+"_"+Math.floor((s.gem_level+3)/4)+".png",tfLevel:{text:s.gem_level,visible:0!=s.gem_id},kuang_1:{visible:1!=s.gem_type},kuang_2:{visible:1==s.gem_type}});this.gemList.array=n,this.selected_bg.visible=i,this.redDot.visible=this.data.canUpgrade||this.data.canEquip,this.removeAllMovie(),this.data.fight_power>=264&&this.data.fight_power<1155?this.addLowMovie():this.data.fight_power>=1155&&this.data.fight_power<2640?this.addHighMovie():this.data.fight_power>=2640&&this.addMaxMovie()}},i.prototype.addLowMovie=function(){this._lowSk||(this._lowSk=new t.AnimationSKe(t.ResPath().getEffect("effect_gem"),1)),this.skLayerDow.addChild(this._lowSk),this._lowSk.x=35,this._lowSk.y=45,this._lowSk.play("effect_gem_low",!0)},i.prototype.addHighMovie=function(){this._lowSk||(this._lowSk=new t.AnimationSKe(t.ResPath().getEffect("effect_gem"),1)),this.skLayerDow.addChild(this._lowSk),this._lowSk.x=39,this._lowSk.y=45,this._lowSk.play("effect_gem_mid_x",!0),this._highSk||(this._highSk=new t.AnimationSKe(t.ResPath().getEffect("effect_gem"),1)),this.skLayerUp.addChild(this._highSk),this._highSk.x=35,this._highSk.y=45,this._highSk.play("effect_gem_mid_s",!0)},i.prototype.addMaxMovie=function(){this._lowSk||(this._lowSk=new t.AnimationSKe(t.ResPath().getEffect("effect_gem"),1)),this.skLayerDow.addChild(this._lowSk),this._lowSk.x=39,this._lowSk.y=45,this._lowSk.play("effect_gem_mid_x",!0),this._highSk||(this._highSk=new t.AnimationSKe(t.ResPath().getEffect("effect_gem"),1)),this.skLayerUp.addChild(this._highSk),this._highSk.x=30,this._highSk.y=45,this._highSk.play("effect_gem_high_s",!0)},i.prototype.removeAllMovie=function(){this._lowSk&&(this._lowSk.stop(),this._lowSk.removeSelf()),this._highSk&&(this._highSk.stop(),this._highSk.removeSelf())},i.prototype.checkRedDot=function(t){this.redDot.visible=t},Object.defineProperty(i.prototype,"selected",{set:function(t){this.selected_bg.visible=t},enumerable:!0,configurable:!0}),i.prototype.destroy=function(){this._lowSk&&(this._lowSk.destroy(),this._lowSk=null),this._highSk&&(this._highSk.destroy(),this._highSk=null),e.prototype.destroy.call(this)},i}(ui.gem.WeaponListItemUI);t.WeaponListItem=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i){t.call(this,new ui.gem.UpgradeConfirmUI,!0,!0),this.display=this.skin,this.name="UpgradeConfirmBox",this.handler=e,this.display.msg2.style.fontFamily="黑体",this.display.msg2.style.fontSize=22,this.display.msg2.style.lineHeight=28,this.display.msg2.style.color="#000000",this.display.msg2.style.stroke=2,this.display.msg2.style.strokeColor="#ffffff",this.display.msg2.style.align="center",this.display.msg2.style.valign="top",this.display.msg1.text=i[0],this.display.msg2.innerHTML=i[1],this.display.msg3.text=i[2],this.display.confirmBtn.label=i[3],this.display.closeBtn.on(Laya.Event.CLICK,this,this.close),this.display.cancelBtn.on(Laya.Event.CLICK,this,this.close),this.display.confirmBtn.on(Laya.Event.CLICK,this,this.onConfirm)}return __extends(e,t),e.prototype.onConfirm=function(){this.handler.run(),t.prototype.close.call(this)},e.TYPE_CLOSE=1,e.TYPE_CANCEL=2,e}(t.BaseBox);t.UpgradeConfirmBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.Event,i=laya.ui.Image,s=function(){function s(s){this.SCENE_DATA=[{id:10001,status:0,npc:[2001,2002],word:["10001_0","10001_1"]},{id:10002,status:0,npc:[2004,2005,2006],word:[]},{id:10003,status:0,npc:[],word:["10003_0"]},{id:10004,status:0,npc:[],word:["10004_0","10004_1"]},{id:10005,status:0,npc:[],word:[]},{id:10006,status:0,npc:[],word:[]},{id:20001,status:0,npc:[2004,2005,2006],word:[]},{id:30001,status:0,npc:[],word:["30001_0","30001_1"]},{id:30002,status:0,npc:[],word:["30002_0","30002_1"]},{id:30003,status:0,npc:[],word:["30003_0","30003_1"]},{id:30004,status:0,npc:[],word:["30004_0","30004_1"]},{id:30005,status:0,npc:[2007,2008,2009,2010,2011,2012,2013,2014],word:[]},{id:30006,status:0,npc:[],word:[]},{id:30007,status:0,npc:[],word:["30007_0","30007_1"]},{id:30009,status:0,npc:[],word:[]},{id:30010,status:0,npc:[2003],word:["30010_0","30010_1"]},{id:40001,status:0,npc:[],word:[]}],this._datas=[],this._curNpcIdx=-1,this._curWordIndex=-1,this._shareFlag=!1,this._display=s,this._display.btn_close.on(e.CLICK,this,this.btnClick),this._display.btn_npc.on(e.CLICK,this,this.btnClick),this._display.btn_word.on(e.CLICK,this,this.btnClick),this._display.btn_shareZone.on(e.CLICK,this,this.btnClick),this._display.btn_shareFriend.on(e.CLICK,this,this.btnClick),Laya.timer.loop(2e3,this,this.award),this._con=new Sprite,this._con.x=this._display.img_con.x+8,this._con.y=this._display.img_con.y+8,this._display.addChildAt(this._con,this._display.getChildIndex(this._display.img_con)+1),this._scene=new t.PageList,this._scene.setPageButtons(this._display.btn_left,this._display.btn_right),this._scene.repeatX=1,this._scene.repeatY=1,this._scene.itemRender=n,this._scene.renderHandler=new Handler(this,this.onScenerender),this._scene.array=[],this._scene.on(t.PageList.EVENT_PAGE_CHANG,this,this.onSceneChange),this._con.addChild(this._scene),this._shadow=new i,this._shadow.skin=t.ResPath().getPic("shadow",t.ResourcePath.PATH_HANDBOOK_SCENENPC),this._con.addChild(this._shadow),this._shadow.x=60,this._shadow.y=290,this._npc=new i,this._npc.on(e.LOADED,this,this.onNpcLoadLoad),this._con.addChild(this._npc),this._word=new i,this._word.on(e.LOADED,this,this.onWordLoadLoad),this._con.addChild(this._word),this._con.addChild(this._display.img_QRCode),this._display.img_QRCode.x=0,this._display.img_QRCode.y=0;for(var a=0;a<this.SCENE_DATA.length;a++){var o=this.SCENE_DATA[a].npc;o.length>=1&&o.unshift("");var r=this.SCENE_DATA[a].word;r.length>=1&&r.unshift("")}this._display.btn_shareZone.visible=!1}return s.prototype.show=function(){this._display&&(this._display.visible=!0)},s.prototype.hide=function(){this._display&&(this._display.visible=!1)},s.prototype.btnClick=function(e){switch(e.currentTarget){case this._display.btn_close:t.Facade.callCommand(new t.OpenHandbookBoxCommand(t.HandbookType.MAIN));break;case this._display.btn_npc:-1!=this._curNpcIdx&&(this._curNpcIdx++,this._curNpcIdx>=this._curData.npc.length&&(this._curNpcIdx=0),this.updateNPC());break;case this._display.btn_word:-1!=this._curWordIndex&&(this._curWordIndex++,this._curWordIndex>=this._curData.word.length&&(this._curWordIndex=0),this.updateWord());break;case this._display.btn_shareZone:this.share(1);break;case this._display.btn_shareFriend:this.share(0)}},s.prototype.onSceneChange=function(){this._curData=null,this._datas.length>0?(this._curData=this._datas[this._scene.startIndex],this._curData.status>=1?(this._curData.npc.length>0?this._curNpcIdx=0:this._curNpcIdx=-1,this._curData.word.length>0?this._curWordIndex=0:this._curWordIndex=-1):(this._curNpcIdx=-1,this._curWordIndex=-1)):(this._curNpcIdx=-1,this._curWordIndex=-1),this._curData&&this._curData.status>=1&&this._curData.npc.length>1?(this._display.btn_npc.mouseEnabled=!0,this._display.btn_npc.gray=!1):(this._display.btn_npc.mouseEnabled=!1,this._display.btn_npc.gray=!0),this._curData&&this._curData.status>=1&&this._curData.word.length>1?(this._display.btn_word.mouseEnabled=!0,this._display.btn_word.gray=!1):(this._display.btn_word.mouseEnabled=!1,this._display.btn_word.gray=!0),null==this._curData||0==this._curData.status||"0"==this._curData.status?(this._display.btn_shareZone.mouseEnabled=!1,this._display.btn_shareZone.gray=!0,this._display.btn_shareFriend.mouseEnabled=!1,this._display.btn_shareFriend.gray=!0):(this._display.btn_shareZone.mouseEnabled=!0,this._display.btn_shareZone.gray=!1,this._display.btn_shareFriend.mouseEnabled=!0,this._display.btn_shareFriend.gray=!1),this._curData.status>=1?this._display.tf_tips.visible=!1:(this._display.tf_tips.text="在此休闲场景上通过：点击、滑动或者摇动操作\n激活场景彩蛋即可完成本场景图鉴收集。",this._display.tf_tips.visible=!0),this._curData.status>=1&&!t.Global.isWXAPP?this._display.img_QRCode.visible=!0:this._display.img_QRCode.visible=!1,1==this._curData.status||2==this._curData.status?this._display.img_award.visible=!0:this._display.img_award.visible=!1,this.updateNPC(),this.updateWord()},s.prototype.onScenerender=function(t,e){t.setData(this._scene.getItem(e))},s.prototype.update=function(){var e=t.HandbookNet.singleton.queryData,i=e.lists[1].attrs;this._datas.length=0;for(var s=0;s<this.SCENE_DATA.length;s++){for(var n=this.SCENE_DATA[s],a=0;a<i.length;a++){var o=i[a];n.id==o.id&&(n.status=o.status,n.ext=o.ext)}this._datas.push(n)}this._datas.sort(function(t,e){return 1==t.status?-1:1==e.status?1:t.status>1&&!(e.status>1)?-1:!(t.status>1)&&e.status>1?1:t.id<e.id?-1:1}),this._scene.array=this._datas,this._scene.page=0,this.onSceneChange()},s.prototype.updateNPC=function(){-1==this._curNpcIdx||""==this._curData.npc[this._curNpcIdx]?(this._npc.skin="",this._npc.visible=!1,this._shadow.visible=!1):(this._npc.visible=!0,this._npc.skin=t.ResPath().getPic(this._curData.npc[this._curNpcIdx],t.ResourcePath.PATH_HANDBOOK_SCENENPC),this._shadow.visible=!0)},s.prototype.updateWord=function(){-1==this._curWordIndex||""==this._curData.word[this._curWordIndex]?(this._word.skin="",this._word.visible=!1):(this._word.visible=!0,this._word.skin=t.ResPath().getPic(this._curData.word[this._curWordIndex],t.ResourcePath.PATH_HANDBOOK_SCENEWORD))},s.prototype.onNpcLoadLoad=function(){var t=150,e=200;this._npc.x=-this._npc.width/2,this._npc.y=e-this._npc.height,this._npc.scaleX=-.8,this._npc.scaleY=.8,this._npc.x=t+this._npc.x*-.8,this._npc.y=e+.8*this._npc.y},s.prototype.onWordLoadLoad=function(){this._word.scaleX=.8,this._word.scaleY=.8,this._word.x=776-.8*this._word.width-20,this._word.y=20},s.prototype.share=function(e){this._shareFlag=!1;var i=this,s=this._scene.getCell(this._scene.startIndex);t.HandbookShareUtil.share(t.HandbookShareUtil.SHARE_CODE_CHANGJING,e,this._con,{title:["美图欣赏"],desc:["本鹅觉得这张图还挺美哒，发给你们瞅瞅。"],image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(s.skin),tips:"本鹅的图鉴里又增加了一张新的场景~赶紧发送给好友看看吧！"},function(t){0!=t&&0!=t.retCode||!i._curData||2!=i._curData.status||(i._shareFlag=!0);
})},s.prototype.award=function(){if(this._shareFlag){var e=this;t.HandbookNet.singleton.award(1,e._curData.id,function(t){e._curData.status=3,e._display.img_award.visible=!1}),this._shareFlag=!1}},s}();t.ChangjingHandbookView=s;var n=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.destroy=function(t){void 0===t&&(t=!0),this.destroyPic(),e.prototype.destroy.call(this,t)},i.prototype.destroyPic=function(){this.skin&&""!=this.skin&&-1==this.skin.indexOf(t.Global.MAIN_SCENE_BG_ID+"")&&(Laya.loader.clearRes(this.skin),this.skin="")},i.prototype.setData=function(e){this._curData=e,this.destroyPic(),this.skin=t.ResPath().getFightScene(e.id),this.width=776,this.height=406,0==this._curData.status||"0"==this._curData.status?this.gray=!0:this.gray=!1,1==e.status&&t.HandbookNet.singleton.unlock(1,e.id,function(t){e.red=!1,e.status=2})},i}(i)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.initialize=function(t){},i.prototype.doCommand=function(e){switch(e.getCommandName()){case"OpenHandbookBoxCommand":this._view||(this._view=new t.HandbookView,this._view.on(t.ViewEvent.BOX_HIDE,this,this.onClosePanel)),this._view.showWidthType(e.viewType),e.ecode=0,e.finish();break;case"CloseHandbookBoxCommand":this._view&&(this._view.hide(),this._view=null),e.ecode=0,e.finish();break;case"GetHandbookAwardStatusCommand":var i=this,s=e;if(t.HandbookNet.singleton.queryData){var n=t.HandbookNet.singleton.getStatus(s.type,i.lvFomart(s.type,s.id,s.lv));3==n?s.handler.runWith(1):s.handler.runWith(0)}else t.HandbookNet.singleton.query(function(e){var n=t.HandbookNet.singleton.getStatus(s.type,i.lvFomart(s.type,s.id,s.lv));3==n?s.handler.runWith(1):s.handler.runWith(0)})}},i.prototype.onClosePanel=function(){this._view&&(Laya.loader.clearRes("res/atlas/ui/handbook.json"),Laya.loader.clearRes("ui/handbook/img_card.png"),Laya.loader.clearRes("ui/handbook/img_dadi1.png"),Laya.loader.clearRes("ui/handbook/img_dadi2.png"),Laya.loader.clearRes("ui/handbook/img_gushihui.jpg"),Laya.loader.clearRes("ui/handbook/img_jineng_bg.jpg"),Laya.loader.clearRes("ui/handbook/img_kapai.jpg"),Laya.loader.clearRes("ui/handbook/img_kongbai.jpg"),Laya.loader.clearRes("ui/handbook/img_shouye.png"),Laya.loader.clearRes("ui/handbook/img_wuqiBg.png"))},i.prototype.lvFomart=function(e,i,s){var n=i+"";return e!=t.HandbookType.WUQI&&e!=t.HandbookType.JINENG||(s>=10?n+=s:n=n+"0"+s),n},i.prototype.getPluginName=function(){return t.PluginDef.PLUGIN_HANDBOOK},i}(t.Plugin);t.HandbookModule=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.handbook.HandBookUI,!0,!0,!1,!1),this._display=this.skin,this.init()}return __extends(i,e),i.prototype.showWidthType=function(e){void 0==e&&(e=t.HandbookType.MAIN);for(var i in this._views)this._views[i].hide();this._views[e].show(),this._currentView=this._views[e];var s=this;e==t.HandbookType.MAIN?t.HandbookNet.singleton.query(function(e){0==e.result?s.destroyed||(s._currentView.update&&s._currentView.update(),s.show()):t.WeakTips.show(e.msg)}):(s._currentView.update&&s._currentView.update(),this.show())},i.prototype.init=function(){this._views={},this._views[t.HandbookType.MAIN]=new t.LedouHandbookView(this._display.view_0),this._views[t.HandbookType.JIAOSE]=new t.JiaoseHandbookView(this._display.view_1),this._views[t.HandbookType.CHANGJING]=new t.ChangjingHandbookView(this._display.view_2),this._views[t.HandbookType.LILIANG]=new t.LiliangHandbookView(this._display.view_3),this._views[t.HandbookType.WUQI]=new t.WuQiHandbookView(this._display.view_4),this._views[t.HandbookType.JINENG]=new t.JinengHandbookView(this._display.view_5),t.Global.isWXAPP&&(this._views[t.HandbookType.MAIN]._display.btn_close.x-=t.Global.FLOAT_ICON_OFFSET/4,this._views[t.HandbookType.JIAOSE]._display.btn_close.x-=t.Global.FLOAT_ICON_OFFSET/4,this._views[t.HandbookType.CHANGJING]._display.btn_close.x-=t.Global.FLOAT_ICON_OFFSET/4,this._views[t.HandbookType.LILIANG]._display.btn_close.x-=t.Global.FLOAT_ICON_OFFSET/4,this._views[t.HandbookType.WUQI]._display.btn_close.x-=t.Global.FLOAT_ICON_OFFSET/4,this._views[t.HandbookType.JINENG]._display.btn_close.x-=t.Global.FLOAT_ICON_OFFSET/4)},i.TYPE_MAIN_VIEW=0,i.TYPE_JIAOSE_VIEW=1,i.TYPE_CHANGJING_VIEW=2,i.TYPE_LILIANG_VIEW=3,i.TYPE_WUQI_VIEW=4,i.TYPE_JINENG_VIEW=5,i}(t.BaseBox);t.HandbookView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.Event,i=function(i){function s(s){i.call(this,new ui.handbook.HandbookJiaoseCardUI,!0,!0,!1,!1),this._display=this.skin,this._data=s,this._display.btn_shareZone.on(e.CLICK,this,this.onBtnShare),this._display.btn_shareFriend.on(e.CLICK,this,this.onBtnShare),this.setCloseButton(this._display.btn_close),this._curImg=t.Global.ResPath+t.ResourcePath.PATH_HANDBOOK_NPC_CARD+s.looks+".jpg",this._display.tf_name.text=s.name,this._display.tf_time.text="收藏日期："+t.DateUtils.formate(s.time),this._display.img_card.skin=this._curImg,this._display.btn_shareZone.visible=!1,this._display.btn_shareFriend.x=618}return __extends(s,i),s.prototype.onBtnShare=function(e){var i=-1;e.currentTarget==this._display.btn_shareZone?i=1:e.currentTarget==this._display.btn_shareFriend&&(i=0),t.HandbookShareUtil.share(t.HandbookShareUtil.SHARE_CODE_JIAOSE,i,this._display.img_card,{title:["收集控看过来","图片记录点滴","获得新角色"],desc:["今天又收集到了一张新怪物图片，不错不错。","有日期记录的图册，确实可以让人怀念。","每一张图片都是一段回忆。"],image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(this._display.img_card.skin),tips:"本鹅的图鉴里又增加了一只怪物啦~赶紧发送给好友看看吧！"})},s.prototype.destroy=function(){this._display.btn_shareZone.off(e.CLICK,this,this.onBtnShare),this._display.btn_shareFriend.off(e.CLICK,this,this.onBtnShare),this._display=null,this._data=null,this._curImg=null,i.prototype.destroy.call(this)},s}(t.BaseBox);t.JiaoseCardView=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.Event,i=function(){function i(i){this._display=i,this._display.btn_close.on(e.CLICK,this,this.onBtnClick),this._list=new t.PageList,this._list.setPageButtons(this._display.btn_pre,this._display.btn_next),this._list.x=380,this._list.y=124,this._list.repeatX=3,this._list.repeatY=2,this._list.spaceX=45,this._list.spaceY=23,this._list.selectEnable=!0,this._list.itemRender=s,this._list.renderHandler=new Handler(this,this.onListRender),this._list.selectHandler=new Handler(this,this.onSelect),this._list.array=[],this._display.addChild(this._list)}return i.prototype.show=function(){this._display&&(this._display.visible=!0)},i.prototype.hide=function(){this._display&&(this._display.visible=!1)},i.prototype.onBtnClick=function(e){switch(e.currentTarget){case this._display.btn_close:t.Facade.callCommand(new t.OpenHandbookBoxCommand(t.HandbookType.MAIN))}},i.prototype.onListRender=function(t,e){t.setData(this._list.getItem(e))},i.prototype.onSelect=function(e){if(-1!=e){var i=this._list.getItem(e);this.showSubPanel(i);var i=this._list.getItem(e),s=this._list.getCell(e);1==i.status&&t.HandbookNet.singleton.unlock(0,i.id,function(t){s.destroyEffect(),i.red=!1,i.status=2}),this._list.selectedIndex=-1}},i.prototype.showSubPanel=function(e){if(e.status>=1){var i=new t.JiaoseCardView(e);i.show()}else t.WeakTips.show("在72变系统中激活对应角色的4个变身效果即可收集该角色图鉴啦！")},i.prototype.update=function(){var e=t.HandbookNet.singleton.queryData,i=e.lists[0].attrs;i.sort(function(t,e){return 1==t.status?-1:1==e.status?1:t.status>1&&!(e.status>1)?-1:!(t.status>1)&&e.status>1?1:t.id<e.id?-1:1}),this._list.array=i,this._list.page=0},i}();t.JiaoseHandbookView=i;var s=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.destroy=function(){this.destroyEffect(),e.prototype.destroy.call(this)},i.prototype.setData=function(e){this._curData=e,this.img_red.visible=!1,0==e.red?this.destroyEffect():1==e.red&&this.createEffect(),0==e.status||"0"==e.status?(this.box_ok.visible=!1,this.img_nerver.visible=!0,this.img_icon.gray=!0,this.img_bg.gray=!0):e.status>=1&&(this.box_ok.visible=!0,this.img_nerver.visible=!1,this.img_icon.gray=!1,this.img_bg.gray=!1,this.box_ok.getChildByName("tf_time").text=t.DateUtils.formate(e.time)),this.img_icon.skin=t.Global.ResPath+t.ResourcePath.PATH_HANDBOOK_NPC_HEAD+e.looks+".jpg"},Object.defineProperty(i.prototype,"selected",{set:function(t){},enumerable:!0,configurable:!0}),i.prototype.createEffect=function(){this._effect||(this._effect=new t.AnimationSKe(t.Global.ResPath+"effect/effect_jstj.sk"),this._effect.x=this.width/2,this._effect.y=this.height/2),this._effect.play(0,!0),this.addChild(this._effect)},i.prototype.destroyEffect=function(){this._effect&&(this.removeChild(this._effect),this._effect.stop(),this._effect.destroy(),this._effect=null)},i}(ui.handbook.JiaoseItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.Event,i=laya.ui.Image,s=function(){function i(i){this._datas=[],this._shareFlag=!1,this._display=i,this._display.btn_close.on(e.CLICK,this,this.btnClick),this._display.btn_shareZone.on(e.CLICK,this,this.btnClick),this._display.btn_shareFriend.on(e.CLICK,this,this.btnClick),Laya.timer.loop(2e3,this,this.award),this._con=this._display.img_con,this._pic=new t.PageList,this._pic.setPageButtons(this._display.btn_left,this._display.btn_right),this._pic.repeatX=1,this._pic.repeatY=1,this._pic.itemRender=n,this._pic.renderHandler=new Handler(this,this.onPicRender),this._pic.array=[],this._pic.on(t.PageList.EVENT_PAGE_CHANG,this,this.onPicChange),this._con.addChild(this._pic),this._display.btn_shareZone.visible=!1}return i.prototype.show=function(){this._display&&(this._display.visible=!0)},i.prototype.hide=function(){this._display&&(this._display.visible=!1)},i.prototype.update=function(){var e=t.HandbookNet.singleton.queryData,i=e.lists[4].attrs;this.sortData(i),this._pic.array=this._datas,this._pic.page=0,this._datas.length<=1?this._display.btn_left.visible=this._display.btn_right.visible=!1:this._display.btn_left.visible=this._display.btn_right.visible=!0,this.onPicChange()},i.prototype.sortData=function(t){this._datas.length=0;for(var e={},i=0;i<t.length;i++){var s=t[i],n=this.getIdById(s.id),a=this.getLvById(s.id);if(s._id=n,s._lv=a,s.status>=1){var o;e[n]?o=e[n]:(o=[],e[n]=o),o.push(s)}}for(var r in e)if(o=e[r],2==o.length)for(i=0;i<o.length;i++)this._datas.push(o[i]);for(t.sort(function(t,e){var i=0;if(t.status>=1&&!(e.status>=1))i=-1;else{if(!(t.status>=1)&&e.status>=1)return 1;i=t.id<e.id?-1:1}return i}),i=0;i<t.length;i++)s=t[i],-1==this._datas.indexOf(s)&&this._datas.push(s)},i.prototype.getLvById=function(t){var e=t+"",i=parseInt(e.substr(e.length-2,2));return i},i.prototype.getIdById=function(t){var e=t+"",t=parseInt(e.substr(0,e.length-2));return t},i.prototype.btnClick=function(e){switch(e.currentTarget){case this._display.btn_close:t.Facade.callCommand(new t.OpenHandbookBoxCommand(t.HandbookType.MAIN));break;case this._display.btn_shareZone:this.share(1);break;case this._display.btn_shareFriend:this.share(0)}},i.prototype.onPicRender=function(t,e){this._curData=this._pic.getItem(e),t.setData(this._curData)},i.prototype.onPicChange=function(){var e=this._datas[this._pic.startIndex];if(0==e.status||"0"==e.status){var i=this.getLvById(e.id);this._display.tf_tips.visible=!0,this._display.tf_tips.text="将%name%强化至%level%星可解锁\n%name2%".replace("%name%",e.pre_name).replace("%name2%",e.name).replace("%level%",i+""),this._display.tf_time.visible=!1,this._display.btn_shareZone.mouseEnabled=!1,this._display.btn_shareZone.gray=!0,this._display.btn_shareFriend.mouseEnabled=!1,this._display.btn_shareFriend.gray=!0}else this._display.tf_tips.visible=!1,this._display.tf_time.visible=!0,this._display.tf_time.text=t.DateUtils.formate(e.time),this._display.btn_shareZone.mouseEnabled=!0,this._display.btn_shareZone.gray=!1,this._display.btn_shareFriend.mouseEnabled=!0,this._display.btn_shareFriend.gray=!1;this._display.tf_name.text=e.name,1!=e.status&&2!=e.status||0==this.getLvById(e.id)?this._display.img_award.visible=!1:this._display.img_award.visible=!0},i.prototype.share=function(e){this._shareFlag=!1;var i=this,s=this._pic.getCell(this._pic.startIndex);t.HandbookNet.singleton.desc(function(n){var a=n.skill_config[0].desc,o=s.skin;t.Global.isWXAPP&&o.replace("wxapp","wxappshare"),t.HandbookShareUtil.share(t.HandbookShareUtil.SHARE_CODE_JINENG,e,i._con,{title:[i._curData.name],desc:[a],image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(o),tips:"新技能习得~不容易，赶紧发给朋友们看看吧！"},function(t){0!=t&&0!=t.retCode||!i._curData||2!=i._curData.status&&1!=i._curData.status||0==i._curData._lv||(i._shareFlag=!0)})},"skill",this._curData._id,this._curData._lv)},i.prototype.award=function(){if(this._shareFlag){var e=this;t.HandbookNet.singleton.award(5,e._curData.id,function(t){e._curData.status=3,e._display.img_award.visible=!1}),this._shareFlag=!1}},i}();t.JinengHandbookView=s;var n=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this.destroyPic()},i.prototype.destroyPic=function(){this.skin&&""!=this.skin&&(Laya.loader.clearRes(this.skin),this.skin="")},i.prototype.setData=function(e){this._curData=e,this.destroyPic(),this.skin=t.ResourcePath.singleton.getShareBg("s_"+this.getIdById2(e.id)+"_"+this.getLvById(e.id)),this.width=748,this.height=420,e.status>=1?this.gray=!1:this.gray=!0,1==e.status&&t.HandbookNet.singleton.unlock(5,e.id,function(t){e.red=!1,e.status=2})},i.prototype.getIdById2=function(t){var e=t+"",t=parseInt(e.substr(0,e.length-2));return t-=3e5},i.prototype.getLvById=function(t){var e=t+"",i=parseInt(e.substr(e.length-2,2));return i},i}(i)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.Event,i=function(){function i(i){this._display=i,this._display.btn_js.on(e.CLICK,this,this.btnClick),this._display.btn_close.on(e.CLICK,this,this.btnClick),this._list=new t.PageList,this._list.setPageButtons(this._display.btn_pre,this._display.btn_next),this._list.x=355,this._list.y=120,this._list.repeatX=3,this._list.repeatY=1,this._list.spaceX=10,this._list.selectEnable=!0,this._list.itemRender=s,this._list.renderHandler=new Handler(this,this.onListRender),this._list.selectHandler=new Handler(this,this.onSelect),this._list.array=[],this._display.addChild(this._list)}return i.prototype.update=function(){for(var e=[],i=t.HandbookNet.singleton.queryData,s=0;s<i.lists.length;s++){var n={};n.type=parseInt(i.lists[s].type),n.red=i.lists[s].red,n.total=i.lists[s].total,n.count=i.lists[s].count,e.push(n)}e.sort(function(t,e){return 1==t.red&&0==e.red?-1:0==t.red&&1==e.red?1:t.type<e.type?-1:1}),this._list.array=e},i.prototype.show=function(){this._display&&(this._display.visible=!0)},i.prototype.hide=function(){this._display&&(this._display.visible=!1)},i.prototype.onListRender=function(t,e){t.setData(this._list.getItem(e))},i.prototype.onSelect=function(e){if(-1!=e){var i=this._list.getItem(e);t.Facade.callCommand(new t.OpenHandbookBoxCommand(i.type)),this._list.selectedIndex=-1}},i.prototype.btnClick=function(e){switch(e.currentTarget){case this._display.btn_close:t.Facade.callCommand(new t.CloseHandbookBoxCommand);break;case this._display.btn_js:this.showRule()}},i.prototype.showRule=function(){var e="",i="<br /> <br /><p>乐斗图鉴，用图片记录您的点点滴滴</p>";i+="<br /><p>1.乐斗图鉴共分为角色图鉴、场景图鉴、历练故事汇、武器图鉴和武林秘籍五个部分组成。</p>",i+="<br /><p>2.角色图鉴可以通过完成72变的变身解锁激活，每完成同一个角色的4个不同变身形象后即可解锁对应图鉴的形象，同时您将可以看到解锁该图鉴的日期，为您留下点滴回忆。</p>",i+="<br /><p>3.场景图鉴可以通过在不同的休闲场景中进行点击、滑动、摇动等操作来激活不同场景暗藏的彩蛋来激活。赶紧去发掘不同场景中的惊喜吧！</p>",i+="<br /><p>4.历练故事汇可以通过过关完整的历练关卡解锁，您将可以看到鹅们武林鹅生背后的故事。</p>",t.RulePanel.showRule(i,e)},i}();t.LedouHandbookView=i;var s=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this)},e.prototype.setData=function(t){this.btn_0.visible=!1,this.btn_1.visible=!1,this.btn_2.visible=!1,this.btn_4.visible=!1,this.btn_5.visible=!1,this["btn_"+t.type].visible=!0,this.img_red.visible=1==t.red,this.tf_time.text=t.count+" / "+t.total},Object.defineProperty(e.prototype,"selected",{set:function(t){},enumerable:!0,configurable:!0}),e}(ui.handbook.LeDouItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.Event,i=laya.ui.Image,s=function(){function i(i){this._datas=[],this._shareFlag=!1,this._display=i,this._display.btn_close.on(e.CLICK,this,this.btnClick),this._display.btn_shareZone.on(e.CLICK,this,this.btnClick),this._display.btn_shareFriend.on(e.CLICK,this,this.btnClick),Laya.timer.loop(2e3,this,this.award),this._con=this._display.img_con,this._pic=new t.PageList,this._pic.setPageButtons(this._display.btn_left,this._display.btn_right),this._pic.repeatX=1,this._pic.repeatY=1,this._pic.itemRender=n,this._pic.renderHandler=new Handler(this,this.onPicRender),this._pic.array=[],this._pic.on(t.PageList.EVENT_PAGE_CHANG,this,this.onPicChange),this._con.addChild(this._pic),this._display.btn_shareZone.visible=!1}return i.prototype.show=function(){this._display&&(this._display.visible=!0)},i.prototype.hide=function(){this._display&&(this._display.visible=!1)},i.prototype.update=function(){var e=t.HandbookNet.singleton.queryData,i=e.lists[2].attrs;this.createDataWithCfg(i),this.createDoubleData(),this._pic.array=this._datas,this._pic.page=0,this._datas.length<=1?this._display.btn_left.visible=this._display.btn_right.visible=!1:this._display.btn_left.visible=this._display.btn_right.visible=!0,this.onPicChange()},i.prototype.createDataWithCfg=function(t){this._datas.length=0;for(var e=0;e<i.STORY_CONFIG.length;e++){var s={};if(e<t.length){var n=t[e];s.id=n.id,s.star=n.star,s.status=n.status}else s.id=-1,s.star=-1,s.status=-1;s.name=i.STORY_CONFIG[e],s.name2=i.NAME_CONFIG[e],this._datas.push(s)}},i.prototype.createDoubleData=function(){for(var t=0;t<this._datas.length;t++){var e=this._datas[t],i={};i.id=e.id,i.name=e.name,i.name2=e.name2,1==e.star?(i.status=3,i.star=0,this._datas.splice(t,0,i)):(i.status=0,i.star=1,this._datas.splice(t+1,0,i)),t++}},i.prototype.btnClick=function(e){switch(e.currentTarget){case this._display.btn_close:t.Facade.callCommand(new t.OpenHandbookBoxCommand(t.HandbookType.MAIN));break;case this._display.btn_shareZone:this.share(1);break;case this._display.btn_shareFriend:this.share(0)}},i.prototype.onPicRender=function(t,e){this._curData=this._pic.getItem(e),t.setData(this._curData)},i.prototype.onPicChange=function(){var t=this._datas[this._pic.startIndex];-1==t.status||0==t.status||"0"==t.status?(this._display.sp_blank.visible=!0,this._display.sp_blank.getChildByName("tf_msg").text="%star%完成%name%历练关卡可激活%type%漫画".replace("%name%",t.name2).replace("%type%",1==t.star?"全彩":"普通").replace("%star%",1==t.star?"全三星":""),this._display.sp_star.visible=!1,this._display.tf_name.visible=!1,this._display.btn_shareZone.mouseEnabled=!1,this._display.btn_shareZone.gray=!0,this._display.btn_shareFriend.mouseEnabled=!1,this._display.btn_shareFriend.gray=!0):(this._display.sp_blank.visible=!1,1==t.star?(this._display.sp_star.visible=!0,this._display.tf_name.visible=!0,this._display.tf_name.text=t.name):(this._display.sp_star.visible=!1,this._display.tf_name.visible=!0,this._display.tf_name.text=t.name),this._display.btn_shareZone.mouseEnabled=!0,this._display.btn_shareZone.gray=!1,this._display.btn_shareFriend.mouseEnabled=!0,this._display.btn_shareFriend.gray=!1),1!=t.status&&2!=t.status||1!=t.star?this._display.img_award.visible=!1:this._display.img_award.visible=!0},i.prototype.share=function(e){this._shareFlag=!1;var i=this,s=this._pic.getCell(this._pic.startIndex),n=s.skin;t.Global.isWXAPP&&n.replace("wxapp","wxappshare"),t.HandbookShareUtil.share(t.HandbookShareUtil.SHARE_CODE_LILIAN,e,this._con,{title:["毕业啦毕业啦！","有点腻害，又通过一关！","全新漫画出炉"],desc:["本鹅成功通关“%name%”，鬼知道我都经历了些什么…".replace("%name%",this._curData.name2)],image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(n),tips:"好辛苦~终于通关啦！值得向好友们炫耀一下。"},function(t){0!=t&&0!=t.retCode||!i._curData||2!=i._curData.status||1!=i._curData.star||(i._shareFlag=!0)})},i.prototype.award=function(){if(this._shareFlag){var e=this;t.HandbookNet.singleton.award(2,e._curData.id,function(t){e._curData.status=3,e._display.img_award.visible=!1}),this._shareFlag=!1}},i.STORY_CONFIG=["第1章 启程","第2章 出师不利","第三章 初识","第四章 误解","第五章 重色轻友","第六章 根骨惊奇","第七章 要不起","第八章 秘密武器","第九章 洗劫一空","第十章 死里逃生"],i.NAME_CONFIG=["乐斗村","林松郊外","林松城","洞庭湖","摩云山","东海龙宫","花果山","玉龙湿地","回声遗迹","黄沙漩涡"],i}();t.LiliangHandbookView=s;var n=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t),this.destroyPic()},i.prototype.destroyPic=function(){this.skin&&""!=this.skin&&(Laya.loader.clearRes(this.skin),this.skin="")},i.prototype.setData=function(e){this._curData=e,-1!=e.id&&(this.destroyPic(),t.Global.isWXAPP?this.skin=t.Global.ResPath+t.ResourcePath.PATH_HANDBOOK_LILIANSTORY+"wxapp/"+e.id+".jpg":this.skin=t.Global.ResPath+t.ResourcePath.PATH_HANDBOOK_LILIANSTORY+e.id+".jpg",1==e.star?this.gray=!1:this.gray=!0,1==e.status&&t.HandbookNet.singleton.unlock(2,e.id,function(t){e.red=!1,e.status=2}))},i}(i)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.Event,i=function(i){function s(s){i.call(this,new ui.handbook.HandbookWuqiCardUI,!0,!0,!1,!1),this._shareFlag=!1,this._display=this.skin,this._data=s,this._curIcon=this._display.sp_card.getChildByName("img_icon"),this._curWord=this._display.sp_card.getChildByName("img_word"),this._display.btn_shareZone.on(e.CLICK,this,this.onBtnShare),this._display.btn_shareFriend.on(e.CLICK,this,this.onBtnShare),this.setCloseButton(this._display.btn_close),Laya.timer.loop(2e3,this,this.award),this._curImg=this.getIconPath(s.id),this._display.tf_name.text=s.name,this._display.tf_time.text="收藏日期："+t.DateUtils.formate(s.time),this._curIcon.skin=this._curImg,this._curWord.skin=t.ResPath().getPic(s.id,t.ResourcePath.PATH_HANDBOOK_WUQIWORD),this._lv=this.getLvById(s.id),this._id=this.getIdById(s.id),this._display.btn_shareZone.visible=!1,this._display.btn_shareFriend.x=618,t.Global.isWXAPP&&(this._display.img_QRCode.visible=!1),1!=s.status&&2!=s.status||0==this._lv?this._display.img_award.visible=!1:this._display.img_award.visible=!0}return __extends(s,i),s.prototype.onBtnShare=function(e){this._shareFlag=!1;var i=-1;e.currentTarget==this._display.btn_shareZone?i=1:e.currentTarget==this._display.btn_shareFriend&&(i=0);var s=this;t.HandbookNet.singleton.desc(function(e){var n=e.weapon_config[0].desc,a=s._curIcon.skin;t.Global.isWXAPP&&(a=t.ShareModule.getWXAPPWeaponShareUrl(e.weapon_config[0].id,e.weapon_config[0].level)),t.HandbookShareUtil.share(t.HandbookShareUtil.SHARE_CODE_WUQI,i,s._display.sp_card,{title:[s._data.name],desc:[n],image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(a),tips:"又收集了一把新的武器呢~不容易，赶紧发给朋友们看看吧！"},function(t){0!=t&&0!=t.retCode||!s._data||1!=s._data.status&&2!=s._data.status||0==s._lv||(s._shareFlag=!0)})},"weapon",this._id,this._lv)},s.prototype.award=function(){if(this._shareFlag){var e=this;t.HandbookNet.singleton.award(4,e._data.id,function(t){e._data.status=3,e._display.img_award.visible=!1}),this._shareFlag=!1}},s.prototype.getIconPath=function(e){e+="";var i=parseInt(e.substr(e.length-2,2)),s=parseInt(e.substr(0,e.length-2));return t.Global.ResPath+t.ResourcePath.PATH_WEAPON+"lv"+i+"/pic/"+s+".png"},s.prototype.getIdById=function(t){var e=t+"",t=parseInt(e.substr(0,e.length-2));return t},s.prototype.getLvById=function(t){var e=t+"",i=parseInt(e.substr(e.length-2,2));return i},s.prototype.destroy=function(){this._display.btn_shareZone.off(e.CLICK,this,this.onBtnShare),this._display.btn_shareFriend.off(e.CLICK,this,this.onBtnShare),this._display=null,this._data=null,this._curImg=null,this._curIcon=null,this._curWord=null,i.prototype.destroy.call(this)},s}(t.BaseBox);t.WuQiCardView=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.Event,i=function(){function i(i){this._datas=[],this._display=i,this._display.btn_close.on(e.CLICK,this,this.onBtnClick),this._list=new t.PageList,this._list.setPageButtons(this._display.btn_pre,this._display.btn_next),this._list.x=380,this._list.y=124,this._list.repeatX=3,this._list.repeatY=2,this._list.spaceX=45,this._list.spaceY=23,this._list.selectEnable=!0,this._list.itemRender=s,this._list.renderHandler=new Handler(this,this.onListRender),this._list.selectHandler=new Handler(this,this.onSelect),this._list.array=[],this._display.addChild(this._list)}return i.prototype.onBtnClick=function(e){switch(e.currentTarget){case this._display.btn_close:t.Facade.callCommand(new t.OpenHandbookBoxCommand(t.HandbookType.MAIN))}},i.prototype.onListRender=function(t,e){t.setData(this._list.getItem(e))},i.prototype.onSelect=function(e){if(-1!=e){var i=this._list.getItem(e);this.showSubPanel(i);var i=this._list.getItem(e),s=this._list.getCell(e);1==i.status&&t.HandbookNet.singleton.unlock(4,i.id,function(t){s.destroyEffect(),i.red=!1,i.status=2}),this._list.selectedIndex=-1}},i.prototype.showSubPanel=function(e){if(e.status>=1){var i=new t.WuQiCardView(e);i.show()}},i.prototype.show=function(){this._display&&(this._display.visible=!0)},i.prototype.hide=function(){this._display&&(this._display.visible=!1)},i.prototype.update=function(){var e=t.HandbookNet.singleton.queryData,i=e.lists[3].attrs;this.sortData(i),this._list.array=this._datas,this._list.page=0},i.prototype.sortData=function(t){this._datas.length=0;for(var e={},i=0;i<t.length;i++){var s=t[i],n=this.getIdById(s.id);this.getLvById(s.id);if(s.status>=1){var a;e[n]?a=e[n]:(a=[],e[n]=a),a.push(s)}}for(var o in e)if(a=e[o],3==a.length)for(i=0;i<a.length;i++)this._datas.push(a[i]);for(t.sort(function(t,e){var i=0;if(t.status>=1&&!(e.status>=1))i=-1;else{if(!(t.status>=1)&&e.status>=1)return 1;i=t.id<e.id?-1:1}return i}),i=0;i<t.length;i++)s=t[i],-1==this._datas.indexOf(s)&&this._datas.push(s)},i.prototype.getLvById=function(t){var e=t+"",i=parseInt(e.substr(e.length-2,2));return i},i.prototype.getIdById=function(t){var e=t+"",t=parseInt(e.substr(0,e.length-2));return t},i}();t.WuQiHandbookView=i;var s=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.destroy=function(){this.destroyEffect(),e.prototype.destroy.call(this)},i.prototype.setData=function(e){this._curData=e,this.img_red.visible=!1,0==e.red?this.destroyEffect():1==e.red&&this.createEffect(),0==e.status||"0"==e.status?(this.box_ok.visible=!1,this.img_nerver.visible=!0,this.img_icon.gray=!0,this.img_bg.gray=!0):e.status>=1&&(this.box_ok.visible=!0,this.img_nerver.visible=!1,this.img_icon.gray=!1,this.img_bg.gray=!1,this.box_ok.getChildByName("tf_time").text=t.DateUtils.formate(e.time)),this.img_icon.skin=this.getIconPath(e.id)},Object.defineProperty(i.prototype,"selected",{set:function(t){},enumerable:!0,configurable:!0}),i.prototype.createEffect=function(){this._effect||(this._effect=new t.AnimationSKe(t.Global.ResPath+"effect/effect_jstj.sk"),this._effect.x=this.width/2,this._effect.y=this.height/2),this._effect.play(0,!0),this.addChild(this._effect)},i.prototype.destroyEffect=function(){this._effect&&(this.removeChild(this._effect),this._effect.stop(),this._effect.destroy(),this._effect=null)},i.prototype.getIconPath=function(e){var i=e+"",s=parseInt(i.substr(i.length-2,2)),e=parseInt(i.substr(0,i.length-2));return t.Global.ResPath+t.ResourcePath.PATH_WEAPON+"lv"+s+"/pic/"+e+".png"},i}(ui.handbook.WuqiItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.initialize=function(e){this._um=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL)},i.prototype.finalize=function(){this._um=null},i.prototype.doCommand=function(t){switch(t.getCommandName()){case"HangupCmd":this.query();break;case"ShowDivineTroopsCmd":this.showDivineTroops();break;case"ShowHandupUpgradeCmd":this.showUpgradeBox(t.data);break;case"ShowGiftBoxCmd":this.showGiftBox(t.data);break;case"RefreshHangupCmd":this._hangupScene&&this._hangupScene.refresh(t.data);break;case"UpdatePointCmd":this._hangupScene&&this._hangupScene.updatePoint(t.cost)}},i.prototype.query=function(){t.XHR().Post({file:"petpk",cmd:"marry_hangup",op:"query",uid:t.Global.UID},this,this.dataRet)},i.prototype.dataRet=function(e){0==e.result?Laya.loader.load([t.ResPath().getHangupScene(e.stageid,1),t.ResPath().getHangupScene(e.stageid,2)],new Handler(this,this.enterScene,[e])):t.WeakTips.show(e.msg)},i.prototype.enterScene=function(t){this.showMainScene(t)},i.prototype.showMainScene=function(e){this._hangupScene||(this._hangupScene=new t.HangupScene(e),this._hangupScene.on(t.ViewEvent.BASE_DESTROY,this,this.hangupSceneDestroy),t.SceneMgr.changeScene(this._hangupScene))},i.prototype.hangupSceneDestroy=function(e){this._hangupScene&&(this._hangupScene.off(t.ViewEvent.BASE_DESTROY,this,this.hangupSceneDestroy),this._hangupScene.destroy(),this._hangupScene=null),this.unregisterPlugin()},i.prototype.showDivineTroops=function(){this._divineTroopsBox||(this._divineTroopsBox=new t.DivineTroopsBox),this._divineTroopsBox.show()},i.prototype.hideDivineTroops=function(){this._divineTroopsBox&&(this._divineTroopsBox.destroy(),this._divineTroopsBox=null)},i.prototype.showUpgradeBox=function(e){this._upgradeBox=new t.HangupUpgradeBox(e),this._upgradeBox.show()},i.prototype.showGiftBox=function(e){if(!this._giftBox){var i=e.hasOwnProperty("selfbox")?e.selfbox:[],s=e.hasOwnProperty("oppbox")?e.oppbox:[];this._giftBox=new t.HandupGiftBox(i,s,e),this._giftBox.on(t.ViewEvent.BASE_DESTROY,this,this.giftBoxDestroyHandler),this._giftBox.show()}},i.prototype.giftBoxDestroyHandler=function(){this._giftBox&&(this._giftBox.off(t.ViewEvent.BASE_DESTROY,this,this.giftBoxDestroyHandler),this._giftBox=null)},i.prototype.getPluginName=function(){return t.PluginDef.PLUGIN_HANGUP},i}(t.Plugin);t.HangupModule=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Dictionary,i=function(i){function s(e){i.call(this,new ui.hangup.HangupSceneUI),this._id=-1,this._display=this.skin,this._display.backBtn.on(Laya.Event.CLICK,this,this.backBtnClickHandler),this._data=e,
(t.Global.isWX||t.Global.isWXAPP)&&(this._display.backBtn.x-=100),this._display.attrTab.selectHandler=new Handler(this,this.tabChange),this._display.on(Laya.Event.CLICK,this,this.handler)}return __extends(s,i),s.prototype.onShowed=function(){this.tabChange(0),this._huv=new t.HangupView,this._huv.scale(933/1334,.724),this._display.fightSprite.addChild(this._huv),(this._data.stageid>1||this._data.subid>1)&&this._huv.start(),this.updata(),Laya.timer.once(500,this,this.checkAccount)},s.prototype.checkAccount=function(){if(this._data.hasOwnProperty("account")){var e=new t.ResultBox(this._data.account,new Handler(this,this.checkGift));e.show()}else this.checkGift()},s.prototype.checkGift=function(){if(this._data.gift&&this._data.gift.length>0){var e=new t.ShowHangupRewardBox(this._data,"恭喜，你的配偶送了你以下装备：");e.show()}},s.prototype.refresh=function(t){void 0===t&&(t=null),t&&(this._data=t),this.updata()},s.prototype.updata=function(){if(this._display.tfFightTimes.text="剩余失败次数："+(this._data.maxfight-this._data.fight),this._display.tfLevel.text=this._data.stagename,this._display.tfEffect.text=""+60*this._data.efficiency,this._display.bagRedState.visible=1==this._data.isBagFull,this._display.tfNum0.text=this._data.point<1e4?this._data.point:t.MathUtils.getDotNum(this._data.point/1e4,1)+"万",this._display.tfNum1.text=this._data.rlcoin+"/30000",this._display.tfNum2.text=this._data.stone,this._data.stageid!=this._id){var e=this._id;Laya.loader.load([t.ResPath().getHangupScene(this._data.stageid,1),t.ResPath().getHangupScene(this._data.stageid,1)],new Handler(this,this.changeBg,[e]))}this._data.fight>=this._data.maxfight&&t.Util.toGray(this._display.fightBtn),this._data.rlcoin>=1e3?t.Util.enable(this._display.exchangeBtn):t.Util.toGrayAndDisabled(this._display.exchangeBtn),this._display.exchangeRedState.visible=Number(this._data.rlcoin)>=1e3,0==this._data.encourage?(t.Util.enable(this._display.interactBtn),this._display.interactRedState.visible=!0):(t.Util.toGray(this._display.interactBtn),this._display.interactRedState.visible=!1),this.updateBuff();for(var i,s=!1,n=0;n<this._data.selfbox.length;n++)i=this._data.selfbox[n],i.hasOwnProperty("expired")&&Number(i.expired)>0&&Number(i.expired)<=Math.floor(t.ServerClock.getServerTime()/1e3)||0==i.locked&&(s=!0);for(var a,n=0;n<this._data.oppbox.length;n++)a=this._data.oppbox[n],a.hasOwnProperty("expired")&&Number(a.expired)>0&&Number(a.expired)<=Math.floor(t.ServerClock.getServerTime()/1e3)||0!=a.locked&&(s=!0);this._display.lockRedState.visible=s;for(var o,r=!1,n=0;n<this._data.slots.length;n++)o=this._data.slots[n],o.hasOwnProperty("item")&&null!=o.item.itemid?(this.deal(o),this._display["quality_"+(n+1)].skin="ui/hangup/quality_"+o.item.quality+".png",this._display["wp_"+(n+1)].skin=t.ResPath().getHangupPic(o.item.itemid,o.item.level),this._display["tfLv_"+(n+1)].text="+"+o.level,this._display["wp_"+(n+1)].on(Laya.Event.CLICK,this,this.clickTips,[n]),this._display["klG_"+(n+1)].visible=2==o.item.sex,this._display["klB_"+(n+1)].visible=1==o.item.sex,o.level<o.max_level&&o.cost<=this._data.stone&&(r=!0)):(this._display["quality_"+(n+1)].skin="",this._display["wp_"+(n+1)].skin="",this._display["tfLv_"+(n+1)].text="",this._display["klG_"+(n+1)].visible=!1,this._display["klB_"+(n+1)].visible=!1,this._display["wp_"+(n+1)].off(Laya.Event.CLICK,this,this.clickTips,[n]));this._display.upgradeRedState.visible=r,this._display.attr.text="挂机效率+"+t.MathUtils.getDotNum(this._data.guajiR/100,2)+"%";for(var h=this._data.totalattr,l=h.split(" "),n=0;n<l.length;n++)this._display["attrIcon"+n]&&(this._display["attrIcon"+n].visible=!0,this._display["attr"+n].text=l[n]);for(var n=l.length;9>n;n++)this._display["attrIcon"+n].visible=!1},s.prototype.changeBg=function(e){this._display.background.skin=t.ResPath().getHangupScene(this._data.stageid,1),this._id=this._data.stageid,this._huv.changeBackground(this._data.stageid),this.clearBackground(e)},s.prototype.clearBackground=function(e){-1!=e&&(Laya.loader.clearRes(t.ResPath().getHangupScene(e,1)),Laya.loader.clearRes(t.ResPath().getHangupScene(e,2)))},s.prototype.deal=function(i){for(var s=new e,n=new e,a=new e,o=i.item.effect,r=""==o?[]:o.split(" "),h=0;h<r.length;h++){var l=r[h].split("+");s.set(l[0],l[1])}for(var c,d,h=0;h<s.keys.length;h++){c=s.keys[h];var u=Number(s.get(c).split("%")[0])*(1+Number(i.ratio)/1e4);d=-1!=s.get(c).indexOf("%")?t.MathUtils.getDotNum(u,2)+"%":Math.floor(u),n.set(c,d)}for(var h=0;h<s.keys.length;h++){c=s.keys[h];var u=Number(s.get(c).split("%")[0])*(1+i.next_ratio/1e4);d=-1!=s.get(c).indexOf("%")?t.MathUtils.getDotNum(u,2)+"%":Math.floor(u),a.set(c,d)}i.map0=n,i.map1=a},s.prototype.updatePoint=function(e){this._data.point+=e,this._display.tfNum0.text=this._data.point<1e4?this._data.point:t.MathUtils.getDotNum(this._data.point/1e4,1)+"万"},s.prototype.updateBuff=function(){this._buffMap=new e;for(var i=0;i<this._data.buff.length;i++)this._buffMap.set(this._data.buff[i].id,this._data.buff[i]);if(Laya.timer.clear(this,this.updateBuffTime),this._buffMap.get(1)){var s=this._buffMap.get(1);s.leftTime=Math.floor(s.expired-t.ServerClock.getServerTime()/1e3),t.Util.enable(this._display.buff2),Laya.timer.loop(1e3,this,this.updateBuffTime),this._display.buff2.on(Laya.Event.CLICK,this,this.showBuff1Tips,[1,!0]),this.updateBuffTime()}else t.Util.toGray(this._display.buff2),this._display.tfBuffTime.text="",this._display.buff2.on(Laya.Event.CLICK,this,this.showBuff1Tips,[1,!1]);this._buffMap.get(2)?(t.Util.enable(this._display.buff1),this._display.buff1.on(Laya.Event.CLICK,this,this.showBuff1Tips,[2,!0])):(t.Util.toGray(this._display.buff1),this._display.buff1.on(Laya.Event.CLICK,this,this.showBuff1Tips,[2,!1]))},s.prototype.updateBuffTime=function(){var e=this._buffMap.get(1);if(e.leftTime--,e.leftTime<=0)t.Util.toGray(this._display.buff2),this._display.tfBuffTime.text="",this._display.buff2.on(Laya.Event.CLICK,this,this.showBuff1Tips,[1,!1]);else{var i=Math.floor(e.leftTime/60),s=Math.floor(e.leftTime%60);this._display.tfBuffTime.text=(i>=10?i:"0"+i)+":"+(s>=10?s:"0"+s),this._display.buff2.on(Laya.Event.CLICK,this,this.showBuff1Tips,[1,!0])}},s.prototype.removeBuff1=function(){for(var e=0;e<this._data.buff.length;e++)2==this._data.buff[e].id&&(this._data.buff.splice(e,1),t.Util.toGrayAndDisabled(this._display.buff1))},s.prototype.clickTips=function(e){t.HangupTip.show(this._data.slots[e],new Laya.Point(535+t.LayerMgr.offX,145+t.LayerMgr.offY),this._display)},s.prototype.showBuff1Tips=function(e,i){var s,n={},a=1==e?this._display.buff2:this._display.buff1;s=a.localToGlobal(new laya.maths.Point(-30,0)),n.name=(1==e?"比翼双飞":"心心相印")+"  "+(i?"生效中":"未生效"),n.desc=1==e?"刚刚被鼓励的你感受到了爱的力量。挂机效率提升800%，闯关时造成的伤害提升10%。":"目前的路程对你来说已是驾轻就熟。闯关胜利可以前进1大关"+(i?"，达到"+this._data.buff_stage+"关或闯关失败时状态消失":"")+"。",t.Tips.show(n,s)},s.prototype.handler=function(e){switch(e.target){case this._display.bagBtn:this.queryBag();break;case this._display.upgradeBtn:t.Facade.callCommand(new t.ShowHandupUpgradeCmd(this._data));break;case this._display.exchangeBtn:this.exchange();break;case this._display.dtBtn:t.Facade.callCommand(new t.ShowDivineTroopsCmd);break;case this._display.interactBtn:this.encourage();break;case this._display.unlockBtn:t.Facade.callCommand(new t.ShowGiftBoxCmd(this._data));break;case this._display.fightBtn:this.fight()}-1==e.target.name.indexOf("wp_")&&t.HangupTip.tipsClose(),"buff1"!=e.target.name&&"buff2"!=e.target.name&&t.Tips.tipsClose()},s.prototype.queryBag=function(){t.XHR().Post({file:"petpk",cmd:"marry_hangup",op:"bag_query",uid:t.Global.UID},this,this.queryBagRet)},s.prototype.queryBagRet=function(e){if(0==e.result){var i=new t.HangupBagBox(this._data,e);i.show()}else t.WeakTips.show(e.msg)},s.prototype.encourage=function(){t.XHR().Post({file:"petpk",cmd:"marry_hangup",op:"encourage",uid:t.Global.UID},this,this.encourageRet)},s.prototype.encourageRet=function(e){0==e.result?(this._data.encourage=1,this._data.buff=e.buff,this._data.efficiency=e.efficiency,this.updata(),t.WeakTips.show("鼓励成功！")):t.WeakTips.show(e.msg)},s.prototype.fight=function(){t.XHR().Post({file:"petpk",cmd:"marry_hangup",op:"fight",uid:t.Global.UID},this,this.fightRet)},s.prototype.fightRet=function(e){if(0==e.result){var i=new t.FightCommand(e);t.addListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.onFightEnd,[e]),t.Facade.callCommand(i)}else-1!=e.msg.indexOf("已达上限")&&(this._data.fight=this._data.maxfight,this.updata()),t.WeakTips.show(e.msg)},s.prototype.onFightEnd=function(e){t.removeListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.onFightEnd),e.hasOwnProperty("msg")&&""!=e.msg?t.WeakTips.show(e.msg):1==e.win?this._buffMap.get(2)?t.WeakTips.show("闯关成功，进入下一阶段！"):t.WeakTips.show("闯关成功，进入下一关"):t.WeakTips.show("闯关失败"),1==e.win&&(1==this._data.stageid&&1==this._data.subid&&this._huv.start(),this._data.stagename=e.stagename,this._data.stageid=e.stageid,this._data.subid=e.subid,this._data.efficiency=e.efficiency,e.stagename==this._data.buff_stage&&this.removeBuff1()),0==e.win&&(this._data.fight++,this.removeBuff1()),this.updata()},s.prototype.tabChange=function(t){0==t?(this._display.equipPanel.visible=!0,this._display.attrPanel.visible=!1):(this._display.equipPanel.visible=!1,this._display.attrPanel.visible=!0)},s.prototype.exchange=function(){t.XHR().Post({file:"petpk",cmd:"marry_hangup",op:"exchange",uid:t.Global.UID},this,function(e){if(0==e.result){this._data.rlcoin=e.rlcoin,this._data.point=Number(this._data.point)+Number(e.point_award),this._data.stone=Number(this._data.stone)+Number(e.stone_award);var i=new t.ShowHangupRewardBox(e,"");i.show(),e.hasOwnProperty("isBagFull")&&(this._data.isBagFull=e.isBagFull),this.updata()}else t.WeakTips.show(e.msg)})},s.prototype.backBtnClickHandler=function(){t.Facade.callCommand(new t.HomeCommand)},s.prototype.onHided=function(){this.destroy()},s.prototype.getSceneName=function(){return t.SceneDef.HANGUP_SCENE},s.prototype.destroy=function(){this._huv&&(this._huv.destroy(),this._huv=null),this.clearBackground(this._id),t.Tips.tipsClose(),t.HangupTip.tipsClose(),Laya.timer.clear(this,this.updateBuffTime),this._display.backBtn.off(Laya.Event.CLICK,this,this.backBtnClickHandler),this._display.off(Laya.Event.CLICK,this,this.handler),i.prototype.destroy.call(this)},s}(t.BaseScene);t.HangupScene=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.hangup.DivineTroopsUI,!0,!1,!1,!1),this.display=this.skin,this.setCloseButton(this.display.closeBtn),this.display.lst.itemRender=i,this.display.lst.renderHandler=new Handler(this,this.onListRender),this.display.lst.array=this._arr}return __extends(s,e),s.prototype.show=function(){e.prototype.show.call(this),this.query()},s.prototype.query=function(){t.XHR().Post({file:"petpk",cmd:"marry_hangup",op:"weapon_query",uid:t.Global.UID},this,this.dataRet)},s.prototype.dataRet=function(e){if(!this.destroyed)if(0==e.result){this._data=e;for(var i=0;i<e.weapons.length;i++)e.weapons[i].category=0;for(var i=0;i<e.skills.length;i++)e.skills[i].category=1;this._data.arr=this._data.weapons.concat(this._data.skills),this.display.lst.array=this._data.arr}else t.WeakTips.show(e.msg)},s.prototype.onListRender=function(t,e){t.setData(this.display.lst.getItem(e),e)},s.prototype.destroy=function(){e.prototype.destroy.call(this)},s}(t.BaseBox);t.DivineTroopsBox=e;var i=function(e){function i(){e.call(this),this._selected=!1,this.tfDesc.style.fontFamily="黑体",this.tfDesc.style.fontSize=20,this.tfDesc.style.leading=4,this.tfDesc.style.bold=!0,this.tfDesc.style.color="#4d3f34",this.tfDesc.style.valign="top"}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.setData=function(t,e){this._curData=t,this.updata()},i.prototype.updata=function(){this.tfAtk.text="战力："+this._curData.atk,this.icon.skin=t.ResPath().getPic(this._curData.id,0==this._curData.category?t.ResourcePath.PATH_WEAPON:t.ResourcePath.PATH_SKILL,this._curData.star),this.tfName.text=this._curData.name,this.tfEffect.text="+"+this._curData.substar+"/"+this._curData.star,this.tfEffect.x=this.tfName.x+this.tfName.textWidth+6,this.tfDemage.text=0==this._curData.category?"伤害："+this._curData.min_dmg+"-"+this._curData.max_dmg:"类型："+this._curData.type,this.tfDesc.innerHTML="效果："+this.changeDecHtml(this._curData.effect),this.tfCost.text=65==this._curData.level?"--":"x"+(this._curData.cost_num<1e4?this._curData.cost_num:t.MathUtils.getDotNum(this._curData.cost_num/1e4,1)+"万"),this.tfExtra.text=0==this._curData.category?"类型："+this._curData.type:"",this.starLst.array=new Array(this._curData.star),0==this._curData.status?(t.Util.toGray(this.bx),this.upgradeBtn.label="铸 造"):65==this._curData.level?(t.Util.toGrayAndDisabled(this.upgradeBtn),this.upgradeBtn.label="已达顶级"):(t.Util.enable(this.bx),this.upgradeBtn.label="强 化"),this.upgradeBtn.on(Laya.Event.CLICK,this,this.operate)},i.prototype.operate=function(){0==this._curData.status?t.XHR().Post({file:"petpk",cmd:"marry_hangup",op:"weapon_get",type:this._curData.category,id:this._curData.id,uid:t.Global.UID},this,this.buyRet):t.XHR().Post({file:"petpk",cmd:"marry_hangup",op:"weapon_upgrade",type:this._curData.category,id:this._curData.id,uid:t.Global.UID},this,this.upgradeRet)},i.prototype.buyRet=function(e){0==e.result?(t.Facade.callCommand(new t.UpdatePointCmd(0-this._curData.cost_num)),this._curData.status=1,this.updata(),t.WeakTips.show("恭喜获得"+this._curData.name)):t.WeakTips.show(e.msg)},i.prototype.upgradeRet=function(e){if(0==e.result){t.Facade.callCommand(new t.UpdatePointCmd(0-this._curData.cost_num));var i=e.weapon?e.weapon:e.skill;this._curData.cost_num=i.cost_num,this._curData.atk=i.atk,this._curData.effect=i.effect,this._curData.level=i.level,this._curData.star=i.star,this._curData.max_dmg=i.max_dmg,this._curData.min_dmg=i.min_dmg,this._curData.substar=i.substar,this.updata(),t.Facade.callCommand(new t.SyncChangeCmd(e)),t.WeakTips.show("铸造成功")}else t.WeakTips.show(e.msg)},i.prototype.changeDecHtml=function(t){for(var e=!1,i=0;!e;)-1!=t.indexOf("#")?(t=0==i%2?t.replace("#","<font color='@2d9610'>"):t.replace("#","</font>"),i++):e=!0;return t.replace(/@/g,"#")},i}(ui.hangup.DivineTroopsItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(s,n,a){e.call(this,new ui.hangup.HangupGiftBoxUI,!0,!0),this.display=this.skin,this._data=a,this.name="HangupGiftBox",this.setCloseButton(this.display.back.btnClose),this._selfArr=s,this._otherArr=n;for(var o=this._selfArr.length-1;o>=0;o--){var r=this._selfArr[o];r.hasOwnProperty("expired")&&Number(r.expired)>0&&Number(r.expired)<=Math.floor(t.ServerClock.getServerTime()/1e3)&&this._selfArr.splice(o,1)}for(var o=this._otherArr.length-1;o>=0;o--){var h=this._otherArr[o];h.hasOwnProperty("expired")&&Number(h.expired)>0&&Number(h.expired)<=Math.floor(t.ServerClock.getServerTime()/1e3)&&this._otherArr.splice(o,1)}this._list1=new laya.ui.List,this._list1.hScrollBarSkin="ui/comp/vscroll.png",this._list1.scrollBar.visible=!1,this._list1.renderHandler=Handler.create(this,this.updateLogItem1,null,!1),this._list1.itemRender=i,this.display.addChild(this._list1),this._list1.x=337,this._list1.y=215,this._list1.repeatX=5,this._list1.repeatY=1,this._list1.spaceX=40,this._list1.width=660,this._list1.array=this._selfArr,this._list2=new laya.ui.List,this._list2.hScrollBarSkin="ui/comp/vscroll.png",this._list2.scrollBar.visible=!1,this._list2.renderHandler=Handler.create(this,this.updateLogItem2,null,!1),this._list2.itemRender=i,this.display.addChild(this._list2),this._list2.x=337,this._list2.y=442,this._list2.repeatX=5,this._list2.repeatY=1,this._list2.spaceX=40,this._list2.width=660,this._list2.array=this._otherArr,t.EventCenter.singleton.on("HANDUPGIFTBOX_TIME_UP",this,this.giftIsTimeUp),t.EventCenter.singleton.on("HANDUPGIFTBOX_GET",this,this.getReward),t.EventCenter.singleton.on("HANDUPGIFTBOX_UNLOCK",this,this.unlockRewasrd)}return __extends(s,e),s.prototype.updateLogItem1=function(t,e){e<=this._list1.array.length-1&&t.doRender(this._list1.array[e],e,!0)},s.prototype.updateLogItem2=function(t,e){e<=this._list2.array.length-1&&t.doRender(this._list2.array[e],e,!1)},s.prototype.giftIsTimeUp=function(t){var e=t.isSelf,i=Number(t.idx);if(e){for(var s=0;s<this._selfArr.length;s++)if(Number(this._selfArr[s].idx)==i){this._selfArr.splice(s,1),this._list1.array=this._selfArr;break}}else for(var s=0;s<this._otherArr.length;s++)if(Number(this._otherArr[s].idx)==i){this._otherArr.splice(s,1),this._list2.array=this._otherArr;break}},s.prototype.getReward=function(e){this._getIdx=Number(e.idx);var i={cmd:"marry_hangup",op:"unlock",type:0,idx:this._getIdx};t.XHR().Post(i,this,this.getRewardHandler)},s.prototype.getRewardHandler=function(e){if(0==e.result){for(var i=0;i<this._selfArr.length;i++)if(Number(this._selfArr[i].idx)==this._getIdx){this._selfArr.splice(i,1),this._list1.array=this._selfArr;break}e.hasOwnProperty("point_award")&&(this._data.point=Number(this._data.point)+Number(e.point_award)),new t.ShowHangupRewardBox(e,"恭喜你获得：").show(),t.Facade.callCommand(new t.RefreshHangupCmd)}else t.WeakTips.show("领取失败，"+e.msg)},s.prototype.unlockRewasrd=function(e){this._unlockIdx=Number(e.idx);var i={cmd:"marry_hangup",op:"unlock",type:1,idx:this._unlockIdx};t.XHR().Post(i,this,this.unlockRewardHandler)},s.prototype.unlockRewardHandler=function(e){if(0==e.result){for(var i=0;i<this._otherArr.length;i++)if(Number(this._otherArr[i].idx)==this._unlockIdx){this._otherArr[i].locked=0,this._list2.array=this._otherArr;break}e.hasOwnProperty("point_award")&&(this._data.point=Number(this._data.point)+Number(e.point_award)),new t.ShowHangupRewardBox(e,"").show(),t.Facade.callCommand(new t.RefreshHangupCmd)}else t.WeakTips.show("解锁失败，"+e.msg)},s.prototype.destroy=function(){this._selfArr=null,this._otherArr=null,this._list1&&(this._list1.destroy(),this._list1=null),this._list2&&(this._list2.destroy(),this._list2=null),t.EventCenter.singleton.off("HANDUPGIFTBOX_TIME_UP",this,this.giftIsTimeUp),t.EventCenter.singleton.off("HANDUPGIFTBOX_GET",this,this.getReward),t.EventCenter.singleton.off("HANDUPGIFTBOX_UNLOCK",this,this.unlockRewasrd),this.display=null,e.prototype.destroy.call(this)},s}(t.BaseBox);t.HandupGiftBox=e;var i=function(e){function i(){e.call(this),this.timeTxt.visible=!1,this.doBtn.on(Laya.Event.CLICK,this,this.clickHandler),this._btnInitY=this.doBtn.y}return __extends(i,e),i.prototype.doRender=function(e,i,s){this._obj=e,this._isSelf=s,0==Number(e.locked)?(this.imagePng.skin="ui/hangup/open"+e.quality+".png",this.timeTxt.visible=!1,this.timeTxt.off(t.TimeTextControl.TIME_UP,this,this.timeUp),t.TimeTextControl.removeTimeText(this.timeTxt),this.doBtn.y=this._btnInitY-12,this._isSelf?(this.doBtn.label="领 取",this.doBtn.filters=null):(this.doBtn.label="已解锁",this.doBtn.filters=t.FiltersUtils.getGreyFilters())):(this.imagePng.skin="ui/hangup/close"+e.quality+".png",this.timeTxt.visible=!0,this.timeTxt.on(t.TimeTextControl.TIME_UP,this,this.timeUp),t.TimeTextControl.setTimeText(this.timeTxt,Number(e.expired)-Math.floor(t.ServerClock.getServerTime()/1e3),"HH:NN:SS"),this._isSelf?(this.doBtn.label="未解锁",this.doBtn.filters=t.FiltersUtils.getGreyFilters()):(this.doBtn.label="解 锁",this.doBtn.filters=null),this.doBtn.y=this._btnInitY)},i.prototype.timeUp=function(){t.EventCenter.singleton.event("HANDUPGIFTBOX_TIME_UP",{isSelf:this._isSelf,idx:this._obj.idx})},i.prototype.clickHandler=function(){this._isSelf?0!=Number(this._obj.locked)?t.WeakTips.show("必须由您的配偶来给您的宝箱解锁"):t.EventCenter.singleton.event("HANDUPGIFTBOX_GET",{idx:this._obj.idx}):0==Number(this._obj.locked)?t.WeakTips.show("该宝箱已经解过锁了"):t.EventCenter.singleton.event("HANDUPGIFTBOX_UNLOCK",{idx:this._obj.idx})},i.prototype.destroy=function(){this._obj=null,this.doBtn.off(Laya.Event.CLICK,this,this.clickHandler),this.timeTxt.off(t.TimeTextControl.TIME_UP,this,this.timeUp),t.TimeTextControl.removeTimeText(this.timeTxt),e.prototype.destroy.call(this)},i}(ui.hangup.HangupGiftBoxItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(t,s){e.call(this,new ui.hangup.BagUI,!0,!0,!0,!1),this.MAX=30,this.opcode=0,this.si=null,this.seletedIndex=-1,this.display=this.skin,this._ret=t,this._data=s,this.setCloseButton(this.display.closeBtn),this.display.lst.itemRender=i,this.display.lst.selectEnable=!0,this.display.lst.renderHandler=new Handler(this,this.onListRender),this.display.shortBtn.on(Laya.Event.CLICK,this,this.allRonglian),this.display.ronglianBtn.on(Laya.Event.CLICK,this,this.ronglian),this.display.opBtn.on(Laya.Event.CLICK,this,this.operate),this.display.ronglianBtn.visible=!1,this.display.opBtn.visible=!1,this._arr=new Array(30)}return __extends(s,e),s.prototype.show=function(){e.prototype.show.call(this),this.updata(),this.checkGift()},s.prototype.checkGift=function(){if(this._data.gift&&this._data.gift.length>0){var e=new t.ShowHangupRewardBox(this._data,"恭喜，你的配偶送了你以下装备：");e.show()}},s.prototype.updata=function(){if(t.HangupTip.tipsClose(),this._data)if(this.display.lst.array=this._arr,this.si){this.display.ronglianBtn.visible=!0;for(var e,i=this.si._itm,s=(t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL),0);s<this._ret.slots.length;s++)this._ret.slots[s].slot_id==i.slotid&&(e=this._ret.slots[s]);1==i.canequip?(this.opcode=3,this.display.opBtn.label="装 备",this.display.opBtn.visible=!0):1==i.cansend?(this.opcode=1,this.display.opBtn.label="赠 送",this.display.opBtn.visible=!0):this.display.opBtn.visible=!1}else this.display.ronglianBtn.visible=!1,this.display.opBtn.visible=!1},s.prototype.operate=function(){if(this.si){var t=this.si._itm;1==this.opcode?this.present(t):3==this.opcode&&this.dress(t)}},s.prototype.allRonglian=function(){t.XHR().Post({file:"petpk",cmd:"marry_hangup",op:"ronglian",grid_id:0,uid:t.Global.UID},this,this.ronglianRet)},s.prototype.ronglian=function(e){if(this.si){var e=this.si._itm;t.XHR().Post({file:"petpk",cmd:"marry_hangup",op:"ronglian",grid_id:e.grid_id,uid:t.Global.UID},this,this.ronglianRet)}},s.prototype.ronglianRet=function(e){0==e.result?(this._data=e,this.setSelect(null),this._ret.rlcoin=e.rlcoin,e.hasOwnProperty("isBagFull")&&(this._ret.isBagFull=e.isBagFull),t.Facade.callCommand(new t.RefreshHangupCmd),t.WeakTips.show(e.msg)):t.WeakTips.show(e.msg)},s.prototype.present=function(e){this.url=t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getHangupPic(e.itemid,e.level)),-1!=this.url.indexOf("//ledoures/")&&(this.url=this.url.replace("//ledoures/","/ledoures/")),t.XHR().Post({file:"petpk",cmd:"marry_hangup",op:"send",grid_id:e.grid_id,uid:t.Global.UID},this,this.presentRet)},s.prototype.presentRet=function(e){if(0==e.result){this._data=e,this.setSelect(null),e.hasOwnProperty("isBagFull")&&(this._ret.isBagFull=e.isBagFull,t.Facade.callCommand(new t.RefreshHangupCmd));var i=new t.ConfirmBoxData({confirmStr:"分 享",cancleStr:"下次吧",isShowCancelBtn:!0,callBackHandler:new Handler(this,this.presentShare),contentStr:"赠送成功，是否通知对方？"});t.ConfirmBox.show(i)}else t.WeakTips.show(e.msg)},s.prototype.presentShare=function(){t.Logger.log(this.url);t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);t.ShareModule.shareMessage({title:["赠送分享"],desc:["我刚获得了一件不错的装备，刚好适合你哦~快穿上看看吧"],share_type:0,toUin:this._ret.couple,uid:this._ret.couple,image_url:this.url,back:!0},null,0)},s.prototype.dress=function(e){t.XHR().Post({file:"petpk",cmd:"marry_hangup",op:"toslot",grid_id:e.grid_id,uid:t.Global.UID},this,this.dressRet)},s.prototype.dressRet=function(e){0==e.result?(this._data=e,this.setSelect(null),this._ret.totalattr=e.totalattr,this._ret.guajiR=e.guajiR,this._ret.rlcoin=e.rlcoin,this._ret.slots=e.slots,e.hasOwnProperty("isBagFull")&&(this._ret.isBagFull=e.isBagFull),t.Facade.callCommand(new t.RefreshHangupCmd),t.WeakTips.show(e.msg)):t.WeakTips.show(e.msg)},s.prototype.setSelect=function(t){return t?(this.si==t?(this.si.selected=!1,this.si=null):(this.si&&(this.si.selected=!1,this.si=null),this.si=t,this.si&&(this.si.selected=!0)),void this.updata()):(this.si&&(this.si.selected=!1,this.si=null),void this.updata())},s.prototype.onListRender=function(e,i){e.setData(this.display.lst.getItem(i),i,this._data,this),this.si?this.si.showTips():t.HangupTip.tipsClose()},s.prototype.destroy=function(){this.display.shortBtn.on(Laya.Event.CLICK,this,this.allRonglian),t.HangupTip.tipsClose(),e.prototype.destroy.call(this)},s}(t.BaseBox);t.HangupBagBox=e;var i=function(e){function i(){e.call(this),this._selected=!1}return __extends(i,e),i.prototype.destroy=function(){this.off(Laya.Event.CLICK,this,this.onClick),e.prototype.destroy.call(this)},i.prototype.setData=function(e,i,s,n){this._curData=s,this._curIndex=i,this._owner=n,this.flagEquip.visible=!1,this.flagGift.visible=!1,s&&i<s.capacity?(this._itm=s.bag[i],this._itm?(this.icon.skin=t.ResPath().getHangupPic(this._itm.itemid,this._itm.level),this.quality.skin="ui/hangup/quality_"+this._itm.quality+".png",this.flag.visible=this._selected,this.flagEquip.visible=1==this._itm.canequip,this.flagGift.visible=1==this._itm.cansend,this.klB.visible=1==this._itm.sex,this.klG.visible=2==this._itm.sex):(this.icon.skin="",this.quality.skin="",this.flag.visible=!1,this.klB.visible=!1,this.klG.visible=!1),this.lock.visible=!1):(this.icon.skin="",this.quality.skin="",this.flag.visible=!1,this.lock.visible=!0,this.klB.visible=!1,this.klG.visible=!1),s?this.on(Laya.Event.CLICK,this,this.onClick):this.off(Laya.Event.CLICK,this,this.onClick)},i.prototype.onClick=function(){if(this._curData&&this._curIndex>=this._curData.capacity){var e=new t.ConfirmBoxData({isShowCancelBtn:!0,callBackHandler:new Handler(this,this.inccap),contentStr:"购买下一个背包格子，需要消耗斗豆x"+this._owner._data.extendCost+",确定购买吗？"});t.ConfirmBox.show(e)}this._itm?(this._owner.setSelect(this),this.showTips()):this._owner.setSelect(null)},i.prototype.inccap=function(){t.XHR().Post({file:"petpk",cmd:"marry_hangup",op:"bag_inccap",uid:t.Global.UID},this,this.inccapRet)},i.prototype.showTips=function(){t.HangupTip.show(this._itm,new Laya.Point(720+t.LayerMgr.offX,130+t.LayerMgr.offY),this._owner)},i.prototype.inccapRet=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!1)),this._curData.capacity++,this._owner._data.extendCost=e.nextExtendCost,t.WeakTips.show("背包扩充成功"),this._owner.updata(),1==this._owner._ret.isBagFull&&(this._owner._ret.isBagFull=0,t.Facade.callCommand(new t.RefreshHangupCmd))):121==e.result?(t.WeakTips.show(e.msg),t.Facade.callCommand(new t.OpenVipBoxCommand(1))):t.WeakTips.show(e.msg)},Object.defineProperty(i.prototype,"selected",{set:function(t){t?(this._selected=!0,this.flag.visible=!0):(this._selected=!1,this.flag.visible=!1)},enumerable:!0,configurable:!0}),i}(ui.hangup.BagItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,new ui.hangup.UpgradeUI,!0,!0,!1,!1),this.MAX_LVEL=100,this.IDS=[4,0,2,1,5,3],this._selectIndex=-1,this._display=this.skin,this._data=t,this.setCloseButton(this._display.closeBtn),this._selectIndex=-1;for(var i,s=0;s<this.IDS.length;s++)if(i=this._data.slots[this.IDS[s]],i.hasOwnProperty("item")&&null!=i.item.itemid){this._selectIndex=this.IDS[s];break}this.updata(),this._display.upgradeBtn.on(Laya.Event.CLICK,this,this.upgrade,[0]),this._display.shortBtn.on(Laya.Event.CLICK,this,this.upgrade,[1])}return __extends(i,e),i.prototype.updata=function(){for(var e,i=0;i<this._data.slots.length;i++)e=this._data.slots[i],e.hasOwnProperty("item")&&null!=e.item.itemid?(this._display["wp_"+(i+1)].skin=t.ResPath().getHangupPic(e.item.itemid,e.item.level),this._display["tfLv_"+(i+1)].text="+"+e.level,this._display["wp_"+(i+1)].on(Laya.Event.MOUSE_DOWN,this,this.clickTips,[i]),this._display["quality_"+(i+1)].skin="ui/hangup/quality_"+e.item.quality+".png",this._display["equip_"+(i+1)].on(Laya.Event.CLICK,this,this.choose,[i]),this._display["redState_"+(i+1)].visible=e.level<e.max_level&&e.cost<=this._data.stone,this._display["klB_"+(i+1)].visible=1==e.item.sex,this._display["klG_"+(i+1)].visible=2==e.item.sex):(this._display["wp_"+(i+1)].skin="",this._display["quality_"+(i+1)].skin="",this._display["tfLv_"+(i+1)].text="",this._display["wp_"+(i+1)].off(Laya.Event.MOUSE_DOWN,this,this.clickTips,[i]),this._display["equip_"+(i+1)].off(Laya.Event.CLICK,this,this.choose),this._display["redState_"+(i+1)].visible=!1,this._display["klB_"+(i+1)].visible=!1,this._display["klG_"+(i+1)].visible=!1),this._display["kl_"+(i+1)].visible=!1,this._display["wp_"+(i+1)].on(Laya.Event.MOUSE_OUT,this,this.hideTips),this._display["kl_"+(i+1)].visible=this._selectIndex==i;if(-1==this._selectIndex)this._display.attr0.text="",this._display.attr1.text="",this._display.attr2.text="",this._display.attr3.text="",this._display.attr5.text="",this._display.tfCost.text="",t.Util.toGrayAndDisabled(this._display.upgradeBtn),t.Util.toGrayAndDisabled(this._display.shortBtn);else{var s=this._data.slots[this._selectIndex].map0,n=this._data.slots[this._selectIndex].map1,a=0;this._display.attr5.text="";for(var o,e=this._data.slots[this._selectIndex],i=0;i<s.keys.length&&4>i;i++)o=s.keys[i],"挂机效率"!=o?(this._display["attr"+a].text=e.level<this.MAX_LVEL?o+"+"+s.get(o)+" >> +"+n.get(o):o+"+"+s.get(o),a++):this._display.attr5.text=e.level<this.MAX_LVEL?o+s.get(o)+" >> "+n.get(o):o+s.get(o);for(var i=a;4>i;i++)this._display["attr"+i].text="";this._display.tfCost.text=e.level<10*e.item.level&&e.level<this.MAX_LVEL?"消耗：强化石*"+e.cost+"（"+this._data.stone+"）":"已达顶级",e.level<10*e.item.level&&e.level<this.MAX_LVEL&&this._data.stone>=e.cost?(t.Util.enable(this._display.upgradeBtn),t.Util.enable(this._display.shortBtn)):(this._display.upgradeBtn.mouseEnabled=!0,this._display.shortBtn.mouseEnabled=!0,t.Util.toGray(this._display.upgradeBtn),t.Util.toGrayAndDisabled(this._display.shortBtn))}},i.prototype.clickTips=function(e){t.HangupTip.show(this._data.slots[e],this._display["wp_"+(e+1)].localToGlobal(new laya.maths.Point(-30,0)))},i.prototype.choose=function(t){t!=this._selectIndex&&(this._selectIndex=t,this.updata())},i.prototype.upgrade=function(e){void 0===e&&(e=0);var i=this._data.slots[this._selectIndex];this._data.stone>=i.cost?t.XHR().Post({file:"petpk",cmd:"marry_hangup",op:"lvlupslot",slot_id:this._data.slots[this._selectIndex].slot_id,mutil:e,uid:t.Global.UID},this,this.dataRet):t.WeakTips.show("强化石不够")},i.prototype.dataRet=function(e){this.destroyed||(0==e.result?(this._data=e,t.Facade.callCommand(new t.RefreshHangupCmd(e)),this.updata(),t.WeakTips.show("强化成功")):t.WeakTips.show(e.msg))},i.prototype.hideTips=function(){t.HangupTip.tipsClose()},i.prototype.destroy=function(){e.prototype.destroy.call(this)},i}(t.BaseBox);t.HangupUpgradeBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Tween,i=Laya.Ease,s=function(s){function n(){s.call(this),this.ANI_NORMAL_STAND="act_breath_0",this.ANI_GET_WEAPON="act_choose",this.ANI_RUN="act_move_0",this.ANI_RUN_WITH_WEAPON="act_move_1",this.times=0,this.MAX_TIMES=3,this.isDestroy=!1,this.initialize()}return __extends(n,s),n.prototype.initialize=function(){this.background.scrollRect=new Laya.Rectangle(0,0,1280,714),this.fightLayer.scrollRect=new Laya.Rectangle(0,0,1280,714),this._fighterB=new t.AnimationSKe("assets/skeleton/qq.sk",1),
this._fighterG=new t.AnimationSKe("assets/skeleton/qq.sk",1),this._fighterB.showSkinByName("male"),this._fighterG.showSkinByName("female"),this.fightLayer.addChild(this._fighterB),this.fightLayer.addChild(this._fighterG),this._fighterB.play(this.ANI_NORMAL_STAND,!0),this._fighterG.play(this.ANI_NORMAL_STAND,!0),this._fighterB.pos(n.leftFighterX+100,n.fighterY),this._fighterG.pos(n.leftFighterX-100,n.fighterY),this._fighterR=this._fighterB,this._fighterL=this._fighterG,this._effectSk=new t.AnimationSKe(t.ResPath().getEffect("ui_hangup")),this.addNpc()},n.prototype.changeBackground=function(e){this.bg1.skin=t.ResPath().getHangupScene(e,1),this.bg2.skin=t.ResPath().getHangupScene(e,1),this.bg.skin=t.ResPath().getHangupScene(e,2),this.bg.x=n.BG_X[e-1]},n.prototype.start=function(){this.act(),this.addChild(this._effectSk),this._effectSk.y=300,this._effectSk.x=630,this._effectSk.play(0,!0)},n.prototype.act=function(){this.equipWeapon()},n.prototype.addNpc=function(){this._npcSk&&(this._npcSk.destroy(),this._npcSk=null);var e=Math.ceil(74*Math.random());7!=e&&9!=e||(e+=1),this._npcSk=new t.AnimationSKe(t.ResPath().getAnim(e,t.ResourcePath.PATH_NPC),1),this.fightLayer.addChildAt(this._npcSk,0),this._npcSk.pos(n.rightFighterX,n.fighterY),this._npcSk.play("act_idle",!0),this._npcSk.scale(-1,1)},n.prototype.equipWeapon=function(){this._fighterR.play(this.ANI_GET_WEAPON,!1),this.changeWeapon(this._fighterR),this._fighterR.on(Laya.Event.STOPPED,this,this.moveToNpc)},n.prototype.moveToNpc=function(){this._fighterR.off(Laya.Event.STOPPED,this,this.moveToNpc),this._fighterR.play(this.ANI_RUN_WITH_WEAPON,!0),e.to(this._fighterR,{x:n.rightFighterX-100},1e3,i.linearIn,new Handler(this,this.onMoveToNpc))},n.prototype.onMoveToNpc=function(){this.times=0;var t=100*Math.random();34>t?this.MAX_TIMES=1:67>t?this.MAX_TIMES=2:this.MAX_TIMES=3,this._fighterR.play("act_attack_1_1",!1),this._fighterR.on(Laya.Event.LABEL,this,this.onFighterEvent),this._fighterR.on(Laya.Event.STOPPED,this,this.onAttack),this._npcSk.play("act_injure",!1),this._npcSk.on(Laya.Event.LABEL,this,this.onEvent)},n.prototype.onFighterEvent=function(t){switch(t.name){case"event_hit":this._npcSk.play("act_injure",!1)}},n.prototype.onEvent=function(e){switch(t.Logger.log(e.name),e.name){case"event_hit_default":if(this.isDestroy)return;Laya.timer.callLater(this,function(){this._npcSk.play("act_injure",!1,!0,5e3)}),this.setWord()}},n.prototype.removeNpc=function(){this._npcSk&&(this._npcSk.off(Laya.Event.LABEL,this,this.onEvent),this._npcSk.removeSelf(),this._npcSk.destroy(),this._npcSk=null)},n.prototype.npcOut=function(){Laya.Tween.to(this._npcSk,{x:1734,y:0,rotation:360},600/t.FightController.TIME_SCALE,null,Handler.create(this,this.removeNpc))},n.prototype.onAttack=function(){this.times++,this.times==this.MAX_TIMES?(this._fighterR.off(Laya.Event.LABEL,this,this.onFighterEvent),this._fighterR.off(Laya.Event.STOPPED,this,this.onAttack),this.npcOut(),this.nextScene(),this.setWeaponEmpty(this._fighterR)):this._fighterR.play("act_attack_2_2",!1)},n.prototype.nextScene=function(){this._fighterR.play(this.ANI_RUN,!0),e.to(this._fighterR,{x:1440},1e3,i.linearIn,new Handler(this,this.onMoveStageOut))},n.prototype.onMoveStageOut=function(){this._fighterR.x=-150,e.to(this._fighterR,{x:n.leftFighterX-300},1e3,i.linearIn,new Handler(this,this.moveNextScene))},n.prototype.moveNextScene=function(){this._fighterL.play(this.ANI_RUN,!0),e.to(this._fighterR,{x:n.leftFighterX-100},1e3,i.linearIn,new Handler(this,this.sceneMove)),e.to(this._fighterL,{x:n.leftFighterX+100},1e3,i.linearIn)},n.prototype.sceneMove=function(){this.background.scrollRect.x=0,e.to(this.background.scrollRect,{x:this.background.scrollRect.x+1254},3e3,i.linearIn,new Handler(this,this.next))},n.prototype.next=function(){this._fighterB.play(this.ANI_NORMAL_STAND,!0),this._fighterG.play(this.ANI_NORMAL_STAND,!0);var t=this._fighterL;this._fighterL=this._fighterR,this._fighterR=t,this.addNpc(),this.act()},n.prototype.setWeaponEmpty=function(t){t.setSlotSkin("wuqi",Laya.Loader.getRes("ui/comp/vscroll_empty.png"))},n.prototype.changeWeapon=function(e){var i=n.WEAPON_IDS[Math.floor(Math.random()*n.WEAPON_IDS.length)],s=Math.floor(11*Math.random());this.url=t.ResPath().getFightWeapon(i,s),this.ft=e,Laya.loader.load(this.url,new Handler(this,this.loadWeaponEnd))},n.prototype.loadWeaponEnd=function(){var t=Laya.Loader.getRes(this.url);this.ft.setSlotSkin("wuqi",t)},n.prototype.setWord=function(){if(!this.isDestroy){var e;e=1==this.MAX_TIMES?Math.floor(3e3*Math.random())+12e3:3==this.MAX_TIMES?Math.floor(1500*Math.random())+3500:0==this.times?Math.floor(1500*Math.random())+3500:Math.floor(3e3*Math.random())+12e3;var i=this.getDamageWord(),s=1;this.addChild(i),i.showWord(""+e),i.x=this._npcSk.x+-1*s*i.imgWidth/2+(0>s?-1:0)*i.imgWidth,i.y=this._npcSk.y-180,this.timeLine=new Laya.TimeLine,this.timeLine.to(i,{y:i.y-1},300/t.FightController.TIME_SCALE).to(i,{y:i.y-100,alpha:0},1e3/t.FightController.TIME_SCALE).once(Laya.Event.COMPLETE,this,this.afterFloat,[i]),this.timeLine.play()}},n.prototype.afterFloat=function(t){t&&t.parent&&(t.removeSelf(),t.destroy())},n.prototype.getDamageWord=function(){var e=new t.ImageWord("assets/word/damage/");return e},n.prototype.destroy=function(){this.isDestroy=!0,this._fighterB&&this._fighterB.destroy(),this._fighterG&&this._fighterG.destroy(),this._npcSk&&this._npcSk.destroy(),this.timeLine&&(this.timeLine.offAll(),this.timeLine.destroy()),this._effectSk&&(this._effectSk.destroy(),this._effectSk=null),s.prototype.destroy.call(this)},n.BG_X=[1238,1253,1260,1186,1203,1062,843,1261,1200,1127],n.WEAPON_IDS=[200002,200003,200006,200007,200008,200009,200012,200019,200020,200022,200023,200024,200025,200026,200028,200029],n.qqUrl="assets/skeleton/qq.sk",n.leftFighterX=290,n.rightFighterX=1044,n.fighterY=610,n.leftMoveX=910,n.rightMoveX=424,n.figherScale=1.1,n.runTime=500,n}(ui.hangup.HangupUI);t.HangupView=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i,s){e.call(this,new ui.hangup.ResultUI,!0,!0,!0,!1),this._display=this.skin,this._handler=s,this.setCloseButton(this._display.boxClose),this._display.confirmBtn.on(Laya.Event.CLICK,this,this.hide);var n=t.DateUtils.getTimeFomateObj(i.seconds);this._display.tfTitle.text="本次挂机共持续："+(24*n.day+n.hour)+"小时"+n.minute+"分。",this._display.text1.text="仙缘x"+i.point_award,this._display.text2.text="装备x"+i.equip_award.length,this._display.text3.text="宝箱x"+i.box_award.length}return __extends(i,e),i.prototype.destroy=function(){this._handler&&(this._handler.run(),this._handler=null),e.prototype.destroy.call(this)},i}(t.BaseBox);t.ResultBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i,s){e.call(this,new ui.common.ShowGetRewardViewNewUI,!0,!0),this.spWidth1=0,this._scaleCount=0,this._showSpeed=30,this.display=this.skin,this.cacheAs="none",this.display.mainLayer.cacheAs="bitmap",this.name="ShowHangupRewardBox",this.canClickModelToClose=!1,this.sp1=new Sprite,this.display.sp.addChild(this.sp1),this.setCloseButton(this.display.queDingBtn),this.display.queDingBtn.x=550,this.display.msgContent.visible=!1,this.display.msgContent.text=s||"";var n=0;if(i.hasOwnProperty("point_award")){var a=new ui.hangup.RewardItemUI;a.name="itemMc0",a.size(90,90),a.scaleX=a.scaleY=0,a.cacheAs="none",a.icon.skin="ui/hangup/point.png",a.tfNum.text=i.point_award,a.quality.skin="";var o="仙缘x"+i.point_award;!function(e,i){i.on(Laya.Event.CLICK,this,function(){var s={};s.name=e,t.Tips.show(s,i.localToGlobal(new laya.maths.Point(0,0))),t.HangupTip.tipsClose()})}(o,a),this.sp1.addChild(a),this.spWidth1+=0==n?90:140,a.x=n,n+=140}if(i.hasOwnProperty("stone_award")){var a=new ui.hangup.RewardItemUI;a.name="itemMc0",a.size(90,90),a.scaleX=a.scaleY=0,a.cacheAs="none",a.icon.skin="ui/hangup/stone.png",a.tfNum.text=i.stone_award,a.quality.skin="";var o="强化石x"+i.stone_award;!function(e,i){i.on(Laya.Event.CLICK,this,function(){var s={};s.name=e,t.Tips.show(s,i.localToGlobal(new laya.maths.Point(0,0))),t.HangupTip.tipsClose()})}(o,a),this.sp1.addChild(a),this.spWidth1+=0==n?90:140,a.x=n,n+=140}if(i.hasOwnProperty("equip_award")){var r=i.equip_award,a=new ui.hangup.RewardItemUI;a.name="itemMc1",a.size(90,90),a.scaleX=a.scaleY=0,a.cacheAs="none",a.icon.skin=t.ResPath().getHangupPic(r.itemid,r.level),a.tfNum.text="",a.quality.skin="ui/hangup/quality_"+r.quality+".png",function(e,i){i.on(Laya.Event.CLICK,this,function(){t.HangupTip.show(r,i.localToGlobal(new laya.maths.Point(0,0))),t.Tips.tipsClose()})}(r,a),this.sp1.addChild(a),this.spWidth1+=0==n?90:140,a.x=n,n+=140}if(i.hasOwnProperty("gift"))for(var h=0;h<i.gift.length;h++){var r=i.gift[h],a=new ui.hangup.RewardItemUI;a.name="itemMc"+h,a.size(90,90),a.scaleX=a.scaleY=0,a.cacheAs="none",a.icon.skin=t.ResPath().getHangupPic(r.itemid,r.level),a.tfNum.text="",a.quality.skin="ui/hangup/quality_"+r.quality+".png",function(e,i){var s=r;i.on(Laya.Event.CLICK,this,function(){t.HangupTip.show(s,i.localToGlobal(new laya.maths.Point(0,0))),t.Tips.tipsClose()})}(r,a),this.sp1.addChild(a),this.spWidth1+=0==n?90:140,a.x=n,n+=140}this.sp1.x=(t.LayerMgr.width-this.spWidth1)/2,this.sp1.y=(t.LayerMgr.height-this.sp1.height)/2-105;var l=-400,c=-400;this._movieLight=new t.AnimationSKe("assets/skeleton/hj.sk",1),this.display.spMovieBeh.addChild(this._movieLight),this._movieLight.x=t.LayerMgr.width/2+l,this._movieLight.y=340+c,this._movieLight.play(1,!0),this.display.maskMc.visible=!1,this._movieLight.scrollRect=new Laya.Rectangle(l,c,800,192),this._movieAll=new t.AnimationSKe("assets/skeleton/hj.sk",1),this._movieAll.showSkinByName("gxhd"),this.display.spMovieBeh.addChild(this._movieAll),this._movieAll.x=t.LayerMgr.width/2,this._movieAll.y=340,this._movieAll.play(0,!1);var d=new Sprite;d.graphics.drawRect(0,0,t.LayerMgr.width,t.LayerMgr.clientHeight,"#000000"),d.alpha=.8,d.y=-t.LayerMgr.offY,d.mouseEnabled=!0,d.size(t.LayerMgr.width,t.LayerMgr.clientHeight),this.display.addChildAt(d,0),this._scaleValueArr=[],this._scaleStepArr=[],this._scaleCount=0,Laya.timer.once(200,this,this.delaySetScale),this.display.on(Laya.Event.CLICK,this,this.onClick)}return __extends(i,e),i.prototype.onClick=function(e){-1==e.target.name.indexOf("itemMc")&&(t.Tips.tipsClose(),t.HangupTip.tipsClose())},i.prototype.delaySetScale=function(){this.display.msgContent.visible=!0,Laya.timer.loop(30,this,this.setScale)},i.prototype.setScale=function(){this._scaleCount++;var t=0,e=this.sp1.numChildren,i=0;if(this.sp1)for(var s=this.sp1.numChildren,n=0;s>n;n++)if(t++,this._scaleCount>3*(t-1)){this._scaleValueArr.length<t&&(this._scaleValueArr[t-1]=0,this._scaleStepArr[t-1]=this._showSpeed);var a=this._scaleValueArr[t-1],o=this._scaleStepArr[t-1];if(o==this._showSpeed||a>100){a+=o,this._scaleValueArr[t-1]=a;var r=this.sp1.getChildAt(n);r.scaleX=r.scaleY=a/100,o==this._showSpeed&&a>=120&&(o=-4,this._scaleStepArr[t-1]=o)}else i++}i==e&&Laya.timer.clear(this,this.setScale)},i.prototype.destroy=function(){if(Laya.timer.clear(this,this.delaySetScale),Laya.timer.clear(this,this.setScale),this.display.off(Laya.Event.CLICK,this,this.onClick),this._scaleValueArr=null,this._scaleStepArr=null,t.Tips.tipsClose(),t.HangupTip.tipsClose(),this.sp1){for(;this.sp1.numChildren>0;){var i=this.sp1.removeChildAt(0),s=i.getChildByName("ani");s&&s.stop()}this.sp1.destroy(),this.sp1=null}this._movieLight&&(this._movieLight.destroy(),this._movieLight=null),this._movieAll&&(this._movieAll.destroy(),this._movieAll=null),this.display&&(this.display=null),Laya.loader.clearRes("assets/skeleton/hj.sk"),e.prototype.destroy.call(this)},i.SHOW_REWARD_BOX_END="SHOW_REWARD_BOX_END",i}(t.BaseBox);t.ShowHangupRewardBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.display.Sprite,i=function(e){function i(){e.call(this),this.isTest=!1,this.triggered=!1}return __extends(i,e),i.prototype.trigger=function(){this.report()},i.prototype.report=function(){-1==t.Global.HandBook_bgs.indexOf(this.sid)&&t.XHR().Post({file:"petpk",cmd:"handbook",op:"add",type:1,id:this.sid,uid:t.Global.UID},this,function(e){if(0==e.result){var i=t.Facade.retrieveModel(t.ModelDef.ALL_STATUS_MODEL);i.setStatueFlagByName(t.AllStatusModel.HANDBOOK_STATE,1)}})},i.prototype.OnTriggeredEnd=function(){this.triggered=!1,this.sk&&this.sk.removeSelf(),this.showFirtEffect()},i.prototype.showFirtEffect=function(){-1==t.Global.HandBook_bgs.indexOf(this.sid)&&(t.Global.HandBook_bgs.push(this.sid),t.Facade.callCommand(new t.HomeEffectActiveCmd(this.sid)))},i.prototype.destroy=function(){e.prototype.destroy.call(this),this.sk&&(this.sk.offAll(),this.sk.removeSelf(),this.sk.destroy())},i}(e);t.BackEffect=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Event,i=laya.display.Sprite,s=function(s){function n(){s.call(this),this.url=t.Global.ResPath+"effect/chibi.sk",this.w=100,this.h=100,this.TrackLength=400,this.TOGGLE_DIST=300,this.sid=10001,this.init()}return __extends(n,s),n.prototype.init=function(){var t=new i;this.isTest&&t.graphics.drawRect(0,0,this.w,this.h,"#FF7F50"),t.pivot(this.w/2,this.h/2),t.size(this.w,this.h),t.x=(Laya.stage.width-this.TrackLength)/2,t.y=180,t.on(e.MOUSE_DOWN,this,this.onMouseDown),this.addChild(t),this.button=t,this.beginPosition=t.x,this.endPosition=this.beginPosition+this.TrackLength},n.prototype.onMouseDown=function(t){Laya.stage.on(e.MOUSE_MOVE,this,this.onMouseMove),this.buttonPosition=this.button.x,Laya.stage.on(e.MOUSE_UP,this,this.onMouseUp),Laya.stage.on(e.MOUSE_OUT,this,this.onMouseUp)},n.prototype.onMouseMove=function(t){this.button.x=Math.max(Math.min(Laya.stage.mouseX,this.endPosition),this.beginPosition)},n.prototype.onMouseUp=function(t){Laya.stage.off(e.MOUSE_MOVE,this,this.onMouseMove),Laya.stage.off(e.MOUSE_UP,this,this.onMouseUp),Laya.stage.off(e.MOUSE_OUT,this,this.onMouseUp);var i=Laya.stage.mouseX-this.buttonPosition;i>this.TOGGLE_DIST&&this.trigger(),this.button.x=(Laya.stage.width-this.TrackLength)/2},n.prototype.trigger=function(){s.prototype.trigger.call(this),this.triggered||(this.triggered=!0,this.sk||(this.sk=new t.AnimationSKe(this.url),this.sk.x=400,this.sk.y=130),this.addChild(this.sk),this.sk.play(0,!1,!0),this.sk.on(e.STOPPED,this,this.OnTriggeredEnd))},n}(t.BackEffect);t.Effect_10001=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Event,i=laya.display.Sprite,s=laya.display.Graphics,n=laya.utils.HitArea,a=function(a){function o(){a.call(this),this.url=t.Global.ResPath+"effect/leitai.sk",this.r=123,this.sid=10002,this.init()}return __extends(o,a),o.prototype.init=function(){var t=new i;this.isTest&&(t.graphics.drawCircle(this.r,this.r,this.r,"#FF7F50"),t.alpha=.7);var a=new n,o=new s;o.drawCircle(this.r,this.r,this.r,"#FF7F50"),a.hit=o,t.x=127,t.y=160,t.hitArea=a,this.addChild(t),t.on(e.CLICK,this,this.trigger);var r=new i;this.isTest&&(r.graphics.drawCircle(this.r,this.r,this.r,"#FF7F50"),r.alpha=.7);var h=new n,l=new s;l.drawCircle(this.r,this.r,this.r,"#FF7F50"),h.hit=l,r.x=958,r.y=160,r.hitArea=h,this.addChild(r),r.on(e.CLICK,this,this.trigger)},o.prototype.trigger=function(){a.prototype.trigger.call(this),this.triggered||(this.triggered=!0,this.sk||(this.sk=new t.AnimationSKe(this.url),this.sk.x=644,this.sk.y=530),this.addChild(this.sk),this.sk.on(e.STOPPED,this,this.OnTriggeredEnd),this.sk.play(0,!1,!0))},o}(t.BackEffect);t.Effect_10002=a}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Event,i=laya.display.Sprite,s=laya.display.Graphics,n=laya.utils.HitArea,a=function(a){function o(){a.call(this),this.url=t.Global.ResPath+"effect/sjsdld.sk",this.r=100,this.sid=10003,this.init()}return __extends(o,a),o.prototype.init=function(){var t=new i;this.isTest&&t.graphics.drawCircle(this.r,this.r,this.r,"#FF7F50");var a=new n,o=new s;o.drawCircle(this.r,this.r,this.r,"#FF7F50"),a.hit=o,t.x=710,t.y=220,t.hitArea=a,this.addChild(t),t.on(e.CLICK,this,this.trigger)},o.prototype.trigger=function(){a.prototype.trigger.call(this),this.triggered||(this.triggered=!0,this.sk||(this.sk=new t.AnimationSKe(this.url),this.sk.x=800,this.sk.y=320),this.addChild(this.sk),this.sk.play(0,!1),this.sk.on(e.STOPPED,this,this.OnTriggeredEnd))},o}(t.BackEffect);t.Effect_10003=a}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Event,i=laya.display.Sprite,s=laya.display.Graphics,n=laya.utils.HitArea,a=function(a){function o(){a.call(this),this.url=t.Global.ResPath+"effect/yjzl.sk",this.r=30,this.sid=10004,this.init()}return __extends(o,a),o.prototype.init=function(){var t=new i;this.isTest&&(t.graphics.drawCircle(this.r,this.r,this.r,"#FF7F50"),t.alpha=.7);var a=new n,o=new s;o.drawCircle(this.r,this.r,this.r,"#FF7F50"),a.hit=o,t.x=975,t.y=410,t.hitArea=a,this.addChild(t),t.on(e.CLICK,this,this.trigger)},o.prototype.trigger=function(){a.prototype.trigger.call(this),this.triggered||(this.triggered=!0,this.sk||(this.sk=new t.AnimationSKe(this.url),this.sk.x=662,this.sk.y=442),this.addChild(this.sk),this.sk.play(0,!1),this.sk.on(e.STOPPED,this,this.OnTriggeredEnd))},o}(t.BackEffect);t.Effect_10004=a}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Event,i=laya.display.Sprite,s=laya.device.Shake,n=function(n){function a(){n.call(this),this.url=t.Global.ResPath+"effect/yc.sk",this.ACT_NUM=4,this.w=106,this.h=74,this.sid=10005,s.instance.start(7,700),this.init()}return __extends(a,n),a.prototype.init=function(){if(this.isTest){var t=new i;t.graphics.drawRect(0,0,this.w,this.h,"#FF7F50"),t.size(this.w,this.h),t.x=443,t.y=375,this.addChild(t),t.on(e.CLICK,this,this.trigger)}s.instance.on(Laya.Event.CHANGE,this,this.trigger)},a.prototype.trigger=function(){if(n.prototype.trigger.call(this),!this.triggered){this.triggered=!0,this.sk||(this.sk=new t.AnimationSKe(this.url),this.sk.x=0,this.sk.y=0),this.sk.x=366+543*Math.random(),this.addChild(this.sk);var i=Math.floor(4*Math.random());this.sk.play(i,!1),this.sk.on(e.STOPPED,this,this.OnTriggeredEnd)}},a.prototype.destroy=function(){s.instance.off(Laya.Event.CHANGE,this,this.trigger),s.instance.stop(),n.prototype.destroy.call(this)},a}(t.BackEffect);t.Effect_10005=n}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Event,i=laya.display.Sprite,s=laya.device.Shake,n=function(n){function a(){n.call(this),this.url=t.Global.ResPath+"effect/xiaxue2.sk",this.ACT_NUM=4,this.w=106,this.h=74,this.sid=10006,s.instance.start(7,700),this.init()}return __extends(a,n),a.prototype.init=function(){if(this.isTest){var t=new i;t.graphics.drawRect(0,0,this.w,this.h,"#FF7F50"),t.size(this.w,this.h),t.x=443,t.y=375,this.addChild(t),t.on(e.CLICK,this,this.trigger)}s.instance.on(Laya.Event.CHANGE,this,this.trigger)},a.prototype.trigger=function(){n.prototype.trigger.call(this),this.triggered||(this.triggered=!0,this.sk||(this.sk=new t.AnimationSKe(this.url),this.sk.x=500,this.sk.y=0),this.addChild(this.sk),this.sk.play(0,!1),this.sk.on(e.STOPPED,this,this.OnTriggeredEnd))},a.prototype.destroy=function(){s.instance.off(Laya.Event.CHANGE,this,this.trigger),s.instance.stop(),n.prototype.destroy.call(this)},a}(t.BackEffect);t.Effect_10006=n}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Event,i=laya.display.Sprite,s=function(s){function n(){s.call(this),this.url=t.Global.ResPath+"effect/wldh.sk",this.w=244,this.h=81,this.isShowed=!1,this.sid=20001,this.init()}return __extends(n,s),n.prototype.init=function(){var t=new i;this.isTest&&(t.alpha=.3),t.size(this.w,this.h),t.x=557,t.y=105,this.addChild(t),t.on(e.CLICK,this,this.trigger)},n.prototype.trigger=function(){s.prototype.trigger.call(this),this.triggered||(this.triggered=!0,this.isShowed?(this.sk.visible=!1,this.triggered=!1):(this.sk||(this.sk=new t.AnimationSKe(this.url),this.sk.x=660,this.sk.y=155,this.addChild(this.sk)),this.sk.play(0,!1,!0),this.sk.on(e.STOPPED,this,this.OnTriggeredEnd),this.sk.visible=!0),this.isShowed=!this.isShowed)},n.prototype.OnTriggeredEnd=function(){this.triggered=!1,this.showFirtEffect()},n}(t.BackEffect);t.Effect_20001=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Event,i=laya.display.Sprite,s=laya.display.Graphics,n=laya.utils.HitArea,a=function(a){function o(){a.call(this),this.url=t.Global.ResPath+"effect/ldccd.sk",this.r=40,this.sid=30001,this.init()}return __extends(o,a),o.prototype.init=function(){this.sk=new t.AnimationSKe(this.url),this.sk.x=0,this.sk.y=751,this.addChild(this.sk),this.sk.play(0,!1),this.sk.index=0;var a=new i;this.isTest&&(a.graphics.drawCircle(this.r,this.r,this.r,"#FF7F50"),a.alpha=.7);var o=new n,r=new s;r.drawCircle(this.r,this.r,this.r,"#FF7F50"),o.hit=r,a.pivotX=this.r,a.pivotY=this.r,a.x=949,a.y=461,a.hitArea=o,this.addChild(a),a.on(e.CLICK,this,this.trigger)},o.prototype.trigger=function(){a.prototype.trigger.call(this),this.triggered||(this.triggered=!0,this.sk.play(0,!1),this.sk.on(e.STOPPED,this,this.OnTriggeredEnd))},o.prototype.OnTriggeredEnd=function(){this.sk.index=0,this.triggered=!1,this.showFirtEffect()},o}(t.BackEffect);t.Effect_30001=a}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Event,i=laya.display.Sprite,s=laya.maths.Point,n=function(n){function a(){n.call(this),this.url=t.Global.ResPath+"effect/lscjw.sk",this.w=150,this.h=150,this.TrackLength=400,this.TOGGLE_DIST=170,this.sid=30002,this.init()}return __extends(a,n),a.prototype.init=function(){var t=new i;this.isTest&&t.graphics.drawRect(0,0,this.w,this.h,"#FF7F50"),t.size(this.w,this.h),t.x=454,t.y=55,t.on(e.MOUSE_DOWN,this,this.onMouseDown),this.addChild(t),this.button=t,this.beginPosition=new s(t.x,t.y),this.endPosition=new s(this.beginPosition.x+this.TrackLength,this.beginPosition.y+this.TrackLength)},a.prototype.onMouseDown=function(t){Laya.stage.on(e.MOUSE_MOVE,this,this.onMouseMove),this.buttonPosition=new s(Laya.stage.mouseX,Laya.stage.mouseY),Laya.stage.on(e.MOUSE_UP,this,this.onMouseUp),Laya.stage.on(e.MOUSE_OUT,this,this.onMouseUp)},a.prototype.onMouseMove=function(t){var e=new s(Laya.stage.mouseX,Laya.stage.mouseY);this.button.y=Math.max(Math.min(e.y,this.endPosition.y),this.beginPosition.y),this.button.x=Math.max(Math.min(e.x,this.endPosition.x),this.beginPosition.x)},a.prototype.cancel=function(){this.button.x=this.beginPosition.x,this.button.y=this.beginPosition.y,Laya.stage.off(e.MOUSE_MOVE,this,this.onMouseMove),Laya.stage.off(e.MOUSE_UP,this,this.onMouseUp),Laya.stage.off(e.MOUSE_OUT,this,this.onMouseUp)},a.prototype.onMouseUp=function(e){var i=new s(Laya.stage.mouseX,Laya.stage.mouseY);this.button.y=Math.max(Math.min(i.y,this.endPosition.y),this.beginPosition.y),this.button.x=Math.max(Math.min(i.x,this.endPosition.x),this.beginPosition.x);var n=Math.max(i.x,this.buttonPosition.x)-this.buttonPosition.x+.1,a=Math.max(i.y,this.buttonPosition.y)-this.buttonPosition.y+.1;if(n>a){if(.5>a/n)return this.cancel(),void t.Logger.log("deltaY / deltaX:"+a/n)}else if(.5>n/a)return this.cancel(),void t.Logger.log("deltaX / deltaY:"+n/a);var o=i.x-this.buttonPosition.x,r=i.y-this.buttonPosition.y;o>this.TOGGLE_DIST&&r>this.TOGGLE_DIST&&this.trigger(),this.cancel()},a.prototype.trigger=function(){n.prototype.trigger.call(this),this.triggered||(this.triggered=!0,this.sk||(this.sk=new t.AnimationSKe(this.url),this.sk.x=508,this.sk.y=64),this.addChild(this.sk),this.sk.play(0,!1,!0),this.sk.on(e.STOPPED,this,this.OnTriggeredEnd))},a}(t.BackEffect);t.Effect_30002=n}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Event,i=laya.display.Sprite,s=function(s){function n(){s.call(this),this.url=t.Global.ResPath+"effect/QB_cast.sk",this.w=150,this.h=150,this.TrackLength=400,this.TOGGLE_DIST=300,this.sid=30003,this.init()}return __extends(n,s),n.prototype.init=function(){var t=new i;this.isTest&&t.graphics.drawRect(0,0,this.w,this.h,"#FF7F50"),t.pivot(this.w/2,this.h/2),t.size(this.w,this.h),t.x=(Laya.stage.width-this.TrackLength)/2,t.y=Laya.stage.height/2+200,t.on(e.MOUSE_DOWN,this,this.onMouseDown),this.addChild(t),this.button=t,this.beginPosition=t.x,this.endPosition=this.beginPosition+this.TrackLength},n.prototype.onMouseDown=function(t){Laya.stage.on(e.MOUSE_MOVE,this,this.onMouseMove),this.buttonPosition=this.button.x,Laya.stage.on(e.MOUSE_UP,this,this.onMouseUp),Laya.stage.on(e.MOUSE_OUT,this,this.onMouseUp)},n.prototype.onMouseMove=function(t){this.button.x=Math.max(Math.min(Laya.stage.mouseX,this.endPosition),this.beginPosition)},n.prototype.onMouseUp=function(t){Laya.stage.off(e.MOUSE_MOVE,this,this.onMouseMove),Laya.stage.off(e.MOUSE_UP,this,this.onMouseUp),Laya.stage.off(e.MOUSE_OUT,this,this.onMouseUp);var i=Laya.stage.mouseX-this.buttonPosition;i>this.TOGGLE_DIST&&this.trigger(),this.button.x=(Laya.stage.width-this.TrackLength)/2},n.prototype.trigger=function(){s.prototype.trigger.call(this),this.triggered||(this.triggered=!0,this.sk||(this.sk=new t.AnimationSKe(this.url),this.sk.y=700),this.addChild(this.sk),this.sk.play(0,!1),this.sk.on(e.STOPPED,this,this.OnTriggeredEnd))},n}(t.BackEffect);t.Effect_30003=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Event,i=laya.display.Sprite,s=function(s){function n(){s.call(this),this.url=t.Global.ResPath+"effect/dth.sk",this.w=100,this.h=100,this.TrackLength=400,this.TOGGLE_DIST=220,this.sid=30004,this.init()}return __extends(n,s),n.prototype.init=function(){var t=new i;this.isTest&&t.graphics.drawRect(0,0,this.w,this.h,"#FF7F50"),t.pivot(this.w/2,this.h/2),t.size(this.w,this.h),t.x=783,t.y=103,t.on(e.MOUSE_DOWN,this,this.onMouseDown),this.addChild(t),this.button=t,this.beginPosition=t.y,this.endPosition=this.beginPosition+this.TrackLength},n.prototype.onMouseDown=function(t){Laya.stage.on(e.MOUSE_MOVE,this,this.onMouseMove),this.buttonPosition=this.button.y,Laya.stage.on(e.MOUSE_UP,this,this.onMouseUp),Laya.stage.on(e.MOUSE_OUT,this,this.onMouseUp)},n.prototype.onMouseMove=function(t){this.button.y=Math.max(Math.min(Laya.stage.mouseY,this.endPosition),this.beginPosition)},n.prototype.onMouseUp=function(t){Laya.stage.off(e.MOUSE_MOVE,this,this.onMouseMove),Laya.stage.off(e.MOUSE_UP,this,this.onMouseUp),Laya.stage.off(e.MOUSE_OUT,this,this.onMouseUp);var i=Laya.stage.mouseY-this.buttonPosition;i>this.TOGGLE_DIST&&this.trigger(),this.button.y=103},n.prototype.trigger=function(){s.prototype.trigger.call(this),this.triggered||(this.triggered=!0,this.sk||(this.sk=new t.AnimationSKe(this.url),this.sk.x=745,this.sk.y=80),this.addChild(this.sk),this.sk.play(0,!1,!0),this.sk.on(e.STOPPED,this,this.OnTriggeredEnd))},n}(t.BackEffect);t.Effect_30004=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Event,i=laya.display.Sprite,s=function(s){function n(){s.call(this),this.url=t.Global.ResPath+"effect/myszd.sk",this.w=106,this.h=74,this.sid=30005,this.init()}return __extends(n,s),n.prototype.init=function(){var t=new i;this.isTest&&t.graphics.drawRect(0,0,this.w,this.h,"#FF7F50"),t.size(this.w,this.h),t.x=443,t.y=375,this.addChild(t),t.on(e.CLICK,this,this.trigger)},n.prototype.trigger=function(){s.prototype.trigger.call(this),this.triggered||(this.triggered=!0,this.sk||(this.sk=new t.AnimationSKe(this.url),this.sk.x=488,this.sk.y=410),this.addChild(this.sk),this.sk.play(0,!1),this.sk.on(e.STOPPED,this,this.OnTriggeredEnd))},n}(t.BackEffect);t.Effect_30005=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Event,i=laya.device.Shake,s=function(s){function n(){s.call(this),this.url=t.Global.ResPath+"effect/dhlg.sk",this.w=106,this.h=74,this.sid=30006,i.instance.start(7,700),this.init()}return __extends(n,s),n.prototype.init=function(){i.instance.on(Laya.Event.CHANGE,this,this.trigger)},n.prototype.trigger=function(){if(s.prototype.trigger.call(this),!this.triggered){this.triggered=!0,this.sk||(this.sk=new t.AnimationSKe(this.url),this.sk.y=460),this.sk.x=278+800*Math.random(),this.addChild(this.sk),this.sk.play(0,!1),this.sk.on(e.STOPPED,this,this.OnTriggeredEnd),this.sks=[];for(var i=0;4>i;i++){var n=new t.AnimationSKe(this.url);n.y=460,n.x=278+800*Math.random(),this.addChild(n),n.play(0,!1),this.sks.push(n)}}},n.prototype.onPlayEnd=function(t){},n.prototype.destroy=function(){if(i.instance.off(Laya.Event.CHANGE,this,this.trigger),i.instance.stop(),this.sks){for(var t,e=0;e<this.sks.length;e++)t=this.sks[e],t.removeSelf(),t.destroy();this.sks=null}s.prototype.destroy.call(this)},n}(t.BackEffect);t.Effect_30006=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Event,i=laya.display.Sprite,s=laya.display.Graphics,n=laya.utils.HitArea,a=function(a){function o(){a.call(this),this.url=t.Global.ResPath+"effect/sld.sk",this.r=40,this.sid=30007,this.init()}return __extends(o,a),o.prototype.init=function(){var t=new i;this.isTest&&(t.graphics.drawCircle(this.r,this.r,this.r,"#FF7F50"),t.alpha=.4);var a=new n,o=new s;o.drawCircle(this.r,this.r,this.r,"#FF7F50"),a.hit=o,t.pivotX=this.r,t.pivotY=this.r,t.x=493,t.y=525,t.hitArea=a,this.addChild(t),t.on(e.CLICK,this,this.onTrigger);var r=138,h=42,l=new i;this.isTest&&(l.graphics.drawRect(0,0,r,h,"#FF7F50"),l.alpha=.4),l.pivot(r/2,h/2),l.size(r,h),l.x=360,l.y=460,this.addChild(l),l.on(e.CLICK,this,this.onTrigger);
var c=180,d=48,u=new i;this.isTest&&(u.graphics.drawRect(0,0,c,d,"#FF7F50"),u.alpha=.4),u.pivot(c/2,d/2),u.size(c,d),u.x=1e3,u.y=560,this.addChild(u),u.on(e.CLICK,this,this.onTrigger)},o.prototype.onTrigger=function(t){this.eX=t.target.x+t.target.mouseX-52,this.eY=t.target.y+t.target.mouseY-24,this.trigger()},o.prototype.trigger=function(){a.prototype.trigger.call(this),this.triggered||(this.triggered=!0,this.sk||(this.sk=new t.AnimationSKe(this.url)),this.sk.x=this.eX,this.sk.y=this.eY,this.addChild(this.sk),this.sk.play(0,!1),this.sk.on(e.STOPPED,this,this.OnTriggeredEnd))},o}(t.BackEffect);t.Effect_30007=a}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Event,i=laya.display.Sprite,s=laya.display.Graphics,n=laya.utils.HitArea,a=function(a){function o(){a.call(this),this.url=t.Global.ResPath+"effect/hsyj.sk",this.r=80,this.sid=30009,this.init()}return __extends(o,a),o.prototype.init=function(){var t=new i;this.isTest&&(t.graphics.drawCircle(this.r,this.r,this.r,"#FF7F50"),t.alpha=.7);var a=new n,o=new s;o.drawCircle(this.r,this.r,this.r,"#FF7F50"),a.hit=o,t.x=989,t.y=166,t.hitArea=a,this.addChild(t),t.on(e.CLICK,this,this.trigger)},o.prototype.trigger=function(){a.prototype.trigger.call(this),this.triggered||(this.triggered=!0,this.sk||(this.sk=new t.AnimationSKe(this.url),this.sk.x=1071,this.sk.y=334),this.addChild(this.sk),this.sk.play(0,!1),this.sk.on(e.STOPPED,this,this.OnTriggeredEnd))},o}(t.BackEffect);t.Effect_30009=a}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Event,i=laya.display.Sprite,s=function(s){function n(){s.call(this),this.url=t.Global.ResPath+"effect/petal.sk",this.w=340,this.h=420,this.sid=30010,this.init()}return __extends(n,s),n.prototype.init=function(){var t=new i;this.isTest&&t.graphics.drawRect(0,0,this.w,this.h,"#FF7F50"),t.size(this.w,this.h),t.x=1334-this.w,t.y=0,t.on(e.CLICK,this,this.trigger),this.addChild(t);var s=new i;this.isTest&&(s.graphics.drawRect(0,0,130,190,"#11F7230"),s.alpha=.3),s.size(130,190),s.x=1334-this.w-130,s.y=230,s.on(e.CLICK,this,this.trigger),this.addChild(s)},n.prototype.trigger=function(){s.prototype.trigger.call(this),this.triggered||(this.triggered=!0,this.sk||(this.sk=new t.AnimationSKe(this.url),this.sk.x=1e3,this.sk.y=312),this.addChild(this.sk),this.sk.play(0,!1),this.sk.on(e.STOPPED,this,this.OnTriggeredEnd))},n}(t.BackEffect);t.Effect_30010=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Event,i=laya.display.Sprite,s=function(s){function n(){s.call(this),this.url=t.Global.ResPath+"effect/yt.sk",this.beTriggered0=!1,this.w=100,this.h=100,this.TrackLength=400,this.TOGGLE_DIST=240,this.sid=40001,this.init()}return __extends(n,s),n.prototype.init=function(){var t=new i;this.isTest&&t.graphics.drawRect(0,0,this.w,this.h,"#FF7F50"),t.pivot(this.w/2,this.h/2),t.size(this.w,this.h),t.x=341,t.y=226,t.on(e.MOUSE_DOWN,this,this.onMouseDown),this.addChild(t),this.button=t,this.beginPosition=t.x,this.endPosition=this.beginPosition+this.TrackLength;var s=new i;this.isTest&&s.graphics.drawRect(0,0,this.w,this.h,"#FF7F50"),s.pivot(this.w/2,this.h/2),s.size(this.w,this.h),s.x=959,s.y=226,s.on(e.MOUSE_DOWN,this,this.onMouseDown1),this.addChild(s),this.button1=s,this.beginPosition1=s.x,this.endPosition1=this.beginPosition1-this.TrackLength},n.prototype.onMouseDown=function(t){Laya.stage.on(e.MOUSE_MOVE,this,this.onMouseMove),this.buttonPosition=this.button.x,Laya.stage.on(e.MOUSE_UP,this,this.onMouseUp),Laya.stage.on(e.MOUSE_OUT,this,this.onMouseUp)},n.prototype.onMouseMove=function(t){this.button.x=Math.max(Math.min(Laya.stage.mouseX,this.endPosition),this.beginPosition)},n.prototype.onMouseUp=function(t){Laya.stage.off(e.MOUSE_MOVE,this,this.onMouseMove),Laya.stage.off(e.MOUSE_UP,this,this.onMouseUp),Laya.stage.off(e.MOUSE_OUT,this,this.onMouseUp);var i=Laya.stage.mouseX-this.buttonPosition;i>this.TOGGLE_DIST&&(this.beTriggered0=!0),this.button.x=341,this.button.y=226},n.prototype.onMouseDown1=function(t){Laya.stage.on(e.MOUSE_MOVE,this,this.onMouseMove1),this.buttonPosition1=this.button1.x,Laya.stage.on(e.MOUSE_UP,this,this.onMouseUp1),Laya.stage.on(e.MOUSE_OUT,this,this.onMouseUp1)},n.prototype.onMouseMove1=function(t){this.button1.x=Math.min(Math.max(Laya.stage.mouseX,this.endPosition1),this.beginPosition1)},n.prototype.onMouseUp1=function(t){Laya.stage.off(e.MOUSE_MOVE,this,this.onMouseMove1),Laya.stage.off(e.MOUSE_UP,this,this.onMouseUp1),Laya.stage.off(e.MOUSE_OUT,this,this.onMouseUp1);var i=this.buttonPosition1-Laya.stage.mouseX;i>this.TOGGLE_DIST&&1==this.beTriggered0&&(this.trigger(),this.beTriggered0=!1),this.button1.x=959,this.button1.y=226},n.prototype.trigger=function(){s.prototype.trigger.call(this),this.triggered||(this.triggered=!0,this.sk||(this.sk=new t.AnimationSKe(this.url),this.sk.x=675,this.sk.y=198),this.addChild(this.sk),this.sk.play(0,!1,!0),this.sk.on(e.STOPPED,this,this.OnTriggeredEnd))},n.prototype.OnTriggeredEnd=function(){s.prototype.OnTriggeredEnd.call(this),this.beTriggered0=!1},n}(t.BackEffect);t.Effect_40001=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.display.Sprite,i=function(e){function i(t,i){e.call(this),this.EFFECT_LIST=[10001,10002,10003,10004,10005,10006,20001,30001,30002,30003,30004,30005,30006,30007,30009,30010,40001],this._hasShowNationalBg=!1,this.width=1334,this.height=750,this.effectLayer0=t,this.effectLayer1=i,this.effectLayer1.mouseThrough=!0}return __extends(i,e),i.prototype.change=function(){var e=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);e.firstLogin&&!this._hasShowNationalBg&&(Laya.loader.clearRes(t.ResPath().getFightScene(t.Global.MAIN_SCENE_BG_ID)),t.Global.MAIN_SCENE_BG_ID=1001,this._hasShowNationalBg=!0),this.loadImage(t.ResPath().getFightScene(t.Global.MAIN_SCENE_BG_ID));var i=Number(t.Global.MAIN_SCENE_BG_ID);if(this.effect&&this.currId!=i&&(this.effect.removeSelf(),this.effect.destroy(),this.effect=null,this.currId=-1),-1!=this.EFFECT_LIST.indexOf(i)&&!this.effect){var s=t.JSUtils.StrToFuc("hf.Effect_"+i);this.effect=new s,10003==i?this.effectLayer0.addChild(this.effect):this.effectLayer1.addChild(this.effect),this.currId=i}},i}(e);t.HomeBack=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.display.Sprite,i=laya.utils.Tween,s=laya.utils.Ease,n=function(n){function o(i){n.call(this),this.cfg=i,this.group=[];var s=this.cfg.btns.length;this.w=s*this.cfg.width+(s-1)*this.cfg.spaceX,this.width=this.w,this.height=this.cfg.height,this.container=new e,this.container.width=this.w,this.container.height=this.cfg.height,this.s=new e,this.s.width=this.w,this.s.height=this.cfg.height,this.addChild(this.s),this.s.y=200,this.s.addChild(this.container),this.s.scrollRect=new Laya.Rectangle(0,0,this.width,this.height+200),this.s.mouseThrough=!0,this.mouseThrough=!0;var o,r,h;for(o=0;o<this.cfg.btns.length;o++)if(h=this.cfg.btns[o],r=new t.Icon(h.skin),r.setCfg(h,t.Icon.BOTTOM_MENU),this.group.push(r),h.hasOwnProperty("childs")){var l=new a(h.childs,this);r.childMenu=l,l.hide()}this.arrange()}return __extends(o,n),o.prototype.arrange=function(){var t,e,i,s=0;for(t=this.cfg.btns.length-1;t>=0;t--)i=this.cfg.btns[t],e=this.group[t],e.isExist()?(e.right=s,this.container.addChild(e),i.hasOwnProperty("childs")&&(e.childMenu.x=e.x+e.width/2,e.childMenu.arrange()),s+=i.width+this.cfg.spaceX):this.container.removeChild(e)},o.prototype.hideAllSubMenu=function(){for(var t,e=0;e<this.group.length;e++)t=this.group[e],t.childMenu&&t.childMenu.hide()},o.prototype.spread=function(t){void 0===t&&(t=500),this.mouseEnabled=!0,i.to(this.container,{x:0},t,s.expoOut)},o.prototype.spreadDirect=function(){this.mouseEnabled=!0,this.container.x=0},o.prototype.hide=function(t){void 0===t&&(t=500),this.mouseEnabled=!1,this.hideAllSubMenu(),i.to(this.container,{x:this.w},t,s.expoOut)},o}(e);t.BottomMenu=n;var a=function(e){function n(i,s){e.call(this),this.isShow=!1,this.cfg=i,this.mParent=s,this.group=[];var n,a,o;for(n=0;n<this.cfg.btns.length;n++)o=this.cfg.btns[n],a=new t.Icon(o.skin),a.setCfg(o,t.Icon.BOTTOM_MENU),a.owner=this,this.group.push(a);this.pivotX=this.w,this.arrange()}return __extends(n,e),n.prototype.arrange=function(){var t,e,i,s=0,n=this.cfg.space;for(t=0;t<this.cfg.btns.length;t++)i=this.cfg.btns[t],e=this.group[t],e.isExist()?(e.left=n,e.y=7,this.addChild(e),n+=i.width+this.cfg.spaceX,s++):this.removeChild(e);var a=s*this.cfg.width+(s-1)*this.cfg.spaceX+2*this.cfg.space;this.back.width=a,this.width=a,this.pivotX=a/2,this.arrow.x=a/2,this.y=80,this.mParent.addChildAt(this,0),this.visible=!1,this.isShow=!1},n.prototype.changeState=function(){this.isShow?this.hide():this.spread()},n.prototype.spread=function(e){void 0===e&&(e=200),t.Facade.callCommand(new t.HideAllSubMenu),this.visible=!0,this.y=120,this.alpha=.5,i.to(this,{alpha:1,y:80},e,s.expoOut,new Handler(this,this.onShow)),this.mouseEnabled=!0,this.isShow=!0},n.prototype.onShow=function(){this.checkIconEffect()},n.prototype.hide=function(t){void 0===t&&(t=300),this.visible=!1,this.isShow=!1,this.checkIconEffect()},n.prototype.checkIconEffect=function(){for(var t=0;t<this.group.length;t++)this.group[t].checkEffect()},n}(ui.comp.SubBottomMenuUI);t.BottomSubMenu=a}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.ui.Image,i=laya.utils.Tween,s=laya.utils.Ease,n=function(n){function a(t){void 0===t&&(t="comp/sbtn.png"),n.call(this,"",t),this.isShow=!0,this.platVisible=!0,this.skinUrl=t,this.on(Laya.Event.CLICK,this,this.onClick)}return __extends(a,n),a.prototype.setCfg=function(t,i){this._cfg=t,this.category=i,this.name=this._cfg.name,a.MAIN_SCENE[this.name]=this,this._cfg.hasOwnProperty("redDot")&&""!=this._cfg.redDot&&(this._redDot=new e("ui/comp/redState.png"),this._cfg.hasOwnProperty("redX")?(this._redDot.x=this._cfg.redX,this._redDot.y=this._cfg.redY):(this._redDot.x=63,this._redDot.y=5),this._redDot.visible=!1,this.addChild(this._redDot),this._redStrArr=this._cfg.redDot.split("|"),a.RedDotMap.push(this)),this._cfg.hasOwnProperty("effect")&&""!=this._cfg.effect&&(this._effectStrArr=this._cfg.effect.split("|"),a.EffectMap.push(this))},a.prototype.addRedDotFlag=function(t){this._redStrArr||(this._redDot=new e("ui/comp/redState.png"),this._cfg.hasOwnProperty("redX")?(this._redDot.x=this._cfg.redX,this._redDot.y=this._cfg.redY):(this._redDot.x=63,this._redDot.y=5),this._redDot.visible=!1,this.addChild(this._redDot),this._redStrArr=[],a.RedDotMap.push(this)),this._redStrArr.push(t)},a.prototype.checkRedDot=function(t){for(var e=!1,i=0;i<this._redStrArr.length;i++){var s=t.getStatueFlagByName(this._redStrArr[i]);if(s>0){e=!0;break}}this.redFlag=e,this._redDot.visible=e&&!(this.childMenu&&this.childMenu.isShow)},a.prototype.checkEffect=function(e){if(void 0===e&&(e=null),this.off(Laya.Event.ADDED,this,this.checkEffect),this._effectStrArr&&0!=this._effectStrArr.length){e||(e=t.Facade.retrieveModel(t.ModelDef.ALL_STATUS_MODEL));for(var i=!1,s=0;s<this._effectStrArr.length;s++){var n=e.getStatueFlagByName(this._effectStrArr[s]);if(n>0){i=!0;break}}this.effectFlag=i,i&&(this.childMenu&&!this.childMenu.isShow||this.owner&&this.owner.hasOwnProperty("isShow")&&this.owner.isShow)?this.showEffect():this.cancelEffect()}},a.prototype.showRedDot=function(t){t?this._redDot||(this._redDot=new e("ui/comp/redState.png"),this._redDot.x=63,this._redDot.y=5,this._redDot.visible=!1,this.addChild(this._redDot),this._redDot.visible=!0):this._redDot&&(this._redDot.visible=!1)},a.prototype.isRedDotSHow=function(){return this._redDot.visible},a.prototype.isExist=function(){var e=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);if(0!=this._cfg.level&&e.level<this._cfg.level||!this.platVisible)return!1;if(this._cfg.hasOwnProperty("special")&&!this.checkSpecial(this._cfg.special))return!1;if(t.Global.WXAPP_SPECIAL_DEAL&&t.Global.isWXAPP&&Browser.onIOS&&this._cfg.hasOwnProperty("wxapp")&&0==this._cfg.wxapp)return!1;var i=t.ServerClock.getServerNowDate();if(this._cfg.hasOwnProperty("start")){var s=new Date(this._cfg.start);if(s>i)return!1}if(this._cfg.hasOwnProperty("end")){var s=new Date(this._cfg.end);if(i>s)return!1}return!0},a.prototype.checkSpecial=function(e){switch(e){case 1:var i=t.Facade.retrieveModel(t.ModelDef.ACT_MODEL);return i&&i.hasActivity(this._cfg.actId);case 2:var s=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);return 1!=s.wbShare&&t.Global.isWB||t.Global.isSQ;case 3:var s=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);return s.rebackEndtime>t.ServerClock.getServerTime()/1e3;case 4:var n=t.Facade.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);return 1!=n.getLongDataValue(t.ServerSetDataModel.KEY_NEED_TO_HIDE_INVITE);case 5:return!t.Global.isWXAPP||!Laya.Browser.onIOS;case 6:return!t.Global.isWXAPP;case 11:var s=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);return 0!=s.marryStatus;case 12:return!!(window.OPEN_DATA&&window.OPEN_DATA.qua&&"SQ"==window.OPEN_DATA.qua.app&&Browser.onAndriod);default:return!0}},a.prototype.onClick=function(){this._cfg&&(null!=this.childMenu?(t.Facade.callCommand(new t.HomeMenuCmd(this._cfg.name)),this.childMenu.changeState(),"xkxBtn"==this._cfg.name&&a.MAIN_SCENE.checkWeakTipsPos(),this._redDot&&(this._redDot.visible=this.redFlag&&!this.childMenu.isShow),this.effectFlag&&(this.childMenu.isShow?this.cancelEffect():this.showEffect())):1==this._cfg.op?t.Facade.callCommand(new t.HomeMenuCmd(this._cfg.name)):t.Facade.callStrCommand(this._cfg.cmd))},a.prototype.checkPos=function(){if(this._helpImg&&this.parent){var e=this.parent.localToGlobal(new Laya.Point(this.x+this.width/2,this.y+this.height/2));this._helpImg.x=e.x-t.LayerMgr.offX,this._helpImg.y=e.y-t.LayerMgr.offY}},a.prototype.showEffect=function(){if(!this.parent||!t.LayerMgr.getLayer(t.Layer.SCENE).parent)return this.on(Laya.Event.ADDED,this,this.checkEffect),void this.on(Laya.Event.DISPLAY,this,this.checkPos);this._helpImg||(this._helpImg=new e,this._helpImg.skin=this.skinUrl,this._helpImg.alpha=.5),this._helpImg.scale(1,1),this._helpImg.pivot(this.width/2,this.height/2);var i=this.parent.localToGlobal(new Laya.Point(this.x+this.width/2,this.y+this.height/2));this._helpImg.x=i.x-t.LayerMgr.offX,this._helpImg.y=i.y-t.LayerMgr.offY,a.MAIN_SCENE.btnEffectLayer.addChild(this._helpImg),this._tween1&&(this._tween1.clear(),this._tween1=null),this._tween2&&(this._tween2.clear(),this._tween2=null),this.effect1Duration()},a.prototype.effect1Duration=function(){this._tween1=i.to(this._helpImg,{scaleX:1.33,scaleY:1.33},1e3/30*8,s.linearNone,new Handler(this,this.effect2Duration))},a.prototype.effect2Duration=function(){this._tween2=i.to(this._helpImg,{scaleX:1,scaleY:1},1e3/30*16,s.linearNone,new Handler(this,this.effect1Duration))},a.prototype.cancelEffect=function(){this._tween1&&(this._tween1.clear(),this._tween1=null),this._tween2&&(this._tween2.clear(),this._tween2=null),this._helpImg&&(this._helpImg.destroy(),this._helpImg=null)},a.prototype.destroy=function(){this.off(Laya.Event.ADDED,this,this.checkEffect),this.off(Laya.Event.DISPLAY,this,this.checkPos),this._redDot&&(this._redDot.destroy(),this._redDot=null),n.prototype.destroy.call(this)},a.LEFT_MENU="left",a.RIGHT_MENU="right",a.TOP_MENU="top",a.BOTTOM_MENU="bottom",a.RedDotMap=new Array,a.EffectMap=[],a}(t.SBtn1);t.Icon=n}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.display.Sprite,i=laya.utils.Tween,s=laya.utils.Ease,n=function(e){function n(i){e.call(this),this.cfg=i,this.group=[];var s,n,o;for(s=0;s<this.cfg.btns.length;s++)if(o=this.cfg.btns[s],n=new t.Icon(o.skin),n.setCfg(o,t.Icon.LEFT_MENU),this.group.push(n),o.hasOwnProperty("childs")){var r=new a(o.childs);n.childMenu=r}this.arrange()}return __extends(n,e),n.prototype.arrange=function(){var t,e,i,s=0;for(t=0;t<this.group.length;t++)if(i=this.cfg.btns[t],e=this.group[t],e.isExist()){if(e.x=0,e.y=s,this.addChild(e),s+=i.height+this.cfg.spaceY,i.hasOwnProperty("childs")){var n=e.childMenu;n.y=e.y,n.x=e.x+e.width,this.addChildAt(n,0),n.arrange(),n.hide(0)}}else this.removeChild(e),e.childMenu&&e.childMenu.hide(0)},n.prototype.spread=function(){i.to(this,{x:this.cfg.x},500,s.expoOut)},n.prototype.hide=function(){for(var t,e=0;e<this.group.length;e++)t=this.group[e],t.childMenu&&t.childMenu.hide();i.to(this,{x:-85},500,s.expoOut)},n.prototype.hideAllSubMenu=function(){for(var t,e=0;e<this.group.length;e++)t=this.group[e],t.childMenu&&t.childMenu.hide()},n}(e);t.LeftMenu=n;var a=function(e){function i(i){e.call(this),this.isShow=!1,this.cfg=i,this.group=[];var s,n,a;for(s=0;s<this.cfg.btns.length;s++)a=this.cfg.btns[s],n=new t.Icon(a.skin),n.setCfg(a,t.Icon.RIGHT_MENU),n.owner=this,this.group.push(n);this.arrange()}return __extends(i,e),i.prototype.arrange=function(){var t,e,i,s=0;for(t=0;t<this.cfg.btns.length;t++)i=this.cfg.btns[t],e=this.group[t],e.isExist()?(e.left=s,this.addChild(e),s+=i.width+this.cfg.spaceX):this.removeChild(e)},i.prototype.changeState=function(){this.isShow?this.hide():this.spread(),this.checkIconEffect()},i.prototype.spread=function(e){void 0===e&&(e=300),t.Facade.callCommand(new t.HideAllSubMenu),this.visible=!0,this.mouseEnabled=!0,this.isShow=!0},i.prototype.checkIconEffect=function(){for(var t=0;t<this.group.length;t++)this.group[t].checkEffect()},i.prototype.hide=function(t){void 0===t&&(t=300),this.visible=!1,this.mouseEnabled=!0,this.isShow=!1},i}(e);t.LeftSubMenu=a}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.display.Sprite,i=laya.utils.Tween,s=laya.utils.Ease,n=function(e){function i(i){e.call(this),this.cfg=i,this.group=[];var s,n,o,r=0;for(s=0;s<i.btns.length;s++)if(o=i.btns[s],n=new t.Icon(o.skin),n.x=0,n.y=r,n.owner=this,n.setCfg(o,t.Icon.RIGHT_MENU),this.group.push(n),this.addChild(n),r+=o.height+i.spaceY,o.hasOwnProperty("childs")){var h=new a(o.childs);h.y=n.y,h.x=n.x-1,n.childMenu=h,this.addChildAt(h,0),h.hide(0)}this.x=this.cfg.x,this.y=this.cfg.y,this.arrange()}return __extends(i,e),i.prototype.arrange=function(){var t,e,i,s=0,n=0;for(t=0;t<this.group.length;t++)if(i=this.cfg.btns[t],e=this.group[t],e.isExist()){if(e.x=0,e.y=s,n++,this.addChild(e),s+=i.height+this.cfg.spaceY,i.hasOwnProperty("childs")){var a=e.childMenu;a.y=e.y,a.x=e.x-1-a.width,this.addChildAt(a,0),a.arrange(),a.hide(0)}}else this.removeChild(e),e.childMenu&&e.childMenu.hide(0);this.y=this.cfg.y+(this.cfg.height+this.cfg.spaceY)*(this.cfg.num-n)},i.prototype.spread=function(){this.visible=!0,this.isShow=!0,this.check(!0)},i.prototype.hide=function(){this.visible=!1,this.isShow=!1,this.check(!1)},i.prototype.check=function(t){for(var e,i=0;i<this.group.length;i++)e=this.group[i],t?e.childMenu&&e.childMenu.isShow?e.childMenu.checkIconEffect():e.checkEffect():e.childMenu&&e.childMenu.isShow?e.childMenu.checkIconEffect(!0):e.cancelEffect()},i.prototype.hideAllSubMenu=function(){for(var t,e=0;e<this.group.length;e++)t=this.group[e],t.childMenu&&t.childMenu.hideDirect()},i}(e);t.RightMenu=n;var a=function(n){function a(i){n.call(this),this.isShow=!1,this.cfg=i,this.group=[];var s=this.cfg.btns.length;this.w=s*this.cfg.width+(s-1)*this.cfg.spaceX,this.width=this.w,this.height=this.cfg.height,this.container=new e,this.container.width=this.w,this.container.height=this.cfg.height,this.addChild(this.container),this.scrollRect=new Laya.Rectangle(0,0,this.width,this.height),this.mouseThrough=!0;var a,o,r;for(a=0;a<this.cfg.btns.length;a++)r=this.cfg.btns[a],o=new t.Icon(r.skin),o.owner=this,o.setCfg(r,t.Icon.RIGHT_MENU),this.group.push(o);this.arrange()}return __extends(a,n),a.prototype.arrange=function(){var t,e,i,s=0;for(t=this.cfg.btns.length-1;t>=0;t--)i=this.cfg.btns[t],e=this.group[t],e.isExist()?(e.right=s,this.container.addChild(e),s+=i.width+this.cfg.spaceX):this.container.removeChild(e)},a.prototype.changeState=function(){this.isShow?this.hide():(this.arrange(),this.spread())},a.prototype.spread=function(e){void 0===e&&(e=300),t.Facade.callCommand(new t.HideAllSubMenu);t.Facade.retrieveModel(t.ModelDef.GUIDE_MODEL);this.container.x=this.w,this.container.visible=!0,i.to(this.container,{x:0},e,s.expoOut,new Handler(this,this.onShow)),this.visible=!0,this.mouseEnabled=!0,this.isShow=!0},a.prototype.onShow=function(){this.checkIconEffect()},a.prototype.hide=function(t){void 0===t&&(t=300),this.hideDirect()},a.prototype.hideDirect=function(){this.mouseEnabled=!1,this.isShow=!1,this.container.x=0,this.container.visible=!1,this.checkIconEffect()},a.prototype.checkIconEffect=function(t){void 0===t&&(t=!1);for(var e=0;e<this.group.length;e++)t?this.group[e].cancelEffect():this.group[e].checkEffect()},a.prototype.onHide=function(){this.container.visible=!1,this.container.x=0},a}(e);t.RightSubMenu=a}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.ui.Component,i=function(e){function i(i){e.call(this),this.topCfg=i,this.width=800,this.group1=[],this.group2=[];var s,n,a;i.x_1;for(s=0;s<i.group1.length;s++)a=i.group1[s],n=new t.Icon(a.skin),n.setCfg(a,t.Icon.TOP_MENU),this.group1.push(n);for(s=0;s<i.group2.length;s++)a=i.group2[s],n=new t.Icon(a.skin),n.setCfg(a,t.Icon.TOP_MENU),this.group2.push(n);this.arrange();var o=t.Facade.retrieveModel(t.ModelDef.ACT_MODEL);o.on(t.ModelEvent.UPDATE_FINISH,this,this.arrange)}return __extends(i,e),i.prototype.arrange=function(){var t,e,i,s=this.topCfg.x_1;for(t=this.group1.length-1;t>=0;t--)i=this.topCfg.group1[t],e=this.group1[t],e.isExist()?(e.right=s,e.y=this.topCfg.y_1,this.addChild(e),s+=i.width+this.topCfg.spaceX):this.removeChild(e);var s=this.topCfg.x_2;for(t=this.group2.length-1;t>=0;t--)i=this.topCfg.group2[t],e=this.group2[t],e.isExist()?(e.right=s,e.y=this.topCfg.y_2,this.addChild(e),s+=i.width+this.topCfg.spaceX):this.removeChild(e)},i}(e);t.TopMenu=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(s){e.call(this,new ui.common.ShowButtonOpenLevelUI,!1,!0),this.display=this.skin,this._cfg=s,this._sk=new t.AnimationSKe("assets/skeleton/levelup/tianshu2.sk",2),this._sk.play("tx_1",!0),this._sk.scale(.6,.6),this._sk.x=342,this._sk.y=255,this.display.noSkill.addChildAt(this._sk,0),i.count++,this.display.ruleText.text=this._cfg.rule,this.display.tipsText.text=this._cfg.tips,this.display.btn.skin=this._cfg.skin,this.display.star.x=(668-this.display.ruleText.textWidth)/2;var n=new Sprite;n.graphics.drawRect(0,0,t.LayerMgr.width,t.LayerMgr.clientHeight,"#000000"),n.size(t.LayerMgr.width,t.LayerMgr.clientHeight),n.y-=t.LayerMgr.offY,n.alpha=.6,n.mouseEnabled=!0,n.mouseThrough=!1,this.display.addChildAt(n,0),n.on(Laya.Event.CLICK,this,this.destroy)}return __extends(i,e),i.prototype.destroy=function(){this._sk&&(this._sk.removeSelf(),this._sk.destroy(),this._sk=null),i.count--,e.prototype.destroy.call(this)},i.count=0,i}(t.BaseBox);t.LevelIconOpenBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.ani.bone.Templet,i=function(i){function s(){i.call(this),this._hasShowTask=!1,this._hasShowWbGift=!1,this._hasShowRecall=!1,this._hasShowWb=!1,this._hasShowChristmas=!1,this._hasPop=!0}return __extends(s,i),s.prototype.initialize=function(e){t.DramaMgr.singleton.initialize(),t.configMgr().initialize(),t.Interactive.initialize(),this._hasPop=!0},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"HomeCommand":var i=t.SceneMgr.current&&t.SceneMgr.current.getSceneName()==t.SceneDef.MAIN_SCENE,n=this.retrieveModel(t.ModelDef.GUIDE_MODEL),a=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL),o=0;if(!this.mainScene){t.Logger.log("进入首屏成功。。。。。。"),t.JSUtils.isFromShare()&&(t.Global.isSQ?o=1056:t.Global.isWB&&(o=1057)),t.LayerMgr.removeChild(t.LayerMgr.getLayer(t.Layer.BEFORE_ENTER_GAME)),this._hasShowTask=!1,this.userModel=this.retrieveModel(t.ModelDef.SELF_USER_MODEL);var r=this.retrieveModel(t.ModelDef.ALL_STATUS_MODEL),h=this.retrieveModel(t.ModelDef.BUFF_MODEL),l=this.retrieveModel(t.ModelDef.PACK_MODEL);if(this.mainScene=new t.MainView(this.userModel,r,h,l),t.EventCenter.singleton.on(s.OPENBOXEVENT,this,this.checkOpenBox),n.isGuiding)n.hasGift&&t.Facade.callCommand(new t.OpenTaskCmd(1));else{var c=t.JSUtils.getShareParams(),d=c.command?c.command:t.JSUtils.getQueryString("command");d&&("1017"==d&&this.userModel.level<12||("1017"==d&&(d="1017|0"),t.facade().executeStrCommand(d)))}Laya.timer.once(500,this,this.homePreLoad),0!=o?this.playInviteDrama(o):this.checkToPlaySuiping()}i||this.mainScene.changeBackground(),t.SceneMgr.changeScene(this.mainScene),n.guidetaskID>=t.GuideModel.TASKID_END&&0==o&&this.checkOpenBox(),Laya.timer.loop(9e4,this,this.checkMailRedStatus),this.checkMailRedStatus(),e.ecode=0,e.finish(),1!=this.userModel.level||0!=a.getLongDataValue(t.ServerSetDataModel.KEY_REALNAME_TIPS)||t.Global.isWXAPP||(a.setLongDataValue(t.ServerSetDataModel.KEY_REALNAME_TIPS,1),t.ConfirmBox.show(new t.ConfirmBoxData({contentStr:"你已通过实名认证！",isShowCancelBtn:!1})));break;case"PlayDramaCmd":t.DramaMgr.singleton.executeCmd(e);break;case"HomeBubbleCmd":e.ecode=0,e.finish();break;case"RollRefreshCmd":this.mainScene.refreshRace(e.id);break;case"HomeMenuCmd":this.mainScene.menuOp(e);break;case"CheckMenuStatus":this.mainScene.makeMenuSpread(e.buttonName);break;case"HomeEffectActiveCmd":this.mainScene.showCdActiveEffect(e.id);break;case"HideAllSubMenu":this.mainScene.hideAllSubMenu()}},s.prototype.kkkk=function(){var e={changed:{attrs:[{id:"kCash",num:1001},{id:"kEnergy",num:1001}],items:[{id:200001,hours:3,name:"一二三四五六七"},{id:100008,num:2,name:"一二三四五六aa"},{id:100009,num:3,name:"一二三四五六"},{id:100010,num:4,name:"一二三四五"},{id:100011,num:5,name:"一二三四五刘"}]}};t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0,"BBBBBBBB"))},s.prototype.playInviteDrama=function(e){var i=new t.PlayDramaCmd(String(e));i.on(this,this.playInviteDramaFinish),t.Facade.callCommand(i)},s.prototype.playInviteDramaFinish=function(t){t.off(),this.checkToPlaySuiping()||this.checkOpenBox()},s.prototype.checkToPlaySuiping=function(){var e=this.retrieveModel(t.ModelDef.GUIDE_MODEL);if(241==e.guidetaskID&&!e.hasGift){var i=t.Facade.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);if(t.Global.isWX&&1!=i.getLongDataValue(t.ServerSetDataModel.KEY_HAS_SHOW_WEIXIN_COLLECT_GUIDE)||!t.Global.isWX&&1!=i.hasCollect)return this.playSuiping(),!0}return!1},s.prototype.playSuiping=function(){t.Global.isWXAPP||(this._suipingTem=new e,this._suipingTem.once(Laya.Event.COMPLETE,this,this.onLoadSuiping),this._suipingTem.loadAni(t.ResPath().getEffect("suiping")))},s.prototype.onLoadSuiping=function(){var e=(t.LayerMgr.height+2*t.LayerMgr.offY)/t.LayerMgr.height;1>e&&(e=1),this._maskSp=new Sprite,this._maskSp.width=1334,this._maskSp.height=750,this._maskSp.x=0,this._maskSp.y=0,this._maskSp.mouseEnabled=!0,this._suipingSke=this._suipingTem.buildArmature(0),this._suipingSke.play(0,!1),this._suipingSke.scale(1.4*e,1.4*e),this._suipingSke.x=667,this._suipingSke.y=375,this._suipingSke.once(Laya.Event.STOPPED,this,this.onSuipingStop),t.LayerMgr.parent.addChild(this._suipingSke),t.LayerMgr.parent.addChild(this._maskSp)},s.prototype.onSuipingStop=function(){this._suipingSke.visible=!1,this._suipingSke.parent.removeChild(this._suipingSke),Laya.timer.frameOnce(1,this,this.delayClear,[this._suipingSke,this._suipingTem]),this._suipingSke=null,this._suipingTem=null,this._maskSp.parent.removeChild(this._maskSp),this._maskSp=null},s.prototype.delayClear=function(e,i){e.destroy(),i.destroy(),Laya.loader.clearRes(t.ResPath().getEffect("suiping").replace(".sk",".png")),Laya.loader.clearRes(t.ResPath().getEffect("suiping"))},s.prototype.checkOpenBox=function(){if((null==t.SceneMgr.current||t.SceneMgr.current.getSceneName()==t.SceneDef.MAIN_SCENE)&&0==t.LayerMgr.getLayer(t.Layer.GUIDE).numChildren){this._popdata={url:"ui/act/poplogin.jpg",width:667,height:375,target:"hf.SignCommand|0"};var e=this.retrieveModel(t.ModelDef.SELF_USER_MODEL);if(e.level>=5){var i=this.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL),n=!1,a=window.__last_version,o=t.ServerClock.getServerNowDate().getDay();if(a){var r=a.replace("/r",""),h=t.JSUtils.getCookie("vesion");t.Logger.log("当前版本号："+r+"  cookie版本号："+h),n=h!=r}if(n)t.JSUtils.setCookie("vesion",r),t.Facade.callCommand(new t.OpenNoticeCommand(""));else if(!this._hasShowRecall&&e.rebackEndtime>t.ServerClock.getServerTime()/1e3&&e.firstLogin)this._hasShowRecall=!0,t.Facade.callCommand(new t.RecallCommand);else if(this._hasShowWbGift||null==t.JSUtils.getQueryString("GIFT"))if(e.level>=5&&!t.ActCenter.hasShowActCenter&&e.firstLogin)t.Facade.callCommand(new t.ActCenterCMD);else if(0==this.retrieveModel(t.ModelDef.SELF_USER_MODEL).todayHasSign&&0==t.Sign.hasDoSign)t.Facade.callCommand(new t.SignCommand(4));else if(!this._hasShowTask&&e.firstLogin)this._hasShowTask=!0,t.Facade.callCommand(new t.OpenTaskCmd);else if(1==this.userModel.loginDays&&this._hasPop)this._hasPop=!1,t.Facade.callCommand(new t.ShowPopBoxCMD(this._popdata,this._popdata.target));else if(this.userModel.loginDays<8&&this.userModel.firstLogin&&this._hasPop)this._hasPop=!1,t.Facade.callCommand(new t.ShowPopBoxCMD(this._popdata,this._popdata.target));else if(t.Global.isWB&&!this._hasShowWb&&e.createTime>15059448e5){if(this._hasShowWb=!0,i.severDataHasLoaded&&0==i.getLongDataValue(t.ServerSetDataModel.KEY_HAS_GOT_WB_GIFT)){var l=new t.WbGiftBox;l.show()}}else if(!t.Global.isWXAPP||1==i.getDailyDataValue(t.ServerSetDataModel.KEY_WB_WEEKEND_GIFT)||0!=o&&6!=o)t.EventCenter.singleton.off(s.OPENBOXEVENT,this,this.checkOpenBox);else{var c=t.Facade.retrieveModel(t.ModelDef.ACT_MODEL);if(c&&c.hasActivity(49)){var d={url:"ui/act/hongbao.png",width:672,height:423,target:"hf.WBWeekendCmd|49"};t.Facade.callCommand(new t.ShowPopBoxCMD(d,d.target))}i.setDailyDataValue(t.ServerSetDataModel.KEY_WB_WEEKEND_GIFT,1)}else this._hasShowWbGift=!0,t.Facade.callCommand(new t.WBGiftCmd(Number(t.JSUtils.getQueryString("GIFT"))))}}},s.prototype.homePreLoad=function(){},s.prototype.checkMailRedStatus=function(){t.XHR().Post({file:"petpk",cmd:"reddot",subcmd:"Get",uid:t.Global.UID},this,this.getAllStatusHandler)},s.prototype.getAllStatusHandler=function(e){if(0==e.result&&e.hasOwnProperty("rodinfo2"))for(var i=0;i<e.rodinfo2.length;i++){var s=e.rodinfo2[i],n=this.retrieveModel(t.ModelDef.ALL_STATUS_MODEL);n.setStatueFlagByName(s.name,s.flag);
break}},s.prototype.getPluginName=function(){return t.PluginDef.PLUGIN_HOME},s.OPENBOXEVENT="OPENBOXEVENT",s}(t.Plugin);t.MainModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.utils.Tween,i=laya.utils.Ease,s=Laya.Event,n=laya.maths.Point,a=laya.ui.Image,o=function(o){function r(e,i,a,h){o.call(this,new ui.MainUI),this.m_menuOpen1=!0,this.m_djPath="assets/skeleton/home/skeleton.sk",this.msgid=0,this.isFirst=!0,this.isPlayingRace=!1,this.raceTime=0,this.RACE_INTERVAL=120,this.strMsg="",this.BASIC_ACTION_COUNT=11,this._isOperateShow=!1,this._postfixArr=["a","b","c","d","e","f"],this._LIMIT=3,this.hasLoadBubble=!1,this.isPlayingNpc=!1,this.LEFT_COUNT=3,this._clickStr="",this.PAO_ANI_COUNT=6,this.weakPos1=new n(818,597),this.weakPos2=new n(818,493),this._minBuffTime=0,this._curServerTime=0,this._display=this.skin,this._display.cacheLayer.cacheAs="bitmap",this._hb=new t.HomeBack(this._display.effectLayer0,this._display.effectLayer),this._display.addChildAt(this._hb,0),this._display.progressBar.scrollRect=new Laya.Rectangle(0,0,347,19),this.m_djSk=new t.AnimationSKe(this.m_djPath),this._display.aniLayer.addChild(this.m_djSk),this.m_djSk.x=372,this.m_djSk.y=46,this.m_djSk.play(0,!0),this._display.weaponChipPng.alpha=0,this._display.weaponChipPng.on(Laya.Event.CLICK,this,this.weaponChipPngClickHandler),Laya.stage.on(Laya.Event.RESIZE,this,this.setOffY),t.Icon.MAIN_SCENE=this,this._friendBtn=new t.Icon("ui/main/sbtn1_friend.png"),this._friendBtn.x=1216,this._friendBtn.y=638,this._display.btnLayer.addChild(this._friendBtn),this._friendBtn.on(s.CLICK,this,this.onClickFriend),t.Icon.MAIN_SCENE.friendBtn=this._friendBtn,t.Icon.EffectMap.push(this._friendBtn),this.initIcon(),this.setOffY(),this._um=e,this._am=i;var l=t.Facade.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);this._am.setStatueFlagByName(t.AllStatusModel.DINGYUE,0==l.getLongDataValue(t.ServerSetDataModel.KEY_DINGYUE)?1:0),this.checkRedot(),this.checkChampionRedot(),this._am.on(t.ModelEvent.UPDATE_FINISH,this,this.allStatusModelUpdate),this._shareWB=this._um.wbShare,this._um.on(t.ModelEvent.UPDATE_FINISH,this,this.userModelUpdate),this._level=this._um.level,this.userModelUpdate(),this._pm=h,this._pm.on(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdate),this.packModelUpdate(),this.allStatusModelUpdate(),this._iconLevelCfg=Laya.loader.getRes("config/ipl.json"),this.checkIconLevelLimit(),this._actModel=t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL),this._actModel.on(t.ModelEvent.UPDATE_FINISH,this,this.actModelUpdate),this.actModelUpdate(),this._buffModel=a,this._buffModel.on(t.ModelEvent.UPDATE_FINISH,this,this.updateBuff),this._display.buffLayer.on(Laya.Event.CLICK,this,this.onClickBuff),this.updateBuff(),this._display.playerInfo.photo.on(s.CLICK,this,this.onClickSelfInfo),this._display.strengBox.on(s.CLICK,this,this.onClickStreng),this._display.on(Laya.Event.CLICK,this,this.clickHandler),t.dispatch(r.MAIN_VIEW_SOUND),this._display.pao_0.mouseEnabled=!0,this._display.pao_1.mouseEnabled=!0,this._display.pao_2.mouseEnabled=!0,this._display.dialog.visible=!1,this._display.paoBox.visible=!1,this.loadQQ(),"333"==t.JSUtils.getQueryString("from")||t.Global.isWXAPP||this.communityBoxInit(),this._display.rightMenuRedDot.visible=!1,this._display.showRightMenu.visible=!1,this._display.hideRightMenu.visible=!0,this._display.showRightMenu.on(laya.events.Event.CLICK,this,this.showRightMenu),this._display.hideRightMenu.on(Laya.Event.CLICK,this,this.hideRightMenu),this._display.showLeftMenu.on(laya.events.Event.CLICK,this,this.showLeftMenu),this._display.hideLeftMenu.on(Laya.Event.CLICK,this,this.hideLeftMenu),this._display.btnMenu1.on(Laya.Event.CLICK,this,this.changeMenu1State),this._display.tfRace.style.fontFamily="黑体",this._display.tfRace.scrollRect=new Laya.Rectangle(0,0,563,28),this._display.tfRace.style.fontSize=24,this._display.tfRace.style.wordWrap=!1,this._display.tfRace.style.color="#fff836",this._display.tfRace.style.stroke=2,this._display.tfRace.style.valign="top",t.JSUtils.isFromShare()&&(t.Global.isSQ?this._display.jiaoBiaoPng.skin="ui/main/jiaoBiao_shouQ.jpg":t.Global.isWB&&(this._display.jiaoBiaoPng.skin="ui/main/jiaoBiao_wanba.jpg")),this.hideRaceComp(),this._display.roleBox.size(200,180),this._display.unlockBtn.on(Laya.Event.CLICK,this,this.onShowLevelIconTip),this.checkWeakTips(),this._display.levelGiftBtn.on(Laya.Event.CLICK,this,this.openLevelGift),this._display.loginGiftBtn.on(Laya.Event.CLICK,this,this.openLoginGift),this._display.pleasantBtn.on(Laya.Event.CLICK,this,this.onPleasnatBtn),t.EventCenter.singleton.on("Recharge_succ",this,this.hideRecharge),this.updateChristmas(),this.hideLeftMenu()}return __extends(r,o),r.prototype.hideRecharge=function(){Laya.timer.clear(this,this.cutDown),this._display.pleasantBtn.visible=!1},r.prototype.onPleasnatBtn=function(){t.Facade.callCommand(new t.OpenRechargeCmd)},r.prototype.changeBackground=function(){this._hb.change()},r.prototype.setOffY=function(){var e=t.LayerMgr.offY-this._hasOffY;this._hasOffY=t.LayerMgr.offY;var i=(t.LayerMgr.height+2*t.LayerMgr.offY)/t.LayerMgr.height;1>i&&(i=1),this._hb.scaleX=this._hb.scaleY=i,this._hb.x=-(t.LayerMgr.width*(i-1))/2,this._hb.y-=e,this._display.effectLayer.scaleX=this._display.effectLayer.scaleY=i,this._display.effectLayer.x=-(t.LayerMgr.width*(i-1))/2,this._display.effectLayer.y-=e,this._display.aniLayer.y-=e,this._display.infoBox.y-=e,this._display.raceComp.y-=e,this._topMenu.y-=e,this._display.weaponChipPng.y-=e,this._display.pleasantBtn.y-=e,this._display.showRightMenu.y+=e,this._display.hideRightMenu.y+=e,this._rightMenu.y+=e,this._display.btnMenu1.y+=e,this._friendBtn.y+=e,this._bottomMenu.y+=e,this._display.leftdownComp.y+=e,this._display.rect1.y+=e,this._display.rect2.y+=e,this._display.rect3.y+=e,this.checkWeakTipsPos(),Laya.timer.frameOnce(1,this,this.checkPos),Laya.timer.frameOnce(5,this,this.calcElemPosMap),console.log(this._display.width+"-----宽高------"+this._display.height+"----------offy:---"+t.LayerMgr.offY)},r.prototype.checkPos=function(){for(var e=0;e<t.Icon.EffectMap.length;e++)t.Icon.EffectMap[e].checkPos()},r.prototype.initIcon=function(){var e=Laya.loader.getRes("config/icon.json");this._iconCfg=e;var i=e.topMenu,s=e.leftMenu,n=e.bottomMenu,a=e.rightMenu;if(("333"==t.JSUtils.getQueryString("from")||t.Global.isWXAPP)&&(t.Global.isWXAPP?s.btns.splice(1,1):s.btns.splice(1,2)),this._topMenu=new t.TopMenu(i),this._topMenu.right=i.right,this._topMenu.y=i.y,(t.Global.isWX||t.Global.isWXAPP)&&(this._topMenu.right=t.Global.FLOAT_ICON_OFFSET),this._display.btnLayer.addChild(this._topMenu),this._bottomMenu=new t.BottomMenu(n),this._bottomMenu.x=n.x-this._bottomMenu.width,this._bottomMenu.y=n.y-200,this._display.btnLayer.addChild(this._bottomMenu),this._rightMenu=new t.RightMenu(a),this._display.btnLayer.addChild(this._rightMenu),this._leftMenu=new t.LeftMenu(s),this._leftMenu.x=s.x,this._leftMenu.y=s.y,this._display.btnLayer.addChild(this._leftMenu),this.showLeftMenu(),t.Global.isSQ&&window.mqq&&mqq.compare&&mqq.compare("7.1.5")>=0&&Browser.onIOS){var o=t.Icon.MAIN_SCENE.quitBtn;o.skin="ui/main/sbtn1_hidden.png"}},r.prototype.openLevelGift=function(){t.Facade.callCommand(new t.SignCommand(1))},r.prototype.openLoginGift=function(){t.Facade.callCommand(new t.SignCommand(0))},r.prototype.hideAllSubMenu=function(){this._bottomMenu.hideAllSubMenu(),this._rightMenu.hideAllSubMenu(),this._leftMenu.hideAllSubMenu()},r.prototype.checkIconLevelLimit=function(){this._currIconLevel=null;for(var t,e=0;e<this._iconLevelCfg.items.length;e++)if(t=this._iconLevelCfg.items[e],this._um.level<t.level){this._currIconLevel=t;break}this._currIconLevel?(this._display.upLevelTips.visible=!0,this._display.levelText.text=this._currIconLevel.tips,this._display.unlockBtn.skin=this._currIconLevel.skin):this._display.upLevelTips.visible=!1},r.prototype.onShowLevelIconTip=function(){new t.LevelIconOpenBox(this._currIconLevel).show()},r.prototype.weaponChipPngClickHandler=function(){this.m_djSk.visible&&t.Facade.callCommand(new t.OpenTaskCmd(2))},r.prototype.menuOp=function(e){switch(e.cmd){case"giftBtn":var i=4,s=this._am.getStatueFlagByName(t.AllStatusModel.LV_GIFT_STATE);if(1==s)i=1;else{var n=this._am.getStatueFlagByName(t.AllStatusModel.LOGIN_GIFT_STATE);1==n&&(i=0)}t.Facade.callCommand(new t.SignCommand(i));break;case"addFriendBtn":t.Facade.callCommand(new t.InviteFriendCommand),this.addFriendBtn.isRedDotSHow&&this._am.setStatueFlagByName(t.AllStatusModel.INVITE_STATE,1);break;case"qyhBtn":t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.QYHBTN_CLICK));break;case"xkxBtn":t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.XKXBTN_CLICK));break;case"shejiaoBtn":t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.SHEJIAOBTN_CLICK));break;case"upLevelBtn":t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.CLICK_UPLEVEL_BTN));break;case"userBtn":t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.CLICK_USER_BTN));break;case"shoujiBtn":t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.CLICK_SHOUJI_BTN));break;case"collectBtn":t.Global.isWX||t.Global.isWXAPP?t.Facade.callCommand(new t.WeixinCollectCommand):t.Facade.callCommand(new t.CollectCommand);break;case"gameGroupBtn":wegame.invokeJsapi("openUrlWithExtraWebview",{url:"https://game.weixin.qq.com/cgi-bin/h5/static/community/club_index.html?appid=wxa45f40f2c4d1cfa9#wechat_redirect",openType:"1"},function(t){-1===t.err_msg.indexOf(":ok")&&(window.location.href="https://game.weixin.qq.com/cgi-bin/h5/static/community/club_index.html?appid=wxa45f40f2c4d1cfa9#wechat_redirect")});break;case"publicBtn":window.mqq?mqq.invoke("ui","openUrl",{url:"https://share.mp.qq.com/cgi/share.php?uin=2253115034&account_flag=33626388&jumptype=1&card_type=public_account",target:1,style:1}):t.WeakTips.show("该功能目前暂未开放");break;case"bbsBtn":t.JSUtils.openBBS();break;case"buluoBtn":t.JSUtils.openQQBuluo();break;case"subscriptionBtn":if(t.Facade.callCommand(new t.SubscriptionCommand),1==this._am.getStatueFlagByName(t.AllStatusModel.DINGYUE)){this._am.setStatueFlagByName(t.AllStatusModel.DINGYUE,0);var a=t.Facade.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);a.setLongDataValue(t.ServerSetDataModel.KEY_DINGYUE,1)}break;case"testGroupBtn":window.mqq?mqq.invoke("ui","openUrl",{url:"https://youxi.vip.qq.com/m/act/ec7a0095f7_qmdld_147675.html?_wv=1025",target:1,style:1}):wegame.invokeJsapi("openUrlWithExtraWebview",{url:"https://game.weixin.qq.com/cgi-bin/h5/static/group/index.html?appid=wx1fc34edbe7d4c25c#wechat_redirect",openType:"1"},function(t){-1===t.err_msg.indexOf(":ok")&&(window.location.href="https://game.weixin.qq.com/cgi-bin/h5/static/group/index.html?appid=wx1fc34edbe7d4c25c#wechat_redirect")});break;case"quitBtn":this.quitBtnClick();break;case"opinionBtn":t.H5SDK.openWindow("https://agame.qq.com/bbs_joy/topic.shtml?tid=6855687919010240&frompcbbs=1&page_no=1&rank_way=1&look_lz=0&tpl=0");break;case"questionBtn":t.H5SDK.openWindow("https://ue.qq.com/mur/?a=survey&b=15671&c=2&d=43e20f379285e877865efc231ffddd76");break;case"shareBtn":t.Global.isWB?t.Facade.callCommand(new t.ShareWBCommand):t.Facade.callCommand(new t.ShareSQCommand);break;case"copyBtn":var o=new t.LilianCmd;o.sceneId=0==t.Global.lilianMode?0:1e4,t.Facade.callCommand(o);break;case"hangupBtn":0!=this._um.marryStatus?t.Facade.callCommand(new t.HangupCmd):t.WeakTips.show("当前未结婚");break;case"qbBtn":t.JSUtils.openUrlBox("https://act.qzone.qq.com/vip/meteor/m/p/2292")}},r.prototype.quitBtnClick=function(){if(t.Global.isSQ&&window.mqq&&mqq.compare&&mqq.compare("7.1.5")>=0&&Browser.onIOS)mqq.invoke("ui","switchToMsgList",{title:"全民大乐斗",icon:"http://res.ledou.qq.com/share_icon.png",callback:mqq.callback(function(){})});else{var e=new t.ConfirmBoxData({isShowCancelBtn:!0,contentStr:"是否退出游戏？",callBackHandler:new Handler(this,this.quitGame)});t.ConfirmBox.show(e)}},r.prototype.quitGame=function(){t.JSUtils.closeWebView()},r.prototype.calcElemPosMap=function(){t.Global.elemPosMap.set("kVit",this.getElementPoint(this._display.tfVit)),t.Global.elemPosMap.set("KDouBi",this.getElementPoint(this._display.tfMoney)),t.Global.elemPosMap.set("kDouYu",this.getElementPoint(this._display.tfDouyu)),t.Global.elemPosMap.set("kExp",this.getElementPoint(this._display.tfExp)),t.Global.elemPosMap.set("ws",this.getElementPoint(t.Icon.MAIN_SCENE.userBtn)),t.Global.elemPosMap.set("kPrestige",this.getElementPoint(t.Icon.MAIN_SCENE.userBtn)),t.Global.elemPosMap.set("prop",this.getElementPoint(t.Icon.MAIN_SCENE.bagBtn))},r.prototype.getElementPoint=function(e){var i=e.width/2-e.pivotX,s=e.height/2-e.pivotY-t.LayerMgr.offY;return e.localToGlobal(new n(i,s))},r.prototype.showCdActiveEffect=function(e){this._cdId=e,Laya.loader.load(t.Global.ResPath+"scene/word/"+e+".png",new Handler(this,this.onLoadCdImg))},r.prototype.onLoadCdImg=function(){this._cdWordTexture=Laya.loader.getRes(t.Global.ResPath+"scene/word/"+this._cdId+".png"),this._cdHelpImg=new a,this._cdHelpImg.texture=this._cdWordTexture,this._cdHelpImg.x=-500,this._cdHelpImg.y=-500,this._display.addChild(this._cdHelpImg),Laya.timer.frameOnce(2,this,this.playCd)},r.prototype.playCd=function(){this._cdHelpImg&&(this._cdHelpImg.destroy(),this._cdHelpImg=null),this._display.mouseEnabled=!0,this._qqAni.off(Laya.Event.STOPPED,this,this.playCd),this._cdSk=new t.AnimationSKe(t.Global.ResPath+"effect/firework_cast.sk",2),this._cdSk.x=650,this._cdSk.y=700,this._cdSk.setSlotSkin("fw_sjsdld",this._cdWordTexture),this._display.effectLayer.addChild(this._cdSk),this._cdSk.on(Laya.Event.STOPPED,this,this.onActiveEffectEnd),this._cdSk.play(0,!1)},r.prototype.onActiveEffectEnd=function(){this._cdSk&&(this._cdSk.off(Laya.Event.STOPPED,this,this.onActiveEffectEnd),this._cdSk.removeSelf(),this._cdSk.destroy(),this._cdSk=null),this._display.roleBox.mouseEnabled=!0,this._qqAni.on(Laya.Event.STOPPED,this,this.onNormalEnd),this._qqAni.play(0,!0)},r.prototype.refreshRace=function(t){this.msgid=t,this.requestRace()},r.prototype.hideRaceComp=function(){Laya.timer.clear(this,this.startRaceRun),this._display.raceComp.visible=!1,this.isPlayingRace=!1},r.prototype.nextRace=function(){this.raceTime=this.RACE_INTERVAL,this.isPlayingRace||this.requestRace()},r.prototype.requestRace=function(){Laya.timer.once(6e4,this,this.nextRace),this.raceTime=0,t.XHR().Post({file:"petpk",cmd:"rollmsg",msgid:this.msgid,uid:t.Global.UID},this,function(e){0==e.result&&(this.msgid=e.next_msgid,t.Util.DecodeJSONProperty("msg",e),this.playRaceArray(e.msginfo))},!1)},r.prototype.playRaceArray=function(e){if(this.isFirst&&(this.isFirst=!1,this.chrismasArr=[],e.unshift({type:1,msg:"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;欢迎来到"+t.Global.GameName+"！"})),e&&e.length>0){this.isPlayingRace||(this.strMsg="");for(var i,s,n=0;n<e.length;n++)i=e[n],s=e[n].msg,-1!=s.indexOf("【")&&(Number(i.uid)==Number(t.Global.UID)?(s=s.replace("【","<font color='#ff3fc7'>【"),s=s.replace("】","】</font>")):(s=s.replace("【","<font color='#36ff00'>【"),s=s.replace("】","】</font>"))),-1!=s.indexOf("圣诞特级")&&(""==this.strMsg?this.chrismasArr.push(0):(this._display.tfRace.innerHTML=this.strMsg,this.chrismasArr.push(this._display.tfRace.contextWidth))),this.strMsg+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;",this.strMsg+=s;this.playRace(this.strMsg)}},r.prototype.playRace=function(t){return 1==this.isPlayingRace?(this._display.tfRace.innerHTML=t,void(this._display.tfRace.width=this._display.tfRace.contextWidth)):(this.isPlayingRace=!0,this._display.raceComp.visible=!0,this._display.tfRace.innerHTML=t,this._display.tfRace.width=this._display.tfRace.contextWidth,this._display.tfRace.scrollRect.x=0,void Laya.timer.frameLoop(1,this,this.startRaceRun))},r.prototype.startRaceRun=function(){this._display.tfRace.scrollRect.x+=2,this.checkChristmasPlay(),this._display.tfRace.width-this._display.tfRace.scrollRect.x<0&&(this.hideRaceComp(),this.raceTime==this.RACE_INTERVAL&&this.requestRace())},r.prototype.checkChristmasPlay=function(){this.chrismasArr.length>0&&this._display.tfRace.scrollRect.x<=this.chrismasArr[0]&&this._display.tfRace.scrollRect.x+2>this.chrismasArr[0]&&(this._christmasSk||(this._christmasSk=new t.AnimationSKe(t.ResPath().getEffect("xiaxue")),this._christmasSk.x=667,this._christmasSk.y=375,this._christmasSk.on(Laya.Event.STOPPED,this,this.onChristAniStop)),this._display.effectLayer.addChild(this._christmasSk),this._christmasSk.play(0,!1),this.chrismasArr.shift())},r.prototype.onChristAniStop=function(){this._display.effectLayer.removeChild(this._christmasSk)},r.prototype.actModelUpdate=function(){this._actModel.hasTips&&this._um.level>=17?(this._display.tipsBox.visible=!0,this.actTips(),this.showTipsText()):(this._display.tipsBox.visible=!1,Laya.timer.clear(this,this.actTips));var e=this._actModel.GetActById(41);t.Icon.MAIN_SCENE.nationalBtn&&t.Icon.MAIN_SCENE.nationalBtn.showRedDot(e&&1==e.reddot);var i=this._actModel.GetActByFrontId(49);t.Icon.MAIN_SCENE.wbgift&&(i&&49==i.frontid?t.Icon.MAIN_SCENE.wbgift.showRedDot(i&&1==i.reddot):t.Icon.MAIN_SCENE.wbgift.platVisible=!1)},r.prototype.hideActtips=function(){Laya.timer.clear(this,this.actTips),this._tipstimeline.offAll(),this._actModel.removeShowTips()},r.prototype.openAct=function(){var e=new t.ActCenterCMD(this._actModel.showTips.fontid);t.Facade.callCommand(e),this.hideActtips()},r.prototype.actTips=function(){this._tipstimeline||(this._tipstimeline=new Laya.TimeLine),this._tipstimeline.addLabel("blink",0).to(this._display.tipsIcon,{alpha:.7},400),this._tipstimeline.play(0,!0),this._display.tipsClose.on(Laya.Event.CLICK,this,this.hideActtips),this._display.tipsBg.on(Laya.Event.CLICK,this,this.openAct)},r.prototype.showTipsText=function(){Laya.timer.clear(this,this.actTips),Laya.timer.loop(1e3,this,this.actTips),this._display.tipsText.text=this._actModel.showTips.tips},r.prototype.allStatusModelUpdate=function(){for(var e=this._iconCfg.leftMenu.redDot.split("|"),i=!1,s=0;s<e.length;s++){var n=this._am.getStatueFlagByName(e[s]);if(1==n){i=!0;break}}this._display.leftMenuRedDot.visible=i;for(var s=0;s<t.Icon.RedDotMap.length;s++)t.Icon.RedDotMap[s].checkRedDot(this._am);for(var s=0;s<t.Icon.EffectMap.length;s++)t.Icon.EffectMap[s].checkEffect(this._am);this.addFriendBtn.showRedDot(this._um.firstLogin&&1!=this._am.getStatueFlagByName(t.AllStatusModel.INVITE_STATE));for(var a=[t.AllStatusModel.FIGHTING_CHANNEL,t.AllStatusModel.FIGHTING_FACTION,t.AllStatusModel.FIGHTING_GEM,t.AllStatusModel.FIGHTING_CHAIN,t.AllStatusModel.FIGHTING_UPGRADE],o=!1,s=0;s<a.length;s++)if(this._am.getStatueFlagByName(a[s])>0){o=!0;break}this._display.fightingRedDot.visible=o;var r=this._am.getStatueFlagByName(t.AllStatusModel.LV_GIFT_STATE);this._display.levelGiftRedDot.visible=1==r,this._display.levelGiftBtn.visible=1==r||this._um.level<40,1==r?(this._quanSke1||(this._quanSke1=new t.AnimationSKe(t.ResPath().getEffect("quanquan"))),this._display.levelGiftBtn.addChild(this._quanSke1),this._quanSke1.x=50,this._quanSke1.y=43,this._quanSke1.play(0,!0)):this._quanSke1&&(this._quanSke1.stop(),this._quanSke1.removeSelf()),Laya.timer.clear(this,this.loginCutDown);var h=this._am.getStatueFlagByName(t.AllStatusModel.LOGIN_GIFT_STATE);if(this._display.loginGiftRedDot.visible=1==h,this._display.loginGiftBtn.visible=1==h||this._um.loginDays<14,this._display.loginGiftBtn.x=this._display.levelGiftBtn.visible?274:155,this._display.loginGiftCutDownTxt.x=this._display.levelGiftBtn.visible?242:123,1==h)this._quanSke2||(this._quanSke2=new t.AnimationSKe(t.ResPath().getEffect("quanquan"))),this._quanSke2.x=50,this._quanSke2.y=43,this._display.loginGiftBtn.addChild(this._quanSke2),this._quanSke2.play(0,!0),this._display.loginGiftCutDownTxt.text="";else if(this._quanSke2&&(this._quanSke2.stop(),this._quanSke2.removeSelf()),this._um.loginDays<14){var l=t.ServerClock.getServerNowDate().getHours();5==l?(this._minute=60-t.ServerClock.getServerNowDate().getMinutes(),this._display.loginGiftCutDownTxt.text=this._minute+"分钟后可领",Laya.timer.loop(6e4,this,this.loginCutDown)):(l=6>l?6-l:24-l+6,this._display.loginGiftCutDownTxt.text=l+"小时后可领")}else this._display.loginGiftCutDownTxt.text="";this.setChipVisible()},r.prototype.loginCutDown=function(){this._minute--,this._minute<0?(this._display.loginGiftCutDownTxt.text="",Laya.timer.clear(this,this.loginCutDown)):this._display.loginGiftCutDownTxt.text="剩余"+this._minute+"分钟"},r.prototype.setChipVisible=function(){this.m_djSk.visible=this._um.level>=5&&this._um.level<=15},r.prototype.onShowed=function(){this._isOperateShow=!1,this._display.paoBox.visible=!1,t.addListener(t.ViewEvent.BOX_SHOW,this,this.onBoxShowHide,[!0]),t.addListener(t.ViewEvent.BOX_HIDE,this,this.onBoxShowHide,[!1]),this._display.aniLayer.visible=!0,this._display.aniLayer2.visible=!0,this._display.roleBox.mouseEnabled=!0,this._display.rect1.alpha=this._display.rect2.alpha=this._display.rect3.alpha=0;var e=this._display.rect1.localToGlobal(new laya.maths.Point(0,0));this._rectX1=e.x,this._rectY1=e.y,e=this._display.rect2.localToGlobal(new laya.maths.Point(0,0)),this._rectX2=e.x,this._rectY2=e.y,e=this._display.rect3.localToGlobal(new laya.maths.Point(0,0)),this._rectX3=e.x,this._rectY3=e.y,Laya.stage.on(Laya.Event.CLICK,this,this.backGroundClick),Laya.timer.once(1e3,this,this.requestRace)},r.prototype.loadQQ=function(){this._qqAni=new t.AnimationSKe(t.ResPath().getAnimPath("xianxiagg",t.ResourcePath.PATH_NPC)+".sk",1),this._qqAni.showSkinByName(this._um.isBoy?"male":"female"),this._qqAni.x=100,this._qqAni.y=150,this._qqAni.size(200,200),this._qqAni.mouseEnabled=!1,this._display.roleBox.addChild(this._qqAni),t.dispatch(t.CommonEvent.XIANXIA_Load_OVER),0==this._um.marryStatus&&0!=this._um.marryPropose?(this._qqAni.showSkinByName("male"),this.marryRepeat=0,this._qqAni.play(this._um.isBoy?"xpropose1":"xpropose2",!1),this._qqAni.on(Laya.Event.STOPPED,this,this.circleAni),Laya.timer.once(2e3,this,this.showDialog),this._display.tfWords.text="点我查看新的告白信！",this._display.dialog.mouseEnabled=!0,this._display.dialog.on(Laya.Event.CLICK,this,this.openMarry),this._display.roleBox.on(Laya.Event.CLICK,this,this.openMarry)):this.startQQAni()},r.prototype.circleAni=function(){this.marryRepeat++;var t=this.marryRepeat%3==0?0:61;this._qqAni.play(this._um.isBoy?"xpropose1":"xpropose2",!1,!0,1e3*t/30)},r.prototype.showDialog=function(){this._display.dialog.visible=!0},r.prototype.openMarry=function(){this._display.dialog.mouseEnabled=!1,this._display.dialog.off(Laya.Event.CLICK,this,this.openMarry),this._qqAni.off(Laya.Event.STOPPED,this,this.circleAni),this._display.roleBox.off(Laya.Event.CLICK,this,this.openMarry),this._display.dialog.visible=!1,Laya.timer.clear(this,this.showDialog),this.startQQAni(),t.Facade.callCommand(new t.OpenMarryBoxCommand(t.MarryViewType.TYPE_VIEW_MAIN,t.MarryViewType.TYPE_SUB_VIEW_BEI_QIU_HUN))},r.prototype.startQQAni=function(){this._qqAni.showSkinByName(this._um.isBoy?"male":"female"),this.playNormalAni(),this.onYanwuLoad(),this._display.roleBox.on(Laya.Event.CLICK,this,this.onRoleClick)},r.prototype.onYanwuLoad=function(){this._yanwuAni=new t.AnimationSKe(t.ResPath().getAnimPath("fx_yanwu",t.ResourcePath.PATH_NPC)+".sk",0),this._display.roleBox.addChild(this._yanwuAni),this._yanwuAni.scaleX=1.2,this._yanwuAni.scaleY=1.2,this._yanwuAni.x=100,this._yanwuAni.y=100,this._yanwuAni.stop(),this._yanwuAni.visible=!1,this._display.roleBox.on(Laya.Event.CLICK,this,this.onRoleClick)},r.prototype.playNormalAni=function(){this._display.dialog.visible=!1;var t=Math.ceil(Math.random()*(this.BASIC_ACTION_COUNT-1));this._qqAni.on(Laya.Event.STOPPED,this,this.onNormalEnd),this._qqAni.play(t,!1)},r.prototype.onNormalEnd=function(){this._qqAni.off(Laya.Event.STOPPED,this,this.onNormalEnd),this.sayRandom()},r.prototype.sayRandom=function(){this.sayWords(t.Interactive.getRandomWord())},r.prototype.sayWords=function(t){this._qqAni&&this._qqAni.play(0,!0),this._display.dialog.visible=!0,this._display.tfWords.text=t,Laya.timer.once(5e3,this,this.playNormalAni)},r.prototype.onRoleClick=function(){if(this.hasLoadBubble){if(this.isPlayingNpc)return;this._isOperateShow=!this._isOperateShow,this._display.paoBox.visible=this._isOperateShow,this._isOperateShow?(Laya.timer.clear(this,this.playNormalAni),this.prepare(),this.initPaoBox()):(this.clearHidePaoBox(),this.sayRandom())}else{var e=new t.HomeBubbleCmd;e.on(this,this.homeBubbleLoadOver),t.Facade.callCommand(e)}},r.prototype.homeBubbleLoadOver=function(t){this.hasLoadBubble=!0,t.off(),this.onRoleClick()},r.prototype.prepare=function(){Laya.timer.clear(this,this.playNormalAni),this._qqAni.play(0,!0),this._display.dialog.visible=!1},r.prototype.initPaoBox=function(){this.LEFT_COUNT=3;var t,e=[0,1,2,3,4,5],i=0;for(this._currIndexArr=[],this._targetIndex="",this._targetArr=[];3>i;)t=e.splice(Math.floor(Math.random()*e.length),1)[0],this._currIndexArr.push(String(t+1)),this._targetArr.push(this._postfixArr[t]),i++;for(var s=0;s<this._LIMIT;s++)this._display["pao_"+s].graphics.clear(),this._display["pao_"+s].loadImage("ui/bubble/p_0001"+this._targetArr[s]+".png"),this._display["pao_"+s].visible=!0,this._display["btnPao_"+s].visible=!0;this.delayHidePaoBox()},r.prototype.delayHidePaoBox=function(){this.clearHidePaoBox(),Laya.timer.once(5e3,this,this.hidePaoBox)},r.prototype.clearHidePaoBox=function(){Laya.timer.clear(this,this.hidePaoBox)},r.prototype.hidePaoBox=function(){this.sayRandom(),this._isOperateShow=!1,this._display.paoBox.visible=!1},r.prototype.clickHandler=function(t){var e=t.target.name;if(-1!=e.indexOf("btnPao_")&&this._isOperateShow){var i=Number(e.split("_")[1]);this._targetIndex+=this._currIndexArr[i],this.playPaoMovie(i),this.clearHidePaoBox()}},r.prototype.backGroundClick=function(e){for(var i,s=e.stageX,n=e.stageY,a=1;3>=a;a++)if(s>=this["_rectX"+a]&&s<=this["_rectX"+a]+80&&n>=this["_rectY"+a]&&n<=this["_rectY"+a]+80){t.Logger.log(s,n,this["_rectX"+a],this["_rectY"+a]),i=String(a);break}if(i){this._clickStr+=i,1==this._clickStr.length&&Laya.timer.once(2e3,this,this.checkToOpenNetBox);var o="test"==t.Global.PF?"111":"1212";this._clickStr==o&&(Laya.timer.clear(this,this.checkToOpenNetBox),this._clickStr="",Laya.alertGlobalError=!0,t.Facade.callCommand(new t.ShowNetBoxCmd))}},r.prototype.checkToOpenNetBox=function(){this._clickStr=""},r.prototype.playPaoMovie=function(t){this.paoAniIndex=2,this._display.paoBox.mouseEnabled=!1,Laya.timer.frameLoop(2,this,this.nextMovie,[t])},r.prototype.nextMovie=function(t){this._display["pao_"+t].graphics.clear(),this._display["pao_"+t].loadImage("ui/bubble/p_000"+this.paoAniIndex+(this.paoAniIndex>=4?"":this._targetArr[t])+".png"),this.paoAniIndex++,this.paoAniIndex>6&&(Laya.timer.clear(this,this.nextMovie),this.clickPao(t),this._display.paoBox.mouseEnabled=!0)},r.prototype.clickPao=function(t){this._display["pao_"+t].visible=!1,this._display["btnPao_"+t].visible=!1,this.LEFT_COUNT--,this.delayHidePaoBox(),this.LEFT_COUNT<=0&&(this.clearHidePaoBox(),this._display.paoBox.visible=!1,this._display.roleBox.mouseEnabled=!1,this.isPlayingNpc=!0,this._isOperateShow=!1,this.playAction())},r.prototype.playAction=function(){var e=t.Interactive.getNpcUrlByIndex(this._targetIndex);e?(this._currNpcConf=e,this.reportUnlock(Number(this._currNpcConf.position))):(this.isPlayingNpc=!1,this._display.roleBox.mouseEnabled=!0,this.sayWords("然而并没有什么卵用~~"))},r.prototype.reportUnlock=function(e){t.XHR().Post({file:"petpk",cmd:"unlock",uid:t.Global.UID,op:"unlock",action_id:e},this,function(e){0==e.result||101==e.result?(this.loadNpc(),this._display.roleBox.mouseEnabled=!1):(this._display.roleBox.mouseEnabled=!0,this.isPlayingNpc=!1,t.WeakTips.show(e.msg))},!1)},r.prototype.npcLoadError=function(){this._display.roleBox.mouseEnabled=!0,this._qqAni&&(this._qqAni.visible=!0,this._qqAni.resume()),this.isPlayingNpc=!1,Laya.timer.once(3e3,this,this.sayRandom)},r.prototype.loadNpc=function(){0==t.BoxMgr.boxs.length?(this._npcAni=new t.AnimationSKe(t.ResPath().getAnimPath(this._currNpcConf.icon,t.ResourcePath.PATH_NPC)+".sk",0),this._npcAni.on(Laya.Event.ERROR,this,this.npcLoadError),this._npcAni.x=100,this._npcAni.y=165,this._npcAni.scaleX=1==this._currNpcConf.pos?-1:1,this._display.roleBox.addChild(this._npcAni),this._display.roleBox.mouseEnabled=!1,this._npcAni.stop(),this._npcAni.visible=!1,this._qqAni.visible=!1,Laya.timer.clear(this,this.playNormalAni),this._display.dialog.visible=!1,this._yanwuAni?(this._yanwuAni.visible=!0,this._yanwuAni.play(0,!1),this._yanwuAni.on(Laya.Event.STOPPED,this,this.playYanwuComplete)):this.playYanwuComplete()):this._display.roleBox.mouseEnabled=!0},r.prototype.playYanwuComplete=function(){this._yanwuAni&&(this._yanwuAni.off(Laya.Event.STOPPED,this,this.playYanwuComplete),this._yanwuAni.stop(),this._yanwuAni.visible=!1),0==t.BoxMgr.boxs.length&&this._npcAni&&(this._npcAni.on(Laya.Event.STOPPED,this,this.playNpcComplete),this._npcAni.visible=!0,this._npcAni.play(t.Interactive.getActNameById(this._currNpcConf.type),!1))},r.prototype.playNpcComplete=function(){this._npcAni&&(this._npcAni.off(Laya.Event.STOPPED,this,this.playNpcComplete),this._npcAni.parent&&this._npcAni.parent.removeChild(this._npcAni)),this._yanwuAni?(this._yanwuAni.visible=!0,this._yanwuAni.play(0,!1),this._yanwuAni.on(Laya.Event.STOPPED,this,this.playYanwuComplete1)):this.playYanwuComplete1(),Laya.timer.frameOnce(1,this,this.destroyNpc)},r.prototype.playYanwuComplete1=function(){this._yanwuAni&&(this._yanwuAni.off(Laya.Event.STOPPED,this,this.playYanwuComplete1),this._yanwuAni.stop(),this._yanwuAni.visible=!1),this._display.roleBox.mouseEnabled=!0,this._qqAni&&(this._qqAni.visible=!0,this._qqAni.resume()),this.isPlayingNpc=!1,this._display.dialog.visible=!0,this.sayRandom()},r.prototype.destroyNpc=function(){this._npcAni&&(this._npcAni.destroy(),this._npcAni=null)},r.prototype.changeSex=function(){this._npcAni&&(this._npcAni.destroy(),this._npcAni=null),this._qqAni.visible=!1,this._yanwuAni&&(this._yanwuAni.visible=!0,this._yanwuAni.play(0,!1),this._yanwuAni.on(Laya.Event.STOPPED,this,this.changeSexEnd))},r.prototype.changeSexEnd=function(){this._yanwuAni.off(Laya.Event.STOPPED,this,this.changeSexEnd),this._um.sex=1==this._um.sex?2:1,this._display.playerInfo.photo.loadImage(this._um.headimgurl,0,0,74,74),this._qqAni.visible=!0,this._qqAni.showSkinByName(this._um.isBoy?"male":"female"),this._qqAni.play(0,!0),Laya.timer.once(1e3,this,this.changeSexTip)},r.prototype.changeSexTip=function(){var e=new t.ConfirmBoxData({isShowCancelBtn:!1,contentStr:"改变性别成功，你已成为一名"+(this._um.isBoy?"健壮的少年。":"软萌的妹纸。")});t.ConfirmBox.show(e),this.playNormalAni()},r.prototype.onHided=function(){if(t.removeListener(t.ViewEvent.BOX_SHOW,this,this.onBoxShowHide),t.removeListener(t.ViewEvent.BOX_HIDE,this,this.onBoxShowHide),!t.Global.isRetrench){var e=t.Global.SCENE_ID_ARR.concat();e.splice(e.indexOf(t.Global.MAIN_SCENE_BG_ID),1),this.curr=t.Global.MAIN_SCENE_BG_ID,t.Global.MAIN_SCENE_BG_ID=e[Math.floor(Math.random()*e.length)],Laya.loader.load([{url:t.ResPath().getFightScene(t.Global.MAIN_SCENE_BG_ID),type:Loader.IMAGE}]),this._display.graphics.clear(),Laya.timer.frameOnce(1,this,this.clearbg)}},r.prototype.clearbg=function(){Laya.loader.clearRes(t.ResPath().getFightScene(this.curr)),t.Logger.log("[clear scene:"+t.ResPath().getFightScene(this.curr)+"]")},r.prototype.onBoxShowHide=function(e){t.BoxMgr.numBoxSHowed();e&&t.LevelIconOpenBox.count<=0?(this._display.aniLayer2.visible=!1,this.btnEffectLayer.visible=!1):0==t.BoxMgr.boxs.length&&(this._display.aniLayer.visible=!0,this._display.aniLayer2.visible=!0,this._display.roleBox.mouseEnabled=!0,this.btnEffectLayer.visible=!0),e?(this._yanwuAni&&this.playYanwuComplete1(),this._npcAni&&this.destroyNpc()):this._display.roleBox.mouseEnabled=!0},r.prototype.getSceneName=function(){return t.SceneDef.MAIN_SCENE;
},r.prototype.checkWeakTips=function(){this._display.weakTipsBox.visible=!1,this._um.level<=10&&(this._um.vit>=10||this._um.level>=3&&this._um.energy>=1)&&Laya.timer.once(3e3,this,this.weakTips2)},r.prototype.weakTips2=function(){this._um.level<=10&&this._um.vit>=10?(this.weakPos=this.weakPos1,this._display.weakTipsBox.visible=!0,this.checkWeakTipsPos(),this._display.weakText.text="斗友切磋可获得大量经验升级"):this._display.weakTipsBox.visible=!1,Laya.timer.once(2e3,this,this.weakTips3)},r.prototype.weakTips3=function(){this._um.energy>=1&&this._um.level>=7?(this.weakPos=this.weakPos2,this._display.weakTipsBox.visible=!0,this.checkWeakTipsPos(),this._display.weakText.text="历练可获得大量威望和经验"):this._display.weakTipsBox.visible=!1,Laya.timer.once(2e3,this,this.weakTips4)},r.prototype.weakTips4=function(){this._um.level<=10&&this._um.vit>=10?(this.weakPos=this.weakPos1,this._display.weakTipsBox.visible=!0,this.checkWeakTipsPos(),this._display.weakText.text="好友切磋胜利可额外获得胜点和黄金钥匙"):this._display.weakTipsBox.visible=!1,Laya.timer.once(2e3,this,this.weakTips5)},r.prototype.weakTips5=function(){this._um.energy>=1&&this._um.level>=7?(this.weakPos=this.weakPos2,this._display.weakTipsBox.visible=!0,this.checkWeakTipsPos(),this._display.weakText.text="历练可获得大量威望和经验"):this._display.weakTipsBox.visible=!1,Laya.timer.once(2e3,this,this.checkWeakTips)},r.prototype.checkWeakTipsPos=function(){this._display.weakTipsBox.visible&&(this._display.weakTipsBox.x=this.weakPos==this.weakPos2&&t.Icon.MAIN_SCENE.xkxBtn.childMenu.isShow?this.weakPos.x-100:this.weakPos.x,this._display.weakTipsBox.y=this.weakPos==this.weakPos2?this.weakPos.y+t.LayerMgr.offY:this.weakPos.y+t.LayerMgr.offY)},r.prototype.userModelUpdate=function(){var e=t.SelfInfo.getTitle(this._um.level);this._display.tfTitle.color=e.color,this._display.tfTitle.text=e.text+"("+t.Global.UID+")",this._am.setStatueFlagByName(t.AllStatusModel.FIGHTING_CHANNEL,this._um.prestige>=3e3?1:0),this._am.setStatueFlagByName(t.AllStatusModel.EENEGY,this._um.energy>=1&&this._um.level<=10?1:0),this._display.tfExp.text=this._um.exp+"/"+this._um.maxExp,this._um.maxExp>42e8&&(this._display.tfExp.text="-- / --"),this._um.level>this._level&&(this._level=this._um.level,this._topMenu.arrange(),this._bottomMenu.arrange(),this._rightMenu.arrange(),this.checkIconLevelLimit()),this._um.level<17?this._display.leftdownComp.visible=!1:this._display.leftdownComp.visible=!0,this._display.progressBar.scrollRect.width=347*(this._um.exp/this._um.maxExp),this._display.playerInfo.tfLvl.text=this._um.level+"",this._display.tfName.text=this._um.name,this._display.tfVip.text=""+this._um.vipLevel,this._display.tfName.x=this._display.tfVip.x+this._display.tfVip.textWidth+5,this._display.playerInfo.femaleIcon.visible=this._display.playerInfo.maleIcon.visible=!1,this._display.tfPower.text=this._um.attackPower+"",this._display.fightingRedDot.x=this._display.tfPower.x+this._display.tfPower.textWidth+5,this._display.tfVit.text=this._um.vit+"/"+this._um.maxVit,this._display.tfMoney.text=this._um.doubi+"",this._display.tfDouyu.text=this._um.douyu+"",this._um.vit>=10&&this._um.level<=10?this._friendBtn.showEffect():this._friendBtn.cancelEffect(),this._shareWB!=this._um.wbShare&&this._topMenu.arrange(),this._display.playerInfo.photo.loadImage(this._um.headimgurl,0,0,74,74),this._display.buffLayer.visible=this._um.level>=6,this.setChipVisible();var i=this._am.getStatueFlagByName(t.AllStatusModel.LV_GIFT_STATE);this._display.levelGiftBtn.visible=1==i||this._um.level<40;var s=this._am.getStatueFlagByName(t.AllStatusModel.LOGIN_GIFT_STATE);this._display.loginGiftBtn.visible=1==s||this._um.loginDays<14,this.checkWbGift(),this.updatePumpkin();var n=t.Facade.retrieveModel(t.ModelDef.ACT_MODEL);this._um.level>=10||n&&n.hasActivity(50)?t.Global.isWXAPP&&Browser.onIOS?this._display.pleasantBtn.visible=!1:this.checkRecharge():this._display.pleasantBtn.visible=!1},r.prototype.checkRecharge=function(){t.XHR().Post({cmd:"activity",aid:50},this,this.dataRet)},r.prototype.dataRet=function(t){Laya.timer.clear(this,this.checkRecharge),Laya.timer.clear(this,this.cutDown),0==t.result&&0==t.status?(this._display.pleasantBtn.skin=0==t.type?"ui/main/sbtn1_24.png":"ui/main/sbtn1_48.png",this._display.pleasantBtn.visible=!0,this._rechargeMinute=t.seconds,this.setTime(),Laya.timer.loop(1e3,this,this.cutDown)):this._display.pleasantBtn.visible=!1},r.prototype.setTime=function(){var t=Math.floor(this._rechargeMinute/3600),e=Math.floor(this._rechargeMinute%3600/60);this._display.rechargeTimeTxt.text="剩余"+t+"小时"+e+"分"},r.prototype.cutDown=function(){this._rechargeMinute--,this._rechargeMinute<0?this.checkRecharge():this.setTime()},r.prototype.updatePumpkin=function(){-1==this._um.halloweenFlag?(this._pumpkin&&(this._pumpkin.removeSelf(),this._pumpkin.destroy(),this._pumpkin=null),this._display.pum.visible=!1):(1==this._um.halloweenFlag?(this._pumpkin&&(this._pumpkin.removeSelf(),this._pumpkin.destroy(),this._pumpkin=null),this._display.pumImg.visible=!0):(this._pumpkin||(this._pumpkin=new t.AnimationSKe(t.ResPath().getEffect("pumpkin"))),this._display.pum.addChild(this._pumpkin),this._pumpkin.scale(2,2),this._pumpkin.x=110,this._pumpkin.y=100,this._pumpkin.play((0==this._um.halloweenFlag,0),!0),this._display.pumImg.visible=!1),this._display.pum.visible=!0,this._display.pum.on(Laya.Event.CLICK,this,this.pumpkin))},r.prototype.pumpkin=function(){0==this._um.halloweenFlag?t.XHR().Post({file:"petpk",cmd:"wb_login",op:"login_award",uid:t.Global.UID},this,function(e){0==e.result?(this._um.halloweenFlag=1,this.updatePumpkin(),t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0,"恭喜你获得万圣节礼包："))):t.WeakTips.show(e.msg)}):t.WeakTips.show("今天已领取万圣节礼包")},r.prototype.updateChristmas=function(){this._display.bottomBox.visible=!1;var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);if(e.severDataHasLoaded){t.removeListener(t.ServerSetDataModel.SERVER_SET_DATA_MODEL_RESULT,this,this.updateChristmas);var i=t.Facade.retrieveModel(t.ModelDef.ACT_MODEL);i&&i.hasActivity(78)&&(this._display.bottomBox.visible=!0,this._christmasTree||(this._christmasTree=new t.AnimationSKe(t.ResPath().getEffect("christmas")),this._christmasTree.x=222,this._christmasTree.y=515),0==e.getDailyDataValue(t.ServerSetDataModel.KEY_DAILY_CHRISTMAS_FINGER)?this._display.ani1.play(0,!0):this._display.fingerIcon.visible=!1,this._christmasTree.play(0,!0),this._display.bottomBox.on(Laya.Event.CLICK,this,this.onClickChristmas),this._display.bottomBox.addChildAt(this._christmasTree,0))}else t.addListener(t.ServerSetDataModel.SERVER_SET_DATA_MODEL_RESULT,this,this.updateChristmas)},r.prototype.onClickChristmas=function(){var e=t.Facade.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);e.setDailyDataValue(t.ServerSetDataModel.KEY_DAILY_CHRISTMAS_FINGER,1),this._display.ani1.stop(),this._display.fingerIcon.visible=!1,t.Facade.callCommand(new t.ChristmasCommand)},r.prototype.checkWbGift=function(){var e=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);if(this._um.level>=5&&t.Global.isWB&&e.createTime>15059448e5){var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);if(i.severDataHasLoaded){if(t.removeListener(t.ServerSetDataModel.SERVER_SET_DATA_MODEL_RESULT,this,this.checkWbGift),0==i.getLongDataValue(t.ServerSetDataModel.KEY_HAS_GOT_WB_GIFT)){var s=new t.WbGiftBox;s.show()}}else t.addListener(t.ServerSetDataModel.SERVER_SET_DATA_MODEL_RESULT,this,this.checkWbGift)}},r.prototype.packModelUpdate=function(){var e=0;if(this._um.level>=7&&this._um.chainInfo)for(var i,s=0;s<this._um.chainInfo.length;s++)i=this._um.chainInfo[s],i.level<10?this._pm.getItemCount(i.goods_id)>=5&&(e=1):this._pm.getItemCount(i.goods_id)>=9&&this._pm.getItemCount(i.extra_goods_id)>=3&&(e=1);this._am.setStatueFlagByName(t.AllStatusModel.FIGHTING_CHAIN,e)},r.prototype.checkRedot=function(){var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);if(e.severDataHasLoaded){if(t.removeListener(t.ServerSetDataModel.SERVER_SET_DATA_MODEL_RESULT,this,this.checkRedot),0==e.getDailyDataValue(t.ServerSetDataModel.KEY_DAILY_WULIN_REDDOT)){var i=t.ServerClock.getServerNowDate();i.setHours(12,0,0);var s=t.ServerClock.getServerTime(),n=i.getTime();i.setHours(23,50,0);var a=i.getTime();a>s&&s>n&&this._um.level>=10?this._am.setStatueFlagByName(t.AllStatusModel.WULIN_STATE,1):this._am.setStatueFlagByName(t.AllStatusModel.WULIN_STATE,0)}else this._am.setStatueFlagByName(t.AllStatusModel.WULIN_STATE,0);0==e.getDailyDataValue(t.ServerSetDataModel.KEY_DAILY_MASTER_REDDOT)&&this._um.level>=11&&!t.Global.isWXAPP?this._am.setStatueFlagByName(t.AllStatusModel.MASTER_STATE,1):this._am.setStatueFlagByName(t.AllStatusModel.MASTER_STATE,0)}else t.addListener(t.ServerSetDataModel.SERVER_SET_DATA_MODEL_RESULT,this,this.checkRedot)},r.prototype.checkChampionRedot=function(){var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);if(e.severDataHasLoaded)if(t.removeListener(t.ServerSetDataModel.SERVER_SET_DATA_MODEL_RESULT,this,this.checkChampionRedot),0==e.getDailyDataValue(t.ServerSetDataModel.KEY_DAILY_CHAMPION_REDDOT)){var i=t.ServerClock.getServerNowDate();i.setHours(0,0,0);var s=t.ServerClock.getServerTime(),n=i.getTime();i.setHours(23,50,0);var a=i.getTime();a>s&&s>n&&this._um.level>=25?this._am.setStatueFlagByName(t.AllStatusModel.CHAMPION_STATE,1):this._am.setStatueFlagByName(t.AllStatusModel.CHAMPION_STATE,0)}else this._am.setStatueFlagByName(t.AllStatusModel.CHAMPION_STATE,0);else t.addListener(t.ServerSetDataModel.SERVER_SET_DATA_MODEL_RESULT,this,this.checkChampionRedot)},r.prototype.updateBuff=function(){0==this._minBuffTime&&(this._curServerTime=Math.floor(t.ServerClock.getServerTime()/1e3)),this._minBuffTime=0,Laya.timer.clear(this,this.onBuffTime),this._display.buffLayer.removeChildren();var e=this._buffModel.buffs;e.sort(this.sortCompare);for(var i=e.length,s=0,n=0,a=0;i>a;a++)if(1==e[a].has||1==e[a].resident){var o=new Sprite;if(o.loadImage(t.ResPath().getPic(e[a].id+"",t.ResourcePath.PATH_MINE_BUFF),0,0,40,40,Handler.create(this,this.onBuffLoad,[o])),o.x=42*n,s+=42,0==e[a].has||1!=e[a].id&&2!=e[a].id&&e[a].lv<=0)o.filters=t.FiltersUtils.getGreyFilters();else if(1==e[a].type){var r=e[a].lv;(0==this._minBuffTime||r<this._minBuffTime)&&(this._minBuffTime=r)}this._display.buffLayer.addChild(o),n++}var h=Math.floor(t.ServerClock.getServerTime()/1e3)-this._curServerTime;this._minBuffTime-h>0&&Laya.timer.once(1e3*(this._minBuffTime-h),this,this.onBuffTime),this._display.buffLayer.width=s},r.prototype.sortCompare=function(t,e){var i=t.sortid,s=e.sortid;return i>s?1:s>i?-1:0},r.prototype.onBuffLoad=function(e){e.loadImage(t.ResPath().getPic("big_frame",t.ResourcePath.PATH_MINE_BUFF),0,0,40,40)},r.prototype.onBuffTime=function(){t.XHR().Post({cmd:"detail",op:"status"},this,this.onStatuInfo)},r.prototype.onStatuInfo=function(t){0==t.result&&(this._minBuffTime=0,this._buffModel.buffs=t.status_info)},r.prototype.onClickBuff=function(){t.Facade.callCommand(new t.BuffCommand)},r.prototype.addVit=function(){t.Facade.callCommand(new t.GetGoodsCommand(["100001","100002","100003"]))},r.prototype.onAddCrash=function(){t.Facade.callCommand(new t.OpenVipBoxCommand(1))},r.prototype.onClickFriend=function(){t.Facade.callCommand(new t.FriendCommand)},r.prototype.onClickSelfInfo=function(){t.Facade.callCommand(new t.SelfInfoCommand)},r.prototype.onClickStreng=function(){t.Facade.callCommand(new t.OpenStrengthBoxCommand)},r.prototype.communityBoxInit=function(){window.mqq?this.gameGroupBtn.platVisible=!1:(this.buluoBtn.platVisible=!1,this.bbsBtn.platVisible=!1),t.Global.isWX?(this.subscriptionBtn.platVisible=!0,this.communityBtn.addRedDotFlag("kRedDotDingyue"),this.publicBtn.platVisible=!1):this.subscriptionBtn.platVisible=!1,this._leftMenu.arrange()},r.prototype.showLeftMenu=function(){e.to(this._display.hideLeftMenu,{x:20},500,i.expoOut),this._leftMenu.spread(),this._display.showLeftMenu.visible=!1},r.prototype.hideLeftMenu=function(){this._leftMenu.hide(),e.to(this._display.hideLeftMenu,{x:-85},500,i.expoOut),this._display.showLeftMenu.visible=!0,this._display.showLeftMenu.alpha=0,e.to(this._display.showLeftMenu,{alpha:1},500,i.expoOut)},r.prototype.showRightMenu=function(){this._rightMenu.spread(),this._display.showRightMenu.visible=!1,this._display.hideRightMenu.visible=!0},r.prototype.hideRightMenu=function(){this._rightMenu.hide(),this._display.showRightMenu.visible=!0,this._display.hideRightMenu.visible=!1},r.prototype.changeMenu1State=function(){this.m_menuOpen1?(this._bottomMenu.hide(),e.to(this._display.btnMenu1,{rotation:180},500,i.elasticOut)):(this._bottomMenu.spread(),e.to(this._display.btnMenu1,{rotation:0},500,i.elasticOut)),this.m_menuOpen1=!this.m_menuOpen1},r.prototype.makeMenuSpread=function(e){var i=t.Icon.MAIN_SCENE[e];i&&(i.category!=t.Icon.BOTTOM_MENU||this.m_menuOpen1||(this._display.btnMenu1.rotation=0,this.m_menuOpen1=!0,this._bottomMenu.spreadDirect()))},Object.defineProperty(r.prototype,"btnEffectLayer",{get:function(){return this._display.btnEffectLayer},enumerable:!0,configurable:!0}),r.prototype.destroy=function(){Laya.stage.off(Laya.Event.RESIZE,this,this.setOffY),Laya.stage.off(Laya.Event.CLICK,this,this.backGroundClick),this._um&&(this._um.off(t.ModelEvent.UPDATE_FINISH,this,this.userModelUpdate),this._um=null),this._am&&(this._am.off(t.ModelEvent.UPDATE_FINISH,this,this.allStatusModelUpdate),this._am=null),this._pm&&(this._pm.off(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdate),this._pm=null),this._display=null,Laya.timer.clear(this,this.loginCutDown),o.prototype.destroy.call(this)},r.MAIN_VIEW_SOUND="MAIN_VIEW_SOUND",r}(t.BaseScene);t.MainView=o}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,new ui.user.AddPointUI,!0,!0,!1,!1),this.contentlist=new Array,this.speed=0,this.power=0,this.phy=0,this.freeAttr=0,this.mouseDown=!1,this.typeArr=["power","phy","speed"],this.sliderList=[],this.display=this.skin,this.name="AddPointBox",this.command=t,this.userData=this.command.uData,this.freeAttr=this.userData.free_attr,this.init()}return __extends(i,e),i.prototype.init=function(){this.display.cancelBtn.on(laya.events.Event.CLICK,this,this.cancelPoint),this.display.confirmBtn.on(laya.events.Event.CLICK,this,this.savePoint),this.display.addBtn1.on(laya.events.Event.MOUSE_DOWN,this,this.doBtnKeyDown,[1,0]),this.display.addBtn2.on(laya.events.Event.MOUSE_DOWN,this,this.doBtnKeyDown,[1,1]),this.display.addBtn3.on(laya.events.Event.MOUSE_DOWN,this,this.doBtnKeyDown,[1,2]),this.display.subBtn1.on(laya.events.Event.MOUSE_DOWN,this,this.doBtnKeyDown,[-1,0]),this.display.subBtn2.on(laya.events.Event.MOUSE_DOWN,this,this.doBtnKeyDown,[-1,1]),this.display.subBtn3.on(laya.events.Event.MOUSE_DOWN,this,this.doBtnKeyDown,[-1,2]),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.doBtnKeyUp),this.display.valueSlider0.changeHandler=new Handler(this,this.pointChange,[0]),this.display.valueSlider1.changeHandler=new Handler(this,this.pointChange,[1]),this.display.valueSlider2.changeHandler=new Handler(this,this.pointChange,[2]),this.display.powerIMG.on(laya.events.Event.CLICK,this,this.showBoxTips,[1,this.display.powerIMG]),this.display.jinguIMG.on(laya.events.Event.CLICK,this,this.showBoxTips,[2,this.display.jinguIMG]),this.display.speedIMG.on(laya.events.Event.CLICK,this,this.showBoxTips,[3,this.display.speedIMG]),this.sliderList.push(this.display.valueSlider0),this.sliderList.push(this.display.valueSlider1),this.sliderList.push(this.display.valueSlider2),this.showInfo()},i.prototype.savePoint=function(){0!=this.power||0!=this.phy||0!=this.speed?t.XHR().Post({cmd:"setuser",op:"assign_attr",power:this.power,phy:this.phy,speed:this.speed},this,this.addResult):t.WeakTips.show("分配属性点后方可保存")},i.prototype.pointAdd=function(e,i){var s=["力量","筋骨","速度"];this.freeAttr>0&&e>0?(this[this.typeArr[i]]+=e,this.freeAttr-=e,t.Facade.callCommand(new t.ShowChangeRewardCmd([s[i]+"+"+e]))):this[this.typeArr[i]]>0&&0>e?(this[this.typeArr[i]]+=e,this.freeAttr-=e,t.Facade.callCommand(new t.ShowChangeRewardCmd([s[i]+"-"+Math.abs(e)]))):t.WeakTips.show("没有可调整的点数"),this.showInfo()},i.prototype.doBtnKeyDown=function(t,e){this.mouseDown=!0,this.pointAdd(t,e),Laya.timer.loop(200,this,this.pointAdd,[t,e])},i.prototype.doBtnKeyUp=function(){this.mouseDown=!1,Laya.timer.clear(this,this.pointAdd)},i.prototype.pointChange=function(e){var i=this.freeAttr;if(this.freeAttr=this.freeAttr-(this.sliderList[e].value-this[this.typeArr[e]]),this.freeAttr<0){this._time||(this._time=Browser.now());var s=Browser.now();s-this._time>150&&(t.WeakTips.show("没有可分配的点数"),this._time=s),this.sliderList[e].value=this[this.typeArr[e]],this.freeAttr=i}else this[this.typeArr[e]]=this.sliderList[e].value;this.showInfo()},i.prototype.sliderReload=function(){for(var t=0;t<this.sliderList.length;t++)this.sliderList[t].max=this.userData.free_attr,this.sliderList[t].value=this[this.typeArr[t]]},i.prototype.cancelPoint=function(){this.destroy()},i.prototype.addResult=function(e){0==e.result?(this.showInfo(),this.command.ecode=0,this.command.finish(),t.WeakTips.show("保存分配点数成功！"),this.destroy()):t.WeakTips.show(e.msg)},i.prototype.destroy=function(){Laya.stage.off(Laya.Event.MOUSE_UP,this,this.doBtnKeyUp),e.prototype.destroy.call(this)},i.prototype.showInfo=function(){this.display.power.text="（"+this.userData.base_power+"+"+this.power+"）+"+(parseInt(this.userData.total_power)-parseInt(this.userData.base_power)),this.display.speed.text="（"+this.userData.base_speed+"+"+this.speed+"）+"+(parseInt(this.userData.total_speed)-parseInt(this.userData.base_speed)),this.display.jingu.text="（"+this.userData.base_physique+"+"+this.phy+"）+"+(parseInt(this.userData.total_physique)-parseInt(this.userData.base_physique)),this.display.freeAttr.text="剩余分配点数："+this.freeAttr,this.sliderReload()},i.prototype.showBoxTips=function(e,i){var s,n={};s=i.localToGlobal(new laya.maths.Point(0,0)),n.name="属性说明",n.desc="力量：影响攻击\n筋骨：影响防御、闪避、生命\n速度：影响出手顺序和行动频率",t.Tips.show(n,s)},i}(t.BaseBox);t.AddPoint=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.utils.Dictionary,i=laya.ui.Image,s=function(i){function s(s){i.call(this,new ui.user.InfoPanelUI,!0,!0,!1,!1),this.userData=new Object,this.weaponData=new Array,this.skillData=new Array,this.showIndex=0,this.detailIndex=0,this.layerType=0,this.delayLoad=0,this.display=this.skin,this.name="SelfAttrBox",this.setCloseButton(this.display.back.closeBtn),this.userMap=new e,this.display.tipsBoxUp.visible=!1,s instanceof t.UserInfoCommand&&(this.cmdUserData=s.userData),t.addListener(t.ViewEvent.BOX_HIDE,this,this.boxHideHandler),this._facCMD=new t.GetFacInfoPanelCmd(0),this._facCMD.on(this,this.facInfofinish),this.display.inputTxt.maxChars=40}return __extends(s,i),s.prototype.SetInfo=function(e){this.puid=e.puid,this.layerType=e.layerType,this.display.weaponList.selectEnable=!0,this.display.weaponList.selectedIndex=2,this.display.weaponList.selectHandler=new Handler(this,this.onSelect),this.display.attrList.scrollBar.visible=!1,this.display.attrList.renderHandler=new Handler(this,this.onListRender),this.display.weaponList.renderHandler=new Handler(this,this.onWeaponRender),this.userModel=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),this.userModel.on(t.ModelEvent.UPDATE_FINISH,this,this.delayLoadInfo),this.display.myTitle.visible=!1,this.init()},s.prototype.init=function(){this.hidetips(),this.display.menuTab.labels="属\n\n性,武\n\n器,技\n\n能",this.display.menuTab.selectedIndex=0,this.display.weaponPanel.visible=!1,this.display.back.derocation_left.skin="ui/comp/rope_xia.png",this.display.back.derocation_left.x=125,this.showTab(0),this.display.serventBtn.visible=!1,this.display.btn_hunyin.visible=!1,this.display.menuTab.selectHandler=new Handler(this,this.showTab),this.display.attrTab.selectHandler=new Handler(this,this.showAttr),this.display.upBtn.on(laya.events.Event.CLICK,this,this.upgrade),this.display.upgradeBtn.on(laya.events.Event.CLICK,this,this.userUpgrade),this.display.pointBtn.on(laya.events.Event.CLICK,this,this.addPoint),this.display.serventBtn.on(laya.events.Event.CLICK,this,this.openServent),this.display.btn_hunyin.on(laya.events.Event.CLICK,this,this.openMarry),this.display.monsterBtn.on(laya.events.Event.CLICK,this,this.openMonster),this.display.attrLink.on(laya.events.Event.CLICK,this,this.showtips),this.display.breakFriend.on(laya.events.Event.CLICK,this,this.deleteFriend),this.display.tipsClose.on(laya.events.Event.CLICK,this,this.hidetips),this.display.changeTitleBtn.on(laya.events.Event.CLICK,this,function(){t.WeakTips.show("暂未开放")}),this.display.hpbox.on(laya.events.Event.CLICK,this,this.showBoxTips,[0,this.display.hpbox]),this.display.powerbox.on(laya.events.Event.CLICK,this,this.showBoxTips,[1,this.display.powerbox]),this.display.jingubox.on(laya.events.Event.CLICK,this,this.showBoxTips,[2,this.display.jingubox]),this.display.speedbox.on(laya.events.Event.CLICK,this,this.showBoxTips,[3,this.display.speedbox]),this.display.gemLink.on(laya.events.Event.CLICK,this,this.linkGem),this.display.writeBtn.on(laya.events.Event.CLICK,this,this.showWriteBox),this.display.queDingBtn.on(laya.events.Event.CLICK,this,this.writeSumit),this.display.boxClose.on(laya.events.Event.CLICK,this,this.closeWriteBox)},s.prototype.showWriteBox=function(){this.display.writeBox.visible=!0,this.hideFacBox()},s.prototype.closeWriteBox=function(){this.display.writeBox.visible=!1},s.prototype.writeSumit=function(){this.display.inputTxt.text;t.XHR().Post({cmd:"setuser",op:"set_declaration",value:this.display.inputTxt.text},this,this.writeRet)},s.prototype.writeRet=function(e){0==e.result?(this.loadInfo(),this.closeWriteBox(),t.WeakTips.show("修改成功")):t.WeakTips.show(e.msg)},s.prototype.delayLoadInfo=function(){1==this.delayLoad?(Laya.timer.clearAll(this),Laya.timer.once(3e3,this,this.loadInfo)):Laya.timer.once(3e3,this,this.loadInfo)},s.prototype.loadInfo=function(e){void 0===e&&(e=0);var i=this.showIndex,s=["","weapon","skill"],n={file:"petpk",cmd:"detail",op:s[i],needreload:"1"};this.puid&&(n.puid=this.puid),t.XHR().Post(n,this,function(s){if(0==s.result){Laya.timer.clear(this,this.weaponTimeLeft),1==i?(s.weapons.sort(function(t,e){return t.id-e.id}),s.weapons.sort(function(t,e){return e.has-t.has}),this.userMap.set(i,s),this.weaponData=s.weapons,Laya.timer.loop(1e3,this,this.weaponTimeLeft),t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.GET_WEAPON_INFO))):2==i?(s.skills.sort(function(t,e){return t.id-e.id}),s.skills.sort(function(t,e){return e.has-t.has}),this.userMap.set(i,s),this.skillData=s.skills,Laya.timer.loop(1e3,this,this.weaponTimeLeft),t.Facade.callCommand(new t.SyncChangeCmd(s))):(this.userMap.set(i,s),this.userData=s);var n=0==e?this.detailIndex:0;this.showTab(i,n)}else t.WeakTips.show(s.msg)})},s.prototype.showTab=function(t,e){void 0===e&&(e=0);var i=this.display.menuTab.selectedIndex,s=this.userMap.get([0,1,2][t]);this.showIndex=t,this.detailIndex=e,null!=s?(this.display.infoBox.visible=!1,this.display.weaponPanel.visible=!1,this.display.titleBar.skin="ui/userinfo/title"+i+".png",0==i?this.showInfo(s):this.showWeapon(t)):this.loadInfo(1)},s.prototype.showInfo=function(e){this.m_data=e,this.display.infoBox.visible=!0,this.display.weaponPanel.visible=!1,this.display.userTitle.text=e.title,this.display.hp.text=e.total_hp+"（"+e.bae_hp+"+"+(parseInt(e.total_hp)-parseInt(e.bae_hp))+"）",this.display.power.text=e.total_power+"（"+e.base_power+"+"+(parseInt(e.total_power)-parseInt(e.base_power))+"）",this.display.speed.text=e.total_speed+"（"+e.base_speed+"+"+(parseInt(e.total_speed)-parseInt(e.base_speed))+"）",this.display.jingu.text=e.total_physique+"（"+e.base_physique+"+"+(parseInt(e.total_physique)-parseInt(e.base_physique))+"）",this.display.leftPoint.text="剩余分配点数："+e.free_attr,this.display.combat.text=e.attack_power,this.display.vipLevel.text="达人"+e.vip_lvl,this.display.attrTab.selectedIndex=0,this.display.userName.text=this.userData.name+"（"+this.userData.level+"级）";var i=["无","帮众","精英","","长老","副帮主","帮主"];this.userData.level>=9?(e.fac_pos="无"==e.fac_pos?0:e.fac_pos,this.display.facInfo.text="帮派:"+e.fac_name+"（"+i[e.fac_pos/100]+"）"):this.display.facInfo.text="9级开启帮派",this.display.facInfo.on(Laya.Event.CLICK,this,this.showFaction,[e.fac_id]),this.setMyWord(e),this.showAttr(0),parseInt(e.free_attr)<1?(this.display.pointBtn.filters=t.FiltersUtils.getGreyFilters(),this.display.pointBtn.off(laya.events.Event.CLICK,this,this.addPoint),this.display.redState.visible=!1):(this.display.pointBtn.filters=[],this.display.redState.visible=!0),this.checkUser();var s=this.getAvatar(e.level,e.sex);this.display.avatar.skin=s.avatar,this.display.userTitle.text=s.text,this.display.userTitle.color=s.color},s.prototype.showFaction=function(e){this.userModel.level<9?t.WeakTips.show("该功能尚未开启"):"无"!=e&&""!=e&&(this._facCMD.setData(e,null,450,250),this._facCMD.facInfoBox&&(this._facCMD.facInfoBox.visible=!1),t.Facade.singleton.callCommand(this._facCMD))},s.prototype.facInfofinish=function(){Laya.timer.once(5e3,this,this.hideFacBox),this._facCMD&&this._facCMD.facInfoBox&&(this._facCMD.facInfoBox.visible=!0,this._facCMD.facInfoBox.parent||this.display.addChild(this._facCMD.facInfoBox),this._facCMD.facInfoBox.x=this._facCMD.posX,this._facCMD.facInfoBox.y=this._facCMD.posY,this._facCMD.facInfoBox.y+this._facCMD.facInfoBox.facInfo_bg.height>t.LayerMgr.height+t.LayerMgr.offY&&(this._facCMD.facInfoBox.y-=this._facCMD.facInfoBox.y+this._facCMD.facInfoBox.facInfo_bg.height-(t.LayerMgr.height+t.LayerMgr.offY)))},s.prototype.hideFacBox=function(){this.facInfofinish&&this._facCMD.facInfoBox&&(this._facCMD.facInfoBox.visible=!1)},s.prototype.setMyWord=function(t){""!=t.declaration?(this.display.myword.text=t.declaration,this.display.inputTxt.text=t.declaration,Laya.timer.once(1e3,this,this.showMyWord)):(this.display.myword.text="",Laya.timer.clear(this,this.showMyWord),this.display.myTitle.visible=!1)},s.prototype.showMyWord=function(){Laya.timer.clearAll(this),this.display.myTitle.visible=!0,Laya.timer.once(5e3,this,this.hideMyWord)},s.prototype.hideMyWord=function(){this.display.myTitle.visible=!1,Laya.timer.once(3e3,this,this.showMyWord)},s.prototype.checkUser=function(){this.puid&&this.puid!=t.Global.UID||0!=this.layerType?(this.display.serventBtn.visible=!0,this.display.btn_hunyin.visible=2==this.m_data.marry_status,this.display.monsterBtn.visible=this.m_data.level>=25,this.display.leftPoint.visible=!1,this.display.pointBtn.visible=!1,this.display.upBtn.visible=!1,this.display.upgradeBtn.visible=!1,this.display.userId.text="编号:"+this.puid,this.display.gemLink.visible=!1,this.display.changeTitleBtn.visible=!1,this.display.breakFriend.visible=!(1!=t.JSUtils.isFriend(this.puid)||!t.Global.isWXAPP)):(this.display.pointBtn.visible=!0,this.display.serventBtn.visible=!1,this.display.btn_hunyin.visible=!1,this.display.monsterBtn.visible=!1,this.display.gemLink.visible=!0,this.display.upBtn.visible=!0,this.display.vipImage.visible=!1,this.display.vipLevel.visible=!1,this.display.userId.text="编号:"+t.Global.UID,this.display.writeBtn.visible=!0,this.display.breakFriend.visible=!1),0!=this.layerType&&(this.display.serventBtn.visible=!1,this.display.serventBtn.visible=!1)},s.prototype.showAttr=function(t){var e=this.userMap.get([0,1,2][0]);if(e){var i=e.attr_array,s=8,a=t*s,o=a+s,r=["攻击","防御","暴击","暴抗","命中","闪避","破防","抵挡","小型攻击","小型防御","中型攻击","中型防御","大型攻击","大型防御","技能伤害","技能减免"];this.display.attrList.array=[],this.display.attrList.itemRender=n;for(var h=[],l=a;o>l;l++){var c="";c+=2>l?r[l]+"："+(i[l][0]+i[l][1]+i[l][2]):8>l?r[l]+"："+parseInt(i[l][0]+i[l][1]+i[l][2])/100+"%":r[l]+"："+(i[l][0]+i[l][1]+i[l][2]),h.push({text:c})}this.display.attrList.array=h}},s.prototype.weaponTimeLeft=function(){if(this.skillData)for(var t=0;t<this.skillData.length;t++)1==this.skillData[t].has&&1==this.skillData[t].isage&&this.skillData[t].left_time>0&&(this.skillData[t].left_time=this.skillData[t].left_time-1);if(this.weaponData)for(var t=0;t<this.weaponData.length;t++)1==this.weaponData[t].has&&1==this.weaponData[t].isage&&this.weaponData.left_time>0&&(this.weaponData.left_time=this.weaponData.left_time-1)},s.prototype.onListRender=function(t,e){},s.prototype.showWeaponClass=function(t,e){void 0===e&&(e=0);for(var i=[[{n:"小型武器",idx:1,"var":"xiaoxing"},{n:"中型武器",idx:2,"var":"zhongxing"},{n:"大型武器",idx:3,"var":"daxing"}],[{n:"主动",idx:2,"var":"zhudong"},{n:"被动",idx:1,"var":"beidong"},{n:"防御",idx:4,"var":"fangyu"},{n:"辅助",idx:3,"var":"fuzhu"}]],s=[0,0,0,0,0],n=i[e],a=0;a<t.length;a++)1==t[a].has&&t[a].itype&&s[t[a].itype]++;for(var o=0;o<n.length;o++)this.display[n[o]["var"]].text=n[o].n+"x"+s[n[o].idx]},s.prototype.showWeapon=function(t){var e=this.getDate(),i=[],s=0;this.display.infoBox.visible=!1,this.display.weaponPanel.visible=!0,this.display.weaponList.itemRender=a,this.showWeaponClass(e,t-1),this.display.weaponList.array=i;for(var n=0;n<e.length;n++)s+=e[n].has,i.push({pic:this.getPic(e[n].id,parseInt(e[n].level)),has:e[n].has,type:t});2==t?(this.display.listBack.visible=!1,this.display.listBack2.visible=!0,this.display.weaponNum.text="技能（"+s+"/"+e.length+"）",this.display.effName.text="技能效果",this.display.goodsValue.text="",this.display.numBack.visible=!0,this.display.weaponClass.visible=!1,this.display.skillClass.visible=!0,this.display.weaponList.spaceY=15,this.display.weaponList.spaceX=15):(this.display.listBack.visible=!0,this.display.listBack2.visible=!1,this.display.weaponNum.text="武器（"+s+"/"+e.length+"）",this.display.effName.text="武器效果",this.display.numBack.visible=!1,this.display.weaponClass.visible=!0,this.display.skillClass.visible=!1,this.display.weaponList.spaceY=15,this.display.weaponList.spaceX=15),this.display.weaponList.array=i,this.showDetail(this.detailIndex),this.display.weaponList.selectedIndex=this.detailIndex},s.prototype.onWeaponRender=function(t,e){t.setData(this.display.weaponList.getItem(e),e,this.display.weaponList.selectedIndex==e)},s.prototype.onSelect=function(t){this.showDetail(t)},s.prototype.getDate=function(){var t=this.userMap.get([0,1,2][this.showIndex]),e=new Array;return e=2==this.showIndex?t.skills:t.weapons},s.prototype.getPic=function(e,i){void 0===i&&(i=0);var s="";return s=1==this.showIndex?t.ResPath().getPic(e,t.ResourcePath.PATH_WEAPON,i):t.ResPath().getPic(e,t.ResourcePath.PATH_SKILL,i)},s.prototype.showDetail=function(e){var i=this.getDate(),s=i[e];if(t.Tips.tipsClose(),this.display.goodsPic.skin="",this.selectItem&&(this.selectItem.selected=!1),this.selectItem=this.display.weaponList.selection,this.selectItem&&(this.selectItem.selected=!0),s){this.detailIndex=e,this.display.goodsPic.skin=this.getPic(s.id,parseInt(s.level)),this.display.goodsName.text=s.name,this.display.goodsType.text=s.type,this.display.goodsDesc.text=s.desc,this.display.upBtn.gray=!1;var n=parseInt(s.level),a=[];if(s.effect&&(this.display.goodsInfo.text=s.effect),s.extra_attr&&(this.display.goodsInfo1.text=s.extra_attr),1!=s.isage&&200018!=s.id&&300001!=s.id||1!=s.has?0==s.has?(this.display.upBtn.gray=!0,this.display.upBtn.label="获    取"):(this.display.upBtn.label="强    化",this.display.upBtn.gray=!1):(this.display.upBtn.label="不可强化",this.display.upBtn.gray=!0,this.display.goodsPic.filters=[]),1==s.isage){var o=t.DateUtils.getTimeFomateObj(s.left_time);n=10,this.display.leftTimeBox.visible=!0,this.display.upBtn.visible=!1,s.left_time<=0?this.display.leftTime.text="通过特定活动获得时效":s.left_time<60?this.display.leftTime.text="小于1分钟":s.left_time>4e7?this.display.leftTime.text="永久":this.display.leftTime.text=o.day+"天"+o.hour+"时"+o.minute+"分"}else this.display.leftTimeBox.visible=!1,this.display.upBtn.visible=!(this.puid&&this.puid!=t.Global.UID)&&0==this.layerType;
s.max_dmg&&s.min_dmg&&(this.display.goodsValue.text="伤害："+s.min_dmg+"-"+s.max_dmg),s.id>3e5?this.display.gemBox.visible=!1:this.display.gemBox.visible=!0;var r=0;if(this.userData.level>=13)if(this.removeGemEvent(),s.gems){this.gemDetail=s.gems;for(var h=0;4>h;h++)this.display["gemIcon"+h].skin="";for(var h=0;h<s.gems.length;h++)if(0!=s.gems[h].gem_id){var l=s.gems[h].spot_id-1+2*s.gems[h].gem_type;this.display["gemIcon"+l].skin=t.ResPath().getPic(s.gems[h].icon_id,t.ResourcePath.PATH_GOODS),this.display["gemIcon"+l].on(Laya.Event.CLICK,this,this.showGemTips,["gemIcon"+l,s.gems[h]]),r++;s.gems[h]}this.display.gemTitle.text=r>0?"魂珠镶嵌":"当前武器未镶嵌魂珠"}else this.gemDetail=[];else this.display.gemTitle.changeText("魂珠镶嵌(魂珠13级开放)"),this.display.gemIcon0.skin="ui/userinfo/img_suo.png",this.display.gemIcon2.skin="ui/userinfo/img_suo.png";this.userData.level<40?(this.display.gem3.x=80,this.display.gem2.visible=!1,this.display.gem4.visible=!1):(this.display.gem3.x=160,this.display.gem2.visible=!0,this.display.gem4.visible=!0);for(var h=0;n>h;h++)a.push({});this.display.starList.array=a}else this.display.goodsName.text="",this.display.goodsType.text="",this.display.goodsDesc.text="",this.display.goodsInfo.text="",this.display.goodsValue.text=""},s.prototype.removeGemEvent=function(){this.display.gemIcon0.off(Laya.Event.CLICK,this,this.showGemTips),this.display.gemIcon1.off(Laya.Event.CLICK,this,this.showGemTips),this.display.gemIcon2.off(Laya.Event.CLICK,this,this.showGemTips),this.display.gemIcon3.off(Laya.Event.CLICK,this,this.showGemTips)},s.prototype.showGemTips=function(e,i){var s,n,a,o=e,r={};n=this.display[o],o.indexOf("gemIcon")>-1&&(s=parseInt(o.split("gemIcon")[1])),i&&(a=n.localToGlobal(new laya.maths.Point(0,0)),r.name=i.goods_name,r.desc=i.gem_attr,t.Tips.show(r,a))},s.prototype.linkGem=function(){this.userData.level>=13?t.Facade.callCommand(new t.OpenGemCmd):t.WeakTips.show("魂珠镶嵌13级开放")},s.prototype.upgrade=function(){var e=this.getDate(),i=e[this.detailIndex],s=this.showIndex-1;if(this.display.upBtn.gray&&200018==i.id||300001==i.id)"获    取"==this.display.upBtn.label&&(200018==i.id&&t.Facade.callCommand(new t.ShowChangeRewardCmd(["成为达人可以获得【"+i.name+"】"])),300001==i.id&&t.Facade.callCommand(new t.ShowChangeRewardCmd(["成为5级达人可以获得【"+i.name+"】"])));else if(1==i.isage&&0==i.has)t.Facade.callCommand(new t.ShowChangeRewardCmd(["可以通过特定活动来获得时效【"+i.name+"】"]));else if(1==i.isage&&1==i.has);else if(200018==i.id||300001==i.id)t.Facade.callCommand(new t.ShowChangeRewardCmd(["成为达人可以获得【"+i.name+"】"]));else if(0==i.has)t.Facade.callCommand(new t.ShowChangeRewardCmd(["每次升级有概率领悟【"+i.name+"】"]));else{var n=new t.OpenUpOpCmd,a=[t.WSDef.WEAPON,t.WSDef.SKILL];n.type=a[s],n.id=i.id,t.Facade.callCommand(n),n.on(this,function(){this.loadInfo(this.showIndex)})}},s.prototype.showBoxTips=function(e,i){this.display.tipsBoxUp.visible=!0,this.display.tipsBoxUp.alpha=1,this.display.tipsBoxUp.y=i.y+40,this.display.tipsBoxUpTxt.text="生命：角色生命上限\n力量：影响攻击\n筋骨：影响防御、闪避、生命\n速度：影响出手顺序和行动频率",this.display.tipsBoxUpBg.height=182,t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.CLICK_SELFATTR)),this._tipsBoxUpTween&&(Laya.Tween.clear(this._tipsBoxUpTween),this._tipsBoxUpTween=null),this._tipsBoxUpTween=Laya.Tween.to(this.display.tipsBoxUp,{alpha:0},1e3,null,null,5500)},s.prototype.userUpgrade=function(){t.Facade.callCommand(new t.OpenStrengthBoxCommand)},s.prototype.getAvatar=function(e,i){var s={},n=Math.floor(e/10);return 3>n?n=0:n-=2,n>8&&(n=8),s=t.SelfInfo.getTitle(e),s.avatar=t.Global.ResPath+"avatar/"+i+"/"+(n+1)+".png",s},s.prototype.showtips=function(){this.display.tipsBox.visible=!0,this.display.tipsDesc.text="生命：角色生命上限\n力量：影响攻击\n筋骨：影响防御、闪避、生命\n速度：影响出手顺序和行动频率",this.display.tipsInfo.text="攻击：影响武器和空手的攻击伤害\n防御：降低所受伤害\n暴击：提升暴击概率，暴击造成额外50%伤害\n暴抗：降低被暴击的概率\n命中：提升命中率\n闪避：提升闪避率\n破防：降低对方抵挡概率\n抵挡：提升抵挡概率，抵挡受到伤害降低50%"},s.prototype.deleteFriend=function(){t.ConfirmBox.show(new t.ConfirmBoxData({contentStr:"确定要删除该好友吗？",callBackHandler:new Handler(this,this.sureDeleteFriend)}))},s.prototype.sureDeleteFriend=function(){t.XHR().Post({cmd:"sns",op:"del_in_fri",target_uid:this.puid},this,this.onDeleteBack)},s.prototype.onDeleteBack=function(e){0==e.result?(t.WeakTips.show("删除成功"),t.JSUtils.deleteFriend(this.puid),this.display.breakFriend.visible=!1):t.WeakTips.show(e.msg)},s.prototype.hidetips=function(){this.display.tipsBox.visible=!1},s.prototype.addPoint=function(){this.addCMD&&this.addCMD.off(),t.Tips.tipsClose();var e=this.userMap.get([0,1,2][0]);this.addCMD=new t.AddPointCommand(e,this),this.addCMD.on(this,function(){this.reload()}),t.Facade.callCommand(this.addCMD)},s.prototype.openServent=function(){if(this.puid&&this.puid!=t.Global.UID){if(this.userModel.level<t.UserModel.NEED_USERLV_SERVANT)return void t.WeakTips.show(t.UserModel.NEED_USERLV_SERVANT+"级开启家丁系统");if(this.m_data.level<t.UserModel.NEED_USERLV_SERVANT)return void t.WeakTips.show("对方未达"+t.UserModel.NEED_USERLV_SERVANT+"级，尚未开启家丁系统");var e=new t.OpenServentCmd;e.uid=Number(this.puid),e.hideAll=1,t.Facade.callCommand(e)}},s.prototype.openMarry=function(){if(this.puid&&this.puid!=t.Global.UID){this.m_data.uid=this.puid;var e=new t.OpenMarryBoxCommand(t.MarryViewType.TYPE_VIEW_MAIN,this.m_data);t.Facade.callCommand(e)}},s.prototype.openMonster=function(){this.puid&&this.puid!=t.Global.UID&&t.Facade.callCommand(new t.MonsterCommand("lookup",this.puid))},s.prototype.reload=function(){this.loadInfo()},s.prototype.boxHideHandler=function(e){"WsOpBox"==e&&t.WsOpBox.HAS_UPGRADE_SUCCESS&&this.loadInfo()},s.prototype.destroy=function(){t.removeListener(t.ViewEvent.BOX_HIDE,this,this.boxHideHandler),this._tipsBoxUpTween&&(Laya.Tween.clear(this._tipsBoxUpTween),this._tipsBoxUpTween=null),this.userModel.off(t.ModelEvent.UPDATE_FINISH,this,this.delayLoadInfo),this.removeGemEvent(),t.Tips.tipsClose(),this.addCMD&&this.addCMD.off(),this.cmdUserData=null,this.display.writeBtn.off(laya.events.Event.CLICK,this,this.showWriteBox),this.display.queDingBtn.off(laya.events.Event.CLICK,this,this.writeSumit),this.display.boxClose.off(laya.events.Event.CLICK,this,this.closeWriteBox),Laya.timer.clearAll(this),i.prototype.destroy.call(this)},s}(t.BaseBox);t.SelfAttr=s;var n=function(t){function e(){t.call(this),this.graphics.drawRect(20,0,248,45,null),this.fontSize=24,this.font="黑体",this.bold=!0,this.width=248,this.height=45}return __extends(e,t),e}(laya.ui.Label);t.UserAttrCon=n;var a=function(e){function s(){e.call(this),this.graphics.drawRect(0,0,105,105,null),this.width=105,this.height=105,this.pic=new i,this.pic.name="pic",this.pic.width=80,this.pic.height=80,this.pic.left=10,this.pic.top=10,this.backPic=new i,this.backPic.skin="ui/comp/goodsbg.png",this.selectPic=new i,this.addChild(this.backPic),this.addChild(this.selectPic),this.addChild(this.pic)}return __extends(s,e),s.prototype.setData=function(e,i,s){e&&(this.pic.skin="",this.pic.skin=e.pic,this.pic.filters=[],s?this.selectPic.visible=!0:this.selectPic.visible=!1,0==e.has&&(this.pic.filters=t.FiltersUtils.getGreyFilters()),1==e.type?(this.backPic.visible=!1,this.selectPic.skin="ui/userinfo/drxx-wuqixuanzhong.png"):(this.backPic.visible=!0,this.selectPic.skin="ui/comp/goods_choosebg.png"))},Object.defineProperty(s.prototype,"selected",{set:function(t){t?this.selectPic.visible=!0:this.selectPic.visible=!1},enumerable:!0,configurable:!0}),s}(laya.ui.Box);t.UserSkillItem=a}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.user.UserUI,!0,!0,!1,!1),this.contentlist=new Array,this.userData=new Object,this.display=this.skin,this.setCloseButton(this.display.back.closeBtn),this.display.tiliAdd.on(laya.events.Event.CLICK,this,this.addTili),this.display.combatLink.on(laya.events.Event.CLICK,this,this.userUpgrade),this.display.vipLink.on(laya.events.Event.CLICK,this,this.openVip),this.display.btn_marry.on(laya.events.Event.CLICK,this,this.openMarry),this.userModel=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),this.userModel.on(t.ModelEvent.UPDATE_FINISH,this,this.delayLoadInfo),this._facCMD=new t.GetFacInfoPanelCmd(0),this._facCMD.on(this,this.facInfofinish)}return __extends(i,e),i.prototype.init=function(){this.display.tf_bangPaiNone.text="9级开启",this.display.tf_marryNone.text="16级开启",this.display.tf_vipNone.text="5级开启",this.loadInfo()},i.prototype.loadInfo=function(){t.XHR().Post({cmd:"detail",op:"head",needreload:"1"},this,this.showInfo)},i.prototype.getAvatar=function(e,s){var n={},a=Math.floor(e/10);return 3>a?a=0:a-=2,a>8&&(a=8),n=i.getTitle(e),n.avatar=t.Global.ResPath+"avatar/"+s+"/"+(a+1)+".png",n},i.getTitle=function(t){var e=["乐斗小虾米","乐斗新星","乐斗强者","乐斗豪杰","乐斗大侠","乐斗名将","乐斗尊者","乐斗皇者","乐斗武帝"],i=["#FFFFFF","#3adf00","#26dbf0","#62a8ff","#b05cff","#f713ff","#ff8d31","#ff8d31","#ff471c"],s=Math.floor(t/10),n={};return 3>s?s=0:s-=2,s>8&&(s=8),n.text=e[Math.floor(s)],n.color=i[Math.floor(s)],n},i.prototype.delayLoadInfo=function(){this.display.tili.text=this.userModel.vit+"/100"},i.prototype.showInfo=function(e){if(0==e.result&&!this.destroyed){var i=["无","帮众","精英","","长老","副帮主","帮主"];e.fac_pos="无"==e.fac_pos?0:e.fac_pos,this.display.honorLink.filters=t.FiltersUtils.getGreyFilters(),this.userData=e,this.display.userFace.skin=e.headimgurl,this.display.userId.text="编号："+e.uid,this.display.userName.text=e.name,this.display.combat.text=e.attack_power+"",this.display.level.text=e.lvl+"级";var s=this.getAvatar(e.lvl,e.sex);this.display.avatar.skin=s.avatar,this.display.tili.text=e.vit+"/"+this.userModel.maxVit,e.achieve||(this.display.chengJiu.text="暂未开放"),this.display.expValue.text=e.exp+"/"+e.max_exp,this.display.expBar.value=e.exp/e.max_exp,this.userModel.attackPower!=e.attack_power&&(this.userModel.attackPower=this.userModel.attackPower,this.userModel.updateFinish()),this.display.userFace.loadImage(this.userModel.headimgurl,2,2,88,88),this.userModel.level>=5?(this.display.tf_vipNone.visible=!1,this.display.icon_vip.visible=!0,this.display.bg_vip.visible=!0,this.display.vipLevel.visible=!0,this.display.vipLevel.text=e.vip_lvl+"",this.display.vipLink.gray=!1):(this.display.tf_vipNone.visible=!0,this.display.icon_vip.visible=!1,this.display.bg_vip.visible=!1,this.display.vipLevel.visible=!1,this.display.vipLink.gray=!0),this.userModel.level>=9?(this.display.tf_bangPaiNone.visible=!1,this.display.factionName.visible=!0,this.display.factionId.visible=!0,this.display.factionPos.visible=!0,this.display.factionName.text="名称："+e.fac_name,this.display.factionId.text="帮派编号："+e.fac_id,this.display.factionPos.text="职位："+i[e.fac_pos/100],this.display.factionLink.gray=!1):(this.display.tf_bangPaiNone.visible=!0,this.display.factionName.visible=!1,this.display.factionId.visible=!1,this.display.factionPos.visible=!1,this.display.factionLink.gray=!0),this.display.factionLink.on(Laya.Event.CLICK,this,this.showFaction,[e.fac_id]),this.userModel.level>=16?(this.display.tf_marryNone.visible=!1,0==this.userModel.marryStatus?(this.display.tf_marryName.text="对象：无",this.display.tf_marryTitle.text="称号：无"):2==this.userModel.marryStatus||3==this.userModel.marryStatus?(this.display.tf_marryName.text="对象：",this.display.tf_marryTitle.text="称号：",this.display.btn_marry.gray=!1,this._marryCmd=new t.GetMarryDataCommand,this._marryCmd.on(this,this.showMarryData),t.Facade.callCommand(this._marryCmd)):(this.display.tf_marryNone.visible=!0,this.display.tf_marryName.text="",this.display.tf_marryTitle.text="")):(this.display.tf_marryNone.visible=!0,this.display.tf_marryName.text="",this.display.tf_marryTitle.text="",this.display.btn_marry.gray=!0)}},i.prototype.showMarryData=function(t){this.display&&(this.display.tf_marryName.text="对象："+t.queryData.couple.name,this.display.tf_marryTitle.text="称号："+t.queryData.title)},i.prototype.showFaction=function(e){this.userModel.level<9?t.WeakTips.show("该功能尚未开启"):"无"==e?t.Facade.singleton.callCommand(new t.FactionCommand):(this._facCMD.setData(e,null,650,250),this._facCMD.facInfoBox&&(this._facCMD.facInfoBox.visible=!1),t.Facade.singleton.callCommand(this._facCMD))},i.prototype.facInfofinish=function(){this._facCMD&&this._facCMD.facInfoBox&&(this._facCMD.facInfoBox.visible=!0,Laya.timer.once(8e3,this,this.hideFacBox),this._facCMD.facInfoBox.parent||this.display.addChild(this._facCMD.facInfoBox),this._facCMD.facInfoBox.x=this._facCMD.posX,this._facCMD.facInfoBox.y=this._facCMD.posY,this._facCMD.facInfoBox.y+this._facCMD.facInfoBox.facInfo_bg.height>t.LayerMgr.height+t.LayerMgr.offY&&(this._facCMD.facInfoBox.y-=this._facCMD.facInfoBox.y+this._facCMD.facInfoBox.facInfo_bg.height-(t.LayerMgr.height+t.LayerMgr.offY)))},i.prototype.hideFacBox=function(){this._facCMD.facInfoBox.visible=!1},i.prototype.userUpgrade=function(){t.Facade.callCommand(new t.OpenStrengthBoxCommand)},i.prototype.addTili=function(){t.Facade.callCommand(new t.GetGoodsCommand(["100001","100002","100003"]))},i.prototype.openVip=function(){this.userModel.level<5?t.WeakTips.show("该功能尚未开启"):t.Facade.callCommand(new t.OpenVipBoxCommand(0))},i.prototype.openMarry=function(){this.userModel.level<16?t.WeakTips.show("该功能尚未开启"):0==this.userModel.marryStatus?t.Facade.callCommand(new t.OpenMarryBoxCommand):2!=this.userModel.marryStatus&&3!=this.userModel.marryStatus||t.Facade.callCommand(new t.OpenMarryBoxCommand)},i.prototype.destroy=function(){e.prototype.destroy.call(this),this._facCMD&&(this._facCMD.off(),this._facCMD.destroy(),this._facCMD=null),this.display.factionLink.off(Laya.Event.CLICK,this,this.showFaction),this.display.tiliAdd.off(laya.events.Event.CLICK,this,this.addTili),this.display.combatLink.off(laya.events.Event.CLICK,this,this.userUpgrade),this.display.vipLink.off(laya.events.Event.CLICK,this,this.openVip),this.display.btn_marry.off(laya.events.Event.CLICK,this,this.openMarry),this.userModel.off(t.ModelEvent.UPDATE_FINISH,this,this.delayLoadInfo),this.userModel.off(t.ModelEvent.UPDATE_FINISH,this,this.delayLoadInfo),this._marryCmd&&(this._marryCmd.off(),this._marryCmd.destroy(),this._marryCmd=null)},i}(t.BaseBox);t.SelfInfo=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"UserInfoCommand":if(this.userUI)this.userUI.parent.setChildIndex(this.userUI,this.userUI.parent.numChildren-1);else if(this.userUI=new t.SelfAttr(e),this.userUI.SetInfo(e),this.userUI.on(t.ViewEvent.BOX_HIDE,this,this.onClosePanel),0!==e.layerType)this.userUI.show(t.Layer.TIP);else{var i=e.puid;i&&i!=t.Global.UID||this.checkIsFirstEnter(),this.userUI.show(t.Layer.BOX)}e.ecode=0,e.finish();break;case"SelfInfoCommand":this.selfUI||(this.selfUI=new t.SelfInfo),this.selfUI.on(t.ViewEvent.BOX_HIDE,this,this.onClosePanel),this.selfUI.show(),this.selfUI.init(),e.ecode=0,e.finish();break;case"AddPointCommand":var s=new t.AddPoint(e);s.show()}},s.prototype.checkIsFirstEnter=function(){var e=this.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);if(0==e.hasEnterRole){e.hasEnterRole=1;var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.GUIDE_MODEL);i.guidetaskID=80001}},s.prototype.onClosePanel=function(){this.userUI?(this.userUI.off(t.ViewEvent.BOX_HIDE,this,this.onClosePanel),this.userUI=null,this.unregisterPlugin()):this.selfUI&&(this.selfUI.off(t.ViewEvent.BOX_HIDE,this,this.onClosePanel),this.selfUI=null,this.unregisterPlugin())},s.prototype.getPluginName=function(){return e.PLUGIN_USERINFO},s}(t.Plugin);t.UserInfoModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"InviteFriendCommand":this._invitePanel||(this._invitePanel=new t.InviteFriendView),this._invitePanel.show();break;case"InviteRuleCommand":var i=new t.InviteRuleView;i.show()}},s.prototype.getPluginName=function(){return e.PLUGIN_INVITE_FRIEND},s}(t.Plugin);t.InviteFriendModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.friend.InviteFriendUI,!0,!1),this._display=this.skin,this.setCloseButton(this._display.back.closeBtn),this.cacheAs="none",this._display["static"].cacheAs="bitmap",this._isFirst=!0,this._display.list.itemRender=i,this._display.list.scrollBar.visible=!1,this._display.list.renderHandler=new Handler(this,this.onListRender),this._display.tab.labels="邀\n\n请,奖\n\n励",this._display.tab.selectHandler=new Handler(this,this.onSelectTab),this._display.turnBtn.on(Laya.Event.CLICK,this,this.onClickTurn),this._display.ruleBtn.on(Laya.Event.CLICK,this,this.onClickRule),this._display.inviteBtn.on(Laya.Event.CLICK,this,this.onClickInvite),this._itemIndexMap={},t.Global.isWX&&(Browser.onIOS?this._display.invite.skin="ui/invite_friend/img_001.jpg":this._display.invite.skin="ui/invite_friend/img_002.jpg")}return __extends(s,e),s.prototype.destroy=function(){this._display.turnBtn.off(Laya.Event.CLICK,this,this.onClickTurn),this._display.ruleBtn.off(Laya.Event.CLICK,this,this.onClickRule),this._display.inviteBtn.off(Laya.Event.CLICK,this,this.onClickInvite),e.prototype.destroy.call(this)},s.prototype.onShowed=function(){this._isFirst?this._isFirst=!1:this.resetImageSkin(this),t.addListener(s.INVITEFRIEND_UPDATE,this,this.update),t.XHR().Post({cmd:"sns",op:"invite_view",needreload:"1"},this,this.updatePanel),t.Global.isWX?(this._display.tab.visible=!0,this._display.tab.selectedIndex=0,this._display.tabline1.visible=!0,this._display.tabline2.visible=!0,this._display.tabline3.visible=!0,this._display.inviteBtn.visible=!1):(this._display.tab.visible=!1,this._display.tab.selectedIndex=1,this._display.tabline1.visible=!1,this._display.tabline2.visible=!1,this._display.tabline3.visible=!1),this._display.select0.visible=!1,this._display.select1.visible=!1,this._display.select2.visible=!1,this._display.select3.visible=!1,this._display.select4.visible=!1,this._display.select5.visible=!1,e.prototype.onShowed.call(this)},s.prototype.onHided=function(){e.prototype.onHided.call(this),t.removeListener(s.INVITEFRIEND_UPDATE,this,this.update),Laya.loader.clearRes("res/atlas/ui/invite_friend.json"),Laya.loader.clearRes("ui/invite_friend/img_zhuanpanditu.png"),Laya.loader.clearRes("ui/invite_friend/img_tiaofu.png"),Laya.loader.clearRes("ui/invite_friend/img_001.jpg"),Laya.loader.clearRes("ui/invite_friend/img_002.jpg")},s.prototype.onSelectTab=function(t){0==t?(this._display.reward.visible=!1,this._display.invite.visible=!0,this._display.turnBtn.visible=!1,this._display.di.visible=!1):(this._display.reward.visible=!0,this._display.invite.visible=!1,this._display.turnBtn.visible=!0,this._display.di.visible=!0)},s.prototype.onClickInvite=function(){t.Global.isWXAPP?t.ShareModule.shareMessage({title:[t.Global.GameName],desc:["游戏就要轻轻松松~企鹅会武功，斗斗狠轻松！","本鹅在此郑重的向你发起挑战，求虐求虐！你敢应战吗？","见过企鹅打架嘛？没见过还不来看看！"],share_type:0,image_url:"https://res.ledou.qq.com/share_friend.jpg",back:!0},null,1):t.ShareModule.shareMessage({title:[t.Global.GameName],desc:["游戏就要轻轻松松~企鹅会武功，斗斗狠轻松！","本鹅在此郑重的向你发起挑战，求虐求虐！你敢应战吗？","见过企鹅打架嘛？没见过还不来看看！"],share_type:0,back:!0},null,1)},s.prototype.onClickTurn=function(){this._curData&&t.XHR().Post({cmd:"sns",op:"invite_dial"},this,this.dialResult)},s.prototype.onTurnOver=function(e,i){this._display.turnBtn.rotation-=720,t.Facade.callCommand(new t.SyncChangeCmd(e,!0)),this._display.turnBtn.filters=t.FiltersUtils.getGreyFilters(),this._display.select0.visible=!1,this._display.select1.visible=!1,this._display.select2.visible=!1,this._display.select3.visible=!1,this._display.select4.visible=!1,this._display.select5.visible=!1,this._display["select"+i].visible=!0,this.update()},s.prototype.onClickRule=function(){var e="<img src='ui/comp/icon.png'></img>邀请您的好友进入游戏即可领取丰厚的游戏奖励~<br><img src='ui/comp/icon.png'></img>奖励分为每日奖励和累积奖励俩部分，每日只需要邀请一个好友进入游戏即可领取一份每日随机奖励；当累计邀请好友数达到要求还有更丰富的奖励可以领取哦！<br><img src='ui/comp/icon.png'></img>邀请的好友必须是没有进入过乐斗世界的新朋友才会算作有效邀请哦~ 赶紧拉上你的朋友一起来乐斗吧！<br>";t.RulePanel.showRule(e,"")},s.prototype.dialResult=function(e){if(0==e.result){this._curData.can_dial=0,this._curData.dial_num--,this._display.numTxt.text=this._curData.dial_num+"次";var i=0;if(e.changed&&e.changed.items&&e.changed.items.length>0){var s=e.changed.items[0].id+"_"+e.changed.items[0].num;i=this._itemIndexMap[s]?this._itemIndexMap[s]:0}Laya.Tween.to(this._display.turnBtn,{rotation:720+60*i},600,null,Handler.create(this,this.onTurnOver,[e,i]))}else t.WeakTips.show(e.msg)},s.prototype.update=function(){this.updatePanel(this._curData)},s.prototype.updatePanel=function(e){if(0==e.result){if(this._curData=e,this._display.numTxt.text=e.dial_num+"次",this._display.haveTxt.text=e.total_num+"人",this._display.list.array=e.gift_array,this._display.list.array&&this._display.list.array.length>0){for(var i=!0,s=0;s<this._display.list.array.length;s++)if(1!=this._display.list.array[s].flag){i=!1;break}if(i&&0==e.dial_num){var n=t.Facade.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);n.setLongDataValue(t.ServerSetDataModel.KEY_NEED_TO_HIDE_INVITE,1)}}1==this._curData.can_dial?this._display.turnBtn.filters=null:this._display.turnBtn.filters=t.FiltersUtils.getGreyFilters();for(var a=e.dial_info.items,o=a.length,s=0;o>s;s++)this._display["item"+s].loadImage(t.ResPath().getPic(a[s].icon_id,t.ResourcePath.PATH_GOODS),0,0,57,57),this._display["itemTxt"+s].text=a[s].num+"",this._itemIndexMap[a[s].id+"_"+a[s].num]=s}else t.WeakTips.show(e.msg)},s.prototype.onListRender=function(t,e){t.setData(this._display.list.getItem(e),e)},s.INVITEFRIEND_UPDATE="INVITEFRIEND_UPDATE",s}(t.BaseBox);t.InviteFriendView=e;var i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.destroy=function(){i.prototype.destroy.call(this),t.Tips.tipsClose()},s.prototype.setData=function(e,i){if(this.gift_0.visible=!1,this.gift_1.visible=!1,this.gift_2.visible=!1,this.gift_3.visible=!1,this.gift_4.visible=!1,this.gift_5.visible=!1,this["gift_"+i].visible=!0,this["gift_"+i].on(Laya.Event.CLICK,this,this.onClickTips),e){this._curData=e,this.title.text="邀请"+e.cond+"个";var s=parseInt(e.flag);switch(this.getBtn.off(Laya.Event.CLICK,this,this.onClickGet),s){case-1:this.getBtn.filters=t.FiltersUtils.getGreyFilters(),this.getBtn.label="领 取";break;case 0:this.getBtn.on(Laya.Event.CLICK,this,this.onClickGet),this.getBtn.filters=[],this.getBtn.label="领 取";break;case 1:this.getBtn.filters=t.FiltersUtils.getGreyFilters(),this.getBtn.label="已 领"}}},s.prototype.onClickTips=function(){var e,i={};e=this.localToGlobal(new laya.maths.Point(0,0)),i.name="礼包"+this._curData.gift_id,i.info=this._curData.gift_desc,i.desc=" ",t.Tips.show(i,e)},s.prototype.onClickGet=function(){t.XHR().Post({cmd:"sns",op:"invite_reward",gift_id:this._curData.gift_id},this,this.getResult)},s.prototype.getResult=function(i){0==i.result?(t.Facade.callCommand(new t.SyncChangeCmd(i)),this._curData.flag=1,this.getBtn.filters=t.FiltersUtils.getGreyFilters(),this.getBtn.label="已 领",this.getBtn.off(Laya.Event.CLICK,this,this.onClickGet),t.dispatch(e.INVITEFRIEND_UPDATE)):t.WeakTips.show(i.msg)},s}(ui.friend.InviteRewardItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this,new ui.friend.InviteRuleUI,!0,!0),this._display=this.skin,this.setCloseButton(this._display.back.boxClose),this._display.back.msgTitile.text="规则说明",this._display.back.confirmBtn.visible=!1,this._display.back.msgContent.text="",this._display.contentTxt.text="1.邀请您的微信好友进入游戏即可领取丰厚的游戏奖励~\n2.奖励分为每日奖励和累积奖励俩部分，每日只需要邀请一个好友进入游戏即可领取一份每日随机奖励；当累计邀请好友数达到要求还有更丰富的奖励可以领取哦！"}return __extends(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(t.BaseBox);t.InviteRuleView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this),this.m_mode=0,this.needCheckBeyond=!1}return __extends(s,i),s.prototype.initialize=function(e){this.m_mgr=new t.LilianMgr,this.m_mgr.initialize()},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"LilianCmd":var i=e;this.m_nowSceneInfo&&Number(this.m_nowSceneInfo.id)==i.sceneId?i.finish():this.getCopyData(i),this.getMapFriendList();break;case"OpenGuankaCmd":this.checkLevelInfo(this.m_nowSceneInfo,e.gi);break;case"SweepCmd":this.m_resultView&&this.m_resultView.isShowed&&this.m_resultView.hide(),this.sweep(e);break;case"ReqFightCmd":this.reqFight(e);break;case"GetGiftCmd":this.getGift(e);break;case"OpenMapCmd":var s=new t.MapView;s.show(this.m_mgr)}},s.prototype.getCopyData=function(e){t.XHR().Post({file:"petpk",cmd:"mappush",subcmd:"GetUser",uid:t.Global.UID,dup:e.sceneId},this,function(i){0==i.result?(this.m_mgr.setLilianData(i),0!=e.sceneId&&1e4!=e.sceneId||(e.sceneId=i.userinfo.thisdup),e.finish(),this.openScene(e.sceneId)):(1==e["default"]&&1e4==e.sceneId&&(e.sceneId=0,e["default"]=0,this.getCopyData(e)),t.WeakTips.show(i.msg))})},s.prototype.openScene=function(e){this.m_sceneView?(this.m_nowSceneInfo=this.m_mgr.getSceneInfoById(e),this.m_sceneView.setData(this.m_nowSceneInfo,this.m_mgr)):(this.m_sceneView=new t.SceneView,this.m_sceneView.on(t.ViewEvent.BASE_DESTROY,this,this.sceneDestroy),this.m_nowSceneInfo=this.m_mgr.getSceneInfoById(e),this.m_sceneView.setData(this.m_nowSceneInfo,this.m_mgr),t.SceneMgr.changeScene(this.m_sceneView))},s.prototype.sceneDestroy=function(){this.m_sceneView.off(t.ViewEvent.BASE_DESTROY,this,this.sceneDestroy),this.m_sceneView.destroy(),this.m_sceneView=null,this.m_levelView&&(this.m_levelView.destroy(),this.m_levelView=null),this.m_resultView&&(this.m_resultView.destroy(),this.m_resultView=null),this.m_nowSceneInfo=null,this.unregisterPlugin()},s.prototype.checkLevelInfo=function(e,i){t.XHR().Post({file:"petpk",cmd:"mappush",subcmd:"EnterLevel",uid:t.Global.UID,dup:e.id,level:i.id},this,function(s){"0"==s.result?(this.m_mgr.setGkData(e.id,i.id,s),this.openLevelView(e,i)):t.WeakTips.show(s.msg)})},s.prototype.openLevelView=function(e,i){this.m_levelView||(this.m_levelView=new t.LevelView),this.m_levelView.setData(e,i,this.m_mgr),this.m_levelView.show()},s.prototype.sweep=function(e){t.XHR().Post({file:"petpk",cmd:"mappush",subcmd:"MoppingUp",uid:t.Global.UID,dup:e.sceneId,level:e.gkId,times:e.count},this,function(i){0==i.result?(this.m_resultView||(this.m_resultView=new t.SweepResultView),this.m_resultView.setData(i,e),this.m_resultView.show(),t.Facade.callCommand(new t.SyncChangeCmd(i))):100==i.result?0==e.mode?t.Facade.callCommand(new t.GetGoodsCommand(["100015"])):t.Facade.callCommand(new t.GetGoodsCommand(["100123"])):t.WeakTips.show(i.msg)})},s.prototype.reqFight=function(e){this.needCheckBeyond=!1,t.XHR().Post({file:"petpk",cmd:"mappush",subcmd:"DoPk",uid:t.Global.UID,dup:e.sid,level:e.gkId},this,function(i){if(0==i.result){if(this.beyondData=i,1==i.win&&(this.m_mgr.setLilianData(i),this.m_sceneView.update(),e.isBoss&&this.m_mgr.removeGkData(e.sid,e.gkId),e.isMaxGk&&(this.needCheckBeyond=!0,this.beyondRfc=e)),1==i.start_new_dup&&this.m_sceneView.onNext(),this.m_levelView.hide(),0==this.m_mgr.mode&&this.m_levelView.m_ui.checkB.selected&&(!e.isMaxGk||e.star>0)){t.Facade.callCommand(new t.SyncChangeCmd(i,!1)),t.dispatch(t.BuffIcons.BUFF_ICONS_UPDATE);var s="";if(i.hasOwnProperty("award")){for(var n,a=i.award,o=a.attrs.concat(a.items),r=0;r<o.length;r++){var h="";r>0?s+="，":h="获得",n=o[r],s+=h+n.name+"*"+n.num}s+="。"}t.WeakTips.show(i.msg+s),this.onFightEnd()}else{var l=new t.FightCommand(i);l.rfc=e,l.plot_id_begin=e.plot_id_begin,l.plot_id_end=e.plot_id_end,l.on(this,this.reFight),t.addListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.onFightEnd),t.Facade.callCommand(l),this.mFc=l}1==i.win&&(e.isMaxGk=!1)}else 100==i.result?Number(e.sid)<1e3?t.Facade.callCommand(new t.GetGoodsCommand(["100015"])):t.Facade.callCommand(new t.GetGoodsCommand(["100123"])):t.WeakTips.show(i.msg)})},s.prototype.onFightEnd=function(){this.mFc&&(this.mFc.off(),this.mFc=null),t.removeListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.onFightEnd),this.needCheckBeyond&&this.m_sceneView&&this.m_sceneView.checkBeyond(this.beyondRfc.sid,this.beyondRfc.gkId,1==this.beyondData.start_new_dup),Laya.timer.frameOnce(1,this,this.updateEnegy)},s.prototype.updateEnegy=function(){this.m_sceneView&&this.m_sceneView.updateEnergy(this.beyondData.energy)},s.prototype.reFight=function(t){t.off(),this.mFc=null,t.isRefight&&this.reqFight(t.rfc)},s.prototype.getGift=function(e){t.XHR().Post({file:"petpk",cmd:"mappush",subcmd:"GetPrize",uid:t.Global.UID,star:e.index,dup:e.dup},this,function(i){0==i.result?(this.m_mgr.changeGiftState(Number(e.dup),e.index),this.m_sceneView&&this.m_sceneView.refreshGift(),t.Facade.callCommand(new t.SyncChangeCmd(i))):t.WeakTips.show(i.msg)})},s.prototype.getMapFriendList=function(){t.XHR().Post({file:"petpk",cmd:"mappush",subcmd:"fri",uid:t.Global.UID},this,function(e){0==e.result?this.m_sceneView&&this.m_sceneView.setMapFriendList(e.friendlist):t.WeakTips.show(e.msg)})},s.prototype.getPluginName=function(){return e.PLUGIN_LILIAN},s}(t.Plugin);t.LilianModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.ui.Button,i=laya.display.Sprite,s=function(i){function s(){i.call(this),this.DOT_WIDTH=26,this.DOT_HEIGHT=18}return __extends(s,i),s.prototype.setData=function(e,i){this.m_data=e,this._mgr=i,this.m_data.isBoss?(this.size(109,126),this.m_boss||(this.m_boss=new ui.lilian.BossItemUI,this.m_friList=this.m_boss.friendList,t.SceneView.npcLayer.addChild(this.m_friList)),this.m_btn&&this.m_btn.removeSelf(),this.m_boss.friendList.setData([]),this.pivotX=80,this.pivotY=60,this.m_boss.npcCom.graphics.clear(),this.m_boss.npcCom.loadImage(t.ResPath().getPic(this.m_data.resId,t.ResourcePath.PATH_NPC_PIC),0,0),this.addChild(this.m_boss),this.m_boss.kuang.visible=1==this._mgr.mode):(this.pivotX=0,this.pivotY=0,this.m_btn||(this.m_btn=this.getNpcBtn()),this.m_boss&&this.m_btn.removeSelf(),this.m_friList&&this.m_friList.removeSelf(),this.addChild(this.m_btn)),this.on(laya.events.Event.CLICK,this,this.onClick)},Object.defineProperty(s.prototype,"star",{set:function(t){for(var e=t,i=1;3>=i;i++)e>=i?(this.m_boss["starLight_"+i].visible=!0,this.m_boss["starDark_"+i].visible=!1):(this.m_boss["starLight_"+i].visible=!1,this.m_boss["starDark_"+i].visible=!0)},enumerable:!0,configurable:!0}),s.prototype.updateFriList=function(t){this.m_boss.friendList.setData(t),this.m_friList.x=this.x-50,this.m_friList.y=this.y-128},Object.defineProperty(s.prototype,"gi",{get:function(){return this.m_data},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"enable",{set:function(e){this.m_data.isBoss?e?(t.Util.enable(this.m_boss.npcCom),this.m_boss.mlock.visible=!1,this.mouseEnabled=!0):(t.Util.toGrayAndDisabled(this.m_boss.npcCom),this.m_boss.mlock.visible=!0,this.mouseEnabled=!1):e?t.Util.enable(this):t.Util.toGrayAndDisabled(this),
this.m_data.isBoss||1!=this._mgr.mode||t.Util.toGrayAndDisabled(this)},enumerable:!0,configurable:!0}),s.prototype.checkBtn=function(e){this.isBoss||(this.pivotX=0,this.pivotY=0,this.m_boss&&this.m_btn.removeSelf(),e!=this.isBig&&(this.m_btn&&(this.m_btn.removeSelf(),this.m_btn.destroy()),this.m_btn=e?this.getNpcBigBtn():this.getNpcBtn(),this.addChild(this.m_btn))),e&&0!=this._mgr.mode?(this._sk||(this._sk=new t.AnimationSKe(t.ResPath().getEffect("skeleton"))),this.addChild(this._sk),this._sk.x=55,this._sk.y=57,this._sk.play(0,!0)):this._sk&&(this._sk.stop(),this.removeChild(this._sk))},s.prototype.onClick=function(){var e=new t.OpenGuankaCmd;e.gi=this.m_data,t.Facade.callCommand(e)},Object.defineProperty(s.prototype,"isBoss",{get:function(){return this.m_data.isBoss},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"data",{get:function(){return this.m_data},enumerable:!0,configurable:!0}),s.prototype.getNpcBtn=function(){var t=new e;return t.loadImage("ui/lilian/btn_dot.png",(50-this.DOT_WIDTH)/2,(50-this.DOT_HEIGHT)/2),t.stateNum=1,t.size(50,50),t.pivotX=t.width/2,t.pivotY=t.height/2,this.isBig=!1,t},s.prototype.getNpcBigBtn=function(){var t=new e;return t.loadImage("ui/lilian/btn_dot_big.png",0,0),t.stateNum=1,t.size(77,61),t.pivotX=t.width/2,t.pivotY=t.height/2,this.isBig=!0,t},s.prototype.destroy=function(){this.m_friList&&(this.m_friList.removeSelf(),this.m_friList.destroy()),this._sk&&(this._sk.destroy(),this._sk=null),this._mgr=null,i.prototype.destroy.call(this)},s}(i);t.NpcItem=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.lilian.LevelOpUI,!0,!1,!0,!1),this.name="LilianLevelView",this.m_ui=this.skin,this.setCloseButton(this.m_ui.closeBtn),this.m_ui.btnSweepTen.on(Laya.Event.CLICK,this,this.sweep,[10]),this.m_ui.btnFight.on(Laya.Event.CLICK,this,this.fight),this.m_ui.dropGifts.selectEnable=!0,this.m_ui.dropGifts.mouseHandler=new Handler(this,this.onTips),this.m_ui.checkB.clickHandler=new Handler(this,this.onClickCheckBox);var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);this.m_ui.checkB.selected=1==i.lilianSkipFight,this.skipFight=this.m_ui.checkB.selected,this.size(t.LayerMgr.width,t.LayerMgr.height)}return __extends(i,e),i.prototype.setData=function(t,e,i){this.m_sceneInfo=t,this.m_gi=e,this.m_mgr=i},i.prototype.draw=function(){this.m_ui.tfTitle.text=this.m_gi.name,this.m_ui.tfDesc.text=this.m_gi.desc,this.m_ui.tfCost.text=(0==this.m_mgr.mode?"江湖令×":"英雄江湖令×")+this.m_gi.stamina,this.m_ui.goalList.array=this.getGoalData(),this.m_ui.shortcut.graphics.clear(),this.m_ui.shortcut.loadImage(t.ResPath().getLilianShotcut(this.m_sceneInfo.id)),this.m_gi.isBoss?(this.m_ui.starBox.visible=!0,this.m_ui.info1.visible=!0,this.m_ui.btnSweepTen.visible=!0,this.m_ui.info1.y=329,this.m_ui.info2.y=425,this.updateStar()):(this.m_ui.starBox.visible=!1,this.m_ui.info1.visible=!1,this.m_ui.btnSweepTen.visible=!1,this.m_ui.info2.y=329);var e=this.m_mgr.getGkInfo(this.m_sceneInfo.id,this.m_gi.id),i=[];if(e){var s=e.gift.attrs||[];e.gift.items&&(s=s.concat(e.gift.items)),this.tipsArr=s;for(var n,a=0;a<s.length;a++)n=s[a],i.push({goodsIcon:{skin:t.ResPath().getPic(n.id,t.ResourcePath.PATH_GOODS)},countTxt:"X"+n.num})}this.m_ui.checkSp.visible=0==this.m_mgr.mode&&!this.m_mgr.isMaxGk(Number(this.m_sceneInfo.id),Number(this.m_gi.id)),t.Util.enable(this.m_ui.btnSweepTen),this.m_ui.tfLimit.visible=0!=this.m_mgr.mode,1==this.m_mgr.mode?(this.m_ui.tfLimit.text="今日剩余"+e.left_times+"次",this.m_ui.btnSweepTen.label="扫荡"+e.left_times+"次"):this.m_ui.btnSweepTen.label="扫荡10次",1==this.m_mgr.mode&&e.left_times<=0?t.Util.toGrayAndDisabled(this.m_ui.btnSweepTen):e.star>=3?t.Util.enable(this.m_ui.btnSweepTen):t.Util.toGray(this.m_ui.btnSweepTen),this.m_ui.dropGifts.array=i},i.prototype.onTips=function(e,i){var s=this.m_ui.dropGifts.localToGlobal(this.m_ui.dropGifts.getMousePoint()),n={};this.tipsArr[i]&&(n.name=this.tipsArr[i].name,n.desc=this.tipsArr[i].desc,t.Tips.show(n,s))},i.prototype.onClickCheckBox=function(){if(this.skipFight!=this.m_ui.checkB.selected){this.skipFight=this.m_ui.checkB.selected;var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);e.lilianSkipFight=this.m_ui.checkB.selected?1:0}},i.prototype.updateStar=function(){for(var t=this.m_mgr.getStar(this.m_sceneInfo.id,this.m_gi.id),e=1;3>=e;e++)t>=e?(this.m_ui["starLight_"+e].visible=!0,this.m_ui["starDark_"+e].visible=!1):(this.m_ui["starLight_"+e].visible=!1,this.m_ui["starDark_"+e].visible=!0)},i.prototype.getGoalData=function(){var t=[],e=this.m_mgr.getGkInfo(this.m_sceneInfo.id,this.m_gi.id);return t.push({gou:{visible:e.star>0},tfGoal:"完成关卡"}),this.m_gi.round>0&&t.push({gou:{visible:e.rdcondition>0},tfGoal:"血量剩余"+this.m_gi.round/100+"%以上"}),this.m_gi.lefthp>0&&t.push({gou:{visible:e.hpcondition>0},tfGoal:"血量剩余"+this.m_gi.lefthp/100+"%以上"}),t},i.prototype.fight=function(){var e=this.m_mgr.getGkInfo(this.m_sceneInfo.id,this.m_gi.id),i=new t.ReqFightCmd;i.sid=this.m_sceneInfo.id,i.gkId=this.m_gi.id,i.star=this.m_mgr.getStar(this.m_sceneInfo.id,this.m_gi.id),i.isMaxGk=this.m_mgr.isMaxGk(Number(this.m_sceneInfo.id),Number(this.m_gi.id)),i.plot_id_begin=e.star>0||"0"==this.m_gi.plotId?"":this.m_gi.plotId+"_0",i.plot_id_end=e.star>0||"0"==this.m_gi.plotId?"":this.m_gi.plotId+"_1",i.isBoss=this.m_gi.isBoss,t.Facade.callCommand(i)},i.prototype.sweep=function(e){var i=this.m_mgr.getGkInfo(this.m_sceneInfo.id,this.m_gi.id);if(i.star>=3){var s=new t.SweepCmd;s.sceneId=this.m_sceneInfo.id,s.gkId=this.m_gi.id,0==this.m_mgr.mode?s.count=e:s.count=i.left_times,s.mode=this.m_mgr.mode,t.Facade.callCommand(s),0!=this.m_mgr.mode&&this.hide()}else t.WeakTips.show("只有三星通关boss关卡才可以开启扫荡功能哦～")},i.prototype.onHided=function(){e.prototype.onHided.call(this),Laya.loader.clearRes(t.ResPath().getLilianShotcut(this.m_sceneInfo.id))},i}(t.BaseBox);t.LevelView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.MAX_COPY_INDEX=15,this.mainLayer.cacheAs="bitmap",this.on(Laya.Event.CLICK,this,this.clickHandler),this._djSk=new t.AnimationSKe("assets/skeleton/lilian.sk"),this.arrow.addChild(this._djSk),this._djSk.play(0,!0),this.arrow.visible=!1,this.btnClose.x-=t.Global.FLOAT_ICON_OFFSET}return __extends(i,e),i.prototype.show=function(e){this._mgr=e;var i=0==e.mode?e.curDup:e.maxHeroDup;i%=1e3;for(var s=1;s<=this.MAX_COPY_INDEX;s++)i>=s?t.Util.enable(this["mbtn_"+s]):t.Util.toGrayAndDisabled(this["mbtn_"+s]),s==i&&(this.arrow.visible=!0,this.arrow.x=this["mbtn_"+s].x+this["mbtn_"+s].width/2,this.arrow.y=this["mbtn_"+s].y+this["mbtn_"+s].height/4);Laya.loader.load("ui/lilian/map.png",Handler.create(this,this.onLoad))},i.prototype.onLoad=function(){t.LayerMgr.addChild(this,t.Layer.BOX),this.background.skin="ui/lilian/map.png"},i.prototype.clickHandler=function(t){if(-1!=t.target.name.indexOf("mbtn_")){var e=Number(t.target.name.split("_")[1]);e=0==this._mgr.mode?e:1e4+e,this.openScene(e)}"btnClose"==t.target.name&&this.close()},i.prototype.openScene=function(e){var i=new t.LilianCmd;i.sceneId=e,i.on(this,this.finish),t.Facade.callCommand(i)},i.prototype.finish=function(t){t.off(),this.close()},i.prototype.close=function(){Laya.timer.frameOnce(1,this,this.clearRes),t.LayerMgr.removeChild(this)},i.prototype.clearRes=function(){this._djSk&&(this._djSk.destroy(),this._djSk=null),this.destroy(),Laya.loader.clearRes("ui/lilian/map.png")},i}(ui.lilian.MapUI);t.MapView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.lilian.CopyUI),this.PROGRESS_WIDTH=548,this.PROGRESS_START_X=43,this.m_djPath="assets/skeleton/lilian.sk",this._display=this.skin,this._display.mainLayer.cacheAs="bitmap",this._display.arrow.visible=!1,this._display.background.on(Laya.Event.CLICK,this,this.closeTips),this._display.boxComp_1.on(Laya.Event.CLICK,this,this.showTips,[0,this._display.boxComp_1]),this._display.boxComp_2.on(Laya.Event.CLICK,this,this.showTips,[1,this._display.boxComp_2]),this._display.boxComp_3.on(Laya.Event.CLICK,this,this.showTips,[2,this._display.boxComp_3]),this._display.btnTreasure_1.on(Laya.Event.CLICK,this,this.getGift,[1]),this._display.btnTreasure_2.on(Laya.Event.CLICK,this,this.getGift,[2]),this._display.btnTreasure_3.on(Laya.Event.CLICK,this,this.getGift,[3]),this._display.on(Laya.Event.CLICK,this,this.clickHandler),this.m_um=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL),this._display.buffIcons.updateBuffs(),this._display.buffIcons.visible=this.m_um.level>=6,i.npcLayer=this._display.npcLayer,this.m_djSk=new t.AnimationSKe(this.m_djPath),this.m_djSk.play(0,!0),this._display.arrow.addChild(this.m_djSk),(t.Global.isWX||t.Global.isWXAPP)&&(this._display.buffIcons.x-=t.Global.FLOAT_ICON_OFFSET,this._display.orderComp.x-=t.Global.FLOAT_ICON_OFFSET,this._display.btnWorld.x-=t.Global.FLOAT_ICON_OFFSET,this._display.btnBack.x-=t.Global.FLOAT_ICON_OFFSET,this._display.normalModeBtn.x-=t.Global.FLOAT_ICON_OFFSET,this._display.heroModeBtn.x-=t.Global.FLOAT_ICON_OFFSET)}return __extends(i,e),i.prototype.setData=function(e,i){this.m_npcs&&this.m_npcs.length>0&&this.clearNpcLayer(),this.m_sceneInfo&&this.m_sceneInfo.id!=e.id&&(this.clearId=this.m_sceneInfo.id,Laya.timer.frameOnce(1,this,this.clearBg)),this.m_sceneInfo=e,this.m_mgr=i,this.m_gkData=i.getGkData(e.id),this._mode=Number(e.id)<1e3?0:1,this._display.flag.visible=1==this._mode,this._display.heroBg.visible=1==this._mode,0==this._mode?(this._display.normalModeBtn.visible=!1,this._display.heroModeBtn.visible=!0,this._display.imgProp.skin="ui/lilian/ling.png",this.m_um.level<14||this.m_mgr.curDup<4?t.Util.toGray(this._display.heroModeBtn):t.Util.enable(this._display.heroModeBtn)):1==this._mode&&(this._display.normalModeBtn.visible=!0,this._display.heroModeBtn.visible=!1,this._display.imgProp.skin="ui/lilian/senior_ling.png"),t.Global.isWXAPP&&(this._display.heroModeBtn.visible=!1),this.m_um.on(t.ModelEvent.UPDATE_FINISH,this,this.userModelUpdate),this.userModelUpdate(),this.changeScene()},i.prototype.clickHandler=function(e){switch(e.target){case this._display.normalModeBtn:var i=new t.LilianCmd;i.sceneId=0,t.Facade.callCommand(i);break;case this._display.heroModeBtn:if(t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.HERO_BTN_CLICK)),this.m_um.level<14)t.WeakTips.show("英雄试练14级后开启");else if(this.m_mgr.curDup<4)t.WeakTips.show("通关第三章【林松城】方可进入英雄试练！");else{var i=new t.LilianCmd;i.sceneId=1e4,t.Facade.callCommand(i)}break;case this._display.btnPre:var s=Number(this.m_sceneInfo.id);s%1e3>1&&this.gotoScene(s-1);break;case this._display.btnNext:this.onNext();break;case this._display.buyOrderBtn:0==this._mode?t.Facade.callCommand(new t.GetGoodsCommand(["100015"])):t.Facade.callCommand(new t.GetGoodsCommand(["100123"]));break;case this._display.btnWorld:t.Facade.callCommand(new t.OpenMapCmd);break;case this._display.btnBack:t.FriendListShowBox.singleton.hide(),t.Facade.callCommand(new t.HomeCommand)}},i.prototype.onNext=function(){var t=Number(this.m_sceneInfo.id);(0==this._mode&&t<this.m_mgr.curDup||1==this._mode&&t<this.m_mgr.maxHeroDup)&&this.gotoScene(t+1)},i.prototype.setMapFriendList=function(e){this.friMap=new laya.utils.Dictionary;for(var i,s=0;s<e.length;s++)if(i=e[s],i.uid!=t.Global.UID){null==this.friMap.get(i.layer)&&this.friMap.set(i.layer,[]);var n=this.friMap.get(i.layer);n.push(i)}this.updateFriList()},i.prototype.clearBg=function(){Laya.loader.clearRes(t.ResPath().getLilianMap(this.clearId))},i.prototype.onShowed=function(){},i.prototype.changeScene=function(){this.setBtnState(),this._display.background.graphics.clear(),this._display.background.loadImage(t.ResPath().getLilianMap(this.m_sceneInfo.id)),t.XHR().Post({file:"petpk",cmd:"mappush",subcmd:"conf",uid:t.Global.UID,dup:this.m_sceneInfo.id},this,this.onCfgLoaded)},i.prototype.onHided=function(){this.destroy()},i.prototype.destroy=function(){this.closeTips(),Laya.timer.frameOnce(1,this,this.clear)},i.prototype.clear=function(){this._display.buffIcons&&this._display.buffIcons.destroy(),e.prototype.destroy.call(this),Laya.loader.clearRes(t.ResPath().getLilianMap(this.m_sceneInfo.id)),Laya.loader.clearRes("ui/lilian/bg_hero.png"),this.m_djSk&&(this.m_djSk.destroy(),this.m_djSk=null),this.giftSkeketon1&&(this.giftSkeketon1.destroy(),this.giftSkeketon1=null),this.giftSkeketon2&&(this.giftSkeketon2.destroy(),this.giftSkeketon2=null),this.giftSkeketon3&&(this.giftSkeketon3.destroy(),this.giftSkeketon3=null)},i.prototype.getSceneName=function(){return t.SceneDef.LILIAN_SCENE},i.prototype.setBtnState=function(){var e=Number(this.m_sceneInfo.id);e%1e3>1?this._display.btnPre.visible=!0:this._display.btnPre.visible=!1,0==this._mode&&e<this.m_mgr.curDup||1==this._mode&&e<this.m_mgr.maxHeroDup?t.Util.enable(this._display.btnNext):t.Util.toGrayAndDisabled(this._display.btnNext)},i.prototype.onCfgLoaded=function(e){var i=e.level;if(i){this.m_npcList=new Array,this.m_npcs=new Array,this.m_maxStar=0;for(var s,n,a=0;a<i.length;a++)s=new t.GuankaInfo(i[a]),s.resId=this.m_mgr.getNpcResId(s.npcId[s.npcId.length-1]),this.m_npcList.push(s),s.isBoss&&(this.m_maxStar+=3),n=new t.NpcItem,this._display.npcLayer.addChild(n),n.setData(s,this.m_mgr),n.x=s.x,n.y=s.y,this.m_npcs.push(n);for(var a=0;a<this.m_npcs.length;a++)n=this.m_npcs[a],n.isBoss||n.parent.setChildIndex(n,n.parent.numChildren-1);this.draw(),this.updateFriList()}},i.prototype.updateFriList=function(){if(this.friMap&&this.m_npcs)for(var t,e=0;e<this.m_npcs.length;e++)if(t=this.m_npcs[e],t.isBoss){var i=this.m_sceneInfo.id+(Number(t.gi.id)>=10?"0"+t.gi.id:"00"+t.gi.id),s=this.friMap.get(i);s||(s=[]),t.updateFriList(s)}},i.prototype.checkBeyond=function(e,i,s){var n=e+(Number(i)>=10?"0"+i:"00"+i);if(this.friMap){var a=this.friMap.get(n);if(a){a=a.concat([]);for(var o=0;o<a.length;o++)a[o].uid==t.Global.UID&&a.splice(o,1)}if(a&&a.length>0){var r=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),h=a[0],l="";l+=s?this.m_mgr.getSceneInfoById(String(Number(e)+1)).name+"第1关":this.m_sceneInfo.name+"第"+(Number(i)+1)+"关";var c={type:t.OpenBeyondShareBoxCmd.TYPE_SHARE_LILIANG,users:[{name:r.name,msg:l,lv:r.level,sex:r.sex,headimgurl:r.headimgurl},{uid:h.uid,name:h.name,msg:this.m_sceneInfo.name+"第"+i+"关",lv:h.level?h.level:1,sex:h.sex?h.sex:1,headimgurl:h.url}]};if(t.Facade.callCommand(new t.SendWbGameBarCmd(h.uid,t.SendWbGameBarCmd.kSurpassMappush)),a.length>1){var d=a[1];c.users.push({uid:d.uid,name:d.name,msg:this.m_sceneInfo.name+"第"+i+"关",lv:d.level?d.level:1,sex:d.sex?d.sex:1,headimgurl:d.url})}this.m_um.level>10&&t.Facade.callCommand(new t.OpenBeyondShareBoxCmd(c))}}},i.prototype.draw=function(){this._display.arrow.visible=!1;var e=this.m_gkData.totlestar/this.m_maxStar;this._display.starProgress.width=this.PROGRESS_WIDTH*(e>1?1:e),this._display.starNumTxt.text=this.m_gkData.totlestar+"/"+this.m_maxStar;for(var i=this.m_sceneInfo.gift,s=0;3>s;s++)this._display["starTxt_"+(s+1)].text=i[s].star;this.refreshGift();for(var n,a,o=this.m_npcList.length,s=0;o>s;s++){if(a=this.m_npcList[s],n=this.m_npcs[s],a.isBoss){var r=this.m_mgr.getStar(this.m_sceneInfo.id,a.id);n.star=r}Number(a.id)<=Number(this.m_gkData.curlevel)?n.enable=!0:n.enable=!1,Number(a.id)==Number(this.m_gkData.curlevel)?(this._display.arrow.visible=!0,this._display.arrow.x=a.isBoss?n.x-25:n.x,this._display.arrow.y=a.isBoss?n.y-40:n.y-18,n.checkBtn(!0)):n.checkBtn(!1)}t.Logger.log("npc num:"+this._display.npcLayer.numChildren)},i.prototype.giftParseComplete=function(){this.giftSkeketon1=new t.AnimationSKe("assets/skeleton/icon_light.sk"),this.giftSkeketon2=new t.AnimationSKe("assets/skeleton/icon_light.sk"),this.giftSkeketon3=new t.AnimationSKe("assets/skeleton/icon_light.sk"),this.addGiftSkeleton()},i.prototype.addGiftSkeleton=function(){this.needSkeleton1&&this.giftSkeketon1&&(this.giftSkeketon1.play(0,!0),this._display.boxComp_1.addChild(this.giftSkeketon1),this.giftSkeketon1.x=32,this.giftSkeketon1.y=35),this.needSkeleton2&&this.giftSkeketon2&&(this.giftSkeketon2.play(0,!0),this._display.boxComp_2.addChild(this.giftSkeketon2),this.giftSkeketon2.x=32,this.giftSkeketon2.y=35),this.needSkeleton3&&this.giftSkeketon3&&(this.giftSkeketon3.play(0,!0),this._display.boxComp_3.addChild(this.giftSkeketon3),this.giftSkeketon3.x=32,this.giftSkeketon3.y=35)},i.prototype.refreshGift=function(){for(var e=this.m_gkData.giftstatus,i=!1,s=0;s<e.length;s++)this["needSkeleton"+(s+1)]=!1,2==e[s]?(this._display["treasure_"+(s+1)].visible=!0,this._display["btnTreasure_"+(s+1)].visible=!1):(this._display["treasure_"+(s+1)].visible=!1,this._display["btnTreasure_"+(s+1)].visible=!0,1==e[s]&&(t.Util.enable(this._display["btnTreasure_"+(s+1)]),this["needSkeleton"+(s+1)]=!0,i=!0)),0==this["needSkeleton"+(s+1)]&&this["giftSkeketon"+(s+1)]&&(this["giftSkeketon"+(s+1)].stop(),this["giftSkeketon"+(s+1)].parent&&this["giftSkeketon"+(s+1)].parent.removeChild(this["giftSkeketon"+(s+1)])),this._display["boxComp_"+(s+1)].x=this.PROGRESS_START_X+this.PROGRESS_WIDTH*this.m_sceneInfo.getStarByGiftIndex(s)/this.m_maxStar;i&&(this.giftSkeketon1?this.addGiftSkeleton():this.giftParseComplete())},i.prototype.getGift=function(e){var i=new t.GetGiftCmd;i.index=e,i.dup=this.m_sceneInfo.id,t.Facade.callCommand(i),3==e&&this.m_gkData.totlestar==this.m_maxStar&&0==this._mode&&t.dispatch(t.ShareModule.SHARE_MODULE_EVENT,{type:4,data:this.m_gkData,sceneId:parseInt(this.m_sceneInfo.id)})},i.prototype.update=function(){this.m_gkData=this.m_mgr.getGkData(this.m_sceneInfo.id),this.draw(),this.setBtnState()},i.prototype.clearNpcLayer=function(){var e;t.Logger.log("clearNpcLayer"),this._display.npcLayer.removeChildren(0,this._display.npcLayer.numChildren-1);for(var i=0;i<this.m_npcs.length;i++)e=this.m_npcs[i],e.removeSelf(),e.destroy();this.m_npcs=[]},i.prototype.gotoScene=function(e){var i=new t.LilianCmd;i.sceneId=e,t.Facade.callCommand(i)},i.prototype.userModelUpdate=function(){0==this._mode?this._display.tfOrder.text=this.m_um.energy+"/"+this.m_mgr.max_energy:this._display.tfOrder.text=this.m_um.highEnergy+"/"+this.m_um.maxHighEnergy,this._display.buffIcons.visible=this.m_um.level>=6},i.prototype.updateEnergy=function(t){this.m_um.energy!=t&&(this.m_um.energy=t,this.userModelUpdate())},i.prototype.showTips=function(e,i){var s,n=this.m_gkData.giftdescs[e],a={},o="";a.name="历练星级奖励",a.info="条件：本关历练星级达到"+this.m_sceneInfo.gift[e].star;for(var r=0;r<n.attrs.length;r++)o+=n.attrs[r].name+"x"+n.attrs[r].num+"\n";for(var r=0;r<n.items.length;r++)o+=n.items[r].name+"x"+n.items[r].num+"\n";a.desc="奖励物品：\n"+o,s=i.localToGlobal(new laya.maths.Point(0,0)),t.Tips.show(a,s)},i.prototype.closeTips=function(){t.Tips.tipsClose()},i}(t.BaseScene);t.SceneView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.lilian.SweepUI,!0,!1,!0,!1),this._scrollNum=0,this.m_ui=this.skin,this.size(t.LayerMgr.width,t.LayerMgr.height)}return __extends(i,e),i.prototype.setData=function(t,e){this.m_data=t,this.m_sc=e,this.m_ui.btnMore.visible=0==e.mode,this.m_ui.btnYes.x=0==e.mode?711:581,this.callLater(this.refresh)},i.prototype.refresh=function(){for(var e,i,s,n=[],a=this.m_data.gifts,o=a.length,r=!1,h=0;o>h;h++){e=a[h].award,s=[];for(var l=0;2>l&&l<e.attrs.length;l++)i=e.attrs[l],s.push(i.name+"×"+i.num);for(var c=0;c<e.items.length;c++)i=e.items[c],s.push(i.name+"×"+i.num);s.length<=2?n.push({nameTxt:"第"+t.Util.getWordByNum(h+1)+"次",expTxt:s[0],coinTxt:s[1]?s[1]:"经验×0",extra:{visible:!1},height:125}):(r=!0,n.push({nameTxt:"第"+t.Util.getWordByNum(h+1)+"次",expTxt:s[0],coinTxt:s[1]?s[1]:"经验×0",extra:{visible:!0,extraTxt:s[2]},height:151}))}this.m_ui.list.array=n,this.m_ui.list.scrollBar.hide=!0,this.m_ui.btnYes.on(Laya.Event.CLICK,this,this.hide),this.m_ui.btnMore.on(Laya.Event.CLICK,this,this.sweepAgain),this.scrollList()},i.prototype.scrollList=function(){if(this._scrollNum<this.m_ui.list.length){this._scrollNum++;var t=130*this._scrollNum;this._nowTween=Laya.Tween.to(this.m_ui.list.scrollBar,{value:t},500,null,Handler.create(this,this.scrollList),1e3)}},i.prototype.sweepAgain=function(){0==this.m_sc.mode&&(this.m_sc.count=10,t.Facade.callCommand(this.m_sc))},i.prototype.hide=function(){this.m_ui.list.array=[],this.m_ui.btnYes.offAll(),this.m_ui.btnMore.offAll(),e.prototype.hide.call(this)},i.prototype.destroy=function(){this.m_ui.destroy(),e.prototype.destroy.call(this)},i}(t.BaseBox);t.SweepResultView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"MailCommand":this.mailPanel||(this.mailPanel=new t.MailView),this.mailPanel.on(t.ViewEvent.BOX_HIDE,this,this.onClosePanel),this.mailPanel.show()}},s.prototype.onClosePanel=function(){this.mailPanel&&(this.mailPanel.off(t.ViewEvent.BOX_HIDE,this,this.onClosePanel),Laya.loader.clearRes("res/atlas/ui/mail.json"))},s.prototype.getPluginName=function(){return e.PLUGIN_MAIL},s}(t.Plugin);t.MailModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function n(){e.call(this,new ui.mail.MailUI,!0,!1),this._display=this.skin,this.setCloseButton(this._display.back.closeBtn),this._mailContentChache={},t.addListener(n.MAIL_VIEW_SHOW_MAIL_CONTENT,this,this.queryMailContent),t.addListener(n.MAIL_SELECT_MAIL,this,this.onSelectMail),this._display.back.derocation_left.skin="ui/comp/rope_xia.png",this._display.back.derocation_left.x=119,this._display.red0.visible=!1,this._display.red1.visible=!1,this._contentHtml=new Laya.HTMLDivElement,this._contentHtml.style.color=this._display.mailContentTxt.color,this._contentHtml.style.fontSize=this._display.mailContentTxt.fontSize,this._contentHtml.style.fontFamily="黑体",this._contentHtml.style.leading=5,this._contentHtml.style.width=this._display.mailContentTxt.width,this._contentHtml.style.wordWrap=!0,this._contentHtml.style.valign="top",this.addChild(this._contentHtml),this._contentHtml.x=this._display.mailContentTxt.x,this._contentHtml.y=this._display.mailContentTxt.y,this._display.mailContentTxt.text="",this._display.list.itemRender=i,this._display.list.scrollBar.visible=!1,this._display.list.renderHandler=new Handler(this,this.onListRender),this._display.list.name="checkBoxShowHide",this._display.rewardList.itemRender=s,this._display.rewardList.scrollBar.visible=!1,this._display.rewardList.renderHandler=new Handler(this,this.onRewardListRender),this._display.rewardList.array=[],this._display.deleteMoreBtn.visible=!1,this._display.deleteMoreBtn.name="checkBoxShowHide",this._display.list.on(Laya.Event.MOUSE_DOWN,this,this.listMouseDown),this._display.list.on(Laya.Event.MOUSE_UP,this,this.listMouseUp),this._display.deleteAllBtn.visible=!1,this._display.deleteAllBtn.on(Laya.Event.CLICK,this,this.deleteAllMail),this._display.linkTxt.on(Laya.Event.CLICK,this,this.onClickLink),this._display.deleteMoreBtn.on(Laya.Event.CLICK,this,this.onClickMoreDelete),this._display.linkTxt.visible=!1,this._display.getIcon.visible=!1,this._display.deleteBtn.visible=!1,this._display.getFileBtn.visible=!1,this._display.canSelectTxt.visible=!1,this._display.tab.labels="系\n统\n邮\n件,好\n友\n邮\n件",this._display.tab.selectHandler=new Handler(this,this.onSelectTab),this._display.noTips.visible=!1}return __extends(n,e),n.prototype.destroy=function(){Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.onClickStage),this._display.list.off(Laya.Event.MOUSE_DOWN,this,this.listMouseDown),this._display.list.off(Laya.Event.MOUSE_UP,this,this.listMouseUp),this._display.linkTxt.off(Laya.Event.CLICK,this,this.onClickLink),this._display.deleteMoreBtn.off(Laya.Event.CLICK,this,this.onClickMoreDelete),this._display.deleteBtn.off(Laya.Event.CLICK,this,this.onClickDelete),this._display.getFileBtn.off(Laya.Event.CLICK,this,this.onClickGetFile),t.removeListener(n.MAIL_VIEW_SHOW_MAIL_CONTENT,this,this.queryMailContent),t.removeListener(n.MAIL_SELECT_MAIL,this,this.onSelectMail),e.prototype.destroy.call(this)},n.prototype.onShowed=function(){e.prototype.onShowed.call(this),this.resetImageSkin(this._display),this._display.tab.selectedIndex=0,this._display.red0.visible=!1,this._display.red1.visible=!1,t.XHR().Post({cmd:"mail",op:"mailist",type:3},this,this.onFriendResult)},n.prototype.onHided=function(){e.prototype.onHided.call(this),this._display.tab.selectedIndex=-1,this._sysMailCache=null,this._friendMailCache=null},n.prototype.onFriendResult=function(t){0==t.result&&(this._friendMailCache=t,this.checkMailReaded())},n.prototype.onSelectTab=function(e){switch(this._display.list.array=[],e){case 0:this._display.deleteAllBtn.visible=!1,this._sysMailCache?this.updatePanel(this._sysMailCache):t.XHR().Post({cmd:"mail",op:"mailist",type:2,needreload:"1"},this,this.onMailResult);break;case 1:this._display.deleteAllBtn.visible=!0,this._friendMailCache?this.updatePanel(this._friendMailCache):t.XHR().Post({cmd:"mail",op:"mailist",type:3,needreload:"1"},this,this.onMailResult)}},n.prototype.onMailResult=function(e){if(0==e.result){2==e.type?(this._sysMailCache=e,this.updatePanel(e)):3==e.type&&(this._friendMailCache=e,this.updatePanel(e)),this._mailIdMap={};for(var i=e.maillist,s=i.length,n=0;s>n;n++)this._mailIdMap[i[n].id]=i[n]}else t.WeakTips.show(e.msg),this.showMailContent()},n.prototype.updatePanel=function(t,e){void 0===e&&(e=!0),this._curData=t;for(var i=t.maillist,s=i.length,n=0;s>n;n++)i[n].selected=!1;i.sort(this.mailSort),s>0?(t.maillist[0].selected=!0,this.queryMailContent(t.maillist[0].id)):this.showMailContent(),this._display.list.array=t.maillist,e&&(this._display.list.scrollBar.value=0);var s=this._display.list.array.length;this._display.mailNumTxt.text="当前邮件数量："+s+"/100"},n.prototype.mailSort=function(t,e){var i=t.time,s=e.time;return i>s?-1:s>i?1:0},n.prototype.queryMailContent=function(e){this._mailContentChache[e]?this.showMailContent(this._mailContentChache[e].maillist):t.XHR().Post({cmd:"mail",uid:"20004",op:"getmail",id:e},this,this.mailContentResult)},n.prototype.mailContentResult=function(e){0==e.result?(t.Util.DecodeJSONProperty("content",e),this._mailContentChache[e.id]=e,this.showMailContent(e.maillist),t.dispatch(n.MAIL_VIEW_HAVED_READ,e.id),this.checkMailReaded()):t.WeakTips.show(e.msg)},n.prototype.checkMailReaded=function(){this._display.red0.visible=!1,this._display.red1.visible=!1;var e,i=t.Facade.singleton.model.retrieveModel(t.ModelDef.ALL_STATUS_MODEL),s=0;if(this._sysMailCache){e=this._sysMailCache.maillist;for(var n=0;n<e.length;n++){if(1==e[n].status){s=1,this._display.red0.visible=!0;break}this._display.red0.visible=!1}}if(this._friendMailCache){e=this._friendMailCache.maillist;for(var n=0;n<e.length;n++){if(1==e[n].status){s=1,this._display.red1.visible=!0;break}this._display.red1.visible=!1}}i.setStatueFlagByName(t.AllStatusModel.MAIL_STATE,s)},n.prototype.showMailContent=function(e){if(void 0===e&&(e=null),this._curMailContent=e,e){this._display.mailTitleTxt||t.Logger.log(""),t.Util.DecodeJSONProperty("sender",e),this._display.mailTitleTxt.text="标题："+e.title,this._display.senderTxt.text="发件人："+e.sender;try{this._contentHtml.innerHTML=e.content}catch(i){this._contentHtml.innerHTML="",this._display.mailContentTxt.text=e.content}this._display.getIcon.visible=!1,this._display.deleteBtn.filters=null,this._display.deleteBtn.on(Laya.Event.CLICK,this,this.onClickDelete),1==e.reward?(this._display.getFileBtn.filters=null,this._display.getFileBtn.on(Laya.Event.CLICK,this,this.onClickGetFile),this._display.getFileBtn.label="领 取",this._display.getFileBtn.visible=!0,this._display.deleteBtn.visible=!1):(this._display.getFileBtn.filters=t.FiltersUtils.getGreyFilters(),this._display.getFileBtn.off(Laya.Event.CLICK,this,this.onClickGetFile),2==e.reward?(this._display.getFileBtn.label="已领取",this._display.getIcon.visible=!0):this._display.getFileBtn.label="领 取",this._display.getFileBtn.visible=!1,this._display.deleteBtn.visible=!0),this._display.rewardList.array=e.rewardlist,this._display.rewardList.scrollBar.value=0,this._display.noTips.visible=!1,e.click&&1==e.click?(this._display.linkTxt.visible=!0,this._display.linkTxt.text="我的战绩"):this._display.linkTxt.visible=!1,this._display.canSelectTxt.visible=!1}else this._display.mailTitleTxt.text="标题：",this._display.senderTxt.text="发件人：",this._contentHtml.innerHTML="",this._display.mailContentTxt.text="",this._display.getIcon.visible=!1,this._display.getFileBtn.visible=!1,this._display.deleteBtn.visible=!1,this._display.canSelectTxt.visible=!1,this._display.deleteBtn.filters=t.FiltersUtils.getGreyFilters(),this._display.deleteBtn.off(Laya.Event.CLICK,this,this.onClickDelete),this._display.getFileBtn.filters=t.FiltersUtils.getGreyFilters(),this._display.getFileBtn.off(Laya.Event.CLICK,this,this.onClickGetFile),this._display.rewardList.array=[],this._display.noTips.visible=!0,this._display.linkTxt.visible=!1,this._display.deleteAllBtn.visible=!1},n.prototype.onClickDelete=function(){t.ConfirmBox.show(new t.ConfirmBoxData({contentStr:"确定要删除此邮件吗？",callBackHandler:new Handler(this,this.confirmDelete)}))},n.prototype.confirmDelete=function(e){t.XHR().Post({cmd:"mail",uid:"20004",op:"delmail",id:this._curMailContent.id},this,this.deleteSingleMail)},n.prototype.deleteSingleMail=function(e){if(0==e.result){var i=this._display.list.array;this._display.list.array=[];for(var s=i.length,n=s-1;n>=0;n--)if(i[n].id==e.id){i.splice(n,1),this.updatePanel(this._curData);break}}else t.WeakTips.show(e.msg)},n.prototype.onClickGetFile=function(){t.XHR().Post({cmd:"mail",uid:"20004",op:"getreward",id:this._curMailContent.id},this,this.onGetReward)},n.prototype.onGetReward=function(e){0==e.result?(t.WeakTips.show("附件领取成功"),t.Facade.callCommand(new t.SyncChangeCmd(e,!0)),this._display.getFileBtn.filters=t.FiltersUtils.getGreyFilters(),this._display.getFileBtn.off(Laya.Event.CLICK,this,this.onClickGetFile),this._display.getIcon.visible=!0,this._display.getFileBtn.visible=!1,this._display.deleteBtn.visible=!0,this._mailIdMap[e.id]&&(this._mailIdMap[e.id].reward=2),this._curMailContent.reward=2,t.dispatch(n.MAIL_VIEW_GET_REWARD,e.id)):t.WeakTips.show(e.msg)},n.prototype.onClickMoreDelete=function(){this._needDeleteArr=[];for(var e=[],i=this._display.list.array,s=i.length,n=!1,a=0;s>a;a++)if(i[a].checkBoxSelected){if(1==i[a].reward){n=!0;break}this._needDeleteArr.push(a),e.push(i[a].id)}n?t.WeakTips.show("您有附件未领取，无法删除"):e.length>0?t.ConfirmBox.show(new t.ConfirmBoxData({contentStr:"确定删除所选邮件吗？",callBackHandler:new Handler(this,this.confirmDeleteMore),param:e.join("|")})):t.WeakTips.show("请选择要删除的邮件！")},n.prototype.onSelectMail=function(){for(var e=this._display.list.array,i=e.length,s=0,n=0;i>n;n++)e[n].checkBoxSelected&&s++;s>0?(this._display.deleteMoreBtn.on(Laya.Event.CLICK,this,this.onClickMoreDelete),this._display.deleteMoreBtn.filters=null):(this._display.deleteMoreBtn.off(Laya.Event.CLICK,this,this.onClickMoreDelete),this._display.deleteMoreBtn.filters=t.FiltersUtils.getGreyFilters());
},n.prototype.confirmDeleteMore=function(e){t.XHR().Post({cmd:"mail",uid:"20004",op:"batchdelmail",ids:e},this,this.deleteMoreMailResult)},n.prototype.deleteMoreMailResult=function(e){0==e.result?(this.deleteMail(),this.updatePanel(this._curData),this.checkMailReaded()):t.WeakTips.show(e.msg)},n.prototype.deleteMail=function(){var t=this._display.list.array;this._display.list.array=[],this._friendMailCache.maillist=[];for(var e=t.length,i=e-1;i>=0;i--)-1!=this._needDeleteArr.indexOf(i)&&t.splice(i,1)},n.prototype.deleteAllMail=function(){this._needDeleteArr=[];for(var e=[],i=this._display.list.array,s=i.length,n=0;s>n;n++)this._needDeleteArr.push(n),e.push(i[n].id);e.length>0?t.ConfirmBox.show(new t.ConfirmBoxData({contentStr:"您即将清空您的全部好友邮件，请问继续操作么？",callBackHandler:new Handler(this,this.confirmDeleteMore),param:e.join("|")})):t.WeakTips.show("没有邮件可删除")},n.prototype.onListRender=function(t,e){t.setData(this._display.list.getItem(e))},n.prototype.onRewardListRender=function(t,e){t.setData(this._display.rewardList.getItem(e))},n.prototype.listMouseDown=function(){Laya.timer.once(1e3,this,this.showCheckBox)},n.prototype.listMouseUp=function(){Laya.timer.clear(this,this.showCheckBox)},n.prototype.showCheckBox=function(){Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.onClickStage),t.dispatch(n.MAIL_VIEW_SHOW_HIDE_CHECKBOX,!0),this._display.deleteMoreBtn.visible=!0,this._display.checkTips.visible=!1,this._display.deleteAllBtn.visible=!1,this.onSelectMail()},n.prototype.onClickStage=function(e){!e.target||"checkBoxShowHide"==e.target.name||e.target instanceof i||(Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.onClickStage),t.dispatch(n.MAIL_VIEW_SHOW_HIDE_CHECKBOX,!1),this._display.deleteMoreBtn.visible=!1,this._display.checkTips.visible=!0,1==this._display.tab.selectedIndex&&(this._display.deleteAllBtn.visible=!0))},n.prototype.onClickLink=function(){switch(this._curMailContent.click){case 1:t.Facade.callCommand(new t.WuLinCommand(2))}},n.MAIL_VIEW_SHOW_HIDE_CHECKBOX="MAIL_VIEW_SHOW_HIDE_CHECKBOX",n.MAIL_VIEW_SHOW_MAIL_CONTENT="MAIL_VIEW_SHOW_MAIL_CONTENT",n.MAIL_VIEW_HAVED_READ="MAIL_VIEW_HAVED_READ",n.MAIL_VIEW_GET_REWARD="MAIL_VIEW_GET_REWARD",n.MAIL_SELECT_MAIL="MAIL_SELECT_MAIL",n}(t.BaseBox);t.MailView=e;var i=function(i){function s(){i.call(this),this._showHideCHeckBox=!1,this.name="checkBoxShowHide",t.addListener(e.MAIL_VIEW_SHOW_HIDE_CHECKBOX,this,this.showHideCheckBox),t.addListener(e.MAIL_VIEW_HAVED_READ,this,this.mailRead),t.addListener(e.MAIL_VIEW_GET_REWARD,this,this.getReward),t.addListener(e.MAIL_VIEW_SHOW_MAIL_CONTENT,this,this.hightLightItem),this.check.name="checkBoxShowHide",this.check.clickHandler=new Handler(this,this.onClickCheck),this.on(Laya.Event.CLICK,this,this.onClick),this.selectBg.visible=!1}return __extends(s,i),s.prototype.destroy=function(){this.off(Laya.Event.CLICK,this,this.onClick),t.removeListener(e.MAIL_VIEW_SHOW_HIDE_CHECKBOX,this,this.showHideCheckBox),t.removeListener(e.MAIL_VIEW_HAVED_READ,this,this.mailRead),t.removeListener(e.MAIL_VIEW_GET_REWARD,this,this.getReward),t.removeListener(e.MAIL_VIEW_SHOW_MAIL_CONTENT,this,this.hightLightItem),this.check.clickHandler=null,i.prototype.destroy.call(this)},s.prototype.setData=function(e){if(this.check.visible=this._showHideCHeckBox,e){this._curData=e,e.hasOwnProperty("checkBoxSelected")||(e.checkBoxSelected=!1),e.hasOwnProperty("selected")||(e.selected=!1),t.Util.DecodeJSONProperty("sender",e),this.check.selected=e.checkBoxSelected,this.selectBg.visible=e.selected,this.titleTxt.text=""+e.title,this.senderTxt.text=e.sender,this.timeTxt.text=t.DateUtils.formate(e.time);var i=t.DateUtils.subTime(-1,e.expire_time);""!=i?this.limitTimeTxt.text="有效期："+i:this.limitTimeTxt.text="",this.iconShowControl()}},s.prototype.iconShowControl=function(){for(var t=0;4>t;t++)this["status"+t].visible=!1;1==this._curData.status?1==this._curData.reward?this.status2.visible=!0:this.status0.visible=!0:1==this._curData.reward?this.status3.visible=!0:this.status1.visible=!0},s.prototype.showHideCheckBox=function(t){this._showHideCHeckBox=t,this.check.visible=this._showHideCHeckBox},s.prototype.onClickCheck=function(){this._curData.checkBoxSelected=this.check.selected,t.dispatch(e.MAIL_SELECT_MAIL)},s.prototype.onClick=function(i){"checkBoxShowHide"!=i.target.name&&t.dispatch(e.MAIL_VIEW_SHOW_MAIL_CONTENT,this._curData.id)},s.prototype.mailRead=function(t){this._curData&&t==this._curData.id&&(this._curData.status=2,this.iconShowControl())},s.prototype.getReward=function(t){this._curData&&t==this._curData.id&&(this._curData.reward=2,this.iconShowControl())},s.prototype.hightLightItem=function(t){this._curData&&t==this._curData.id?(this._curData.selected=!0,this.selectBg.visible=!0):(this._curData&&(this._curData.selected=!1),this.selectBg.visible=!1)},s}(ui.mail.MailItemUI),s=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.setData=function(e){this.nameTxt.text="";var i={400001:"kCash",400002:"kExp",400003:"kVit",400004:"kFightPower",400005:"kPrestige",400006:"kSpirit"};if(e){this.icon.graphics.clear();var s=i[e.id]?i[e.id]:e.id;e.icon_id?this.icon.loadImage(t.ResPath().getPic(e.icon_id,t.ResourcePath.PATH_GOODS),0,0,80,80):this.icon.loadImage(t.ResPath().getPic(s,t.ResourcePath.PATH_GOODS),0,0,80,80),this.numTxt.text="x"+e.num}},i}(ui.mail.MailRewardItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i,s,n,a,o){void 0===i&&(i=!0),void 0===s&&(s=!0),void 0===n&&(n=!0),void 0===a&&(a=!1),void 0===o&&(o=.4),t.call(this,e,i,s,n,a,o)}return __extends(e,t),e.prototype.showWithData=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=-1),this.skin&&(this._showData=t,this.show(e,i),this.update())},e.prototype.update=function(){},e.prototype.hide=function(){this._showData=null,t.prototype.hide.call(this)},e.prototype.destroy=function(){this._showData=null,t.prototype.destroy.call(this)},e}(t.BaseBox);t.SmartView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.initialize=function(e){this.viewMrg=new t.MarryViewMrg,this.dataMrg=new t.MarryDataMrg},i.prototype.doCommand=function(e){var i=this;switch(e.getCommandName()){case"OpenMarryBoxCommand":var s=e;s.viewType&&""!=s.viewType&&s.viewType!=t.MarryViewType.TYPE_VIEW_MAIN||(s.data&&s.data instanceof Object?i.dataMrg.target(Handler.create(i,function(){i.viewMrg.showView(t.MarryViewType.TYPE_VIEW_MAIN,s.data)}),s.data.uid):i.dataMrg.query(Handler.create(i,function(){i.dataMrg.record(Handler.create(i,function(){i.viewMrg.showView(t.MarryViewType.TYPE_VIEW_MAIN,s.data)}))}))),e.ecode=0,e.finish();break;case"CloseMarryBoxCommand":e.ecode=0,e.finish();break;case"GetMarryDataCommand":var n=e;this.dataMrg.queryData?(n.queryData=i.dataMrg.queryData,n.ecode=0,n.finish()):i.dataMrg.query(Handler.create(i,function(){n.queryData=i.dataMrg.queryData,n.ecode=0,n.finish()}));break;case"OpenMarry88BoxCommand":this.openMarry88Box()}},i.prototype.openMarry88Box=function(){this._marry88Box||(this._marry88Box=new t.Marry88Box(this.dataMrg.queryData),this._marry88Box.on(t.ViewEvent.BASE_DESTROY,this,this.marry88BoxDestroy),this._marry88Box.on("DO_MARRY_88",this,this.marry88BoxDoMarry88),this._marry88Box.show())},i.prototype.marry88BoxDoMarry88=function(e){this._isdrain=Number(e.isdrain),this._marry88Box&&this._marry88Box.destroy();var i=new t.ConfirmBoxData({isShowCancelBtn:!0,contentStr:"一份感情来之不易，您真的要离婚吗？",callBackHandler:Handler.create(this,this.alertToMarry)});t.ConfirmBox.show(i,t.Layer.WEAK_TIP)},i.prototype.alertToMarry=function(){t.XHR().Post({file:"petpk",cmd:"marry",op:"divorce",isdrain:this._isdrain,uid:t.Global.UID},this,this.doMarry88Handler)},i.prototype.doMarry88Handler=function(e){if(0==e.result){t.WeakTips.show("离婚成功");var i=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);i.marryStatus=0,t.Facade.callCommand(new t.SyncChangeCmd(e)),t.Facade.callCommand(new t.OpenMarryBoxCommand)}else 122==e.result?(t.WeakTips.show("您的配偶已登录"),this.dataMrg.queryData.couple.isdrain=0):t.WeakTips.show("离婚失败，"+e.msg)},i.prototype.marry88BoxDestroy=function(){this._marry88Box&&(this._marry88Box.off(t.ViewEvent.BASE_DESTROY,this,this.marry88BoxDestroy),this._marry88Box.off("DO_MARRY_88",this,this.marry88BoxDoMarry88),this._marry88Box=null)},i.prototype.getPluginName=function(){return t.PluginDef.PLUGIN_MARRY},i.prototype.log=function(e){t.Logger.log("[Marry模块] "+e)},i}(t.Plugin);t.MarryModule=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.btn_yes.clickHandler=Handler.create(this,this.onYes,null,!1),this.btn_no.clickHandler=Handler.create(this,this.onNo,null,!1)}return __extends(i,e),i.prototype.setData=function(e){this._curData=e,t.MarryUtils.setHead(this.mc_head,e),this.tf_name.text=e.name,this.tf_lv.text="等级: %level%级".replace("%level%",e.level+""),this.tf_time.text="%time%向我求婚".replace("%time%",t.DateUtils.getDaysBySecond(e.timestamp))},i.prototype.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t)},i.prototype.onYes=function(){var e=this;this.dataMrg.agree(Handler.create(this,function(i){t.WeakTips.show("已接受求婚！"),t.Facade.callCommand(new t.SendWbGameBarCmd(this._curData.uid,t.SendWbGameBarCmd.kMarryAgree)),e.dataMrg.query(Handler.create(this,function(i){e.viewMrg.updateView(t.MarryViewType.TYPE_VIEW_MAIN)}))}),this._curData.uid)},i.prototype.onNo=function(){var e=this;e.dataMrg.refuse(Handler.create(this,function(i){t.WeakTips.show("已拒绝求婚！"),t.Facade.callCommand(new t.SendWbGameBarCmd(this._curData.uid,t.SendWbGameBarCmd.kMarryRefuse)),e.dataMrg.record(Handler.create(this,function(i){e.viewMrg.updateView(t.MarryViewType.TYPE_VIEW_MAIN)}))}),this._curData.uid)},Object.defineProperty(i.prototype,"viewType",{get:function(){return t.MarryViewType.TYPE_VIEW_MAIN},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"module",{get:function(){return this._moduel||(this._moduel=t.Facade.singleton.retrievePlugin(t.PluginDef.PLUGIN_MARRY)),this._moduel},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewMrg",{get:function(){return this.module.viewMrg},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dataMrg",{get:function(){return this.module.dataMrg},enumerable:!0,configurable:!0}),i}(ui.marry.item.BeiQiuHunItemUI);t.BeiQiuHunItem=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this)}return __extends(e,t),e.prototype.setData=function(t){this._curData=t},e.prototype.destroy=function(e){void 0===e&&(e=!0),t.prototype.destroy.call(this,e)},e}(ui.marry.item.HunLiItemUI);t.HunLiItem=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.btn_qiu.clickHandler=Handler.create(this,this.onClick,null,!1)}return __extends(i,e),i.prototype.setData=function(e){this._curData=e,t.MarryUtils.setHead(this.mc_head,e),this.tf_name.text=e.name,this.tf_fc.text=e.attack_power+"",this.tf_lv.text="等级: %level%级".replace("%level%",e.level+""),0==e.proposed?(this.btn_qiu.label="求 婚",this.btn_qiu.mouseEnabled=!0,this.btn_qiu.gray=!1):(this.btn_qiu.label="已求婚",this.btn_qiu.mouseEnabled=!1,this.btn_qiu.gray=!0)},i.prototype.destroy=function(t){void 0===t&&(t=!0),e.prototype.destroy.call(this,t)},i.prototype.onClick=function(){this.viewMrg.showView(t.MarryViewType.TYPE_VIEW_QIU_HUN,this._curData)},Object.defineProperty(i.prototype,"viewType",{get:function(){return t.MarryViewType.TYPE_VIEW_MAIN},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"module",{get:function(){return this._moduel||(this._moduel=t.Facade.singleton.retrievePlugin(t.PluginDef.PLUGIN_MARRY)),this._moduel},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"viewMrg",{get:function(){return this.module.viewMrg},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dataMrg",{get:function(){return this.module.dataMrg},enumerable:!0,configurable:!0}),i}(ui.marry.item.QiuHunItemUI);t.QiuHunItem=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i){e.call(this,new ui.marry.Marry_88UI),this._display=this.skin,this.setCloseButton(this._display.closeBtn),this._display.queDingBtn.on(Laya.Event.CLICK,this,this.queDingBtnClickhandler),this._display.quXiaoBtn.on(Laya.Event.CLICK,this,this.quXiaoBtnBtnClickhandler),this._isdrain=Number(i.couple.isdrain),Number(i.divorce_cout)>0?0==this._isdrain?(this._display.needCashBox.visible=!0,this._display.noNeedCashTxt.visible=!1):(this._display.needCashBox.visible=!1,this._display.noNeedCashTxt.visible=!0,this._display.noNeedCashTxt.text="对方超过7天未登录，可免费提交离婚申请"):(this._display.needCashBox.visible=!1,this._display.noNeedCashTxt.visible=!0,this._display.noNeedCashTxt.text="首次离婚不需要消耗斗豆");var s=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL),n={uid:s.uid,headimg:s.headimgurl,name:s.name,level:s.level,vip_lvl:s.vipLevel,sex:s.sex};t.MarryUtils.setHead(this._display.mc_head0,n),t.MarryUtils.setHead(this._display.mc_head1,i.couple),this._display.tf_name0.text=n.name,this._display.tf_name1.text=i.couple.name,this._display.chengHaoTxt.text=i.title}return __extends(i,e),i.prototype.queDingBtnClickhandler=function(){this._display.needCashBox.visible?t.PayConfirm.checkDouYu(500,Handler.create(this,this.checkToMarry88)):this.checkToMarry88()},i.prototype.checkToMarry88=function(){this.event("DO_MARRY_88",{isdrain:this._isdrain})},i.prototype.quXiaoBtnBtnClickhandler=function(){this.destroy()},i.prototype.destroy=function(){this._display.queDingBtn.off(Laya.Event.CLICK,this,this.queDingBtnClickhandler),this._display.quXiaoBtn.off(Laya.Event.CLICK,this,this.quXiaoBtnBtnClickhandler),e.prototype.destroy.call(this)},i}(t.BaseBox);t.Marry88Box=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.ui.List,i=laya.events.Event,s=function(s){function n(){s.call(this,new ui.marry.MarryMainUI,!0,!1,!1,!1),this._display=this.skin,t.Global.isWXAPP&&(this._display.btn_close.x-=t.Global.FLOAT_ICON_OFFSET/4),this._display.btn_close.on(i.CLICK,this,this.onClick),this._display.btn_rule.on(i.CLICK,this,this.onClick),this._display.tab_1.selectHandler=new Handler(this,this.update),this._display.tab_1.labels="求婚列表,求婚记录",this._display.msgTxt.text="",this.createSubView()}return __extends(n,s),n.prototype.createSubView=function(){this._qiuHunList=new e,this._qiuHunList.repeatX=1,this._qiuHunList.repeatY=4,this._qiuHunList.vScrollBarSkin="ui/comp/progress.png",this._qiuHunList.scrollBar.visible=!1,this._qiuHunList.itemRender=t.QiuHunItem,this._qiuHunList.array=[],this._qiuHunList.renderHandler=new Handler(this,function(t,e){t.setData(this._qiuHunList.getItem(e))}),this._beiQiuHunList=new e,this._beiQiuHunList.repeatX=1,this._beiQiuHunList.repeatY=4,this._beiQiuHunList.vScrollBarSkin="ui/comp/progress.png",this._beiQiuHunList.scrollBar.visible=!1,this._beiQiuHunList.itemRender=t.BeiQiuHunItem,this._beiQiuHunList.array=[],this._beiQiuHunList.renderHandler=new Handler(this,function(t,e){t.setData(this._beiQiuHunList.getItem(e))}),this._hunLiList=new e,this._hunLiList.repeatX=1,this._hunLiList.repeatY=4,this._hunLiList.vScrollBarSkin="ui/comp/progress.png",this._hunLiList.scrollBar.visible=!1,this._hunLiList.itemRender=t.HunLiItem,this._hunLiList.array=[],this._hunLiList.renderHandler=new Handler(this,function(t,e){t.setData(this._hunLiList.getItem(e))}),this._myMarrySubView=new t.MyMarrySubView,this._titleSubView=new t.TitleMarrySubView},n.prototype.onClick=function(e){switch(e.currentTarget){case this._display.btn_close:this._showData&&this._showData==t.MarryViewType.TYPE_SUB_VIEW_TITLE?this.viewMrg.showView(t.MarryViewType.TYPE_VIEW_MAIN,this._otherData):this.viewMrg.hideView(this.viewType);break;case this._display.btn_rule:this.showRule()}},n.prototype.showRule=function(){var e=this.dataMrg.queryData,i="",s="";0==e.status?(s="<br /><p>婚姻规则：</p>",s+="<br /><p>1.系统：等级达到16级开启婚姻系统</p>",s+="<br /><p>2.求婚：求婚和被求婚均需等级达到16级且为异性好友，每天求婚和被求婚上限为10次。求婚需要消耗99斗币购买999朵玫瑰为门票，被拒绝后不会返回门票。</p>",s+="<br /><p>3.求婚列表：当有人向你求婚时，将会在主界面播放求婚小动画提示有新告白信，点击即可快速进入求婚列表。此页签展示所有向你求婚的信息，可以选择同意或者拒绝对方。同意求婚后即完成结婚，求婚列表将切换为已婚列表；拒绝求婚后系统将会把拒绝信息发送到对方邮箱（24小时后发送） 。</p>",s+="<br /><p>4. 当24小时内未同意或拒绝对方求婚，则视为自动拒绝，24小时之后系统自动发送拒绝信息到对方邮箱。</p>",s+="<br /><p>5. 离婚说明：首次离婚免费，之后离婚需要消耗500斗鱼可立即解除婚姻关系，对方如超过7天（包括7天）未登录游戏，可以免费离婚，离婚后可再次求婚结婚。</p>",s+="<br /><p></p>",t.RulePanel.showRule(s,i)):2==e.status&&t.RulePanel.showRule2(new ui.marry.RuleMarrySubUI,i)},n.prototype.showWithData=function(e,i,n){void 0===i&&(i=null),void 0===n&&(n=-1),this._display.tab_1.selectHandler=null,e==t.MarryViewType.TYPE_SUB_VIEW_BEI_QIU_HUN?this._display.tab_1.selectedIndex=1:this._display.tab_1.selectedIndex=0,this._display.tab_1.selectHandler=new Handler(this,this.update),s.prototype.showWithData.call(this,e,i,n)},n.prototype.update=function(){var e=this.dataMrg.queryData,i=this.dataMrg.recordData;this.dataMrg.targetData;this._display.msgTxt.text="",this._tab1Index=this._display.tab_1.selectedIndex,i&&(this._beiQiuHunList.array=i.friend_array),e&&0==e.status?this._qiuHunList.array=e.friend_array:this._qiuHunList.array=[],this._display.sp_listContainer.removeChildren(),this._showData&&this._showData==t.MarryViewType.TYPE_SUB_VIEW_TITLE?(this._display.tf_state.text="",this._display.tab_1.visible=!1,this._display.btn_rule.visible=!1,this._display.sp_listContainer.addChild(this._titleSubView),this._titleSubView.update()):this._showData&&this._showData instanceof Object?(this._otherData=this._showData,this._display.tf_state.text="",this._display.tab_1.visible=!1,this._display.btn_rule.visible=!1,this._display.sp_listContainer.addChild(this._myMarrySubView),this._myMarrySubView.update(this._showData)):(this._otherData=this._showData,this._display.btn_rule.visible=!0,0==e.status?(this._display.tf_state.text="婚姻状态：未婚",this._display.tab_1.visible=!0,0==this._tab1Index?(this._display.sp_listContainer.addChild(this._qiuHunList),0==this._qiuHunList.array.length&&(this._display.msgTxt.text="你还没有满16级的未婚异性好友哟～")):1==this._tab1Index&&(this._display.sp_listContainer.addChild(this._beiQiuHunList),0==this._beiQiuHunList.array.length&&(this._display.msgTxt.text="还没有人向你求婚呢，耐心等待TA的到来～")),this._myMarrySubView.parent&&this._myMarrySubView.parent.removeChild(this._myMarrySubView)):2==e.status&&(this._display.tf_state.text="婚姻状态：已婚",this._display.tab_1.visible=!1,this._display.sp_listContainer.addChild(this._myMarrySubView),this._myMarrySubView.y=-61,this._myMarrySubView.update()))},n.prototype.destroy=function(){this._destroy(),s.prototype.destroy.call(this)},Object.defineProperty(n.prototype,"viewType",{get:function(){return t.MarryViewType.TYPE_VIEW_MAIN},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"module",{get:function(){return this._moduel||(this._moduel=t.Facade.singleton.retrievePlugin(t.PluginDef.PLUGIN_MARRY)),this._moduel},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"viewMrg",{get:function(){return this.module.viewMrg},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"dataMrg",{get:function(){return this.module.dataMrg},enumerable:!0,configurable:!0}),n.prototype._destroy=function(){},n}(t.SmartView);t.MarryMainView=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.Event,i=function(i){function s(){i.call(this),this._isSelf=!1,this.btn_titleMore.on(e.CLICK,this,this.onClick),this.btn_task.on(e.CLICK,this,this.onClick),this.btn_88.on(e.CLICK,this,this.onClick),this.btn_skill.on(e.CLICK,this,this.onClick),this.btn_love.on(e.CLICK,this,this.onClick),t.HTMLTextUtil.setDivStyle(this.tf_marryDate),t.HTMLTextUtil.setDivStyle(this.tf_marryDay),t.HTMLTextUtil.setDivStyle(this.tf_onlineDay),t.HTMLTextUtil.setDivStyle(this.tf_marryTitle),this.titleTxt.text="",this.titleMore_line.visible=!1}return __extends(s,i),s.prototype.onClick=function(e){if(this._isSelf)switch(e.currentTarget){case this.btn_88:t.Facade.callCommand(new t.OpenMarry88BoxCommand);break;case this.btn_task:t.Facade.callCommand(new t.HangupCmd);break;case this.btn_skill:t.WeakTips.show("夫妻技能根据亲密度升级来提升，查看右上规则详情。");break;case this.btn_love:t.WeakTips.show("根据夫妻2人同时活跃而增加和减少，查看右上规则详情");break;case this.btn_titleMore:this.viewMrg.showView(t.MarryViewType.TYPE_VIEW_MAIN,t.MarryViewType.TYPE_SUB_VIEW_TITLE)}},s.prototype.update=function(e){void 0===e&&(e=null);var i=null,s=null;if(e)this._isSelf=!1,this.titleTxt.text="对方婚姻信息",this.btn_titleMore.visible=!1,this.titleMore_line.visible=!1,this.mc_task.visible=!1,this.btn_88.visible=!1,i=this.dataMrg.targetData,s=e;else{this._isSelf=!0,this.titleTxt.text="",this.btn_titleMore.visible=!0,this.titleMore_line.visible=!0,this.mc_task.visible=!0,this.btn_88.visible=!0;var n=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL);i=this.dataMrg.queryData,s={uid:n.uid,headimg:n.headimgurl,name:n.name,level:n.level,vip_lvl:n.vipLevel,sex:n.sex}}t.MarryUtils.setHead(this.mc_head0,s),t.MarryUtils.setHead(this.mc_head1,i.couple),this.tf_name0.text=s.name,this.tf_name1.text=i.couple.name;var a=new Date;a.setTime(1e3*i.marry_time),this.tf_marryDate.innerHTML=t.StringUtil.replace("%year%年%month%月%date%日结婚",{year:t.HTMLTextUtil.getStyleFont(a.getFullYear()+"","#FF0000"),month:t.HTMLTextUtil.getStyleFont(a.getMonth()+1+"","#FF0000"),date:t.HTMLTextUtil.getStyleFont(a.getDate()+"","#FF0000")}),this.tf_marryDay.innerHTML=t.StringUtil.replace("结婚已经%1%天",t.HTMLTextUtil.getStyleFont(i.marry_day+"","#FF0000")),this.tf_onlineDay.innerHTML=t.StringUtil.replace("同时登录%1%天",t.HTMLTextUtil.getStyleFont(i.login_day+"","#FF0000")),this.tf_marryTitle.innerHTML=t.StringUtil.replace("夫妻称号为：%1%",t.HTMLTextUtil.getStyleFont(i.title+"","#FF0000")),this.tf_love.text=i.intimacy+"",this.tf_skill.text=null==i.skill?"0":i.skill.level+""},s.prototype.destroy=function(){},Object.defineProperty(s.prototype,"module",{get:function(){return this._moduel||(this._moduel=t.Facade.singleton.retrievePlugin(t.PluginDef.PLUGIN_MARRY)),this._moduel},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"viewMrg",{get:function(){return this.module.viewMrg},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"dataMrg",{get:function(){return this.module.dataMrg},enumerable:!0,configurable:!0}),s}(ui.marry.MyMarrySubUI);t.MyMarrySubView=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.Event,i=function(i){function s(){i.call(this,new ui.marry.QiuHunUI,!0,!1,!1,!1),this._display=this.skin,this._display.btn_close.on(e.CLICK,this,this.onClick),this._display.btn_yes.on(e.CLICK,this,this.onClick),this._display.btn_no.on(e.CLICK,this,this.onClick)}return __extends(s,i),s.prototype.onClick=function(e){switch(e.currentTarget){case this._display.btn_close:case this._display.btn_no:this.viewMrg.hideView(this.viewType);break;case this._display.btn_yes:this.viewMrg.showView(t.MarryViewType.TYPE_VIEW_SONG_HUA,this._showData),this.viewMrg.hideView(this.viewType)}},s.prototype.update=function(){var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL);t.MarryUtils.setHead(this._display.mc_head0,this._showData),t.MarryUtils.setHead(this._display.mc_head1,{uid:e.uid,headimg:e.headimgurl,name:e.name,level:e.level,vip_lvl:e.vipLevel,sex:e.sex}),this._display.tf_name0.text=this._showData.name,this._display.tf_name1.text=e.name,this._display.tf_msg.text=s.MSG[Math.floor(Math.random()*s.MSG.length)]},s.prototype.destroy=function(){this._destroy(),i.prototype.destroy.call(this)},Object.defineProperty(s.prototype,"viewType",{get:function(){return t.MarryViewType.TYPE_VIEW_QIU_HUN},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"module",{get:function(){return this._moduel||(this._moduel=t.Facade.singleton.retrievePlugin(t.PluginDef.PLUGIN_MARRY)),this._moduel},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"viewMrg",{get:function(){return this.module.viewMrg},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"dataMrg",{get:function(){return this.module.dataMrg},enumerable:!0,configurable:!0}),s.prototype._destroy=function(){},s.MSG=["送你一支玫瑰代表我的心意，在以后的日子里由我来保护你！","你问我爱你有多深，玫瑰代表我的心;你问我对你有多真，没有你我就头昏!","从现在起，你只有三个选择：第一是嫁给我，第二是嫁给我，第三是以上二选一"],s}(t.SmartView);t.QiuHunView=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.Event,i=function(i){function s(){i.call(this,new ui.marry.SongHuaUI,!0,!1,!1,!1),this._display=this.skin,this._display.btn_close.on(e.CLICK,this,this.onClick),this._display.btn_close2.on(e.CLICK,this,this.onClick),this._display.btn_yes.on(e.CLICK,this,this.onClick),this._display.btn_no.on(e.CLICK,this,this.onClick)}return __extends(s,i),s.prototype.onClick=function(e){switch(e.currentTarget){case this._display.btn_close:case this._display.btn_no:case this._display.btn_close2:this.viewMrg.hideView(this.viewType);break;case this._display.btn_yes:var i=this;i.dataMrg.propose(Handler.create(this,function(e){t.Facade.callCommand(new t.SendWbGameBarCmd(this._showData.uid,t.SendWbGameBarCmd.kMarryPropse)),t.WeakTips.show("求婚发送成功！"),i.dataMrg.query(Handler.create(this,function(e){i.viewMrg.updateView(t.MarryViewType.TYPE_VIEW_MAIN),this.viewMrg.hideView(this.viewType)}))}),i._showData.uid)}},s.prototype.showWithData=function(t,e,s){void 0===e&&(e=null),void 0===s&&(s=-1),i.prototype.showWithData.call(this,t,e,s)},s.prototype.update=function(){this.dataMrg.queryData,this.dataMrg.recordData},s.prototype.destroy=function(){this._destroy(),i.prototype.destroy.call(this)},Object.defineProperty(s.prototype,"viewType",{get:function(){return t.MarryViewType.TYPE_VIEW_SONG_HUA},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"module",{get:function(){return this._moduel||(this._moduel=t.Facade.singleton.retrievePlugin(t.PluginDef.PLUGIN_MARRY)),this._moduel},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"viewMrg",{get:function(){return this.module.viewMrg},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"dataMrg",{get:function(){return this.module.dataMrg},enumerable:!0,configurable:!0}),s.prototype._destroy=function(){},s}(t.SmartView);t.SongHuaView=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this),this.list.itemRender=i,this.list.scrollBar.visible=!1,this.list.renderHandler=Handler.create(this,this.onItemRender,null,!1)}return __extends(s,e),s.prototype.update=function(){this.dataMrg.titleData||this.dataMrg.title(Handler.create(this,this._update))},s.prototype._update=function(t){this.list.array=t.title_array},s.prototype.onItemRender=function(t,e){t.setData(this.list.getItem(e))},s.prototype.destroy=function(){},Object.defineProperty(s.prototype,"module",{get:function(){return this._moduel||(this._moduel=t.Facade.singleton.retrievePlugin(t.PluginDef.PLUGIN_MARRY)),this._moduel},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"viewMrg",{get:function(){return this.module.viewMrg},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"dataMrg",{get:function(){return this.module.dataMrg},enumerable:!0,configurable:!0}),s}(ui.marry.TitleMarrySubUI);t.TitleMarrySubView=e;var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.setData=function(e){this.tf_lv.text=e.level+"",this.tf_name.text=e.title,t.HTMLTextUtil.setDivStyle(this.tf_des,"黑体",18,!0,"#7a583d","center"),this.tf_des.style.valign="top";var i="夫妻2人"+t.HTMLTextUtil.getStyleFont("同时","#FF0000")+"登录游戏"+t.HTMLTextUtil.getStyleFont("累计","#FF0000")+"%1%天";this.tf_des.innerHTML=t.StringUtil.replace(i,e.days+""),e.level%2==0?(this.img_bg1.visible=!1,this.img_bg2.visible=!0):(this.img_bg1.visible=!0,this.img_bg2.visible=!1)},i}(ui.marry.item.TitleItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.master.MasterApplyUI,!0,!0),this.m_ui=this.skin,this.setCloseButton(this.m_ui.back.closeBtn),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.MASTER_MODEL),this.name="MasterApply",this.m_ui.quickJoinBtn.on(Laya.Event.CLICK,this,this.onClickQuickJoin),this.m_ui.searchBtn.on(Laya.Event.CLICK,this,this.onClickSearch),this.m_ui.backBtn.on(Laya.Event.CLICK,this,this.update),this.m_ui.list.scrollBar.visible=!1,this.m_ui.list.itemRender=i,this.m_ui.list.renderHandler=new Laya.Handler(this,this.renderList),this.m_ui.list.array=[]}return __extends(s,e),s.prototype.destroy=function(){e.prototype.destroy.call(this),this._model.off(t.MasterModel.MASTERMODEL_SHOW_SEARCH_MASTER,this,this.showSearch),this._model.off(t.MasterModel.MASTERMODEL_HIDE_APPLY_PANEL,this,this.hide),this._model=null},s.prototype.onShowed=function(){e.prototype.onShowed.call(this),this._model.on(t.MasterModel.MASTERMODEL_SHOW_SEARCH_MASTER,this,this.showSearch),this._model.on(t.MasterModel.MASTERMODEL_HIDE_APPLY_PANEL,this,this.hide),this.update()},s.prototype.onHided=function(){e.prototype.onHided.call(this)},s.prototype.update=function(){this.m_ui.list.scrollBar.value=0,this.m_ui.backBtn.visible=!1,this.m_ui.list.array=this._model.masterList,this.m_ui.redIcon.visible=this._model.showQuickRenIcon,this._model.showQuickRenIcon=!1},s.prototype.renderList=function(t,e){t.update(this.m_ui.list.getItem(e),e)},s.prototype.onClickQuickJoin=function(){this.m_ui.redIcon.visible=!1,t.XHR().Post({cmd:"mentor",op:"join",mentor:0},this,this.onJoinRet)},s.prototype.onJoinRet=function(e){0==e.result?(this._model.haveMaster=!0,this._model.reqData(),this.hide()):t.WeakTips.show(e.msg)},s.prototype.onClickSearch=function(){(new t.MasterSearch).show()},s.prototype.showSearch=function(){this.m_ui.list.scrollBar.value=0,this.m_ui.backBtn.visible=!0,this.m_ui.list.array=this._model.searchMasterData},s}(t.BaseBox);t.MasterApply=e;var i=function(e){function i(){e.call(this),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.MASTER_MODEL)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this);
},i.prototype.update=function(e,i){i%2==0?this.bg.visible=!1:this.bg.visible=!0,e?(this._curData=e,this.tfLvl.text=this._curData.level+"",this.tfName.text=this._curData.name,this.masterTitle.text=this._curData.mentor_title,this.viplevel.text=this._curData.vip_level+"",this.tfAtk.text=this._curData.attack_power+"",1==this._curData.sex?this.sexIcon.skin="ui/main/img_nan.png":this.sexIcon.skin="ui/main/img_nv.png",this.defaultHead.skin=t.JSUtils.getHeadUrl("",this._curData.sex),this.photo.skin="",this.photo.skin=t.JSUtils.getHeadUrl(this._curData.headimgurl,this._curData.sex),this.needLevel.text=this._curData.join_level+"级以下",this.needAccept.text=0==this._curData.join_type?"自动通过":"需审批",this.addBtn.label=0==this._curData.join_type?"直接入门":"申请拜师",this._curData.status?(this.addBtn.gray=!0,this.addBtn.label="待审批",this.addBtn.off(Laya.Event.CLICK,this,this.onClickAdd)):(this.addBtn.on(Laya.Event.CLICK,this,this.onClickAdd),this.addBtn.gray=!1),this.photo.on(Laya.Event.CLICK,this,this.onClick)):(this.photo.off(Laya.Event.CLICK,this,this.onClick),this.addBtn.off(Laya.Event.CLICK,this,this.onClickAdd))},i.prototype.onClick=function(){t.Facade.callCommand(new t.UserInfoCommand(this._curData.uid))},i.prototype.onClickAdd=function(){t.XHR().Post({cmd:"mentor",op:"join",mentor:this._curData.uid},this,this.onJoinRet)},i.prototype.onJoinRet=function(e){0==e.result?0==this._curData.join_type?(this._model.haveMaster=!0,this._model.reqData(),this._model.event(t.MasterModel.MASTERMODEL_HIDE_APPLY_PANEL)):(this.addBtn.off(Laya.Event.CLICK,this,this.onClickAdd),this._curData.status=1,this.addBtn.gray=!0,this.addBtn.label="待审批"):t.WeakTips.show(e.msg)},i}(ui.master.MasterApplyItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.MASTER_MODEL),this._um=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),this.clickArea.on(Laya.Event.CLICK,this,this.onClickRole),this.teaBtn.on(Laya.Event.CLICK,this,this.clickTea),this._model.on(t.MasterModel.MASTERMODEL_UPDARE_TEABTN,this,this.update),this._scale=100,this._scaleStep=1}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),this._model.off(t.MasterModel.MASTERMODEL_UPDARE_TEABTN,this,this.update)},i.prototype.update=function(){Laya.timer.clear(this,this.figuireMovie),this.showRole(),this._roleSke.showSkinByName(this._model.masterSex),this.namePre.text=this._model.masterInfo.namePre,this.nameTxt.text=this._model.masterInfo.name,this.nameTxt.x=this.namePre.x+this.namePre.textWidth+5,this.teaBtn.visible=!1,this.reddot.visible=!1,this._model.isMaster?this.figure.visible=!1:this._um.level>=this._model.maxPupilLevel?this.figure.visible=!1:0==this._model.mineBrotherInfo.status?(Laya.timer.loop(20,this,this.figuireMovie),this.figure.visible=!0):this.figure.visible=!1},i.prototype.showRole=function(){this._roleSke||(this._roleSke=new t.AnimationSKe(t.ResPath().getAnimPath("xianxiagg",t.ResourcePath.PATH_NPC)+".sk",1),this.addChildAt(this._roleSke,0),this._roleSke.x=125,this._roleSke.y=119,this._roleSke.play(0,!0),this._roleSke.scale(.7,.7))},i.prototype.figuireMovie=function(){this._scale+=this._scaleStep,this._scaleStep>0?this._scale>=120&&(this._scaleStep=-1):this._scale<=100&&(this._scaleStep=1),this.figure&&(this.figure.scaleX=this.figure.scaleY=this._scale/100)},i.prototype.onClickRole=function(){if(this._model.isMaster)t.Facade.callCommand(new t.UserInfoCommand(this._model.masterUid));else if(this._um.level>=this._model.maxPupilLevel)t.WeakTips.show("恭喜达到35级，已成为乐斗大侠，快出师收徒吧！");else{var e=new t.MasterPupilView(this._model.masterInfo);e.show()}},i.prototype.clickTea=function(){var e=new t.MasterPupilView(this._model.masterInfo);e.show()},i}(ui.master.MasterInfoUI);t.MasterInfo=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.master.MasterLilianUI),this.m_ui=this.skin,this._isFirst=!0,this.m_ui.cacheAs="bitmap",this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.MASTER_MODEL),this._um=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),this.m_ui.closeBtn.clickHandler=new Laya.Handler(this,this.onClickBack),this.m_ui.freshBtn.on(Laya.Event.CLICK,this,this.onClickFresh),this.m_ui.ruleBtn.on(Laya.Event.CLICK,this,this.onClickRule),t.Global.isWX&&(this.m_ui.closeBtn.x-=100)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.onShowed=function(){this._model.on(t.MasterModel.MASTERMODEL_UPDARE_LILIAN,this,this.updateLilian),this._isFirst?this._isFirst=!1:this.resetImageSkin(this.m_ui),this.updateLilian()},i.prototype.getSceneName=function(){return t.SceneDef.MASTER_LILIAN_SCENE},i.prototype.onHided=function(){this._model.off(t.MasterModel.MASTERMODEL_UPDARE_LILIAN,this,this.updateLilian);for(var e=0;8>e;e++)this.m_ui["monster"+e].clear();Laya.loader.clearRes("ui/lilian/map.png")},i.prototype.updateLilian=function(){this._curData=this._model.lilianData,this.update()},i.prototype.update=function(){this._curData.flush_times>=this._curData.max_flush_times?(this.m_ui.cost.visible=!0,this.m_ui.timeTxt.visible=!1):(this.m_ui.cost.visible=!1,this.m_ui.timeTxt.visible=!0,this.m_ui.timeTxt.text="消耗：今日免费（"+(this._curData.max_flush_times-this._curData.flush_times)+"）"),this.m_ui.leaveTxt.text="挑战次数："+this._curData.fight_times+"/"+this._curData.max_fight_times;for(var t=0;8>t;t++)this.m_ui["monster"+t].visible=!1;for(var e=this._curData.npcs,t=0;t<e.length;t++)this.m_ui["monster"+e[t].idx].visible=!0,this.m_ui["monster"+e[t].idx].update(e[t])},i.prototype.onClickBack=function(){t.Facade.callCommand(new t.MasterCommand)},i.prototype.onClickRule=function(){var e="<img src='ui/comp/icon.png'></img><span style='font-weight:bold'>1.</span>徒弟每日可成功试练5次，获得经验奖励；<br><img src='ui/comp/icon.png'></img><span style='font-weight:bold'>2.</span>试练时由徒弟先出手试练，如失败后则由师傅出战；<br><img src='ui/comp/icon.png'></img><span style='font-weight:bold'>3.</span>徒弟等级和对手品质等级越高，试练经验越高；<br><img src='ui/comp/icon.png'></img><span style='font-weight:bold'>4.</span>每天可免费3次刷新情报，后需要消耗斗鱼（斗鱼不足时用斗豆）购买情报。<br><br><br><br>";t.RulePanel.showRule(e,"")},i.prototype.onClickFresh=function(){this._curData.flush_times<this._curData.max_flush_times?this.reqFresh():this._um.douyu>=10?t.ConfirmBox.show(new t.ConfirmBoxData({contentStr:"刷新需要消耗10斗鱼，是否刷新？",title:"提 示",isShowXBtn:!1,confirmStr:"刷 新",callBackHandler:Handler.create(this,this.reqFresh)})):t.PayConfirm.checkDouYu(10,Handler.create(this,this.reqFresh))},i.prototype.reqFresh=function(){this.checkHightMoster()?t.ConfirmBox.show(new t.ConfirmBoxData({contentStr:"当前有高品质的情报，是否确认刷新？",title:"提 示",isShowXBtn:!1,confirmStr:"确认刷新",callBackHandler:Handler.create(this,this.sendMsg)})):this.sendMsg()},i.prototype.sendMsg=function(){t.XHR().Post({cmd:"mentor",op:"train",type:1},this,this.onFreshRet)},i.prototype.checkHightMoster=function(){for(var t=this._model.lilianData.npcs,e=0;e<t.length;e++)if(t[e].quality>=4)return!0;return!1},i.prototype.onFreshRet=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!1)),this._model.lilianData=e,this._curData=e,this.update()):t.WeakTips.show(e.msg)},i}(t.BaseScene);t.MasterLilian=e;var i=function(e){function i(){e.call(this),this.on(Laya.Event.CLICK,this,this.onClick)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),this._aniSke&&(this._aniSke.destroy(),this._aniSke=null)},i.prototype.clear=function(){this._aniSke&&(this._aniSke.destroy(),this._aniSke=null)},i.prototype.update=function(e){switch(this._curData=e,this.namePre.text=e.level+"",this.nameTxt.text=e.name,this.nameTxt.x=this.namePre.x+this.namePre.textWidth+13,e.quality){case 1:this.nameTxt.color="#ffffff";break;case 2:this.nameTxt.color="#0fed10";break;case 3:this.nameTxt.color="#0eb8f1";break;case 4:this.nameTxt.color="#ed0ae6";break;default:this.nameTxt.color="#ffffff"}this._aniSke&&(this._aniSke.destroy(),this._aniSke=null),this._aniSke=new t.AnimationSKe(t.ResPath().getAnim(e.looks,t.ResourcePath.PATH_NPC),1),this._aniSke.scale(-.6,.6),this.addChildAt(this._aniSke,0),this._aniSke.play("act_idle",!0),this._aniSke.x=75,this._aniSke.y=166},i.prototype.onClick=function(){new t.MasterShowMonster(this._curData).show()},i}(ui.master.MasterLilianItemUI);t.MasterLilianItem=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,t.ModelDef.MASTER_MODEL),this.brotherList=[new i,new i,new i,new i,new i],this.masterInfo=new i,this.brotherNameArr=["首席","二弟子","三弟子","四弟子","五弟子"],this.maxBrotherNum=5,this.maxPupilLevel=35,this.showQuickRenIcon=!0,this.masterTreasureGetPoint=100,this.masterDrama=[1062,1063,1064,1065,1066,1067,1068,1069,1070],this.masterTitleMap={"初级新师":1,"中级大师":2,"高级名师":3,"绝代宗师":4}}return __extends(s,e),s.prototype.reqData=function(){t.XHR().Post({cmd:"mentor"},this,this.onReqDataBack)},s.prototype.onReqDataBack=function(e){0==e.result?e.mentor?(e.mentor.uid==t.Global.UID?(this.haveMaster=!1,this.isMaster=!0):(this.haveMaster=!0,this.isMaster=!1),this.onBaseDataRet(e)):(this.haveMaster=!1,this.isMaster=!1,this.onApplyDataRet(e)):t.WeakTips.show(e.msg)},s.prototype.onBaseDataRet=function(e){if(0==e.result){for(var i=e.list,n=0;n<this.maxBrotherNum;n++)this.brotherList[n].update(i[n],this.brotherNameArr[n],n),i[n]&&this.haveMaster&&i[n].uid==t.Global.UID&&(this.mineBrotherInfo=this.brotherList[n]);this.masetrData=e.mentor,this.notice=e.notice,this.maxnum=e.maxnum,this.masterInfo.update(e.mentor,"师傅",-1),this.masterUid=e.mentor.uid,this.masterSexType=e.mentor.sex,this.masterSex=1==this.masterSexType?"male":"female",this.event(s.MASTERMODEL_BASE_DATA_RET)}else t.WeakTips.show(e.msg)},s.prototype.onApplyDataRet=function(e){0==e.result?(this.applyTimes=e.apply_times,this.masterList=e.list,this.event(s.MASTERMODEL_APPLY_DATA_RET)):t.WeakTips.show(e.msg)},s.prototype.searchMaster=function(e){t.XHR().Post({cmd:"mentor",mentor:e},this,this.onSearchRet)},s.prototype.onSearchRet=function(e){0==e.result?(this.searchMasterData=e.list,this.event(s.MASTERMODEL_SHOW_SEARCH_MASTER),this.event(s.MASTERMODEL_HIDE_SEARCH_PANEL)):t.WeakTips.show(e.msg)},s.prototype.dealFight=function(e,i){e.win&&this.lilianData.fight_times++;for(var s=this.lilianData.npcs,n=0;n<s.length;n++)if(s[n].idx==i){s.splice(n,1);break}s.push(e.newnpc);var a=new t.FightCommand(e);t.once(t.FightStaticStr.FIGHT_COMPLETE,this,this.onFightEnd),t.Facade.callCommand(a)},s.prototype.onFightEnd=function(){this.event(s.MASTERMODEL_UPDARE_LILIAN)},s.MASTERMODEL_BASE_DATA_RET="MASTERMODEL_BASE_DATA_RET",s.MASTERMODEL_APPLY_DATA_RET="MASTERMODEL_APPLY_DATA_RET",s.MASTERMODEL_SHOW_SEARCH_MASTER="MASTERMODEL_SHOW_SEARCH_MASTER",s.MASTERMODEL_HIDE_SEARCH_PANEL="MASTERMODEL_HIDE_SEARCH_PANEL",s.MASTERMODEL_HIDE_APPLY_PANEL="MASTERMODEL_HIDE_APPLY_PANEL",s.MASTERMODEL_DELETE_APPLYER="MASTERMODEL_DELETE_APPLYER",s.MASTERMODEL_UPDARE_LILIAN="MASTERMODEL_UPDARE_LILIAN",s.MASTERMODEL_UPDARE_TREASUREBOX="MASTERMODEL_UPDARE_TREASUREBOX",s.MASTERMODEL_UPDARE_TEABTN="MASTERMODEL_UPDARE_TEABTN",s.MASTERMODEL_UPDARE_NOTICE="MASTERMODEL_UPDARE_NOTICE",s.MASTERMODEL_HIDE_ADD_REDDOT="MASTERMODEL_HIDE_ADD_REDDOT",s.MASTERMODEL_HIDE_TASK="MASTERMODEL_HIDE_TASK",s.MASTERMODEL_TASK_OPEN_PANEL="MASTERMODEL_TASK_OPEN_PANEL",s}(t.BaseModel);t.MasterModel=e;var i=function(){function t(){}return t.prototype.update=function(t,e,i){this.rank=i+1,t?(this.isAlive=!0,this.uid=t.uid,this.sex=1==t.sex?"male":"female",this.sexType=t.sex,this.type=t.status,this.name=t.name,this.power=t.attack_power,this.level=t.level,this.headimgurl=t.headimgurl,this.logintime=t.logintime,this.namePre=e,this.status=t.status):this.isAlive=!1},t}();t.MasterBrotherInfo=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(e){if(!this._model){this._model=new t.MasterModel,t.Facade.singleton.model.registerModel(this._model),this._model.on(t.MasterModel.MASTERMODEL_BASE_DATA_RET,this,this.onBaseRet),this._model.on(t.MasterModel.MASTERMODEL_APPLY_DATA_RET,this,this.onApplyRet);var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL);if(i.level>=11){var s=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);s.setDailyDataValue(t.ServerSetDataModel.KEY_DAILY_MASTER_REDDOT,1);var n=t.Facade.singleton.model.retrieveModel(t.ModelDef.ALL_STATUS_MODEL);n.setStatueFlagByName(t.AllStatusModel.MASTER_STATE,0)}}switch(e.getCommandName()){case"MasterCommand":this._model.reqData();break;case"MasterLilianCommand":t.XHR().Post({cmd:"mentor",op:"viewtrain"},this,this.onLilianRet)}},s.prototype.getPluginName=function(){return e.PLUGIN_MASTER},s.prototype.onBaseRet=function(e){this._panel||(this._panel=new t.MasterScene),t.SceneMgr.changeScene(this._panel),this._panel.update()},s.prototype.onApplyRet=function(){(new t.MasterApply).show()},s.prototype.onLilianRet=function(e){0==e.result?(this._model.lilianData=e,this._lilianScene||(this._lilianScene=new t.MasterLilian),t.SceneMgr.changeScene(this._lilianScene)):t.WeakTips.show(e.msg)},s}(t.Plugin);t.MasterModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.master.MasterNoticeUI,!0,!0),this._display=this.skin,this.setCloseButton(this._display.boxClose),this._display.queDingBtn.on(Laya.Event.CLICK,this,this.modifyNotice),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.MASTER_MODEL),this._display.inputTxt.maxChars=40,this._display.inputTxt.color="#4A2507",this._display.inputTxt.text=this._model.notice,this._model.isMaster||(this._display.msgTxt.visible=!1,this._display.inputTxt.mouseEnabled=!1)}return __extends(i,e),i.prototype.modifyNotice=function(){""==this._display.inputTxt.text?t.WeakTips.show("门规不能为空"):this._model.isMaster?t.XHR().Post({cmd:"mentor",op:"set",notice:this._display.inputTxt.text},this,this.onSetRet):this.hide()},i.prototype.onSetRet=function(e){0==e.result?(this._model.notice=this._display.inputTxt.text,t.WeakTips.show("设置成功"),this._model.event(t.MasterModel.MASTERMODEL_UPDARE_NOTICE),this.hide()):t.WeakTips.show(e.msg)},i.prototype.destroy=function(){e.prototype.destroy.call(this)},i}(t.BaseBox);t.MasterNotice=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i){e.call(this,new ui.master.MasterPupilViewUI,!0,!0),this.m_ui=this.skin,this.setCloseButton(this.m_ui.boxClose),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.MASTER_MODEL),this._curData=i,this.m_ui.fightBtn.on(Laya.Event.CLICK,this,this.onClickFight),this.m_ui.leaveMaster.on(Laya.Event.CLICK,this,this.onClickLeave),this.m_ui.addBtn.on(Laya.Event.CLICK,this,this.onClickAddFriend),this.m_ui.addMasterBtn.on(Laya.Event.CLICK,this,this.onClickAddMaster),this.m_ui.sendMsg.on(Laya.Event.CLICK,this,this.onClickSendMsg)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.onShowed=function(){e.prototype.onShowed.call(this),this.update()},i.prototype.onHided=function(){e.prototype.onHided.call(this)},i.prototype.update=function(){this.m_ui.pupilName.text=this._curData.name,this.m_ui.tfLvl.text=this._curData.level+"",this.m_ui.tfAtk.text=this._curData.power+"",this.m_ui.defaultHead.skin=t.JSUtils.getHeadUrl("",this._curData.sexType),this.m_ui.photo.skin="",this.m_ui.photo.skin=t.JSUtils.getHeadUrl(this._curData.headimgurl,this._curData.sexType),this.m_ui.rankTxt.text="身份："+this._curData.namePre,this.m_ui.timeTxt.text="登录时间："+t.DateUtils.getDaysBySecond2(this._curData.logintime),this.m_ui.photo.on(Laya.Event.CLICK,this,this.onClickPhoto),0==this._curData.rank?(this.m_ui.masterBox.visible=!0,this.m_ui.fightBox.visible=!1,this.m_ui.leaveBox.visible=!1,1==t.JSUtils.isFriend(this._model.masterInfo.uid)?(this.m_ui.tips2.color="#ff3600",this.m_ui.tips2.text="好友请教经验+50%(已激活)",this.m_ui.tips1.text="体力+"+this._model.masetrData.tea_vit+",经验+"+(1.5*this._model.masetrData.tea_exp+this._model.masetrData.tea_extra)):(this.m_ui.tips2.color="#989189",this.m_ui.tips2.text="好友请教经验+50%(未激活)",this.m_ui.tips1.text="体力+"+this._model.masetrData.tea_vit+",经验+"+(this._model.masetrData.tea_exp+this._model.masetrData.tea_extra)),0==this._model.mineBrotherInfo.status?(this.m_ui.teaBtn.on(Laya.Event.CLICK,this,this.clickTea),this.m_ui.teaBtn.gray=!1):(this.m_ui.teaBtn.off(Laya.Event.CLICK,this,this.clickTea),this.m_ui.teaBtn.gray=!0)):(this.m_ui.masterBox.visible=!1,this._curData.uid==t.Global.UID||this._model.isMaster?(this.m_ui.fightBox.visible=!1,this.m_ui.leaveBox.visible=!0,this._model.isMaster?(this.m_ui.leaveMaster.label="逐出师门",this.m_ui.sendMsg.visible=!0,this.m_ui.leaveMaster.x=246):(this.m_ui.leaveMaster.label="脱离师门",this.m_ui.sendMsg.visible=!1,this.m_ui.leaveMaster.x=123)):(this.m_ui.fightBox.visible=!0,this.m_ui.leaveMaster.visible=!1,this.m_ui.leaveBox.visible=!1,1==t.JSUtils.isFriend(this._curData.uid)?(this.m_ui.addBtn.visible=!1,this.m_ui.fightBtn.x=123):t.Global.isSQ&&window.mqq&&mqq.compare&&mqq.compare("7.1.5")>=0?(this.m_ui.addBtn.visible=!0,this.m_ui.fightBtn.x=246):(this.m_ui.addBtn.visible=!1,this.m_ui.fightBtn.x=123)))},i.prototype.onClickFight=function(){var e=this._curData.rank>this._model.mineBrotherInfo.rank?0:1;t.XHR().Post({cmd:"mentor",op:"fight",oppuid:this._curData.uid,type:e},this,this.onFightRet)},i.prototype.onFightRet=function(e){if(0==e.result){var i=new t.FightCommand(e);t.Facade.callCommand(i),e.win>0&&(this._model.reqData(),this.hide())}else t.WeakTips.show(e.msg)},i.prototype.onClickLeave=function(){this._model.isMaster?t.ConfirmBox.show(new t.ConfirmBoxData({contentStr:"确认将该徒弟逐出师门吗？",callBackHandler:new Handler(this,this.confirmGetout)})):t.ConfirmBox.show(new t.ConfirmBoxData({contentStr:"脱离师门后，师徒试练需加入师门第二天方可参加，加入师门的天数奖励相关加成将重置，是否确认？",callBackHandler:new Handler(this,this.confirmLeave)}))},i.prototype.confirmLeave=function(){t.XHR().Post({cmd:"mentor",op:"quit"},this,this.onGraduateRet)},i.prototype.onGraduateRet=function(e){0==e.result?(t.WeakTips.show("脱离成功"),this.hide(),t.Facade.callCommand(new t.HomeCommand)):t.WeakTips.show(e.msg)},i.prototype.confirmGetout=function(){t.XHR().Post({cmd:"mentor",op:"quit",oppuid:this._curData.uid},this,this.onKickRet)},i.prototype.onKickRet=function(e){0==e.result?(this._model.reqData(),t.WeakTips.show("逐出师门成功"),this.hide()):t.WeakTips.show(e.msg)},i.prototype.onClickPhoto=function(){t.Facade.callCommand(new t.UserInfoCommand(this._curData.uid))},i.prototype.onClickAddFriend=function(){1==t.JSUtils.isFriend(this._curData.uid)?t.WeakTips.show("已是好友"):t.Global.isSQ&&window.mqq&&mqq.compare&&mqq.compare("7.1.5")>=0?t.ConfirmBox.show(new t.ConfirmBoxData({contentStr:"确定要发送添加好友消息吗？",title:"提 示",isShowXBtn:!1,confirmStr:"发送",callBackHandler:Handler.create(this,this.onSureToAdd)})):t.WeakTips.show("添加对方为好友")},i.prototype.onClickSendMsg=function(){0!=this._curData.status?t.WeakTips.show("该徒弟今日已敬茶请教，无需呼唤！"):1==t.JSUtils.isFriend(this._curData.uid)?t.ShareModule.shareMessage({title:["师门飞鸽！"],desc:["光速升级，快来师门领取大量经验吧！"],toUin:this._curData.uin,uid:this._curData.uid,alertType:1,command:1002},Handler.create(this,this.sendCallBack),2):t.Global.isSQ&&window.mqq&&mqq.compare&&mqq.compare("7.1.5")>=0?t.ConfirmBox.show(new t.ConfirmBoxData({contentStr:"添加对方好友后即可发送师门飞鸽，是否加该徒弟为好友？",title:"提 示",isShowXBtn:!1,confirmStr:"加为好友",cancleStr:"暂不添加",callBackHandler:Handler.create(this,this.onSureToAdd)})):t.WeakTips.show("添加对方为好友后，即可发送师门飞鸽呼唤对方")},i.prototype.sendCallBack=function(e){e&&0==e.retCode?t.WeakTips.show("发送成功"):t.WeakTips.show("发送失败")},i.prototype.onClickAddMaster=function(){1==t.JSUtils.isFriend(this._curData.uid)?t.WeakTips.show("已是好友，每日敬茶可额外获得50%经验"):t.Global.isSQ&&window.mqq&&mqq.compare&&mqq.compare("7.1.5")>=0?t.ConfirmBox.show(new t.ConfirmBoxData({contentStr:"确定要发送添加好友消息吗？",title:"提 示",isShowXBtn:!1,confirmStr:"发送",callBackHandler:Handler.create(this,this.onSureToAdd)})):t.Global.isWXAPP?t.ConfirmBox.show(new t.ConfirmBoxData({contentStr:"确定要添加好友吗？",title:"提 示",isShowXBtn:!1,confirmStr:"确 定",callBackHandler:Handler.create(this,this.onSureToAddWxapp)})):t.WeakTips.show("添加对方为好友，每日敬茶可额外获得50%经验")},i.prototype.onSureToAddWxapp=function(){t.XHR().Post({cmd:"sns",op:"add_in_fri",target_uid:this._curData.uid},this,this.onAddBackRet)},i.prototype.onAddBackRet=function(e){0==e.result?(t.WeakTips.show("添加成功"),t.JSUtils.addOneFriend(this._curData.uid),this.m_ui.tips2.color="#ff3600",this.m_ui.tips2.text="好友请教经验+50%(已激活)"):t.WeakTips.show(e.msg)},i.prototype.onSureToAdd=function(){t.ShareModule.openIdMap[this._curData.uid]?t.JSUtils.addFriend(t.ShareModule.openIdMap[this._curData.uid].openid,this._curData.name,t.Global.GameName,"1",this,this.onAddFriendCallback):t.XHR().Post({cmd:"detail",op:"simple",puid:this._curData.uid},this,this.onQueryOpenId)},i.prototype.onAddFriendCallback=function(e){e&&0==e.code&&e.result&&t.WeakTips.show("发送成功,请等待同意申请")},i.prototype.onQueryOpenId=function(e){0==e.result?(t.ShareModule.openIdMap[e.uid]={openid:e.openid,uin:e.uin},this.onSureToAdd()):t.WeakTips.show(e.msg)},i.prototype.clickTea=function(){1==t.JSUtils.isFriend(this._model.masterInfo.uid)?this.playDrama():t.ConfirmBox.show(new t.ConfirmBoxData({contentStr:"当师徒双方为好友时，每日敬茶请教的经验增加50%，确认是否直接请教？",title:"提 示",isShowXBtn:!1,confirmStr:"直接请教",callBackHandler:Handler.create(this,this.playDrama)}))},i.prototype.playDrama=function(){var e=new t.PlayDramaCmd(this._model.masterDrama[Math.floor(Math.random()*this._model.masterDrama.length)]+"");e.on(this,this.onDramaFinish),t.Facade.callCommand(e)},i.prototype.onDramaFinish=function(e){e.off(),t.XHR().Post({cmd:"mentor",op:"tea",type:1==t.JSUtils.isFriend(this._model.masterInfo.uid)?1:0},this,this.onTeaRet)},i.prototype.onTeaRet=function(e){t.WeakTips.show(e.msg),0==e.result&&(this._model.mineBrotherInfo.status=1,this.m_ui.teaBtn.off(Laya.Event.CLICK,this,this.clickTea),this.m_ui.teaBtn.gray=!0,t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!1)),this._model.event(t.MasterModel.MASTERMODEL_UPDARE_TEABTN),this.hide())},i}(t.BaseBox);t.MasterPupilView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.master.MasterRecruitUI,!0,!0),this.m_ui=this.skin,this.setCloseButton(this.m_ui.back.closeBtn),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.MASTER_MODEL),this.m_ui.roleBox.visible=!1,this.m_ui.list.scrollBar.visible=!1,this.m_ui.list.itemRender=i,this.m_ui.list.renderHandler=new Laya.Handler(this,this.renderList),this.m_ui.list.array=[],this.m_ui.checkBox0.on(Laya.Event.CHANGE,this,this.onChange0),this.m_ui.checkBox1.on(Laya.Event.CHANGE,this,this.onChange1),this.m_ui.settingBtn.on(Laya.Event.CLICK,this,this.onClickSend),this.m_ui.clearAllBtn.on(Laya.Event.CLICK,this,this.onClicClearAll)}return __extends(s,e),s.prototype.destroy=function(){e.prototype.destroy.call(this)},s.prototype.onShowed=function(){e.prototype.onShowed.call(this),t.XHR().Post({cmd:"mentor",op:"viewapply"},this,this.onViewApplyRet),this._model.on(t.MasterModel.MASTERMODEL_DELETE_APPLYER,this,this.onDeletApplyer)},s.prototype.onHided=function(){e.prototype.onHided.call(this)},s.prototype.onViewApplyRet=function(e){0==e.result?(this._curData=e,this.update()):t.WeakTips.show(e.msg)},s.prototype.renderList=function(t,e){t.update(this.m_ui.list.getItem(e),e)},s.prototype.update=function(){0==this._curData.join_type?(this.m_ui.checkBox0.selected=!0,this.m_ui.checkBox1.selected=!1):(this.m_ui.checkBox0.selected=!1,this.m_ui.checkBox1.selected=!0),this._curData.join_level<11&&(this._curData.join_level=34),this.updateBtn(),this.m_ui.needLvTxt.text=this._curData.join_level+"级",this.m_ui.list.array=this._curData.list,this.m_ui.list.array.length>0?this.m_ui.roleBox.visible=!1:this.m_ui.roleBox.visible=!0},s.prototype.onClickLeft=function(){this._curData.join_level>11&&this._curData.join_level--,this.m_ui.needLvTxt.text=this._curData.join_level+"级",this.updateBtn()},s.prototype.onClickRight=function(){this._curData.join_level<this._model.maxPupilLevel-1&&this._curData.join_level++,this.m_ui.needLvTxt.text=this._curData.join_level+"级",this.updateBtn()},s.prototype.updateBtn=function(){this._curData.join_level<=11?(this.m_ui.leftBtn.gray=!0,this.m_ui.rightBtn.gray=!1,this.m_ui.leftBtn.off(Laya.Event.CLICK,this,this.onClickLeft),this.m_ui.rightBtn.on(Laya.Event.CLICK,this,this.onClickRight)):this._curData.join_level<34?(this.m_ui.leftBtn.gray=!1,this.m_ui.rightBtn.gray=!1,this.m_ui.leftBtn.on(Laya.Event.CLICK,this,this.onClickLeft),this.m_ui.rightBtn.on(Laya.Event.CLICK,this,this.onClickRight)):(this.m_ui.leftBtn.gray=!1,this.m_ui.rightBtn.gray=!0,this.m_ui.leftBtn.on(Laya.Event.CLICK,this,this.onClickLeft),this.m_ui.rightBtn.off(Laya.Event.CLICK,this,this.onClickRight))},s.prototype.onChange0=function(){this.m_ui.checkBox0.selected?this.m_ui.checkBox1.selected=!1:this.m_ui.checkBox1.selected=!0},s.prototype.onChange1=function(){this.m_ui.checkBox1.selected?this.m_ui.checkBox0.selected=!1:this.m_ui.checkBox0.selected=!0},s.prototype.onClickSend=function(){var e=this.m_ui.checkBox0.selected?0:1,i=this._curData.join_level;t.XHR().Post({cmd:"mentor",op:"set",type:e,level:i},this,this.onSendRet)},s.prototype.onSendRet=function(e){0==e.result?(t.WeakTips.show("发布成功"),this.hide()):t.WeakTips.show(e.msg)},s.prototype.onClicClearAll=function(){t.XHR().Post({cmd:"mentor",op:"proc",oppuid:0,type:1},this,this.onDeleteAllRet)},s.prototype.onDeleteAllRet=function(e){0==e.result?(t.WeakTips.show("清空成功"),this.m_ui.list.array=[],this.m_ui.roleBox.visible=!0):t.WeakTips.show(e.msg)},s.prototype.onDeletApplyer=function(t){this._curData.list.splice(t,1),this.m_ui.list.array=this._curData.list,this.m_ui.list.array.length>0?this.m_ui.roleBox.visible=!1:this.m_ui.roleBox.visible=!0},s}(t.BaseBox);t.MasterRecruit=e;var i=function(e){function i(){e.call(this),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.MASTER_MODEL),this.deleteBtn.on(Laya.Event.CLICK,this,this.onClickDelete),this.agreeBtn.on(Laya.Event.CLICK,this,this.onClickAgree)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.update=function(e,i){this._curData=e,this._index=i,e&&(this.nameTxt.text=this._curData.name,this.strengTxt.text=this._curData.attack_power,this.playerInfo.tfLvl.text=this._curData.level+"",this.playerInfo.tfVip.text=""+this._curData.vip_level,this.playerInfo.photo.loadImage(t.JSUtils.getHeadUrl(this._curData.headimgurl),0,0,82,82),1==this._curData.sex?(this.playerInfo.maleIcon.visible=!0,this.playerInfo.femaleIcon.visible=!1,this.playerInfo.defaultHead.skin="ui/main/male.png"):(this.playerInfo.maleIcon.visible=!1,this.playerInfo.femaleIcon.visible=!0,this.playerInfo.defaultHead.skin="ui/main/female.png"))},i.prototype.onClickDelete=function(){t.XHR().Post({cmd:"mentor",op:"proc",oppuid:this._curData.uid,type:1},this,this.onDeleteRet)},i.prototype.onDeleteRet=function(e){0==e.result?this._model.event(t.MasterModel.MASTERMODEL_DELETE_APPLYER,this._index):t.WeakTips.show(e.msg)},i.prototype.onClickAgree=function(){t.XHR().Post({cmd:"mentor",op:"proc",oppuid:this._curData.uid,type:0},this,this.onAgreeRet)},i.prototype.onAgreeRet=function(e){0==e.result?(this._model.reqData(),t.WeakTips.show("同意成功")):t.WeakTips.show(e.msg)},i}(ui.master.MasterRecruitItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.master.MasterViewUI),this.m_ui=this.skin,this._isFirst=!0,this.m_ui.cacheLayer.cacheAs="bitmap",this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.MASTER_MODEL),this._um=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),this.m_ui.bg.skin=t.ResPath().getFightScene("master"),this.m_ui.closeBtn.clickHandler=new Laya.Handler(this,this.onClickBack),this.m_ui.rankBtn.on(Laya.Event.CLICK,this,this.onClickRank),this.m_ui.lilianBtn.on(Laya.Event.CLICK,this,this.onClickLilian),this.m_ui.taskBtn.on(Laya.Event.CLICK,this,this.onClickTask),this.m_ui.ruleBtn.on(Laya.Event.CLICK,this,this.onClickRule),this.m_ui.masterRuleBtn.on(Laya.Event.CLICK,this,this.onClickMasterRule),this.m_ui.graduateBtn.on(Laya.Event.CLICK,this,this.clickGraduate),this.m_ui.graduateTreasure.on(Laya.Event.CLICK,this,this.showGraduateTips),(t.Global.isWX||t.Global.isWXAPP)&&(this.m_ui.closeBtn.x-=100)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),this._model.off(t.MasterModel.MASTERMODEL_UPDARE_TREASUREBOX,this,this.updateTreasureBox),this._model.off(t.MasterModel.MASTERMODEL_UPDARE_NOTICE,this,this.updateNotice),this._model.off(t.MasterModel.MASTERMODEL_TASK_OPEN_PANEL,this,this.taskOpen),this._model=null},i.prototype.onShowed=function(){this._isFirst?this._isFirst=!1:this.resetImageSkin(this.m_ui),this._model.on(t.MasterModel.MASTERMODEL_UPDARE_TREASUREBOX,this,this.updateTreasureBox),this._model.on(t.MasterModel.MASTERMODEL_UPDARE_NOTICE,this,this.updateNotice),this._model.on(t.MasterModel.MASTERMODEL_TASK_OPEN_PANEL,this,this.taskOpen)},i.prototype.getSceneName=function(){return t.SceneDef.MASTER_SCENE},i.prototype.onHided=function(){Laya.timer.clear(this,this.hideNotice),Laya.timer.clear(this,this.showNotice),t.Tips.tipsClose()},i.prototype.update=function(){for(var e=0;e<this._model.maxBrotherNum;e++)this.m_ui["pupil"+e].update(this._model.brotherList[e]);this.m_ui.masterInfo.update(),this.m_ui.lilianReddot.visible=!1,this.m_ui.graduateBtn.visible=!1,this.m_ui.graduateTreasure.visible=!1,this._model.isMaster?(this.m_ui.lilianBtn.visible=!1,this.m_ui.lilianIcon.visible=!1,this.m_ui.lilianWord.visible=!1,this.m_ui.taskIcon.visible=!1,this.m_ui.taskWord.visible=!1):(this.m_ui.noticeBox.visible=!0,this.m_ui.lilianBtn.visible=!0,this.m_ui.lilianIcon.visible=!0,this.m_ui.lilianWord.visible=!0,this.m_ui.taskIcon.visible=!0,this.m_ui.taskWord.visible=!0,this.m_ui.graduateTreasure.visible=!0,this._model.masetrData.train_times<this._model.masetrData.max_train_times&&(this.m_ui.lilianReddot.visible=!0),this._um.level>=this._model.maxPupilLevel?(this.m_ui.graduateBtn.visible=!0,this.m_ui.graduateTreasure.gray=!1):this.m_ui.graduateTreasure.gray=!0),this.updateNotice(),this.showNotice(),this.m_ui.masterTitle.skin=t.ResPath().getPic(this._model.masterTitleMap[this._model.masetrData.mentor_title],t.ResourcePath.PATH_MASTER),this.updateTreasureBox(),this.m_ui.lilianIcon.visible=!1,this.m_ui.rankIcon.visible=!1,this.m_ui.taskIcon.visible=!1,this.m_ui.ruleIcon.visible=!1},i.prototype.updateNotice=function(){""!=this._model.notice?this.m_ui.noticeTxt.text=this._model.notice:this.m_ui.noticeTxt.text="师傅暂未发布门规",
this.m_ui.noticeBg.height=92+this.m_ui.noticeTxt.textHeight},i.prototype.hideNotice=function(){this.m_ui.noticeBox.visible=!1,Laya.timer.once(1e4,this,this.showNotice)},i.prototype.showNotice=function(){this.m_ui.noticeBox.visible=!0,Laya.timer.once(5e3,this,this.hideNotice)},i.prototype.onClickBack=function(){t.Facade.callCommand(new t.HomeCommand),Laya.loader.clearRes("res/atlas/ui/master.json"),Laya.loader.clearRes(t.ResPath().getFightScene("master")),Laya.loader.clearRes("ui/master/e.png"),Laya.loader.clearRes("ui/master/bgDown.png"),Laya.loader.clearRes("ui/master/img_shenqingliebiao.png"),Laya.loader.clearRes("ui/master/e.png")},i.prototype.updateTreasureBox=function(){this._model.isMaster?(this.m_ui.treasureBox.visible=!0,this.m_ui.treasureBox.numTxt.text=this._model.masetrData.mentor_point+"/"+this._model.masterTreasureGetPoint,this._model.masetrData.mentor_point>=this._model.masterTreasureGetPoint?(this.m_ui.treasureBox.treasureIcon.gray=!1,this.m_ui.treasureBox.treasureIcon.on(Laya.Event.CLICK,this,this.onClickTreasure)):(this.m_ui.treasureBox.treasureIcon.gray=!0,this.m_ui.treasureBox.treasureIcon.on(Laya.Event.CLICK,this,this.onClickTreasure))):this.m_ui.treasureBox.visible=!1},i.prototype.onClickTreasure=function(){if(this._model.masetrData.mentor_point>=this._model.masterTreasureGetPoint)t.XHR().Post({cmd:"mentor",op:"box"},this,this.onGetTreasure);else{var e,i={};e=this.localToGlobal(new laya.maths.Point(this.m_ui.treasureBox.x,this.m_ui.treasureBox.y)),i.name="师德礼包",i.info="领取条件：师傅消耗100师德领取",i.desc="随机获得下列物品之一：\n黄金卷轴+25；\n黄金卷轴+8；\n1级聚魂之盒+10；\n1级聚魂之盒+3；\n潜能果实+50；\n潜能果实+15；\n中威望旗+2；\n大威望旗+1；",t.Tips.show(i,e)}},i.prototype.showGraduateTips=function(){var e,i={};e=this.localToGlobal(new laya.maths.Point(this.m_ui.treasureBox.x,this.m_ui.treasureBox.y)),i.name="出师礼包",i.info="领取条件：入门第二天后达到35级，可出师领取",i.desc="内含物品如下：\n小体力药水+10；\n中体力药水+4；\n大体力药水+2；\n江湖令礼包+20；\n黄金卷轴+10；\n中威望旗+2；\n经验药水+2；\n灵药葫芦+8；",t.Tips.show(i,e)},i.prototype.onGetTreasure=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),this._model.masetrData.mentor_point-=this._model.masterTreasureGetPoint,this.updateTreasureBox()):t.WeakTips.show(e.msg)},i.prototype.onClickRank=function(){t.Facade.callCommand(new t.RankCMD(10)),this.m_ui.lilianIcon.visible=!1,this.m_ui.rankIcon.visible=!0,this.m_ui.taskIcon.visible=!1,this.m_ui.ruleIcon.visible=!1,t.Tips.tipsClose()},i.prototype.onClickLilian=function(){this._um.level>=this._model.maxPupilLevel?t.WeakTips.show("恭喜达到35级，已成为乐斗大侠，快出师收徒吧！"):0==this._model.mineBrotherInfo.status?t.WeakTips.show("给师傅敬茶之后，即可参与师门试练！"):t.Facade.callCommand(new t.MasterLilianCommand),this.m_ui.lilianIcon.visible=!0,this.m_ui.rankIcon.visible=!1,this.m_ui.taskIcon.visible=!1,this.m_ui.ruleIcon.visible=!1,t.Tips.tipsClose()},i.prototype.onClickTask=function(){this._model.isMaster||(this.m_ui.lilianIcon.visible=!1,this.m_ui.rankIcon.visible=!1,this.m_ui.taskIcon.visible=!0,this.m_ui.ruleIcon.visible=!1,this._um.level>=this._model.maxPupilLevel?t.WeakTips.show("恭喜达到35级，已成为乐斗大侠，快出师收徒吧！"):(new t.MasterTask).show(),t.Tips.tipsClose())},i.prototype.onClickRule=function(){(new t.MasterNotice).show(),this.m_ui.lilianIcon.visible=!1,this.m_ui.rankIcon.visible=!1,this.m_ui.taskIcon.visible=!1,this.m_ui.ruleIcon.visible=!0,t.Tips.tipsClose()},i.prototype.onClickMasterRule=function(){t.Tips.tipsClose();var e="<img src='ui/comp/icon.png'></img><span style='font-weight:bold'>1.</span>35级前可拜师，35级出师之后可发布收徒信息；<br><img src='ui/comp/icon.png'></img><span style='font-weight:bold'>2.</span>徒弟每天可敬茶，师门试练和完成师门任务；<br><img src='ui/comp/icon.png'></img><span style='font-weight:bold'>4.</span>师傅每天可为徒弟解惑获得师德奖励，师德可用于开启师德宝箱获得大量奖励；<br><img src='ui/comp/icon.png'></img><span style='font-weight:bold'>5.</span>入门时间越长，则师徒互动的奖励越多；<br><img src='ui/comp/icon.png'></img><span style='font-weight:bold'>6.</span>徒弟出师可获得大量奖励，同时师傅可通过邮件获得谢师礼包，获得师德奖励；<br><img src='ui/comp/icon.png'></img><span style='font-weight:bold'>7.</span>每个师傅每周最多可获得5个谢师礼包；<br><img src='ui/comp/icon.png'></img><span style='font-weight:bold'>8.</span>师傅历史师德越高，可获得越好的称号，同时可开启更多的徒弟位置。<br><br><br><br>";t.RulePanel.showRule(e,"")},i.prototype.taskOpen=function(e){switch(e){case 0:var i=new t.MasterPupilView(this._model.masterInfo);i.show();break;case 1:t.WeakTips.show("请点击同门进行切磋");break;case 2:this.onClickLilian()}},i.prototype.clickGraduate=function(){this._um.level>=this._model.maxPupilLevel?t.XHR().Post({cmd:"mentor",op:"quit"},this,this.onGraduateRet):t.WeakTips.show(this._model.maxPupilLevel+"级之后才可出师哦")},i.prototype.onGraduateRet=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0,"师傅领进门，修行在个人，恭喜获得出师奖励")),t.Facade.callCommand(new t.HomeCommand)):t.WeakTips.show(e.msg)},i}(t.BaseScene);t.MasterScene=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.master.SearchMasterBoxUI,!0,!0),this.m_ui=this.skin,this.setCloseButton(this.m_ui.closeBtn),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.MASTER_MODEL),this.m_ui.searchBtn.on(Laya.Event.CLICK,this,this.clickSearch)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),this._model.off(t.MasterModel.MASTERMODEL_HIDE_SEARCH_PANEL,this,this.hide),this._model=null},i.prototype.onShowed=function(){e.prototype.onShowed.call(this),this._model.on(t.MasterModel.MASTERMODEL_HIDE_SEARCH_PANEL,this,this.hide)},i.prototype.onHided=function(){e.prototype.onHided.call(this)},i.prototype.clickSearch=function(){""==this.m_ui.facIDTxt.text?t.WeakTips.show("请输入师傅编号"):this._model.searchMaster(this.m_ui.facIDTxt.text)},i}(t.BaseBox);t.MasterSearch=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i){e.call(this,new ui.master.MasterShowMonsterUI,!0,!0),this.m_ui=this.skin,this.setCloseButton(this.m_ui.boxClose),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.MASTER_MODEL),this._curData=i,this.m_ui.fightBtn.on(Laya.Event.CLICK,this,this.onFight)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),this._aniSke&&(this._aniSke.destroy(),this._aniSke=null)},i.prototype.onShowed=function(){e.prototype.onShowed.call(this),this.update()},i.prototype.onHided=function(){e.prototype.onHided.call(this)},i.prototype.update=function(){switch(this.m_ui.rewardTxt.text="经验*"+this._curData.exp,this.m_ui.descTxt.text=this._curData.desc,this.m_ui.npcNameTxt.text=this._curData.name,this.m_ui.levelTxt.text=this._curData.level+"级",this._aniSke=new t.AnimationSKe(t.ResPath().getAnim(this._curData.looks,t.ResourcePath.PATH_NPC)),this.m_ui.addChild(this._aniSke),this._aniSke.play("act_idle",!0),this._aniSke.scaleX=-1,this._aniSke.x=265,this._aniSke.y=287,this.m_ui.fightBtn.label="挑 战("+(this._model.lilianData.max_fight_times-this._model.lilianData.fight_times)+")",this._curData.quality){case 1:this.m_ui.npcNameTxt.color="#ffffff";break;case 2:this.m_ui.npcNameTxt.color="#0fed10";break;case 3:this.m_ui.npcNameTxt.color="#0eb8f1";break;case 4:this.m_ui.npcNameTxt.color="#ed0ae6";break;default:this.m_ui.npcNameTxt.color="#ffffff"}},i.prototype.onFight=function(){this._model.lilianData.fight_times<this._model.lilianData.max_fight_times?t.XHR().Post({cmd:"mentor",op:"train",idx:this._curData.idx},this,this.onFightRet):t.WeakTips.show("今日已无挑战次数")},i.prototype.onFightRet=function(e){0==e.result?(this._model.dealFight(e,this._curData.idx),this.hide()):t.WeakTips.show(e.msg)},i}(t.BaseBox);t.MasterShowMonster=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.master.MasterTaskUI,!0,!0),this.m_ui=this.skin,this.setCloseButton(this.m_ui.back.closeBtn),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.MASTER_MODEL)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),this._model.off(t.MasterModel.MASTERMODEL_HIDE_TASK,this,this.hide),this._model=null},i.prototype.onShowed=function(){e.prototype.onShowed.call(this),this._model.on(t.MasterModel.MASTERMODEL_HIDE_TASK,this,this.hide),t.XHR().Post({cmd:"mentor",op:"task"},this,this.onDataRet)},i.prototype.onHided=function(){e.prototype.onHided.call(this)},i.prototype.onDataRet=function(e){0==e.result?this.destroyed||(this._curData=e,this.update()):t.WeakTips.show(e.msg)},i.prototype.update=function(){for(var t=0;3>t;t++)this._curData.task[t]?(this.m_ui["task"+t].visible=!0,this.m_ui["task"+t].update(this._curData.task[t],this._curData.award_vit,this._curData.award_exp,t)):this.m_ui["task"+t].visible=!1},i}(t.BaseBox);t.MasterTask=e;var i=function(e){function i(){e.call(this),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.MASTER_MODEL),this.goodsIcon.skin=t.ResPath().getPic("kExp",t.ResourcePath.PATH_GOODS),this.goodsIcon2.skin=t.ResPath().getPic("kVit",t.ResourcePath.PATH_GOODS)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),this._model=null},i.prototype.update=function(e,i,s,n){switch(this._curData=e,this._index=n,n){case 0:this.tfMDesc.text="给师傅敬茶"+this._curData.max+"次",this.tfMTitle.text="尊师重道",this.ico.skin=t.ResPath().getPic(1,t.ResourcePath.PATH_TASK);break;case 1:this.tfMDesc.text="与同门切磋"+this._curData.max+"次",this.tfMTitle.text="同门切磋",this.ico.skin=t.ResPath().getPic(2,t.ResourcePath.PATH_TASK);break;case 2:this.tfMDesc.text="今日参与试练"+this._curData.max+"次",this.tfMTitle.text="惩奸除恶",this.ico.skin=t.ResPath().getPic(2,t.ResourcePath.PATH_TASK)}this.tfMProgressTxt.text=this._curData.value+"/"+this._curData.max,this.countTxt.text=s+"",this.countTxt2.text=i+"",0==this._curData.flag&&this._curData.value<this._curData.max?(this.btnGo2.visible=!0,this.btnGet.visible=!1,this.btnGo2.on(Laya.Event.CLICK,this,this.onClickGo)):0==this._curData.flag&&this._curData.value>=this._curData.max?(this.btnGo2.visible=!1,this.btnGet.visible=!0,this.btnGet.label="领取奖励",this.btnGet.gray=!1,this.btnGet.on(Laya.Event.CLICK,this,this.onClickGet)):(this.btnGo2.visible=!1,this.btnGet.visible=!0,this.btnGet.label="已领取",this.btnGet.gray=!0,this.btnGet.off(Laya.Event.CLICK,this,this.onClickGet))},i.prototype.onClickGo=function(){this._model.event(t.MasterModel.MASTERMODEL_TASK_OPEN_PANEL,this._index),this._model.event(t.MasterModel.MASTERMODEL_HIDE_TASK)},i.prototype.onClickGet=function(){t.XHR().Post({cmd:"mentor",op:"task",type:"1",id:this._curData.id},this,this.onRet)},i.prototype.onRet=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),this._curData.flag=1,this.btnGo2.visible=!1,this.btnGet.visible=!0,this.btnGet.label="已领取",this.btnGet.gray=!0,this.btnGet.off(Laya.Event.CLICK,this,this.onClickGet)):t.WeakTips.show(e.msg)},i}(ui.master.MasterTaskItemUI);t.MasterTaskItem=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this._model=t.Facade.singleton.model.retrieveModel(t.ModelDef.MASTER_MODEL),this._um=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),this._model.on(t.MasterModel.MASTERMODEL_HIDE_ADD_REDDOT,this,this.hideRedDot)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),this._model.off(t.MasterModel.MASTERMODEL_HIDE_ADD_REDDOT,this,this.hideRedDot),this._wenhaoSke&&(this._wenhaoSke.destroy(),this._wenhaoSke=null),this.lock.off(Laya.Event.CLICK,this,this.showLockTips)},i.prototype.update=function(e){if(this._curData=e,this.showRole(),this.reddot.visible=!1,this._curData.isAlive)this._roleSke.visible=!0,this.nameBg.visible=!0,this.addBtn.visible=!1,this.lock.visible=!1,this._roleSke.showSkinByName(this._curData.sex),this.namePre.text=this._curData.namePre,this.nameTxt.text=this._curData.name,this.nameTxt.x=this.namePre.x+this.namePre.textWidth+5,this._model.isMaster?1==this._curData.status?(this.fixBtn.visible=!1,this.fixBtn.gray=!1,this.showWenHao(),this.fixBtn.on(Laya.Event.CLICK,this,this.onClickFix)):0==this._curData.status?(this.fixBtn.visible=!0,this.fixBtn.gray=!0,this.fixBtn.off(Laya.Event.CLICK,this,this.onClickFix),this._wenhaoSke&&(this._wenhaoSke.destroy(),this._wenhaoSke=null)):(this.fixBtn.visible=!1,this._wenhaoSke&&(this._wenhaoSke.destroy(),this._wenhaoSke=null)):(this.fixBtn.visible=!1,this.fixBtn.off(Laya.Event.CLICK,this,this.onClickFix),this._wenhaoSke&&(this._wenhaoSke.destroy(),this._wenhaoSke=null)),this.clickArea.on(Laya.Event.CLICK,this,this.onClickRole);else{if(this._roleSke.visible=!1,this.nameBg.visible=!1,this.fixBtn.visible=!1,this.lock.visible=!1,this.addBtn.visible=!1,this.addBtn.skin="",this.addBtn.skin="ui/master/sbtn1_add.png",this._model.isMaster)if(this._curData.rank<=this._model.maxnum){this.addBtn.visible=!0;var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);0==i.getDailyDataValue(t.ServerSetDataModel.KEY_DAILY_MASTER_ADD_REDDOT)&&(this.reddot.visible=!0),this.addBtn.on(Laya.Event.CLICK,this,this.onClickAdd)}else this.lock.visible=!0;else this.addBtn.visible=!1,this.addBtn.off(Laya.Event.CLICK,this,this.onClickAdd);this.clickArea.off(Laya.Event.CLICK,this,this.onClickRole)}this.lock.on(Laya.Event.CLICK,this,this.showLockTips)},i.prototype.showLockTips=function(){var e=[600,600,600,600,2e3,5e3,5e3];t.WeakTips.show("师德达到"+e[this._curData.rank]+"开启"+this._curData.rank+"个徒弟位置")},i.prototype.showRole=function(){this._roleSke||(this._roleSke=new t.AnimationSKe(t.ResPath().getAnimPath("xianxiagg",t.ResourcePath.PATH_NPC)+".sk",1),this.addChildAt(this._roleSke,0),this._roleSke.x=125,this._roleSke.y=65,this._roleSke.play(0,!0),this._roleSke.scale(.8,.8))},i.prototype.showWenHao=function(){this._wenhaoSke||(this._wenhaoSke=new t.AnimationSKe(t.ResPath().getEffect("wenhao")),this.addChild(this._wenhaoSke),this._wenhaoSke.x=160,this._wenhaoSke.y=3,this._wenhaoSke.play(0,!0))},i.prototype.onClickAdd=function(){(new t.MasterRecruit).show();var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);0==e.getDailyDataValue(t.ServerSetDataModel.KEY_DAILY_MASTER_ADD_REDDOT)&&(e.setDailyDataValue(t.ServerSetDataModel.KEY_DAILY_MASTER_ADD_REDDOT,1),this._model.event(t.MasterModel.MASTERMODEL_HIDE_ADD_REDDOT))},i.prototype.hideRedDot=function(){this.reddot.visible=!1},i.prototype.onClickRole=function(){if(this._um.level>=this._model.maxPupilLevel&&!this._model.isMaster)t.WeakTips.show("恭喜达到35级，已成为乐斗大侠，快出师收徒吧！");else if(this._model.isMaster&&1==this._curData.status)this.onClickFix();else{var e=new t.MasterPupilView(this._curData);e.show()}},i.prototype.onClickFix=function(){t.XHR().Post({cmd:"mentor",op:"disabuse",oppuid:this._curData.uid},this,this.onDisabuseRet)},i.prototype.onDisabuseRet=function(e){t.WeakTips.show(e.msg),0==e.result&&(this._curData.status=2,this.fixBtn.visible=!1,this._model.masetrData.mentor_point=e.mentor_point,this._model.event(t.MasterModel.MASTERMODEL_UPDARE_TREASUREBOX),t.Facade.callCommand(new t.SyncChangeCmd(e)),this._wenhaoSke&&(this._wenhaoSke.destroy(),this._wenhaoSke=null),this._model.reqData())},i}(ui.master.PupilInfoUI);t.PupilInfo=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.isLookUp=!1,this.txtPanel.vScrollBar.visible=!1,this.equipBtn0.on(Laya.Event.CLICK,this,this.onEquip0),this.equipBtn1.on(Laya.Event.CLICK,this,this.onEquip1),this.skillDec.style.fontFamily="黑体",this.skillDec.style.fontSize=20,this.skillDec.style.leading=4,this.skillDec.style.bold=!0,this.skillDec.style.color="#4d3f34",this.skillDec.style.valign="top",this.tipsHtml.style.fontFamily="黑体",this.tipsHtml.style.fontSize=22,this.tipsHtml.style.leading=4,this.tipsHtml.style.bold=!0,this.tipsHtml.style.align="center",this.tipsHtml.style.color="#4d3f34",this.tipsHtml.style.valign="top",this.redIcon0.visible=!1,this.redIcon1.visible=!1,this.redIcon2.visible=!1}return __extends(i,e),i.prototype.onhide=function(){Laya.timer.clear(this,this.onTime),Laya.timer.clear(this,this.onUpBtn)},i.prototype.update=function(e){if(e&&e.assist_skill){var i=t.MonsterView.getHolyLevel(e.holy_things),s=t.MonsterView.getSkillLimitData(i),n=s.skillLimit,a=s.nextHoly;this.goodIcon.on(Laya.Event.CLICK,this,this.onClickGoodicon),this._totalData=e,this._curData=e.assist_skill,this._curData.redIconShow=!1,this.redIcon0.visible=!1,this.redIcon1.visible=!1,this.redIcon2.visible=!1,this.skillName.text=this._curData.assist_skill.name+"(等级："+this._curData.level+")",this.skillIcon.skin=t.ResPath().getPic(this._curData.assist_skill.id,t.ResourcePath.PATH_SKILL,1),this.skillDec.innerHTML=t.MonsterView.changeDecHtml(this._curData.assist_skill.desc),this._curData.bind_skills.sort(this.sortSkill);for(var o=0;2>o;o++)this._curData.bind_skills[o]&&(this._curData.bind_skills[o].id?(this["equipSkill"+o].skin=t.ResPath().getPic(this._curData.bind_skills[o].id,t.ResourcePath.PATH_SKILL,1),t.MonsterView.bindSkillList&&-1==t.MonsterView.bindSkillList.indexOf(this._curData.bind_skills[o].id)&&t.MonsterView.bindSkillList.push(this._curData.bind_skills[o].id),this["equipBtn"+o].label="卸载"):(this["equipSkill"+o].skin="ui/monster/t"+this._curData.bind_skills[o].itype+".png",this["equipBtn"+o].label="搭载"),i>=this._curData.bind_skills[o].open_level?(this["tips"+o].visible=!1,this["equipBtn"+o].visible=!0,this._curData.bind_skills[o].id||(this._curData.redIconShow=!0,this["redIcon"+o].visible=!0)):(this["tips"+o].visible=!0,this["tips"+o].text="圣物"+t.MonsterHolyItem.getPinzhiName(this._curData.bind_skills[o].open_level).word+"开启",this["equipBtn"+o].visible=!1));this.rateTxt.text=this._curData.prob_desc,"中"==this._curData.prob_desc?this.rateTxt.color="#ffe71c":"低"==this._curData.prob_desc?this.rateTxt.color="#f63624":this.rateTxt.color="#2d9610";for(var r="",h=0,l=0,c="",d="",o=0;2>o;o++)this._curData.attr&&(this._curData.attr[o]||this._curData.up_attr[o])?(r=this._curData.attr[o]?this._curData.attr[o].attr:this._curData.up_attr[o].attr,h=this._curData.attr[o]?this._curData.attr[o].val:0,l=this._curData.up_attr[o]?this._curData.up_attr[o].val:0,-1!=r.indexOf("%")?(c="+"+h/100+"%",d="(↑"+l/100+"%)"):(c="+"+h,d="(↑"+l+")"),0==l&&(d=""),this["attrIcon"+o].visible=!0,this["attr"+o].text=r.replace("%","")+c+d):this["attrIcon"+o].visible=!1;var u=t.Facade.singleton.model.retrieveModel(t.ModelDef.PACK_MODEL);this._curData.cost.cur_num=u.getItemCount(this._curData.cost.icon_id),this.blessValue.text="祝福值:"+this._curData.bless+"/"+this._curData.max_bless,this.goodIcon.skin=t.ResPath().getPic(this._curData.cost.icon_id,t.ResourcePath.PATH_GOODS),this.costTxt.text="x"+this._curData.cost.cost_num+"("+this._curData.cost.cur_num+")",this._curData.level>=this._curData.max_level?(this.tips.visible=!1,this.blessProgress.width=0,this.costTxt.text="x---("+this._curData.cost.cur_num+")",this.upBtn.gray=!0,this.upBtn.label="已达顶级",this.upBtn.visible=!0,this.rateWord.visible=!1,this.upBtn.off(Laya.Event.CLICK,this,this.onUpBtn),this.upBtn.off(Laya.Event.MOUSE_DOWN,this,this.onClickown),this._curData.redIconShow=!1,this.redIcon2.visible=!1):(this.blessProgress.width=261*this._curData.bless/this._curData.max_bless,this.rateWord.visible=!0,this.upBtn.label="强  化",this._curData.level>=n||i<this._curData.bind_skills[0].open_level?(this.upBtn.visible=!1,this.upBtn.off(Laya.Event.CLICK,this,this.onUpBtn),this.upBtn.off(Laya.Event.MOUSE_DOWN,this,this.onClickown),this.tips.visible=!0,i<this._curData.bind_skills[0].open_level&&this._curData.bind_skills[0].open_level>=a?this.tipsHtml.innerHTML="两个圣物都达到<font color='#ff0000'>"+t.MonsterHolyItem.getPinzhiName(this._curData.bind_skills[0].open_level).word+"</font>品质":this.tipsHtml.innerHTML="两个圣物都达到<font color='#ff0000'>"+t.MonsterHolyItem.getPinzhiName(a).word+"</font>品质"):(this.upBtn.visible=!0,this.upBtn.gray=!1,this.tips.visible=!1,this.upBtn.on(Laya.Event.CLICK,this,this.onUpBtn),this.upBtn.on(Laya.Event.MOUSE_DOWN,this,this.onClickown),this._curData.cost.cur_num>=5*this._curData.cost.cost_num&&(this._curData.redIconShow=!0,this.redIcon2.visible=!0))),this.isLookUp&&(this.upBtn.gray=!0,this.upBtn.off(Laya.Event.CLICK,this,this.onUpBtn),this.upBtn.off(Laya.Event.MOUSE_DOWN,this,this.onClickown),this.equipBtn0.off(Laya.Event.CLICK,this,this.onEquip0),this.equipBtn1.off(Laya.Event.CLICK,this,this.onEquip1),this.equipBtn0.gray=!0,this.equipBtn1.gray=!0,this.costTxt.text="x"+this._curData.cost.cost_num,this.redIcon0.visible=!1,this.redIcon1.visible=!1,this.redIcon2.visible=!1)}},i.prototype.sortSkill=function(t,e){return t.open_level>e.open_level?1:t.open_level<e.open_level?-1:0},i.prototype.onClickGoodicon=function(){var e,i={};e=this.localToGlobal(new laya.maths.Point(this.goodIcon.x,this.goodIcon.y)),i.name=this._curData.cost.name,i.info=this._curData.cost.desc,t.Tips.show(i,e)},i.prototype.onEquip0=function(){this._curData&&("卸载"==this.equipBtn0.label?t.XHR().Post({cmd:"beast",op:"remove_assistskill",beast_id:this._totalData.id,skill:this._curData.bind_skills[0].id,index:0},this,this.onDownSkill0):t.dispatch(t.MonsterView.MONSTER_VIEW_OPEN_SKILL_PANEL,{itype:this._curData.bind_skills[0].itype,skill:this._curData.bind_skills[0].id,beast_id:this._totalData.id,index:0}))},i.prototype.onDownSkill0=function(e){if(0==e.result){t.WeakTips.show("卸载成功");var i=t.MonsterView.bindSkillList.indexOf(this._curData.bind_skills[0].id);i>0&&t.MonsterView.bindSkillList.splice(i,1),t.dispatch(t.MonsterView.MONSTER_VIEW_UPDATE_VIEW,e.beastinfo.beast[0])}else t.WeakTips.show(e.msg)},i.prototype.onEquip1=function(){this._curData&&("卸载"==this.equipBtn1.label?t.XHR().Post({cmd:"beast",op:"remove_assistskill",beast_id:this._totalData.id,skill:this._curData.bind_skills[1].id,index:1},this,this.onDownSkill1):t.dispatch(t.MonsterView.MONSTER_VIEW_OPEN_SKILL_PANEL,{itype:this._curData.bind_skills[1].itype,skill:this._curData.bind_skills[1].id,beast_id:this._totalData.id,index:1}))},i.prototype.onDownSkill1=function(e){if(0==e.result){t.WeakTips.show("卸载成功");var i=t.MonsterView.bindSkillList.indexOf(this._curData.bind_skills[1].id);i>0&&t.MonsterView.bindSkillList.splice(i,1),t.dispatch(t.MonsterView.MONSTER_VIEW_UPDATE_VIEW,e.beastinfo.beast[0])}else t.WeakTips.show(e.msg)},i.prototype.onClickown=function(){Laya.stage.once(Laya.Event.MOUSE_UP,this,this.onClickMouseUp),Laya.timer.once(400,this,this.onTime)},i.prototype.onTime=function(){Laya.timer.loop(200,this,this.onUpBtn)},i.prototype.onUpBtn=function(){if(this._curData)if(this._curData.cost.cur_num>=this._curData.cost.cost_num)t.XHR().Post({cmd:"beast",op:"upgrade_assistskill",beast_id:this._totalData.id},this,this.onUpgradeBack);else{var e=new t.BuyCommand(100058);e.on(this,this.onBuyFinish),t.Facade.callCommand(e),Laya.timer.clear(this,this.onTime),Laya.timer.clear(this,this.onUpBtn)}},i.prototype.onBuyFinish=function(e){e.off(),this._curData.cost.cur_num+=e.num,this._totalData.special_skill.cost.cur_num+=e.num,t.dispatch(t.MonsterView.MONSTER_VIEW_UPDATE_VIEW,this._totalData)},i.prototype.onClickMouseUp=function(){Laya.stage.off(Laya.Event.MOUSE_UP,this,this.onClickMouseUp),Laya.timer.clear(this,this.onTime),Laya.timer.clear(this,this.onUpBtn)},i.prototype.onUpgradeBack=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!1)),e.beastinfo.beast[0].assist_skill.level>this._totalData.assist_skill.level?t.dispatch(t.MonsterView.MONSTER_VIEW_PLAYS_SUCCESS):t.Facade.callCommand(new t.ShowChangeRewardCmd(["强化失败，祝福值+2"],100,"#999999")),this._totalData.attr=e.beastinfo.beast[0].attr,this._totalData.power=e.beastinfo.beast[0].power,this._totalData.assist_skill=e.beastinfo.beast[0].assist_skill,this._totalData.special_skill=e.beastinfo.beast[0].special_skill,this._curData=this._totalData.assist_skill,t.dispatch(t.MonsterView.MONSTER_VIEW_UPDATE_VIEW,this._totalData)):t.WeakTips.show(e.msg)},i}(ui.monster.MonsterEquipSkillUI);t.MonsterEquipSkill=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.haveClickSelect=!1,this.selectBg.visible=!1,this.lock.visible=!1,this.redIcon.visible=!1,this._um=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL)}return __extends(i,e),Object.defineProperty(i.prototype,"data",{get:function(){return this._curData},set:function(t){this._curData=t},enumerable:!0,configurable:!0}),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.update=function(t,e){void 0===t&&(t=null),void 0===e&&(e=0),this._curData=t,this.index=e,t?(this.headIcon.skin="ui/monster/h"+t.id+"_an.png",this._um.level>=t.open_level?(this.lock.visible=!1,this.openTips.text="战："+t.power):(this.lock.visible=!0,this.openTips.text=t.open_level+"级开放")):this.lock.visible=!0},i.prototype.updateFight=function(){this.openTips.text="战："+this._curData.power},i.prototype.setSelect=function(t){this._curData&&(t?this.headIcon.skin="ui/monster/h"+this._curData.id+".png":this.headIcon.skin="ui/monster/h"+this._curData.id+"_an.png"),this.selectBg.visible=t},i.prototype.showHideRedIcon=function(t){this.redIcon.visible=t},i}(ui.monster.MonsterHeadUI);t.MonsterHead=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.isLookUp=!1,t.addListener(t.MonsterView.MONSTER_VIEW_UPDATE_HOLY,this,this.update)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.onhide=function(){},i.prototype.update=function(t){if(this._totalData=t,t&&t.holy_things)for(var e=0;2>e;e++)this["holy"+e].isLookUp=this.isLookUp,t.holy_things[e]&&this["holy"+e].update(t.holy_things[e],t.potential.level,t.id,this._totalData,e)},i}(ui.monster.MonsterHolyUI);t.MonsterHoly=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.isLookUp=!1,this.pinzhi.visible=!1,this.redIcon.visible=!1}return __extends(i,e),i.prototype.update=function(e,s,n,a,o){this._index=o,this.goodIcon.on(Laya.Event.CLICK,this,this.onClickGoodicon),this._curData=e,this._curData.redIconShow=!1,this.redIcon.visible=!1,this._beastId=n,this._totalData=a,this.holyName.text=e.name,this.icon.skin=t.ResPath().getPic(this._beastId+"_"+e.id,t.ResourcePath.PATH_MONSTER),this.goodIcon.skin=t.ResPath().getPic(e.cost.icon_id,t.ResourcePath.PATH_GOODS),this.costTxt.text="x"+e.exp2next+"("+e.cost.cur_num+")",this.holyBg.skin=t.ResPath().getPic("holy1",t.ResourcePath.PATH_MONSTER);for(var r=0;4>r;r++)this["b"+r].visible=!1;if(e.open_level=0,s>=e.open_level){if(0==e.level)this.pinzhi.text="未 激 活",this.upBtn.label="激 活";else{var h=i.getPinzhiName(e.level);this.pinzhi.text="品质："+h.word,-1!=this.pinzhi.text.indexOf("4")?this.upBtn.label="进 阶":this.upBtn.label="充 能"}for(var r=0;4>r;r++)h&&r<h.star?this["b"+r].visible=!0:this["b"+r].visible=!1;h&&(this.holyBg.skin=t.ResPath().getPic("holy"+h.pinzhi,t.ResourcePath.PATH_MONSTER)),this.holyName.text+="("+this.pinzhi.text+")",this.attrInfo.visible=!0,this.openTips.visible=!1,this.upBtn.gray=!1,this.upBtn.on(Laya.Event.CLICK,this,this.onClickUp);for(var r=0;2>r;r++)e.attr[r]||0==e.level?(this["attr"+r].visible=!0,this["attrup"+r].visible=!0,this["arrow"+r].visible=!0,0==e.level&&e.up_attr[r]?(this["attr"+r].text=e.up_attr[r].attr+"+0",this["attrup"+r].text=e.up_attr[r].attr+"+"+e.up_attr[r].val):e.attr[r]&&(this["attr"+r].text=e.attr[r].attr+"+"+e.attr[r].val,e.up_attr[r]&&(this["attrup"+r].text=e.up_attr[r].attr+"+"+e.up_attr[r].val),this["attrmax"+r].text=e.attr[r].attr+"+"+e.attr[r].val)):(this["attr"+r].visible=!1,this["attrup"+r].visible=!1,this["arrow"+r].visible=!1);var l=e.addtion?e.addtion:0,c=e.next_addtion?e.next_addtion:0;this.attr2.text=(0==this._index?"防御潜能+":"攻击潜能+")+l/100+"%",this.attrup2.text=(0==this._index?"防御潜能+":"攻击潜能+")+c/100+"%",this.attrmax2.text=this.attr2.text,e.cost.cur_num>=e.exp2next&&(this._curData.redIconShow=!0,this.redIcon.visible=!0)}else this.upBtn.off(Laya.Event.CLICK,this,this.onClickUp),this.pinzhi.text="未解锁",this.attrInfo.visible=!1,this.openTips.visible=!0,this.openTips.text="召唤兽"+t.MonsterView.getGrade(e.open_level)+"阶可激活",this.upBtn.gray=!0,this.upBtn.label="充 能";this._curData.level>=this._curData.max_level?(this.tips.visible=!1,this.upBtn.label="已达顶级",this.costTxt.text="x---("+e.cost.cur_num+")",this.upBtn.gray=!0,this.attrmax0.visible=!0,this.attrmax1.visible=!0,this.attrmax2.visible=!0,this.attrInfo.visible=!1,this.upBtn.off(Laya.Event.CLICK,this,this.onClickUp),this._curData.redIconShow=!1,this.redIcon.visible=!1):(this.tips.visible=!1,this.attrmax0.visible=!1,this.attrmax1.visible=!1,this.attrmax2.visible=!1),this.isLookUp&&(this.upBtn.gray=!0,this.upBtn.off(Laya.Event.CLICK,this,this.onClickUp),this.costTxt.text="x"+e.exp2next,this.redIcon.visible=!1)},i.prototype.onClickGoodicon=function(){var e,i={};e=this.localToGlobal(new laya.maths.Point(this.goodIcon.x,this.goodIcon.y)),i.name=this._curData.cost.name,i.info=this._curData.cost.desc,t.Tips.show(i,e)},i.prototype.onClickUp=function(){this._curData&&(this._curData.cost.cur_num>=this._curData.exp2next?t.XHR().Post({cmd:"beast",op:"upgrade_holythings",beast_id:this._beastId,thins_id:this._curData.id},this,this.onUpgradeBack):t.WeakTips.show("道具不足"))},i.prototype.onUpgradeBack=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!1)),t.WeakTips.show("充能成功"),this._totalData.attr=e.beastinfo.beast[0].attr,this._totalData.power=e.beastinfo.beast[0].power,this._totalData.holy_things=e.beastinfo.beast[0].holy_things,t.dispatch(t.MonsterView.MONSTER_VIEW_UPDATE_VIEW,this._totalData)):t.WeakTips.show(e.msg)},i.getPinzhiName=function(t){var e="普通",i=1,s=0,n="";5>=t?(e="普通",i=1):10>=t?(e="良好",i=2):15>=t?(e="优秀",i=3):20>=t?(e="精良",i=4):25>=t?(e="稀有",i=5):(e="极品",i=6);var a=t%5;return 0==a&&t>0&&(a=5),a>1&&(n="+"+(a-1),s=a-1,s>=5&&(s=4)),{word:e+n,star:s,pinzhi:i}},i}(ui.monster.MonsterHolyItemUI);t.MonsterHolyItem=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.tab.labels="潜\n\n能,圣\n\n物,助\n\n阵,特\n\n技",this.tab.selectHandler=new Handler(this,this.onSelectTab),this.tab.selectedIndex=0}return __extends(i,e),i.prototype.onhide=function(){for(var t=0;4>t;t++)this["t"+t].onhide()},i.prototype.onSelectTab=function(e){for(var i=0;4>i;i++)this["t"+i].visible=!1,this["t"+i].isLookUp=!0,this["t"+i].onhide();this["t"+e].visible=!0,t.dispatch(t.MonsterView.MONSTER_VIEW_CLOSE_SKILL_PANEL)},i.prototype.update=function(t){this.t0.update(t),this.t1.update(t),this.t2.update(t),this.t3.update(t)},i}(ui.monster.MonsterLookUpTabUI);t.MonsterLookUpTabView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,
new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.monster.MonsterLookUpUI,!0,!1),this._maxMonster=4,this._display=this.skin,this.setCloseButton(this._display.back.closeBtn),this._isFirst=!0,this._imgMap=[1,1,1,1,4,4,6,6,8,8,10]}return __extends(i,e),Object.defineProperty(i.prototype,"curData",{set:function(t){this._curData=t},enumerable:!0,configurable:!0}),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.onShowed=function(){e.prototype.onShowed.call(this),this._isFirst?this._isFirst=!1:this.resetImageSkin(this),this.updatePanel()},i.prototype.onHided=function(){e.prototype.onHided.call(this),this._display.tabView.onhide(),t.Tips.tipsClose(),Laya.loader.clearRes("res/atlas/ui/monster.json"),Laya.loader.clearRes("ui/monster/lookupbg.jpg"),Laya.loader.clearRes(this._display.photo.skin)},i.prototype.updatePanel=function(){if(this._curData){for(var t=0;t<this._maxMonster;t++)this._display["head"+t].setSelect(!1),this._curData.beast[t]?(this._display["head"+t].update(this._curData.beast[t],t),this._display["head"+t].lock.visible||this._display["head"+t].on(Laya.Event.CLICK,this,this.onClickHead)):(this._display["head"+t].update(),this._display["head"+t].off(Laya.Event.CLICK,this,this.onClickHead));this._curSelectMonsterHead=this._display.head0,this._display.head0.setSelect(!0),this.updateDetail(this._curData.beast[0])}},i.prototype.updateMonster=function(t){this._curData.beast[this._curSelectMonsterHead.index]=t,this._curSelectMonsterHead.data=t,this._curSelectMonsterHead.updateFight(),this.updateDetail(t)},i.prototype.updateDetail=function(e){e&&(this._curMonsterData=e,this._display.tabView.update(e),this._display.photo.skin=t.ResPath().getPic("img"+e.id+"_"+this._imgMap[e.grade],t.ResourcePath.PATH_MONSTER),e.grade<10?(this._display.gradeWord.skin="ui/monster/jieduan.png",this._display.gradeImg.skin="ui/monster/jieduan"+e.grade+".png",this._display.gradeImg.visible=!0):(this._display.gradeWord.skin="ui/monster/jieduan10.png",this._display.gradeImg.visible=!1),this._display.fightTxt.text=""+e.power,this.updateAttr(e.attr))},i.prototype.updateAttr=function(t){for(var e=0;7>e;e++)t[e]?(this._display["attr"+e].visible=!0,-1!=t[e].attr.indexOf("%")&&t[e].val>0?this._display["attr"+e].txt.text=t[e].attr.replace("%","")+"+"+t[e].val/100+"%":this._display["attr"+e].txt.text=t[e].attr+"+"+t[e].val):this._display["attr"+e].visible=!1},i.prototype.onClickHead=function(e){if(this._curSelectMonsterHead=e.target,this._curSelectMonsterHead.data&&this._curSelectMonsterHead.data.potential){for(var i=0;i<this._maxMonster;i++)this._display["head"+i].setSelect(!1);this._curSelectMonsterHead.setSelect(!0),this.updateDetail(this._curSelectMonsterHead.data)}else t.XHR().Post({cmd:"beast",op:"query_by_uid",beast_id:this._curSelectMonsterHead.data.id,dstuid:this.uid},this,this.onQueryDetail)},i.prototype.onQueryDetail=function(e){if(0==e.result){for(var i=0;i<this._maxMonster;i++)this._display["head"+i].setSelect(!1);this._curData.beast[this._curSelectMonsterHead.index]=e.beastinfo.beast[0],this._curSelectMonsterHead.data=e.beastinfo.beast[0],this._curSelectMonsterHead.setSelect(!0),this.updateDetail(this._curSelectMonsterHead.data)}else t.WeakTips.show(e.msg)},i}(t.BaseBox);t.MonsterLookUpView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(e){switch(e.type){case"main":var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL);i.level>=25?t.XHR().Post({cmd:"beast",op:"query",needreload:"1"},this,this.onQuery):t.WeakTips.show("25级开启召唤兽！");break;case"lookup":this._uid=e.uid,t.XHR().Post({cmd:"beast",op:"query_by_uid",dstuid:e.uid,needreload:"1"},this,this.onLookUp)}},s.prototype.onQuery=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!1)),this._queryData=e.beastinfo,this._queryData.beast.sort(this.sortQuery),t.XHR().Post({cmd:"beast",op:"query",beast_id:this._queryData.beast[0].id,needreload:"1"},this,this.onQueryDetail)):t.WeakTips.show(e.msg)},s.prototype.onQueryDetail=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!1)),this._queryData.beast[0]=e.beastinfo.beast[0],this._monsterView||(this._monsterView=new t.MonsterView),this._monsterView.curData=this._queryData,t.SceneMgr.changeScene(this._monsterView)):t.WeakTips.show(e.msg)},s.prototype.onLookUp=function(e){0==e.result?(this._lookUpData=e.beastinfo,this._lookUpData.beast[0]?(this._lookUpData.beast.sort(this.sortQuery),t.XHR().Post({cmd:"beast",op:"query_by_uid",beast_id:this._lookUpData.beast[0].id,dstuid:this._uid,needreload:"1"},this,this.onLookUpDetail)):t.WeakTips.show("该玩家未开启召唤兽！")):t.WeakTips.show(e.msg)},s.prototype.onLookUpDetail=function(e){0==e.result?(this._lookUpData.beast[0]=e.beastinfo.beast[0],this._lookUpView||(this._lookUpView=new t.MonsterLookUpView),this._lookUpView.uid=this._uid,this._lookUpView.curData=this._lookUpData,this._lookUpView.show()):t.WeakTips.show(e.msg)},s.prototype.sortQuery=function(e,i){var s=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL);return s.level>=e.open_level&&s.level<i.open_level?-1:s.level>=i.open_level&&s.level<e.open_level?1:e.pos>i.pos?1:e.pos<i.pos?-1:e.id>i.id?1:e.id<i.id?-1:0},s.prototype.getPluginName=function(){return e.PLUGIN_MONSTER},s}(t.Plugin);t.MonsterModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.isLookUp=!1,this.tips.visible=!1,this.redIcon.visible=!1}return __extends(i,e),i.prototype.onhide=function(){},i.prototype.update=function(e){if(e&&e.potential){this.goodIcon.on(Laya.Event.CLICK,this,this.onClickGoodicon),this.initGrade(e),this._totalData=e,this._curData=e.potential,this._curData.redIconShow=!1,this.redIcon.visible=!1,this.word1.visible=!1,this.word2.visible=!1,this.word3.visible=!1,this.word4.visible=!1,(e.id<1||e.id>4)&&(e.id=1),this["word"+e.id].visible=!0;var i=0;this.attrItem0.visible=!1,this.attrItem1.visible=!1;for(var s=0;4>s;s++)if(this._curData.up_attr[s]&&2>i)if(this["attrItem"+i].visible=!0,0==this._curData.level){if(-1!=this._curData.up_attr[s].attr.indexOf("%")&&this._curData.up_attr[s].val>0){var n=this._curData.up_attr[s].attr,a=this._curData.up_attr[s].val;this["attr"+i].text=n.replace("%","")+"+"+a/100+"%"}else this["attr"+i].text=this._curData.up_attr[s].attr+"+"+this._curData.up_attr[s].val;i++}else{var n=this._curData.attr[s]?this._curData.attr[s].attr:this._curData.up_attr[s].attr,o=this._curData.attr[s]?this._curData.attr[s].val:0,a=this._curData.up_attr[s]?this._curData.up_attr[s].val:0;a>o&&(-1!=this._curData.up_attr[s].attr.indexOf("%")&&this._curData.up_attr[s].val>0?this["attr"+i].text=n.replace("%","")+"+"+(a-o)/100+"%":this["attr"+i].text=n+"+"+(a-o),i++)}var r=t.Facade.singleton.model.retrieveModel(t.ModelDef.PACK_MODEL);this._curData.cost.cur_num=r.getItemCount(this._curData.cost.icon_id),this.goodIcon.skin=t.ResPath().getPic(this._curData.cost.icon_id,t.ResourcePath.PATH_GOODS),this.costTxt.text="x"+this._curData.exp2next+"("+this._curData.cost.cur_num+")",this.updateBall(this["word"+e.id]),this._curData.cost.cur_num>=this._curData.exp2next&&(this._curData.redIconShow=!0,this.redIcon.visible=!0),9==this._curData.subGrade?(this.title.text="进阶获得属性",this.upBtn.label="进  阶"):(this.title.text="培养获得属性",this.upBtn.label="培  养"),this._curData.level>=this._curData.max_level?(this.tips.visible=!0,this.costTxt.text="x---("+this._curData.cost.cur_num+")",this.upBtn.gray=!0,this.upBtn.label="已达顶级",this.upBtn.off(Laya.Event.CLICK,this,this.onClickUp),this._curData.redIconShow=!1,this.redIcon.visible=!1):(this.tips.visible=!1,this.upBtn.gray=!1,this.upBtn.on(Laya.Event.CLICK,this,this.onClickUp))}this.isLookUp&&(this.upBtn.gray=!0,this.upBtn.off(Laya.Event.CLICK,this,this.onClickUp),this.costTxt.text="x"+this._curData.exp2next,this.redIcon.visible=!1)},i.prototype.onClickGoodicon=function(){var e,i={};e=this.localToGlobal(new laya.maths.Point(this.goodIcon.x,this.goodIcon.y)),i.name=this._curData.cost.name,i.info=this._curData.cost.desc,t.Tips.show(i,e)},i.prototype.updateBall=function(t){for(var e=0;10>e;e++)e<this._curData.subGrade?t["ball"+e].lightIcon.visible=!0:t["ball"+e].lightIcon.visible=!1,this._curData.level>=this._curData.max_level&&(t["ball"+e].lightIcon.visible=!0)},i.prototype.onClickUp=function(){this._curData&&(this._curData.cost.cur_num>=this._curData.exp2next?t.XHR().Post({cmd:"beast",op:"upgrade_potential",beast_id:this._totalData.id},this,this.onUpgradeBack):t.WeakTips.show("道具不足"))},i.prototype.onUpgradeBack=function(e){if(0==e.result){t.Facade.callCommand(new t.SyncChangeCmd(e,!1));var i=this._totalData.grade,s=this._curData.subGrade;this._totalData.potential.level++,this._curData.cost.cur_num-=this._curData.exp2next,this._curData.exp2next=e.beastinfo.beast[0].potential.exp2next,this.initGrade(this._totalData);var n=Math.ceil((this._totalData.potential.level+1)/10);this._totalData.potential=e.beastinfo.beast[0].potential,this._totalData.attr=e.beastinfo.beast[0].attr,this._totalData.power=e.beastinfo.beast[0].power,n>i?n>10?(t.WeakTips.show("进阶成功"),t.dispatch(t.MonsterView.MONSTER_VIEW_UPDATE_VIEW,this._totalData),this["word"+this._totalData.id]["ball"+s].playEffect()):(this["word"+this._totalData.id]["ball"+s].playEffect(),t.addListener(t.MonsterView.MONSTER_VIEW_BALL_EFFECT,this,this.onBallEffect)):(t.WeakTips.show("培养成功"),t.dispatch(t.MonsterView.MONSTER_VIEW_UPDATE_VIEW,this._totalData),this["word"+this._totalData.id]["ball"+s].playEffect())}else t.WeakTips.show(e.msg)},i.prototype.onBallEffect=function(){t.removeListener(t.MonsterView.MONSTER_VIEW_BALL_EFFECT,this,this.onBallEffect),this.playAllBallEffect()},i.prototype.playAllBallEffect=function(){t.once(t.MonsterView.MONSTER_VIEW_BALL_EFFECT,this,this.onEffectEnd);for(var e=0;10>e;e++)this["word"+this._totalData.id]["ball"+e].playEffect()},i.prototype.onEffectEnd=function(){t.WeakTips.show("进阶成功"),t.dispatch(t.MonsterView.MONSTER_VIEW_UPDATE_VIEW,this._totalData)},i.prototype.initGrade=function(e){e.grade=t.MonsterView.getGrade(e.potential.level),e.potential.subGrade=e.potential.level%10},i}(ui.monster.MonsterPotentialUI);t.MonsterPotential=e;var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.playEffect=function(){var e=new t.AnimationSKe(t.ResPath().getEffect("dianliangbaoshi"));this.addChild(e),e.x=17.5,e.y=17.5,e.on(Laya.Event.STOPPED,this,this.onAniStop,[e]),e.play(0,!1)},i.prototype.onAniStop=function(e){e.destroy(),t.dispatch(t.MonsterView.MONSTER_VIEW_BALL_EFFECT)},i}(ui.monster.MonsterBallUI);t.MonsterBall=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this),this.tips.visible=!1,t.addListener(t.MonsterView.MONSTER_VIEW_OPEN_SKILL_PANEL,this,this.onOpen),t.addListener(t.MonsterView.MONSTER_VIEW_SELECT_SKILL,this,this.onSelect),t.addListener(t.MonsterView.MONSTER_VIEW_CLOSE_SKILL_PANEL,this,this.onClickClose),this.boxClose.on(Laya.Event.CLICK,this,this.onClickClose),this.visible=!1,this.list.itemRender=i,this.list.scrollBar.visible=!1,this.list.renderHandler=new Handler(this,this.onListRender),this.list.array=[]}return __extends(s,e),s.prototype.destroy=function(){e.prototype.destroy.call(this),t.removeListener(t.MonsterView.MONSTER_VIEW_OPEN_SKILL_PANEL,this,this.onOpen),t.removeListener(t.MonsterView.MONSTER_VIEW_SELECT_SKILL,this,this.onSelect),t.removeListener(t.MonsterView.MONSTER_VIEW_CLOSE_SKILL_PANEL,this,this.onClickClose)},s.prototype.onClickClose=function(){this.visible=!1},s.prototype.onOpen=function(e){this._curIndex=-1,this._curData=e,s.itype=this._curData.itype,this.visible=!0,t.XHR().Post({cmd:"detail",op:"skill",needreload:1,simplify:!0},this,this.onQuerySkill)},s.prototype.onQuerySkill=function(e){this.confirmBtn.gray=!0,this.confirmBtn.off(Laya.Event.CLICK,this,this.onClickSure),0==e.result?(this.list.array=e.skills.filter(this.arrFilter),this.list.array.length>0?(this.tips.visible=!1,this.confirmBtn.gray=!1,this.confirmBtn.on(Laya.Event.CLICK,this,this.onClickSure)):this.tips.visible=!0):t.WeakTips.show(e.msg)},s.prototype.arrFilter=function(e){return e.itype==s.itype&&-1==t.MonsterView.bindSkillList.indexOf(e.id)},s.prototype.onSelect=function(t){this._curIndex=t},s.prototype.onListRender=function(t,e){t.setData(this.list.getItem(e),e)},s.prototype.onClickSure=function(){this._curIndex>=0?t.XHR().Post({cmd:"beast",op:"bind_assistskill",beast_id:this._curData.beast_id,skill:this.list.getItem(this._curIndex).id,index:this._curData.index},this,this.onEquipSkill):t.WeakTips.show("请选择技能")},s.prototype.onEquipSkill=function(e){if(0==e.result){t.WeakTips.show("搭载成功");var i=t.MonsterView.bindSkillList.indexOf(this._curData.skill);i>0&&t.MonsterView.bindSkillList.splice(i,1),this.onClickClose(),t.dispatch(t.MonsterView.MONSTER_VIEW_UPDATE_VIEW,e.beastinfo.beast[0])}else t.WeakTips.show(e.msg)},s}(ui.monster.MonsterSelectSkillUI);t.MonsterSkillPanel=e;var i=function(e){function i(){e.call(this),t.addListener(t.MonsterView.MONSTER_VIEW_SELECT_SKILL,this,this.onSelect),this.on(Laya.Event.CLICK,this,this.onClickItem)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),t.removeListener(t.MonsterView.MONSTER_VIEW_SELECT_SKILL,this,this.onSelect)},i.prototype.setData=function(e,i){this.selectIcon.visible=!1,this._curIndex=i,this.skillName.text=e.name,this.icon.skin=t.ResPath().getPic(e.id,t.ResourcePath.PATH_SKILL,1)},i.prototype.onClickItem=function(){t.dispatch(t.MonsterView.MONSTER_VIEW_SELECT_SKILL,this._curIndex)},i.prototype.onSelect=function(t){this._curIndex==t?this.selectIcon.visible=!0:this.selectIcon.visible=!1},i}(ui.monster.MonsterSkillItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.isLookUp=!1,this.skill0.on(Laya.Event.CLICK,this,this.onClickSkill0),this.skill1.on(Laya.Event.CLICK,this,this.onClickSkill1),this.skill2.on(Laya.Event.CLICK,this,this.onClickSkill2),this.selectIcon.skin=t.ResPath().getPic("selectframe",t.ResourcePath.PATH_MONSTER),this.desc.style.fontFamily="黑体",this.desc.style.fontSize=17,this.desc.style.leading=4,this.desc.style.bold=!0,this.desc.style.color="#4d3f34",this.desc.style.valign="top",this.tipsHtml.style.fontFamily="黑体",this.tipsHtml.style.fontSize=22,this.tipsHtml.style.leading=4,this.tipsHtml.style.bold=!0,this.tipsHtml.style.align="center",this.tipsHtml.style.color="#4d3f34",this.tipsHtml.style.valign="top",this.redIcon.visible=!1}return __extends(i,e),i.prototype.onhide=function(){},i.prototype.update=function(e){if(e&&e.special_skill){var i=t.MonsterView.getSkillLimitData(t.MonsterView.getHolyLevel(e.holy_things)),s=i.skillLimit,n=i.nextHoly;this.goodIcon.on(Laya.Event.CLICK,this,this.onClickGoodicon),this._totalData=e,this._curData=e.special_skill,this._curData.redIconShow=!1,this.redIcon.visible=!1;var a=t.Facade.singleton.model.retrieveModel(t.ModelDef.PACK_MODEL);this._curData.cost.cur_num=a.getItemCount(this._curData.cost.icon_id),this.goodIcon.skin=t.ResPath().getPic(this._curData.cost.icon_id,t.ResourcePath.PATH_GOODS),this.costTxt.text="x"+this._curData.cost.cost_num+"("+this._curData.cost.cur_num+")",this.blessValue.text="祝福值:"+this._curData.bless+"/"+this._curData.max_bless;for(var o=0;3>o;o++)this._curData.skills[o]&&(this["skill"+o].skin=t.ResPath().getPic(this._curData.skills[o].id,t.ResourcePath.PATH_SKILL,1),this._curData.skills[o].id==this._curData.id&&(this.desc.innerHTML=t.MonsterView.changeDecHtml(this._curData.skills[o].desc),this.skillName.text=this._curData.skills[o].name+"(等级："+this._curData.level+")",this.selectIcon.x=-8+102*o,this.setBtn.gray=!0,this.setBtn.off(Laya.Event.CLICK,this,this.onClickSet),this._curIndex=o,this.arrow.x=29+102*o,this.onFight.x=-13+102*o));this.rateTxt.text=this._curData.prob_desc,"中"==this._curData.prob_desc?this.rateTxt.color="#ffe71c":"低"==this._curData.prob_desc?this.rateTxt.color="#f63624":this.rateTxt.color="#2d9610";for(var r="",h=0,l=0,c="",d="",o=0;2>o;o++)this._curData.attr&&(this._curData.attr[o]||this._curData.up_attr[o])?(r=this._curData.attr[o]?this._curData.attr[o].attr:this._curData.up_attr[o].attr,h=this._curData.attr[o]?this._curData.attr[o].val:0,l=this._curData.up_attr[o]?this._curData.up_attr[o].val:0,-1!=r.indexOf("%")?(c="+"+h/100+"%",d="(↑"+l/100+"%)"):(c="+"+h,d="(↑"+l+")"),0==l&&(d=""),this["attrIcon"+o].visible=!0,this["attr"+o].text=r.replace("%","")+c+d):this["attrIcon"+o].visible=!1;this._curData.level>=this._curData.max_level?(this.blessProgress.width=0,this.costTxt.text="x---("+this._curData.cost.cur_num+")",this.upBtn.visible=!0,this.upBtn.gray=!0,this.upBtn.label="已达顶级",this.upBtn.off(Laya.Event.CLICK,this,this.onClickUpBtn),this.upBtn.off(Laya.Event.MOUSE_DOWN,this,this.onClickown),this.rateWord.visible=!1,this._curData.redIconShow=!1,this.redIcon.visible=!1,this.tips.visible=!1,this.tipsHtml.visible=!1):(this.upBtn.label="强  化",this.blessProgress.width=261*this._curData.bless/this._curData.max_bless,this.rateWord.visible=!0,this._curData.level>=s?(this.upBtn.visible=!1,this.upBtn.off(Laya.Event.CLICK,this,this.onClickUpBtn),this.upBtn.off(Laya.Event.MOUSE_DOWN,this,this.onClickown),this.tips.visible=!0,this.tipsHtml.visible=!0,this.tipsHtml.innerHTML="两个圣物都达到<font color='#ff0000'>"+t.MonsterHolyItem.getPinzhiName(n).word+"</font>品质"):(this.upBtn.visible=!0,this.upBtn.gray=!1,this.tips.visible=!1,this.upBtn.on(Laya.Event.CLICK,this,this.onClickUpBtn),this.upBtn.on(Laya.Event.MOUSE_DOWN,this,this.onClickown),this._curData.cost.cur_num>=5*this._curData.cost.cost_num&&(this._curData.redIconShow=!0,this.redIcon.visible=!0))),this.isLookUp&&(this.upBtn.off(Laya.Event.CLICK,this,this.onClickUpBtn),this.upBtn.off(Laya.Event.MOUSE_DOWN,this,this.onClickown),this.upBtn.gray=!0,this.skill0.off(Laya.Event.CLICK,this,this.onClickSkill0),this.skill1.off(Laya.Event.CLICK,this,this.onClickSkill1),this.skill2.off(Laya.Event.CLICK,this,this.onClickSkill2),this.goodIcon.off(Laya.Event.CLICK,this,this.onClickGoodicon),this.costTxt.text="x"+this._curData.cost.cost_num,this.redIcon.visible=!1)}},i.prototype.updateSkill=function(e){this._curIndex=e,this.desc.innerHTML=t.MonsterView.changeDecHtml(this._curData.skills[e].desc),this.selectIcon.x=-8+102*e,this.skillName.text=this._curData.skills[e].name+"(等级："+this._curData.level+")",this.arrow.x=29+102*e,this._curData.skills[e].id==this._curData.id?(this.setBtn.gray=!0,this.setBtn.off(Laya.Event.CLICK,this,this.onClickSet)):(this.setBtn.gray=!1,this.setBtn.on(Laya.Event.CLICK,this,this.onClickSet))},i.prototype.onClickGoodicon=function(){var e,i={};e=this.localToGlobal(new laya.maths.Point(this.goodIcon.x,this.goodIcon.y)),i.name=this._curData.cost.name,i.info=this._curData.cost.desc,t.Tips.show(i,e)},i.prototype.onClickSet=function(){this._curData&&t.XHR().Post({cmd:"beast",op:"set_specialskill",beast_id:this._totalData.id,skill:this._curData.skills[this._curIndex].id},this,this.onSetBack)},i.prototype.onSetBack=function(e){0==e.result?(t.WeakTips.show("设置成功"),this._totalData.assist_skill=e.beastinfo.beast[0].assist_skill,this._totalData.special_skill=e.beastinfo.beast[0].special_skill,this._curData=this._totalData.special_skill,this.update(this._totalData)):t.WeakTips.show(e.msg)},i.prototype.onClickSkill0=function(){this.updateSkill(0)},i.prototype.onClickSkill1=function(){this.updateSkill(1)},i.prototype.onClickSkill2=function(){this.updateSkill(2)},i.prototype.onClickown=function(){Laya.stage.once(Laya.Event.MOUSE_UP,this,this.onClickMouseUp),Laya.timer.once(400,this,this.onTime)},i.prototype.onTime=function(){Laya.timer.loop(200,this,this.onClickUpBtn)},i.prototype.onClickMouseUp=function(){Laya.stage.off(Laya.Event.MOUSE_UP,this,this.onClickMouseUp),Laya.timer.clear(this,this.onTime),Laya.timer.clear(this,this.onClickUpBtn)},i.prototype.onClickUpBtn=function(){if(this._curData)if(this._curData.cost.cur_num>=this._curData.cost.cost_num)t.XHR().Post({cmd:"beast",op:"upgrade_specialskill",beast_id:this._totalData.id},this,this.onSpecialUp);else{var e=new t.BuyCommand(100058);e.on(this,this.onBuyFinish),t.Facade.callCommand(e),Laya.timer.clear(this,this.onTime),Laya.timer.clear(this,this.onClickUpBtn)}},i.prototype.onBuyFinish=function(e){e.off(),this._curData.cost.cur_num+=e.num,this._totalData.assist_skill.cost.cur_num+=e.num,t.dispatch(t.MonsterView.MONSTER_VIEW_UPDATE_VIEW,this._totalData)},i.prototype.onSpecialUp=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!1)),e.beastinfo.beast[0].special_skill.level>this._totalData.special_skill.level?t.dispatch(t.MonsterView.MONSTER_VIEW_PLAYS_SUCCESS):t.Facade.callCommand(new t.ShowChangeRewardCmd(["强化失败，祝福值+2"],100,"#999999")),this._totalData.power=e.beastinfo.beast[0].power,this._totalData.attr=e.beastinfo.beast[0].attr,this._totalData.special_skill=e.beastinfo.beast[0].special_skill,this._curData=this._totalData.special_skill,t.dispatch(t.MonsterView.MONSTER_VIEW_UPDATE_VIEW,this._totalData)):t.WeakTips.show(e.msg)},i}(ui.monster.MonsterStuntUI);t.MonsterStunt=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this),this.tab.labels="潜\n\n能,圣\n\n物,助\n\n阵,特\n\n技",this.tab.selectHandler=new Handler(this,this.onSelectTab),this.tab.selectedIndex=0}return __extends(i,e),i.prototype.onhide=function(){for(var t=0;4>t;t++)this["t"+t].onhide()},i.prototype.onSelectTab=function(e){for(var i=0;4>i;i++)this["t"+i].visible=!1,this["t"+i].onhide();this["t"+e].visible=!0,t.dispatch(t.MonsterView.MONSTER_VIEW_CLOSE_SKILL_PANEL)},i.prototype.update=function(t){this.t0.update(t),this.t1.update(t),this.t2.update(t),this.t3.update(t)},i}(ui.monster.MonsterTabUI);t.MonsterTabView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.monster.MonsterUI),this._maxMonster=4,this._totalPower=0,this._display=this.skin,this._display.closeBtn.x-=t.Global.FLOAT_ICON_OFFSET,this._display.closeBtn.on(Laya.Event.CLICK,this,this.onClickCloseBtn),this._display.cacheLayer.cacheAs="bitmap",this._display.selectBg.visible=!1,this._display.bgMask.graphics.drawRect(0,0,1334,750,"#000000"),this._display.bg.skin=t.ResPath().getLilianMap("14"),this._display.changeBtn.on(Laya.Event.CLICK,this,this.onClickChange),this._display.cancelBtn.on(Laya.Event.CLICK,this,this.onClickCancelChange),t.addListener(i.MONSTER_VIEW_UPDATE_VIEW,this,this.updateMonster),this._curSelectIndex=0,this._imgMap=["yn","yn","yn","yn","qn","qn","cn","cn","zn","zn","dj"],this._skeMap=["dragon_idle","dragon_idle","tiger","phoenix","dragon_idle"]}return __extends(i,e),Object.defineProperty(i.prototype,"curData",{set:function(t){this._curData=t},enumerable:!0,configurable:!0}),i.prototype.destroy=function(){e.prototype.destroy.call(this),t.removeListener(i.MONSTER_VIEW_UPDATE_VIEW,this,this.updateMonster)},i.prototype.onShowed=function(){t.addListener(i.MONSTER_VIEW_PLAYS_SUCCESS,this,this.playSuccess),Laya.stage.on(Laya.Event.CLICK,this,this.onClickStage);var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL);this._display.changeBtn.visible=e.level>=35,i.bindSkillList=[],this._display.skillPanel.visible=!1,this.resetImageSkin(this._display),this.updatePanel()},i.prototype.getSceneName=function(){return t.SceneDef.MONSTER_SCENE},i.prototype.onHided=function(){t.removeListener(i.MONSTER_VIEW_PLAYS_SUCCESS,this,this.playSuccess),this._display.tabView.onhide(),Laya.stage.off(Laya.Event.CLICK,this,this.onClickStage),t.Tips.tipsClose(),this.releaseAni(),Laya.loader.clearRes("res/atlas/ui/monster.json"),Laya.loader.clearRes(t.ResPath().getLilianMap("14")),Laya.loader.clearRes("ui/monster/bg1.png"),Laya.loader.clearRes("ui/monster/bg2.png"),Laya.loader.clearRes("ui/monster/back_bg.png");for(var e=1;10>=e;e++)Laya.loader.clearRes(t.ResPath().getPic("img1_"+e,t.ResourcePath.PATH_MONSTER));this._monsterAni&&(this._monsterAni.destroy(),this._monsterAni=null)},i.prototype.onClickStage=function(e){"goodIcon"!=e.target.name&&t.Tips.tipsClose()},i.prototype.onClickCloseBtn=function(){t.Facade.callCommand(new t.HomeCommand)},i.prototype.onClickChange=function(){if("确定"==this._display.changeBtn.label){for(var e=[],i=0,s=0;s<this._maxMonster;s++){var n=this._display["select"+s].data;n&&this._display["select"+s].visible&&e.push(n.id),this._display["head"+s].data&&!this._display["head"+s].lock.visible&&i++}i==e.length&&i>=2?t.XHR().Post({cmd:"beast",op:"sort",beasts:e.join("-")},this,this.onSortRet):t.WeakTips.show("请先完成排序！")}else{this._display.selectBg.visible=!0,this._display.changeBtn.label="确定",this._curSelectIndex=0;for(var s=0;s<this._maxMonster;s++)this._display["head"+s].haveClickSelect=!1,this._curData.beast[s]?(this._display["select"+s].update(this._curData.beast[s],s),this._display["select"+s].visible=this._display["select"+s].lock.visible):(this._display["select"+s].visible=!0,this._display["select"+s].update())}},i.prototype.onSortRet=function(e){if(0==e.result){this._display.changeBtn.label="调序",this._display.selectBg.visible=!1;for(var i=0;i<this._maxMonster;i++)this._display["head"+i].update(this._display["select"+i].data,i);var s=new Laya.Event;s.target=this._display.head0,this.onClickHead(s),t.WeakTips.show("排序成功")}else t.WeakTips.show(e.msg)},i.prototype.onClickCancelChange=function(){this._display.changeBtn.label="调序",this._display.selectBg.visible=!1},i.prototype.updatePanel=function(){if(this._curData){for(var t=0;t<this._maxMonster;t++)if(this._display["head"+t].setSelect(!1),this._curData.beast[t]){this._display["head"+t].update(this._curData.beast[t],t),this._display["head"+t].lock.visible||this._display["head"+t].on(Laya.Event.CLICK,this,this.onClickHead);for(var e=this._curData.beast[t].assist_skill?this._curData.beast[t].assist_skill.bind_skills:[],s=0;s<e.length;s++)-1==i.bindSkillList.indexOf(e[t])&&i.bindSkillList.push(e[t])}else this._display["head"+t].update(),this._display["head"+t].off(Laya.Event.CLICK,this,this.onClickHead);this._curSelectMonsterHead=this._display.head0,this._display.head0.setSelect(!0),this.updateDetail(this._curData.beast[0])}},i.prototype.updateMonster=function(t){this._curData.beast[this._curSelectMonsterHead.index]=t,this._curSelectMonsterHead.data=t,this._curSelectMonsterHead.updateFight(),this.updateDetail(t)},i.prototype.countPower=function(){this._totalPower=0;for(var t=0;t<this._maxMonster;t++)this._curData.beast[t]&&this._curData.beast[t].power&&(this._totalPower+=this._curData.beast[t].power)},i.prototype.updateDetail=function(e){e&&(i.skillLimit=e.skill_limit,this._curMonsterData=e,this._display.tabView.update(e),this._monsterAni||(this._monsterAni=new t.AnimationSKe(t.ResPath().getEffect(this._skeMap[this._curMonsterData.id]),1),this._display.photo.addChild(this._monsterAni),this._monsterAni.play(0,!0)),this._monsterAni.showSkinByName(this._imgMap[e.grade]),this._display.monsterName.skin=t.ResPath().getPic("name"+this._curMonsterData.id,t.ResourcePath.PATH_MONSTER),e.grade<10?(this._display.gradeWord.skin="ui/monster/jieduan.png",this._display.gradeImg.skin="ui/monster/jieduan"+e.grade+".png",this._display.gradeImg.visible=!0):(this._display.gradeWord.skin="ui/monster/jieduan10.png",this._display.gradeImg.visible=!1),this.countPower(),this._display.fightTxt.text=""+this._totalPower,this.updateAttr(e.attr),this.redIconShow())},i.prototype.redIconShow=function(){this._display.tabRedIcon0.visible=!1,this._display.tabRedIcon1.visible=!1,this._display.tabRedIcon2.visible=!1,this._display.tabRedIcon3.visible=!1,this._curMonsterData.potential.redIconShow&&(this._display.tabRedIcon0.visible=!0),(this._curMonsterData.holy_things[0].redIconShow||this._curMonsterData.holy_things[1].redIconShow)&&(this._display.tabRedIcon1.visible=!0),this._curMonsterData.assist_skill.redIconShow&&(this._display.tabRedIcon2.visible=!0),this._curMonsterData.special_skill.redIconShow&&(this._display.tabRedIcon3.visible=!0),this._curSelectMonsterHead.showHideRedIcon(this._display.tabRedIcon0.visible||this._display.tabRedIcon1.visible||this._display.tabRedIcon2.visible||this._display.tabRedIcon3.visible)},i.prototype.updateAttr=function(t){for(var e=0;7>e;e++)t[e]?(this._display["attr"+e].visible=!0,-1!=t[e].attr.indexOf("%")&&t[e].val>0?this._display["attr"+e].txt.text=t[e].attr.replace("%","")+"+"+t[e].val/100+"%":this._display["attr"+e].txt.text=t[e].attr+"+"+t[e].val):this._display["attr"+e].visible=!1},i.prototype.onClickHead=function(e){if(this._display.selectBg.visible&&this._curSelectIndex<this._maxMonster)e.target.haveClickSelect?t.WeakTips.show("不能重复选择哦"):e.target.lock.visible||(e.target.haveClickSelect=!0,this._display["select"+this._curSelectIndex].update(e.target.data),this._display["select"+this._curSelectIndex].visible=!0,this._curSelectIndex++);else if(this._curSelectMonsterHead=e.target,this._monsterAni&&(this._monsterAni.destroy(),this._monsterAni=null),this._curSelectMonsterHead.data&&this._curSelectMonsterHead.data.potential){for(var i=0;i<this._maxMonster;i++)this._display["head"+i].setSelect(!1);this._curSelectMonsterHead.setSelect(!0),this.updateDetail(this._curSelectMonsterHead.data)}else t.XHR().Post({cmd:"beast",op:"query",beast_id:this._curSelectMonsterHead.data.id,needreload:"1"},this,this.onQueryDetail)},i.prototype.onQueryDetail=function(e){if(0==e.result){for(var i=0;i<this._maxMonster;i++)this._display["head"+i].setSelect(!1);this._curData.beast[this._curSelectMonsterHead.index]=e.beastinfo.beast[0],this._curSelectMonsterHead.data=e.beastinfo.beast[0],this._curSelectMonsterHead.setSelect(!0),this.updateDetail(this._curSelectMonsterHead.data)}else t.WeakTips.show(e.msg)},i.prototype.playSuccess=function(){this._aniSke||(this._aniSke=new t.AnimationSKe("assets/skeleton/upgrade_success.sk"),this._aniSke.x=670,this._aniSke.y=330,this._aniSke.on(Laya.Event.STOPPED,this,this.onAniStop)),this._aniSke.visible=!0,this._aniSke.play(0,!1),this._display.addChild(this._aniSke)},i.prototype.onAniStop=function(){this._aniSke&&(this._aniSke.visible=!1)},i.prototype.releaseAni=function(){this._aniSke&&(this._display.removeChild(this._aniSke),this._aniSke.destroy(),this._aniSke=null)},i.getGrade=function(t){var e=Math.ceil((t+1)/10);return e>10&&(e=10),e},i.changeDecHtml=function(t){for(var e=!1,i=0;!e;)-1!=t.indexOf("#")?(t=0==i%2?t.replace("#","<font color='@2d9610'>"):t.replace("#","</font>"),i++):e=!0;return t.replace(/@/g,"#")},i.getSkillLimitData=function(t){if(i.skillLimit){for(var e,s=0,n=1,a=0;a<i.skillLimit.length;a++)if(e=i.skillLimit[a],e.holy_level==t)s=e.skill_level;else{if(e.holy_level>t&&e.skill_level>s){n=e.holy_level;break}a==i.skillLimit.length-1&&t>e.holy_level&&(s=e.skill_level,n=t)}return{skillLimit:s,nextHoly:n}}return{skillLimit:0,nextHoly:30}},i.getHolyLevel=function(t){if(t){var e=t[0]?t[0].level:0,i=t[1]?t[1].level:0;return e>i?i:e}return 0},i.MONSTER_VIEW_OPEN_SKILL_PANEL="MONSTER_VIEW_OPEN_SKILL_PANEL",i.MONSTER_VIEW_CLOSE_SKILL_PANEL="MONSTER_VIEW_CLOSE_SKILL_PANEL",
i.MONSTER_VIEW_SELECT_SKILL="MONSTER_VIEW_SELECT_SKILL",i.MONSTER_VIEW_UPDATE_VIEW="MONSTER_VIEW_UPDATE_VIEW",i.MONSTER_VIEW_UPDATE_HOLY="MONSTER_VIEW_UPDATE_HOLY",i.MONSTER_VIEW_BALL_EFFECT="MONSTER_VIEW_BALL_EFFECT",i.MONSTER_VIEW_PLAYS_SUCCESS="MONSTER_VIEW_PLAYS_SUCCESS",i}(t.BaseScene);t.MonsterView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.SoundManager,i=function(i){function s(){i.call(this,new ui.musicmaster.MusicMasterUI),this.m_ui=this.skin,this.m_ui.cacheAs="bitmap",this.m_ui.closeBtn.x-=t.Global.FLOAT_ICON_OFFSET,this.m_ui.closeBtn.clickHandler=new Laya.Handler(this,this.onClickBack),this.m_ui.doBtn.on(Laya.Event.CLICK,this,this.onClickDo),this.m_ui.reBtn.on(Laya.Event.CLICK,this,this.onClickRe),this.m_ui.miBtn.on(Laya.Event.CLICK,this,this.onClickMi),this.m_ui.faBtn.on(Laya.Event.CLICK,this,this.onClickFa),this.m_ui.soBtn.on(Laya.Event.CLICK,this,this.onClickSo),this.m_ui.laBtn.on(Laya.Event.CLICK,this,this.onClickLa),this.m_ui.siBtn.on(Laya.Event.CLICK,this,this.onClickSi),this.m_ui.restartBtn.on(Laya.Event.CLICK,this,this.onClickReStart),this.m_ui.cancelBtn.on(Laya.Event.CLICK,this,this.onClickCancel),this.m_ui.nextBtn.on(Laya.Event.CLICK,this,this.onClickNext),this.m_ui.ruleBtn.on(Laya.Event.CLICK,this,this.onClickRule),this.m_ui["do"].alpha=0,this.m_ui.doFrame.alpha=0,this.m_ui.re.alpha=0,this.m_ui.reFrame.alpha=0,this.m_ui.mi.alpha=0,this.m_ui.miFrame.alpha=0,this.m_ui.fa.alpha=0,this.m_ui.faFrame.alpha=0,this.m_ui.so.alpha=0,this.m_ui.soFrame.alpha=0,this.m_ui.la.alpha=0,this.m_ui.laFrame.alpha=0,this.m_ui.si.alpha=0,this.m_ui.siFrame.alpha=0,this._isCanPlay=!1,this.m_ui.countDown.visible=!1,this.m_ui.errorBox.visible=!1,this.m_ui.successBox.visible=!1,this.m_ui.startWord.visible=!1,this._codeArr=["333 333","333 333 35123","444 4433","444 4433 33322325","333 333 35123 444 4433 3355421"],this._nodeArr=["","1_do","2_re","3_mi","4_fa","5_so","6_la","7_si"],this._napArr=[[500,500,1e3,0,500,500,500],[500,500,1e3,0,500,500,1e3,0,500,500,750,250,500],[500,500,750,0,250,500,500,500],[500,500,750,0,250,500,500,500,0,250,250,500,500,500,500,1e3,500],[500,500,1e3,0,500,500,1e3,0,500,500,750,250,2e3,0,500,500,750,0,250,500,500,500,0,250,250,500,500,500,500,500]];var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL);this._aid=e.GetActByFrontId(83).id}return __extends(s,i),s.prototype.destroy=function(){i.prototype.destroy.call(this),Laya.loader.clearRes("ui/musicmaster/bg.jpg"),Laya.loader.clearRes("ui/musicmaster/chuangguangchenggong.png"),Laya.loader.clearRes("ui/musicmaster/co1.png"),Laya.loader.clearRes("ui/musicmaster/co2.png"),Laya.loader.clearRes("ui/musicmaster/co3.png"),Laya.loader.clearRes("ui/musicmaster/co4.png"),Laya.loader.clearRes("ui/musicmaster/co5.png"),Laya.loader.clearRes("ui/musicmaster/co6.png"),Laya.loader.clearRes("ui/musicmaster/co7.png"),Laya.loader.clearRes("ui/musicmaster/kaishibiaoyan.png"),Laya.loader.clearRes("ui/musicmaster/tanchuang.png"),Laya.loader.clearRes("res/atlas/ui/musicmaster.json")},s.prototype.onShowed=function(){t.XHR().Post({cmd:"activity",aid:this._aid},this,this.init),t.dispatch(t.SoundModule.STOP_MUSIC)},s.prototype.getSceneName=function(){return t.SceneDef.MUSIC_MASTER},s.prototype.onHided=function(){t.Tips.tipsClose(),t.dispatch(t.MainView.MAIN_VIEW_SOUND)},s.prototype.init=function(e){0==e.result?(this._curData=e,this.m_ui.startBtn.on(Laya.Event.CLICK,this,this.onClickStart),this.m_ui.freeBtn.on(Laya.Event.CLICK,this,this.onClickFree),this.updateBase(),this.updateReward()):t.WeakTips.show(e.msg)},s.prototype.updateBase=function(){for(var t=0;5>t;t++)t<this._curData.stage?this.m_ui["star"+t].visible=!0:this.m_ui["star"+t].visible=!1;this._curData.stage>=5?(this.m_ui.freeBtn.gray=!1,this.m_ui.startBtn.visible=!1):this.m_ui.freeBtn.gray=!0,this.m_ui.mineCode.text="",this.m_ui.rightCode.text=""},s.prototype.updateReward=function(){for(var t=0;5>t;t++)this._curData.gifts[t]?(this.m_ui["reward"+t].visible=!0,this.m_ui["reward"+t].update(this._curData.gifts[t],t,this._curData.stage,this._aid)):this.m_ui["reward"+t].visible=!1},s.prototype.onClickBack=function(){t.Facade.callCommand(new t.HomeCommand),Laya.timer.clear(this,this.playDemoMusic),this.destroy()},s.prototype.onClickStart=function(){this._curData.stage>=5?(this._isCanPlay=!0,this.m_ui.startBtn.visible=!1):(this.m_ui.mineCode.text="",this.m_ui.startBtn.visible=!1,this.m_ui.countDown.visible=!0,this.m_ui.countAni.on(Laya.Event.COMPLETE,this,this.onStopCountDown),this.m_ui.countAni.play(0,!1))},s.prototype.onClickFree=function(){this._curData.stage>=5?(this._isCanPlay=!0,t.WeakTips.show("自由弹唱模式开启")):t.WeakTips.show("通关后可解锁此模式")},s.prototype.onClickReStart=function(){this.m_ui.errorBox.visible=!1,this.onClickStart()},s.prototype.onClickCancel=function(){this.m_ui.errorBox.visible=!1,this.m_ui.startBtn.visible=!0},s.prototype.onClickNext=function(){this.m_ui.successBox.visible=!1,this._curData.stage<5?this.onClickStart():this.m_ui.startBtn.visible=!1},s.prototype.onClickRule=function(){var e="<img src='ui/comp/icon.png'></img><span style='font-weight:bold'>1、</span>活动期间，玩家每天可通关1次音乐大师；<br><img src='ui/comp/icon.png'></img><span style='font-weight:bold'>2、</span>玩家根据提示进行演奏，音符全部弹奏正确可进入下一关；<br><img src='ui/comp/icon.png'></img><span style='font-weight:bold'>3、</span>一共有5个音乐关卡，通关越多，可领取奖励越多哦；<br><img src='ui/comp/icon.png'></img><span style='font-weight:bold'>4、</span>关卡奖励每天可以领取一次；<br><img src='ui/comp/icon.png'></img><span style='font-weight:bold'>5、</span>奖励每天6点重置。<br><br><br><br>";t.RulePanel.showRule(e,"")},s.prototype.onStopCountDown=function(){this.m_ui.countDown.visible=!1,this._codeIndex=0,e.playSound(t.ResPath().getSound("Melody_0"+(this._curData.stage+1))),this.playDemoMusic()},s.prototype.playDemoMusic=function(){var t=this._codeArr[this._curData.stage];if(this.m_ui.rightCode.text=t,this._codeIndex<t.length){var e=t.charAt(this._codeIndex);" "!=e?this.playNode(parseInt(e),!1):(this._codeIndex++,e=t.charAt(this._codeIndex),!1,this.playNode(parseInt(e),!1)),Laya.timer.once(this._napArr[this._curData.stage][this._codeIndex],this,this.playDemoMusic),this._codeIndex++}else this.m_ui.starAni.on(Laya.Event.COMPLETE,this,this.onWordShow),this.m_ui.starAni.play(0,!1)},s.prototype.onWordShow=function(){this.m_ui.rightCode.text="",this._isCanPlay=!0},s.prototype.playNode=function(i,s){void 0===s&&(s=!0),s&&e.playSound(t.ResPath().getSound(this._nodeArr[i])),this.m_ui["ani"+i].play(0,!1)},s.prototype.showMineCode=function(e){if(this._curData.stage<5){var i=this._codeArr[this._curData.stage],s=i.charAt(this.m_ui.mineCode.text.length);" "!=s?this.m_ui.mineCode.text+=e:(s=i.charAt(this.m_ui.mineCode.text.length+1),this.m_ui.mineCode.text+=" "+e),s!=e?(this._isCanPlay=!1,this.m_ui.errorBox.visible=!0):this.m_ui.mineCode.text.length==i.length&&(this._isCanPlay=!1,t.XHR().Post({cmd:"activity",aid:this._aid,op:"pass"},this,this.onPass))}},s.prototype.onPass=function(e){0==e.result?(this.m_ui.successBox.visible=!0,this._curData.stage++,this._curData.stage>=5&&(this.m_ui.nextBtn.label="关  闭"),this.updateBase(),this.updateReward()):t.WeakTips.show(e.msg)},s.prototype.onClickDo=function(){this._isCanPlay&&(this.playNode(1),this.showMineCode("1"))},s.prototype.onClickRe=function(){this._isCanPlay&&(this.playNode(2),this.showMineCode("2"))},s.prototype.onClickMi=function(){this._isCanPlay&&(this.playNode(3),this.showMineCode("3"))},s.prototype.onClickFa=function(){this._isCanPlay&&(this.playNode(4),this.showMineCode("4"))},s.prototype.onClickSo=function(){this._isCanPlay&&(this.playNode(5),this.showMineCode("5"))},s.prototype.onClickLa=function(){this._isCanPlay&&(this.playNode(6),this.showMineCode("6"))},s.prototype.onClickSi=function(){this._isCanPlay&&(this.playNode(7),this.showMineCode("7"))},s}(t.BaseScene);t.MusicMaster=i;var s=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.update=function(e,i,s,n){this.on(Laya.Event.CLICK,this,this.onClick),this._curData=e,this._index=i,this._stage=s,this._aid=n,this.icon.skin=t.ResPath().getPic("gift"+(i+1),t.ResourcePath.PATH_GOODS),this.guan.skin="ui/musicmaster/guan"+(i+1)+".png",0==e.flag?(e.stage<=s?(this.tipsIcon.visible=!0,this.tipsIcon.skin="ui/musicmaster/kelingqu.png"):this.tipsIcon.visible=!1,this.gray=!1):(this.gray=!0,this.tipsIcon.visible=!0,this.tipsIcon.skin="ui/musicmaster/yilingqu.png")},i.prototype.onClick=function(){if(0==this._curData.flag&&this._curData.stage<=this._stage)t.XHR().Post({cmd:"activity",aid:this._aid,op:"award",stage:this._curData.stage},this,this.onReward);else{var e="",i=new t.DecodeDataCmd(this._curData.detail);t.Facade.callCommand(i);for(var s,n=0;n<i.rewardBoxArr.length;n++)s=i.rewardBoxArr[n],e+=s.name+"*"+s.num+";\n";var a,o={};a=this.localToGlobal(new laya.maths.Point(0,0)),o.name="礼包",o.info="将获得以下道具：",o.desc=e,t.Tips.show(o,a)}},i.prototype.onReward=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!0)),this._curData.flag=1,this.update(this._curData,this._index,this._stage,this._aid)):t.WeakTips.show(e.msg)},i}(ui.musicmaster.MusicMasterRewardUI);t.MusicMasterReward=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"MusicMasterCommand":t.SceneMgr.changeScene(new t.MusicMaster)}},s.prototype.getPluginName=function(){return e.PLUGIN_MUSIC_MASTER},s}(t.Plugin);t.MusicMasterModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.national.CollectBoxUI),this.cfg=[{word:[1,2,3,4],gift:"gift_3",num:0},{word:[1,2],gift:"gift_2",num:0},{word:[3,4],gift:"gift_2",num:0},{word:[1],gift:"gift_1",num:0},{word:[2],gift:"gift_1",num:0},{word:[3],gift:"gift_1",num:0},{word:[4],gift:"gift_1",num:0}],this._display=this.skin,this.setCloseButton(this._display.closeBtn),this.cacheAs="none",this._display.mainLayer.cacheAs="bitmap",this.name="CollectBox",this._display.lst.renderHandler=Handler.create(this,this.updateItem,null,!1),this._display.lst.itemRender=i,this._display.lst.array=[],this._display.lst.scrollBar.visible=!1,this._display.on(Laya.Event.CLICK,this,this.closeTips),t.XHR().Post({file:"petpk",cmd:"activity",aid:41,op:"viewinfo",uid:t.Global.UID},this,this.getDataHandler)}return __extends(s,e),s.prototype.getDataHandler=function(e){0==e.result?(this._data=e.data,this._gifts=e.gifts,this.update()):t.WeakTips.show("查询活动信息失败，"+e.msg)},s.prototype.update=function(){this._display.tfNum_0.text=this._data.words_num[0],this._display.tfNum_1.text=this._data.words_num[1],this._display.tfNum_2.text=this._data.words_num[2],this._display.tfNum_3.text=this._data.words_num[3],this._display.tfStatistics.text=this._data.pk_fall_num+"/10";for(var t=0;t<this.cfg.length;t++)this.cfg[t].num=this._data.pkg_exchange_num[t];this._display.lst.array=this.cfg},s.prototype.updateItem=function(t,e){e<=this._display.lst.array.length-1&&t.doRender(this._display.lst.array[e],e,this,this._gifts[e])},s.prototype.setData=function(t){this._data=t.data,this.update()},s.prototype.closeTips=function(e){"imgGift"!=e.target.name&&t.Tips.tipsClose()},s.prototype.hideRedDot=function(){this.event("HIDE_RED")},s.prototype.destroy=function(){this._display.lst&&this._display.lst.destroy(),this._display.off(Laya.Event.CLICK,this,this.closeTips),t.Tips.tipsClose(),e.prototype.destroy.call(this)},s}(t.BaseBox);t.CollectBox=e;var i=function(e){function i(){e.call(this),this.MAX_COUNT=25,this.cacheAs="bitmap",this.getBtn.on(Laya.Event.CLICK,this,this.getBtnClickHandler)}return __extends(i,e),i.prototype.doRender=function(e,i,s,n){this._data=e,this._index=i,this._owner=s,this._gift=n,this.imgGift.skin="ui/national/collect/"+e.gift+".png",this.tfTip.text="兑换次数限制："+e.num+"/"+this.MAX_COUNT,i>=3&&(this.tfTip.text="兑换次数限制：无限制"),e.num>=this.MAX_COUNT?t.Util.toGray(this.getBtn):t.Util.enable(this.getBtn);for(var a=0;a<e.word.length;a++)this["iconBg"+a].visible=!0,this["icon"+a].skin="ui/national/collect/"+e.word[a]+".png";for(var a=e.word.length;4>a;a++)this["iconBg"+a].visible=!1,this["icon"+a].skin="";this.imgGift.on(Laya.Event.CLICK,this,this.clickTips)},i.prototype.clickTips=function(){var e,i={};e=this.imgGift.localToGlobal(new laya.maths.Point(-30,0));for(var s="",n=0;n<this._gift.award.items.length;n++)s+=this._gift.award.items[n].name+"x"+this._gift.award.items[n].num,n!=this._gift.award.items.length&&(s+="\n");i.name="礼包内容",i.info=s,t.Tips.show(i,e)},i.prototype.getBtnClickHandler=function(){this._data.num>=this.MAX_COUNT?t.WeakTips.show("已达到兑换上限"):t.XHR().Post({file:"petpk",cmd:"activity",aid:41,op:"exchange",index:this._index+1,uid:t.Global.UID},this,this.getHandler)},i.prototype.getHandler=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!0)),this._owner.setData(e),0==e.flag&&this._owner.hideRedDot()):t.WeakTips.show("领取失败，"+e.msg)},i.prototype.destroy=function(){this.imgGift.off(Laya.Event.CLICK,this,this.clickTips),this.getBtn.off(Laya.Event.CLICK,this,this.getBtnClickHandler),e.prototype.destroy.call(this)},i}(ui.national.CollectItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this,new ui.national.DoubleJoyBoxUI),this._display=this.skin,this.setCloseButton(this._display.closeBtn),this.cacheAs="none",this.name="DoubleJoyBox"}return __extends(e,t),e}(t.BaseBox);t.DoubleJoyBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.national.FirstEnterPngBoxUI),this._display=this.skin,this.canClickModelToClose=!1,this.setCloseButton(this._display.closeBtn),this.name="FirstEnterNationalBox",this._display.clickPng.on(Laya.Event.CLICK,this,this.clickHandler)}return __extends(i,e),i.prototype.clickHandler=function(){t.Facade.callCommand(new t.EnterNationalTotalCmd)},i.prototype.destroy=function(){this._display.clickPng.off(Laya.Event.CLICK,this,this.clickHandler),e.prototype.destroy.call(this)},i}(t.BaseBox);t.FirstEnterNationalBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Animation,i=function(e){function i(){e.call(this,new ui.national.NationalLoginGiftUI),this._idx=-1,this._display=this.skin,this.setCloseButton(this._display.closeBtn),this.cacheAs="none",this._display.mainLayer.cacheAs="bitmap",this.list=new laya.ui.List,this.list.vScrollBarSkin="ui/comp/vscroll.png",this.list.scrollBar.visible=!1,this.list.renderHandler=Handler.create(this,this.updateItem,null,!1),this.list.itemRender=s,this._display.sp.addChild(this.list),this.list.x=228,this.list.y=248,this.list.repeatX=1,this.list.repeatY=4,this.list.spaceX=0,this.list.spaceY=4,this.list.height=374,this.list.array=[],t.EventCenter.singleton.on("GET_NATIONAL_LOGIN_GIFT",this,this.getLoginGiftSucc),t.XHR().Post({file:"petpk",cmd:"activity",aid:41,op:"scheduleq",uid:t.Global.UID},this,this.getDataHandler)}return __extends(i,e),i.prototype.getDataHandler=function(e){if(0==e.result){this._idx=-1;for(var i=-1,s=e.list.length-1;s>=0;s--)if(1==e.list[s].status||2==e.list[s].status){this._idx=e.list[s].idx,i=1==e.list[s].status?s:s+1;break}var n;if(-1!=i&&i!=e.list.length){var a=e.list.slice(0,s),o=e.list.slice(s,e.list.length);n=o.concat(a)}else n=e.list;this.list.array=n}else t.WeakTips.show("查询活动信息失败，"+e.msg)},i.prototype.updateItem=function(t,e){e<=this.list.array.length-1&&t.doRender(this.list.array[e],e,this._idx)},i.prototype.getLoginGiftSucc=function(){this.event("HIDE_RED")},i.prototype.destroy=function(){t.EventCenter.singleton.off("GET_NATIONAL_LOGIN_GIFT",this,this.getLoginGiftSucc),this.list&&(this.list.destroy(),this.list=null),e.prototype.destroy.call(this)},i}(t.BaseBox);t.NationalLoginGiftBox=i;var s=function(i){function s(){i.call(this),this.cacheAs="none",this.mainLayer.cacheAs="bitmap",this.getBtn.on(Laya.Event.CLICK,this,this.getBtnClickHandler)}return __extends(s,i),s.prototype.doRender=function(i,s,n){this._data=i,this._index=s,this._idx=n;var a=new Date;a.setFullYear(2017),i.idx<2?(a.setMonth(9),a.setDate(29+i.idx)):(a.setMonth(10),a.setDate(i.idx-1)),this.tfTime.text=a.getMonth()+"月"+a.getDate()+"日",this.getBtn.label="领  取",2==Number(i.status)?(this.hasGet.visible=!0,this.getBtn.visible=!1):1==Number(i.status)?(this.hasGet.visible=!1,this.getBtn.visible=!0,t.Util.enable(this.getBtn)):(i.idx<n&&(this.getBtn.label="已过期"),this.hasGet.visible=!1,this.getBtn.visible=!0,t.Util.toGray(this.getBtn)),this.icon1.visible=this.icon2.visible=this.icon3.visible=this.icon4.visible=!1,this.icon1Bg.visible=this.icon2Bg.visible=this.icon3Bg.visible=this.icon4Bg.visible=!1,this.numTxt1.text=this.numTxt2.text=this.numTxt3.text=this.numTxt4.text="";for(var o,r=0,h=0;h<i.details.attrs.length&&(r++,!(r>4));h++)o=i.details.attrs[h],this["icon"+r].visible=!0,this["icon"+r+"Bg"].visible=!0,this["icon"+r].skin=t.ResPath().getPic(o.id,t.ResourcePath.PATH_GOODS),this["numTxt"+r].text=o.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.desc,t.Tips.show(n,e)})}(r,o,this["icon"+r]);for(var l,c=0;c<i.details.items.length&&(r++,!(r>4));c++)l=i.details.items[c],this["icon"+r].visible=!0,this["icon"+r+"Bg"].visible=!0,this["icon"+r].skin=t.ResPath().getPic(l.icon_id,t.ResourcePath.PATH_GOODS),l.id>=200001&&l.id<=4e5?(this["numTxt"+r].text=t.DateUtils.getStrByHours(l.hours),this["ani"+r]||(this["ani"+r]=new e,this["ani"+r].loadAtlas("res/atlas/ui/item_movie.json"),this["ani"+r].interval=95,this["ani"+r].index=1,this.sp.addChild(this["ani"+r]),this["ani"+r].x=this["icon"+r+"Bg"].x-51,this["ani"+r].y=this["icon"+r+"Bg"].y-52),this["ani"+r].play(),this["ani"+r].visible=!0):this["numTxt"+r].text=l.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.goods_desc,n.info=i.effect_desc,t.Tips.show(n,e)})}(r,l,this["icon"+r])},s.prototype.getBtnClickHandler=function(){this._data.idx<this._idx?t.WeakTips.show("已过领取时间"):0==this._data.status?t.WeakTips.show("只能领取当天礼包"):t.XHR().Post({file:"petpk",cmd:"activity",aid:41,op:"schedulea",uid:t.Global.UID},this,this.getHandler)},s.prototype.getHandler=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),this.getBtn.visible=!1,this.hasGet.visible=!0,t.EventCenter.singleton.event("GET_NATIONAL_LOGIN_GIFT")):t.WeakTips.show("领取失败，"+e.msg)},s.prototype.destroy=function(){for(var t=1;4>=t;t++)this.ani+t&&(this.ani.stop(),this.ani.destroy(),this.ani=null);this.getBtn.off(Laya.Event.CLICK,this,this.getBtnClickHandler),i.prototype.destroy.call(this)},s}(ui.national.NationalLoginGiftItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Animation,i=function(e){function i(){e.call(this,new ui.national.NationalPlanBoxUI),this._display=this.skin,this.setCloseButton(this._display.closeBtn),this.cacheAs="none",this._display.mainLayer.cacheAs="bitmap",this.list=new laya.ui.List,this.list.vScrollBarSkin="ui/comp/vscroll.png",this.list.scrollBar.visible=!1,this.list.renderHandler=Handler.create(this,this.updateItem,null,!1),this.list.itemRender=s,this._display.sp.addChild(this.list),this.list.x=228,this.list.y=248,this.list.repeatX=1,this.list.repeatY=4,this.list.spaceX=0,this.list.spaceY=4,this.list.height=374,this.list.array=[],t.EventCenter.singleton.on("NATIONAL_PLAN_GIFT",this,this.getPlanGiftSucc),this._display.getBtn.on(Laya.Event.CLICK,this,this.getGift),this.query()}return __extends(i,e),i.prototype.query=function(){t.XHR().Post({file:"petpk",cmd:"activity",aid:41,op:"taskq",uid:t.Global.UID},this,this.getDataHandler)},i.prototype.getDataHandler=function(e){if(0==e.result||"ok"==e.msg){for(var i=!1,s=0;s<e.task.length;s++)1==e.task[s].status&&(i=!0);i||this.event("HIDE_RED");for(var s=0;s<e.task.length;s++)7==e.task[s].id&&(this.task=e.task.splice(s,1)[0]);var n=[0,0,0];this.task&&(this.task.num>=10&&(n[0]=0==this.task.step?1:2),this.task.num>=20&&(n[1]=this.task.step<=1?1:2),this.task.num>=30&&(n[2]=this.task.step<=2?1:2),3==this.task.step&&(n=[2,2,2])),this.states=n;for(var s=0;s<n.length;s++)this._display["hasGet_"+s].visible=!1,0==n[s]&&t.Util.toGray(this._display["btnGift_"+s]),1==n[s]&&t.Util.enable(this._display["btnGift_"+s]),2==n[s]&&(t.Util.enable(this._display["btnGift_"+s]),this._display["hasGet_"+s].visible=!0);this._display.tfStatistics.text="进度："+this.task.num+"/30",this.task.step==this.task.max?(this._display.getBtn.label="已完成",t.Util.toGrayAndDisabled(this._display.getBtn)):1==this.task.status?(this._display.getBtn.label="领  取",t.Util.enable(this._display.getBtn)):(this._display.getBtn.label="领  取",t.Util.toGray(this._display.getBtn));var a=["初有成就大礼包","持之以恒大礼包","功名成就大礼包"];if(this.task.tasks)for(var s=0;s<this.task.tasks.length;s++){for(var o=this.task.tasks[s].rewards.items,r="",h=0;h<o.length;h++)r+=o[h].name+"x"+(o[h].num?o[h].num:o[h].hours+"小时"),h!=o.length-1&&(r+="\n");!function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var n,a={};n=s.localToGlobal(new laya.maths.Point(0,0)),a.name=e,a.info=i,t.Tips.show(a,n)})}(a[s],r,this._display["btnGift_"+s])}e.task.sort(function(t,e){var i=t.step==t.max?-1:t.status,s=e.step==e.max?-1:e.status;return s-i}),this.list.array=e.task}else t.WeakTips.show("查询活动信息失败，"+e.msg)},i.prototype.hideTips=function(){t.Tips.tipsClose()},i.prototype.getGift=function(e){1==this.task.status?t.XHR().Post({file:"petpk",cmd:"activity",aid:41,op:"taska",idx:this.task.id,uid:t.Global.UID},this,this.getHandler):t.WeakTips.show("未满足领取条件")},i.prototype.getHandler=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),this.query()):t.WeakTips.show("领取失败，"+e.msg)},i.prototype.updateItem=function(t,e){e<=this.list.array.length-1&&t.doRender(this.list.array[e],e)},i.prototype.getPlanGiftSucc=function(){this.query()},i.prototype.destroy=function(){t.EventCenter.singleton.off("NATIONAL_PLAN_GIFT",this,this.getPlanGiftSucc),this.list&&(this.list.destroy(),this.list=null),e.prototype.destroy.call(this)},i}(t.BaseBox);t.NationalPlanBox=i;var s=function(i){function s(){i.call(this),this.cacheAs="none",this.mainLayer.cacheAs="bitmap",this.getBtn.on(Laya.Event.CLICK,this,this.getBtnClickHandler)}return __extends(s,i),s.prototype.doRender=function(i,s){this._data=i,this._index=s,this.termTxt.text=i.name,this.timesTxt.text="（"+i.step+"/"+i.max+"）",this.statisTxt.text="（"+i.num+"/"+i.target+"）",this.hasGot.visible=i.step==i.max,i.step==i.max?(this.getBtn.label="已完成",t.Util.toGrayAndDisabled(this.getBtn)):i.num>=i.target?(this.getBtn.label="领  取",t.Util.enable(this.getBtn)):(this.getBtn.label="领  取",t.Util.toGray(this.getBtn)),this.icon1.visible=this.icon2.visible=this.icon3.visible=this.icon4.visible=!1,this.icon1Bg.visible=this.icon2Bg.visible=this.icon3Bg.visible=this.icon4Bg.visible=!1,this.numTxt1.text=this.numTxt2.text=this.numTxt3.text=this.numTxt4.text="";for(var n,a=0,o=0;o<i.rewards.attrs.length&&(a++,!(a>4));o++)n=i.rewards.attrs[o],this["icon"+a].visible=!0,this["icon"+a+"Bg"].visible=!0,this["icon"+a].skin=t.ResPath().getPic(n.id,t.ResourcePath.PATH_GOODS),this["numTxt"+a].text=n.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.desc,t.Tips.show(n,e)})}(a,n,this["icon"+a]);for(var r,h=0;h<i.rewards.items.length&&(a++,!(a>4));h++)r=i.rewards.items[h],this["icon"+a].visible=!0,this["icon"+a+"Bg"].visible=!0,this["icon"+a].skin=t.ResPath().getPic(r.icon_id,t.ResourcePath.PATH_GOODS),r.id>=200001&&r.id<=4e5?(this["numTxt"+a].text=t.DateUtils.getStrByHours(r.hours),this["ani"+a]||(this["ani"+a]=new e,this["ani"+a].loadAtlas("res/atlas/ui/item_movie.json"),this["ani"+a].interval=95,this["ani"+a].index=1,this.sp.addChild(this["ani"+a]),this["ani"+a].x=this["icon"+a+"Bg"].x-51,this["ani"+a].y=this["icon"+a+"Bg"].y-52),this["ani"+a].play(),this["ani"+a].visible=!0):this["numTxt"+a].text=r.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.goods_desc,n.info=i.effect_desc,t.Tips.show(n,e)})}(a,r,this["icon"+a])},s.prototype.getBtnClickHandler=function(){this._data.step==this._data.max?t.WeakTips.show("已完成该系列所有任务"):this._data.num<this._data.target?t.WeakTips.show("未满足领取条件"):t.XHR().Post({file:"petpk",cmd:"activity",aid:41,op:"taska",idx:this._data.id,uid:t.Global.UID},this,this.getHandler)},s.prototype.getHandler=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),t.EventCenter.singleton.event("NATIONAL_PLAN_GIFT")):t.WeakTips.show("领取失败，"+e.msg)},s.prototype.destroy=function(){for(var t=1;4>=t;t++)this.ani+t&&(this.ani.stop(),this.ani.destroy(),this.ani=null);this.getBtn.off(Laya.Event.CLICK,this,this.getBtnClickHandler),i.prototype.destroy.call(this)},s}(ui.national.NationalPlanItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,new ui.national.PopConfirmUI,!0,!0),this.display=this.skin,this.name="PopConfirm",this.canClickModelToClose=!1,this.setCloseButton(this.display.closeBtn),this.handler=t,this.display.msgContent.text="确定要花费20斗鱼射击一次吗？",this.display.cancelBtn.on(Laya.Event.CLICK,this,this.destroy),this.display.queDingBtn.on(Laya.Event.CLICK,this,this.onConfirm)}return __extends(i,e),i.prototype.destroy=function(){this.display.cancelBtn.off(Laya.Event.CLICK,this,this.destroy),this.display.queDingBtn.off(Laya.Event.CLICK,this,this.onConfirm),e.prototype.destroy.call(this)},i.prototype.onConfirm=function(){this.handler&&(this.display.myCheck.selected&&(t.Global.skipCheckPlayBall=!0),this.handler.run()),this.destroy()},i}(t.BaseBox);t.NationalPopConfirm=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.national.NationalWinshopUI,!0,!0,!1,!1),this.display=this.skin,this.setCloseButton(this.display.closeBtn),this.list=new laya.ui.List,this.list.vScrollBarSkin="ui/comp/vscroll.png",this.list.scrollBar.visible=!1,this.list.renderHandler=Handler.create(this,this.updateItem,null,!1),this.list.itemRender=i,this.display.addChild(this.list),this.list.height=533,this.list.x=258,this.list.y=138,this.list.repeatX=5,this.list.repeatY=3,this.list.spaceX=5,this.name="NationalWinShop",this.list.array=[],this.pm=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL),this.pm.on(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdate),this.packModelUpdate(),t.XHR().Post({file:"petpk",cmd:"activity",aid:41,op:"shopq",uid:t.Global.UID},this,this.getWinSHopDataHandler)}return __extends(s,e),s.prototype.packModelUpdate=function(){this.display.winPointNum.text=""+this.pm.getItemCount(100133)},s.prototype.getWinSHopDataHandler=function(e){this.destroyed||0!=e.result?t.WeakTips.show("查询积分商城信息失败，"+e.msg):this.list.array=e.gift_array},s.prototype.updateItem=function(t,e){e<=this.list.array.length-1&&t.doRender(this.list.array[e])},s.prototype.destroy=function(){this.list&&(this.list.destroy(),this.list=null),this.pm.off(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdate),e.prototype.destroy.call(this)},s}(t.BaseBox);t.NationalWinShop=e;var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.doRender=function(e){this._curData=e,this.mprice.text=e.price,e.left_times=e.left_times>99999?"left_times":e.left_times,this.goodsRemain.text="剩余："+e.left_times,0==e.remain?this.buyBtn.filters=t.FiltersUtils.getGreyFilters():this.buyBtn.filters=null,this._gi=e.details.items[0],this.goodsName.text=this._gi.name,this.goodsPic.skin=t.ResPath().getPic(this._gi.icon_id,t.ResourcePath.PATH_GOODS),this.goodsPic.on(Laya.Event.CLICK,this,this.clickTips),this.goodsBg.on(Laya.Event.CLICK,this,this.closeTips),this.buyBtn.on(Laya.Event.CLICK,this,this.clickBuy)},i.prototype.clickTips=function(){var e,i={};e=this.localToGlobal(new laya.maths.Point(0,0)),i.name=this._gi.name,i.desc=this._gi.effect_desc,i.info=this._gi.desc?this._gi.desc:this._gi.goods_desc,t.Tips.show(i,e)},i.prototype.closeTips=function(){t.Tips.tipsClose()},i.prototype.clickBuy=function(){t.Tips.tipsClose(),0==this._curData.remain?t.WeakTips.show("已经没有剩余了"):this.buy()},i.prototype.buy=function(){t.XHR().Post({file:"petpk",cmd:"activity",aid:41,op:"shopa",idx:this._curData.idx,uid:t.Global.UID},this,this.buyHandler)},i.prototype.buyHandler=function(e){0==e.result?t.Facade.callCommand(new t.SyncChangeCmd(e)):t.WeakTips.show("领取失败，"+e.msg)},i.prototype.destroy=function(){this._curData=null,this.goodsPic.off(Laya.Event.CLICK,this,this.clickTips),this.goodsBg.off(Laya.Event.CLICK,this,this.closeTips),this.buyBtn.off(Laya.Event.CLICK,this,this.clickBuy),e.prototype.destroy.call(this)},i}(ui.national.NationalWinShopGoodsItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.national.PlayBallBoxUI),this._posArr=[[19,3],[157,114],[289,3],[550,56],[696,20],[401,155],[51,269],[263,277],[535,261],[698,248]],this._display=this.skin,this.cacheAs="none",this._display.mainLayer.cacheAs="bitmap",this.setCloseButton(this._display.closeBtn),this._display.shopBtn.on(Laya.Event.CLICK,this,this.openShop),this._pm=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL),this._pm.on(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdate),this.packModelUpdate(),this._qiQius=[];for(var s,n,a=0;8>a;a++)s=new i,this._qiQius.push(s),this._display.sp.addChild(s),n=this.getPos(),s.x=n[0],s.y=n[1],s.play(),s.mouseEnabled=!0,s.on(Laya.Event.CLICK,this,this.onClickQiqiu);t.XHR().Post({file:"petpk",cmd:"activity",aid:41,op:"shootq",uid:t.Global.UID},this,this.getDataHandler)}return __extends(s,e),s.prototype.getPos=function(){var t=Math.floor(Math.random()*this._posArr.length);return this._posArr.splice(t,1)[0]},s.prototype.pushPos=function(t,e){this._posArr.push([t,e])},s.prototype.onClickQiqiu=function(e){if(this.taget=e.target,this._data.today_num==this._data.today_max)t.WeakTips.show("今日射击次数已满");else if(this._pm.getItemCount(100132)>0)this.shoot();else if(t.Global.skipCheckPlayBall)this.shoot(1);else{var i=new t.NationalPopConfirm(new Handler(this,this.shoot,[1]));i.show()}},s.prototype.playQiqiu=function(t){void 0===t&&(t=!1),this.taget&&(t?this.taget.breakSpecial():this.taget.breakNormal(),this.taget.on("end",this,this.onEnd))},s.prototype.onEnd=function(){
this.taget.off("end",this,this.onEnd),this.pushPos(this.taget.x,this.taget.y);var t=this.getPos();this.taget.x=t[0],this.taget.y=t[1],this.taget.play(),this._display.sp.mouseEnabled=!0},s.prototype.packModelUpdate=function(){this._display.tfLeft.text="剩余飞镖："+this._pm.getItemCount(100132),this._display.tfScore.text="可用节日币："+this._pm.getItemCount(100133),this._pm.getItemCount(100132)<=0&&this.event("HIDE_RED")},s.prototype.getDataHandler=function(e){0==e.result?(this._data=e,this._display.tfStatics.text="今日射击："+e.today_num+"/"+e.today_max):t.WeakTips.show("查询活动信息失败，"+e.msg)},s.prototype.openShop=function(){t.Facade.callCommand(new t.OpenNationalShopCmd)},s.prototype.shoot=function(e){void 0===e&&(e=0),this._display.sp.mouseEnabled=!1,0==e?t.XHR().Post({file:"petpk",cmd:"activity",aid:41,op:"shoota",uid:t.Global.UID},this,this.shootHandler):t.XHR().Post({file:"petpk",cmd:"activity",aid:41,op:"shoota",cash:1,uid:t.Global.UID},this,this.shootHandler)},s.prototype.shootHandler=function(e){0==e.result?(this.playQiqiu(100==e.changed.items[0].num),t.Facade.callCommand(new t.SyncChangeCmd(e)),this._data.today_num++,this._display.tfStatics.text="今日射击："+this._data.today_num+"/"+this._data.today_max,this._data.today_num==this._data.today_max&&this.event("HIDE_RED")):(this._display.sp.mouseEnabled=!0,t.WeakTips.show("射击失败，"+e.msg))},s.prototype.destroy=function(){if(this._pm&&(this._pm.off(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdate),this._pm=null),this._qiQius){for(var i=0;i<this._qiQius.length;i++)this._qiQius[i].destroy(),this._qiQius[i]=null;this._qiQius=null}e.prototype.destroy.call(this)},s}(t.BaseBox);t.PlayBallBox=e;var i=function(e){function i(){e.call(this),this._sk=new t.AnimationSKe(t.ResPath().getEffect("qiqiu"),1),this.addChild(this._sk),this._sk.x=40,this._sk.y=160,this._sk.mouseEnabled=!0,this.size(130,150),this.mouseEnabled=!0}return __extends(i,e),i.prototype.hide=function(){},i.prototype.play=function(){this.visible=!0,this._sk.play(Math.floor(3*Math.random()),!0)},i.prototype.breakNormal=function(){this._sk.play(4,!1),this._sk.on(Laya.Event.STOPPED,this,this.end)},i.prototype.end=function(){this._sk.off(Laya.Event.STOPPED,this,this.end),this.visible=!1,this.event("end")},i.prototype.breakSpecial=function(){this._sk.play(5,!1),this._sk.on(Laya.Event.STOPPED,this,this.end)},i.prototype.destroy=function(){this._sk&&(this._sk.destroy(),this._sk=null),e.prototype.destroy.call(this)},i}(Laya.Sprite)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.national.NationalSceneUI),this._display=this.skin,this._display.backBtn.on(Laya.Event.CLICK,this,this.backBtnClickHandler),this._display.btnCollect.alpha=0,this._display.btnCollect.on(Laya.Event.CLICK,this,this.openCollectActivity),this._display.btnDoubleJoy.alpha=0,this._display.btnDoubleJoy.on(Laya.Event.CLICK,this,this.openDoubleJoyActivity),this._display.btnLoginGift.alpha=0,this._display.btnLoginGift.on(Laya.Event.CLICK,this,this.openLoginGiftActivity),this._display.btnPlan.alpha=0,this._display.btnPlan.on(Laya.Event.CLICK,this,this.openPlanActivity),this._display.btnPlayBall.alpha=0,this._display.btnPlayBall.on(Laya.Event.CLICK,this,this.openPlayBallActivity),this._display.redLoginGift.visible=!1,this._display.redPlan.visible=!1,this._display.redCollect.visible=!1,this._display.backBtn.x-=t.Global.FLOAT_ICON_OFFSET,this._pm=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL),this._pm.on(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdate),this.packModelUpdate();var i=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);this._display.photoM_default.loadImage(t.JSUtils.getHeadUrl("",i.sex),0,0,79,79),this._display.photoM.loadImage(t.JSUtils.getHeadUrl(i.headimgurl,i.sex),0,0,81,81),this._display.sexBM.visible=i.sex==t.Global.BOY,this._display.sexGM.visible=i.sex==t.Global.GIRL,this._display.tfNameM.text=i.name,this._display.tfAtkM.text=i.attackPower+"",this._display.selfPhoto.on(Laya.Event.CLICK,this,this.photoClickHandler),t.XHR().Post({file:"petpk",cmd:"activity",aid:41,op:"reddot",uid:t.Global.UID},this,this.getReddotHandler)}return __extends(i,e),i.prototype.packModelUpdate=function(){this._display.scoreTxt.text="节日币："+this._pm.getItemCount(100133)},i.prototype.photoClickHandler=function(){t.Facade.callCommand(new t.UserInfoCommand(t.Global.UID))},i.prototype.getReddotHandler=function(t){if(this._data=t,0==t.result&&(t.hasOwnProperty("score")&&(this._display.redBall.visible=t.score>0),t.list&&t.list.length>0))for(var e=0;e<t.list.length;e++){var i=Number(t.list[e].idx);1==i?this._display.redLoginGift.visible=!0:2==i?this._display.redBall.visible=!0:3==i?this._display.redPlan.visible=!0:5==i&&(this._display.redCollect.visible=1==this._data.word_start)}},i.prototype.hideRed=function(t){1==t?this._display.redLoginGift.visible=!1:2==t?this._display.redBall.visible=!1:3==t?this._display.redPlan.visible=!1:5==t&&(this._display.redCollect.visible=!1)},i.prototype.openCollectActivity=function(){1==this._data.word_start?t.Facade.callCommand(new t.OpenCollectWordCmd):t.WeakTips.show("中秋集字活动10月4日6点开启~")},i.prototype.openDoubleJoyActivity=function(){t.Facade.callCommand(new t.OpenDoubleJoyCmd)},i.prototype.openPlanActivity=function(){t.Facade.callCommand(new t.OpenPlanCmd)},i.prototype.openPlayBallActivity=function(){t.Facade.callCommand(new t.OpenPlayBallCmd)},i.prototype.openLoginGiftActivity=function(){t.Facade.callCommand(new t.OpenNationalLoginGiftCmd)},i.prototype.backBtnClickHandler=function(){t.Facade.callCommand(new t.HomeCommand)},i.prototype.onShowed=function(){},i.prototype.onHided=function(){this.destroy()},i.prototype.getSceneName=function(){return t.SceneDef.NATIONAL_TOTAL},i.prototype.destroy=function(){this._pm&&(this._pm.off(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdate),this._pm=null),this._display.selfPhoto.off(Laya.Event.CLICK,this,this.photoClickHandler),this._display.backBtn.off(Laya.Event.CLICK,this,this.backBtnClickHandler),this._display.btnCollect.off(Laya.Event.CLICK,this,this.openCollectActivity),this._display.btnDoubleJoy.off(Laya.Event.CLICK,this,this.openDoubleJoyActivity),this._display.btnLoginGift.off(Laya.Event.CLICK,this,this.openLoginGiftActivity),this._display.btnPlan.off(Laya.Event.CLICK,this,this.openPlanActivity),this._display.btnPlayBall.off(Laya.Event.CLICK,this,this.openPlayBallActivity),e.prototype.destroy.call(this)},i}(t.BaseScene);t.NactionalTotalScene=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.initialize=function(t){},i.prototype.finalize=function(){},i.prototype.doCommand=function(t){switch(t.getCommandName()){case"EnterNationalTotalCmd":this.showMainScene();break;case"FirstEnterNationalCmd":this.showFirstEnterBox();break;case"OpenPlayBallCmd":this.showPlayBallBox();break;case"OpenPlanCmd":this.showPlanBox();break;case"OpenDoubleJoyCmd":this.showDoubleJoyBox();break;case"OpenCollectWordCmd":this.showCollectBox();break;case"OpenNationalLoginGiftCmd":this.showLoginGiftBox();break;case"OpenNationalShopCmd":this.showWinShop()}},i.prototype.showPettyBuyBox=function(e){this._PettyBuyBox=new t.PettyBuy(e.goodsData,e),this._PettyBuyBox.show()},i.prototype.showMainScene=function(){this._nationalTotalScene||(this._nationalTotalScene=new t.NactionalTotalScene,this._nationalTotalScene.on(t.ViewEvent.BASE_DESTROY,this,this.nationalSceneDestroy),t.SceneMgr.changeScene(this._nationalTotalScene))},i.prototype.nationalSceneDestroy=function(e){this._nationalTotalScene&&(this._nationalTotalScene.off(t.ViewEvent.BASE_DESTROY,this,this.nationalSceneDestroy),this._nationalTotalScene=null),t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL).reload(),this.unregisterPlugin()},i.prototype.showPlayBallBox=function(){this._playBallBox||(this._playBallBox=new t.PlayBallBox,this._playBallBox.on(t.ViewEvent.BASE_DESTROY,this,this.playBallBoxDestroy),this._playBallBox.on("HIDE_RED",this,this.hideBallRed),this._playBallBox.show())},i.prototype.playBallBoxDestroy=function(){this._playBallBox&&(this._playBallBox.off(t.ViewEvent.BASE_DESTROY,this,this.playBallBoxDestroy),this._playBallBox.off("HIDE_RED",this,this.hideBallRed),this._playBallBox=null),this.unregisterCommand(new t.OpenPlayBallCmd)},i.prototype.hideBallRed=function(){this._nationalTotalScene&&this._nationalTotalScene.hideRed(2)},i.prototype.showPlanBox=function(){this._planBox||(this._planBox=new t.NationalPlanBox,this._planBox.on(t.ViewEvent.BASE_DESTROY,this,this.planBoxDestroy),this._planBox.on("HIDE_RED",this,this.hidePlanRed),this._planBox.show())},i.prototype.planBoxDestroy=function(){this._planBox&&(this._planBox.off(t.ViewEvent.BASE_DESTROY,this,this.planBoxDestroy),this._planBox.off("HIDE_RED",this,this.hidePlanRed),this._planBox=null),this.unregisterCommand(new t.OpenPlanCmd)},i.prototype.hidePlanRed=function(){this._nationalTotalScene&&this._nationalTotalScene.hideRed(3)},i.prototype.showDoubleJoyBox=function(){this._doubleJoyBox||(this._doubleJoyBox=new t.DoubleJoyBox,this._doubleJoyBox.on(t.ViewEvent.BASE_DESTROY,this,this.doubleJoyBoxDestroy),this._doubleJoyBox.show())},i.prototype.doubleJoyBoxDestroy=function(){this._doubleJoyBox&&(this._doubleJoyBox.off(t.ViewEvent.BASE_DESTROY,this,this.doubleJoyBoxDestroy),this._doubleJoyBox=null),this.unregisterCommand(new t.OpenDoubleJoyCmd)},i.prototype.showCollectBox=function(){this._collectBox||(this._collectBox=new t.CollectBox,this._collectBox.on(t.ViewEvent.BASE_DESTROY,this,this.collectBoxDestroy),this._collectBox.on("HIDE_RED",this,this.hideCollectRed),this._collectBox.show())},i.prototype.collectBoxDestroy=function(){this._collectBox&&(this._collectBox.off(t.ViewEvent.BASE_DESTROY,this,this.collectBoxDestroy),this._collectBox.off("HIDE_RED",this,this.hideCollectRed),this._collectBox=null),this.unregisterCommand(new t.OpenCollectWordCmd)},i.prototype.hideCollectRed=function(){this._nationalTotalScene&&this._nationalTotalScene.hideRed(5)},i.prototype.showLoginGiftBox=function(){this._loginGiftBox||(this._loginGiftBox=new t.NationalLoginGiftBox,this._loginGiftBox.on(t.ViewEvent.BASE_DESTROY,this,this.loginGiftBoxDestroy),this._loginGiftBox.on("HIDE_RED",this,this.hideLoginGiftRed),this._loginGiftBox.show())},i.prototype.loginGiftBoxDestroy=function(){this._loginGiftBox&&(this._loginGiftBox.off(t.ViewEvent.BASE_DESTROY,this,this.loginGiftBoxDestroy),this._loginGiftBox.off("HIDE_RED",this,this.hideLoginGiftRed),this._loginGiftBox=null),this.unregisterCommand(new t.OpenNationalLoginGiftCmd)},i.prototype.hideLoginGiftRed=function(){this._nationalTotalScene&&this._nationalTotalScene.hideRed(1)},i.prototype.showWinShop=function(){this._winShop||(this._winShop=new t.NationalWinShop,this._winShop.on(t.ViewEvent.BASE_DESTROY,this,this.winShopDestroy),this._winShop.show())},i.prototype.winShopDestroy=function(){this._winShop&&(this._winShop.off(t.ViewEvent.BASE_DESTROY,this,this.winShopDestroy),this._winShop=null),this.unregisterCommand(new t.OpenNationalShopCmd)},i.prototype.showFirstEnterBox=function(){this._firstEnterNationalBox||(this._firstEnterNationalBox=new t.FirstEnterNationalBox,this._firstEnterNationalBox.on(t.ViewEvent.BASE_DESTROY,this,this.firstEnterBoxDestroy),this._firstEnterNationalBox.show())},i.prototype.firstEnterBoxDestroy=function(){this._firstEnterNationalBox&&(this._firstEnterNationalBox.off(t.ViewEvent.BASE_DESTROY,this,this.firstEnterBoxDestroy),this._firstEnterNationalBox=null),this.unregisterCommand(new t.FirstEnterNationalCmd)},i.prototype.getPluginName=function(){return t.PluginDef.PLUGIN_NATIONAL_TOTAL},i}(t.Plugin);t.NationalTotalModule=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function n(){e.call(this,new ui.rank.RankUI,!0,!0,!1,!1),this.tabIndex=0,this.rankPage=1,this.pageSize=7,this.totalPage=100,this.rankMapArr=[0,1,5,3,4,10],this.display=this.skin,this.setCloseButton(this.display.back.closeBtn),this._facCMD=new t.GetFacInfoPanelCmd(0,null,0,0,!0),this._facCMD.on(this,this.facInfofinish)}return __extends(n,e),n.prototype.init=function(e){this.display.menuList.selectEnable=!0,this.display.rankList.array=[],this.display.menuList.array=[],this.display.menuList.selectedIndex=this.getMapIdx(e._index),this.showMenuList(this.getMapIdx(e._index)),this.display.menuList.selectHandler=new Handler(this,this.showTab),this.display.rankList.itemRender=i,this.display.menuList.itemRender=s,this.display.menuList.renderHandler=new Handler(this,this.onMenuListRender),this.display.rankList.renderHandler=new Handler(this,this.onRankListRender),this.display.nextPage.on(laya.events.Event.CLICK,this,this.goToRank,[1]),this.display.nextTen.on(laya.events.Event.CLICK,this,this.goToRank,[10]),this.display.proPage.on(laya.events.Event.CLICK,this,this.goToRank,[-1]),this.display.proTen.on(laya.events.Event.CLICK,this,this.goToRank,[-10]),this.showTab(this.getMapIdx(e._index)),t.EventCenter.singleton.on(n.RANK_FAC,this,this.showFaction)},n.prototype.getMapIdx=function(t){for(var e=0;e<this.rankMapArr.length;e++)if(this.rankMapArr[e]==t)return e;return 0},n.prototype.goToRank=function(t){var t=this.rankPage+t;t=1>t?1:t,t=t>this.totalPage?this.totalPage:t,t!=this.rankPage&&(this.rankPage=t,this.loadRank())},n.prototype.showTab=function(e){this._facCMD&&this._facCMD.facInfoBox&&this._facCMD.facInfoBox.parent&&(this._facCMD.facInfoBox.parent.removeChild(this._facCMD.facInfoBox),Laya.timer.clear(this,this.hideFacBox)),7>e?(this.tabIndex=this.rankMapArr[e],this.rankPage=1,this.showMenuList(e),this.loadRank()):t.WeakTips.show("暂未开放"),t.Logger.log(this.tabIndex)},n.prototype.showMenuList=function(t){void 0===t&&(t=0);for(var e=[{title:"等级",pic:"ui/rank/menuicon0.png",bar:[{name:"排名",width:74,key:"rank"},{name:"角色",width:183,key:"field1"},{name:"等级",width:68,key:"field2"},{name:"帮派",width:183,key:"field3"},{name:"经验",width:132,key:"field4"}]},{title:"战力",pic:"ui/rank/menuicon1.png",bar:[{name:"排名",width:74,key:"rank"},{name:"角色",width:183,key:"field1"},{name:"等级",width:68,key:"field2"},{name:"帮派",width:183,key:"field3"},{name:"战斗力",width:132,key:"field4"}]},{title:"声望",pic:"ui/rank/menuicon2.png",bar:[{name:"排名",width:74,key:"rank"},{name:"角色",width:183,key:"field1"},{name:"等级",width:68,key:"field2"},{name:"雇主",width:183,key:"field3"},{name:"声望值",width:132,key:"field4"}]},{title:"新生",pic:"ui/rank/menuicon4.png",bar:[{name:"排名",width:74,key:"rank"},{name:"角色",width:183,key:"field1"},{name:"等级",width:68,key:"field2"},{name:"帮派",width:183,key:"field3"},{name:"前进关卡",width:132,key:"field4"}]},{title:"斩妖",pic:"ui/rank/menuicon5.png",bar:[{name:"排名",width:74,key:"rank"},{name:"角色",width:183,key:"field1"},{name:"等级",width:68,key:"field2"},{name:"帮派",width:183,key:"field3"},{name:"当前关卡",width:132,key:"field4"}]},{title:"帮派",pic:"ui/rank/menuicon3.png",bar:[{name:"排名",width:74,key:"rank"},{name:"帮派名称",width:183,key:"field1"},{name:"等级",width:68,key:"field2"},{name:"帮主",width:183,key:"field3"},{name:"总战力",width:132,key:"field4"}]},{title:"帮派",pic:"ui/rank/menuicon3.png",bar:[{name:"排名",width:74,key:"rank"},{name:"帮派名称",width:183,key:"field1"},{name:"等级",width:68,key:"field2"},{name:"帮主",width:183,key:"field3"},{name:"总战力",width:132,key:"field4"}]},{title:"帮派",pic:"ui/rank/menuicon3.png",bar:[{name:"排名",width:74,key:"rank"},{name:"帮派名称",width:183,key:"field1"},{name:"等级",width:68,key:"field2"},{name:"帮主",width:183,key:"field3"},{name:"总战力",width:132,key:"field4"}]},{title:"帮派",pic:"ui/rank/menuicon3.png",bar:[{name:"排名",width:74,key:"rank"},{name:"帮派名称",width:183,key:"field1"},{name:"等级",width:68,key:"field2"},{name:"帮主",width:183,key:"field3"},{name:"总战力",width:132,key:"field4"}]},{title:"帮派",pic:"ui/rank/menuicon3.png",bar:[{name:"排名",width:74,key:"rank"},{name:"帮派名称",width:183,key:"field1"},{name:"等级",width:68,key:"field2"},{name:"帮主",width:183,key:"field3"},{name:"总战力",width:132,key:"field4"}]},{title:"师德",pic:"ui/rank/menuicon6.png",bar:[{name:"排名",width:74,key:"rank"},{name:"师傅名称",width:183,key:"field1"},{name:"等级",width:68,key:"field2"},{name:"师德称号",width:183,key:"field3"},{name:"历史师德",width:132,key:"field4"}]},{title:"帮派",pic:"ui/rank/menuicon3.png",bar:[{name:"排名",width:74,key:"rank"},{name:"帮派名称",width:183,key:"field1"},{name:"等级",width:68,key:"field2"},{name:"帮主",width:183,key:"field3"},{name:"总战力",width:132,key:"field4"}]}],i=[],s=0;s<this.rankMapArr.length;s++)i[s]=e[this.rankMapArr[s]];this.display.menuList.array=i,this.template=i[t].bar,this.initRankType()},n.prototype.initRankType=function(){for(var t=0,e=0;e<this.template.length;e++)this.display["thTxt"+e].text=this.template[e].name,this.display["thbg"+e].width=this.template[e].width,this.display["thTxt"+e].x=t,this.display["thbg"+e].x=t,t+=this.template[e].width+3},n.prototype.loadRank=function(){var e=this.rankPage,i=(e-1)*this.pageSize+1,s=e*this.pageSize,n={file:"petpk",cmd:"rank",subcmd:"GetRank",type:this.tabIndex,start:i,end:s};t.XHR().Post(n,this,this.showRank)},n.prototype.showRank=function(e){0==e.result&&(t.Util.DecodeJSONProperty("field1",e),t.Util.DecodeJSONProperty("field2",e),t.Util.DecodeJSONProperty("field3",e),t.Util.DecodeJSONProperty("field4",e),t.Util.DecodeJSONProperty("field5",e),this.totalPage=Math.ceil(parseInt(e.totlerank)/8),this.display.pageNum.text=this.rankPage+"/"+this.totalPage,this.rankData=e,this.setListData(e))},n.prototype.setListData=function(t){this.display.rankList.array=[],this.display.rankList.array=t.rankinfo;var e=["myRankNum","myName","myLevel","myFaction","myCombat"],i=0;this.display.myRankNum.off(laya.events.Event.CLICK,this,this.showMyRank),parseInt(t.rank)>0&&parseInt(t.rank)<=3?this.display.numIcon.skin="ui/rank/"+parseInt(t.rank)+".png":(this.display.numIcon.skin="",this.display.myRankNum.on(laya.events.Event.CLICK,this,this.showMyRank));for(var s=0;s<this.template.length;s++)this.display[e[s]].text=t.selfinfo[this.template[s].key],this.display[e[s]].width=this.template[s].width,this.display[e[s]].x=i,i+=this.template[s].width+3},n.prototype.showMyRank=function(){var e=this.rankData.selfinfo.rank,i=Math.ceil(e/this.pageSize);e>0&&i<this.totalPage?(this.rankPage=i,this.loadRank()):t.WeakTips.show("您在排行榜之外")},n.prototype.onRankListRender=function(t,e){t.setData(this.display.rankList.getItem(e),e,this.tabIndex,this.template)},n.prototype.onMenuListRender=function(t,e){t.setData(this.display.menuList.getItem(e),e,this.display.menuList.selectedIndex==e)},n.prototype.showFaction=function(e,i){this._facCMD.setData(e,null,i.x,i.y+30-t.LayerMgr.offY),this._facCMD.facInfoBox&&(this._facCMD.facInfoBox.visible=!1),t.Facade.singleton.callCommand(this._facCMD)},n.prototype.facInfofinish=function(){this._facCMD&&this._facCMD.facInfoBox&&(this._facCMD.facInfoBox.visible=!0,Laya.timer.once(8e3,this,this.hideFacBox),this._facCMD.facInfoBox.parent||this.display.addChild(this._facCMD.facInfoBox),this._facCMD.facInfoBox.x=this._facCMD.posX,this._facCMD.facInfoBox.y=this._facCMD.posY,this._facCMD.facInfoBox.y+this._facCMD.facInfoBox.facInfo_bg.height>t.LayerMgr.height+t.LayerMgr.offY&&(this._facCMD.facInfoBox.y-=this._facCMD.facInfoBox.y+this._facCMD.facInfoBox.facInfo_bg.height-(t.LayerMgr.height+t.LayerMgr.offY)))},n.prototype.hideFacBox=function(){this._facCMD&&this._facCMD.facInfoBox&&(this._facCMD.facInfoBox.visible=!1)},n.prototype.destroy=function(){Laya.timer.clear(this,this.hideFacBox),t.Logger.log("Rank","destroy"),t.EventCenter.singleton.off(n.RANK_FAC,this,this.showFaction),this._facCMD&&(this._facCMD.off(),this._facCMD.destroy(),this._facCMD=null),e.prototype.destroy.call(this)},n.RANK_FAC="RANK_FAC",n}(t.BaseBox);t.Rank=e;var i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.destroy=function(){this.listName.off(Laya.Event.CLICK,this,this.showUser),i.prototype.destroy.call(this)},s.prototype.setData=function(e,i,s,n){if(e){this.listName.text="",e.uid==t.Global.UID?this.rankListBg.skin="ui/rank/ranklistbg3.png":i%2==1?this.rankListBg.skin="ui/rank/ranklistbg1.png":this.rankListBg.skin="ui/rank/ranklistbg0.png";for(var a=["numTxt","listName","listLevel","listFaction","listCombat"],o=0,r=0;r<n.length;r++)this[a[r]].text=e[n[r].key],this[a[r]].width=n[r].width,this[a[r]].x=o,o+=n[r].width+3;parseInt(e.rank)>0&&parseInt(e.rank)<=3&&(this.rankListBg.skin="ui/rank/img_paiming"+e.rank+".png",this.numTxt.text=""),this.underLine.width=this.listName.textWidth,this.underLine.x=(this.listName.width-this.underLine.width)/2,5!=s?(this.vipIcon.visible=!0,this.listName.text="",this.namecon.text=e[n[1].key],this.underLine.width=this.namecon.textWidth,this.underLine.x=42,e.viplvl&&parseInt(e.viplvl)>0?(this.viplevel.text=e.viplvl,this.vipIcon.filters=[]):(this.viplevel.text="",this.vipIcon.filters=t.FiltersUtils.getGreyFilters())):(this.namecon.text="",this.vipIcon.visible=!1),this.mouseEnabled=!0,this._curData=e,this._temp=n,this._rankindex=s,this.listName.on(Laya.Event.CLICK,this,this.showUser)}},s.prototype.showUser=function(){if(this._rankindex<5)t.Facade.callCommand(new t.UserInfoCommand(this._curData.id));else if(5==this._rankindex){var i;i=this.localToGlobal(new laya.maths.Point(0,0)),t.EventCenter.singleton.event(e.RANK_FAC,[this._curData.id,i])}},Object.defineProperty(s.prototype,"selected",{set:function(t){},enumerable:!0,configurable:!0}),s}(ui.rank.RankItemUI),s=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.setData=function(e,i,s){e?(this.mouseEnabled=!0,this.listIcon.skin=e.pic,this.listTitle.text=e.title,s?(this.listTitle.color="#ffc30b",this.listTitle.strokeColor="#310000",this.listBg.skin="ui/rank/img_yeqian02.png",this.listIcon.filters=[]):(this.listTitle.color="#4c3725",this.listTitle.strokeColor="#f0e2ce",this.listBg.skin="ui/rank/img_yeqian01.png",this.listIcon.filters=t.FiltersUtils.getGreyFilters())):this.listBg.skin="ui/rank/img_yeqian03.png"},Object.defineProperty(i.prototype,"selected",{set:function(t){},enumerable:!0,configurable:!0}),i}(ui.rank.RankMenuItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"RankCMD":this.rankBox=new t.Rank,this.rankBox.on(t.ViewEvent.BOX_HIDE,this,this.onClosePanel),this.rankBox.show(),this.rankBox.init(e),e.ecode=0,e.finish()}},s.prototype.onClosePanel=function(){this.rankBox&&(this.rankBox.off(t.ViewEvent.BOX_HIDE,this,this.onClosePanel),this.rankBox=null,Laya.loader.clearRes("ui/rank/img_paiming1.png"),Laya.loader.clearRes("ui/rank/img_paiming2.png"),Laya.loader.clearRes("ui/rank/img_paiming3.png"))},s.prototype.getPluginName=function(){return e.PLUGIN_RANK},s}(t.Plugin);t.RankModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.initialize=function(t){},i.prototype.finalize=function(){},i.prototype.doCommand=function(t){switch(t.getCommandName()){case"RebateCmd":this.showMainScene()}},i.prototype.showMainScene=function(){this._rebateScene||(this._rebateScene=new t.RebateScene,this._rebateScene.on(t.ViewEvent.BASE_DESTROY,this,this.rebateSceneDestroy),t.SceneMgr.changeScene(this._rebateScene))},i.prototype.rebateSceneDestroy=function(e){this._rebateScene&&(this._rebateScene.off(t.ViewEvent.BASE_DESTROY,this,this.rebateSceneDestroy),this._rebateScene=null),this.unregisterPlugin()},i.prototype.getPluginName=function(){return t.PluginDef.PLUGIN_REBATE},i}(t.Plugin);t.RebateModule=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.rebate.RebateUI),this._display=this.skin,this._display.backBtn.on(Laya.Event.CLICK,this,this.backBtnClickHandler),this._display.getBtn.on(Laya.Event.CLICK,this,this.get),this._display.rechargeBtn.on(Laya.Event.CLICK,this,this.openShop),this._actModel=t.Facade.singleton.model.retrieveModel(t.ModelDef.ACT_MODEL),this._aid=this._actModel.GetActByFrontId(s._frontid).id,this._display.lst.itemRender=i,this._display.lst.renderHandler=new Handler(this,this.onListRender),this._display.lst.array=[],this._display.lst.scrollBar.hide=!0,this._display.backBtn.x-=t.Global.FLOAT_ICON_OFFSET,t.XHR().Post({file:"petpk",cmd:"activity",aid:this._aid,op:"get",uid:t.Global.UID},this,this.dataRet),this._display.viewBtn.on(Laya.Event.CLICK,this,this.showWeaponTips)}return __extends(s,e),s.prototype.showWeaponTips=function(){var e={};e.uptype=1,e.name="屠龙刀",e.desc="必中！必暴击！不会被反击或者反弹！使用武器时优先选中。",e.id=200039,e.isage=1,t.Facade.callCommand(new t.ShowUpAnimationCMD(e))},s.prototype.hideTips=function(e){"reward"!=e.target.name&&t.Tips.tipsClose()},s.prototype.dataRet=function(e){if(0==e.result){this._data=e;var i=this._actModel.GetActById(this._aid).end_time;i=i.split(":")[0];var s=i.split(" ")[1];i=i.split(" ")[0];var n=i.split("-")[0],a=i.split("-")[1],o=i.split("-")[2];o=parseInt(o)-3,this._display.endTime.text="活动时间："+n+"年"+a+"月"+o+"日"+s+"时结束",this.updateRank(),this.updata()}else t.WeakTips.show(e.msg)},s.prototype.updata=function(){for(var e,i=!1,s=0,n=0,a=0;a<this._data.act_info.length;a++)e=this._data.act_info[a],this._data.award_max>=e.need?(s+=e.award.attrs[0].num,n+=e.award.attrs[0].num,this._display["flag_"+a].visible=!0,t.Util.enable(this._display["gift_"+a])):this._data.pay_total>=e.need?(i=!0,n+=e.award.attrs[0].num,this._display["flag_"+a].visible=!1,t.Util.enable(this._display["gift_"+a])):(this._display["flag_"+a].visible=!1,t.Util.toGray(this._display["gift_"+a])),this._display["gift_"+a].on(Laya.Event.CLICK,this,this.showTips,[a]);i?t.Util.enable(this._display.getBtn):t.Util.toGrayAndDisabled(this._display.getBtn),this._display.txt1.text=""+n,this._display.txt2.text=""+s,this._display.txt3.text=this._data.pay_total},s.prototype.showTips=function(e){t.Tips.show({name:this._data.act_info[e].award.attrs[0].num+"斗鱼"},this._display["gift_"+e].localToGlobal(new Laya.Point(0,0)))},s.prototype.updateRank=function(){var e={file:"petpk",cmd:"rank",subcmd:"GetRank",type:11,start:1,end:10};t.XHR().Post(e,this,this.showRank)},s.prototype.showRank=function(e){if(0==e.result){this._display.lst.array=e.rankinfo;for(var i=-1,s=0;s<e.rankinfo.length;s++)e.rankinfo[s].id==t.Global.UID&&(i=s+1);-1==i?(this._display.self.visible=!0,this._display.tfRank.text="未上榜",this._display.tfNum.text=this._data.counter_total,this._display.tfName.text=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).name,this._display.tfReward.text="",this._display.recieveBtn.visible=!1):(this._display.self.visible=!0,this._display.tfRank.text=""+i,this._display.tfNum.text=this._data.counter_total,this._display.tfName.text=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).name,0==this._data.my_rank_award?(this._display.tfReward.text="",this._display.recieveBtn.visible=!0,t.Util.toGrayAndDisabled(this._display.recieveBtn)):1==this._data.my_rank_award?(this._display.tfReward.text="",this._display.recieveBtn.visible=!0,t.Util.enable(this._display.recieveBtn),this._display.recieveBtn.on(Laya.Event.CLICK,this,this.recieve)):(this._display.recieveBtn.visible=!1,this._display.tfReward.text="已领取"))}else t.WeakTips.show(e.msg)},s.prototype.recieve=function(){t.XHR().Post({file:"petpk",cmd:"activity",aid:this._aid,op:"rank_award",uid:t.Global.UID},this,function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),this._data.my_rank_award=2,this._display.recieveBtn.visible=!1,this._display.tfReward.text="已领取"):t.WeakTips.show(e.msg)})},s.prototype.onListRender=function(t,e){t.setData(this._display.lst.getItem(e),e)},s.prototype.get=function(){t.XHR().Post({file:"petpk",cmd:"activity",aid:this._aid,op:"award",uid:t.Global.UID},this,function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),this._data.award_max=e.award_max,this.updata()):t.WeakTips.show(e.msg)})},s.prototype.backBtnClickHandler=function(){t.Facade.callCommand(new t.HomeCommand)},s.prototype.openShop=function(){var e=new t.OpenVipBoxCommand(1);t.Facade.callCommand(e)},s.prototype.onShowed=function(){},s.prototype.onHided=function(){this.destroy()},s.prototype.getSceneName=function(){return t.SceneDef.REBATE_SCENE},s.prototype.destroy=function(){this._display.getBtn.off(Laya.Event.CLICK,this,this.get),this._display.rechargeBtn.off(Laya.Event.CLICK,this,this.openShop),this._display.backBtn.off(Laya.Event.CLICK,this,this.backBtnClickHandler),t.Tips.tipsClose(),e.prototype.destroy.call(this)},s._frontid=52,s}(t.BaseScene);t.RebateScene=e;var i=function(e){function i(){e.call(this),this.hours=[43800,4320,2160,720,720,720,336,336,336,336]}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.setData=function(e,i){this.index=i,t.Util.DecodeJSONProperty("field1",e),this.tfRank.text=""+(i+1),this.tfName.text=e.field1,this.tfNum.text=e.field4,this.tfReward.text="",this.reward.skin=t.ResPath().getPic(200039,t.ResourcePath.PATH_GOODS),this.reward.on(Laya.Event.CLICK,this,this.showTips)},i.prototype.showTips=function(){var e,i={};e=this.reward.localToGlobal(new laya.maths.Point(-150,0));var s=this.hours[this.index];i.name="屠龙刀  "+(s>4e4?"永久":"x"+s/24+"天"),i.desc="必中！必暴击！不会被反击或者反弹！使用武器时优先选中。",t.Tips.show(i,e)},i}(ui.rebate.RebateItemUI);t.RebateRankItem=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"RecallCommand":this._recallPanel||(this._recallPanel=new t.RecallGiftView),this._recallPanel.show()}},s.prototype.getPluginName=function(){return e.PLUGIN_RECALL},s}(t.Plugin);t.RecallGiftModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.recall.RecallGiftUI,!0,!1),this.m_ui=this.skin,this.setCloseButton(this.m_ui.back.closeBtn),this._isFirst=!0,this.m_ui.infoBox.visible=!1,this.m_ui.on(Laya.Event.CLICK,this,this.onClickPanel),this.m_ui.tabView0.on(Laya.Event.CLICK,this,this.onClickPanel),this.m_ui.tabView1.on(Laya.Event.CLICK,this,this.onClickPanel),this.m_ui.tab.labels="好\n礼\n相\n送,独\n享\n特\n权",this.m_ui.tab.selectHandler=new Handler(this,this.onSelectTab),this.m_ui.tab.selectedIndex=0;var i=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);this.m_ui.leaveTime.text="剩余时间："+t.DateUtils.subTime(-1,i.rebackEndtime,4)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.onShowed=function(){e.prototype.onShowed.call(this),t.addListener(i.RECALL_GIFT_VIEW_TIPS,this,this.onClickGift),t.addListener(i.RECALL_REDICON_UPDATE,this,this.checkRedIcon),this._isFirst?this._isFirst=!1:this.resetImageSkin(this),
t.XHR().Post({cmd:"activity",aid:36,sub:"query"},this,this.onQuery)},i.prototype.onHided=function(){t.EventCenter.singleton.event(t.MainModule.OPENBOXEVENT),e.prototype.onHided.call(this);var s=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);s.setDailyDataValue(t.ServerSetDataModel.KEY_RECALL_OPEN,1),t.removeListener(i.RECALL_GIFT_VIEW_TIPS,this,this.onClickGift),t.removeListener(i.RECALL_REDICON_UPDATE,this,this.checkRedIcon),this.ani&&(this.ani.destroy(),this.ani=null)},i.prototype.onSelectTab=function(t){this.m_ui.tabView0.visible=!1,this.m_ui.tabView1.visible=!1,this.m_ui["tabView"+t].visible=!0},i.prototype.onClickGift=function(e){if(e){this.m_ui.infoBox.x=e.x+476,this.m_ui.infoBox.y=e.y-154+73,this.m_ui.infoBox.visible=!0;var i=new t.DecodeDataCmd(e);t.Facade.callCommand(i);for(var s,n=0;6>n;n++)s=i.rewardBoxArr[n],s?(this.m_ui["item"+n].visible=!0,this.m_ui["item"+n].text=s.name+"*"+s.num):this.m_ui["item"+n].visible=!1}},i.prototype.onClickPanel=function(t){"gift"!=t.target.name&&(this.m_ui.infoBox.visible=!1)},i.prototype.onQuery=function(e){0==e.result?(this._curData=e,this.updaeGift(),this.updatePrivilege(),this.checkRedIcon()):t.WeakTips.show(e.msg)},i.prototype.updaeGift=function(){if(this._curData.infos&&this._curData.infos[0]){for(var t=this._curData.infos[0],e=0;8>e;e++)t.items.items[e]?(this.m_ui.tabView0["itemTxt"+e].visible=!0,t.items.items[e].num?this.m_ui.tabView0["itemTxt"+e].text=t.items.items[e].name+"X"+t.items.items[e].num:this.m_ui.tabView0["itemTxt"+e].text=t.items.items[e].name+"X"+t.items.items[e].hours/24+"天"):this.m_ui.tabView0["itemTxt"+e].visible=!1;0==t.flag?this.m_ui.tabView0.giftBtn.gray=!0:1==t.flag?(this.m_ui.tabView0.giftBtn.gray=!1,this.m_ui.tabView0.giftBtn.on(Laya.Event.CLICK,this,this.onClickGiftBtn)):(this.m_ui.tabView0.giftBtn.gray=!0,this.m_ui.tabView0.giftBtn.label="已领取")}if(this._curData.infos)for(var e=0;7>e;e++)this._curData.infos[e+1]?(this.m_ui.tabView0["gift"+e].visible=!0,this.m_ui.tabView0["gift"+e].update(this._curData.infos[e+1],e)):this.m_ui.tabView0["gift"+e].visible=!1},i.prototype.onClickGiftBtn=function(){t.XHR().Post({cmd:"activity",aid:36,sub:"get_gift",idx:0},this,this.getGiftBack)},i.prototype.getGiftBack=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!0)),this.m_ui.tabView0.giftBtn.off(Laya.Event.CLICK,this,this.onClickGiftBtn),this.m_ui.tabView0.giftBtn.gray=!0,this.m_ui.tabView0.giftBtn.label="已领取",this._curData.infos[0].flag=2,this.checkRedIcon()):t.WeakTips.show(e.msg)},i.prototype.updatePrivilege=function(){if(this._curData.infos&&this._curData.infos[8]){var t=this._curData.infos[8];0==t.flag?(this.m_ui.tabView1.getBuff.gray=!0,this.m_ui.red1.visible=!1):1==t.flag?(this.m_ui.tabView1.getBuff.gray=!1,this.m_ui.tabView1.getBuff.on(Laya.Event.CLICK,this,this.onClickGetBuff),this.m_ui.red1.visible=!0):(this.m_ui.tabView1.getBuff.gray=!0,this.m_ui.tabView1.getBuff.label="已激活",this.m_ui.red1.visible=!1,this.ani||(this.ani=new Laya.Animation,this.ani.loadAtlas("res/atlas/ui/item_movie.json"),this.ani.interval=95,this.ani.index=1,this.m_ui.tabView1.addChild(this.ani),this.ani.x=-12,this.ani.y=12),this.ani.play())}if(this._curData.infos)for(var e=0;3>e;e++)this._curData.infos[e+9]?(this.m_ui.tabView1["goods"+e].visible=!0,this.m_ui.tabView1["goods"+e].update(this._curData.infos[e+9],e)):this.m_ui.tabView1["goods"+e].visible=!1},i.prototype.onClickGetBuff=function(){t.XHR().Post({cmd:"activity",aid:36,sub:"get_gift",idx:8},this,this.getBuffBack)},i.prototype.getBuffBack=function(e){if(0==e.result){t.Facade.callCommand(new t.SyncChangeCmd(e,!0));var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.BUFF_MODEL);i.updateBuffData(),this.m_ui.tabView1.getBuff.off(Laya.Event.CLICK,this,this.onClickGetBuff),this.m_ui.tabView1.getBuff.gray=!0,this.m_ui.tabView1.getBuff.label="已激活",this.m_ui.red1.visible=!1,this.ani||(this.ani=new Laya.Animation,this.ani.loadAtlas("res/atlas/ui/item_movie.json"),this.ani.interval=95,this.ani.index=1,this.m_ui.tabView1.addChild(this.ani),this.ani.x=-12,this.ani.y=12),this.ani.play()}else t.WeakTips.show(e.msg)},i.prototype.checkRedIcon=function(){if(this.m_ui.red0.visible=!1,this._curData.infos)for(var t=0;8>t;t++)if(this._curData.infos[t]&&1==this._curData.infos[t].flag){this.m_ui.red0.visible=!0;break}},i.RECALL_GIFT_VIEW_TIPS="RECALL_GIFT_VIEW_TIPS",i.RECALL_REDICON_UPDATE="RECALL_REDICON_UPDATE",i}(t.BaseBox);t.RecallGiftView=e;var i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.update=function(e,i){this._curData=e,this.title.text="第"+(i+1)+"日",this.icon.skin=t.ResPath().getPic("gift"+(i+1),t.ResourcePath.PATH_GOODS),this.icon.on(Laya.Event.CLICK,this,this.onClickIcon),0==e.flag?this.getBtn.gray=!0:1==e.flag?(this.getBtn.gray=!1,this.getBtn.on(Laya.Event.CLICK,this,this.onClickGetBtn)):(this.getBtn.gray=!0,this.getBtn.label="已领取")},s.prototype.onClickGetBtn=function(){t.XHR().Post({cmd:"activity",aid:36,sub:"get_gift",idx:this._curData.idx},this,this.getGiftBack)},s.prototype.getGiftBack=function(i){0==i.result?(t.Facade.callCommand(new t.SyncChangeCmd(i,!0)),this.getBtn.off(Laya.Event.CLICK,this,this.onClickGetBtn),this.getBtn.gray=!0,this.getBtn.label="已领取",this._curData.flag=2,t.dispatch(e.RECALL_REDICON_UPDATE)):t.WeakTips.show(i.msg)},s.prototype.onClickIcon=function(){this._curData.items.x=this.x,this._curData.items.y=this.y,t.dispatch(e.RECALL_GIFT_VIEW_TIPS,this._curData.items)},s}(ui.recall.RecallGiftItemUI);t.RecallGift=i;var s=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.update=function(t,e){this._curData=t,this.icon.skin="ui/recall/box"+(e+1)+".png",this.icon.on(Laya.Event.CLICK,this,this.onClickIcon);for(var i=0;3>i;i++)t.items.items[i]?(this["itemTxt"+i].visible=!1,this["itemTxt"+i].text=t.items.items[i].name+"X"+t.items.items[i].num):this["itemTxt"+i].visible=!1;0==e?(this.srcMoney.text="原价：600斗豆",this.curMoney.text="现价：200斗豆"):1==e?(this.srcMoney.text="原价：600斗豆",this.curMoney.text="现价：200斗豆"):(this.srcMoney.text="原价：720斗豆",this.curMoney.text="现价：200斗豆"),0==t.flag?this.getBtn.gray=!0:1==t.flag?(this.getBtn.gray=!1,this.getBtn.on(Laya.Event.CLICK,this,this.onClickGetBtn)):(this.getBtn.label="已购买",this.getBtn.gray=!0)},s.prototype.onClickGetBtn=function(){t.XHR().Post({cmd:"activity",aid:36,sub:"get_gift",idx:this._curData.idx},this,this.getGiftBack)},s.prototype.onClickIcon=function(){this._curData.items.x=this.x,this._curData.items.y=this.y,t.dispatch(e.RECALL_GIFT_VIEW_TIPS,this._curData.items)},s.prototype.getGiftBack=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!0)),this.getBtn.off(Laya.Event.CLICK,this,this.onClickGetBtn),this.getBtn.label="已购买",this.getBtn.gray=!0):t.WeakTips.show(e.msg)},s}(ui.recall.RecallGoodsItemUI);t.RecallGoods=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Animation,i=function(e){function i(){e.call(this,new ui.schoolOpen2017.ClassTableBoxUI),this._display=this.skin,this.setCloseButton(this._display.closeBtn),this.cacheAs="none",this._display.mainLayer.cacheAs="bitmap",this.list=new laya.ui.List,this.list.vScrollBarSkin="ui/comp/vscroll.png",this.list.scrollBar.visible=!1,this.list.renderHandler=Handler.create(this,this.updateItem,null,!1),this.list.itemRender=s,this._display.sp.addChild(this.list),this.list.x=228,this.list.y=248,this.list.repeatX=1,this.list.repeatY=4,this.list.spaceX=0,this.list.spaceY=4,this.list.height=374,this.list.array=[],t.EventCenter.singleton.on("GET_CLASS_TABLE_GIFT_SUCCESS",this,this.getClassTableGiftSuccess),t.XHR().Post({file:"petpk",cmd:"activity",aid:37,op:"scheduleq",uid:t.Global.UID},this,this.getDataHandler)}return __extends(i,e),i.prototype.getDataHandler=function(e){if(0==e.result){for(var i=0;i<e.list.length;i++){var s=e.list[i];s.sortV=1==s.status?1:0}e.list.sort(function(t,e){return 1e4*(e.sortV-t.sortV)+(t.idx-e.idx)}),this.list.array=e.list}else t.WeakTips.show("查询活动信息失败，"+e.msg)},i.prototype.getClassTableGiftSuccess=function(){this.event("HIDE_RED")},i.prototype.updateItem=function(t,e){e<=this.list.array.length-1&&t.doRender(this.list.array[e])},i.prototype.destroy=function(){t.EventCenter.singleton.off("GET_CLASS_TABLE_GIFT_SUCCESS",this,this.getClassTableGiftSuccess),this.list&&(this.list.destroy(),this.list=null),e.prototype.destroy.call(this)},i}(t.BaseBox);t.ClassTableBox=i;var s=function(i){function s(){i.call(this),this.cacheAs="none",this.mainLayer.cacheAs="bitmap",this.getBtn.on(Laya.Event.CLICK,this,this.getBtnClickHandler)}return __extends(s,i),s.prototype.doRender=function(i){if(this._idx=Number(i.idx),this.dateTxt.text="9月"+(8+this._idx)+"日",2==Number(i.status))this.hasGet.visible=!0,this.getBtn.visible=!1;else{this.hasGet.visible=!1,this.getBtn.visible=!0;var s=t.ServerClock.getServerNowDate(),n=s.getDate();s.getHours()<6&&(n-=1),this.getBtn.filters=8+this._idx!=n?t.FiltersUtils.getGreyFilters():null}this.icon1.visible=this.icon2.visible=this.icon3.visible=this.icon4.visible=!1,this.icon1Bg.visible=this.icon2Bg.visible=this.icon3Bg.visible=this.icon4Bg.visible=!1,this.numTxt1.text=this.numTxt2.text=this.numTxt3.text=this.numTxt4.text="";for(var a=1;4>=a;a++)this["ani"+a]&&(this["ani"+a].stop(),this["ani"+a].visible=!1);for(var o,r=0,a=0;a<i.details.attrs.length&&(r++,!(r>4));a++)o=i.details.attrs[a],this["icon"+r].visible=!0,this["icon"+r+"Bg"].visible=!0,this["icon"+r].skin=t.ResPath().getPic(o.id,t.ResourcePath.PATH_GOODS),this["numTxt"+r].text=o.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.desc,t.Tips.show(n,e)})}(r,o,this["icon"+r]);for(var h,l=0;l<i.details.items.length&&(r++,!(r>4));l++)h=i.details.items[l],this["icon"+r].visible=!0,this["icon"+r+"Bg"].visible=!0,this["icon"+r].skin=t.ResPath().getPic(h.icon_id,t.ResourcePath.PATH_GOODS),h.id>=200001&&h.id<=4e5?(this["numTxt"+r].text=t.DateUtils.getStrByHours(h.hours),this["ani"+r]||(this["ani"+r]=new e,this["ani"+r].loadAtlas("res/atlas/ui/item_movie.json"),this["ani"+r].interval=95,this["ani"+r].index=1,this.sp.addChild(this["ani"+r]),this["ani"+r].x=this["icon"+r+"Bg"].x-51,this["ani"+r].y=this["icon"+r+"Bg"].y-52),this["ani"+r].play(),this["ani"+r].visible=!0):this["numTxt"+r].text=h.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.goods_desc,n.info=i.effect_desc,t.Tips.show(n,e)})}(r,h,this["icon"+r])},s.prototype.getBtnClickHandler=function(){var e=new Date(t.ServerClock.getServerTime()).getDate();8+this._idx!=e?t.WeakTips.show("只能领取当天的礼包"):t.XHR().Post({file:"petpk",cmd:"activity",aid:37,op:"schedulea",uid:t.Global.UID},this,this.getHandler)},s.prototype.getHandler=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),this.getBtn.visible=!1,this.hasGet.visible=!0,t.EventCenter.singleton.event("GET_CLASS_TABLE_GIFT_SUCCESS"),e.hasOwnProperty("score")&&t.Facade.callCommand(new t.SchoolOpenScoreChangeCmd(Number(e.score)))):t.WeakTips.show("领取失败，"+e.msg)},s.prototype.destroy=function(){for(var t=1;4>=t;t++)this.ani+t&&(this.ani.stop(),this.ani.destroy(),this.ani=null);this.getBtn.off(Laya.Event.CLICK,this,this.getBtnClickHandler),i.prototype.destroy.call(this)},s}(ui.schoolOpen2017.ClassTableItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Animation,i=function(e){function i(){e.call(this,new ui.schoolOpen2017.Day7GiftBoxUI),this._power=0,this._display=this.skin,this.setCloseButton(this._display.closeBtn),this.cacheAs="none",this._display.mainLayer.cacheAs="bitmap",this.list=new laya.ui.List,this.list.vScrollBarSkin="ui/comp/vscroll.png",this.list.scrollBar.visible=!1,this.list.renderHandler=Handler.create(this,this.updateItem,null,!1),this.list.itemRender=s,this._display.sp.addChild(this.list),this.list.x=228,this.list.y=248,this.list.repeatX=1,this.list.repeatY=4,this.list.spaceX=0,this.list.spaceY=4,this.list.height=374,this.list.array=[],t.EventCenter.singleton.on("GET_DAY7_GIFT_SUCCESS",this,this.getDa7GiftSuccess),t.XHR().Post({file:"petpk",cmd:"activity",aid:37,op:"beastq",uid:t.Global.UID},this,this.getDataHandler)}return __extends(i,e),i.prototype.getDataHandler=function(e){if(0==e.result){this._power=e.beast_fp;var i=[1100,1300,1500,2400];this._canGetCount=4;for(var s=0;4>s;s++){var n=e.infos[s];(2==Number(n.flag)||this._power<i[n.idx])&&this._canGetCount--}this.list.array=e.infos}else t.WeakTips.show("查询活动信息失败，"+e.msg)},i.prototype.updateItem=function(t,e){e<=this.list.array.length-1&&t.doRender(this.list.array[e],e,this._power)},i.prototype.getDa7GiftSuccess=function(){this._canGetCount--,0==this._canGetCount&&this.event("HIDE_RED")},i.prototype.destroy=function(){t.EventCenter.singleton.off("GET_DAY7_GIFT_SUCCESS",this,this.getDa7GiftSuccess),this.list&&(this.list.destroy(),this.list=null),e.prototype.destroy.call(this)},i}(t.BaseBox);t.Day7GiftBox=i;var s=function(i){function s(){i.call(this),this.cacheAs="none",this.mainLayer.cacheAs="bitmap",this.getBtn.on(Laya.Event.CLICK,this,this.getBtnClickHandler)}return __extends(s,i),s.prototype.doRender=function(i,s,n){this._index=s,this._selfPower=n;var a=[1100,1300,1500,2400];this._thisPower=a[s],this.powerTxt.text="战力："+this._thisPower,2==Number(i.flag)?(this.hasGet.visible=!0,this.getBtn.visible=!1):(this.hasGet.visible=!1,this.getBtn.visible=!0,this.getBtn.filters=this._selfPower<this._thisPower?t.FiltersUtils.getGreyFilters():null),this.icon1.visible=this.icon2.visible=this.icon3.visible=this.icon4.visible=!1,this.icon1Bg.visible=this.icon2Bg.visible=this.icon3Bg.visible=this.icon4Bg.visible=!1,this.numTxt1.text=this.numTxt2.text=this.numTxt3.text=this.numTxt4.text="";for(var o=1;4>=o;o++)this["ani"+o]&&(this["ani"+o].stop(),this["ani"+o].visible=!1);for(var r,h=0,o=0;o<i.giftdesc.attrs.length&&(h++,!(h>4));o++)r=i.giftdesc.attrs[o],this["icon"+h].visible=!0,this["icon"+h+"Bg"].visible=!0,this["icon"+h].skin=t.ResPath().getPic(r.id,t.ResourcePath.PATH_GOODS),this["numTxt"+h].text=r.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.desc,t.Tips.show(n,e)})}(h,r,this["icon"+h]);for(var l,c=0;c<i.giftdesc.items.length&&(h++,!(h>4));c++)l=i.giftdesc.items[c],this["icon"+h].visible=!0,this["icon"+h+"Bg"].visible=!0,this["icon"+h].skin=t.ResPath().getPic(l.icon_id,t.ResourcePath.PATH_GOODS),l.id>=200001&&l.id<=4e5?(this["numTxt"+h].text=t.DateUtils.getStrByHours(l.hours),this["ani"+h]||(this["ani"+h]=new e,this["ani"+h].loadAtlas("res/atlas/ui/item_movie.json"),this["ani"+h].interval=95,this["ani"+h].index=1,this.sp.addChild(this["ani"+h]),this["ani"+h].x=this["icon"+h+"Bg"].x-51,this["ani"+h].y=this["icon"+h+"Bg"].y-52),this["ani"+h].play(),this["ani"+h].visible=!0):this["numTxt"+h].text=l.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.goods_desc,n.info=i.effect_desc,t.Tips.show(n,e)})}(h,l,this["icon"+h])},s.prototype.getBtnClickHandler=function(){this._selfPower<this._thisPower?t.WeakTips.show("召唤兽战力不足"):t.XHR().Post({file:"petpk",cmd:"activity",aid:37,op:"beasta",idx:this._index,uid:t.Global.UID},this,this.getHandler)},s.prototype.getHandler=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),this.getBtn.visible=!1,this.hasGet.visible=!0,t.EventCenter.singleton.event("GET_DAY7_GIFT_SUCCESS")):t.WeakTips.show("领取失败，"+e.msg)},s.prototype.destroy=function(){for(var t=1;4>=t;t++)this.ani+t&&(this.ani.stop(),this.ani.destroy(),this.ani=null);this.getBtn.off(Laya.Event.CLICK,this,this.getBtnClickHandler),i.prototype.destroy.call(this)},s}(ui.schoolOpen2017.Day7GiftItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.schoolOpen2017.FirstEnterPngBoxUI),this._display=this.skin,this.canClickModelToClose=!1,this._display.clickPng.on(Laya.Event.CLICK,this,this.clickHandler)}return __extends(i,e),i.prototype.clickHandler=function(){t.Facade.callCommand(new t.EnterSchoopOpen2017SceneCmd)},i.prototype.destroy=function(){this._display.clickPng.off(Laya.Event.CLICK,this,this.clickHandler),e.prototype.destroy.call(this)},i}(t.BaseBox);t.FirstEnterSchoolOpen2017Box=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i,s){e.call(this,new ui.schoolOpen2017.BuyUI,!0,!0,!1,!1),this.goodsId=0,this.allPrice=0,this.moneyNum=0,this.progressLength=0,this.canBuyNum=0,this._buynum=0,this.display=this.skin,this.name="BuyBox",this.cmd=s,this.goodsData=i,this.userModel=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),this.moneyNum=this.userModel.doubi,this.goodsId=i.id,this.init()}return __extends(i,e),i.prototype.init=function(){this.showDetail(),this.display.cancelBtn.on(laya.events.Event.CLICK,this,this.destroy),this.display.confirmBtn.on(laya.events.Event.CLICK,this,this.buyGoods),this.display.subBtn.on(laya.events.Event.MOUSE_DOWN,this,this.doBtnKeyDown,[-1]),this.display.addBtn.on(laya.events.Event.MOUSE_DOWN,this,this.doBtnKeyDown,[1]),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.doBtnKeyUp),this.display.numSlider.changeHandler=new Handler(this,this.onStartDrag),this.display.numSlider.showLabel=!1},i.prototype.showDetail=function(){this.canBuyNum=Math.floor(this.moneyNum/this.goodsData.price),this.canBuyNum=0==this.canBuyNum?1:this.canBuyNum,this.goodsData.hasOwnProperty("remain")&&this.goodsData.max_num>this.goodsData.remain&&(this.goodsData.max_num=this.goodsData.remain),this.goodsData.default_num=this.goodsData.default_num>this.canBuyNum?this.canBuyNum:this.goodsData.default_num,this.display.goodsName.text=this.goodsData.name,this.display.goodsPic.skin=t.ResPath().getPic(this.goodsData.iconId,t.ResourcePath.PATH_GOODS),this.display.goodsPic.skin="ui/schoolOpen2017/pettyStore/icon"+(Number(this.goodsData.idx)+1)+".png",this.display.goodsDesc.text=this.goodsData.goods_effect,this.goodsData.max_num=0==this.goodsData.max_num?1:this.goodsData.max_num,this.progressLength=this.display.numValue.width,this.display.numSlider.max=this.goodsData.max_num,this.setNum(1)},i.prototype.initShopMgr=function(t){this.sMgr=t},i.prototype.doBtnKeyDown=function(t){this.numAdd(t),Laya.timer.loop(200,this,this.numAdd,[t])},i.prototype.doBtnKeyUp=function(){Laya.timer.clear(this,this.numAdd),this.destroyed||(this.display.subBtn.state=1,this.display.addBtn.state=1)},i.prototype.numAdd=function(t){var e=this.display.numSlider.value;e+=t,this.setNum(e)},i.prototype.setNum=function(e){var i;if(i="斗豆",e>this.canBuyNum){this._time||(this._time=Browser.now());var s=Browser.now();s-this._time>250&&(t.WeakTips.show("当前"+i+"不足，请确认后重试！"),this._time=s),e=this.canBuyNum}e=0==e?1:e,this.display.numSlider.value=e,e=this.display.numSlider.value,this.display.numValue.value=e/this.goodsData.max_num,this.allPrice=e*this.goodsData.price,this.display.subDetail.text="已选择"+e+"个，总价："+this.allPrice+i,this.display.numSlider.value=e},i.prototype.buyGoods=function(){this._buynum=this.display.numSlider.value;this.allPrice;this._buyid=this.goodsId+"",t.XHR().Post({file:"petpk",cmd:"activity",aid:37,op:"shopa",idx:this.goodsData.idx,num:this._buynum,uid:t.Global.UID},this,this.buyRet)},i.prototype.buyRet=function(e){this.destroyed||0!=e.result?(this.cmd.ecode=e.result,this.cmd.finish(),t.WeakTips.show("购买失败，"+e.msg)):(t.Facade.callCommand(new t.SyncChangeCmd(e)),this.cmd.num=this._buynum,this.cmd.score=e.hasOwnProperty("score")?Number(e.score):-1,this.cmd.ecode=0,this.cmd.finish(),this.sMgr&&this.sMgr.getShopGoods(this._buyid)&&(this.sMgr.getShopGoods(this._buyid).remain>=this._buynum?this.sMgr.getShopGoods(this._buyid).remain=this.sMgr.getShopGoods(this._buyid).remain-this._buynum:this.sMgr.getShopGoods(this._buyid).remain=0),this.destroy())},i.prototype.onStartDrag=function(t){this.setNum(t)},i.prototype.destroy=function(){this.cmd.off(),this.cmd=null,Laya.stage.off(Laya.Event.MOUSE_UP,this,this.doBtnKeyUp),e.prototype.destroy.call(this)},i}(t.BaseBox);t.PettyBuy=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.schoolOpen2017.PettyStoreBoxUI),this._goodsData=[],this._display=this.skin,this.setCloseButton(this._display.closeBtn),this._display.tipsBox.visible=!1;for(var i=1;6>=i;i++){var s=this._display["item"+i];s.buyBtn.on(Laya.Event.CLICK,this,this.buyBtnClickHandler),s.nameTxt.text="召唤兽礼包"+i,this._display["icon"+i].on(Laya.Event.CLICK,this,this.iconClickHandler)}t.XHR().Post({file:"petpk",cmd:"activity",aid:37,op:"shopq",uid:t.Global.UID},this,this.getDataHandler)}return __extends(i,e),i.prototype.getDataHandler=function(e){if(0==e.result){if(e.gift_array){this._goodsData=e.gift_array;for(var i=0;i<e.gift_array.length;i++){var s=e.gift_array[i],n=Number(s.idx),a=this._display["item"+(n+1)];a.priceTxt1.text=s.price,a.priceTxt2.text=s.discount_price;var o=s.hasOwnProperty("left_times")?Number(s.left_times):0,r=s.hasOwnProperty("limit_times")?Number(s.limit_times):0;-1==r?a.buyBtn.label="购买":(a.buyBtn.label="购买："+(r-o)+"/"+r,0>=o&&(a.buyBtn.filters=t.FiltersUtils.getGreyFilters()))}}}else t.WeakTips.show("查询活动信息失败，"+e.msg)},i.prototype.buyBtnClickHandler=function(e){if(this._nowGetIndex=Number(e.target.parent.name.split("item")[1]),e.target.filters&&e.target.filters.length>0)t.WeakTips.show("购买次数已达上限");else{var i=this._display["item"+this._nowGetIndex],s=Number(i.priceTxt2.text),n=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).doubi;if(Math.floor(n/s)<1)t.WeakTips.show("斗豆数量不足");else{var a=e.target.label,o=!0;if(-1!=a.indexOf("/")){var r=a.split("购买：")[1],h=Number(r.split("/")[0]),l=Number(r.split("/")[1]);o=l>h+5}if(o){var c=Math.floor(n/s),d=this._goodsData[this._nowGetIndex-1];d.max_num=-1!=a.indexOf("/")?Math.min(l-h,c):Math.min(100,c),d.name=i.nameTxt.text,d.idx=this._nowGetIndex-1,d.goods_effect=["潜能果实*10","召唤水晶*5","风神之息*2","潜能果实*1","召唤水晶*1","风神之息*1"][this._nowGetIndex-1];var u=new t.OpenPettyBuyCmd(d);u.on(this,this.buyTimesHandler),t.Facade.callCommand(u)}else this._buyNum=1,t.XHR().Post({file:"petpk",cmd:"activity",aid:37,op:"shopa",idx:this._nowGetIndex-1,uid:t.Global.UID},this,this.buyGIftHandler)}}},i.prototype.buyGIftHandler=function(e){if(0==e.result){t.Facade.callCommand(new t.SyncChangeCmd(e));var i=this._display["item"+this._nowGetIndex],s=i.buyBtn.label;if(-1!=s.indexOf("/")){var n=s.split("购买：")[1],a=Number(n.split("/")[0]),o=Number(n.split("/")[1]);a+=this._buyNum,i.buyBtn.label="购买："+a+"/"+o,a>=o&&(i.buyBtn.filters=t.FiltersUtils.getGreyFilters())}e.hasOwnProperty("score")&&-1!=Number(e.score)&&t.Facade.callCommand(new t.SchoolOpenScoreChangeCmd(Number(e.score)))}else t.WeakTips.show("购买失败，"+e.msg)},i.prototype.buyTimesHandler=function(t){if(t.off(),0==t.ecode){this._buyNum=t.num;var e={result:0,score:t.score};this.buyGIftHandler(e)}},i.prototype.iconClickHandler=function(t){var e=Number(t.target.name.split("icon")[1]),i=["潜能果实*10","召唤水晶*5","风神之息*2","潜能果实*1","召唤水晶*1","风神之息*1"],e=Number(t.target.name.split("icon")[1]);Laya.timer.clear(this,this.hideTips),this._display.tipsBox.visible=!0,this._display.tipsBox.x=t.target.x+50,this._display.tipsBox.y=t.target.y+50;var s=this._display["item"+e];this._display.tipsName.text=s.nameTxt.text,this._display.tipsMsg1.text=i[e-1],Laya.timer.once(4e3,this,this.hideTips)},i.prototype.hideTips=function(){this._display.tipsBox.visible=!1},i.prototype.destroy=function(){this._goodsData=null,Laya.timer.clear(this,this.hideTips);for(var t=1;6>=t;t++){var i=this._display["item"+t];i.buyBtn.off(Laya.Event.CLICK,this,this.buyBtnClickHandler),this._display["icon"+t].off(Laya.Event.CLICK,this,this.iconClickHandler)}e.prototype.destroy.call(this)},i}(t.BaseBox);t.PettyStoreBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.schoolOpen2017.SchoolMateListBoxUI),this._display=this.skin,this.setCloseButton(this._display.closeBtn),this._display.tipsBox.visible=!1,s.TOKEN_LIST=[],this.list=new laya.ui.List,this.list.vScrollBarSkin="ui/comp/vscroll.png",this.list.scrollBar.visible=!1,this.list.renderHandler=Handler.create(this,this.updateItem,null,!1),this.list.itemRender=i,this._display.addChildAt(this.list,this._display.getChildIndex(this._display.lanternPng)),this.list.x=227,this.list.y=138,this.list.repeatX=1,this.list.repeatY=5,this.list.spaceX=0,this.list.height=484,this.list.array=[],this._display.menuTab.selectHandler=new Handler(this,this.showTab),t.EventCenter.singleton.on("SHOW_SCHOOL_MATE_TIPS",this,this.showTips),t.EventCenter.singleton.on("GET_SHOOLEMATE_GIFT",this,this.getShoolMateGift),this._display.ruleImage.on(Laya.Event.CLICK,this,this.showRule),this.getList(0)}return __extends(s,e),s.prototype.getList=function(e){t.XHR().Post({file:"petpk",cmd:"activity",aid:37,op:"class",type:e,uid:t.Global.UID},this,this.getListHandler)},s.prototype.getListHandler=function(e){if(0==e.result){if(e.tokenlist&&e.tokenlist.length>0)for(var i=0;i<e.tokenlist.length;i++)s.TOKEN_LIST.push(String(e.tokenlist[i].uid));if(this._display.timesTxt.text=s.TOKEN_LIST?"活动期间领取次数："+s.TOKEN_LIST.length+"/3":"活动期间领取次数：0/3",e.friendlist&&e.friendlist.length>0)for(var i=0;i<e.friendlist.length;i++)e.friendlist[i].sortV=0,e.friendlist[i].uid==t.Global.UID?e.friendlist[i].sortV=999999:-1!=s.TOKEN_LIST.indexOf(e.friendlist[i].uid)&&(e.friendlist[i].sortV=-999999);e.friendlist.sort(function(t,e){return e.sortV-t.sortV+1e4*(e.gift_num-t.gift_num)+(e.score-t.score)}),this.list.array=e.friendlist}else t.WeakTips.show("获取列表失败，"+e.msg)},s.prototype.updateItem=function(t,e){e<=this.list.array.length-1&&t.doRender(this.list.array[e],e,this._display.menuTab.selectedIndex)},s.prototype.showTab=function(){var t=this._display.menuTab.selectedIndex;this.getList(t)},s.prototype.showTips=function(e){var i=e.p;Laya.timer.clear(this,this.hideTips),this._display.tipsBox.visible=!0,this._display.tipsBox.y=i.y-this.y-t.LayerMgr.offY+50,Laya.timer.once(4e3,this,this.hideTips)},s.prototype.hideTips=function(){this._display.tipsBox.visible=!1},s.prototype.showRule=function(){var e="";e+="<img src='ui/comp/icon.png'></img> 1. 领取1次课程表奖励积10分，小卖部购买一次商品积1分，转盘一次积2分；<br>",e+="<img src='ui/comp/icon.png'></img> 2. 活动期间开学分数达到100分，可以获得开学礼包；<br>",e+="<img src='ui/comp/icon.png'></img> 3. 活动期间可领取3次开学礼包，每个礼包同一个玩家只能领取1次；<br>",e+="<img src='ui/comp/icon.png'></img> 4. 开学分数达到100分以上方可领取开学礼包。",t.RulePanel.showRule(e,"")},s.prototype.getShoolMateGift=function(e){if(String(e.uid)!=t.Global.UID){for(var i=this.list.array,n=0;n<i.length;n++)if(i[n].uid==e.uid){i[n].sortV=-999999;break}i.sort(function(t,e){return e.sortV-t.sortV+1e4*(e.gift_num-t.gift_num)+(e.score-t.score)}),this.list.array=i}this._display.timesTxt.text=s.TOKEN_LIST?"活动期间领取次数："+s.TOKEN_LIST.length+"/3":"活动期间领取次数：0/3"},s.prototype.destroy=function(){s.TOKEN_LIST=null,Laya.timer.clear(this,this.hideTips),t.EventCenter.singleton.off("SHOW_SCHOOL_MATE_TIPS",this,this.showTips),t.EventCenter.singleton.off("GET_SHOOLEMATE_GIFT",this,this.getShoolMateGift),this._display.ruleImage.off(Laya.Event.CLICK,this,this.showRule),this.list&&(this.list.destroy(),this.list=null),e.prototype.destroy.call(this)},s}(t.BaseBox);t.SchoolMateListBox=e;var i=function(i){function s(){i.call(this),this.getBtn.on(Laya.Event.CLICK,this,this.getBtnClickHandler),this.giftIcon.on(Laya.Event.CLICK,this,this.iconClickHandler),this.playerInfo.headBg.on(Laya.Event.CLICK,this,this.headBgClickHandler),this.playerInfo.maleIcon.visible=!1,this.playerInfo.femaleIcon.visible=!1,this._initPng2X=this.numPng2.x,this._initPng3X=this.numPng3.x,this.hasGet.visible=!1}return __extends(s,i),s.prototype.doRender=function(i,s,n){this._selectIndex=n,this._memberObj=i;var a=s+1;3>=a?(this.numPng.visible=!0,this.numPng.skin="ui/schoolOpen2017/schoolMateList/img_"+a+".png",this.numPng1.visible=!1,this.numPng2.visible=!1,this.numPng3.visible=!1):(this.numPng.visible=!1,10>a?(this.numPng1.visible=!1,this.numPng2.visible=!0,this.numPng2.x=this._initPng2X,this.numPng2.skin="ui/schoolOpen2017/schoolMateList/"+a+".png",this.numPng3.visible=!1):100>a?(this.numPng1.visible=!1,this.numPng2.visible=!0,this.numPng2.x=this._initPng2X-20,this.numPng2.skin="ui/schoolOpen2017/schoolMateList/"+String(a).charAt(0)+".png",this.numPng3.visible=!0,this.numPng3.x=this._initPng3X-20,this.numPng3.skin="ui/schoolOpen2017/schoolMateList/"+String(a).charAt(1)+".png"):(this.numPng1.visible=!0,this.numPng1.skin="ui/schoolOpen2017/schoolMateList/"+String(a).charAt(0)+".png",this.numPng2.visible=!0,this.numPng2.x=this._initPng2X,this.numPng2.skin="ui/schoolOpen2017/schoolMateList/"+String(a).charAt(1)+".png",this.numPng3.visible=!0,this.numPng3.x=this._initPng3X,this.numPng3.skin="ui/schoolOpen2017/schoolMateList/"+String(a).charAt(2)+".png")),this._memberObj=i,this.playerInfo.photo.loadImage(t.JSUtils.getHeadUrl(this._memberObj.headimgurl),0,0,82,82),1==Number(this._memberObj.sex)?(this.playerInfo.maleIcon.visible=!0,this.playerInfo.femaleIcon.visible=!1,this.playerInfo.defaultHead.skin="ui/main/male.png"):(this.playerInfo.maleIcon.visible=!1,this.playerInfo.femaleIcon.visible=!0,this.playerInfo.defaultHead.skin="ui/main/female.png"),this.nameTxt.text=this._memberObj.name,this.scoreTxt.text="开学分数："+this._memberObj.score,Number(this._memberObj.score)<100?(this.getCountTxt.text="领取次数：0/0",this.getBtn.filters=t.FiltersUtils.getGreyFilters()):(this.getCountTxt.text="领取次数："+(3-Number(this._memberObj.gift_num))+"/3",0==Number(this._memberObj.gift_num)?this.getBtn.filters=t.FiltersUtils.getGreyFilters():this.getBtn.filters=null),this.powerTxt.text="战斗力："+this._memberObj.power,this.playerInfo.tfLvl.text=this._memberObj.level,this.playerInfo.tfVip.text=""+this._memberObj.vip_lvl,e.TOKEN_LIST&&-1!=e.TOKEN_LIST.indexOf(String(this._memberObj.uid))?(this.getBtn.visible=!1,this.hasGet.visible=!0):(this.getBtn.visible=!0,this.hasGet.visible=!1)},s.prototype.getBtnClickHandler=function(){Number(this._memberObj.score)<100?t.WeakTips.show("分数不够，需要分数达到100分"):0==Number(this._memberObj.gift_num)?t.WeakTips.show("已经被领完了"):t.XHR().Post({file:"petpk",cmd:"activity",aid:37,op:"class_award",type:this._selectIndex,target_uid:this._memberObj.uid,uid:t.Global.UID},this,this.getGiftHandler)},s.prototype.getGiftHandler=function(i){0==i.result?(t.Facade.callCommand(new t.SyncChangeCmd(i)),this.getBtn.visible=!1,this.hasGet.visible=!0,this._memberObj.gift_num=Number(this._memberObj.gift_num)-1,this.getCountTxt.text="领取次数："+(3-Number(this._memberObj.gift_num))+"/3",e.TOKEN_LIST||(e.TOKEN_LIST=[]),e.TOKEN_LIST.push(String(this._memberObj.uid)),t.EventCenter.singleton.event("GET_SHOOLEMATE_GIFT",{uid:this._memberObj.uid})):t.WeakTips.show("领取失败，"+i.msg)},s.prototype.headBgClickHandler=function(){t.Facade.callCommand(new t.UserInfoCommand(this._memberObj.uid))},s.prototype.iconClickHandler=function(){t.EventCenter.singleton.event("SHOW_SCHOOL_MATE_TIPS",{p:this.giftIcon.localToGlobal(new laya.maths.Point(0,0))})},s.prototype.destroy=function(){
this._memberObj=null,this.getBtn.off(Laya.Event.CLICK,this,this.getBtnClickHandler),this.giftIcon.off(Laya.Event.CLICK,this,this.iconClickHandler),this.playerInfo.headBg.off(Laya.Event.CLICK,this,this.headBgClickHandler),i.prototype.destroy.call(this)},s}(ui.schoolOpen2017.SchoolMateListItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.schoolOpen2017.Arrive100ScoreUI),this._display=this.skin,this.canClickModelToClose=!1,this.setCloseButton(this._display.closeBtn),this._display.shareBtn.on(Laya.Event.CLICK,this,this.clickHandler)}return __extends(i,e),i.prototype.clickHandler=function(){t.ShareModule.shareMessage({title:["开学啦开学啦！"],desc:["乐斗私塾开学了，快上线领取开学礼包吧~"]},Handler.create(this,this.callBackHandler))},i.prototype.callBackHandler=function(){t.XHR().Post({file:"petpk",cmd:"activity",aid:37,op:"share",uid:t.Global.UID},this,this.shareHandler)},i.prototype.shareHandler=function(e){0==e.result&&(t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0,"恭喜获得分享奖励：")),this.destroy())},i.prototype.destroy=function(){this._display.shareBtn.off(Laya.Event.CLICK,this,this.clickHandler),e.prototype.destroy.call(this)},i}(t.BaseBox);t.ShareSchoolOpen2017Box=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.schoolOpen2017.ShootArrowBoxUI),this.moviePath_shootArrow="assets/skeleton/schoolOpen2017/jianba.sk",this._numObj={},this._canClick=!0,this._display=this.skin,this.cacheAs="none",this._display.mainLayer.cacheAs="bitmap",this.setCloseButton(this._display.closeBtn),this._display.startBtn.on(Laya.Event.CLICK,this,this.startBtnCLickHandler),this.skeleton_shootArrow=new t.AnimationSKe(this.moviePath_shootArrow),this._display.sp.addChild(this.skeleton_shootArrow),this.skeleton_shootArrow.visible=!1,this.skeleton_shootArrow.on(Laya.Event.STOPPED,this,this.shootArrowMoviePlayOver);for(var i=1;5>=i;i++)this._display["pos"+i].alpha=0;t.XHR().Post({file:"petpk",cmd:"activity",aid:37,op:"shootq",uid:t.Global.UID},this,this.getDataHandler)}return __extends(i,e),i.prototype.getDataHandler=function(e){if(0==e.result){this._shootMax=Number(e.today_max),this._shootNow=Number(e.today_num),this._display.freeNumTxt.text="每天免费训练："+(this._shootNow>3?3:this._shootNow)+"/3",this._display.dayNumTxt.text="今日训练："+ +this._shootNow+"/"+this._shootMax;for(var i,s=0,n=0;n<e.award.attrs.length&&(s++,!(s>5));n++)i=e.award.attrs[n],function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.desc,t.Tips.show(n,e)})}(s,i,this._display["pos"+s]);for(var a,o=0;o<e.award.items.length&&(s++,!(s>5));o++)a=e.award.items[o],this._numObj["id"+s]=Number(a.num),function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.goods_desc,n.info=i.effect_desc,t.Tips.show(n,e)})}(s,a,this._display["pos"+s])}else t.WeakTips.show("查询活动信息失败，"+e.msg)},i.prototype.startBtnCLickHandler=function(){if(this._canClick)if(this._shootNow>=this._shootMax)t.WeakTips.show("今日训练次数已达上限，明天再来吧！");else if(this._shootNow>=3)if(t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).cash<40)t.WeakTips.show("需要消耗40斗豆，您的斗豆数量不足");else{var e=new t.ConfirmBoxData({contentStr:"确定要花费40斗豆来射击一次吗？",callBackHandler:Handler.create(this,this.doShoot)});t.ConfirmBox.show(e)}else t.XHR().Post({file:"petpk",cmd:"activity",aid:37,op:"shoota",uid:t.Global.UID},this,this.shootHandler)},i.prototype.doShoot=function(){t.XHR().Post({file:"petpk",cmd:"activity",aid:37,op:"shoota",uid:t.Global.UID},this,this.shootHandler)},i.prototype.shootHandler=function(e){if(0==e.result){this._data=e,this._shootNow+=1,this._shootNow>=3&&this.event("HIDE_RED"),this._display.freeNumTxt.text="每天免费训练："+(this._shootNow>3?3:this._shootNow)+"/3",this._display.dayNumTxt.text="今日训练："+ +this._shootNow+"/"+this._shootMax,this._canClick=!1,this._display.startBtn.filters=t.FiltersUtils.getGreyFilters(),this._display.startBtn.mouseEnabled=!1,this.skeleton_shootArrow.visible=!0,this.skeleton_shootArrow.play(0,!1);for(var i=e.changed.items[0].num,s=1,n=1;5>=n;n++)if(Number(this._numObj["id"+n])==i){s=n;break}this.skeleton_shootArrow.x=this._display["pos"+s].x+172,this.skeleton_shootArrow.y=this._display["pos"+s].y+92}else t.WeakTips.show("训练失败，"+e.msg)},i.prototype.shootArrowMoviePlayOver=function(){this._canClick=!0,this._display.startBtn.filters=null,this._display.startBtn.mouseEnabled=!0,this.skeleton_shootArrow.visible=!1,this.syncData()},i.prototype.syncData=function(){this._data&&(this._data.hasOwnProperty("score")&&t.Facade.callCommand(new t.SchoolOpenScoreChangeCmd(Number(this._data.score))),t.Facade.callCommand(new t.SyncChangeCmd(this._data)),this._data=null)},i.prototype.destroy=function(){this._numObj=null,this.syncData(),this.skeleton_shootArrow&&(this.skeleton_shootArrow.off(Laya.Event.STOPPED,this,this.shootArrowMoviePlayOver),this.skeleton_shootArrow.destroy(),this.skeleton_shootArrow=null),this._display.startBtn.off(Laya.Event.CLICK,this,this.startBtnCLickHandler),e.prototype.destroy.call(this)},i}(t.BaseBox);t.ShootArrowBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.schoolOpen2017.VipSchoolOpenBoxUI),this._display=this.skin,this.setCloseButton(this._display.closeBtn),this._display.tipsBox.visible=!1,this._canGetCount=5;for(var i=[0,1,2,6,8],s=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL),n=1;5>=n;n++)this._display["getBtn"+n].on(Laya.Event.CLICK,this,this.getBtnClickHandler),this._display["icon"+n].on(Laya.Event.CLICK,this,this.iconClickHandler),this._display["hasGet"+n].visible=!1,s.vipLevel<i[n-1]&&(this._display["getBtn"+n].filters=t.FiltersUtils.getGreyFilters(),this._canGetCount--);t.XHR().Post({file:"petpk",cmd:"activity",aid:37,op:"vipq",uid:t.Global.UID},this,this.getDataHandler)}return __extends(i,e),i.prototype.getDataHandler=function(e){if(0==e.result){if(e.infos)for(var i=0;i<e.infos.length;i++){var s=e.infos[i];2==Number(s.flag)&&(this._display["hasGet"+(i+1)].visible=!0,this._display["getBtn"+(i+1)].visible=!1,this._canGetCount--)}}else t.WeakTips.show("查询活动信息失败，"+e.msg)},i.prototype.getBtnClickHandler=function(e){e.target.filters&&e.target.filters.length>0?t.WeakTips.show("达人等级不足"):(this._nowGetIndex=Number(e.target.name.split("getBtn")[1]),t.XHR().Post({file:"petpk",cmd:"activity",aid:37,op:"vipa",idx:this._nowGetIndex-1,uid:t.Global.UID},this,this.getVipGiftHandler))},i.prototype.getVipGiftHandler=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e)),this._display["getBtn"+this._nowGetIndex].visible=!1,this._display["hasGet"+this._nowGetIndex].visible=!0,this._canGetCount--,0==this._canGetCount&&this.event("HIDE_RED")):t.WeakTips.show("领取失败，"+e.msg)},i.prototype.iconClickHandler=function(t){var e=["黄金卷轴*20,中威望旗*3,1级聚魂之盒 *6","酱油瓶1天,黄金卷轴*20,中威望旗*4","酱油瓶2天,怒火精华*5,禅修精华*5,鹰眼精华*5,原水精华*5,燃烧精华*5,山岳精华*5","酱油瓶2天,高级怒火精华*5,高级禅修精华*5,高级鹰眼精华*5,高级原水精华*5,高级燃烧精华*5,高级山岳精华*5","酱油瓶4天,潜能果实*40,召唤水晶*20,风神之息*8"],i=Number(t.target.name.split("icon")[1]);Laya.timer.clear(this,this.hideTips),this._display.tipsBox.visible=!0,this._display.tipsBox.x=t.target.x+50,this._display.tipsBox.y=t.target.y+50,this._display.tipsName.text=this._display["nameTxt"+i].text;for(var s=1;8>=s;s++)this._display["tipsMsg"+s].text="";for(var n=e[i-1],a=n.split(","),s=0;s<a.length;s++)this._display["tipsMsg"+(s+1)].text=a[s];this._display.tipsBox.height=75+21*(a.length-1),Laya.timer.once(4e3,this,this.hideTips)},i.prototype.hideTips=function(){this._display.tipsBox.visible=!1},i.prototype.destroy=function(){Laya.timer.clear(this,this.hideTips);for(var t=1;5>=t;t++)this._display["getBtn"+t].off(Laya.Event.CLICK,this,this.getBtnClickHandler),this._display["icon"+t].off(Laya.Event.CLICK,this,this.iconClickHandler);e.prototype.destroy.call(this)},i}(t.BaseBox);t.VipSchoolOpenBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.initialize=function(t){},i.prototype.finalize=function(){},i.prototype.doCommand=function(e){switch(e.getCommandName()){case"EnterSchoopOpen2017SceneCmd":this.showMainScene();break;case"OpenVipSchoolOpenCmd":this.showVipSchoolOpenBox();break;case"OpenClassTableCmd":this.showClassTableBox();break;case"OpenDay7GiftCmd":this.showDay7GiftBox();break;case"OpenShootArrowCmd":this.showShootArrowBox();break;case"OpenSchoolmateListCmd":this.showSchoolMateListBox();break;case"OpenPettyStoreCmd":this.showPettyStoreBox();break;case"FirstEnterSchoolOpen2017Cmd":this.showFirstEnterBox();break;case"SchoolOpen2017ShareScoreBoxCmd":this.showShareBox();break;case"OpenPettyBuyCmd":this.showPettyBuyBox(e);break;case"SchoolOpenScoreChangeCmd":if(this._schoolOpen2017totalScene){var i=e.score;this._schoolOpen2017totalScene.score<100&&i>=100&&t.Facade.callCommand(new t.SchoolOpen2017ShareScoreBoxCmd),this._schoolOpen2017totalScene.changeScore(i)}}},i.prototype.showPettyBuyBox=function(e){this._PettyBuyBox=new t.PettyBuy(e.goodsData,e),this._PettyBuyBox.show()},i.prototype.showMainScene=function(){this._schoolOpen2017totalScene||(this._schoolOpen2017totalScene=new t.SchoolOpen2017TotalScene,this._schoolOpen2017totalScene.on(t.ViewEvent.BASE_DESTROY,this,this.schoolOpen2017totalSceneDestroy),t.SceneMgr.changeScene(this._schoolOpen2017totalScene))},i.prototype.schoolOpen2017totalSceneDestroy=function(e){this._schoolOpen2017totalScene&&(this._schoolOpen2017totalScene.off(t.ViewEvent.BASE_DESTROY,this,this.schoolOpen2017totalSceneDestroy),this._schoolOpen2017totalScene=null),this.unregisterPlugin()},i.prototype.showVipSchoolOpenBox=function(){this._vipSchoolOpenBox||(this._vipSchoolOpenBox=new t.VipSchoolOpenBox,this._vipSchoolOpenBox.on(t.ViewEvent.BASE_DESTROY,this,this.vipSchoolOpenBoxDestroy),this._vipSchoolOpenBox.on("HIDE_RED",this,this.hideVipSchoolRed),this._vipSchoolOpenBox.show())},i.prototype.vipSchoolOpenBoxDestroy=function(){this._vipSchoolOpenBox&&(this._vipSchoolOpenBox.off(t.ViewEvent.BASE_DESTROY,this,this.vipSchoolOpenBoxDestroy),this._vipSchoolOpenBox.off("HIDE_RED",this,this.hideVipSchoolRed),this._vipSchoolOpenBox=null),this.unregisterCommand(new t.OpenVipSchoolOpenCmd)},i.prototype.hideVipSchoolRed=function(){this._schoolOpen2017totalScene&&this._schoolOpen2017totalScene.hideRed(3)},i.prototype.showClassTableBox=function(){this._ClassTableBox||(this._ClassTableBox=new t.ClassTableBox,this._ClassTableBox.on(t.ViewEvent.BASE_DESTROY,this,this.classTableBoxDestroy),this._ClassTableBox.on("HIDE_RED",this,this.hideClassTableRed),this._ClassTableBox.show())},i.prototype.classTableBoxDestroy=function(){this._ClassTableBox&&(this._ClassTableBox.off(t.ViewEvent.BASE_DESTROY,this,this.classTableBoxDestroy),this._ClassTableBox.off("HIDE_RED",this,this.hideClassTableRed),this._ClassTableBox=null),this.unregisterCommand(new t.OpenClassTableCmd)},i.prototype.hideClassTableRed=function(){this._schoolOpen2017totalScene&&this._schoolOpen2017totalScene.hideRed(1)},i.prototype.showDay7GiftBox=function(){this._Day7GiftBox||(this._Day7GiftBox=new t.Day7GiftBox,this._Day7GiftBox.on(t.ViewEvent.BASE_DESTROY,this,this.day7GiftBoxDestroy),this._Day7GiftBox.on("HIDE_RED",this,this.hideDay7GiftRed),this._Day7GiftBox.show())},i.prototype.day7GiftBoxDestroy=function(){this._Day7GiftBox&&(this._Day7GiftBox.off(t.ViewEvent.BASE_DESTROY,this,this.day7GiftBoxDestroy),this._Day7GiftBox.off("HIDE_RED",this,this.hideDay7GiftRed),this._Day7GiftBox=null),this.unregisterCommand(new t.OpenDay7GiftCmd)},i.prototype.hideDay7GiftRed=function(){this._schoolOpen2017totalScene&&this._schoolOpen2017totalScene.hideRed(4)},i.prototype.showShootArrowBox=function(){this._ShootArrowBox||(this._ShootArrowBox=new t.ShootArrowBox,this._ShootArrowBox.on(t.ViewEvent.BASE_DESTROY,this,this.shootArrowBoxDestroy),this._ShootArrowBox.on("HIDE_RED",this,this.hideShootArrowRed),this._ShootArrowBox.show())},i.prototype.shootArrowBoxDestroy=function(){this._ShootArrowBox&&(this._ShootArrowBox.off(t.ViewEvent.BASE_DESTROY,this,this.shootArrowBoxDestroy),this._ShootArrowBox.off("HIDE_RED",this,this.hideShootArrowRed),this._ShootArrowBox=null),this.unregisterCommand(new t.OpenShootArrowCmd)},i.prototype.hideShootArrowRed=function(){this._schoolOpen2017totalScene&&this._schoolOpen2017totalScene.hideRed(2)},i.prototype.showSchoolMateListBox=function(){this._schoolMateListBox||(this._schoolMateListBox=new t.SchoolMateListBox,this._schoolMateListBox.on(t.ViewEvent.BASE_DESTROY,this,this.schoolMateListBoxDestroy),this._schoolMateListBox.show())},i.prototype.schoolMateListBoxDestroy=function(){this._schoolMateListBox&&(this._schoolMateListBox.off(t.ViewEvent.BASE_DESTROY,this,this.schoolMateListBoxDestroy),this._schoolMateListBox=null),this.unregisterCommand(new t.OpenSchoolmateListCmd)},i.prototype.showPettyStoreBox=function(){this._PettyStoreBox||(this._PettyStoreBox=new t.PettyStoreBox,this._PettyStoreBox.on(t.ViewEvent.BASE_DESTROY,this,this.pettyStoreBoxDestroy),this._PettyStoreBox.show())},i.prototype.pettyStoreBoxDestroy=function(){this._PettyStoreBox&&(this._PettyStoreBox.off(t.ViewEvent.BASE_DESTROY,this,this.pettyStoreBoxDestroy),this._PettyStoreBox=null),this.unregisterCommand(new t.FirstEnterSchoolOpen2017Cmd)},i.prototype.showFirstEnterBox=function(){this._firstEnterSchoolOpen2017Box||(this._firstEnterSchoolOpen2017Box=new t.FirstEnterSchoolOpen2017Box,this._firstEnterSchoolOpen2017Box.on(t.ViewEvent.BASE_DESTROY,this,this.firstEnterBoxDestroy),this._firstEnterSchoolOpen2017Box.show())},i.prototype.firstEnterBoxDestroy=function(){this._firstEnterSchoolOpen2017Box&&(this._firstEnterSchoolOpen2017Box.off(t.ViewEvent.BASE_DESTROY,this,this.firstEnterBoxDestroy),this._firstEnterSchoolOpen2017Box=null),this.unregisterCommand(new t.OpenPettyStoreCmd)},i.prototype.showShareBox=function(){this._shareSchoolOpen2017Box||(this._shareSchoolOpen2017Box=new t.ShareSchoolOpen2017Box,this._shareSchoolOpen2017Box.on(t.ViewEvent.BASE_DESTROY,this,this.shareBoxDestroy),this._shareSchoolOpen2017Box.show())},i.prototype.shareBoxDestroy=function(){this._shareSchoolOpen2017Box&&(this._shareSchoolOpen2017Box.off(t.ViewEvent.BASE_DESTROY,this,this.shareBoxDestroy),this._shareSchoolOpen2017Box=null),this.unregisterCommand(new t.SchoolOpen2017ShareScoreBoxCmd)},i.prototype.getPluginName=function(){return t.PluginDef.PLUGIN_SCHOOL_OPEN2017_TOTAL},i}(t.Plugin);t.SchoolOpen2017Plugin=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.schoolOpen2017.SchoolOpen2017SceneUI),this._display=this.skin,this._display.backBtn.on(Laya.Event.CLICK,this,this.backBtnClickHandler),this._display.btn_vipSchoolOpen.alpha=0,this._display.btn_vipSchoolOpen.on(Laya.Event.CLICK,this,this.openVipSchoolOpenActivity),this._display.btn_classTable.alpha=0,this._display.btn_classTable.on(Laya.Event.CLICK,this,this.openClassTableActivity),this._display.btn_day7Gift.alpha=0,this._display.btn_day7Gift.on(Laya.Event.CLICK,this,this.openDay7GfitActivity),this._display.btn_shootArrow.alpha=0,this._display.btn_shootArrow.on(Laya.Event.CLICK,this,this.openShootArrowActivity),this._display.btn_schoolmateList.alpha=0,this._display.btn_schoolmateList.on(Laya.Event.CLICK,this,this.openShoolmateListActivity),this._display.btn_pettyStore.alpha=0,this._display.btn_pettyStore.on(Laya.Event.CLICK,this,this.openPettyStoreActivity),this._display.red_classTable.visible=!1,this._display.red_shootArrow.visible=!1,this._display.red_vip.visible=!1,this._display.red_day7.visible=!1,this._display.backBtn.x-=t.Global.FLOAT_ICON_OFFSET;var i=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);this._display.photoM_default.loadImage(t.JSUtils.getHeadUrl("",i.sex),0,0,79,79),this._display.photoM.loadImage(t.JSUtils.getHeadUrl(i.headimgurl,i.sex),0,0,81,81),this._display.sexBM.visible=i.sex==t.Global.BOY,this._display.sexGM.visible=i.sex==t.Global.GIRL,this._display.tfNameM.text=i.name,this._display.tfAtkM.text=i.attackPower+"",this._display.selfPhoto.on(Laya.Event.CLICK,this,this.photoClickHandler),t.XHR().Post({file:"petpk",cmd:"activity",aid:37,op:"reddot",uid:t.Global.UID},this,this.getReddotHandler)}return __extends(i,e),i.prototype.photoClickHandler=function(){t.Facade.callCommand(new t.UserInfoCommand(t.Global.UID))},i.prototype.getReddotHandler=function(t){if(0==t.result&&(t.hasOwnProperty("score")&&(this._display.scoreTxt.text="开学分数："+t.score),t.list&&t.list.length>0))for(var e=0;e<t.list.length;e++){var i=Number(t.list[e].idx);1==i?this._display.red_classTable.visible=!0:2==i?this._display.red_shootArrow.visible=!0:3==i?this._display.red_vip.visible=!0:4==i&&(this._display.red_day7.visible=!0)}},i.prototype.changeScore=function(t){this._display.scoreTxt.text="开学分数："+t},Object.defineProperty(i.prototype,"score",{get:function(){var t=this._display.scoreTxt.text.split("开学分数：")[1];return t&&t.length>0?Number(t):0},enumerable:!0,configurable:!0}),i.prototype.hideRed=function(t){1==t?this._display.red_classTable.visible=!1:2==t?this._display.red_shootArrow.visible=!1:3==t?this._display.red_vip.visible=!1:4==t&&(this._display.red_day7.visible=!1)},i.prototype.openVipSchoolOpenActivity=function(){t.Facade.callCommand(new t.OpenVipSchoolOpenCmd)},i.prototype.openClassTableActivity=function(){t.Facade.callCommand(new t.OpenClassTableCmd)},i.prototype.openDay7GfitActivity=function(){t.Facade.callCommand(new t.OpenDay7GiftCmd)},i.prototype.openShootArrowActivity=function(){t.Facade.callCommand(new t.OpenShootArrowCmd)},i.prototype.openShoolmateListActivity=function(){t.Facade.callCommand(new t.OpenSchoolmateListCmd)},i.prototype.openPettyStoreActivity=function(){t.Facade.callCommand(new t.OpenPettyStoreCmd)},i.prototype.onShowed=function(){},i.prototype.onHided=function(){this.destroy()},i.prototype.getSceneName=function(){return t.SceneDef.SCHOOL_OPEN2017_TOTAL},i.prototype.backBtnClickHandler=function(){t.Facade.callCommand(new t.HomeCommand)},i.prototype.destroy=function(){this._display.selfPhoto.off(Laya.Event.CLICK,this,this.photoClickHandler),this._display.backBtn.off(Laya.Event.CLICK,this,this.backBtnClickHandler),this._display.btn_vipSchoolOpen.off(Laya.Event.CLICK,this,this.openVipSchoolOpenActivity),this._display.btn_classTable.off(Laya.Event.CLICK,this,this.openClassTableActivity),this._display.btn_day7Gift.off(Laya.Event.CLICK,this,this.openDay7GfitActivity),this._display.btn_shootArrow.off(Laya.Event.CLICK,this,this.openShootArrowActivity),this._display.btn_schoolmateList.off(Laya.Event.CLICK,this,this.openShoolmateListActivity),this._display.btn_pettyStore.off(Laya.Event.CLICK,this,this.openPettyStoreActivity),e.prototype.destroy.call(this)},i}(t.BaseScene);t.SchoolOpen2017TotalScene=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.initialize=function(t){},i.prototype.doCommand=function(e){switch(e.getCommandName()){case"OpenServentCmd":this.friendBox&&this.friendBox.isShowed&&this.friendBox.hide(),this.caffBox&&this.caffBox.isShowed&&this.caffBox.hide(),this.msgBox&&this.msgBox.isShowed&&this.msgBox.hide(),this.getServentInfo(e);break;case"ServentOpCmd":this.operate(e);break;case"CatchCmd":this["catch"](e);break;case"OpBoxCmd":this.showOpBox(e);break;case"ResistCmd":this.resist(e);break;case"ReleaseCmd":this.release(e);break;case"ServentRefreshCmd":this.refreshScene();break;case"GetRoleXCmd":t.Global.SERVENT_ROLE_X=[1047,801,554,308][this.curr_idx];break;case"OpenServentRankCmd":var i=e;0==i.tatal&&this.osrc||(this.osrc=i),this.getFriendList();break;case"OpenServentHelpCmd":this.getHelpList();break;case"AskHelpCmd":this.askHelp(e);break;case"TrainCmd":this.train();break;case"ViewRobCmd":this.viewRob(e);break;case"RobCmd":this.rob(e);break;case"OpenJxCmd":this.jxBox||(this.jxBox=new t.JxBox),this.jxBox.show()}},i.prototype.operate=function(e){switch(e.op){case t.ServentOpCmd.OPEN_FEED_BOX:this.getFeed();break;case t.ServentOpCmd.OPEN_CAFF_BOX:this.search(e.searchId,e.idx);break;case t.ServentOpCmd.OP_ACTIVE:this.active(e);break;case t.ServentOpCmd.OP_REWARD:this.reward(e);break;case t.ServentOpCmd.CLOSE_OP_BOX:this.opBox&&this.opBox.hide()}},i.prototype.refreshScene=function(){if(this.sData){var e=new t.OpenServentCmd;e.uid=this.sData.uid,this.getServentInfo(e)}},i.prototype.showServentScene=function(e){this.sData=e,this.serventScene||(this.serventScene=new t.ServentScene,this.serventScene.on(t.ViewEvent.BASE_DESTROY,this,this.sceneDestroy),t.SceneMgr.changeScene(this.serventScene)),this.serventScene.setData(e)},i.prototype.sceneDestroy=function(){this.serventScene.off(t.ViewEvent.BASE_DESTROY,this,this.sceneDestroy),this.serventScene.destroy(),this.serventScene=null,this.msgBox&&(this.msgBox.destroy(),this.msgBox=null),this.friendBox&&(this.friendBox.destroy(),this.friendBox=null),this.caffBox&&(this.caffBox.destroy(),this.caffBox=null),this.opBox&&(this.opBox.destroy(),this.opBox=null),this.robBox&&(this.robBox.destroy(),this.robBox=null),this.helpBox&&(this.helpBox.destroy(),this.helpBox=null),this.unregisterPlugin()},i.prototype.showMsgBox=function(e){this.msgBox||(this.msgBox=new t.MsgBox),this.msgBox.setData(e),this.msgBox.show()},i.prototype.showFriendBox=function(e){this.friendBox||(this.friendBox=new t.FriendBox),this.friendBox.setData(e,this.osrc),this.friendBox.show()},i.prototype.showHelpBox=function(e){this.helpBox||(this.helpBox=new t.HelpBox),this.helpBox.setData(e),this.helpBox.show()},i.prototype.showCaffBox=function(e,i,s){this.caffBox||(this.caffBox=new t.CaffBox),this.caffBox.setData(e,i,s),this.caffBox.isShowed||this.caffBox.show()},i.prototype.showRobBox=function(e){this.robBox||(this.robBox=new t.RobBox),this.robBox.setData(e,this.sData),this.robBox.isShowed||this.robBox.show()},i.prototype.showOpBox=function(e){this.opBox||(this.opBox=new t.ServentOpBox),this.opBox.setData(e),this.opBox.show()},i.prototype.getServentInfo=function(e){e.uid=e.uid==Number(t.Global.UID)?0:e.uid,t.XHR().Post({file:"petpk",cmd:"servant",uid:t.Global.UID,target_uid:e.uid},this,function(s){0==s.result?(i.releaseTimes=Number(s.release_times),i.maxReleaseTimes=Number(s.max_release_times),1==e.hideAll&&t.BoxMgr.hideAll(),s.uid=e.uid,this.showServentScene(s),e.updateLevelLimit&&this.robBox&&this.robBox.isShowed&&this.robBox.update(s)):t.WeakTips.show(s.msg)})},i.prototype.active=function(e){t.XHR().Post({file:"petpk",cmd:"servant",uid:t.Global.UID,op:"activate",idx:e.idx},this,function(i){0==i.result&&this.serventScene.active(e.idx,i.work_type),t.WeakTips.show(i.msg)})},i.prototype["catch"]=function(e){this.curr_idx=e.idx,t.XHR().Post({file:"petpk",cmd:"servant",uid:t.Global.UID,op:"arrest",idx:e.idx,target_uid:e.target_uid,target_owner:e.target_owner,charge:e.charge},this,function(i){if(this.catchData=i,this.catchCmd=e,i.replay){var s=new t.FightCommand(i);t.addListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.onCatchEnd),t.Facade.callCommand(s)}else this.onCatchEnd()})},i.prototype.onCatchEnd=function(){t.removeListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.onCatchEnd),0==this.catchData.result?(this.caffBox&&this.caffBox.isShowed&&this.caffBox.hide(),t.WeakTips.show(this.catchData.msg),this.refreshScene(),t.Facade.callCommand(new t.SendWbGameBarCmd(this.catchCmd.target_uid,t.SendWbGameBarCmd.kServantArrest)),this.catchCmd.win=1==this.catchData.win,this.catchCmd.finish()):t.WeakTips.show(this.catchData.msg)},i.prototype.release=function(e){t.XHR().Post({file:"petpk",cmd:"servant",uid:t.Global.UID,op:"release",target_owner:e.target_owner,target_uid:e.target_uid,charge:e.charge},this,function(s){if(0==s.result)if(t.Facade.callCommand(new t.SyncChangeCmd(s)),s.hasOwnProperty("release_times")&&(i.releaseTimes=Number(s.release_times)),this.releaseData=s,this.releaseCmd=e,s.replay){var n=new t.FightCommand(s);t.addListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.onReleaseEnd),t.Facade.callCommand(n)}else this.onReleaseEnd()})},i.prototype.onReleaseEnd=function(){t.removeListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.onReleaseEnd),0==this.releaseData.result?(t.WeakTips.show(this.releaseData.msg),this.refreshScene(),t.Facade.callCommand(new t.SendWbGameBarCmd(0==this.releaseCmd.target_owner?Number(t.Global.UID):this.releaseCmd.target_owner,t.SendWbGameBarCmd.kServantRelease))):t.WeakTips.show(this.releaseData.msg)},i.prototype.resist=function(e){t.XHR().Post({file:"petpk",cmd:"servant",uid:t.Global.UID,op:"resist",owner:e.owner},this,function(i){if(this.resistData=i,this.resistCmd=e,i.replay){var s=new t.FightCommand(i);t.addListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.onResistEnd),t.Facade.callCommand(s)}else this.onResistEnd()})},i.prototype.onResistEnd=function(){t.removeListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.onResistEnd),0==this.resistData.result?(t.WeakTips.show(this.resistData.msg),t.Facade.callCommand(new t.SendWbGameBarCmd(this.resistCmd.owner,t.SendWbGameBarCmd.kServantResist)),this.refreshScene()):t.WeakTips.show(this.resistData.msg)},i.prototype.reward=function(e){t.XHR().Post({file:"petpk",cmd:"servant",uid:t.Global.UID,op:"reward",idx:e.idx},this,function(e){0==e.result?(this.refreshScene(),t.Util.DecodeJSONProperty("msg",e),t.Facade.callCommand(new t.ShowChangeRewardCmd([e.msg])),t.Facade.callCommand(new t.SyncChangeCmd(e,!1))):t.WeakTips.show(e.msg)})},i.prototype.search=function(e,i){void 0===e&&(e=0),void 0===i&&(i=0),t.XHR().Post({file:"petpk",cmd:"servant",uid:t.Global.UID,op:"teahouse",target_uid:e},this,function(s){0==s.result?this.showCaffBox(s.player_array,i,e):t.WeakTips.show(s.msg)})},i.prototype.viewRob=function(e,i){void 0===i&&(i=0),t.XHR().Post({file:"petpk",cmd:"servant",uid:t.Global.UID,op:"viewrob",target_uid:e.target_uid},this,function(e){0==e.result?this.showRobBox(e):t.WeakTips.show(e.msg)})},i.prototype.rob=function(e){t.XHR().Post({file:"petpk",cmd:"servant",uid:t.Global.UID,op:"rob",target_uid:e.target_uid},this,function(i){if(this.robData=i,this.rc=e,i.replay){var s=new t.FightCommand(i);t.addListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.onRobEnd),t.Facade.callCommand(s)}else this.onRobEnd()})},i.prototype.onRobEnd=function(){t.removeListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.onRobEnd),0==this.robData.result?(this.robBox&&this.robBox.isShowed?(this.rc.win=0!=this.robData.win,this.rc.finish(),this.serventScene&&this.serventScene.addCash(this.robData.cash_rob_num,this.robData.rob_cash_cost,this.robData.exp_rob_num),this.robBox&&this.robBox.updateData()):this.serventScene&&this.refreshScene(),t.WeakTips.show(this.robData.msg),t.Facade.callCommand(new t.SendWbGameBarCmd(this.robData.target_uid,t.SendWbGameBarCmd.kServantRob))):t.WeakTips.show(this.robData.msg)},i.prototype.getFeed=function(){t.XHR().Post({file:"petpk",cmd:"servant",uid:t.Global.UID,op:"feeds"},this,function(e){0==e.result?this.showMsgBox(e.feeds_array):t.WeakTips.show(e.msg)})},i.prototype.getFriendList=function(){t.XHR().Post({file:"petpk",cmd:"servant",uid:t.Global.UID,op:"friend"},this,function(e){0==e.result?this.showFriendBox(e.friend_array):t.WeakTips.show(e.msg)})},i.prototype.getHelpList=function(){t.XHR().Post({file:"petpk",cmd:"servant",uid:t.Global.UID,op:"viewhelp"},this,function(e){0==e.result?this.showHelpBox(e):t.WeakTips.show(e.msg)})},i.prototype.askHelp=function(e){this.ahc=e,t.XHR().Post({file:"petpk",cmd:"servant",uid:t.Global.UID,op:"askhelp",target_uid:e.uid},this,function(e){if(this.askHelpData=e,e.replay){var i=new t.FightCommand(e);t.addListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.onAskHelpEnd),t.Facade.callCommand(i)}else this.onAskHelpEnd()})},i.prototype.onAskHelpEnd=function(){t.removeListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.onAskHelpEnd),0==this.askHelpData.result?(0!=this.askHelpData.win?(this.helpBox&&this.helpBox.isShowed&&this.helpBox.hide(),t.WeakTips.show(this.askHelpData.msg),this.refreshScene()):t.WeakTips.show(this.askHelpData.msg),this.ahc.result=0!=this.askHelpData.win,this.ahc.finish()):t.WeakTips.show(this.askHelpData.msg)},i.prototype.train=function(){t.XHR().Post({file:"petpk",cmd:"servant",uid:t.Global.UID,op:"train"},this,function(e){this.serventScene?this.serventScene.act(e):t.WeakTips.show(e.msg)})},i.prototype.getPluginName=function(){return t.PluginDef.PLUGIN_SERVENT},i.releaseTimes=0,i.maxReleaseTimes=5,i}(t.Plugin);t.ServentModule=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.servent.CaffUI,!0,!1,!0,!1),this.init()}return __extends(s,e),s.prototype.init=function(){this.name="CaffBox",this._display=this.skin,this.setCloseButton(this._display.back.btnClose),this._display.list.itemRender=i,this._display.list.renderHandler=new Handler(this,this.onListRender),this._display.on(Laya.Event.CLICK,this,this.onClick)},s.prototype.onClick=function(e){switch(e.target){case this._display.searchBtn:var i=new t.ServentOpCmd;i.op=t.ServentOpCmd.OPEN_CAFF_BOX,i.idx=this._idx,i.searchId=Number(this._display.input.text),t.Facade.callCommand(i);break;case this._display.changeBtn:var i=new t.ServentOpCmd;i.op=t.ServentOpCmd.OPEN_CAFF_BOX,i.idx=this._idx,t.Facade.callCommand(i)}},s.prototype.setData=function(t,e,i){this.isSearch=0!=i,this._players=t,this._idx=e,this.callLater(this.refresh)},s.prototype.refresh=function(){this._display.list.array=this._players},s.prototype.onListRender=function(t,e){t.setData(this._display.list.getItem(e),this._idx,this.isSearch)},s}(t.BaseBox);t.CaffBox=e;var i=function(e){function i(){e.call(this),this.on(laya.events.Event.CLICK,this,this.onClick)}return __extends(i,e),i.prototype.setData=function(e,i,s){this.data=e,this.idx=i,this.isSearch=s,this.tfName.text=this.data.name,this.ulName.width=this.tfName.textWidth,this.ulName.x=(this.tfName.width-this.ulName.width)/2,this.photo.loadImage(t.JSUtils.getHeadUrl("",this.data.sex),0,0,82,82),Laya.timer.frameOnce(1,this,this.loadPhoto),this.tfLvl.text=this.data.level,this.tfVip.text="达人"+this.data.vip_level,this.sexB.visible=this.data.sex==t.Global.BOY,this.sexG.visible=this.data.sex==t.Global.GIRL;var n=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);this.flag.visible=0!=n.facID&&n.facID==e.facid,this.flag.x=81-this.tfName.textWidth/2,0==this.data.owner_uid?(this.info1.visible=!0,this.info2.visible=!1,this.catchBtn.visible=!0,this.robBtn.visible=!1,this.tfAtk.text=this.data.attack_power):(this.info1.visible=!1,this.info2.visible=!0,this.catchBtn.visible=!1,this.robBtn.visible=!0,this.flag2.visible=0!=n.facID&&n.facID==e.owner_facid,this.tfFlag.x=this.flag2.visible?47:10,this.tfAtk_1.text="雇主战力："+this.data.owner_attack_power)},i.prototype.loadPhoto=function(){this.photo.loadImage(t.JSUtils.getHeadUrl(this.data.headimgurl,this.data.sex),0,0,82,82)},i.prototype.onClick=function(e){
switch(e.target){case this.tfName:var i=new t.OpenServentCmd;i.uid=this.data.uid,t.Facade.callCommand(i);break;case this.catchBtn:case this.robBtn:if(this.isSearch&&0==t.JSUtils.isFriend(this.data.uid)&&0!=this.data.owner_uid){var s=new t.ConfirmBoxData({isShowCancelBtn:!0,contentStr:"【转雇】非好友或帮友，需消耗50斗鱼/次，是否确定？",callBackHandler:new Handler(this,this["catch"])});t.ConfirmBox.show(s)}else{var n=new t.CatchCmd;n.target_uid=this.data.uid,n.target_owner=this.data.owner_uid,n.idx=this.idx,t.Facade.callCommand(n)}break;case this.photo:t.Facade.callCommand(new t.UserInfoCommand(this.data.uid))}},i.prototype["catch"]=function(){var e=new t.CatchCmd;e.target_uid=this.data.uid,e.target_owner=this.data.owner_uid,e.idx=this.idx,e.charge=1,t.Facade.callCommand(e)},i}(ui.servent.CaffItemUI);t.CaffItem=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this,new ui.servent.RankUI,!0,!1,!0,!1),this.init()}return __extends(e,t),e.prototype.init=function(){this.name="FriendBox",this._display=this.skin,this.setCloseButton(this._display.back.closeBtn),this._display.rankList.itemRender=i,this._display.rankList.renderHandler=new Handler(this,this.onListRender),this._display.rankList.array=[],this._display.rankList.scrollBar.hide=!0},e.prototype.setData=function(t,e){this._friends=t,this._orsc=e,this._friends.sort(function(t,e){return e.level-t.level}),this._display.tfNum.text=e.curr+"/"+e.tatal,this.callLater(this.refresh)},e.prototype.refresh=function(){var t=this._display.rankList.selectedIndex;this._display.rankList.array=this._friends,this._display.rankList.scrollTo(t)},e.prototype.onListRender=function(t,e){t.setData(this._display.rankList.getItem(e),e,this._orsc)},e}(t.BaseBox);t.FriendBox=e;var i=function(e){function i(){e.call(this),this._word=new t.ImageWord("assets/word/friend/"),this._word.x=7,this._word.y=18,this.addChild(this._word),this.on(laya.events.Event.CLICK,this,this.onClick)}return __extends(i,e),i.prototype.setData=function(e,i,s){this.data=e,this._orsc=s,this._curIndex=i+1,1==this._curIndex?this._word.showWord("a"):2==this._curIndex?this._word.showWord("b"):3==this._curIndex?this._word.showWord("c"):this._word.showWord(""+this._curIndex),this.data.uid==t.Global.UID?(this.opComp.visible=!1,this.lookBtn.visible=!1):(this.opComp.visible=!0,this.lookBtn.visible=!0);var n=t.SelfInfo.getTitle(e.level);if(this.titleTxt.color=n.color,this.titleTxt.text=n.text,this.levelTxt.text=e.level,this.maleIcon.visible=e.sex+""=="1",this.femaleIcon.visible=e.sex+""=="2",this.head.skin=t.JSUtils.getHeadUrl(e.headimgurl,e.sex),e.headimgurl&&""!=e.headimgurl?(this.headIcon.graphics.clear(),0==this._curIndex?this.headIcon.loadImage(e.headimgurl,0,0,71,71):this.headIcon.loadImage(t.JSUtils.getHeadUrl(e.headimgurl),0,0,71,71),this.headIcon.visible=!0):this.headIcon.visible=!1,this.nameTxt.text=this.data.name,this.fightTxt.text="战："+this.data.attack_power,0==this.data.owner_uid)this.ownerComp.visible=!1;else{this.ownerComp.visible=!0;var n=t.SelfInfo.getTitle(e.owner_level);this.titleTxt.color=n.color,this.titleTxt2.text=n.text,this.levelTxt2.text=e.owner_level,this.maleIcon2.visible=e.owner_sex+""=="1",this.femaleIcon2.visible=e.owner_sex+""=="2",this.head2.skin=t.JSUtils.getHeadUrl(e.owner_headimg,e.owner_sex),e.owner_headimg&&""!=e.owner_headimg?(this.headIcon2.graphics.clear(),0==this._curIndex?this.headIcon2.loadImage(e.owner_headimg,0,0,71,71):this.headIcon2.loadImage(t.JSUtils.getHeadUrl(e.owner_headimg),0,0,71,71),this.headIcon2.visible=!0):this.headIcon2.visible=!1;try{this.data.owner_name=this.data.owner_name}catch(a){}this.data.owner_name.length>6&&(this.data.owner_name=String(this.data.owner_name).slice(0,5)+"..."),this.nameTxt2.text=this.data.owner_name,this.fightTxt2.text="战："+this.data.owner_attack_power,this.data.owner_uid==t.Global.UID?t.Util.toGray(this.btnHire):t.Util.enable(this.btnHire)}},i.prototype.onClick=function(e){switch(e.target){case this.lookBtn:var i=new t.OpenServentCmd;i.uid=this.data.uid,t.Facade.callCommand(i);break;case this.btnPhoto1:t.Facade.callCommand(new t.UserInfoCommand(this.data.uid));break;case this.btnPhoto2:t.Facade.callCommand(new t.UserInfoCommand(this.data.owner_uid));break;case this.btnHire:if(this.data.owner_uid==t.Global.UID)return void t.Facade.callCommand(new t.ShowChangeRewardCmd(["该好友的雇主是自己"],200,"#FF0000"));var s=new t.CatchCmd;s.init([this.data.uid,this.data.owner_uid,999]),s.on(this,this.onCatch),t.Facade.callCommand(s)}},i.prototype.onCatch=function(e){if(e.win){var i=new t.OpenServentRankCmd;i.tatal=this._orsc.tatal,i.curr=this._orsc.curr,t.Facade.callCommand(i)}},i}(ui.servent.RankItemUI);t.FriendListItem=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.servent.HelpUI,!0,!1,!0,!1),this.init()}return __extends(s,e),s.prototype.init=function(){this.name="HelpBox",this._display=this.skin,this.setCloseButton(this._display.back.closeBtn),this._display.imgReputation.skin=t.ResPath().getPic("kServantCash",t.ResourcePath.PATH_GOODS),this._display.rankList.itemRender=i,this._display.rankList.renderHandler=new Handler(this,this.onListRender),this._display.rankList.array=[],this._display.rankList.scrollBar.hide=!0,this._um=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL),this._um.on(t.ModelEvent.UPDATE_FINISH,this,this.userModelUpdate),this.userModelUpdate()},s.prototype.userModelUpdate=function(){this._display.tfCash.text=""+this._um.servantCash},s.prototype.setData=function(t){this._data=t,this._data.friend_array.sort(function(t,e){return e.level-t.level}),this._display.tfNum.text=t.help_max_times-t.help_times+"/"+t.help_max_times,this.callLater(this.refresh)},s.prototype.refresh=function(){this._display.rankList.array=this._data.friend_array},s.prototype.onListRender=function(t,e){t.setData(this._display.rankList.getItem(e),e)},s.prototype.destroy=function(){this._um.off(t.ModelEvent.UPDATE_FINISH,this,this.userModelUpdate),this._um=null,e.prototype.destroy.call(this)},s}(t.BaseBox);t.HelpBox=e;var i=function(e){function i(){e.call(this),this._word=new t.ImageWord("assets/word/friend/"),this._word.x=7,this._word.y=18,this.addChild(this._word),this.on(laya.events.Event.CLICK,this,this.onClick)}return __extends(i,e),i.prototype.setData=function(e,i){if(this.data=e,this._curIndex=i+1,1==this._curIndex?this._word.showWord("a"):2==this._curIndex?this._word.showWord("b"):3==this._curIndex?this._word.showWord("c"):this._word.showWord(""+this._curIndex),this.data.uid==t.Global.UID)this.opComp.visible=!1,this.btnShare.visible=!0;else{this.opComp.visible=!0,this.btnShare.visible=!1;var s=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);0==this.data.can_help||s.attackPower>this.data.attack_power?t.Util.toGrayAndDisabled(this.opComp):t.Util.enable(this.opComp)}this.tfCash.text=this.data.help_cash;var n=t.SelfInfo.getTitle(e.level);this.titleTxt.color=n.color,this.titleTxt.text=n.text,this.levelTxt.text=e.level,this.maleIcon.visible=e.sex+""=="1",this.femaleIcon.visible=e.sex+""=="2",this.head.skin=t.JSUtils.getHeadUrl(e.headimgurl,e.owner_sex),e.headimgurl&&""!=e.headimgurl?(this.headIcon.graphics.clear(),0==this._curIndex?this.headIcon.loadImage(e.headimgurl,0,0,71,71):this.headIcon.loadImage(t.JSUtils.getHeadUrl(e.headimgurl),0,0,71,71),this.headIcon.visible=!0):this.headIcon.visible=!1,this.nameTxt.text=this.data.name,this.fightTxt.text="战斗力："+this.data.attack_power,this.desc1.text=0==this.data.help_total_num?"胜率：无":"胜率："+Number(100*this.data.help_win_num/this.data.help_total_num).toFixed(2)+"%",this.desc2.text="助人："+this.data.help_total_num+"次",0==this.data.help_total_num?t.Util.toGray(this.btnShare):t.Util.enable(this.btnShare)},i.prototype.onClick=function(e){switch(e.target){case this.btnHelp:t.Util.toGrayAndDisabled(this.opComp);var i=new t.AskHelpCmd;i.uid=this.data.uid,i.on(this,this.onAskEnd),t.Facade.callCommand(i);break;case this.btnShare:0==this.data.help_total_num?t.Facade.callCommand(new t.ShowChangeRewardCmd(["未被好友求助过，请确认后再试！"],200,"#FF0000")):t.ShareModule.shareMessage({desc:["求超越！本大侠累计已被求助"+this.data.help_total_num+"次，胜率"+100*this.data.help_win_num/this.data.help_total_num+"%！！"]});break;case this.btnPhoto:t.Facade.callCommand(new t.UserInfoCommand(this.data.uid))}},i.prototype.onAskEnd=function(t){t.off(),0==t.result&&(this.data.help_total_num++,this.desc1.text="胜率："+Number(100*this.data.help_win_num/this.data.help_total_num).toFixed(2)+"%",this.desc2.text="助人："+this.data.help_total_num+"次")},i}(ui.servent.HelpItemUI);t.HelpListItem=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.servent.JxUI,!0,!1,!0,!1),this.name="JxBox",this._display=this.skin,this.setCloseButton(this._display.closeBtn),this._display.lst.itemRender=i,this._display.lst.renderHandler=new Handler(this,this.onListRender),this._display.lst.array=[],this._display.lst.scrollBar.hide=!0,this._display.yesBtn.on(Laya.Event.CLICK,this,this.deal),this._display.myCheck.on(Laya.Event.CLICK,this,this.onCheck)}return __extends(s,e),s.prototype.onShowed=function(){this.getData(),e.prototype.onShowed.call(this)},s.prototype.getData=function(){t.XHR().Post({file:"petpk",cmd:"servant",uid:t.Global.UID,op:"talk"},this,function(e){0==e.result?this.update(e):t.WeakTips.show(e.msg)})},s.prototype.update=function(t){this._data=t,this._count=0;for(var e=0;e<this._data.talks.length;e++)0!=this._data.talks[e].status&&this._count++;this.updateCount(),this._display.myCheck.selected=!this._data.visible,this._display.lst.array=this._data.talks},s.prototype.onCheck=function(){this._data.visible=!this._display.myCheck.selected,t.XHR().Post({file:"petpk",cmd:"servant",uid:t.Global.UID,op:"talk",sub:1},this,function(e){0==e.result?(this._data.visible=!this._display.myCheck.selected,t.Facade.callCommand(new t.ServentRefreshCmd)):this._display.myCheck.selected=!this._data.visible,t.WeakTips.show(e.msg)})},s.prototype.updateCount=function(){this._display.tfCount.text=this._count+"/10"},s.prototype.deal=function(){for(var e="",i=[],s=0;s<this._data.talks.length;s++)1==this._data.talks[s].status&&i.push(this._data.talks[s].id);e=i.join("|"),t.XHR().Post({file:"petpk",cmd:"servant",uid:t.Global.UID,op:"talk",sub:2,list:e},this,function(e){t.WeakTips.show(e.msg),t.Facade.callCommand(new t.ServentRefreshCmd),this.hide()})},s.prototype.onListRender=function(t,e){t.setData(this._display.lst.getItem(e),e,this)},s}(t.BaseBox);t.JxBox=e;var i=function(e){function i(){e.call(this),this._word=new t.ImageWord("assets/word/friend/"),this._word.x=12,this._word.y=23,this.addChild(this._word),this.on(laya.events.Event.CLICK,this,this.onClick)}return __extends(i,e),i.prototype.setData=function(t,e,i){this._data=t,this._jx=i,this._curIndex=e+1,this._word.showWord(""+this._curIndex),this._curIndex<10?this._word.x=20:this._word.x=4,this.tfDesc.text=t.text,this.checkBox.selected=0!=t.status},i.prototype.onClick=function(e){switch(e.target){case this.checkBox:this._data.status=this.checkBox.selected?1:0,this.checkBox.selected?this._jx._count++:this._jx._count--,this._jx._count>10?(this._jx._count--,this._data.status=0,this.checkBox.selected=!1,t.WeakTips.show("最多选择十条")):this._jx.updateCount()}},i}(ui.servent.JxItemUI);t.JxListItem=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this,new ui.servent.MsgUI,!0,!1,!0,!1),this.init()}return __extends(e,t),e.prototype.init=function(){this.name="MsgBox",this._display=this.skin,this.setCloseButton(this._display.closeBtn),this._display.msgList.itemRender=i,this._display.msgList.selectEnable=!0,this._display.msgList.renderHandler=new Handler(this,this.onListRender),this._display.msgList.array=[],this._display.msgList.scrollBar.hide=!0},e.prototype.setData=function(t){this._feed=t,this.callLater(this.refresh)},e.prototype.refresh=function(){this._display.msgList.array=this._feed},e.prototype.onListRender=function(t,e){t.setData(this._display.msgList.getItem(e))},e}(t.BaseBox);t.MsgBox=e;var i=function(e){function i(){e.call(this),this.on(Laya.Event.CLICK,this,this.onClick)}return __extends(i,e),i.prototype.setData=function(t,e){this.data=t,this.tfTime.text=this.format(t.time),this.tfMsg.text=t.feeds,this.imgNew.visible=!1},i.prototype.onClick=function(){var e=new t.OpenServentCmd;e.uid=this.data.target_uid,t.Facade.callCommand(e)},i.prototype.format=function(t){var e=new Date(1e3*t),i=e.getMonth()+1+"月"+e.getDate()+"日\n"+e.getHours()+"时"+e.getMinutes()+"分";return i},i}(ui.servent.MsgItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.servent.RobUI,!0,!1,!0,!1),this.init()}return __extends(s,e),s.prototype.init=function(){this.name="RobBox",this._display=this.skin,this.setCloseButton(this._display.back.btnClose),this._display.imgReputation.skin=t.ResPath().getPic("kServantCash",t.ResourcePath.PATH_GOODS),this._display.imgExp.skin=t.ResPath().getPic("kExp",t.ResourcePath.PATH_GOODS),this._display.list.itemRender=i,this._display.list.renderHandler=new Handler(this,this.onListRender),this._display.on(Laya.Event.CLICK,this,this.onClick)},s.prototype.onClick=function(e){switch(e.target){case this._display.searchBtn:var i=new t.ViewRobCmd;i.target_uid=Number(this._display.input.text),t.Facade.callCommand(i);break;case this._display.changeBtn:var i=new t.ViewRobCmd;t.Facade.callCommand(i)}},s.prototype.update=function(t){this._sdata=t,this.updateData()},s.prototype.setData=function(t,e){this._players=t.player_array,this._sdata=e,this.updateData(),this.callLater(this.refresh)},s.prototype.updateData=function(){this._sdata&&(this._display.tfCash.text=this._sdata.cash_rob_got+"/"+this._sdata.cash_rob_max,this._display.tfExp.text=this._sdata.exp_rob_got+"/"+this._sdata.exp_rob_max,this._display.tfTimes.text="今日次数："+this._sdata.rob_times+"/"+this._sdata.rob_max_times)},s.prototype.refresh=function(){this._display.list.array=this._players},s.prototype.onListRender=function(t,e){t.setData(this._display.list.getItem(e),this._sdata)},s}(t.BaseBox);t.RobBox=e;var i=function(e){function i(){e.call(this),this.on(laya.events.Event.CLICK,this,this.onClick)}return __extends(i,e),i.prototype.setData=function(e,i){this.data=e,this.tfName.text=this.data.name,this.ulName.width=this.tfName.textWidth,this.ulName.x=(this.tfName.width-this.ulName.width)/2,this.photo.loadImage(t.JSUtils.getHeadUrl("",this.data.sex),0,0,82,82),Laya.timer.frameOnce(1,this,this.loadPhoto),this.tfLvl.text=this.data.level,this.tfVip.text="达人"+this.data.vip_level,this.sexB.visible=this.data.sex==t.Global.BOY,this.sexG.visible=this.data.sex==t.Global.GIRL,this.tfAtk.text=this.data.attack_power,this.tfCash.text=this.data.cash_rob;var s=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);this.flag.visible=0!=s.facID&&s.facID==e.facid,this.flag.x=81-this.tfName.textWidth/2,0==this.data.cash_rob?t.Util.toGrayAndDisabled(this.robBtn):t.Util.enable(this.robBtn)},i.prototype.loadPhoto=function(){this.photo.loadImage(t.JSUtils.getHeadUrl(this.data.headimgurl,this.data.sex),0,0,82,82)},i.prototype.onClick=function(e){switch(e.target){case this.tfName:var i=new t.OpenServentCmd;i.uid=this.data.uid,t.Facade.callCommand(i);break;case this.robBtn:var s=new t.RobCmd;s.target_uid=this.data.uid,s.on(this,this.onRob),t.Facade.callCommand(s);break;case this.photo:t.Facade.callCommand(new t.UserInfoCommand(this.data.uid))}},i.prototype.onRob=function(e){e.off(),e.win&&(this.data.cash_rob=0,this.tfCash.text="0",t.Util.toGrayAndDisabled(this.robBtn))},i}(ui.servent.RobItemUI);t.RobItem=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this,new ui.servent.OpUI,!0,!1,!0,!1),this.init()}return __extends(e,t),e.prototype.init=function(){this.name="ServentOpBox",this._display=this.skin,this.setCloseButton(this._display.closeBtn),this._display.opList.itemRender=i,this._display.opList.renderHandler=new Handler(this,this.onListRender),this._display.opList.array=[],this._display.opList.scrollBar.hide=!0},e.prototype.setData=function(t){this.obc=t,this.callLater(this.refresh)},e.prototype.refresh=function(){this._display.opList.array=this.obc.opList;var t=this.obc.opList.length,e=117*t+8*(t-1);this._display.opList.height=e;var i;this.obc.extraInfo?(this._display.extraInfo.visible=!0,this._display.desTxt.text=this.obc.extraInfo.info,this._display.extraInfo.y=this._display.opList.y+8+e,i=8+this._display.extraInfo.height):(this._display.extraInfo.visible=!1,i=0);var s=this._display.bg.height;this._display.bg.height=e+i+100,this._display.y-=(this._display.bg.height-s)/2},e.prototype.onListRender=function(t,e){t.setData(this._display.opList.getItem(e),e)},e}(t.BaseBox);t.ServentOpBox=e;var i=function(e){function i(){e.call(this),this.opBtn.on(laya.events.Event.CLICK,this,this.onClick)}return __extends(i,e),i.prototype.setData=function(e,i){this.data=e,this.index=i,this.opBtn.label=this.data.btnText,this.desTxt.text=this.data.desText,this.tipsBox.visible=!1,"train"==this.data.desText&&(this.desTxt.text="",this.tipsBox.visible=!0,this.tipsBox.x=136,this.imgReputation.skin=t.ResPath().getPic("kExp",t.ResourcePath.PATH_GOODS),this.imgExp.skin="",this.tfCash.text=this.data.data.exp_train_got+"/"+this.data.data.exp_train_max,this.tfExp.text=""),"rock"==this.data.desText&&(this.desTxt.text="",this.tipsBox.visible=!0,this.tipsBox.x=74,this.imgReputation.skin=t.ResPath().getPic("kServantCash",t.ResourcePath.PATH_GOODS),this.imgExp.skin=t.ResPath().getPic("kExp",t.ResourcePath.PATH_GOODS),this.tfCash.text=this.data.data.cash_rob_got+"/"+this.data.data.cash_rob_max,this.tfExp.text=this.data.data.exp_rob_got+"/"+this.data.data.exp_rob_max,this.data.data.cash_rob_got>=this.data.data.cash_rob_max&&this.data.data.exp_rob_got>=this.data.data.exp_rob_max&&t.Util.toGrayAndDisabled(this.opBtn))},i.prototype.onClick=function(e){if(this.data.showConfirm&&this.data.confirm){var i={isShowCancelBtn:!0,contentStr:this.data.confirm,callBackHandler:new Handler(this,this.op)};this.data.hasOwnProperty("align")&&(i.align=this.data.align);var s=new t.ConfirmBoxData(i);t.ConfirmBox.show(s)}else this.op();2==this.index&&t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.CLICK_WORK_BTN))},i.prototype.op=function(){null!=this.data.enable&&this.data.enable?t.WeakTips.show(this.data.tips):this.data.hasOwnProperty("needDouyu")&&Number(this.data.needDouyu)>0?t.PayConfirm.checkDouYu(Number(this.data.needDouyu),Handler.create(this,this.doOp)):this.doOp()},i.prototype.doOp=function(){var e=new t.ServentOpCmd;e.op=t.ServentOpCmd.CLOSE_OP_BOX,t.Facade.callCommand(e),t.Facade.callStrCommand(this.data.cmd)},i}(ui.servent.OpItemUI);t.OpItem=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function n(){e.call(this,new ui.servent.MainUI),this.SERVENT_COUNT=4,this._isMyOwner=!1,this._actIndex=0,n.SERVENT_SCENE=this,this.init()}return __extends(n,e),n.prototype.init=function(){this._display=this.skin,this._display.on(Laya.Event.CLICK,this,this.clickHandler),this._display.staticLayer.cacheAs="bitmap",this._um=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL),this._um.on(t.ModelEvent.UPDATE_FINISH,this,this.userModelUpdate),this._lv=this._um.level,this._roleList=[];for(var e,n=0;n<this.SERVENT_COUNT;n++)e=new i(this._display["role_"+n]),this._roleList.push(e);this._display.tipsBox.on(Laya.Event.CLICK,this,this.showTips,[this._display.tipsBox]),this._display.tipsBox.on(Laya.Event.MOUSE_OUT,this,this.hideTips),this._display.dialog.visible=!1,this.addPetalAni(),this._brg1=new s(this._display.barrage1,1),this._brg2=new s(this._display.barrage2,2),this._display.closeBtn.x-=t.Global.FLOAT_ICON_OFFSET},n.prototype.userModelUpdate=function(){if(0==this._data.uid&&(this._display.tfCashM.text="家财："+this._um.servantCash),this._um.level>this._lv){this._lv=this._um.level;var e=new t.OpenServentCmd;e.updateLevelLimit=!0,t.Facade.callCommand(e)}},n.prototype.addPetalAni=function(){this.petalGroup=[];for(var e,i=0;3>i;i++)e=new t.AnimationSKe(t.ResPath().getAnimPath("petal",t.ResourcePath.PATH_NPC)+".sk",0),e.mouseEnabled=!1,e.x=this._display.sceneEffect.width,this._display.sceneEffect.addChild(e),e.play(i,!0),this.petalGroup.push(e)},n.prototype.showTips=function(e){var i=e.localToGlobal(new laya.maths.Point(0,0));t.Tips.show({name:"小贴士",info:"等级越高，动一下每日获得奖励上限越高"},i)},n.prototype.hideTips=function(){t.Tips.tipsClose()},n.prototype.onShowed=function(){},n.prototype.onHided=function(){this.destroy()},n.prototype.setData=function(e){this._data=e,this._data.servant_array.sort(function(t,e){return e.idx-t.idx});for(var i,s=!1,a=0;a<this._data.servant_array.length;a++)i=this._data.servant_array[a],i.rob_cash>0&&(s=!0);n.SHARED=e.share_reward,this._bgUrl=s?t.ConfigDef.ROBBED_BG:t.ConfigDef.SERVENT_BG,this._display.background.loadImage(t.Global.getUrl(this._bgUrl)),this.callLater(this.render)},n.prototype.active=function(t,e){this._data.servant_array[this.getIndex(t)]={idx:t,work_times:0,max_work_times:3,uid:"0",status:2,work_type:e},this.callLater(this.renderServantArray)},n.prototype.reward=function(t){if(0==this._data.uid){var e=this._data.servant_array[this.getIndex(t)];5==e.status?e.status=3:e.status=2,this.callLater(this.renderServantArray)}},n.prototype.getIndex=function(t){for(var e=0;e<this._data.servant_array.length;e++)if(this._data.servant_array[e].idx==t)return e;return-1},n.prototype.resist=function(){0==this._data.uid&&(this._data.owner_uid=0,this.renderSelf())},n.prototype.render=function(){this._display.imgReputation.skin=t.ResPath().getPic("kServantCash",t.ResourcePath.PATH_GOODS),this._display.imgExp.skin=t.ResPath().getPic("kExp",t.ResourcePath.PATH_GOODS),this._display.photoM_default.loadImage(t.JSUtils.getHeadUrl("",this._data.sex),0,0,79,79),this._display.photoM.loadImage(t.JSUtils.getHeadUrl(this._data.headimg,this._data.sex),0,0,81,81),this._display.sexBM.visible=this._data.sex==t.Global.BOY,this._display.sexGM.visible=this._data.sex==t.Global.GIRL,this._display.tfNameM.text=this._data.name,this._display.tfCashM.text="家财："+this._data.self_cash,this._display.tfAtkM.text=this._data.attack_power,this._display.nPhoto.skin="ui/servent/"+this._data.sex+".png",0!=this._data.owner_uid?(this._display.actC.scale(.7,.7),this._display.actC1.scale(.7,.7),this._longziSk||(this._longziSk=new t.AnimationSKe(t.ResPath().getEffect("longzi")),this._longziSk.x=1231,this._longziSk.y=691),this._display.skBox.addChild(this._longziSk),this._longziSk.play(0,!1)):(this._display.actC.scale(1,1),this._display.actC1.scale(1,1),this._longziSk&&this._longziSk.removeSelf()),this.clearBarrage(),this._data.talks.length>0&&(0==this._data.owner_uid?this._brg1.show(this._data.talks):this._brg2.show(this._data.talks)),0==this._data.uid||this._data.uid==Number(t.Global.UIN)?(this._display.sbtn1_help.visible=0!=this._data.owner_uid,this.renderSelf()):(this._display.sbtn1_help.visible=!1,this.renderOther()),this.renderServantArray()},n.prototype.clearBarrage=function(){this._brg1&&(this._brg1.clear(),this._brg1.hide()),this._brg2&&(this._brg2.clear(),this._brg2.hide())},n.prototype.renderSelf=function(){if(0==this._data.owner_uid)this._display.ownerInfo.visible=!1,this._display.owner_detail.visible=!1,this._display.tips.visible=!1;else{this._display.ownerInfo.visible=!0,this._display.owner_detail.visible=!0,this._display.tips.visible=!0,this._display.tfLvl.text=this._data.owner_level,this._display.sexB.visible=this._data.owner_sex==t.Global.BOY,this._display.sexG.visible=this._data.owner_sex==t.Global.GIRL,this._display.tfName.text=this._data.owner_name;var e=t.SelfInfo.getTitle(this._data.owner_level);this._display.tfVip.text=e.text,this._display.tfVip.color=e.color,this._display.tfAtk.text=this._data.owner_attack_power,this._display.photo.loadImage(t.JSUtils.getHeadUrl(this._data.owner_headimg),0,0,81,81)}this._display.myOp.visible=!0,this._display.myOp2.visible=!0,this._display.backBtn.visible=!1,this._display.friendFlag.visible=0!=this._data.owner_uid&&1==t.JSUtils.isFriend(this._data.owner_uid),this.refreshActData()},n.prototype.renderOther=function(){if(this._display.tips.visible=!1,this._display.friendFlag.visible=!1,0==this._data.owner_uid)this._display.ownerInfo.visible=!1,this._display.owner_detail.visible=!1;else{this._display.ownerInfo.visible=!0,this._display.owner_detail.visible=!0,this._display.tfLvl.text=this._data.owner_level,this._display.sexB.visible=this._data.owner_sex==t.Global.BOY,this._display.sexG.visible=this._data.owner_sex==t.Global.GIRL,this._display.tfName.text=this._data.owner_name;var e=t.SelfInfo.getTitle(this._data.owner_level);this._display.tfVip.text=e.text,this._display.tfVip.color=e.color,this._display.tfAtk.text=this._data.owner_attack_power,this._display.photo.loadImage(t.JSUtils.getHeadUrl(this._data.owner_headimg),0,0,81,81)}this._display.myOp.visible=!1,this._display.myOp2.visible=!1,this._display.backBtn.visible=!0,this.refreshActData()},n.prototype.renderServantArray=function(){n.POSITION_COUNT=0,n.MY_S_COUNT=0,this._isMyOwner=!1;for(var e,i=0;i<this._data.servant_array.length&&this._roleList.length;i++)e=this._data.servant_array[i],0!=this._data.uid&&e.uid==t.Global.UID&&(this._isMyOwner=!0),this._roleList[i].setData(e,this._data.uid);this.nowRoles=[];for(var s,i=0;i<this._roleList.length;i++)s=this._roleList[i],s.exist&&this.nowRoles.push(s);this.startRoleRandomSay()},n.prototype.hideRoleOps=function(t){for(var e,i=0;i<this._data.servant_array.length&&this._roleList.length;i++)e=this._roleList[i],e!=t&&e.hideOps()},n.prototype.startRoleRandomSay=function(){Laya.timer.loop(6e3,this,this.reallySay)},n.prototype.reallySay=function(){var t=this.nowRoles.length;if(t>=1){var e=Math.floor(Math.random()*t);this.nowRoles[e].say()}},n.prototype.stopRoleRandomSay=function(){Laya.timer.clear(this,this.reallySay)},n.prototype.clickHandler=function(e){switch(e.target){case this._display.messageBtn:var i=new t.ServentOpCmd;i.op=t.ServentOpCmd.OPEN_FEED_BOX,t.Facade.callCommand(i);break;case this._display.friendBtn:var s=new t.OpenServentRankCmd;s.tatal=n.POSITION_COUNT,s.curr=n.MY_S_COUNT,t.Facade.callCommand(s);break;case this._display.ruleBtn:this.showRuleBox();break;case this._display.backBtn:t.Facade.callCommand(new t.OpenServentCmd);break;case this._display.closeBtn:t.Facade.callCommand(new t.HomeCommand);break;case this._display.selfPhoto:0==this._data.uid?t.Facade.callCommand(new t.UserInfoCommand):t.Facade.callCommand(new t.UserInfoCommand(this._data.uid));break;case this._display.btnPhoto:t.Facade.callCommand(new t.UserInfoCommand(this._data.owner_uid));break;case this._display.shopBtn:t.Facade.callCommand(new t.OpenWinShopCmd(4));break;case this._display.jxBtn:t.Facade.callCommand(new t.OpenJxCmd);break;case this._display.sbtn1_help:t.Global.isWXAPP?t.ShareModule.shareMessage({title:["全民大乐斗"],desc:["江湖告急，本鹅被抓为家丁，快来救救我…"],share_type:0,command:1017,image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(9)),back:!0},null,0):t.ShareModule.shareMessage({title:["全民大乐斗"],desc:["江湖告急，本鹅被抓为家丁，快来救救我…"],share_type:0,command:1017,image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg("ss",".png")),back:!0},null,0);break;case this._display.actBtn:if(0!=this._data.uid)if(0!=this._data.owner_uid){var a=new t.OpBoxCmd;this._data.owner_uid==t.Global.UID?t.ServentModule.releaseTimes>=t.ServentModule.maxReleaseTimes?a.opList=[{btnText:"释  放【"+this._data.name+"】",desText:"江湖事了，还其自由身",showConfirm:!0,confirm:"今日释放自己家丁次数（含解救别人家丁）总次数超过5次，为维护家丁市场稳定，每次需消耗50斗鱼（斗鱼不足时消耗斗豆）。\n确定释放家丁【"+this._data.name+"】，还其自由身吗？",cmd:"1014|0,"+this._data.uid+",1",align:"left",needDouyu:50},{btnText:"捣  乱",desText:"胜利可获得"+this._data.cash_rob_num+"家财",cmd:"1016|"+this._data.uid}]:a.opList=[{btnText:"释  放【"+this._data.name+"】",desText:"江湖事了，还其自由身",showConfirm:!0,confirm:"每日可免费释放家丁5次（含解救别人家丁），本次是今日第"+(t.ServentModule.releaseTimes+1)+"次释放。\n确定释放家丁【"+this._data.name+"】，还其自由身吗？",cmd:"1014|0,"+this._data.uid+",0",align:"left"},{btnText:"捣  乱",desText:"胜利可获得"+this._data.cash_rob_num+"家财",cmd:"1016|"+this._data.uid}]:0==t.JSUtils.isFriend(this._data.uid)?a.opList=[{btnText:"解  救【"+this._data.name+"】",desText:"打败雇主，将其解救出来",showConfirm:!0,confirm:"【解救】非好友或帮友，需消耗50斗鱼/次，是否确定？",cmd:"1014|"+this._data.owner_uid+","+this._data.uid+",1",needDouyu:50},{btnText:"转  雇【"+this._data.name+"】",desText:"打败其雇主，雇佣其为自己的家丁",showConfirm:!0,confirm:"【转雇】非好友或帮友，需消耗50斗鱼/次，是否确定？",cmd:"1015|"+this._data.uid+","+this._data.owner_uid+",999,1"},{btnText:"捣  乱",desText:"胜利可获得"+this._data.cash_rob_num+"家财",cmd:"1016|"+this._data.uid}]:t.ServentModule.releaseTimes>=t.ServentModule.maxReleaseTimes?a.opList=[{btnText:"解  救【"+this._data.name+"】",desText:"打败雇主，将其解救出来",showConfirm:!0,confirm:"今日解救别人家丁（含释放自己家丁）总次数超过5次，为维护家丁市场稳定，每次需消耗50斗鱼（斗鱼不足时消耗斗豆）。\n确定解救家丁【"+this._data.name+"】，还其自由身吗？",cmd:"1014|"+this._data.owner_uid+","+this._data.uid+",1",align:"left",needDouyu:50},{btnText:"转  雇【"+this._data.name+"】",desText:"打败其雇主，雇佣其为自己的家丁",showConfirm:!0,confirm:"【转雇】非好友或帮友，需消耗50斗鱼/次，是否确定？",cmd:"1015|"+this._data.uid+","+this._data.owner_uid+",999,1"},{btnText:"捣  乱",desText:"胜利可获得"+this._data.cash_rob_num+"家财",cmd:"1016|"+this._data.uid}]:a.opList=[{btnText:"解  救【"+this._data.name+"】",desText:"打败雇主，将其解救出来",showConfirm:!0,confirm:"每日可免费解救家丁5次（含释放自己家丁），本次是今日第"+(t.ServentModule.releaseTimes+1)+"次解救。\n确定解救家丁【"+this._data.name+"】，还其自由身吗？",cmd:"1014|"+this._data.owner_uid+","+this._data.uid+",0",align:"left"},{btnText:"转  雇【"+this._data.name+"】",desText:"打败其雇主，雇佣其为自己的家丁",showConfirm:!0,confirm:"【转雇】非好友或帮友，需消耗50斗鱼/次，是否确定？",cmd:"1015|"+this._data.uid+","+this._data.owner_uid+",999,0"},{btnText:"捣  乱",desText:"胜利可获得"+this._data.cash_rob_num+"家财",cmd:"1016|"+this._data.uid}],t.Facade.callCommand(a)}else{var a=new t.OpBoxCmd;this._isMyOwner?a.opList=[{btnText:"挣  脱",desText:"消耗：10家财，胜利可获得自由身",cmd:"1013|"+this._data.uid},{btnText:"捣  乱",desText:"胜利可获得"+this._data.cash_rob_num+"家财",cmd:"1016|"+this._data.uid}]:a.opList=[{btnText:"雇  佣【"+this._data.name+"】",desText:"雇佣其为自己的家丁",cmd:"1015|"+this._data.uid+","+this._data.owner_uid+",999,0"},{btnText:"捣  乱",desText:"胜利可获得"+this._data.cash_rob_num+"家财",cmd:"1016|"+this._data.uid}],t.Facade.callCommand(a)}else if(0!=this._data.owner_uid){var a=new t.OpBoxCmd;a.opList=[{btnText:"挣  脱",desText:"消耗：10家财，胜利可获得自由身",cmd:"1013|"+this._data.owner_uid},{btnText:"求助好友",desText:"求助好友解救",cmd:"hf.OpenServentHelpCmd"},{btnText:"训  练",data:this._data,desText:"train",cmd:"hf.TrainCmd"},{btnText:"去 捣 乱",data:this._data,desText:"rock",cmd:"hf.ViewRobCmd|0"}],t.Facade.callCommand(a)}else{var a=new t.OpBoxCmd;a.opList=[{btnText:"训  练",data:this._data,desText:"train",cmd:"hf.TrainCmd"},{btnText:"去 捣 乱",data:this._data,desText:"rock",cmd:"hf.ViewRobCmd|0"}],t.Facade.callCommand(a)}}},n.prototype.rob=function(){
t.Facade.callStrCommand("1015|"+this._data.uid+","+this._data.owner_uid+",999,0")},n.prototype.act=function(e){if(this._actData=e,0!=this._actData.result)return void t.WeakTips.show(e.msg);this._display.mouseEnabled=!1,this._data.exp_train_got=e.exp_got,this.stopRoleRandomSay(),this._actList=[];for(var i,s=0;s<this._roleList.length;s++)i=this._roleList[s],i.exist&&(i.stopSay(),this._actList.push(i));this._actIndex=0,this._actData=e,this.playNext()},n.prototype.playNext=function(){if(this._actIndex>=this._actData.task.length)return this._display.mouseEnabled=!0,this.showTrainResult(),void this.startRoleRandomSay();var t=this._actData.task[this._actIndex];if(0==t.npc)t.hasOwnProperty("desc")&&""!=t.desc&&this.say(t.desc);else if(t.hasOwnProperty("action_id")||t.hasOwnProperty("desc")){var e=this._actList[t.npc-1];e.act(t.action_id,t.desc)}this._actIndex++,Laya.timer.once(t.time,this,this.playNext)},n.prototype.showTrainResult=function(){this.refreshActData(),t.Facade.callCommand(new t.SyncChangeCmd(this._actData))},n.prototype.say=function(t){this._display.dialog.visible=!0,this._display.tfWords.text=t,Laya.timer.once(3e3,this,this.hideSay)},n.prototype.hideSay=function(){this._display.dialog.visible=!1},n.prototype.addCash=function(t,e,i){this._data.cash_rob_got+=t,this._data.self_rob_cost=e,this._data.exp_rob_got+=i,this._data.rob_times++,this._data.rob_times>10&&(this._data.rob_times=10),this.refreshActData()},n.prototype.refreshActData=function(){this._display.tfCash.text=this._data.cash_rob_got+"/"+this._data.cash_rob_max,this._display.tfExp.text=this._data.exp_train_got+this._data.exp_rob_got+"/"+(this._data.exp_train_max+this._data.exp_rob_max)},n.prototype.showRuleBox=function(){var e="<img src='ui/comp/icon.png'></img>点击空的家丁位，打开江湖茶馆，战胜玩家后即可将其雇为家丁；<br><img src='ui/comp/icon.png'></img>家财可在家财商城内购买物品，可通过雇佣家丁和【动一下】获得；<br><img src='ui/comp/icon.png'></img>雇佣后每10分钟产生一次家财，单次领取间隔上限为12小时，达到上限后不可继续产生家财，领取奖励后重置；<br><img src='ui/comp/icon.png'></img>雇佣家丁低于自己5级的，家财收益会逐渐衰减，最低收益效率为50%；<br><img src='ui/comp/icon.png'></img>每次被捣乱，会减少当前家丁收益的20%；<br><img src='ui/comp/icon.png'></img>【动一下】里面的【训练】和【去捣乱】可获得经验和家财奖励，等级越高，每日获得上限越高；<br><img src='ui/comp/icon.png'></img>雇佣好友做家丁的时候，可使用【勾一下】发送消息勾动一下该好友，每日首次使用会获得奖励；<br><img src='ui/comp/icon.png'></img>当前自由身无雇主时，可显示设置最多10条【家训】循环显示在家丁上方，并将其显示在对方家丁庭院内。";t.RulePanel.showRule(e,"")},n.prototype.destroy=function(){this._um.off(t.ModelEvent.UPDATE_FINISH,this,this.userModelUpdate);for(var e=0;e<this._roleList.length;e++)this._roleList[e].destroy();for(var e=0;e<this.petalGroup.length;e++)this.petalGroup[e].destroy();this._longziSk&&(this._longziSk.destroy(),this._longziSk=null),this.clearBarrage(),this.stopRoleRandomSay(),Laya.timer.frameOnce(1,this,this.clear)},n.prototype.clear=function(){e.prototype.destroy.call(this),t.Global.clearRes(t.ConfigDef.SERVENT_BG),t.Global.clearRes(t.ConfigDef.ROBBED_BG)},n.prototype.getSceneName=function(){return t.SceneDef.SERVENT_SCENE},n.POSITION_COUNT=0,n.MY_S_COUNT=0,n}(t.BaseScene);t.ServentScene=e;var i=function(){function i(t){this._scale=80,this._scaleStep=1,this.times=0,this.ui=t,this.ui.mainComp.visible=!1,this.ui.opComp.visible=!1,this.ui.staticComp.cacheAs="bitmap",this.ui.staticComp.mouseThrough=!0,this.ui.on(Laya.Event.CLICK,this,this.clickHandler)}return i.prototype.setData=function(i,s){this.data=i,this.owner=s,Laya.timer.clear(this,this.figuireMovie),this.ui.ops.visible=!1,this.ui.op.visible=!1,0==this.owner&&1!=t.JSUtils.isFriend(this.data.uid)?t.Util.toGray(this.ui.btnGou):t.Util.enable(this.ui.btnGou),this.ui.friendFlag.visible=0==this.owner&&1==t.JSUtils.isFriend(this.data.uid),Laya.timer.clear(this,this.onCutDown),3==this.data.status?(this.ui.mainComp.visible=!0,this.ui.opComp.visible=!1,this.ui.dialog.visible=!1,this.exist=!0,this.ui.tfName.text=this.data.name,this.ui.tfLvl.text=this.data.level,this.ui.photo_default.loadImage(t.JSUtils.getHeadUrl("",this.data.sex),0,0,47,47),this.ui.photo.loadImage(t.JSUtils.getHeadUrl(this.data.headimgurl,this.data.sex),0,0,47,47),this.ui.tfScore.text=0==this.data.rob_cash?this.data.work_cash:this.data.work_cash+"(-"+this.data.rob_cash+")",this.ui.progressNormal.value=0==this.data.total_cash?0:this.data.work_cash/this.data.total_cash,this.ui.progressRob.value=0==this.data.total_cash?0:this.data.rob_cash/this.data.total_cash,this.ui.figure.visible=this.data.work_cash>0&&0==this.owner,this.data.left_time=this.data.work_max_time-this.data.work_time,this.data.left_time=this.data.left_time<0?0:this.data.left_time,this.setTime(),Laya.timer.loop(1e3,this,this.onCutDown),this.qqAni||(this.qqAni=new t.AnimationSKe(t.ResPath().getAnimPath(1==this.data.sex?"nanqie":"nvqie",t.ResourcePath.PATH_NPC)+".sk",1),this.qqAni.x=95,this.qqAni.y=150,this.qqAni.scaleX=.8,this.qqAni.scaleY=.8,this.qqAni.size(120,120),this.qqAni.mouseEnabled=!0,this.ui.roleBox.addChild(this.qqAni),2==this.data.idx&&(this.qqAni.scaleX=-.8)),this.breathe(),e.MY_S_COUNT++,this.ui.roleBox.mouseEnabled=!0):(this.ui.mainComp.visible=!1,this.ui.opComp.visible=!0,this.exist=!1,this.createEffectAni(),this.ui.lock.visible=0==this.data.status,this.ui.activeBtn.visible=1==this.data.status&&0==this.owner,this.ui.catchBtn.visible=2==this.data.status&&0==this.owner,this.ui.figure.visible=4==this.data.status&&0==this.owner),0!=this.data.status&&1!=this.data.status&&e.POSITION_COUNT++,this.ui.figure.visible&&Laya.timer.loop(20,this,this.figuireMovie)},i.prototype.createEffectAni=function(){this.effectAni||(this.effectAni=new t.AnimationSKe(t.ResPath().getAnimPath("effect_jiapu",t.ResourcePath.PATH_NPC)+".sk",0),this.effectAni.x=95,this.effectAni.y=150,this.effectAni.mouseEnabled=!1,this.effectAni.alpha=.6,this.ui.effectBox.addChild(this.effectAni),this.effectAni.play(0,!0))},i.prototype.figuireMovie=function(){this.ui.figure.visible&&(this._scale+=this._scaleStep,this._scaleStep>0?this._scale>=90&&(this._scaleStep=-1):this._scale<=70&&(this._scaleStep=1),this.ui.figure&&(this.ui.figure.scaleX=this.ui.figure.scaleY=this._scale/100))},i.prototype.clickHandler=function(i){switch(i.target){case this.ui.activeBtn:var s=new t.ServentOpCmd;s.op=t.ServentOpCmd.OP_ACTIVE,s.idx=this.data.idx,t.Facade.callCommand(s);break;case this.ui.catchBtn:var s=new t.ServentOpCmd;s.op=t.ServentOpCmd.OPEN_CAFF_BOX,s.idx=this.data.idx,t.Facade.callCommand(s);break;case this.ui.figure:var s=new t.ServentOpCmd;s.op=t.ServentOpCmd.OP_REWARD,s.idx=this.data.idx,t.Facade.callCommand(s);break;case this.ui.roleBox:if(this.ui.figure.visible){var s=new t.ServentOpCmd;return s.op=t.ServentOpCmd.OP_REWARD,s.idx=this.data.idx,void t.Facade.callCommand(s)}3==this.data.status&&(e.SERVENT_SCENE.hideRoleOps(this),0==this.owner?this.ui.op.visible=!this.ui.op.visible:this.ui.ops.visible=!this.ui.ops.visible);break;case this.ui.btnRelease:if(this.ui.op.visible=!1,t.ServentModule.releaseTimes>=t.ServentModule.maxReleaseTimes){var n=new t.ConfirmBoxData({isShowCancelBtn:!0,callBackHandler:new Handler(this,this.releaseNeedMoney),align:"left",contentStr:"今日释放自己家丁次数（含解救别人家丁）总次数超过5次，为维护家丁市场稳定，每次需消耗50斗鱼（斗鱼不足时消耗斗豆）。\n确定释放家丁【"+this.data.name+"】，还其自由身吗？"});t.ConfirmBox.show(n)}else{var n=new t.ConfirmBoxData({isShowCancelBtn:!0,callBackHandler:new Handler(this,this.releaseFree),align:"left",contentStr:"每日可免费释放家丁5次（含解救别人家丁），本次是今日第"+(t.ServentModule.releaseTimes+1)+"次释放。\n确定释放家丁【"+this.data.name+"】，还其自由身吗？"});t.ConfirmBox.show(n)}break;case this.ui.btnHire:if(this.ui.ops.visible=!1,0==t.JSUtils.isFriend(this.data.uid)){var n=new t.ConfirmBoxData({isShowCancelBtn:!0,contentStr:"【转雇】非好友或帮友，需消耗50斗鱼/次，是否确定？",callBackHandler:new Handler(this,this.hire)});t.ConfirmBox.show(n)}else t.Facade.callStrCommand("1015|"+this.data.uid+","+this.owner+",999,0");break;case this.ui.btnSave:if(this.ui.ops.visible=!1,0==t.JSUtils.isFriend(this.data.uid)){var n=new t.ConfirmBoxData({isShowCancelBtn:!0,callBackHandler:new Handler(this,this.saveNeedMoney),contentStr:"【解救】非好友或帮友，需消耗50斗鱼/次，是否确定？"});t.ConfirmBox.show(n)}else if(t.ServentModule.releaseTimes>=t.ServentModule.maxReleaseTimes){var n=new t.ConfirmBoxData({isShowCancelBtn:!0,callBackHandler:new Handler(this,this.saveNeedMoney),align:"left",contentStr:"今日解救别人家丁（含释放自己家丁）总次数超过5次，为维护家丁市场稳定，每次需消耗50斗鱼（斗鱼不足时消耗斗豆）。\n确定解救家丁【"+this.data.name+"】，还其自由身吗？"});t.ConfirmBox.show(n)}else{var n=new t.ConfirmBoxData({isShowCancelBtn:!0,callBackHandler:new Handler(this,this.saveFree),align:"left",contentStr:"每日可免费解救家丁5次（含释放自己家丁），本次是今日第"+(t.ServentModule.releaseTimes+1)+"次解救。\n确定解救家丁【"+this.data.name+"】，还其自由身吗？"});t.ConfirmBox.show(n)}break;case this.ui.lock:this.data.hasOwnProperty("vip_level")&&this.data.vip_level>0?t.Facade.callCommand(new t.ShowChangeRewardCmd(["该家丁位达人"+this.data.vip_level+"开启"],200,"#ffec49")):this.data.hasOwnProperty("level")&&this.data.level>0&&t.Facade.callCommand(new t.ShowChangeRewardCmd(["该家丁位"+this.data.level+"级开启"],200,"#ffec49"));break;case this.ui.btnPhoto:t.Facade.callCommand(new t.UserInfoCommand(this.data.uid));break;case this.ui.btnGou:if(1==t.JSUtils.isFriend(this.data.uid)){var n=new t.ConfirmBoxData({isShowCancelBtn:!0,contentStr:"是否勾动一下该好友，并发送一条消息给对方？",callBackHandler:new Handler(this,this.share)});t.ConfirmBox.show(n)}else t.WeakTips.show("雇佣好友为家丁时，可发分享消息勾动一下对方，每日首次勾动有奖励哦！")}},i.prototype.releaseFree=function(){t.Facade.callStrCommand("1014|0,"+this.data.uid+",0")},i.prototype.releaseNeedMoney=function(){t.PayConfirm.checkDouYu(50,Handler.create(this,this.doReleaseNeedMoney))},i.prototype.doReleaseNeedMoney=function(){t.Facade.callStrCommand("1014|0,"+this.data.uid+",1")},i.prototype.saveFree=function(){t.Facade.callStrCommand("1014|"+this.owner+","+this.data.uid+",0")},i.prototype.saveNeedMoney=function(){t.PayConfirm.checkDouYu(50,Handler.create(this,this.doSaveNeedMoney))},i.prototype.doSaveNeedMoney=function(){t.Facade.callStrCommand("1014|"+this.owner+","+this.data.uid+",1")},i.prototype.hire=function(){t.Facade.callStrCommand("1015|"+this.data.uid+","+this.owner+",999,1")},i.prototype.share=function(){t.ShareModule.shareMessage({title:["全民大乐斗【家丁】"],desc:["做为家丁，你要好好干活，我马上就要给你加工资了..."],uid:this.data.uid,command:1017,image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg("ss",".png")),back:!0},new Handler(this,this.onShare),0)},i.prototype.onShare=function(){e.SHARED||t.XHR().Post({file:"petpk",cmd:"servant",uid:t.Global.UID,op:"share"},this,function(i){0==i.result?(e.SHARED=!0,t.Facade.callCommand(new t.SyncChangeCmd(i))):t.WeakTips.show(i.msg)})},i.prototype.hideOps=function(){this.ui.ops.visible=!1,this.ui.op.visible=!1},i.prototype.say=function(){this.ui.roleBox.mouseEnabled=!1,Laya.timer.clear(this,this.hide),Laya.timer.clear(this,this.enable),this.ui.dialog.visible=!0,this.ui.tfWords.text=t.ServentConst.getWords(this.owner),Laya.timer.once(4e3,this,this.hide),Laya.timer.once(2e3,this,this.enable),this.qqAni.on(Laya.Event.STOPPED,this,this.onWorkEnd),this.qqAni.play(this.getActName(this.data.idx,1),!1)},i.prototype.onWorkEnd=function(){this.qqAni.off(Laya.Event.STOPPED,this,this.onWorkEnd),this.qqAni.play(this.getActName(this.data.idx,0),!0)},i.prototype.enable=function(){this.ui.roleBox.mouseEnabled=!0},i.prototype.hide=function(){this.ui.dialog.visible=!1},i.prototype.stopSay=function(){this.ui.dialog.visible=!1,Laya.timer.clear(this,this.hide),Laya.timer.clear(this,this.enable)},i.prototype.breathe=function(){this.data.rob_cash>0?this.qqAni.play(this.getActName(this.data.idx,2),!0):this.qqAni.play(this.getActName(this.data.idx,0),!0)},i.prototype.getActName=function(t,e){switch(t){case 0:return 0==e?"caijian":1==e?"caijian_work":"shengeukelian";case 1:return 0==e?"saodi":1==e?"saodi_work":"shengeukelian3";case 2:return 0==e?"caijian":1==e?"caijian_work":"shengeukelian";case 3:return 0==e?"duancha":1==e?"duancha_work":"shengeukelian2"}},i.prototype.act=function(t,e){null!=t&&""!=t&&(this.times=0,this.qqAni.on(Laya.Event.STOPPED,this,this.onPlayActEnd),this.qqAni.play(this.getActName(this.data.idx,1),!1),this.qqAni.playbackRate(2)),null!=e&&""!=e&&(this.ui.dialog.visible=!0,this.ui.tfWords.text=e,Laya.timer.once(3e3,this,this.hide))},i.prototype.onPlayActEnd=function(){this.times++,3==this.times?(this.qqAni.off(Laya.Event.STOPPED,this,this.onPlayActEnd),this.qqAni.visible=!0,this.qqAni.playbackRate(1),this.breathe()):this.qqAni.play(this.getActName(this.data.idx,1),!1)},i.prototype.onCutDown=function(){this.data.left_time<1?Laya.timer.clear(this,this.onCutDown):(this.data.left_time--,this.setTime())},i.prototype.setTime=function(){var t=Math.floor(this.data.left_time/3600),e=this.data.left_time%3600,i=Math.floor(e/60),s=e%60;this.ui.tfTime.text=t+":"+(10>i?"0"+i:i)+":"+(10>s?"0"+s:s)},i.prototype.destroy=function(){Laya.timer.clear(this,this.figuireMovie),Laya.timer.clear(this,this.hide),Laya.timer.clear(this,this.enable),Laya.timer.clear(this,this.onCutDown),this.qqAni&&(this.qqAni.destroy(),this.qqAni=null),this.effectAni&&(this.effectAni.destroy(),this.effectAni=null),this.ui=null},i}(),s=function(){function t(t,e){this.ui=t,this._id=e;for(var i=1;3>=i;i++)this["_rc"+i]=new n(this.ui.getChildByName("item"+i),this._id)}return t.prototype.show=function(t){this._talks=t;for(var e=[],i=[],s=[],n=0;n<this._talks.length;n++)n%3==0&&e.push(this._talks[n]),n%3==1&&i.push(this._talks[n]),n%3==2&&s.push(this._talks[n]);e.length>0?this._rc1.play(e):this._rc1.hide(),i.length>0?Laya.timer.once(2e3,this,this.play2,[i]):this._rc2.hide(),s.length>0?Laya.timer.once(4e3,this,this.play3,[s]):this._rc3.hide(),this.ui.visible=!0},t.prototype.play2=function(t){this._rc2.play(t)},t.prototype.play3=function(t){this._rc3.play(t)},t.prototype.clear=function(){Laya.timer.clear(this,this.play2),Laya.timer.clear(this,this.play3),this._rc1&&this._rc1.clear(),this._rc2&&this._rc2.clear(),this._rc3&&this._rc3.clear()},t.prototype.hide=function(){this.ui.visible=!1},t}(),n=function(){function t(t,e){this.index=0,this._display=t,this._display.tfRace.style.fontFamily="黑体",this._display.tfRace.scrollRect=new Laya.Rectangle(0,0,563,28),this._display.tfRace.style.fontSize=24,this._display.tfRace.style.wordWrap=!1,this._display.tfRace.style.color=1==e?"#fff836":"#c82701",this._display.tfRace.style.stroke=2,this._display.tfRace.style.valign="top"}return t.prototype.play=function(t){t.length>0&&(this._arr=t,this.index=0,this.playRace(this._arr[0].text),this._display.visible=!0)},t.prototype.hide=function(){this._display.visible=!1},t.prototype.playRace=function(t){this._display.tfRace.innerHTML=t,this._display.tfRace.width=this._display.tfRace.contextWidth,this._display.tfRace.scrollRect.x=-563,Laya.timer.frameLoop(1,this,this.startRaceRun)},t.prototype.startRaceRun=function(){this._display.tfRace.scrollRect.x+=2,this._display.tfRace.width-this._display.tfRace.scrollRect.x<0&&(this.index++,this._arr&&this.playRace(this._arr[this.index%this._arr.length].text))},t.prototype.clear=function(){Laya.timer.clear(this,this.startRaceRun),this._arr=null,this.index=0},t}()}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.set.ExchangeCodeUI,!0,!0),this._display=this.skin,this.setCloseButton(this._display.boxClose),this._display.confirmBtn.on(Laya.Event.CLICK,this,this.onClickConfirm)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.onShowed=function(){e.prototype.onShowed.call(this)},i.prototype.onHided=function(){e.prototype.onHided.call(this)},i.prototype.onClickConfirm=function(){""!=this._display.inputTxt.text?t.XHR().Post({cmd:"secret",op:"award",token:this._display.inputTxt.text},this,this.onDataRet):t.WeakTips.show("请输入兑换码")},i.prototype.onDataRet=function(e){0==e.result?t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0)):t.WeakTips.show(e.msg)},i}(t.BaseBox);t.ExchangeCodeView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.set.RetrenchModeSetUI,!0,!1),this._display=this.skin,this.setCloseButton(this._display.closeBtn),this._display.modeSlider.disabled=!0,this._display.btn_left.on(Laya.Event.CLICK,this,this.onClickBtn),this._display.btn_right.on(Laya.Event.CLICK,this,this.onClickBtn),this.setRetrenchView(t.RetrenchMode.singleton.isRetrech,!1),1==t.NetEvn.singleton.isWifi?(this._display.modeSlider.mouseEnabled=!1,this._display.modeSlider.gray=!0):(this._display.modeSlider.mouseEnabled=!0,this._display.modeSlider.gray=!1);var i="";i+="1、精简模式下不加载音乐\n",i+="2、精简模式下战斗动画将会简化，但不影响流程战斗和结构战斗\n",i+="3、精简模式下的动画效果会大幅度降低\n",i+="4、当游戏的网络环境切换wifi时，游戏会恢复正常\n",this._display.tf_desc.text=i}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.onClickBtn=function(e){switch(e.target.name){case"modeBar":this._display.modeSlider.value>50?(this.setRetrenchView(!0),t.RetrenchMode.singleton.retrench=t.RetrenchMode.TYPE_RETRENCH_TRUE):this._display.modeSlider.value<=50&&(this.setRetrenchView(!1),t.RetrenchMode.singleton.retrench=t.RetrenchMode.TYPE_RETRENCH_FALSE);break;case"btn_right":this.setRetrenchView(!0),t.RetrenchMode.singleton.retrench=t.RetrenchMode.TYPE_RETRENCH_TRUE;break;case"btn_left":this.setRetrenchView(!1),t.RetrenchMode.singleton.retrench=t.RetrenchMode.TYPE_RETRENCH_FALSE}},i.prototype.setRetrenchView=function(e,i){void 0===i&&(i=!0),e?(this._display.modeBar.value=1,this._display.modeSlider.value=100,i&&t.WeakTips.show("已切换到精简模式")):(this._display.modeBar.value=0,this._display.modeSlider.value=0)},i}(t.BaseBox);t.RetrenchModeView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"SetCommand":this._setView||(this._setView=new t.SetView),this._setView.on(t.ViewEvent.BOX_HIDE,this,this.onClosePanel),this._setView.show();break;case"ExchangeCodeCommand":var i=new t.ExchangeCodeView;i.show()}},s.prototype.onClosePanel=function(){this._setView&&(this._setView.off(t.ViewEvent.BOX_HIDE,this,this.onClosePanel),Loader.clearRes("ui/set/bg.jpg"))},s.prototype.getPluginName=function(){return e.PLUGIN_SET},s}(t.Plugin);t.SetModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.set.SetUI,!0,!1),this._display=this.skin,this._display.back.di.visible=!1,this.setCloseButton(this._display.closeBtn),this._display.musicSlider.disabled=!0,this._display.musicSlider.gray=!1,this._display.soundSlider.disabled=!0,this._display.soundSlider.gray=!1,this._display.musicSlider.changeHandler=Handler.create(this,this.onMusicChange,null,!1),this._display.soundSlider.changeHandler=Handler.create(this,this.onSoundChange,null,!1),this._display.musicUp.on(Laya.Event.CLICK,this,this.onClickBtn),this._display.musicDown.on(Laya.Event.CLICK,this,this.onClickBtn),this._display.soundUp.on(Laya.Event.CLICK,this,this.onClickBtn),this._display.soundDown.on(Laya.Event.CLICK,this,this.onClickBtn),this._display.musicBar.on(Laya.Event.CLICK,this,this.onClickBtn),this._display.soundBar.on(Laya.Event.CLICK,this,this.onClickBtn),this._display.noticeBtn.on(Laya.Event.CLICK,this,this.onClickButtons),this._display.exchangeBtn.on(Laya.Event.CLICK,this,this.onClickButtons),this._display.retrenchBtn.on(Laya.Event.CLICK,this,this.onClickButtons),this._display.kefuBtn.on(Laya.Event.CLICK,this,this.onClickButtons),this._display.tips.on(Laya.Event.CLICK,this,this.onClickTips),this._display.verText.text=window.hasOwnProperty("__last_version")?"版本号："+window.__last_version:"",Browser.onIOS&&(this._display.tipsTxt.y-=4),t.Global.isWXAPP&&(t.Util.toGrayAndDisabled(this._display.kefuBtn),this._display.tips.visible=!1)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.onShowed=function(){e.prototype.onShowed.call(this),this.resetImageSkin(this._display),this.updatePanel()},i.prototype.onHided=function(){var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);i.musicVol=this._display.musicSlider.value+1,i.soundVol=this._display.soundSlider.value+1,e.prototype.onHided.call(this)},i.prototype.updatePanel=function(){var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);this._display.musicSlider.value=e.musicVol-1,this._display.soundSlider.value=e.soundVol-1,1==t.RetrenchMode.running?(this._display.retrenchBtn.gray=!1,this._display.retrenchBtn.mouseEnabled=!0):(this._display.retrenchBtn.gray=!0,this._display.retrenchBtn.mouseEnabled=!1)},i.prototype.onMusicChange=function(e){this._display.musicBar.value=e/100;var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);i.musicVol=this._display.musicSlider.value+1,t.dispatch(t.MainView.MAIN_VIEW_SOUND)},i.prototype.onSoundChange=function(t){this._display.soundBar.value=t/100},i.prototype.onClickBtn=function(t){switch(t.target.name){case"musicUp":this._display.musicSlider.value=100;break;case"musicDown":this._display.musicSlider.value=0;break;case"soundUp":this._display.soundSlider.value=100;break;case"soundDown":this._display.soundSlider.value=0;break;case"musicBar":0==this._display.musicSlider.value?this._display.musicSlider.value=100:100==this._display.musicSlider.value&&(this._display.musicSlider.value=0);break;case"soundBar":this._display.soundSlider.value<=50?this._display.soundSlider.value=100:this._display.soundSlider.value>50&&(this._display.soundSlider.value=0)}},i.prototype.onClickButtons=function(e){switch(e.target.name){case"noticeBtn":t.Facade.callCommand(new t.OpenNoticeCommand(""));break;case"exchangeBtn":t.Facade.callCommand(new t.ExchangeCodeCommand);break;case"retrenchBtn":var i=new t.RetrenchModeView;i.show();break;case"kefuBtn":var s=t.Global.isWX?"https://kf.qq.com/touch/product/qmdld_mp.html":"https://kf.qq.com/touch/product/qmdld_qqmp.html";t.H5SDK.openWindow(s)}},i.prototype.onClickTips=function(){t.JSUtils.openUrlBox("https://game.qq.com/contract.shtml")},i}(t.BaseBox);t.SetView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,new ui.share.ShareAlertUI,!0,!0),this._display=this.skin,this.setCloseButton(this._display.closeBtn),this._display.cancelBtn.on(Laya.Event.CLICK,this,this.hide),this._display.sendBtn.on(Laya.Event.CLICK,this,this.onSend),this._curData=t,this.update()}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.update=function(){1==this._curData.alertType?(this._display.img.graphics.clear(),this._display.img.loadImage(t.ResPath().getShareBg("npc1",".png")),this._display.img.x=453,this._display.img.y=224,this._display.contentTxt.text="看来你还是有点厉害嘛！赶紧去通知一下你的斗友吧！"):2==this._curData.alertType?(this._display.img.graphics.clear(),this._display.img.loadImage(t.ResPath().getShareBg("npc2",".png")),this._display.img.x=366,this._display.img.y=220,this._display.contentTxt.text="人多力量大~朋友多了路好走！赶紧向你的好友求助吧~"):10==this._curData.alertType?(this._display.img.graphics.clear(),this._display.img.loadImage(t.ResPath().getShareBg("npc1",".png")),this._display.img.x=453,this._display.img.y=224,this._display.contentTxt.text="确认要发送微信消息给好友吗？"):(this._display.img.graphics.clear(),this._display.img.loadImage(t.ResPath().getShareBg("npc1",".png")),this._display.img.x=453,this._display.img.y=224,this._display.contentTxt.text="确认要发送微信消息给好友吗？")},i.prototype.onSend=function(){t.dispatch(t.ShareModule.SHARE_MODULE_SEND_MSG_EVENT,this._curData),this.hide()},i}(t.BaseBox);t.ShareAlertView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(t){e.call(this,new ui.share.ShareFriendUI,!0,!0),this._display=this.skin,this.setCloseButton(this._display.back.closeBtn),this._curData=t,this._display.list.itemRender=i,this._display.list.scrollBar.visible=!1,this._display.list.scrollBar.elasticDistance=100,this._display.list.renderHandler=new Handler(this,this.onListRender),this._display.list.array=[],this._display.sendBtn.on(Laya.Event.CLICK,this,this.onSend)}return __extends(s,e),s.prototype.destroy=function(){t.removeListener(s.SHARE_FRIEND_VIEW_SELECTED_EVENT,this,this.onSelect),e.prototype.destroy.call(this)},s.prototype.onShowed=function(){this._curIndex=-1,t.addListener(s.SHARE_FRIEND_VIEW_SELECTED_EVENT,this,this.onSelect),e.prototype.onShowed.call(this),t.XHR().Post({cmd:"sns",op:"query",needreload:"1",type:0},this,this.onFriendDataResult,!0)},s.prototype.onFriendDataResult=function(e){0==e.result?(e.friendlist=e.friendlist.filter(this.arrFilter),e.friendlist.sort(this.lisSortCompare),this._display.list.array=e.friendlist):t.WeakTips.show(e.msg)},s.prototype.arrFilter=function(e){var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL).uid;return e.uid!=i},s.prototype.lisSortCompare=function(t,e){var i=t.level,s=e.level;if(i>s)return-1;if(s>i)return 1;var n=t.power,a=e.power;return n>a?-1:a>n?1:0},s.prototype.onListRender=function(t,e){t.setData(this._display.list.getItem(e),e)},s.prototype.onSelect=function(t){this._curIndex=t},s.prototype.onSend=function(){this._curIndex>=0?(this._curData.uid=this._display.list.getItem(this._curIndex).uid,t.ShareModule.shareMessage(this._curData,null,t.ShareModule.shareType)):t.WeakTips.show("请选择好友")},s.SHARE_FRIEND_VIEW_SELECTED_EVENT="SHARE_FRIEND_VIEW_SELECTED_EVENT",s}(t.BaseBox);t.ShareFriendView=e;var i=function(i){function s(){i.call(this),this.selectIcon.visible=!1,this.on(Laya.Event.CLICK,this,this.onClick),t.addListener(e.SHARE_FRIEND_VIEW_SELECTED_EVENT,this,this.onSelect)}return __extends(s,i),s.prototype.destroy=function(){t.removeListener(e.SHARE_FRIEND_VIEW_SELECTED_EVENT,this,this.onSelect),i.prototype.destroy.call(this)},s.prototype.setData=function(e,i){if(e){this._index=i,""!=e.headimgurl?this.head.skin=t.JSUtils.getHeadUrl(e.headimgurl):1==e.sex?this.head.skin="ui/sharefriend/male.png":this.head.skin="ui/sharefriend/female.png",this.levelTxt.text=e.level+"",this.nameTxt.text=e.name;var s=t.SelfInfo.getTitle(e.level);this.titleTxt.color=s.color,this.titleTxt.text=s.text,this.fightTxt.text=""+e.power}},s.prototype.onClick=function(){t.dispatch(e.SHARE_FRIEND_VIEW_SELECTED_EVENT,this._index)},s.prototype.onSelect=function(t){this._index==t?this.selectIcon.visible=!0:this.selectIcon.visible=!1},s}(ui.share.ShareFriendItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i){e.call(this,new ui.share.ShareLilianUI,!0,!0),this._display=this.skin,this.setCloseButton(this._display.closeBtn),this._curData=i,t.Global.isWXAPP?this._display.bg.skin=t.Global.ResPath+t.ResourcePath.PATH_HANDBOOK_LILIANSTORY+"wxapp/"+i.bg+".jpg":this._display.bg.skin=t.Global.ResPath+t.ResourcePath.PATH_HANDBOOK_LILIANSTORY+i.bg+".jpg",this._display.friendBtn.on(Laya.Event.CLICK,this,this.shareFriend),this._display.spaceBtn.on(Laya.Event.CLICK,this,this.shareSpace),this._display.shareBtn.on(Laya.Event.CLICK,this,this.share),this._display.spaceBtn.visible=!1,this._display.friendBtn.visible=!1,this._display.shareBtn.visible=!0,this._awarded=!0,this._display.rewardTips.visible=!1,t.Facade.callCommand(new t.GetHandbookAwardStatusCommand(t.HandbookType.LILIANG,this._curData.id,0,Handler.create(this,this.onStatusBack)))}return __extends(i,e),i.prototype.onStatusBack=function(t){this._curData.id<=14?(this._awarded=1==t,this._display.rewardTips.visible=!this._awarded):(this._awarded=!0,this._display.rewardTips.visible=!1)},i.prototype.destroy=function(){this._display.friendBtn.off(Laya.Event.CLICK,this,this.shareFriend),this._display.spaceBtn.off(Laya.Event.CLICK,this,this.shareSpace),this._curData=null,e.prototype.destroy.call(this),Laya.loader.clearRes("ui/share/bgbig.png"),Laya.loader.clearRes("ui/share/title.png"),Laya.loader.clearRes("res/atlas/ui/share.json"),Laya.loader.clearRes(this._display.bg.skin),this._display=null},i.prototype.shareSpace=function(){t.ShareModule.shareMessage({title:this._curData.title,desc:[this._curData.msg],share_type:1,image_url:this._curData.imgUrl,back:!0,tips:"好辛苦~终于通关啦！值得向好友们炫耀一下。",alertType:10},Handler.create(this,this.afterShare),13)},i.prototype.shareFriend=function(){t.ShareModule.shareMessage({title:this._curData.title,desc:[this._curData.msg],share_type:0,image_url:this._curData.imgUrl,back:!0,tips:"好辛苦~终于通关啦！值得向好友们炫耀一下。",alertType:10},Handler.create(this,this.afterShare),13)},i.prototype.share=function(){t.ShareModule.shareMessage({title:this._curData.title,desc:[this._curData.msg],share_type:0,image_url:this._curData.imgUrl,back:!0,tips:"好辛苦~终于通关啦！值得向好友们炫耀一下。",alertType:10},Handler.create(this,this.afterShare),13)},i.prototype.afterShare=function(t){0==t.retCode&&0==this._awarded&&this.award()},i.prototype.award=function(){this._curData&&t.XHR().Post({file:"petpk",cmd:"handbook",op:"award",type:t.HandbookType.LILIANG,id:this._curData.id,uid:t.Global.UID},this,this.afterAward)},i.prototype.afterAward=function(e){0==e.result?t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0,"分享奖励")):t.WeakTips.show(e.msg)},i}(t.BaseBox);t.ShareLilianView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(e){t.addListener(s.SHARE_MODULE_EVENT,this,this.onEvent),this._skillKeyMap={s_6_6:"s_6_6",s_2_10:"s_2_10",s_7_6:"s_7_6",s_16_6:"s_16_6",s_16_10:"s_16_10",s_10_6:"s_10_6",s_10_10:"s_10_10",s_11_6:"s_11_6",s_11_10:"s_11_10",s_8_6:"s_8_6",s_8_10:"s_8_10",s_13_6:"s_13_6",s_13_10:"s_13_10",s_14_6:"s_14_6",s_14_10:"s_14_10",s_15_6:"s_15_6",s_15_10:"s_15_10",s_54_6:"s_54_6",s_54_10:"s_54_10",s_9_6:"s_9_6",s_9_10:"s_9_10",s_57_6:"s_57_6",s_57_10:"s_57_10",s_3_6:"s_3_6",s_3_10:"s_3_10"},s.openIdMap={}},s.shareMessage=function(e,i,n){void 0===i&&(i=null),void 0===n&&(n=0),t.Global.isSQ&&Browser.onIOS&&Browser.onAndriod&&window.mqq&&mqq.compare("7.1.5")>=0&&(13==n||12==n)?s.shareShortCut(e.image_url?e.image_url:t.Global.protocol+"//res.ledou.qq.com/share_icon.png",i,n,e):t.Global.isWX?(s.showCallBack=i,s.shareType=n,s.shareWX(e,i)):(s.showCallBack=i,s.shareType=n,s.shareSQ(e,i))},s.shareWX=function(e,i){if(void 0===i&&(i=null),s.shareData.share_url=e.share_url?e.share_url:t.Global.protocol+"//res.ledou.qq.com/wxShare.html?pf="+t.Global.PF+"&appid="+t.Global.appID+"&invitor="+t.Global.UID+"&invite_openid="+t.Global.OPENID+"&from="+s.getFromParam(e)+"&share_from="+s.shareType,s.shareData.image_url=e.image_url?e.image_url:"http://res.ledou.qq.com/share_icon.png",s.shareData.imageUrl=e.image_url?e.image_url:"http://res.ledou.qq.com/share_icon.png",s.shareData.params={},e.command&&(s.shareData.params.command=e.command,s.shareData.share_url+="&command="+e.command),e.urlParam)for(var n=0;n<e.urlParam.length;n++)s.shareData.share_url+="&"+e.urlParam[n].key+"="+e.urlParam[n].value,
s.shareData.params[e.urlParam[n].key]=e.urlParam[n].value;if(s.shareData.share_type=e.share_type?e.share_type:0,s.shareData.title=e.title?s.getRandomStr(e.title):t.Global.GameName,s.shareData.desc=e.desc?s.getRandomStr(e.desc):t.Global.GameName,s.shareData.sourceName=e.sourceName?e.sourceName:t.Global.GameName,s.shareData.back=e.back?e.back:!0,s.shareData.toUin=e.toUin?e.toUin:void 0,s.shareData.uinType=e.uinType?e.uinType:void 0,s.shareData.param=e.param?e.param:0,s.shareData.param2=e.param2?e.param2:0,s.shareData.serviceID=e.serviceID?e.serviceID:0,e.uid){t.addListener(s.SHARE_MODULE_SEND_MSG_EVENT,this,s.onSureSend);var a=new t.ShareFriendCommand("alert");a.data=e,t.Facade.callCommand(a)}else{var o=new t.ShareWeixinCommand;o.data=s.shareData,t.Facade.callCommand(o)}},s.onSureSend=function(e){t.removeListener(s.SHARE_MODULE_SEND_MSG_EVENT,this,s.onSureSend),s.openIdMap[e.uid]?(s.shareData.f_openid=s.openIdMap[e.uid].openid,s.shareData.toUin=s.openIdMap[e.uid].uin,s.shareData.shareType=s.shareType,t.H5SDK.shareMessage(s.shareData,s.calllBackFun)):t.XHR().Post({cmd:"detail",op:"simple",puid:e.uid},this,s.onQueryOpenId)},s.shareSQ=function(e,i){void 0===i&&(i=null);var n="https://res.ledou.qq.com/GameShare.html",a=t.Global.isSQ?s.getFromParam(e):305;if(s.shareData.share_url=e.share_url?e.share_url:n+"?_wv=2147674919&pf="+t.Global.PF+"&invitor="+t.Global.UID+"&invite_openid="+t.Global.OPENID+"&from="+a+"&share_from="+s.shareType,s.shareData.image_url=e.image_url?e.image_url:t.Global.protocol+"//res.ledou.qq.com/share_icon.png",s.shareData.imageUrl=e.image_url?e.image_url:t.Global.protocol+"//res.ledou.qq.com/share_icon.png",e.command&&(s.shareData.share_url+="&command="+e.command),e.urlParam)for(var o=0;o<e.urlParam.length;o++)s.shareData.share_url+="&"+e.urlParam[o].key+"="+e.urlParam[o].value;s.shareData.share_type=e.share_type?e.share_type:0,s.shareData.title=e.title?s.getRandomStr(e.title):t.Global.GameName,s.shareData.desc=e.desc?s.getRandomStr(e.desc):t.Global.GameName,s.shareData.sourceName=e.sourceName?e.sourceName:t.Global.GameName,s.shareData.back=e.back?e.back:!0,s.shareData.toUin=e.toUin?e.toUin:void 0,s.shareData.uinType=e.uinType?e.uinType:void 0,s.shareData.param=e.param?e.param:0,s.shareData.param2=e.param2?e.param2:0,s.shareData.serviceID=e.serviceID?e.serviceID:0,e.uid?s.openIdMap[e.uid]?(s.shareData.f_openid=s.openIdMap[e.uid],s.shareData.shareType=s.shareType,t.H5SDK.shareMessage(s.shareData,s.calllBackFun)):t.XHR().Post({cmd:"detail",op:"simple",puid:e.uid},this,s.onQueryOpenId):(s.shareData.f_openid=null,t.H5SDK.shareMessage(s.shareData,s.calllBackFun))},s.onQueryOpenId=function(e){0==e.result?(s.openIdMap[e.uid]={openid:e.openid,uin:e.uin},s.shareData.f_openid=e.openid,s.shareData.toUin=e.uin,s.shareData.shareType=s.shareType,t.H5SDK.shareMessage(s.shareData,s.calllBackFun)):t.WeakTips.show("分享失败")},s.shareSQMenu=function(e,i,n){void 0===i&&(i=null),void 0===n&&(n=0),window.mqq?(s.showCallBack=i,s.shareType=n,t.H5SDK.ShareConf.image_url="http://res.ledou.qq.com/share_icon.png",t.H5SDK.ShareConf.title="全民大乐斗",t.H5SDK.ShareConf.desc=e.desc[0],t.H5SDK.ShareConf.share_url=e.share_url,t.H5SDK.setShareInfo(t.H5SDK.ShareConf),mqq.invoke("ui","showShareMenu")):this.shareMessage(e,i,n)},s.sharePicture=function(e,i,n,a){void 0===n&&(n=null),void 0===a&&(a=0),s.shareType=a,s.showCallBack=n,t.JSUtils.sharePicture(e,i,s.pictureCallBack)},s.pictureCallBack=function(e){s.showCallBack&&(s.showCallBack.runWith({retCode:e}),s.showCallBack=null),0==e&&t.Report.shareReport(s.shareType)},s.calllBackFun=function(e){s.showCallBack&&(s.showCallBack.runWith(e),s.showCallBack=null),!e||0!=e.iRet&&0!=e.retCode||(t.Global.isWX&&t.WeakTips.show("您的消息已发送成功啦！"),t.Report.shareReport(s.shareType,"",s.shareData.param,s.shareData.param2),s.shareType=0)},s.getRandomStr=function(e){return e.length>0?1==e.length?e[0]:e[Math.floor(Math.random()*e.length)]:t.Global.GameName},s.shareShortCut=function(e,i,n,a){s.screenShortCutHandler=i,s.shareType=n,s.shareData.param=a.param,s.shareData.param2=a.param2,s.screenImg||(s.screenImg=new Laya.Image),s.screenImg.width=t.LayerMgr.width,s.screenImg.height=t.LayerMgr.clientHeight,s.screenImg.skin=e,Laya.stage.addChild(s.screenImg),Laya.timer.once(800,s,s.setImgEvent),Laya.timer.once(800,this,t.JSUtils.shareScreenshot,[t.Global.GameName+"图片分享",s.shareScreenCallBack,s])},s.setImgEvent=function(){s.screenImg||s.screenImg.on(Laya.Event.CLICK,s,s.clickScreenImg)},s.shareScreenCallBack=function(e){s.clickScreenImg(),e&&1==e.resultCode?(t.Report.shareReport(s.shareType,"",s.shareData.param,s.shareData.param2),s.screenShortCutHandler&&(s.screenShortCutHandler.runWith({retCode:0}),s.screenShortCutHandler=null)):s.screenShortCutHandler&&(s.screenShortCutHandler.runWith({retCode:1,msg:"分享失败"}),s.screenShortCutHandler=null),s.shareType=0},s.clickScreenImg=function(){s.screenImg&&(s.screenImg.off(Laya.Event.CLICK,s,s.clickScreenImg),s.screenImg.destroy(),s.screenImg=null)},s.getFromParam=function(t){return 1==t.share_type?4:1},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"ShareCommand":switch(this._curData.type){case 1:this.showWeaponAndSkillShare(this._curData);break;case 2:t.Global.isWX||this.selfShow(this._curData);break;case 3:this.channelsShare(this._curData);break;case 4:this.lilianShare(this._curData);break;case 100:this.signShare();break;case 101:this.rechargeShare(this._curData.id)}break;case"ShareFriendCommand":if("friend"==e.type){var i=new t.ShareFriendView(e.data);i.show()}else{var i=new t.ShareAlertView(e.data);i.show(t.Layer.TIP)}break;case"ShareWeixinCommand":this._weixinShare||(this._weixinShare=new t.ShareWeixin),this._weixinShare.show(t.Layer.LV_UP),this._weixinShare.setInfo(e.data);break;case"WBGiftCmd":this.getWbGift(e.id);break;case"ShareWBCommand":var s=new t.ShareWB;s.show();break;case"ShareSQCommand":var n=new t.ShareSQ;n.show()}},s.prototype.getWbGift=function(e){t.XHR().Post({file:"petpk",cmd:"wb_login",op:"award",id:e,uid:t.Global.UID},this,this.onGetWbGift)},s.prototype.onGetWbGift=function(e){var i=new t.WbGiftView(e);i.show()},s.prototype.onEvent=function(e){this._curData=e,t.Facade.callCommand(new t.ShareCommand)},s.prototype.showWeaponAndSkillShare=function(e){var i=e.data;if(!i||6!=i.level&&10!=i.level)Laya.loader.clearRes("ui/share/bgbig.png"),Laya.loader.clearRes("ui/share/title.png"),Laya.loader.clearRes("res/atlas/ui/share.json");else{var s;if(0==i.type){var n=6==i.level?5:6;s=new t.ShareView({title:["升星成功！"],bg:this.getWeaponUrlKey(i.id,i.level),msg:["本鹅的"+i.name+"一不小心就升级到"+i.level+"星了，似乎又腻害了不少呐~"],tips:"哎呀！一不小心本鹅的武器就升级到"+i.level+"星了~赶紧炫耀给小伙伴看看吧",sid:i.id,level:i.level,imgUrl:this.getImagePath(this.getWeaponUrlKey(i.id,i.level)),imgUrl_old:this.getImagePath(this.getWeaponUrlKey(i.id,i.level-1)),shareType:n})}else{var n=6==i.level?7:8;s=new t.ShareView({title:["升星成功！"],bg:this.getSkillUrlKey(i.id,i.level),msg:["失传已久的"+i.level+"星神功"+i.name+"现已被本鹅习得~ 感觉自己都要飞起来啦！"],tips:"哎呀！一不小心本鹅的技能就升级到"+i.level+"星了~赶紧炫耀给小伙伴看看吧",sid:i.id,level:i.level,imgUrl:this.getImagePath(this.getSkillUrlKey(i.id,i.level)),shareType:n})}s.show()}},s.prototype.selfShow=function(e){var i;i=new t.ShareView({bg:1,msg:"站如松，坐如钟，静如处子，动如脱兔~ 说的就是本鹅！",imgUrl:this.getImagePath(1)}),i.show()},s.prototype.channelsShare=function(e){var i=this.retrieveModel(t.ModelDef.GUIDE_MODEL);if(!i.isGuiding){var s;"Item"==e.dataType&&e.isRenshen?(s=new t.ShareView({title:["鹅妹子嘤"],bg:1,msg:["哦~ 天啊~ 瞅瞅本鹅挖出来的高丽参！要流鼻血啦！"],tips:"天了噜！瞅瞅本鹅挖到了啥宝贝~必须发送给好友们秀一秀!",imgUrl:this.getImagePath(1),shareType:10,param:6,param2:1}),s.show()):"Item"!=e.dataType&&5==e.quality&&(s=new t.ShareView({title:["鹅妹子嘤"],bg:2,msg:["突然觉得一股神秘之力让本鹅醍醐灌顶~"],tips:"经大师指点迷津~本鹅内力大幅提升，功力又增长了呢！通知一下我的伙伴们吧~",imgUrl:this.getImagePath(2),shareType:9,param:6,param2:2}),s.show())}},s.prototype.signShare=function(){var e=new t.ShareView({title:["全勤标兵"],bg:1,msg:["真是一只勤奋的鹅，本月签到一天不落，拿到了豪华全勤大奖！奖品是啥，快来看看吧~"],tips:"真是一只勤奋的鹅，本月签到一天不落，拿到了豪华全勤大奖！奖品是啥，快来看看吧~",imgUrl:this.getImagePath(1),shareType:100});e.show()},s.prototype.rechargeShare=function(e){var i=0==e?"赚了赚了":"赚大了",s=0==e?"60斗豆升到达人5，这是怎么办到的？快来围观吧":"120斗豆获得了传奇神器倚天剑！快来围观吧！",n=new t.ShareView({title:[i],bg:1,msg:[s],tips:s,imgUrl:this.getImagePath(1),shareType:101});n.show()},s.prototype.lilianShare=function(e){var i,s=[{},{bg:1,msg:"乐斗村：小桥流水人家，胖企鹅出村啦！本鹅成功通关乐斗村~可喜可贺！"},{bg:2,msg:"林松郊外：外面的世界很精彩，外面的世界很无奈。本鹅成功通关林松郊外~可喜可贺！"},{bg:3,msg:"林松城：小城故事多，充满喜和乐。本鹅成功通关林松城~可喜可贺！"},{bg:4,msg:"洞庭湖：洞庭西望楚江分，水尽南天不见云。本鹅成功通关洞庭湖~可喜可贺！"},{bg:5,msg:"摩云山：山不在高，有仙则名。本鹅成功通关摩云山~可喜可贺！"},{bg:6,msg:"东海龙宫：天地存玄机，田野隐龙宫。本鹅成功通关东海龙宫~可喜可贺！"},{bg:7,msg:"花果山：花果山，美猴王，本鹅乱入称霸王！本鹅成功通关花果山~可喜可贺！"},{bg:8,msg:"玉龙湿地：千回百转，险境丛生！本鹅成功通关玉龙湿地~可喜可贺！"},{bg:9,msg:"回声遗迹：真真假假，虚虚实实。本鹅成功通关回声遗迹~可喜可贺！"},{bg:10,msg:"黄沙漩涡：大漠孤烟直，长河落日圆。本鹅成功通关黄沙漩涡~可喜可贺！"},{bg:0,msg:""},{bg:0,msg:""},{bg:0,msg:""},{bg:0,msg:""},{bg:0,msg:""},{bg:0,msg:""},{bg:0,msg:""}],n=e.sceneId;i=new t.ShareLilianView({title:["毕业啦毕业啦！","有点腻害，又通过一关！","根本停不下来，一关又一关"],bg:s[n].bg,msg:s[n].msg,imgUrl:this.getImagePath2(s[n].bg),id:n}),i.show()},s.prototype.getImagePath=function(e){return t.Global.isWXAPP?t.Global.ResHost+"/"+t.ResVersionControl.handelVersionUrl(t.Global.ResPath+"share/wxappshare/"+e+".jpg"):t.Global.ResHost+"/"+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(e))},s.getWXAPPWeaponShareUrl=function(e,i){return i=6>i?1:10>i?6:10,t.Global.ResPath+"share/wxappshare/w_"+(e-2e5)+"_"+i+".jpg"},s.getWXAPPSkillShareUrl=function(e,i){return i=6>i?1:10>i?6:10,t.Global.ResPath+"share/wxappshare/s_"+(e-3e5)+"_"+i+".jpg"},s.prototype.getImagePath2=function(e){return t.Global.isWXAPP?t.Global.ResHost+"/"+t.ResVersionControl.handelVersionUrl("ledoures/"+t.ResourcePath.PATH_HANDBOOK_LILIANSTORY+"wxappshare/"+e+".jpg"):t.Global.ResHost+"/"+t.ResVersionControl.handelVersionUrl("ledoures/"+t.ResourcePath.PATH_HANDBOOK_LILIANSTORY+e+".jpg")},s.prototype.getWeaponUrlKey=function(t,e){return 33>=t-2e5?"w_"+(t-2e5)+"_"+e:"1"},s.prototype.getSkillUrlKey=function(t,e){var i="s_"+(t-3e5)+"_"+e;return i},s.prototype.getPluginName=function(){return e.PLUGIN_SHARE},s.SHARE_MODULE_EVENT="SHARE_MODULE_EVENT",s.SHARE_MODULE_SEND_MSG_EVENT="SHARE_MODULE_SEND_MSG_EVENT",s.shareData={},s.shareType=0,s.shareCode={INVITE_FRIEND:1,WIN_SHARE:2,TASD_HELP:3,REQUEST_TL:4,WEAPON_SIX:5,WEAPON_TEN:6,SKILL_SIX:7,SKILL_TEN:8,GET_NL:9,GET_RS:10,PIC_NPC:11,PIC_SCENE:12,PIC_STORY:13,PIC_WEAPON:14,PIC_SKILL:15,FIGHT_REPLAY:16,LVL_BEYOND:17,FB_BEYOND:18,TOWER_BEYOND:19,GET_WEAPON:20,GET_SKILL:21},s}(t.Plugin);t.ShareModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.share.ShareSQUI,!0,!0),this._display=this.skin,this.setCloseButton(this._display.closeBtn),this._display.shareBtn.on(Laya.Event.CLICK,this,this.shareSpace);t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);this._display.shareBtn.label="分   享",t.Util.enable(this._display.shareBtn),this.update()}return __extends(i,e),i.prototype.initShare=function(){t.H5SDK.ShareConf.image_url="http://res.ledou.qq.com/share_icon.png",t.H5SDK.ShareConf.title="全民大乐斗",t.H5SDK.ShareConf.desc="PK好友，统一武林，就来全民大乐斗！",t.H5SDK.ShareConf.share_url=location.protocol+"//res.ledou.qq.com/GameShare.html?_wv=2147674919&pf=sq&invitor=0&invite_openid=0&from=1&share_from=0",t.H5SDK.InitShare()},i.prototype.destroy=function(){Laya.loader.clearRes("ui/share/sqbg.jpg"),Laya.loader.clearRes("ui/share/title.png"),Laya.loader.clearRes("ui/share/3.jpg"),Laya.loader.clearRes("res/atlas/ui/share.json"),this.initShare(),e.prototype.destroy.call(this)},i.prototype.update=function(){t.XHR().Post({file:"petpk",cmd:"wb_share",op:"list",uid:t.Global.UID},this,this.init)},i.prototype.init=function(e){if(0==e.result&&e.award){for(var i,s=[{id:100006,icon_id:100006,num:1,name:"黄金卷轴",type:2,goods_type:1,effect_desc:"可强化技能和武器，增强战斗实力。",goods_desc:"金光闪闪的卷轴，似乎隐藏着什么修炼秘诀…",subid:3006,short_des:"",canabandon:0,canuse:1,target_url:"1005|0"},{id:100012,icon_id:100012,num:1,name:"小威望旗",type:3,goods_type:1,effect_desc:"使用获得600点威望。（每日最多可购买40个）",goods_desc:"小门派的旗子，有一定的号召力…",subid:7013,short_des:"",canabandon:0,canuse:1,target_url:""},{id:100003,icon_id:100002,num:1,name:"中体力药水",type:1,goods_type:1,effect_desc:"使用获得30体力，用于好友或斗友的切磋挑战。",goods_desc:"药师精心炼制，有安心宁神之效！",subid:1002,short_des:"",canabandon:0,canuse:1,target_url:""}],n=[],a=0;a<s.length;a++)i=s[a],n.push({goodsIcon:{skin:t.ResPath().getPic(i.icon_id,t.ResourcePath.PATH_GOODS)},goodsNum:"x"+i.num});this._display.giftList.array=n}},i.prototype.shareSpace=function(){var e="http://youxi.vip.qq.com/m/act/201709/zj/dld_225767.html?_wv=1&test="+t.Global.UIN;t.ShareModule.shareSQMenu({title:["全民大乐斗"],desc:["嗨，兄弟，乐斗宝箱与你共享"],share_type:1,image_url:"http://res.ledou.qq.com/share_icon.png",share_url:e,back:!0,tips:"",alertType:10},Handler.create(this,this.afterShare),13)},i.prototype.getImagePath=function(e){return t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(e))},i.prototype.afterShare=function(t){0==t.retCode&&this.award()},i.prototype.award=function(){t.XHR().Post({file:"petpk",cmd:"wb_share",op:"award",uid:t.Global.UID},this,this.afterAward)},i.prototype.afterAward=function(e){0==e.result?t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0)):t.WeakTips.show(e.msg)},i}(t.BaseBox);t.ShareSQ=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.utils.Tween,i=laya.utils.Ease,s=function(s){function n(e){s.call(this,new ui.share.ShareUI,!0,!0),this._display=this.skin,this.setCloseButton(this._display.closeBtn),this._curData=e,5==e.shareType||6==e.shareType?(this._display.skBox.scrollRect=new Laya.Rectangle(0,0,667,375),this._sk=new t.AnimationSKe(t.ResPath().getEffect("xingxing"),1),this._display.skBox.addChild(this._sk),this._sk.x=302,this._sk.y=375,this._display.wp.visible=!0,this._display.wp.skin=this.getIconPath(e.sid,6==e.level?0:6),Laya.loader.load(this.getIconPath1("w_"+e.sid,e.level),new Handler(this,this.onLoadCdImg))):(this._display.bg.skin=t.ResPath().getShareBg(e.bg),this._display.wp.visible=!1),this._display.spaceBtn.on(Laya.Event.CLICK,this,this.shareSpace),this._display.friendBtn.on(Laya.Event.CLICK,this,this.shareFriend),this._display.shareBtn.on(Laya.Event.CLICK,this,this.shareWeixin),t.Global.isWX||t.Global.isWXAPP?(this._display.spaceBtn.visible=!1,this._display.friendBtn.visible=!1,this._display.shareBtn.visible=!0):(this._display.spaceBtn.visible=!0,this._display.friendBtn.visible=!0,this._display.shareBtn.visible=!1),this._display.rewardTips.visible=!1,this.showRewardTips()}return __extends(n,s),n.prototype.onLoadCdImg=function(){this._cdWordTexture=Laya.loader.getRes(this.getIconPath1("w_"+this._curData.sid,this._curData.level)),this._sk.play(5==this._curData.shareType?"liuxing":"shixing",!1),this._sk.setSlotSkin(6==this._curData.level?"liuxing":"shixing",this._cdWordTexture),this._cdHelpImg=new Laya.Image,this._cdHelpImg.texture=this._cdWordTexture,this._cdHelpImg.x=-1e3,this._cdHelpImg.y=-1e3,this._display.addChild(this._cdHelpImg),Laya.timer.once(500,this,this.startWp)},n.prototype.startWp=function(){Laya.timer.once(500,this,this.changeWp),this._tween=e.to(this._display.wp,{alpha:.5,scaleX:0,scaleY:0},500,i.expoOut)},n.prototype.changeWp=function(){e.to(this._display.wp,{alpha:1,scaleX:1,scaleY:1},800,i.expoOut),this._display.wp.skin=this.getIconPath(this._curData.sid,this._curData.level)},n.prototype.getIconPath=function(e,i){return t.Global.ResPath+t.ResourcePath.PATH_WEAPON+"lv"+i+"/pic/"+e+".png"},n.prototype.getIconPath1=function(e,i){return t.Global.ResPath+t.ResourcePath.PATH_WEAPON+"lv"+i+"/pic/"+e+".png"},n.prototype.destroy=function(){s.prototype.destroy.call(this),Laya.timer.clear(this,this.changeWp),Laya.timer.clear(this,this.startWp),this._tween&&(this._tween.clear(),this._tween=null),this._cdHelpImg&&(this._cdHelpImg.destroy(),this._cdHelpImg=null),this._cdWordTexture&&(this._cdWordTexture.destroy(),this._cdWordTexture=null),Laya.loader.clearRes("ui/share/bgbig.png"),Laya.loader.clearRes("ui/share/title.png"),Laya.loader.clearRes("res/atlas/ui/share.json"),Laya.loader.clearRes(this._display.bg.skin)},n.prototype.onHided=function(){s.prototype.onHided.call(this),Laya.loader.clearRes("ui/share/bgbig.png"),Laya.loader.clearRes("ui/share/title.png"),Laya.loader.clearRes(this._display.bg.skin)},n.prototype.showRewardTips=function(){if(9==this._curData.shareType||10==this._curData.shareType){var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);9==this._curData.shareType&&0==e.getLongDataValue(t.ServerSetDataModel.KEY_FIRST_NEILI_REWARD)?this._display.rewardTips.visible=!0:10==this._curData.shareType&&0==e.getLongDataValue(t.ServerSetDataModel.KEY_FIRST_RENSHEN_REWARD)&&(this._display.rewardTips.visible=!0)}5!=this._curData.shareType&&6!=this._curData.shareType||t.Facade.callCommand(new t.GetHandbookAwardStatusCommand(t.HandbookType.WUQI,this._curData.sid,this._curData.level,Handler.create(this,this.onStatuBack))),7!=this._curData.shareType&&8!=this._curData.shareType||t.Facade.callCommand(new t.GetHandbookAwardStatusCommand(t.HandbookType.JINENG,this._curData.sid,this._curData.level,Handler.create(this,this.onStatuBack))),100!=this._curData.shareType&&101!=this._curData.shareType||(this._display.rewardTips.visible=!1)},n.prototype.shareSpace=function(){t.ShareModule.shareMessage({title:this._curData.title,desc:this._curData.msg,share_type:1,image_url:this._curData.imgUrl,param:this._curData.param,param2:this._curData.param2,back:!0},Handler.create(this,this.onCallBack),this._curData.shareType?this._curData.shareType:0)},n.prototype.shareFriend=function(){t.Global.isSQ&&Browser.onIOS&&Browser.onAndriod&&window.mqq&&mqq.compare&&mqq.compare("7.1.5")>=0?t.ShareModule.shareShortCut(this._display.bg.skin,Handler.create(this,this.onCallBack),this._curData.shareType?this._curData.shareType:0,this._curData):Browser.onIOS&&!t.Global.isWB&&mqq&&mqq.support("mqq.Qzone.sharePicture")?t.ShareModule.sharePicture(this._display.bg,0,Handler.create(this,this.onCallBack),this._curData.shareType?this._curData.shareType:0):t.ShareModule.shareMessage({title:this._curData.title,desc:this._curData.msg,share_type:0,image_url:this._curData.imgUrl,param:this._curData.param,param2:this._curData.param2,serviceID:113,back:!0},Handler.create(this,this.onCallBack),this._curData.shareType?this._curData.shareType:0)},n.prototype.shareWeixin=function(){t.ShareModule.shareMessage({title:this._curData.title,desc:this._curData.msg,share_type:1,image_url:this._curData.imgUrl,back:!0,tips:this._curData.tips,param:this._curData.param,param2:this._curData.param2,alertType:10},Handler.create(this,this.onCallBack),this._curData.shareType?this._curData.shareType:0)},n.prototype.onCallBack=function(e){if(0==e.retCode||0==e.iRet)if(9==this._curData.shareType||10==this._curData.shareType){var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);9==this._curData.shareType&&0==i.getLongDataValue(t.ServerSetDataModel.KEY_FIRST_NEILI_REWARD)?i.setLongDataValue(t.ServerSetDataModel.KEY_FIRST_NEILI_REWARD,1):10==this._curData.shareType&&0==i.getLongDataValue(t.ServerSetDataModel.KEY_FIRST_RENSHEN_REWARD)&&i.setLongDataValue(t.ServerSetDataModel.KEY_FIRST_RENSHEN_REWARD,1)}else if(5==this._curData.shareType||6==this._curData.shareType){var s=6==this._curData.level?this._curData.sid+"06":this._curData.sid+"10";t.XHR().Post({file:"petpk",cmd:"handbook",op:"award",type:t.HandbookType.WUQI,id:s},this,this.onAward)}else if(7==this._curData.shareType||8==this._curData.shareType){var s=6==this._curData.level?this._curData.sid+"06":this._curData.sid+"10";t.XHR().Post({file:"petpk",cmd:"handbook",op:"award",type:t.HandbookType.JINENG,id:s},this,this.onAward)}},n.prototype.onStatuBack=function(t){0==t&&(this._display.rewardTips.visible=!0)},n.prototype.onAward=function(e){0==e.result?t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0,"分享奖励")):t.WeakTips.show(e.msg)},n}(t.BaseBox);t.ShareView=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.share.ShareWBUI,!0,!0),this.strArr=[{title:"我萌吗？",content:"见过卖萌的企鹅，没有见过会武功的，来见识一下！"},{title:"出水芙蓉一朵花~",content:"听说这里的鹅妹纸很美，心花怒放啦！"},{title:"搞事情搞事情！",content:"一只拉帮结派的鹅，快来一起搞事情啦！"},{title:"我的freestyle",content:"现在的乐斗不提也罢！"}],this._display=this.skin,this.setCloseButton(this._display.closeBtn),this._display.shareBtn.on(Laya.Event.CLICK,this,this.shareSpace);var i=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);1==i.wbShare?(this._display.shareBtn.label="已分享",t.Util.toGrayAndDisabled(this._display.shareBtn)):(this._display.shareBtn.label="分   享",t.Util.enable(this._display.shareBtn)),this.update()}return __extends(i,e),i.prototype.destroy=function(){Laya.loader.clearRes("ui/share/bgbig.png"),Laya.loader.clearRes("ui/share/title.png"),Laya.loader.clearRes("ui/share/3.jpg"),Laya.loader.clearRes("res/atlas/ui/share.json"),e.prototype.destroy.call(this)},i.prototype.update=function(){t.XHR().Post({file:"petpk",cmd:"wb_share",op:"list",uid:t.Global.UID},this,this.init)},i.prototype.init=function(e){if(0==e.result&&e.award){var i,s=[];if(e.award.attrs)for(var n=0;n<e.award.attrs.length;n++)i=e.award.attrs[n],s.push({goodsIcon:{skin:t.ResPath().getPic(i.id,t.ResourcePath.PATH_GOODS)},goodsNum:"x"+i.num});if(e.award.items)for(var n=0;n<e.award.items.length;n++)i=e.award.items[n],s.push({goodsIcon:{skin:t.ResPath().getPic(i.icon_id,t.ResourcePath.PATH_GOODS)},goodsNum:"x"+i.num});this._display.giftList.array=s;var a=Math.min(4,s.length);this._display.giftList.x=444+(409-(100*a+3*(a-1)))/2,this._display.giftList.scrollBar.hide=!0}},i.prototype.shareSpace=function(){var e=Math.floor(4*Math.random()),i=Math.ceil(8*Math.random()),s=this.getImagePath("wb_"+i);t.ShareModule.shareMessage({title:[this.strArr[e].title],desc:[this.strArr[e].content],share_type:1,image_url:s,back:!0,tips:"",alertType:10},Handler.create(this,this.afterShare),13)},i.prototype.getImagePath=function(e){return t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(e))},i.prototype.afterShare=function(t){0==t.retCode&&this.award()},i.prototype.award=function(){t.XHR().Post({file:"petpk",cmd:"wb_share",op:"award",uid:t.Global.UID},this,this.afterAward)},i.prototype.afterAward=function(e){if(0==e.result){this._display.shareBtn.label="已分享",t.Util.toGrayAndDisabled(this._display.shareBtn),t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0));var i=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);i.wbShare=1,i.updateFinish()}else t.WeakTips.show(e.msg)},i}(t.BaseBox);t.ShareWB=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.share.ShareWeixinUI,!0,!1),this._display=this.skin,this.setCloseButton(this._display.back.closeBtn),this._isFirst=!0,Browser.onIOS?this._display.img.skin="ui/share/1_ios.jpg":this._display.img.skin="ui/share/1.jpg"}return __extends(i,e),i.prototype.onShowed=function(){e.prototype.onShowed.call(this),this._isFirst?this._isFirst=!1:this.resetImageSkin(this)},i.prototype.onHided=function(){e.prototype.onHided.call(this),Laya.loader.clearRes("res/atlas/ui/share.json"),Laya.loader.clearRes("ui/share/titleicon.jpg"),t.H5SDK.ShareConf.image_url="http://res.ledou.qq.com/share_icon.png",t.H5SDK.ShareConf.title="全民大乐斗",t.H5SDK.ShareConf.desc="PK好友，统一武林，就来欢乐全民大乐斗！",t.H5SDK.ShareConf.timelineTitle="PK好友，统一武林，就来欢乐全民大乐斗！",t.H5SDK.ShareConf.wx_share_url=location.protocol+"//res.ledou.qq.com/wxShare.html",t.H5SDK.ShareConf.params={},t.H5SDK.InitShare()},i.prototype.setInfo=function(e){t.H5SDK.ShareConf.image_url=e.image_url?e.image_url:"http://res.ledou.qq.com/share_icon.png",t.H5SDK.ShareConf.title=e.title,t.H5SDK.ShareConf.desc=e.desc,t.H5SDK.ShareConf.timelineTitle=e.desc,t.H5SDK.ShareConf.wx_share_url=e.share_url,t.H5SDK.ShareConf.params=e.params,t.H5SDK.InitShare()},i}(t.BaseBox);t.ShareWeixin=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,new ui.share.WbGiftUI,!0,!0),this._display=this.skin,this.setCloseButton(this._display.closeBtn),this.update(t)}return __extends(i,e),i.prototype.update=function(e){if(e.award){var i,s=[];if(e.award.attrs)for(var n=0;n<e.award.attrs.length;n++)i=e.award.attrs[n],s.push({goodsIcon:{skin:t.ResPath().getPic(i.id,t.ResourcePath.PATH_GOODS)},goodsNum:"x"+i.num});if(e.award.items)for(var n=0;n<e.award.items.length;n++)i=e.award.items[n],s.push({goodsIcon:{skin:t.ResPath().getPic(i.icon_id,t.ResourcePath.PATH_GOODS)},goodsNum:"x"+i.num});this._display.giftList.array=s,this._display.giftList.x=483+(409-(100*s.length+3*(s.length-1)))/2}e.hasOwnProperty("result")&&2==e.result?(this._display.title2.visible=!0,this._display.title1.visible=!1,this._display.titleTxt.text="已获得",this._display.contentTxt.text="今日已领取，请明天继续到玩吧礼包中心领取新的礼包。"):(this._display.title2.visible=!1,this._display.title1.visible=!0,this._display.titleTxt.text="恭喜你获得",this._display.contentTxt.text="请明天继续到玩吧礼包中心领取新的礼包。",t.Facade.callCommand(new t.SyncChangeCmd(e)))},i.prototype.destroy=function(){Laya.loader.clearRes("ui/share/bgbig.png"),Laya.loader.clearRes("ui/share/title.png"),Laya.loader.clearRes("ui/share/3.jpg"),t.dispatch(t.MainModule.OPENBOXEVENT),e.prototype.destroy.call(this)},i}(t.BaseBox);t.WbGiftView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(i,s){e.call(this,new ui.shop.BuyUI,!0,!0,!1,!1),this.goodsId=0,this.allPrice=0,this.moneyNum=0,this.progressLength=0,this.canBuyNum=0,this._buynum=0,this.display=this.skin,this.name="BuyBox",this.cmd=s,this.goodsData=i,this.userModel=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),3==s.type?this.moneyNum=this.userModel.winPoint:4==s.type?this.moneyNum=this.userModel.servantCash:5==s.type?this.moneyNum=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF).selfFactionUserModel.holePoint:6==s.type?this.moneyNum=this.userModel.kingMetal:this.moneyNum=this.userModel.cash,this.goodsId=i.id,this.init()}return __extends(i,e),i.prototype.init=function(){this.showDetail(),this.display.cancelBtn.on(laya.events.Event.CLICK,this,this.destroy),this.display.confirmBtn.on(laya.events.Event.CLICK,this,this.buyGoods),this.display.subBtn.on(laya.events.Event.MOUSE_DOWN,this,this.doBtnKeyDown,[-1]),this.display.addBtn.on(laya.events.Event.MOUSE_DOWN,this,this.doBtnKeyDown,[1]),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.doBtnKeyUp),this.display.numSlider.changeHandler=new Handler(this,this.onStartDrag),this.display.numSlider.showLabel=!1},i.prototype.showDetail=function(){this.canBuyNum=Math.floor(this.moneyNum/this.goodsData.price),this.canBuyNum=0==this.canBuyNum?1:this.canBuyNum,this.goodsData.hasOwnProperty("remain")&&this.goodsData.max_num>this.goodsData.remain&&(this.goodsData.max_num=this.goodsData.remain),this.goodsData.default_num=this.goodsData.default_num>this.canBuyNum?this.canBuyNum:this.goodsData.default_num,this.display.goodsName.text=this.goodsData.name,this.display.goodsPic.skin=t.ResPath().getPic(this.goodsData.iconId,t.ResourcePath.PATH_GOODS),this.display.goodsDesc.text=this.goodsData.goods_effect,this.goodsData.max_num=0==this.goodsData.max_num?1:this.goodsData.max_num,this.progressLength=this.display.numValue.width,this.display.numSlider.max=this.goodsData.max_num,this.setNum(this.cmd.count>1?this.cmd.count:this.goodsData.default_num)},i.prototype.initShopMgr=function(t){this.sMgr=t},i.prototype.doBtnKeyDown=function(t){this.numAdd(t),Laya.timer.loop(200,this,this.numAdd,[t])},i.prototype.doBtnKeyUp=function(){Laya.timer.clear(this,this.numAdd),this.destroyed||(this.display.subBtn.state=1,this.display.addBtn.state=1)},i.prototype.numAdd=function(t){var e=this.display.numSlider.value;e+=t,this.setNum(e)},i.prototype.setNum=function(e){var i;if(i=3==this.cmd.type?"胜点":4==this.cmd.type?"家财":5==this.cmd.type?"洞穴积分":6==this.cmd.type?"王者勋章":"斗鱼",e>this.canBuyNum){this._time||(this._time=Browser.now());var s=Browser.now();s-this._time>250&&(t.WeakTips.show("当前"+i+"不足，请确认后重试！"),this._time=s),e=this.canBuyNum}e=0==e?1:e,this.display.numSlider.value=e,e=this.display.numSlider.value,this.display.numValue.value=e/this.goodsData.max_num,this.allPrice=e*this.goodsData.price,this.display.subDetail.text="已选择"+e+"个，总价："+this.allPrice+i,this.display.numSlider.value=e},i.prototype.buyGoods=function(){this._buynum=this.display.numSlider.value;var e=this.allPrice,i=this.userModel.douyu,s=t.Facade.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL),n=s.getDailyDataValue(t.ServerSetDataModel.KEY_BUY_CONFIRM);if(console.log(n),this.cmd.type<=1&&e>i&&1!=n){var a=new t.ConfirmBoxData({isShowCancelBtn:!0,title:"支付提示",contentStr:"您当前正在使用"+i+"斗鱼+"+(e-i)+"斗豆购买"+this.goodsData.name+"*"+this._buynum+"？",callBackHandler:new Handler(this,this.buy)});t.PayConfirm.show(a)}else this.buy()},i.prototype.buy=function(){this._buynum=this.display.numSlider.value;var e=this.allPrice;this._buyid=this.goodsId+"",t.XHR().Post({cmd:"shop",subtype:"1",num:this._buynum,id:this._buyid,price:e},this,this.buyRet)},i.prototype.buyRet=function(e){this.destroyed||0!=e.result?t.WeakTips.show("购买失败，"+e.msg):(t.Facade.callCommand(new t.SyncChangeCmd(e,!0,!1,"购买物品")),this.cmd.num=this._buynum,this.cmd.ecode=0,this.cmd.finish(),this.sMgr&&this.sMgr.getShopGoods(this._buyid)&&(this.sMgr.getShopGoods(this._buyid).remain>=this._buynum?this.sMgr.getShopGoods(this._buyid).remain=this.sMgr.getShopGoods(this._buyid).remain-this._buynum:this.sMgr.getShopGoods(this._buyid).remain=0),this.destroy())},i.prototype.onStartDrag=function(t){this.setNum(t)},i.prototype.destroy=function(){this.cmd.off(),this.cmd=null,Laya.stage.off(Laya.Event.MOUSE_UP,this,this.doBtnKeyUp),e.prototype.destroy.call(this)},i}(t.BaseBox);t.Buy=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.shop.BuyUseUI,!0,!0,!1,!1),this.idList=[],this.allPrice=0,this.doudouNum=0,this.progressLength=0,this.leftMargin=0,this._isMouseDown=!1,this.display=this.skin,this.setCloseButton(this.display.back.btnClose),this.display.getList.renderHandler=new Handler(this,this.onListRender);var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.PACK_MODEL);i.on(t.ModelEvent.UPDATE_FINISH,this,this.load),this.leftMargin=this.display.getList.x,t.addListener("GetGoods_USE",this,this.eventToUse)}return __extends(s,e),s.prototype.init=function(t){this.idList=t.IDList,this.cmd=t,this.load()},s.prototype.load=function(){for(var e="",i=0;i<this.idList.length;i++)e+=this.idList[i]+"",i<this.idList.length-1&&(e+="|");var s={cmd:"limit",goodslist:e};t.XHR().Post(s,this,this.showData)},s.prototype.showData=function(e){this.destroyed||(this.goodsData=e.limit_info,this.display.getList.itemRender=i,t.Logger.log(this.goodsData),this.display.getList.x=this.leftMargin+30,this.goodsData&&this.goodsData.length>=3?(this.display.bg0.visible=!1,this.display.bg1.visible=!1,
this.display.bg2.visible=!1):(this.display.bg0.visible=!0,this.display.bg1.visible=!0,this.display.bg2.visible=!0),this.goodsData&&this.goodsData.length>0&&(this.display.getList.spaceX=Math.ceil(100/this.goodsData.length)),this.display.getList.array=this.goodsData)},s.prototype.onListRender=function(t,e){t.setData(this.display.getList.getItem(e),e,this.display.getList.selectedIndex==e)},s.prototype.eventToUse=function(t){this._useId=t,this._isMouseDown=!0,Laya.stage.on(Laya.Event.MOUSE_UP,this,this.mouseUpHandler),this.doUse()},s.prototype.doUse=function(){this._lastDoTime=Browser.now(),t.XHR().Post({file:"petpk",cmd:"storage",op:"use",uid:t.Global.UID,id:this._useId},this,this.doUseHandler)},s.prototype.doUseHandler=function(e){if(0==e.result){t.Facade.callCommand(new t.SyncChangeCmd(e));var i=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL).getItemCount(this._useId);if(i>0&&this._isMouseDown){var s=Browser.now(),n=s-this._lastDoTime;n>=200?(this._lastDoTime=s,this.doUse()):Laya.timer.once(200-n,this,this.doUse)}}else this._isMouseDown=!1,t.WeakTips.show("使用失败"+e.msg)},s.prototype.mouseUpHandler=function(){this._isMouseDown=!1,Laya.timer.clear(this,this.doUse),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.mouseUpHandler)},s.prototype.destroy=function(){this.mouseUpHandler();var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.PACK_MODEL);i.off(t.ModelEvent.UPDATE_FINISH,this,this.load),t.removeListener("GetGoods_USE",this,this.eventToUse),this.cmd.ecode=0,this.cmd.finish(),e.prototype.destroy.call(this)},s}(t.BaseBox);t.GetGoods=e;var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.destroy=function(){this._curData=null,this.buyBtn.off(Laya.Event.CLICK,this,this.clickBuy),this.buyBtn.off(Laya.Event.MOUSE_DOWN,this,this.mouseDownToUse),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.mouseUpHandler),e.prototype.destroy.call(this)},i.prototype.mouseDownToUse=function(){Laya.stage.on(Laya.Event.MOUSE_UP,this,this.mouseUpHandler),t.dispatch("GetGoods_USE",this._curData.Goods)},i.prototype.mouseUpHandler=function(){Laya.stage.off(Laya.Event.MOUSE_UP,this,this.mouseUpHandler),this.destroyed||(this.buyBtn.state=1)},i.prototype.setData=function(e,i,s){e&&(this.mouseEnabled=!0,t.Logger.log(e),this._curData=e,this._curIndex=i,this.goodsName.text=e.Name,this.goodsPic.skin="",this.price.text=e.Price+"",this.goodsInfo.text=e.EffectDesc,this.goodsPic.skin=t.ResPath().getPic(e.IconId,t.ResourcePath.PATH_GOODS),this.goodsNum.text=e.Num,e.Num>0?(this.priceBox.visible=!1,"unlimited"==e.limit?this.buyBtn.label="使 用":this.buyBtn.label="使 用("+e.limit+")",this.buyBtn.off(Laya.Event.CLICK,this,this.clickBuy),this.buyBtn.on(Laya.Event.MOUSE_DOWN,this,this.mouseDownToUse)):(this.priceBox.visible=!0,this.buyBtn.label="购  买",this.buyBtn.off(Laya.Event.MOUSE_DOWN,this,this.mouseDownToUse),this.buyBtn.on(Laya.Event.CLICK,this,this.clickBuy)))},i.prototype.clickBuy=function(){t.Facade.callCommand(new t.BuyCommand(this._curData.ShopId))},Object.defineProperty(i.prototype,"selected",{set:function(t){},enumerable:!0,configurable:!0}),i}(ui.shop.GetGoodsItemUI);t.GetGoodsItem=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(s){e.call(this,new ui.shop.ShopUI,!0,!0,!1,!1),this.goodsId=0,this.douNum=0,this.tabIndex=0,this.goodsIndex=0,this.display=this.skin,this.display.goodsList.itemRender=i,this.userModel=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),this.userModel.on(t.ModelEvent.UPDATE_FINISH,this,this.upDoudou),this.goodsList=s.commodity_info,this.douNum=this.userModel.doubi,this.init()}return __extends(s,e),s.prototype.init=function(){this.display.goodsList.selectEnable=!0,this.display.goodsList.array=[],this.display.doudouNum.text=this.douNum+"",this.display.douyuNum.text=this.userModel.douyu+"",this.display.doudouAdd.on(laya.events.Event.CLICK,this,this.addDoudou),this.setListData(this.goodsList),this.display.shopBg.on(laya.events.Event.CLICK,this,this.closeTips),this.display.goodsList.renderHandler=new Handler(this,this.onListRender),this.display.closeBtn.on(laya.events.Event.CLICK,this,this.destroy)},s.prototype.upDoudou=function(){this.douNum=this.userModel.doubi,this.display.doudouNum.text=this.douNum+"",this.display.douyuNum.text=this.userModel.douyu+""},s.prototype.setListData=function(t){this.display.goodsList.array=t},s.prototype.onListRender=function(t,e){t.setData(this.display.goodsList.getItem(e),e,this.display.goodsList.selectedIndex==e)},s.prototype.addDoudou=function(){t.Facade.callCommand(new t.OpenVipBoxCommand(1))},s.prototype.closeTips=function(){t.Tips.tipsClose()},s.prototype.destroy=function(){this.userModel.off(t.ModelEvent.UPDATE_FINISH,this,this.upDoudou),e.prototype.destroy.call(this)},s}(t.BaseBox);t.Shop=e;var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.destroy=function(){t.Tips.tipsClose(),e.prototype.destroy.call(this)},i.prototype.setData=function(e,i,s){e&&(this.mouseEnabled=!0,this._curData=e,this._curIndex=i,this.goodsName.text=e.name,this.goodsPic.skin="",this.mprice.text=e.price+"",this.goodsPic.skin=t.ResPath().getPic(e.iconId,t.ResourcePath.PATH_GOODS),this.goodsPic.on(Laya.Event.CLICK,this,this.clickTips),this.goodsBg.on(Laya.Event.CLICK,this,this.closeTips),this.buyBtn.on(Laya.Event.CLICK,this,this.clickBuy))},i.prototype.clickTips=function(){var e,i={};e=this.localToGlobal(new laya.maths.Point(0,0)),i.name=this._curData.name,i.desc=this._curData.goods_des,i.info=this._curData.goods_effect,t.Tips.show(i,e)},i.prototype.closeTips=function(){t.Tips.tipsClose()},i.prototype.clickBuy=function(){t.Tips.tipsClose(),t.Facade.callCommand(new t.BuyCommand(this._curData.id,1))},Object.defineProperty(i.prototype,"selected",{set:function(t){},enumerable:!0,configurable:!0}),i}(ui.shop.ShopGoodsItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(e){this.m_mgr=new t.ShopMgr},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"ShopCommand":this.getShopData(e);break;case"GetGoodsCommand":this.getGoods||(this.getGoods=new t.GetGoods),this.getGoods.init(e),this.getGoods.show(),this.getGoods.on(t.ViewEvent.BOX_HIDE,this,this.onClosePanel);break;case"BuyCommand":2==e.type?this.getWinShopData(e.GoodsId):this.getShopData(e);break;case"OpenWinShopCmd":this.getWinShopData(e.shoptype);break;case"WinShopBuyCmd":this.openBuyFromWinShop(e.goodsData,e.shoptype)}},s.prototype.getShopData=function(e){var i=this.m_mgr.GetShopData();this.shopModel=t.Facade.singleton.model.retrieveModel(t.ModelDef.SHOP_MODEL),i?this.process(e):t.XHR().Post({cmd:"shop",shoptype:1,needreload:"1"},this,function(i){0==i.result?(this.shopModel.items=i.commodity_info,this.m_mgr.SetShopData(i),this.process(e)):t.WeakTips.show(i.msg)})},s.prototype.process=function(e){var i=this.m_mgr.GetShopData();if("ShopCommand"==e.getCommandName())this.shopUI||(this.shopUI=new t.Shop(i)),this.shopUI.on(t.ViewEvent.BOX_HIDE,this,this.onClosePanel),this.shopUI.show(),e.ecode=0,e.finish();else{var s=e.GoodsId,n=this.m_mgr.getShopGoods(s),a=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL);if(1==e.type&&a.cash<n.price)t.WeakTips.show("您当前的货币不足啦~要不去充充值呀？菜菜爱你哟！");else{var o=new t.Buy(n,e);o.initShopMgr(this.m_mgr),o.show()}}},s.prototype.onClosePanel=function(){this.shopUI?(this.shopUI.off(t.ViewEvent.BOX_HIDE,this,this.onClosePanel),this.shopUI=null,this._winShop||this.unregisterPlugin()):this.getGoods&&(this.getGoods.off(t.ViewEvent.BOX_HIDE,this,this.onClosePanel),this.getGoods=null,this._winShop||this.shopUI||this.unregisterPlugin())},s.prototype.getWinShopData=function(e,i){void 0===e&&(e=3),void 0===i&&(i=0),this._winShopType=e,this._winShopId=i,t.XHR().Post({file:"petpk",cmd:"shop",shoptype:e,uid:t.Global.UID},this,this.getWinSHopDataHandler)},s.prototype.getWinSHopDataHandler=function(e){if(0==e.result)if(0==this._winShopId)this._winShop||(this._winShop=new t.WinShop(e,this._winShopType),this._winShop.on(t.ViewEvent.BOX_HIDE,this,this.onCloseWinShopPanel),this._winShop.show());else{for(var i,s=0;s<e.commodity_info.length;s++){var n=e.commodity_info[s];if(n.id==this._winShopId){i=n;break}}this.openBuyFromWinShop(i)}else{var a;switch(this._winShopType){case 3:a="胜点";break;case 4:a="家财";break;case 5:a="洞穴";break;case 6:a="排位赛"}t.WeakTips.show("查询"+a+"商店信息失败，"+e.msg)}},s.prototype.openBuyFromWinShop=function(e,i){if(void 0===i&&(i=3),e){var s,n=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL);switch(i){case 3:s=n.winPoint;break;case 4:s=n.servantCash;break;case 5:s=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF).selfFactionUserModel.holePoint;break;case 6:s=n.kingMetal}if(s<e.price){var a;switch(i){case 3:a="胜点";break;case 4:a="家财";break;case 5:a="洞穴积分";break;case 6:a="王者勋章"}t.WeakTips.show("当前"+a+"不足，请确认后重试！")}else{var o=new t.Buy(e,new t.BuyCommand(e.id,i));o.show()}}},s.prototype.onCloseWinShopPanel=function(){this._winShop&&(this._winShop.off(t.ViewEvent.BOX_HIDE,this,this.onCloseWinShopPanel),this._winShop=null,this.shopUI||this.unregisterPlugin())},s.prototype.getPluginName=function(){return e.PLUGIN_SHOP},s}(t.Plugin);t.ShopModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(s,n){e.call(this,new ui.shop.WinShopUI,!0,!0,!1,!1),this.shoptype=3,this.display=this.skin,this.setCloseButton(this.display.closeBtn),this.list=new laya.ui.List,this.list.vScrollBarSkin="ui/comp/vscroll.png",this.list.scrollBar.visible=!1,this.list.renderHandler=Handler.create(this,this.updateItem,null,!1),this.list.itemRender=i,this.display.addChild(this.list),this.list.height=533,this.list.x=258,this.list.y=138,this.list.repeatX=5,this.list.repeatY=3,this.list.spaceX=5,this.name="WinShop",this.shoptype=n,this.display.title_3.visible=3==this.shoptype,this.display.title_4.visible=4==this.shoptype,this.display.title_5.visible=5==this.shoptype,this.display.title_6.visible=6==this.shoptype,this.display.ico_3.visible=3==this.shoptype,this.display.ico_4.visible=4==this.shoptype,this.display.ico_5.visible=5==this.shoptype,this.display.ico_6.visible=6==this.shoptype;var a=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);a.on(t.ModelEvent.UPDATE_FINISH,this,this.modelUpdateHandler);var o=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);o.on(t.ModelEvent.UPDATE_FINISH,this,this.modelUpdateHandler),3==this.shoptype?this.display.winPointNum.text=String(a.winPoint):4==this.shoptype?this.display.winPointNum.text=String(a.servantCash):5==this.shoptype?this.display.winPointNum.text=String(t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF).selfFactionUserModel.holePoint):6==this.shoptype&&(this.display.winPointNum.text=String(a.kingMetal)),this.display.goShopBtn.on(Laya.Event.CLICK,this,this.goShop),this.display.goShopBtn.visible=3==this.shoptype,this.list.array=s.commodity_info}return __extends(s,e),s.prototype.modelUpdateHandler=function(){var e=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);3==this.shoptype?this.display.winPointNum.text=String(e.winPoint):4==this.shoptype?this.display.winPointNum.text=String(e.servantCash):5==this.shoptype?this.display.winPointNum.text=String(t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF).selfFactionUserModel.holePoint):6==this.shoptype&&(this.display.winPointNum.text=String(e.kingMetal)),t.XHR().Post({file:"petpk",cmd:"shop",shoptype:this.shoptype,uid:t.Global.UID},this,this.getWinSHopDataHandler)},s.prototype.getWinSHopDataHandler=function(e){if(this.destroyed||0!=e.result){var i;3==this.shoptype?i="胜点商店":4==this.shoptype?i="家财商城":5==this.shoptype?i="洞穴商城":6==this.shoptype&&(i="排位赛商城"),t.WeakTips.show("查询"+i+"信息失败，"+e.msg)}else this.list.array=e.commodity_info},s.prototype.updateItem=function(t,e){e<=this.list.array.length-1&&t.doRender(this.list.array[e],this.shoptype)},s.prototype.goShop=function(){t.Facade.callCommand(new t.ShopCommand)},s.prototype.destroy=function(){var i=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);i.off(t.ModelEvent.UPDATE_FINISH,this,this.modelUpdateHandler);var s=t.Facade.retrieveModel(t.ModelDef.FACTION_MODEL_SELF);s.off(t.ModelEvent.UPDATE_FINISH,this,this.modelUpdateHandler),this.display.goShopBtn.off(Laya.Event.CLICK,this,this.goShop),this.list&&(this.list.destroy(),this.list=null),e.prototype.destroy.call(this)},s}(t.BaseBox);t.WinShop=e;var i=function(e){function i(){e.call(this),this._um=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL)}return __extends(i,e),i.prototype.doRender=function(e,i){this._curData=e,this._shoptype=i,this.goodsName.text=e.name,this.mprice.text=e.price,e.remain=e.remain>99999?"不限量":e.remain,this.goodsRemain.text="剩余："+e.remain,0==e.remain?this.buyBtn.filters=t.FiltersUtils.getGreyFilters():this.buyBtn.filters=null,this.ico_3.visible=3==this._shoptype,this.ico_4.visible=4==this._shoptype,this.ico_5.visible=5==this._shoptype,this.ico_6.visible=6==this._shoptype,this.goodsPic.skin=t.ResPath().getPic(e.iconId,t.ResourcePath.PATH_GOODS),this.goodsPic.on(Laya.Event.CLICK,this,this.clickTips),this.goodsBg.on(Laya.Event.CLICK,this,this.closeTips),this.buyBtn.on(Laya.Event.CLICK,this,this.clickBuy),e.hasOwnProperty("vip_level")&&e.vip_level?(this.tfVipLv.text=e.vip_level,this.sign.visible=!0,this._um.vipLevel<e.vip_level&&(this.buyBtn.filters=t.FiltersUtils.getGreyFilters())):this.sign.visible=!1},i.prototype.clickTips=function(){var e,i={};e=this.localToGlobal(new laya.maths.Point(0,0)),i.name=this._curData.name,i.desc=this._curData.goods_des,i.info=this._curData.goods_effect,t.Tips.show(i,e)},i.prototype.closeTips=function(){t.Tips.tipsClose()},i.prototype.clickBuy=function(){t.Tips.tipsClose(),this._curData.hasOwnProperty("vip_level")&&this._curData.vip_level>this._um.vipLevel?t.WeakTips.show("达人等级不够"):0==this._curData.remain?t.WeakTips.show("已经没有剩余了"):t.Facade.callCommand(new t.WinShopBuyCmd(this._curData,this._shoptype))},i.prototype.destroy=function(){this._um=null,this._curData=null,this.goodsPic.off(Laya.Event.CLICK,this,this.clickTips),this.goodsBg.off(Laya.Event.CLICK,this,this.closeTips),this.buyBtn.off(Laya.Event.CLICK,this,this.clickBuy),e.prototype.destroy.call(this)},i}(ui.shop.WinShopGoodsItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Animation,i=function(i){function s(s){i.call(this,new ui.sign.NextLoginRewardUI,!0,!0),this.hasJYP=!1,this.spWidth1=0,this.spWidth2=0,this._scaleCount=0,this._showSpeed=30,this.display=this.skin,this.cacheAs="none",this.display.mainLayer.cacheAs="bitmap",this.name="CommoRewardBox",this.canClickModelToClose=!1,this.sp1=this.display.sp1,this.sp2=this.display.sp2,this.setCloseButton(this.display.queDingBtn);var n=[];if(s.hasOwnProperty("attrs"))for(var a,o=0;o<s.attrs.length;o++)a=s.attrs[o];for(var r,h=0;h<s.items.length;h++)r=s.items[h],r.id>=200001&&r.id<=4e5?this.hasJYP=!0:n.push(r);this.hasJYP?(this.display.jyp.visible=!0,this.display.sp.x=665,this._ske=new t.AnimationSKe(t.ResPath().getEffect("effect_nbwq"),1),this._ske.play(0,!0),this._ske.x=330,this._ske.y=320,this._ske.setSlotSkin("guo",Laya.Loader.getRes("ui/comp/vscroll_empty.png")),this.display.addChildAt(this._ske,0)):(this.display.jyp.visible=!1,this.display.sp.x=469),this.listData=n;for(var l=this.listData.length,o=0;l>o;o++){var c=this.display["item"+o];c.visible=!0,c.scaleX=c.scaleY=0,c.cacheAs="none",c.mainLayer.cacheAs="bitmap",c.nameTxt.visible=!1,c.idTxt.visible=!1;var r=this.listData[o];if(c.idTxt.text=r.id,c.icon.skin=t.ResPath().getPic(r.icon_id,t.ResourcePath.PATH_GOODS),c.nameTxt.text=r.name,c.nameTxt1.text=r.name,c.nameTxt2.text=r.name,c.nameTxt.textWidth>128?(c.nameTxt1.visible=!1,c.nameTxt2.visible=!0):(c.nameTxt1.visible=!0,c.nameTxt2.visible=!1),r.id>=200001&&r.id<=4e5){c.numTxt.text=t.DateUtils.getStrByHours(r.hours);var d=new e;d.name="ani",d.scaleX=d.scaleY=1,d.loadAtlas("res/atlas/ui/item_movie.json"),d.interval=95,d.index=1,c.sp.addChild(d),d.x=-29,d.y=-55,d.visible=!0,d.play()}else c.numTxt.text="×"+r.num;!function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.desc,t.Tips.show(n,e)})}(o,r,c)}for(var o=l;4>o;o++){var c=this.display["item"+o];c.visible=!1}var u=-400,p=-400;this._movieLight=new t.AnimationSKe("assets/skeleton/hj.sk",1),this.display.spMovieBeh.addChild(this._movieLight),this._movieLight.x=t.LayerMgr.width/2+u,this._movieLight.y=340+p,this._movieLight.play(1,!0),this._movieLight.scrollRect=new Laya.Rectangle(u,p,800,192),this._movieAll=new t.AnimationSKe("assets/skeleton/hj.sk",1),this._movieAll.showSkinByName("minrihd"),this.display.spMovieBeh.addChild(this._movieAll),this._movieAll.x=t.LayerMgr.width/2,this._movieAll.y=340,this._movieAll.play(0,!1);var _=new Sprite;_.graphics.drawRect(0,0,t.LayerMgr.width,t.LayerMgr.clientHeight,"#000000"),_.alpha=.8,_.y=-t.LayerMgr.offY,_.mouseEnabled=!0,_.size(t.LayerMgr.width,t.LayerMgr.clientHeight),this.display.addChildAt(_,0),this._scaleValueArr=[],this._scaleStepArr=[],this._scaleCount=0,Laya.timer.once(200,this,this.delaySetScale)}return __extends(s,i),s.prototype.delaySetScale=function(){Laya.timer.loop(30,this,this.setScale)},s.prototype.setScale=function(){this._scaleCount++;var t=0,e=this.sp1.numChildren;this.sp2&&(e+=this.sp2.numChildren);var i=0;if(this.sp1)for(var s=this.sp1.numChildren,n=0;s>n;n++)if(t++,this._scaleCount>3*(t-1)){this._scaleValueArr.length<t&&(this._scaleValueArr[t-1]=0,this._scaleStepArr[t-1]=this._showSpeed);var a=this._scaleValueArr[t-1],o=this._scaleStepArr[t-1];if(o==this._showSpeed||a>100){a+=o,this._scaleValueArr[t-1]=a;var r=this.sp1.getChildAt(n);r.scaleX=r.scaleY=a/100,o==this._showSpeed&&a>=120&&(o=-4,this._scaleStepArr[t-1]=o)}else i++}if(this.sp2)for(var h=this.sp2.numChildren,n=0;h>n;n++)if(t++,this._scaleCount>3*(t-1)){this._scaleValueArr.length<t&&(this._scaleValueArr[t-1]=0,this._scaleStepArr[t-1]=this._showSpeed);var a=this._scaleValueArr[t-1],o=this._scaleStepArr[t-1];if(o==this._showSpeed||a>100){a+=o,this._scaleValueArr[t-1]=a;var r=this.sp2.getChildAt(n);r.scaleX=r.scaleY=a/100,o==this._showSpeed&&a>=120&&(o=-4,this._scaleStepArr[t-1]=o)}else i++}i==e&&Laya.timer.clear(this,this.setScale)},s.prototype.destroy=function(){if(Laya.timer.clear(this,this.delaySetScale),Laya.timer.clear(this,this.setScale),this._scaleValueArr=null,this._scaleStepArr=null,this.sp1){for(;this.sp1.numChildren>0;){var t=this.sp1.removeChildAt(0),e=t.getChildByName("ani");e&&e.stop()}this.sp1.destroy(),this.sp1=null}if(this.sp2){for(;this.sp2.numChildren>0;){var t=this.sp2.removeChildAt(0),e=t.getChildByName("ani");e&&e.stop()}this.sp2.destroy(),this.sp2=null}this._movieLight&&(this._movieLight.destroy(),this._movieLight=null),this._movieAll&&(this._movieAll.destroy(),this._movieAll=null),this.listData=null,this.display&&(this.display=null),Laya.loader.clearRes("assets/skeleton/hj.sk"),i.prototype.destroy.call(this)},s}(t.BaseBox);t.NextLoginRewardBox=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Animation,i=function(e){function i(s,n){e.call(this,new ui.sign.SignUI,!0,!0,!1,!1),this.doudouNum=0,this.signTimes=0,this.signRemain=0,this.signFlag=0,this._aniLoadFlag=!1,this.display=this.skin,t.Global.isWXAPP&&Browser.onAndriod&&(this.display.closeBtn.x-=60),this.setCloseButton(this.display.closeBtn),this.cacheAs="none",this.display.mainLayer.cacheAs="bitmap",this.signData={},this._hasInitSign=this._hasInitGift=!1,this.name="SignBox",this.hideAllRed(),this._am=n,this._am.on(t.ModelEvent.UPDATE_FINISH,this,this.allStatusModelUpdate),this.allStatusModelUpdate(),this.display.menuTab.labels="登\n录\n礼\n包,等\n级\n礼\n包,签\n\n到",this.display.menuTab.selectHandler=new Handler(this,this.checkTab),0==t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).todayHasSign&&0==i.hasDoSign&&(s=4),s>3&&(0==t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).todayHasSign&&0==i.hasDoSign&&(this.signFlag=1),s=2),this.display.titleSign.visible=2==s,this.display.titleLv.visible=1==s,this.display.titleLogin.visible=0==s,this._initIndex=s,this.display.previewBtn.on(Laya.Event.CLICK,this,this.onPreview),this.display.tipsBtn.on(Laya.Event.CLICK,this,this.onSignTips),this.display.loginBannerBox.visible=!1,this.display.lvBannerPng.visible=!1,Laya.loader.load("res/atlas/ui/item_movie.json",Handler.create(this,this.aniLoadComplete),null,Loader.ATLAS),t.addListener(t.ViewEvent.BOX_HIDE,this,this.boxHideHandler)}return __extends(i,e),i.prototype.tempParseComplete=function(){this.display.menuTab.mouseEnabled=!0,this.init()},i.prototype.onPreview=function(){var e={};e.uptype=1,e.name="酱油瓶",e.desc="干嘛来打我啊？！我只是来打酱油的！必中！造成自身等级*8点额外伤害。并使对方受到的伤害提升30%，持续3次受击。",e.id=200017,e.isage=1,t.Facade.callCommand(new t.ShowUpAnimationCMD(e))},i.prototype.aniLoadComplete=function(){this.destroyed||(this._aniLoadFlag=!0,this.init())},i.prototype.init=function(){this.giftList=new laya.ui.List,this.giftList.vScrollBarSkin="ui/comp/vscroll.png",this.giftList.scrollBar.visible=!1,this.giftList.renderHandler=Handler.create(this,this.updateItem,null,!1),this.giftList.itemRender=n,this.display.movieContainer.addChild(this.giftList),this.giftList.x=243,this.giftList.y=230,this.giftList.repeatX=1,this.giftList.repeatY=5,this.giftList.spaceY=3,this.giftList.height=451,this.giftList.array=[],this.display.menuTab.selectedIndex=this._initIndex,this.showTab(),t.EventCenter.singleton.on("GET_LV_OR_DAY_GIFT_SUCCESS",this,this.getGiftSuccess)},i.prototype.hideAllRed=function(){this.display.lvRedState.visible=!1,this.display.loginRedState.visible=!1},i.prototype.allStatusModelUpdate=function(){var e=this._am.getStatueFlagByName(t.AllStatusModel.LV_GIFT_STATE),i=this._am.getStatueFlagByName(t.AllStatusModel.LOGIN_GIFT_STATE);this.display.lvRedState.visible=1==e,this.display.loginRedState.visible=1==i;var s=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL),n=s.level>=40&&1!=e&&s.loginDays>=14&&1!=i;this.display.tabBox.visible=!n},i.prototype.initSign=function(){this.signData={signstatus:[],has:0,remain:0,gifts:[],totalSignStatus:[],totalSignGifts:[]},this.display.signList.scrollBar.visible=!1,this.display.signList.spaceX=0,this.load(),this.display.signList.itemRender=s,this.display.signList.renderHandler=new Handler(this,this.onListRender),this.display.signBtn.on(laya.events.Event.CLICK,this,this.sign)},i.prototype.load=function(){t.XHR().Post({cmd:"sign",subcmd:"GetUser",needreload:"1"},this,this.checkData)},i.prototype.checkData=function(e){0==e.result?(e.userinfo&&(this.signData=e,this.signStatus=e.userinfo.signstatus,this.totalSignStatus=e.userinfo.total_sign_gift,this.signTimes=e.userinfo.has,this.signRemain=e.userinfo.remain,this.vipStatus=e.userinfo.viplevels,e.userinfo.changed&&t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0,"签到奖励"))),e.gifts&&(this.signGifts=e.gifts),e.total_awards&&(this.totalSignGifts=e.total_awards),this.showSign(),1==this.signFlag&&this.signPost("0")):t.WeakTips.show(e.msg)},i.prototype.sign=function(){var e="ui/comp/kcash.png";t.ConfirmBox.show(new t.ConfirmBoxData({htmlStr:"确定要花费<img style='width:40px;height:40px;' src='"+e+"'></img>"+this.display.doudou.text+"补签吗？",callBackHandler:new Handler(this,this.signPost)}))},i.prototype.signPost=function(e){void 0===e&&(e="1");var i={cmd:"sign",subcmd:"Sign",repair:e};t.XHR().Post(i,this,this.signPostHandler)},i.prototype.signPostHandler=function(e){i.hasDoSign=!0,0==e.result?(this.signFlag=0,t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0,"签到奖励")),t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL).todayHasSign=!0,this.destroyed||this.checkData(e)):t.WeakTips.show("签到失败，"+e.msg)},i.prototype.onListRender=function(t,e){t.setData(this.display.signList.getItem(e),e,this.display.signList.selectedIndex==e)},i.prototype.showSign=function(){if(!this.destroyed){var e=["20","20","10","5"],i=[];this.display.btnText.text="补签（"+this.signRemain+"）",0==this.signRemain?(this.display.doudou.text=e[this.signRemain],this.display.signBtn.filters=t.FiltersUtils.getGreyFilters(),this.display.signBtn.off(laya.events.Event.CLICK,this,this.sign)):this.display.doudou.text=e[this.signRemain],this.display.signTimes.text="本月签到次数："+this.signTimes+"/28",this.display.progressBar.width=598*this.signTimes/28;for(var s,n=0;n<this.totalSignStatus.length;n++)s=this.totalSignStatus[n],0==s?t.Util.toGray(this.display["gift_"+(n+1)]):t.Util.enable(this.display["gift_"+(n+1)]),this.display["btnGet_"+(n+1)].visible=1==s,this.display["flag_"+(n+1)].visible=2==s,this.display["btnGet_"+(n+1)].on(Laya.Event.CLICK,this,this.GetGift,[n]);for(var a,n=0;n<this.totalSignGifts.length;n++){a=this.totalSignGifts[n].award.items;for(var o="",r=0;r<a.length;r++)o+=a[r].name+"x"+(a[r].num?a[r].num:a[r].hours+"小时"),r!=a.length-1&&(o+="\n");!function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name="礼包内容",n.desc=i,t.Tips.show(n,e)})}(n,o,this.display["gift_"+(n+1)])}for(var n=0;n<this.signStatus.length;n++){var h={};h.signtype=this.signStatus[n],h.viplevel=this.vipStatus[n],this.signGifts[n].attrs.length>0?(h.id=this.signGifts[n].attrs[0].id,h.num=this.signGifts[n].attrs[0].num,h.name=this.signGifts[n].attrs[0].name,h.desc=this.signGifts[n].attrs[0].desc):this.signGifts[n].items.length>0&&(h.id=this.signGifts[n].items[0].icon_id,h.hours=this.signGifts[n].items[0].hours,h.num=this.signGifts[n].items[0].num,h.name=this.signGifts[n].items[0].name,h.desc=this.signGifts[n].items[0].goods_desc,h.info=this.signGifts[n].items[0].effect_desc),i.push(h)}this.display.signList.array=i}},i.prototype.GetGift=function(e){t.XHR().Post({cmd:"sign",subcmd:"GetTotalSignGift",index:e},this,function(i){if(0==i.result){this.totalSignStatus[e]=2,this.showSign();var s=null;4==e&&(s=new Handler(this,this.signShare)),t.Facade.callCommand(new t.SyncChangeCmd(i,!1,!0,"",s))}else t.WeakTips.show("领取失败，"+i.msg)})},i.prototype.signShare=function(){t.dispatch(t.ShareModule.SHARE_MODULE_EVENT,{type:100})},i.prototype.checkTab=function(){this._aniLoadFlag?this.showTab():this.display.menuTab.selectedIndex=0},i.prototype.showTab=function(){var t=this.display.menuTab.selectedIndex;this._aniLoadFlag&&(2==t?(this.display.signBtn.visible=!0,this.display.signList.visible=!0,this.display.signTimes.visible=!0,this.display.signBannerBox.visible=!0,this.display.titleSign.visible=!0,this.display.titleLv.visible=!1,this.display.titleLogin.visible=!1,this.giftList.visible=!1,0==this._hasInitSign&&(this._hasInitSign=!0,this.initSign()),this.display.loginBannerBox.visible=!1,this.display.lvBannerPng.visible=!1):(this.display.signBtn.visible=!1,this.display.signList.visible=!1,this.display.signTimes.visible=!1,this.display.signBannerBox.visible=!1,this.display.titleSign.visible=!1,this.display.titleLv.visible=1==t,this.display.titleLogin.visible=0==t,this.giftList.visible=!0,this.giftList.scrollTo(0),1==this.display.menuTab.selectedIndex?(this.display.loginBannerBox.visible=!1,this.display.lvBannerPng.visible=!0):(this.display.loginBannerBox.visible=!0,this.display.lvBannerPng.visible=!1),0==this._hasInitGift?(this._hasInitGift=!0,this.initGift()):1==this.display.menuTab.selectedIndex?this.giftList.array=this._userInfo?this._userInfo.levelgift:[]:this.giftList.array=this._userInfo?this._userInfo.logingift:[]))},i.prototype.initGift=function(){t.XHR().Post({cmd:"lvlogingift",subcmd:"GetUser",needreload:"1"},this,this.gitGiftData)},i.prototype.gitGiftData=function(e){if(0==e.result){this._userInfo=e.userinfo,this._userLv=this._userInfo.level,this._loginDay=this._userInfo.days,this._canGetLvGift=!1;for(var i=0;i<this._userInfo.levelgift.length;i++){var s=this._userInfo.levelgift[i];1==s.sts?(this._canGetLvGift=!0,s.sortV=3):0==s.sts?s.sortV=2:s.sortV=1}this._userInfo.levelgift.sort(function(t,e){return 1e4*(e.sortV-t.sortV)+(t.lvl-e.lvl)}),this._canGetLoginGift=!1;for(var n=0;n<this._userInfo.logingift.length;n++){var a=this._userInfo.logingift[n];1==a.sts?(this._canGetLoginGift=!0,a.sortV=3):0==a.sts?a.sortV=2:a.sortV=1}this._userInfo.logingift.sort(function(t,e){return 1e4*(e.sortV-t.sortV)+(t.days-e.days)}),1==this.display.menuTab.selectedIndex?this.giftList.array=this._userInfo.levelgift:this.giftList.array=this._userInfo.logingift}else t.WeakTips.show("获取礼包数据失败，"+e.msg)},i.prototype.getGiftSuccess=function(e){var i=this._canGetLvGift,s=this._canGetLoginGift;this.gitGiftData(e),1==this.display.menuTab.selectedIndex?i&&!this._canGetLvGift&&this._am.setStatueFlagByName(t.AllStatusModel.LV_GIFT_STATE,0):s&&!this._canGetLoginGift&&this._am.setStatueFlagByName(t.AllStatusModel.LOGIN_GIFT_STATE,0)},i.prototype.updateItem=function(t,e){var i=1==this.display.menuTab.selectedIndex?this._userInfo.levelgift:this._userInfo.logingift;e<=i.length-1&&t.doRender(i[e],this.display.menuTab.selectedIndex,this._userLv,this._loginDay)},i.prototype.boxHideHandler=function(e){if((1==this._loginDay||2==this._loginDay||6==this._loginDay||7==this._loginDay||10==this._loginDay||13==this._loginDay)&&"CommoRewardBox"==e&&!i.HAS_SHOW_NEXT_REWARD&&0==this.display.menuTab.selectedIndex&&this._loginDay<14)for(var s=0;s<this._userInfo.logingift.length;s++){var n=this._userInfo.logingift[s];if(Number(n.days)==this._loginDay+1){t.Facade.callCommand(new t.ShowNextLoginRewardCmd(n.gifts)),i.HAS_SHOW_NEXT_REWARD=!0;break}}},i.prototype.onSignTips=function(){var e,i={};e=this.display.tipsBtn.localToGlobal(new laya.maths.Point(0,0)),i.name="提示",i.desc="累积签到指定天数可以领取签到礼包，全勤的豆油可领取豪华全勤大礼包",t.Tips.show(i,e)},i.prototype.destroy=function(){t.removeListener(t.ViewEvent.BOX_HIDE,this,this.boxHideHandler),Laya.loader.clearRes("res/atlas/ui/item_movie.json"),Laya.loader.clearRes("ui/sign/signBanner.jpg"),t.EventCenter.singleton.off("GET_LV_OR_DAY_GIFT_SUCCESS",this,this.getGiftSuccess),this._am&&(this._am.off(t.ModelEvent.UPDATE_FINISH,this,this.allStatusModelUpdate),this._am=null),this.display.tipsBtn.off(Laya.Event.CLICK,this,this.onSignTips),this.display.previewBtn.off(Laya.Event.CLICK,this,this.onPreview),this.display.menuTab.selectHandler=null,this.display.signList.destroy(),this.signGifts=null,this.signStatus=null,this.display=null,t.Tips.tipsClose(),t.dispatch(t.MainModule.OPENBOXEVENT),e.prototype.destroy.call(this)},i.hasDoSign=!1,i.HAS_SHOW_NEXT_REWARD=!1,i}(t.BaseBox);t.Sign=i;var s=function(i){function s(){i.call(this),this.cacheAs="none",this.mainLayer.cacheAs="bitmap"}return __extends(s,i),s.prototype.destroy=function(){this._curData=null,this.ani&&(this.ani.stop(),this.ani.destroy(),this.ani=null),i.prototype.destroy.call(this)},s.prototype.setData=function(i,s,n){i&&(this.mouseEnabled=!0,(s+1)%7==0&&(this.signItem.skin="ui/sign/img_002.png"),this._curData=i,this._curIndex=s,this.goodsPic.skin=t.ResPath().getPic(i.id,t.ResourcePath.PATH_GOODS),i.id>=200001&&i.id<=4e5?(this.goodsNum.text=t.DateUtils.getStrByHours(i.hours),this.ani||(this.ani=new e,this.ani.loadAtlas("res/atlas/ui/item_movie.json"),this.ani.interval=95,this.ani.index=1,this.sp.addChild(this.ani),this.ani.x=this.signTag.x-57,this.ani.y=this.signTag.y-58),this.ani.play()):this.goodsNum.text=i.num,this.signTag.skin="",0!=i.signtype&&(this.signTag.skin="ui/sign/signicon"+i.signtype+".png"),
0!=i.viplevel?(this.viptitle.visible=!0,this.vipLevel.text=i.viplevel+""):(this.viptitle.visible=!1,this.vipLevel.text=""),this.goodsPic.on(Laya.Event.CLICK,this,this.clickTips))},s.prototype.clickTips=function(){var e,i={};e=this.goodsPic.localToGlobal(new laya.maths.Point(0,0)),i.name=this._curData.name,i.desc=this._curData.desc,this._curData.info&&(i.info=this._curData.info),t.Tips.show(i,e)},Object.defineProperty(s.prototype,"selected",{set:function(t){},enumerable:!0,configurable:!0}),s}(ui.sign.SignItemUI),n=function(i){function s(){i.call(this),this.cacheAs="none",this.mainLayer.cacheAs="bitmap"}return __extends(s,i),s.prototype.doRender=function(i,s,n,a){this.index=s,this.icon1.visible=this.icon2.visible=this.icon3.visible=this.icon4.visible=this.icon5.visible=!1,this.icon1Bg.visible=this.icon2Bg.visible=this.icon3Bg.visible=this.icon4Bg.visible=this.icon5Bg.visible=!1,this.numTxt1.text=this.numTxt2.text=this.numTxt3.text=this.numTxt4.text=this.numTxt5.text="";for(var o=1;5>=o;o++)this["ani"+o]&&(this["ani"+o].stop(),this["ani"+o].visible=!1);0!=i.ishot?(this.hotPng.visible=!0,this.bg_hot.visible=!0,this.bg_normal.visible=!1):(this.hotPng.visible=!1,this.bg_hot.visible=!1,this.bg_normal.visible=!0),this.doudouTxt.text=i.show_price;for(var r,h=0,o=0;o<i.gifts.attrs.length&&(h++,!(h>5));o++)r=i.gifts.attrs[o],this["icon"+h].visible=!0,this["icon"+h+"Bg"].visible=!0,this["icon"+h].skin=t.ResPath().getPic(r.id,t.ResourcePath.PATH_GOODS),this["numTxt"+h].text=r.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.desc,t.Tips.show(n,e)})}(h,r,this["icon"+h]);for(var l,c=0;c<i.gifts.items.length&&(h++,!(h>5));c++)l=i.gifts.items[c],this["icon"+h].visible=!0,this["icon"+h+"Bg"].visible=!0,this["icon"+h].skin=t.ResPath().getPic(l.icon_id,t.ResourcePath.PATH_GOODS),l.id>=200001&&l.id<=4e5?(this["numTxt"+h].text=t.DateUtils.getStrByHours(l.hours),this["ani"+h]||(this["ani"+h]=new e,this["ani"+h].loadAtlas("res/atlas/ui/item_movie.json"),this["ani"+h].interval=95,this["ani"+h].index=1,this.sp.addChild(this["ani"+h]),this["ani"+h].x=this["icon"+h+"Bg"].x-51,this["ani"+h].y=this["icon"+h+"Bg"].y-52),this["ani"+h].play(),this["ani"+h].visible=!0):this["numTxt"+h].text=l.num,function(e,i,s){s.on(Laya.Event.CLICK,this,function(){var e,n={};e=s.localToGlobal(new laya.maths.Point(0,0)),n.name=i.name,n.desc=i.goods_desc,n.info=i.effect_desc,t.Tips.show(n,e)})}(h,l,this["icon"+h]);var d,u=!1;1==s?(this.lvName.text=i.lvl+"",this.lvName.visible=!0,this.lvMsg.visible=!0,this.dayName.visible=!1,this.dayMsg.visible=!1,this.value=i.lvl,d=n,i.lvl<=n&&(u=!0)):(this.lvName.visible=!1,this.lvMsg.visible=!1,this.dayName.text=i.days,this.dayName.visible=!0,this.dayMsg.visible=!0,this.value=i.days,d=a,i.days<=a&&(u=!0)),u?2==i.sts?(this.getBtn.label="已领取",this.getBtn.filters=t.FiltersUtils.getGreyFilters(),this.greenTxt.visible=!0,this.greenTxt.text=d+"",this.needTxt.text="/"+this.value,this.redTxt.visible=!1):(this.getBtn.label="领取",this.getBtn.filters=null,this.greenTxt.visible=!0,this.greenTxt.text=d+"",this.needTxt.text="/"+this.value,this.redTxt.visible=!1):(this.getBtn.label="领取",this.getBtn.filters=t.FiltersUtils.getGreyFilters(),this.redTxt.visible=!0,this.redTxt.text=d+"",this.needTxt.text="/"+this.value,this.greenTxt.visible=!1),this.getBtn.on(Laya.Event.CLICK,this,this.getBtnClick)},s.prototype.getBtnClick=function(){null!=this.getBtn.filters&&0!=this.getBtn.filters.length||t.XHR().Post({cmd:"lvlogingift",subcmd:"GetPrize",type:(this.index+1)%2,value:this.value},this,this.getGiftHandler)},s.prototype.getGiftHandler=function(e){0==e.result?(t.EventCenter.singleton.event("GET_LV_OR_DAY_GIFT_SUCCESS",e),t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0))):t.WeakTips.show("领取失败，"+e.msg)},s.prototype.destroy=function(){for(var t=1;5>=t;t++)this.ani+t&&(this.ani.stop(),this.ani.destroy(),this.ani=null);this.getBtn.off(Laya.Event.CLICK,this,this.getBtnClick),i.prototype.destroy.call(this)},s}(ui.sign.Gift_ItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"SignCommand":this._sign||(this._sign=new t.Sign(e.index,this.retrieveModel(t.ModelDef.ALL_STATUS_MODEL)),this._sign.on(t.ViewEvent.BASE_DESTROY,this,this.singDestroy),this._sign.show()),e.ecode=0,e.finish();break;case"ShowNextLoginRewardCmd":this.showNextLoginRewardBox(e.giftObj)}},s.prototype.singDestroy=function(){this._sign.off(t.ViewEvent.BASE_DESTROY,this,this.singDestroy),this._sign=null,Laya.loader.clearRes("ui/sign/giftBg.png"),Laya.loader.clearRes("ui/sign/giftBgNew.png"),Laya.loader.clearRes("ui/sign/loginBanner.jpg"),Laya.loader.clearRes("ui/sign/lvBanner.jpg"),this.unregisterPlugin()},s.prototype.showNextLoginRewardBox=function(e){this._nextLoginRewardBox||(this._nextLoginRewardBox=new t.NextLoginRewardBox(e),this._nextLoginRewardBox.on(t.ViewEvent.BASE_DESTROY,this,this.nextLoginRewardBoxDestroy),this._nextLoginRewardBox.show())},s.prototype.nextLoginRewardBoxDestroy=function(){this._nextLoginRewardBox&&(this._nextLoginRewardBox.off(t.ViewEvent.BASE_DESTROY,this,this.nextLoginRewardBoxDestroy),this._nextLoginRewardBox=null)},s.prototype.getPluginName=function(){return e.PLUGIN_SIGN},s}(t.Plugin);t.SignModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.strength.StrengthBoxUI,!0,!0),this.display=this.skin,this.setCloseButton(this.display.commonBg.closeBtn);var s=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);s.on(t.ModelEvent.UPDATE_FINISH,this,this.userModelUpdateFinish),this.userModelUpdateFinish(),this.strDic=new laya.utils.Dictionary,this.strDic.set("kLevelPower","提升等级获得强大武器技能和更多属性。"),this.strDic.set("kMeridianPower","求教内力获得强大的属性加成。"),this.strDic.set("kWeaponPower","强化武器技能发觉武器技能的潜力。"),this.strDic.set("kGemPower","在武器上镶嵌魂珠，强化使用武器时的攻防能力。"),this.strDic.set("kFactionPower","在帮派武馆和修炼馆中学习技能和强化修炼。"),this.strDic.set("kChainPower","修行密卷获得强大的密卷技能并让更多的武器得到发挥。"),this.strDic.set("kBeastPower","强化召唤兽获得属性成长并可获得强大的召唤兽技能。"),this.list=new laya.ui.List,this.list.vScrollBarSkin="ui/comp/vscroll.png",this.list.scrollBar.visible=!1,this.list.renderHandler=Handler.create(this,this.updateItem,null,!1),this.list.itemRender=i,this.addChild(this.list),this.list.x=238,this.list.y=185,this.list.repeatX=1,this.list.repeatY=6,this.list.height=488,this.list.spaceY=2,this.display.ruleBtn.on(Laya.Event.CLICK,this,this.showRule)}return __extends(s,e),s.prototype.showRule=function(){var e="";e+="<img src='ui/comp/icon.png'></img> 1. 强化过的密卷无需装备，可以获得属性加成；<br>",e+="<img src='ui/comp/icon.png'></img> 2. 密卷等级建议最低升到10级；<br>",e+="<img src='ui/comp/icon.png'></img> 3. 根据密卷的技能装备不同武器可收到奇效；<br>",e+="<img src='ui/comp/icon.png'></img> 4. 武器附加属性在没使用时也可获得加成，建议强化到6星以上；<br>",e+="<img src='ui/comp/icon.png'></img> 5. 技能附加属性在没使用时也可获得加成，建议强化到6星以上；<br>",e+="<img src='ui/comp/icon.png'></img> 6. 每个武器装备2个以上魂珠即可激活活力之魂，大幅提升生命上限；<br>",e+="<img src='ui/comp/icon.png'></img> 7. 经脉建议侧重修炼攻击；<br>",e+="<img src='ui/comp/icon.png'></img> 8. 帮派武馆技能换帮后需要重新去学习；<br>",e+="<img src='ui/comp/icon.png'></img> 9. 帮派修炼馆内的技能换帮后需重新去学习；<br>",e+="<img src='ui/comp/icon.png'></img> 10. 洞穴商店可以购买药水；<br>",e+="<img src='ui/comp/icon.png'></img> 11. 历练可以获得大量经验和威望；<br>",e+="<img src='ui/comp/icon.png'></img> 12. 每张地图达到15星就会有丰厚的奖励；",t.RulePanel.showRule(e,"")},s.prototype.setData=function(e){var i=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);t.Facade.retrieveModel(t.ModelDef.ALL_STATUS_MODEL);this.listData=[];for(var s=0,n=0,a=0,o=0,r=e["happyfight.HFQueryStrongRsp"].figtherPower,h=0;h<r.length;h++){var l=r[h];"kWeaponPower"==l.type||"kSkillPower"==l.type?(s+=Number(l.value),n+=Number(l.max)):"kMClubSkillPower"==l.type||"kPraticSkillPower"==l.type?(a+=Number(l.value),o+=Number(l.max)):"kLevelPower"==l.type?(l.sortValue=70,l.flag=t.AllStatusModel.ROLE_STATE,this.listData.push(l)):"kMeridianPower"==l.type&&i.level>=4?(l.sortValue=60,l.flag=t.AllStatusModel.FIGHTING_CHANNEL,this.listData.push(l)):"kGemPower"==l.type&&i.level>=15?(l.sortValue=40,l.flag=t.AllStatusModel.FIGHTING_GEM,this.listData.push(l)):"kChainPower"==l.type&&i.level>=7?(l.sortValue=20,l.flag=t.AllStatusModel.FIGHTING_CHAIN,this.listData.push(l)):"kBeastPower"==l.type&&i.level>=25?(l.sortValue=10,l.flag="",this.listData.push(l)):"kFightPower"==l.type&&(this.display.strengBestTxt.text="推荐战斗力："+l.max)}this.listData.push({type:"kWeaponPower",sortValue:30,value:s,max:n,flag:t.AllStatusModel.FIGHTING_UPGRADE}),t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL).level>=t.UserModel.NEED_USERLV_FACTION&&this.listData.push({type:"kFactionPower",sortValue:50,value:a,max:o,flag:t.AllStatusModel.FIGHTING_FACTION}),this.listData.sort(function(t,e){return t.sortValue-e.sortValue}),this.list.array=this.listData},s.prototype.userModelUpdateFinish=function(){var e=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);this.display.strengTxt.text=e.attackPower+""},s.prototype.updateItem=function(t,e){e<=this.listData.length-1&&t.doRender(this.listData[e].type,this.listData[e].value,this.listData[e].max,this.strDic.get(this.listData[e].type),this.listData[e].flag)},s.prototype.destroy=function(){this.display.ruleBtn.off(Laya.Event.CLICK,this,this.showRule);var i=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);i.off(t.ModelEvent.UPDATE_FINISH,this,this.userModelUpdateFinish),this.list.destroy(),this.list=null,this.listData=null,this.strDic=null,this.display=null,e.prototype.destroy.call(this)},s}(t.BaseBox);t.StrengthBox=e;var i=function(e){function i(){e.call(this),this.goBtn.on(Laya.Event.CLICK,this,this.clickHandler),this.icon.on(Laya.Event.CLICK,this,this.clickHandler),this._barMaxWidth=this.bar_lv.width}return __extends(i,e),i.prototype.doRender=function(e,i,s,n,a){this._id=e,this.strengTxt.text="战："+i+"/"+s,this.msgTxt.text=n,this.icon.skin=t.ResPath().getPic(e,"streng/"),this.redDot.visible=!1,this._flag=a,a&&""!=a&&(this._asm=t.Facade.retrieveModel(t.ModelDef.ALL_STATUS_MODEL),this._asm.on(t.ModelEvent.UPDATE_FINISH,this,this.statusUpdate),this.statusUpdate());var o=i/s;o>1&&(o=1),.3>o?(this.wordTxt.color="#ff5529",this.wordTxt.text="急需提升",this.bar_cheng.visible=!0,this.bar_cheng.width=this._barMaxWidth*o,this.bar_huang.visible=!1,this.bar_lv.visible=!1):.8>=o?(this.wordTxt.color="#ffe235",this.wordTxt.text="有待提升",this.bar_cheng.visible=!1,this.bar_huang.visible=!0,this.bar_huang.width=this._barMaxWidth*o,this.bar_lv.visible=!1):(this.wordTxt.color="#3aff0a",this.wordTxt.text="出类拔萃",this.bar_cheng.visible=!1,this.bar_huang.visible=!1,this.bar_lv.visible=!0,this.bar_lv.width=this._barMaxWidth*o)},i.prototype.statusUpdate=function(){this.redDot.visible=this._asm.getStatueFlagByName(this._flag)>0},i.prototype.clickHandler=function(){switch(this._id){case"kLevelPower":t.Facade.callCommand(new t.UserInfoCommand);break;case"kMeridianPower":t.Facade.callCommand(new t.OpenChannelsBoxCommand);break;case"kWeaponPower":t.Facade.callCommand(new t.OpenUpgradeCmd);break;case"kGemPower":t.Facade.callCommand(new t.OpenGemCmd);break;case"kFactionPower":t.Facade.callCommand(new t.FactionCommand);break;case"kChainPower":t.Facade.callCommand(new t.ChainCommand);break;case"kBeastPower":t.Facade.callCommand(new t.MonsterCommand)}},i.prototype.destroy=function(){this._asm&&(this._asm.off(t.ModelEvent.UPDATE_FINISH,this,this.statusUpdate),this._asm=null),this.goBtn.off(Laya.Event.CLICK,this,this.clickHandler),this.icon.off(Laya.Event.CLICK,this,this.clickHandler),e.prototype.destroy.call(this)},i}(ui.strength.StrengItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.initialize=function(t){},i.prototype.doCommand=function(e){switch(e.getCommandName()){case"OpenStrengthBoxCommand":e.ecode=0,e.finish(),t.XHR().Post({file:"petpk",cmd:"strong",uid:t.Global.UID},this,this.getStrengDataHandler)}},i.prototype.getStrengDataHandler=function(e){if(0!=e.result)t.WeakTips.show("获取战力信息失败，"+e.msg);else if(this.strengthBox)this.strengthBox.parent.setChildIndex(this.strengthBox,this.strengthBox.parent.numChildren-1);else{this.strengthBox=new t.StrengthBox,this.strengthBox.on(t.ViewEvent.BASE_DESTROY,this,this.stengthBoxDestroy),this.strengthBox.show(),this.strengthBox.setData(e);var i=this.retrieveModel(t.ModelDef.SELF_USER_MODEL);i.on(t.ModelEvent.UPDATE_FINISH,this,this.userModelUpdateFinish),this.nowStrength=i.attackPower}},i.prototype.userModelUpdateFinish=function(){var e=this.retrieveModel(t.ModelDef.SELF_USER_MODEL);e.attackPower!=this.nowStrength&&(this.nowStrength=e.attackPower,t.XHR().Post({file:"petpk",cmd:"strong",uid:t.Global.UID},this,this.refreshStrengBox))},i.prototype.refreshStrengBox=function(t){0==t.result&&this.strengthBox&&this.strengthBox.setData(t)},i.prototype.stengthBoxDestroy=function(e){var i=this.retrieveModel(t.ModelDef.SELF_USER_MODEL);i.off(t.ModelEvent.UPDATE_FINISH,this,this.userModelUpdateFinish),this.strengthBox.off(t.ViewEvent.BASE_DESTROY,this,this.stengthBoxDestroy),this.strengthBox=null},i.prototype.getPluginName=function(){return t.PluginDef.PLUGIN_STRENGTH},i}(t.Plugin);t.StrengthModule=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"SubscriptionCommand":this._Panel||(this._Panel=new t.SubscriptionView),this._Panel.on(t.ViewEvent.BOX_HIDE,this,this.onClosePanel),this._Panel.show()}},s.prototype.onClosePanel=function(){this._Panel&&(this._Panel.off(t.ViewEvent.BOX_HIDE,this,this.onClosePanel),Laya.loader.clearRes("ui/subsription/bg.png"))},s.prototype.getPluginName=function(){return e.PLUGIN_SUBSCRIPTION},s}(t.Plugin);t.SubscriptionModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.subscription.SubscriptionUI,!0,!1),this.m_ui=this.skin,this.setCloseButton(this.m_ui.back.closeBtn),this._isFirst=!0,this.m_ui.btn147.on(Laya.Event.CLICK,this,this.onClickBtn),this.m_ui.btn148.on(Laya.Event.CLICK,this,this.onClickBtn),this.m_ui.btn149.on(Laya.Event.CLICK,this,this.onClickBtn)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.onShowed=function(){e.prototype.onShowed.call(this),this._isFirst?this._isFirst=!1:this.resetImageSkin(this),t.XHR().Post({cmd:"subscribe",op:"get",needreload:"1"},this,this.onDataBack)},i.prototype.onHided=function(){e.prototype.onHided.call(this)},i.prototype.onDataBack=function(e){if(0==e.result){this._curData={};for(var i=e.subscribe_list,s=0;s<i.length;s++)this._curData[i[s].id]=i[s];this.updatePanel()}else t.WeakTips.show(e.msg)},i.prototype.updatePanel=function(){this.setLable("147"),this.setLable("148"),this.setLable("149")},i.prototype.setLable=function(t){this._curData[t]&&(this._curData[t].status?this.m_ui["btn"+t].label="取消订阅":this.m_ui["btn"+t].label="订  阅")},i.prototype.onClickBtn=function(e){this._curData&&this._curData[e.target.name]&&(this._curName=e.target.name,"取消订阅"==this.m_ui["btn"+e.target.name].label?t.XHR().Post({cmd:"subscribe",op:"set",msgid:e.target.name,type:1},this,this.onSetRet):t.XHR().Post({cmd:"subscribe",op:"set",msgid:e.target.name,type:0},this,this.onSetRet))},i.prototype.onSetRet=function(e){0==e.result?"取消订阅"==this.m_ui["btn"+this._curName].label?(this.m_ui["btn"+this._curName].label="订  阅",t.WeakTips.show("您已经取消订阅啦！")):(this.m_ui["btn"+this._curName].label="取消订阅",t.WeakTips.show("您已经订阅成功啦！")):t.WeakTips.show(e.msg)},i}(t.BaseBox);t.SubscriptionView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this,new ui.talk.FactionTalkUI,!1,!1),this.m_ui=this.skin,this._isFirst=!0,this._hasSendMore=!1,this.name="FactionTalk",this.m_ui.list.itemRender=i,this.m_ui.list.scrollBar.visible=!1,this.m_ui.list.scrollBar.elasticDistance=50,this.m_ui.list.scrollBar.changeHandler=new Handler(this,this.listChange),this.m_ui.list.renderHandler=new Handler(this,this.onListRender),this.m_ui.closeBtn.on(Laya.Event.CLICK,this,this.onClickClose),this.m_ui.simple.on(Laya.Event.CLICK,this,this.onClickSimple),this.m_ui.newMsg.on(Laya.Event.CLICK,this,this.onClickToEnd),this.m_ui.inputTxt.on(Laya.Event.BLUR,this,this.onInputBlur),this._addValue=0,this._tipsShow=!1,this.m_ui.loadTips.visible=!1,this.m_ui.simple.visible=!0,this.m_ui.detail.visible=!1,t.MessageDispather.Register(t.MsgId.MSG_FACTION_RECORD,this,this.onGetRocord),t.MessageDispather.Register(t.MsgId.MSG_FACTION_TALK_GET,this,this.onMsgAdd)}return __extends(s,e),s.prototype.destroy=function(){e.prototype.destroy.call(this)},s.prototype.onShowed=function(){e.prototype.onShowed.call(this),this._isFirst?this._isFirst=!1:this.resetImageSkin(this),this.visible=!1,this._canLoadMore=!0,this.m_ui.sendBtn.filters=null,this.m_ui.sendBtn.label="发 送",this.m_ui.sendBtn.on(Laya.Event.CLICK,this,this.onClickSend),this._factionModel=t.Facade.singleton.model.retrieveModel(t.ModelDef.FACTION_MODEL_SELF),this._factionModel&&this._factionModel.members.length>0?this.onUpdate():this._factionModel.on(t.ModelEvent.UPDATE_FINISH,this,this.onUpdate)},s.prototype.onInputBlur=function(){Laya.timer.clear(this,this.resetWindow),this.resetWindow()},s.prototype.onInputFocus=function(){Laya.timer.loop(2e3,this,this.resetWindow)},s.prototype.resetWindow=function(){t.Global.isWXAPP||window.dispatchEvent(new Event("resize"))},s.prototype.onUpdate=function(){this._factionModel.off(t.ModelEvent.UPDATE_FINISH,this,this.onUpdate),this.initData(),t.SocketFacade.sendData({cmd:"chat",sub:"getrecord",lasttime:"0"})},s.prototype.initData=function(){if(this._membersMap||(this._membersMap={}),this._factionModel)for(var t=0;t<this._factionModel.members.length;t++)this._membersMap[this._factionModel.members[t].uid]=this._factionModel.members[t],"600"==this._factionModel.members[t].pos&&(this._leaderName=this._factionModel.members[t].name)},s.prototype.onGetRocord=function(e){if(0==e.result){this.visible=!0;for(var i=0;i<e.words.length;i++)this.formateData(e.words[i]);this._curdata?(0!=e.words.length?(this._addValue=125*e.words.length+this.m_ui.list.scrollBar.value,this._curdata.words=e.words.concat(this._curdata.words)):(this._addValue=0,this._hasSendMore&&(t.WeakTips.show("已无更多历史聊天消息！"),this._canLoadMore=!1)),this.update()):(this._curdata=e,this.update())}else t.WeakTips.show(e.msg)},s.prototype.formateData=function(e){var i=this._membersMap[e.uid];return i||(i={head_url:"",level:"?",name:"(已退帮)",sex:1,vip_level:0,pos:0}),e.content=t.HTMLTextUtil.changeSpecialHtml(e.content),e.detail=i,e},s.prototype.onMsgAdd=function(e){0==e.result?this.receiveMsg(this.formateData(e.word)):t.WeakTips.show(e.msg)},s.prototype.onHided=function(){e.prototype.onHided.call(this),Laya.loader.clearRes("ui/talk/3.jpg"),Laya.loader.clearRes("ui/talk/11.jpg"),t.SocketFacade.close(),Laya.timer.clear(this,this.loopTime),Laya.timer.clear(this,this.tipShow),Laya.timer.clear(this,this.resetWindow),this._curdata=null},s.prototype.update=function(){this.m_ui.list.array=this._curdata.words;var t=this._curdata.words.length;t>0?this.m_ui.txt.text="【"+this.getPosStr(this._curdata.words[t-1].detail.pos)+"】"+this._curdata.words[t-1].detail.name+"："+this._curdata.words[t-1].content:this.m_ui.txt.text="【帮主】"+this._leaderName+"：欢迎来到帮派!",this._hasSendMore?(this._hasSendMore=!1,this.m_ui.simple.visible=!1,this.m_ui.detail.visible=!0,this.m_ui.list.scrollBar.value=this._addValue):(this.m_ui.simple.visible=!0,this.m_ui.detail.visible=!1)},s.prototype.onClickClose=function(){this.m_ui.simple.visible=!0,this.m_ui.detail.visible=!1},s.prototype.onClickSimple=function(){this.m_ui.simple.visible=!1,this.m_ui.detail.visible=!0,this.m_ui.newMsg.visible=!1,this.m_ui.list.scrollBar.value=this.m_ui.list.scrollBar.max},s.prototype.onClickSend=function(){""!=this.m_ui.inputTxt.text?(t.SocketFacade.sendData({cmd:"chat",sub:"faction",word:this.m_ui.inputTxt.text}),this.m_ui.sendBtn.off(Laya.Event.CLICK,this,this.onClickSend),this.m_ui.inputTxt.text="",this._sendLoopTime=5,this.m_ui.sendBtn.filters=t.FiltersUtils.getGreyFilters(),this.m_ui.sendBtn.label=this._sendLoopTime+" 秒",Laya.timer.loop(1e3,this,this.loopTime)):t.WeakTips.show("请说点什么吧……")},s.prototype.loopTime=function(){this._sendLoopTime--,this.m_ui.sendBtn.label=this._sendLoopTime+" 秒",this._sendLoopTime<0&&(this.m_ui.sendBtn.filters=null,this.m_ui.sendBtn.label="发 送",this.m_ui.sendBtn.on(Laya.Event.CLICK,this,this.onClickSend),Laya.timer.clear(this,this.loopTime))},s.prototype.receiveMsg=function(t){if(this._curdata.words){var e=!1;this.m_ui.list.scrollBar.value==this.m_ui.list.scrollBar.max?e=!0:(this.m_ui.newMsg.visible=!0,this.m_ui.newTxt.text="【"+this.getPosStr(t.detail.pos)+"】"+t.detail.name+"："+t.content),this.m_ui.txt.text="【"+this.getPosStr(t.detail.pos)+"】"+t.detail.name+":"+t.content,this._curdata.words.push(t),this.m_ui.list.array=this._curdata.words,e&&(this.m_ui.list.scrollBar.value=this.m_ui.list.scrollBar.max)}},s.prototype.listChange=function(){this.m_ui.list.scrollBar.value>=this.m_ui.list.scrollBar.max&&(this.m_ui.newMsg.visible=!1),this.m_ui.list.scrollBar.value<-40&&!this._hasSendMore&&(this._canLoadMore?this.m_ui.list.array&&this.m_ui.list.array.length>0&&(this._hasSendMore=!0,t.SocketFacade.sendData({cmd:"chat",sub:"getrecord",lasttime:this.m_ui.list.array[0].atime})):this._tipsShow||(this._tipsShow=!0,Laya.timer.once(1500,this,this.tipShow),t.WeakTips.show("已无更多历史聊天消息！"))),this.m_ui.list.scrollBar.value<-30?this.m_ui.loadTips.visible=!0:this.m_ui.loadTips.visible=!1},s.prototype.tipShow=function(){this._tipsShow=!1},s.prototype.onClickToEnd=function(){this.m_ui.newMsg.visible=!1,this.m_ui.list.scrollBar.value=this.m_ui.list.scrollBar.max},s.prototype.onListRender=function(t,e){t.setData(this.m_ui.list.getItem(e))},s.prototype.getPosStr=function(e){return 0==e?"路人":t.FactionUserModel.getPosStr(e)},s}(t.BaseBox);t.FactionTalk=e;var i=function(e){function i(){e.call(this),this.rightinfo.on(Laya.Event.CLICK,this,this.onClick),this.leftinfo.on(Laya.Event.CLICK,this,this.onClick),this._useModel=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL)}return __extends(i,e),i.prototype.setData=function(t){t&&(this._curData=t,t.uid!=this._useModel.uid?(this.leftBox.visible=!0,this.rightBox.visible=!1,this.update("left")):(this.leftBox.visible=!1,this.rightBox.visible=!0,this.update("right")))},i.prototype.onClick=function(){this._curData&&t.Facade.callCommand(new t.UserInfoCommand(this._curData.uid+""))},i.prototype.update=function(e){this[e+"content"].text=this._curData.content,this._curData.uid==this._useModel.uid?this[e+"name"].text="【"+this.getPosStr(this._curData.detail.pos)+"】自己":this[e+"name"].text="【"+this.getPosStr(this._curData.detail.pos)+"】"+this._curData.detail.name,this[e+"time"].text=this.formateTime(this._curData.atime),this[e+"info"].tfLvl.text=this._curData.detail.level+"",this[e+"info"].tfVip.text=this._curData.detail.vip_level+"",this[e+"info"].tfLvl.text=this._curData.detail.level+"",1==this._curData.detail.sex?(this[e+"info"].femaleIcon.visible=!1,this[e+"info"].maleIcon.visible=!0,this[e+"info"].defaultHead.skin="ui/main/male.png"):(this[e+"info"].femaleIcon.visible=!0,this[e+"info"].maleIcon.visible=!1,this[e+"info"].defaultHead.skin="ui/main/female.png"),this[e+"info"].photo.loadImage(t.JSUtils.getHeadUrl(this._curData.detail.head_url),0,0,80,80)},i.prototype.getPosStr=function(e){return 0==e?"路人":t.FactionUserModel.getPosStr(e)},i.prototype.formateTime=function(e){var i=Math.floor(parseInt(this._curData.atime)/1e6),s=t.ServerClock.getServerDateByTime(1e3*i),n=s.getHours(),a=s.getMinutes(),o=s.getSeconds();return t.DateUtils.getDaysBySecond2(i)+" "+(n>=10?n:"0"+n)+":"+(a>=10?a:"0"+a)+":"+(o>=10?o:"0"+o)},i}(ui.talk.FactionTalkItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"TalkCommand":this._factionTalk||(this._factionTalk=new t.FactionTalk),this._factionTalk.show();break;case"TalkCloseCommand":this._factionTalk&&this._factionTalk.hide()}},s.prototype.getPluginName=function(){return e.PLUGIN_TALK},s}(t.Plugin);t.TalkModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.initialize=function(t){},i.prototype.doCommand=function(e){switch(e.getCommandName()){case"OpenTaskCmd":this.getTaskInfo(e.tabIndex);break;case"GetTaskGiftCmd":this.getTaskGift(e);break;case"GoCmd":var i=e.strCmd;t.Facade.callStrCommand(i);var s=i.split("|")[0];"1001"!=s&&"1017"!=s&&"1018"!=s&&this.taskView&&this.taskView.hide()}},i.prototype.getTaskInfo=function(e){void 0===e&&(e=0);var i=this.retrieveModel(t.ModelDef.GUIDE_MODEL);i.isGuiding&&i.guidetaskID>=241&&i.guidetaskID<=t.GuideModel.TASKID_END&&(e=1),t.XHR().Post({file:"petpk",cmd:"task",needreload:1,uid:t.Global.UID,subcmd:"GetUser"},this,function(i){0==i.result?(this.taskView||(this.taskView=new t.TaskView,this.taskView.on(t.ViewEvent.BASE_DESTROY,this,this.onTaskViewHide),this.taskView.show()),this.taskView.init(e,i.userinfo)):t.WeakTips.show(i.msg)})},i.prototype.getTaskGift=function(e){this.gtgc=e,t.XHR().Post({file:"petpk",cmd:"task",uid:t.Global.UID,subcmd:"GetPrize",id:e.id},this,this.getTaskGiftHandler)},i.prototype.getTaskGiftHandler=function(e){if(0==e.result){this.taskView&&this.taskView.setData(e.userinfo);var i=this.retrieveModel(t.ModelDef.GUIDE_MODEL),s=i.guidetaskID;0!=t.LayerMgr.getLayer(t.Layer.GUIDE).numChildren?(t.Facade.callCommand(new t.SyncChangeCmd(e)),this.taskView&&this.taskView.destroy()):this.gtgc.isMaster?t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0,this.gtgc.desc,Handler.create(this,this.checkMasterGift))):this.gtgc.isChip?t.Facade.callCommand(new t.SyncChangeCmd(e)):t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0,this.gtgc.desc)),241==s&&(i.guidetaskID=242),t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.GET_REWARD)),t.Facade.callCommand(new t.CheckAllStatusCommand)}else t.WeakTips.show(e.msg)},i.prototype.checkMasterGift=function(){this.taskView&&this.taskView.checkMasterGift()},i.prototype.onTaskViewHide=function(){this.taskView.off(t.ViewEvent.BASE_DESTROY,this,this.onTaskViewHide),this.taskView=null,Laya.loader.clearRes("ui/task/help_left.jpg"),Laya.loader.clearRes("ui/task/help_right.jpg"),Laya.loader.clearRes("ui/task/rw_jindutiao.png"),Laya.loader.clearRes("ui/task/tongyong_datuodongkuang.png"),t.Facade.callCommand(new t.CheckAllStatusCommand);var e=this.retrieveModel(t.ModelDef.GUIDE_MODEL);e.isGuiding||t.dispatch(t.MainModule.OPENBOXEVENT)},i.prototype.getPluginName=function(){return t.PluginDef.PLUGIN_TASK},i}(t.Plugin);t.TaskModule=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function n(){e.call(this,new ui.task.TaskUI,!0,!0,!0,!1),this.TOTAL_ACTIVE=100,this.PROGRESS_MAX_WIDTH=645,this.PROGRESS_WIDTH=645,this._canListChange=!0,this.display=this.skin,this.name="TaskViewBox",this.cacheAs="none",this.display.mainLayer.cacheAs="bitmap",this.setCloseButton(this.display.bg.closeBtn),this.display.bg.derocation_left.skin="ui/comp/rope_xia.png",this.display.bg.derocation_left.x=115,this.display.reddot_daily1.visible=!1,this.display.reddot_main1.visible=!1,this.display.reddot_daily2.visible=!1,this.display.reddot_main2.visible=!1,this.display.reddot_chip.visible=!1,this.display.menuTab1.labels="日\n\n常,主\n\n线,求\n\n助",this.display.menuTab1.selectHandler=new Handler(this,this.onTab),this.display.menuTab1.mouseEnabled=!0,this.display.menuTab2.labels="日\n\n常,主\n\n线,神\n\n器,求\n\n助",this.display.menuTab2.selectHandler=new Handler(this,this.onTab),this.display.menuTab2.mouseEnabled=!0,this.display.menuTab2.labelSize=20,this.display.chipBox.visible=!1,this.display.dailyList.itemRender=i,this.display.dailyList.selectEnable=!1,this.display.dailyList.renderHandler=new Handler(this,this.onDailyListRender),this.display.dailyList.array=[],this.display.masterList.itemRender=s,this.display.masterList.selectEnable=!1,this.display.masterList.renderHandler=new Handler(this,this.onMasterListRender),this.display.masterList.array=[],this.display.masterList.scrollBar.changeHandler=new Handler(this,this.masterListChange),this.display.masterUI.visible=!1,this._chipTaskList=new laya.ui.List,this._chipTaskList.vScrollBarSkin="ui/comp/vscroll.png",this._chipTaskList.scrollBar.visible=!1,this._chipTaskList.renderHandler=Handler.create(this,this.onChipListRender,null,!1),this._chipTaskList.itemRender=s,this.display.mainLayer.addChildAt(this._chipTaskList,this.display.mainLayer.getChildIndex(this.display.chipBox)),this._chipTaskList.x=233,this._chipTaskList.y=252,this._chipTaskList.repeatX=1,this._chipTaskList.repeatY=4,this._chipTaskList.spaceX=0,this._chipTaskList.spaceY=15,this._chipTaskList.height=431,this._chipTaskList.array=[],this.on(Laya.Event.CLICK,this,this.onClick);var n=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL);n.on(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdate),this.packModelUpdate(),this.display.doChipBtn.on(Laya.Event.CLICK,this,this.doChip),this.display.chipTipsBox.visible=!1,this.display.chipTipsBox.mouseEnabled=!1,this.display.chipClickPng.alpha=0,this.display.chipClickPng.on(Laya.Event.CLICK,this,this.showChipTips),this.display.weaponTipsBox.visible=!1,this.display.weaponTipsBox.mouseEnabled=!1,this.display.weaponClickPng.alpha=0,this.display.weaponClickPng.on(Laya.Event.CLICK,this,this.showWeaponTips)}return __extends(n,e),n.prototype.masterListChange=function(){this._canListChange&&0!=t.LayerMgr.getLayer(t.Layer.GUIDE).numChildren&&(this._canListChange=!1,this.display.masterList.scrollBar.value=0,this._canListChange=!0)},n.prototype.init=function(t,e){this.m_data=e,this._isFourTab=this.m_data.exchangetask&&this.m_data.exchangetask.length>0,this._isFourTab?(this.display.menuTab1.visible=!1,this.display.boxTab1.visible=!1):(this.display.menuTab2.visible=!1,this.display.boxTab2.visible=!1);var i=this._isFourTab?this.display.menuTab2:this.display.menuTab1;i.selectedIndex=t,this.setData(e)},n.prototype.setData=function(t){this.m_data=t,this.callLater(this.refreshList)},n.prototype.onTab=function(t){
this.callLater(this.refreshList)},n.prototype.onClick=function(e){var i=e.target.name,s=this.m_data.activegift;if(-1!=i.indexOf("btnTreasure_")){var n=Number(i.split("_")[1]);if(1!=s[n-1].status)this.showTips(this.display[i],s[n-1]);else{var a=new t.GetTaskGiftCmd;a.id=this.m_data.activegift[n-1].id,t.Facade.callCommand(a)}}},n.prototype.refreshList=function(){var t=this._isFourTab?this.display.menuTab2:this.display.menuTab1;if(0==t.selectedIndex){this.display.dailyUI.visible=!0,this.display.movieLayer.visible=!0,this.display.masterUI.visible=!1,this.display.helpUI.visible=!1,this.display.chipBox.visible=!1,this._chipTaskList.visible=!1,this.display.dailyList.array=this.m_data.dailytask,this.display.tfActive.text=this.m_data.totle_active_value;var e=this.m_data.totle_active_value/this.TOTAL_ACTIVE;0==e?this.display.progressBar.visible=!1:(this.display.progressBar.visible=!0,this.display.progressBar.width=Math.min(e*this.PROGRESS_WIDTH,this.PROGRESS_MAX_WIDTH));for(var i,s=this.m_data.activegift,n=!1,a=0;a<s.length;a++)this["needSkeleton"+(a+1)]=!1,i=s[a],this.display["btnTreasure_"+(a+1)].visible=2!=i.status,this.display["treasure_"+(a+1)].visible=2==i.status,this.display["btnTreasure_"+(a+1)].dataSource={id:i.id},1!=i.status?(this.display["btnTreasure_"+(a+1)].skin="ui/task/baoxiang_g.png",this.display["redDot_"+(a+1)].visible=!1,this["giftSkeketon"+(a+1)]&&(this["giftSkeketon"+(a+1)].stop(),this["giftSkeketon"+(a+1)].parent&&this["giftSkeketon"+(a+1)].parent.removeChild(this["giftSkeketon"+(a+1)]))):(this.display["btnTreasure_"+(a+1)].skin="ui/task/btn_treasure.png",this.display["redDot_"+(a+1)].visible=!0,this["needSkeleton"+(a+1)]=!0,n=!0);n&&(this.giftSkeketon1?this.addGiftSkeleton():this.giftParseComplete())}else 1==t.selectedIndex?(this.display.dailyUI.visible=!1,this.display.movieLayer.visible=!1,this.display.masterUI.visible=!0,this.display.helpUI.visible=!1,this.display.chipBox.visible=!1,this._chipTaskList.visible=!1,this.display.masterList.array=this.m_data.maintask):2==t.selectedIndex&&this._isFourTab?(this.display.dailyUI.visible=!1,this.display.movieLayer.visible=!1,this.display.masterUI.visible=!1,this.display.helpUI.visible=!1,this.display.chipBox.visible=!0,this._chipTaskList.visible=!0,this._chipTaskList.array=this.m_data.exchangetask||[],this.display.chipTipsBox.visible=!1,Laya.timer.clear(this,this.hideChipTipsBox),this.display.weaponTipsBox.visible=!1,Laya.timer.clear(this,this.hideWeaponTipsBox)):this.showHelp();this._isFourTab?(this.display.reddot_daily2.visible=this.m_data.daily_reddot>0,this.display.reddot_main2.visible=this.m_data.main_reddot>0,this.display.reddot_chip.visible=this.m_data.exchange_reddot>0):(this.display.reddot_daily1.visible=this.m_data.daily_reddot>0,this.display.reddot_main1.visible=this.m_data.main_reddot>0,this.display.reddot_chip.visible=!1)},n.prototype.showHelp=function(){this.display.dailyUI.visible=!1,this.display.movieLayer.visible=!1,this.display.masterUI.visible=!1,this.display.helpUI.visible=!0,this._chipTaskList.visible=!1,this.display.chipBox.visible=!1,t.XHR().Post({cmd:"task",subcmd:"Help"},this,this.onHelpData)},n.prototype.giftParseComplete=function(){for(var e=1;5>=e;e++)this["giftSkeketon"+e]=new t.AnimationSKe("assets/skeleton/icon_light.sk"),this["giftSkeketon"+e].scaleX=this["giftSkeketon"+e].scaleY=1.5;this.addGiftSkeleton()},n.prototype.addGiftSkeleton=function(){for(var t=1;5>=t;t++)this["needSkeleton"+t]&&this["giftSkeketon"+t]&&(this["giftSkeketon"+t].play(0,!0),this.display.movieLayer.addChild(this["giftSkeketon"+t]),this["giftSkeketon"+t].x=this.display["btnTreasure_"+t].x+40,this["giftSkeketon"+t].y=this.display["btnTreasure_"+t].y+35)},n.prototype.showTips=function(e,i){var s=e.localToGlobal(new laya.maths.Point(0,0)),n={},a="";n.name=i.name,n.typeDesc="条件："+i.desc,n.info="奖励物品：";for(var o=0;o<i.gift.attrs.length;o++)a+=i.gift.attrs[o].name+"\n";for(var r=0;r<i.gift.items.length;r++)a+=r==i.gift.items.length-1?i.gift.items[r].name:i.gift.items[r].name+"\n";n.desc=a,t.Tips.show(n,s)},n.prototype.onDailyListRender=function(t,e){t.setData(this.display.dailyList.getItem(e))},n.prototype.onMasterListRender=function(t,e){t.setData(this.display.masterList.getItem(e),!0)},n.prototype.onChipListRender=function(t,e){t.setData(this._chipTaskList.getItem(e),!1)},n.prototype.checkMasterGift=function(){var t=this.display.masterList.getCell(0);t&&t.getGift()},n.prototype.onHelpData=function(e){if(this.display.helpBtn1.on(Laya.Event.CLICK,this,this.onClickHelp),this.display.helpBtn2.on(Laya.Event.CLICK,this,this.onClickHelp),0==e.result&&e.info){var i=e.info[0];i&&(this.display.curNum1.text="当前次数："+i.curnum+"/"+i.targetnum,this.display.curActive1.text="当前活跃："+i.curnum*i.activevalue+"/"+i.targetnum*i.activevalue),i=e.info[1],i&&(this.display.curNum2.text="当前次数："+i.curnum+"/"+i.targetnum,this.display.curActive2.text="当前活跃："+i.curnum*i.activevalue+"/"+i.targetnum*i.activevalue)}else t.WeakTips.show(e.msg)},n.prototype.onClickHelp=function(e){switch(e.target.name){case"helpBtn1":t.ShareModule.shareMessage({title:["求求你求求你","可以帮帮我么","本鹅需要你的帮助"],desc:["游戏就要轻轻松松~企鹅会武功，斗斗狠轻松！","本鹅在此郑重的向你发起挑战，求虐求虐！","逗逼、搞笑还会武术的企鹅~来看看呗！","蓝瘦？香菇？这里有一群逗逼企鹅可以哄哄你哦~"],share_type:0,image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(5)),back:!0},null,3);break;case"helpBtn2":t.ShareModule.shareMessage({title:["求求你求求你","可以帮帮我么","本鹅需要你的帮助"],desc:["本鹅体力不足咯~ 求助亲来帮忙送点体力呀！感谢您啦~","人多力量大~朋友多了路好走！赶紧向你的好友求助吧~"],image_url:t.Global.ResHost+t.ResVersionControl.handelVersionUrl(t.ResPath().getShareBg(6)),share_type:0,back:!0},null,3)}},n.prototype.packModelUpdate=function(){var e=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL);this.display.chipNumTxt.text=e.getItemCount(100119)+"/100"},n.prototype.doChip=function(){var e=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL);e.getItemCount(100119)<100?t.WeakTips.show("玻璃碎片数量不足，需要100个玻璃碎片来合成一天酱油瓶"):t.XHR().Post({cmd:"storage",op:"exchange",exid:1},this,this.doChipHandler)},n.prototype.doChipHandler=function(e){0==e.result?t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0)):t.WeakTips.show("合成失败，"+e.msg)},n.prototype.showChipTips=function(){this.display.weaponTipsBox.visible=!1,Laya.timer.clear(this,this.hideWeaponTipsBox),this.display.chipTipsBox.visible=!this.display.chipTipsBox.visible,Laya.timer.clear(this,this.hideChipTipsBox),this.display.chipTipsBox.visible&&Laya.timer.once(4e3,this,this.hideChipTipsBox)},n.prototype.hideChipTipsBox=function(){this.display.chipTipsBox.visible=!1},n.prototype.showWeaponTips=function(){this.display.chipTipsBox.visible=!1,Laya.timer.clear(this,this.hideChipTipsBox),this.display.weaponTipsBox.visible=!this.display.weaponTipsBox.visible,Laya.timer.clear(this,this.hideWeaponTipsBox),this.display.weaponTipsBox.visible&&Laya.timer.once(4e3,this,this.hideWeaponTipsBox)},n.prototype.hideWeaponTipsBox=function(){this.display.weaponTipsBox.visible=!1},n.prototype.destroy=function(){Laya.timer.clear(this,this.hideChipTipsBox),Laya.timer.clear(this,this.hideWeaponTipsBox),this.display.chipClickPng.alpha=1,this.display.chipClickPng.off(Laya.Event.CLICK,this,this.showChipTips),this.display.weaponClickPng.alpha=1,this.display.weaponClickPng.off(Laya.Event.CLICK,this,this.showWeaponTips),this.display.doChipBtn.off(Laya.Event.CLICK,this,this.doChip);var i=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL);i.off(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdate),this.giftSkeketon1&&(this.giftSkeketon1.destroy(),this.giftSkeketon1=null),this.giftSkeketon2&&(this.giftSkeketon2.destroy(),this.giftSkeketon2=null),this.giftSkeketon3&&(this.giftSkeketon3.destroy(),this.giftSkeketon3=null),this.giftSkeketon4&&(this.giftSkeketon4.destroy(),this.giftSkeketon4=null),this.giftSkeketon5&&(this.giftSkeketon5.destroy(),this.giftSkeketon5=null),e.prototype.destroy.call(this),Laya.loader.clearRes("ui/task/chipBanner.jpg")},n}(t.BaseBox);t.TaskView=e;var i=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.destroy=function(){this.off(Laya.Event.CLICK,this,this.onClick),t.Tips.tipsClose(),e.prototype.destroy.call(this)},i.prototype.setData=function(e){this.m_data=e,e?(this.tfTitle.text=e.name,this.tfDesc1.text=e.desc,this.tfDesc2.text="次数 "+e.curnum+"/"+e.targetnum+"    活跃 "+e.curnum*e.activevalue+"/"+e.targetnum*e.activevalue,this.sign.visible=1==e.recommend,this.imgSymbol.graphics.clear(),this.imgSymbol.loadImage(t.ResPath().getPic(e.icon,t.ResourcePath.PATH_TASK),0,0,57,57),this.btnGo.visible=null!=this.m_data.command&&""!=this.m_data.command,this.imgSymbol.visible=null!=this.m_data.command&&""!=this.m_data.command,this.hasDone.visible=1==e.status,this.btnGo.on(Laya.Event.CLICK,this,this.onClick)):this.btnGo.off(Laya.Event.CLICK,this,this.onClick)},i.prototype.onClick=function(){t.Facade.callCommand(new t.GoCmd(this.m_data.command))},i}(ui.task.TaskDailyItemUI),s=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.destroy=function(){this.btnGet.off(Laya.Event.CLICK,this,this.getGift),this.btnGo2.off(Laya.Event.CLICK,this,this.go),e.prototype.destroy.call(this)},i.prototype.setData=function(e,i){if(this.m_data=e,this._isMaster=i,e){this.ico.skin=t.ResPath().getPic(e.icon,t.ResourcePath.PATH_TASK),this.tfMTitle.text=e.name,this.tfMDesc.text=e.desc,this.sign.visible=1==e.recommend,0==e.status?(this.btnGet.visible=!1,this.btnGo2.visible=!0,this.btnGo2.visible=null!=this.m_data.command&&""!=this.m_data.command,this.tfMProgressTxt.y=null!=this.m_data.command&&""!=this.m_data.command?78:45,this.tfMProgressTxt.text=e.curnum+"/"+e.targetnum,this.imgSymbol.visible=!1):1==e.status?(this.btnGet.visible=!0,this.btnGo2.visible=!1,this.tfMProgressTxt.text="",this.imgSymbol.visible=!0):(this.btnGet.visible=!1,this.btnGo2.visible=!1,this.tfMProgressTxt.text="",this.imgSymbol.visible=!1);var s=e.gift.attrs||[];e.gift.items&&(s=s.concat(e.gift.items));for(var a,o=[],r=0;r<s.length;r++)a=s[r],o.push({goodsIcon:{skin:t.ResPath().getPic(a.id,t.ResourcePath.PATH_GOODS)},countTxt:"X"+a.num});this.goodList.itemRender=n,this.goodList.array=s,this.goodList.renderHandler=new Handler(this,this.onListRender),this.btnGet.on(Laya.Event.CLICK,this,this.getGift),this.btnGo2.on(Laya.Event.CLICK,this,this.go)}else this.btnGet.off(Laya.Event.CLICK,this,this.getGift),this.btnGo2.off(Laya.Event.CLICK,this,this.go)},i.prototype.onListRender=function(t,e){t.setData(this.goodList.getItem(e))},i.prototype.getGift=function(){if(1==this.m_data.status){var e=new t.GetTaskGiftCmd;e.id=this.m_data.id,this._isMaster?(e.isMaster=!0,e.isChip=!1):(e.isMaster=!1,e.isChip=!0),e.desc="恭喜“"+this.m_data.desc+"”，获得奖励：",t.Facade.callCommand(e)}},i.prototype.go=function(){t.Facade.callCommand(new t.GoCmd(this.m_data.command))},i}(ui.task.TaskMasterItemUI),n=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.setData=function(e){this.off(laya.events.Event.CLICK,this,this.showTips),e&&(this.m_data=e,e.icon_id?this.goodsIcon.skin=t.ResPath().getPic(e.icon_id,t.ResourcePath.PATH_GOODS):this.goodsIcon.skin=t.ResPath().getPic(e.id,t.ResourcePath.PATH_GOODS),this.countTxt.text="X"+e.num,this.on(laya.events.Event.CLICK,this,this.showTips))},i.prototype.showTips=function(){var e,i={};e=this.localToGlobal(new laya.maths.Point(0,0)),i.name=this.m_data.name,this.m_data.desc?i.desc=this.m_data.desc:this.m_data.goods_desc&&(i.desc=this.m_data.goods_desc),this.m_data.effect_desc?i.info=this.m_data.effect_desc:this.m_data.effect&&(i.info=this.m_data.effect),t.Tips.show(i,e)},i}(ui.task.TaskMasterGiftItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,new ui.tower.TowerAwardUI,!0,!0),this._display=this.skin,this._awardDataParse=t.awardDataParse,this._layer=t.layer}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this),this._ani&&this._ani.destroy(),this._ani=null},i.prototype.onShowed=function(){e.prototype.onShowed.call(this),this._ani=new t.AnimationSKe(t.ResPath().getEffect("tower_xiangzi"),2),this._ani.x=667,this._ani.y=375,this._display.addChild(this._ani),this._ani.play(this.getFirstAni(),!1),this._display.clickBox.on(Laya.Event.CLICK,this,this.onClickTreasure)},i.prototype.onAniLoad=function(){},i.prototype.onClickTreasure=function(){this._display.clickBox.off(Laya.Event.CLICK,this,this.onClickTreasure),this._treasureAniEnd=!1,this._getAwardEnd=!1,this._ani.on(Laya.Event.STOPPED,this,this.onStop),this._ani.play(this.getSecondAni(),!1,!0),t.XHR().Post({cmd:"tower",op:"award"},this,this.onGetAward)},i.prototype.onStop=function(){this._treasureAniEnd=!0,this._getAwardEnd&&this.openRewardPanel()},i.prototype.getFirstAni=function(){return this._layer<=3?"mu_1":this._layer<=6?"tie_1":this._layer<=9?"tong_1":"jin_1"},i.prototype.getSecondAni=function(){return this._layer<=3?"mu":this._layer<=6?"tie":this._layer<=9?"tong":"jin"},i.prototype.openRewardPanel=function(){this._ani.visible=!1,this._ani.destroy(),this._ani=null,this._awardDataParse=new t.DecodeDataCmd(this._retData.award),t.Facade.callCommand(this._awardDataParse);for(var e="当前位于妖塔<span color='#ff0000'>第"+this._layer+"层</span>。获得奖励如下<br>",i=this._awardDataParse.rewardBoxArr.length,s=0;i>s;s++)e+=this._awardDataParse.rewardBoxArr[s].name+" X "+this._awardDataParse.rewardBoxArr[s].num+"<br>";t.ConfirmBox.show(new t.ConfirmBoxData({htmlStr:e,title:"领取奖励",isShowXBtn:!1,isShowCancelBtn:!1,confirmStr:"领取",callBackHandler:Handler.create(this,this.onClickAward)}))},i.prototype.onClickAward=function(){t.Facade.callCommand(new t.SyncChangeCmd(this._retData,!0)),this.hide()},i.prototype.onGetAward=function(e){0==e.result?(this._getAwardEnd=!0,this._retData=e,this._treasureAniEnd&&this.openRewardPanel()):(t.WeakTips.show(e.msg),this._ani.visible=!1,this._ani.destroy(),this._ani=null,Laya.timer.frameOnce(1,this,this.hide))},i}(t.BaseBox);t.TowerAwardView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"TowerCommand":if("main"==e.panel){var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),s=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);if(1==s.towerGuide&&20==i.level){var n=t.Facade.singleton.model.retrieveModel(t.ModelDef.GUIDE_MODEL);n.guidetaskID=200001}this._towerView||(this._towerView=new t.TowerView),t.SceneMgr.changeScene(this._towerView)}else if("status"==e.panel){var a=new t.TowerMyStatusView(e.paramData);a.show()}else if("award"==e.panel){var o=new t.TowerAwardView(e.paramData);o.show()}}},s.prototype.getPluginName=function(){return e.PLUGIN_TOWER},s}(t.Plugin);t.TowerModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(s){e.call(this,new ui.tower.TowerMyStatusUI,!0,!0),this._curIndex=-1,i.skillMap||(i.skillMap={300030:{desc:"生命上限提升",num:1},300031:{desc:"造成伤害提升",num:1},300032:{desc:"受到伤害降低",num:.5},300033:{desc:"速度值提升",num:1}}),this._display=this.skin,this.setCloseButton(this._display.back.btnClose),t.addListener(i.TOWER_MYSTATUS_CLICK_ITM,this,this.onSelectItem),this._curData=s,this._curData.tech_list.sort(this.lisSortCompare),this.updatePanel(s),this._display.sureBtn.on(Laya.Event.CLICK,this,this.onClickSure),this._display.resetBtn.on(Laya.Event.CLICK,this,this.onClickReset),this._display.subBtn.on(Laya.Event.CLICK,this,this.onClickSub),this._display.subBtn.on(Laya.Event.MOUSE_DOWN,this,this.onClickSubDown),this._display.subBtn.on(Laya.Event.MOUSE_UP,this,this.onClickSubUp),this._display.addBtn.on(Laya.Event.CLICK,this,this.onClickAdd),this._display.addBtn.on(Laya.Event.MOUSE_DOWN,this,this.onClickAddDown),this._display.addBtn.on(Laya.Event.MOUSE_UP,this,this.onClickAddUp)}return __extends(i,e),i.prototype.destroy=function(){t.removeListener(i.TOWER_MYSTATUS_CLICK_ITM,this,this.onSelectItem),Laya.timer.clear(this,this.onSubDown),Laya.timer.clear(this,this.onClickSub),Laya.timer.clear(this,this.onAddDown),Laya.timer.clear(this,this.onClickAdd),e.prototype.destroy.call(this)},i.prototype.updatePanel=function(e){if(e){i.leavePoint=e.point;for(var s=0;4>s;s++)e.tech_list[s]&&this._display["buffItem"+s].updateItem(e.tech_list[s],s);t.dispatch(i.TOWER_MYSTATUS_CLICK_ITM,0)}},i.prototype.onSelectItem=function(e){var s=this._curData.tech_list[e];if(s){this._curIndex=e;var n=this._display["buffItem"+e].tempNum;this._display.leaveTxt.text="剩余状态点："+i.leavePoint+"(长按可连续分配)",this._display.curTxt.text=s.name+"("+n+"级)",this._display.upTips.text="升级后："+i.skillMap[s.id].desc+i.skillMap[s.id].num*(n+1)+"%",0>=n?(this._display.subBtn.filters=t.FiltersUtils.getGreyFilters(),this._display.subBtn.mouseEnabled=!1,this.onClickSubUp()):(this._display.subBtn.filters=null,this._display.subBtn.mouseEnabled=!0),n>=100?(this._display.addBtn.filters=t.FiltersUtils.getGreyFilters(),this._display.addBtn.mouseEnabled=!1,this.onClickAddUp()):(this._display.addBtn.filters=null,this._display.addBtn.mouseEnabled=!0)}},i.prototype.onClickSure=function(){t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.CLICK_TOWER,"saveBtn"));var e=this.getBuffStr();t.XHR().Post({cmd:"tower",op:"set_techtree",value:e},this,this.onDataRet)},i.prototype.getBuffStr=function(){for(var t="",e=0;4>e;e++)t+=3!=e?this._display["buffItem"+e].getIdValue()+"|":this._display["buffItem"+e].getIdValue();return t},i.prototype.onDataRet=function(e){if(0==e.result||0==e.ret){this._curData.point=e.tech.point,this._curData.tech_list=e.tech.tech_list,this._curData.tech_list.sort(this.lisSortCompare),this.updatePanel(this._curData),t.dispatch(t.TowerView.TOWERVIEW_UPDATE_BUFF,this._curData);var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);if(i.towerGuide<5&&i.towerGuide++,3==i.towerGuide){var s=t.Facade.singleton.model.retrieveModel(t.ModelDef.GUIDE_MODEL);s.guidetaskID=200003,t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.CLICK_TOWER_SHOW))}this.hide()}else t.WeakTips.show(e.msg)},i.prototype.lisSortCompare=function(t,e){var i=t.id,s=e.id;return i>s?1:s>i?-1:0},i.prototype.onClickReset=function(){if(this._curIndex>=0){for(var t=0;4>t;t++)i.leavePoint+=this._display["buffItem"+t].tempNum,this._display["buffItem"+t].tempNum=0;for(var t=0;4>t;t++)i.leavePoint+=this._display["buffItem"+t].tempNum,this._display["buffItem"+t].numTxt.text="0",this._display["buffItem"+t].update();this.onSelectItem(this._curIndex)}},i.prototype.onClickSub=function(){this._curIndex>=0&&(this._display["buffItem"+this._curIndex].onClickSub()?this.onSelectItem(this._curIndex):this.onClickSubUp())},i.prototype.onClickAdd=function(){this._curIndex>=0&&(t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.CLICK_TOWER,"addBtn")),this._display["buffItem"+this._curIndex].onClickAdd()?this.onSelectItem(this._curIndex):this.onClickAddUp())},i.prototype.onClickSubDown=function(){Laya.timer.once(400,this,this.onSubDown)},i.prototype.onSubDown=function(){Laya.timer.loop(100,this,this.onClickSub)},i.prototype.onClickSubUp=function(){Laya.timer.clear(this,this.onSubDown),Laya.timer.clear(this,this.onClickSub)},i.prototype.onClickAddDown=function(){Laya.timer.once(400,this,this.onAddDown)},i.prototype.onAddDown=function(){Laya.timer.loop(100,this,this.onClickAdd)},i.prototype.onClickAddUp=function(){Laya.timer.clear(this,this.onAddDown),Laya.timer.clear(this,this.onClickAdd)},i.TOWER_MYSTATUS_CLICK_ITM="TOWER_MYSTATUS_CLICK_ITM",i.leavePoint=0,i}(t.BaseBox);t.TowerMyStatusView=e;var i=function(i){function s(){i.call(this),this._curIdnex=0,this.tempNum=0,this.base.on(Laya.Event.CLICK,this,this.onClickItem),this.selectIcon.visible=!1,t.addListener(e.TOWER_MYSTATUS_CLICK_ITM,this,this.onSelectItem)}return __extends(s,i),s.prototype.destroy=function(){t.removeListener(e.TOWER_MYSTATUS_CLICK_ITM,this,this.onSelectItem),i.prototype.destroy.call(this)},s.prototype.updateItem=function(i,s){this._curData=i,this._curIdnex=s,this.icon.graphics.clear(),this.icon.loadImage(t.ResPath().getPic(i.id,t.ResourcePath.PATH_BUFF),0,0,81,81),this.numTxt.text=i.num,this.tempNum=i.num,this.decTxt.text=e.skillMap[i.id].desc+"\n"+e.skillMap[i.id].num*i.num+"%",this.buffName.text=i.name},s.prototype.update=function(){this._curData&&(this.decTxt.text=e.skillMap[this._curData.id].desc+"\n"+e.skillMap[this._curData.id].num*this.tempNum+"%")},s.prototype.getIdValue=function(){return this._curData.id+":"+this.tempNum},s.prototype.onClickItem=function(){t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.CLICK_TOWER,"buffItem")),t.dispatch(e.TOWER_MYSTATUS_CLICK_ITM,this._curIdnex)},s.prototype.onSelectItem=function(t){t==this._curIdnex?this.selectIcon.visible=!0:this.selectIcon.visible=!1},s.prototype.onClickSub=function(){return this.tempNum>0?(this.tempNum--,e.leavePoint++,this.numTxt.text=this.tempNum+"",this.decTxt.text=e.skillMap[this._curData.id].desc+"\n"+e.skillMap[this._curData.id].num*this.tempNum+"%",!0):(t.WeakTips.show("已无法分配"),!1)},s.prototype.onClickAdd=function(){return e.leavePoint>0?(this.tempNum++,e.leavePoint--,this.numTxt.text=this.tempNum+"",this.decTxt.text=e.skillMap[this._curData.id].desc+"\n"+e.skillMap[this._curData.id].num*this.tempNum+"%",!0):(t.WeakTips.show("已无法分配"),!1)},s}(ui.tower.TowerBuffItemUI);t.TowerBuffItem=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.tower.TowerUI),this._aniPlaying=!1,this._win=!1,this._display=this.skin,this._layerWord=["","","（精英）","（首领）"],this._display.closeBtn.on(Laya.Event.CLICK,this,this.onClickCloseBtn),this._display.fightBtn.on(Laya.Event.CLICK,this,this.onClickFight),this._display.reviveBtn.on(Laya.Event.CLICK,this,this.onClickRevive),this._display.ruleBtn.on(Laya.Event.CLICK,this,this.onClickRule),this._display.myStatus.on(Laya.Event.CLICK,this,this.onClickStatus),this._display.rankBtn.on(Laya.Event.CLICK,this,this.onClickRank),this._display.buyBtn.on(Laya.Event.CLICK,this,this.onClickBuyAlive),this._display.bgTower.scrollRect=new Laya.Rectangle(0,237,1334,577),this._display.on(Laya.Event.CLICK,this,this.onClickPanel),this._display.treasureBox.mouseEnabled=!0,this._display.cashIcon.loadImage(t.ResPath().getPic("kDouYu",t.ResourcePath.PATH_GOODS),0,0,30,30),this.cacheAs="none",this._display.staticBox.cacheAs="bitmap",this._display.staticBox2.cacheAs="bitmap",this._display.staticBox3.cacheAs="bitmap",this._display.rewardTips.cacheAs="bitmap",this._display.buffTips.cacheAs="bitmap",this._positionArr=[{x:415,y:758},{x:766,y:594},{x:415,y:424},{x:766,y:260},{x:408,y:100},{x:748,y:-60}],this._positionArr2=[{x:766,y:758},{x:415,y:594},{x:766,y:424},{x:415,y:260},{x:748,y:100},{x:408,y:-60}],this._curBarrier=1,this._display.rewardTips.visible=!1,this._display.buffTxt.style.fontFamily="黑体",this._display.buffTxt.style.color="#fdf89d",this._display.buffTxt.style.fontSize=20,this._display.buffTxt.style.valign="top"}return __extends(i,e),i.prototype.destroy=function(){t.removeListener(i.TOWERVIEW_MONSTER_SELECTED_ITEM,this,this.onSelectedMonster),t.removeListener(i.TOWERVIEW_UPDATE_BUFF,this,this.updateBuff),e.prototype.destroy.call(this)},i.prototype.getSceneName=function(){return t.SceneDef.TOWER_SCENE},i.prototype.onClickCloseBtn=function(){t.Facade.callCommand(new t.HomeCommand)},i.prototype.onShowed=function(){this.resetImageSkin(this._display),this._aniPlaying=!1,this._display.buffTips.visible=!1,this._display.rewardTips.visible=!1,t.addListener(i.TOWERVIEW_MONSTER_SELECTED_ITEM,this,this.onSelectedMonster),t.addListener(i.TOWERVIEW_UPDATE_BUFF,this,this.updateBuff),this._qq||(this._qq=new t.AnimationSKe(t.ResData.qqUrl),this._qq.showSkinByName(t.Global.isBoy?"male":"female"),this._display.bgTower.addChild(this._qq),this._qq.visible=!1,this.updateTower()),this._curSelectMonsterIndex=-1,t.XHR().Post({cmd:"tower",op:"mainpage",needreload:"1"},this,this.onDataRet),this._display.buffIcons.updateBuffs()},i.prototype.onHided=function(){Laya.loader.clearRes("res/atlas/ui/tower.json"),Laya.loader.clearRes("ui/tower/bottomBack.jpg"),Laya.loader.clearRes(t.ResPath().getTowerImage(1)),Laya.loader.clearRes(t.ResPath().getTowerImage(2)),Laya.loader.clearRes(t.ResPath().getTowerImage(3)),Laya.loader.clearRes(t.ResPath().getTowerImage(4)),Laya.loader.clearRes("ui/lilian/bg.png"),Laya.loader.clearRes("ui/lilian/tongyong_taitouwuzi.png"),Laya.loader.clearRes("ui/lilian/dikuang.png"),t.removeListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.onFightEnd),this._qq&&(this._qq.destroy(),this._qq=null)},i.prototype.onDataRet=function(e){0==e.result?(this._curData=e,this.updatePanel(e)):t.WeakTips.show(e.msg)},i.prototype.updatePanel=function(t){t&&(this.updateBaseInfo(t),this.updateMonster(t),this.updateBuff(t.tech),this.updateTower(),this.updateFriendShow(),this.checkCanGetDailyReward(),this.checkGuide())},i.prototype.checkCanGetDailyReward=function(){if(1==this._curData.giftInfo.gift_status&&this._curData.giftInfo.gift_info&&this._curData.giftInfo.gift_info){var e=new t.DecodeDataCmd(this._curData.giftInfo.gift_info);t.Facade.callCommand(e);var i=new t.TowerCommand("award");i.paramData={awardDataParse:e,layer:this._curData.baseInfo.layer},t.Facade.callCommand(i)}},i.prototype.checkGuide=function(){var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);if(0==this._curData.baseInfo.layer&&2==e.towerGuide){var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.GUIDE_MODEL);i.guidetaskID=200002,t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.CLICK_TOWER_SHOW))}else if(4==e.towerGuide){var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.GUIDE_MODEL);0==this._curData.monsterInfo[0].status?i.guidetaskID=200004:i.guidetaskID=200005,t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.CLICK_TOWER_SHOW))}else 5==e.towerGuide&&(e.towerGuide++,t.Facade.callCommand(new t.PlayDramaCmd("1044")))},i.prototype.updateBaseInfo=function(t){this._curBarrier=t.baseInfo.barrier,this._curData.baseInfo.layer>0?this._curTotalBarrier=t.baseInfo.barrier+20*(this._curData.baseInfo.layer-1):this._curTotalBarrier=0,this._display.layerTxt.text=this.getLayerName(),this._display.buyCost.text=t.baseInfo.cost,1==t.baseInfo.alive?(this._display.reviveTxt.text="剩余复活次数："+t.baseInfo.revive,this._display.fightBtn.visible=!0,this._display.reviveBtn.visible=!1,this._display.buyBtn.visible=!1):(this._display.fightBtn.visible=!1,this._display.reviveBtn.visible=!1,this._display.buyBtn.visible=!1,t.baseInfo.revive>0?(this._display.reviveTxt.text="剩余复活次数："+t.baseInfo.revive,this._display.reviveBtn.visible=!0):(this._display.reviveTxt.text="剩余购买次数："+t.baseInfo.buyNum,this._display.buyBtn.visible=!0))},i.prototype.getLayerName=function(){return 0==this._curData.baseInfo.layer&&4==this._curData.baseInfo.barrier?"千层妖塔外":0==this._curData.baseInfo.layer&&5==this._curData.baseInfo.barrier?"妖塔大门前":"第"+this._curData.baseInfo.layer+"层--第"+this._curData.baseInfo.barrier+"关"+this._layerWord[this._curData.baseInfo.barrierType]},i.prototype.updateMonster=function(t,e){void 0===e&&(e=!1);var i=t.monsterInfo;if(i){if(i.sort(this.monsterSortCompare),-1==this._curSelectMonsterIndex){for(var s=[],n=0;n<i.length;n++)0==i[n].status&&s.push(i[n].index);1==s.length&&(this._curSelectMonsterIndex=s[0])}for(var n=0;3>n;n++)if(i[n]){e&&(i[n].status=1);var a=i[n].index==this._curSelectMonsterIndex;a&&1==i[n].status&&(this._curSelectMonsterIndex=-1,a=!1),this._display["monster"+n].updateItem(i[n],a,n)}else this._display["monster"+n].updateItem(null,!1,n)}},i.prototype.monsterSortCompare=function(t,e){var i=t.index,s=e.index;return i>s?1:s>i?-1:0},i.prototype.updateBuff=function(e){if(e){var i=e.tech_list;i.sort(this.lisSortCompare);for(var s=0;4>s;s++)this._display["buff"+s].graphics.clear(),i[s]?(this._display["buff"+s].loadImage(t.ResPath().getPic(i[s].id,t.ResourcePath.PATH_BUFF),0,0,74,74),this._display["buffNum"+s].text=i[s].num+""):this._display["buffNum"+s].text="BEN";e.point>0?this._display.redDot.visible=!0:this._display.redDot.visible=!1}},i.prototype.lisSortCompare=function(t,e){var i=t.id,s=e.id;return i>s?1:s>i?-1:0},i.prototype.updateTower=function(){if(this._curData){var e=Math.ceil(this._curBarrier/5);this._curBgUrl=t.ResPath().getTowerImage(e),this._display.bgTower.loadImage(this._curBgUrl);var i=e%2==0?this._positionArr2:this._positionArr,s=this._curBarrier%5==0?5:this._curBarrier%5;3>=s?this._display.bgTower.scrollRect.y=237-118.5*(s-1):this._display.bgTower.scrollRect.y=0;for(var n=0;5>n;n++)this._display["position"+n].x=i[n].x,this._display["position"+n].y=i[n].y;4==e?(this._display.position4.visible=!1,this._display.position5.visible=!0):(this._display.position4.visible=!0,this._display.position5.visible=!1),this.updateQQ()}},i.prototype.updateQQ=function(){if(this._curData&&this._qq){this._qq.visible=!0;var t=Math.ceil(this._curBarrier/5),e=t%2==0?this._positionArr2:this._positionArr,i=this._curBarrier%5-1<0?4:this._curBarrier%5-1;this._qq.scale(.6*(this._curBarrier%2==0?-1:1),.6),this._qq.play("act_breath_0",!0),this._qq.x=e[i].x+31,this._qq.y=e[i].y+30}},i.prototype.updateFriendShow=function(){this.updateFriendFramePosition(),this._friendShowData?this.setFriendShowData():t.XHR().Post({cmd:"tower",op:"fri"},this,this.onFriendShowDataRet)},i.prototype.onFriendShowDataRet=function(e){if(0==e.result){var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL).uid;this._friendShowData={};for(var s=e.friendlist,n=0;n<s.length;n++)i!=s[n].uid&&s[n].barrier>2&&(s[n].barrier=s[n].barrier-2,this._friendShowData[s[n].barrier]||(this._friendShowData[s[n].barrier]=[]),this._friendShowData[s[n].barrier].push(s[n]));this.setFriendShowData()}else t.WeakTips.show(e.msg)},i.prototype.updateFriendFramePosition=function(){for(var t=Math.ceil(this._curBarrier/5),e=t%2==0?this._positionArr2:this._positionArr,i=0;5>i;i++)e[i].x<500?(this._display["frame"+i].x=e[i].x-70,this._display["frame"+i].setBgScale(1)):(this._display["frame"+i].x=e[i].x+70,this._display["frame"+i].setBgScale(-1)),this._display["frame"+i].y=e[i].y-70},i.prototype.setFriendShowData=function(){for(var t=5*Math.floor(this._curBarrier/5)+1+20*(this._curData.baseInfo.layer-1),e=0;5>e;e++)this._friendShowData[t+e]?(this._display["frame"+e].visible=!0,this._display["frame"+e].setData(this._friendShowData[t+e])):this._display["frame"+e].visible=!1},i.prototype.showTreasureBox=function(){if(this._curData&&this._curData.baseInfo.reward_info&&this._curData.baseInfo.reward_info[0]){this._display.rewardTips.visible=!0;var e=new t.DecodeDataCmd(this._curData.baseInfo.reward_info[0]);t.Facade.callCommand(e);for(var i="",s=e.rewardBoxArr.length,n=0;s>n;n++)i+=n!=s-1?e.rewardBoxArr[n].name+" * "+e.rewardBoxArr[n].num+"\n":e.rewardBoxArr[n].name+" * "+e.rewardBoxArr[n].num;this._display.rewardTxt.text=i}},i.prototype.showBuffTips=function(t,e){this._display.buffTips.visible=!0;for(var i="",s=t.buffList,n=0;n<s.length;n++)i+="<span color='#ff7709'>"+s[n].name+"：</span><br>"+s[n].desc+"<br>";this._display.buffTxt.innerHTML=i;var a=232+this._display.buffTxt.height-140;232>a&&(a=232),this._display.buffBg.height=a,0==e?this._display.buffTips.x=104:1==e?this._display.buffTips.x=326:this._display.buffTips.x=525},i.prototype.onSelectedMonster=function(t){this._curSelectMonsterIndex=t.data.index,
this.showBuffTips(t.data,t.sort)},i.prototype.onClickFight=function(){if(!this._aniPlaying)if(this._curSelectMonsterIndex>=0){t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.CLICK_TOWER,"fight"));var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);e.towerGuide<5&&e.towerGuide++,t.XHR().Post({cmd:"tower",op:"battle",needreload:"1",index:this._curSelectMonsterIndex},this,this.onFightBack)}else t.WeakTips.show("请先选择要挑战的怪物")},i.prototype.onFightBack=function(e){0==e.result?(this._win=1==e.win,t.addListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.onFightEnd),t.Facade.callCommand(new t.FightCommand(e))):t.WeakTips.show(e.msg)},i.prototype.onFightEnd=function(){t.removeListener(t.FightStaticStr.FIGHT_COMPLETE,this,this.onFightEnd),this._win?t.XHR().Post({cmd:"tower",op:"mainpage",needreload:"1"},this,this.onWinData):(this._curData.baseInfo.alive=0,this.updateBaseInfo(this._curData))},i.prototype.onWinData=function(e){0==e.result?(this._curSelectMonsterIndex=-1,e.baseInfo.barrier>this._curBarrier||20==this._curBarrier&&1==e.baseInfo.barrier||5==this._curBarrier&&0==this._curData.baseInfo.layer&&1==e.baseInfo.barrier?(this.updateMonster(this._curData,!0),this._curData=e,this.moveQQ()):(this._curData=e,this.updatePanel(this._curData))):t.WeakTips.show(e.msg)},i.prototype.moveQQ=function(){if(this._qq){this._aniPlaying=!0,this._qq.play("act_move_0",!0),this._qq.scale(.6*(this._curBarrier%2==0?-1:1),.6);var t=Math.ceil(this._curBarrier/5),e=t%2==0?this._positionArr2:this._positionArr,i=this._curBarrier%5;0==i&&(i=5),Laya.Tween.to(this._qq,{x:e[i].x+31,y:e[i].y+30},2e3,null,Handler.create(this,this.onRunEnd)),2>=i&&Laya.Tween.to(this._display.bgTower.scrollRect,{y:this._display.bgTower.scrollRect.y-118.5},2e3)}},i.prototype.onRunEnd=function(){if(this._aniPlaying=!1,this.checkOverFriend(),0==this._curBarrier%5){this._curBarrier++,this._curBarrier>20&&(this._curBarrier=1);var e=Math.ceil(this._curBarrier/5);this._display.bgTower.loadImage(t.ResPath().getTowerImage(e),0,0,0,0,Handler.create(this,this.onChangeLayer))}else this._curBarrier++,this.updatePanel(this._curData)},i.prototype.checkOverFriend=function(){if(this._friendShowData&&this._friendShowData[this._curTotalBarrier]&&this._friendShowData[this._curTotalBarrier].length>0){var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL),i=this._friendShowData[this._curTotalBarrier][0],s={type:t.OpenBeyondShareBoxCmd.TYPE_SHARE_QIANCENGTA,users:[{name:e.name,msg:"千层塔第"+(this._curTotalBarrier+1)+"层",lv:e.level,sex:e.sex,headimgurl:e.headimgurl},{uid:i.uid,name:i.name,msg:"千层塔第"+this._curTotalBarrier+"层",lv:i.level?i.level:1,sex:i.sex?i.sex:1,headimgurl:i.url}]};if(t.Facade.callCommand(new t.SendWbGameBarCmd(i.uid,t.SendWbGameBarCmd.kSurpassTower)),this._friendShowData[this._curTotalBarrier].length>=2){var n=this._friendShowData[this._curTotalBarrier][1];s.users.push({uid:n.uid,name:n.name,msg:"千层塔第"+this._curTotalBarrier+"层",lv:n.level?n.level:1,sex:n.sex?n.sex:1,headimgurl:n.url})}t.Facade.callCommand(new t.OpenBeyondShareBoxCmd(s))}},i.prototype.onChangeLayer=function(){Laya.timer.frameOnce(1,this,this.delayShow)},i.prototype.delayShow=function(){this._display.bgTower.graphics.clear(),Laya.loader.clearRes(this._curBgUrl),this.updatePanel(this._curData)},i.prototype.onClickRevive=function(){this._curData&&(this._curData.baseInfo.revive>0?t.XHR().Post({cmd:"tower",op:"buylife",type:"free"},this,this.onReviveBack):t.WeakTips.show("您已无复活次数"))},i.prototype.onReviveBack=function(e){0==e.result?(t.WeakTips.show("复活成功"),t.XHR().Post({cmd:"tower",op:"mainpage",needreload:"1"},this,this.onDataRet)):t.WeakTips.show(e.msg)},i.prototype.onClickStatus=function(){if(this._curData){var e=new t.TowerCommand("status");e.paramData=this._curData.tech,t.Facade.callCommand(e)}},i.prototype.onClickRule=function(){var e="<img src='ui/comp/icon.png'></img><span>1.玩家每日都可以挑战千层妖塔，首次通关会获得经验和宝箱奖励。每日挑战过后，第二天还会根据玩家所在的层数获得经验和宝箱奖励。</span><br/><img src='ui/comp/icon.png'></img><span>2.妖塔中有普通，精英和首领关卡3种关卡。普通关卡有1只怪物，精英关卡有2只怪物，首领关卡有3只怪物。</span><br/><img src='ui/comp/icon.png'></img><span>3.妖塔中的怪物会携带强大的状态，怪物所在层数越高，状态的等级就越高。状态的类型每周一6:00会全部重新分配。</span><br/><img src='ui/comp/icon.png'></img><span>4.在精英关卡和首领关卡中，先被消灭的怪物会把自己的状态传递个剩余的怪物。请谨慎选择挑战顺序。</span><br/><img src='ui/comp/icon.png'></img><span>5.成功通过关卡后可以获得状态点，状态点可以强化玩家在挑战妖塔时的能力。</span><br/><img src='ui/comp/icon.png'></img><span>6.挑战失败后需要复活才能继续挑战。玩家每天可免费复活2次，免费次数用光后可付费复活，达人玩家有更多的付费复活次数。</span>";t.RulePanel.showRule(e,"")},i.prototype.onClickRank=function(){t.Facade.callCommand(new t.RankCMD(4))},i.prototype.onClickBuyAlive=function(){t.ConfirmBox.show(new t.ConfirmBoxData({htmlStr:this.getBuyAliveTips(),title:"提 示",isShowXBtn:!1,callBackHandler:Handler.create(this,this.checkDouYu)}))},i.prototype.checkDouYu=function(){t.PayConfirm.checkDouYu(this._curData.baseInfo.cost,Handler.create(this,this.sureToBuyAlive))},i.prototype.sureToBuyAlive=function(){t.XHR().Post({cmd:"tower",op:"buylife",type:"buy"},this,this.onBuyLife)},i.prototype.getBuyAliveTips=function(){return"<br><br>复活需要消耗：斗鱼*<font color='#ff0000'>"+this._curData.baseInfo.cost+"</font>，你确定要复活吗？"},i.prototype.onBuyLife=function(e){0==e.result?(t.WeakTips.show("购买成功"),t.Facade.callCommand(new t.SyncChangeCmd(e,!1)),t.XHR().Post({cmd:"tower",op:"mainpage",needreload:"1"},this,this.onDataRet)):t.WeakTips.show(e.msg)},i.prototype.onClickPanel=function(t){"treasureBox"!=t.target.name||this._display.rewardTips.visible?this._display.rewardTips.visible=!1:this.showTreasureBox(),"monsterItem"!=t.target.name&&(this._display.buffTips.visible=!1)},i.prototype.onGetReward=function(){t.XHR().Post({cmd:"tower",op:"award"},this,this.onGetAwardBack)},i.prototype.onGetAwardBack=function(e){0==e.result?t.Facade.callCommand(new t.SyncChangeCmd(e,!0)):t.WeakTips.show(e.msg)},i.TOWERVIEW_MONSTER_SELECTED_ITEM="TOWERVIEW_MONSTER_SELECTED_ITEM",i.TOWERVIEW_UPDATE_BUFF="TOWERVIEW_UPDATE_BUFF",i}(t.BaseScene);t.TowerView=e;var i=function(i){function s(){i.call(this),this.on(Laya.Event.CLICK,this,this.onClickItem),this.on(Laya.Event.MOUSE_DOWN,this,this.onClickMouseDown),this.on(Laya.Event.MOUSE_UP,this,this.onClickMouseUp),t.addListener(e.TOWERVIEW_MONSTER_SELECTED_ITEM,this,this.onSelected)}return __extends(s,i),s.prototype.destroy=function(){t.removeListener(e.TOWERVIEW_MONSTER_SELECTED_ITEM,this,this.onSelected),i.prototype.destroy.call(this)},s.prototype.updateItem=function(e,i,s){if(this._curData=e,this._curData){this._curSort=s,this.haveStatus.visible=!0,this.noneStatus.visible=!1,this.monsterName.text=e.name,this.levelTxt.text=e.level,this.head.scrollRect=new Laya.Rectangle(0,0,90,80),this.head.graphics.clear(),this.head.loadImage(t.ResPath().getPic(e.icon,t.ResourcePath.PATH_NPC_HEAD),0,0,90,90),this.beatedIcon.visible=!1,this.selectedStatus.visible=i;for(var n=0;3>n;n++)this["monsterBuff"+n].graphics.clear(),e.buffList[n]&&this["monsterBuff"+n].loadImage(t.ResPath().getPic(e.buffList[n].icon,t.ResourcePath.PATH_BUFF),3,4,45,45);i?this.scale(1.05,1.05):this.scale(.95,.95),1==e.status?(this.beatedIcon.visible=!0,this.base.filters=t.FiltersUtils.getGreyFilters()):this.base.filters=null}else this.noneStatus.visible=!0,this.haveStatus.visible=!1,this.scale(.95,.95)},s.prototype.onClickItem=function(){t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.CLICK_TOWER,"monster")),this._curData&&0==this._curData.status&&t.dispatch(e.TOWERVIEW_MONSTER_SELECTED_ITEM,{data:this._curData,sort:this._curSort})},s.prototype.onSelected=function(t){this._curData&&(this.selectedStatus.visible=this._curData.index==t.data.index,this.selectedStatus.visible?this.scale(1.05,1.05):this.scale(.95,.95))},s.prototype.onClickMouseDown=function(){},s.prototype.onClickMouseUp=function(){},s}(ui.tower.TowerMonsterItemUI);t.MonsterItem=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.initialize=function(t){this.SHOP_ID=100005},i.prototype.doCommand=function(e){var i=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL);if(i&&i.level<3)t.WeakTips.show("玩家3级开启强化功能");else switch(e.getCommandName()){case"OpenUpgradeCmd":this.wsModel||(this.wsModel=this.retrieveModel(t.ModelDef.WEOPEN_SKILL_MODEL),this.wsModel||(this.wsModel=new t.WeopenSkillModel,this.registerModel(this.wsModel)));var s=e,n=this.retrieveModel(t.ModelDef.GUIDE_MODEL);n.isGuiding&&245==n.guidetaskID&&n.nowStep>=3&&n.nowStep<=5&&(s.type=1),this.upgradeBox||(this.upgradeBox=new t.UpgradeBox(this.wsModel),this.upgradeBox.m_ui.menuTab.selectHandler=new Handler(this,this.onUpgradeTab),this.upgradeBox.on(t.ViewEvent.BOX_HIDE,this,this.onUpgradeBoxHide),t.addListener(t.ViewEvent.BOX_SHOW,this,this.onBoxShow)),this.upgradeBox.init(s.type),this.upgradeBox.isShowed||this.upgradeBox.show(),this.getUpgradeInfo(s.type);break;case"OpenUpOpCmd":var a=e;this.getDetailInfo(a);break;case"UpgradeCmd":this.upgrade(e)}},i.prototype.getUpgradeInfo=function(e){e==t.OpenUpgradeCmd.WEAPON&&this.wsModel.isWeaponNew||e==t.OpenUpgradeCmd.SKILL&&this.wsModel.isSkillNew?this.showUpgradeBox(e):t.XHR().Post({file:"petpk",cmd:"upgrade",uid:t.Global.UID,op:0==e?"weaponlist":"skilllist"},this,function(i){if(0==i.result){this.wsModel.setUpgradeData(i),this.showUpgradeBox(e),t.Facade.callCommand(new t.SyncChangeCmd(i));var s=this.retrieveModel(t.ModelDef.GUIDE_MODEL);if(s.isGuiding&&245==s.guidetaskID&&t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.SKILL_TAB_CHANGE)),e==t.OpenUpgradeCmd.WEAPON){var n=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);if(0==n.getDailyDataValue(t.ServerSetDataModel.KEY_DAILY_UPGRADE_ISAGE)){for(var a,o=[],r=0;r<i.weapons.length;r++)a=i.weapons[r],1==a.isage&&1==a.own&&a.left_time<86400&&o.push({goodsIcon:{skin:t.ResPath().getPic(a.id,t.ResourcePath.PATH_WEAPON,10)}});if(o.length>0){var h=new t.UpgradePop(o);h.show(),n.setDailyDataValue(t.ServerSetDataModel.KEY_DAILY_UPGRADE_ISAGE,1)}}}}else t.WeakTips.show(i.msg)},!0)},i.prototype.showUpgradeBox=function(t){this.upgradeBox&&(this.upgradeBox.updateList(t),this.upgradeBox.updateData())},i.prototype.onUpgradeTab=function(t){this.getUpgradeInfo(t)},i.prototype.onBoxShow=function(){var e=t.Facade.retrieveModel(t.ModelDef.GUIDE_MODEL);245==e.guidetaskID&&"TaskViewBox"==t.BoxMgr.boxs[t.BoxMgr.boxs.length-1].boxName&&this.onUpgradeBoxHide()},i.prototype.onUpgradeBoxHide=function(){t.removeListener(t.ViewEvent.BOX_SHOW,this,this.onBoxShow),this.upgradeBox.off(t.ViewEvent.BOX_HIDE,this,this.onUpgradeBoxHide),this.upgradeBox.destroy(),this.wsModel.isSkillNew=!1,this.wsModel.isWeaponNew=!1,this.upgradeBox=null,this.upOpBox&&(this.upOpBox.destroy(),this.upOpBox=null),this.unregisterPlugin()},i.prototype.getDetailInfo=function(e){t.XHR().Post({file:"petpk",cmd:"upgrade",uid:t.Global.UID,op:"page",type:0==e.type?"weapon":"skill",id:e.id},this,function(i){0==i.result?(i.type=e.type,this.showUpOpBox(i)):t.WeakTips.show(i.msg)})},i.prototype.showUpOpBox=function(e){this.upOpBox||(this.upOpBox=new t.WsOpBox),this.upOpBox.show(),this.upOpBox.setData(e),t.WsOpBox.HAS_UPGRADE_SUCCESS=!1},i.prototype.upgrade=function(e){t.XHR().Post({file:"petpk",cmd:"upgrade",uid:t.Global.UID,op:"upgrade",type:0==e.type?"weapon":"skill",id:e.id,times:e.times},this,function(i){if(0==i.result){if("suc"==i.res){if(this.upgradeBox){var s=this.wsModel.getWeopenOrSkillById(e.id,e.type);s.level=i.level,s.name=i.name,t.dispatch(t.ShareModule.SHARE_MODULE_EVENT,{type:1,data:s}),this.upgradeBox.refreshList(),10==i.level&&(0==e.type?this.wsModel.weapon_top_num++:this.wsModel.skill_top_num++)}this.upOpBox&&(this.upOpBox.playSuccAni(),this.upOpBox.stopBatch(),t.WsOpBox.HAS_UPGRADE_SUCCESS=!0)}else{var n="强化失败";i.reslist&&i.reslist.length>0&&(n+="，"+i.reslist[0].msg),t.Facade.callCommand(new t.ShowChangeRewardCmd([n],100,"#999999"))}i.hasOwnProperty("rollmsg_id")&&t.Facade.callCommand(new t.RollRefreshCmd(i.rollmsg_id)),t.Facade.callCommand(new t.SyncChangeCmd(i)),this.upOpBox&&(this.upOpBox.updateData(i),this.upOpBox.checkPackItem(i.goods_num)),this.upgradeBox&&(this.wsModel.setUpgradeData(i),this.upgradeBox.updateData()),e.finish()}else this.upOpBox&&this.upOpBox.stopBatch(),10017==i.result?t.Facade.callCommand(new t.BuyCommand(this.SHOP_ID)):t.WeakTips.show(i.msg)})},i.prototype.getPluginName=function(){return t.PluginDef.PLUGIN_UPGRADE},i}(t.Plugin);t.UpgradeModule=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Animation,i=Laya.Ease,s=Laya.Point,n=Laya.Sprite,a=function(e){function i(i){e.call(this,new ui.upgrade.UpgradeListUI,!0,!0,!0,!1),this.PROP_ID=100006,this.SHOP_ID=100005,this.m_ui=this.skin,this.name="UpgradeBox",this.m_wsModel=i,this.setCloseButton(this.m_ui.bg.closeBtn),this.m_ui.btnAdd.on(Laya.Event.CLICK,this,this.buyGood),this.um=t.Facade.retrieveModel(t.ModelDef.SELF_USER_MODEL),this.um.level<30?(this.m_ui.menuTab.labels="武\n\n器,技\n\n能",this.m_ui.d2.y=this.m_ui.d1.y-2,this.m_ui.d1.visible=!1):(this.m_ui.menuTab.labels="武\n\n器,技\n\n能,重\n\n修",this.m_ui.reTab.labels="武器,技能",this.m_ui.reTab.selectHandler=new Handler(this,this.onReplaceTab),this.m_ui.lst1.itemRender=r,this.m_ui.lst1.renderHandler=new Handler(this,this.onLst1Render),this.m_ui.lst1.selectEnable=!0,this.m_ui.lst1.selectHandler=new Handler(this,this.onSelectLst1),this.m_ui.lst1.array=[],this.m_ui.lst1.scrollBar.hide=!0,this.m_ui.lst2.itemRender=r,this.m_ui.lst2.renderHandler=new Handler(this,this.onLst2Render),this.m_ui.lst2.selectEnable=!0,this.m_ui.lst2.selectHandler=new Handler(this,this.onSelectLst2),this.m_ui.lst2.array=[],this.m_ui.lst2.scrollBar.hide=!0),this.m_ui.upgradeComp.visible=!1,this.m_ui.replaceComp.visible=!1,this.m_ui.list.itemRender=o,this.m_ui.list.selectEnable=!1,this._canListChange=!0,this.m_ui.list.renderHandler=new Handler(this,this.onListRender),this.m_ui.btnForget.on(Laya.Event.CLICK,this,this.onForget),this.m_ui.btnGrasp.on(Laya.Event.CLICK,this,this.onGrasp),this.m_ui.btnReRule.on(Laya.Event.CLICK,this,this.showGraspRule),this.m_ui.btnRule.on(Laya.Event.CLICK,this,this.onOpenRule),this.m_ui.list.array=[],this.m_ui.list.scrollBar.hide=!0,this.m_ui.list.scrollBar.changeHandler=new Handler(this,this.listChange),this.m_ui.reddot.visible=!1,this.pm=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL),this.pm.on(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdate),this.packModelUpdate()}return __extends(i,e),i.prototype.init=function(t){this.m_ui.menuTab.selectedIndex=t,this.m_ui.bg.derocation_left.skin="ui/comp/rope_xia.png",this.m_ui.bg.derocation_left.x=120},i.prototype.buyGood=function(){t.Facade.callCommand(new t.BuyCommand(this.SHOP_ID))},i.prototype.updateList=function(t){this.m_type=t,this.refreshList()},i.prototype.refreshList=function(){0==this.m_type?(this.m_ui.upgradeComp.visible=!0,this.m_ui.replaceComp.visible=!1,this.m_ui.list.array=this.m_wsModel.weopens):1==this.m_type?(this.m_ui.upgradeComp.visible=!0,this.m_ui.replaceComp.visible=!1,this.m_ui.list.array=this.m_wsModel.skills):(this.m_ui.upgradeComp.visible=!1,this.m_ui.replaceComp.visible=!0,this.m_ui.reTab.selectedIndex=0)},i.prototype.updateData=function(){this.m_ui.tfWeaponForce.text="武器战斗力："+this.m_wsModel.weapon_atk,this.m_ui.tfSkillForce.text="技能战斗力："+this.m_wsModel.skill_atk,this.m_ui.tfMaxWeaponCount.text="10星武器数："+this.m_wsModel.weapon_top_num,this.m_ui.tfMaxSkillCount.text="10星技能数："+this.m_wsModel.skill_top_num,this.m_ui.tfReCount.text="剩余重修次数："+this.m_wsModel.exchange_times,this.m_ui.tfReLevel.text="下个重修等级："+(0==this.m_wsModel.exchange_next_level?"--":this.m_wsModel.exchange_next_level),this.m_ui.reddot.visible=1==this.m_wsModel.exchange_reddot&&this.um.level>=30},i.prototype.initReView=function(){},i.prototype.onReplaceTab=function(){this.m_ui.lst1.array=[],this.m_ui.lst2.array=[];var e;e=0==this.m_ui.reTab.selectedIndex?this.m_wsModel.weopens:this.m_wsModel.skills;for(var i,s=[],n=[],a=0;a<e.length;a++)i=e[a],1!=i.isage&&1!=i.isvip&&(i.isHas?s.push(i):n.push(i));this.m_ui.lst1.array=s,this.m_ui.lst2.array=n,this.m_ui.lst1.selectedIndex=-1,this.m_ui.lst2.selectedIndex=-1,this.m_ui.maskComp.visible=!1,this.m_ui.btnForget.label="遗  忘",this.leftLocked=!1,this.preSelectedLeft&&this.preSelectedLeft.setSelected(!1),this.preSelectedRight&&this.preSelectedRight.setSelected(!1),this.preSelectedLeft=null,this.preSelectedRight=null,this.m_ui.tfTips1.text="",t.Util.toGrayAndDisabled(this.m_ui.btnForget),t.Util.toGrayAndDisabled(this.m_ui.btnGrasp)},i.prototype.onSelectLst1=function(){if(this.preSelectedLeft&&this.preSelectedLeft.setSelected(!1),this.preSelectedLeft=this.m_ui.lst1.selection,this.preSelectedLeft.setSelected(!0),this.m_wsModel.exchange_times<=0)this.m_ui.tfTips1.text="重修次数不足",t.Util.toGray(this.m_ui.btnForget);else{var e=this.m_ui.lst1.selectedItem;this.m_ui.tfTips1.text="返还黄金卷轴*"+e.returnnum,t.Util.enable(this.m_ui.btnForget)}},i.prototype.onSelectLst2=function(){this.preSelectedRight&&this.preSelectedRight.setSelected(!1),this.preSelectedRight=this.m_ui.lst2.selection,this.preSelectedRight.setSelected(!0)},i.prototype.onForget=function(){if(this.leftLocked)this.m_ui.maskComp.visible=!1,this.m_ui.btnForget.label="遗  忘",this.leftLocked=!1,t.Util.toGrayAndDisabled(this.m_ui.btnGrasp);else{if(this.m_wsModel.exchange_times<=0)return void t.WeakTips.show("重修次数不足");var e=this.m_ui.lst1.selectedItem;if(!e)return void t.WeakTips.show("请先选择需要遗忘的武器或技能");this.m_ui.maskComp.visible=!0,this.m_ui.btnForget.label="重  选",this.leftLocked=!0,t.Util.enable(this.m_ui.btnGrasp)}},i.prototype.onGrasp=function(){var e=this.m_ui.lst1.selectedItem;if(!e)return void t.WeakTips.show("请先选择需要遗忘的武器或技能");var i=this.m_ui.lst2.selectedItem;if(!i)return void t.WeakTips.show("请先选择需要领悟的武器或技能");var s=new t.ConfirmBoxData({isShowCancelBtn:!0,contentStr:"你将失去"+e.name+"(等级："+e.level+"),获得"+i.name+"(等级："+i.level+")"+(e.returnnum>0?"。并获得返还黄金卷轴*"+e.returnnum:"")+"。确定要这样做吗？",callBackHandler:new Handler(this,this.grasp)});t.ConfirmBox.show(s)},i.prototype.grasp=function(){var e=this.m_ui.lst1.selectedItem,i=this.m_ui.lst2.selectedItem;t.XHR().Post({file:"petpk",cmd:"upgrade",uid:t.Global.UID,op:"exchange",type:0==this.m_ui.reTab.selectedIndex?"weapon":"skill",src_id:e.id,dst_id:i.id},this,this.onGraspResult)},i.prototype.onGraspResult=function(e){var i=this.m_ui.lst1.selectedItem,n=this.m_ui.lst2.selectedItem;if(0==e.result){t.Facade.callCommand(new t.SyncChangeCmd(e)),t.WeakTips.show(e.msg),i.own=0,i.level=0,n.own=1,n.level=0;var a=this.m_ui.lst1.selection,o=this.m_ui.lst2.selection,r=a.localToGlobal(new s(a.width/2,a.height/2)),l=o.localToGlobal(new s(o.width/2,o.height/2)),c=new h(t.ResPath().getPic(i.id,i.type==t.WSDef.WEAPON?t.ResourcePath.PATH_WEAPON:t.ResourcePath.PATH_SKILL,0),r,l);this.m_ui.addChild(c);var d=new h(t.ResPath().getPic(n.id,n.type==t.WSDef.WEAPON?t.ResourcePath.PATH_WEAPON:t.ResourcePath.PATH_SKILL,0),l,r);this.m_ui.addChild(d),this.m_wsModel.exchange_times--,Laya.timer.once(600,this,this.updata)}else t.WeakTips.show(e.msg)},i.prototype.updata=function(){this.onReplaceTab(),this.updateData()},i.prototype.packModelUpdate=function(){this.m_ui.tfCount.text=""+this.pm.getItemCount(this.PROP_ID)},i.prototype.onListRender=function(t,e){t.setData(this.m_ui.list.getItem(e))},i.prototype.onLst1Render=function(t,e){t.setData(this.m_ui.lst1.getItem(e))},i.prototype.onLst2Render=function(t,e){t.setData(this.m_ui.lst2.getItem(e))},i.prototype.onOpenRule=function(){var e="<img src='ui/comp/icon.png'></img>强化可以提升武器技能的伤害和效果，还可以解锁武器技能的高级表现。<br><img src='ui/comp/icon.png'></img>不同星级的武器技能强化时消耗不同数量的黄金卷轴，每次强化都有概率成功。<br><img src='ui/comp/icon.png'></img>强化失败时获得祝福值。当祝福值达到上限时，下一次强化必成功。<br><img src='ui/comp/icon.png'></img>祝福值会在强化成功后清空。";t.RulePanel.showRule(e,"")},i.prototype.showGraspRule=function(){var e="<img src='ui/comp/icon.png'></img>重修武器只能领悟其他武器，重修技能只能领悟其他技能。<br><img src='ui/comp/icon.png'></img>升级到30、40、50、60、66级可以各获得1个重修机会。<br><img src='ui/comp/icon.png'></img>重修成功后会根据遗忘的武器技能及星级返还一定数量的黄金卷轴。";t.RulePanel.showRule(e,"")},i.prototype.listChange=function(){this._canListChange&&t.LayerMgr.getLayer(t.Layer.GUIDE).numChildren>0&&(this._canListChange=!1,this.m_ui.list.scrollBar.value=0,this._canListChange=!0)},i.prototype.destroy=function(){this.m_ui&&this.m_ui.list&&(this.m_ui.list.scrollBar.changeHandler=null),this.pm.off(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdate),e.prototype.destroy.call(this)},i}(t.BaseBox);t.UpgradeBox=a;var o=function(e){function i(){e.call(this)}return __extends(i,e),i.prototype.destroy=function(){this.off(Laya.Event.CLICK,this,this.onClick),e.prototype.destroy.call(this)},i.prototype.setData=function(e){if(this.icon.graphics.clear(),e){e.level=1==e.isage?10:e.level,this.m_data=e,this.imgActivity.visible=1==e.hot,this.tfLv.text=e.level+"",this.flagHc.visible=e.level<10&&1==e.hc&&1==e.own,this.flagC.visible=e.level<10&&1==e.c&&1==e.own;var i=t.ResPath().getPic(e.id,e.type==t.WSDef.WEAPON?t.ResourcePath.PATH_WEAPON:t.ResourcePath.PATH_SKILL,e.level);this.icon.loadImage(i,0,0,90,90),e.isHas?t.Util.enable(this):t.Util.toGray(this),this.on(Laya.Event.CLICK,this,this.onClick)}else this.off(Laya.Event.CLICK,this,this.onClick)},i.prototype.onClick=function(){var e=this.m_data,i=new t.OpenUpOpCmd;i.type=e.type,i.id=e.id,t.Facade.callCommand(i)},i}(ui.upgrade.UpgradeListItemUI),r=function(i){function s(){i.call(this),this.selected=!1}return __extends(s,i),s.prototype.destroy=function(){this.off(Laya.Event.CLICK,this,this.onClick),i.prototype.destroy.call(this)},s.prototype.setData=function(e){if(this.icon.graphics.clear(),e){this.m_data=e,this.tfLv.text=e.level+"",this.viewBtn.visible=this.selected;var i=t.ResPath().getPic(e.id,e.type==t.WSDef.WEAPON?t.ResourcePath.PATH_WEAPON:t.ResourcePath.PATH_SKILL,e.level);this.icon.loadImage(i,0,0,80,80),this.selected?this.on(Laya.Event.CLICK,this,this.onClick):this.off(Laya.Event.CLICK,this,this.onClick)}},s.prototype.setSelected=function(t){t?(this.ani||(this.ani=new e,this.ani.loadAtlas("res/atlas/ui/item_movie.json"),this.ani.interval=95,this.ani.index=1,this.ani.x=this.icon.x-57,this.ani.y=this.icon.y-58),this.addChild(this.ani),this.ani.play(),this.bx.scale(1.05,1.05),this.selected=!0,this.viewBtn.visible=!0,this.parent.setChildIndex(this,this.parent.numChildren-1)):(this.ani&&(this.ani.stop(),this.ani.removeSelf()),this.selected=!1,this.viewBtn.visible=!1,this.bx.scale(1,1))},s.prototype.onClick=function(){this.selected&&this.showAnimtion()},s.prototype.showAnimtion=function(){if(this.m_data){var e={};e.uptype=this.m_data.type==t.WSDef.WEAPON?1:2,e.name=this.m_data.name,e.desc=this.m_data.desc,e.id=this.m_data.id,e.isage=this.m_data.isage,t.Facade.callCommand(new t.ShowUpAnimationCMD(e))}},s}(ui.upgrade.ReplaceItemUI),h=function(t){function e(e,s,n){t.call(this),this.w=80,this.h=80,this.loadImage(e,0,0,this.w,this.h),this.width=this.w,this.height=this.h,this.x=s.x,this.y=s.y,Laya.Tween.to(this,{x:n.x,y:n.y,scaleX:1,scaleY:1},500,i.linearOut,new Handler(this,this.destroy))}return __extends(e,t),e}(n);t.WsFlyHelpItem=h}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e){t.call(this,new ui.upgrade.UpgradePopupUI,!0,!0),this.display=this.skin,this.name="PopConfirm",this.canClickModelToClose=!1,this.setCloseButton(this.display.closeBtn),this.display.lst.array=e,this.display.lst.x=13+102*(5-e.length)/2,this.display.queDingBtn.on(Laya.Event.CLICK,this,this.hide)}return __extends(e,t),e.prototype.destroy=function(){this.display.queDingBtn.off(Laya.Event.CLICK,this,this.hide),t.prototype.destroy.call(this)},e}(t.BaseBox);t.UpgradePop=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.upgrade.UpgradeOpUI,!0,!1,!0,!1),this.m_djPath="assets/skeleton/upgrade_success.sk",this.PROP_ID=100006,this.SHOP_ID=100005,this.name="WsOpBox",this.ui=this.skin,this.cacheAs="none",this.ui.mainLayer.cacheAs="bitmap",this.setCloseButton(this.ui.bg.btnClose),this.ui.btnUpgrade.on(Laya.Event.MOUSE_DOWN,this,this.onMouseDown),this.pm=t.Facade.retrieveModel(t.ModelDef.PACK_MODEL),this.pm.on(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdate),this.parseComplete(),this.ui.imgPhoto.on(Laya.Event.CLICK,this,this.showAnimtion),this.ui.viewBtn.on(Laya.Event.CLICK,this,this.showAnimtion)}return __extends(i,e),i.prototype.parseComplete=function(){this.qhSk=new t.AnimationSKe(this.m_djPath),this.qhSk.x=670,this.qhSk.y=180,this.ui.aniLayer.addChild(this.qhSk),this.ui.aniLayer.removeSelf()},i.prototype.onShowed=function(){this.stage.on(Laya.Event.MOUSE_UP,this,this.stopBatch),e.prototype.onShowed.call(this)},i.prototype.onHided=function(){this.stage.off(Laya.Event.MOUSE_UP,this,this.stopBatch),e.prototype.onHided.call(this)},i.prototype.onMouseDown=function(){var e=t.Facade.singleton.model.retrieveModel(t.ModelDef.GUIDE_MODEL);245!=e.guidetaskID?this.startBatch():this.upgradeOnce()},i.prototype.startBatch=function(){Laya.timer.loop(200,this,this.upgradeOnce),this.upgradeOnce()},i.prototype.stopBatch=function(){Laya.timer.clear(this,this.upgradeOnce),this.destroyed||(this.ui.btnUpgrade.state=1)},i.prototype.upgradeOnce=function(){if(this.m_data.level>=10)return void this.stopBatch();if(this.pm.getItemCount(this.PROP_ID)>=this.m_data.cost_num){var e=new t.UpgradeCmd;e.type=this.m_data.type,e.id=this.m_data.id,e.times=1,e.level=this.m_data.level,e.bless=this.m_data.bless,t.Facade.callCommand(e)}else{this.stopBatch();var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.GUIDE_MODEL);245!=i.guidetaskID&&t.Facade.callCommand(new t.BuyCommand(this.SHOP_ID))}},i.prototype.setData=function(e){this.m_data=e,1==this.m_data.isage&&(this.m_data.level=10,e.level=10),this.ui.tfName.text=e.name,this.ui.tfRate.text=e.rate,"中"==e.rate?this.ui.tfRate.color="#ffe71c":"低"==e.rate?this.ui.tfRate.color="#f63624":this.ui.tfRate.color="#60ff00",this.ui.tfCost.text="黄金卷轴*"+e.cost_num+"("+this.pm.getItemCount(this.PROP_ID)+")",this.ui.tfActivity.visible=1==e.hot,this.ui.tfProgress.text="祝福值："+e.bless+"/"+e.max_bless,this.ui.progressBar.value=e.bless/e.max_bless;var i=t.ResPath().getPic(e.id,e.type==t.WSDef.WEAPON?t.ResourcePath.PATH_WEAPON:t.ResourcePath.PATH_SKILL,e.level);this.ui.imgPhoto.graphics.clear(),this.ui.imgPhoto.loadImage(i,0,0,90,90),this.ui.compL_c.visible=this.m_data.type==t.WSDef.WEAPON,this.ui.compR_c.visible=this.m_data.type==t.WSDef.WEAPON,this.ui.compL_d.y=this.m_data.type==t.WSDef.WEAPON?74:37,this.ui.compR_d.y=this.m_data.type==t.WSDef.WEAPON?74:37,1==e.own?(this.ui.imgNotGot.visible=!1,this.ui.compL.visible=!0,this.ui.tfLv_l.text=e.level,this.ui.tfForce_l.text=e.atk,this.ui.tfDamage_l.text=e.damage,this.ui.tfEffect_l.text=e.desc,this.ui.tfExtra_l.text=e.add_desc):(this.ui.imgNotGot.visible=!0,this.ui.compL.visible=!1),10==e.level?(this.ui.imgMaxLv.visible=!0,this.ui.compR.visible=!1,this.ui.progressBar.value=0):(this.ui.imgMaxLv.visible=!1,this.ui.compR.visible=!0,this.ui.tfLv_r.text=e.level+1,this.ui.tfForce_r.text=e.next_atk,this.ui.tfDamage_r.text=e.next_damage,this.ui.tfEffect_r.text=e.next_desc,this.ui.tfExtra_r.text=e.next_add_desc),1==this.m_data.isage?(this.ui.viewBtn.visible=!1,t.Util.toGrayAndDisabled(this.ui.btnUpgrade)):1==this.m_data.isvip?(this.ui.viewBtn.visible=!0,t.Util.toGrayAndDisabled(this.ui.btnUpgrade)):1==e.own&&e.level<10?(this.ui.viewBtn.visible=!0,t.Util.enable(this.ui.btnUpgrade)):(this.ui.viewBtn.visible=!0,t.Util.toGrayAndDisabled(this.ui.btnUpgrade))},i.prototype.getExtraAddMsg=function(t){var e="";if(t&&0!=t.length)for(var i=t.split(" "),s=this.ui.tfExtra_l.text.split(" "),n=0;n<i.length;n++){var a=i[n];if(-1!=a.indexOf("+")){var o=a.split("+")[0],r=Number(a.split("+")[1]),h=s[n],l=Number(h.split("+")[1]);r>l&&(e+="，"+o+"+"+(r-l))}}return e},i.prototype.showAnimtion=function(){if(this.m_data){var e={};e.uptype=this.m_data.type==t.WSDef.WEAPON?1:2,e.name=this.m_data.name,e.desc=this.m_data.desc,e.id=this.m_data.id,e.isage=this.m_data.isage,t.Facade.callCommand(new t.ShowUpAnimationCMD(e))}},i.prototype.packModelUpdate=function(){this.m_data&&(this.ui.tfCost.text="黄金卷轴*"+this.m_data.cost_num+"("+this.pm.getItemCount(this.PROP_ID)+")")},i.prototype.checkPackItem=function(t){this.pm.getItemCount(this.PROP_ID)!=t&&(this.pm.updataPackItem(this.PROP_ID,t),this.packModelUpdate())},i.prototype.updateData=function(t){this.m_data.level<t.level?(this.m_data.name=t.name,this.m_data.level=t.level,this.m_data.rate=t.rate,this.m_data.bless=t.bless,this.m_data.max_bless=t.max_bless,this.m_data.atk=this.m_data.next_atk,this.m_data.damage=this.m_data.next_damage,this.m_data.desc=this.m_data.next_desc,this.m_data.cost_num=t.cost_num,this.m_data.next_atk=t.next_atk,this.m_data.next_damage=t.next_damage,this.m_data.next_desc=t.next_desc):(this.m_data.rate=t.rate,this.m_data.bless=t.bless),this.m_data.add_desc=t.add_desc,this.m_data.next_add_desc=t.next_add_desc,this.setData(this.m_data)},i.prototype.playSuccAni=function(){this.qhSk&&(this.ui.addChild(this.ui.aniLayer),this.ui.btnUpgrade.mouseEnabled=!1,this.qhSk.on(Laya.Event.STOPPED,this,this.onAniEnd),this.qhSk.play(0,!1))},i.prototype.onAniEnd=function(){this.qhSk.off(Laya.Event.STOPPED,this,this.onAniEnd),Laya.timer.once(200,this,this.hideAni)},i.prototype.hideAni=function(){this.ui.aniLayer.removeSelf(),this.ui.btnUpgrade.mouseEnabled=!0},i.prototype.destroy=function(){this.pm.off(t.ModelEvent.UPDATE_FINISH,this,this.packModelUpdate),this.qhSk&&(this.qhSk.destroy(),this.qhSk=null),Laya.loader.clearRes("ui/lilian/bg.png"),Laya.loader.clearRes("ui/lilian/tongyong_taitouwuzi.png"),Laya.loader.clearRes("ui/lilian/dikuang.png"),e.prototype.destroy.call(this)},i.HAS_UPGRADE_SUCCESS=!1,i}(t.BaseBox);t.WsOpBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(t){e.call(this,new ui.vip.ChongZhiBoxUI,!0,!0,!0,!1),this.display=this.skin,this.setCloseButton(this.display.closeBtn),this.display.inputTxt.restrict="0-9",this.display.inputTxt.on(Laya.Event.INPUT,this,this.inputTxtChange),this.display.inputTxt.text=t+"",this.inputTxtChange(),this.display.chongzhiBtn.on(Laya.Event.CLICK,this,this.chongzhi),this.display.clearBtn.on(Laya.Event.CLICK,this,this.clearTxt)}return __extends(i,e),i.prototype.inputTxtChange=function(){Number(this.display.inputTxt.text)>999999?this.display.inputTxt.text="999999":"0000000"==this.display.inputTxt.text&&(this.display.inputTxt.text="000000");for(var e=0,i=0,s=0;s<t.VipBox.firstChongzhiArr.length;s++){var n=t.VipBox.firstChongzhiArr[s];if(!(Number(this.display.inputTxt.text)>=Number(n.cash_pay_num)))break;e=Number(n.cash_pay_num),i=0==n.first_charge_flag?n.first_charge_extra:n.charge_extra}this.display.msg.text="充值斗豆满"+e+"，赠送斗豆"+i,this.display.money.text=Number(this.display.inputTxt.text)/10+""},i.prototype.chongzhi=function(){if(""==this.display.inputTxt.text)t.WeakTips.show("请输入要充值的斗豆数量");else{var e=Number(this.display.inputTxt.text);if(2>e)t.WeakTips.show("至少充值2斗豆");else{var i=t.Global.isWB;if(i){var s={};s.num=Number(this.display.inputTxt.text),t.JSUtils.pay(s,this.payBack)}else t.XHR().Post({file:"petpk",cmd:"midas",num:e,uid:t.Global.UID},this,this.getChongzhiInfoHandler)}}},i.prototype.getChongzhiInfoHandler=function(e){
if(0==e.result){var i=t.Global.isWB;if(i)t.Facade.callCommand(new t.RefreshUserInfoCmd);else{var s={};s.num=Number(this.display.inputTxt.text),s.params=e.url_params,s._version="v3",s.sandbox=-1==t.Global.WebHost.indexOf("ledou.qq.com"),s.onSuccess=this.paySuccess,s.onClose=this.payClose,t.JSUtils.pay(s,this.payBack)}}else t.WeakTips.show("充值下单失败，"+e.msg)},i.prototype.wanbaBuyStarSuc=function(){var e=t.Global.H5OPENID,i=t.Global.H5TOKEN;t.XHR().Post({file:"petpk",cmd:"midas",subcmd:1,num:Number(this.display.inputTxt.text),openid:e,openkey:i,paypf:"wanba_ts",uid:t.Global.UID},this,this.getChongzhiInfoHandler)},i.prototype.paySuccess=function(){t.Facade.callCommand(new t.RefreshUserInfoCmd)},i.prototype.payClose=function(){},i.prototype.payBack=function(){t.Facade.callCommand(new t.RefreshUserInfoCmd)},i.prototype.clearTxt=function(){this.display.inputTxt.text="",this.inputTxtChange(),this.display.inputTxt.focus=!0},i.prototype.destroy=function(){this.display.inputTxt.off(Laya.Event.CHANGE,this,this.inputTxtChange),this.display.chongzhiBtn.off(Laya.Event.CLICK,this,this.chongzhi),this.display.clearBtn.off(Laya.Event.CLICK,this,this.clearTxt),e.prototype.destroy.call(this)},i}(t.BaseBox);t.InputChongzhiNumBox=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function n(a,o){e.call(this,new ui.vip.VipUI,!0,!0,!0,!1),this.waitToSendWanbaBuyDoudouNum=0,this._isWbRetry=!1,this.display=this.skin,this.setCloseButton(this.display.closeBtn),this.waitToSendWanbaBuyDoudouNum=0,t.EventCenter.singleton.on("VIP_ITEM_SELECT_HANDLER",this,this.selectChange),t.EventCenter.singleton.on("CHONGZHI_ITEM_SELECT_HANDLER",this,this.chongzhiItemClick),this.display.red_vipGift.visible=!1,this.setData(o),t.Global.isWXAPP&&Browser.onAndriod&&(this.display.closeBtn.x-=60),this.display.panel.vScrollBarSkin="ui/comp/vscroll.png",this.display.panel.vScrollBar.showButtons=!1,this.display.txt.style.fontFamily="黑体",this.display.txt.style.fontSize=22,this.display.txt.style.lineHeight=34,this.display.down.visible=!1,this.display.panel.vScrollBar.visible=!1,this.vipList=new laya.ui.List,this.vipList.vScrollBarSkin="ui/comp/vscroll.png",this.vipList.scrollBar.visible=!1,this.vipList.renderHandler=Handler.create(this,this.updateItem,null,!1),this.vipList.itemRender=i,this.display.pageVip.addChild(this.vipList),this.vipList.x=7,this.vipList.y=136,this.vipList.repeatX=1,this.vipList.repeatY=7,this.vipList.spaceY=1,this.vipList.array=o.vip_array,this.vipList.height=472,this.chongZhiList=new laya.ui.List,this.chongZhiList.renderHandler=Handler.create(this,this.updateChongZhiItem,null,!1),this.chongZhiList.itemRender=s,this.display.pageChongzhi.addChild(this.chongZhiList),this.chongZhiList.x=248,this.chongZhiList.y=20,this.chongZhiList.repeatX=4,this.chongZhiList.repeatY=2,this.chongZhiList.spaceY=22,this.display.chongzhi.on(Laya.Event.CLICK,this,this.btnChongZhiClick),this.display.vipBtn.on(Laya.Event.CLICK,this,this.btnVipClick),this.display.gift.on(Laya.Event.CLICK,this,this.giftBtnClick),this.changeIndex(a),this.selectChange(n.SELF_VIP_LV),n.SELF_VIP_LV>5&&(n.SELF_VIP_LV>=this._maxVipLv-5?this.vipList.scrollBar.value=this.vipList.scrollBar.max:this.vipList.scrollBar.value=this.vipList.scrollBar.max*n.SELF_VIP_LV/(this._maxVipLv-5))}return __extends(n,e),n.prototype.setData=function(t){this.data=t,n.HAS_SHOW_RED||(this.display.red_vipGift.visible=t.hasOwnProperty("packet_red_dot")&&0!=t.packet_red_dot,this.display.red_vipGift.visible&&(n.HAS_SHOW_RED=!0)),this._maxVipLv=0;for(var e=0;e<t.vip_array.length;e++)t.vip_array[e].level>this._maxVipLv&&(this._maxVipLv=t.vip_array[e].level);n.SELF_VIP_LV=t.vip_level,n.NOW_SELECT=n.SELF_VIP_LV,this.display.vipTxt.text=t.progress_x+"/"+t.progress_y,this.display.vipTxt1.text=t.progress_x+"/"+t.progress_y,this._maxVipBarWidth=this.display.vipBar.width,this._maxVipBar1Width=this.display.vipBar1.width,t.progress_x>=t.progress_y?(this.display.vipBar.width=this._maxVipBarWidth,this.display.vipBar1.width=this._maxVipBar1Width):(this.display.vipBar.width=this._maxVipBarWidth*t.progress_x/t.progress_y,this.display.vipBar1.width=this._maxVipBar1Width*t.progress_x/t.progress_y),n.SELF_VIP_LV>=10?(this.display.numRight.visible=this.display.numRight1.visible=!0,this.display.numLeft.skin="ui/vip/"+Math.floor(n.SELF_VIP_LV/10)+".png",this.display.numRight.skin="ui/vip/"+n.SELF_VIP_LV%10+".png",this.display.numLeft1.skin="ui/vip/"+Math.floor(n.SELF_VIP_LV/10)+".png",this.display.numRight1.skin="ui/vip/"+n.SELF_VIP_LV%10+".png"):(this.display.numRight.visible=this.display.numRight1.visible=!1,this.display.numLeft.skin="ui/vip/"+n.SELF_VIP_LV+".png",this.display.numLeft1.skin="ui/vip/"+n.SELF_VIP_LV+".png"),n.SELF_VIP_LV<this._maxVipLv?(this.display.needInfo.visible=!0,this.display.maxTxt.visible=!1,this.display.needInfo1.visible=!0,this.display.maxTxt1.visible=!1,this.display.needCash.text=t.progress_y-t.progress_x+"",this.display.upTxt.x=this.display.needCash.x+this.display.needCash.textWidth+8,this.display.needCash1.text=t.progress_y-t.progress_x+"",this.display.goVipTxt.text="可升级：达人"+(n.SELF_VIP_LV+1)):(this.display.needInfo.visible=!1,this.display.maxTxt.visible=!0,this.display.needInfo1.visible=!1,this.display.maxTxt1.visible=!0,this.display.vipBar.width=this._maxVipBarWidth,this.display.vipBar1.width=this._maxVipBar1Width,this.display.vipTxt.text=t.progress_x+"/???",this.display.vipTxt1.text=t.progress_x+"/???")},n.prototype.btnChongZhiClick=function(){this.changeIndex(1)},n.prototype.btnVipClick=function(){this.changeIndex(0),this.checkToRetryWbChongzhi()},n.prototype.giftBtnClick=function(){this.event("OPEN_VIP_GIFT_BOX"),this.display.red_vipGift.visible=!1},n.prototype.changeIndex=function(t){0==t?(this.display.titleVip.visible=!0,this.display.titleChongzhi.visible=!1,this.display.pageVip.visible=!0,this.display.pageChongzhi.visible=!1):(this.display.titleVip.visible=!1,this.display.titleChongzhi.visible=!0,this.display.pageVip.visible=!1,this.display.pageChongzhi.visible=!0,n.firstChongzhiArr||this.getFirstChongzhiInfo())},n.prototype.getFirstChongzhiInfo=function(){t.XHR().Post({file:"petpk",cmd:"vip",op:"viewcharge",uid:t.Global.UID},this,this.getFirstChongzhiInfoHandler)},n.prototype.getFirstChongzhiInfoHandler=function(e){0==e.result?(n.firstChongzhiArr=e.charge_array,n.firstChongzhiArr.sort(function(t,e){return t.cash_pay_num-e.cash_pay_num}),this.chongZhiList.array=n.firstChongzhiArr):t.WeakTips.show("拉取充值信息失败，"+e.msg)},n.prototype.selectChange=function(t){n.NOW_SELECT=t,this.vipList.array=this.data.vip_array;var e=Laya.loader.getRes("config/vipDes.txt"),i=e.split("=============================="),s=i[2*t],a=s.split("DDDDD");1==a.length?(this.display.titleIcon.visible=!1,this.display.title2.visible=!1,this.display.title1.text=a[0].replace("\n","")):(this.display.titleIcon.visible=!0,this.display.title2.visible=!0,this.display.title1.text=a[0].replace("\n",""),this.display.titleIcon.x=this.display.title1.x+this.display.title1.textField.textWidth-5,this.display.title2.text=a[1].replace("\n",""),this.display.title2.x=this.display.titleIcon.x+50),this.display.txt.style.height=100,this.display.txt.innerHTML=i[2*t+1]+"<br/>",this.display.panel.refresh(),this.display.panel.vScrollBar.value=0,Laya.timer.frameOnce(3,this,this.check)},n.prototype.check=function(){this.display&&(0!=this.display.panel.vScrollBar.max?(this.display.down.visible=!0,this.display.panel.vScrollBar.visible=!0):(this.display.down.visible=!1,this.display.panel.vScrollBar.visible=!1))},n.prototype.updateItem=function(t,e){e<this.data.vip_array.length&&t.doRender(e)},n.prototype.chongzhiItemClick=function(e){if(t.Global.isWXAPP)n.nowChongzhiValue=Number(e.value1),n.extraChongzhiValue=Number(e.value2),n.chongzhiIndexValue=Number(e.chongzhiIndex),this.WXAppPaySuccess();else if(!this.checkToRetryWbChongzhi()){n.nowChongzhiValue=Number(e.value1),n.extraChongzhiValue=Number(e.value2),t.Logger.log("充值斗豆："+n.nowChongzhiValue+"赠送斗豆："+n.extraChongzhiValue+"AAAAA"),n.chongzhiIndexValue=Number(e.chongzhiIndex);var i=t.Global.isWB;if(i||Laya.Browser.onIOS){var s="您确定要花费"+e.needMoney+"元充值"+n.nowChongzhiValue+"斗豆";n.extraChongzhiValue>0&&(s+="（额外赠送"+n.extraChongzhiValue+"斗豆）"),s+="吗？";var a=new t.ConfirmBoxData({contentStr:s,callBackHandler:Handler.create(this,this.alertToChongzhi)});t.ConfirmBox.show(a,t.Layer.WEAK_TIP)}else t.XHR().Post({file:"petpk",cmd:"midas",num:n.nowChongzhiValue,uid:t.Global.UID,channel:t.JSUtils.getChannel()},this,this.getChongzhiInfoHandler)}},n.prototype.alertToChongzhi=function(){var e=t.Global.isWB;e?this.sendWanbaBuyDoudou():this.sendIPABuyDoudou()},n.prototype.getChongzhiInfoHandler=function(e){var i=t.Global.isWB;if(0==e.result)if(i||Laya.Browser.onIOS)t.Facade.callCommand(new t.RefreshUserInfoCmd),t.Logger.log("充值斗豆："+n.nowChongzhiValue+"赠送斗豆："+n.extraChongzhiValue+"BBBBB1"),t.Facade.callCommand(new t.ChongzhiSuccessCmd(n.nowChongzhiValue,n.extraChongzhiValue)),i&&(this.waitToSendWanbaBuyDoudouNum=0);else{var s={};s.num=n.nowChongzhiValue,s.params=e.url_params,s._version="v3",s.sandbox=-1==t.Global.WebHost.indexOf("ledou.qq.com"),s.onSuccess=this.paySuccess,s.onClose=this.payClose,s.chongzhiIndex=n.chongzhiIndexValue,t.JSUtils.pay(s,this.payBack)}else if(!i&&!Laya.Browser.onIOS||121!=e.result||this._isWbRetry)this._isWbRetry||t.WeakTips.show("充值下单失败，"+e.msg);else{var s={};s.num=n.nowChongzhiValue,s.chongzhiIndex=n.chongzhiIndexValue,t.JSUtils.pay(s,this.payBack),i&&(this.waitToSendWanbaBuyDoudouNum=n.nowChongzhiValue)}},n.prototype.checkToRetryWbChongzhi=function(){return t.Global.isWB&&0!=this.waitToSendWanbaBuyDoudouNum?(this.sendWanbaBuyDoudou(this.waitToSendWanbaBuyDoudouNum),this.waitToSendWanbaBuyDoudouNum=0,!0):!1},n.prototype.sendWanbaBuyDoudou=function(e){void 0===e&&(e=0);var i,s=t.Global.H5OPENID,a=t.Global.H5TOKEN;0==e?(i=n.nowChongzhiValue,this._isWbRetry=!1):(i=e,this._isWbRetry=!0),t.XHR().Post({file:"petpk",cmd:"midas",subcmd:1,num:n.nowChongzhiValue,openid:s,openkey:a,paypf:"wanba_ts"},this,this.getChongzhiInfoHandler)},n.prototype.sendIPABuyDoudou=function(){t.XHR().Post({file:"petpk",cmd:"midas",subcmd:3,paytoken:t.Global.H5PAYTOKEN,num:n.nowChongzhiValue},this,this.getChongzhiInfoHandler)},n.prototype.WXAppPaySuccess=function(){t.XHR().Post({file:"petpk",cmd:"midas",subcmd:4},this,this.wxApppayBack)},n.prototype.paySuccess=function(){t.Facade.callCommand(new t.RefreshUserInfoCmd),t.Logger.log("充值斗豆："+n.nowChongzhiValue+"赠送斗豆："+n.extraChongzhiValue+"BBBBB2"),t.Facade.callCommand(new t.ChongzhiSuccessCmd(n.nowChongzhiValue,n.extraChongzhiValue))},n.prototype.payClose=function(){},n.prototype.payBack=function(){},n.prototype.wxApppayBack=function(e){0==e.result?(t.Facade.callCommand(new t.RefreshUserInfoCmd),t.Facade.callCommand(new t.ChongzhiSuccessCmd(n.nowChongzhiValue,n.extraChongzhiValue))):121==e.result?t.JSUtils.pay({num:n.nowChongzhiValue},this.payBack):t.WeakTips.show("充值下单失败，"+e.msg)},n.prototype.changeChongzhiItem=function(){var t=n.firstChongzhiArr[n.chongzhiIndexValue];0==Number(t.first_charge_flag)&&(t.first_charge_flag=1,this.chongZhiList.array=n.firstChongzhiArr)},n.prototype.updateChongZhiItem=function(t,e){8>e&&t.doRender(e,n.firstChongzhiArr[e])},n.prototype.hide=function(){this.checkToRetryWbChongzhi()||e.prototype.hide.call(this)},n.prototype.destroy=function(){this.display.chongzhi.off(Laya.Event.CLICK,this,this.btnChongZhiClick),this.display.vipBtn.off(Laya.Event.CLICK,this,this.btnVipClick),this.display.gift.off(Laya.Event.CLICK,this,this.giftBtnClick),t.EventCenter.singleton.off("VIP_ITEM_SELECT_HANDLER",this,this.selectChange),t.EventCenter.singleton.off("CHONGZHI_ITEM_SELECT_HANDLER",this,this.chongzhiItemClick),n.firstChongzhiArr=null,e.prototype.destroy.call(this)},n.HAS_SHOW_RED=!1,n}(t.BaseBox);t.VipBox=e;var i=function(i){function s(){i.call(this),this.on(Laya.Event.CLICK,this,this.clickHandler)}return __extends(s,i),s.prototype.doRender=function(t){this.index=t,this.normalTxt.text="达人"+t,this.lightTxt.text="达人"+t,t==e.NOW_SELECT?(this.light.visible=!0,this.normal.visible=!1,this.lightTxt.visible=!0,this.normalTxt.visible=!1):(this.light.visible=!1,this.normal.visible=!0,t==e.SELF_VIP_LV?(this.lightTxt.visible=!0,this.normalTxt.visible=!1):(this.lightTxt.visible=!1,this.normalTxt.visible=!0))},s.prototype.clickHandler=function(){t.EventCenter.singleton.event("VIP_ITEM_SELECT_HANDLER",this.index)},s.prototype.destroy=function(){i.prototype.destroy.call(this)},s}(ui.vip.VipItemUI),s=function(e){function i(){e.call(this),this.first.visible=this.reback.visible=!1,this.txt1.text=this.txt2.text=this.money.text="",this.on(Laya.Event.CLICK,this,this.clickHandler)}return __extends(i,e),i.prototype.doRender=function(t,e){if(this.index=t,this.gift.skin="ui/vip/gold"+(t+1)+".png",this.txt1.text=e.cash_pay_num,this.money.text=e.cash_pay_num/10+"元",this._needMoney=Number(e.cash_pay_num/10),0==e.first_charge_flag)this.first.visible=!0,this.reback.visible=this.rebackTxt.visible=!1,this.txt2.visible=!0,this.txt2.text=e.first_charge_extra;else if(this.first.visible=!1,0==e.charge_extra)this.doudouIcon.x=51,this.txt1.x=76,this.zengIcon.visible=!1,this.txt2.visible=!1,this.txt2.text="0",this.reback.visible=this.rebackTxt.visible=!1;else{this.doudouIcon.x=11,this.txt1.x=36,this.zengIcon.visible=!0,this.reback.visible=this.rebackTxt.visible=!0,this.txt2.visible=!0,this.txt2.text=e.charge_extra;var i=100*Number(this.txt2.text)/Number(this.txt1.text);-1!=String(i).indexOf(".")&&(i=Number(String(i).split(".")[0])),this.rebackTxt.text=i+"%"}},i.prototype.clickHandler=function(){if(t.Global.isWXAPP&&this.index>=6)t.WeakTips.show("该额度暂未开放");else{var e=Laya.Browser.userAgent;if(e=e.replace(/ipadqq/i,"ipadqq"),Laya.Browser.onIPad&&-1!=e.indexOf("ipadqq"))t.WeakTips.show("IPadQQ暂未开放充值");else{var i=""==this.txt1.text?0:Number(this.txt1.text),s=""==this.txt2.text?0:Number(this.txt2.text);t.EventCenter.singleton.event("CHONGZHI_ITEM_SELECT_HANDLER",{value1:i,value2:s,chongzhiIndex:this.index,needMoney:this._needMoney})}}},i.prototype.destroy=function(){this.off(Laya.Event.CLICK,this,this.clickHandler),e.prototype.destroy.call(this)},i}(ui.vip.ChongzhiItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=Laya.Animation,i=function(e){function i(){e.call(this,new ui.vip.VipGiftUI,!0,!0,!0,!1),this.display=this.skin,this.setCloseButton(this.display.closeBtn),this.cacheAs="none",this.giftList=new laya.ui.List,this.giftList.vScrollBarSkin="ui/comp/vscroll.png",this.giftList.scrollBar.visible=!1,this.giftList.renderHandler=Handler.create(this,this.updateItem,null,!1),this.giftList.itemRender=s,this.display.addChild(this.giftList),this.giftList.x=243,this.giftList.y=82,this.giftList.repeatX=1,this.giftList.repeatY=4,this.giftList.spaceY=12,t.EventCenter.singleton.on("VIP_BOX_BUY_SUCCESS",this,this.vipBuySuccess)}return __extends(i,e),i.prototype.setData=function(t,e){void 0===e&&(e=!1),t.packet_array.sort(function(t,e){return 1e4*(t.buy_num-e.buy_num)+(t.level-e.level)}),e?(this._initData=t,Laya.loader.load("res/atlas/ui/item_movie.json",Handler.create(this,this.aniLoadComplete),null,Loader.ATLAS)):this.giftList.array=t.packet_array},i.prototype.aniLoadComplete=function(){this.destroyed||(this.giftList.array=this._initData.packet_array)},i.prototype.updateItem=function(t,e){e<=this.giftList.array.length-1&&t.doRender(e,this.giftList.array[e])},i.prototype.vipBuySuccess=function(){t.XHR().Post({file:"petpk",cmd:"vip",op:"packet",uid:t.Global.UID},this,this.getVipGiftInfoHandler)},i.prototype.getVipGiftInfoHandler=function(t){0==t.result&&this.setData(t)},i.prototype.destroy=function(){this._initData=null,this.giftList&&(this.giftList.destroy(),this.giftList=null),t.EventCenter.singleton.off("VIP_BOX_BUY_SUCCESS",this,this.vipBuySuccess),e.prototype.destroy.call(this)},i}(t.BaseBox);t.VipGiftBox=i;var s=function(e){function i(){e.call(this),this.cacheAs="none",this.mainLayer.cacheAs="bitmap",this.iconList=new laya.ui.List,this.iconList.hScrollBarSkin="ui/comp/vscroll.png",this.iconList.scrollBar.visible=!1,this.iconList.renderHandler=Handler.create(this,this.updateItem,null,!1),this.iconList.itemRender=n,this.addChild(this.iconList),this.iconList.x=79,this.iconList.y=20,this.iconList.repeatX=6,this.iconList.repeatY=1,this.iconList.spaceX=3,this.iconList.width=558}return __extends(i,e),i.prototype.updateItem=function(t,e){e<=this.iconList.array.length-1&&t.doRender(this.iconList.array[e])},i.prototype.doRender=function(e,i){this.level=i.level,this.vipValueTxt.text=i.level,this.oriPrice.text=i.price,this.nowPrice.text=i.discount_price;for(var s=0;s<i.details.attrs.length;s++){var n=i.details.attrs[s];n.isAttr=!0}var a=i.details.attrs.concat(i.details.items);this.iconList.array=a,i.buy_num>0?(this.buyBtn.label="已购买",this.buyBtn.filters=t.FiltersUtils.getGreyFilters(),this.red_buy.visible=!1):this.level>t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL).vipLevel?(this.buyBtn.label="达人不足",this.buyBtn.filters=t.FiltersUtils.getGreyFilters(),this.red_buy.visible=!1):(this.buyBtn.label="购买",this.buyBtn.filters=null,this.red_buy.visible=!0),this.buyBtn.on(Laya.Event.CLICK,this,this.buyBtnClick)},i.prototype.buyBtnClick=function(){this.level>t.Facade.singleton.model.retrieveModel(t.ModelDef.SELF_USER_MODEL).vipLevel?t.WeakTips.show("购买失败，达人等级不足"):null!=this.buyBtn.filters&&0!=this.buyBtn.filters.length||t.XHR().Post({file:"petpk",cmd:"vip",op:"buy",level:this.level,uid:t.Global.UID},this,this.buyGiftHandler)},i.prototype.buyGiftHandler=function(e){0==e.result?(t.Facade.callCommand(new t.SyncChangeCmd(e,!1,!0)),t.EventCenter.singleton.event("VIP_BOX_BUY_SUCCESS")):t.WeakTips.show("购买失败，"+e.msg)},i.prototype.destroy=function(){Laya.loader.clearRes("res/atlas/ui/item_movie.json"),this.iconList&&(this.iconList.destroy(),this.iconList=null),this.buyBtn.off(Laya.Event.CLICK,this,this.buyBtnClick),e.prototype.destroy.call(this)},i}(ui.vip.GiftBuyItemUI),n=function(i){function s(){i.call(this),this.cacheAs="none",this.mainLayer.cacheAs="bitmap"}return __extends(s,i),s.prototype.doRender=function(i){this.obj=i,this.icon.skin=i.hasOwnProperty("icon_id")?t.ResPath().getPic(i.icon_id,t.ResourcePath.PATH_GOODS):t.ResPath().getPic(i.id,t.ResourcePath.PATH_GOODS),i.hasOwnProperty("isAttr")?this.numTxt.text=i.num:(i.id>=200001&&i.id<=4e5?(this.numTxt.text=t.DateUtils.getStrByHours(i.hours),this.ani||(this.ani=new e,this.ani.loadAtlas("res/atlas/ui/item_movie.json"),this.ani.interval=95,this.ani.index=1,this.sp.addChild(this.ani),this.ani.x=this.iconBg.x-51,this.ani.y=this.iconBg.y-52),this.ani.play(),this.ani.visible=!0):(this.numTxt.text=i.num,this.ani&&(this.ani.stop(),this.ani.visible=!1)),this.on(Laya.Event.CLICK,this,this.clickHandler))},s.prototype.clickHandler=function(){var e,i={};e=this.localToGlobal(new laya.maths.Point(0,0)),i.name=this.obj.name,i.desc=this.obj.goods_desc,i.info=this.obj.effect_desc,t.Tips.show(i,e)},s.prototype.destroy=function(){this.ani&&(this.ani.stop(),this.ani.destroy(),this.ani=null),this.off(Laya.Event.CLICK,this,this.clickHandler),this.obj=null,i.prototype.destroy.call(this)},s}(ui.vip.GiftBuyItemIconUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"OpenVipBoxCommand":t.Logger.log("userAgent:"+Laya.Browser.userAgent),t.Global.isWXAPP&&Laya.Browser.onIOS?t.WeakTips.show("充值和达人暂未开放"):(this._index=e.index,this.getVipInfo());break;case"ChongzhiSuccessCmd":var i={},s=e.value1,n=e.value2;t.SyncExecuter.constructObj(i,"kDouBi",String(s+n),2);var a;a=0==n?"充值"+s+"斗豆成功：":"充值"+s+"斗豆，并赠送"+n+"斗豆：",t.Facade.callCommand(new t.SyncChangeCmd(i,!1,!0,a)),this.vipBox&&(this.vipBox.changeChongzhiItem(),this.getVipInfo());break;case"WanbaBuyStarSuccessCmd":this.vipBox&&(this.vipBox.sendWanbaBuyDoudou(),this.vipBox.waitToSendWanbaBuyDoudouNum=0);break;case"WXAppPaySuccessCmd":this.vipBox&&this.vipBox.WXAppPaySuccess();break;case"IPABuySuccessCmd":this.vipBox&&this.vipBox.sendIPABuyDoudou()}},s.prototype.getVipInfo=function(){t.XHR().Post({file:"petpk",cmd:"vip",uid:t.Global.UID},this,this.getVipInfoHandler)},s.prototype.getVipInfoHandler=function(e){0==e.result?this.openVipBox(this._index,e):t.WeakTips.show("查询达人信息失败，"+e.msg)},s.prototype.openVipBox=function(e,i){this.vipBox?this.vipBox.setData(i):(this.vipBox=new t.VipBox(e,i),this.vipBox.on("OPEN_VIP_GIFT_BOX",this,this.getVipGiftInfo),this.vipBox.on(t.ViewEvent.BASE_DESTROY,this,this.vipBoxDestroy),this.vipBox.show())},s.prototype.vipBoxDestroy=function(){this.vipBox.off(t.ViewEvent.BASE_DESTROY,this,this.vipBoxDestroy),this.vipBox=null,this.unregisterPlugin()},s.prototype.getVipGiftInfo=function(){t.XHR().Post({file:"petpk",cmd:"vip",op:"packet",uid:t.Global.UID},this,this.getVipGiftInfoHandler)},s.prototype.getVipGiftInfoHandler=function(e){0==e.result?this.openVipGiftBox(e):t.WeakTips.show("查询达人礼包信息失败，"+e.msg)},s.prototype.openVipGiftBox=function(e){var i=new t.VipGiftBox;i.show(),i.setData(e,!0)},s.prototype.getPluginName=function(){return e.PLUGIN_VIP},s}(t.Plugin);t.VipModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this),this._curAreaIndex=0,this._isFirstQuery=!1,this._maxPage=11,this._areaName=["青龙","白虎","朱雀","玄武","貔貅","饕餮","鲲鹏","白泽","黄鸟","夔牛","麒麟","九尾"],this.x=230,this.y=76,this.tabPanel.hScrollBar.visible=!1,this.tab.selectHandler=new Handler(this,this.onSelectTab),this.playerArr=[],this.playerArr2=[],this._cacheData={},this._curPlayersMap={};for(var t=0;8>t;t++)this.playerArr.push(new i(this["player_"+t]));this.playerArr2.push(new i(this.player2_0)),this.playerArr2.push(new i(this.player2_1)),this.championItem=new i(this.champion),this.replay_0.on(Laya.Event.CLICK,this,this.onClickReplay,[0]),this.replay_1.on(Laya.Event.CLICK,this,this.onClickReplay,[1]),this.replay_2.on(Laya.Event.CLICK,this,this.onClickReplay,[2]),this.replay_3.on(Laya.Event.CLICK,this,this.onClickReplay,[3]),this.replay2_0.on(Laya.Event.CLICK,this,this.onClickReplay,[4]),this.replay2_1.on(Laya.Event.CLICK,this,this.onClickReplay,[5]),this.replay3_0.on(Laya.Event.CLICK,this,this.onClickReplay,[6]),this.leftBtn.on(Laya.Event.CLICK,this,this.onClickLeft),this.rightBtn.on(Laya.Event.CLICK,this,this.onClickRight)}return __extends(s,e),s.prototype.destroy=function(){this.replay_0.off(Laya.Event.CLICK,this,this.onClickReplay),this.replay_1.off(Laya.Event.CLICK,this,this.onClickReplay),this.replay_2.off(Laya.Event.CLICK,this,this.onClickReplay),this.replay_3.off(Laya.Event.CLICK,this,this.onClickReplay),this.replay2_0.off(Laya.Event.CLICK,this,this.onClickReplay),this.replay2_1.off(Laya.Event.CLICK,this,this.onClickReplay),this.replay3_0.off(Laya.Event.CLICK,this,this.onClickReplay),this.leftBtn.off(Laya.Event.CLICK,this,this.onClickLeft),this.rightBtn.off(Laya.Event.CLICK,this,this.onClickRight),e.prototype.destroy.call(this)},s.prototype.clearData=function(){this._baseData=null,this._cacheData={}},s.prototype.update=function(e){this._cacheData[e]?(this._maxPage=this._cacheData[e].arena_num?this._cacheData[e].arena_num-1:11,this.updatePanel(this._cacheData[e])):t.XHR().Post({cmd:"wulin",op:"match",arena_id:e,needreload:"1"},this,this.onQuery)},s.prototype.onQuery=function(e){0==e.result?(this._baseData||(this._baseData=e),this._maxPage=e.arena_num?e.arena_num-1:11,this._cacheData[e.arena_id]=e,this.updatePanel(e)):t.WeakTips.show(e.msg)},s.prototype.updatePanel=function(t){if(this._secId=Math.floor(t.arena_id/1e3),!this._tabIndexMap){this._tabIndexMap={};for(var e=t.sec_list.length,i="",s=0;e>s;s++)i+=s!=e-1?t.sec_list[s].sec_name+",":t.sec_list[s].sec_name,this._tabIndexMap[t.sec_list[s].sec_id]=s;this._isFirstQuery=!0,this.tab.labels=i,this.tab.selectedIndex=this._tabIndexMap[this._secId],this.tabPanel.refresh(),this.parent.skin.sessionTxt.text=""+t.pid}this.tabPanel.hScrollBar.value=0,this.showArea(t)},s.prototype.onSelectTab=function(e){if(this._isFirstQuery)this._isFirstQuery=!1;else if(this._baseData){var i=1e3*this._baseData.sec_list[e].sec_id;this._cacheData[i]?(this._maxPage=this._cacheData[i].arena_num?this._cacheData[i].arena_num-1:11,this.updatePanel(this._cacheData[i])):t.XHR().Post({cmd:"wulin",op:"match",arena_id:i,needreload:"1"},this,this.onQuery)}},s.prototype.showArea=function(t){this._curAreaObj=t,t&&(this._curAreaIndex=t.arena_id%1e3,this.getCurList(t),this.showMatchLine(t),this.showPlayer(t),this.showReplay(t),0==this._curAreaIndex?this.leftBtn.visible=!1:this.leftBtn.visible=!0,this._maxPage==this._curAreaIndex?this.rightBtn.visible=!1:this.rightBtn.visible=!0,this.titleTxt.text=this._areaName[this._curAreaIndex]+"区八强对决")},s.prototype.getCurList=function(t){this._list8=[],this._list4=[],this._list2=[],this._list1=[];for(var e=t.matchlist,i=0;7>i;i++)e[i]&&(4>i?(this._list8.push(e[i].winner),this._list8.push(e[i].loser),this._list4.push(e[i].winner)):6>i?this._list2.push(e[i].winner):this._list1.push(e[i].winner));var s=t.userlist,n=s.length;for(i=0;n>i;i++)this._curPlayersMap[s[i].uid]=s[i]},s.prototype.showMatchLine=function(t){for(var e=0;8>e;e++)this["line8_"+e].visible=!1,4>e&&(this["line4_"+e].visible=!1,this["line4_"+e+"_1"].visible=!1),2>e&&(this["line2_"+e].visible=!1);var i,s;if(this._list4.length>0){for(i=this.getIndexArr(this._list8,this._list4),s=i.length,e=0;s>e;e++)this["line8_"+i[e]].visible=!0;if(this._list2.length>0){for(i=this.getIndexArr(this._list4,this._list2),s=i.length,e=0;s>e;e++)this["line8_"+2*e].visible?this["line4_"+i[e]].visible=!0:this["line4_"+i[e]+"_1"].visible=!0;if(this._list1.length>0)for(i=this.getIndexArr(this._list2,this._list1),s=i.length,e=0;s>e;e++)this["line2_"+i[e]].visible=!0}}},s.prototype.getIndexArr=function(t,e){for(var i=[],s=t.length,n=0;s>n;n++)-1!=e.indexOf(t[n])&&i.push(n);return i},s.prototype.showPlayer=function(t){for(var e=0;8>e;e++)this._list8[e]?this.playerArr[e].setData(this._curPlayersMap[this._list8[e]]):this.playerArr[e].setData();for(e=0;2>e;e++)this._list2[e]?this.playerArr2[e].setData(this._curPlayersMap[this._list2[e]]):this.playerArr2[e].setData();this._list1.length>0?this.championItem.setData(this._curPlayersMap[this._list1[0]]):this.championItem.setData()},s.prototype.showReplay=function(t){this.replay_0.visible=!1,this.replay_1.visible=!1,this.replay_2.visible=!1,this.replay_3.visible=!1,this.replay2_0.visible=!1,this.replay2_1.visible=!1,this.replay3_0.visible=!1;var e=t.matchlist;if(e.length>0){for(var i=0;4>i;i++)e[i]&&e[i].repid&&(this["replay_"+i].visible=!0);e.length>4&&(e[4]&&e[4].repid&&(this.replay2_0.visible=!0),e[5]&&e[5].repid&&(this.replay2_1.visible=!0),e.length>6&&e[6]&&e[6].repid&&(this.replay3_0.visible=!0))}},s.prototype.onClickReplay=function(e,i){if(this._curAreaObj){var s=this._curAreaObj.matchlist;s[e]&&s[e].repid&&t.Facade.callCommand(new t.FightReplayCommand(s[e].repid))}},s.prototype.onClickLeft=function(){if(this._curAreaIndex>0&&this._curAreaObj){this._curAreaIndex--;var e=this._curAreaObj.arena_id;e--,this._cacheData[e]?this.showArea(this._cacheData[e]):t.XHR().Post({cmd:"wulin",op:"match",arena_id:e},this,this.onQuery)}},s.prototype.onClickRight=function(){if(this._curAreaIndex<this._maxPage&&this._curAreaObj){this._curAreaIndex++;var e=this._curAreaObj.arena_id;e++,this._cacheData[e]?this.showArea(this._cacheData[e]):t.XHR().Post({cmd:"wulin",op:"match",arena_id:e},this,this.onQuery)}},s}(ui.wulin.WuLinCourseUI);t.WuLinCourse=e;var i=function(){function e(t){this._skin=t,this._skin.head.on(Laya.Event.CLICK,this,this.onClick)}return e.prototype.destroy=function(){this._skin=null,this._skin.head.off(Laya.Event.CLICK,this,this.onClick)},e.prototype.setData=function(e){void 0===e&&(e=null),this._curData=e,e?(""!=e.headurl?(this._skin.head.graphics.clear(),this._skin.head.loadImage(t.JSUtils.getHeadUrl(e.headurl),8,8,76,76),this._skin.head.visible=!0):this._skin.head.visible=!1,this._skin.nameTxt.text=e.name):(this._skin.head.visible=!1,this._skin.nameTxt.text="虚位以待")},e.prototype.onClick=function(){this._curData&&t.Facade.callCommand(new t.UserInfoCommand(this._curData.uid+""))},e}()}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this),this.x=230,this.y=76,this.list.itemRender=i,this.list.scrollBar.visible=!1,this.list.renderHandler=new Handler(this,this.onListRender),this.tab.labels="",this.tab.selectedIndex=0,this.tips.visible=!1}return __extends(s,e),s.prototype.destroy=function(){e.prototype.destroy.call(this)},s.prototype.update=function(){t.XHR().Post({cmd:"wulin",op:"feeds",needreload:"1"},this,this.onQuery)},s.prototype.onQuery=function(e){0==e.result?(this.parent.skin.sessionTxt.text=""+e.pid,this.list.array=e.feedslist,e.feedslist.length>0?this.tips.visible=!1:this.tips.visible=!0):t.WeakTips.show(e.msg)},s.prototype.onListRender=function(t,e){var i=this.list.array.length;t.setData(this.list.getItem(e),i-e)},s}(ui.wulin.WuLinMineUI);t.WuLinMine=e;var i=function(e){function i(){e.call(this),this._p=new Laya.HTMLDivElement,this._p.style.fontSize=24,this._p.style.fontFamily="黑体",this._p.style.leading=15,this._p.style.bold=!0,this._p.style.width=635,this._p.style.valign="top",this.addChild(this._p),this._p.x=37,this._p.y=23,this.replayBtn.on(Laya.Event.CLICK,this,this.onClickReplay)}return __extends(i,e),i.prototype.destroy=function(){this.replayBtn.off(Laya.Event.CLICK,this,this.onClickReplay),e.prototype.destroy.call(this)},i.prototype.setData=function(t,e){this._curData=t,this.replayBtn.visible=!1,t&&(this._p.innerHTML=t.content,this._curData.repid&&(this.replayBtn.visible=!0))},i.prototype.onClickReplay=function(){this._curData&&this._curData.repid&&t.Facade.callCommand(new t.FightReplayCommand(this._curData.repid))},i}(ui.wulin.WuLinListItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=t.PluginDef,i=function(i){function s(){i.call(this)}return __extends(s,i),s.prototype.initialize=function(t){},s.prototype.doCommand=function(e){switch(e.getCommandName()){case"WuLinCommand":this._wulinPanel||(this._wulinPanel=new t.WuLinView),this._wulinPanel.tabIndex=e.tabIndex,this._wulinPanel.on(t.ViewEvent.BOX_HIDE,this,this.onClosePanel),this._wulinPanel.show()}},s.prototype.onClosePanel=function(){this._wulinPanel&&(this._wulinPanel.off(t.ViewEvent.BOX_HIDE,this,this.onClosePanel),Laya.loader.clearRes("res/atlas/ui/wulin.json"),Laya.loader.clearRes("ui/wulin/wldh-baqiangdi.jpg"))},s.prototype.getPluginName=function(){return e.PLUGIN_WULIN},s.WULIN_CLICK_AREA="WULIN_CLICK_AREA",s}(t.Plugin);t.WuLinModule=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this,new ui.wulin.WuLinRuleUI,!1,!0,!0,!1),this.m_ui=this.skin,this.setCloseButton(this.m_ui.back.boxClose),
this.m_ui.contentBox.vScrollBar.visible=!1,this._p=new Laya.HTMLDivElement,this.m_ui.contentBox.addChild(this._p),this._p.style.fontSize=24,this._p.style.fontFamily="黑体",this._p.style.leading=5,this._p.style.width=466,this._p.x=15,this._p.y=10,this._p.innerHTML="<span style='font-weight:bold'>报名规则：</span><span style='valign:top;'>每届比赛只能报一个等级段内的一个赛区，每次报名消耗挑战书 * 1，每个大区都有人数限制，先到先得！</span><br><span style='font-weight:bold'>报名时间：</span><span style='valign:top;'>每天7:00开始本届大赛的报名，报名截止时间为23:50分或大区名额已满</span><br><span style='font-weight:bold'>比赛时间：</span><span style='valign:top;'>比赛在报名截止时间的10分钟后进行，即第二天的00:00开始打响</span><br><span style='font-weight:bold'>比赛规则：</span><span style='valign:top;'>武林大会采用一局定胜负制，玩家可以在战斗开始前吃好药水，做好万全准备</span><br><span style='font-weight:bold'>比赛奖励：</span><span style='valign:top;'>每次武林大会结束后，武林大会官方委员会根据参赛者的战斗结果发放奖励，每一轮都有相应的奖励，晋级的轮数越多，奖励越丰厚，每天8:00统一发放奖励</span><br>"}return __extends(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this)},e}(t.BaseBox);t.WuLinRuleView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function s(){e.call(this),this._isFirstQuery=!1,this.GOOD_ID=100009,this.x=230,this.y=76,this.cacheAs="none",this.cacheLayer.cacheAs="bitmap",this.tabPanel.hScrollBar.visible=!1,this.tab.selectHandler=new Handler(this,this.onSelectTab),this.tab.labels="",this.list.itemRender=i,this.list.scrollBar.visible=!1,this.list.scrollBar.rollRatio=.6,this.list.renderHandler=new Handler(this,this.onListRender),this.list.scrollBar.on(Laya.Event.END,this,this.onChangeScrollerEnd),this.list.scrollBar.on(Laya.Event.START,this,this.onChangeScrollerStart),this.list.array=[],this._cacheData={},this.smallIcon.skin=t.ResPath().getPic(100016,t.ResourcePath.PATH_GOODS),this.bigIcon.skin=t.ResPath().getPic(100016,t.ResourcePath.PATH_GOODS),this.upArrow.visible=!1,this.downArrow.visible=!1}return __extends(s,e),s.prototype.destroy=function(){this.signUpBtn.off(Laya.Event.CLICK,this,this.onClickSignUp),this._countDown&&this._countDown.destroy(),e.prototype.destroy.call(this)},s.prototype.clearData=function(){Laya.Tween.clearAll(this.list.scrollBar),this.ani1.stop(),this.ani2.stop(),this._baseData=null,this._cacheData={},this._tabIndexMap=null},s.prototype.update=function(){this._baseData?this.updatePanel(this._baseData):(this._isFirstQuery=!0,t.XHR().Post({cmd:"wulin",op:"query",sec_id:0,needreload:"1"},this,this.onQuery))},s.prototype.onQuery=function(e){0==e.result?(t.Util.DecodeJSONProperty("ex-champion",e),this._baseData?this._cacheData[this._querySecId]=e:(this._baseData=e,this._cacheData[e.sec_id]=e),this.updatePanel(e)):t.WeakTips.show(e.msg)},s.prototype.updatePanel=function(e){this._curData=e,this._countDown||(this._curData.seconds_till_fight<=0?(this._countDown=new t.CountDownUtils(this.timeTxt,e.seconds_next_signup,"距离下次报名还有：@",2),this._countDown.start()):(this._countDown=new t.CountDownUtils(this.timeTxt,e.seconds_till_fight,"距离开赛还有：@",2),this._countDown.start()));var i=!1,s=t.Facade.singleton.model.retrieveModel(t.ModelDef.ALL_STATUS_MODEL);if(1==s.getStatueFlagByName(t.AllStatusModel.WULIN_STATE)){i=!0,s.setStatueFlagByName(t.AllStatusModel.WULIN_STATE,0);var n=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);n.setDailyDataValue(t.ServerSetDataModel.KEY_DAILY_WULIN_REDDOT,1)}if(!this._tabIndexMap){var a=e.sec_list.length,o="";this._tabIndexMap={};for(var r=0;a>r;r++)o+=r!=a-1?e.sec_list[r].sec_name+",":e.sec_list[r].sec_name,this._tabIndexMap[e.sec_list[r].sec_id]=r;this.tab.labels=o,this.parent.skin.sessionTxt.text=""+e.pid,this.tokenNum.text="武林帖X"+e.goodsnum,this.tab.selectedIndex=this._tabIndexMap[e.sec_id]}this.tabPanel.hScrollBar.value=0,this.signUpBtn.off(Laya.Event.CLICK,this,this.onClickSignUp),this.redIcon.visible=!1,this._curData.arena_id<0?this._baseData.seconds_till_signup<=0?(this.signUpBtn.filters=t.FiltersUtils.getGreyFilters(),this.signUpBtn.label="报名结束"):(this.signUpBtn.filters=t.FiltersUtils.getGreyFilters(),this.signUpBtn.label="报名已满"):0==this._curData.arena_id?(this._curData.sec_id==this._baseData.sec_id?(this.signUpBtn.filters=null,this.signUpBtn.on(Laya.Event.CLICK,this,this.onClickSignUp),(i||this._curData.seconds_till_fight>0)&&(this.redIcon.visible=!0)):this.signUpBtn.filters=t.FiltersUtils.getGreyFilters(),this.signUpBtn.label="开始报名"):(this.signUpBtn.filters=t.FiltersUtils.getGreyFilters(),this.signUpBtn.label="已报名"),this.list.array=this._curData.arenalist,this.setScrollerValue(),this.list.array&&(1==this.list.array.length?this.list.x=333:2==this.list.array.length?(this.list.x=179,this.list.spaceX=100):3==this.list.array.length?(this.list.x=93,this.list.spaceX=31):(this.list.x=6,this.list.spaceX=9))},s.prototype.onListRender=function(t,e){var i=this.list.getItem(e);if(i){var s=this.fightIconShowHide(e,i);t.setData(i,e,s)}},s.prototype.setScrollerValue=function(){if(this.list.array.length>0){for(var t=0,e=0;e<this.list.array.length;e++)if(this.fightIconShowHide(e,this.list.array[e])){t=3>=e?0:7>=e?371:742;break}this.list.scrollBar.value=t,this.onListChange()}},s.prototype.fightIconShowHide=function(t,e){return this._curData.sec_id==this._baseData.sec_id&&this._curData.arena_id==e.arena_id},s.prototype.onSelectTab=function(e){if(this._isFirstQuery)this._isFirstQuery=!1;else{var i=this._baseData.sec_list[e].sec_id;this._cacheData[i]?this.updatePanel(this._cacheData[i]):(this._querySecId=i,t.XHR().Post({cmd:"wulin",op:"query",sec_id:i},this,this.onQuery))}},s.prototype.onClickSignUp=function(){if(t.Facade.callCommand(new t.CheckShowGuideCommand(t.CheckShowGuideCommand.WULIN_SIGNUP)),this._baseData&&this._baseData.goodsnum<=0){t.WeakTips.show("武林帖不足");var e=new t.BuyCommand(this.GOOD_ID);e.on(this,this.onBuyFinish),t.Facade.callCommand(e)}else t.XHR().Post({cmd:"wulin",op:"signup"},this,this.onSignUp)},s.prototype.onBuyFinish=function(t){t.off(),this._baseData.goodsnum+=t.num,this.tokenNum.text="武林帖X"+this._baseData.goodsnum},s.prototype.onSignUp=function(e){if(0==e.result){t.WeakTips.show("报名成功"),this._baseData.arena_id=e.arena_id,this._baseData.goodsnum--,this.tokenNum.text="武林帖X"+this._baseData.goodsnum,this.list.refresh(),this.setScrollerValue(),this.signUpBtn.off(Laya.Event.CLICK,this,this.onClickSignUp),this.signUpBtn.filters=t.FiltersUtils.getGreyFilters(),this.signUpBtn.label="已报名",this.redIcon.visible=!1;var i=t.Facade.singleton.model.retrieveModel(t.ModelDef.SERVER_SET_DATA_MODEL);i.setDailyDataValue(t.ServerSetDataModel.KEY_DAILY_WULIN_REDDOT,1)}else t.WeakTips.show(e.msg)},s.prototype.onChangeScrollerStart=function(){this.list.scrollBar.on(Laya.Event.CHANGE,this,this.onListChangeValue),Laya.Tween.clearAll(this.list.scrollBar)},s.prototype.onChangeScrollerEnd=function(){console.log("value:"+this.list.scrollBar.value),this.list.scrollBar.on(Laya.Event.CHANGE,this,this.onListChangeValue);var t=this.list.scrollBar.value;if(185.5>t)t>0?Laya.Tween.to(this.list.scrollBar,{value:0},t/185.5*500,null,Handler.create(this,this.onListChange)):(this.list.scrollBar.value=0,this.onListChange());else if(556.5>t){var e=t>371?(t-371)/185.5:(371-t)/185.5;Laya.Tween.to(this.list.scrollBar,{value:371},500*e,null,Handler.create(this,this.onListChange))}else if(t>=740)this.list.scrollBar.value=742,this.onListChange();else{var e=t>742?(t-742)/185.5:(742-t)/185.5;Laya.Tween.to(this.list.scrollBar,{value:742},500*e,null,Handler.create(this,this.onListChange))}},s.prototype.onListChangeValue=function(){var t=this.list.scrollBar.value;0>=t?(this.list.scrollBar.off(Laya.Event.CHANGE,this,this.onListChangeValue),this.list.scrollBar.value=0,this.onListChange()):t>=740&&(this.list.scrollBar.off(Laya.Event.CHANGE,this,this.onListChangeValue),this.list.scrollBar.value=742,this.onListChange())},s.prototype.onListChange=function(){},s}(ui.wulin.WuLinSignUpUI);t.WuLinSignUp=e;var i=function(e){function i(){e.call(this),this.on(Laya.Event.CLICK,this,this.onClick),this._img=new Laya.Image,this._img.skin="ui/comp/kcash.png",this._img.width=180,this._img.height=180,this._img.x=-10,this._img.y=-10,t.Global.isWXAPP||(this.head.mask=this._img)}return __extends(i,e),i.prototype.destroy=function(){e.prototype.destroy.call(this)},i.prototype.setData=function(e,s,n){if(e){this._curData=e;var a=e.status-1;if(this.type0.visible=!1,this.type1.visible=!1,this.type2.visible=!1,this.type3.visible=!1,this["type"+a].visible=!0,this.typeTxt.text=i.typeArr[a],this.nameTxt.text=e["ex-champion"],this.nameImg.skin="ui/wulin/a"+s+".png",this.fightIcon.visible=n,this.fightBg.visible=n,e.headurl)if(t.Global.isWX)this.head.skin=t.JSUtils.getHeadUrl(e.headurl);else if(t.Global.isSQ){var o=e.headurl.replace(/40$/,"160");this.head.skin=t.JSUtils.getHeadUrl(o)}else{var o=e.headurl.replace(/50$/,"100");this.head.skin=t.JSUtils.getHeadUrl(o)}else this.head.skin="ui/wulin/h"+s+".png"}},i.prototype.onClick=function(){this._curData&&t.dispatch(t.WuLinModule.WULIN_CLICK_AREA,this._curData.arena_id)},i.typeArr=["人气","热闹","火爆","爆满"],i}(ui.wulin.WuLinItemUI)}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(e){function i(){e.call(this,new ui.wulin.WuLinUI,!0,!1),this.m_ui=this.skin,this.setCloseButton(this.m_ui.back.closeBtn),this.name="WulinBox",this._isFirst=!0,this.m_ui.back.derocation_left.skin="ui/comp/rope_xia.png",this.m_ui.back.derocation_left.x=120,this._signUp=new t.WuLinSignUp,this._course=new t.WuLinCourse,this._mine=new t.WuLinMine,this.addChild(this._signUp),this.addChild(this._course),this.addChild(this._mine),this.m_ui.tab.labels="报\n\n名,赛\n\n程,我\n的\n战\n绩",this.m_ui.tab.selectHandler=new Handler(this,this.onSelectTab),this.tabIndex=0,this._areaId=0,this.m_ui.rule.on(Laya.Event.CLICK,this,this.onClickRule),this.addChild(this.m_ui.rule)}return __extends(i,e),i.prototype.destroy=function(){this.m_ui.rule.off(Laya.Event.CLICK,this,this.onClickRule),this._signUp.destroy(),this._course.destroy(),this._mine.destroy(),e.prototype.destroy.call(this),this._signUp=null,this._course=null,this._mine=null},i.prototype.onShowed=function(){e.prototype.onShowed.call(this),t.addListener(t.WuLinModule.WULIN_CLICK_AREA,this,this.onClickArea),this._isFirst?this._isFirst=!1:this.resetImageSkin(this),this.m_ui.tab.selectedIndex=this.tabIndex},i.prototype.onHided=function(){e.prototype.onHided.call(this),t.removeListener(t.WuLinModule.WULIN_CLICK_AREA,this,this.onClickArea),this._signUp.clearData(),this._course.clearData(),this.m_ui.tab.selectedIndex=-1},i.prototype.onClickArea=function(t){this._areaId=t,this.m_ui.tab.selectedIndex=1},i.prototype.onSelectTab=function(t){switch(this._signUp.visible=!1,this._course.visible=!1,this._mine.visible=!1,t){case 0:this._signUp.visible=!0,this._signUp.update();break;case 1:this._course.visible=!0,this._course.update(this._areaId),this._areaId=0;break;case 2:this._mine.visible=!0,this._mine.update()}},i.prototype.onClickRule=function(){var e="<img src='ui/comp/icon.png'></img><span style='font-weight:bold'>报名规则：</span>每届比赛只能报一个等级段内的一个赛区，每次报名消耗武林帖 * 1，每个大区都有人数限制，先到先得！<br><img src='ui/comp/icon.png'></img><span style='font-weight:bold'>报名时间：</span>每天12:00开始本届大赛的报名，报名截止时间为23:50分或大区名额已满<br><img src='ui/comp/icon.png'></img><span style='font-weight:bold'>比赛时间：</span>比赛在报名截止时间的10分钟后进行，即第二天的00:00开始打响<br><img src='ui/comp/icon.png'></img><span style='font-weight:bold'>比赛规则：</span>武林大会采用一局定胜负制，玩家可以在战斗开始前吃好药水，做好万全准备<br><img src='ui/comp/icon.png'></img><span style='font-weight:bold'>比赛奖励：</span>每次武林大会结束后，武林大会官方委员会根据参赛者的战斗结果发放奖励，每一轮都有相应的奖励，晋级的轮数越多，奖励越丰厚。<br><br><br><br>";t.RulePanel.showRule(e,"")},i}(t.BaseBox);t.WuLinView=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(hf){var Event=laya.events.Event,Request=function(_super){function Request(){_super.call(this),this.on(Event.COMPLETE,this,this.onLoadComplete),this.on(Event.ERROR,this,this.onLoadError)}return __extends(Request,_super),Request.prototype.open=function(t,e,i,s){this._successHandler=i,this._faildHandler=s,this.url=t,_super.prototype.send.call(this,t,e)},Request.prototype.onLoadComplete=function(e){var data=this.data,result=eval("("+data.toString()+")");hf.Logger.log(this.data),this._successHandler(result)},Request.prototype.onLoadError=function(t){null!=this._faildHandler&&this._faildHandler(t)},Request}(laya.net.HttpRequest);hf.Request=Request}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(){t.call(this),this.data="{}"}return __extends(e,t),e.prototype.Read=function(t){return this.data=t.getUTFString(),!0},e.prototype.Write=function(t){return t.writeUTFString(this.data),!0},e}(t.BaseMessage);t.MsgCommon=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.Event,i=laya.ani.bone.Templet,s=function(t){function s(e,i){void 0===i&&(i=0),t.call(this),this._url=e,this._mode=i,this._resLoaded=!1,this._needDestory=!1,this._resError=!1,this._handlerArr=[],this.init()}return __extends(s,t),Object.defineProperty(s.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),s.prototype.destroy=function(){this._resLoaded?(this._resLoaded=!1,this.removeChild(this._skeleton),this._skeleton.offAll(),this._skeleton.stop(),Laya.timer.frameOnce(1,this,this.delayDestory)):this._resError?(this._templet&&(this._templet.destroy(),this._templet=null),t.prototype.destroy.call(this)):this._needDestory=!0},s.inserTemplet=function(t,e){return s.templetMap[t]?(console.log("已经存在动画"),!1):(s.templetMap[t]={templet:e,num:1},!0)},s.getTemplet=function(t){return s.templetMap[t]?(s.templetMap[t].num++,s.templetMap[t].templet):null},s.removeTemplet=function(t){return s.templetMap[t]?1==s.templetMap[t].num?(s.templetMap[t].templet.destroy(),s.templetMap[t]=null,!0):void s.templetMap[t].num--:!1},Object.defineProperty(s.prototype,"resLoaded",{get:function(){return this._resLoaded},enumerable:!0,configurable:!0}),s.prototype.delayDestory=function(){if(this._skeleton.destroy(),s.templetMap[this._url])if(s.templetMap[this._url].num<=1){if(s.templetMap[this._url].templet.destroy(),s.templetMap[this._url].templetArr)for(var e=s.templetMap[this._url].templetArr.length,i=0;e>i;i++)s.templetMap[this._url].templetArr[i].destroy();delete s.templetMap[this._url],s.templetMap[this._url]=null}else s.templetMap[this._url].num--;this._skeleton=null,this._templet=null,t.prototype.destroy.call(this)},s.prototype.init=function(){s.templetMap[this._url]?(this._templet=s.templetMap[this._url].templet,s.templetMap[this._url].num++,this.buildSke()):(this._templet=new i,this._templet.on(e.ERROR,this,this.onResError),this._templet.on(e.COMPLETE,this,this.onResLoaded),this._templet.loadAni(this._url))},s.prototype.onResError=function(){console.log("动画资源加载错误"),this._resError=!0,this._needDestory&&(this._templet.destroy(),this._templet=null,t.prototype.destroy.call(this)),this.event(e.ERROR)},s.prototype.onResLoaded=function(){this._needDestory?(this._templet.destroy(),this._templet=null,t.prototype.destroy.call(this)):(s.templetMap[this._url]?(s.templetMap[this._url].templetArr||(s.templetMap[this._url].templetArr=[]),s.templetMap[this._url].templetArr.push(this._templet),this._templet=s.templetMap[this._url].templet,s.templetMap[this._url].num++):s.templetMap[this._url]={templet:this._templet,num:1},this.buildSke())},s.prototype.buildSke=function(){this._resLoaded=!0,this._skeleton=this._templet.buildArmature(this._mode),this._skeleton.on(e.STOPPED,this,this.onStop),this._skeleton.on(e.LABEL,this,this.onLabel),this.addChild(this._skeleton),this.runHandler(),Laya.timer.frameOnce(1,this,this.event,[Laya.Event.COMPLETE])},s.prototype.onStop=function(t){this.event(e.STOPPED,t)},s.prototype.onLabel=function(t){this.event(e.LABEL,t)},s.prototype.runHandler=function(){for(var t=0;t<this._handlerArr.length;t++)this._handlerArr[t].run();this._handlerArr.length=0},s.prototype.play=function(t,e,i,s,n,a){return this._resLoaded?void this._skeleton.play(t,e,i,s,n,a):void this._handlerArr.push(Handler.create(this,this.play,[t,e,i,s,n,a]))},s.prototype.stop=function(){return this._resLoaded?void this._skeleton.stop():void this._handlerArr.push(Handler.create(this,this.stop))},s.prototype.paused=function(){return this._resLoaded?void this._skeleton.paused():void this._handlerArr.push(Handler.create(this,this.paused))},s.prototype.resume=function(){return this._resLoaded?void this._skeleton.resume():void this._handlerArr.push(Handler.create(this,this.resume))},s.prototype.showSkinByName=function(t){return this._resLoaded?void this._skeleton.showSkinByName(t):void this._handlerArr.push(Handler.create(this,this.showSkinByName,[t]))},s.prototype.playbackRate=function(t){return this._resLoaded?void this._skeleton.playbackRate(t):void this._handlerArr.push(Handler.create(this,this.playbackRate,[t]))},s.prototype.setSlotSkin=function(t,e){return this._resLoaded?void this._skeleton.setSlotSkin(t,e):void this._handlerArr.push(Handler.create(this,this.setSlotSkin,[t,e]))},Object.defineProperty(s.prototype,"index",{get:function(){return this._resLoaded?this._skeleton.index:0},set:function(t){return this._resLoaded?void this.setIndex(t):void this._handlerArr.push(Handler.create(this,this.setIndex,[t]))},enumerable:!0,configurable:!0}),s.prototype.setIndex=function(t){this._skeleton.index=t},s.prototype.getSlotByName=function(t){return this._resLoaded?this._skeleton.getSlotByName(t):null},Object.defineProperty(s.prototype,"player",{get:function(){return this._resLoaded?this._skeleton.player:null},enumerable:!0,configurable:!0}),s.templetMap={},s}(Laya.Sprite);t.AnimationSKe=s}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.net.Loader,i=function(i){function s(t){i.call(this),this._url="",this._imgWidth=0,this._imgHeight=0,this._url=t}return __extends(s,i),Object.defineProperty(s.prototype,"imgWidth",{get:function(){return this._imgWidth},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"imgHeight",{get:function(){return this._imgHeight},enumerable:!0,configurable:!0}),s.prototype.destroy=function(){i.prototype.destroy.call(this)},s.prototype.showWord=function(i,s,n){void 0===s&&(s=!0),void 0===n&&(n=0),s&&this.graphics.clear(),this._imgWidth=0,this._imgHeight=0;for(var a,o,r=i.split(""),h=r.length,l=0,c=0;h>c;c++)a=r[c],o=e.getRes(this._url+a+".png"),o?(this.graphics.drawTexture(o,l,0),l+=o.sourceWidth+n,o.sourceHeight>this._imgHeight&&(this._imgHeight=o.sourceHeight)):(console.error("ImageWord:不存在资源"+a),t.Logger.log("ImageWord:不存在资源"+a));this._imgWidth=l-n},s.prototype.showWordUnit=function(i,s,n){void 0===s&&(s=!0),void 0===n&&(n=0),s&&this.graphics.clear(),this._imgWidth=0,this._imgHeight=0;var a,o=0;a=e.getRes(this._url+i+".png"),a?(this.graphics.drawTexture(a,o,0),o+=a.sourceWidth+n,a.sourceHeight>this._imgHeight&&(this._imgHeight=a.sourceHeight),this._imgWidth=o-n):(console.error("ImageWord:不存在资源"+i),t.Logger.log("ImageWord:不存在资源"+i))},s}(Laya.Sprite);t.ImageWord=i}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=function(t){function e(e,i,s){t.call(this),this._imgUrls=e,this._rollHeight=i,this._rollWidth=s;for(var n=0;3>n;n++)this["_img"+n]=new Laya.Image,this["_img"+n].width=s,this["_img"+n].height=i,this.addChild(this["_img"+n]);this.scrollRect=new Laya.Rectangle(0,0,s,i),this._img1.y=i,this._img2.y=2*i,this._curIndex=0,this.setSkin()}return __extends(e,t),e.prototype.destroy=function(){Laya.Tween.clearAll(this._img0),Laya.Tween.clearAll(this._img1),Laya.Tween.clearAll(this._img2),t.prototype.destroy.call(this)},e.prototype.setSkin=function(){var t=this._curIndex;t<this._imgUrls.length?this._img0.skin=this._imgUrls[t]:(t=0,this._img0.skin=this._imgUrls[t]),t++,t<this._imgUrls.length?this._img1.skin=this._imgUrls[t]:(t=0,this._img1.skin=this._imgUrls[0]),t++,t<this._imgUrls.length?this._img2.skin=this._imgUrls[t]:this._img2.skin=this._imgUrls[0],this._curIndex++,this._curIndex>=this._imgUrls.length&&(this._curIndex=0)},e.prototype.play=function(t,e,i,s){void 0===i&&(i=null),void 0===s&&(s=150),this._time=t,this._targIndex=e,this._curTime=0,this._onceTime=s,this._onceTime2=s,this._callBackHandler=i,this.rollImage()},e.prototype.rollImage=function(){Laya.Tween.to(this._img0,{y:-this._rollHeight},this._onceTime),Laya.Tween.to(this._img1,{y:0},this._onceTime),Laya.Tween.to(this._img2,{y:this._rollHeight},this._onceTime,null,Laya.Handler.create(this,this.onRollEnd))},e.prototype.onRollEnd=function(){return this._img0.y=0,this._img1.y=this._rollHeight,this._img2.y=2*this._rollHeight,this._curTime>this._time&&this._targIndex==this._curIndex?(this.setSkin(),void(this._callBackHandler&&(this._callBackHandler.run(),this._callBackHandler.recover(),this._callBackHandler=null))):(this.setSkin(),this.rollImage(),void(this._curTime+=this._onceTime))},e}(Laya.Sprite);t.RollNumber=e}(hf||(hf={}));var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},hf;!function(t){var e=laya.events.EventDispatcher,i=laya.events.Event,s=function(e){function s(){e.call(this),this._count=0}return __extends(s,e),s.prototype.createCanva=function(){var t=document.getElementsByTagName("body")[0];this._canvas=document.createElement("canvas"),this._canvas.id="shareCanvas",this._canvas.width=this._data.width,this._canvas.height=this._data.height,this._canvas.style.visibility="hidden",t.appendChild(this._canvas)},s.prototype.loadImage=function(){var t=new Image,e=this._data.imgDatas[this._count],s=this;t.onload=function(){var n=s._canvas.getContext("2d");n.save(),n.scale(e.scaleX,e.scaleY),n.drawImage(t,e.x/e.scaleX,e.y/e.scaleY,e.width,e.height),n.restore(),s._count++,s._count>=s._data.imgDatas.length?s.event(i.COMPLETE):s.loadImage()},t.src=e.skin},s.prototype.createData=function(t){var e;if(t instanceof Laya.Image){e={},e.x=0,e.y=0,e.width=t.width,e.height=t.height;var i=[];this.getNodeDate(t,i,-t.x,-t.y),e.imgDatas=i}else if(t instanceof Sprite){e={},e.x=0,e.y=0;var s=t.getBounds();e.width=s.width,e.height=s.height;var i=[];this.getNodeDate(t,i,-t.x,-t.y),e.imgDatas=i}return e},s.prototype.getNodeDate=function(e,i,s,n){if(e.numChildren>0){s+=e.x,n+=e.y;for(var a=0;a<e.numChildren;a++)this.getNodeDate(e.getChildAt(a),i,s,n)}else if(e.skin&&""!=e.skin){var o={};o.width=e.width,o.height=e.height,o.x=e.x+s,o.y=e.y+n,o.scaleX=e.scaleX,o.scaleY=e.scaleY,o.skin=t.ResVersionControl.handelVersionUrl(e.skin),i.push(o)}},s.prototype.createByDisplay=function(t){this._data=this.createData(t),this._data&&(this.createCanva(),this.loadImage())},s.prototype.destory=function(){var t=document.getElementsByTagName("body")[0];t.removeChild(this._canvas),this._data=null,this._canvas=null},Object.defineProperty(s.prototype,"source",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),s}(e);t.ShareCanvas=s}(hf||(hf={}));var Sprite=laya.display.Sprite,Browser=laya.utils.Browser,Stat=laya.utils.Stat,WebGL=laya.webgl.WebGL,ProgressBar=hf.ProgressBar,Global=hf.Global,LayerMgr=hf.LayerMgr,Layer=hf.Layer,Logger=hf.Logger,Facade=hf.Facade,Plugindef=hf.PluginDef,UserInfoCommand=hf.UserInfoCommand,HomeCommand=hf.HomeCommand,CommandMgrEvent=hf.CommandMgrEvent,EventCenter=hf.EventCenter,Loader=laya.net.Loader,Handler=laya.utils.Handler,RoleSpeak=hf.RoleSpeak,RoleSpeakData=hf.RoleSpeakData,LevelView=hf.LevelView,LilianMgr=hf.LilianMgr,Util=hf.Util,DramaMgr=hf.DramaMgr,PlayDramaCmd=hf.PlayDramaCmd,SceneMgr=hf.SceneMgr,HFMain=function(){function t(){this.hasreg=!1,this.CGhasplay=!1,hf.JSUtils.loadtext("正在初始化脚本..."),Browser.container.style.display="none",hf.Report.SpeedPoint(1),hf.Global.PF=hf.JSUtils.getQueryString("pf")||(window.WXAPP?"wx2":Global.PF),hf.Global.UID=hf.JSUtils.getQueryString("uid")||Global.UID||(window.WXAPP?window.UID:null),hf.Global.TOKEN=hf.JSUtils.getCookie("openkey")||hf.JSUtils.getCookie("access_token")||hf.JSUtils.getQueryString("openkey"),hf.Global.OPENID=hf.JSUtils.getCookie("openid")||hf.JSUtils.getQueryString("openid"),hf.Global.FROM=hf.JSUtils.getQueryString("from")||hf.JSUtils.getQueryString("frome")||Global.FROM,hf.Global.INVITE_OPENID=hf.JSUtils.getCookie("invite_openid")||Global.INVITE_OPENID,hf.Global.UIN=hf.JSUtils.getCookie("uin"),hf.Global.SKEY=hf.JSUtils.getCookie("skey"),hf.Global.protocol=location.protocol,hf.Global.protocol="file:"==hf.Global.protocol?"http:":hf.Global.protocol,"wanba_ts"==hf.Global.PF&&(hf.Global.PF="wb"),window.speedReport&&window.speedReport.add&&window.speedReport.add(10),Global.ReportType=Global.isWX?4:Global.isWB?2:3,hf.JSUtils.getQueryString("replay_id")&&"1"!=hf.JSUtils.getCookie("replayover")?(hf.Report.PointReport(1,[28]),this.init(),new hf.ShowReplay(hf.JSUtils.getQueryString("replay_id")),Browser.container.style.display="block"):"1"==hf.JSUtils.getCookie("hasreg")||"1"==hf.JSUtils.getCookie("CGhasplay")||Global.isWXAPP?(this.init(),hf.JSUtils.loadtext("正在初始化SDK..."),hf.JSUtils.initSDK(this,this.beforGame),this.beforeEnterGame||(this.beforeEnterGame=new hf.BeforeEnterGame),setTimeout(function(){window.policybox&&window.policybox.hide()},1e3),hf.JSUtils.setCookie("replayover","0"),this.hasreg=!0):(this.init(),hf.Report.PointReport(Global.ReportType,[3]),new hf.CgStart,Browser.container.style.display="block"),Global.isWB&&Browser.getElementById("loadprogress")&&(Browser.getElementById("loadprogress").style.display="none")}return t.prototype.getReg=function(){var t={file:"petpk",cmd:"isexist",uid:Global.UID};hf.XHR().Post(t,this,this.checkReg)},t.prototype.checkReg=function(t){0==t.result&&"1"==t.exist?(hf.Report.PointReport(1,[26]),this.beforGame(),this.hasreg=!0):(hf.Report.PointReport(1,[27]),new hf.CgStart)},t.prototype.reload=function(t){void 0===t&&(t=!1),t?hf.JSUtils.initSDK(this,this.beforGame):this.beforGame(),window.speedReport&&window.speedReport.add&&window.speedReport.add(16)},t.prototype.init=function(){"canvas"==hf.JSUtils.getQueryString("canvas_model")?Laya.init(Global.WIDTH,Global.HEIGHT,laya.webgl.canvas):Laya.init(Global.WIDTH,Global.HEIGHT,WebGL),Laya.stage.alignH=Laya.Stage.ALIGN_CENTER,Laya.stage.alignV=Laya.Stage.ALIGN_MIDDLE,this._isFixedWidth=Laya.Browser.clientWidth/Laya.Browser.clientHeight<=1334/750,Laya.stage.scaleMode=this._isFixedWidth?Laya.Stage.SCALE_FIXED_WIDTH:Laya.Stage.SCALE_FIXED_HEIGHT,Laya.stage.screenMode=Laya.Stage.SCREEN_HORIZONTAL,Laya.stage.frameRate=Laya.Stage.FRAME_SLOW,Laya.stage.bgColor="#000000",hf.ResVersionControl.init(),window.WXAPP?(hf.Global.protocol="https:",Global.WebHost=hf.Global.protocol+"//zone4.ledou.qq.com",Browser.onAndriod?Global.FLOAT_ICON_OFFSET=200:Global.FLOAT_ICON_OFFSET=175):Global.isWX?(Global.WebHost=hf.Global.protocol+"//zone2.ledou.qq.com",Global.FLOAT_ICON_OFFSET=100):Global.isWB?Global.WebHost=hf.Global.protocol+"//zone3.ledou.qq.com":Global.WebHost=hf.Global.protocol+"//zone1.ledou.qq.com",hf.Global.isTest&&(Laya.alertGlobalError=!0),View.regComponent("HFMapButton",hf.HFMapButton),View.regComponent("SBtn1",hf.SBtn1),View.regComponent("SBtn2",hf.SBtn2),View.regComponent("SBtn3",hf.SBtn3),hf.Config().init(),Laya.stage.on(Laya.Event.RESIZE,this,this.onResize),LayerMgr.setContainer(Laya.stage,Global.WIDTH,Global.HEIGHT),EventCenter.singleton.once("GET_USER_DATA_OVER",this,this.getUserDataOver),LayerMgr.getStage().on(Laya.Event.KEY_DOWN,this,this.a)},t.prototype.onResize=function(){var t=Laya.Browser.clientWidth/Laya.Browser.clientHeight<=1334/750;t!=this._isFixedWidth&&(this._isFixedWidth=t,Laya.stage.scaleMode=this._isFixedWidth?Laya.Stage.SCALE_FIXED_WIDTH:Laya.Stage.SCALE_FIXED_HEIGHT)},t.prototype.beforGame=function(){window.speedReport&&window.speedReport.add&&window.speedReport.add(17),hf.JSUtils.loadtext("SDK初始化完成..."),this.beforeEnterGame||(this.beforeEnterGame=new hf.BeforeEnterGame),this.beforeEnterGame.init(),hf.NetEvn.singleton.run()},t.prototype.a=function(t){9==t.keyCode&&Global.isTest&&Facade.callCommand(new hf.FightTestCommand),t.keyCode==Laya.Keyboard.F7?Laya.ResourceManager.systemResourceManager.traceInfo():t.keyCode==Laya.Keyboard.NUMPAD_6&&Global.isTest?hf.AthlasTools.getInstance().start():t.keyCode==Laya.Keyboard.NUMPAD_7&&Global.isTest?hf.AthlasTools.getInstance().showNext():t.keyCode==Laya.Keyboard.NUMPAD_8&&Global.isTest&&hf.AthlasTools.getInstance().end()},t.prototype.getUserDataOver=function(){Facade.singleton,Facade.addCommandMap("1001","hf.LilianCmd"),Facade.addCommandMap("1002","hf.FriendCommand"),Facade.addCommandMap("1003","hf.BagCommand"),Facade.addCommandMap("1004","hf.WuLinCommand"),Facade.addCommandMap("1005","hf.OpenUpgradeCmd"),Facade.addCommandMap("1006","hf.OpenChannelsBoxCommand"),Facade.addCommandMap("1007","hf.OpenStrengthBoxCommand"),Facade.addCommandMap("1008","hf.GetGoodsCommand"),Facade.addCommandMap("1009","hf.SignCommand"),Facade.addCommandMap("1010","hf.OpenTaskCmd"),Facade.addCommandMap("1011","hf.BuffCommand"),Facade.addCommandMap("1012","hf.OpenGemCmd"),Facade.addCommandMap("1013","hf.ResistCmd"),Facade.addCommandMap("1014","hf.ReleaseCmd"),Facade.addCommandMap("1015","hf.CatchCmd"),Facade.addCommandMap("1016","hf.RobCmd"),Facade.addCommandMap("1017","hf.OpenServentCmd"),Facade.addCommandMap("1018","hf.TowerCommand"),Facade.addCommandMap("1019","hf.InviteFriendCommand"),ProgressBar.bind(Facade.singleton.getPluginMgr(),Facade.singleton.getCommandMgr());var t=Facade.singleton.getPluginMgr();Logger.log("开始启动框架："+hf.ServerClock.getServerTime()),t.on("plugin",this,this.OnMgrOk),t.startup()},t.prototype.OnMgrOk=function(){window.policybox.hide(),Facade.singleton.retrievePlugin(Plugindef.PLUGIN_MANAGER).loadPlugin(hf.PluginDef.PLUGIN_SOUND),Facade.singleton.retrievePlugin(Plugindef.PLUGIN_MANAGER).loadPlugin(hf.PluginDef.PLUGIN_SHARE);var t,e=Facade.retrieveModel(hf.ModelDef.GUIDE_MODEL);!e.isFirst()||this.CGhasplay||"1"==hf.JSUtils.getCookie("CGhasplay")||Global.isWXAPP?(Facade.callCommand(new hf.StartGuideCommand),Facade.callCommand(new hf.StartCommonCmd),t=new HomeCommand):(hf.Report.PointReport(Global.ReportType,[3]),Logger.log("新手阶段-开始加载CG："+hf.ServerClock.getServerTime()),t=new hf.CgCommand),t.on(this,this.onCmdFinish),Facade.callCommand(t)},t.prototype.onCmdFinish=function(t){if(0==t.ecode){t.off();var e=Facade.retrieveModel(hf.ModelDef.GUIDE_MODEL);e.isFirst()&&!this.CGhasplay&&"1"!=hf.JSUtils.getCookie("CGhasplay")?(Logger.log("新手阶段-加载CG完毕："+hf.ServerClock.getServerTime()),hf.Report.SpeedPoint(3),this.beforeEnterGame.loadGameRes(!0),this.beforeEnterGame=null):(hf.Report.SpeedPoint(2),this.beforeEnterGame&&(this.beforeEnterGame.destroy(),this.beforeEnterGame=null)),hf.JSUtils.setOnAddShortcut(),hf.GameSleep().init(),hf.ClientDoubleOpen.singleton.init(),window.speedReport&&window.speedReport.add&&window.speedReport.add(20)}else hf.WeakTips.show("网络不好，请点击屏幕重试"),Laya.stage.once(Laya.Event.CLICK,this,this.retryCmd,[t]);Global.isTest||(Browser.window.onerror=hf.Report.CheckError),hf.Report.init(),Facade.retrieveModel(hf.ModelDef.SELF_USER_MODEL).level>=6&&hf.RetrenchMode.singleton.run(),
"1"==hf.JSUtils.getCookie("qmdld_login_report")?("1"==hf.JSUtils.getCookie("gamereg")?(hf.Report.PointReport(Global.ReportType,[6,9]),window.speedReport&&window.speedReport.add&&window.speedReport.add(17)):(hf.Report.PointReport(Global.ReportType,[6]),window.speedReport&&window.speedReport.add&&window.speedReport.add(16)),hf.Report.PointReport(1,[23]),hf.JSUtils.setCookie("qmdld_login_report","0"),hf.JSUtils.setCookie("gamereg","0")):hf.Report.PointReport(1,[24])},t.prototype.onKey=function(t){console.log(t)},t.prototype.retryCmd=function(t){Facade.callCommand(t)},t}();hf.Global.GameMain=new HFMain; 
 			});
 		define("index.js", function(require, module, exports){ 			
// index.js
Page({

  /**
   * 页面的初始数据
   */
  data: {
  
  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function (options) {
  
  },

  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function () {
  
  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function () {
  
  },

  /**
   * 生命周期函数--监听页面隐藏
   */
  onHide: function () {
  
  },

  /**
   * 生命周期函数--监听页面卸载
   */
  onUnload: function () {
  
  },

  /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
  onPullDownRefresh: function () {
  
  },

  /**
   * 页面上拉触底事件的处理函数
   */
  onReachBottom: function () {
  
  },

  /**
   * 用户点击右上角分享
   */
  onShareAppMessage: function () {
  
  }
}) 
 			});
 		define("weapp-adapter.js", function(require, module, exports){ 			
/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};

/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {

/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId])
/******/ 			return installedModules[moduleId].exports;

/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			exports: {},
/******/ 			id: moduleId,
/******/ 			loaded: false
/******/ 		};

/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);

/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;

/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}


/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;

/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;

/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";

/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

	'use strict';

	var _window2 = __webpack_require__(1);

	var _window = _interopRequireWildcard(_window2);

	function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

	var global = GameGlobal;

	function inject() {
	  _window.addEventListener = _window.canvas.addEventListener = function (type, listener) {
	    _window.document.addEventListener(type, listener);
	  };
	  _window.removeEventListener = _window.canvas.removeEventListener = function (type, listener) {
	    _window.document.removeEventListener(type, listener);
	  };

	  var _wx$getSystemInfoSync = wx.getSystemInfoSync(),
	      platform = _wx$getSystemInfoSync.platform;

	  // 开发者工具无法重定义 window


	  if (typeof __devtoolssubcontext === 'undefined' && platform === 'devtools') {
	    for (var key in _window) {
	      var descriptor = Object.getOwnPropertyDescriptor(global, key);

	      if (!descriptor || descriptor.configurable === true) {
	        Object.defineProperty(window, key, {
	          value: _window[key]
	        });
	      }
	    }

	    for (var _key in _window.document) {
	      var _descriptor = Object.getOwnPropertyDescriptor(global.document, _key);

	      if (!_descriptor || _descriptor.configurable === true) {
	        Object.defineProperty(global.document, _key, {
	          value: _window.document[_key]
	        });
	      }
	    }
	    window.parent = window;
	  } else {
	    for (var _key2 in _window) {
	      global[_key2] = _window[_key2];
	    }
	    global.window = _window;
	    window = global;
	    window.top = window.parent = window;
	  }
	}

	if (!GameGlobal.__isAdapterInjected) {
	  GameGlobal.__isAdapterInjected = true;
	  inject();
	}

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

	'use strict';

	Object.defineProperty(exports, "__esModule", {
	  value: true
	});
	exports.cancelAnimationFrame = exports.requestAnimationFrame = exports.clearInterval = exports.clearTimeout = exports.setInterval = exports.setTimeout = exports.canvas = exports.location = exports.localStorage = exports.HTMLElement = exports.FileReader = exports.Audio = exports.Image = exports.WebSocket = exports.XMLHttpRequest = exports.navigator = exports.document = undefined;

	var _WindowProperties = __webpack_require__(2);

	Object.keys(_WindowProperties).forEach(function (key) {
	  if (key === "default" || key === "__esModule") return;
	  Object.defineProperty(exports, key, {
	    enumerable: true,
	    get: function get() {
	      return _WindowProperties[key];
	    }
	  });
	});

	var _constructor = __webpack_require__(3);

	Object.keys(_constructor).forEach(function (key) {
	  if (key === "default" || key === "__esModule") return;
	  Object.defineProperty(exports, key, {
	    enumerable: true,
	    get: function get() {
	      return _constructor[key];
	    }
	  });
	});

	var _Canvas = __webpack_require__(9);

	var _Canvas2 = _interopRequireDefault(_Canvas);

	var _document2 = __webpack_require__(10);

	var _document3 = _interopRequireDefault(_document2);

	var _navigator2 = __webpack_require__(17);

	var _navigator3 = _interopRequireDefault(_navigator2);

	var _XMLHttpRequest2 = __webpack_require__(18);

	var _XMLHttpRequest3 = _interopRequireDefault(_XMLHttpRequest2);

	var _WebSocket2 = __webpack_require__(19);

	var _WebSocket3 = _interopRequireDefault(_WebSocket2);

	var _Image2 = __webpack_require__(11);

	var _Image3 = _interopRequireDefault(_Image2);

	var _Audio2 = __webpack_require__(12);

	var _Audio3 = _interopRequireDefault(_Audio2);

	var _FileReader2 = __webpack_require__(20);

	var _FileReader3 = _interopRequireDefault(_FileReader2);

	var _HTMLElement2 = __webpack_require__(4);

	var _HTMLElement3 = _interopRequireDefault(_HTMLElement2);

	var _localStorage2 = __webpack_require__(21);

	var _localStorage3 = _interopRequireDefault(_localStorage2);

	var _location2 = __webpack_require__(22);

	var _location3 = _interopRequireDefault(_location2);

	function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

	exports.document = _document3.default;
	exports.navigator = _navigator3.default;
	exports.XMLHttpRequest = _XMLHttpRequest3.default;
	exports.WebSocket = _WebSocket3.default;
	exports.Image = _Image3.default;
	exports.Audio = _Audio3.default;
	exports.FileReader = _FileReader3.default;
	exports.HTMLElement = _HTMLElement3.default;
	exports.localStorage = _localStorage3.default;
	exports.location = _location3.default;


	// 暴露全局的 canvas
	var canvas = new _Canvas2.default();

	exports.canvas = canvas;
	exports.setTimeout = setTimeout;
	exports.setInterval = setInterval;
	exports.clearTimeout = clearTimeout;
	exports.clearInterval = clearInterval;
	exports.requestAnimationFrame = requestAnimationFrame;
	exports.cancelAnimationFrame = cancelAnimationFrame;

/***/ }),
/* 2 */
/***/ (function(module, exports) {

	"use strict";

	Object.defineProperty(exports, "__esModule", {
	  value: true
	});

	var _wx$getSystemInfoSync = wx.getSystemInfoSync(),
	    screenWidth = _wx$getSystemInfoSync.screenWidth,
	    screenHeight = _wx$getSystemInfoSync.screenHeight,
	    devicePixelRatio = _wx$getSystemInfoSync.devicePixelRatio;

	var innerWidth = exports.innerWidth = screenWidth;
	var innerHeight = exports.innerHeight = screenHeight;
	exports.devicePixelRatio = devicePixelRatio;
	var screen = exports.screen = {
	  availWidth: innerWidth,
	  availHeight: innerHeight
	};
	var performance = exports.performance = {
	  now: function now() {
	    return Date.now() / 1000;
	  }
	};
	var ontouchstart = exports.ontouchstart = null;
	var ontouchmove = exports.ontouchmove = null;
	var ontouchend = exports.ontouchend = null;

/***/ }),
/* 3 */
/***/ (function(module, exports, __webpack_require__) {

	'use strict';

	Object.defineProperty(exports, "__esModule", {
	  value: true
	});
	exports.HTMLCanvasElement = exports.HTMLImageElement = undefined;

	var _HTMLElement3 = __webpack_require__(4);

	var _HTMLElement4 = _interopRequireDefault(_HTMLElement3);

	function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

	function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

	function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

	function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

	var HTMLImageElement = exports.HTMLImageElement = function (_HTMLElement) {
	  _inherits(HTMLImageElement, _HTMLElement);

	  function HTMLImageElement() {
	    _classCallCheck(this, HTMLImageElement);

	    return _possibleConstructorReturn(this, (HTMLImageElement.__proto__ || Object.getPrototypeOf(HTMLImageElement)).call(this, 'img'));
	  }

	  return HTMLImageElement;
	}(_HTMLElement4.default);

	var HTMLCanvasElement = exports.HTMLCanvasElement = function (_HTMLElement2) {
	  _inherits(HTMLCanvasElement, _HTMLElement2);

	  function HTMLCanvasElement() {
	    _classCallCheck(this, HTMLCanvasElement);

	    return _possibleConstructorReturn(this, (HTMLCanvasElement.__proto__ || Object.getPrototypeOf(HTMLCanvasElement)).call(this, 'canvas'));
	  }

	  return HTMLCanvasElement;
	}(_HTMLElement4.default);

/***/ }),
/* 4 */
/***/ (function(module, exports, __webpack_require__) {

	'use strict';

	Object.defineProperty(exports, "__esModule", {
	  value: true
	});

	var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

	var _Element2 = __webpack_require__(5);

	var _Element3 = _interopRequireDefault(_Element2);

	var _util = __webpack_require__(8);

	var _WindowProperties = __webpack_require__(2);

	function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

	function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

	function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

	function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

	var HTMLElement = function (_Element) {
	  _inherits(HTMLElement, _Element);

	  function HTMLElement() {
	    var tagName = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';

	    _classCallCheck(this, HTMLElement);

	    var _this = _possibleConstructorReturn(this, (HTMLElement.__proto__ || Object.getPrototypeOf(HTMLElement)).call(this));

	    _this.className = '';
	    _this.childern = [];
	    _this.style = {
	      width: _WindowProperties.innerWidth + 'px',
	      height: _WindowProperties.innerHeight + 'px'
	    };
	    _this.insertBefore = _util.noop;
	    _this.innerHTML = '';

	    _this.tagName = tagName.toUpperCase();
	    return _this;
	  }

	  _createClass(HTMLElement, [{
	    key: 'setAttribute',
	    value: function setAttribute(name, value) {
	      this[name] = value;
	    }
	  }, {
	    key: 'getAttribute',
	    value: function getAttribute(name) {
	      return this[name];
	    }
	  }, {
	    key: 'getBoundingClientRect',
	    value: function getBoundingClientRect() {
	      return {
	        top: 0,
	        left: 0,
	        width: _WindowProperties.innerWidth,
	        height: _WindowProperties.innerHeight
	      };
	    }
	  }, {
	    key: 'focus',
	    value: function focus() {}
	  }, {
	    key: 'clientWidth',
	    get: function get() {
	      var ret = parseInt(this.style.fontSize, 10) * this.innerHTML.length;

	      return Number.isNaN(ret) ? 0 : ret;
	    }
	  }, {
	    key: 'clientHeight',
	    get: function get() {
	      var ret = parseInt(this.style.fontSize, 10);

	      return Number.isNaN(ret) ? 0 : ret;
	    }
	  }]);

	  return HTMLElement;
	}(_Element3.default);

	exports.default = HTMLElement;

/***/ }),
/* 5 */
/***/ (function(module, exports, __webpack_require__) {

	'use strict';

	Object.defineProperty(exports, "__esModule", {
	  value: true
	});

	var _Node2 = __webpack_require__(6);

	var _Node3 = _interopRequireDefault(_Node2);

	function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

	function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

	function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

	function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

	var ELement = function (_Node) {
	  _inherits(ELement, _Node);

	  function ELement() {
	    _classCallCheck(this, ELement);

	    var _this = _possibleConstructorReturn(this, (ELement.__proto__ || Object.getPrototypeOf(ELement)).call(this));

	    _this.className = '';
	    _this.children = [];
	    return _this;
	  }

	  return ELement;
	}(_Node3.default);

	exports.default = ELement;

/***/ }),
/* 6 */
/***/ (function(module, exports, __webpack_require__) {

	'use strict';

	Object.defineProperty(exports, "__esModule", {
	  value: true
	});

	var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

	var _EventTarget2 = __webpack_require__(7);

	var _EventTarget3 = _interopRequireDefault(_EventTarget2);

	function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

	function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

	function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

	function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

	var Node = function (_EventTarget) {
	  _inherits(Node, _EventTarget);

	  function Node() {
	    _classCallCheck(this, Node);

	    var _this = _possibleConstructorReturn(this, (Node.__proto__ || Object.getPrototypeOf(Node)).call(this));

	    _this.childNodes = [];
	    return _this;
	  }

	  _createClass(Node, [{
	    key: 'appendChild',
	    value: function appendChild(node) {
	      if (node instanceof Node) {
	        this.childNodes.push(node);
	      } else {
	        throw new TypeError('Failed to executed \'appendChild\' on \'Node\': parameter 1 is not of type \'Node\'.');
	      }
	    }
	  }, {
	    key: 'cloneNode',
	    value: function cloneNode() {
	      var copyNode = Object.create(this);

	      Object.assign(copyNode, this);
	      return copyNode;
	    }
	  }, {
	    key: 'removeChild',
	    value: function removeChild(node) {
	      var index = this.childNodes.findIndex(function (child) {
	        return child === node;
	      });

	      if (index > -1) {
	        return this.childNodes.splice(index, 1);
	      }
	      return null;
	    }
	  }]);

	  return Node;
	}(_EventTarget3.default);

	exports.default = Node;

/***/ }),
/* 7 */
/***/ (function(module, exports) {

	'use strict';

	Object.defineProperty(exports, "__esModule", {
	  value: true
	});

	var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

	function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

	var _events = new WeakMap();

	var EventTarget = function () {
	  function EventTarget() {
	    _classCallCheck(this, EventTarget);

	    _events.set(this, {});
	  }

	  _createClass(EventTarget, [{
	    key: 'addEventListener',
	    value: function addEventListener(type, listener) {
	      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

	      var events = _events.get(this);

	      if (!events) {
	        events = {};
	        _events.set(this, events);
	      }
	      if (!events[type]) {
	        events[type] = [];
	      }
	      events[type].push(listener);

	      if (options.capture) {
	        console.warn('EventTarget.addEventListener: options.capture is not implemented.');
	      }
	      if (options.once) {
	        console.warn('EventTarget.addEventListener: options.once is not implemented.');
	      }
	      if (options.passive) {
	        console.warn('EventTarget.addEventListener: options.passive is not implemented.');
	      }
	    }
	  }, {
	    key: 'removeEventListener',
	    value: function removeEventListener(type, listener) {
	      var listeners = _events.get(this)[type];

	      if (listeners && listeners.length > 0) {
	        for (var i = listeners.length; i--; i > 0) {
	          if (listeners[i] === listener) {
	            listeners.splice(i, 1);
	            break;
	          }
	        }
	      }
	    }
	  }, {
	    key: 'dispatchEvent',
	    value: function dispatchEvent() {
	      var event = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

	      var listeners = _events.get(this)[event.type];

	      if (listeners) {
	        for (var i = 0; i < listeners.length; i++) {
	          listeners[i](event);
	        }
	      }
	    }
	  }]);

	  return EventTarget;
	}();

	exports.default = EventTarget;

/***/ }),
/* 8 */
/***/ (function(module, exports) {

	"use strict";

	Object.defineProperty(exports, "__esModule", {
	  value: true
	});
	exports.noop = noop;
	function noop() {}

/***/ }),
/* 9 */
/***/ (function(module, exports, __webpack_require__) {

	'use strict';

	Object.defineProperty(exports, "__esModule", {
	  value: true
	});
	exports.default = Canvas;

	var _constructor = __webpack_require__(3);

	var _HTMLElement = __webpack_require__(4);

	var _HTMLElement2 = _interopRequireDefault(_HTMLElement);

	var _document = __webpack_require__(10);

	var _document2 = _interopRequireDefault(_document);

	function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

	var hasModifiedCanvasPrototype = false;
	var hasInit2DContextConstructor = false;
	var hasInitWebGLContextConstructor = false;

	function Canvas() {
	  var canvas = wx.createCanvas();

	  canvas.type = 'canvas';

	  canvas.__proto__.__proto__ = new _HTMLElement2.default('canvas');

	  var _getContext = canvas.getContext;

	  canvas.getBoundingClientRect = function () {
	    var ret = {
	      top: 0,
	      left: 0,
	      width: window.innerWidth,
	      height: window.innerHeight
	    };
	    return ret;
	  };

	  return canvas;
	}

/***/ }),
/* 10 */
/***/ (function(module, exports, __webpack_require__) {

	'use strict';

	Object.defineProperty(exports, "__esModule", {
	  value: true
	});

	var _window = __webpack_require__(1);

	var window = _interopRequireWildcard(_window);

	var _HTMLElement = __webpack_require__(4);

	var _HTMLElement2 = _interopRequireDefault(_HTMLElement);

	var _Image = __webpack_require__(11);

	var _Image2 = _interopRequireDefault(_Image);

	var _Audio = __webpack_require__(12);

	var _Audio2 = _interopRequireDefault(_Audio);

	var _Canvas = __webpack_require__(9);

	var _Canvas2 = _interopRequireDefault(_Canvas);

	__webpack_require__(15);

	function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

	function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

	var events = {};

	var document = {
	  readyState: 'complete',
	  visibilityState: 'visible',
	  documentElement: window,
	  hidden: false,
	  style: {},
	  location: window.location,
	  ontouchstart: null,
	  ontouchmove: null,
	  ontouchend: null,

	  head: new _HTMLElement2.default('head'),
	  body: new _HTMLElement2.default('body'),

	  createElement: function createElement(tagName) {
	    if (tagName === 'canvas') {
	      return new _Canvas2.default();
	    } else if (tagName === 'audio') {
	      return new _Audio2.default();
	    } else if (tagName === 'img') {
	      return new _Image2.default();
	    }

	    return new _HTMLElement2.default(tagName);
	  },
	  getElementById: function getElementById(id) {
	    if (id === window.canvas.id) {
	      return window.canvas;
	    }
	    return null;
	  },
	  getElementsByTagName: function getElementsByTagName(tagName) {
	    if (tagName === 'head') {
	      return [document.head];
	    } else if (tagName === 'body') {
	      return [document.body];
	    } else if (tagName === 'canvas') {
	      return [window.canvas];
	    }
	    return [];
	  },
	  querySelector: function querySelector(query) {
	    if (query === 'head') {
	      return document.head;
	    } else if (query === 'body') {
	      return document.body;
	    } else if (query === 'canvas') {
	      return window.canvas;
	    } else if (query === '#' + window.canvas.id) {
	      return window.canvas;
	    }
	    return null;
	  },
	  querySelectorAll: function querySelectorAll(query) {
	    if (query === 'head') {
	      return [document.head];
	    } else if (query === 'body') {
	      return [document.body];
	    } else if (query === 'canvas') {
	      return [window.canvas];
	    }
	    return [];
	  },
	  addEventListener: function addEventListener(type, listener) {
	    if (!events[type]) {
	      events[type] = [];
	    }
	    events[type].push(listener);
	  },
	  removeEventListener: function removeEventListener(type, listener) {
	    var listeners = events[type];

	    if (listeners && listeners.length > 0) {
	      for (var i = listeners.length; i--; i > 0) {
	        if (listeners[i] === listener) {
	          listeners.splice(i, 1);
	          break;
	        }
	      }
	    }
	  },
	  dispatchEvent: function dispatchEvent(event) {
	    var listeners = events[event.type];

	    if (listeners) {
	      for (var i = 0; i < listeners.length; i++) {
	        listeners[i](event);
	      }
	    }
	  }
	};

	exports.default = document;

/***/ }),
/* 11 */
/***/ (function(module, exports) {

	"use strict";

	Object.defineProperty(exports, "__esModule", {
	  value: true
	});
	exports.default = Image;
	function Image() {
	  var image = wx.createImage();

	  return image;
	}

/***/ }),
/* 12 */
/***/ (function(module, exports, __webpack_require__) {

	'use strict';

	Object.defineProperty(exports, "__esModule", {
	  value: true
	});

	var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

	var _HTMLAudioElement2 = __webpack_require__(13);

	var _HTMLAudioElement3 = _interopRequireDefault(_HTMLAudioElement2);

	function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

	function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

	function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

	function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

	var HAVE_NOTHING = 0;
	var HAVE_METADATA = 1;
	var HAVE_CURRENT_DATA = 2;
	var HAVE_FUTURE_DATA = 3;
	var HAVE_ENOUGH_DATA = 4;

	var _innerAudioContext = new WeakMap();
	var _src = new WeakMap();
	var _loop = new WeakMap();
	var _autoplay = new WeakMap();

	var Audio = function (_HTMLAudioElement) {
	  _inherits(Audio, _HTMLAudioElement);

	  function Audio(url) {
	    _classCallCheck(this, Audio);

	    var _this = _possibleConstructorReturn(this, (Audio.__proto__ || Object.getPrototypeOf(Audio)).call(this));

	    _this.HAVE_NOTHING = HAVE_NOTHING;
	    _this.HAVE_METADATA = HAVE_METADATA;
	    _this.HAVE_CURRENT_DATA = HAVE_CURRENT_DATA;
	    _this.HAVE_FUTURE_DATA = HAVE_FUTURE_DATA;
	    _this.HAVE_ENOUGH_DATA = HAVE_ENOUGH_DATA;
	    _this.readyState = HAVE_NOTHING;


	    _src.set(_this, '');

	    var innerAudioContext = wx.createInnerAudioContext();

	    _innerAudioContext.set(_this, innerAudioContext);

	    innerAudioContext.onCanplay(function () {
	      _this.dispatchEvent({ type: 'load' });
	      _this.dispatchEvent({ type: 'loadend' });
	      _this.dispatchEvent({ type: 'canplay' });
	      _this.dispatchEvent({ type: 'canplaythrough' });
	      _this.dispatchEvent({ type: 'loadedmetadata' });
	      _this.readyState = HAVE_CURRENT_DATA;
	    });
	    innerAudioContext.onPlay(function () {
	      _this.dispatchEvent({ type: 'play' });
	    });
	    innerAudioContext.onPause(function () {
	      _this.dispatchEvent({ type: 'pause' });
	    });
	    innerAudioContext.onEnded(function () {
	      _this.dispatchEvent({ type: 'ended' });
	      _this.readyState = HAVE_ENOUGH_DATA;
	    });
	    innerAudioContext.onError(function () {
	      _this.dispatchEvent({ type: 'error' });
	    });

	    if (url) {
	      _innerAudioContext.get(_this).src = url;
	    }
	    return _this;
	  }

	  _createClass(Audio, [{
	    key: 'load',
	    value: function load() {
	      console.warn('HTMLAudioElement.load() is not implemented.');
	    }
	  }, {
	    key: 'play',
	    value: function play() {
	      _innerAudioContext.get(this).play();
	    }
	  }, {
	    key: 'pause',
	    value: function pause() {
	      _innerAudioContext.get(this).pause();
	    }
	  }, {
	    key: 'canPlayType',
	    value: function canPlayType() {
	      var mediaType = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';

	      if (typeof mediaType !== 'string') {
	        return '';
	      }

	      if (mediaType.indexOf('audio/mpeg') > -1 || mediaType.indexOf('audio/mp4')) {
	        return 'probably';
	      }
	      return '';
	    }
	  }, {
	    key: 'cloneNode',
	    value: function cloneNode() {
	      var newAudio = new Audio();
	      newAudio.loop = _innerAudioContext.get(this).loop;
	      newAudio.autoplay = _innerAudioContext.get(this).loop;
	      newAudio.src = this.src;
	      return newAudio;
	    }
	  }, {
	    key: 'currentTime',
	    get: function get() {
	      return _innerAudioContext.get(this).currentTime;
	    },
	    set: function set(value) {
	      _innerAudioContext.get(this).seek(value);
	    }
	  }, {
	    key: 'src',
	    get: function get() {
	      return _src.get(this);
	    },
	    set: function set(value) {
	      _src.set(this, value);
	      _innerAudioContext.get(this).src = value;
	    }
	  }, {
	    key: 'loop',
	    get: function get() {
	      return _innerAudioContext.get(this).loop;
	    },
	    set: function set(value) {
	      _innerAudioContext.get(this).loop = value;
	    }
	  }, {
	    key: 'autoplay',
	    get: function get() {
	      return _innerAudioContext.get(this).autoplay;
	    },
	    set: function set(value) {
	      _innerAudioContext.get(this).autoplay = value;
	    }
	  }, {
	    key: 'paused',
	    get: function get() {
	      return _innerAudioContext.get(this).paused;
	    }
	  }]);

	  return Audio;
	}(_HTMLAudioElement3.default);

	exports.default = Audio;

/***/ }),
/* 13 */
/***/ (function(module, exports, __webpack_require__) {

	'use strict';

	Object.defineProperty(exports, "__esModule", {
	  value: true
	});

	var _HTMLMediaElement2 = __webpack_require__(14);

	var _HTMLMediaElement3 = _interopRequireDefault(_HTMLMediaElement2);

	function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

	function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

	function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

	function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

	var HTMLAudioElement = function (_HTMLMediaElement) {
	  _inherits(HTMLAudioElement, _HTMLMediaElement);

	  function HTMLAudioElement() {
	    _classCallCheck(this, HTMLAudioElement);

	    return _possibleConstructorReturn(this, (HTMLAudioElement.__proto__ || Object.getPrototypeOf(HTMLAudioElement)).call(this, 'audio'));
	  }

	  return HTMLAudioElement;
	}(_HTMLMediaElement3.default);

	exports.default = HTMLAudioElement;

/***/ }),
/* 14 */
/***/ (function(module, exports, __webpack_require__) {

	'use strict';

	Object.defineProperty(exports, "__esModule", {
	  value: true
	});

	var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

	var _HTMLElement2 = __webpack_require__(4);

	var _HTMLElement3 = _interopRequireDefault(_HTMLElement2);

	function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

	function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

	function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

	function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

	var HTMLMediaElement = function (_HTMLElement) {
	  _inherits(HTMLMediaElement, _HTMLElement);

	  function HTMLMediaElement(type) {
	    _classCallCheck(this, HTMLMediaElement);

	    return _possibleConstructorReturn(this, (HTMLMediaElement.__proto__ || Object.getPrototypeOf(HTMLMediaElement)).call(this, type));
	  }

	  _createClass(HTMLMediaElement, [{
	    key: 'addTextTrack',
	    value: function addTextTrack() {}
	  }, {
	    key: 'captureStream',
	    value: function captureStream() {}
	  }, {
	    key: 'fastSeek',
	    value: function fastSeek() {}
	  }, {
	    key: 'load',
	    value: function load() {}
	  }, {
	    key: 'pause',
	    value: function pause() {}
	  }, {
	    key: 'play',
	    value: function play() {}
	  }]);

	  return HTMLMediaElement;
	}(_HTMLElement3.default);

	exports.default = HTMLMediaElement;

/***/ }),
/* 15 */
/***/ (function(module, exports, __webpack_require__) {

	'use strict';

	__webpack_require__(16);

/***/ }),
/* 16 */
/***/ (function(module, exports, __webpack_require__) {

	'use strict';

	var _window = __webpack_require__(1);

	var window = _interopRequireWildcard(_window);

	var _document = __webpack_require__(10);

	var _document2 = _interopRequireDefault(_document);

	var _util = __webpack_require__(8);

	function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

	function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

	function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

	var TouchEvent = function TouchEvent(type) {
	  _classCallCheck(this, TouchEvent);

	  this.target = window.canvas;
	  this.currentTarget = window.canvas;
	  this.touches = [];
	  this.targetTouches = [];
	  this.changedTouches = [];
	  this.preventDefault = _util.noop;
	  this.stopPropagation = _util.noop;

	  this.type = type;
	};

	function touchEventHandlerFactory(type) {
	  return function (event) {
	    var touchEvent = new TouchEvent(type);

	    touchEvent.touches = event.touches;
	    touchEvent.targetTouches = Array.prototype.slice.call(event.touches);
	    touchEvent.changedTouches = event.changedTouches;
	    touchEvent.timeStamp = event.timeStamp;
	    _document2.default.dispatchEvent(touchEvent);
	  };
	}

	wx.onTouchStart(touchEventHandlerFactory('touchstart'));
	wx.onTouchMove(touchEventHandlerFactory('touchmove'));
	wx.onTouchEnd(touchEventHandlerFactory('touchend'));
	wx.onTouchCancel(touchEventHandlerFactory('touchcancel'));

/***/ }),
/* 17 */
/***/ (function(module, exports, __webpack_require__) {

	'use strict';

	Object.defineProperty(exports, "__esModule", {
	  value: true
	});

	var _util = __webpack_require__(8);

	// TODO 需要 wx.getSystemInfo 获取更详细信息
	var _wx$getSystemInfoSync = wx.getSystemInfoSync(),
	    platform = _wx$getSystemInfoSync.platform;

	var navigator = {
	  platform: platform,
	  language: 'zh-cn',
	  appVersion: '5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1',
	  userAgent: 'Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/zh_CN',
	  onLine: true, // TODO 用 wx.getNetworkStateChange 和 wx.onNetworkStateChange 来返回真实的状态

	  // TODO 用 wx.getLocation 来封装 geolocation
	  geolocation: {
	    getCurrentPosition: _util.noop,
	    watchPosition: _util.noop,
	    clearWatch: _util.noop
	  }
	};

	exports.default = navigator;

/***/ }),
/* 18 */
/***/ (function(module, exports) {

	'use strict';

	Object.defineProperty(exports, "__esModule", {
	  value: true
	});

	var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

	function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

	var _url = new WeakMap();
	var _method = new WeakMap();
	var _requestHeader = new WeakMap();
	var _responseHeader = new WeakMap();
	var _requestTask = new WeakMap();

	function _triggerEvent(type) {
	  if (typeof this['on' + type] === 'function') {
	    for (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
	      args[_key - 1] = arguments[_key];
	    }

	    this['on' + type].apply(this, args);
	  }
	}

	function _changeReadyState(readyState) {
	  this.readyState = readyState;
	  _triggerEvent.call(this, 'readystatechange');
	}

	var XMLHttpRequest = function () {
	  // TODO 没法模拟 HEADERS_RECEIVED 和 LOADING 两个状态
	  function XMLHttpRequest() {
	    _classCallCheck(this, XMLHttpRequest);

	    this.onabort = null;
	    this.onerror = null;
	    this.onload = null;
	    this.onloadstart = null;
	    this.onprogress = null;
	    this.ontimeout = null;
	    this.onloadend = null;
	    this.onreadystatechange = null;
	    this.readyState = 0;
	    this.response = null;
	    this.responseText = null;
	    this.responseType = '';
	    this.responseXML = null;
	    this.status = 0;
	    this.statusText = '';
	    this.upload = {};
	    this.withCredentials = false;

	    _requestHeader.set(this, {
	      'content-type': 'application/x-www-form-urlencoded'
	    });
	    _responseHeader.set(this, {});
	  }

	  /*
	   * TODO 这一批事件应该是在 XMLHttpRequestEventTarget.prototype 上面的
	   */


	  _createClass(XMLHttpRequest, [{
	    key: 'abort',
	    value: function abort() {
	      var myRequestTask = _requestTask.get(this);

	      if (myRequestTask) {
	        myRequestTask.abort();
	      }
	    }
	  }, {
	    key: 'getAllResponseHeaders',
	    value: function getAllResponseHeaders() {
	      var responseHeader = _responseHeader.get(this);

	      return Object.keys(responseHeader).map(function (header) {
	        return header + ': ' + responseHeader[header];
	      }).join('\n');
	    }
	  }, {
	    key: 'getResponseHeader',
	    value: function getResponseHeader(header) {
	      return _responseHeader.get(this)[header];
	    }
	  }, {
	    key: 'open',
	    value: function open(method, url /* async, user, password 这几个参数在小程序内不支持*/) {
	      _method.set(this, method);
	      _url.set(this, url);
	      _changeReadyState.call(this, XMLHttpRequest.OPENED);
	    }
	  }, {
	    key: 'overrideMimeType',
	    value: function overrideMimeType() {}
	  }, {
	    key: 'send',
	    value: function send() {
	      var _this = this;

	      var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';

	      if (this.readyState !== XMLHttpRequest.OPENED) {
	        throw new Error("Failed to execute 'send' on 'XMLHttpRequest': The object's state must be OPENED.");
	      } else {
	        wx.request({
	          data: data,
	          url: _url.get(this),
	          method: _method.get(this),
	          header: _requestHeader.get(this),
	          responseType: this.responseType,
	          success: function success(_ref) {
	            var data = _ref.data,
	                statusCode = _ref.statusCode,
	                header = _ref.header;

	            if (typeof data !== 'string' && !(data instanceof ArrayBuffer)) {
	              try {
	                data = JSON.stringify(data);
	              } catch (e) {
	                data = data;
	              }
	            }

	            _this.status = statusCode;
	            _responseHeader.set(_this, header);
	            _triggerEvent.call(_this, 'loadstart');
	            _changeReadyState.call(_this, XMLHttpRequest.HEADERS_RECEIVED);
	            _changeReadyState.call(_this, XMLHttpRequest.LOADING);

	            _this.response = data;

	            if (data instanceof ArrayBuffer) {
	              _this.responseText = '';
	              var bytes = new Uint8Array(data);
	              var len = bytes.byteLength;

	              for (var i = 0; i < len; i++) {
	                _this.responseText += String.fromCharCode(bytes[i]);
	              }
	            } else {
	              _this.responseText = data;
	            }
	            _changeReadyState.call(_this, XMLHttpRequest.DONE);
	            _triggerEvent.call(_this, 'load');
	            _triggerEvent.call(_this, 'loadend');
	          },
	          fail: function fail(_ref2) {
	            var errMsg = _ref2.errMsg;

	            // TODO 规范错误
	            if (errMsg.indexOf('abort') !== -1) {
	              _triggerEvent.call(_this, 'abort');
	            } else {
	              _triggerEvent.call(_this, 'error', errMsg);
	            }
	            _triggerEvent.call(_this, 'loadend');
	          }
	        });
	      }
	    }
	  }, {
	    key: 'setRequestHeader',
	    value: function setRequestHeader(header, value) {
	      var myHeader = _requestHeader.get(this);

	      myHeader[header] = value;
	      _requestHeader.set(this, myHeader);
	    }
	  }]);

	  return XMLHttpRequest;
	}();

	XMLHttpRequest.UNSEND = 0;
	XMLHttpRequest.OPENED = 1;
	XMLHttpRequest.HEADERS_RECEIVED = 2;
	XMLHttpRequest.LOADING = 3;
	XMLHttpRequest.DONE = 4;
	exports.default = XMLHttpRequest;

/***/ }),
/* 19 */
/***/ (function(module, exports) {

	'use strict';

	Object.defineProperty(exports, "__esModule", {
	  value: true
	});

	var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

	function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

	var _socketTask = new WeakMap();

	var WebSocket = function () {
	  // TODO 更新 binaryType
	  // The connection is in the process of closing.
	  // The connection is not yet open.
	  function WebSocket(url) {
	    var _this = this;

	    var protocols = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];

	    _classCallCheck(this, WebSocket);

	    this.binaryType = '';
	    this.bufferedAmount = 0;
	    this.extensions = '';
	    this.onclose = null;
	    this.onerror = null;
	    this.onmessage = null;
	    this.onopen = null;
	    this.protocol = '';
	    this.readyState = 3;

		console.log(url);
		console.log(typeof url === 'string' )
		console.log(/(^wss:\/\/)/.test(url))
			console.log(/(^ws:\/\/)|(^wss:\/\/)/.test(url))
	    if (typeof url !== 'string' || !/(^ws:\/\/)|(^wss:\/\/)/.test(url)) {
	      throw new TypeError('Failed to construct \'WebSocket\': The URL \'' + url + '\' is invalid');
	    }

	    this.url = url;
	    this.readyState = WebSocket.CONNECTING;

	    var socketTask = wx.connectSocket({
	      url: url,
	      protocols: Array.isArray(protocols) ? protocols : [protocols]
	    });

	    _socketTask.set(this, socketTask);

	    socketTask.onClose(function (res) {
	      _this.readyState = WebSocket.CLOSED;
	      if (typeof _this.onclose === 'function') {
	        _this.onclose(res);
	      }
	    });

	    socketTask.onMessage(function (res) {
	      if (typeof _this.onmessage === 'function') {
	        _this.onmessage(res);
	      }
	    });

	    socketTask.onOpen(function () {
	      _this.readyState = WebSocket.OPEN;
	      if (typeof _this.onopen === 'function') {
	        _this.onopen();
	      }
	    });

	    socketTask.onError(function (res) {
	      if (typeof _this.onerror === 'function') {
	        _this.onerror(new Error(res.errMsg));
	      }
	    });

	    return this;
	  } // TODO 小程序内目前获取不到，实际上需要根据服务器选择的 sub-protocol 返回
	  // TODO 更新 bufferedAmount
	  // The connection is closed or couldn't be opened.

	  // The connection is open and ready to communicate.


	  _createClass(WebSocket, [{
	    key: 'close',
	    value: function close(code, reason) {
	      this.readyState = WebSocket.CLOSING;
	      var socketTask = _socketTask.get(this);

	      socketTask.close({
	        code: code,
	        reason: reason
	      });
	    }
	  }, {
	    key: 'send',
	    value: function send(data) {
	      if (typeof data !== 'string' && !(data instanceof ArrayBuffer)) {
	        throw new TypeError('Failed to send message: The data ' + data + ' is invalid');
	      }

	      var socketTask = _socketTask.get(this);

	      socketTask.send({
	        data: data
	      });
	    }
	  }]);

	  return WebSocket;
	}();

	WebSocket.CONNECTING = 0;
	WebSocket.OPEN = 1;
	WebSocket.CLOSING = 2;
	WebSocket.CLOSED = 3;
	exports.default = WebSocket;

/***/ }),
/* 20 */
/***/ (function(module, exports) {

	"use strict";

	Object.defineProperty(exports, "__esModule", {
	  value: true
	});

	function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

	/*
	 * TODO 使用 wx.readFile 来封装 FileReader
	 */
	var FileReader = function FileReader() {
	  _classCallCheck(this, FileReader);
	};

	exports.default = FileReader;

/***/ }),
/* 21 */
/***/ (function(module, exports) {

	"use strict";

	Object.defineProperty(exports, "__esModule", {
	  value: true
	});
	var localStorage = {
	  get length() {
	    var _wx$getStorageInfoSyn = wx.getStorageInfoSync(),
	        keys = _wx$getStorageInfoSyn.keys;

	    return keys.length;
	  },

	  key: function key(n) {
	    var _wx$getStorageInfoSyn2 = wx.getStorageInfoSync(),
	        keys = _wx$getStorageInfoSyn2.keys;

	    return keys[n];
	  },
	  getItem: function getItem(key) {
	    return wx.getStorageSync(key);
	  },
	  setItem: function setItem(key, value) {
	    return wx.setStorageSync(key, value);
	  },
	  removeItem: function removeItem(key) {
	    wx.removeStorageSync(key);
	  },
	  clear: function clear() {
	    wx.clearStorageSync();
	  }
	};

	exports.default = localStorage;

/***/ }),
/* 22 */
/***/ (function(module, exports) {

	'use strict';

	Object.defineProperty(exports, "__esModule", {
	  value: true
	});
	var location = {
	  href: 'game.js',
	  reload: function reload() {}
	};

	exports.default = location;

/***/ })
/******/ ]); 
 			});
 		define("game.js", function(require, module, exports){ 			
require("weapp-adapter.js");
window.WXAPP = true;


window.__last_version="20171222_14";


//登录数据
if (window.__last_version)
{
  //外网写死Path.json
  window.pathJson = {
    "WebHost":"https://zone4.ledou.qq.com",
    "WebPath":"/fcgi-bin/",
    "ResPath":"/ledoures/",
    "ClientPath":"https://res.ledou.qq.com/client/",
    "DefaultFile":"petpk",
    "PF":"wx2",
    "H5OPENID":"o8FFywJcAMLAEAo-1Xh7YkIlR0dI",
    "H5TOKEN":"12345"
  }
}




//映射外网资源
window.newRootPath = "https://res.ledou.qq.com";
if (window.__last_version){
  window.newBasePath = "https://res.ledou.qq.com/%v%/".replace("%v%", window.__last_version);
}else{
  window.newBasePath = "http://10.125.56.122/test/build/"
}
window.replacePath = function(url, basePath)
{
  if (url.indexOf("://")==-1)
  {
    url = window.newRootPath+url;
  }
  // else
  //    url = url.replace(basePath, window.newBasePath);
  //console.log("url: "+url);
  return url;
}
wx.request({
  url: 'https://res.ledou.qq.com/'+window.__last_version+'/res_version_'+window.__last_version+'.json', 
  dataType: "json",
  success: function(res) {
	  window.__res_version=res.data;
	  require("./filePackage.js");
	  
	  hf.Global.ResHost = "https://res.ledou.qq.com";
	   window["wx"].showShareMenu();

	wx.onShareAppMessage(function(){



				return {
						title: '高颜值玩家最爱的小游戏',
						imageUrl: 'https://res.ledou.qq.com/share_pic.png',
						query: 'foo=bar&invitor='+hf.Global.UID+"&invite_openid="+hf.Global.H5OPENID,   
						success:function() {
							// 转发成功
							},
						 fail:function() {
						// 转发失败
					}
				}
    })

  },
fail:function(msg){
  
  }
})
//执行js


 window["wx"].onShow(function(options){
			
				wx.updateShareMenu({
					withShareTicket: true
				})
		 var option=wx.getLaunchOptionsSync();
			
                })

var GCIntelval=setInterval(function(){
			wx.triggerGC();
},5000) 
 			}); 	require("game.js");
 	