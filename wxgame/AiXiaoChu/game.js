	define("App.js", function(require, module, exports){ 			
!function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};e.m=t,e.c=i,e.p="",e(0)}({0:function(t,e,i){"use strict";i(67),i(68),i(74),i(75)},67:function(t,e){"use strict";var i=!1;"undefined"!=typeof Worker?(console.log("支持 Web worker"),i=!0):i=!1,i=!1;var n=function(){this._bHoldMessage=!1,this._isInit=!1,i&&(console.log("use worker mode"),this._retryCount=3,this._newWorker())};n.prototype._newWorker=function(){var t="../dist/LogicWorker.js";window.DEBUG||(t=GetConvertResUrl("dist/LogicWorker.js"));var e=new Worker(t);this._worker=e;var i=this;e.onmessage=function(t){var e=t.data;i._onMessage(e)},e.onerror=function(t){console.log(t.filename,t.lineno,t.message)};var n=[];if(window.DEBUG)n.push("ProtoBuf.js"),n.push("RemoveLogic.js");else{n.push("../../"+GetResVersion("dist/ProtoBuf.js")+"/dist/ProtoBuf.js?max_age=864000"),n.push("../../"+GetResVersion("dist/RemoveLogic.js")+"/dist/RemoveLogic.js?max_age=864000")}this._postMessage(PGD_MSG.importScript,n)},n.prototype._postMessage=function(t,e){this._worker&&this._worker.postMessage({id:this._msgId,msg:t,data:e}),this._msgId++},n.prototype._onMessage=function(t){if(console.log("_onMessage: "+JSON.stringify(t.msg)),!this._bHoldMessage){var e=null;switch(t.msg){case PGD_MSG.input:(e=this._callbackMap[PGD_MSG.input]).msgId==t.id&&(e=e&&e.callback,"function"==typeof e&&e(t.data));break;case PGD_MSG.validInput:(e=this._callbackMap[PGD_MSG.validInput]).msgId==t.id&&(e=e&&e.callback,"function"==typeof e&&e(t.data));break;case PGD_MSG.loadStage:t.data.isOk?(e=this._callbackMap[PGD_MSG.loadStage]).msgId==t.id&&(e=e&&e.callback,"function"==typeof e&&e(t.data.param[0])):(e=this._errCallbackMap[PGD_MSG.loadStage]).msgId==t.id&&(e=e&&e.callback,"function"==typeof e&&e());break;case PGD_MSG.UpdateData:for(var i=t.data,n=0,o=i.length;n<o;n++){var s=i[n];s&&(this._dataBuf[s.key]=s.data)}break;case PGD_MSG.GAMESTART:this.eventManager.trigger(PGD_MSG.GAMESTART);break;case PGD_MSG.addAnimation:console.log("addAnimation: "+JSON.stringify(t.data)),this.aniQueue.push(t.data);break;case PGD_MSG.findActive:(e=this._callbackMap[PGD_MSG.findActive]).msgId==t.id&&(e=e&&e.callback,"function"==typeof e&&e(t.data.slide_pos,t.data.crush_pos));break;case PGD_MSG.getWorldNodeDataList:(e=this._callbackMap[PGD_MSG.getWorldNodeDataList]).msgId==t.id&&(e=e&&e.callback,"function"==typeof e&&e(t.data));break;case PGD_MSG.run:t.data.isOk||(e=this._errCallbackMap[PGD_MSG.run],e.msgId==t.id&&(e=e&&e.callback,"function"==typeof e&&e()));break;case PGD_MSG.LogPanel:"undefined"!=typeof LogPanel&&LogPanel.addInfo(t.data);break;case PGD_MSG.wokerOk:console.log("worker is ok"),clearTimeout(this._loadStageTimeout),this._loadStageTimeout=null}}},n.prototype.holdMessage=function(){this._bHoldMessage=!0},n.prototype.init=function(){i?(this.eventManager=new function(){this.bind=function(t,e){return this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e),e},this.unbind=function(t,e){this._events=this._events||{},t in this._events!=0&&this._events[t].splice(this._events[t].indexOf(e),1)},this.trigger=function(t){if(this._events=this._events||{},t in this._events!=0)for(var e=0;e<this._events[t].length;e++)this._events[t][e].apply(this,Array.prototype.slice.call(arguments,1))}},this._callbackMap={},this._errCallbackMap={},this._dataBuf={},this.aniQueue=[],this._msgId=0,this._postMessage(PGD_MSG.create,{debug:bDebug})):(this.puzzleGame=new RemoveLogic.PuzzleGame,this.eventManager=this.puzzleGame.eventManager),this._isInit=!0,this._bHoldMessage=!1},n.prototype.loadStage=function(t,e,n){if(this._isInit){e=e||new Function;var o=this,s=function(){console.log("关卡加载错误回调"),window.Service&&window.Service.Util.showNetworkTip(function(){o.loadStage(t,e)}),n&&n()};if(i){this._callbackMap[PGD_MSG.loadStage]={msgId:this._msgId,callback:e},this._errCallbackMap[PGD_MSG.loadStage]={msgId:this._msgId,callback:s};var a=window.DEBUG?"../":"../../../../";this._postMessage(PGD_MSG.loadStage,{stageId:t,basePath:a}),this._retryCount>0&&(clearTimeout(this._loadStageTimeout),this._loadStageTimeout=null,this._loadStageTimeout=setTimeout(function(){console.log("worker dead"),o._retryCount--,o._worker&&o._worker.terminate(),o._newWorker(),o.init(),o.loadStage(t,e)},3500))}else this.puzzleGame.loadStage(t,e,s)}},n.prototype.getAnimation=function(){if(!this._isInit)return null;if(i){var t=this.aniQueue.shift();return t&&(this._dataBuf[PGD_MSG.getGameStatus]=t.state,t=t.aniData),t}return this.puzzleGame.getAnimation()},n.prototype.getAnimationNum=function(){return this._isInit?i?this.aniQueue.length:this.puzzleGame.getAnimationNum():0},n.prototype.getAnimationQueue=function(){return this._isInit?i?this.aniQueue:this.puzzleGame.getAnimationQueue():[]},n.prototype.getStep=function(){return this._isInit?i?this._dataBuf[PGD_MSG.getStep]:this.puzzleGame.getStep():0},n.prototype.getSuccessStep=function(){return this._isInit?i?this._dataBuf[PGD_MSG.getSuccessStep]:this.puzzleGame.getSuccessStep():0},n.prototype.getStage=function(t){return this._isInit?i?this._dataBuf[PGD_MSG.getStage]:this.puzzleGame.getStage(t):null},n.prototype.simple_stage_info=function(t){return this._isInit?(t=t||new Function,void(i?this._triggerCallBack(t,this._dataBuf[PGD_MSG.simple_stage_info]):this._triggerCallBack(t,this.puzzleGame.simple_stage_info()))):null},n.prototype.getContainChessType=function(t){return this._isInit?i?this._dataBuf[PGD_MSG.getContainChessType]:this.puzzleGame.getContainChessType(t):null},n.prototype.checkPass=function(){return!!this._isInit&&(i?this._dataBuf[PGD_MSG.checkPass]:this.puzzleGame.checkPass())},n.prototype.GetSodaLine=function(){return this._isInit?i?this._dataBuf[PGD_MSG.GetSodaLine]:this.puzzleGame.GetSodaLine():0},n.prototype.GetStartRow=function(){return this._isInit?i?this._dataBuf[PGD_MSG.GetStartRow]:this.puzzleGame.GetStartRow():0},n.prototype.IsSodaGame=function(){return!!this._isInit&&(i?this._dataBuf[PGD_MSG.IsSodaGame]:this.puzzleGame.IsSodaGame())},n.prototype.run=function(t){if(!this._isInit)return null;var e=this,n=function(){console.log("run运行错误回调"),window.Service&&window.Service.Util.showNetworkTip(function(){e.run(t)})};if(!i)return this.puzzleGame.run(t,n);this._errCallbackMap[PGD_MSG.run]={msgId:this._msgId,callback:n};var o=window.DEBUG?"../":"../../../../";this._postMessage(PGD_MSG.run,{info:t,basePath:o})},n.prototype.getRecord=function(){return this._isInit?i?this._dataBuf[PGD_MSG.getRecord]:this.puzzleGame.getRecord():null},n.prototype.respawn=function(){return this._isInit?i?void this._postMessage(PGD_MSG.respawn):this.puzzleGame.respawn():null},n.prototype.input=function(t,e){if(!this._isInit)return null;if(e=e||new Function,i){var n={op:t.op,from:t.from&&{row:t.from.row,col:t.from.col},to:t.to&&{row:t.to.row,col:t.to.col},item_id:t.item_id,value1:t.value1,value2:t.value2};this._callbackMap[PGD_MSG.input]={msgId:this._msgId,callback:e},this._postMessage(PGD_MSG.input,n)}else this._triggerCallBack(e,this.puzzleGame.input(t))},n.prototype.validInput=function(t,e){if(!this._isInit)return!1;if(e=e||new Function,i){var n={op:t.op,from:t.from&&{row:t.from.row,col:t.from.col},to:t.to&&{row:t.to.row,col:t.to.col},item_id:t.item_id,value1:t.value1,value2:t.value2};this._callbackMap[PGD_MSG.validInput]={msgId:this._msgId,callback:e},this._postMessage(PGD_MSG.validInput,n)}else this._triggerCallBack(e,this.puzzleGame.validInput(t))},n.prototype.getGameStatus=function(t){return this._isInit?(t=t||new Function,void(i?this._triggerCallBack(t,this._dataBuf[PGD_MSG.getGameStatus]):this._triggerCallBack(t,this.puzzleGame.getGameStatus()))):0},n.prototype.continue_=function(){return!!this._isInit&&!i&&this.puzzleGame.continue_()},n.prototype.findActive=function(t,e,n){return this._isInit?(n=n||new Function,void(i?(this._callbackMap[PGD_MSG.findActive]={msgId:this._msgId,callback:n},this._postMessage(PGD_MSG.findActive)):(this.puzzleGame.findActive(t,e),this._triggerCallBack(n,t,e)))):null},n.prototype.getWorldNodeDataList=function(t){return this._isInit?(t=t||new Function,void(i?(this._callbackMap[PGD_MSG.getWorldNodeDataList]={msgId:this._msgId,callback:t},this._postMessage(PGD_MSG.getWorldNodeDataList)):this._triggerCallBack(t,this.puzzleGame.getWorldNodeDataList()))):[]},n.prototype.Local2World=function(t){if(!this._isInit)return null;if(i){var e=this.GetStartRow();return new RemoveLogic.weTypeModule.GridPosition(t.row+e,t.col)}return this.puzzleGame.Local2World(t)},n.prototype.World2Local=function(t){if(!this._isInit)return null;if(i){var e=this.GetStartRow();return new RemoveLogic.weTypeModule.GridPosition(t.row-e,t.col)}return this.puzzleGame.World2Local(t)},n.prototype.IsDiggerType=function(){return!!this._isInit&&(i?this._dataBuf[PGD_MSG.IsDiggerType]:this.puzzleGame.IsDiggerType())},n.prototype.IsNormalDigger=function(){return!!this._isInit&&(i?this._dataBuf[PGD_MSG.IsNormalDigger]:this.puzzleGame.IsNormalDigger())},n.prototype.IsSodaDigger=function(){return!!this._isInit&&(i?this._dataBuf[PGD_MSG.IsSodaDigger]:this.puzzleGame.IsSodaDigger())},n.prototype.logInputRecord=function(){return this._isInit?i?void this._postMessage(PGD_MSG.logInputRecord):this.puzzleGame.logInputRecord():null},n.prototype.logRecordString=function(){return this._isInit?i?void this._postMessage(PGD_MSG.logRecordString):this.puzzleGame.logRecordString():null},n.prototype.logFullRecordString=function(){return this._isInit?i?void this._postMessage(PGD_MSG.logFullRecordString):this.puzzleGame.logFullRecordString():null},n.prototype.logRandNumList=function(){return this._isInit?i?void this._postMessage(PGD_MSG.logRandNumList):this.puzzleGame.logRandNumList():null},n.prototype.getChessboardLog=function(){return this._isInit?i?this._dataBuf[PGD_MSG.getChessboardLog]:this.puzzleGame.getChessboardLog():null},n.prototype.getCollectUnderIceList=function(){return this._isInit?i?this._dataBuf[PGD_MSG.getCollectUnderIceList]:this.puzzleGame.getCollectUnderIceList():[]},n.prototype.GetScale=function(){return this._isInit?i?this._dataBuf[PGD_MSG.GetScale]:this.puzzleGame.GetScale():0},n.prototype.GetScalePositionAdd=function(){return this._isInit?i?this._dataBuf[PGD_MSG.GetScalePositionAdd]:this.puzzleGame.GetScalePositionAdd():null},n.prototype._triggerCallBack=function(){if(!this._bHoldMessage){var t=arguments[0];"function"==typeof t&&t.apply(null,Array.prototype.slice.call(arguments,1))}},window.workerMode=i,window.PuzzleGameDelegate=n},68:function(t,e,i){"use strict";i(69),i(70),i(71),i(72),i(73)},69:function(t,e){"use strict";var i=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),n=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return i(t,null,[{key:"today",value:function(){return new Date(1e3*NetData.now_unix_timestamp.low)}},{key:"stamp2num",value:function(t){var e=new Date(t),i=e.getFullYear(),n=("0"+(e.getMonth()+1)).slice(-2),o=("0"+e.getDate()).slice(-2);return parseInt(i+n+o,10)}},{key:"todayFormat",value:function(){var t=this.today();return t.getFullYear()+("0"+(t.getMonth()+1)).slice(-2)+("0"+t.getDate()).slice(-2)}},{key:"todayInTime",value:function(t,e){var i=parseInt(this.todayFormat(),10);return t=parseInt(t,10),e=parseInt(e,10),i>=t&&i<=e}},{key:"num2cn",value:function(t){return(t=""+t).slice(0,4)+"年"+t.slice(4,6)+"月"+t.slice(6,8)+"日"}}]),t}();window.Time=n,t.exports=n},70:function(t,e){"use strict";var i=cc.Class.extend({ctor:function(){this._bRunning=!1,this._duration=0,this._elapse=0,this._timeUpFunc=null},setTimeUp:function(t){this._timeUpFunc=t},setDuration:function(t){this._duration=t},getDuration:function(){return this._duration},setElapse:function(t){this._elapse=t},getElapse:function(){return this._elapse},update:function(t){this._bRunning&&(this._elapse+=t,this._elapse>=this._duration&&(this._elapse=0,null!=this._timeUpFunc&&this._timeUpFunc()))},pause:function(){this._bRunning=!1},resume:function(){this._bRunning=!0},start:function(){this._bRunning=!0},isRunning:function(){return this._bRunning}});window.Timer=t.exports=i},71:function(t,e){"use strict";var i=cc.Class.extend({_startTime:null,_endTime:null,_currentTime:null,_secondTimer:null,_coefficient:-1,_secondTimeCallBack:null,_endTimeCallBack:null,ctor:function(t){t=t||1,this._secondTimer=new Timer,this._secondTimer.setDuration(t),this._secondTimer.setTimeUp(this._onSecondTimeElapse.bind(this))},setSecondTimerDuration:function(t){this._secondTimer.setDuration(t)},_onSecondTimeElapse:function(){var t=this._secondTimer.getDuration();this._currentTime=this._currentTime+t*this._coefficient,-1==this._coefficient?this._currentTime<=this._endTime&&this._callEndTimeCallBack():this._currentTime>=this._endTime&&this._callEndTimeCallBack(),this._secondTimeCallBack(this._currentTime)},_callEndTimeCallBack:function(){this._currentTime=this._endTime,this._secondTimer.pause(),this._endTimeCallBack()},update:function(t){this._secondTimer.update(t)},pause:function(){this._secondTimer.pause()},resume:function(){this._secondTimer.resume()},start:function(){this._secondTimer.start()},isRunning:function(){return this._secondTimer.isRunning()},reset:function(){this._secondTimer.setElapse(0)},setTimeData:function(t,e){this._startTime=t,this._endTime=e,this._currentTime=this._startTime,this._coefficient=this._startTime>this._endTime?-1:1},getCurrentTime:function(){return this._currentTime},setSecondTimeCallBack:function(t){this._secondTimeCallBack=t},setEndTimeCallBack:function(t){this._endTimeCallBack=t}});window.QuantumTimer=t.exports=i},72:function(t,e){"use strict";var i=cc.Class.extend({_secondTimer:null,_minuteTimer:null,_secondTimeCallBack:null,_minuteTimeCallBack:null,_currentTime:0,ctor:function(t,e){t=t||1,this._secondTimer=new Timer,this._secondTimer.setDuration(t),this._secondTimer.setTimeUp(this._onSecondTimeElapse.bind(this)),e=e||1,e*=60,this._minuteTimer=new Timer,this._minuteTimer.setDuration(e),this._minuteTimer.setTimeUp(this._onMinuteTimeElapse.bind(this))},setSecondTimerDuration:function(t){this._secondTimer.setDuration(t)},setMinuteTimerDuration:function(t){t*=60,this._minuteTimer.setDuration(t)},_onSecondTimeElapse:function(){var t=this._secondTimer.getDuration();this._currentTime+=t,this._secondTimeCallBack(this._currentTime)},_onMinuteTimeElapse:function(){this._minuteTimeCallBack()},update:function(t){this._secondTimer.update(t),this._minuteTimer.update(t)},pause:function(){this._secondTimer.pause(),this._minuteTimer.pause()},start:function(){this._secondTimer.start(),this._minuteTimer.start()},resume:function(){this._secondTimer.resume(),this._minuteTimer.resume()},reset:function(){this._secondTimer.setElapse(0),this._secondTimer.resume(),this._minuteTimer.setElapse(0),this._minuteTimer.resume(),this._currentTime=0},setCurrentTime:function(t){this._currentTime=t},setSecondTimeCallBack:function(t){this._secondTimeCallBack=t},setMinuteTimeCallBack:function(t){this._minuteTimeCallBack=t},setMinuteTimerElapse:function(t){this._minuteTimer.setElapse(t)}});window.CalcTimer=t.exports=i},73:function(t,e){"use strict";var i=cc.Class.extend({_secondTimer:null,_secondTimeCallBack:null,_countTimeCallBack:null,_currentCountTime:0,_originalCountTime:0,ctor:function(t){t=t||1,this._secondTimer=new Timer,this._secondTimer.setDuration(t),this._secondTimer.setTimeUp(this._onSecondTimeElapse.bind(this))},setSecondTimerDuration:function(t){this._secondTimer.setDuration(t)},_onSecondTimeElapse:function(){var t=this._secondTimer.getDuration();this._currentCountTime-=t,this._currentCountTime<=0&&(this._currentCountTime=0,this._secondTimer.pause(),this._countTimeCallBack()),this._secondTimeCallBack(this._currentCountTime)},isRunning:function(){return this._secondTimer.isRunning()},pause:function(){this._secondTimer.pause()},resume:function(){this._secondTimer.resume()},start:function(){this._secondTimer.start()},update:function(t){this._secondTimer.update(t)},setElapse:function(t){this._currentCountTime=this._originalCountTime-t},getElapse:function(){return this._originalCountTime-this._currentCountTime},getSurplusTime:function(){return this._currentCountTime},setCountTime:function(t){this._currentCountTime=t,this._originalCountTime=t},setSecondTimeCallBack:function(t){this._secondTimeCallBack=t},setCountTimeCallBack:function(t){this._countTimeCallBack=t}});window.CountDownTimer=t.exports=i},74:function(t,e){"use strict";var i={x:0,y:0,width:620,height:1020};window.subRectMap=t.exports=function(t,e){switch(t){case"Rank":return i;case"USER_HEAD":return{x:i.width,y:0,width:72,height:72};case"USER_NICK":return{x:i.width+72+2,y:0,width:320,height:72};case"MyFriendHead":return{x:i.width+e%6*84,y:72+94*Math.floor(e/6),width:84,height:94};default:return!1}},sharedCanvas.width=i.width+504,sharedCanvas.height=Math.max(i.height,1656),window.subUpdateRate={FRIEND:120,SETTING:15,RANK:15,BEYOND_FRIEND:20},window.subBeyondFriend={oldStaticsNtf:{stage_statics:{max_stage_id:0,star_count:0}},newStaticsNtf:{stage_statics:{max_stage_id:0,star_count:0}}}},75:function(t,e){"use strict";var i=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),n=function(){function t(){(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this._timeOutHandleMap={},this._reloadTimeoutHandleMap={},this._showRetryWindowCount=0,eventDispatcher.addListener(EventID.ON_NETWORK_TIP_WINDOW_CANCEL,function(){this._clearTimeoutMap(this._timeOutHandleMap),this._timeOutHandleMap={},this._clearTimeoutMap(this._reloadTimeoutHandleMap),this._reloadTimeoutHandleMap={},this._showRetryWindowCount=0}.bind(this))}return i(t,[{key:"_clearTimeoutMap",value:function(t){for(var e in t)clearTimeout(t[e])}},{key:"silenceLoadRes",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._loadRes({noHideLoadingTxt:!0,resObject:t,loadResSuccessCallBack:function(){e()},timeOutCallBack:function(){i()}})}},{key:"showPageResLoadingWindow",value:function(t,e,i,n){this._showLoadingWindow(t,e,i,n,!0)}},{key:"showSubResLoadingWindow",value:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};this._showLoadingWindow(0,t,function(){e.hideLoadingWindow(),i()},function(){SubResLoadingWindow.Hide(),n()},!1)}},{key:"hideLoadingWindow",value:function(){this._clearTimeoutMap(this._timeOutHandleMap),this._timeOutHandleMap={},PageResLoadingWindow.Hide(),SubResLoadingWindow.Hide()}},{key:"_showLoadingWindow",value:function(t,e,i,n,o){function s(){0==--a&&"function"==typeof i&&i()}if(e&&e.isLoaded())"function"==typeof i&&i();else{var a=2;o?PageResLoadingWindow.Show(t,function(){s()}.bind(this)):SubResLoadingWindow.Show(t,function(){s()}.bind(this)),this._loadRes({resObject:e,loadingCallBack:function(t){this._loadingCallBack(t,o)}.bind(this),loadResSuccessCallBack:function(){s()}.bind(this),timeOutCallBack:function(){a=0,this._showNetworkRetryWindow(e,i,n,o)}.bind(this)})}}},{key:"_showNetworkRetryWindow",value:function(t,e,i,n){console.log("_showNetworkRetryWindow count "+this._showRetryWindowCount),this._showRetryWindowCount++,this._showRetryWindowCount<3?NetworkRetryWindow.Show(Language.getString(LanguageKey.RES_LOAD_ERROR),function(){this._tryReLoad(t,e,i,n)}.bind(this),function(){this._showRetryWindowCount=0,this._cancelReLoad(i)}.bind(this)):(this._showRetryWindowCount=0,NetworkRetryWindow.ShowSureButton(Language.getString(LanguageKey.RES_LOAD_ERROR_2),function(){this._cancelReLoad(i)}.bind(this)))}},{key:"_cancelReLoad",value:function(t){"function"==typeof t?t():this.hideLoadingWindow()}},{key:"_tryReLoad",value:function(t,e,i,n){this._loadRes({resObject:t,loadingCallBack:function(t){this._loadingCallBack(t,n)}.bind(this),loadResSuccessCallBack:function(){t.onLoadFinish(),"function"==typeof e&&e()}.bind(this),timeOutCallBack:function(){this._showNetworkRetryWindow(t,e,i,n)}.bind(this)})}},{key:"_loadingCallBack",value:function(t,e){e?PageResLoadingWindow.setLoadingTxt&&PageResLoadingWindow.setLoadingTxt(t):SubResLoadingWindow.setLoadingTxt&&SubResLoadingWindow.setLoadingTxt(t)}},{key:"_hideLoadingTxt",value:function(){SubResLoadingWindow.hideLoadingTxt&&SubResLoadingWindow.hideLoadingTxt(),PageResLoadingWindow.hideLoadingTxt&&PageResLoadingWindow.hideLoadingTxt()}},{key:"_loadRes",value:function(t){console.log("_loadRes");var e=t.loadResSuccessCallBack,i=t.resObject;if(i.isLoaded())"function"==typeof e&&e();else{var n=this,o=i.__instanceId,s=t.loadingCallBack,a=t.timeOutCallBack,r=t.reloadCount||0,u=t.retryCount||5,c=t.noHideLoadingTxt,l=t.startTime||(new Date).getTime();t.startTime=l;var d=this._timeOutHandleMap[o];clearTimeout(d),delete this._timeOutHandleMap[o],d=Timeout.register(function(){var t=(new Date).getTime();console.warn("Timeout.register:timeout "+(t-l)),"function"==typeof a&&a()}.bind(this),1e3*RES_LOAD_TIME_OUT_TIME),this._timeOutHandleMap[o]=d;var h=i.getLoadResList();h instanceof Array||(h=[]),(new Date).getTime(),console.log("cc.loader.load"),cc.loader.load(h,function(t,e,i){if("function"==typeof s&&t){var n=(i+1)/e*100|0;n=Math.min(n,100),s(n)}},function(s,d){if(console.warn("cc.loader.load callback"),clearTimeout(this._timeOutHandleMap[o]),delete this._timeOutHandleMap[o],s)if(r<u){r++,console.warn("load res retry "+r);var h=this._reloadTimeoutHandleMap[o];clearTimeout(h),delete this._reloadTimeoutHandleMap[o],h=Timeout.register(function(){if(t.reloadCount=r,window.isNetworkConnected)console.warn("网络可用，继续重试"),n._loadRes(t);else{window.onNetworkChangeCallbacks[o]=function(e){e&&(console.warn("监听到网络状态变为可用，继续重试"),delete window.onNetworkChangeCallbacks[o],n._loadRes(t))}}},1e3),this._reloadTimeoutHandleMap[o]=h}else{var _=(new Date).getTime();console.warn("load.err:timeout "+(_-l)),"function"==typeof a&&a()}else this._showRetryWindowCount=0,i.onLoadFinish(),"function"==typeof e&&e(),!c&&n._hideLoadingTxt(),console.warn("cc.loader.load onLoadFinish")}.bind(this))}}}]),t}();window.ResLoader=t.exports=new n}});
var WindowBase=cc.Node.extend({ctor:function(){this._super(),this.setAnchorPoint(.5,.5),this.setContentSize(cc.winSize),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),this.setPosition(cc.winSize.width/2,cc.winSize.height/2)},onShowNotify:function(){},onShow:function(){},onHideNotify:function(){},onHide:function(){},onDestroyNotify:function(){},onDestroy:function(){},onCover:function(){},onResume:function(){}});
var TabBase=cc.Class.extend({_tabNode:null,_tabTouchedListener:null,_data:null,ctor:function(t){this._tabNode=t},getTabNode:function(){return this._tabNode},setData:function(t){this._data=t},getData:function(){return this._data},setTabTouchedListener:function(t){this._tabTouchedListener=t},_onTabTouched:function(){this._tabTouchedListener(this)},onSelected:function(){},onUnSelected:function(){},onDestroy:function(){}});
var PageBase=cc.Class.extend({_pageNode:null,ctor:function(n){this._pageNode=n},getPageNode:function(){return this._pageNode},onShowNotify:function(n){},onShow:function(n){},onHideNotify:function(n){},onHide:function(n){},onDestroy:function(){}});
var Timeout={_timeoutHandlerMap:{},_scheduleHandlerMap:{},_scheduleKey:0,register:function(e,t){var n=this,i=setTimeout(function(){delete n._timeoutHandlerMap[i],"function"==typeof e&&e()},t);return this._timeoutHandlerMap[i]=i,i},clear:function(){for(var e in this._timeoutHandlerMap)clearTimeout(this._timeoutHandlerMap[e]);this._timeoutHandlerMap={};for(var e in this._scheduleHandlerMap)this.clearTimeoutEx(this._scheduleHandlerMap[e]);this._scheduleHandlerMap={},this._scheduleKey=0},registerEx:function(e,t){var n=this;this._scheduleKey++;var i=this._scheduleKey,u=this.setTimeoutEx(function(){delete n._scheduleHandlerMap[i],"function"==typeof e&&e()},t);return this._scheduleHandlerMap[i]=u,u},setTimeoutEx:function(e,t){var n=cc.director.getRunningScene();return n?(n.scheduleOnce(e,t/1e3),e):null},clearTimeoutEx:function(e){var t=cc.director.getRunningScene();t&&t.unschedule(e)}};
TimeFormatType={hms:"hh:mm:ss",ms:"mm:ss"};var Util={formatTime:function(t,e){var r=Math.floor(t/3600),n=Math.floor(t%3600/60),i=Math.floor(t%60),o="";return(e=e||TimeFormatType.hms)==TimeFormatType.hms?o=(r<10?"0"+r:r)+":"+(n<10?"0"+n:n)+":"+(i<10?"0"+i:i):e==TimeFormatType.ms&&(o=(n<10?"0"+n:n)+":"+(i<10?"0"+i:i)),o},readTxtFileSync:function(t,e,r){if(cc.sys.isNative)e(jsb.fileUtils.getStringFromFile(t));else{var n=0;function i(){cc.loader.loadTxt(cc.path.join(cc.loader.resPath,t),function(t,o){t?n<r&&(n++,console.log("try reload txt"),i()):e(o)})}i()}},mergeRecursive:function(t,e){for(var r in e)try{e[r].constructor==Object?t[r]=Util.mergeRecursive(t[r],e[r]):t[r]=e[r]}catch(n){t[r]=e[r]}return t},isBlankString:function(t){return!t||/^\s*$/.test(t)},endsWithString:function(t,e){return!Util.isBlankString(t)&&t.match(e+"$")==e},startsWithString:function(t,e){return!Util.isBlankString(t)&&0===t.indexOf(e)},getStringLength:function(t){var e=t.match(/[^\x00-\xff]/gi);return t.length+(null==e?0:e.length)},upperFirstLetter:function(t){return t.substring(0,1).toUpperCase()+t.substring(1)},clone:function(t){var e=t.constructor?new t.constructor:{};for(var r in t){var n=t[r];"object"!=typeof n||!n||n instanceof cc.Node?e[r]=n:e[r]=Util.clone(n)}return e},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},isObject:function(t){return"object"==typeof t},spliceListToNCol:function(t,e){for(var r=[],n=[],i=0;i<t.length;i++)n.push(t[i]),(i+1)%e==0&&(r.push(n),n=[]);return i%e!=0&&r.push(n),r},splitStringToIntArray:function(t){var e=[],r=t.split(",");for(var n in r)e.push(parseInt(r[n]));return e},splitStringToObjectArray:function(t){var e=[],r=t.split("#");for(var n in r)e.push(JSON.parse(r[n]));return e},getRandom:function(t,e){var r=e-t,n=Math.random();return t+Math.round(n*r)},getFloatRandom:function(t,e){var r=e-t;return t+Math.random()*r},getRandomBool:function(){return this.getRandom(0,100)%2==0},isHaveDot:function(t){if(!isNaN(t))return-1!=(t+"").indexOf(".")},toFixed:function(t,e){var r=(t+"").split(".");return 1==r.length?t:2==r[1].length?t:parseFloat(t.toFixed(e))},registerListener:function(t,e,r,n){var i=!1;for(var o in t)if(t[o].eventID==e){i=!0;break}if(!i){var a=eventDispatcher.addListener(e,r,n);t.push({eventID:e,eventFun:a})}},unRegisterListener:function(t,e){for(var r in t)if(t[r].eventID==e)return void eventDispatcher.removeListener(e,t[r].eventFun)},unRegisterListeners:function(t){if(null!=t){for(var e=t.length-1;e>=0;e--)eventDispatcher.removeListener(t[e].eventID,t[e].eventFun),t.splice(e,1);t.length=0}},getInt:function(t){var e=t.replace(/[^0-9]/gi,"");return parseInt(e)},getNumberWithComma:function(t){"number"==typeof t&&(t=String(t));return t.replace(/[^0-9]/gi,"").replace(/\B(?=(?:\d{3})+\b)/g,",")},getBaseStorageKey:function(t){for(var e=[],r="",n=0,i=e.length;n<i;n++){var o=e[n];if("game"==o)break;o&&(r+=o+"_")}return t||(r+=NetData.user_info.openid),r},getDiffDay:function(t,e){return parseInt(t/86400)-parseInt(e/86400)},isAttributeExist:function(t,e){if(null==t)return!1;var r=!0;if("string"==typeof e)for(var n=e.split("."),i=0,o=n.length;i<o;i++){var a=n[i];if(null==t[a]){r=!1;break}t=t[a]}else r=!1;return r},isQQIAP:function(){return!1}};
var Effect=cc.Node.extend({_node:null,_action:null,_bEnd:!1,_bPlaying:!1,_completeCallBack:null,_timeSpeed:null,_effectPath:null,_bLoop:!1,ctor:function(t){this._super(),this._effectPath=t,this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0);var e=ccs.load(t,GameDataConfig.EFFECT_ROOT_PATH);this._node=e.node,this._node.setCascadeColorEnabled(!0),this._node.setCascadeOpacityEnabled(!0),this.addChild(this._node),this._action=e.action,this._action.setLastFrameCallFunc(this._onEnterLastFrame.bind(this)),this._action.setFrameEventCallFunc(this._onEnterFrame.bind(this)),this._bEnd=!1,this._bPlaying=!1},play:function(t,e){void 0===e&&(e=0),this._bLoop=t,this._bPlaying=!0,this._bEnd=!1,this._node.stopAllActions(),this._node.runAction(this._action),this._timeSpeed&&this._action.setTimeSpeed(this._timeSpeed),this._action.gotoFrameAndPlay(e,this._action.getDuration(),0,t)},setTimeSpeed:function(t){this._timeSpeed=t},gotoLastFrame:function(){this._node.stopAllActions(),this._node.runAction(this._action),this._timeSpeed&&this._action.setTimeSpeed(this._timeSpeed),this._action.gotoFrameAndPause(this._action.getDuration())},getDuration:function(){return this._action.getDuration()},getTime:function(){return this._action.getEndFrame()*this._action._frameInternal},getFrameCount:function(){return this._action.getDuration()},pause:function(){this._action.pause(),this._node.stopAllActions()},enterEvent:function(t){},_onEnterFrame:function(t){t.getFrameIndex()==this._action.getCurrentFrame()&&this.enterEvent(t)},_onEnterLastFrame:function(){this._bEnd||(this._bLoop||(this._bPlaying=!1,this.pause()),this._bEnd=!0,"function"==typeof this._completeCallBack&&this._completeCallBack())},isPlaying:function(){return this._bPlaying},isPlayComplete:function(){return this._bEnd},setPlayCompleteCallBack:function(t){this._completeCallBack=t}});
var res,resGroup,subResList,resList,resPath="res/";function loadResources(e){var s=function(s){"object"!=typeof s&&(s=JSON.parse(s)),res=res||{};var r=s.resources;for(var o in r){var t=r[o].name,u=r[o].url;res[t]=resPath+u}var a={};resList=resList||[],subResList=subResList||{},resGroup=resGroup||{};var n=s.groups;for(var o in n){t=n[o].name;var c={},i=[],l=n[o].keys.split(",");for(var v in l){var p=l[v],R=res[p];c[p]=R,i.push(R),null==a[p]&&(resList.push(R),a[p]=R)}resGroup[t]=c,subResList[t]=i}delete a,console.log("loadResources finish"),e()};if(document.ccResource)s(document.ccResource);else{var r=cc.path.join(resPath,"resource.json");window.GetConvertResUrl&&(r=GetConvertResUrl(r)),console.log("resource json"),Util.readTxtFileSync(r,s,3)}}
var ChessStateType={drop:1,attacked:2,move:3,devour:4,devoured:5,divided:6,change:7},ChessBase=cc.Node.extend({_chessData:null,_delegate:null,_stateMap:null,ctor:function(t){this._super(),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),this._chessData=t,this._stateMap={};for(var e in ChessStateType){var n=ChessStateType[e];this._stateMap[n]={effectRecoveryFun:null,effect:null}}},cloneChessData:function(){return this._chessData.clone()},getLogicOrder:function(){return null!=this._chessData.extendData.chessLogicOrder?this._chessData.extendData.chessLogicOrder:(console.log("chessLogicOrder is null"),GameDataConfig.ChessLogicOrder.ORDER_2)},getChessData:function(){return this._chessData},setDelegate:function(t){this._delegate=t},getGridPosition:function(){return new GridPosition(this._chessData.gridPosition.row,this._chessData.gridPosition.col)},setGridPosition:function(t,e){this._chessData.gridPosition.row=t,this._chessData.gridPosition.col=e},getRow:function(){return this._chessData.gridPosition.row},getCol:function(){return this._chessData.gridPosition.col},getWidth:function(){return this._chessData.size.width},getHeight:function(){return this._chessData.size.height},getColorType:function(){return this._chessData.colorType},getChessType:function(){return this._chessData.chessType},turnToIdle:function(){},finish:function(){},reset:function(t){this._chessData=t,this.setScale(1)},moveScaleOut:function(t,e,n){this._moveScale(!1,t,e,n)},moveScaleIn:function(t,e,n){this._moveScale(!0,t,e,n)},_moveScale:function(t,e,n,i){var o=this,a=2;function s(){0==--a&&"function"==typeof n&&n(o)}i=i||GameDataConfig.CHESS_MOVE_SPEED/2,this._move(e,s,i);var c=this._calcDistance(this.getPosition(),e)/i;t?this._scaleIn(c,s):this._scaleOut(c,s)},_scaleIn:function(t,e){this._scale(t,0,e)},_scaleOut:function(t,e){this._scale(t,1,e)},_scale:function(t,e,n){t=t||.03;var i=new cc.ScaleTo(t,e),o=new cc.CallFunc(function(){"function"==typeof n&&n(this)},this),a=new cc.Sequence(i,o);this.runAction(a)},_swap:function(t,e){this.turnToIdle();var n=this.getUserData(),i=new cc.MoveTo(GameDataConfig.CHESS_SWAP_TIME,n),o=new cc.CallFunc(function(){this.setGridPosition(t.row,t.col),"function"==typeof e&&e()}.bind(this)),a=new cc.Sequence(i,o);this.runAction(a)},_createDropPath:function(t){var e=[];if(1==t.length)return e.push({to:t[0].viewPosition,count:0}),e;for(var n=0,i=this._calcDirection(t[0].viewPosition,t[1].viewPosition),o=null,a=null,s=0,c=t.length-1;s<c;s++){o=t[s].viewPosition,a=t[s+1].viewPosition;var h=this._calcDirection(o,a);h!=i?(e.push({to:o,count:n}),n=1,i=h):n++}return e.push({to:a,count:n}),e},_calcDirection:function(t,e){return e.x==t.x&&e.y==t.y?GameDataConfig.ChessDropDirection.NONE:e.x==t.x&&e.y<t.y?GameDataConfig.ChessDropDirection.TO_BOTTOM:e.x<t.x&&e.y<t.y?GameDataConfig.ChessDropDirection.TO_LEFT_BOTTOM:e.x>t.x&&e.y<t.y?GameDataConfig.ChessDropDirection.TO_RIGHT_BOTTOM:e.x==t.x&&e.y>t.y?GameDataConfig.ChessDropDirection.TO_TOP:e.x<t.x&&e.y>t.y?GameDataConfig.ChessDropDirection.TO_LEFT_TOP:e.x>t.x&&e.y>t.y?GameDataConfig.ChessDropDirection.TO_RIGHT_TOP:e.x<t.x&&e.y==t.y?GameDataConfig.ChessDropDirection.TO_LEFT:e.x>t.x&&e.y==t.y?GameDataConfig.ChessDropDirection.TO_RIGHT:void 0},_drop:function(t,e){if(null==t||0==t.length)return this.setRotation(0),void("function"==typeof e&&e(this));var n=t.shift().to,i=this._calcDistance(this.getPosition(),n)/GameDataConfig.CHESS_DROP_SPEED,o=new cc.MoveTo(i,n),a=new cc.CallFunc(function(){this._drop(t,e)}.bind(this)),s=new cc.Sequence(o,a);this.runAction(s);var c=this._getRotation(this.getPosition(),n);this.setRotation(c)},_move:function(t,e,n){var i=this._calcDistance(this.getPosition(),t)/n,o=new cc.MoveTo(i,t),a=new cc.CallFunc(function(){this.turnToIdle(),"function"==typeof e&&e(this)}.bind(this)),s=new cc.Sequence(o,a);this.runAction(s)},_calcDistance:function(t,e){if(null==t||null==e)return 0;var n=Math.round(e.x),i=Math.round(e.y),o=Math.round(t.x),a=Math.round(t.y);return n==o&&i!=a?Math.abs(i-a):i==a&&n!=o?Math.abs(n-o):cc.pDistance(t,e)},_getRotation:function(t,e){if(null==t||null==e)return 0;var n=Math.round(e.x),i=Math.round(e.y),o=Math.round(t.x),a=Math.round(t.y);return n==o&&i!=a?0:i==a&&n!=o?0:n<o&&i<a?45:n>o&&i<a?-45:n<o&&i>a?-45:n>o&&i>a?45:(console.log("unKnown calc"),0)},_doState:function(t,e,n){var i=this._stateMap[t];null!=i&&("function"==typeof i.effectRecoveryFun&&i.effectRecoveryFun(i.effect),i.effectRecoveryFun=n,i.effect=e)},_clearAllState:function(){for(var t in ChessStateType){var e=ChessStateType[t];this._clearState(e,!0)}},_clearState:function(t,e){var n=this._stateMap[t];null!=n&&(e&&"function"==typeof n.effectRecoveryFun&&n.effectRecoveryFun(n.effect),n.effectRecoveryFun=null,n.effect=null)},_getSpeedWeight:function(t,e){var n=0,i=0;do{if(null==t||null==e){n=0,i=0;break}var o=Math.round(e.x),a=Math.round(e.y),s=Math.round(t.x),c=Math.round(t.y);if(o==s){a>c?i=1:a<c&&(i=-1);break}if(a==c){o>s?n=1:o<s&&(n=-1);break}var h=.7071067811865476;if(o<s&&a<c){n=-h,i=-h;break}if(o>s&&a<c){n=h,i=-h;break}if(o<s&&a>c){n=-h,i=h;break}if(o>s&&a>c){n=h,i=h;break}}while(0);return{x:n,y:i}},onClicked:function(){},onDrop:function(t,e){var n=this._createDropPath(t.pathList);if(this._drop(n,e),t.scaleFlag)for(var i=this.getPosition(),o=0,a=0,s=this,c=t.pathList,h=null,r=0,u=c.length;r<u;r++){var f=(h=c[r]).viewPosition;a=this._calcDistance(i,f),o+=a;var l=h.bScaleIn;!0===l?d(function(){this._scaleIn(.03)}.bind(this)):!1===l&&(o-=this._chessData.size.height/2,d(function(){this._scaleOut(.03)}.bind(this))),i=f}function d(t){var e=o/GameDataConfig.CHESS_DROP_SPEED,n=new cc.DelayTime(e),i=new cc.CallFunc(function(){"function"==typeof t&&t()},this),a=new cc.Sequence(n,i);s.runAction(a)}},onAbsorbed:function(t,e){var n=this._calcDistance(this.getPosition(),t),i=Math.min(1.5,n/GameDataConfig.CHESS_ABSORBED_MOVE_SPEED),o=new cc.MoveTo(i,t),a=new cc.RotateBy(i,4*i*360),s=new cc.CallFunc(function(){"function"==typeof e&&e(this)}.bind(this)),c=new cc.Spawn(o,a),h=new cc.Sequence(c,s);this.runAction(h)},onDropEffectPlayComplete:function(){this._clearState(ChessStateType.drop)},onDropEffectStartPlay:function(t,e){this._doState(ChessStateType.drop,t,e)},onChangeEffectStartPlay:function(t,e){this._doState(ChessStateType.change,t,e),this.setOpacity(0)},onChangeEffectPlayComplete:function(){this._clearState(ChessStateType.change),this.setOpacity(255)},onCrush:function(){this._clearAllState(),this._delegate.onChessCrush(this)},onSwap:function(t,e){this._swap(t,e)},onTempSwap:function(t,e,n){var i={row:this._chessData.gridPosition.row,col:this._chessData.gridPosition.col},o=this.getPosition();this._swap(t,function(){this.setUserData(o),this._swap(i,e),"function"==typeof n&&n()}.bind(this))},onRearranged:function(t,e){var n=new cc.MoveTo(GameDataConfig.CHESS_REARRANGE_MOVE_TIME,t),i=new cc.CallFunc(function(){this.turnToIdle(),"function"==typeof e&&e(this)}.bind(this)),o=new cc.Sequence(n,i);this.runAction(o)},onMove:function(t,e){this._move(t,e,GameDataConfig.CHESS_MOVE_SPEED)},onMoveEffectStartPlay:function(t,e){this._doState(ChessStateType.move,t,e)},onMoveEffectPlayComplete:function(){this._clearState(ChessStateType.move)},onAttacked:function(t){this._chessData.gridPosition.isEqual(t.gridPosition)||console.log("gridPosition is un equal"),this._chessData.extendData.chessLogicOrder!=t.extendData.chessLogicOrder&&console.log("chessLogicOrder is un equal"),this._chessData=t},onAttackedEffectStartPlay:function(t,e){this._doState(ChessStateType.attacked,t,e)},onAttackedEffectPlayComplete:function(){this._clearState(ChessStateType.attacked)},onDevour:function(){},onDevourEffectStartPlay:function(t,e){this._doState(ChessStateType.devour,t,e)},onDevourEffectPlayComplete:function(){this._clearState(ChessStateType.devour)},onDevoured:function(){},onDevouredEffectStartPlay:function(t,e){this._doState(ChessStateType.devoured,t,e),this.setOpacity(0)},onDevouredEffectPlayComplete:function(){this._clearState(ChessStateType.devoured),this.setOpacity(255)},onDivide:function(){},onDivided:function(){},onDividedEffectStartPlay:function(t,e){this._doState(ChessStateType.divided,t,e)},onDividedEffectPlayComplete:function(){this._clearState(ChessStateType.divided)}});
var BeAttackChess=ChessBase.extend({_idleEffect:null,_hpProgress:null,_hpProgressBg:null,ctor:function(t){this._super(t);var s=GameDataConfig.DynamicChessViewConfig[t.chessType],e=null!=s?s.effectPath:"";this._idleEffect=new Effect(e),this._idleEffect.play(!0),this.addChild(this._idleEffect)},reset:function(t){this._super(t),this._idleEffect.setOpacity(255),this._idleEffect.play(!0)},finish:function(){this._super(),this._resetHPParent(),this._createHPProgress(),this._updateHPProgress(),this._updateHpViewPosition()},setPosition:function(t,s){this._super(t,s),this._updateHpViewPosition()},setPositionY:function(t){this._super(t),this._updateHpViewPosition()},setPositionX:function(t){this._super(t),this._updateHpViewPosition()},setScale:function(t){this._super(t),this._hpProgressBg&&this._hpProgressBg.setScale(t),this._hpProgress&&this._hpProgress.setScale(t)},_updateHpViewPosition:function(){var t=cc.p(this.getPositionX(),this.getPositionY()-this._chessData.size.height/2+10);this._hpProgressBg&&this._hpProgressBg.setPosition(t),this._hpProgress&&this._hpProgress.setPosition(t)},_resetHPParent:function(){null!=this._hpProgressBg&&(this._hpProgressBg.setParent(null),this.getParent().addChild(this._hpProgressBg,GameDataConfig.ZOrder.HP)),null!=this._hpProgress&&(this._hpProgress.setParent(null),this.getParent().addChild(this._hpProgress,GameDataConfig.ZOrder.HP))},_createHPProgress:function(){if(null!=this._hpProgress){var t=cc.p(this.getPositionX(),this.getPositionY()-this._chessData.size.height/2+10);return this._hpProgressBg.setPosition(t),void this._hpProgress.setPosition(t)}var s=GameDataConfig.BeAttackChessHPViewConfig[this._chessData.chessType];if(null!=s&&s.bNeedCreateHPView){var e={bPlistTexture:!0,imageFileName:"obstacle/lawn/bar_green_bg.png",opacity:0,position:t=cc.p(this.getPositionX(),this.getPositionY()-this._chessData.size.height/2+10)},i=UIHelper.createImage(e);this.getParent().addChild(i,GameDataConfig.ZOrder.HP),this._hpProgressBg=i;e={bPlistTexture:!0,imageFileName:"obstacle/lawn/bar_green.png",opacity:0,percent:100,position:t},i=UIHelper.createLoadingBar(e);this.getParent().addChild(i,GameDataConfig.ZOrder.HP),this._hpProgress=i}},_updateHPProgress:function(){if(RemoveLogic.we4Proto.ChessType.STIT_HUGEMUSHROOM==this._chessData.chessType&&null!=this._hpProgress){var t=this._chessData.extendData.mushroomData;if(null!=t){var s=t.maxHealth,e=t.currentHealth,i=e/s*100;this._hpProgress.setPercent(i);var h=e<s?255:0;this._hpProgress.setOpacity(h),this._hpProgressBg.setOpacity(h)}else console.log("find mushroom data fail")}},onAttacked:function(t){this._super(t),this._updateHPProgress()},onAttackedEffectStartPlay:function(t,s){this._super(t,s),this._idleEffect.setOpacity(0)},onAttackedEffectPlayComplete:function(){this._super(),this._idleEffect.setOpacity(255)},onDevourEffectStartPlay:function(t,s){this._super(t,s),this._chessData.chessType==RemoveLogic.we4Proto.ChessType.STIT_CANDYPOT&&this._clearState(ChessStateType.attacked,!0),this._idleEffect.setOpacity(0)},onDevourEffectPlayComplete:function(){this._super(),this._idleEffect.setOpacity(255)},onCrush:function(){this._super(),this._hpProgress&&this._hpProgress.setOpacity(0),this._hpProgressBg&&this._hpProgressBg.setOpacity(0)}});
var DynamicChess=ChessBase.extend({_idleEffect:null,ctor:function(e){this._super(e);var t=GameDataConfig.DynamicChessViewConfig[e.chessType],i=null!=t?t.effectPath:"",s=new Effect(i);s.play(!0),this.addChild(s),this._idleEffect=s},reset:function(e){this._super(e),this._idleEffect.setOpacity(255),this._idleEffect.play(!0)},onMoveEffectStartPlay:function(e,t){this._super(e,t),this._idleEffect.setOpacity(0)},onMoveEffectPlayComplete:function(){this._super(),this._idleEffect.setOpacity(255)}});
var StaticChess=ChessBase.extend({_idleView:null,ctor:function(e){this._super(e);var i=GameDataConfig.StaticChessViewConfig[e.chessType];null==i&&(i=GameDataConfig.StaticTagChessViewConfig[e.chessType][e.colorType]);var t=null!=i?i.image1:"",s=new cc.Sprite;s.initWithSpriteFrameName(t),s.setAnchorPoint(.5,.5),e.size.height<s.getContentSize().height&&s.setPositionY((e.size.height-s.getContentSize().height)/2);var n=null!=i&&null!=i.yOffset?i.yOffset:0;s.setPositionY(s.getPositionY()+n),this.addChild(s),this._idleView=s}});
var SubHandleBase=cc.Class.extend({_completeCallBack:null,_bComplete:!1,_config:null,_listenerList:null,start:function(t){this._config=t,this._listenerList=[],Util.registerListener(this._listenerList,EventID.ON_WINDOW_RESIZE,this.onWindowResize.bind(this))},destroy:function(){Util.unRegisterListeners(this._listenerList)},setCompleteCallBack:function(t){this._completeCallBack=t},complete:function(){this._bComplete=!0,"function"==typeof this._completeCallBack&&this._completeCallBack()},isComplete:function(){return this._bComplete},onWindowResize:function(){}});
var RankType={RANK_TYPE_NULL:0,RANK_TYPE_MAX_STAGE:1,RANK_TYPE_WEEKMATCH_MASTER_MERGER:2,RANK_TYPE_WEEKMATCH_SIX_CORNER_ELIM:3,RANK_TYPE_COUNT:4},RankData=cc.Class.extend({_totalPage:0,_currPageID:0,_updateTimestamp:0,_rankListAllData:null,_avatarList:null,_dataModified:!0,ctor:function(){this._rankListAllData=[],this._avatarList=[],this._listenerList=[]},addBaseInfoListener:function(){Util.registerListener(this._listenerList,EventID.PLAYER_BASEINFO_NTF,this.refreshFriendsAvatar.bind(this))},refreshFriendsAvatar:function(){console.log("RankData: refreshFriendsAvatar"),this.updateAvatarList(),eventDispatcher.dispatchEvent(EventID.REFRESH_RANK_EVENT)},addRankListData:function(t){this._totalPage=t.total_page,this._updateTimestamp=t.update_timestamp,this._currPageID=t.page_id;var a={pageIndex:0,itemList:[],weekMatchFriendList:[]};a.pageIndex=t.page_id,a.itemList=t.friend_list,a.weekMatchFriendList=t.week_match_friend_list;var e;for(var i in this._rankListAllData)if(e=this._rankListAllData[i],t.page_id==e.pageIndex)return void this._rankListAllData.splice(i,1,a);this._rankListAllData.push(a)},getRankListData:function(){return this._rankListAllData},getRankListDataByID:function(t){var a,e;for(var i in this._rankListAllData)t==(e=this._rankListAllData[i]).pageIndex&&(a=e.itemList);return a},getRandPageDataByPageId:function(t){for(var a=0,e=this._rankListAllData.length;a<e;a++)if(t==this._rankListAllData[a].pageIndex)return this._rankListAllData[a];return null},updateAvatarList:function(){var t=NetData.player_baseinfo_ntf.baseinfo_list;if(console.log("updateAvatarList: infoList.length= "+t.length),this._avatarList&&this._avatarList.length>0)for(var a=0,e=t.length;a<e;a++){r=t[a];var i=!1;for(var n in this._avatarList)if(this._avatarList[n].openid==r.openid){i=!0;break}if(!i){(_=new cc.Sprite).setContentSize(60,60);var s={openid:r.openid,nick:r.nick,avatar:_};this._addAvatarByUrl(r.pic,_),this._avatarList.push(s),console.log("updateAvatarList: add new i= "+a)}}else{var r;for(a=0,e=t.length;a<e;a++){r=t[a];var _;(_=new cc.Sprite).setContentSize(60,60);s={openid:r.openid,nick:r.nick,avatar:_};this._addAvatarByUrl(r.pic,_),this._avatarList.push(s)}}console.log("updateAvatarList: this._avatarList.length= "+this._avatarList.length)},_addAvatarByUrl:function(t,a){!t||t.length<1||GameUtil._loadAvatar(t,function(t,a){if(null==t)console.log("_addAvatarByUrl: null == avatar");else{var e=t.getContentSize();t.setScaleX(60/e.width),t.setScaleY(60/e.height),t.setAnchorPoint(cc.p(.5,.5)),t.setPosition(33,33),a.addChild(t)}},a)},getAvatarDataByOpenid:function(t){for(var a=null,e=0,i=this._avatarList.length;e<i;e++)if((a=this._avatarList[e]).openid==t)return a},freshRankIndex:function(){var t,a=0,e=0;NetData.stage_ntf.info_list&&(a=(a=GameUtil.getAllStarNum())>3*(e=NetData.statics_ntf.stage_statics.max_stage_id)?3*e:a);var i=0,n=this.getRankListDataByID(this._currPageID);for(var s in n)if(t=n[s],NetData.user_info.openid==t.openid){t.star_count=a,t.stage_id=e,i=s;break}var r,_=i;for(s=i-1;s>=0;--s){if(!(e>(r=n[s]).stage_id)){if(e==r.stage_id){if(a>r.star_count){if(0==s){_=s;break}continue}_=s+1;break}_=s+1;break}if(0==s){_=s;break}}_>=0&&_<i&&(r=n.splice(i,1),n.splice(_,0,r[0]))},clearAllData:function(){this._rankListAllData.splice(0),this._rankListAllData=[]},createServerTestData:function(){NetData.user_info.openid=1021;for(var t,a=[],e={page_id:1,total_page:4,update_timestamp:0,friend_list:[]},i=0;i<30;++i)t={openid:1e3+i,stage_id:100-i,star_count:240-3*i,recv_heart_state:i%2,is_in_cd:(i+1)%2,last_send_heart_time:.001*Date.now()-100},e.friend_list.push(t);a.push(e);for(e={page_id:2,total_page:4,update_timestamp:0,friend_list:[]},i=30;i<60;++i)t={openid:1e3+i,stage_id:200-i,star_count:240-3*i,recv_heart_state:i%2,is_in_cd:(i+1)%2,last_send_heart_time:.001*Date.now()-100},e.friend_list.push(t);a.push(e);for(e={page_id:3,total_page:4,update_timestamp:0,friend_list:[]},i=60;i<90;++i)t={openid:1e3+i,stage_id:300-i,star_count:300-3*i,recv_heart_state:i%2,is_in_cd:(i+1)%2,last_send_heart_time:.001*Date.now()-100},e.friend_list.push(t);a.push(e);for(e={page_id:4,total_page:4,update_timestamp:0,friend_list:[]},i=90;i<100;++i)t={openid:1e3+i,stage_id:400-i,star_count:400-3*i,recv_heart_state:i%2,is_in_cd:(i+1)%2,last_send_heart_time:.001*Date.now()-100},e.friend_list.push(t);return a.push(e),a},updateRankListByPage:function(t,a){var e,i=this.createServerTestData(),n=t.page_id;for(var s in i)if(n==(e=i[s]).page_id){Timeout.register(function(){a&&a(0,e),eventDispatcher.dispatchEvent(EventID.REFRESH_RANK_EVENT)},1e3);break}},_getDataFromServer:function(){var t={rank_type:RankType.RANK_TYPE_MAX_STAGE,page_id:1,page_size:MaxItemNumPerPage},a=this;GameService.updateRankListByPage(t,function(t,e){if(t)console.log("err code: "+t.ret);else{a.addRankListData(e),a._dataModified=!1,TopGoldBar.Hide(),RankListWindow.Show();for(var i,n=a.getRankListDataByID(a._currPageID),s=n.length,r=[],_=0;_<s;++_)i=n[_],r.push(i.openid);console.log("initRankList: total= "+s),console.log("RankListWindow: avatarList.length= "+r.length),GameService.getPlayerBaseinfo({openid_list:r},function(t,a){t&&console.log("RankListWindow: 拉取基本信息失败")})}})}});RankData.getInstance=function(){return null==RankData._instance&&(RankData._instance=new RankData),RankData._instance};var rankData=RankData.getInstance();
var EffectCacheType={};EffectCacheType.CHESS_CHANGE_EFFECT=1,EffectCacheType.GUIDE_SWAP_CHESS_APERTUR_EEFFECT=2,EffectCacheType.ANIMAL_ORIGINAL_CRUSH_EFFECT=3,EffectCacheType.BOMB_CHESS_CRUSH_EFFECT=4,EffectCacheType.GHOST_APERTUR_EEFFECT=5,EffectCacheType.ANIMAL_LAST_PANG_CRUSH_EFFECT=6,EffectCacheType.TYPE_CRUSH_EFFECT=7,EffectCacheType.COLLECT_CRUSH_EFFECT=8,EffectCacheType.COLLECT_FLY_EFFECT=9,EffectCacheType.DIVIDE_EFFECT=11,EffectCacheType.MOVE_EFFECT=12,EffectCacheType.DIVIDED_EFFECT=13,EffectCacheType.SHOCK_WAVE_EFFECT=14,EffectCacheType.COLLECT_GET_EFFECT=15,EffectCacheType.SWAP_PROP_APERTURE_EFFECT=16,EffectCacheType.SWAP_PROP_FLASH_OF_LIGHT_EFFECT=17,EffectCacheType.GHOST_ABSORB_EFFECT=18,EffectCacheType.GHOST_SING_EFFECT=19,EffectCacheType.ATTACKED_EFFECT=20,EffectCacheType.LAST_PANG_RADIAL_EFFECT=21,EffectCacheType.DEVOUR_CHESS_EFFECT=22,EffectCacheType.CHESS_DEVOURED_EFFECT=23,EffectCacheType.ANIMAL_CHESS_DROP_EFFECT=24,EffectCacheType.BOMB_CHESS_DROP_EFFECT=25,EffectCacheType.GLASSES_CHESS_DROP_EFFECT=26,EffectCacheType.TYPE_DROP_EFFECT=27,EffectCacheType.STAR_LEVEL=28,EffectCacheType.GUIDE_SWAP_CHESS=29,EffectCacheType.HAMMER_PROP=30,EffectCacheType.PROP_ITEM_BG=31,EffectCacheType.STEP_TIP=32,EffectCacheType.DROP_ENCOURAGE=33,EffectCacheType.ADD_THREE_STEP=34,EffectCacheType.STEP_CHESS_ADD_STEP=35;var EffectCacheDescribe={};EffectCacheDescribe[EffectCacheType.CHESS_CHANGE_EFFECT]={describe:"棋子替换特效"},EffectCacheDescribe[EffectCacheType.GUIDE_SWAP_CHESS_APERTUR_EEFFECT]={describe:"引导交换棋子光圈特效"},EffectCacheDescribe[EffectCacheType.ANIMAL_ORIGINAL_CRUSH_EFFECT]={describe:"动物棋子消除特效"},EffectCacheDescribe[EffectCacheType.BOMB_CHESS_CRUSH_EFFECT]={describe:"爆炸棋子消除特效"},EffectCacheDescribe[EffectCacheType.GHOST_APERTUR_EEFFECT]={describe:"幽灵光圈特效"},EffectCacheDescribe[EffectCacheType.ANIMAL_LAST_PANG_CRUSH_EFFECT]={describe:"lastPang棋子消除特效"},EffectCacheDescribe[EffectCacheType.TYPE_CRUSH_EFFECT]={describe:"障碍物棋子消除特效"},EffectCacheDescribe[EffectCacheType.COLLECT_CRUSH_EFFECT]={describe:"收集物棋子消除特效"},EffectCacheDescribe[EffectCacheType.COLLECT_FLY_EFFECT]={describe:"收集物棋子飞行特效"},EffectCacheDescribe[EffectCacheType.DIVIDE_EFFECT]={describe:"棋子分裂特效"},EffectCacheDescribe[EffectCacheType.MOVE_EFFECT]={describe:"棋子移动特效"},EffectCacheDescribe[EffectCacheType.DIVIDED_EFFECT]={describe:"棋子被分裂特效"},EffectCacheDescribe[EffectCacheType.SHOCK_WAVE_EFFECT]={describe:"冲击波特效"},EffectCacheDescribe[EffectCacheType.COLLECT_GET_EFFECT]={describe:"获取收集物特效"},EffectCacheDescribe[EffectCacheType.SWAP_PROP_APERTURE_EFFECT]={describe:"交换道具光圈特效"},EffectCacheDescribe[EffectCacheType.SWAP_PROP_FLASH_OF_LIGHT_EFFECT]={describe:"交换道具闪光特效"},EffectCacheDescribe[EffectCacheType.GHOST_ABSORB_EFFECT]={describe:"幽灵棋子吸收特效"},EffectCacheDescribe[EffectCacheType.GHOST_SING_EFFECT]={describe:"幽灵棋子吟唱特效"},EffectCacheDescribe[EffectCacheType.ATTACKED_EFFECT]={describe:"受击特效"},EffectCacheDescribe[EffectCacheType.LAST_PANG_RADIAL_EFFECT]={describe:"lastPang射线特效"},EffectCacheDescribe[EffectCacheType.DEVOUR_CHESS_EFFECT]={describe:"吞噬特效"},EffectCacheDescribe[EffectCacheType.CHESS_DEVOURED_EFFECT]={describe:"被吞噬特效"},EffectCacheDescribe[EffectCacheType.ANIMAL_CHESS_DROP_EFFECT]={describe:"普通棋子掉落特效"},EffectCacheDescribe[EffectCacheType.BOMB_CHESS_DROP_EFFECT]={describe:"爆炸棋子掉落特效"},EffectCacheDescribe[EffectCacheType.GLASSES_CHESS_DROP_EFFECT]={describe:"眼镜棋子掉落特效"},EffectCacheDescribe[EffectCacheType.TYPE_DROP_EFFECT]={describe:"类型棋子掉落特效"},EffectCacheDescribe[EffectCacheType.STAR_LEVEL]={describe:"星级特效"},EffectCacheDescribe[EffectCacheType.GUIDE_SWAP_CHESS]={describe:"引导交换棋子特效(手指)"},EffectCacheDescribe[EffectCacheType.HAMMER_PROP]={describe:"锤子道具"},EffectCacheDescribe[EffectCacheType.PROP_ITEM_BG]={describe:"道具背景光圈特效"},EffectCacheDescribe[EffectCacheType.STEP_TIP]={describe:"剩余步数提示特效"},EffectCacheDescribe[EffectCacheType.DROP_ENCOURAGE]={describe:"掉落鼓励特效"},EffectCacheDescribe[EffectCacheType.ADD_THREE_STEP]={describe:"加三步特效"},EffectCacheDescribe[EffectCacheType.STEP_CHESS_ADD_STEP]={describe:"步数棋子加步特效"};var AnimationCacheManager={_preCreateOperateList:null,_updateProxy:null,_createCountSecondFrame:2,_bPreCreateFinish:!1,_bSaveEffectCacheModel:!0,_bCacheModelInit:!1,_cacheListMap:null,_createMap:null,preCreateAnimation:function(){this._preCreateOperateList=[],this._preCreateOperateList=this._preCreateOperateList.concat(OriginalAnimationPreCreate.getPreCreateList()),this._preCreateOperateList=this._preCreateOperateList.concat(SpecialAnimationPreCreate.getPreCreateList()),this._preCreateOperateList=this._preCreateOperateList.concat(DropEncouragePreCreate.getPreCreateList()),this._preCreateOperateList=this._preCreateOperateList.concat(StepTipPreCreate.getPreCreateList()),this._startUpdateProxy(),this._createCountSecondFrame=0!=this._preCreateOperateList.length?Math.ceil(this._preCreateOperateList.length/GameDataConfig.GAME_START_ANIMATION_TOTAL_FRAME):2},preCreateLastpangAnimation:function(){this._preCreateOperateList=this._preCreateOperateList.concat(LastpangAnimationPreCreate.getPreCreateList()),this._startUpdateProxy()},init:function(){this._createMap={};for(var e in EffectCacheType){var t=EffectCacheType[e];this._createMap[t]={preCreate:0,dynamicCreate:0}}this._bSaveEffectCacheModel?this._cacheModelInit():this._unCacheModelInit()},destroy:function(){this._bSaveEffectCacheModel?this._cacheModelDestroy():this._unCacheModelDestroy(),this._log()},cacheEffect:function(e,t){if(null!=t){var a=this._cacheListMap[e];null!=a&&(t.setOpacity&&t.setOpacity(0),t.pause&&t.pause(),a.push(t))}},getEffectCount:function(e,t){var a=this.getCacheList(e);if(null==a)return console.log("find cache list fail : "+e),-1;if(null==t)return a.length;for(var c=0,C=0,f=a.length;C<f;C++)t==a[C].getTag()&&c++;return c},getEffect:function(e,t){var a={bCreate:!1,effect:null},c=this._cacheListMap[e];if(null==c)return console.log("find effect cache fail"),a;var C=null!=t?t.tag:null,f=null;return null!=C?null==(f=this._getEffectByTag(c,C))&&(a.bCreate=!0,f=this._createEffect(e,t)):null==(f=c.pop())&&(a.bCreate=!0,f=this._createEffect(e,t)),a.effect=f,a},getCacheList:function(e){return this._cacheListMap[e]},createAndCacheEffect:function(e,t){var a=this._createEffect(e,t);this.cacheEffect(e,a)},_getEffectByTag:function(e,t){for(var a=e.length-1;a>=0;a--)if(e[a].getTag()==t)return e.splice(a,1)[0];return null},_createEffect:function(e,t){var a=AnimationCreator.createEffect(e,t);return this._recordCreate(e,a),a},_recordCreate:function(e,t){if(null!=t){var a=this._createMap[e];null!=a&&(this._bPreCreateFinish?a.dynamicCreate++:a.preCreate++)}},_cacheModelDestroy:function(){for(var e in this._cacheListMap)this._setParentNull(this._cacheListMap[e])},_unCacheModelDestroy:function(){for(var e in this._cacheListMap)this._releaseList(this._cacheListMap[e])},_setParentNull:function(e){if(null!=e)for(var t=0,a=e.length;t<a;t++){var c=e[t];c&&c.setParent&&c.setParent(null)}},_releaseList:function(e){if(null!=e){for(var t=0,a=e.length;t<a;t++){var c=e[t];c&&c.removeFromParent&&c.removeFromParent()}e.length=0}},_log:function(){var e=this;function t(t){var a=e.getCacheList(t);return null!=a?a.length:(console.log("find cache list fail "+t),0)}console.log("====================特效  第"+GameProxy.getStageId()+"关====================");var a=0,c=0,C=0;for(var f in this._createMap){var r=this._createMap[f];if(null!=r){if(r.preCreate>0||r.dynamicCreate>0){a++;var E=EffectCacheDescribe[f],i="unKnown";null!=E?i=E.describe:console.log("effectCacheDescribe is null "+f),console.log(i+":预创建("+r.preCreate+"),动态创建("+r.dynamicCreate+"),缓存数量("+t(f)+")"),c+=r.preCreate,C+=r.dynamicCreate}}else console.log("cacheType : "+f+" data is null")}0==a?console.log("没有预创建,动态创建特效"):console.log("预创建:("+c+"),动态创建:("+C+")")},_cacheModelInit:function(){if(!this._bCacheModelInit){this._bCacheModelInit=!0,this._cacheListMap={};for(var e in EffectCacheType){var t=EffectCacheType[e];this._cacheListMap[t]=[]}}},_unCacheModelInit:function(){this._cacheListMap={};for(var e in EffectCacheType){var t=EffectCacheType[e];this._cacheListMap[t]=[]}},_startUpdateProxy:function(){this._bPreCreateFinish=!1,0!=this._preCreateOperateList.length?(null==this._updateProxy&&(this._updateProxy=new UpdateProxy(this._onUpdate.bind(this))),this._updateProxy.start()):this._bPreCreateFinish=!0},_onUpdate:function(e){for(var t=0;t<this._createCountSecondFrame;t++){var a=this._preCreateOperateList.shift();null!=a&&a.fun.apply(a.funCaller,a.arguments)}0==this._preCreateOperateList.length&&(this._updateProxy.pause(),this._bPreCreateFinish=!0)}},OriginalAnimationPreCreate={_bGet:!1,getPreCreateList:function(){if(this._bGet)return[];var e=[],t=RemoveLogic.we4Proto.ChessType;return _addPreCreateOperate(EffectCacheType.GHOST_ABSORB_EFFECT,null,2,e),_addPreCreateOperate(EffectCacheType.SHOCK_WAVE_EFFECT,null,6,e),_addPreCreateOperate(EffectCacheType.ANIMAL_CHESS_DROP_EFFECT,t.CT_NormalUnit,64,e),_addPreCreateOperate(EffectCacheType.BOMB_CHESS_DROP_EFFECT,t.CT_SpecialHurricane,4,e),_addPreCreateOperate(EffectCacheType.ANIMAL_ORIGINAL_CRUSH_EFFECT,t.CT_NormalUnit,64,e),_addPreCreateOperate(EffectCacheType.GHOST_SING_EFFECT,null,2,e),_addPreCreateOperate(EffectCacheType.BOMB_CHESS_CRUSH_EFFECT,t.CT_SpecialHurricane,4,e),_addPreCreateOperate(EffectCacheType.TYPE_DROP_EFFECT,t.CT_SpecialGas,2,e),_addPreCreateOperate(EffectCacheType.GLASSES_CHESS_DROP_EFFECT,t.CT_SpecialVerticalShockWave,4,e),_addPreCreateOperate(EffectCacheType.GLASSES_CHESS_DROP_EFFECT,t.CT_SpecialHorizontalShockWave,4,e),_addPreCreateOperate(EffectCacheType.GHOST_APERTUR_EEFFECT,null,1,e),this._bGet=0==e.length,e}},LastpangAnimationPreCreate={_bGet:!1,getPreCreateList:function(){if(this._bGet)return[];var e=[];return _addPreCreateOperate(EffectCacheType.LAST_PANG_RADIAL_EFFECT,null,6,e),_addPreCreateOperate(EffectCacheType.ANIMAL_LAST_PANG_CRUSH_EFFECT,null,6,e),this._bGet=0==e.length,e}};function _addPreCreateOperate(e,t,a,c){var C=AnimationCacheManager.getEffectCount(e,t);if(-1!=C&&C<a)for(var f=a-C,r=0;r<f;r++)pushPreCreateOperate(c,AnimationCacheManager.createAndCacheEffect,AnimationCacheManager,[e,{tag:t,chessType:t}])}var SpecialAnimationPreCreate={getPreCreateList:function(){var e=[];if(null!=puzzleGame){var t=this._getCacheTypeConfigList(),a=new StageId(GameProxy.getStageId(),0),c=puzzleGame.getContainChessType(a);for(var C in c){var f=c[C];f=f>GameDataConfig.EFFECT_PRE_CREATE_MAX_LIMIT?GameDataConfig.EFFECT_PRE_CREATE_MAX_LIMIT:f,C=parseInt(C),this._handleCrushEffectPreCreate(C,f,e),this._handleCacheTypeConfigPreCreate(t,C,f,e);var r=GameDataConfig.MultistageChessCrushConfig[C];if(null!=r)for(var E=0,i=r.length;E<i;E++){C=r[E];this._handleCrushEffectPreCreate(C,f,e),this._handleCacheTypeConfigPreCreate(t,C,f,e)}}}return e},_getCacheTypeConfigList:function(){var e=[];return e.push({cacheType:EffectCacheType.CHESS_DEVOURED_EFFECT,config:GameDataConfig.ChessDevouredEffectConfig}),e.push({cacheType:EffectCacheType.DIVIDE_EFFECT,config:GameDataConfig.ChessDivideEffectConfig}),e.push({cacheType:EffectCacheType.DIVIDED_EFFECT,config:GameDataConfig.ChessDividedEffectConfig}),e.push({cacheType:EffectCacheType.MOVE_EFFECT,config:GameDataConfig.ChessMoveEffectConfig}),e.push({cacheType:EffectCacheType.CHESS_CHANGE_EFFECT,config:GameDataConfig.ChessChangeEffectConfig}),e.push({cacheType:EffectCacheType.ATTACKED_EFFECT,config:GameDataConfig.ChessAttackedEffectConfig}),e.push({cacheType:EffectCacheType.DEVOUR_CHESS_EFFECT,config:GameDataConfig.ChessDevourEffectConfig}),e.push({cacheType:EffectCacheType.COLLECT_FLY_EFFECT,config:GameDataConfig.CollectEffectConfig}),e.push({cacheType:EffectCacheType.COLLECT_GET_EFFECT,config:GameDataConfig.CollectEffectConfig}),e},_handleCacheTypeConfigPreCreate:function(e,t,a,c){for(var C=0,f=e.length;C<f;C++){var r=e[C].config,E=e[C].cacheType;null!=r[t]&&_addPreCreateOperate(E,t,a,c)}},_handleCrushEffectPreCreate:function(e,t,a){var c=GameDataConfig.CrushEffectConfig[e];if(null!=c)switch(c.crushType){case GameDataConfig.CrushType.TYPE_CRUSH:_addPreCreateOperate(EffectCacheType.TYPE_CRUSH_EFFECT,e,t,a);break;case GameDataConfig.CrushType.FLY_COLLECT:_addPreCreateOperate(EffectCacheType.COLLECT_CRUSH_EFFECT,e,t,a)}}},DropEncouragePreCreate={_bGet:!1,getPreCreateList:function(){if(this._bGet)return[];this._bGet=!0;var e=[];function t(t){pushPreCreateOperate(e,AnimationCacheManager.createAndCacheEffect,AnimationCacheManager,[EffectCacheType.DROP_ENCOURAGE,{tag:t.effectPath,effectPath:t.effectPath}])}return t(GameDataConfig.EncourageTitleConfig.LI_HAI),t(GameDataConfig.EncourageTitleConfig.SHUANG),t(GameDataConfig.EncourageTitleConfig.CHAO_ZAN),t(GameDataConfig.EncourageTitleConfig.WAI_SAI),t(GameDataConfig.EncourageTitleConfig.GAN_DE_PIAO_LIANG),t(GameDataConfig.EncourageTitleConfig.JING_CAI_JUE_LUN),t(GameDataConfig.EncourageTitleConfig.CHU_SHEN_RU_HUA),t(GameDataConfig.EncourageTitleConfig.BU_KE_SI_YI),t(GameDataConfig.EncourageTitleConfig.WU_YU_LUN_BI),e}},StepTipPreCreate={_bGet:!1,getPreCreateList:function(){if(this._bGet)return[];this._bGet=!0;var e=[];return pushPreCreateOperate(e,AnimationCacheManager.createAndCacheEffect,AnimationCacheManager,[EffectCacheType.STEP_TIP,{tag:res.guideplayer5steps_json,effectPath:res.guideplayer5steps_json}]),pushPreCreateOperate(e,AnimationCacheManager.createAndCacheEffect,AnimationCacheManager,[EffectCacheType.STEP_TIP,{tag:res.guideplayer10steps_json,effectPath:res.guideplayer10steps_json}]),e}};
var AnimationCreator={createEffect:function(e,t){var c=null;switch(e){case EffectCacheType.LAST_PANG_RADIAL_EFFECT:c=this._createLastPangRadialEffect();break;case EffectCacheType.SWAP_PROP_APERTURE_EFFECT:c=this._createSwapPropApertureEffect();break;case EffectCacheType.CHESS_CHANGE_EFFECT:c=this._createChessChangeEffect(t);break;case EffectCacheType.DEVOUR_CHESS_EFFECT:c=this._createDevourChessEffect(t);break;case EffectCacheType.CHESS_DEVOURED_EFFECT:c=this._createChessDevouredEffect(t);break;case EffectCacheType.ATTACKED_EFFECT:c=this._createAttackedEffect(t);break;case EffectCacheType.GHOST_ABSORB_EFFECT:c=this._createGhostAbsorbEffect();break;case EffectCacheType.HAMMER_PROP:c=this._createHammerPropEffect();break;case EffectCacheType.STAR_LEVEL:c=this._createStarLevelEffect();break;case EffectCacheType.GUIDE_SWAP_CHESS:c=this._createGuideSwapChessEffect();break;case EffectCacheType.GHOST_SING_EFFECT:c=this._createGhostSingEffect();break;case EffectCacheType.SHOCK_WAVE_EFFECT:c=this._createShockWaveEffect();break;case EffectCacheType.GHOST_APERTUR_EEFFECT:c=this._createGhostApertureEffect();break;case EffectCacheType.DIVIDED_EFFECT:c=this._createDividedEffect(t);break;case EffectCacheType.DIVIDE_EFFECT:c=this._createDivideEffect(t);break;case EffectCacheType.MOVE_EFFECT:c=this._createMoveEffect(t);break;case EffectCacheType.ANIMAL_CHESS_DROP_EFFECT:c=this._createOrdinaryChessDropEffect();break;case EffectCacheType.BOMB_CHESS_DROP_EFFECT:c=this._createBombChessDropEffect();break;case EffectCacheType.GLASSES_CHESS_DROP_EFFECT:c=this._createGlassesChessDropEffect();break;case EffectCacheType.TYPE_DROP_EFFECT:c=this._createTypeDropEffect(t);break;case EffectCacheType.GUIDE_SWAP_CHESS_APERTUR_EEFFECT:c=this._createGuideSwapChessApertureEffect();break;case EffectCacheType.ANIMAL_ORIGINAL_CRUSH_EFFECT:c=this._createAnimalChessCrushEffect();break;case EffectCacheType.BOMB_CHESS_CRUSH_EFFECT:c=this._createBombChessCrushEffect();break;case EffectCacheType.ANIMAL_LAST_PANG_CRUSH_EFFECT:c=this._createAnimalLastPangCrushEffect();break;case EffectCacheType.TYPE_CRUSH_EFFECT:c=this._createTypeCrushEffect(t);break;case EffectCacheType.COLLECT_CRUSH_EFFECT:c=this._createCollectCrushEffect(t);break;case EffectCacheType.COLLECT_FLY_EFFECT:c=this._createCollectFlyEffect(t);break;case EffectCacheType.COLLECT_GET_EFFECT:c=this._createCollectGetEffect(t);break;case EffectCacheType.SWAP_PROP_FLASH_OF_LIGHT_EFFECT:c=this._createSwapPropFlashOfLightEffect();break;case EffectCacheType.PROP_ITEM_BG:c=this._createPropItemBgEffect();break;case EffectCacheType.STEP_TIP:c=this._createStepTipEffect(t);break;case EffectCacheType.DROP_ENCOURAGE:c=this._createDropEncourageEffect(t);break;case EffectCacheType.ADD_THREE_STEP:c=this._createAddThreeStepEffect(t);break;case EffectCacheType.STEP_CHESS_ADD_STEP:c=this._createStepChessAddStepEffect(t)}return t&&c&&c.setTag(t.tag),c},_createPropItemBgEffect:function(){return new Effect(res.backgroung2_json)},_createSwapPropFlashOfLightEffect:function(){return new SwapPropFlashOfLightEffect},_createCollectGetEffect:function(e){var t=e.chessType;return new CollectGetEffect(t)},_createCollectFlyEffect:function(e){var t=e.chessType;return t!=RemoveLogic.we4Proto.ChessType.STIT_COLLECT_UNDER_ICE?new CollectFlyEffect(t):new CollectBearEffect(t)},_createCollectCrushEffect:function(e){var t=e.chessType;return new CollectCrushEffect(t)},_createTypeCrushEffect:function(e){var t=e.chessType;return new TypeCrushEffect(t)},_createAnimalLastPangCrushEffect:function(){return new AnimalLastPangCrushEffect},_createBombChessCrushEffect:function(){return new BombChessCrushEffect},_createAnimalChessCrushEffect:function(){return new AnimalOriginalCrushEffect},_createGuideSwapChessApertureEffect:function(){return new GuideSwapChessApertureEffect},_createTypeDropEffect:function(e){var t=e.chessType;return new TypeDropEffect(t)},_createGlassesChessDropEffect:function(){return new DirectionChessDropEffect},_createBombChessDropEffect:function(){return new BombChessDropEffect},_createOrdinaryChessDropEffect:function(){return new OrdinaryChessDropEffect},_createMoveEffect:function(e){var t=e.chessType;return new ChessMoveEffect(t)},_createDivideEffect:function(e){var t=e.chessType;return new ChessDivideEffect(t)},_createDividedEffect:function(e){var t=e.chessType;return new ChessDividedEffect(t)},_createGhostApertureEffect:function(){return new GhostApertureEffect},_createShockWaveEffect:function(){return new ShockWaveEffect},_createGhostSingEffect:function(){return new GhostSingEffect},_createGhostAbsorbEffect:function(){return new GhostAbsorbEffect},_createHammerPropEffect:function(){return new HammerPropEffect},_createGuideSwapChessEffect:function(){return new GuideSwapChessEffect},_createStarLevelEffect:function(){return new StarLevelEffect},_createLastPangRadialEffect:function(){return new RadialEffect},_createSwapPropApertureEffect:function(){return new SwapPropApertureEffect},_createChessChangeEffect:function(e){var t=e.chessType;return new ChessChangeEffect(t)},_createDevourChessEffect:function(e){var t=e.chessType;return RemoveLogic.we4Proto.ChessType.STIT_HUGEMUSHROOM!=t?new DevourChessEffect(t):new MushroomDevourEffect(t)},_createChessDevouredEffect:function(e){var t=e.chessType;return new ChessDevouredEffect(t)},_createAttackedEffect:function(e){var t=e.chessType;return RemoveLogic.we4Proto.ChessType.STIT_HUGEMUSHROOM!=t?new ChessAttackedEffect(t):new MushroomAttackedEffect(t)},_createStepTipEffect:function(e){var t=e.effectPath;return new Effect(t)},_createDropEncourageEffect:function(e){var t=e.effectPath;return new Effect(t)},_createAddThreeStepEffect:function(){return new AddStepEffect(res.add5steps2_json)},_createStepChessAddStepEffect:function(){return new AddStepEffect(res.stepscounterfly_json)}};
var AnimationManager={_animationTaskHandler:null,_guideSwapChessEffect:null,_swapPropApertureEffectList:null,_ghostAbsorbEffectList:null,_guideSwapChessApertureEffectList:null,_ghostSingEffectList:null,_executingEffectLogicCount:null,_playingEffectCount:null,_waitChessBoardStableCount:null,_ghostAbsorbEffectCount:null,_animationQueueUpdateProxy:null,_collectPositionMap:null,_bPlayedEffect:null,_collectLayer:null,_listenerList:null,_waitChessBoardStableFunList:null,_bNeedCallContinueOnAnimationComplete:!1,init:function(e,t){this._collectPositionMap=e,this._collectLayer=t,this._guideSwapChessEffect=null,this._executingEffectLogicCount=0,this._playingEffectCount=0,this._waitChessBoardStableCount=0,this._ghostAbsorbEffectCount=0,this._bPlayedEffect=!1,this._guideSwapChessApertureEffectList=[],this._ghostSingEffectList=[],this._ghostAbsorbEffectList=[],this._swapPropApertureEffectList=[],this._waitChessBoardStableFunList=[],this._listenerList=[],Util.registerListener(this._listenerList,EventID.ON_USE_PROP,this._onUseProp.bind(this));var i=workerMode?this._onAnimationQueueUpdateWorkerModel.bind(this):this._onAnimationQueueUpdate.bind(this);this._animationQueueUpdateProxy=new UpdateProxy(i),this._animationQueueUpdateProxy&&this._animationQueueUpdateProxy.pause(),this._animationTaskHandler=new AnimationTaskHandler},destroy:function(){this.hideGuideSwapChessEffect(),this._hideGhostAbsorbEffect(),this._hideGhostSingEffect(),this._releaseList(this._swapPropApertureEffectList),this._releaseList(this._ghostSingEffectList),this._releaseList(this._guideSwapChessApertureEffectList),this._releaseList(this._ghostAbsorbEffectList),this._ghostSingEffectList=null,this._guideSwapChessApertureEffectList=null,this._ghostAbsorbEffectList=null,this._swapPropApertureEffectList=null,this._guideSwapChessEffect=null,this._collectPositionMap=null,this._collectLayer=null,this._executingEffectLogicCount=null,this._playingEffectCount=null,this._waitChessBoardStableCount=null,this._ghostAbsorbEffectCount=null,this._bPlayedEffect=null,this._waitChessBoardStableFunList=null,Util.unRegisterListeners(this._listenerList),this._listenerList=null,this._animationQueueUpdateProxy.release(),this._animationQueueUpdateProxy=null,this._animationTaskHandler.destroy(),this._animationTaskHandler=null,AnimationCacheManager.destroy()},start:function(){this._animationQueueUpdateProxy.start()},pause:function(){this._animationQueueUpdateProxy&&this._animationQueueUpdateProxy.pause()},resume:function(){this._animationQueueUpdateProxy.resume()},isNeedCallContinueOnAnimationComplete:function(){return this._bNeedCallContinueOnAnimationComplete},isAnimationQueueEmpty:function(){return 0==puzzleGame.getAnimationNum()},playStepChessAddStepEffect:function(e,t){var i=AnimationCacheManager.getEffect(EffectCacheType.STEP_CHESS_ADD_STEP).effect;null!=i?(null==i.getParent()&&e.viewRoot.addChild(i),this._increasePlayingEffectCount(),i.setOpacity(255),i.setPosition(e.position),i.play(e,function(e){"function"==typeof t&&t()}.bind(this),function(e){AnimationCacheManager.cacheEffect(EffectCacheType.STEP_CHESS_ADD_STEP,e),this._reducePlayingEffectCount()}.bind(this))):console.log("step chess add step effect is null")},playUseAddThreeStepPropEffect:function(e,t){var i=AnimationCacheManager.getEffect(EffectCacheType.ADD_THREE_STEP).effect;null!=i?(null==i.getParent()&&e.viewRoot.addChild(i),this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount(),i.setOpacity(255),i.setPosition(e.position),i.play(e,function(e){this._reduceExecutingEffectLogicCount(),"function"==typeof t&&t()}.bind(this),function(e){AnimationCacheManager.cacheEffect(EffectCacheType.ADD_THREE_STEP,e),this._reducePlayingEffectCount()}.bind(this))):console.log("add three step effect is null")},playTipSwapChessEffect:function(e){var t=AnimationCacheManager.getEffect(EffectCacheType.GUIDE_SWAP_CHESS).effect;if(null!=t){null==t.getParent()&&e.viewRoot.addChild(t,GameDataConfig.ZOrder.GUIDE_SWAP_CHESS),t.setOpacity(255),t.setPosition(e.position),t.play(e.fromPosition,e.toPosition),this._guideSwapChessEffect=t;var i={};i.viewRoot=e.viewRoot,i.crushPositionList=e.crushPositionList,this._playGuideSwapChessApertureEffect(i)}else console.log("guide swap chess effect is null")},playGuideSlideChessEffect:function(e){var t=AnimationCacheManager.getEffect(EffectCacheType.GUIDE_SWAP_CHESS).effect;if(null!=t)return null==t.getParent()&&e.viewRoot.addChild(t,GameDataConfig.ZOrder.GUIDE_SWAP_CHESS),t.setOpacity(255),t.setPosition(e.position),t.play(e.fromPosition,e.toPosition),t;console.log("guide swap chess effect is null")},playReachStarLevelEffect:function(e){var t=AnimationCacheManager.getEffect(EffectCacheType.STAR_LEVEL).effect;null!=t?(t.removeFromParent(),e.viewRoot.addChild(t),t.setPosition(e.position),t.setOpacity(255),t.play(function(e){AnimationCacheManager.cacheEffect(EffectCacheType.STAR_LEVEL,e)})):console.log("star level effect is null")},hideGuideSwapChessEffect:function(){if(null!=this._guideSwapChessEffect&&(AnimationCacheManager.cacheEffect(EffectCacheType.GUIDE_SWAP_CHESS,this._guideSwapChessEffect),this._guideSwapChessEffect=null),Util.isArray(this._guideSwapChessApertureEffectList))for(var e=0,t=this._guideSwapChessApertureEffectList.length;e<t;e++)AnimationCacheManager.cacheEffect(EffectCacheType.GUIDE_SWAP_CHESS_APERTUR_EEFFECT,this._guideSwapChessApertureEffectList[e]);this._guideSwapChessApertureEffectList=[]},playAdventureSuccessAnimation:function(e){this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount(),GameUtil.registerNextFrameCall(function(){GameResultSuccessWindow.Show(function(){this._reduceExecutingEffectLogicCount(),this._reducePlayingEffectCount()}.bind(this),e.level)}.bind(this))},playLastPangRadialAnimation:function(e,t){var i=AnimationCacheManager.getEffect(EffectCacheType.LAST_PANG_RADIAL_EFFECT).effect;if(null==i)return console.log("radial effect is null"),void("function"==typeof t&&t(e.animationDataList));this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount(),null==i.getParent()&&e.viewRoot.addChild(i,GameDataConfig.ZOrder.RADIAL),i.setOpacity(255),i.setUserData(e.animationDataList),i.play(e.fromPosition,e.toPosition,function(e){AnimationCacheManager.cacheEffect(EffectCacheType.LAST_PANG_RADIAL_EFFECT,e),this._reduceExecutingEffectLogicCount(),this._reducePlayingEffectCount(),"function"==typeof t&&t(e.getUserData())}.bind(this))},playSwapPropFlashOfLightEffect:function(e,t,i,n){this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount();var a=2,o=this;function c(){0==--a&&(o._removeSwapPropApertureEffect(),o._reduceExecutingEffectLogicCount(),o._reducePlayingEffectCount(),"function"==typeof n&&n())}var f={};f.viewRoot=e.viewRoot,f.position=e.firstPosition,this._playSwapPropFlashOfLightEffect(f,function(){"function"==typeof t&&t()}.bind(this),function(){"function"==typeof i&&i()}.bind(this),function(){c()});var s={};s.viewRoot=e.viewRoot,s.position=e.secondPosition,this._playSwapPropFlashOfLightEffect(s,null,null,function(){c()})},playSwapPropApertureEffect:function(e){var t=AnimationCacheManager.getEffect(EffectCacheType.SWAP_PROP_APERTURE_EFFECT).effect;null!=t?(null==t.getParent()&&e.viewRoot.addChild(t,GameDataConfig.ZOrder.PROP),t.setPosition(e.position),t.setOpacity(255),t.play(),this._swapPropApertureEffectList.push(t)):console.log("swap prop aperture effect is null")},playChessChangeEffect:function(e,t){var i=GameDataConfig.ChessChangeEffectConfig[e.chessType];if(null==i)return console.log("find ChessChangeEffectConfig fail : "+e.chessType),void("function"==typeof t&&t());var n=AnimationCacheManager.getEffect(EffectCacheType.CHESS_CHANGE_EFFECT,{tag:e.chessType,chessType:e.chessType}).effect;if(null==n)return console.log("chess change effect is null"),void("function"==typeof t&&t());e.bNeedCalcExecutingEffectLogicCount=i.bNeedCalcExecutingEffectLogicCount,e.bNeedCalcExecutingEffectLogicCount&&this._increaseExecutingEffectLogicCount(),null==n.getParent()&&e.viewRoot.addChild(n,GameDataConfig.ZOrder.CHANGE);function a(e){null!=e&&(AnimationCacheManager.cacheEffect(EffectCacheType.CHESS_CHANGE_EFFECT,e),"function"==typeof t&&t())}e.chess.onChangeEffectStartPlay(n,a),n.setPosition(e.position),n.setOpacity(255),n.play(function(t){e.chess.onChangeEffectPlayComplete(),a(t)}.bind(this));var o=null!=i.delayTime?i.delayTime:n.getDuration()/FRAME_SECOND*1e3;Timeout.registerEx(function(){e.bNeedCalcExecutingEffectLogicCount&&this._reduceExecutingEffectLogicCount()}.bind(this),o)},playDevourChessEffect:function(e,t,i){var n=GameDataConfig.ChessDevourEffectConfig[e.chessType];if(null==n)return"function"==typeof t&&t(),void("function"==typeof i&&i());var a=AnimationCacheManager.getEffect(EffectCacheType.DEVOUR_CHESS_EFFECT,{tag:e.chessType,chessType:e.chessType}).effect;if(null!=a){this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount(),null==a.getParent()&&e.viewRoot.addChild(a,GameDataConfig.ZOrder.DEVOUR);var o=this;e.chess.onDevourEffectStartPlay(a,u),a.setPosition(e.position),a.setOpacity(255);var c=null!=e.extendData?e.extendData:{};a.play(c,function(t){u(t),e.chess.onDevourEffectPlayComplete()}.bind(this));var f=1e3*a.getDuration(),s=null!=n.devourChessDelayTime?n.devourChessDelayTime:f;Timeout.registerEx(function(){"function"==typeof t&&t()},s);s=null!=n.addChessDelayTime?n.addChessDelayTime:f;Timeout.registerEx(function(){"function"==typeof i&&i()},s)}else console.log("devour chess is null");function u(e){null!=e&&(AnimationCacheManager.cacheEffect(EffectCacheType.DEVOUR_CHESS_EFFECT,e),o._reduceExecutingEffectLogicCount(),o._reducePlayingEffectCount())}},playChessDevouredEffect:function(e){if(null!=GameDataConfig.ChessDevouredEffectConfig[e.chessType]){var t=AnimationCacheManager.getEffect(EffectCacheType.CHESS_DEVOURED_EFFECT,{tag:e.chessType,chessType:e.chessType}).effect;if(null!=t){this._increasePlayingEffectCount(),null==t.getParent()&&e.viewRoot.addChild(t,GameDataConfig.ZOrder.DEVOUR);var i=this;e.chess.onDevouredEffectStartPlay(t,n),t.setPosition(e.position),t.setOpacity(255),t.play(function(t){n(t),e.chess.onDevouredEffectPlayComplete()}.bind(this))}else console.log("chess devoured is null")}else console.log("find ChessDevouredEffectConfig fail : "+e.chessType);function n(e){null!=e&&(AnimationCacheManager.cacheEffect(EffectCacheType.CHESS_DEVOURED_EFFECT,e),i._reducePlayingEffectCount())}},playChessAttackedEffect:function(e){var t=GameDataConfig.ChessAttackedEffectConfig[e.chessType];if(null!=t){var i=AnimationCacheManager.getEffect(EffectCacheType.ATTACKED_EFFECT,{tag:e.chessType,chessType:e.chessType}).effect;if(null!=i){e.bNeedCalcExecutingEffectLogicCount=t.bNeedCalcExecutingEffectLogicCount,e.bNeedCalcExecutingEffectLogicCount&&this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount(),null==i.getParent()&&e.viewRoot.addChild(i,GameDataConfig.ZOrder.ATTACKED);var n=this;e.chess.onAttackedEffectStartPlay(i,o),i.setPosition(e.position),i.setOpacity(255);var a=null!=e.extendData?e.extendData:{};i.play(a,function(t){o(t),e.chess.onAttackedEffectPlayComplete()}.bind(this))}else console.log("attacked effect is null")}else console.log("find ChessAttackedEffectConfig fail : "+e.chessType);function o(t){null!=t&&(AnimationCacheManager.cacheEffect(EffectCacheType.ATTACKED_EFFECT,t),e.bNeedCalcExecutingEffectLogicCount&&n._reduceExecutingEffectLogicCount(),n._reducePlayingEffectCount())}},playCollectBearChessEffect:function(e){e.chess.setOpacity(0),this._playCollectFlyEffect(e)},playHammerPropEffect:function(e,t,i){var n=AnimationCacheManager.getEffect(EffectCacheType.HAMMER_PROP).effect;if(null==n)return console.log("hammer prop effect is null"),void("function"==typeof i&&i());null==n.getParent()&&e.viewRoot.addChild(n,GameDataConfig.ZOrder.PROP),this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount(),n.setOpacity(255),n.setPosition(e.position),n.play(function(){this._reduceExecutingEffectLogicCount(),"function"==typeof t&&t()}.bind(this),function(e){AnimationCacheManager.cacheEffect(EffectCacheType.HAMMER_PROP,e),this._reducePlayingEffectCount(),"function"==typeof i&&i()}.bind(this))},playGhostAbsorbEffect:function(e){var t=AnimationCacheManager.getEffect(EffectCacheType.GHOST_ABSORB_EFFECT).effect;null!=t?(null==t.getParent()&&e.viewRoot.addChild(t,GameDataConfig.ZOrder.GHOST_ABSORB),t.setPosition(e.position),t.setOpacity(255),t.play(),this._ghostAbsorbEffectList.push(t)):console.log("ghost absorb effect is null")},playGhostSingEffect:function(e){var t=AnimationCacheManager.getEffect(EffectCacheType.GHOST_SING_EFFECT).effect;null!=t?(null==t.getParent()&&e.viewRoot.addChild(t,GameDataConfig.ZOrder.GHOST_SING),t.setPosition(e.position),t.setOpacity(255),t.play(),this._ghostSingEffectList.push(t)):console.log("ghost sing effect is null")},playCrushEffect:function(e,t){var i=GameDataConfig.CrushEffectConfig[e.chessType];if(null!=i)switch(e.bNeedCalcExecutingEffectLogicCount=i.bNeedCalcExecutingEffectLogicCount,e.zOrder=i.zOrder,i.crushType){case GameDataConfig.CrushType.ANIMAL_CHESS:e.bLastPang?this._playAnimalLastPangCrushEffect(e,t):this._playAnimalOriginalCrushEffect(e,t);break;case GameDataConfig.CrushType.BOMB_CHESS:this._playBombChessCrushEffect(e,t);break;case GameDataConfig.CrushType.TYPE_CRUSH:this._playTypeCrushEffect(e,t);break;case GameDataConfig.CrushType.FLY_COLLECT:this._playCollectCrushEffect(e,t)}},playShockWaveEffect:function(e,t){var i=AnimationCacheManager.getEffect(EffectCacheType.SHOCK_WAVE_EFFECT).effect;if(null==i)return console.log("shock wave effect is null"),void("function"==typeof t&&t());this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount(),null==i.getParent()&&e.viewRoot.addChild(i,GameDataConfig.ZOrder.SHOCK_WAVE),i.setOpacity(255),i.setPosition(e.position),i.setDirection(e.bHorizontal),i.play(function(e){AnimationCacheManager.cacheEffect(EffectCacheType.SHOCK_WAVE_EFFECT,e),this._reduceExecutingEffectLogicCount(),this._reducePlayingEffectCount(),"function"==typeof t&&t()}.bind(this))},playGhostApertureEffect:function(e,t){var i=AnimationCacheManager.getEffect(EffectCacheType.GHOST_APERTUR_EEFFECT).effect;if(null==i)return console.log("ghost aperture effect is null"),void("function"==typeof t&&t());this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount(),null==i.getParent()&&e.viewRoot.addChild(i,GameDataConfig.ZOrder.GHOST_APERTURE),i.setOpacity(255),i.setPosition(e.position),i.play(function(e){AnimationCacheManager.cacheEffect(EffectCacheType.GHOST_APERTUR_EEFFECT,e),this._reduceExecutingEffectLogicCount(),this._reducePlayingEffectCount(),"function"==typeof t&&t()}.bind(this))},playChessDividedEffect:function(e,t){var i=AnimationCacheManager.getEffect(EffectCacheType.DIVIDED_EFFECT,{tag:e.chessType,chessType:e.chessType}).effect;if(null==i)return console.log("chess divided effect is null"),void("function"==typeof t&&t());this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount(),null==i.getParent()&&e.viewRoot.addChild(i,GameDataConfig.ZOrder.DIVIDE);var n=this;function a(e){null!=e&&(AnimationCacheManager.cacheEffect(EffectCacheType.DIVIDED_EFFECT,e),n._reduceExecutingEffectLogicCount(),n._reducePlayingEffectCount())}e.chess.onDividedEffectStartPlay(i,a),i.setPosition(e.position),i.setOpacity(255),i.play(function(i){a(i),e.chess.onDividedEffectPlayComplete(),"function"==typeof t&&t()}.bind(this))},playChessDivideEffect:function(e,t){var i=GameDataConfig.ChessDivideEffectConfig[e.chessType];if(null==i)return console.log("find ChessDivideEffectConfig fail : "+e.chessType),void("function"==typeof t&&t());var n=AnimationCacheManager.getEffect(EffectCacheType.DIVIDE_EFFECT,{tag:e.chessType,chessType:e.chessType}).effect;if(null==n)return console.log("chess divide effect is null"),void("function"==typeof t&&t());this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount(),null==n.getParent()&&e.viewRoot.addChild(n,GameDataConfig.ZOrder.DIVIDE),n.setPosition(e.position),n.setOpacity(255),n.play(function(e){AnimationCacheManager.cacheEffect(EffectCacheType.DIVIDE_EFFECT,e),this._reduceExecutingEffectLogicCount(),this._reducePlayingEffectCount()}.bind(this));var a=null!=i.divideChessDelayTime?i.divideChessDelayTime:n.getDuration()/FRAME_SECOND*1e3;Timeout.registerEx(function(){"function"==typeof t&&t()},a)},playChessMoveEffect:function(e){if(null!=GameDataConfig.ChessMoveEffectConfig[e.chessType]){var t=AnimationCacheManager.getEffect(EffectCacheType.MOVE_EFFECT,{tag:e.chessType,chessType:e.chessType}).effect;if(null!=t){this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount(),null==t.getParent()&&e.viewRoot.addChild(t,GameDataConfig.ZOrder.MOVE);i=this;e.chess.onMoveEffectStartPlay(t,n),t.setOpacity(255),t.play(e.fromPosition,e.toPosition),e.chessMoveCompleteCallBack=function(){n(t),e.chess.onMoveEffectPlayComplete()}}else console.log("chess move effect is null")}else{this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount();var i=this;e.chessMoveCompleteCallBack=function(){i._reduceExecutingEffectLogicCount(),i._reducePlayingEffectCount()}}function n(e){null!=e&&(AnimationCacheManager.cacheEffect(EffectCacheType.MOVE_EFFECT,e),i._reduceExecutingEffectLogicCount(),i._reducePlayingEffectCount())}},onRearrangeChessTipEffectPlayComplete:function(){this._updateFrameRate(GameDataConfig.GAME_SCENE_FRAME_RATE)},onAllChessRearrangeComplete:function(){this._updateFrameRate(GameDataConfig.ORIGINAL_FRAME_RATE)},onChessBoardWaitScroll:function(e){this._increaseWaitChessBoardStableCount(),this._waitChessBoardStableFunList.push(e)},onChessBoardDoScroll:function(){this._reduceWaitChessBoardStableCount()},onStartScrollChessBoard:function(){this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount()},onScrollChessBoardComplete:function(){this._reduceExecutingEffectLogicCount(),this._reducePlayingEffectCount()},onChessMoveScale:function(e){this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount();var t=this;e.chessMoveScaleCompleteCallBack=function(){t._reduceExecutingEffectLogicCount(),t._reducePlayingEffectCount()}},onChessTranslate:function(e){this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount();var t=this;e.chessTranslateCompleteCallBack=function(){t._reduceExecutingEffectLogicCount(),t._reducePlayingEffectCount()}},onTriggerSwapPropFail:function(){this._removeSwapPropApertureEffect()},onStartRearrangeChess:function(){this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount()},onRearrangeChessComplete:function(){this._reduceExecutingEffectLogicCount(),this._reducePlayingEffectCount()},onChessWaitDivide:function(e){this._increaseWaitChessBoardStableCount(),this._waitChessBoardStableFunList.push(e)},onChessDoDivide:function(){this._reduceWaitChessBoardStableCount()},onChessWaitMove:function(e){this._increaseWaitChessBoardStableCount(),this._waitChessBoardStableFunList.push(e)},onChessDoMove:function(){this._reduceWaitChessBoardStableCount()},onChessWaitTranslate:function(e){this._increaseWaitChessBoardStableCount(),this._waitChessBoardStableFunList.push(e)},onChessDoTranslate:function(){this._reduceWaitChessBoardStableCount()},onChessWaitMoveScale:function(e){this._increaseWaitChessBoardStableCount(e),this._waitChessBoardStableFunList.push(e)},onChessDoMoveScale:function(){this._reduceWaitChessBoardStableCount()},onChessStartDrop:function(){this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount()},onChessDropComplete:function(e){this._reduceExecutingEffectLogicCount(),this._reducePlayingEffectCount();var t=GameDataConfig.DropEffectConfig[e.chessType];if(null!=t)switch(t.dropType){case GameDataConfig.DropType.ANIMAL_CHESS:this._playAnimalChessDropEffect(e);break;case GameDataConfig.DropType.GLASSES_CHESS:this._playGlassesChessDropEffect(e);break;case GameDataConfig.DropType.BOMB_CHESS:this._playBombChessDropEffect(e);break;case GameDataConfig.DropType.TYPE_DROP:this._playTypeDropEffect(e);break;default:console.log("unKnown dropType : "+t.dropType)}else console.log("find DropEffectConfig fail : "+e.chessType)},onStartSwapChess:function(){this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount()},onSwapChessComplete:function(){this._reduceExecutingEffectLogicCount(),this._reducePlayingEffectCount()},onStartAbsorbChess:function(){this._ghostAbsorbEffectCount++,this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount()},onAbsorbChessComplete:function(){this._ghostAbsorbEffectCount--,0==this._ghostAbsorbEffectCount&&this._hideGhostAbsorbEffect(),this._reduceExecutingEffectLogicCount(),this._reducePlayingEffectCount()},onGasChess2SpecialChessEffectFinish:function(){this._hideGhostAbsorbEffect(),this._hideGhostSingEffect()},getAnimationTaskHandler:function(){return this._animationTaskHandler},_playAnimalChessDropEffect:function(e){var t=AnimationCacheManager.getEffect(EffectCacheType.ANIMAL_CHESS_DROP_EFFECT).effect;null!=t?this._playOrdinaryDropEffect(e,t,function(e){AnimationCacheManager.cacheEffect(EffectCacheType.ANIMAL_CHESS_DROP_EFFECT,e)}):console.log("animal chess drop effect is null")},_playBombChessDropEffect:function(e){var t=AnimationCacheManager.getEffect(EffectCacheType.BOMB_CHESS_DROP_EFFECT).effect;null!=t?this._playOrdinaryDropEffect(e,t,function(e){AnimationCacheManager.cacheEffect(EffectCacheType.BOMB_CHESS_DROP_EFFECT,e)}):console.log("bomb chess drop effect is null")},_playGlassesChessDropEffect:function(e){var t=AnimationCacheManager.getEffect(EffectCacheType.GLASSES_CHESS_DROP_EFFECT).effect;null!=t?this._playOrdinaryDropEffect(e,t,function(e){AnimationCacheManager.cacheEffect(EffectCacheType.GLASSES_CHESS_DROP_EFFECT,e)}):console.log("glasses chess drop effect is null")},_playOrdinaryDropEffect:function(e,t,i){this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount(),null==t.getParent()&&e.viewRoot.addChild(t,e.dropEffectZOrder);var n=this;function a(e){null!=e&&(i(e),n._reducePlayingEffectCount())}e.chess.onDropEffectStartPlay(t,a),t.setPosition(e.position.x,e.position.y-e.chessSize.height/2),t.setColorType(e.colorType),t.setOpacity(255),t.play(function(t){a(t),e.chess.onDropEffectPlayComplete()}.bind(this)),Timeout.registerEx(function(){this._reduceExecutingEffectLogicCount()}.bind(this),GameDataConfig.CHESS_DROP_EFFECT_DELAY_TIME)},_playTypeDropEffect:function(e){var t=AnimationCacheManager.getEffect(EffectCacheType.TYPE_DROP_EFFECT,{tag:e.chessType,chessType:e.chessType}).effect;if(null!=t){this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount(),null==t.getParent()&&e.viewRoot.addChild(t,e.dropEffectZOrder);var i=this;e.chess.onDropEffectStartPlay(t,n),t.setPosition(e.position),t.setOpacity(255),t.play(function(t){n(t),e.chess.onDropEffectPlayComplete()}.bind(this)),Timeout.registerEx(function(){this._reduceExecutingEffectLogicCount()}.bind(this),GameDataConfig.CHESS_DROP_EFFECT_DELAY_TIME)}else console.log("type drop effect is null");function n(e){null!=e&&(AnimationCacheManager.cacheEffect(EffectCacheType.TYPE_DROP_EFFECT,e),i._reducePlayingEffectCount())}},_playGuideSwapChessApertureEffect:function(e){this._guideSwapChessApertureEffectList=this._guideSwapChessApertureEffectList||[];for(var t=e.crushPositionList,i=0,n=t.length;i<n;i++){var a=AnimationCacheManager.getEffect(EffectCacheType.GUIDE_SWAP_CHESS_APERTUR_EEFFECT).effect;if(null==a)return void console.log("guide swap chess aperture effect is null");null==a.getParent()&&e.viewRoot.addChild(a,GameDataConfig.ZOrder.SWAP_CHESS_APERTURE),a.setOpacity(255),a.setPosition(t[i]),a.play(),this._guideSwapChessApertureEffectList.push(a)}},_playAnimalOriginalCrushEffect:function(e,t){var i=AnimationCacheManager.getEffect(EffectCacheType.ANIMAL_ORIGINAL_CRUSH_EFFECT).effect;if(null==i)return console.log("animal original crush effect is null"),void("function"==typeof t&&t());e.bNeedCalcExecutingEffectLogicCount&&this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount(),null==i.getParent()&&i.setParent(e.viewRoot),i.setColorType(e.colorType),i.setPosition(e.position),i.setOpacity(255),i.play(function(e){AnimationCacheManager.cacheEffect(EffectCacheType.ANIMAL_ORIGINAL_CRUSH_EFFECT,e),this._reducePlayingEffectCount(),"function"==typeof t&&t()}.bind(this)),Timeout.registerEx(function(){e.bNeedCalcExecutingEffectLogicCount&&this._reduceExecutingEffectLogicCount()}.bind(this),GameDataConfig.ANIMAL_ORIGINAL_CRUSH_EFFECT_DELAY_TIME)},_playBombChessCrushEffect:function(e,t){var i=AnimationCacheManager.getEffect(EffectCacheType.BOMB_CHESS_CRUSH_EFFECT).effect;if(null==i)return console.log("bomb chess crush effect is null"),void("function"==typeof t&&t());e.bNeedCalcExecutingEffectLogicCount&&this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount(),null==i.getParent()&&i.setParent(e.viewRoot),i.setColorType(e.colorType),i.setPosition(e.position),i.setOpacity(255),i.play(function(e){AnimationCacheManager.cacheEffect(EffectCacheType.BOMB_CHESS_CRUSH_EFFECT,e),this._reducePlayingEffectCount(),"function"==typeof t&&t()}.bind(this)),Timeout.registerEx(function(){e.bNeedCalcExecutingEffectLogicCount&&this._reduceExecutingEffectLogicCount()}.bind(this),GameDataConfig.BOMB_CRUSH_EFFECT_DELAY_TIME)},_playAnimalLastPangCrushEffect:function(e,t){var i=AnimationCacheManager.getEffect(EffectCacheType.ANIMAL_LAST_PANG_CRUSH_EFFECT).effect;if(null==i)return console.log("animal lastpang crush effect is null"),void("function"==typeof t&&t());this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount(),null==i.getParent()&&e.viewRoot.addChild(i,GameDataConfig.ZOrder.CRUSH),i.setColorType(e.colorType),i.setPosition(e.position),i.setOpacity(255),i.play(function(e){AnimationCacheManager.cacheEffect(EffectCacheType.ANIMAL_LAST_PANG_CRUSH_EFFECT,e),this._reducePlayingEffectCount(),"function"==typeof t&&t()}.bind(this)),Timeout.registerEx(function(){this._reduceExecutingEffectLogicCount()}.bind(this),GameDataConfig.ANIMAL_LAST_PANG_CRUSH_EFFECT_DELAY_TIME)},_playTypeCrushEffect:function(e,t){var i=AnimationCacheManager.getEffect(EffectCacheType.TYPE_CRUSH_EFFECT,{tag:e.chessType,chessType:e.chessType}).effect;if(null==i)return console.log("type crush effect is null"),void("function"==typeof t&&t());e.bNeedCalcExecutingEffectLogicCount&&this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount();var n=void 0!==e.zOrder?e.zOrder:GameDataConfig.ZOrder.CRUSH;null==i.getParent()&&e.viewRoot.addChild(i,n),i.setPosition(e.position),i.setOpacity(255),i.setColorType(e.colorType),i.play(function(i){AnimationCacheManager.cacheEffect(EffectCacheType.TYPE_CRUSH_EFFECT,i),e.bNeedCalcExecutingEffectLogicCount&&this._reduceExecutingEffectLogicCount(),this._reducePlayingEffectCount(),"function"==typeof t&&t()}.bind(this))},_playCollectCrushEffect:function(e,t){var i=AnimationCacheManager.getEffect(EffectCacheType.COLLECT_CRUSH_EFFECT,{tag:e.chessType,chessType:e.chessType}).effect;if(null==i)return console.log("collect crush effect is null"),void("function"==typeof t&&t());e.bNeedCalcExecutingEffectLogicCount&&this._increaseExecutingEffectLogicCount(),this._increasePlayingEffectCount(),null==i.getParent()&&e.viewRoot.addChild(i,GameDataConfig.ZOrder.COLLECT),i.setPosition(e.position),i.setOpacity(255),i.play(function(e){AnimationCacheManager.cacheEffect(EffectCacheType.COLLECT_CRUSH_EFFECT,e),"function"==typeof t&&t();var i={};i.position=e.getPosition(),i.chessType=e.getTag(),i.viewRoot=e.getParent(),this._playCollectFlyEffect(i),i.bNeedCalcExecutingEffectLogicCount&&this._reduceExecutingEffectLogicCount(),this._reducePlayingEffectCount()}.bind(this))},_playCollectFlyEffect:function(e,t){if(null!=this._collectPositionMap[e.chessType]){var i=AnimationCacheManager.getEffect(EffectCacheType.COLLECT_FLY_EFFECT,{tag:e.chessType,chessType:e.chessType}).effect;if(null==i)return console.log("collect fly effect is null"),void("function"==typeof t&&t());e.viewRoot=this._collectLayer,e.bNeedCalcExecutingEffectLogicCount&&this._increaseExecutingEffectLogicCount(),null==i.getParent()&&e.viewRoot.addChild(i,GameDataConfig.ZOrder.COLLECT),i.setPosition(e.position),i.setOpacity(255);var n=this._collectPositionMap[e.chessType].position;i.play(n,function(e){AnimationCacheManager.cacheEffect(EffectCacheType.COLLECT_FLY_EFFECT,e),"function"==typeof t&&t();var i={};i.position=e.getPosition(),i.chessType=e.getTag(),i.viewRoot=e.getParent(),this._playCollectGetEffect(i),i.bNeedCalcExecutingEffectLogicCount&&this._reduceExecutingEffectLogicCount()}.bind(this))}else"function"==typeof t&&t()},_playCollectGetEffect:function(e,t){var i=AnimationCacheManager.getEffect(EffectCacheType.COLLECT_GET_EFFECT,{tag:e.chessType,chessType:e.chessType}).effect;if(null==i)return console.log("collect get effect is null"),void("function"==typeof t&&t());null==i.getParent()&&e.viewRoot.addChild(i,GameDataConfig.ZOrder.COLLECT),i.setPosition(e.position),i.setOpacity(255),i.play(function(e){AnimationCacheManager.cacheEffect(EffectCacheType.COLLECT_GET_EFFECT,e),"function"==typeof t&&t()}.bind(this))},_playSwapPropFlashOfLightEffect:function(e,t,i,n){var a=AnimationCacheManager.getEffect(EffectCacheType.SWAP_PROP_FLASH_OF_LIGHT_EFFECT).effect;if(null==a)return console.log("swap prop flash of light effect is null"),"function"==typeof t&&t(),"function"==typeof i&&i(),void("function"==typeof n&&n());null==a.getParent()&&e.viewRoot.addChild(a,GameDataConfig.ZOrder.PROP),a.setPosition(e.position),a.setOpacity(255),a.play(function(e){"function"==typeof t&&t(e)}.bind(this),function(e){"function"==typeof i&&i(e)}.bind(this),function(e){AnimationCacheManager.cacheEffect(EffectCacheType.SWAP_PROP_FLASH_OF_LIGHT_EFFECT,e),"function"==typeof n&&n()}.bind(this))},_hideGhostAbsorbEffect:function(){if(Util.isArray(this._ghostAbsorbEffectList))for(var e=0,t=this._ghostAbsorbEffectList.length;e<t;e++){var i=this._ghostAbsorbEffectList[e];i.onHide(),AnimationCacheManager.cacheEffect(EffectCacheType.GHOST_ABSORB_EFFECT,i)}this._ghostAbsorbEffectList=[]},_hideGhostSingEffect:function(){if(Util.isArray(this._ghostSingEffectList))for(var e=0,t=this._ghostSingEffectList.length;e<t;e++){var i=this._ghostSingEffectList[e];i.onHide(),AnimationCacheManager.cacheEffect(EffectCacheType.GHOST_SING_EFFECT,i)}this._ghostSingEffectList=[]},_reduceExecutingEffectLogicCount:function(){this._executingEffectLogicCount--},_increaseExecutingEffectLogicCount:function(){this._executingEffectLogicCount++},_reducePlayingEffectCount:function(){this._playingEffectCount--},_increasePlayingEffectCount:function(){this._playingEffectCount++},_reduceWaitChessBoardStableCount:function(){this._waitChessBoardStableCount--},_increaseWaitChessBoardStableCount:function(){this._waitChessBoardStableCount++},_releaseList:function(e){if(null!=e){for(var t=0,i=e.length;t<i;t++){var n=e[t];n&&n.removeFromParent&&n.removeFromParent()}e.length=0}},_removeSwapPropApertureEffect:function(){if(Util.isArray(this._swapPropApertureEffectList))for(var e=0,t=this._swapPropApertureEffectList.length;e<t;e++){var i=this._swapPropApertureEffectList[e];AnimationCacheManager.cacheEffect(EffectCacheType.SWAP_PROP_APERTURE_EFFECT,i)}this._swapPropApertureEffectList=[]},_onAnimationQueueUpdateWorkerModel:function(e){if(0==this._playingEffectCount&&0!=this._waitChessBoardStableFunList.length){for(var t=0,i=this._waitChessBoardStableFunList.length;t<i;t++){var n=this._waitChessBoardStableFunList[t];"function"==typeof n&&n()}this._waitChessBoardStableFunList=[]}if(0==this._executingEffectLogicCount&&!this._animationTaskHandler.isHaveTaskRunning()&&0==this._waitChessBoardStableFunList.length){var a=puzzleGame.getAnimation();if(null==a)this._bPlayedEffect&&0==this._playingEffectCount&&0==this._waitChessBoardStableCount&&(this._executingEffectLogicCount=0,this._bPlayedEffect=!1,puzzleGame.eventManager.trigger("ON_ONE_BATCH_ANIMATION_PLAY_COMPLETE"),AnimationManager.isAnimationQueueEmpty()&&this._updateFrameRate(GameDataConfig.ORIGINAL_FRAME_RATE));else{this._bPlayedEffect=!0;var o=this._isHaveDropAnimation(a);puzzleGame.eventManager.trigger("START_ANIMATION",a),this._updateFrameRate(GameDataConfig.GAME_SCENE_FRAME_RATE),o&&(this._hideGhostSingEffect(),this._hideGhostAbsorbEffect(),puzzleGame.continue_(),puzzleGame.getGameStatus(function(e){}))}}},_onAnimationQueueUpdate:function(e){if(0==this._playingEffectCount&&0!=this._waitChessBoardStableFunList.length){for(var t=0,i=this._waitChessBoardStableFunList.length;t<i;t++){var n=this._waitChessBoardStableFunList[t];"function"==typeof n&&n()}this._waitChessBoardStableFunList=[]}if(0==this._executingEffectLogicCount&&!this._animationTaskHandler.isHaveTaskRunning()&&0==this._waitChessBoardStableFunList.length){if(puzzleGame.getAnimationNum()>0){var a=puzzleGame.getAnimationQueue(),o=a[a.length-1],c=this._isHaveDropAnimation(o);if(this._bNeedCallContinueOnAnimationComplete=!c,!c){o=a[0];var f=this._isSwapFailAnimation(o);if(this._bNeedCallContinueOnAnimationComplete=!f,!f){var s=this._isRerrangeAnimation(o);this._bNeedCallContinueOnAnimationComplete=!s}}}if(null==(o=puzzleGame.getAnimation()))this._bPlayedEffect&&0==this._playingEffectCount&&0==this._waitChessBoardStableCount&&(this._executingEffectLogicCount=0,this._bPlayedEffect=!1,puzzleGame.eventManager.trigger("ON_ONE_BATCH_ANIMATION_PLAY_COMPLETE"),AnimationManager.isAnimationQueueEmpty()&&this._updateFrameRate(GameDataConfig.ORIGINAL_FRAME_RATE));else{this._bPlayedEffect=!0;var u=this._isHaveDropAnimation(o);puzzleGame.eventManager.trigger("START_ANIMATION",o),this._updateFrameRate(GameDataConfig.GAME_SCENE_FRAME_RATE),u&&(this._hideGhostSingEffect(),this._hideGhostAbsorbEffect(),puzzleGame.continue_(),puzzleGame.getGameStatus(function(e){LogPanel.addInfo("continue(drop)("+e+")")}))}}},_updateFrameRate:function(e){this.lastFrameRate!=e&&(this.lastFrameRate=e,GameUtil.registerNextFrameCall(function(){cc.game.setFrameRate(e)}))},_isHaveDropAnimation:function(e){for(var t=0,i=e.length;t<i;t++){switch(e[t].animation_id){case RemoveLogic.we4Proto.AnimationId.drop:return!0}}return!1},_isSwapFailAnimation:function(e){for(var t=0,i=e.length;t<i;t++){var n=e[t];switch(n.animation_id){case RemoveLogic.we4Proto.AnimationId.swap:return n.result!=RemoveLogic.we4Proto.SlideResult.kSwap}}return!1},_isRerrangeAnimation:function(e){for(var t=0,i=e.length;t<i;t++){switch(e[t].animation_id){case RemoveLogic.we4Proto.AnimationId.itemRearrange:return!0}}return!1},_onUseProp:function(){}};
var AnimalDisappearEffect=Effect.extend({_animalColorType:null,ctor:function(){this._super(res.disappearAction_json),this._animalColorType=RemoveLogic.we4Proto.ChessColor.kChessColorYellow},play:function(e){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof e&&e(this)}.bind(this))},setColorType:function(e){if(this._animalColorType!=e){e==RemoveLogic.we4Proto.ChessColor.kChessColorRandom&&(e=Util.getRandom(0,e-1)),this._animalColorType=e;var o=GameDataConfig.AnimalCrushEffectConfig[e].image1,i=GameDataConfig.AnimalCrushEffectConfig[e].image2;UIHelper.seekWidgetByName(this._node,"image1",NodeType.SPRITE).setSpriteFrame(o);UIHelper.seekWidgetByName(this._node,"image2",NodeType.SPRITE).setSpriteFrame(i)}}});
var AnimalLastPangCrushEffect=cc.Node.extend({_disappearEffect:null,_bombEffect:null,_startEffect:null,ctor:function(){this._super(),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0);this._bombEffect=new AnimalOriginalCrushBgEffect,this._bombEffect.setTimeSpeed(.7),this.addChild(this._bombEffect),this._startEffect=new AnimalLastPangCrushBgEffect,this._startEffect.setTimeSpeed(.7),this.addChild(this._startEffect),this._disappearEffect=new AnimalDisappearEffect,this._disappearEffect.setTimeSpeed(.7),this.addChild(this._disappearEffect)},pause:function(){this._bombEffect.pause(),this._startEffect.pause(),this._disappearEffect.pause()},play:function(t){this._bombEffect.play(function(){this._checkDoCallBack(t)}.bind(this)),this._startEffect.play(function(){this._checkDoCallBack(t)}.bind(this)),this._disappearEffect.play(function(){this._checkDoCallBack(t)}.bind(this))},setColorType:function(t){this._disappearEffect.setColorType(t)},_checkDoCallBack:function(t){this._startEffect.isPlayComplete()&&this._bombEffect.isPlayComplete()&&this._disappearEffect.isPlayComplete()&&"function"==typeof t&&t(this)}}),AnimalLastPangCrushBgEffect=Effect.extend({ctor:function(){this._super(res.boomeffects_json)},play:function(t){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof t&&t(this)}.bind(this))}});
var AnimalOriginalCrushEffect=cc.Class.extend({_disappearEffect:null,_bombEffect:null,_tag:null,_parent:null,ctor:function(){var t=GameDataConfig.CRUSH_EFFECT_TIME_SPEED;this._bombEffect=new AnimalOriginalCrushBgEffect,this._bombEffect.setTimeSpeed(t),this._disappearEffect=new AnimalDisappearEffect,this._disappearEffect.setTimeSpeed(t)},pause:function(){this._bombEffect.pause(),this._disappearEffect.pause()},getParent:function(){return this._parent},setParent:function(t){this._parent!=t&&(this._parent=t),null!=t?(t.addChild(this._bombEffect,GameDataConfig.ZOrder.CRUSH),t.addChild(this._disappearEffect,GameDataConfig.ZOrder.DISAPPEAR_EFFECT)):(this._bombEffect.setParent(null),this._disappearEffect.setParent(null))},setPosition:function(t){this._bombEffect.setPosition(t),this._disappearEffect.setPosition(t)},setOpacity:function(t){this._bombEffect.setOpacity(t),this._disappearEffect.setOpacity(t)},setTag:function(t){this._tag=t},getTag:function(){return this._tag},play:function(t){this._bombEffect.play(function(){this._checkDoCallBack(t)}.bind(this)),this._disappearEffect.play(function(){this._checkDoCallBack(t)}.bind(this))},setColorType:function(t){this._disappearEffect.setColorType(t)},_checkDoCallBack:function(t){this._bombEffect.isPlayComplete()&&this._disappearEffect.isPlayComplete()&&"function"==typeof t&&t(this)}}),AnimalOriginalCrushBgEffect=Effect.extend({ctor:function(){this._super(res.boomAction_json)},play:function(t){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof t&&t(this)}.bind(this))}});
var BombChessClickEffect=cc.Node.extend({_ordinaryChessClickEffect:null,_glassesClickEffect:null,ctor:function(){this._super(),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),this._ordinaryChessClickEffect=new OrdinaryChessClickEffect,this.addChild(this._ordinaryChessClickEffect),this._glassesClickEffect=new BombChessGlassesClickEffect,this.addChild(this._glassesClickEffect)},pause:function(){this._ordinaryChessClickEffect.pause(),this._glassesClickEffect.pause()},setColorType:function(s){this._ordinaryChessClickEffect.setColorType(s),this._glassesClickEffect.setColorType(s)},play:function(s){this._ordinaryChessClickEffect.play(function(){this._checkDoCallBack(s)}.bind(this)),this._glassesClickEffect.play(function(){this._checkDoCallBack(s)}.bind(this))},gotoLastFrame:function(){this._ordinaryChessClickEffect.gotoLastFrame(),this._glassesClickEffect.gotoLastFrame()},_checkDoCallBack:function(s){this._ordinaryChessClickEffect.isPlayComplete()&&this._glassesClickEffect.isPlayComplete()&&"function"==typeof s&&s(this)}}),BombChessGlassesClickEffect=Effect.extend({ctor:function(){this._super(res.noseclickAction_json)},setColorType:function(s){var t=GameDataConfig.BombChessConfig[s],e=null!=t&&null!=t.clickEffect?t.clickEffect.y:0;this.setPositionY(e)},play:function(s){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof s&&s(this)}.bind(this))}});
var BombChessCrushEffect=cc.Class.extend({_disappearEffect:null,_bombEffect:null,_tag:null,_parent:null,ctor:function(){var t=GameDataConfig.CRUSH_EFFECT_TIME_SPEED;this._bombEffect=new BoomChessCrushBgEffect,this._bombEffect.setTimeSpeed(t),this._disappearEffect=new AnimalDisappearEffect,this._disappearEffect.setTimeSpeed(t)},pause:function(){this._bombEffect.pause(),this._disappearEffect.pause()},getParent:function(){return this._parent},setParent:function(t){this._parent!=t&&(this._parent=t),null!=t?(t.addChild(this._bombEffect,GameDataConfig.ZOrder.CRUSH),t.addChild(this._disappearEffect,GameDataConfig.ZOrder.DISAPPEAR_EFFECT)):(this._bombEffect.setParent(null),this._disappearEffect.setParent(null))},setPosition:function(t){this._bombEffect.setPosition(t),this._disappearEffect.setPosition(t)},setOpacity:function(t){this._bombEffect.setOpacity(t),this._disappearEffect.setOpacity(t)},setTag:function(t){this._tag=t},getTag:function(){return this._tag},play:function(t){this._bombEffect.play(function(){this._checkDoCallBack(t)}.bind(this)),this._disappearEffect.play(function(){this._checkDoCallBack(t)}.bind(this))},setColorType:function(t){this._disappearEffect.setColorType(t)},_checkDoCallBack:function(t){this._bombEffect.isPlayComplete()&&this._disappearEffect.isPlayComplete()&&"function"==typeof t&&t(this)}}),BoomChessCrushBgEffect=Effect.extend({ctor:function(){this._super(res.glassboomAction_json)},play:function(t){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof t&&t(this)}.bind(this))}});
var BombChessDropEffect=cc.Node.extend({_ordinaryChessDropEffect:null,_bombChessGlassesDropEffect:null,ctor:function(){this._super(),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),this._ordinaryChessDropEffect=new OrdinaryChessDropEffect,this.addChild(this._ordinaryChessDropEffect),this._bombChessGlassesDropEffect=new BombChessGlassesDropEffect,this.addChild(this._bombChessGlassesDropEffect)},pause:function(){this._ordinaryChessDropEffect.pause(),this._bombChessGlassesDropEffect.pause()},play:function(s){this._ordinaryChessDropEffect.play(function(){this._checkDoCallBack(s)}.bind(this)),this._bombChessGlassesDropEffect.play(function(){this._checkDoCallBack(s)}.bind(this))},setColorType:function(s){this._bombChessGlassesDropEffect.setColorType(s),this._ordinaryChessDropEffect.setColorType(s)},_checkDoCallBack:function(s){this._ordinaryChessDropEffect.isPlayComplete()&&this._bombChessGlassesDropEffect.isPlayComplete()&&"function"==typeof s&&s(this)}}),BombChessGlassesDropEffect=Effect.extend({ctor:function(){this._super(res.nosedropAction_json)},setColorType:function(s){var e=GameDataConfig.BombChessConfig[s],t=null!=e&&null!=e.dropEffect?e.dropEffect.y:0;this.setPositionY(t)},play:function(s){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof s&&s(this)}.bind(this))}});
var ChessAttackedEffect=Effect.extend({ctor:function(t){var e=GameDataConfig.ChessAttackedEffectConfig[t],f=null!=e?e.effectPath:"";this._super(f)},play:function(t,e){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof e&&e(this)}.bind(this))}});
var ChessChangeEffect=Effect.extend({ctor:function(t){var e=GameDataConfig.ChessChangeEffectConfig[t],f=null!=e?e.effectPath:"";this._super(f)},play:function(t){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof t&&t(this)}.bind(this))}});
var ChessDevouredEffect=Effect.extend({_devouredEffect:null,ctor:function(e){var t=GameDataConfig.ChessDevouredEffectConfig[e],f=null!=t?t.effectPath:"";this._super(f)},play:function(e){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof e&&e(this)}.bind(this))}});
var ChessDividedEffect=Effect.extend({ctor:function(t){var e=GameDataConfig.ChessDividedEffectConfig[t],i=null!=e?e.effectPath:"";this._super(i)},play:function(t){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof t&&t(this)}.bind(this))}});
var ChessDivideEffect=Effect.extend({ctor:function(t){var e=GameDataConfig.ChessDivideEffectConfig[t],i=null!=e?e.effectPath:"";this._super(i)},play:function(t){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof t&&t(this)}.bind(this))}});
var ChessMoveEffect=Effect.extend({ctor:function(e){var t=GameDataConfig.ChessMoveEffectConfig[e],n=null!=t?t.effectPath:"";this._super(n)},play:function(e,t){this._super(!0),this.setPosition(e);var n=cc.pDistance(e,t)/GameDataConfig.CHESS_MOVE_SPEED,c=new cc.MoveTo(n,t);this.runAction(c)}});
var CollectBearEffect=Effect.extend({_chessType:null,ctor:function(e){this._chessType=e,this._super(res.hellokittyaction_json),this.setScale(.6)},play:function(e,t){this._super(!1),Timeout.register(function(){var c=cc.pDistance(e,this.getPosition())/(GameDataConfig.COLLECT_MOVE_SPEED+150),i=new cc.MoveTo(c,e),n=new cc.CallFunc(function(){"function"==typeof t&&t(this)}.bind(this)),s=new cc.Sequence(i,n);this.runAction(s),MusicManager.playEffect(MusicEffectFiles.Audio_G_abaorelease)}.bind(this),1500)}});
var DevourChessEffect=Effect.extend({ctor:function(t){var e=GameDataConfig.ChessDevourEffectConfig[t],f=null!=e?e.effectPath:"";this._super(f)},play:function(t,e){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof e&&e(this)}.bind(this))}});
var DirectionChessClickEffect=cc.Node.extend({_ordinaryChessClickEffect:null,_directionChessGlassesClickEffect:null,ctor:function(){this._super(),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),this._ordinaryChessClickEffect=new OrdinaryChessClickEffect,this.addChild(this._ordinaryChessClickEffect),this._directionChessGlassesClickEffect=new DirectionChessGlassesClickEffect,this.addChild(this._directionChessGlassesClickEffect)},pause:function(){this._ordinaryChessClickEffect.pause(),this._directionChessGlassesClickEffect.pause()},play:function(s){this._ordinaryChessClickEffect.play(function(){this._checkDoCallBack(s)}.bind(this)),this._directionChessGlassesClickEffect.play(function(){this._checkDoCallBack(s)}.bind(this))},setColorType:function(s){this._directionChessGlassesClickEffect.setColorType(s),this._ordinaryChessClickEffect.setColorType(s)},gotoLastFrame:function(){this._ordinaryChessClickEffect.gotoLastFrame(),this._directionChessGlassesClickEffect.gotoLastFrame()},_checkDoCallBack:function(s){this._ordinaryChessClickEffect.isPlayComplete()&&this._directionChessGlassesClickEffect.isPlayComplete()&&"function"==typeof s&&s(this)}}),DirectionChessGlassesClickEffect=Effect.extend({ctor:function(){this._super(res.glassclickAction_json)},setColorType:function(s){var i=GameDataConfig.DirectionChessConfig[s],e=null!=i&&null!=i.clickEffect?i.clickEffect.y:0;this.setPositionY(e)},play:function(s){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof s&&s(this)}.bind(this))}});
var DirectionChessDropEffect=cc.Node.extend({_ordinaryChessDropEffect:null,_glassDropEffect:null,ctor:function(){this._super(),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),this._ordinaryChessDropEffect=new OrdinaryChessDropEffect,this.addChild(this._ordinaryChessDropEffect),this._glassDropEffect=new DirectionChessGlassesDropEffect,this.addChild(this._glassDropEffect)},pause:function(){this._ordinaryChessDropEffect.pause(),this._glassDropEffect.pause()},play:function(s){this._ordinaryChessDropEffect.play(function(){this._checkDoCallBack(s)}.bind(this)),this._glassDropEffect.play(function(){this._checkDoCallBack(s)}.bind(this))},setColorType:function(s){this._ordinaryChessDropEffect.setColorType(s),this._glassDropEffect.setColorType(s)},_checkDoCallBack:function(s){this._ordinaryChessDropEffect.isPlayComplete()&&this._glassDropEffect.isPlayComplete()&&"function"==typeof s&&s(this)}}),DirectionChessGlassesDropEffect=Effect.extend({ctor:function(){this._super(res.glassdropAction_json)},setColorType:function(s){var t=GameDataConfig.DirectionChessConfig[s],e=null!=t&&null!=t.dropEffect?t.dropEffect.y:0;this.setPositionY(e)},play:function(s){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof s&&s(this)}.bind(this))}});
var GhostAbsorbEffect=cc.Node.extend({_bgEffect:null,_mouthEffect:null,_audio:null,_bShow:!1,ctor:function(){this._super(),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),this._bgEffect=new GhostAbsorbBgEffect,this.addChild(this._bgEffect),this._mouthEffect=new GhostMouthEffect,this.addChild(this._mouthEffect)},pause:function(){this._bgEffect.pause(),this._mouthEffect.pause()},play:function(){this._bShow=!0,this._bgEffect.play(),this._mouthEffect.play(),MusicManager.playEffect(MusicEffectFiles.Audio_G_ghostabsorb),MusicManager.playEffect(MusicEffectFiles.Audio_G_ghostabsorb_loop,function(t){this._audio=t,this._bShow||MusicManager.stopEffect(this._audio)}.bind(this),!0)},onHide:function(){this._bShow=!1,MusicManager.stopEffect(this._audio)}}),GhostMouthEffect=Effect.extend({_loopIndex:0,_bComplete:null,ctor:function(){this._super(res.ghosteffectscom1_1_json),this.setPlayCompleteCallBack(this._onPlayComplete.bind(this)),this.setScale(1.5),this._loopIndex=14},play:function(){this._bComplete=!1,this._super(!1)},_onPlayComplete:function(){this._bComplete||(this._bComplete=!0,this._action.gotoFrameAndPlay(this._loopIndex,this._action.getDuration(),this._loopIndex,!0))}}),GhostAbsorbBgEffect=Effect.extend({ctor:function(){this._super(res.ghosteffectscom1_2_json),this.setScale(1.35)},play:function(){this._super(!0)}});
var GhostApertureEffect=Effect.extend({ctor:function(){this._super(res.ghostandghosteffectscom_json)},play:function(t){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof t&&t(this)}.bind(this))}});
var GhostSingEffect=cc.Node.extend({_bgEffect:null,_faceEffect:null,_audio:null,_bShow:!1,ctor:function(){this._super(),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),this._bgEffect=new GhostSingBgEffect,this.addChild(this._bgEffect),this._faceEffect=new GhostFaceEffect,this.addChild(this._faceEffect)},pause:function(){this._bgEffect.pause(),this._faceEffect.pause()},play:function(){this._bShow=!0,this._bgEffect.play(),this._faceEffect.play(),MusicManager.playEffect(MusicEffectFiles.Audio_G_ghostsing),MusicManager.playEffect(MusicEffectFiles.Audio_G_ghostsing_loop,function(t){this._audio=t,this._bShow||MusicManager.stopEffect(this._audio)}.bind(this),!0)},onHide:function(){this._bShow=!1,MusicManager.stopEffect(this._audio)}}),GhostFaceEffect=Effect.extend({_loopIndex:0,_bComplete:null,ctor:function(){this._super(res.ghosteffectscom2_1_json),this.setPlayCompleteCallBack(this._onPlayComplete.bind(this)),this.setScale(1.5),this._loopIndex=14},play:function(){this._bComplete=!1,this._super(!1)},_onPlayComplete:function(){this._bComplete||(this._bComplete=!0,this._action.gotoFrameAndPlay(this._loopIndex,this._action.getDuration(),this._loopIndex,!0))}}),GhostSingBgEffect=Effect.extend({ctor:function(){this._super(res.ghosteffectscom2_2_json),this.setScale(1.35)},play:function(){this._super(!0)}});
var MushroomAttackedEffect=cc.Node.extend({_attackedEffect:null,_effectMap:null,ctor:function(){this._super(),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),this._effectMap={},this._attackedEffect=null,this._initEffectMap()},_initEffectMap:function(){for(var t in GameDataConfig.MushroomEffectConfig){var e=GameDataConfig.MushroomEffectConfig[t];if(null!=e&&null!=e.attackedEffect&&null!=e.attackedEffect.effectPath){var f=e.attackedEffect.effectPath,a=this._effectMap[f];null==a&&((a=new Effect(f)).setOpacity(0),this._effectMap[f]=a)}}},play:function(t,e){this._attackedEffect&&this._attackedEffect.setOpacity(0);var f=null!=t&&null!=t.state?t.state:0,a=GameDataConfig.MushroomEffectConfig[f];if(null!=a&&null!=a.attackedEffect&&null!=a.attackedEffect.effectPath){var c=a.attackedEffect.effectPath,i=this._effectMap[c];null==i&&(i=new Effect(c),this.addChild(i),this._effectMap[c]=i),null==i.getParent()&&this.addChild(i),i.setOpacity(255),i.play(!1),i.setPlayCompleteCallBack(function(){"function"==typeof e&&e(this)}.bind(this)),this._attackedEffect=i}else"function"==typeof e&&e(this)},pause:function(){this._attackedEffect&&this._attackedEffect.pause()}});
var MushroomDevourEffect=cc.Node.extend({_effectMap:{},_devourEffect:null,_preState:null,ctor:function(){this._super(),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),this._devourEffect=null,this._preState=-1,this._effectMap={},this._initDevourEffectMap()},_initDevourEffectMap:function(){for(var t in GameDataConfig.MushroomEffectConfig){var e=GameDataConfig.MushroomEffectConfig[t];if(null!=e&&null!=e.devourEffect&&null!=e.devourEffect.effectPath){var f=e.devourEffect.effectPath,a=this._effectMap[f];null==a&&((a=new Effect(f)).setOpacity(0),this._effectMap[f]=a)}}},play:function(t,e){this._devourEffect&&this._devourEffect.setOpacity(0);var f=null!=t&&null!=t.state?t.state:0,a=GameDataConfig.MushroomEffectConfig[f];if(null!=a&&null!=a.devourEffect&&null!=a.devourEffect.effectPath){var i=a.devourEffect.effectPath,c=this._effectMap[i];null==c&&(c=new Effect(i),this.addChild(c),this._effectMap[i]=c),null==c.getParent()&&this.addChild(c),c.setOpacity(255),c.play(!1),c.setPlayCompleteCallBack(function(){"function"==typeof e&&e(this)}.bind(this)),this._devourEffect=c}else"function"==typeof e&&e(this)},pause:function(){this._devourEffect&&this._devourEffect.pause()},getDuration:function(){return this._devourEffect.getDuration()}});
var OrdinaryChessClickEffect=Effect.extend({_animalColorType:null,ctor:function(){this._super(res.clickAction_json),this._animalColorType=RemoveLogic.we4Proto.ChessColor.kChessColorYellow},play:function(e){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof e&&e(this)}.bind(this))},setColorType:function(e){if(this._animalColorType!=e){this._animalColorType=e;var i=GameDataConfig.ClickEffectConfig[e].image1,o=GameDataConfig.ClickEffectConfig[e].image2;UIHelper.seekWidgetByName(this._node,"image1",NodeType.SPRITE).setSpriteFrame(i);UIHelper.seekWidgetByName(this._node,"image2",NodeType.SPRITE).setSpriteFrame(o)}}});
var OrdinaryChessDropEffect=Effect.extend({_animalColorType:null,ctor:function(){this._super(res.dropAction_json),this._animalColorType=RemoveLogic.we4Proto.ChessColor.kChessColorYellow},play:function(e){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof e&&e(this)}.bind(this))},setColorType:function(e){if(this._animalColorType!=e){this._animalColorType=e;var o=GameDataConfig.ColorChessDropEffectConfig[e].image1;UIHelper.seekWidgetByName(this._node,"image1",NodeType.SPRITE).setSpriteFrame(o)}}});
var ShockWaveEffect=Effect.extend({_bHorizontalDirection:!0,ctor:function(){this._super(res.forceheffect_json)},play:function(t){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof t&&t(this)}.bind(this))},setDirection:function(t){if(this._bHorizontalDirection!==t){this._bHorizontalDirection=t;var e=t?0:90;UIHelper.seekWidgetByName(this._node,"image1",NodeType.SPRITE).setRotation(e),this.setRotation(e)}}});
var TypeCrushEffect=Effect.extend({_chessType:null,_colorType:null,ctor:function(e){this._chessType=e;var t=GameDataConfig.CrushEffectConfig[e],o=null!=t?t.effectPath:"";this._super(o)},setColorType:function(e){if(this._colorType!=e){this._colorType=e;var t=RemoveLogic.we4Proto.ChessType;switch(this._chessType){case t.CT_STEPBONUS:this._updateStepBonusColorType(e);break;case t.CT_TICKBOMB:this._updateTickBombColorType(e);break;case t.CT_Chameleon:this.setTimeSpeed(GameDataConfig.CRUSH_EFFECT_TIME_SPEED)}}},_updateStepBonusColorType:function(e){var t=GameDataConfig.StaticTagChessViewConfig[this._chessType];if(null!=t&&null!=t[e]&&null!=t[e].image1){var o=t[e].image1;UIHelper.seekWidgetByName(this._node,"addstepblue_1",NodeType.SPRITE).setSpriteFrame(o)}},_updateTickBombColorType:function(e){UIHelper.seekWidgetByName(this._node,"boomblue_1",NodeType.SPRITE).setSpriteFrame("obstacle/bomb/boom"+{0:"yellow",1:"red",2:"brown",3:"green",4:"blue",5:"purple"}[e]+".png")},play:function(e){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof e&&e(this)}.bind(this))}});
var TypeDropEffect=Effect.extend({ctor:function(t){var e=GameDataConfig.DropEffectConfig[t],f=null!=e&&null!=e.effectPath?e.effectPath:"";this._super(f)},play:function(t){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof t&&t(this)}.bind(this))}});
var CollectCrushEffect=cc.Node.extend({_effect:null,ctor:function(t){this._super(),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0);var e=GameDataConfig.CollectEffectConfig[t];if(null!=e&&null!=e.crushEffect){var f=new Effect(e.crushEffect.effectPath);this.addChild(f),this._effect=f}},play:function(t){null!=this._effect?(this._effect.setPlayCompleteCallBack(function(){"function"==typeof t&&t(this)}.bind(this)),this._effect.play(!1)):"function"==typeof t&&t(this)},pause:function(){this._effect&&this._effect.pause()}});
var CollectFlyEffect=Effect.extend({_chessType:null,ctor:function(e){this._chessType=e;var t=GameDataConfig.CollectEffectConfig[e],c=null!=t&&null!=t.flyEffect?t.flyEffect.effectPath:"";this._super(c)},play:function(e,t){this._super(!0);var c=GameDataConfig.CollectEffectConfig[this._chessType],f=null!=c&&null!=c.flyEffect?c.flyEffect.yOffset:"";this.setPositionY(this.getPositionY()+(void 0!=f&&f));var i=cc.pDistance(e,this.getPosition())/GameDataConfig.COLLECT_MOVE_SPEED,s=new cc.MoveTo(i,e),o=new cc.CallFunc(function(){"function"==typeof t&&t(this)}.bind(this)),n=new cc.Sequence(s,o);switch(this.runAction(n),this._chessType){case RemoveLogic.we4Proto.ChessType.CT_COLLECTBALLOON:MusicManager.playEffect(MusicEffectFiles.Audio_G_balloonget);break;case RemoveLogic.we4Proto.ChessType.CT_SodaBottle:MusicManager.playEffect(MusicEffectFiles.Audio_G_popget)}}});
var CollectGetEffect=Effect.extend({_chessType:null,ctor:function(e){this._chessType=e;var t=GameDataConfig.CollectEffectConfig[e],c=null!=t&&null!=t.getEffect?t.getEffect.effectPath:"";this._super(c)},play:function(e){switch(this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof e&&e(this)}.bind(this)),this._chessType){case RemoveLogic.we4Proto.ChessType.CT_COLLECTBALLOON:MusicManager.playEffect(MusicEffectFiles.Audio_G_balloonretroaction);break;case RemoveLogic.we4Proto.ChessType.CT_SodaBottle:MusicManager.playEffect(MusicEffectFiles.Audio_G_popretroaction);break;case RemoveLogic.we4Proto.ChessType.CT_COLLECTCANDY:MusicManager.playEffect(MusicEffectFiles.Audio_G_candyget);break;case RemoveLogic.we4Proto.ChessType.STIT_COLLECT_UNDER_ICE:MusicManager.playEffect(MusicEffectFiles.Audio_G_abaoretroaction)}}});
var DropEncourage=cc.Node.extend({ctor:function(){this._super(),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0)},showEncourage:function(e){var n="res/effect/title/bukesiyi.json",c=null!=e&&null!=e.effectPath?e.effectPath:n,t=AnimationCacheManager.getEffect(EffectCacheType.DROP_ENCOURAGE,{tag:c}).effect;null==t&&(console.log("drop encourage effect is null"),t=new Effect(c)),t.setOpacity(255),t.play(!1),t.setPlayCompleteCallBack(function(){AnimationCacheManager.cacheEffect(EffectCacheType.DROP_ENCOURAGE,t),t.removeFromParent()}.bind(this)),null==t.getParent()&&this.addChild(t)}});DropEncourage.GetInstance=function(){return null==DropEncourage._instance&&(DropEncourage._instance=new DropEncourage),DropEncourage._instance},DropEncourage.Show=function(e){var n=DropEncourage.GetInstance();null==n.getParent()&&(n.setPosition(cc.winSize.width/2,cc.winSize.height/2),cc.director.getRunningScene().addChild(n,GameCommonDef.LAYER_Z_ORDER_DROP_ENCOURAGE)),n.showEncourage(e)},DropEncourage.Destroy=function(){DropEncourage._instance&&DropEncourage._instance.removeFromParent(),DropEncourage._instance=null};
var GuideSwapChessApertureEffect=Effect.extend({ctor:function(){this._super(res.guideeffects_json)},play:function(){this._super(!0)}});
var GuideSwapChessEffect=cc.Node.extend({_handEffect:null,_lineEffect:null,ctor:function(){this._super(),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0);var t=new Effect(res.guidehand_2_json);this.addChild(t),this._lineEffect=t;(t=new HandEffect).setUserData(t.getPosition()),this.addChild(t),this._handEffect=t},play:function(t,i){this._handEffect.play(t,i);var e=cc.pSub(i,t),s=cc.pToAngle(e);s=90-(s=(180*s/Math.PI+360)%360),this._lineEffect.setRotation(s),this._lineEffect.play(!0)},pause:function(){this._handEffect.pause(),this._lineEffect.pause()}}),HandEffect=Effect.extend({_fromPosition:null,_toPosition:null,_time:null,_timeOutHandle:null,ctor:function(){this._super(res.guidehand_1_json),this._time=.5,this.setPlayCompleteCallBack(this._onPlayComplete.bind(this))},_onPlayComplete:function(){this.play(this._fromPosition,this._toPosition)},play:function(t,i){this.stopAllActions(),this.setPosition(this.getUserData()),this._fromPosition=t,this._toPosition=i,this._super(!1);clearTimeout(this._timeOutHandle),this._timeOutHandle=Timeout.register(function(){this._playMoveAction()}.bind(this),10/30*1e3)},_playMoveAction:function(){var t=cc.pSub(this._toPosition,this._fromPosition),i=new cc.MoveBy(this._time,t);this.stopAllActions(),this.runAction(i)}});
var HeartEffect=Effect.extend({ctor:function(){this._super(res.heart_json);var e=UIHelper.seekWidgetByName(this._node,"Panel_7",NodeType.PANEL);e.setBackGroundColorType(ccui.Layout.BG_COLOR_NONE);var t=UIHelper.createImage({imageFileName:res.mask_png,position:cc.p(e.getContentSize().width/2,e.getContentSize().height/2),scale:Math.max(cc.winSize.width/4,cc.winSize.height/4)});e.addChild(t),e.setScale(2)},play:function(e){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof e&&e(this)}.bind(this)),Timeout.register(function(){MusicManager.playEffect(MusicEffectFiles.Audio_UI_heartexplode)},GameDataConfig.HEART_EFFECT_EXPLODE_DELAY_TIME)}});
var RadialEffect=Effect.extend({ctor:function(){this._super(res.lastpang_json)},play:function(t,c,n){this._super(!1);var e=cc.pSub(t,c),i=cc.pToAngle(e);(i=(180*i/Math.PI+360)%360)>=180&&(i-=180),this.setRotation(90-i),this.setPosition(t);var a=cc.pDistance(t,c)/GameDataConfig.RADIAL_MOVE_SPEED,s=new cc.MoveTo(a,c),o=new cc.CallFunc(function(){"function"==typeof n&&n(this)}.bind(this)),f=new cc.Sequence(s,o);this.runAction(f),MusicManager.playEffect(MusicEffectFiles.Audio_G_xray)}});
var GiftGetEffect=Effect.extend({ctor:function(){this._super(res.giftget_json)},play:function(){this._super(!1)}});
var GiftLightEffect=Effect.extend({ctor:function(){this._super(res.giftlight_json)},play:function(){this._super(!0)}});
var GiftShineEffect=Effect.extend({ctor:function(){this._super(res.giftshine_json)},play:function(){this._super(!0)}});
var GiftUpEffect=Effect.extend({ctor:function(){this._super(res.giftup_json)},play:function(){this._super(!1)}});
var AddStepEffect=cc.Node.extend({_flyEffect:null,_numberEffect:null,ctor:function(e){this._super(),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0);var t=new Effect(e);this.addChild(t),this._flyEffect=t;(t=new AddStepNumberEffect).setOpacity(0),this.addChild(t),this._numberEffect=t},play:function(e,t,i){var s=e.toPosition,n=e.fromPosition;this._flyEffect.play(!0),this._flyEffect.setOpacity(255);var c=cc.pDistance(s,n)/GameDataConfig.USE_ADD_THREE_STEP_PROP_STAR_MOVE_SPEED,a=new cc.MoveBy(c,cc.pSub(s,n)),o=new cc.CallFunc(function(){"function"==typeof t&&t(this),this._flyEffect.setOpacity(0),this._numberEffect.setOpacity(255),this._numberEffect.play(e.step,function(){"function"==typeof i&&i(this)}.bind(this))}.bind(this)),f=new cc.Sequence(a,o);this.runAction(f),MusicManager.playEffect(MusicEffectFiles.Audio_G_addtimefly),null!=e.chess&&this._updateColorType(e.chess)},_updateColorType:function(e){var t=e.getColorType(),i=e.getChessType();switch(i){case RemoveLogic.we4Proto.ChessType.CT_STEPBONUS:this._updateStepBonusColorType(i,t)}},_updateStepBonusColorType:function(e,t){var i=GameDataConfig.StaticTagChessViewConfig[e];if(null!=i&&null!=i[t]&&null!=i[t].image1){var s=i[t].image1;UIHelper.seekWidgetByName(this._flyEffect._node,"addstepblue_1",NodeType.SPRITE).setSpriteFrame(s)}},pause:function(){this._flyEffect.pause()}}),AddStepNumberEffect=Effect.extend({_stepText:null,ctor:function(){this._super(res.add5steps3_json);var e=UIHelper.seekWidgetByName(this._node,"Panel_1",NodeType.PANEL);e.setBackGroundColorType(ccui.Layout.BG_COLOR_NONE),e.setCascadeColorEnabled(!0),e.setCascadeOpacityEnabled(!0);var t=new cc.LabelBMFont("+3",res.number_shallow_gold_fnt);t.setPosition(e.getContentSize().width/2,e.getContentSize().height/2),e.addChild(t),this._stepText=t},play:function(e,t){this._super(!1),this._stepText.setString("+"+e),this.setPlayCompleteCallBack(function(){"function"==typeof t&&t(this)}.bind(this)),MusicManager.playEffect(MusicEffectFiles.Audio_G_addtimeretroaction)}});
var HammerPropEffect=Effect.extend({ctor:function(){this._super(res.hammer_json)},play:function(t,e){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof e&&e(this)}.bind(this)),Timeout.register(function(){"function"==typeof t&&t(this)}.bind(this),GameDataConfig.HAMMER_PROP_EFFECT_DELAY_TIME)}});
var StepInnerBgEffect=Effect.extend({ctor:function(){this._super(res.add5steps1_json)},play:function(){this._super(!0)}});
var SwapPropApertureEffect=Effect.extend({ctor:function(){this._super(res.backgroung1_json)},play:function(t){this._super(!0),this.setPlayCompleteCallBack(function(){"function"==typeof t&&t(this)}.bind(this))}});
var SwapPropFlashOfLightEffect=Effect.extend({ctor:function(){this._super(res.exchange_json)},play:function(t,i,n){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof n&&n(this)}.bind(this)),Timeout.register(function(){"function"==typeof t&&t(this)}.bind(this),GameDataConfig.SWAP_PROP_FLASH_EFFECT_DISAPPEAR_CHESS_DELAY_TIME),Timeout.register(function(){"function"==typeof i&&i(this)}.bind(this),GameDataConfig.SWAP_PROP_FLASH_EFFECT_ADD_CHESS_DELAY_TIME)}});
var StarLevelEffect=Effect.extend({ctor:function(){this._super(res.finishstar_json)},play:function(t){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof t&&t(this)}.bind(this)),MusicManager.playEffect(MusicEffectFiles.Audio_UI_star)}});
var AnimationTaskHandler=cc.Class.extend({_taskList:null,_updateProxy:null,ctor:function(){this._taskList=[],this._updateProxy=new UpdateProxy(this._onUpdate.bind(this)),this._updateProxy.start()},isHaveTaskRunning:function(){return 0!=this._taskList.length},pushTask:function(t,a){this._taskList.push({data:t,bNeedBatchHandle:a})},destroy:function(){this._updateProxy.release(),this._taskList=[]},_onUpdate:function(t){if(0!=this._taskList.length){for(var a=!1,s=0;s<8&&this._taskList.length>0;s++){if(null!=(n=this._taskList.shift())){if((e=n.data).fun.apply(e.funCaller,e.arguments),n.bNeedBatchHandle){a=!0;break}}}var i=-1;if(a)for(s=this._taskList.length-1;s>=0;s--)if(this._taskList[s].bNeedBatchHandle){i=s;break}if(-1!=i)for(s=0;s<=i;s++){var n;if(null!=(n=this._taskList.shift())){var e;(e=n.data).fun.apply(e.funCaller,e.arguments)}}}}});
var GameCommonDef={};GameCommonDef.DESIGN_RESOLUTION_SIZE=cc.size(640,1136),GameCommonDef.RESOLUTION_POLICY=cc.ResolutionPolicy.FIXED_HEIGHT,GameCommonDef.lastFrameSize=cc.size(0,0),GameCommonDef.orientation=0,GameCommonDef.LAYER_Z_ORDER_BG=0,GameCommonDef.LAYER_Z_ORDER_MAIN_UI=5,GameCommonDef.LAYER_Z_ORDER_EFFECT=60,GameCommonDef.LAYER_Z_ORDER_DROP_ENCOURAGE=80,GameCommonDef.LAYER_Z_ORDER_POP_UP=101,GameCommonDef.LAYER_Z_ORDER_TIP_UI=107,GameCommonDef.LAYER_Z_ORDER_NET_LOADING=109,GameCommonDef.LAYER_Z_ORDER_RETRY_WINDOW=200,GameCommonDef.LAYER_Z_ORDER_GUIDE_MASK=100,GameCommonDef.LAYER_Z_ORDER_GUIDE_DIALOG=104,GameCommonDef.LAYER_Z_ORDER_GUIDE_ANIMATION=106,GameCommonDef.LAYER_Z_ORDER_GUIDE_OPERATION=110;var PriceType={GOLD:1,DIAMONDS:2},MAX_STAGE_ID=390,MaxItemNumPerPage=30,RES_LOAD_TIME_OUT_TIME=30,REMOVE_LOGIC_JS_PATH="../dist/RemoveLogic.js",LOGIC_TASK_JS_PATH="../dist/LogicWorker.js";window.DEBUG||(REMOVE_LOGIC_JS_PATH="dist/RemoveLogic.js",LOGIC_TASK_JS_PATH="dist/LogicWorker.js");var COMMON_ANCHOR={leftBottom:cc.p(0,0),leftMid:cc.p(0,.5),leftTop:cc.p(0,1),midBottom:cc.p(.5,0),midCenter:cc.p(.5,.5),midTop:cc.p(.5,1),rightBottom:cc.p(1,0),rightMid:cc.p(1,.5),rightTop:cc.p(1,1)};
var AllStageConfig=[{id:1,img:1,pos:cc.p(218,2966)},{id:2,img:1,pos:cc.p(300,2891)},{id:3,img:1,pos:cc.p(220,2810)},{id:4,img:1,pos:cc.p(121,2742)},{id:5,img:1,pos:cc.p(112,2552)},{id:6,img:1,pos:cc.p(230,2494)},{id:7,img:1,pos:cc.p(327,2427)},{id:8,img:1,pos:cc.p(379,2338)},{id:9,img:1,pos:cc.p(378,2168)},{id:10,img:1,pos:cc.p(327,2075)},{id:11,img:1,pos:cc.p(232,2008)},{id:12,img:1,pos:cc.p(111,1953)},{id:13,img:2,pos:cc.p(195,1811)},{id:14,img:2,pos:cc.p(308,1758)},{id:15,img:2,pos:cc.p(379,1674)},{id:16,img:2,pos:cc.p(308,1584)},{id:17,img:2,pos:cc.p(196,1531)},{id:18,img:2,pos:cc.p(106,1452)},{id:19,img:2,pos:cc.p(195,1372)},{id:20,img:2,pos:cc.p(306,1310)},{id:21,img:2,pos:cc.p(287,1131)},{id:22,img:2,pos:cc.p(178,1076)},{id:23,img:2,pos:cc.p(112,882)},{id:24,img:2,pos:cc.p(230,826)},{id:25,img:2,pos:cc.p(327,759)},{id:26,img:2,pos:cc.p(380,667)},{id:27,img:2,pos:cc.p(327,573)},{id:28,img:2,pos:cc.p(231,505)},{id:29,img:2,pos:cc.p(113,448)},{id:30,img:2,pos:cc.p(218,383)}],StagePosConfig=[{textPos1:cc.p(48,70),textPos2:cc.p(54,60),starPos:[cc.p(35.5,39.5),cc.p(59.5,37.5),cc.p(84.5,39.5)]},{textPos1:cc.p(48,72),textPos2:cc.p(48,62),starPos:[cc.p(23.5,42.5),cc.p(47.5,40.5),cc.p(71.5,42.5)]}],last_max_stage_id=-1;
function pushPreCreateOperate(e,a,o,t){e.push({fun:a,funCaller:o,arguments:t})}var chessBoardRow=8,chessBoardCol=8,viewportRow=8,viewportCol=8,cloud_divide_effect_path="",BearChessImagePath="obstacle/hellokitty/bear2.png",bAutoPlay=!1,bChallengeMode=!1,FRAME_SECOND=30,GameDataConfig={ORIGINAL_FRAME_RATE:30,GAME_SCENE_FRAME_RATE:30,CHESS_BOARD_POSITION:{x:320,y:498},CHESS_BOARD_MASK_EXTEND:80,CHESS_GRID_WIDTH:74,CHESS_GRID_HEIGHT:74,CHESS_BOARD_SCROLL_SPEED:200,LUCKY_DICE_ID:50,LUCKY_DICE_PRICE:10,LUCKY_DICE_DISCOUNT_PRICE:8,CHESS_PRE_CREATE_MAX_LIMIT:64,EFFECT_PRE_CREATE_MAX_LIMIT:64,GAME_START_ANIMATION_TOTAL_FRAME:173,EFFECT_ROOT_PATH:"res/effect/",SHOW_GUIDE_USE_STEP_INNER_PROP_STEP:5,PROP_CAN_USE_COUNT:4,ADD_FIVE_STEP_PROP_ITEM_ID:11,CHESS_MOVE_SPEED:250,CRUSH_EFFECT_TIME_SPEED:.9,RADIAL_MOVE_SPEED:1500,CHESS_SWAP_TIME:.2,CHESS_DROP_SPEED:1150,CHESS_ABSORBED_MOVE_SPEED:400,COLLECT_MOVE_SPEED:600,CHESS_REARRANGE_MOVE_TIME:.3,USE_ADD_THREE_STEP_PROP_STAR_MOVE_SPEED:1e3,ANIMAL_ORIGINAL_CRUSH_EFFECT_DELAY_TIME:10/FRAME_SECOND*1e3,ANIMAL_LAST_PANG_CRUSH_EFFECT_DELAY_TIME:20/FRAME_SECOND*1e3,CHESS_DROP_EFFECT_DELAY_TIME:4/FRAME_SECOND*1e3,BOMB_CRUSH_EFFECT_DELAY_TIME:15/FRAME_SECOND*1e3,HAMMER_PROP_EFFECT_DELAY_TIME:20/FRAME_SECOND*1e3,SWAP_PROP_FLASH_EFFECT_DISAPPEAR_CHESS_DELAY_TIME:4/FRAME_SECOND*1e3,SWAP_PROP_FLASH_EFFECT_ADD_CHESS_DELAY_TIME:5/FRAME_SECOND*1e3,HEART_EFFECT_EXPLODE_DELAY_TIME:25/FRAME_SECOND*1e3,ChessDropDirection:{NONE:-1,TO_BOTTOM:1,TO_TOP:2,TO_LEFT:3,TO_RIGHT:4,TO_LEFT_TOP:5,TO_RIGHT_TOP:6,TO_LEFT_BOTTOM:7,TO_RIGHT_BOTTOM:8},ZOrder:{BG:0,CHESS:2,MAX_CHESS:10,CHANGE:125,ATTACKED:1100,MOVE:1124,DIVIDE:1125,DISAPPEAR_EFFECT:1126,CRUSH:1127,DEVOUR:1128,HP:1130,SHOCK_WAVE:1140,GHOST_ABSORB:1150,GHOST_SING:1160,GHOST_APERTURE:1170,ABSORBED_CHESS:1180,CONVEYER_LIGHT:1185,PROP:1190,COLLECT:2220,SWAP_CHESS_APERTURE:2223,GUIDE_SWAP_CHESS:2265,RADIAL:3370},ChessLogicOrder:{ORDER_0:-1,ORDER_1:0,ORDER_2:1,ORDER_3:2,ORDER_4:3,ORDER_5:4},CrushType:{ANIMAL_CHESS:1,BOMB_CHESS:2,TYPE_CRUSH:3,FLY_COLLECT:4},DropType:{ANIMAL_CHESS:1,BOMB_CHESS:2,GLASSES_CHESS:3,TYPE_DROP:4},DirectionChessConfig:{},BombChessConfig:{},ClickEffectConfig:{},ChessMoveEffectConfig:{},AnimalCrushEffectConfig:{},ColorChessDropEffectConfig:{},CollectEffectConfig:{},ColorChessViewConfig:{},StaticChessViewConfig:{},StaticTagChessViewConfig:{},DynamicChessViewConfig:{},ChessDivideEffectConfig:{},ChessDividedEffectConfig:{},DropEffectConfig:{},MultistageChessConfig:{},StageResMap:{},PropTitleViewConfig:{},EncourageTitleConfig:{},CrushEffectConfig:{},ChessAttackedEffectConfig:{},BeAttackChessHPViewConfig:{},ChessDevourEffectConfig:{},ChessDevouredEffectConfig:{},MushroomEffectConfig:{},MultistageChessCrushConfig:{},ChessChangeEffectConfig:{},ConveyerChessConfig:{},ConveyerLightEffectConfig:{},ConveyerLightDirConfig:{},PropViewConfig:{1:{image1:"prop_addStep.png"},2:{image1:"prop_ghost.png"},3:{image1:"prop_glasses.png"},4:{image1:"prop_crush_magic_wand.png"},5:{image1:"prop_swap.png"},6:{image1:"prop_glasses_radial.png"},7:{image1:"prop_rearrange.png"},9:{image1:"prop_addStep.png"},13:{image1:"prop_addStep_1.png"},14:{image1:"prop_addStep_2.png"},15:{image1:"prop_score_5.png"},16:{image1:"prop_score_7.png"},17:{image1:"prop_score_9.png"},18:{image1:"prop_hurricane.png"}}};GameDataConfig.PropViewConfig[GameDataConfig.LUCKY_DICE_ID]={image1:"prop_lucky_dice.png"};var WeekMatchId={MERGED:1,HEX_CRUSH:2},WeekMatchConfig={};WeekMatchConfig[WeekMatchId.MERGED]={name:"合并大师",subscribeId:184,htmlIndexPath:"../app/merged/index.html",rankType:RankType.RANK_TYPE_WEEKMATCH_MASTER_MERGER},WeekMatchConfig[WeekMatchId.HEX_CRUSH]={name:"六角消除",subscribeId:186,htmlIndexPath:"../app/hexCrush/index.html",rankType:RankType.RANK_TYPE_WEEKMATCH_SIX_CORNER_ELIM};var GameDataDefine={_bInit:!1,init:function(){if(!this._bInit){this._bInit=!0,initGlassesPropTargetChess();var e=RemoveLogic.we4Proto.ChessColor,a=RemoveLogic.we4Proto.ChessType,o=RemoveLogic.we4Proto.ItemId,t=RemoveLogic.weTypeModule.ConveyerDirection;GameDataConfig.ClickEffectConfig[e.kChessColorYellow]={image1:"chess/animal/yellow1.png",image2:"chess/animal/yellow2.png"},GameDataConfig.ClickEffectConfig[e.kChessColorRed]={image1:"chess/animal/red1.png",image2:"chess/animal/red2.png"},GameDataConfig.ClickEffectConfig[e.kChessColorBlue]={image1:"chess/animal/blue1.png",image2:"chess/animal/blue2.png"},GameDataConfig.ClickEffectConfig[e.kChessColorBrown]={image1:"chess/animal/brown1.png",image2:"chess/animal/brown2.png"},GameDataConfig.ClickEffectConfig[e.kChessColorGreen]={image1:"chess/animal/green1.png",image2:"chess/animal/green2.png"},GameDataConfig.ClickEffectConfig[e.kChessColorPurple]={image1:"chess/animal/purple1.png",image2:"chess/animal/purple2.png"},GameDataConfig.AnimalCrushEffectConfig[e.kChessColorYellow]={image1:"chess/animal/yellow2.png",image2:"chess/animal/yellow1.png"},GameDataConfig.AnimalCrushEffectConfig[e.kChessColorRed]={image1:"chess/animal/red2.png",image2:"chess/animal/red1.png"},GameDataConfig.AnimalCrushEffectConfig[e.kChessColorBlue]={image1:"chess/animal/blue2.png",image2:"chess/animal/blue1.png"},GameDataConfig.AnimalCrushEffectConfig[e.kChessColorBrown]={image1:"chess/animal/brown2.png",image2:"chess/animal/brown1.png"},GameDataConfig.AnimalCrushEffectConfig[e.kChessColorGreen]={image1:"chess/animal/green2.png",image2:"chess/animal/green1.png"},GameDataConfig.AnimalCrushEffectConfig[e.kChessColorPurple]={image1:"chess/animal/purple2.png",image2:"chess/animal/purple1.png"},GameDataConfig.ColorChessDropEffectConfig[e.kChessColorYellow]={image1:"chess/animal/yellow0.png"},GameDataConfig.ColorChessDropEffectConfig[e.kChessColorRed]={image1:"chess/animal/red0.png"},GameDataConfig.ColorChessDropEffectConfig[e.kChessColorBlue]={image1:"chess/animal/blue0.png"},GameDataConfig.ColorChessDropEffectConfig[e.kChessColorBrown]={image1:"chess/animal/brown0.png"},GameDataConfig.ColorChessDropEffectConfig[e.kChessColorGreen]={image1:"chess/animal/green0.png"},GameDataConfig.ColorChessDropEffectConfig[e.kChessColorPurple]={image1:"chess/animal/purple0.png"},GameDataConfig.CollectEffectConfig[a.CT_SodaBottle]={crushEffect:{effectPath:res.bubblebroken_json},flyEffect:{effectPath:res.bubblefly_json,yOffset:105},getEffect:{effectPath:res.bubbleget_json},chessView:{image1:"obstacle/bubble/bubble.png"}},GameDataConfig.CollectEffectConfig[a.CT_COLLECTBALLOON]={flyEffect:{effectPath:res.balloonfly_json},getEffect:{effectPath:res.balloonget1_json},chessView:{image1:"obstacle/balloon/balloon.png"}},GameDataConfig.CollectEffectConfig[a.CT_COLLECTCANDY]={flyEffect:{effectPath:res.bottlecandyfly_json},getEffect:{effectPath:res.bottlecandyget_json},chessView:{image1:"obstacle/bottle/bottlecandyicon.png"}},GameDataConfig.CollectEffectConfig[a.STIT_COLLECT_UNDER_ICE]={flyEffect:{effectPath:res.hellokittyaction_json},getEffect:{effectPath:res.hellokittyget_json},chessView:{image1:"obstacle/hellokitty/hellokityhead.png"}},GameDataConfig.CollectEffectConfig[a.STIT_ICE]={chessView:{image1:"obstacle/ice/icesmall.png"}},GameDataConfig.CollectEffectConfig[a.STIT_BOX]={chessView:{image1:"obstacle/box/box.png"}},GameDataConfig.CollectEffectConfig[a.STIT_BOX_TWO]={chessView:{image1:"obstacle/box/box2.png"}},GameDataConfig.CollectEffectConfig[a.STIT_BOX_THREE]={chessView:{image1:"obstacle/box/box3.png"}},GameDataConfig.CollectEffectConfig[a.STIT_BOX_FOUR]={chessView:{image1:"obstacle/box/box4.png"}},GameDataConfig.CollectEffectConfig[a.STIT_CANDYPAPER1]={chessView:{image1:"obstacle/jelly/jelly1.png"}},GameDataConfig.CollectEffectConfig[a.STIT_CANDYPAPER2]={chessView:{image1:"obstacle/jelly/jelly2.png"}},GameDataConfig.CollectEffectConfig[a.STIT_CANDYPAPER3]={chessView:{image1:"obstacle/jelly/jelly3.png"}},GameDataConfig.CollectEffectConfig[a.STIT_CANDYPAPER4]={chessView:{image1:"obstacle/jelly/jelly4.png"}},GameDataConfig.CollectEffectConfig[a.STIT_CANDYPAPER5]={chessView:{image1:"obstacle/jelly/jelly5.png"}},GameDataConfig.CollectEffectConfig[a.STIT_DEEPICE]={chessView:{image1:"obstacle/ice/ice_2.png"}},GameDataConfig.CollectEffectConfig[a.STIT_CAGE]={chessView:{image1:"obstacle/lock/lock.png"}},GameDataConfig.CollectEffectConfig[a.STIT_CAGE2]={chessView:{image1:"obstacle/lock/lock_2.png"}},GameDataConfig.CollectEffectConfig[a.STIT_DONUTSBOMB]={chessView:{image1:"obstacle/cookies/doughnuts.png"}},GameDataConfig.CollectEffectConfig[a.STIT_BLUEBERRY]={chessView:{image1:"obstacle/lawn/lawn_icon.png"}},GameDataConfig.CollectEffectConfig[a.STIT_MAOQIU1]={chessView:{image1:"obstacle/cloudface/cloudfaceelement.png"}},GameDataConfig.CollectEffectConfig[a.STIT_HUGEMUSHROOM]={chessView:{image1:"obstacle/mushroom/mushroomelement.png"}},GameDataConfig.ColorChessViewConfig[e.kChessColorYellow]={image1:"chess/animal/yellow0.png"},GameDataConfig.ColorChessViewConfig[e.kChessColorRed]={image1:"chess/animal/red0.png"},GameDataConfig.ColorChessViewConfig[e.kChessColorBlue]={image1:"chess/animal/blue0.png"},GameDataConfig.ColorChessViewConfig[e.kChessColorBrown]={image1:"chess/animal/brown0.png"},GameDataConfig.ColorChessViewConfig[e.kChessColorGreen]={image1:"chess/animal/green0.png"},GameDataConfig.ColorChessViewConfig[e.kChessColorPurple]={image1:"chess/animal/purple0.png"},GameDataConfig.StaticChessViewConfig[a.STIT_BOX]={image1:"obstacle/box/box.png"},GameDataConfig.StaticChessViewConfig[a.STIT_BOX_TWO]={image1:"obstacle/box/box2.png"},GameDataConfig.StaticChessViewConfig[a.STIT_BOX_THREE]={image1:"obstacle/box/box3.png"},GameDataConfig.StaticChessViewConfig[a.STIT_BOX_FOUR]={image1:"obstacle/box/box4.png"},GameDataConfig.StaticChessViewConfig[a.STIT_CANDYPAPER1]={image1:"obstacle/jelly/jelly1.png"},GameDataConfig.StaticChessViewConfig[a.STIT_CANDYPAPER2]={image1:"obstacle/jelly/jelly2.png"},GameDataConfig.StaticChessViewConfig[a.STIT_CANDYPAPER3]={image1:"obstacle/jelly/jelly3.png"},GameDataConfig.StaticChessViewConfig[a.STIT_CANDYPAPER4]={image1:"obstacle/jelly/jelly4.png"},GameDataConfig.StaticChessViewConfig[a.STIT_CANDYPAPER5]={image1:"obstacle/jelly/jelly5.png"},GameDataConfig.StaticChessViewConfig[a.STIT_ICE]={image1:"obstacle/ice/icesmall.png"},GameDataConfig.StaticChessViewConfig[a.STIT_ICE_BEAR_UNDER]={image1:"obstacle/ice/icesmall.png"},GameDataConfig.StaticChessViewConfig[a.STIT_DEEPICE]={image1:"obstacle/ice/ice_2.png"},GameDataConfig.StaticChessViewConfig[a.STIT_CAGE]={image1:"obstacle/lock/lock.png"},GameDataConfig.StaticChessViewConfig[a.STIT_CAGE2]={image1:"obstacle/lock/lock_2.png"},GameDataConfig.StaticChessViewConfig[a.STIT_DONUTSBOMB]={image1:"obstacle/cookies/doughnuts.png"},GameDataConfig.StaticChessViewConfig[a.CT_CLODS0]={image1:"obstacle/cookies/cookies.png"},GameDataConfig.StaticChessViewConfig[a.CT_CLODS1]={image1:"obstacle/cookies/cook2.png"},GameDataConfig.StaticChessViewConfig[a.STIT_BLUEBERRY]={image1:"obstacle/lawn/lawn.png"},GameDataConfig.StaticChessViewConfig[a.CT_COLLECTCANDY]={image1:"obstacle/bottle/bottlecandyicon.png"},GameDataConfig.StaticChessViewConfig[a.STIT_COLLECT_POINT_IN_SODA]={image1:"obstacle/mushroom/icon_flag.png",yOffset:-30},GameDataConfig.StaticTagChessViewConfig[a.CT_STEPBONUS]={},GameDataConfig.StaticTagChessViewConfig[a.CT_STEPBONUS][e.kChessColorYellow]={image1:"obstacle/stepscounter/addstepyellow.png"},GameDataConfig.StaticTagChessViewConfig[a.CT_STEPBONUS][e.kChessColorRed]={image1:"obstacle/stepscounter/addstepred.png"},GameDataConfig.StaticTagChessViewConfig[a.CT_STEPBONUS][e.kChessColorBrown]={image1:"obstacle/stepscounter/addstepbrown.png"},GameDataConfig.StaticTagChessViewConfig[a.CT_STEPBONUS][e.kChessColorGreen]={image1:"obstacle/stepscounter/addstepgreen.png"},GameDataConfig.StaticTagChessViewConfig[a.CT_STEPBONUS][e.kChessColorBlue]={image1:"obstacle/stepscounter/addstepblue.png"},GameDataConfig.StaticTagChessViewConfig[a.CT_STEPBONUS][e.kChessColorPurple]={image1:"obstacle/stepscounter/addsteppurple.png"},GameDataConfig.DynamicChessViewConfig[a.CT_COLLECTBALLOON]={effectPath:res.balloonhold_json},GameDataConfig.DynamicChessViewConfig[a.STIT_COLLECTBALLOON_POINT]={effectPath:res.arrow_json},GameDataConfig.DynamicChessViewConfig[a.STIT_COLLECTCANDY_POINT]={effectPath:res.arrow2_json},GameDataConfig.DynamicChessViewConfig[a.STIT_CHONGDONG1]={effectPath:res.sofainin_json},GameDataConfig.DynamicChessViewConfig[a.STIT_CHONGDONG2]={effectPath:res.sofainout_json},GameDataConfig.DynamicChessViewConfig[a.STIT_CANDYPOT]={effectPath:res.bottlehold_json},GameDataConfig.DynamicChessViewConfig[a.STIT_MAOQIU1]={effectPath:res.cloudface2hold_json},GameDataConfig.DynamicChessViewConfig[a.STIT_MAOQIU2]={effectPath:res.cloudface1hold_json},GameDataConfig.DynamicChessViewConfig[a.STIT_LITTLEMUSHROOM]={effectPath:res.mushroomlhold_json},GameDataConfig.DynamicChessViewConfig[a.STIT_HUGEMUSHROOM]={effectPath:res.mushroom1hold_json},GameDataConfig.DirectionChessConfig[e.kChessColorYellow]={bgEffect:{y:-6},glasses:{y:25},clickEffect:{y:0},dropEffect:{y:1}},GameDataConfig.DirectionChessConfig[e.kChessColorRed]={bgEffect:{y:-7},glasses:{y:24},clickEffect:{y:-6},dropEffect:{y:0}},GameDataConfig.DirectionChessConfig[e.kChessColorBlue]={bgEffect:{y:-6},glasses:{y:30},clickEffect:{y:0},dropEffect:{y:5}},GameDataConfig.DirectionChessConfig[e.kChessColorBrown]={bgEffect:{y:0},glasses:{y:30},clickEffect:{y:0},dropEffect:{y:6}},GameDataConfig.DirectionChessConfig[e.kChessColorGreen]={bgEffect:{y:-7},glasses:{y:24},clickEffect:{y:-6},dropEffect:{y:0}},GameDataConfig.DirectionChessConfig[e.kChessColorPurple]={bgEffect:{y:-4},glasses:{y:28},clickEffect:{y:0},dropEffect:{y:3}},GameDataConfig.BombChessConfig[e.kChessColorYellow]={bgEffect:{y:-6},nose:{y:22},clickEffect:{y:0},dropEffect:{y:1}},GameDataConfig.BombChessConfig[e.kChessColorRed]={bgEffect:{y:-7},nose:{y:22},clickEffect:{y:-5},dropEffect:{y:0}},GameDataConfig.BombChessConfig[e.kChessColorBlue]={bgEffect:{y:-6},nose:{y:28},clickEffect:{y:1},dropEffect:{y:5}},GameDataConfig.BombChessConfig[e.kChessColorBrown]={bgEffect:{y:0},nose:{y:28},clickEffect:{y:0},dropEffect:{y:6}},GameDataConfig.BombChessConfig[e.kChessColorGreen]={bgEffect:{y:-7},nose:{y:22},clickEffect:{y:-2},dropEffect:{y:0}},GameDataConfig.BombChessConfig[e.kChessColorPurple]={bgEffect:{y:-4},nose:{y:26},clickEffect:{y:-1},dropEffect:{y:3}},GameDataConfig.CrushEffectConfig[a.CT_NormalUnit]={bNeedCalcExecutingEffectLogicCount:!0,crushType:GameDataConfig.CrushType.ANIMAL_CHESS},GameDataConfig.CrushEffectConfig[a.CT_SpecialVerticalShockWave]={bNeedCalcExecutingEffectLogicCount:!0,crushType:GameDataConfig.CrushType.ANIMAL_CHESS},GameDataConfig.CrushEffectConfig[a.CT_SpecialHorizontalShockWave]={bNeedCalcExecutingEffectLogicCount:!0,crushType:GameDataConfig.CrushType.ANIMAL_CHESS},GameDataConfig.CrushEffectConfig[a.CT_Chameleon]={effectPath:res.boomAction_json,bNeedCalcExecutingEffectLogicCount:!0,crushType:GameDataConfig.CrushType.TYPE_CRUSH},GameDataConfig.CrushEffectConfig[a.CT_TICKBOMB]={effectPath:res.bomb1clearup_json,bNeedCalcExecutingEffectLogicCount:!0,crushType:GameDataConfig.CrushType.TYPE_CRUSH},GameDataConfig.CrushEffectConfig[a.CT_SpecialHurricane]={bNeedCalcExecutingEffectLogicCount:!0,crushType:GameDataConfig.CrushType.BOMB_CHESS},GameDataConfig.CrushEffectConfig[a.STIT_MAOQIU1]={effectPath:res.cloudface2broken_json,bNeedCalcExecutingEffectLogicCount:!1,crushType:GameDataConfig.CrushType.TYPE_CRUSH},GameDataConfig.CrushEffectConfig[a.STIT_ICE]={effectPath:res.iceAction1_json,bNeedCalcExecutingEffectLogicCount:!1,crushType:GameDataConfig.CrushType.TYPE_CRUSH},GameDataConfig.CrushEffectConfig[a.STIT_ICE_BEAR_UNDER]={effectPath:res.iceAction1_json,bNeedCalcExecutingEffectLogicCount:!1,crushType:GameDataConfig.CrushType.TYPE_CRUSH},GameDataConfig.CrushEffectConfig[a.STIT_DEEPICE]={effectPath:res.iceAction2_json,bNeedCalcExecutingEffectLogicCount:!1,crushType:GameDataConfig.CrushType.TYPE_CRUSH,zOrder:GameDataConfig.ZOrder.BG},GameDataConfig.CrushEffectConfig[a.STIT_BOX]={effectPath:res.boxAction1_json,bNeedCalcExecutingEffectLogicCount:!1,crushType:GameDataConfig.CrushType.TYPE_CRUSH},GameDataConfig.CrushEffectConfig[a.STIT_BOX_TWO]={effectPath:res.boxAction2_json,bNeedCalcExecutingEffectLogicCount:!1,crushType:GameDataConfig.CrushType.TYPE_CRUSH},GameDataConfig.CrushEffectConfig[a.STIT_BOX_THREE]={effectPath:res.boxAction3_json,bNeedCalcExecutingEffectLogicCount:!1,crushType:GameDataConfig.CrushType.TYPE_CRUSH},GameDataConfig.CrushEffectConfig[a.STIT_BOX_FOUR]={effectPath:res.boxAction4_json,bNeedCalcExecutingEffectLogicCount:!1,crushType:GameDataConfig.CrushType.TYPE_CRUSH},GameDataConfig.CrushEffectConfig[a.STIT_LITTLEMUSHROOM]={effectPath:res.mushroomlbroken_json,bNeedCalcExecutingEffectLogicCount:!1,crushType:GameDataConfig.CrushType.TYPE_CRUSH},GameDataConfig.CrushEffectConfig[a.STIT_CANDYPAPER1]={effectPath:res.jelly1_json,bNeedCalcExecutingEffectLogicCount:!1,crushType:GameDataConfig.CrushType.TYPE_CRUSH},GameDataConfig.CrushEffectConfig[a.STIT_CANDYPAPER2]={effectPath:res.jelly2_json,bNeedCalcExecutingEffectLogicCount:!1,crushType:GameDataConfig.CrushType.TYPE_CRUSH},GameDataConfig.CrushEffectConfig[a.STIT_CANDYPAPER3]={effectPath:res.jelly3_json,bNeedCalcExecutingEffectLogicCount:!1,crushType:GameDataConfig.CrushType.TYPE_CRUSH},GameDataConfig.CrushEffectConfig[a.STIT_CANDYPAPER4]={effectPath:res.jelly4_json,bNeedCalcExecutingEffectLogicCount:!1,crushType:GameDataConfig.CrushType.TYPE_CRUSH},GameDataConfig.CrushEffectConfig[a.STIT_CAGE]={effectPath:res.lockAction_json,bNeedCalcExecutingEffectLogicCount:!1,crushType:GameDataConfig.CrushType.TYPE_CRUSH},GameDataConfig.CrushEffectConfig[a.CT_COLLECTBALLOON]={bNeedCalcExecutingEffectLogicCount:!1,crushType:GameDataConfig.CrushType.FLY_COLLECT},GameDataConfig.CrushEffectConfig[a.CT_SodaBottle]={bNeedCalcExecutingEffectLogicCount:!1,crushType:GameDataConfig.CrushType.FLY_COLLECT},GameDataConfig.CrushEffectConfig[a.CT_CLODS0]={effectPath:res.cookiesbroken_json,bNeedCalcExecutingEffectLogicCount:!1,crushType:GameDataConfig.CrushType.TYPE_CRUSH},GameDataConfig.CrushEffectConfig[a.STIT_DONUTSBOMB]={effectPath:res.candybroken_json,bNeedCalcExecutingEffectLogicCount:!1,crushType:GameDataConfig.CrushType.TYPE_CRUSH},GameDataConfig.CrushEffectConfig[a.CT_COLLECTCANDY]={bNeedCalcExecutingEffectLogicCount:!1,crushType:GameDataConfig.CrushType.FLY_COLLECT},GameDataConfig.CrushEffectConfig[a.STIT_BLUEBERRY]={effectPath:res.lawn_json,bNeedCalcExecutingEffectLogicCount:!1,crushType:GameDataConfig.CrushType.TYPE_CRUSH,zOrder:GameDataConfig.ZOrder.BG},GameDataConfig.CrushEffectConfig[a.STIT_HUGEMUSHROOM]={effectPath:res.mushroom4broken_json,bNeedCalcExecutingEffectLogicCount:!0,crushType:GameDataConfig.CrushType.TYPE_CRUSH},GameDataConfig.CrushEffectConfig[a.CT_STEPBONUS]={effectPath:res.stepscounterbroken_json,bNeedCalcExecutingEffectLogicCount:!0,crushType:GameDataConfig.CrushType.TYPE_CRUSH},GameDataConfig.ChessAttackedEffectConfig[a.STIT_CANDYPOT]={effectPath:res.bottleaction2_json,bNeedCalcExecutingEffectLogicCount:!1},GameDataConfig.ChessAttackedEffectConfig[a.STIT_HUGEMUSHROOM]={bNeedCalcExecutingEffectLogicCount:!1},GameDataConfig.ChessChangeEffectConfig[a.CT_CLODS1]={bNeedCalcExecutingEffectLogicCount:!0,effectPath:res.cookiesbroken2_json,delayTime:16/FRAME_SECOND*1e3},GameDataConfig.MushroomEffectConfig[1]={attackedEffect:{effectPath:res.mushroom1broken_json,bNeedCalcExecutingEffectLogicCount:!0},idleEffect:{effectPath:res.mushroom1hold_json},devourEffect:{effectPath:res.mushroom1action_json}},GameDataConfig.MushroomEffectConfig[2]={attackedEffect:{effectPath:res.mushroom2broken_json,bNeedCalcExecutingEffectLogicCount:!0},idleEffect:{effectPath:res.mushroom2hold_json},devourEffect:{effectPath:res.mushroom2action_json}},GameDataConfig.MushroomEffectConfig[3]={attackedEffect:{effectPath:res.mushroom3broken_json,bNeedCalcExecutingEffectLogicCount:!0},idleEffect:{effectPath:res.mushroom3hold_json},devourEffect:{effectPath:res.mushroom3action_json}},GameDataConfig.BeAttackChessHPViewConfig[a.STIT_HUGEMUSHROOM]={bNeedCreateHPView:!0},GameDataConfig.ChessDevourEffectConfig[a.STIT_CANDYPOT]={effectPath:res.bottleaction1_json,devourChessDelayTime:500,addChessDelayTime:1e3},GameDataConfig.ChessDevourEffectConfig[a.STIT_HUGEMUSHROOM]={devourChessDelayTime:50/FRAME_SECOND*1e3,addChessDelayTime:50/FRAME_SECOND*1e3},GameDataConfig.ChessDevouredEffectConfig[a.STIT_LITTLEMUSHROOM]={effectPath:res.mushroomlbulid_json},cloud_divide_effect_path=res.cloudface1broken1_json,GameDataConfig.ChessDividedEffectConfig[a.STIT_MAOQIU1]={effectPath:res.cloudface1broken2_json},GameDataConfig.DropEffectConfig[a.CT_NormalUnit]={dropType:GameDataConfig.DropType.ANIMAL_CHESS},GameDataConfig.DropEffectConfig[a.CT_SpecialVerticalShockWave]={dropType:GameDataConfig.DropType.GLASSES_CHESS},GameDataConfig.DropEffectConfig[a.CT_SpecialHorizontalShockWave]={dropType:GameDataConfig.DropType.GLASSES_CHESS},GameDataConfig.DropEffectConfig[a.CT_SpecialHurricane]={dropType:GameDataConfig.DropType.BOMB_CHESS},GameDataConfig.DropEffectConfig[a.CT_SpecialGas]={dropType:GameDataConfig.DropType.TYPE_DROP,effectPath:res.ghostdropAction_json},GameDataConfig.ChessMoveEffectConfig[a.STIT_MAOQIU1]={effectPath:res.cloudface2move_json},GameDataConfig.ChessMoveEffectConfig[a.STIT_MAOQIU2]={effectPath:res.cloudface1move_json},GameDataConfig.PropTitleViewConfig[o.itemStepOut]={image1:"title_add_three_step.png"},GameDataConfig.PropTitleViewConfig[o.itemGas]={image1:"title_ghost.png"},GameDataConfig.PropTitleViewConfig[o.itemShockWave]={image1:"title_glasses.png"},GameDataConfig.PropTitleViewConfig[GameDataConfig.LUCKY_DICE_ID]={image1:"title_lucky_dice.png"},GameDataConfig.PropTitleViewConfig[o.itemAddStep_1]={image1:"title_add_one_step.png"},GameDataConfig.PropTitleViewConfig[o.itemAddStep_2]={image1:"title_add_two_step.png"},GameDataConfig.PropTitleViewConfig[o.itemScoreAdd_5]={image1:"title_add_score_5.png"},GameDataConfig.PropTitleViewConfig[o.itemScoreAdd_7]={image1:"title_add_score_7.png"},GameDataConfig.PropTitleViewConfig[o.itemScoreAdd_9]={image1:"title_add_score_9.png"},GameDataConfig.PropTitleViewConfig[o.itemHurricane]={image1:"title_hurricane.png"},GameDataConfig.EncourageTitleConfig.BU_KE_SI_YI={effectPath:res.bukesiyi_json},GameDataConfig.EncourageTitleConfig.CHAO_ZAN={effectPath:res.chaozan_json},GameDataConfig.EncourageTitleConfig.CHU_SHEN_RU_HUA={effectPath:res.chushenruhua_json},GameDataConfig.EncourageTitleConfig.GAN_DE_PIAO_LIANG={effectPath:res.gandepiaoliang_json},GameDataConfig.EncourageTitleConfig.LI_HAI={effectPath:res.lihai_json},GameDataConfig.EncourageTitleConfig.SHUANG={effectPath:res.shuang_json},GameDataConfig.EncourageTitleConfig.WAI_SAI={effectPath:res.wasai_json},GameDataConfig.EncourageTitleConfig.WU_YU_LUN_BI={effectPath:res.wuyilunbi_json},GameDataConfig.EncourageTitleConfig.JING_CAI_JUE_LUN={effectPath:res.jingcaijuelun_json},GameDataConfig.MultistageChessConfig[a.STIT_BOX]=!0,GameDataConfig.MultistageChessConfig[a.STIT_BOX_TWO]=!0,GameDataConfig.MultistageChessConfig[a.STIT_BOX_THREE]=!0,GameDataConfig.MultistageChessConfig[a.STIT_BOX_FOUR]=!0,GameDataConfig.MultistageChessConfig[a.STIT_ICE]=!0,GameDataConfig.MultistageChessConfig[a.STIT_DEEPICE]=!0,GameDataConfig.MultistageChessConfig[a.CT_CLODS0]=!0,GameDataConfig.MultistageChessConfig[a.CT_CLODS1]=!0,GameDataConfig.MultistageChessConfig[a.STIT_CANDYPAPER1]=!0,GameDataConfig.MultistageChessConfig[a.STIT_CANDYPAPER2]=!0,GameDataConfig.MultistageChessConfig[a.STIT_CANDYPAPER3]=!0,GameDataConfig.MultistageChessConfig[a.STIT_CANDYPAPER4]=!0,GameDataConfig.MultistageChessConfig[a.STIT_CANDYPAPER5]=!0,GameDataConfig.MultistageChessCrushConfig[a.STIT_BOX_FOUR]=[a.STIT_BOX,a.STIT_BOX_TWO,a.STIT_BOX_THREE],GameDataConfig.MultistageChessCrushConfig[a.STIT_BOX_THREE]=[a.STIT_BOX,a.STIT_BOX_TWO],GameDataConfig.MultistageChessCrushConfig[a.STIT_BOX_TWO]=[a.STIT_BOX],GameDataConfig.MultistageChessCrushConfig[a.STIT_DEEPICE]=[a.STIT_ICE],GameDataConfig.MultistageChessCrushConfig[a.CT_CLODS1]=[a.CT_CLODS0],GameDataConfig.MultistageChessCrushConfig[a.STIT_CANDYPAPER5]=[a.STIT_CANDYPAPER1,a.STIT_CANDYPAPER2,a.STIT_CANDYPAPER3,a.STIT_CANDYPAPER4],GameDataConfig.MultistageChessCrushConfig[a.STIT_CANDYPAPER4]=[a.STIT_CANDYPAPER1,a.STIT_CANDYPAPER2,a.STIT_CANDYPAPER3],GameDataConfig.MultistageChessCrushConfig[a.STIT_CANDYPAPER3]=[a.STIT_CANDYPAPER1,a.STIT_CANDYPAPER2],GameDataConfig.MultistageChessCrushConfig[a.STIT_CANDYPAPER2]=[a.STIT_CANDYPAPER1],GameDataConfig.MultistageChessCrushConfig[a.STIT_HUGEMUSHROOM]=[a.STIT_LITTLEMUSHROOM],GameDataConfig.MultistageChessCrushConfig[a.STIT_MAOQIU2]=[a.STIT_MAOQIU1],GameDataConfig.ConveyerChessConfig[t.Conveyer_Up]={image1:"obstacle/conveyerbell/conveyerbell1.png",rotate:-90,offset:cc.p(0,0)},GameDataConfig.ConveyerChessConfig[t.Conveyer_Down]={image1:"obstacle/conveyerbell/conveyerbell1.png",rotate:90,offset:cc.p(0,0)},GameDataConfig.ConveyerChessConfig[t.Conveyer_Left]={image1:"obstacle/conveyerbell/conveyerbell1.png",rotate:-180,offset:cc.p(0,0)},GameDataConfig.ConveyerChessConfig[t.Conveyer_Right]={image1:"obstacle/conveyerbell/conveyerbell1.png",rotate:0,offset:cc.p(0,0)},GameDataConfig.ConveyerChessConfig[t.Conveyer_TopLeft_Right]={image1:"obstacle/conveyerbell/conveyerbell2.png",rotate:180,offset:cc.p(0,0)},GameDataConfig.ConveyerChessConfig[t.Conveyer_TopLeft_Down]={image1:"obstacle/conveyerbell/conveyerbell2.png",rotate:180,offset:cc.p(0,0)},GameDataConfig.ConveyerChessConfig[t.Conveyer_TopRight_Left]={image1:"obstacle/conveyerbell/conveyerbell2.png",rotate:-90,offset:cc.p(0,0)},GameDataConfig.ConveyerChessConfig[t.Conveyer_TopRight_Down]={image1:"obstacle/conveyerbell/conveyerbell2.png",rotate:-90,offset:cc.p(0,0)},GameDataConfig.ConveyerChessConfig[t.Conveyer_BottomLeft_Right]={image1:"obstacle/conveyerbell/conveyerbell2.png",rotate:90,offset:cc.p(0,0)},GameDataConfig.ConveyerChessConfig[t.Conveyer_BottomLeft_Up]={image1:"obstacle/conveyerbell/conveyerbell2.png",rotate:90,offset:cc.p(0,0)},GameDataConfig.ConveyerChessConfig[t.Conveyer_BottomRight_Left]={image1:"obstacle/conveyerbell/conveyerbell2.png",rotate:0,offset:cc.p(0,0)},GameDataConfig.ConveyerChessConfig[t.Conveyer_BottomRight_Up]={image1:"obstacle/conveyerbell/conveyerbell2.png",rotate:0,offset:cc.p(0,0)},GameDataConfig.ConveyerChessConfig[t.Conveyer_Broken_Out_Up]={image1:"obstacle/conveyerbell/conveyerbell1.png",rotate:-90,offset:cc.p(0,0)},GameDataConfig.ConveyerChessConfig[t.Conveyer_Broken_Out_Down]={image1:"obstacle/conveyerbell/conveyerbell1.png",rotate:90,offset:cc.p(0,0)},GameDataConfig.ConveyerChessConfig[t.Conveyer_Broken_Out_Left]={image1:"obstacle/conveyerbell/conveyerbell1.png",rotate:-180,offset:cc.p(0,0)},GameDataConfig.ConveyerChessConfig[t.Conveyer_Broken_Out_Right]={image1:"obstacle/conveyerbell/conveyerbell1.png",rotate:0,offset:cc.p(0,0)},GameDataConfig.ConveyerChessConfig[t.Conveyer_Broken_In_Up]={image1:"obstacle/conveyerbell/conveyerbell1.png",rotate:-90,offset:cc.p(0,0)},GameDataConfig.ConveyerChessConfig[t.Conveyer_Broken_In_Down]={image1:"obstacle/conveyerbell/conveyerbell1.png",rotate:90,offset:cc.p(0,0)},GameDataConfig.ConveyerChessConfig[t.Conveyer_Broken_In_Left]={image1:"obstacle/conveyerbell/conveyerbell1.png",rotate:-180,offset:cc.p(0,0)},GameDataConfig.ConveyerChessConfig[t.Conveyer_Broken_In_Right]={image1:"obstacle/conveyerbell/conveyerbell1.png",rotate:0,offset:cc.p(0,0)},GameDataConfig.ConveyerLightEffectConfig[0]={effectIn:res.conveyerin1_json,effectOut:res.conveyerout1_json},GameDataConfig.ConveyerLightEffectConfig[1]={effectIn:res.conveyerin2_json,effectOut:res.conveyerout2_json},GameDataConfig.ConveyerLightEffectConfig[2]={effectIn:res.conveyerin3_json,effectOut:res.conveyerout3_json},GameDataConfig.ConveyerLightDirConfig[t.Conveyer_Broken_Out_Up]={effectType:"effectIn",rotate:0},GameDataConfig.ConveyerLightDirConfig[t.Conveyer_Broken_Out_Down]={effectType:"effectIn",rotate:180},GameDataConfig.ConveyerLightDirConfig[t.Conveyer_Broken_Out_Left]={effectType:"effectIn",rotate:-90},GameDataConfig.ConveyerLightDirConfig[t.Conveyer_Broken_Out_Right]={effectType:"effectIn",rotate:90},GameDataConfig.ConveyerLightDirConfig[t.Conveyer_Broken_In_Up]={effectType:"effectOut",rotate:180},GameDataConfig.ConveyerLightDirConfig[t.Conveyer_Broken_In_Down]={effectType:"effectOut",rotate:0},GameDataConfig.ConveyerLightDirConfig[t.Conveyer_Broken_In_Left]={effectType:"effectOut",rotate:90},GameDataConfig.ConveyerLightDirConfig[t.Conveyer_Broken_In_Right]={effectType:"effectOut",rotate:-90},GameDataConfig.StageResMap[a.STIT_ICE]=subResList.Ice1Res,GameDataConfig.StageResMap[a.STIT_DEEPICE]=subResList.Ice2Res,GameDataConfig.StageResMap[a.CT_COLLECTBALLOON]=subResList.BalloonRes,GameDataConfig.StageResMap[a.STIT_BOX]=subResList.Box1Res,GameDataConfig.StageResMap[a.STIT_BOX_TWO]=subResList.Box2Res,GameDataConfig.StageResMap[a.STIT_BOX_THREE]=subResList.Box3Res,GameDataConfig.StageResMap[a.STIT_BOX_FOUR]=subResList.Box4Res,GameDataConfig.StageResMap[a.CT_SodaBottle]=subResList.BubbleRes,GameDataConfig.StageResMap[a.STIT_DONUTSBOMB]=subResList.DonutsBombRes,GameDataConfig.StageResMap[a.CT_CLODS0]=subResList.ClodSo1Res,GameDataConfig.StageResMap[a.CT_CLODS1]=subResList.ClodSo2Res,GameDataConfig.StageResMap[a.STIT_CHONGDONG1]=subResList.Chongdong1Res,GameDataConfig.StageResMap[a.STIT_CHONGDONG2]=subResList.Chongdong2Res,GameDataConfig.StageResMap[a.STIT_BLUEBERRY]=subResList.BlueberryRes,GameDataConfig.StageResMap[a.STIT_CAGE]=subResList.Cage1Res,GameDataConfig.StageResMap[a.STIT_CAGE2]=subResList.Cage1Res,GameDataConfig.StageResMap[a.STIT_CANDYPOT]=subResList.CandyRes,GameDataConfig.StageResMap[a.STIT_CANDYPAPER1]=subResList.Jelly1Res,GameDataConfig.StageResMap[a.STIT_CANDYPAPER2]=subResList.Jelly2Res,GameDataConfig.StageResMap[a.STIT_CANDYPAPER3]=subResList.Jelly3Res,GameDataConfig.StageResMap[a.STIT_CANDYPAPER4]=subResList.Jelly4Res,GameDataConfig.StageResMap[a.STIT_CANDYPAPER5]=subResList.Jelly5Res,GameDataConfig.StageResMap[a.STIT_ICE_BEAR_UNDER]=subResList.IceBearRes,GameDataConfig.StageResMap[a.STIT_MAOQIU1]=subResList.Cloud1Res,GameDataConfig.StageResMap[a.STIT_MAOQIU2]=subResList.Cloud2Res,GameDataConfig.StageResMap[a.STIT_LITTLEMUSHROOM]=subResList.Mushroom1Res,GameDataConfig.StageResMap[a.STIT_HUGEMUSHROOM]=subResList.Mushroom2Res,GameDataConfig.StageResMap[a.CT_TICKBOMB]=subResList.ChessTickBombRes,GameDataConfig.StageResMap[a.CT_STEPBONUS]=subResList.StepBonusRes,GameDataConfig.StageResMap[a.STIT_CONVEYER]=subResList.ConveyerRes}}};
var HeartConfig={full_count:99,sec_per_heart:600,max_pool_buf:5};
var PassConditionType={};PassConditionType.SCORE=1;var MainPageData=function(e){this._initPassCondition=function(e){this.passCondition=[];for(var t=0,a=e.length;t<a;t++){var s=e[t];this.passCondition.push({type:s.pass_type,data1:s.value1,data2:s.value2,collectType:s.collect_type})}},this.step=e.step_limit,this.score=e.star_score[2],this.level=e.puzzle_stage,this.oneStarScore=e.star_score[0],this.twoStarScore=e.star_score[1],this.threeStarScore=e.star_score[2],this._initPassCondition(e.pass_condition)},GameSettlementSuccessPageData={};GameSettlementSuccessPageData.bgImagePath="",GameSettlementSuccessPageData.score=0,GameSettlementSuccessPageData.reward=0,GameSettlementSuccessPageData.starCount=0,GameSettlementSuccessPageData.level=0;var GameSettlementFailPageData={};GameSettlementFailPageData.failReason=null;
var bMergeFileModel=!1,ResObjectConfig={},ResObjects={_resObjectMap:{},init:function(){ResObjectConfig.stageProp={cl:ResObject,op:[subResList.StagePropRes,subResList.PropSelectRes],name:"stagePropResObject"},ResObjectConfig.email={cl:ResObject,op:[subResList.EmailRes],name:"emailResObject"},ResObjectConfig.mainGame={cl:MainGameResObject,op:[subResList.MainGamePageRes],name:"mainGameResObject"},ResObjectConfig.mergedRule={cl:ResObject,op:[subResList.MergedRuleRes],name:"mergedRuleResObject"},ResObjectConfig.weekMatchMergedSubscribe={cl:ResObject,op:[subResList.WeekMatchMergedSubscribeRes],name:"weekMatchMergedSubscribeResObject"},ResObjectConfig.hexCrushRule={cl:ResObject,op:[subResList.HexCrushRuleRes],name:"hexCrushRuleResObject"},ResObjectConfig.weekMatchHexSubscribe={cl:ResObject,op:[subResList.WeekMatchHexSubscribeRes],name:"weekMatchHexSubscribeResObject"},ResObjectConfig.allStage={cl:AllStageResObject,op:[subResList.AllStage],name:"allStageResObject"},ResObjectConfig.preLoad={cl:ResObject,op:[subResList.PreLoadRes],name:"preLoadResObject"},ResObjectConfig.gameFail={cl:ResObject,op:[subResList.GameFailRes],name:"gameFailResObject"},ResObjectConfig.gameSuccess={cl:GameSuccessResObject,op:[subResList.GameSuccessRes],name:"gameSuccessResObject"},ResObjectConfig.stageDetail={cl:StageDetailResObject,op:[subResList.StageDetailRes],name:"stageDetailResObject"},ResObjectConfig.propSelect={cl:ResObject,op:[subResList.PropSelectRes],name:"propSelectResObject"},ResObjectConfig.setting={cl:ResObject,op:[subResList.SettingRes],name:"settingResObject"},ResObjectConfig.rankList={cl:ResObject,op:[subResList.RankListRes],name:"rankListResObject"},ResObjectConfig.taskCenter={cl:ResObject,op:[subResList.taskCenterRes],name:"taskCenterResObject"},ResObjectConfig.task={cl:ResObject,op:[subResList.taskRes],name:"taskResObject"},ResObjectConfig.exchange={cl:ResObject,op:[subResList.ExchangeRes],name:"exchangeResObject"},ResObjectConfig.cloud={cl:ResObject,op:[subResList.CloudRes],name:"cloudResObject"},ResObjectConfig.mapEffect1={cl:ResObject,op:[subResList.MapEffectRes1],name:"mapEffectRes1Object"},ResObjectConfig.mapEffect2={cl:ResObject,op:[subResList.MapEffectRes2],name:"mapEffectRes2Object"},ResObjectConfig.mapEffect3={cl:ResObject,op:[subResList.MapEffectRes3],name:"mapEffectRes3Object"},ResObjectConfig.mapEffect4={cl:ResObject,op:[subResList.MapEffectRes4],name:"mapEffectRes4Object"},ResObjectConfig.mapBkg1={cl:ResObject,op:[subResList.mapBkgImgRes1],name:"mapBkgRes1Object"},ResObjectConfig.mapBkg2={cl:ResObject,op:[subResList.mapBkgImgRes2],name:"mapBkgRes2Object"},ResObjectConfig.mapBkg3={cl:ResObject,op:[subResList.mapBkgImgRes3],name:"mapBkgRes3Object"},ResObjectConfig.mapBkg4={cl:ResObject,op:[subResList.mapBkgImgRes4],name:"mapBkgRes4Object"},ResObjectConfig.mapBkg5={cl:ResObject,op:[subResList.mapBkgImgRes5],name:"mapBkgRes5Object"},ResObjectConfig.mapBkg6={cl:ResObject,op:[subResList.mapBkgImgRes6],name:"mapBkgRes6Object"},ResObjectConfig.mapBkg7={cl:ResObject,op:[subResList.mapBkgImgRes7],name:"mapBkgRes7Object"},ResObjectConfig.mapBkg8={cl:ResObject,op:[subResList.mapBkgImgRes8],name:"mapBkgRes8Object"},ResObjectConfig.miniMap={cl:ResObject,op:[subResList.MiniMapRes],name:"miniMapResObject"},ResObjectConfig.loginReward={cl:ResObject,op:[subResList.LoginRewardRes],name:"loginRewardResObject"},ResObjectConfig.newBieGift={cl:ResObject,op:[subResList.newBieGiftRes],name:"newBieGiftResObject"},ResObjectConfig.clickTip={cl:ResObject,op:[subResList.ClickTipRes],name:"clickTipResObject"},ResObjectConfig.starRewardPreview={cl:ResObject,op:[subResList.StarRewardPreviewRes],name:"starRewardPreviewResObject"},ResObjectConfig.buyProp={cl:ResObject,op:[subResList.BuyPropRes],name:"buyPropResObject"},ResObjectConfig.shareGift={cl:ResObject,op:[subResList.ShareGiftRes],name:"shareGiftResObject"},ResObjectConfig.PKRank={cl:ResObject,op:[subResList.PKRankRes],name:"PKRankResObject"},ResObjectConfig.flaunt={cl:ResObject,op:[subResList.FlauntRes],name:"flauntResObject"},ResObjectConfig.newMapCloud={cl:ResObject,op:[subResList.NewMapCloudRes],name:"newMapCloudResObject"},ResObjectConfig.newElementWave={cl:ResObject,op:[subResList.newElementWave],name:"newElementWaveResObject"},ResObjectConfig.mergedWeekMatch={cl:ResObject,op:[subResList.MergedWeekMatchRes,subResList.WeekMatchCommonRes],name:"mergedWeekMatchResObject"},ResObjectConfig.hexCrushWeekMatch={cl:ResObject,op:[subResList.HexCrushWeekMatchRes,subResList.WeekMatchCommonRes],name:"hexCrushWeekMatchResObject"},ResObjectConfig.guideDesktop={cl:ResObject,op:[subResList.GuideDesktopRes],name:"guideDesktopResObject"},ResObjectConfig.yuan1={cl:ResObject,op:[subResList.Yuan1Res],name:"yuan1ResObject"},ResObjectConfig.weekMatchCount={cl:ResObject,op:[subResList.WeekMatchCountRes],name:"weekMatchCountResObject"},ResObjectConfig.notifyGoOnline={cl:ResObject,op:[subResList.NotifyGoOnlineRes],name:"notifyGoOnlineResObject"},ResObjectConfig.dialog={cl:ResObject,op:[subResList.DialogRes],name:"dialogResObject"},ResObjectConfig.dialogRewardBox={cl:ResObject,op:[subResList.DialogRewardBoxRes],name:"dialogRewardBoxResObject"},ResObjectConfig.jumpStage={cl:ResObject,op:[subResList.JumpStageRes],name:"jumpStageResObject"},ResObjectConfig.weekMatchReward={cl:ResObject,op:[subResList.WeekMatchRewardRes],name:"weekMatchRewardResObject"},ResObjectConfig.preLoadGame={cl:ResObject,op:[subResList.PreLoadGameRes],name:"preLoadGameResObject"},ResObjectConfig.rankGroupGuide={cl:ResObject,op:[subResList.rankGroupGuide],name:"rankGroupGuide"},ResObjectConfig.preloadStage={cl:PreloadStageResObject,op:[subResList.MainGamePageRes],name:"preloadStageResObject"},ResObjectConfig.ringMatchResult={cl:ResObject,op:[subResList.RingMatchResultRes],name:"ringMatchResultResObject"}},getResObject:function(e){var s=this._resObjectMap[e.name];if(null!=s)return s;for(var t=[],i=0,a=e.op.length;i<a;i++)t=t.concat(e.op[i]);return s=new e.cl(t),this._resObjectMap[e.name]=s,s}},ResObject=cc.Class.extend({_resList:null,_bLoaded:!1,ctor:function(e){bMergeFileModel?this.initMergeFileModelResList(e):this.initOriginalModelResList(e)},initOriginalModelResList:function(e){this._resList=null!=e?e.concat():[]},initMergeFileModelResList:function(e){},isLoaded:function(){return this._bLoaded},getLoadResList:function(){return this._resList},getResList:function(){return this._resList},onLoadFinish:function(){this._bLoaded||(this.addSpriteFrames(),this._bLoaded=!0,bMergeFileModel&&this.handleDataToLoaderCache())},handleDataToLoaderCache:function(){},addSpriteFrames:function(){for(var e=0,s=this._resList.length;e<s;e++)Util.endsWithString(this._resList[e],"plist")&&cc.spriteFrameCache.addSpriteFrames(this._resList[e])}}),AllStageResObject=ResObject.extend({initOriginalModelResList:function(e){this._super(e)},initMergeFileModelResList:function(e){}}),StageDetailResObject=ResObject.extend({initOriginalModelResList:function(e){this._super(e)},initMergeFileModelResList:function(e){}}),MainGameResObject=ResObject.extend({_basicsResList:null,_bLoadedBasicResList:!1,initOriginalModelResList:function(e){this._basicsResList=e.concat()},initMergeFileModelResList:function(e){},getLoadResList:function(){this._bLoaded=!1;var e=[],s=null;return null==resGroup.MainGamePageRes.bgImage_jpg?(s=this._randomBgRes(),resGroup.MainGamePageRes.bgImage_jpg=s):s=resGroup.MainGamePageRes.bgImage_jpg,e=this._bLoadedBasicResList?this._generatorLoadResList([],s):this._generatorLoadResList(this._basicsResList,s),e=this._filletLoadResList(e),this._resList=e,e},_filletLoadResList:function(e){for(var s=[],t={},i=0,a=e.length;i<a;i++){var c=e[i];null==t[c]&&(t[c]=c,s.push(c))}return s},_generatorLoadResList:function(e,s){var t=e.concat(s);if(null!=puzzleGame){var i=new StageId(GameProxy.getStageId(),0),a=puzzleGame.getContainChessType(i),c=this._getSubResList(a);t=t.concat(c)}return t},_getSubResList:function(e){var s=[];for(var t in e){var i=e[t];console.log("count : "+i);var a=GameDataConfig.StageResMap[t];null!=a?s=s.concat(a):console.log("find StageResMap fail, chessType : "+t)}return s},isLoaded:function(){return!1},onLoadFinish:function(){this._super(),this._bLoadedBasicResList=!0},_randomBgRes:function(){var e=Util.getRandom(0,subResList.GameBgRes.length-1);return subResList.GameBgRes[e]}}),PreloadStageResObject=ResObject.extend({_basicsResList:null,_bLoadedBasicResList:!1,_stageId:null,initOriginalModelResList:function(e){this._basicsResList=e.concat()},initMergeFileModelResList:function(e){},setStageId:function(e){this._stageId=e},getLoadResList:function(){this._bLoaded=!1;var e=[],s=null;return null==resGroup.MainGamePageRes.bgImage_jpg?(s=this._randomBgRes(),resGroup.MainGamePageRes.bgImage_jpg=s):s=resGroup.MainGamePageRes.bgImage_jpg,e=this._bLoadedBasicResList?this._generatorLoadResList([],s):this._generatorLoadResList(this._basicsResList,s),e=this._filletLoadResList(e),this._resList=e,e},_filletLoadResList:function(e){for(var s=[],t={},i=0,a=e.length;i<a;i++){var c=e[i];null==t[c]&&(t[c]=c,s.push(c))}return s},_generatorLoadResList:function(e,s){var t=e.concat(s),i=RemoveLogic.StageLoader.getContainChessType(this._stageId),a=this._getSubResList(i);return t=t.concat(a)},_getSubResList:function(e){var s=[];for(var t in e){var i=e[t];console.log("count : "+i);var a=GameDataConfig.StageResMap[t];null!=a?s=s.concat(a):console.log("find StageResMap fail, chessType : "+t)}return s},isLoaded:function(){return!1},onLoadFinish:function(){this._super(),this._bLoadedBasicResList=!0},_randomBgRes:function(){var e=Util.getRandom(0,subResList.GameBgRes.length-1);return subResList.GameBgRes[e]}}),GameSuccessResObject=ResObject.extend({_star:null,_basicsResList:null,_bLoadedBasicResList:!1,setStar:function(e){this._star=e},initOriginalModelResList:function(e){this._basicsResList=e.concat()},initMergeFileModelResList:function(e){},getLoadResList:function(){var e=[],s=this._getStarRes();return this._bLoadedBasicResList?e.push(s):e=this._basicsResList.concat(s),this._resList=this._basicsResList.concat(s),e},onLoadFinish:function(){this._super(),this._bLoadedBasicResList=!0},isLoaded:function(){return!1},_getStarRes:function(){var e="number"==typeof this._star?this._star:1;e<1&&(e=1),e>3&&(e=3);return res["successbudget"+e+"_json"]}});
var SimpleStageData=function(t){this._initPassCondition=function(t){this.passCondition=[];for(var i=0,s=t.length;i<s;i++){var e=t[i];this.passCondition.push({type:e.pass_type,data1:e.value1,data2:e.value2,result1:e.result1,result2:e.result2,collectType:e.collect_type,crushType:e.CollectType})}},this.chessBoardRow=t.board_row,this.chessBoardCol=t.board_col,this.chessBoardViewportRow=t.screen_col,this.chessBoardViewportCol=t.screen_col,this.step=t.step_limit,this.score=t.star_score[2],this.level=t.puzzle_stage,this.oneStarScore=t.star_score[0],this.twoStarScore=t.star_score[1],this.threeStarScore=t.star_score[2],this._initPassCondition(t.pass_condition)},StartItemData=function(t,i){var s=new RemoveLogic.we4Proto.StartItemData;return s.type=t,s.value=i,s},AbsorbData=function(t,i,s,e,o){this.chessLogicOrder=s,this.from=new GridPosition(t,i),this.to=new GridPosition(e,o)},Input=function(t,i,s,e,o,h){var n=new RemoveLogic.we4Proto.Input;return n.op=t,n.from=i,n.to=s,n.item_id=e,n.value1=o,n.value2=h,n},GridPosition=function(t,i){this.row=t,this.col=i,this.isEqual=function(t){return this.row==t.row&&this.col==t.col}},MushroomData=function(t,i,s){this.maxHealth=t,this.currentHealth=i,this.hurtValue=s},ChessData=function(t,i,s,e,o,h,n){this.gridPosition=new GridPosition(t,i),this.colorType=o,this.chessType=h,this.size={width:s,height:e},this.extendData=n,this.clone=function(){return Util.clone(this)}},DropData=function(t){this.extendData=t,this.path=[],this.push=function(t,i){this.path.push(new GridPosition(t,i))},this.clone=function(){return Util.clone(this)}},MoveData=function(t,i){this.chessData=t,this.to=i},DivideData=function(t,i){this.chessData=t,this.dividedChessDataList=i},GridData=function(t,i,s,e,o,h,n){this.gridRow=t,this.gridCol=i,this.viewportRow=s,this.viewportCol=e,this.chessWidth=o,this.chessHeight=h,this.chessGridDataList=n},ChessGridData=function(t,i,s){this.gridPosition=new GridPosition(t,i),this.chessDataList=s},ChessBoardData=function(t,i,s,e,o,h,n){this.row=t,this.col=i,this.viewportRow=s,this.viewportCol=e,this.chessWidth=o,this.chessHeight=h,this.chessGridDataList=n},StageId=function(t,i){this.id=t,this.sub_id=i},StageStartRequest=function(t,i,s,e){this.stage_id=t,this.start_time=i,this.item_id_list=s,this.cost_item_list=e},PkMatchStartRequest=function(t,i){this.arena_match_id=t,this.stage_id=i},StageStartInfo=function(t,i,s){this.random_seed=t,this.item_id_list=i,this.stage_id=s},StageUseItemRequest=function(t,i){this.stage_id=t,this.item_id=i},ArticleType={};ArticleType.ARTICLE_TYPE_NULL=0,ArticleType.ARTICLE_TYPE_ATTR=1,ArticleType.ARTICLE_TYPE_PET=2,ArticleType.ARTICLE_TYPE_COUNT=3;var ArticleSubType={};ArticleSubType.ARTICLE_SUB_TYPE_HEART=1,ArticleSubType.ARTICLE_SUB_TYPE_DIAMONDS=2,ArticleSubType.ARTICLE_SUB_TYPE_COIN=3,ArticleSubType.ARTICLE_SUB_TYPE_PROP=4;var BuyGoodsRequest=function(t,i,s,e,o,h){this.id=t,this.type=i,this.subtype=s,this.count=e,this.conf_id=o,this.conf_pkg_id=h},BuyStagePropRequest=function(t,i,s){var e=ConfigLoader.getPropGoodsConfig(t);return new BuyGoodsRequest(t,e.type,e.subtype,i,e.id,s)},CostItem=function(t,i,s){this.item_id=t,this.conf_id=i,this.conf_pkg_id=s},MergedWeekMatchData=function(t,i,s,e,o,h){this.openId=t,this.rank=i,this.headImgUrl=s,this.name=e,this.score=o,this.bInvited=h},MergedRankData=function(t,i,s,e,o){this.openId=t,this.rank=i,this.headImgUrl=s,this.name=e,this.score=o};
var HistoryRecord={recordList:{},isUsingHistory:!1,curUsingRecord:null,curInputIndex:0};HistoryRecord.saveRecord=function(r,o){this.recordList[r]=o},HistoryRecord.getRecordByStage=function(r){return this.recordList[r]};
var EnLanguage={APP_NAME:"PuzzleGame"};
var LanguageKey={APP_NAME:"APP_NAME",OWN_DIAMONDS_COUNT:"OWN_DIAMONDS_COUNT",PROP_OVER_USE_LIMIT:"PROP_OVER_USE_LIMIT",SINGLE_GAME_PROP_CAN_USE_COUNT_LIMIT:"SINGLE_GAME_PROP_CAN_USE_COUNT_LIMIT",BUY_PROP_SUCCESS:"BUY_PROP_SUCCESS",SETTLEMENT_CHEAT:"SETTLEMENT_CHEAT",REWARD_ARRIVAL:"REWARD_ARRIVAL",LEVEL:"LEVEL",LOADING_RES:"LOADING_RES",LOADING_CONFIG:"LOADING_CONFIG",LOGINING:"LOGINING",TOUCH_SCREEN_ENTER_GAME:"TOUCH_SCREEN_ENTER_GAME",SCORE_PASSCONDITION:"SCORE_PASSCONDITION",PROP_USE_LIMIT:"PROP_USE_LIMIT",PROP_DESC:"PROP_DESC",TOTAL_COST:"TOTAL_COST",CONTINUOUS_USE_DISCOUNT:"CONTINUOUS_USE_DISCOUNT",TEMPORARILY_UNAVAILABLE:"TEMPORARILY_UNAVAILABLE",STAGE:"STAGE",RES_LOAD_ERROR:"RES_LOAD_ERROR",RES_LOAD_ERROR_2:"RES_LOAD_ERROR_2",NET_ERROR:"NET_ERROR",NET_ERROR_2:"NET_ERROR_2",SEND_HEART_SUCCESS:"SEND_HEART_SUCCESS",NOTIFY_FRIEND_BY_WECHAT:"NOTIFY_FRIEND_BY_WECHAT",NOTIFY_FRIEND_BY_QQ:"NOTIFY_FRIEND_BY_QQ",NOTIFY_FRIEND_GO_ONLINE_NOW:"NOTIFY_FRIEND_GO_ONLINE_NOW",MERGED_LAST_RANK:"MERGED_LAST_RANK",ADD_MERGED_PARTAKE_COUNT_TIP:"ADD_MERGED_PARTAKE_COUNT_TIP",SHARE:"SHARE",WEEK_MATCH_INVITE_TITLE:"WEEK_MATCH_INVITE_TITLE",WEEK_MATCH_HEX_CRUSH_INVITE_DESCRIBE:"WEEK_MATCH_HEX_CRUSH_INVITE_DESCRIBE",WEEK_MATCH_HEX_CRUSH_SHARE_DESCRIBE:"WEEK_MATCH_HEX_CRUSH_SHARE_DESCRIBE",WEEK_MATCH_MERGED_INVITE_DESCRIBE:"WEEK_MATCH_MERGED_INVITE_DESCRIBE",WEEK_MATCH_MERGED_SHARE_DESCRIBE:"WEEK_MATCH_MERGED_SHARE_DESCRIBE",USE_DIAMONDS_BUY_WEEK_MATCH_TICKET:"USE_DIAMONDS_BUY_WEEK_MATCH_TICKET",USE_COIN_BUY_WEEK_MATCH_TICKET:"USE_COIN_BUY_WEEK_MATCH_TICKET",WEEK_MATCH_REWARD_TITLE_1:"WEEK_MATCH_REWARD_TITLE_1",WEEK_MATCH_REWARD_TITLE_2:"WEEK_MATCH_REWARD_TITLE_2",WEEK_MATCH_REWARD_TITLE_3:"WEEK_MATCH_REWARD_TITLE_3",LUCKY_DICE_TITLE_TEXT:"LUCKY_DICE_TITLE_TEXT",LUCKY_DICE_NEXT_TEXT:"LUCKY_DICE_NEXT_TEXT",WEEK_MATCH_TICKET_COUT:"WEEK_MATCH_TICKET_COUT",SHARE_SUCCESS:"SHARE_SUCCESS",SHARE_FAIL:"SHARE_FAIL",INVITE_FRIEND_NOTIFY_FAIL:"INVITE_FRIEND_NOTIFY_FAIL"};
var ZhLanguage={APP_NAME:"爱消除乐园",OWN_DIAMONDS_COUNT:"当前拥有的钻石数量:",PROP_OVER_USE_LIMIT:"%s本局使用已达上限咯，现在已经不能使用了呢~T_T~",SINGLE_GAME_PROP_CAN_USE_COUNT_LIMIT:"一局最多使用%d次",BUY_PROP_SUCCESS:"购买道具成功",SETTLEMENT_CHEAT:"哦哦,发现你作弊了哦!(%d)",REWARD_ARRIVAL:"奖励已经到账啦!",LEVEL:"等级:",LOADING_RES:"正在加载资源",LOADING_CONFIG:"正在加载配置",LOGINING:"正在登录",TOUCH_SCREEN_ENTER_GAME:"点击屏幕进入游戏",SCORE_PASSCONDITION:"过关目标:%d分!",PROP_USE_LIMIT:"每局游戏最多只能使用%d种道具",PROP_DESC:"道具说明",TOTAL_COST:"总花费:",CONTINUOUS_USE_DISCOUNT:"连续使用折扣",TEMPORARILY_UNAVAILABLE:"暂不可用",STAGE:"第 %d 关",RES_LOAD_ERROR:"资源加载异常，请调整网络并重试!",RES_LOAD_ERROR_2:"资源加载异常，请检查网络稍候再试!",NET_ERROR:"网络不给力，请调整网络并重试!",NET_ERROR_2:"网络不给力，请稍后重试!",SEND_HEART_SUCCESS:"爱心已发送成功",NOTIFY_FRIEND_BY_WECHAT:"是否微信告诉TA?",NOTIFY_FRIEND_BY_QQ:"是否QQ告诉TA?",NOTIFY_FRIEND_GO_ONLINE_NOW:"请TA参与活动",MERGED_LAST_RANK:"上期榜单",ADD_MERGED_PARTAKE_COUNT_TIP:"哎呀没次数,快选择下面一种方式获得",SHARE:"分享",WEEK_MATCH_INVITE_TITLE:"参赛邀请",WEEK_MATCH_HEX_CRUSH_INVITE_DESCRIBE:"爱消除合体玩法上线，参加六角消除周赛马上体验，无需下载，点击即玩",WEEK_MATCH_HEX_CRUSH_SHARE_DESCRIBE:"爱消除全新合体玩法来袭，参加六角消除周赛，冠军等你加冕！",WEEK_MATCH_MERGED_INVITE_DESCRIBE:"爱消除合体玩法上线，参加合并大师周赛马上体验，无需下载，点击即玩",WEEK_MATCH_MERGED_SHARE_DESCRIBE:"爱消除全新合体玩法来袭，参加合并大师周赛，冠军等你加冕！",USE_DIAMONDS_BUY_WEEK_MATCH_TICKET:"确定使用%d钻石购买吗?",USE_COIN_BUY_WEEK_MATCH_TICKET:"确定使用%d金币购买吗?",WEEK_MATCH_REWARD_TITLE_1:"上周第%d名!获得参与奖励:",WEEK_MATCH_REWARD_TITLE_2:"上周第%d名!参赛人数少于5人,获得参与奖励:",WEEK_MATCH_REWARD_TITLE_3:"上周第%d名!获得奖励:",LUCKY_DICE_TITLE_TEXT:"是否消耗 %d      抽取一个幸运道具？",LUCKY_DICE_NEXT_TEXT:"将再消耗 %d      ，另换一个",WEEK_MATCH_TICKET_COUT:"剩余次数:%d",SHARE_SUCCESS:"分享成功",SHARE_FAIL:"分享失败",INVITE_FRIEND_NOTIFY_FAIL:"邀请通知失败"};
var Language={getString:function(g){return ZhLanguage[g]}};
var ConfigLoader={getPropConfig:function(o,n){for(var t=0,e=ConfigData.ItemConf.list_data.length;t<e;t++){var r=ConfigData.ItemConf.list_data[t];if(r.id==o)return n?Util.clone(r):r}return console.log("getPropConfig config is null : "+o),null},getPropGoodsConfig:function(o,n){var t=this.getGoodsConfig(ArticleType.ARTICLE_TYPE_ATTR,ArticleSubType.ARTICLE_SUB_TYPE_PROP,o,n);return null==t&&console.log("getPropGoodsConfig config is null : "+o),t},getGoodsConfig:function(o,n,t,e){for(var r=0,l=ConfigData.GoodsConf.list_data.length;r<l;r++){var i=ConfigData.GoodsConf.list_data[r];if(i.type==o&&i.subtype==n&&i.article_id==t)return e?Util.clone(i):i}return console.log("getGoodsConfig config is null : "+t),null},getRewardConfig:function(o,n){for(var t=cc.loader.getRes(res.CommRewardPool_json),e=t&&t.list_data||[],r=0,l=e.length;r<l;r++)if(e[r].id==o)return n?Util.clone(e[r]):e[r];return null},getWeekMatchRewardConfig:function(o,n,t){for(var e=cc.loader.getRes(res.weekmatch_rank_reward_conf_bin_json),r=e&&e.list_data||[],l=0,i=r.length;l<i;l++){var a=r[l];if(a.match_id==o&&a.rank_num==n)return t?Util.clone(a):a}return null},_getConfigById:function(o,n){for(var t=0,e=o.length;t<e;t++)if(o[t].ID==n)return Util.clone(o[t]);return console.log("config is null"),null}};
var Loader={load:function(){StorageManager.load(),SettlementDescribe.init(),MusicManager.init(StorageManager.isMusicOpen(),StorageManager.isEffectOpen(),StorageManager.getMusicVolume(),StorageManager.getEffectVolume())}};
var StorageManager={_openMusicKey:null,_openEffectKey:null,_musicVolumeKey:null,_effectVolumeKey:null,_sendHeartStateKey:null,_weekMatchInviteFriendKey:null,_clearWeekMatchLocalStorageFlagKey:null,_weekMatchGameStateKey:null,_bOpenMusic:!0,_bOpenEffect:!0,_musicVolume:.5,_effectVolume:.5,_weekMatchInviteFriendMap:null,_clearWeekMatchLocalStorageFlag:null,_weekMatchGameStateMap:null,load:function(){var e=Util.getBaseStorageKey();e+="_",this._initKey(e),this._bOpenMusic=this._getData(this._openMusicKey,!0),this._bOpenEffect=this._getData(this._openEffectKey,!0),this._musicVolume=this._getData(this._musicVolumeKey,.5),this._effectVolume=this._getData(this._effectVolumeKey,.5),this._weekMatchGameStateMap=this._getData(this._weekMatchGameStateKey,{}),this._weekMatchInviteFriendMap=this._getData(this._weekMatchInviteFriendKey,{}),Util.isArray(this._weekMatchInviteFriendMap)&&(this._weekMatchInviteFriendMap={},cc.sys.localStorage.removeItem(this._weekMatchInviteFriendKey)),this._clearWeekMatchLocalStorageFlag=this._getData(this._clearWeekMatchLocalStorageFlagKey,{})},_initKey:function(e){this._openMusicKey="h5_pz_openMusic",this._openEffectKey="h5_pz_musicVolume",this._musicVolumeKey="h5_pz_musicVolume",this._effectVolumeKey="h5_pz_effectVolume",this._sendHeartStateKey=e+"h5_pz_sendHeartState",this._weekMatchInviteFriendKey=e+"h5_pz_week_match_invite_friend",this._clearWeekMatchLocalStorageFlagKey=e+"h5_pz_clear_week_match_local_storage_flag",this._weekMatchGameStateKey=e+"h5_pz_week_match_game_state"},recordClearWeekMatchLocalStorageFlag:function(e,t){this._clearWeekMatchLocalStorageFlag[e]=t,this._recordData(this._clearWeekMatchLocalStorageFlagKey,this._clearWeekMatchLocalStorageFlag)},getClearWeekMatchLocalStorageFlag:function(e){var t=this._clearWeekMatchLocalStorageFlag[e];return t&&this.recordClearWeekMatchLocalStorageFlag(e,!1),t},getWeekMatchInviteFriend:function(e){return this._weekMatchInviteFriendMap[e]},setWeekMatchGameState:function(e,t){this._weekMatchGameStateMap[e]=this._weekMatchGameStateMap[e]||{};var a=this._weekMatchGameStateMap[e];a.gameState!=t&&(a.gameState=t,this._recordData(this._weekMatchGameStateKey,this._weekMatchGameStateMap))},getWeekMatchGameState:function(e){return null!=this._weekMatchGameStateMap[e]?this._weekMatchGameStateMap[e].gameState:null},clearWeekMatchGameState:function(e){delete this._weekMatchGameStateMap[e],this._recordData(this._weekMatchGameStateKey,this._weekMatchGameStateMap)},addWeekMatchInviteFriendData:function(e,t){this._weekMatchInviteFriendMap[e]=this._weekMatchInviteFriendMap[e]||[];var a=this._weekMatchInviteFriendMap[e];-1==a.indexOf(t)&&(a.push(t),this._recordData(this._weekMatchInviteFriendKey,this._weekMatchInviteFriendMap))},clearWeekMatchInviteFriendData:function(e){delete this._weekMatchInviteFriendMap[e],this._recordData(this._weekMatchInviteFriendKey,this._weekMatchInviteFriendMap)},isMusicOpen:function(){return this._bOpenMusic},openMusic:function(){!0!==this._bOpenMusic&&(this._bOpenMusic=!0,this._recordData(this._openMusicKey,!0))},closeMusic:function(){!1!==this._bOpenMusic&&(this._bOpenMusic=!1,this._recordData(this._openMusicKey,!1))},isEffectOpen:function(){return this._bOpenEffect},openEffect:function(){!0!==this._bOpenEffect&&(this._bOpenEffect=!0,this._recordData(this._openEffectKey,!0))},closeEffect:function(){!1!==this._bOpenEffect&&(this._bOpenEffect=!1,this._recordData(this._openEffectKey,!1))},setMusicVolume:function(e){e!=this._musicVolume&&(this._musicVolume=e,this._recordData(this._musicVolumeKey,e))},getMusicVolume:function(){return this._musicVolume},setEffectVolume:function(e){e!=this._effectVolume&&(this._effectVolume=e,this._recordData(this._effectVolumeKey,e))},getEffectVolume:function(){return this._effectVolume},_getData:function(e,t){var a=cc.sys.localStorage.getItem(e),i=t;try{a&&""!=a&&(i=JSON.parse(a))}catch(e){i=t}return i},_recordData:function(e,t){cc.sys.localStorage.setItem(e,JSON.stringify(t))}};
var page={};page.BasePage=cc.Layer.extend({_leftPanel:null,_rightPanel:null,_topPanel:null,_bottomPanel:null,_middlePanel:null,_enterCallBack:null,_frameRateRecordInterval:null,_frameRateData:null,ctor:function(){this._super();var e=GameCommonDef.DESIGN_RESOLUTION_SIZE.width,t=GameCommonDef.DESIGN_RESOLUTION_SIZE.height;this._leftPanel=this._createPanel({position:cc.p(0,t/2),size:cc.size(.2*e,t),anchorPoint:cc.p(0,.5),name:"leftPanel"}),this.addChild(this._leftPanel,1),this._rightPanel=this._createPanel({position:cc.p(e,t/2),size:cc.size(.2*e,t),anchorPoint:cc.p(1,.5),name:"rightPanel"}),this.addChild(this._rightPanel,1),this._topPanel=this._createPanel({position:cc.p(e/2,t),size:cc.size(e,.2*t),anchorPoint:cc.p(.5,1),name:"topPanel"}),this.addChild(this._topPanel,1),this._bottomPanel=this._createPanel({position:cc.p(e/2,0),size:cc.size(e,.2*t),anchorPoint:cc.p(.5,0),name:"bottomPanel"}),this.addChild(this._bottomPanel,1),this._middlePanel=this._createPanel({position:cc.p(e/2,t/2),size:cc.size(e,t),anchorPoint:cc.p(.5,.5),name:"middlePanel"}),this.addChild(this._middlePanel,1)},_createPanel:function(e){var t=new ccui.Layout;return e.position&&t.setPosition(e.position),e.size&&t.setContentSize(e.size),e.anchorPoint&&t.setAnchorPoint(e.anchorPoint),e.name&&t.setName(e.name),t},setEnterCallBack:function(e){this._enterCallBack=e},onCreate:function(e){},onEnter:function(){this._super(),"function"==typeof this._enterCallBack&&this._enterCallBack(),this._frameRateData={frameRateCount:0,recordCount:0},clearInterval(this._frameRateRecordInterval),this._frameRateRecordInterval=setInterval(function(){this._frameRateData.recordCount++,this._frameRateData.frameRateCount+=cc.profiler.getFrameRate()}.bind(this),1e3)},onExit:function(){this._super(),clearInterval(this._frameRateRecordInterval),this._frameRateData={frameRateCount:0,recordCount:0}},getAverageFrameRate:function(){return 0!=this._frameRateData.recordCount?parseInt(this._frameRateData.frameRateCount/this._frameRateData.recordCount):0}});var PageType={replace:0,jump:1,cover:2},PageOptions=function(e,t,a,n){this.pageType=e||1,this.res=t||[],this.pageData=a||null,this.frameRate=n||30};
var FrameController=function(){this.rootContainer=null,this._pageStack=new Stack,this._curPageID="",this._curPage=null,this._curPageOptions=null,this._isBack=!1,this._init=function(){this.rootContainer=new RootContainer},this._preloadPage=function(e,a){"function"==typeof a&&a()},this._releasePage=function(){},this._pushPageToStack=function(){if(""!=this._curPageID){var e={pageID:this._curPageID,options:this._curPageOptions};this._pageStack.push(e)}}};FrameController.prototype.setFrameRate=function(){var e=this._curPageOptions.frameRate,a=this;e!==a.frameRate&&window.requestAnimFrame(function(){a.frameRate=e,cc.game.setFrameRate(e)})},FrameController.prototype.backToLastPage=function(){console.log("backToLastPage");var e=this._pageStack.pop();if(e){var a=e.pageID,t=e.options;this._isBack=!0,this.switchPageTo(a,t)}},FrameController.prototype.switchPageTo=function(e,a,t){var r=this,o=(a=a||new PageOptions)&&a.res||[];this._preloadPage(o,function(){if(r._isBack){r._isBack=!1;var o=r._curPageOptions&&r._curPageOptions.pageType||PageType.replace;r._releasePage(),r._curPage&&r._curPage.removeFromParent(!0),PageType.cover!==o&&(r._curPage=new page[e],r._curPage.onCreate(a),r._curPage.setEnterCallBack(t),r.rootContainer.addChild(r._curPage))}else{var n=a&&a.pageType||PageType.replace;PageType.replace===n?(r._releasePage(),r._curPage&&r._curPage.removeFromParent(!0),r._pageStack.clear()):PageType.jump===n?(r._releasePage(),r._curPage&&r._curPage.removeFromParent(!0),r._pushPageToStack()):PageType.cover===n&&r._pushPageToStack(),r._curPage=new page[e],r._curPage.onCreate(a),r._curPage.setEnterCallBack(t),r.rootContainer.addChild(r._curPage)}r._curPageID=e,r._curPageOptions=a,eventDispatcher.dispatchEvent(EventID.PAGE_CHANGED,{curPageID:e}),r.setFrameRate()})},FrameController.prototype.removeAllPage=function(){this._releasePage(),this._curPage&&this._curPage.removeFromParent(!0),this._pageStack.clear(),this._curPageID="",this._curPage=null,this._curPageOptions=null},FrameController.prototype.start=function(e,a,t){this._init(),cc.director.runScene(this.rootContainer),this.switchPageTo(e,a,t)},FrameController.prototype.getCurPageID=function(){return this._curPageID},FrameController.prototype.getCurPage=function(){return this._curPage},FrameController.GetInstance=function(){return FrameController._instance||(FrameController._instance=new FrameController),FrameController._instance},FrameController.IsInit=function(){return null!=FrameController._instance};
var RootContainer=cc.Scene.extend({ctor:function(){this._super()},onEnter:function(){this._super(),cc.profiler.isShowingStats()&&UIHelper.attachProfiler(cc.p(0,0),this)},onExit:function(){this._super()}});
var Stack=function(){var t=[];this.push=function(n){t.push(n)},this.pop=function(){return t.pop()},this.front=function(){return t[0]},this.last=function(){return t[t.length-1]},this.isEmpty=function(){return 0==t.length},this.clear=function(){t=[]},this.size=function(){return t.length},this.print=function(){}};
var GlobalObject={init:function(){window.NetLoadingWindow=NetLoadingWindow,window.NetworkRetryWindow=NetworkRetryWindow,window.LanguageKey=LanguageKey,window.Language=Language}};
var ActionLoadingBar=cc.Node.extend({_bActionEnable:!0,_timer:null,_actionTime:1,_onePercentActionTime:null,_percentChangedFinishCallBack:null,_loadingBar:null,ctor:function(e){this._super(),this._updateOnePercentActionTime(),this._loadingBar=e,this._initTimer()},_updateOnePercentActionTime:function(){this._onePercentActionTime=this._actionTime/100},_initTimer:function(){this._timer=new QuantumTimer,this._timer.setSecondTimeCallBack(this._onSecondTimeElapse.bind(this)),this._timer.setEndTimeCallBack(this._onReachEndTime.bind(this)),this._timer.setSecondTimerDuration(this._onePercentActionTime)},_onSecondTimeElapse:function(e){var t=100*e/this._actionTime;this.setPercent(t)},_onReachEndTime:function(){this._timer.pause(),null!=this._percentChangedFinishCallBack&&this._percentChangedFinishCallBack(this)},getPercent:function(){return this._loadingBar.getPercent()},setPercent:function(e){this._loadingBar.setPercent(e)},_configTimer:function(e){var t=this.getPercent()*this._onePercentActionTime,i=e*this._onePercentActionTime;this._timer.setTimeData(t,i)},setPercentWithAction:function(e){e!=this.getPercent()&&(e<0&&(e=0),e>100&&(e=100),this._bActionEnable?this._handlePercentChangedAction(e):this.setPercent(e))},_handlePercentChangedAction:function(e){this._timer.isRunning()&&this._timer.pause(),this._timer.reset(),this._configTimer(e),this._timer.start()},setActionTime:function(e){this._actionTime=e<=0?this._actionTime:e,this._updateOnePercentActionTime(),this._timer.setSecondTimerDuration(this._onePercentActionTime)},setActionEnable:function(e){this._bActionEnable=e,e?this.scheduleUpdate():this.unscheduleUpdate()},setPercentChangedFinishCallBack:function(e){this._percentChangedFinishCallBack=e},isActionEnable:function(){return this._bActionEnable},update:function(e){this._timer.update(e)}});
var ActionText=cc.Node.extend({_bActionEnable:!0,_actionTime:1,_text:null,_currentNumber:0,_targetNumber:0,_coefficient:1,_bWithCommaEnable:!1,_diffValue:0,_increase:0,_bUpdate:!1,ctor:function(t){this._super(),t.setString("0"),this._text=t,this._currentNumber=0,this._targetNumber=0},getTargetNumber:function(){return this._targetNumber},setNumber:function(t){if(this._bActionEnable){if(this._targetNumber==t)return;this._targetNumber=t,this._diffValue=Math.abs(t-this._currentNumber);var e=cc.game.config[cc.game.CONFIG_KEY.frameRate]*this._actionTime;if(this._diffValue<=e)return void this._updateNumber(this._targetNumber);var i=this._targetNumber-this._currentNumber;this._coefficient=Math.abs(i)/i,this._increase=Math.floor(this._diffValue/e),this._bUpdate=!0}else this._updateNumber(t)},_updateNumber:function(t){this._bWithCommaEnable?this._text.setString(this._getNumberWithComma(t)):this._text.setString(t),this._currentNumber=t},setActionTime:function(t){this._actionTime=t},getActionTime:function(){return this._actionTime},getNumber:function(){return this._currentNumber},setWithCommaEnable:function(t){this._bWithCommaEnable=t},isWithCommaEnable:function(){return this._bWithCommaEnable},setActionEnable:function(t){this._bActionEnable=t,t?this.scheduleUpdate():this.unscheduleUpdate()},isActionEnable:function(){return this._bActionEnable},update:function(t){if(this._bUpdate){if(this._diffValue<this._increase)return this._updateNumber(this._targetNumber),void(this._bUpdate=!1);this._currentNumber+=this._increase*this._coefficient,this._diffValue-=this._increase,this._updateNumber(this._currentNumber)}},_getNumberWithComma:function(t){"number"==typeof t&&(t=String(t));return t.replace(/[^0-9]/gi,"").replace(/\B(?=(?:\d{3})+\b)/g,",")}});
var ExtendLoadingBar=cc.Node.extend({_originalSize:null,_percent:null,_layout:null,ctor:function(t){this._super();var i=t.size;this.setContentSize(i),this._originalSize=i,this._percent=0;var e=new ccui.Layout;e.setClippingEnabled(!0),e.setContentSize(0,i.height),this.addChild(e),this._layout=e;var n=0,r=t.leftBarSpriteFrameName,a=null;null!=r&&((a=new cc.Sprite).initWithSpriteFrameName(r),a.setAnchorPoint(0,0),a.setPosition(n,0),e.addChild(a),n+=a.getBoundingBox().width);var o=t.rightBarSpriteFrameName,l=null,h=o==r;null!=o&&((l=new cc.Sprite).initWithSpriteFrameName(o),l.setAnchorPoint(0,0),l.setFlippedX(h),e.addChild(l));var d=t.middleBarSpriteFrameName,s=new cc.Sprite;s.initWithSpriteFrameName(d),s.setAnchorPoint(0,0),s.setPosition(n,0);var c=null!=a?a.getBoundingBox().width:0,u=null!=l?l.getBoundingBox().width:0,g=i.width-(c+u);s.setScaleX(g/s.getBoundingBox().width),e.addChild(s),n+=s.getBoundingBox().width,null!=l&&l.setPosition(n,0)},setPercent:function(t){if(t!==this._percent){t>100&&(t=100),t<0&&(t=0),this._percent=t;var i=this._originalSize.width*this._percent/100;this._layout.setContentSize(i,this._originalSize.height)}},getPercent:function(){return this._percent}});
var ListViewFillOrder={LISTVIEW_FILL_POSITIVE_SEQUENCE:1,LISTVIEW_FILL_INVERTED_SEQUENCE:2},ListViewDirection={LISTVIEW_DIRECTION_HORIZONTAL:1,LISTVIEW_DIRECTION_VERTICAL:2},ListView=cc.Layer.extend({_delegate:null,_itemsData:null,_bTouchEnable:!1,_bBounceEnable:!1,_itemsMargin:0,_fillOrder:ListViewFillOrder.LISTVIEW_FILL_POSITIVE_SEQUENCE,_direction:ListViewDirection.LISTVIEW_DIRECTION_VERTICAL,_touchListener:null,_touchedItem:null,_itemsPositions:null,_itemUsedArray:null,_itemFreeArray:null,_container:null,_minContainerOffset:null,_maxContainerOffset:null,ctor:function(e){this._super(),this._itemUsedArray=new cc.ArrayForObjectSorting,this._itemFreeArray=new cc.ArrayForObjectSorting,this._itemsData=e,this.setTouchEnable(!0)},setViewSize:function(e){this.setContentSize(e)},getViewSize:function(){return this.getContentSize()},setDirection:function(e){this._direction=e},getDirection:function(){return this._direction},setTouchEnable:function(e){this._bTouchEnable!==e&&(this._bTouchEnable=e,this._touchEnabled?(this._touchListener||(this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:this.onTouchMoved.bind(this),onTouchEnded:this.onTouchEnded.bind(this),onTouchCancelled:this.onTouchCancelled.bind(this)})),cc.eventManager.addListener(this._touchListener,this)):cc.eventManager.removeListener(this._touchListener))},isTouchEnable:function(){return this._bTouchEnable},setDelegate:function(e){this._delegate=e},getDelegate:function(){return this._delegate},removeItem:function(e){},insertItem:function(e){},setItemsMargin:function(e){this._itemsMargin=e},getItemsMargin:function(){return this._itemsMargin},setBounceEnable:function(e){this._bBounceEnable=e},isBounceEnable:function(){return this._bBounceEnable},setFillOrder:function(e){this._fillOrder=e},getFillOrder:function(){return this._fillOrder},scrollToItem:function(e){},reload:function(){for(var e=0,t=this._itemUsedArray.count();e<t;e++){var i=this._itemUsedArray.objectAtIndex(e);this._itemFreeArray.addObject(i),i.reset()}this._container.removeAllChildren(!0),this._itemUsedArray=new cc.ArrayForObjectSorting,this._updateItemsPositions(),this._updateLimitContainerOffset(),this._numberOfItemsInListView()>0&&this._scrollView()},getContentOffset:function(){var e=this._container.getPosition();return cc.p(e.x,e.y)},onItemContentSizeChanged:function(e){},onItemDataChanged:function(e){},onTouchBegan:function(e,t){return!0},onTouchMoved:function(e,t){},onTouchEnded:function(e,t){},onTouchCancelled:function(e,t){},_numberOfItemsInListView:function(){return this._itemsData.length},_updateItemsPositions:function(){this._itemsPositions=[];for(var e=this._numberOfItemsInListView(),t=0,i=0,n=null,s=0,r=0;r<e;r++){switch(this._itemsPositions[r]=t,n=this._delegate.itemSizeAtIndex(this,r),this._direction){case ListViewDirection.LISTVIEW_DIRECTION_HORIZONTAL:s=n.width;break;case ListViewDirection.LISTVIEW_DIRECTION_VERTICAL:s=n.height;break;default:console.log("error direction")}t=(i+=s)+(r+1)*this._itemsMargin}this._itemsPositions[e]=t-this._itemsMargin},_updateLimitContainerOffset:function(){var e=0,t=0,i=0,n=0,s=this._numberOfItemsInListView();if(s>0){var r=this._itemsPositions[s],o=this.getContentSize();switch(this._direction){case ListViewDirection.LISTVIEW_DIRECTION_HORIZONTAL:r>o.width?(e=o.width-r,i=0):(e=0,i=o.width-r);break;case ListViewDirection.LISTVIEW_DIRECTION_VERTICAL:r>o.height?(t=o.height-r,n=0):(t=0,n=o.height-r);break;default:console.log("error direction")}}this._minContainerOffset=cc.size(e,t),this._maxContainerOffset=cc.size(i,n)},_scrollView:function(){if(0!=this._numberOfItemsInListView())switch(this._direction){case ListViewDirection.LISTVIEW_DIRECTION_HORIZONTAL:this._handleHorizontalDirectionScroll();break;case ListViewDirection.LISTVIEW_DIRECTION_VERTICAL:this._handleVerticalDirectionScroll();break;default:console.log("error direction")}},_handleVerticalDirectionScroll:function(){var e=this._numberOfItemsInListView(),t=(Math.max(e-1,0),this._getIndexVerticalDirection());-1==t.startIndex||t.startIndex,-1==t.endIndex||t.endIndex},_handleHorizontalDirectionScroll:function(){},_getIndexVerticalDirection:function(){var e=this.getContentOffset(),t=this._numberOfItemsInListView(),i=this._itemsPositions[t],n=this.getContentSize(),s=-e.y,r=i-s-n.height;switch(this._fillOrder){case ListViewFillOrder.LISTVIEW_FILL_POSITIVE_SEQUENCE:case ListViewFillOrder.LISTVIEW_FILL_INVERTED_SEQUENCE:break;default:console.log("error fillOrder")}return{startIndex:this._getIndexByOffset(r),endIndex:this._getIndexByOffset(s)}},_getIndexByOffset:function(e){for(var t=0,i=this._numberOfItemsInListView()-1,n=e;i>=t;){var s=0|t+(i-t)/2,r=this._itemsPositions[s],o=this._itemsPositions[s+1];if(n>=r&&n<=o)return s;n<r?i=s-1:t=s+1}return t<=0?0:-1}}),ListViewItem=cc.Node.extend({setIndex:function(e){},getIndex:function(){return 0},reset:function(){}}),ListViewDelegate=cc.Class.extend({onItemTouchedDown:function(e,t){},onItemTouchedRelease:function(e,t){},itemSizeAtIndex:function(e,t){return cc.size(0,0)},itemAtIndex:function(e,t){return null}});
var UpdateProxy=cc.Class.extend({_updateFunc:null,_bRunning:!1,_timeScale:1,_listener:null,ctor:function(e){this._updateFunc=e,this._listener=cc.EventListener.create({event:cc.EventListener.CUSTOM,eventName:cc.Director.EVENT_AFTER_UPDATE,callback:this._afterUpdate.bind(this)}),cc.eventManager.addListener(this._listener,1),this._timeScale=cc.director.getScheduler().getTimeScale()},_afterUpdate:function(){if(this._bRunning&&null!=this._updateFunc){var e=cc.director.getDeltaTime();1!==this._timeScale&&(e*=this._timeScale),this._updateFunc(e)}},release:function(){this._bRunning=!1,cc.eventManager.removeListener(this._listener)},start:function(){this._bRunning=!0},stop:function(){this._bRunning=!1},pause:function(){this._bRunning=!1},resume:function(){this._bRunning=!0}});
var BlurBgLayer=cc.Node.extend({onShow:function(){},onHide:function(){},onDestroy:function(){}}),BlurBgLayerNull=cc.Node.extend({onShow:function(){},onHide:function(){},onDestroy:function(){}});
var Mask=cc.Layer.extend({_touchedCallBack:null,_bGrey:null,_maskView:null,ctor:function(){this._super()},setGrey:function(e){this._bGrey!==e&&(this._bGrey=e,e?(this._createMask(),this._maskView.setVisible(!0)):this._maskView&&this._maskView.setVisible(!1))},_createMask:function(){if(null==this._maskView){var e=UIHelper.createImage({imageFileName:res.mask_png,position:UIHelper.getCenterPosition(),scale:Math.max(cc.winSize.width/4,cc.winSize.height/4),opacity:180});this.addChild(e),this._maskView=e}},_onTouchBegan:function(e,i){return!0},_onTouchEnded:function(e,i){this._touchedCallBack&&this._touchedCallBack(e,i)},setTouchedCallBack:function(e){this._touchedCallBack=e},onShow:function(){var e=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this._onTouchBegan.bind(this),onTouchEnded:this._onTouchEnded.bind(this)});if(cc.eventManager.addListener(e,this),null!=this._maskView){var i=Math.max(cc.winSize.width/4,cc.winSize.height/4);this._maskView.setScale(i)}},onHide:function(){cc.eventManager.removeListeners(this)},onDestroy:function(){cc.eventManager.removeListeners(this)}});
var ObjectArray=cc.Class.extend({_array:null,ctor:function(){this._array=[]},addObject:function(t){null!=t&&(this._retainObject(t),this._array.push(t))},getObjectByIndex:function(t){return this._checkIndex(t)?this._array[t]:null},removeObject:function(t){if(null!=t){var e=this._array.indexOf(t);e>-1?(this._array.splice(e,1),this._releaseObject(t)):console.log("object is no in array")}},removeObjectByIndex:function(t){if(this._checkIndex(t)){var e=this._array.splice(t,1);this._releaseObject(e)}},removeFirstObject:function(){if(!this.isEmpty()){var t=this._array.shift();this._releaseObject(t)}},removeLastObject:function(){if(!this.isEmpty()){var t=this._array.pop();this._releaseObject(t)}},removeAllObject:function(){for(var t in this._array){var e=this._array.splice(t,1);this._releaseObject(e)}this._array=[]},getFirstObject:function(){return this.isEmpty()?null:this._array[0]},getLastObject:function(){return this.isEmpty()?null:this._array[this._array.length-1]},isEmpty:function(){return 0==this._array.length},size:function(){return this._array.length},_checkIndex:function(t){if(t<0)return!1;return!(t>=this._array.length)},_retainObject:function(t){if(t)t.retain&&t.retain();else if(Util.isArray(t)||Util.isObject(t))for(var e in t)this._retainObject(t[e])},_releaseObject:function(t){if(t)t.release&&t.release();else if(Util.isArray(t)||Util.isObject(t))for(var e in t)this._releaseObject(t[e])}});
var WindowAction={getScaleEaseElasticOutAction:function(e){if(null==e)return null;e.setScale(.9);var c=new cc.ScaleTo(1,1);c.easing(cc.easeElasticOut(.25));var n=new cc.CallFunc(this._onActionComplete,this);return new cc.Sequence(c,n)},getSlideDownwardAction:function(e){if(null==e)return null;var c=e.getPosition();e.setPositionY(c.y+cc.winSize.height);var n=new cc.MoveTo(.75,c).easing(cc.easeElasticOut(.7)),t=new cc.CallFunc(this._onActionComplete,this);return new cc.Sequence(n,t)},getUpGlideAction:function(e){if(null==e)return null;var c=cc.p(e.getPositionX(),e.getPositionY()+cc.winSize.height),n=new cc.MoveTo(.75,c).easing(cc.easeElasticIn(.7)),t=new cc.CallFunc(this._onActionComplete,this);return new cc.Sequence(n,t)},geFadeIntAction:function(e){if(null==e)return null;e.setScale(1.3),e.setOpacity(102);var c=cc.scaleTo(7/30,1),n=cc.fadeIn(7/30),t=new cc.CallFunc(this._onActionComplete,this);return cc.sequence(cc.spawn(c,n),t)},setActionCompleteCallBack:function(e){this._actionCompleteCallBack=e},_onActionComplete:function(e){this._actionCompleteCallBack(e)}};
var WindowManager=cc.Class.extend({_showModalWindowList:null,_hideModalWindowList:null,_destroyModalWindowList:null,_blurBgLayer:null,_blurBgLayerNull:null,ctor:function(){this._showModalWindowList=new ObjectArray,this._hideModalWindowList=new ObjectArray,this._destroyModalWindowList=new ObjectArray},showWindow:function(i,o,n,t,e,d,s,l){if(null!=i){null==s&&(s=cc.director.getRunningScene());var r=this._isExistModalWindowInHideList(i);if(r.bExist)this._showModalWindowList.addObject(r.modalWindow),this._hideModalWindowList.removeObjectByIndex(r.index),this._showModalWindow(r.modalWindow,o,t,s);else if((r=this._isExistModalWindowInShowList(i)).bExist);else{var a={window:i,mask:this._createMask(n,d),blur:this._getBlurBgLayer(e),destroyFun:l};this._showModalWindowList.addObject(a),this._showModalWindow(a,o,t,s)}var w=this._showModalWindowList.size()-2,h=this._showModalWindowList.getObjectByIndex(w);this._coverModalWindow(h)}},_getBlurBgLayer:function(i){return i?(null==this._blurBgLayer&&(this._blurBgLayer=new BlurBgLayer,this._blurBgLayer.retain()),this._blurBgLayer):(null==this._blurBgLayerNull&&(this._blurBgLayerNull=new BlurBgLayerNull,this._blurBgLayerNull.retain()),this._blurBgLayerNull)},hideWindow:function(i,o){if(null!=i){var n=this._isExistModalWindowInShowList(i);n.bExist&&(this._hideModalWindowList.addObject(n.modalWindow),this._showModalWindowList.removeObjectByIndex(n.index),this._hideModalWindow(n.modalWindow,o),this._resumeModalWindow(n.previousModalWindow))}},hideAllWindow:function(){for(var i=this._showModalWindowList.size()-1;i>=0;i--){var o=this._showModalWindowList.getObjectByIndex(i);this.hideWindow(o.window)}eventDispatcher.dispatchEvent(EventID.HIDE_ALL_WINDOW)},destroyWindow:function(i,o){if(null!=i){var n=this._isExistModalWindowInShowList(i);n.bExist&&(this._destroyModalWindowList.addObject(n.modalWindow),this._showModalWindowList.removeObjectByIndex(n.index),this._destroyModalWindow(n.modalWindow,o),this._resumeModalWindow(n.previousModalWindow))}},destroyAllWindow:function(){for(var i=this._showModalWindowList.size()-1;i>=0;i--){var o=this._showModalWindowList.getObjectByIndex(i),n=this._showModalWindowList.getObjectByIndex(i-1);"function"==typeof o.destroyFun&&o.destroyFun(),this._resumeModalWindow(n)}for(i=this._hideModalWindowList.size()-1;i>=0;i--){"function"==typeof(o=this._hideModalWindowList.getObjectByIndex(i)).destroyFun&&o.destroyFun()}this._showModalWindowList.removeAllObject(),this._hideModalWindowList.removeAllObject(),this._blurBgLayer&&this._blurBgLayer.release(),this._blurBgLayerNull&&this._blurBgLayerNull.release(),eventDispatcher.dispatchEvent(EventID.DESTROY_ALL_WINDOW)},_showModalWindow:function(i,o,n,t){if(null!=i){var e=i.blur,d=i.mask,s=i.window;e.removeFromParent(),d.removeFromParent(),s.removeFromParent(),n=n||10,t.addChild(e,n),e.onShow(),t.addChild(d,n),t.addChild(s,n),e.setVisible(!0),d.setVisible(!0),s.setVisible(!0),s.setPosition(cc.winSize.width/2,cc.winSize.height/2),null==o?(d.onShow(),s.onShowNotify(),s.onShow()):(WindowAction.setActionCompleteCallBack(this._onWindowShowActionComplete.bind(this)),d.onShow(),s.onShowNotify(),s.runAction(o))}},_hideModalWindow:function(i,o){if(null!=i){var n=i.window,t=i.mask,e=i.blur;null==o?(n.onHideNotify(),n.onHide(),n.setVisible(!1),t.onHide(),t.setVisible(!1),e.onHide(),e.setVisible(!1)):(WindowAction.setActionCompleteCallBack(this._onWindowHideActionComplete.bind(this)),n.onHideNotify(),n.runAction(o))}},_destroyModalWindow:function(i,o){if(null!=i){var n=i.window,t=i.mask,e=i.blur;null==o?(n.onDestroyNotify(),n.onDestroy(),n.removeFromParent(),t.onDestroy(),t.removeFromParent(),e.onDestroy(),e.removeFromParent()):(WindowAction.setActionCompleteCallBack(this._onWindowDestroyActionComplete.bind(this)),n.onDestroyNotify(),n.runAction(o))}},_onWindowShowActionComplete:function(i){i.onShow()},_onWindowHideActionComplete:function(i){var o=this._isExistModalWindowInHideList(i);if(o.bExist){i=o.modalWindow.window;var n=o.modalWindow.mask,t=o.modalWindow.blur;i.onHide(),i.setVisible(!1),n.onHide(),n.setVisible(!1),t.onHide(),t.setVisible(!1)}},_onWindowDestroyActionComplete:function(i){var o=this._isExistModalWindowInDestroyList(i);if(o.bExist){i=o.modalWindow.window;var n=o.modalWindow.mask,t=o.modalWindow.blur;i.onDestroy(),i.removeFromParent(),n.onDestroy(),n.removeFromParent(),t.onDestroy(),t.removeFromParent(),this._destroyModalWindowList.removeObjectByIndex(o.index)}},_resumeModalWindow:function(i){null!=i&&i.window.onResume()},_coverModalWindow:function(i){null!=i&&i.window.onCover()},_isExistModalWindowInShowList:function(i){var o=this._isExistModalWindowInList(i,this._showModalWindowList);if(o.bExist){var n=o.index,t=this._showModalWindowList.getObjectByIndex(n-1);o.previousModalWindow=t}return o},_isExistModalWindowInHideList:function(i){return this._isExistModalWindowInList(i,this._hideModalWindowList)},_isExistModalWindowInDestroyList:function(i){return this._isExistModalWindowInList(i,this._destroyModalWindowList)},_isExistModalWindowInList:function(i,o){if(null==i||null==o)return{bExist:!1};for(var n=o.size(),t=0;t<n;t++){var e=o.getObjectByIndex(t);if(i==e.window)return{bExist:!0,modalWindow:e,index:t}}return{bExist:!1}},_createMask:function(i,o){var n=new Mask,t=!0===i;return n.setGrey(t),n.setTouchedCallBack(o),n}});WindowManager.GetInstance=function(){return null==WindowManager._instance&&(WindowManager._instance=new WindowManager),WindowManager._instance};
var ButtonTab=TabBase.extend({bSelected:!1,ctor:function(t){this._super(t),t.addTouchEventListener(this._onTabNodeTouched,this)},_onTabNodeTouched:function(t,e){e===ccui.Widget.TOUCH_ENDED&&(this._onTabTouched(),this._updateBrightStyle())},onSelected:function(){this.bSelected=!0,this._updateBrightStyle()},onUnSelected:function(){this.bSelected=!1,this._updateBrightStyle()},_updateBrightStyle:function(){this.bSelected?this._tabNode.setBrightStyle(ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT):this._tabNode.setBrightStyle(ccui.Widget.BRIGHT_STYLE_NORMAL)}});
var PageAction={setActionCompleteCallBack:function(t){this._actionCompleteCallBack=t},_onActionComplete:function(t){this._actionCompleteCallBack(t)}};
var TabPage=cc.Class.extend({_tabPageList:null,_currentTabPage:null,_toggleTabPageCallBackFun:null,_index:-1,ctor:function(){this._tabPageList=[]},getTabPageList:function(){return this._tabPageList},setFocus:function(e){if(this._index!=e)if(e<0)console.log("index less than 0");else if(e>this._tabPageList.length-1)console.log("index greater than length");else{this._index=e;var t=this.getTabPageByIndex(e);this._toggleTabPage(t)}},addTabPage:function(e,t,a,i){if(null!=e&&null!=t){e.setTabTouchedListener(this._onTabTouched.bind(this)),a&&a.retain(),i&&i.retain();var n={tab:e,page:t,pageShowAction:a,pageHideAction:i};this._tabPageList.push(n),t.getPageNode().setVisible(!1)}else console.log("tab or page is null")},onDestroy:function(){for(var e=0,t=this._tabPageList.length;e<t;e++){var a=this._tabPageList[e];a.tab.onDestroy(),a.tab.getTabNode().removeFromParent(),a.page.onDestroy(),a.page.getPageNode().removeFromParent(),a.pageShowAction&&a.pageShowAction.release(),a.pageHideAction&&a.pageHideAction.release()}this._tabPageList=[],this._currentTabPage=null,this._toggleTabPageCallBackFun=null,this._index=-1},setToggleTabPageCallBack:function(e){this._toggleTabPageCallBackFun=e},_onTabTouched:function(e){if(null!=e){var t=this._isExistTabPageByTab(e);if(t.bExist){if(null==t.tabPage||t.tabPage==this._currentTabPage)return;this._index=t.index,this._toggleTabPage(t.tabPage)}}},_toggleTabPage:function(e){this._hideTabPage(this._currentTabPage),this._showTabPage(e);var t=this._currentTabPage;this._currentTabPage=e,this._callToggleTabPageCallBack(this._currentTabPage,t)},getCurrentTabPage:function(){return this._currentTabPage},_callToggleTabPageCallBack:function(e,t){if(null!=e&&null!==this._toggleTabPageCallBackFun){var a=null!=t?t.tab:null,i=null!=t?t.page:null;this._toggleTabPageCallBackFun(e.tab,e.page,a,i)}},_showTabPage:function(e){if(null!=e){var t=e.tab,a=e.page;null==e.pageShowAction?(t.onSelected(),a.onShowNotify(t),a.onShow(t)):(PageAction.setActionCompleteCallBack(this._onPageShowActionComplete.bind(this)),t.onSelected(),a.onShowNotify(t),a.getPageNode().runAction(e.pageShowAction.clone())),a.getPageNode().setVisible(!0)}},_hideTabPage:function(e){if(null!=e){var t=e.tab,a=e.page;null==e.pageHideAction?(t.onUnSelected(),a.onHideNotify(t),a.onHide(t),a.getPageNode().setVisible(!1)):(PageAction.setActionCompleteCallBack(this._onPageHideActionComplete.bind(this)),t.onUnSelected(),a.onHideNotify(t),a.getPageNode().runAction(e.pageHideAction.clone()))}},_isExistTabPageByTab:function(e){if(null==e)return{bExist:!1};for(var t=0,a=this._tabPageList.length;t<a;t++)if(e==this._tabPageList[t].tab)return{bExist:!0,tabPage:this._tabPageList[t],index:t};return{bExist:!1}},getTabPageByIndex:function(e){for(var t=0,a=this._tabPageList.length;t<a;t++)if(t==e)return this._tabPageList[t];return null},_isExistTabPageByPageNode:function(e){if(null==e)return{bExist:!1};for(var t=0,a=this._tabPageList.length;t<a;t++)if(e==this._tabPageList[t].page.getPageNode())return{bExist:!0,tabPage:this._tabPageList[t]};return{bExist:!1}},_onPageShowActionComplete:function(e){var t=this._isExistTabPageByPageNode(e);if(t.bExist){var a=t.tabPage.tab;t.tabPage.page.onShow(a)}},_onPageHideActionComplete:function(e){var t=this._isExistTabPageByPageNode(e);if(t.bExist){var a=t.tabPage.tab,i=t.tabPage.page;i.onHide(a),i.getPageNode().setVisible(!1)}}});
var TipManager=cc.Class.extend({_tipList:null,_tipPanel:null,init:function(){this._tipList=new Array;var t=new ccui.Layout;t.setAnchorPoint(.5,.5),t.setBackGroundColor(cc.color(0,0,0)),t.setBackGroundColorOpacity(180),t.setBackGroundColorType(ccui.Layout.BG_COLOR_SOLID);var e=new ccui.Text;e.setTextColor(cc.color(255,255,255)),e.setFontSize(30),e.setName("tipText"),t.addChild(e),this._tipPanel=t,this._tipPanel.retain()},_cascadeColorOpacity:function(t){t.setCascadeColorEnabled(!0),t.setCascadeOpacityEnabled(!0);for(var e=t.getChildren(),i=0;i<e.length;i++){var n=e[i];this._cascadeColorOpacity(n)}},showTip:function(t,e){if("string"==typeof t){var i=this._tipPanel.clone();this._cascadeColorOpacity(i);var n=i.getChildByName("tipText");n.ignoreContentAdaptWithSize(!0),n.setString(t),i.setContentSize(n.getContentSize().width+20,100);var c=e||cc.p(cc.winSize.width/2,cc.winSize.height/2);i.setPosition(c),n.setPosition(i.getContentSize().width/2,i.getContentSize().height/2),cc.director.getRunningScene().addChild(i,GameCommonDef.LAYER_Z_ORDER_TIP_UI);var a=new cc.DelayTime(1),o=new cc.FadeOut(3),r=new cc.CallFunc(this._actionComplete,this),s=new cc.Sequence(a,o,r);if(i.runAction(s),this._isNeedMoveAllTip()){var l=i.getContentSize().height+5;this._moveAllTip(l)}this._tipList.push(i)}},_actionComplete:function(t){cc.arrayRemoveObject(this._tipList,t),t.removeFromParent()},_moveAllTip:function(t){for(var e in this._tipList){var i=new cc.MoveBy(.1,cc.p(0,t));this._tipList[e].runAction(i)}},_isNeedMoveAllTip:function(){return!1},removeAllTip:function(){for(var t in this._tipList)this._tipList[t].removeFromParent(),this._tipList.splice(t,1)}});TipManager.GetInstance=function(){return null==TipManager._instance&&(TipManager._instance=new TipManager,TipManager._instance.init()),TipManager._instance};
var NodeType={SPRITE:1,PANEL:2},UIHelper={calculateShowAllScale:function(e,t){var i=t.width,n=t.height,c=e.width,o=e.height,r=i/c,a=n/o,l=0;return r<a?(i,o*(l=r)):(c*(l=a),n),l},copyProperties:function(e,t){cc.sys.isNative?e.copyProperties(t):e._copyProperties(t)},loadUI:function(e){return ccs.load(e).node},adjustUILayout:function(e){var t=cc.winSize,i=GameCommonDef.DESIGN_RESOLUTION_SIZE;if(i.width!=t.width||i.height!=t.height)if(GameCommonDef.RESOLUTION_POLICY==cc.ResolutionPolicy.FIXED_WIDTH){cc.log("UIHelper:adjustUILayout");e.getContentSize();if(null!=(a=ccui.helper.seekWidgetByName(e,"bgImage"))){a.y=t.height/2;var n=a.getContentSize(),c=t.width/n.width,o=t.height/n.height;cc.log("scaleX: "+c+", scaleY: "+o),a.setScale(c>o?c:o)}null!=(l=ccui.helper.seekWidgetByName(e,"topPanel"))&&(l.y=t.height);null!=(u=ccui.helper.seekWidgetByName(e,"rightPanel"))&&(u.y=t.height/2);var r=ccui.helper.seekWidgetByName(e,"leftPanel");null!=r&&(r.y=t.height/2);if(null!=(d=ccui.helper.seekWidgetByName(e,"middlePanel"))&&(d.y=t.height/2),iphoneXMode){null!=(s=ccui.helper.seekWidgetByName(e,"bottomPanel"))&&(s.y+=(t.height-GameCommonDef.DESIGN_RESOLUTION_SIZE.height)/2)}}else if(GameCommonDef.RESOLUTION_POLICY==cc.ResolutionPolicy.FIXED_HEIGHT){var a;e.getContentSize();if(null!=(a=ccui.helper.seekWidgetByName(e,"bgImage"))){a.x=t.width/2;n=a.getContentSize(),c=t.width/n.width,o=t.height/n.height;cc.log("scaleX: "+c+", scaleY: "+o),a.setScale(c>o?c:o)}var l;null!=(l=ccui.helper.seekWidgetByName(e,"topPanel"))&&(l.x=t.width/2);var s;null!=(s=ccui.helper.seekWidgetByName(e,"bottomPanel"))&&(s.x=t.width/2);var u;null!=(u=ccui.helper.seekWidgetByName(e,"rightPanel"))&&(u.x=t.width);var d;null!=(d=ccui.helper.seekWidgetByName(e,"middlePanel"))&&(d.x=t.width/2)}},adjustBgImage:function(e){var t=cc.winSize,i=GameCommonDef.DESIGN_RESOLUTION_SIZE;if(i.width!=t.width||i.height!=t.height)if(GameCommonDef.RESOLUTION_POLICY==cc.ResolutionPolicy.FIXED_WIDTH){if(cc.log("UIHelper:adjustBgImage"),null!=e){e.y=t.height/2;var n=t.width/i.width,c=t.height/i.height;cc.log("scaleX: "+n+", scaleY: "+c),e.setScale(n>c?n:c)}}else if(GameCommonDef.RESOLUTION_POLICY==cc.ResolutionPolicy.FIXED_HEIGHT&&null!=e){e.x=t.width/2;n=t.width/i.width,c=t.height/i.height;cc.log("scaleX: "+n+", scaleY: "+c),e.setScale(n>c?n:c)}},adjustLoginBg:function(e){var t=cc.winSize,i=GameCommonDef.DESIGN_RESOLUTION_SIZE;if(i.width!=t.width||i.height!=t.height)if(GameCommonDef.RESOLUTION_POLICY==cc.ResolutionPolicy.FIXED_WIDTH){if(console.log("UIHelper:adjustLoginBg"),null!=e)var n=t.height/i.height}else if(GameCommonDef.RESOLUTION_POLICY==cc.ResolutionPolicy.FIXED_HEIGHT&&null!=e){var c=t.width/i.width;n=t.height/i.height;console.log("scaleX: "+c+", scaleY: "+n),e.setScale(c>n?c:n),c>1.1&&e.setScaleY(1.1)}},subsectionTextForUIText:function(e,t,i,n){if(this.isUITextObject(e))if("number"!=typeof i||i<=0)console.log("lineWidth parameter error");else if(i<e.getFontSize())console.log("lineWidth less than fontSize");else if("string"==typeof t){n=null==n?cc.TEXT_ALIGNMENT_CENTER:cc.TEXT_ALIGNMENT_LEFT;e.setTextHorizontalAlignment(n),e.ignoreContentAdaptWithSize(!1),e.setTextAreaSize(cc.size(i,0)),e.setString(t),e.setTextAreaSize(e.getVirtualRendererSize())}else console.log("str parameter error");else console.log("uiText parameter error")},isNodeObject:function(e){return e instanceof cc.Node},isUISliderObject:function(e){return e instanceof ccui.Slider},isWidgetObject:function(e){return e instanceof ccui.Widget},isUITextObject:function(e){return e instanceof ccui.Text},isUITextFieldObject:function(e){return e instanceof ccui.TextField},isUIButtonObject:function(e){return e instanceof ccui.Button},isUIImageViewObject:function(e){return e instanceof ccui.ImageView},isUIPanelObject:function(e){return e instanceof ccui.Layout},isUIListViewObject:function(e){return e instanceof ccui.ListView},isUIPageViewObject:function(e){return e instanceof ccui.PageView},isUIScrollViewObject:function(e){return e instanceof ccui.ScrollView},isUIScale9SpriteObject:function(e){return e instanceof ccui.Scale9Sprite},isSpriteObject:function(e){return e instanceof cc.Sprite},bindUIWidget:function(e,t){var i=this.loadUI(t);return this.bindUIWidgetToObject(e,i),i},bindUIWidgetToObject:function(e,t){if(Util.isObject(e))if(this.isNodeObject(t))for(var i=t.getChildren(),n=0;n<i.length;n++){var c=i[n];this._ignoreContentSize(c),this._handleUIWidget(e,c),this.bindUIWidgetToObject(e,c)}else console.log("uiRoot is not node type");else console.log("object is not object type")},_handleUIWidget:function(e,t){var i=t.getName();Util.startsWithString(i,"_")&&(e[i]=t,this.bindUIWidgetTouchListener(e,t))},_ignoreContentSize:function(e){if(this.isUITextObject(e)||this.isUITextFieldObject(e)){e.ignoreContentAdaptWithSize(!0);var t=e.getString();e.setString(""),e.setString(t)}},bindUIWidgetTouchListener:function(e,t){if(Util.isObject(e))if(this.isWidgetObject(t)){var i=t.getName();if(Util.startsWithString(i,"_")){i=i.substring(1);var n="_on"+(i=Util.upperFirstLetter(i))+"Touched";"function"==typeof e[n]&&(this.isUIButtonObject(t)?t.addTouchEventListener(e[n],e):this.isUIListViewObject(t)?t.addEventListener(e[n],e):this.isUIPageViewObject(t)?t.addEventListener(e[n],e):this.isUIScrollViewObject(t)?t.addEventListener(e[n],e):this.isUISliderObject(t)?t.addEventListener(e[n],e):this.isUITextFieldObject(t)?t.addEventListener(e[n],e):this.isUIPanelObject(t)&&t.addTouchEventListener(e[n],e))}}else console.log("uiWidget is not widget type");else console.log("object is not object type")},showPopUpTips:function(e,t,i,n,c){var o=new cc.LabelTTF(t,"Arial",i);if(n&&o.setColor(n),o.setAnchorPoint(cc.p(.5,.5)),c)o.setPosition(c);else{var r=e.getContentSize();o.setPosition(cc.p(r.width/2,r.height/2))}e.addChild(o,100);var a=new cc.Sequence(cc.moveBy(.5,cc.p(0,50)),cc.removeSelf());o.runAction(a)},release:function(e){e&&e.release&&e.release()},retain:function(e){e&&e.retain&&e.retain()},clipLongTextLabel:function(e,t,i,n,c){if(cc.isString(t)){var o="";if(e||(e=new cc.LabelTTF(t,"Arial",i)),e.setString(t),e.getContentSize().width>n)if(null!=c)o=t.substring(0,c-1)+"...";else for(var r=t.length,a=r-2;r>=0&&(o=t.substring(0,a)+"...",e.setString(o),!(e.getContentSize().width<=n));a--);else o=t;return o}},getCenterPosition:function(){return cc.p(cc.winSize.width/2,cc.winSize.height/2)},getPosition:function(e,t){return cc.p(e/GameCommonDef.DESIGN_RESOLUTION_SIZE.width*cc.winSize.width,t/GameCommonDef.DESIGN_RESOLUTION_SIZE.height*cc.winSize.height)},createImage:function(e){var t=new ccui.ImageView,i=e.bPlistTexture?ccui.Widget.PLIST_TEXTURE:ccui.Widget.LOCAL_TEXTURE;return t.loadTexture(e.imageFileName,i),!0===e.bScale9Enabled?t.setScale9Enabled(!0):!1===e.bScale9Enabled&&t.setScale9Enabled(!1),e.capInsets&&t.setCapInsets(e.capInsets),this._fillAttribute(t,e),t},createLoadingBar:function(e){var t=new ccui.LoadingBar,i=e.bPlistTexture?ccui.Widget.PLIST_TEXTURE:ccui.Widget.LOCAL_TEXTURE;t.loadTexture(e.imageFileName,i);var n=e.bRightToLeft?ccui.LoadingBar.TYPE_RIGHT:ccui.LoadingBar.TYPE_LEFT;return t.setDirection(n),null!=e.percent&&t.setPercent(e.percent),!0===e.bScale9Enabled?t.setScale9Enabled(!0):!1===e.bScale9Enabled&&t.setScale9Enabled(!1),e.capInsets&&t.setCapInsets(e.capInsets),this._fillAttribute(t,e),t},createButton:function(e){var t=new ccui.Button,i=e.bPlistTexture?ccui.Widget.PLIST_TEXTURE:ccui.Widget.LOCAL_TEXTURE;return e.normalFile&&t.loadTextureNormal(e.normalFile,i),e.pressedFile&&t.loadTexturePressed(e.pressedFile,i),e.disabledFile&&t.loadTextureDisabled(e.disabledFile,i),!0===e.bScale9Enabled?t.setScale9Enabled(!0):!1===e.bScale9Enabled&&t.setScale9Enabled(!1),e.capInsets&&t.setCapInsets(e.capInsets),!0===e.bPressedActionEnabled?t.setPressedActionEnabled(!0):!1===e.bPressedActionEnabled&&t.setPressedActionEnabled(!1),!0===e.bTouchEnable?t.setTouchEnabled(!0):!1===e.bTouchEnable&&t.setTouchEnabled(!1),this._fillAttribute(t,e),t},createSlider:function(e){var t=new ccui.Slider,i=e.bPlistTexture?ccui.Widget.PLIST_TEXTURE:ccui.Widget.LOCAL_TEXTURE;return e.barTextureFile&&t.loadBarTexture(e.barTextureFile,i),e.progressBarTexture&&t.loadProgressBarTexture(e.progressBarTexture,i),e.slidBallTextureNormal&&t.loadSlidBallTextureNormal(e.slidBallTextureNormal,i),e.bScale9Enabled&&t.setScale9Enabled(e.bScale9Enabled),e.percent&&t.setPercent(e.percent),e.position&&t.setPosition(e.position),e.anchorPoint&&t.setAnchorPoint(e.anchorPoint),e.contentSize&&t.setContentSize(e.contentSize),t},createPanel:function(e){var t=new ccui.Layout;e.colorType&&t.setBackGroundColorType(e.colorType),e.bgColor&&t.setBackGroundColor(e.bgColor);var i=e.bPlistTexture?ccui.Widget.PLIST_TEXTURE:ccui.Widget.LOCAL_TEXTURE;return e.backgroundImage&&t.setBackGroundImage(e.backgroundImage,i),!0===e.bTouchEnable?t.setTouchEnabled(!0):!1===e.bTouchEnable&&t.setTouchEnabled(!1),this._fillAttribute(t,e),t},createText:function(e){var t=new ccui.Text;return null!=e.fontName?t.setFontName(e.fontName):t.setFontName("Arial"),e.fontSize&&t.setFontSize(e.fontSize),e.content&&t.setString(e.content),null!=e.fontColor?t.setTextColor(e.fontColor):t.setTextColor(cc.color(0,0,0)),!0===e.bIgnoreSize?t.ignoreContentAdaptWithSize(!0):!1===e.bIgnoreSize&&t.ignoreContentAdaptWithSize(!1),this._fillAttribute(t,e),t},createList:function(e){var t=new ccui.ListView;null!=e.anchorPoint&&t.setAnchorPoint(e.anchorPoint),null!=e.position&&t.setPosition(e.position),null!=e.direction&&t.setDirection(e.direction),null!=e.bounceEnabled&&t.setBounceEnabled(e.bounceEnabled),null!=e.touchEnabled&&t.setTouchEnabled(e.touchEnabled),null!=e.contentSize&&t.setContentSize(e.contentSize);var i=e.bPlistTexture?ccui.Widget.PLIST_TEXTURE:ccui.Widget.LOCAL_TEXTURE;return e.backgroundImage&&t.setBackGroundImage(e.backgroundImage,i),!0===e.bBgScale9Enabled?t.setBackGroundImageScale9Enabled(!0):!1===e.bBgScale9Enabled&&t.setBackGroundImageScale9Enabled(!1),e.bgCapInsets&&t.setBackGroundImageCapInsets(e.bgCapInsets),t},createRewardPreviewPanel:function(e){var t=e&&e.length||0,i=UIHelper.createImage({imageFileName:"preview_panel.png",bScale9Enabled:!0,capInsets:cc.rect(10,10,180,114),bPlistTexture:!0,size:cc.size(220,20+50*t)}),n=UIHelper.createList({anchorPoint:cc.p(0,0),contentSize:cc.size(200,50*t),direction:ccui.ScrollView.DIR_VERTICAL,bounceEnabled:!1,touchEnabled:!0,position:cc.p(10,10)});i.addChild(n);for(var c=function(e,t){var i=UIHelper.createPanel({anchorPoint:cc.p(0,0),position:cc.p(0,0),size:cc.size(200,50)}),n=new cc.Sprite;n.initWithSpriteFrameName(t.icon),n.setScale(.5),n.setPosition(cc.p(0,25)),n.setAnchorPoint(cc.p(0,.5)),i.addChild(n);var c=new cc.LabelBMFont("X"+t.amount,res.number_white_fnt);if(c.setAnchorPoint(0,.5),c.setPosition(50,25),c.setScale(.9),i.addChild(c),t.probability){var o=UIHelper.createText({position:cc.p(170,25),anchorPoint:cc.p(.5,.5),fontSize:20,fontColor:cc.color(255,255,255),content:"(概率获得)"});i.addChild(o)}return i},o=0;o<t;o++){var r=c(0,e[o]);n.pushBackCustomItem(r)}return i},attachRedPot:function(e,t,i){this.removeRedPot(e);var n=i?"m_red_pot.png":"s_red_pot.png",c=new cc.Sprite;if(c.setName("red_pot"),c.initWithSpriteFrameName(n),c.setPosition(t),e.addChild(c),i){var o=new cc.LabelTTF(""+i,"Arial",18);o.setAnchorPoint(.5,.5),o.setPosition(20,21),c.addChild(o)}},removeRedPot:function(e){var t=e.getChildByName("red_pot");t&&t.removeFromParent()},_fillAttribute:function(e,t){t.position&&e.setPosition(t.position),t.anchorPoint&&e.setAnchorPoint(t.anchorPoint),t.scale&&e.setScale(t.scale),t.size&&e.setContentSize(t.size),t.rotation&&e.setRotation(t.rotation),"number"==typeof t.opacity&&e.setOpacity(t.opacity),!0===t.bVisible?e.setVisible(!0):!1===t.bVisible&&e.setVisible(!1)},seekWidgetByName:function(e,t,i){if(null==e)return this._createDefaultNodeByType(i);var n=ccui.helper.seekWidgetByName(e,t);return null!=n?n:this._createDefaultNodeByType(i)},_createDefaultNodeByType:function(e){switch(e){case NodeType.SPRITE:return new cc.Sprite;case NodeType.PANEL:return new ccui.Layout}return new cc.Node},setViewToCenter:function(e,t,i){var n=e.getContentSize(),c=e.getAnchorPoint(),o=e.getPosition(),r=o.y-c.y*n.height,a=r+n.height,l=t.getContentSize(),s=t.getAnchorPoint(),u=r-i-(1-s.y)*l.height;t.setPositionY(u);var d=(a+(u-s.y*l.height))/2,h=cc.winSize.height/2-d;e.setPositionY(o.y+h),t.setPositionY(u+h)},getGuideBgPath:function(e){return"res/pages/guide/popup_"+e+"_bg.png"},attachChangeEnvPanel:function(e,t){var i=UIHelper.createPanel({bTouchEnable:!0,anchorPoint:COMMON_ANCHOR.leftTop,position:e,size:cc.size(250,80)});t.addChild(i,GameCommonDef.LAYER_Z_ORDER_TIP_UI),i.addTouchEventListener(this.onEnvLabelTouched,this);var n=UIHelper.createText({anchorPoint:cc.p(0,.5),position:cc.p(0,30),fontSize:35,fontColor:cc.color(255,0,0),content:"切换环境: "+window.serverEnv});i.addChild(n);var c=new ccui.ListView;c.setAnchorPoint(cc.p(0,1)),c.setPosition(e.x,e.y-80),c.setDirection(ccui.ScrollView.DIR_VERTICAL),c.setScrollBarEnabled(!1),c.setBounceEnabled(!1),c.setTouchEnabled(!0),c.setContentSize(200,240),t.addChild(c,GameCommonDef.LAYER_Z_ORDER_TIP_UI),this.envList=c,c.setVisible(!1);for(var o=["daily","test","deploy","online"],r=0;r<4;r++){var a=UIHelper.createPanel({bTouchEnable:!0,anchorPoint:COMMON_ANCHOR.leftBottom,position:cc.p(0,0),size:cc.size(200,60)});a.setName(o[r]),a.addTouchEventListener(this._onEnvItemTouched,this);var l=UIHelper.createText({anchorPoint:cc.p(.5,.5),position:cc.p(100,30),fontSize:35,fontColor:cc.color(0,255,0),content:o[r]});a.addChild(l),c.pushBackCustomItem(a)}},_onEnvItemTouched:function(e,t){if(ccui.Widget.TOUCH_ENDED==t){var i=e.getName();this.envList.setVisible(!1),wx.setStorageSync("serverEnv",i),wx.exitMiniProgram()}},onEnvLabelTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(this.envList.isVisible()?this.envList.setVisible(!1):this.envList.setVisible(!0))},attachProfiler:function(e,t){var i=UIHelper.createPanel({colorType:ccui.Layout.BG_COLOR_SOLID,bgColor:cc.color._getBlue(),anchorPoint:COMMON_ANCHOR.leftBottom,position:e,size:cc.size(120,100)});t.addChild(i,GameCommonDef.LAYER_Z_ORDER_TIP_UI);var n=UIHelper.createText({anchorPoint:cc.p(0,1),position:cc.p(0,50),fontSize:20,fontColor:cc.color._getGreen(),content:"FPS : 60"});i.addChild(n),cc.profiler._customFPSLabel=n;var c=UIHelper.createText({anchorPoint:cc.p(0,1),position:cc.p(0,75),fontSize:20,fontColor:cc.color._getGreen(),content:"SPF : 0.025"});i.addChild(c),cc.profiler._customSPFLabel=c;var o=UIHelper.createText({anchorPoint:cc.p(0,1),position:cc.p(0,100),fontSize:20,fontColor:cc.color._getGreen(),content:"Draws : 0"});i.addChild(o),cc.profiler._customDrawsLabel=o}};
var AutoWindowManager={windowEntry:{},init:function(){this.startOne()},startOne:function(){var t=null,i="";for(var n in this.windowEntry){i=n,t=this.windowEntry[n];break}t&&(this.lastPriority=i,t())},continue:function(){this.lastPriority&&this.windowEntry[this.lastPriority]&&delete this.windowEntry[this.lastPriority],this.startOne()},hasFun:function(){var t=!1;for(var i in this.windowEntry){t=!0;break}return t},add:function(t,i){i=i||1,this.windowEntry[i]=t}};
var AutoWindowTimeLogic=function(t){this.options=t,this.callback=t.callback,this.priority=t.priority,this.last_sign_key=t.last_sign_key,this.init()};AutoWindowTimeLogic.onShowCb=[],AutoWindowTimeLogic.prototype={_listenerList:[],init:function(){this.isCrossOneDay()?this.callback&&this.callback():this.startTiming(),cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,this._onHide.bind(this)),cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,this._onShow.bind(this))},isCrossOneDay:function(){var t=this._getLastSignTime(),i=NetData.now_unix_timestamp,e=this._getYMD(t),n=this._getYMD(i);return n.y>e.y||n.m>e.m||n.d>e.d},startTiming:function(){var t=this._getLastSignTime(),i=NetData.now_unix_timestamp,e=this._getYMD(t),n=new Date(e.y+"/"+e.m+"/"+e.d),a=this.nextSignDate=new Date(n.getTime()+864e5),o=this._getYMD(a/1e3);"last_sign_time"==this.last_sign_key&&o.m!=e.m&&(NetData.month_sign_days=0),this._delayedCallback(1e3*i)},_callback:function(){var t=this;"MainGamePage"!=FrameController.GetInstance().getCurPageID()?this.callback&&this.callback():Util.registerListener(this._listenerList,EventID.PAGE_CHANGED,function(i){"MainGamePage"!=i.curPageID&&(Util.unRegisterListener(this._listenerList,EventID.PAGE_CHANGED),Timeout.registerEx(function(){t.callback&&t.callback()},1e3))}.bind(this))},_getLastSignTime:function(){var t=this.last_sign_key;if(t.indexOf(".")>=0){t=t.split(".");var i=NetData;return t.forEach(function(t){i=i&&i[t]}),i}return NetData[t]},_delayedCallback:function(t){var i=this,e=this.nextSignDate.getTime()-t;this.last_sign_key;e>0?(Timeout.clearTimeoutEx(this.t),this.t=Timeout.registerEx(function(){i._addCb()},e),AutoWindowManager.continue()):i._callback()},_addCb:function(){var t=this,i=AutoWindowManager.hasFun();AutoWindowManager.add(function(){t._callback()},this.priority),i||AutoWindowManager.startOne()},_getYMD:function(t){var i=new Date(1e3*t);return{y:i.getFullYear(),m:i.getMonth()+1,d:i.getDate()}},_onHide:function(){Timeout.clearTimeoutEx(this.t)},_onShow:function(){var t=this;this.nextSignDate&&(Timeout.clearTimeoutEx(this._onShowTimeout),this._onShowTimeout=Timeout.registerEx(function(){AutoWindowTimeLogic.onShowCb.push(function(i,e){var n=(new Date).getTime();e?t._delayedCallback(1e3*e.server_timestamp):t._delayedCallback(n)}),AutoWindowTimeLogic._heartbeatReq||(AutoWindowTimeLogic._heartbeatReq=!0,GameService.heartbeat(function(t,i){AutoWindowTimeLogic._heartbeatReq=!1;for(var e,n=0;e=AutoWindowTimeLogic.onShowCb[n];n++)e&&e(t,i);AutoWindowTimeLogic.onShowCb=[]},!0))},1e3))}};
var LoginRewardWindow=WindowBase.extend({ctor:function(){this._super(),this.rewardConfig=this.getRewardConfig(),this.initView(),this._listenerList=[],Util.registerListener(this._listenerList,EventID.ON_WINDOW_RESIZE,this._onWindowResize.bind(this))},getRewardConfig:function(){var e=cc.loader.cache[res.month_sign_reward_conf_json],i=cc.loader.cache[res.CommRewardPool_json];e=e&&e.list_data||[];var t={};(i=i&&i.list_data||[]).forEach(function(e){t[e.id]=e});var n=[];return e.forEach(function(e){n.push(t[e.reward_pool_id]||{})}),n},initView:function(){var e=this.wrapperWidth=620,i=this.wrapperHeight=900,t=this.panelWidth=620,n=this.panelHeight=660,o=this.wrapper=UIHelper.createPanel({position:UIHelper.getCenterPosition(),anchorPoint:cc.p(.5,.5),size:cc.size(e,i)});this.addChild(o);var a=this.panel=UIHelper.createImage({imageFileName:"lr_dialog.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(t,n),capInsets:cc.rect(0,84,t,20),position:cc.p(0,i),anchorPoint:cc.p(0,1)});o.addChild(a);var c=UIHelper.createImage({imageFileName:"lr_tt.png",bPlistTexture:!0,anchorPoint:cc.p(.5,1),position:cc.p(t/2,n+35),size:cc.size(212,80)});a.addChild(c);var r=UIHelper.createButton({normalFile:"lr_des_tt.png",bPlistTexture:!0,anchorPoint:cc.p(1,1),position:cc.p(t-35,n-35),bTouchEnable:!0});r.addClickEventListener(this._onDesBtnTouched.bind(this)),a.addChild(r),this.setSignNum(),this.createGridList();var s=UIHelper.createImage({imageFileName:"lr_des_bg.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(594,96),capInsets:cc.rect(92,0,5,96),position:cc.p(t/2,i-n-10),anchorPoint:cc.p(.5,1)}),d=UIHelper.createText({fontSize:20,content:"欢迎你，这是为你今天准备的奖励。\r\n 累计登录天数越多，获得奖励越丰富！",position:cc.p(297,75),anchorPoint:cc.p(.5,1),fontColor:cc.color(255,255,255)});s.addChild(d),o.addChild(s);var l=UIHelper.createButton({normalFile:"lr_btn.png",bPlistTexture:!0,position:cc.p(e/2,0),anchorPoint:cc.p(.5,0),bTouchEnable:!0});l.addClickEventListener(this._onSignBtnTouched.bind(this)),o.addChild(l)},createGridList:function(){var e=new ccui.ListView;e.setAnchorPoint(cc.p(0,1)),e.setPosition(18,this.panelHeight-83),e.setDirection(ccui.ScrollView.DIR_VERTICAL),e.setScrollBarEnabled(!1),e.setBounceEnabled(!0),e.setTouchEnabled(!0),e.setContentSize(588,568),this.panel.addChild(e);for(var i=0;i<6;i++){var t=this.createListItem(i);e.pushBackCustomItem(t)}NetData.month_sign_days>19&&Timeout.register(function(){e.jumpToBottom()},30)},createListItem:function(e){this._gridSize=118;var i=e*this._gridSize,t=this._gridSize;0===e&&(t=this._gridSize+10,i=10);for(var n=UIHelper.createPanel({position:cc.p(0,i),anchorPoint:cc.p(0,1),size:cc.size(588,t)}),o=e>=5?3:5,a=0;a<o;a++){var c=this.createGridItem(e,a);n.addChild(c)}return n},createGridItem:function(e,i){var t,n,o=5*e+i,a=this.rewardConfig[o],c=i*this._gridSize,r=a.reward_list[0],s=NetData.month_sign_days||0;s>27&&(s=27);var d=o==s;if(d){t=UIHelper.createImage({imageFileName:"lr_grid_hl.png",bPlistTexture:!0,anchorPoint:cc.p(0,1),position:cc.p(c,this._gridSize),size:cc.size(112,112)});var l=new GiftUpEffect;l.setPosition(56,56),l.play(),t.addChild(l),(n=UIHelper.seekWidgetByName(l,"Panel_12"))&&n.setBackGroundColorType(ccui.Layout.BG_COLOR_NONE),n=null;var p=UIHelper.createImage({imageFileName:"today_tag.png",bPlistTexture:!0,anchorPoint:cc.p(0,1),position:cc.p(3,111)});t.addChild(p)}else t=UIHelper.createImage({imageFileName:"lr_grid.png",bPlistTexture:!0,anchorPoint:cc.p(0,1),position:cc.p(c,this._gridSize),size:cc.size(112,112)});t.setTouchEnabled(!0),t.addClickEventListener(this._onGridTouched.bind(this));var h=GameUtil.getGoodsImageById(r.article_type,r.article_subtype,r.article_id),g=UIHelper.createImage({imageFileName:h,bPlistTexture:!0,anchorPoint:cc.p(.5,.5),position:cc.p(56,56)});g.setScale(.8),r.article_type==ArticleType.ARTICLE_TYPE_ATTR&&r.article_subtype==ArticleSubType.ARTICLE_SUB_TYPE_COIN&&g.setScale(.7),d&&n?(g.setPosition(100,100),n.addChild(g)):t.addChild(g);var _=new cc.LabelBMFont(String("X"+r.article_count),res.number_gold_big_fnt);if(_.setPosition(104,8),_.setAnchorPoint(cc.p(1,0)),_.setScale(.8),d)if(this.todayGiftRes=h,this.todayGiftCount="X"+r.article_count,n){_.setPosition(148,52),n.addChild(_)}else t.addChild(_);else t.addChild(_);if(d&&(g.setOpacity(0),_.setOpacity(0),g.runAction(cc.fadeIn(1)),_.runAction(cc.fadeIn(1))),o<s){var u=UIHelper.createImage({imageFileName:"lr_signed_tag.png",bPlistTexture:!0,anchorPoint:cc.p(.5,.5),position:cc.p(56,56)});t.addChild(u)}var f=UIHelper.createImage({imageFileName:"lr_tip_bg.png",bPlistTexture:!0,anchorPoint:cc.p(0,1),position:cc.p(3,111)}),w=UIHelper.createText({fontSize:14,content:a.get_content,position:cc.p(56,25),anchorPoint:cc.p(.5,1),fontColor:cc.color(228,219,131)});return f.name="gridTip",f.visible=!1,f.addChild(w),t.addChild(f),t},setSignNum:function(){var e=NetData.month_sign_days||0,i=UIHelper.createText({fontSize:19,content:"本月已经累计签到"+e+"次",position:cc.p(this.panelWidth/2,this.panelHeight-49),anchorPoint:cc.p(.5,1),fontColor:cc.color(255,255,255)});this.panel.addChild(i)},_onDesBtnTouched:function(){MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),TipWindow.Show("\r\n1. 每月根据累计签到天数领取对应奖励, 每月1号清空签到次数。\r\n\r\n2. 想要领取本月所有奖励, 记得每日登录签到哦~",function(){},cc.TEXT_ALIGNMENT_LEFT,24)},_onGridTouched:function(e){var i=this;MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),clearTimeout(this._gridTipTime),this.curGridTip&&(this.curGridTip.visible=!1);var t=UIHelper.seekWidgetByName(e,"gridTip");t.visible=!0,this.curGridTip=t,this._gridTipTime=Timeout.register(function(){i.curGridTip.visible=!1,i.curGridTip=null},2e3)},_onSignBtnTouched:function(){var e=this;e._onSBTouched||(MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),e._onSBTouched=!0,GameService.sign({month_sign_days:NetData.month_sign_days},function(i,t){e._onSBTouched=!1,t?((t=t.sign_res||t).last_sign_time&&(NetData.last_sign_time=t.last_sign_time),t.month_sign_days&&(NetData.month_sign_days=t.month_sign_days),e._playSignEffect()):(TipWindow.Show(i.ret_desc),LoginRewardWindow.Destroy())}))},_playSignEffect:function(){var e=cc.winSize.width,i=cc.winSize.height,t=this.effectWrapper=UIHelper.createPanel({position:UIHelper.getCenterPosition(),anchorPoint:cc.p(.5,.5),size:cc.size(e,i)});t.setScale(1.5),this.addChild(t);var n=new GiftShineEffect;n.visible=!1,n.setPosition(UIHelper.getCenterPosition()),t.addChild(n);var o=new GiftGetEffect;o.setPosition(UIHelper.getCenterPosition()),o.play(),t.addChild(o);var a=new GiftLightEffect;a.visible=!1,a.setPosition(UIHelper.getCenterPosition()),t.addChild(a),this.wrapper.visible=!1;var c=UIHelper.seekWidgetByName(o,"Panel_8");c.setBackGroundColorType(ccui.Layout.BG_COLOR_NONE);var r=UIHelper.createImage({imageFileName:this.todayGiftRes,bPlistTexture:!0,anchorPoint:cc.p(.5,.5),position:cc.p(100,100)}),s=new cc.LabelBMFont(this.todayGiftCount,res.number_gold_big_fnt);s.setPosition(100,20),s.setAnchorPoint(cc.p(.5,0)),s.setScale(1.1),c.addChild(r),c.addChild(s);setTimeout(function(){a.play(),a.visible=!0,n.play(),n.visible=!0},2200);Timeout.register(function(){LoginRewardWindow.Destroy(),LoginRewardWindow.timeLogic.startTiming()},4e3)},_onWindowResize:function(){UIHelper.adjustBgImage(this.bgImage),this.wrapper&&this.wrapper.setPosition(UIHelper.getCenterPosition()),this.effectWrapper&&this.effectWrapper.setPosition(UIHelper.getCenterPosition())}});LoginRewardWindow.GetInstance=function(){return null==LoginRewardWindow._instance&&(LoginRewardWindow._instance=new LoginRewardWindow),LoginRewardWindow._instance},LoginRewardWindow.Show=function(){ResLoader.showSubResLoadingWindow(ResObjects.getResObject(ResObjectConfig.loginReward),function(){var e=LoginRewardWindow.GetInstance();WindowManager.GetInstance().showWindow(e,null,!0,GameCommonDef.LAYER_Z_ORDER_TIP_UI,!1,null,null,LoginRewardWindow.Destroy)})},LoginRewardWindow.Hide=function(){WindowManager.GetInstance().hideWindow(LoginRewardWindow._instance)},LoginRewardWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(LoginRewardWindow._instance),LoginRewardWindow._instance=null},LoginRewardWindow.Start=function(){var e=this;LoginRewardWindow.timeLogic=new AutoWindowTimeLogic({last_sign_key:"last_sign_time",priority:2,callback:function(){e.Show()}})},Util.isQQIAP()||AutoWindowManager.add(function(){LoginRewardWindow.Start()},2);
var NewbieGiftWindow=WindowBase.extend({ctor:function(){this._super(),this.rewardConfig=this.getRewardConfig(),this.initView(),this._listenerList=[],Util.registerListener(this._listenerList,EventID.ON_WINDOW_RESIZE,this._onWindowResize.bind(this))},getRewardConfig:function(){var e=cc.loader.cache[res.NewUserPool_json];return e=e&&e.list_data||[]},initView:function(){var e=this.panelWidth=620,i=this.panelHeight=880;this.itemHeight=100,this.listHeight=711,this.listWidth=570;var t=this.panel=UIHelper.createImage({imageFileName:"n_g_dialog.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(e,i),capInsets:cc.rect(0,84,e,20),position:UIHelper.getCenterPosition(),anchorPoint:cc.p(.5,.5)});this.addChild(t);var n=UIHelper.createImage({imageFileName:"n_g_flag_l.png",bPlistTexture:!0,anchorPoint:cc.p(0,1),position:cc.p(0,i-30)});t.addChild(n);var a=UIHelper.createImage({imageFileName:"n_g_flag_r.png",bPlistTexture:!0,anchorPoint:cc.p(1,1),position:cc.p(e,i-30)});t.addChild(a);var c=UIHelper.createImage({imageFileName:"n_g_tt.png",bPlistTexture:!0,anchorPoint:cc.p(.5,1),position:cc.p(e/2,i+38)});t.addChild(c);var o=UIHelper.createButton({normalFile:"n_g_back.png",bPlistTexture:!0,anchorPoint:cc.p(.5,.5),position:cc.p(35,i-18),bTouchEnable:!0});o.addClickEventListener(this._onBackBtnTouched.bind(this)),t.addChild(o);var s=UIHelper.createImage({imageFileName:"n_g_subtt.png",bPlistTexture:!0,anchorPoint:cc.p(.5,1),position:cc.p(e/2,i-80)});t.addChild(s);var r=UIHelper.createImage({imageFileName:"n_g_t_bg.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(200,23),capInsets:cc.rect(14,0,20,23),position:cc.p(e/2,i-115),anchorPoint:cc.p(.5,1)});t.addChild(r);var l=this._getDistanceTime()||"",d=UIHelper.createText({fontSize:18,content:l+"后结束",position:cc.p(100,23),anchorPoint:cc.p(.5,1),fontColor:cc.color(255,255,255)});r.addChild(d);var _=this.mainContent=UIHelper.createImage({imageFileName:"n_g_content_bg.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(570,711),capInsets:cc.rect(3,4,40,30),position:cc.p(e/2,i-145),anchorPoint:cc.p(.5,1)});t.addChild(_),this.createList()},createList:function(){var e=new ccui.ListView;e.setAnchorPoint(cc.p(0,1)),e.setPosition(0,this.listHeight),e.setDirection(ccui.ScrollView.DIR_VERTICAL),e.setScrollBarEnabled(!1),e.setBounceEnabled(!0),e.setTouchEnabled(!0),e.setContentSize(this.listWidth,this.listHeight),this.mainContent.addChild(e);for(var i=0;i<7;i++){var t=this.createListItem(i);e.pushBackCustomItem(t)}},createListItem:function(e){this.itemHeight;var i=this.itemHeight;0==e&&(i+=5);var t={size:cc.size(this.listWidth,i)};e%2&&(t.bgColor=cc.color(1,134,149),t.colorType=ccui.Layout.BG_COLOR_SOLID);var n=UIHelper.createPanel(t),a=this.rewardConfig[e];if(a){for(var c,o=a.reward_list||[],s=0;(c=o[s])&&(0!=c.article_type||0!=c.article_subtype||0!=c.article_id);s++){var r=this.createGrid(c,s);n.addChild(r)}var l=NetData.new_user_award_info.already_take_days,d=0;d=e<l?0:e==l?1:2;var _=this.createRightEle(d,e);n.addChild(_)}return n},createGrid:function(e,i){var t=UIHelper.createImage({imageFileName:"n_g_grid.png",bPlistTexture:!0,size:cc.size(86,86),position:cc.p(35+112*i,this.itemHeight/2-3),anchorPoint:cc.p(0,.5)}),n=GameUtil.getGoodsImageById(e.article_type,e.article_subtype,e.article_id),a=UIHelper.createImage({imageFileName:n,bPlistTexture:!0,anchorPoint:cc.p(.5,.5),position:cc.p(43,43)});a.setScale(.8);var c=UIHelper.createImage({imageFileName:"n_g_t_mask.png",bPlistTexture:!0,anchorPoint:cc.p(0,0),position:cc.p(7,9)}),o=UIHelper.createText({fontSize:18,fontName:"Microsoft YaHei",content:"x"+e.article_count,position:cc.p(36,20),anchorPoint:cc.p(.5,1),fontColor:cc.color(255,255,255)});return c.addChild(o),t.addChild(a),t.addChild(c),t},createRightEle:function(e,i){var t;return 0==e?t=this._createSignedTag():1==e?(t=UIHelper.createButton({normalFile:"n_g_btn.png",bPlistTexture:!0,anchorPoint:cc.p(1,.5),position:cc.p(this.listWidth-32,this.itemHeight/2-3),bTouchEnable:!0})).addClickEventListener(this._onBtnTouched.bind(this)):t=UIHelper.createImage({imageFileName:"n_g_num"+(i+1)+".png",bPlistTexture:!0,size:cc.size(81,31),position:cc.p(this.listWidth-35-40,this.itemHeight/2),anchorPoint:cc.p(1,.5)}),t},_onBtnTouched:function(e){var i=this;if(!i._onSBTouched){MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),i._onSBTouched=!0;var t=NetData.new_user_award_info;GameService.takeNewUserAward({already_take_days:t.already_take_days},function(n,a){i._onSBTouched=!1,a?(i.normalReceive=!0,a.last_take_time&&(t.last_take_time=a.last_take_time,console.log("==========================_onBtnTouched:NewbieGiftWindow=========================="),console.log("last_take_time: "+t.last_take_time)),a.already_take_days&&(t.already_take_days=a.already_take_days,console.log("==========================_onBtnTouched:NewbieGiftWindow=========================="),console.log("already_take_days: "+t.already_take_days)),i._playSignEffect(e),i._tipBackClick()):(TipWindow.Show(n.ret_desc),i._onBackBtnTouched())})}},_tipBackClick:function(){var e=this,i=ResObjects.getResObject(ResObjectConfig.clickTip).getResList();i&&i.length&&cc.loader.load(i,function(i,t){if(!i){(n=new Effect(res.guidehand_1_json)).setPosition(cc.p(35,e.panelHeight-18)),e.panel.addChild(n),n.play(!0);var n;(n=new Effect(res.guideeffects_json)).setPosition(cc.p(35,e.panelHeight-18)),e.panel.addChild(n),n.play(!0)}})},_onBackBtnTouched:function(){MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),NewbieGiftWindow.Destroy(),this.normalReceive?NewbieGiftWindow.timeLogic.startTiming():AutoWindowManager.continue()},_createSignedTag:function(){return UIHelper.createImage({imageFileName:"n_g_checked.png",bPlistTexture:!0,size:cc.size(85,82),position:cc.p(this.listWidth-35-40,this.itemHeight/2),anchorPoint:cc.p(1,.5)})},_playSignEffect:function(e){e.setVisible(!1);var i=e.getParent();i&&i.addChild(this._createSignedTag())},_onWindowResize:function(){UIHelper.adjustBgImage(this.bgImage),this.panel&&this.panel.setPosition(UIHelper.getCenterPosition())},_getDistanceTime:function(){var e,i,t,n=1e3*NetData.now_unix_timestamp,a=1e3*NetData.new_user_award_info.activity_end_time-n;if(a>=0)return a-=864e5*(e=Math.floor(a/864e5)),a-=36e5*(i=Math.floor(a/36e5)),a-=6e4*(t=Math.floor(a/6e4)),i<10&&(i="0"+i),t<10&&(t="0"+t),e+"天"+i+"时"+t+"分"}});NewbieGiftWindow.GetInstance=function(){return null==NewbieGiftWindow._instance&&(NewbieGiftWindow._instance=new NewbieGiftWindow),NewbieGiftWindow._instance},NewbieGiftWindow.Show=function(){ResLoader.showSubResLoadingWindow(ResObjects.getResObject(ResObjectConfig.newBieGift),function(){var e=NewbieGiftWindow.GetInstance();WindowManager.GetInstance().showWindow(e,null,!0,GameCommonDef.LAYER_Z_ORDER_TIP_UI,!1,null,null,NewbieGiftWindow.Destroy)})},NewbieGiftWindow.Hide=function(){WindowManager.GetInstance().hideWindow(NewbieGiftWindow._instance)},NewbieGiftWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(NewbieGiftWindow._instance),NewbieGiftWindow._instance=null},NewbieGiftWindow.Start=function(){var e=this,i=NetData.new_user_award_info,t=i.activity_end_time;(NetData.now_unix_timestamp||(new Date).getTime()/1e3)>t||i.already_take_days>=7?AutoWindowManager.continue():this.timeLogic=new AutoWindowTimeLogic({last_sign_key:"new_user_award_info.last_take_time",priority:1,callback:function(){e.Show()}})},Util.isQQIAP()||AutoWindowManager.add(function(){NewbieGiftWindow.Start()},1);
var NoticePanel=cc.Node.extend({_closeCallback:null,_listenerList:null,_noticeItem:null,ctor:function(t,e){this._super(),this._closeCallback=e,this._listenerList=[],Util.registerListener(this._listenerList,EventID.ON_WINDOW_RESIZE,this.onWindowResize.bind(this)),this.setContentSize(cc.winSize),this._noticeItem=t,this._createNoticePanel(t)},_createNoticePanel:function(t){var e=cc.director.getWinSize(),i=UIHelper.createImage({imageFileName:"bg_dialog.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(576,870),capInsets:cc.rect(35,70,480,10),position:cc.p(.5*e.width,.5*e.height-18)});this.addChild(i);var n=t.content.replace(/\n/g,"↵"),c=i.width-2,o=i.height-175;if(1==t.content_type){var l=this._splitStringWithParagraph(n),r=0,h=new ccui.ScrollView;h.setDirection(ccui.ScrollView.DIR_VERTICAL),h.setTouchEnabled(!0),h.setInertiaScrollEnabled(!0),h.setContentSize(c,o),h.x=0,h.y=105,i.addChild(h);var s=new cc.Node;s.setAnchorPoint(0,0);for(var a=0;a<l.length;a++){var d=l[a],g=this._splitStringWithStyle(d),u=new ccui.RichText;u.ignoreContentAdaptWithSize(!1),u.width=h.width-60,u._setAnchorY(.5);for(var p=0;p<g.length;p++){var _=g[p],f=this._getStyle(_);if(null!==_&&_.length>0){var b=new ccui.RichElementText(p,this._getColor(f),255,this._getSubStr(_),"Helvetica",30);u.pushBackElement(b)}}u.x=.5*h.width,r+=u.height+3,u.y=0===a?2*h.height-.5*u.height-30:2*h.height-r+.5*u.height-30,s.addChild(u),s.setContentSize(i.width,r+50)}h.height>=s.height?s.setPositionY(-h.height):s.setPositionY(2*-h.height+s.height),h.setInnerContainerSize(cc.size(i.width,s.height)),h.addChild(s)}else if(2==t.content_type){var v=t.content;if(!v)return void console.log("noticeImgUrl == null");"http:"!=v.substr(0,5)&&"https:"!=v.substr(0,6)||(v=(v=v.replace("https:","")).replace("http:",""),cc.loader.loadImg(v,function(t,e){if(t)console.log("cc.loader.loadImg: error!");else{var n=GameUtil.getAndCacheTexture(v,e);if(n instanceof cc.Texture2D){var l=new cc.Sprite(n);l.setAnchorPoint(.5,0),l.setPosition(c/2,105),l.setScaleX((c-18)/l.width),l.setScaleY(o/l.height),i.addChild(l,0)}}}))}var S=UIHelper.createText({position:cc.p(.5*i.width,i.height-35),fontSize:35,fontColor:cc.color(255,255,255),content:t.title});i.addChild(S);var w=UIHelper.createButton({normalFile:"m_red_btn.png",bPlistTexture:!0,anchorPoint:cc.p(.5,.5),bTouchEnable:!0});t.url?w.setPosition(cc.p(.33*i.width,50)):w.setPosition(cc.p(.5*i.width,50)),i.addChild(w),w.addTouchEventListener(function(t,e){ccui.Widget.TOUCH_ENDED==e&&(MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),this.onDestroy())},this);var C=UIHelper.createText({position:cc.p(.5*w.width,.5*w.height+5),anchorPoint:cc.p(.5,.5),fontSize:30,fontColor:cc.color(255,255,255),content:"我知道了"});if(w.addChild(C),t.url){var m=UIHelper.createButton({normalFile:"m_red_btn.png",bPlistTexture:!0,position:cc.p(.66*i.width,50),anchorPoint:cc.p(.5,.5),bTouchEnable:!0});i.addChild(m),m.addTouchEventListener(function(t,e){ccui.Widget.TOUCH_ENDED},this);C=UIHelper.createText({position:cc.p(.5*w.width,.5*w.height+5),anchorPoint:cc.p(.5,.5),fontSize:30,fontColor:cc.color(255,255,255),content:"查看详情"});m.addChild(C)}},onWindowResize:function(){this.removeAllChildren(!0),this._createNoticePanel(this._noticeItem)},_splitStringWithParagraph:function(t){for(var e=t,i=new Array,n=0;n<e.length;n++){if("↵"==e[n]){if("↵"==e[0])var c=e.substring(1,n);else c=e.substring(0,n);null!==c&&c.length>0?i.push(c):i.push(" "),e=e.substring(n),n=0}}if(null!==e&&e.length>0){if("↵"===e[0]){var o=e.substring(1);null!==o&&o.length>0?i.push(o):i.push(" ")}else i.push(e)}return i},_splitStringWithStyle:function(t){for(var e=t,i=new Array,n=0;n<e.length;n++){if("<"==e[n]&&this._isValidFlag(e,n)){var c=e.substring(0,n);null!==c&&c.length>0&&i.push(c),e=e.substring(n),n=0}}return null!==e&&e.length>0&&i.push(e),i},_getSubStr:function(t){return this._isValidFlag(t,0)?t.substring(3):t},_isValidFlag:function(t,e){if(t.length<e+3||">"!=t[e+2])return!1;var i=t[e+1];return"B"==i||"b"==i||"D"==i||"d"==i||"G"==i||"g"==i||"H"==i||"h"==i||"O"==i||"o"==i||"P"==i||"p"==i||"R"==i||"r"==i||"V"==i||"v"==i||"W"==i||"w"==i||"Y"==i||"y"==i},_getStyle:function(t){return this._isValidFlag(t,0)?t[1]:"D"},_getColor:function(t){return"B"==t||"b"==t?cc.color(30,30,135):"D"==t||"d"==t?cc.color.WHITE:"G"==t||"g"==t?cc.color(194,255,129):"H"==t||"h"==t?cc.color.BLACK:"O"==t||"o"==t?cc.color(250,220,0):"P"==t||"p"==t?cc.color(220,140,130):"R"==t||"r"==t?cc.color.RED:"V"==t||"v"==t?cc.color(165,0,130):"W"==t||"w"==t?cc.color.WHITE:"Y"==t||"y"==t?cc.color(250,246,125):cc.color.WHITE},resetImageView:function(){this.imageView&&(document.body.removeChild(this.imageView),this.imageView=null),this.imageStyleNode&&(document.body.removeChild(this.imageStyleNode),this.imageStyleNode=null)},onDestroy:function(){Util.unRegisterListener(this._listenerList),this._closeCallback&&this._closeCallback(this.tag)}});
var NoticeWindow=WindowBase.extend({_tag:0,_tagList:null,ctor:function(i){this._super(),this._tag=0,this._tagList=new Array,i.forEach(this._createNoticePanel.bind(this))},_createNoticePanel:function(i){var n=new NoticePanel(i,this.removeView.bind(this));n.tag=this._tag,this.addChild(n),this._tagList[this._tag]=this._tag,this._tag++},removeView:function(i){this.removeChildByTag(i),this._tagList[i]=-1,this.childrenCount<=0&&(NoticeWindow.Hide(),AutoWindowManager.continue())},onShowNotify:function(){},onShow:function(){},onHideNotify:function(){},onHide:function(){},onDestroyNotify:function(){},onDestroy:function(){for(var i=0;i<this._tagList.length;i++){var n=this._tagList[i];if(-1!==n){var t=this.getChildByTag(n);t.resetImageView(),t.onDestroy()}}this._tagList.length=0},onCover:function(){},onResume:function(){}});NoticeWindow.GetInstance=function(i){return null!=NoticeWindow._instance?null:(NoticeWindow._instance=new NoticeWindow(i),NoticeWindow._instance)},NoticeWindow.Show=function(i,n){var t=NoticeWindow.GetInstance(i);t&&WindowManager.GetInstance().showWindow(t,null,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,n,NoticeWindow.Destroy)},NoticeWindow.Hide=function(){WindowManager.GetInstance().hideWindow(NoticeWindow._instance)},NoticeWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(NoticeWindow._instance),NoticeWindow._instance=null},NoticeWindow.Start=function(i){if(Service.Util.isDailyEnv()||Service.Util.isTestEnv())null==i&&AutoWindowManager.continue();else{GameService.getNotice({notice_type:1},function(n,t){if(console.log("StageMapPage get login notice",n,t),n)console.log("StageMapPage get login notice failed!! error is:",n);else if(null!=t){var e=t.notice_list;e.length>0?NoticeWindow.Show(e):null==i&&AutoWindowManager.continue()}})}},AutoWindowManager.add(NoticeWindow.Start,3);
var BackLogin={_bCalled:!1,isCalled:function(){return this._bCalled},back:function(){puzzleGame&&puzzleGame.holdMessage(),Timeout.clear(),this._bCalled=!0,null!=cc.director.getRunningScene()?(Service.AppManager.closeGame(),TopGoldBar.Destroy(),NoticeWindow.Destroy(),WindowManager.GetInstance().destroyAllWindow(),cc.director.getActionManager().pauseAllRunningActions(),GameUtil.pauseAllAnimation(cc.director.getRunningScene()),FrameController.IsInit()&&FrameController.GetInstance().removeAllPage(),MusicManager.stopAllSound(),MusicManager.playMusic(MusicEffectFiles.Audio_login,!0),LoginGameWindow.Destroy(),LoginLoadDelegate.destroy(),LoginGameWindow.Show(function(){FrameController.IsInit()?PageUtil.switchPageWithLoading("StageMapPage",PageType.replace,ResObjects.getResObject(ResObjectConfig.allStage),{noMusic:!0,getMail:!0}):PageUtil.startPageWithLoading("StageMapPage",PageType.replace,ResObjects.getResObject(ResObjectConfig.allStage),{noMusic:!0,getMail:!0})},!1,function(){},function(){}),LoginLoadDelegate.onLoadResFinished(),LoginLoadDelegate.onLoadConfigFinished()):LoginLoadDelegate.logout()}};
var BuyPropWindow=WindowBase.extend({_closeCallBack:null,_buySuccessCallBack:null,_itemData:null,_bgBuyPropLightView:null,_buyItemPanel:null,_listenerList:null,_diamondsText:null,ctor:function(){this._super(),this._listenerList=[],Util.registerListener(this._listenerList,EventID.AT_DIAMOND,this._onDiamondsUpdate.bind(this));var e=UIHelper.createImage({imageFileName:"bg_dialog.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(622,570),capInsets:cc.rect(0,72,512,22),position:UIHelper.getPosition(320,600)});this.addChild(e);var t=UIHelper.createPanel({anchorPoint:e.getAnchorPoint(),position:e.getPosition(),size:e.getContentSize()});this.addChild(t),this._buyItemPanel=t;(i=UIHelper.createButton({normalFile:"btn_close_N.png",bPressedActionEnabled:!0,bPlistTexture:!0,position:cc.p(586,540),bTouchEnable:!0})).addTouchEventListener(this._onCloseButtonTouched,this),e.addChild(i);var i=UIHelper.createImage({imageFileName:"bg_buy_prop_light.png",bPlistTexture:!0,position:cc.p(e.getContentSize().width/2,378)});e.addChild(i),this._bgBuyPropLightView=i;i=UIHelper.createImage({imageFileName:"buy_prop_title.png",bPlistTexture:!0,position:cc.p(320,532)});e.addChild(i);i=UIHelper.createText({position:cc.p(330,62),anchorPoint:cc.p(1,.5),fontSize:30,fontColor:cc.color(255,255,255),content:Language.getString(LanguageKey.OWN_DIAMONDS_COUNT)});e.addChild(i);i=UIHelper.createImage({imageFileName:"bg_diamonds.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(170,40),capInsets:cc.rect(25,13,20,14),position:cc.p(434,62)});e.addChild(i);var n=UIHelper.createImage({imageFileName:"icon_diamonds.png",bPlistTexture:!0,scale:.7,position:cc.p(35,16.5)});i.addChild(n);var o=NetData.diamond.count||0,a=new cc.LabelBMFont(String(o),res.number_white_fnt);a.setAnchorPoint(0,.5),a.setPosition(70,18),i.addChild(a),this._diamondsText=a},setItemData:function(e){this._itemData=e},setCloseCallBack:function(e){this._closeCallBack=e},setBuySuccessCallBack:function(e){this._buySuccessCallBack=e},_onCloseButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&("function"==typeof this._closeCallBack&&this._closeCallBack(),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),BuyPropWindow.Destroy())},onShowNotify:function(){this._bgBuyPropLightView.removeAllChildren();var e=this._bgBuyPropLightView,t=e.getContentSize().width/2,i=this._itemData.itemId,n=GameDataConfig.PropViewConfig[i].image1,o=UIHelper.createImage({imageFileName:n,bPlistTexture:!0,position:cc.p(t,106),scale:1.4,anchorPoint:cc.p(.5,0)});e.addChild(o);var a=ConfigLoader.getPropConfig(i);o=UIHelper.createText({position:cc.p(t,80),fontColor:cc.color(30,90,140),fontSize:28,content:a.item_name});e.addChild(o);o=UIHelper.createText({position:cc.p(t,38),fontColor:cc.color(30,90,140),fontSize:28,content:a.desc});e.addChild(o);o=UIHelper.createText({position:cc.p(568,200),anchorPoint:cc.p(1,.5),fontColor:cc.color(233,153,0),fontSize:28,content:cc.formatStr(Language.getString(LanguageKey.SINGLE_GAME_PROP_CAN_USE_COUNT_LIMIT),a.use_limit)});e.addChild(o),this._buyItemPanel.removeAllChildren();for(var c=[],s=ConfigLoader.getPropGoodsConfig(this._itemData.itemId),r=0;r<3;r++){var l=s.price_pkg_list[r];c.push({bgFrameName:"button_buy_prop_green_N.png",packageId:r,priceType:s.price_type,count:l.amount,price:l.price,bPlus:!1})}var d=c[c.length-1];d.bgFrameName="button_buy_prop_yellow_N.png",d.bPlus=!0;for(var u=new SortViewGroup,g=(r=0,c.length);r<g;r++){var p=new BuyItem(c[r]);p.setDelegate(this),p.setPositionY(194),this._buyItemPanel.addChild(p),u.addView(p)}0!=u.getViewList().length&&(u.setViewHorizontalSpacing(20),u.setMidX(this._buyItemPanel.getContentSize().width/2),u.sort())},onBuyItemTouched:function(e){MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch);if(GameUtil.isWealthEnough(e.getPriceType(),e.getPrice())){var t=new BuyStagePropRequest(this._itemData.itemId,e.getCount(),e.getPackageId()+1);NetLoadingWindow.Show(),GameService.buyGoods(t,function(e,t){null!=t?("function"==typeof this._buySuccessCallBack&&this._buySuccessCallBack(t),NetLoadingWindow.Hide(),BuyPropWindow.Destroy(),TipWindow.Show(Language.getString(LanguageKey.BUY_PROP_SUCCESS))):(NetLoadingWindow.Hide(),TipWindow.Show(e.ret_desc))}.bind(this))}else e.getPriceType()==PriceType.DIAMONDS&&wx.getSystemInfoSync().system.indexOf("iOS")>=0?(TipWindow.Show("钻石不足"),console.error("iOS 不能购买")):GameUtil.showExchangeWindowByPriceType(e.getPriceType())},_onDiamondsUpdate:function(){var e=NetData.diamond.count||0;this._diamondsText.setString(e)},onShow:function(){},onHideNotify:function(){},onHide:function(){},onDestroyNotify:function(){Util.unRegisterListeners(this._listenerList)},onDestroy:function(){},onCover:function(){},onResume:function(){}});BuyPropWindow.GetInstance=function(){return null==BuyPropWindow._instance&&(BuyPropWindow._instance=new BuyPropWindow),BuyPropWindow._instance},BuyPropWindow.Show=function(e,t,i){ResLoader.showSubResLoadingWindow(ResObjects.getResObject(ResObjectConfig.buyProp),function(){var n=BuyPropWindow.GetInstance();n.setItemData(e),n.setCloseCallBack(t),n.setBuySuccessCallBack(i);var o=WindowAction.getScaleEaseElasticOutAction(n);WindowManager.GetInstance().showWindow(n,o,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,BuyPropWindow.Destroy)})},BuyPropWindow.Hide=function(){WindowManager.GetInstance().hideWindow(BuyPropWindow._instance)},BuyPropWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(BuyPropWindow._instance),BuyPropWindow._instance=null};var BuyItem=cc.Node.extend({_delegate:null,_buyItemData:null,ctor:function(e){this._super(),this._buyItemData=e;var t=e.bgFrameName,i=UIHelper.createImage({imageFileName:t,bPlistTexture:!0});i.setPosition(i.getContentSize().width/2,i.getContentSize().height/2),this.addChild(i),this.setContentSize(i.getContentSize()),this.setAnchorPoint(.5,.5);var n=UIHelper.createPanel({anchorPoint:i.getAnchorPoint(),position:i.getPosition(),size:i.getContentSize(),bTouchEnable:!0});n.addTouchEventListener(this._onItemPanelTouched,this),this.addChild(n);var o=new cc.LabelBMFont("+"+e.count,res.number_white_fnt);o.setPosition(i.getContentSize().width/2,92),i.addChild(o);var a=new cc.LabelBMFont(String(e.price),res.number_white_fnt);a.setPosition(98.5,46),i.addChild(a);var c=cc.p(0,0),s="coin_big.png",r=1;switch(e.priceType){case PriceType.DIAMONDS:s="icon_diamonds.png",r=.7,c.x=50,c.y=42;break;case PriceType.GOLD:s="coin_big.png",r=1,c.x=47,c.y=47}var l=UIHelper.createImage({imageFileName:s,bPlistTexture:!0,scale:r,position:c});if(this.addChild(l),!0===e.bPlus){l=UIHelper.createImage({imageFileName:"icon_tip_add3.png",bPlistTexture:!0,position:cc.p(132,126)});i.addChild(l)}},getPackageId:function(){return this._buyItemData.packageId},getCount:function(){return this._buyItemData.count},getPrice:function(){return this._buyItemData.price},getPriceType:function(){return this._buyItemData.priceType},setDelegate:function(e){this._delegate=e},_onItemPanelTouched:function(e,t){switch(t){case ccui.Widget.TOUCH_BEGAN:this.setScale(1.1);break;case ccui.Widget.TOUCH_ENDED:this.setScale(1),this._delegate.onBuyItemTouched(this);break;case ccui.Widget.TOUCH_CANCELED:this.setScale(1)}}});
var GameResultFailWindow=WindowBase.extend({_completeCallBack:null,_effect:null,ctor:function(){this._super();var e=new GameResultFailEffect;e.setPlayCompleteCallBack(this._onEffectPlayComplete.bind(this)),e.setPosition(UIHelper.getCenterPosition()),this.addChild(e),this._effect=e},_onEffectPlayComplete:function(){"function"==typeof this._completeCallBack&&this._completeCallBack(),GameResultFailWindow.Hide()},setCompleteCallBack:function(e){this._completeCallBack=e},onShowNotify:function(){this._effect.play(),MusicManager.playEffect(MusicEffectFiles.Audio_UI_stagefail)},onShow:function(){},onHideNotify:function(){},onHide:function(){},onDestroyNotify:function(){},onDestroy:function(){},onCover:function(){},onResume:function(){}});GameResultFailWindow.GetInstance=function(){return null==GameResultFailWindow._instance&&(GameResultFailWindow._instance=new GameResultFailWindow),GameResultFailWindow._instance},GameResultFailWindow.Show=function(e){var t=GameResultFailWindow.GetInstance();t.setCompleteCallBack(e),WindowManager.GetInstance().showWindow(t,null,!1,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,GameResultFailWindow.Destroy)},GameResultFailWindow.Hide=function(){WindowManager.GetInstance().hideWindow(GameResultFailWindow._instance)},GameResultFailWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(GameResultFailWindow._instance),GameResultFailWindow._instance=null};var GameResultFailEffect=Effect.extend({ctor:function(){this._super(res.failed_json);var e=UIHelper.seekWidgetByName(this._node,"Panel_1",NodeType.PANEL);e.setBackGroundColorType(ccui.Layout.BG_COLOR_NONE);var t=UIHelper.createImage({imageFileName:res.mask_png,position:UIHelper.getCenterPosition(),scale:Math.max(cc.winSize.width/4,cc.winSize.height/4),opacity:180});t.setPosition(e.getContentSize().width/2,e.getContentSize().height/2),e.addChild(t)},play:function(){this._super(!1)}});
var GameResultSuccessWindow=WindowBase.extend({_completeCallBack:null,_effect:null,_level:null,ctor:function(){this._super();var e=new GameResultSuccessEffect;e.setPlayCompleteCallBack(this._onEffectPlayComplete.bind(this)),e.setPosition(UIHelper.getCenterPosition()),this.addChild(e),this._effect=e},_onEffectPlayComplete:function(){"function"==typeof this._completeCallBack&&this._completeCallBack(),GameResultSuccessWindow.Hide()},setLevel:function(e){this._level=e},setCompleteCallBack:function(e){this._completeCallBack=e},onShowNotify:function(){this._effect.play(this._level),MusicManager.playEffect(MusicEffectFiles.Audio_UI_stagewin)},onShow:function(){},onHideNotify:function(){},onHide:function(){},onDestroyNotify:function(){},onDestroy:function(){},onCover:function(){},onResume:function(){}});GameResultSuccessWindow.GetInstance=function(){return null==GameResultSuccessWindow._instance&&(GameResultSuccessWindow._instance=new GameResultSuccessWindow),GameResultSuccessWindow._instance},GameResultSuccessWindow.Show=function(e,t){var n=GameResultSuccessWindow.GetInstance();n.setCompleteCallBack(e),n.setLevel(t),WindowManager.GetInstance().showWindow(n,null,!1,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,GameResultSuccessWindow.Destroy)},GameResultSuccessWindow.Hide=function(){WindowManager.GetInstance().hideWindow(GameResultSuccessWindow._instance)},GameResultSuccessWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(GameResultSuccessWindow._instance),GameResultSuccessWindow._instance=null};var GameResultSuccessEffect=Effect.extend({_levelText:null,ctor:function(){this._super(res.success_json);var e=UIHelper.seekWidgetByName(this._node,"Panel_1_0",NodeType.PANEL);e.setBackGroundColorType(ccui.Layout.BG_COLOR_NONE);var t=UIHelper.createImage({imageFileName:res.mask_png,position:UIHelper.getCenterPosition(),scale:Math.max(cc.winSize.width/4,cc.winSize.height/4),opacity:180});t.setPosition(e.getContentSize().width/2,e.getContentSize().height/2),e.addChild(t)},play:function(e){if(this._super(!1),null==this._levelText){var t=UIHelper.seekWidgetByName(this._node,"Panel_3",NodeType.PANEL);t.setBackGroundColorType(ccui.Layout.BG_COLOR_NONE),this._levelText=new cc.LabelBMFont(String(e),res.number_brown_fnt);var n=t.getParent();null!=n&&n.addChild(this._levelText),this._levelText.setPosition(t.getPosition())}var i=this._levelText;i.setString(e);var s=UIHelper.seekWidgetByName(this._node,"title11_1",NodeType.SPRITE);s.setAnchorPoint(1,.5);var o=i.getPositionX()-i.getAnchorPoint().x*i.getContentSize().width;s.setPositionX(o);var l=UIHelper.seekWidgetByName(this._node,"title12_2",NodeType.SPRITE);l.setAnchorPoint(0,.5);o=i.getPositionX()+(1-i.getAnchorPoint().x)*i.getContentSize().width;l.setPositionX(o),i.setPositionY(l.getPositionY()),bChallengeMode&&(s.setVisible(!1),l.setVisible(!1),i.setVisible(!1))}});
var StepRewardWindow=WindowBase.extend({_completeCallBack:null,_effect:null,ctor:function(){this._super();var e=new StepRewardEffect;e.setPlayCompleteCallBack(this._onEffectPlayComplete.bind(this)),e.setPosition(UIHelper.getCenterPosition()),this.addChild(e),this._effect=e},_onEffectPlayComplete:function(){"function"==typeof this._completeCallBack&&this._completeCallBack(),StepRewardWindow.Hide()},setCompleteCallBack:function(e){this._completeCallBack=e},onShowNotify:function(){this._effect.play(),MusicManager.playEffect(MusicEffectFiles.Audio_UI_lastpang)},onShow:function(){},onHideNotify:function(){},onHide:function(){},onDestroyNotify:function(){},onDestroy:function(){},onCover:function(){},onResume:function(){}});StepRewardWindow.GetInstance=function(){return null==StepRewardWindow._instance&&(StepRewardWindow._instance=new StepRewardWindow),StepRewardWindow._instance},StepRewardWindow.Show=function(e){var t=StepRewardWindow.GetInstance();t.setCompleteCallBack(e),WindowManager.GetInstance().showWindow(t,null,!1,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,StepRewardWindow.Destroy)},StepRewardWindow.Hide=function(){WindowManager.GetInstance().hideWindow(StepRewardWindow._instance)},StepRewardWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(StepRewardWindow._instance),StepRewardWindow._instance=null};var StepRewardEffect=Effect.extend({ctor:function(){this._super(res.rewardeffects_json);var e=UIHelper.seekWidgetByName(this._node,"Panel_1_0",NodeType.PANEL);e.setBackGroundColorType(ccui.Layout.BG_COLOR_NONE);var t=UIHelper.createImage({imageFileName:res.mask_png,position:UIHelper.getCenterPosition(),scale:Math.max(cc.winSize.width/4,cc.winSize.height/4),opacity:180});t.setPosition(e.getContentSize().width/2,e.getContentSize().height/2),e.addChild(t)},play:function(){this._super(!1)}});
page.GameSettlementFailPage=page.BasePage.extend({_listenerList:null,onCreate:function(e){(t=UIHelper.createImage({imageFileName:resGroup.GameFailRes.bg_fail_jpg,position:UIHelper.getCenterPosition()})).setName("bgImage"),this.addChild(t);var t=UIHelper.createImage({imageFileName:"balloon.png",bPlistTexture:!0,position:cc.p(188,620)});this._middlePanel.addChild(t),t.setPositionY(t.getPositionY()-100);var i=new GameSettlementFailEffect(e.pageData.failReason);i.setPosition(cc.p(320,668)),i.play(),this._middlePanel.addChild(i),i.setPositionY(i.getPositionY()-50);t=UIHelper.createImage({imageFileName:"pet.png",bPlistTexture:!0,position:cc.p(450,568)});this._middlePanel.addChild(t);(t=UIHelper.createButton({normalFile:"btn_back_map_N.png",bPlistTexture:!0,bPressedActionEnabled:!0,position:cc.p(170,150),bTouchEnable:!0})).addTouchEventListener(this._onSureButtonTouched,this),this._bottomPanel.addChild(t);(t=UIHelper.createButton({normalFile:"btn_replay.png",bPressedActionEnabled:!0,bPlistTexture:!0,position:cc.p(470,150),bTouchEnable:!0})).addTouchEventListener(this._onReplayButtonTouched,this),this._bottomPanel.addChild(t),UIHelper.adjustUILayout(this),MusicManager.playEffect(MusicEffectFiles.Audio_UI_stagefailscore),this._listenerList=[],Util.registerListener(this._listenerList,EventID.ON_WINDOW_RESIZE,this._onWindowResize.bind(this))},_onWindowResize:function(){UIHelper.adjustUILayout(this)},_onSureButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(PageUtil.switchPageWithLoading("StageMapPage",PageType.replace,ResObjects.getResObject(ResObjectConfig.allStage)),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch))},_onReplayButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(PageUtil.switchPageWithLoading("StageMapPage",PageType.replace,ResObjects.getResObject(ResObjectConfig.allStage),null,function(){GameProxy.init();var e=GameProxy.getStageId();if(StageJumpData.getJumpCostStarCount(e)>1){var t=FrameController.GetInstance().getCurPage();t.selectedStageId=e,t.showStageView(e)}else PropSelectWindow.Show(!1)}.bind(this)),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch))},onEnter:function(){this._super(),wx.triggerGC&&wx.triggerGC()},onExit:function(){var e=this.getAverageFrameRate();console.log("GameSettlementFailPage average frame rate : "+e),this._super(),Util.unRegisterListeners(this._listenerList)}});var GameSettlementFailEffect=Effect.extend({ctor:function(e){this._super(res.failedbudget_json),this._node.setAnchorPoint(.5,.5);var t=UIHelper.seekWidgetByName(this._node,"Panel_1",NodeType.PANEL);t.setBackGroundColorType(ccui.Layout.BG_COLOR_NONE);var i=new ccui.Text;i.setFontName("Microsoft YaHei"),i.setFontSize(30);var a=null!=e?e.failDescribe:"unKnown";UIHelper.subsectionTextForUIText(i,a,335),i.setPosition(t.getContentSize().width/2,t.getContentSize().height/2),t.addChild(i)},play:function(){this._super(!1)}});
page.GameSettlementSuccessPage=page.BasePage.extend({_listenerList:null,_effect:null,_score:0,_haveShowResult:!1,onCreate:function(e){Timeout.register(function(){PreloadStageResLogic.loadNextStage()},500);(o=UIHelper.createImage({imageFileName:resGroup.GameSuccessRes.bg_success_jpg,position:UIHelper.getCenterPosition()})).setName("bgImage"),this.addChild(o);var t=new Effect(res.successbudgetelement2_json),i=cc.winSize.height-o.getContentSize().height;t.setPositionY(i),t.play(!0),this._middlePanel.addChild(t),t.setScale(1.1),t.setPositionY(t.getPositionY()-150);var s=this._middlePanel.getContentSize(),a=cc.p(s.width/2,s.height/2),n={};n.score=this._score=e.pageData.score,n.starCount=e.pageData.starCount,n.stageId=e.pageData.level;(t=new GameSettlementSuccessEffect(n)).setPosition(a),t.play(),this._middlePanel.addChild(t),this._effect=t,this._effect.setPositionY(this._effect.getPositionY()-50);var o=UIHelper.createImage({imageFileName:"bg_ground.png",bPlistTexture:!0,position:cc.p(this._middlePanel.getContentSize().width/2,388)});this._middlePanel.addChild(o);(t=new Effect(res.successbudgetelement_json)).setPosition(cc.p(500,468)),t.play(!0),this._middlePanel.addChild(t),this._haveShowResult=!1,this._listenerList=[],Util.registerListener(this._listenerList,EventID.SETTLEMENT_FAIL,this._onSettlementFail.bind(this)),Util.registerListener(this._listenerList,EventID.ON_WINDOW_RESIZE,this._onWindowResize.bind(this)),Util.registerListener(this._listenerList,EventID.ON_NETWORK_TIP_WINDOW_CANCEL,this._onNetworkTipWindowCancel.bind(this)),null==GameProxy.getSettlementSuccessResult()||this._haveShowResult?Util.registerListener(this._listenerList,EventID.SETTLEMENT_SUCCESS,this._onSettlementSuccess.bind(this)):(this._haveShowResult=!0,this.showRewardView()),null==GameProxy.getSettlementFailResult()||this._haveShowResult||(this._haveShowResult=!0,this._showErrorWindow(GameProxy.getSettlementFailResult()));var r=this._middlePanel.getContentSize().width/2;(o=new cc.ParticleSystem(res.soccerstarpalur1_plist)).setPosition(r,cc.winSize.height),this._middlePanel.addChild(o);(o=new cc.ParticleSystem(res.soccerstarpalur2_plist)).setPosition(r,cc.winSize.height),this._middlePanel.addChild(o);(o=new cc.ParticleSystem(res.soccerstarpalur3_plist)).setPosition(r,cc.winSize.height),this._middlePanel.addChild(o),UIHelper.adjustUILayout(this),MusicManager.playEffect(MusicEffectFiles.Audio_UI_stagewinscore);var c=StageJumpData.isPassedHoldStage(n.stageId);if(c>0){var l=new cc.Sprite("#jump-return-bg.png");l.setPosition(130,cc.visibleRect.height-275),this.addChild(l);var d=new cc.Sprite("#jump-return star.png");d.setPosition(.17*l.width,.36*l.height),l.addChild(d);var h=new cc.LabelBMFont(c,res.number_stage_y_fnt);h.setPosition(.61*l.width,.36*l.height),l.addChild(h)}},onEnter:function(){this._super(),console.warn("GameSettlementSuccessPage.onEnter"),wx.triggerGC&&wx.triggerGC(),this.updateStep=0,this.showBeyondFriend(),this.scheduleUpdate()},showBeyondFriend:function(){var e=cc.rect(0,0,cc.winSize.width,cc.winSize.height),t={req:"OVER_FRIEND",data:{userInfo:NetData.user_info,oldStaticsNtf:window.subBeyondFriend.oldStaticsNtf,newStaticsNtf:window.subBeyondFriend.newStaticsNtf,noAnimate:!0},rect:e};wx.postMessage(t),this.subTex=new cc.Texture2D,this.subTex.initWithElement(sharedCanvas),this.subTex.handleLoadedTexture();var i=new cc.Sprite(this.subTex,e);i.setPosition(cc.visibleRect.center),this.addChild(i,1e4),this._topPanel.setLocalZOrder(10001),this._bottomPanel.setLocalZOrder(10002)},update:function(){this.subTex&&(0==this.updateStep++&&(this.subTex.initWithElement(sharedCanvas),this.subTex.handleLoadedTexture()),window.subUpdateRate.BEYOND_FRIEND==this.updateStep&&(this.updateStep=0))},_onWindowResize:function(){UIHelper.adjustUILayout(this)},_onNetworkTipWindowCancel:function(){this._backStage()},_showButton:function(e){if(e==MAX_STAGE_ID)return this._showLastLevelButton(),this._showBackButton(),void this._bottomPanel.setPositionY(50);last_max_stage_id<e&&e<MAX_STAGE_ID?(this._showSingleNextLevelButton(),this._showBackButton()):(this._showTwoButton(),this._showBackButton()),this._bottomPanel.setPositionY(50)},_showBackButton:function(){var e=this._topPanel.getContentSize(),t=UIHelper.createButton({normalFile:"btn_back_N.png",bPlistTexture:!0,position:cc.p(15,e.height-20),anchorPoint:cc.p(0,1),bTouchEnable:!0});t.addTouchEventListener(this._onSureButtonTouched,this),this._topPanel.addChild(t)},_showSingleSureButton:function(){var e=UIHelper.createButton({normalFile:"btn_sure.png",bPressedActionEnabled:!0,bPlistTexture:!0,position:cc.p(320,150),bTouchEnable:!0});e.addTouchEventListener(this._onSureButtonTouched,this),this._bottomPanel.addChild(e)},_showLastLevelButton:function(){var e=!1,t=UIHelper.createButton({normalFile:"res/pages/gameSuccess/gameSuccess_flaunt_btn.png",bPressedActionEnabled:!0,bPlistTexture:!1,position:cc.p(160,150),bTouchEnable:!0});t.addTouchEventListener(function(t,i){ccui.Widget.TOUCH_ENDED==i&&(XCXSDK.setCustomShareData({title:"我已经通关游戏，快来挑战我！",imageUrl:window.remoteResPath+"res/shareimg2/flaunt_greatx.png",query:""},function(){e=!1,XCXSDK.clearCustomShareData()},function(){e=!1,XCXSDK.clearCustomShareData()}),e||(e=!0,XCXSDK.customShare()))},this),this._bottomPanel.addChild(t);var i=UIHelper.createButton({normalFile:"btn_sure.png",bPressedActionEnabled:!0,bPlistTexture:!0,position:cc.p(480,150),bTouchEnable:!0});i.addTouchEventListener(this._onSureButtonTouched,this),this._bottomPanel.addChild(i)},_showSingleNextLevelButton:function(){var e=this,t=!1,i=UIHelper.createButton({normalFile:"res/pages/gameSuccess/gameSuccess_flaunt_btn.png",bPressedActionEnabled:!0,bPlistTexture:!1,position:cc.p(160,150),bTouchEnable:!0});i.addTouchEventListener(function(i,s){ccui.Widget.TOUCH_ENDED==s&&(XCXSDK.setCustomShareData({title:cc.formatStr("我通过了第%s关，暴击打出%s分，快来挑战我！",GameProxy.getStageId(),e._score),imageUrl:window.remoteResPath+"res/shareimg2/flaunt_greatx.png",query:""},function(){t=!1,XCXSDK.clearCustomShareData()},function(){t=!1,XCXSDK.clearCustomShareData()}),t||(t=!0,XCXSDK.customShare()))},this),this._bottomPanel.addChild(i);var s=UIHelper.createButton({normalFile:"btn_next_level.png",bPressedActionEnabled:!0,bPlistTexture:!0,position:cc.p(480,150),bTouchEnable:!0});s.addTouchEventListener(this._onNextLevelButtonTouched,this),this._bottomPanel.addChild(s)},_showTwoButton:function(){(e=UIHelper.createButton({normalFile:"btn_sure.png",bPressedActionEnabled:!0,bPlistTexture:!0,position:cc.p(170,150),bTouchEnable:!0})).addTouchEventListener(this._onSureButtonTouched,this),this._bottomPanel.addChild(e);var e;(e=UIHelper.createButton({normalFile:"btn_next_level.png",bPressedActionEnabled:!0,bPlistTexture:!0,position:cc.p(470,150),bTouchEnable:!0})).addTouchEventListener(this._onNextLevelButtonTouched,this),this._bottomPanel.addChild(e)},_onSettlementSuccess:function(){this._haveShowResult||(this._haveShowResult=!0,this.showRewardView())},_onSettlementFail:function(e){this._haveShowResult||(this._haveShowResult=!0,this._showErrorWindow(e.userData.error))},_showErrorWindow:function(e){var t=null!=e?e.ret:-1,i=null!=e&&null!=e.ret_desc?e.ret_desc:Language.getString(LanguageKey.SETTLEMENT_CHEAT);TipWindow.Show(cc.formatStr(i,t)),this._showSingleSureButton()},showRewardView:function(){var e=GameProxy.getSettlementSuccessResult();if("number"==typeof e.game_result){var t=Util.clone(e);(e={}).stage_report_res=t}var i=GameProxy.getStageId();if(1!=e.stage_report_res.game_result)return this._showButton(i),void TipWindow.Show(cc.formatStr(Language.getString(LanguageKey.SETTLEMENT_CHEAT,e.stage_report_res.game_result)));this._showButton(i);var s={};s.rewardCoin=e.stage_report_res.reward_money,s.playerLevel=1,s.playerLevelProgress=50,s.playerLevelAdd=20;if(0!=(null!=e.reward_pool_apd?e.reward_pool_apd.length:0)){null!=(t=e.reward_pool_apd[0].reward_list[0])?(s.bFirstPass=!0,s.rewardGoodsType=t.article_type,s.rewardGoodsSubType=t.article_subtype,s.rewardGoodsId=t.article_id,s.rewardGoodsCount=t.article_count):s.bFirstPass=!1}else s.bFirstPass=!1;this._effect.showRewardView(s)},_onSureButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(this._backStage(),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch))},_backStage:function(){var e=GameProxy.getStageId()==MAX_STAGE_ID;MusicManager.stopAllSound(),PageUtil.switchPageTo("StageMapPage",PageType.replace,ResObjects.getResObject(ResObjectConfig.allStage),{bLastStage:e})},_onNextLevelButtonTouched:function(e,t){if(ccui.Widget.TOUCH_ENDED==t){var i={showNextStageAni:!1,callback:function(){GameProxy.init();var e=GameProxy.getStageId();e++,GameProxy.setStageId(e),SureAdventureWindow.Show(function(){PropSelectWindow.Show()}.bind(this))}.bind(this)},s=NetData.statics_ntf.stage_statics.max_stage_id;last_max_stage_id!=s&&s<MAX_STAGE_ID&&(i.showNextStageAni=!0),MusicManager.stopAllSound(),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),PageUtil.switchPageTo("StageMapPage",PageType.replace,ResObjects.getResObject(ResObjectConfig.allStage),i,null)}},onExit:function(){wx.postMessage({req:"OVER_FRIEND_CLOSE",rect:cc.rect(0,0,sharedCanvas.width,sharedCanvas.height)});var e=this.getAverageFrameRate();console.log("GameSettlementSuccessPage average frame rate : "+e),this._super(),Util.unRegisterListeners(this._listenerList),console.warn("GameSettlementSuccessPage.onExit")}});var GameSettlementSuccessEffect=Effect.extend({_score:null,_actionScoreText:null,_rewardData:null,_starCount:null,ctor:function(e){var t=Math.max(1,e.starCount);this._starCount=t;var i=null;switch(t){case 1:i=res.successbudget1_json;break;case 2:i=res.successbudget2_json;break;case 3:i=res.successbudget3_json}this._super(i),this._node.setAnchorPoint(.5,.5);(n=UIHelper.seekWidgetByName(this._node,"Panel_1",NodeType.PANEL)).setBackGroundColorType(ccui.Layout.BG_COLOR_NONE);var s=new Effect(res.circlelight_json);s.play(!0),n.addChild(s),this._score=e.score;(n=UIHelper.seekWidgetByName(this._node,"Panel_3",NodeType.PANEL)).setBackGroundColorType(ccui.Layout.BG_COLOR_NONE);var a=new cc.LabelBMFont("0",res.number_brown_fnt);a.setPosition(n.getContentSize().width/2,n.getContentSize().height/2),n.addChild(a),this._actionScoreText=new ActionText(a),this._actionScoreText.setActionEnable(!0),this._actionScoreText.setWithCommaEnable(!0),this._actionScoreText.setActionTime(1),this.addChild(this._actionScoreText);var n;(n=UIHelper.seekWidgetByName(this._node,"Panel_4",NodeType.PANEL)).setBackGroundColorType(ccui.Layout.BG_COLOR_NONE);var o=new cc.LabelBMFont(Util.getNumberWithComma(e.stageId),res.number_brown_fnt);o.setPosition(n.getPosition());var r=n.getParent();null!=r&&r.addChild(o);var c=UIHelper.seekWidgetByName(this._node,"title11_1",NodeType.SPRITE);c.setAnchorPoint(1,.5);var l=o.getPositionX()-o.getAnchorPoint().x*o.getContentSize().width;c.setPositionX(l);var d=UIHelper.seekWidgetByName(this._node,"title12_2",NodeType.SPRITE);d.setAnchorPoint(0,.5);l=o.getPositionX()+(1-o.getAnchorPoint().x)*o.getContentSize().width;d.setPositionX(l),o.setPositionY(d.getPositionY())},showRewardView:function(e){this._rewardData=e,this._rewardData.bFirstPass?this._showFirstPassReward():this._showCoinReward()},_showCoinReward:function(){var e=UIHelper.seekWidgetByName(this._node,"Panel_3",NodeType.PANEL),t=e.clone();t.removeAllChildren(),e.getParent().addChild(t);var i=cc.size(170,41);t.setContentSize(i),t.setPositionY(-20);var s=UIHelper.createImage({imageFileName:"bg_coin_reward.png",bPlistTexture:!0,bScale9Enabled:!0,size:i,capInsets:cc.rect(27,0,29,41),position:cc.p(i.width/2,i.height/2)});t.addChild(s);var a=new SortViewGroup,n=UIHelper.createImage({imageFileName:"coin_big.png",bPlistTexture:!0,position:cc.p(0,i.height/2),scale:1.2});s.addChild(n),a.addView(n);(n=new cc.LabelBMFont("+"+this._rewardData.rewardCoin,res.number_shallow_gold_fnt)).setPosition(0,i.height/2),s.addChild(n),a.addView(n),a.setMidX(i.width/2),a.sort()},_showFirstPassReward:function(){var e=UIHelper.seekWidgetByName(this._node,"Panel_3",NodeType.PANEL),t=e.clone();t.removeAllChildren(),e.getParent().addChild(t);var i=cc.size(220,200);t.setContentSize(i),t.setPositionY(-105);var s=UIHelper.createImage({imageFileName:"bg_first_pass_reward.png",bPlistTexture:!0,bScale9Enabled:!0,size:i,capInsets:cc.rect(15,14,3,3),position:cc.p(i.width/2,i.height/2)});t.addChild(s);var a=UIHelper.createImage({imageFileName:"icon_first_pass_reward.png",bPlistTexture:!0,position:cc.p(i.width/2,95)});t.addChild(a);var n=GameUtil.getGoodsImageById(this._rewardData.rewardGoodsType,this._rewardData.rewardGoodsSubType,this._rewardData.rewardGoodsId);s=UIHelper.createImage({imageFileName:n,bPlistTexture:!0,position:cc.p(a.getContentSize().width/2,15),anchorPoint:cc.p(.5,0)});a.addChild(s);(s=new cc.LabelBMFont("+"+this._rewardData.rewardGoodsCount,res.number_white_fnt)).setPosition(a.getContentSize().width/2,15),a.addChild(s);s=UIHelper.createText({fontSize:20,content:Language.getString(LanguageKey.REWARD_ARRIVAL),position:cc.p(i.width/2,18),fontColor:cc.color(255,255,255)});t.addChild(s);var o=new SortViewGroup;s=UIHelper.createImage({imageFileName:"coin_big.png",bPlistTexture:!0,position:cc.p(0,180),scale:1.2});t.addChild(s),o.addView(s);(s=new cc.LabelBMFont("+"+this._rewardData.rewardCoin,res.number_shallow_gold_fnt)).setPosition(0,180),t.addChild(s),o.addView(s),o.setMidX(i.width/2),o.sort()},_showLevelReward:function(){var e=UIHelper.seekWidgetByName(this._node,"Panel_3",NodeType.PANEL),t=cc.size(300,41),i=e.clone();i.removeAllChildren(),e.getParent().addChild(i),i.setContentSize(t),i.setPositionY(-15);(s=UIHelper.createImage({imageFileName:"bg_coin_reward.png",bPlistTexture:!0,bScale9Enabled:!0,size:t,capInsets:cc.rect(27,0,29,41),position:cc.p(t.width/2,t.height/2),opacity:70})).setColor(cc.color(0,0,0)),i.addChild(s);var s=UIHelper.createText({fontSize:20,content:Language.getString(LanguageKey.LEVEL),position:cc.p(40,t.height/2),fontColor:cc.color(255,255,255)});i.addChild(s);s=UIHelper.createText({fontSize:20,anchorPoint:cc.p(0,.5),content:this._rewardData.playerLevel,position:cc.p(65,t.height/2),fontColor:cc.color(255,255,255)});i.addChild(s);(s=UIHelper.createImage({imageFileName:"bg_coin_reward.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(200,35),capInsets:cc.rect(27,0,29,41),position:cc.p(165,t.height/2),opacity:117})).setScaleX(.7),s.setScaleY(.77),s.setColor(cc.color(0,0,0)),i.addChild(s);(s=new ExtendLoadingBar({leftBarSpriteFrameName:"bar_green_side.png",middleBarSpriteFrameName:"bar_green_middle.png",rightBarSpriteFrameName:"bar_green_side.png",size:cc.size(130,27)})).setPosition(90,8),s.setPercent(this._rewardData.playerLevelProgress),i.addChild(s);(s=new cc.LabelBMFont("+"+this._rewardData.playerLevelAdd,res.number_white_fnt)).setAnchorPoint(0,.5),s.setScale(.8),s.setPosition(240,t.height/2),i.addChild(s)},play:function(){switch(this._super(!1),this._actionScoreText.setNumber(this._score),MusicManager.playEffect(MusicEffectFiles.Audio_UI_scoreinc),this._starCount){case 1:MusicManager.playEffect(MusicEffectFiles.Audio_UI_stagewinstar);break;case 2:MusicManager.playEffect(MusicEffectFiles.Audio_UI_stagewinstar2);break;case 3:MusicManager.playEffect(MusicEffectFiles.Audio_UI_stagewinstar3)}}});
page.RinkMatchResultPage=page.BasePage.extend({_listenerList:null,_container:null,_score:0,miaowanresultEffect:null,_effectWrapper:null,onCreate:function(e){this._score=e.pageData.score;var t=cc.winSize.width,i=cc.winSize.height,n=UIHelper.createImage({imageFileName:res.bg_success_jpg,position:UIHelper.getCenterPosition()});n.setName("bgImage"),this.addChild(n);var s=this._container=UIHelper.createPanel({position:cc.p(t/2,i/2),anchorPoint:cc.p(.5,.5),size:cc.size(t,i)});this.addChild(s);var o=this._effectWrapper=UIHelper.createPanel({position:UIHelper.getCenterPosition(),anchorPoint:cc.p(.5,.5)});s.addChild(o);var a=new Effect(res.miaowanresultcircle_json),r=new Effect(res.miaowanresultcloud_json),c=this.miaowanresultEffect=new Effect(res.miaowanresult_json);o.addChild(a),a.play(!0),o.addChild(r),r.play(!0),o.addChild(c),c.play(!1);var l=this._bottomPanel,h=this.wrapper=UIHelper.createPanel({bTouchEnable:!0,position:cc.p(0,0),anchorPoint:cc.p(0,0),size:cc.size(t,i)});l.addChild(h),h.addTouchEventListener(this._onRankButtonTouched,this);var u=UIHelper.createButton({normalFile:res.mr_words_djjx_png,bPressedActionEnabled:!0,bPlistTexture:!1,position:cc.p(320,280),anchorPoint:cc.p(.5,0),bTouchEnable:!0});u.addTouchEventListener(this._onRankButtonTouched,this),l.addChild(u);var _=this._topPanel.getContentSize(),d=UIHelper.createButton({normalFile:"btn_back_N.png",bPlistTexture:!0,position:cc.p(15,_.height-20),anchorPoint:cc.p(0,1),bTouchEnable:!0});d.addTouchEventListener(this._onSureButtonTouched,this),this._topPanel.addChild(d),this._topPanel.setZOrder(2),this.showScore(this._score),UIHelper.adjustUILayout(this),l.y=0,this._haveShowResult=!1,this._listenerList=[],Util.registerListener(this._listenerList,EventID.ON_WINDOW_RESIZE,this._onWindowResize.bind(this)),Util.registerListener(this._listenerList,EventID.ON_NETWORK_TIP_WINDOW_CANCEL,this._onNetworkTipWindowCancel.bind(this)),null==GameProxy.getSettlementSuccessResult()||this._haveShowResult?Util.registerListener(this._listenerList,EventID.SETTLEMENT_SUCCESS,this._onSettlementSuccess.bind(this)):(this._haveShowResult=!0,l.setVisible(!0)),null==GameProxy.getSettlementFailResult()||this._haveShowResult?Util.registerListener(this._listenerList,EventID.SETTLEMENT_FAIL,this._onSettlementFail.bind(this)):(this._haveShowResult=!0,this._showErrorWindow(GameProxy.getSettlementFailResult()))},_onSettlementSuccess:function(){this._haveShowResult||(this._haveShowResult=!0,this._bottomPanel.setVisible(!0))},_onSettlementFail:function(e){this._haveShowResult||(this._haveShowResult=!0,this._showErrorWindow(e.userData.error))},_showErrorWindow:function(e){var t=null!=e?e.ret:-1,i=null!=e&&null!=e.ret_desc?e.ret_desc:Language.getString(LanguageKey.SETTLEMENT_CHEAT);TipWindow.Show(cc.formatStr(i,t))},_onWindowResize:function(){this._container.setPosition(UIHelper.getCenterPosition()),UIHelper.adjustUILayout(this)},_onNetworkTipWindowCancel:function(){},_onSureButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(this._backStage(),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch))},_onRankButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),PageUtil.switchPageWithLoading("PKRank",PageType.replace,ResObjects.getResObject(ResObjectConfig.PKRank)))},_onRetryButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),PageUtil.startPKMatch())},_backStage:function(){var e=GameProxy.getStageId()==MAX_STAGE_ID;MusicManager.stopAllSound(),PageUtil.switchPageTo("StageMapPage",PageType.replace,ResObjects.getResObject(ResObjectConfig.allStage),{bLastStage:e})},onEnter:function(){this._super(),wx.triggerGC&&wx.triggerGC()},onExit:function(){this._super(),Util.unRegisterListeners(this._listenerList)},_getFormatNum:function(e){return e.toString().replace(/\B(?=(\d{3})+$)/g,",")},showScore:function(e){var t=UIHelper.seekWidgetByName(this.miaowanresultEffect,"numberfill"),i=new cc.LabelBMFont(this._getFormatNum(e),res.number_brown_big_fnt);i.setAnchorPoint(cc.p(.5,0)),i.setPosition(105,60),t.addChild(i)}});
var FullSceneAnimation=SubHandleBase.extend({start:function(e){this._super(e),GuidePopup.ShowNextButton(e.position),this.complete()},destroy:function(){this._super()}}),ChessHighlightAreaAnimation=SubHandleBase.extend({_effectRootView:null,_guideSwapChessEffect:null,start:function(e){this._super(e);var t=GuideAuxiliaryData.getChessBoard(),i=t.getGrid(),o=new cc.Node;o.setContentSize(i.getContentSize()),o.setAnchorPoint(i.getAnchorPoint()),o.setScale(puzzleGame.GetScale());var s=i.convertToWorldSpaceAR(cc.ZERO);o.setPosition(s),cc.director.getRunningScene().addChild(o,GameCommonDef.LAYER_Z_ORDER_GUIDE_ANIMATION),this._effectRootView=o;var n=e.slideChessData;this._guideSwapChessEffect=t.onGuideSlideChess(n.from,n.to,o),this.complete()},destroy:function(){this._super(),AnimationCacheManager.cacheEffect(EffectCacheType.GUIDE_SWAP_CHESS,this._guideSwapChessEffect),this._guideSwapChessEffect.removeFromParent(),this._effectRootView&&this._effectRootView.removeFromParent()},onWindowResize:function(){var e=GuideAuxiliaryData.getChessBoard().getGrid().convertToWorldSpaceAR(cc.ZERO);this._effectRootView.setPosition(e)}}),TouchHighlightAreaAnimation=SubHandleBase.extend({start:function(e){this._super(e),this.complete()},destroy:function(){this._super()}});
var GuideAuxiliaryData={_chessBoard:null,_middlePanel:null,_propModalLayer:null,_fingerHighlightArea:null,_guideStageDataMap:{},_stageNeedGuideDataMap:{},addGuideStageData:function(e,i){this._guideStageDataMap[e]={bGuideStage:i}},isGuideStage:function(e){var i=this._guideStageDataMap[e];return null!=i&&i.bGuideStage},addStageNeedGuide:function(e,i){this._stageNeedGuideDataMap[e]={bNeedGuide:i}},isStageNeedGuide:function(e){var i=this._stageNeedGuideDataMap[e];return null!=i&&i.bNeedGuide},isNeedGuide:function(e){return cc._renderType!=cc.game.RENDER_TYPE_CANVAS&&(this.isGuideStage(e)&&this.isStageNeedGuide(e))},setChessBoard:function(e){this._chessBoard=e},getChessBoard:function(){return this._chessBoard},setMiddlePanel:function(e){this._middlePanel=e},getMiddlePanel:function(){return this._middlePanel},setPropModalLayer:function(e){this._propModalLayer=e},getPropModalLayer:function(){return this._propModalLayer},setFingerHighlightArea:function(e){this._fingerHighlightArea=e},getFingerHighlightArea:function(){return this._fingerHighlightArea}};
var KeywordType={VERSION:"ver",TOTAL_STEPS:"totalsteps",SCENE:"SCENE"},MaskType={FULL_SCENE_MASK:1,CHESS_MASK:2,UI_MASK:3},AnimationType={NONE:0,TOUCH_ANY_WHERE_CONTINUE:1,SLIDE_CHESS_HIGH_LIGHT_AREA:2,TOUCH_FINGER_HIGH_LIGHT_AREA:3},SlideDirection={LEFT_2_RIGHT:1,RIGHT_2_LEFT:2,TOP_2_BOTTOM:3,BOTTOM_2_TOP:4},OperationType={FULL_SCENE:1,SLIDE_CHESS_HIGH_LIGHT_AREA:2,TOUCH_FINGER_HIGH_LIGHT_AREA:3,SPECIFIED_CHESS:4},OperationReturnType={UN_BACK_CHESS_BOARD:0,BACK_CHESS_BOARD_PLAY_ANIMATION:1},GuideConfigParse=cc.Class.extend({_guideConfigList:null,parseConfig:function(e){if(this._guideConfigList=[],!cc.isArray(e))return console.log("configs is not a array"),!1;for(var a=0,r=e.length;a<r;a++){var i=e[a];KeywordType.SCENE==i.keyword?this._guideConfigList.push(this._parseScene(i)):KeywordType.VERSION==i.keyword?this._parseVersion(i):KeywordType.TOTAL_STEPS==i.keyword&&this._parseTotalStep(i)}return!0},getGuideConfigList:function(){return this._guideConfigList},_parseVersion:function(e){return{}},_parseTotalStep:function(e){return{}},_parseScene:function(e){if(null==e)return null;return{originalData:e,maskData:this._parseMask(e.masking),dialogData:this._parseDialog(e.dialog),animationData:this._parseAnimation(e.cartoon),operationData:this._parseOperator(e.operation)}},_parseMask:function(e){if(!cc.isString(e)||0==e.length)return null;var a=e.split(","),r=parseInt(a[1]),i={maskType:r};switch(r){case MaskType.CHESS_MASK:for(var t=[],n=a[2].split("|"),o=0,s=n.length;o<s;o++){var p=n[o].split("*"),_=parseInt(p[0]),l=parseInt(p[1]);t.push({row:_-1,col:l-1})}i.gridPositions=t;break;case MaskType.UI_MASK:i.maskUIId=parseInt(a[2]);break;case MaskType.FULL_SCENE_MASK:break;default:console.log("unKnown maskType : "+r)}return i},_parseDialog:function(e){if(!cc.isString(e)||0==e.length)return null;var a=e.split(","),r=parseInt(a[1]),i=a[2].split("|"),t=parseInt(i[0]),n=parseInt(i[1]);return{panelId:r,describe:a[3],position:cc.p(t,n)}},_parseAnimation:function(e){if(!cc.isString(e)||0==e.length)return null;var a=e.split(","),r=parseInt(a[1]),i={animationType:r};switch(r){case AnimationType.NONE:break;case AnimationType.TOUCH_ANY_WHERE_CONTINUE:var t=a[2].split("|"),n=parseInt(t[0]),o=parseInt(t[1]);i.position=cc.p(n,o);break;case AnimationType.SLIDE_CHESS_HIGH_LIGHT_AREA:var s=a[2].split("|"),p=parseInt(a[3]);i.slideChessData=this._parseSlideChessHighlightArea(s,p);break;case AnimationType.TOUCH_FINGER_HIGH_LIGHT_AREA:var _=parseInt(a[2]);i.maskUIId=_;break;default:console.log("unKnown animationType : "+r)}return i},_parseOperator:function(e){if(!cc.isString(e)||0==e.length)return null;var a=e.split(","),r=parseInt(a[1]),i={operationType:r,operationReturn:parseInt(a[2])};switch(r){case OperationType.FULL_SCENE:break;case OperationType.SLIDE_CHESS_HIGH_LIGHT_AREA:var t=a[3].split("|"),n=parseInt(a[4]);i.slideChessData=this._parseSlideChessHighlightArea(t,n);break;case OperationType.TOUCH_FINGER_HIGH_LIGHT_AREA:break;case OperationType.SPECIFIED_CHESS:t=a[3].split("|");var o=parseInt(t[0]),s=parseInt(t[1]);i.gridPosition={row:o-1,col:s-1};break;default:console.log("unKnown operationType : "+r)}return i},_parseSlideChessHighlightArea:function(e,a){var r={row:parseInt(e[0])-1,col:parseInt(e[1])-1},i={row:0,col:0};switch(a){case SlideDirection.LEFT_2_RIGHT:i.row=r.row,i.col=r.col+1;break;case SlideDirection.RIGHT_2_LEFT:i.row=r.row,i.col=r.col-1;break;case SlideDirection.TOP_2_BOTTOM:i.row=r.row+1,i.col=r.col;break;case SlideDirection.BOTTOM_2_TOP:i.row=r.row-1,i.col=r.col;break;default:console.log("unKnown slideDirection : "+a)}return{from:r,to:i,slideDirection:a}}}),TempGuideData={conf_data:[{step:0,keyword:"ver",masking:"1.0.1",dialog:"",cartoon:"",operation:""},{step:0,keyword:"totalsteps",masking:"2",dialog:"",cartoon:"",operation:""},{step:1,keyword:"SCENE",masking:"A,2,2*3|3*2|3*3|4*3",dialog:"B,4,0|480,530266",cartoon:"C,2,3|2,1",operation:"D,2,1,3|2,1"},{step:2,keyword:"SCENE",masking:"A,3,0",dialog:"B,0,0|222,530268",cartoon:"C,1,551|480",operation:"D,1,0"}]};
var GuideManager=cc.Class.extend({_guideConfigParse:null,_guideUIHandler:null,_guideConfigIndex:-1,ctor:function(){this._guideConfigParse=new GuideConfigParse;var e=GuideResHandler.getGuideConfig(GameProxy.getStageId());this._guideConfigParse.parseConfig(e),this._guideUIHandler=new GuideUIHandler,this._guideUIHandler.setCompleteCallBack(this._onGuideUIHandlerComplete.bind(this)),this._guideConfigIndex=-1},guide:function(){if(this._guideConfigIndex++,null!=this._guideConfigParse&&this._guideConfigIndex<this._guideConfigParse.getGuideConfigList().length){var e=this._guideConfigParse.getGuideConfigList()[this._guideConfigIndex];this._guideUIHandler.guide(e)}else eventDispatcher.dispatchEvent(EventID.ON_GUIDE_COMPLETE),console.log("all guide complete")},destroy:function(){this._guideConfigParse=null,this._guideUIHandler&&this._guideUIHandler.destroy(),this._guideUIHandler=null,this._guideConfigIndex=-1},_onGuideUIHandlerComplete:function(){this.guide()}});GuideManager.GetInstance=function(){return null==GuideManager._instance&&(GuideManager._instance=new GuideManager),GuideManager._instance},GuideManager.DestroyInstance=function(){null!=GuideManager._instance&&GuideManager._instance.destroy(),GuideManager._instance=null};
var FullSceneMask=SubHandleBase.extend({_mask:null,start:function(e){this._super(e);var t=UIHelper.createImage({imageFileName:res.mask_png,position:UIHelper.getCenterPosition(),scale:Math.max(cc.winSize.width/4,cc.winSize.height/4),opacity:0});cc.director.getRunningScene().addChild(t,GameCommonDef.LAYER_Z_ORDER_GUIDE_MASK),this._mask=t,this.complete()},destroy:function(){this._super(),this._mask&&this._mask.removeFromParent()}}),ChessMask=SubHandleBase.extend({_mask:null,_clippingNode:null,start:function(e){this._super(e);var t=new cc.DrawNode,i=new cc.ClippingNode(t),a=GuideAuxiliaryData.getMiddlePanel(),n=a.getContentSize();i.setContentSize(n),i.setPosition(UIHelper.getCenterPosition()),i.setAnchorPoint(.5,.5),i.setInverted(!0),cc.director.getRunningScene().addChild(i,GameCommonDef.LAYER_Z_ORDER_GUIDE_MASK),this._clippingNode=i;var o=UIHelper.createImage({imageFileName:res.mask_png,position:cc.p(n.width/2,n.height/2),bScale9Enabled:!0,size:n,capInsets:cc.rect(1,1,1,1),opacity:0});this._mask=o,i.addChild(o);var s=(cc.winSize.width-n.width)/2,c=cc.p(o.getPositionX()-n.width/2,n.height/2),r=UIHelper.createImage({imageFileName:res.mask_png,position:c,bScale9Enabled:!0,size:cc.size(s,n.height),capInsets:cc.rect(1,1,1,1),opacity:0,anchorPoint:cc.p(1,.5)});i.addChild(r);var d=cc.p(o.getPositionX()+n.width/2,n.height/2),l=UIHelper.createImage({imageFileName:res.mask_png,position:d,bScale9Enabled:!0,size:cc.size(s,n.height),capInsets:cc.rect(1,1,1,1),opacity:0,anchorPoint:cc.p(0,.5)});i.addChild(l);for(var h=GuideAuxiliaryData.getChessBoard(),p=h.getChessWidth(),g=e.gridPositions,m=a.getPositionX()-a.getContentSize().width*a.getAnchorPoint().x,I=h.getGrid(),_=[],u=0,P=g.length;u<P;u++){var S=g[u],v=I.getChess(S.row,S.col);if(null==v){v=new cc.Node;var w=I.getGridPosition(S.row,S.col);v.setPosition(w),I.addChild(v),_.push(v)}(w=v.convertToWorldSpace(cc.ZERO)).x-=m,t.drawDot(w,p/2,cc.color(255,255,255))}for(u=0,P=_.length;u<P;u++)_[u].removeFromParent();this.complete()},destroy:function(){this._super(),this._mask&&this._mask.removeFromParent(),this._clippingNode&&this._clippingNode.removeFromParent()},onWindowResize:function(){this._clippingNode.setPosition(UIHelper.getCenterPosition())}}),MaskUIId={};MaskUIId.STEP=0,MaskUIId.PET_BOSS=1,MaskUIId.GLASSES_PROP=3,MaskUIId.SWAP_PROP=4,MaskUIId.PASS_CONDITION=13;var UIMask=SubHandleBase.extend({_propItem:null,_mask:null,_clippingNode:null,start:function(e){this._super(e),this._propItem=null;var t=new cc.Sprite;t.setAnchorPoint(0,0);var i=new cc.ClippingNode(t),a=GuideAuxiliaryData.getMiddlePanel().getContentSize();i.setContentSize(a),i.setPosition(UIHelper.getCenterPosition()),i.setAnchorPoint(.5,.5),i.setInverted(!0),i.setAlphaThreshold(.5),cc.director.getRunningScene().addChild(i,GameCommonDef.LAYER_Z_ORDER_GUIDE_MASK),this._clippingNode=i;var n=UIHelper.createImage({imageFileName:res.mask_png,position:cc.p(a.width/2,a.height/2),bScale9Enabled:!0,size:a,capInsets:cc.rect(1,1,1,1),opacity:0});this._mask=n,i.addChild(n);var o=(cc.winSize.width-a.width)/2,s=cc.p(n.getPositionX()-a.width/2,a.height/2),c=UIHelper.createImage({imageFileName:res.mask_png,position:s,bScale9Enabled:!0,size:cc.size(o,a.height),capInsets:cc.rect(1,1,1,1),opacity:0,anchorPoint:cc.p(1,.5)});i.addChild(c);var r=cc.p(n.getPositionX()+a.width/2,a.height/2),d=UIHelper.createImage({imageFileName:res.mask_png,position:r,bScale9Enabled:!0,size:cc.size(o,a.height),capInsets:cc.rect(1,1,1,1),opacity:0,anchorPoint:cc.p(0,.5)});i.addChild(d);var l=0,h=0,p=0,g=0;switch(e.maskUIId){case MaskUIId.STEP:l=20,h=858,p=148,g=904;break;case MaskUIId.GLASSES_PROP:l=(m=this._calcPropItemData(RemoveLogic.we4Proto.ItemId.itemGlass)).startX,h=m.startY,p=m.endX,g=m.endY;break;case MaskUIId.SWAP_PROP:var m;l=(m=this._calcPropItemData(RemoveLogic.we4Proto.ItemId.itemSwap)).startX,h=m.startY,p=m.endX,g=m.endY;break;case MaskUIId.PASS_CONDITION:l=173,h=845,p=385,g=908;break;default:console.log("unKnown maskUIId : "+e.maskUIId)}if(0!=l&&0!=h&&0!=p&&0!=g){o=p-l;var I=g-h;t.setPosition(l,h),drawRoundRect(t,o,I,15,cc.color(255,255,255)),GuideAuxiliaryData.setFingerHighlightArea(cc.rect(l,h,o,I))}this.complete()},destroy:function(){this._super(),this._mask&&this._mask.removeFromParent(),this._clippingNode&&this._clippingNode.removeFromParent(),this._propItem&&this._propItem.setLight(!1)},_calcPropItemData:function(e){var t=0,i=0,a=0,n=0,o=GuideAuxiliaryData.getMiddlePanel(),s=GuideAuxiliaryData.getPropModalLayer().getPropItem(e);if(null!=s){var c=o.getPositionX()-o.getContentSize().width*o.getAnchorPoint().x,r=s.convertToWorldSpace(cc.ZERO),d=s.getContentSize();t=r.x-c,i=r.y,a=t+d.width,n=i+d.height,s.setLight(!0),this._propItem=s}return{startX:t,startY:i,endX:a,endY:n}},onWindowResize:function(){this._clippingNode.setPosition(UIHelper.getCenterPosition())}});function drawRoundRect(e,t,i,a,n){var o=new cc.Texture2D,s=new wx.createCanvas;s.width=t,s.height=i;var c=s.getContext("2d");c.clearRect(0,0,t,i),c.fillStyle="rgba("+n.r+","+n.g+","+n.b+","+n.a+")",c.beginPath(),c.moveTo(a,.5),c.lineTo(t-a,.5),c.quadraticCurveTo(t-.5,.5,t-.5,a),c.lineTo(t-.5,i-a),c.quadraticCurveTo(t-.5,i-.5,t-a,i-.5),c.lineTo(a,i-.5),c.quadraticCurveTo(.5,i-.5,.5,i-a),c.lineTo(.5,a),c.quadraticCurveTo(.5,.5,a,.5),c.fill(),o.initWithElement(s),o.handleLoadedTexture(),e.initWithTexture(o)}
var FullSceneOperation=SubHandleBase.extend({_node:null,start:function(e){this._super(e);var t=new cc.Node;t.setContentSize(cc.winSize);var n=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this._onTouchBegan.bind(this)});cc.eventManager.addListener(n,t),cc.director.getRunningScene().addChild(t,GameCommonDef.LAYER_Z_ORDER_GUIDE_OPERATION),this._node=t},destroy:function(){this._super(),this._node&&this._node.removeFromParent()},_onTouchBegan:function(e,t){return Timeout.register(function(){cc.eventManager.removeListeners(this._node),this.complete()}.bind(this),0),!0}}),FingerHighlightAreaOperation=SubHandleBase.extend({_node:null,start:function(e){this._super(e);var t=GuideAuxiliaryData.getMiddlePanel(),n=new cc.Node;n.setContentSize(t.getContentSize()),n.setAnchorPoint(t.getAnchorPoint()),n.setPosition(t.getPosition());var i=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this._onTouchBegan.bind(this)});cc.eventManager.addListener(i,n),cc.director.getRunningScene().addChild(n,GameCommonDef.LAYER_Z_ORDER_GUIDE_OPERATION),this._node=n},_onTouchBegan:function(e,t){var n=t.getCurrentTarget().convertToNodeSpace(e.getLocation());return cc.rectContainsPoint(GuideAuxiliaryData.getFingerHighlightArea(),n)&&(cc.eventManager.removeListeners(this._node),this.complete()),!0},destroy:function(){this._super(),this._node&&this._node.removeFromParent()},onWindowResize:function(){this._node.setPosition(UIHelper.getCenterPosition())}}),ChessHighlightAreaOperation=SubHandleBase.extend({_node:null,_touchRect:null,_slideDirection:null,_beginTouchPosition:null,_targetChess:null,start:function(e){this._super(e);var t=new cc.Node;t.setContentSize(cc.winSize);var n=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this._onTouchBegan.bind(this),onTouchMoved:this._onTouchMoved.bind(this)});cc.eventManager.addListener(n,t),cc.director.getRunningScene().addChild(t,GameCommonDef.LAYER_Z_ORDER_GUIDE_OPERATION),this._node=t,this._calcTouchRect(),this._slideDirection=e.slideChessData.slideDirection},onWindowResize:function(){this._calcTouchRect()},_calcTouchRect:function(){var e=GuideAuxiliaryData.getChessBoard(),t=this._config.slideChessData,n=e.getGrid().getChess(t.from.row,t.from.col);this._targetChess=n;var i=n.convertToWorldSpace(cc.ZERO),o=e.getChessWidth(),s=e.getChessHeight();this._touchRect=cc.rect(i.x-o/2,i.y-s/2,o,s)},destroy:function(){this._super(),this._node&&this._node.removeFromParent()},_onTouchBegan:function(e,t){var n=t.getCurrentTarget().convertToNodeSpace(e.getLocation());return cc.rectContainsPoint(this._touchRect,n)&&(this._beginTouchPosition=n,GuideAuxiliaryData.getChessBoard().onChessTouched(this._targetChess)),!0},_onTouchMoved:function(e,t){if(null!=this._beginTouchPosition){var n=!1,i=t.getCurrentTarget().convertToNodeSpace(e.getLocation());switch(this._slideDirection){case SlideDirection.BOTTOM_2_TOP:i.y-this._beginTouchPosition.y>10&&(n=!0);break;case SlideDirection.TOP_2_BOTTOM:i.y-this._beginTouchPosition.y<-10&&(n=!0);break;case SlideDirection.LEFT_2_RIGHT:i.x-this._beginTouchPosition.x>10&&(n=!0);break;case SlideDirection.RIGHT_2_LEFT:i.x-this._beginTouchPosition.x<-10&&(n=!0);break;default:console.log("unKnown slideDirection : "+this._slideDirection)}if(n){cc.eventManager.removeListeners(this._node),this._beginTouchPosition=null;var o=GuideAuxiliaryData.getChessBoard(),s=this._config.slideChessData;o.onTrySwap(s.from,s.to),this.complete()}}}}),WaitAnimationCompleteOperation=cc.Class.extend({_completeCallBack:null,_listenerList:null,start:function(){var e=this;this._listenerList=[],Util.registerListener(this._listenerList,EventID.ALL_ANIMATION_PLAY_COMPLETE,function(){Util.unRegisterListeners(e._listenerList),"function"==typeof e._completeCallBack&&e._completeCallBack()})},destroy:function(){Util.unRegisterListeners(this._listenerList)},setCompleteCallBack:function(e){this._completeCallBack=e}});
var PuzzleDescType={GUIDE_STAGE:3},GuideResHandler={_guideResTaskMap:{},_guideConfigMap:{},loadRes:function(e){var i=e.puzzle_stage,t=this._isGuideStage(e);if(t.bGuideStage){GuideAuxiliaryData.addGuideStageData(i,!0);if(!(GameUtil.getStarNumByStageID(i)>0)){GuideAuxiliaryData.addStageNeedGuide(i,!0);if(null!=(a=this._guideResTaskMap[i]))a.isFail()&&a.start({puzzleDesc:t.puzzleDesc,stageId:i});else{var a=new GuideResTask;this._guideResTaskMap[i]=a,a.setDelegate(this),a.start({puzzleDesc:t.puzzleDesc,stageId:i})}}else GuideAuxiliaryData.addStageNeedGuide(i,!1)}else GuideAuxiliaryData.addGuideStageData(i,!1)},isGuideResLoaded:function(e){var i=this._guideResTaskMap[e];return null!=i&&i.isFinish()},onGuideConfigLoadFinish:function(e,i){this._guideConfigMap[e]=i},getGuideConfig:function(e){return this._guideConfigMap[e]},_isGuideStage:function(e){if(1==e.puzzle_stage)return!1;var i={bGuideStage:!1,puzzleDesc:null},t=e.newbie_id;return 0==t?i:(i.bGuideStage=!0,i.puzzleDesc={desc_data1:t},i)}},GuideResTask=cc.Class.extend({_delegate:null,_bFail:!1,_puzzleDesc:null,_guideConfig:null,_bFinish:!1,_stageId:null,setDelegate:function(e){this._delegate=e},isFail:function(){return this._bFail},isFinish:function(){return this._bFinish},getGuideConfig:function(){return this._guideConfig},start:function(e){this._bFail=!1,this._puzzleDesc=e.puzzleDesc,this._stageId=e.stageId,this._loadGuideConfig(function(e){this._loadGuideUIRes(e)}.bind(this))},_loadGuideConfig:function(e){var i=this._delegate.getGuideConfig(this._stageId);if(null!=i)"function"==typeof e&&e(i);else{var t=this._puzzleDesc.desc_data1;t<10?t="00"+t:t>=10&&t<100&&(t="0"+t);var a="config/guide/new_guide_"+t+".bin.json";cc.loader.loadJson(a,function(i,t){if(null!=t){cc.loader.cache[a]=t;var s=t.conf_data;this._delegate.onGuideConfigLoadFinish(this._stageId,s),"function"==typeof e&&e(s)}else this._bFail=!0}.bind(this))}},_loadGuideUIRes:function(e){var i=this._getGuideResList(e);i.push("res/effect/platform/clickeffects.json");var t=new ResObject(i);ResLoader.silenceLoadRes(t,function(){this._bFinish=!0}.bind(this),function(){this._bFail=!0}.bind(this))},_getGuideResList:function(e){var i=[],t=new GuideConfigParse;t.parseConfig(e);for(var a=t.getGuideConfigList(),s=0,n=a.length;s<n;s++){var u=a[s].dialogData;if(null!=u){var d=UIHelper.getGuideBgPath(u.panelId);i.push(d)}}return i}});
var GuideUIHandler=cc.Class.extend({_uiHandler:null,_completeCallBack:null,guide:function(e){if(null==this._uiHandler)if(null!=e){if(null!=e.originalData){e.originalData.keyword==KeywordType.SCENE&&this._handleScene(e)}}else console.log("guideConfig is null")},setCompleteCallBack:function(e){this._completeCallBack=e},destroy:function(){this._uiHandler&&this._uiHandler.destroy(),this._uiHandler=null},_onGuideComplete:function(){this._uiHandler=null,console.log("next guide"),"function"==typeof this._completeCallBack&&this._completeCallBack()},_handleScene:function(e){this._uiHandler=new UIHandler,this._uiHandler.setCompleteCallBack(this._onGuideComplete.bind(this)),this._uiHandler.start(e)}}),UIHandler=cc.Class.extend({_completeCallBack:null,_handleDataList:null,_waitAnimationCompleteOperation:null,ctor:function(){this._handleDataList=[]},start:function(e){this._handleMask(e.maskData),this._handleDialog(e.dialogData),this._handleAnimation(e.animationData),this._handleOperation(e.operationData);for(var n=0,a=this._handleDataList.length;n<a;n++){var t=this._handleDataList[n];null!=t.subHandle&&null!=t.config&&(t.subHandle.setCompleteCallBack(this._onSubHandleComplete.bind(this)),t.subHandle.start(t.config))}},destroy:function(){this._destroySubHandle(),this._waitAnimationCompleteOperation&&this._waitAnimationCompleteOperation.destroy()},_destroySubHandle:function(){for(var e=0,n=this._handleDataList.length;e<n;e++){var a=this._handleDataList[e].subHandle;a&&a.destroy()}this._handleDataList=[]},setCompleteCallBack:function(e){this._completeCallBack=e},_onSubHandleComplete:function(){for(var e=!0,n=0,a=this._handleDataList.length;n<a;n++){var t=this._handleDataList[n].subHandle;if(null!=t&&!t.isComplete()){e=!1;break}}e&&(this._destroySubHandle(),GuidePopup.Hide(),null==this._waitAnimationCompleteOperation?this._complete():this._waitAnimationCompleteOperation.start())},_complete:function(){"function"==typeof this._completeCallBack&&this._completeCallBack()},_onWaitAnimationCompleteOperationComplete:function(){this._waitAnimationCompleteOperation&&this._waitAnimationCompleteOperation.destroy(),this._complete()},_handleMask:function(e){if(null!=e){var n=null;switch(e.maskType){case MaskType.CHESS_MASK:n=new ChessMask;break;case MaskType.FULL_SCENE_MASK:n=new FullSceneMask;break;case MaskType.UI_MASK:n=new UIMask;break;default:console.log("unKnown maskType : "+e.maskType)}null!=n&&this._handleDataList.push({subHandle:n,config:e})}else console.log("mask config is null")},_handleDialog:function(e){null!=e?GuidePopup.ShowPanel(e.panelId,e.position,e.describe):console.log("dialog config is null")},_handleAnimation:function(e){if(null!=e){var n=null;switch(e.animationType){case AnimationType.SLIDE_CHESS_HIGH_LIGHT_AREA:n=new ChessHighlightAreaAnimation;break;case AnimationType.TOUCH_FINGER_HIGH_LIGHT_AREA:n=new TouchHighlightAreaAnimation;break;case AnimationType.TOUCH_ANY_WHERE_CONTINUE:n=new FullSceneAnimation;break;case AnimationType.NONE:break;default:console.log("unKnown animationType : "+e.animationType)}null!=n&&this._handleDataList.push({subHandle:n,config:e})}else console.log("animation config is null")},_handleOperation:function(e){if(null!=e){var n=null;switch(e.operationType){case OperationType.SLIDE_CHESS_HIGH_LIGHT_AREA:n=new ChessHighlightAreaOperation;break;case OperationType.TOUCH_FINGER_HIGH_LIGHT_AREA:n=new FingerHighlightAreaOperation;break;case OperationType.FULL_SCENE:n=new FullSceneOperation;break;case OperationType.SPECIFIED_CHESS:break;default:console.log("unKnown operationType : "+e.operationType)}switch(null!=n&&this._handleDataList.push({subHandle:n,config:e}),e.operationReturn){case OperationReturnType.BACK_CHESS_BOARD_PLAY_ANIMATION:this._waitAnimationCompleteOperation=new WaitAnimationCompleteOperation,this._waitAnimationCompleteOperation.setCompleteCallBack(this._onWaitAnimationCompleteOperationComplete.bind(this))}}else console.log("operation config is null")}});
var GuidePopup=cc.Node.extend({_popupPos:null,_nextEffectPos:null,_popupView:null,_nextEffect:null,_listenerList:null,ctor:function(){this._super(),this._listenerList=[],this._popupPos=cc.p(0,0),this._nextEffectPos=cc.p(0,0),Util.registerListener(this._listenerList,EventID.ON_WINDOW_RESIZE,this.onWindowResize.bind(this)),this.setAnchorPoint(.5,.5),this.setPosition(UIHelper.getCenterPosition()),this.setContentSize(GameCommonDef.DESIGN_RESOLUTION_SIZE),cc.director.getRunningScene().addChild(this,GameCommonDef.LAYER_Z_ORDER_GUIDE_DIALOG)},showPanel:function(e,t,i){this._popupPos=t,this._popupView&&this._popupView.removeFromParent(),this._isCommonPopup(e)?this._popupView=this._createCommonPopup(t,i):this._popupView=this._createSpecificPopup(e,t),this.addChild(this._popupView)},showNextButton:function(e){if(this._nextEffect&&this._nextEffect.removeFromParent(),this._nextEffectPos=e,e){var t=this._conversionPosition(e),i=new Effect(res.clickeffects_json);i.setPosition(t),i.play(!0),this._nextEffect=i,this.addChild(i)}},onWindowResize:function(){this.setPosition(UIHelper.getCenterPosition())},_isCommonPopup:function(e){return 0===e},_conversionPosition:function(e){var t=GameCommonDef.DESIGN_RESOLUTION_SIZE.width*(e.x/640),i=GameCommonDef.DESIGN_RESOLUTION_SIZE.height*(1-e.y/960);return cc.p(t,i)},_createCommonPopup:function(e,t){var i=this._conversionPosition(e),o=UIHelper.createImage({imageFileName:UIHelper.getGuideBgPath(0),anchorPoint:cc.p(.5,1),position:cc.p(.5*this.width,i.y)}),n=UIHelper.createText({position:cc.p(180,120),anchorPoint:cc.p(0,.5),fontSize:30,fontColor:cc.color(255,255,255)});return UIHelper.subsectionTextForUIText(n,t,400),o.addChild(n),o},_createSpecificPopup:function(e,t){var i=this._conversionPosition(t);return UIHelper.createImage({imageFileName:this._imagePathWithId(e),anchorPoint:cc.p(.5,1),position:cc.p(.5*this.width,i.y)})},_imagePathWithId:function(e){return e<1||e>11?(console.log("popupId is error!!!"),""):UIHelper.getGuideBgPath(e)},hide:function(){this._popupView&&this._popupView.setVisible(!1),this._nextEffect&&this._nextEffect.setVisible(!1)},destroy:function(){Util.unRegisterListener(this._listenerList),this.removeFromParent(!0)}});GuidePopup.GetInstance=function(){return null==GuidePopup._instance&&(GuidePopup._instance=new GuidePopup),GuidePopup._instance},GuidePopup.ShowPanel=function(e,t,i,o){GuidePopup.GetInstance().showPanel(e,t,i,o)},GuidePopup.ShowNextButton=function(e){GuidePopup.GetInstance().showNextButton(e)},GuidePopup.Hide=function(){GuidePopup.GetInstance().hide()},GuidePopup.Destroy=function(){null!=GuidePopup._instance&&GuidePopup._instance.destroy(),GuidePopup._instance=null};
var NetLoadingWindow=WindowBase.extend({_delayCallBack:null,_effect:null,_delayTime:null,ctor:function(){this._super();var n=this.getContentSize(),e=cc.p(n.width/2,n.height/2),i=new Effect(res.loading2_json);i.setPosition(e),this.addChild(i),this._effect=i},setDelayTime:function(n){this._delayTime=n},setDelayCallBack:function(n){this._delayCallBack=n},resetLoadingProgress:function(){this._lable&&this._lable.setString("0%")},setLoadingTxt:function(n){if(e=this._lable)e.setVisible(!0),e.setString(n+"%");else{var e;(e=this._lable=new cc.LabelTTF(n+"%","Microsoft YaHei",20)).setPosition(cc.winSize.width/2,cc.winSize.height/2-80),e.setColor(cc.color(255,255,255)),this.addChild(e)}},hideLoadingTxt:function(){this._lable&&this._lable.setVisible(!1)},onShowNotify:function(){this._effect.play(!0),"number"==typeof this._delayTime&&this._delayTime,"function"==typeof this._delayCallBack&&this._delayCallBack(),this._delayTime=null},onShow:function(){},onHideNotify:function(){this._effect.pause()},onHide:function(){},onDestroyNotify:function(){this._effect.pause()},onDestroy:function(){},onCover:function(){},onResume:function(){}});NetLoadingWindow.GetInstance=function(){return null==NetLoadingWindow._instance&&(NetLoadingWindow._instance=new NetLoadingWindow),NetLoadingWindow._instance},NetLoadingWindow.Show=function(n,e){var i=NetLoadingWindow.GetInstance();i.setDelayTime(n),i.setDelayCallBack(e),i.resetLoadingProgress(),WindowManager.GetInstance().showWindow(i,null,!0,GameCommonDef.LAYER_Z_ORDER_NET_LOADING,!1,null,null,NetLoadingWindow.Destroy)},NetLoadingWindow.Hide=function(){WindowManager.GetInstance().hideWindow(NetLoadingWindow._instance)},NetLoadingWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(NetLoadingWindow._instance),NetLoadingWindow._instance=null};
var PageResLoadingWindow=WindowBase.extend({_delayCallBack:null,_effect:null,_delayTime:null,_contentText:null,_STHandler:null,ctor:function(){this._super();var e=this.getContentSize(),n=cc.p(e.width/2,e.height/2),i=UIHelper.createImage({imageFileName:res.mask_png,position:n,scale:Math.max(cc.winSize.width/4,cc.winSize.height/4)});this.addChild(i);var t=new Effect(res.loading1_json);t.setPosition(n),this.addChild(t),this._effect=t;var a=cc.p(cc.winSize.width/2,.15*cc.winSize.height);i=UIHelper.createText({position:a,fontSize:30,fontColor:cc.color(180,180,180),content:""});this.addChild(i),this._contentText=i},resetLoadingProgress:function(){this._lable&&this._lable.setString("0%")},setLoadingTxt:function(e){if(n=this._lable)n.setVisible(!0),n.setString(e+"%");else{var n;(n=this._lable=new cc.LabelTTF(e+"%","Microsoft YaHei",20)).setPosition(cc.winSize.width/2,cc.winSize.height/2-80),n.setColor(cc.color(255,255,255)),this.addChild(n)}},hideLoadingTxt:function(){this._lable&&this._lable.setVisible(!1)},setDelayTime:function(e){this._delayTime=e},setDelayCallBack:function(e){this._delayCallBack=e},onError:function(e){this._contentText.setString(e)},startTimer:function(){"number"==typeof this._delayTime&&this._delayTime,"function"==typeof this._delayCallBack&&this._delayCallBack(),this._delayTime=null},onShowNotify:function(){this._effect.play(!0)},onShow:function(){},onHideNotify:function(){this._contentText.setString(""),this._effect.pause()},onHide:function(){},onDestroyNotify:function(){this._effect.pause()},onDestroy:function(){},onCover:function(){},onResume:function(){},delayShow:function(){if(null==this._STHandler){console.warn("delayShow"),this.setVisible(!1);var e=this;this._STHandler=Timeout.registerEx(function(){console.warn("delayShow callback"),e._STHandler=null,e.setVisible(!0)},800)}},clearSTHandler:function(){null!=this._STHandler&&(console.warn("clearSTHandler"),Timeout.clearTimeoutEx(this._STHandler),this._STHandler=null)}});PageResLoadingWindow.GetInstance=function(){return null==PageResLoadingWindow._instance&&(PageResLoadingWindow._instance=new PageResLoadingWindow),PageResLoadingWindow._instance},PageResLoadingWindow.Show=function(e,n){console.warn("PageResLoadingWindow.Show"),TopGoldBar.Hide();var i=PageResLoadingWindow.GetInstance();i.setDelayTime(e),i.setDelayCallBack(n),i.startTimer(),i.resetLoadingProgress(),WindowManager.GetInstance().showWindow(i,null,!1,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,PageResLoadingWindow.Destroy);"LoadingTransitionPage"!=FrameController.GetInstance().getCurPageID()&&i.delayShow()},PageResLoadingWindow.setLoadingTxt=function(e){PageResLoadingWindow.GetInstance().setLoadingTxt(e)},PageResLoadingWindow.hideLoadingTxt=function(){PageResLoadingWindow.GetInstance().hideLoadingTxt()},PageResLoadingWindow.Hide=function(){PageResLoadingWindow._instance&&PageResLoadingWindow._instance.clearSTHandler(),WindowManager.GetInstance().hideWindow(PageResLoadingWindow._instance)},PageResLoadingWindow.Destroy=function(){PageResLoadingWindow._instance&&PageResLoadingWindow._instance.clearSTHandler(),WindowManager.GetInstance().destroyWindow(PageResLoadingWindow._instance),PageResLoadingWindow._instance=null},page.LoadingTransitionPage=page.BasePage.extend({onCreate:function(e){var n=UIHelper.createImage({imageFileName:res.mask_png,position:UIHelper.getCenterPosition(),scale:Math.max(cc.winSize.width/4,cc.winSize.height/4)});this.addChild(n)}});
var SubResLoadingWindow={};SubResLoadingWindow.Show=function(n,e){var i=NetLoadingWindow.GetInstance();i.setDelayTime(n),i.setDelayCallBack(e),i.resetLoadingProgress(),WindowManager.GetInstance().showWindow(i,null,!0,GameCommonDef.LAYER_Z_ORDER_NET_LOADING,!1,null,null)},SubResLoadingWindow.setLoadingTxt=function(n){NetLoadingWindow.GetInstance().setLoadingTxt(n)},SubResLoadingWindow.hideLoadingTxt=function(){NetLoadingWindow.GetInstance().hideLoadingTxt()},SubResLoadingWindow.Hide=function(){WindowManager.GetInstance().hideWindow(NetLoadingWindow._instance)},SubResLoadingWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(NetLoadingWindow._instance),NetLoadingWindow._instance=null};
var LoginGameWindow=WindowBase.extend({_touchCallBack:null,_bLoadResFinished:!1,_bLoginFinished:!1,_bLoadConfigFinished:!1,_contentText:null,_stateMap:null,_wxLoginButtonTouchedCallBack:null,_qqLoginButtonTouchedCallBack:null,_bAutoMode:!0,_wxLoginButton:null,_qqLoginButton:null,_listenerList:null,_enterGameView:null,_uploadTimeout:null,_hitPanelCount:0,ctor:function(){this._super();var t=cc.p(cc.winSize.width/2,.15*cc.winSize.height),n=(Language.getString(LanguageKey.LOADING_RES),UIHelper.createText({position:t,fontSize:35,fontColor:cc.color(180,180,180),content:"122336655"}));this.addChild(n,1),this._contentText=n;var i=UIHelper.createPanel({anchorPoint:cc.p(.5,0),position:cc.p(cc.winSize.width/2,20),size:cc.size(cc.winSize.width,50),bTouchEnable:!0});i.addTouchEventListener(this._onHitPanel,this),this.addChild(i),this._runScaleAction(n);var o={};o.loadRes={bFinished:!1,count:0,describe:Language.getString(LanguageKey.LOADING_RES)},o.loadConfig={bFinished:!1,count:0,describe:Language.getString(LanguageKey.LOADING_CONFIG)},o.login={bFinished:!1,count:0,describe:Language.getString(LanguageKey.LOGINING)},this._stateMap=o,this._listenerList=[],Util.registerListener(this._listenerList,EventID.ON_WINDOW_RESIZE,this._onWindowResize.bind(this))},_onHitPanel:function(t,n){if(ccui.Widget.TOUCH_ENDED==n){var i=this;null==this._uploadTimeout&&(this._uploadTimeout=Timeout.registerEx(function(){console.log("upload time out callback"),i._uploadTimeout=null,i._hitPanelCount=0},1e3)),this._hitPanelCount++,this._hitPanelCount>=4&&(this._hitPanelCount=0,console.log("upload log file"),wx.showToast({title:"正在上传日志"}),Service.Log.uploadAllLog())}},_onWindowResize:function(){this._contentText.setPositionX(cc.winSize.width/2),this._enterGameView&&this._enterGameView.setPositionX(cc.winSize.width/2)},setWXLoginButtonTouchedCallBack:function(t){this._wxLoginButtonTouchedCallBack=t},setQQLoginButtonTouchedCallBack:function(t){this._qqLoginButtonTouchedCallBack=t},setLoginAutoMode:function(t){this._bAutoMode=t},setTouchCallBack:function(t){this._touchCallBack=t},onLoadResFinished:function(){console.log("onLoadResFinished"),this._updateState("loadRes")},onLoginFinished:function(){this._hideLoginButton(),this._updateState("login")},onLoadConfigFinished:function(){this._updateState("loadConfig")},_updateState:function(t){var n=!1;this._stateMap[t].bFinished=!0,this._stateMap[t].count+=1;for(var i in this._stateMap)if(!this._stateMap[i].bFinished){this._contentText.setString(this._stateMap[i].describe),n=!0;break}if(!n){this._contentText.setVisible(!1);for(var i in this._stateMap)if(1!==this._stateMap[i].count){!1;break}var o=this;setTimeout(function(){o._touchCallBack()},0)}},_runScaleAction:function(t){var n=new cc.ScaleTo(.5,1.1),i=new cc.ScaleTo(.5,1),o=new cc.Sequence(n,i),e=new cc.RepeatForever(o);t.runAction(e)},_onMaskTouched:function(){var t=!0;for(var n in this._stateMap)if(!this._stateMap[n].bFinished){t=!1;break}t&&(LoginLoadDelegate.destroy(),"function"==typeof this._touchCallBack&&this._touchCallBack(),LoginGameWindow.Destroy())},_hideLogoImage:function(){var t=cc.director.getRunningScene(),n=t&&t.getChildByName("logo");n&&n.setVisible(!1)},_showLogoImage:function(){var t=cc.director.getRunningScene(),n=t&&t.getChildByName("logo");n&&n.setVisible(!0)},onShowNotify:function(){this._showLogoImage()},_hideLoginButton:function(){this._wxLoginButton&&this._wxLoginButton.setVisible(!1),this._qqLoginButton&&this._qqLoginButton.setVisible(!1),this._contentText.setVisible(!0)},_showLoginButton:function(){this._contentText.setVisible(!1),X8SDK.isWX()?this._showWXLoginButton(UIHelper.getPosition(320,150)):X8SDK.isQQ()?this._showQQLoginButton(UIHelper.getPosition(320,150)):(this._showWXLoginButton(UIHelper.getPosition(160,150)),this._showQQLoginButton(UIHelper.getPosition(480,150)))},_showWXLoginButton:function(t){if(null==this._wxLoginButton){var n=UIHelper.createButton({normalFile:"btn_wx_login_N.png",bPlistTexture:!0,bPressedActionEnabled:!0,position:t,bTouchEnable:!0});n.addTouchEventListener(this._onWXButtonTouched,this),this.addChild(n),this._wxLoginButton=n}},_showQQLoginButton:function(t){if(null==this._qqLoginButton){var n=UIHelper.createButton({normalFile:"btn_qq_login_N.png",bPlistTexture:!0,bPressedActionEnabled:!0,position:t,bTouchEnable:!0});n.addTouchEventListener(this._onQQButtonTouched,this),this.addChild(n),this._qqLoginButton=n}},_onWXButtonTouched:function(t,n){ccui.Widget.TOUCH_ENDED==n&&("function"==typeof this._wxLoginButtonTouchedCallBack&&this._wxLoginButtonTouchedCallBack(),this._contentText.setVisible(!1))},_onQQButtonTouched:function(t,n){ccui.Widget.TOUCH_ENDED==n&&("function"==typeof this._qqLoginButtonTouchedCallBack&&this._qqLoginButtonTouchedCallBack(),this._hideLoginButton())},onShow:function(){},onHideNotify:function(){this._hideLogoImage()},onHide:function(){},onDestroyNotify:function(){this._hideLogoImage()},onDestroy:function(){},onCover:function(){},onResume:function(){}});LoginGameWindow.GetInstance=function(){return null==LoginGameWindow._instance&&(LoginGameWindow._instance=new LoginGameWindow),LoginGameWindow._instance},LoginGameWindow.Show=function(t,n,i,o,e){var s=LoginGameWindow.GetInstance();s.setTouchCallBack(t),s.setLoginAutoMode(n),s.setWXLoginButtonTouchedCallBack(i),s.setQQLoginButtonTouchedCallBack(o),WindowManager.GetInstance().showWindow(s,null,!1,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,s._onMaskTouched.bind(s),e,LoginGameWindow.Destroy)},LoginGameWindow.Hide=function(){WindowManager.GetInstance().hideWindow(LoginGameWindow._instance)},LoginGameWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(LoginGameWindow._instance),LoginGameWindow._instance=null};
var LoginLoadDelegate={_bLoadResFinished:!1,_bLoadConfigFinished:!1,_bLoginFinished:!1,_bLoadBgMusicFinished:!1,_bCallLoadResFinishedFun:!1,_bCallLoadConfigFinishedFun:!1,_bCallLoginFinishedFun:!1,destroy:function(){this._bLoadResFinished=!1,this._bLoadConfigFinished=!1,this._bLoginFinished=!1,this._bCallLoadResFinishedFun=!1,this._bCallLoadConfigFinishedFun=!1,this._bCallLoginFinishedFun=!1},logout:function(){this._bLoginFinished=!1},onLoadResFinished:function(){this._bLoadResFinished=!0,this._callLoginGameWindowFinishedFun()},onLoadConfigFinished:function(){this._bLoadConfigFinished=!0,this._callLoginGameWindowFinishedFun()},onLoginFinished:function(){this._bLoginFinished=!0,this._callLoginGameWindowFinishedFun(),this._playBgMusic()},loadLoginBgMusic:function(){var i=MusicManager.getLoginBgMusicRes();cc.loader.load([i],function(i,n){null==i&&(this._bLoadBgMusicFinished=!0,this._playBgMusic())}.bind(this))},_playBgMusic:function(){this._bLoadBgMusicFinished&&this._bLoginFinished&&MusicManager.playMusic(MusicEffectFiles.Audio_login,!0)},_callLoginGameWindowFinishedFun:function(){this._bLoadResFinished&&(this._bCallLoadResFinishedFun||(this._bCallLoadResFinishedFun=!0,LoginGameWindow.GetInstance().onLoadResFinished()),this._bLoadConfigFinished&&(this._bCallLoadConfigFinishedFun||(this._bCallLoadConfigFinishedFun=!0,LoginGameWindow.GetInstance().onLoadConfigFinished())),this._bCallLoadResFinishedFun&&this._bCallLoadConfigFinishedFun&&window.Network&&Network.onLine&&GameService.clearMainTimeout&&GameService.clearMainTimeout(),this._bLoginFinished&&(this._bCallLoginFinishedFun||(this._bCallLoginFinishedFun=!0,LoginGameWindow.GetInstance().onLoginFinished())))}};
var AddStepWindow=WindowBase.extend({_closeCallBack:null,_diamondsCountText:null,_listenerList:null,_useCount:null,_addCallBack:null,_button:null,_priceType:null,_cost:null,_packageIndex:null,ctor:function(){this._super(),this._listenerList=[];var e=UIHelper.createImage({imageFileName:"bg_add_step.png",bPlistTexture:!0,position:UIHelper.getPosition(320,705)});this.addChild(e);var t=UIHelper.createImage({imageFileName:"add_step_title.png",bPlistTexture:!0,position:cc.p(295,350)});e.addChild(t);t=UIHelper.createImage({imageFileName:"bar_add_step.png",bPlistTexture:!0,position:cc.p(295,46)});e.addChild(t);var n=NetData.diamond.count||0,i=new cc.LabelBMFont("X"+n,res.number_white_fnt);i.setPosition(370,t.getContentSize().height/2),t.addChild(i),this._diamondsCountText=i;(t=UIHelper.createButton({normalFile:"btn_close_N.png",bPressedActionEnabled:!0,bPlistTexture:!0,position:cc.p(550,530),bTouchEnable:!0})).addTouchEventListener(this._onCloseButtonTouched,this),e.addChild(t);var o=UIHelper.createButton({normalFile:"btn_add_step_N.png",bPressedActionEnabled:!0,bPlistTexture:!0,position:UIHelper.getPosition(320,350),bTouchEnable:!0});o.addTouchEventListener(this._onBuyButtonTouched,this),this.addChild(o),this._button=o,UIHelper.setViewToCenter(e,o,50)},setUseCount:function(e){this._useCount=e},setCloseCallBack:function(e){this._closeCallBack=e},setAddCallBack:function(e){this._addCallBack=e},_registerListener:function(){Util.registerListener(this._listenerList,EventID.AT_DIAMOND,this._onDiamondChanged.bind(this))},_unRegisterListener:function(){Util.unRegisterListeners(this._listenerList)},_onDiamondChanged:function(){this._updateDiamondText()},_updateDiamondText:function(){var e=NetData.diamond.count||0;this._diamondsCountText.setString(e)},_onBuyButtonTouched:function(e,t){if(ccui.Widget.TOUCH_ENDED==t){if(GameUtil.isWealthEnough(this._priceType,this._cost)){var n=new BuyStagePropRequest(GameDataConfig.ADD_FIVE_STEP_PROP_ITEM_ID,1,this._packageIndex);NetLoadingWindow.Show(),GameService.buyGoods(n,function(e,t){null!=t?("function"==typeof this._addCallBack&&this._addCallBack(),NetLoadingWindow.Hide(),AddStepWindow.Hide()):(NetLoadingWindow.Hide(),TipWindow.Show(e.ret_desc))}.bind(this))}else this._priceType==PriceType.DIAMONDS&&wx.getSystemInfoSync().system.indexOf("iOS")>=0?(TipWindow.Show("钻石不足"),console.error("iOS 不能购买")):GameUtil.showExchangeWindowByPriceType(this._priceType)}},_onCloseButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&("function"==typeof this._closeCallBack&&this._closeCallBack(),AddStepWindow.Hide())},onShowNotify:function(){this._registerListener(),this._button.removeAllChildren();var e=ConfigLoader.getPropGoodsConfig(GameDataConfig.ADD_FIVE_STEP_PROP_ITEM_ID);this._priceType=e.price_type;var t="coin_big.png",n=1;switch(e.price_type){case PriceType.DIAMONDS:t="icon_diamonds_add_step.png",n=1;break;case PriceType.GOLD:t="coin_big.png",n=1.6}var i=this._button.getContentSize(),o=new SortViewGroup,d=i.height/2+10,s=UIHelper.createImage({imageFileName:t,bPlistTexture:!0,position:cc.p(100,d),scale:n});this._button.addChild(s),o.addView(s);var a=this._useCount||0;a=Math.min(a,e.price_pkg_cnt-1),this._packageIndex=a+1;var c=e.price_pkg_list[a].price;this._cost=c;var l=new cc.LabelBMFont("X"+c,res.number_white_fnt);l.setPosition(370,d),l.setScale(1.5),this._button.addChild(l),o.addView(l),o.setMidX(i.width/2),o.sort(),eventDispatcher.dispatchEvent(EventID.ON_ADD_STEP_WINDOW_SHOW),this._updateDiamondText()},onShow:function(){},onHideNotify:function(){this._unRegisterListener()},onHide:function(){},onDestroyNotify:function(){this._unRegisterListener()},onDestroy:function(){},onCover:function(){},onResume:function(){}});AddStepWindow.GetInstance=function(){return null==AddStepWindow._instance&&(AddStepWindow._instance=new AddStepWindow),AddStepWindow._instance},AddStepWindow.Show=function(e,t,n){var i=AddStepWindow.GetInstance();i.setUseCount(e),i.setAddCallBack(t),i.setCloseCallBack(n);var o=WindowAction.getScaleEaseElasticOutAction(i);WindowManager.GetInstance().showWindow(i,o,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,AddStepWindow.Destroy)},AddStepWindow.Hide=function(){WindowManager.GetInstance().hideWindow(AddStepWindow._instance)},AddStepWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(AddStepWindow._instance),AddStepWindow._instance=null};
var BombChess=ChessBase.extend({_animalView:null,_noseView:null,_glareEffect:null,_bgEffect:null,ctor:function(e){this._super(e);var t=new Effect(res.windboomeffectAction_json),i=null!=(o=GameDataConfig.BombChessConfig[e.colorType])&&null!=o.bgEffect?o.bgEffect.y:0;t.setPositionY(i),t.play(!0),this.addChild(t),this._bgEffect=t;var s=null!=(o=GameDataConfig.ColorChessViewConfig[e.colorType])?o.image1:"";(a=new cc.Sprite).initWithSpriteFrameName(s),a.setAnchorPoint(.5,.5),this.addChild(a),this._animalView=a;var a;(a=new cc.Sprite).initWithSpriteFrameName("chess/image/nose.png");var o;i=null!=(o=GameDataConfig.BombChessConfig[e.colorType])&&null!=o.nose?o.nose.y:0;a.setPositionY(i-e.size.height/2),this.addChild(a),this._noseView=a;(t=new BombChessClickEffect).setColorType(this._chessData.colorType),t.setPosition(0,-this._chessData.size.height/2),t.setOpacity(0),this.addChild(t,1),this._glareEffect=t},_playGlareEffect:function(e){this._glareEffect.setOpacity(255),e?this._glareEffect.gotoLastFrame():this._glareEffect.play()},reset:function(e){if(this.getColorType()!=e.colorType){var t=null!=(s=GameDataConfig.BombChessConfig[e.colorType])&&null!=s.bgEffect?s.bgEffect.y:0;this._bgEffect.setPositionY(t);var i=null!=(s=GameDataConfig.ColorChessViewConfig[e.colorType])?s.image1:"";this._animalView.setSpriteFrame(i);var s;t=null!=(s=GameDataConfig.BombChessConfig[e.colorType])&&null!=s.nose?s.nose.y:0;this._noseView.setPositionY(t-e.size.height/2),this._glareEffect.setColorType(e.colorType)}this._bgEffect.setOpacity(255),this._animalView.setOpacity(255),this._noseView.setOpacity(255),this._glareEffect.setOpacity(0),this._bgEffect.play(!0),this._super(e)},turnToIdle:function(){this._super(),this._glareEffect.setOpacity(0),this._animalView.setOpacity(255),this._noseView.setOpacity(255)},onClicked:function(){this._super(),this._playGlareEffect(!1),this._animalView.setOpacity(0),this._noseView.setOpacity(0)},onDropEffectStartPlay:function(e,t){this._super(e,t),this._glareEffect.setOpacity(0),this._animalView.setOpacity(0),this._noseView.setOpacity(0)},onDropEffectPlayComplete:function(){this._super(),this._animalView.setOpacity(255),this._noseView.setOpacity(255)},onRearranged:function(e,t){this._super(e,t),this._playGlareEffect(!0),this._animalView.setOpacity(0),this._noseView.setOpacity(0)},onDrop:function(e,t){this._super(e,t),this._playGlareEffect(!0)}});
var CloudChess=DynamicChess.extend({_divideEffect:null,ctor:function(t){this._super(t);var e=new Effect(cloud_divide_effect_path);e.setOpacity(0),this.addChild(e),this._divideEffect=e},reset:function(t){this._super(t),this._divideEffect.setOpacity(0)},onAttacked:function(t){this._super(t),this._divideEffect.setOpacity(255),this._divideEffect.play(!0),this._idleEffect.setOpacity(0)}});
var ConveyerChess=ChessBase.extend({_idleView:null,ctor:function(e){this._super(e),this.initSprite(e)},reset:function(e){this._super(e),this.initSprite(e)},initSprite:function(e){this._idleView&&this._idleView.removeFromParent(),this._idleView=null;var i=GameDataConfig.ConveyerChessConfig[e.extendData.conveyer_data.direction],t=null!=i?i.image1:"",n=new cc.Sprite;n.initWithSpriteFrameName(t),n.setAnchorPoint(.5,.5),n.setRotation(i.rotate),e.size.height<n.getContentSize().height&&n.setPositionY((e.size.height-n.getContentSize().height)/2);var s=null!=i&&null!=i.offset?i.offset:cc.p(0,0);n.setPositionX(n.getPositionX()+s.x),n.setPositionY(n.getPositionY()+s.y),this.addChild(n),this._idleView=n},setLocalZOrder:function(e){e=GameDataConfig.ChessLogicOrder.ORDER_0*GameDataConfig.ZOrder.CHESS,this._super(e)}});
var ConveyerLight=ChessBase.extend({_idleEffect:null,ctor:function(e){this._super(e),this.initSprite(e)},reset:function(e){this._super(e),this.initSprite(e),this._idleEffect.setOpacity(255),this._idleEffect.play(!0)},initSprite:function(e){this._idleEffect&&this._idleEffect.removeFromParent(),this._idleEffect=null;var t=GameDataConfig.ConveyerLightEffectConfig[e.extendData.conveyer_data.conveyerID%3],i=GameDataConfig.ConveyerLightDirConfig[e.extendData.conveyer_data.direction],f=null!=t&&null!=i?t[i.effectType]:"",n=new Effect(f);i&&n.setRotation(i.rotate),n.play(!0),this.addChild(n),this._idleEffect=n},setLocalZOrder:function(e){this._super(GameDataConfig.ZOrder.CONVEYER_LIGHT)},onMoveEffectStartPlay:function(e,t){this._super(e,t),this._idleEffect.setOpacity(0)},onMoveEffectPlayComplete:function(){this._super(),this._idleEffect.setOpacity(255)}});
var DirectionChess=ChessBase.extend({_bVerticalDirection:!0,_directionEffect:null,_animalView:null,_glassesView:null,_glareEffect:null,ctor:function(e){this._super(e);var i=new Effect(res.windveffectAction_json),t=GameDataConfig.DirectionChessConfig[e.colorType],s=null!=t&&null!=t.bgEffect?t.bgEffect.y:0;i.setPositionY(s),i.play(!0),this.addChild(i),this._directionEffect=i;var a=GameDataConfig.ColorChessViewConfig[e.colorType].image1;(c=new cc.Sprite).initWithSpriteFrameName(a),c.setAnchorPoint(.5,.5),this.addChild(c),this._animalView=c;var c;(c=new cc.Sprite).initWithSpriteFrameName("chess/image/glass.png");s=null!=t&&null!=t.glasses?t.glasses.y:0;c.setPositionY(s-e.size.height/2),this.addChild(c),this._glassesView=c;(i=new DirectionChessClickEffect).setColorType(this._chessData.colorType),i.setPosition(0,-this._chessData.size.height/2),i.setOpacity(0),this.addChild(i,1),this._glareEffect=i,this.setVerticalDirection(this._chessData.chessType==RemoveLogic.we4Proto.ChessType.CT_SpecialVerticalShockWave)},_playGlareEffect:function(e){this._glareEffect.setOpacity(255),e?this._glareEffect.gotoLastFrame():this._glareEffect.play()},reset:function(e){if(this.getColorType()!=e.colorType){var i=GameDataConfig.DirectionChessConfig[e.colorType],t=null!=i&&null!=i.bgEffect?i.bgEffect.y:0;this._directionEffect.setPositionY(t);var s=GameDataConfig.ColorChessViewConfig[e.colorType].image1;this._animalView.setSpriteFrame(s);t=null!=i&&null!=i.glasses?i.glasses.y:0;this._glassesView.setPositionY(t-e.size.height/2),this._glareEffect.setColorType(e.colorType)}this._directionEffect.setOpacity(255),this._animalView.setOpacity(255),this._glassesView.setOpacity(255),this._glareEffect.setOpacity(0),this._directionEffect.play(!0),this._super(e)},setVerticalDirection:function(e){if(this._bVerticalDirection!==e){this._bVerticalDirection=e;var i=this._bVerticalDirection?0:90;this._directionEffect.setRotation(i)}},finish:function(){this._super(),this.setVerticalDirection(this._chessData.chessType==RemoveLogic.we4Proto.ChessType.CT_SpecialVerticalShockWave)},turnToIdle:function(){this._super(),this._glareEffect.setOpacity(0),this._animalView.setOpacity(255),this._glassesView.setOpacity(255)},onClicked:function(){this._super(),this._playGlareEffect(!1),this._animalView.setOpacity(0),this._glassesView.setOpacity(0)},onDropEffectStartPlay:function(e,i){this._super(e,i),this._glareEffect.setOpacity(0),this._animalView.setOpacity(0),this._glassesView.setOpacity(0)},onDropEffectPlayComplete:function(){this._super(),this._animalView.setOpacity(255),this._glassesView.setOpacity(255)},onRearranged:function(e,i){this._super(e,i),this._playGlareEffect(!0),this._animalView.setOpacity(0),this._glassesView.setOpacity(0)},onDrop:function(e,i){this._super(e,i),this._playGlareEffect(!0)}});
var GhostChess=ChessBase.extend({_idleEffect:null,_bgEffect:null,ctor:function(t){this._super(t);(e=new Effect(res.ghosteffects_json)).play(!0),this.addChild(e),this._bgEffect=e;var e;(e=new Effect(res.ghostelemwnt_json)).play(!0),this.addChild(e),this._idleEffect=e},reset:function(t){this._super(t),this._bgEffect.setOpacity(255),this._bgEffect.play(!0),this._idleEffect.setOpacity(255),this._idleEffect.play(!0)},turnToIdle:function(){this._super(),this._idleEffect.setOpacity(255)},onDropEffectStartPlay:function(t,e){this._super(t,e),this._idleEffect.setOpacity(0)},onDropEffectPlayComplete:function(){this._super(),this._idleEffect.setOpacity(255)}});
var IceBearChess=ChessBase.extend({_view:null,_chessData:null,ctor:function(e){this._super(e),this._chessData=e;var c=new cc.Sprite;c.initWithSpriteFrameName(BearChessImagePath),c.setScale(this._getScale(e.iType)),c.setRotation(e.bHorizontal&&90),this.addChild(c),this._view=c},_getScale:function(e){switch(e){case RemoveLogic.weTypeModule.IceCollectType.One_And_Two:return.3;case RemoveLogic.weTypeModule.IceCollectType.Two_And_Three:return.6;case RemoveLogic.weTypeModule.IceCollectType.Three_And_Five:default:return 1}},getOffset:function(e,c){var t=cc.size(0,0);switch(this._chessData.iType){case RemoveLogic.weTypeModule.IceCollectType.One_And_Two:t=this._chessData.bHorizontal?cc.size(.5*e,0):cc.size(0,.5*-c);break;case RemoveLogic.weTypeModule.IceCollectType.Two_And_Three:t=this._chessData.bHorizontal?cc.size(e,.5*-c):cc.size(.5*e,-c);break;case RemoveLogic.weTypeModule.IceCollectType.Three_And_Five:t=this._chessData.bHorizontal?cc.size(2*e,-c):cc.size(e,2*-c)}return t}});
var MushroomChess=BeAttackChess.extend({_effectMap:null,_state:null,ctor:function(t){this._super(t),this._effectMap={},this._initIdleEffectMap(),this._calcState(),this._updateIdleEffect()},reset:function(t){this._super(t),this._calcState(),this._updateIdleEffect()},getState:function(){return this._state},_initIdleEffectMap:function(){for(var t in GameDataConfig.MushroomEffectConfig){var e=GameDataConfig.MushroomEffectConfig[t],f=null!=e&&null!=e.idleEffect&&null!=e.idleEffect.effectPath?e.idleEffect.effectPath:"",a=this._effectMap[f];null==a&&((a=new Effect(f)).setOpacity(0),this.addChild(a),this._effectMap[f]=a)}},_updateIdleEffect:function(){this._idleEffect&&this._idleEffect.setOpacity(0);var t=GameDataConfig.MushroomEffectConfig[this._state],e=null!=t&&null!=t.idleEffect&&null!=t.idleEffect.effectPath?t.idleEffect.effectPath:"",f=this._effectMap[e];null==f&&(f=new Effect(e),this.addChild(f),this._effectMap[e]=f),null==f.getParent()&&this.addChild(f),f.setOpacity(255),f.play(!0),this._idleEffect=f},_calcState:function(){var t=this._chessData.extendData.mushroomData;if(null!=t){var e=t.currentHealth;e>=21&&e<=30?this._state=1:e>=11&&e<=20?this._state=2:e>=1&&e<=10?this._state=3:e<=0&&(this._state=4)}},onAttacked:function(t){this._super(t),this._calcState(),this._updateIdleEffect()}});
var OrdinaryChess=ChessBase.extend({_animalView:null,_glareEffect:null,ctor:function(e){this._super(e);var t=GameDataConfig.ColorChessViewConfig[e.colorType],i=null!=t?t.image1:"",a=new cc.Sprite;a.initWithSpriteFrameName(i),a.setAnchorPoint(.5,.5),this.addChild(a),this._animalView=a;var s=new OrdinaryChessClickEffect;s.setColorType(this._chessData.colorType),s.setPosition(0,-this._chessData.size.height/2),s.setOpacity(0),this.addChild(s,1),this._glareEffect=s},_playGlareEffect:function(e){this._glareEffect.setOpacity(255),e?this._glareEffect.gotoLastFrame():this._glareEffect.play()},reset:function(e){if(this.getColorType()!=e.colorType){var t=GameDataConfig.ColorChessViewConfig[e.colorType],i=null!=t?t.image1:"";this._animalView.setSpriteFrame(i),this._glareEffect.setColorType(e.colorType)}this._animalView.setOpacity(255),this._glareEffect.setOpacity(0),this._super(e)},turnToIdle:function(){this._super(),this._glareEffect.setOpacity(0),this._animalView.setOpacity(255)},onClicked:function(){this._super(),this._playGlareEffect(!1),this._animalView.setOpacity(0)},onDropEffectStartPlay:function(e,t){this._super(e,t),this._glareEffect.setOpacity(0),this._animalView.setOpacity(0)},onDropEffectPlayComplete:function(){this._super(),this._animalView.setOpacity(255)},onRearranged:function(e,t){this._super(e,t),this._playGlareEffect(!0),this._animalView.setOpacity(0)},onDrop:function(e,t){this._super(e,t),this._playGlareEffect(!0)}});
var SodaBottleChess=ChessBase.extend({_bubbleEffect:null,_clickEffect:null,_animalView:null,ctor:function(e){this._super(e);var t=GameDataConfig.ColorChessViewConfig[e.colorType],i=null!=t?t.image1:"",c=new cc.Sprite;c.initWithSpriteFrameName(i),c.setAnchorPoint(.5,.5),this.addChild(c),this._animalView=c;(s=new Effect(res.bubblehold_json)).play(!0),this.addChild(s),this._bubbleEffect=s;var s;(s=new Effect(res.bubbleclick_json)).setOpacity(0),this.addChild(s),this._clickEffect=s},reset:function(e){if(this.getColorType()!=e.colorType){var t=GameDataConfig.ColorChessViewConfig[e.colorType],i=null!=t?t.image1:"";this._animalView.setSpriteFrame(i)}this._clickEffect.setOpacity(0),this._animalView.setOpacity(255),this._bubbleEffect.setOpacity(255),this._bubbleEffect.play(!0),this._super(e)},onClicked:function(){this._super(),this._clickEffect.isPlaying()||(this._bubbleEffect.setOpacity(0),this._clickEffect.setOpacity(255),this._clickEffect.setPlayCompleteCallBack(function(){this._bubbleEffect.setOpacity(255),this._clickEffect.setOpacity(0)}.bind(this)),this._clickEffect.play(!1))}});
var StaticTagChess=StaticChess.extend({_tagRoot:null,_clickedAction:null,ctor:function(e){this._super(e);var t=new cc.Node;t.setCascadeColorEnabled(!0),t.setCascadeOpacityEnabled(!0),t.setContentSize(this._chessData.size),t.setAnchorPoint(.5,.5),this.addChild(t,1),this._tagRoot=t,this._createTag()},reset:function(e){e.colorType!=this._chessData.colorType&&this._updateColor(e),this._super(e),this._createTag()},_updateColor:function(e){var t=GameDataConfig.StaticChessViewConfig[e.chessType];null==t&&(t=GameDataConfig.StaticTagChessViewConfig[e.chessType][e.colorType]);var s=null!=t?t.image1:"";this._idleView.setSpriteFrame(s)},_createTag:function(){this._tagRoot.removeAllChildren();var e=RemoveLogic.we4Proto.ChessType;switch(this._chessData.chessType){case e.CT_STEPBONUS:this._addStepBonusChessTag()}},_addStepBonusChessTag:function(){var e=new SortViewGroup;e.setMidX(this._chessData.size.width/2);var t=this;function s(s){var i=new cc.Sprite,a=cc.formatStr("obstacle/stepscounter/white%d.png",s);i.initWithSpriteFrameName(a),i.setPositionY(t._chessData.size.height/2),t._tagRoot.addChild(i),e.addView(i)}s(10);var i=this._chessData.extendData.step_bonus_data.step_bonus;if(i>0&&i<10)s(i);else if(i>=10&&i<100){var a=i%10;s(~~(i/10)),s(a)}e.sort()},turnToIdle:function(){this._idleView.stopAllActions(),this._idleView.setScale(1)},onClicked:function(){this._super();var e=cc.scaleTo(.33,1.1).easing(cc.easeInOut(3)),t=cc.scaleTo(.2,.9).easing(cc.easeInOut(3)),s=cc.scaleTo(.2,1.05).easing(cc.easeInOut(3)),i=cc.scaleTo(.2,1).easing(cc.easeInOut(3)),a=new cc.Sequence(e,t,s,i);this._idleView.stopAction(this._clickedAction),this._idleView.runAction(a),this._clickedAction=a}});
var ChessBoard=cc.Node.extend({_grid:null,_currentClickedChess:null,_chessBoardData:null,_bActivateProp:!1,_bPropAnimationPlaying:!1,_bAnimationPlaying:!1,_delegate:null,_soundConfig:null,ctor:function(i){this._super(),this._initSoundConfig(),this.setAnchorPoint(cc.p(.5,.5)),this.setPosition(cc.p(GameCommonDef.DESIGN_RESOLUTION_SIZE.width/2,iphoneXMode?GameCommonDef.DESIGN_RESOLUTION_SIZE.height/2:cc.visibleRect.center.y)),this.setScale(puzzleGame.GetScale()),this.setContentSize(GameCommonDef.DESIGN_RESOLUTION_SIZE),this._chessBoardData=i,this._initGrid()},setDelegate:function(i){this._delegate=i},getChessBoardData:function(){return this._chessBoardData},getChessGrid:function(i){return this._grid.getChessGrid(i)},turnClickedChessToIdle:function(){this._currentClickedChess&&this._currentClickedChess.turnToIdle(),this._currentClickedChess=null},getChessWidth:function(){return this._chessBoardData.chessWidth},getChessHeight:function(){return this._chessBoardData.chessHeight},getChessBoardRow:function(){return this._chessBoardData.row},getChessBoardCol:function(){return this._chessBoardData.col},removeChessByGridPosition:function(i,e){this._grid.removeChessByGridPosition(i,e)},initBearChess:function(i){this._grid.initBearChess(i)},resetChess:function(i,e){if(this._grid.resetChess(i),this._playSound(this._soundConfig.reset,i.chessType),e&&null!=i){var s={};s.viewRoot=this._grid,s.colorType=i.colorType,s.chessType=i.chessType,s.position=this._grid.getGridPosition(i.gridPosition.row,i.gridPosition.col),s.chessLogicOrder=i.extendData.chessLogicOrder,AnimationManager.playCrushEffect(s)}},rearrangeChess:function(i,e,s){var t=this._grid.rearrangeChess(i,e,function(i){"function"==typeof s&&s(),AnimationManager.onRearrangeChessComplete()}.bind(this));return null!=t&&AnimationManager.onStartRearrangeChess(),t},absorbChess:function(i){null!=this._grid.absorbChess(i,function(){AnimationManager.onAbsorbChessComplete()}.bind(this))&&AnimationManager.onStartAbsorbChess()},swapChess:function(i,e,s){switch(s){case RemoveLogic.we4Proto.SlideResult.kSwap:AnimationManager.onStartSwapChess(),this._grid.swapChess(i,e,function(){AnimationManager.onSwapChessComplete()}.bind(this));break;case RemoveLogic.we4Proto.SlideResult.kFail:AnimationManager.onStartSwapChess(),this._grid.tempSwapChess(i,e,function(){this._grid.setTouchEnabled(!0),AnimationManager.onSwapChessComplete()}.bind(this),function(){MusicManager.playEffect(MusicEffectFiles.Audio_A_falsemove)}.bind(this))}},turnChessToClicked:function(i){this._grid.turnChessToClicked(i)},addChess:function(i,e){this._grid.addChess(i,e),this._playSound(this._soundConfig.add,i.chessType)},addChessToChessGrid:function(i,e){this._grid.addChessToChessGrid(i,e),this._playSound(this._soundConfig.add,i.chessType)},synthesisChess:function(i){this._grid.synthesisChess(i)},changeChess:function(i,e){var s=this._grid.changeChess(i,e);if(null!=i&&null!=s){var t={};t.viewRoot=this._grid,t.colorType=i.colorType,t.chessType=i.chessType,t.position=this._grid.getGridPosition(i.gridPosition.row,i.gridPosition.col),t.chessLogicOrder=i.extendData.chessLogicOrder,t.chess=s;null==GameDataConfig.ChessChangeEffectConfig[t.chessType]?AnimationManager.playCrushEffect(t):AnimationManager.playChessChangeEffect(t)}},crushChess:function(i,e){var s=this._grid.crushChess(i);if(null!=s){var t={};t.viewRoot=this._grid,t.colorType=i.colorType,t.chessType=i.chessType,t.position=this._grid.getGridPosition(i.gridPosition.row,i.gridPosition.col),t.bLastPang=e,AnimationManager.playCrushEffect(t),this._playSound(this._soundConfig.crush,i.chessType),eventDispatcher.dispatchEvent(EventID.ON_CHESS_CRUSH,{chess:s})}},dropChess:function(i,e){null!=this._grid.dropChess(i,function(i){var s={};s.chessType=i.getChessType(),s.viewRoot=this._grid,s.chess=i,s.position=i.getPosition(),s.colorType=i.getColorType(),s.chessSize=cc.size(this.getChessWidth(),this.getChessHeight()),s.dropEffectZOrder=i.getLocalZOrder()+1,AnimationManager.onChessDropComplete(s),"function"==typeof e&&e()}.bind(this))&&AnimationManager.onChessStartDrop()},moveChess:function(i,e){var s=this;AnimationManager.onChessWaitMove(function(){AnimationManager.onChessDoMove();var t={};t.chessMoveCompleteCallBack=null;var o=s._grid.moveChess(i,function(){"function"==typeof t.chessMoveCompleteCallBack&&t.chessMoveCompleteCallBack(),"function"==typeof e&&e()});if(null!=o){var n=i.chessData;t.viewRoot=s._grid,t.chess=o,t.chessType=n.chessType,t.fromPosition=s._grid.getGridPosition(n.gridPosition.row,n.gridPosition.col),t.toPosition=s._grid.getGridPosition(i.to.row,i.to.col),AnimationManager.playChessMoveEffect(t)}})},moveScaleChess:function(i,e,s){var t=this;AnimationManager.onChessWaitMoveScale(function(){AnimationManager.onChessDoMoveScale();var o={};o.chessMoveScaleCompleteCallBack=null,null!=(i?t._grid.moveScaleInChess.bind(t._grid):t._grid.moveScaleOutChess.bind(t._grid))(e,function(){"function"==typeof o.chessMoveScaleCompleteCallBack&&o.chessMoveScaleCompleteCallBack(),"function"==typeof s&&s()})&&AnimationManager.onChessMoveScale(o)})},translateChess:function(i,e){var s=this;AnimationManager.onChessWaitTranslate(function(){AnimationManager.onChessDoTranslate();var t={};t.chessTranslateCompleteCallBack=null,null!=s._grid.moveChess(i,function(){"function"==typeof t.chessTranslateCompleteCallBack&&t.chessTranslateCompleteCallBack(),"function"==typeof e&&e()})&&AnimationManager.onChessTranslate(t)})},divideChess:function(i,e){var s=this;!function(){var t=i.dividedChessDataList.length;function o(){0==--t&&"function"==typeof e&&e()}if(null!=s._grid.divideChess(i)){var n=i.chessData,r={};r.viewRoot=s._grid,r.chessType=n.chessType,r.position=s._grid.getGridPosition(n.gridPosition.row,n.gridPosition.col),AnimationManager.playChessDivideEffect(r,function(){for(var e=0,t=i.dividedChessDataList.length;e<t;e++){var n=i.dividedChessDataList[e];s.addChessToChessGrid(n,function(i){i.onDivided();var e={};e.viewRoot=s._grid,e.chessType=n.chessType,e.chess=i,e.position=s._grid.getGridPosition(n.gridPosition.row,n.gridPosition.col),AnimationManager.playChessDividedEffect(e,o)})}})}}()},attackChess:function(i){var e=this._grid.attackChess(i);if(null!=e){var s={};s.viewRoot=this._grid,s.colorType=i.colorType,s.chessType=i.chessType,s.chess=e,s.position=this._grid.getGridPosition(i.gridPosition.row,i.gridPosition.col),null!=e.getState&&(s.extendData={state:e.getState()}),AnimationManager.playChessAttackedEffect(s),this._playSound(this._soundConfig.attack,i.chessType)}},changeColorChess:function(i,e){var s=this._grid.getChess(i.gridPosition.row,i.gridPosition.col,i.extendData.chessLogicOrder);if(s){AnimationManager.onChessWaitMove(function(){s.changeColor(e)})}},bombChessTick:function(i){var e=this._grid.getChess(i.gridPosition.row,i.gridPosition.col,i.extendData.chessLogicOrder);e&&e.changeNumber(i.extendData.bomb_data.tick_count)},bombChessFired:function(i){null!=this._grid.fireChess(i)&&MusicManager.playEffect(MusicEffectFiles.Audio_G_timebomb)},bombChessAddStep:function(i,e){var s=this._grid.getChess(i.gridPosition.row,i.gridPosition.col,i.extendData.chessLogicOrder);s&&s.addStep(e)},devourChess:function(i,e,s){var t=this._grid.getChess(i.gridPosition.row,i.gridPosition.col,i.extendData.chessLogicOrder);if(null!=t){t.onDevour();var o=this,n=!1;var r={};r.viewRoot=this._grid,r.chessType=i.chessType,r.chess=t,r.position=this._grid.getGridPosition(i.gridPosition.row,i.gridPosition.col),null!=t.getState&&(r.extendData={state:t.getState()}),AnimationManager.playDevourChessEffect(r,function(){n=!0;for(var i=0,s=e.length;i<s;i++)o._grid.devourChess(e[i])},function(){n||console.log("must do remove chess before add chess");for(var i=0,e=s.length;i<e;i++){var t=s[i];o._grid.addChessToChessGrid(t,function(i){var e={};e.viewRoot=o._grid,e.chessType=t.chessType,e.chess=i,e.position=o._grid.getGridPosition(t.gridPosition.row,t.gridPosition.col),AnimationManager.playChessDevouredEffect(e)})}}),this._playSound(this._soundConfig.devour,i.chessType)}},getGrid:function(){return this._grid},_initSoundConfig:function(){var i={},e=RemoveLogic.we4Proto.ChessType,s={};i.add=s,s[e.CT_SpecialVerticalShockWave]=MusicEffectFiles.Audio_G_produceshock,s[e.CT_SpecialHorizontalShockWave]=MusicEffectFiles.Audio_G_produceshock,s[e.CT_SpecialHurricane]=MusicEffectFiles.Audio_G_producebomb,s[e.CT_SpecialGas]=MusicEffectFiles.Audio_G_produceghost,s[e.CT_COLLECTCANDY]=MusicEffectFiles.Audio_G_candycreate;var t={};i.devour=t,t[e.STIT_CANDYPOT]=MusicEffectFiles.Audio_G_candyretroaction;var o={};i.reset=o,o[e.STIT_BLUEBERRY]=MusicEffectFiles.Audio_G_grass;var n={};i.attack=n,n[e.STIT_CANDYPOT]=MusicEffectFiles.Audio_G_candyjarhit;var r={};i.crush=r,r[e.CT_SpecialHurricane]=MusicEffectFiles.Audio_G_bomb,r[e.STIT_ICE]=MusicEffectFiles.Audio_G_icebroken,r[e.STIT_ICE_BEAR_UNDER]=MusicEffectFiles.Audio_G_icebroken,r[e.STIT_DEEPICE]=MusicEffectFiles.Audio_G_icebroken,r[e.STIT_BOX]=MusicEffectFiles.Audio_G_boxbroken,r[e.STIT_BOX_TWO]=MusicEffectFiles.Audio_G_boxbroken,r[e.STIT_BOX_THREE]=MusicEffectFiles.Audio_G_boxbroken,r[e.STIT_BOX_FOUR]=MusicEffectFiles.Audio_G_boxbroken,r[e.STIT_CANDYPAPER1]=MusicEffectFiles.Audio_G_jellybroken,r[e.STIT_CANDYPAPER2]=MusicEffectFiles.Audio_G_jellybroken,r[e.STIT_CANDYPAPER3]=MusicEffectFiles.Audio_G_jellybroken,r[e.STIT_CANDYPAPER4]=MusicEffectFiles.Audio_G_jellybroken,r[e.STIT_CANDYPAPER5]=MusicEffectFiles.Audio_G_jellybroken,r[e.STIT_CAGE]=MusicEffectFiles.Audio_G_lockbroken,r[e.CT_CLODS0]=MusicEffectFiles.Audio_G_chocolatebroken,r[e.CT_CLODS1]=MusicEffectFiles.Audio_G_chocolatebroken,r[e.STIT_DONUTSBOMB]=MusicEffectFiles.Audio_G_bombboom,this._soundConfig=i},_initGrid:function(){var i=this._chessBoardData,e=new GridData(i.row,i.col,this._chessBoardData.viewportRow,this._chessBoardData.viewportCol,i.chessWidth,i.chessHeight,i.chessGridDataList),s=new Grid(e);s.setPosition(GameDataConfig.CHESS_BOARD_POSITION),s.setDelegate(this),this.addChild(s),this._grid=s},_isCanOperator:function(){return!this._bAnimationPlaying&&!this._bActivateProp&&!this._bPropAnimationPlaying},_trySwap:function(i,e){this._delegate.onTrySwapChess()&&(puzzleGame.input(new Input(RemoveLogic.we4Proto.InputOp.kOpSlide,i,e)),this.turnClickedChessToIdle())},_playSound:function(i,e){if(null!=i){var s=i[e];s&&MusicManager.playEffect(s)}},onChessTouched:function(i){if(null==i)return this.turnClickedChessToIdle(),!1;if(null!=this._currentClickedChess){if(this._currentClickedChess!=i)return this._trySwap(this._currentClickedChess.getGridPosition(),i.getGridPosition()),!0}else this._currentClickedChess=i;return MusicManager.playEffect(MusicEffectFiles.Audio_A_select),this._currentClickedChess.onClicked(),!1},onTrySwap:function(i,e){this._trySwap(i,e)},onTriggerDirectionCrush:function(i,e,s){if(!(i<0||i>=this.getChessBoardRow()||e<0||e>=this.getChessBoardCol())){var t={};t.viewRoot=this._grid,t.position=this._grid.getGridPosition(i,e),t.bHorizontal=s,AnimationManager.playShockWaveEffect(t),MusicManager.playEffect(MusicEffectFiles.Audio_G_shockwave)}},onTriggerGhostSing:function(i,e){var s={};s.viewRoot=this._grid,s.position=this._grid.getGridPosition(i,e),AnimationManager.playGhostSingEffect(s)},onTriggerGhostAbsorb:function(i,e){var s={};s.viewRoot=this._grid,s.position=this._grid.getGridPosition(i,e),AnimationManager.playGhostAbsorbEffect(s)},onCollectBear:function(i){var e=this._grid.getBearChess(i.id);if(e){var s={};s.viewRoot=this._grid,s.chessType=RemoveLogic.we4Proto.ChessType.STIT_COLLECT_UNDER_ICE,s.chess=e,s.position=e.getPosition(),e.setLocalZOrder(GameDataConfig.ChessLogicOrder.ORDER_3*GameDataConfig.ZOrder.CHESS),AnimationManager.playCollectBearChessEffect(s)}},onGhostChess2GhostChess:function(i,e){var s={};s.position=this._grid.getGridPosition(i,e),s.viewRoot=this._grid,AnimationManager.playGhostApertureEffect(s)},onChessCrushByRadial:function(i,e,s,t){var o=this._grid.getGridPosition(i,e),n=UIHelper.createText({position:o,content:s,fontSize:30,fontColor:cc.color(255,255,255)});t.addChild(n);var r=new cc.MoveBy(.5,cc.p(0,50)),a=new cc.RemoveSelf,c=new cc.Sequence(r,a);n.runAction(c)},onTriggerLastPangRadial:function(i,e,s,t,o){var n=this._grid.getGridPosition(i,e),r={};r.fromPosition=cc.p(s.x,s.y),r.toPosition=n,r.viewRoot=t,r.animationDataList=o,AnimationManager.playLastPangRadialAnimation(r,function(i){LastPang.triggerLastpangRadialCrush(i)}.bind(this))},onAllAnimationsPlayComplete:function(){this._bAnimationPlaying=!1,this._grid.setTouchEnabled(this._isCanOperator())},onStartPlayAnimation:function(){this._bAnimationPlaying=!0,this._grid.setTouchEnabled(this._isCanOperator())},onStartPlayPropAnimation:function(){this._bPropAnimationPlaying=!0,this._grid.setTouchEnabled(this._isCanOperator())},onPropAnimationPlayComplete:function(){this._bPropAnimationPlaying=!1,this._grid.setTouchEnabled(this._isCanOperator())},onActivateProp:function(){this._bActivateProp=!0,this.turnClickedChessToIdle(),this._grid.setTouchEnabled(this._isCanOperator())},onUnActivateProp:function(){this._bActivateProp=!1,this._grid.setTouchEnabled(this._isCanOperator())},onTipSwapChess:function(i,e,s){var t=this._grid.getGridPosition(i.row,i.col),o=this._grid.getGridPosition(e.row,e.col),n={};n.viewRoot=this._grid,n.position=t,n.fromPosition=t,n.toPosition=o;for(var r=[],a=0,c=s.length;a<c;a++){var h=s[a];r.push(this._grid.getGridPosition(h.row,h.col))}n.crushPositionList=r,AnimationManager.playTipSwapChessEffect(n)},onGuideSlideChess:function(i,e,s){var t=this._grid.getGridPosition(i.row,i.col),o=this._grid.getGridPosition(e.row,e.col),n={};return n.viewRoot=s,n.position=t,n.fromPosition=t,n.toPosition=o,AnimationManager.playGuideSlideChessEffect(n)},onStartScroll:function(){this._bAnimationPlaying=!0,this._grid.setTouchEnabled(this._isCanOperator())},onScrollComplete:function(){this._bAnimationPlaying=!1,this._grid.setTouchEnabled(this._isCanOperator())}});
var ChessBoardBackground=cc.Node.extend({_globalChessBoardBgRowList:null,_viewportChessBoardBgRowList:null,_startRowIndex:null,_chessWidth:null,_chessHeight:null,_maxRow:null,_maxCol:null,_viewportRow:null,_viewportCol:null,_gridDataList:null,_extendEdgeList:null,_bgRootNode:null,_edgeWidth:null,ctor:function(t){this._super(),this.setAnchorPoint(cc.p(.5,.5)),this.setPosition(cc.p(GameCommonDef.DESIGN_RESOLUTION_SIZE.width/2,iphoneXMode?GameCommonDef.DESIGN_RESOLUTION_SIZE.height/2:cc.visibleRect.center.y)),this.setScale(puzzleGame.GetScale()),this.setContentSize(GameCommonDef.DESIGN_RESOLUTION_SIZE),this._maxRow=t.row,this._maxCol=t.col,this._viewportRow=t.viewportRow,this._viewportCol=t.viewportCol,this._chessWidth=t.chessWidth,this._chessHeight=t.chessHeight,this._startRowIndex=0,this._edgeWidth=10,this._globalChessBoardBgRowList=[],this._viewportChessBoardBgRowList=[],this._extendEdgeList=[],this._initGridDataList(t),this._initChessBoardBg(t);var e=this._startRowIndex+this._viewportRow-1;this._updateChessBoardBgRowOpacity(this._startRowIndex,e),this._updateViewportChessGridList(),this._removeExtendEdge(),this._addExtendEdge()},scrollToRow:function(t,e,i){this._removeExtendEdge(),this._updateChessBoardBgRowOpacity(0,this._maxRow-1);var o=(t-this._startRowIndex)*this._chessHeight,a=this;function s(){a._startRowIndex=t;var e=a._startRowIndex+a._viewportRow-1;a._updateChessBoardBgRowOpacity(a._startRowIndex,e),a._updateViewportChessGridList(),a._addExtendEdge(),"function"==typeof i&&i()}if(e<=0){var n=this._bgRootNode.getPositionY()+o;return this._bgRootNode.setPositionY(n),void s()}var r=new cc.MoveBy(e,cc.p(0,o)),l=new cc.CallFunc(s),h=new cc.Sequence(r,l);this._bgRootNode.runAction(h)},_removeExtendEdge:function(){for(var t=0,e=this._extendEdgeList.length;t<e;t++)this._extendEdgeList[t].removeFromParent();this._extendEdgeList=[]},_addExtendEdge:function(){var t=this;function e(i,o){for(var a=!0,s=0;s<t._viewportCol;s++){if(null!=t._getGridData(i,s)){a=!1;break}}return a?e(i+=o,o):i}var i=this._chessWidth,o=this._chessHeight,a=this._edgeWidth,s=e(this._startRowIndex,1),n=this._bgRootNode,r=this._extendEdgeList;function l(){var t=cc.p(p.x+i/2,p.y+o),e=UIHelper.createImage({imageFileName:"block_edge.png",bPlistTexture:!0,position:t,anchorPoint:cc.p(0,0),rotation:-90});n.addChild(e,1),r.push(e)}function h(){var t=UIHelper.createImage({imageFileName:"block_outer_fillet.png",bPlistTexture:!0}),e=t.getContentSize(),s=p.x-i/2-a+e.width/2,l=p.y+o+a-e.height/2;t.setPosition(s,l),n.addChild(t,2),r.push(t)}function d(){var t=UIHelper.createImage({imageFileName:"block_outer_fillet.png",bPlistTexture:!0,rotation:90}),e=t.getContentSize(),s=p.x+i/2+a-e.width/2,l=p.y+o+a-e.height/2;t.setPosition(s,l),n.addChild(t,2),r.push(t)}function g(){var t=cc.p(p.x-i/2,p.y),e=UIHelper.createImage({imageFileName:"block_edge.png",bPlistTexture:!0,position:t,anchorPoint:cc.p(0,0),rotation:90});n.addChild(e,1),r.push(e)}function c(){var t=UIHelper.createImage({imageFileName:"block_outer_fillet.png",bPlistTexture:!0,rotation:-90}),e=t.getContentSize(),o=p.x-i/2-a+e.width/2,s=p.y-a+e.height/2;t.setPosition(o,s),n.addChild(t,2),r.push(t)}function _(){var t=UIHelper.createImage({imageFileName:"block_outer_fillet.png",bPlistTexture:!0,rotation:180}),e=t.getContentSize(),o=p.x+i/2+a-e.width/2,s=p.y-a+e.height/2;t.setPosition(o,s),n.addChild(t,2),r.push(t)}if(s>0)for(var u=0;u<this._viewportCol;u++){var p=this._getPosition(s,u);if(null!=this._getGridData(s,u)){l();null==this._getGridData(s,u-1)&&h();null==this._getGridData(s,u+1)&&d()}}if((s=this._startRowIndex+this._viewportRow-1)<this._maxRow-1){s=e(s,-1);for(u=0;u<this._viewportCol;u++){p=this._getPosition(s,u);if(null!=this._getGridData(s,u)){g();null==this._getGridData(s,u-1)&&c();null==this._getGridData(s,u+1)&&_()}}}},_updateChessBoardBgRowOpacity:function(t,e){if(t<0&&(t=0),t>=this._maxRow&&(t=this._maxRow-1),e<0&&(e=0),e>=this._maxRow&&(e=this._maxRow-1),t!=e){for(var i=this,o=0;o<t;o++)a(o,0);for(o=t;o<=e;o++)a(o,255);this._globalChessBoardBgRowList[e].updateBottomInnerFilletOpacity(0);for(o=e+1;o<this._maxRow;o++)a(o,0)}function a(t,e){var o=i._globalChessBoardBgRowList[t];o&&o.setOpacity(e)}},_updateViewportChessGridList:function(){this._viewportChessBoardBgRowList=[];for(var t=0;t<this._viewportRow;t++){this._viewportChessBoardBgRowList[t]=[];for(var e=this._startRowIndex+t,i=0;i<this._viewportCol;i++)this._viewportChessBoardBgRowList[t][i]=this._globalChessBoardBgRowList[e][i]}},_initGridDataList:function(t){for(var e=t.chessWidth,i=t.chessHeight,o=t.row,a=t.col,s=t.chessGridDataList,n=cc.size(viewportCol*e,viewportRow*i),r=[],l=0;l<o;l++){r[l]=[];for(var h=0;h<a;h++){var d=cc.p((h+.5)*e,n.height-(l+1)*i);r[l][h]={flag:0,position:d}}}for(var g=0,c=s.length;g<c;g++){var _=s[g];l=_.gridPosition.row,h=_.gridPosition.col;r[l][h].flag=1}this._gridDataList=r},_getPosition:function(t,e){return this._gridDataList[t][e].position},_getGridData:function(t,e){return this._gridDataList[t]&&this._gridDataList[t][e]&&1==this._gridDataList[t][e].flag?this._gridDataList[t][e]:null},_initChessBoardBg:function(t){var e=t.chessWidth,i=t.chessHeight,o=t.row,a=t.col,s=t.viewportRow,n=t.viewportCol,r=cc.size(n*e,s*i),l=new ccui.Layout;l.setClippingEnabled(!0),l.setAnchorPoint(.5,.5),l.setContentSize(cc.winSize.width/puzzleGame.GetScale(),r.height+GameDataConfig.CHESS_BOARD_MASK_EXTEND),l.setPosition(GameDataConfig.CHESS_BOARD_POSITION),this.addChild(l);var h=new cc.Node;h.setAnchorPoint(.5,.5),h.setContentSize(r),h.setPosition(l.getContentSize().width/2,l.getContentSize().height/2),l.addChild(h),this._bgRootNode=h;var d=this._edgeWidth;function g(){var t=cc.p(S.x-e/2-d,S.y),i=UIHelper.createImage({imageFileName:"block_edge.png",bPlistTexture:!0,position:t,anchorPoint:cc.p(1,0)});i.setScaleX(-1),h.addChild(i,1),D.setLeftEdge(i)}function c(){var t=cc.p(S.x+e/2,S.y),i=UIHelper.createImage({imageFileName:"block_edge.png",bPlistTexture:!0,position:t,anchorPoint:cc.p(0,0)});h.addChild(i,1),D.setRightEdge(i)}function _(){var t=cc.p(S.x+e/2,S.y+i),o=UIHelper.createImage({imageFileName:"block_edge.png",bPlistTexture:!0,position:t,anchorPoint:cc.p(0,0),rotation:-90});h.addChild(o,1),D.setTopEdge(o)}function u(){var t=cc.p(S.x-e/2,S.y),i=UIHelper.createImage({imageFileName:"block_edge.png",bPlistTexture:!0,position:t,anchorPoint:cc.p(0,0),rotation:90});h.addChild(i,1),D.setBottomEdge(i)}function p(){var t=UIHelper.createImage({imageFileName:"block_outer_fillet.png",bPlistTexture:!0}),o=t.getContentSize(),a=S.x-e/2-d+o.width/2,s=S.y+i+d-o.height/2;t.setPosition(a,s),h.addChild(t,2),D.setLeftTopOuterFillet(t)}function w(){var t=UIHelper.createImage({imageFileName:"block_outer_fillet.png",bPlistTexture:!0,rotation:-90}),i=t.getContentSize(),o=S.x-e/2-d+i.width/2,a=S.y-d+i.height/2;t.setPosition(o,a),h.addChild(t,2),D.setLeftBottomOuterFillet(t)}function m(){var t=UIHelper.createImage({imageFileName:"block_outer_fillet.png",bPlistTexture:!0,rotation:90}),o=t.getContentSize(),a=S.x+e/2+d-o.width/2,s=S.y+i+d-o.height/2;t.setPosition(a,s),h.addChild(t,2),D.setRightTopOuterFillet(t)}function v(){var t=UIHelper.createImage({imageFileName:"block_outer_fillet.png",bPlistTexture:!0,rotation:180}),i=t.getContentSize(),o=S.x+e/2+d-i.width/2,a=S.y-d+i.height/2;t.setPosition(o,a),h.addChild(t,2),D.setRightBottomOuterFillet(t)}function f(){var t=UIHelper.createImage({imageFileName:"block_inner_fillet.png",bPlistTexture:!0,rotation:-90}),o=t.getContentSize(),a=S.x-e/2-o.width/2,s=S.y+i-o.height/2;t.setPosition(a,s),h.addChild(t,30),D.setLeftTopInnerFillet(t)}function C(){var t=UIHelper.createImage({imageFileName:"block_inner_fillet.png",bPlistTexture:!0}),i=t.getContentSize(),o=S.x-e/2-i.width/2,a=S.y+i.height/2;t.setPosition(o,a),h.addChild(t,3),D.setLeftBottomInnerFillet(t)}function x(){var t=UIHelper.createImage({imageFileName:"block_inner_fillet.png",bPlistTexture:!0,rotation:180}),o=t.getContentSize(),a=S.x+e/2+o.width/2,s=S.y+i-o.height/2;t.setPosition(a,s),h.addChild(t,30),D.setRightTopInnerFillet(t)}function I(){var t=UIHelper.createImage({imageFileName:"block_inner_fillet.png",bPlistTexture:!0,rotation:90}),i=t.getContentSize(),o=S.x+e/2+i.width/2,a=S.y+i.height/2;t.setPosition(o,a),h.addChild(t,3),D.setRightBottomInnerFillet(t)}function R(){var t="";t=b%2==0?B%2==0?"block_light_color.png":"block_deep_color.png":B%2==0?"block_deep_color.png":"block_light_color.png";var e=UIHelper.createImage({imageFileName:t,bPlistTexture:!0,position:S,anchorPoint:cc.p(.5,0)});h.addChild(e,4),D.setMiddleView(e)}for(var b=0;b<o;b++){var P=new ChessBoardBgRow;this._globalChessBoardBgRowList[b]=P;for(var B=0;B<a;B++){var L=this._gridDataList[b][B];if(1==L.flag){var D=new ChessGridBg,S=L.position,E=this._getGridData(b,B-1);null==E&&g();var G=this._getGridData(b,B+1);null==G&&c();var N=this._getGridData(b-1,B);null==N&&_();var F=this._getGridData(b+1,B);null==F&&u(),null==E&&null==N&&p(),null==E&&null==F&&w(),null==G&&null==N&&m(),null==G&&null==F&&v();var T=this._getGridData(b+1,B-1);null==E&&null!=T&&C();var y=this._getGridData(b-1,B-1);null==E&&null!=y&&f();var H=this._getGridData(b+1,B+1);null==G&&null!=H&&I();var k=this._getGridData(b-1,B+1);null==G&&null!=k&&x(),R(),P.pushChessGridBg(D)}}}}});
var ChessBoardBgRow=cc.Class.extend({_chessGridBgList:null,ctor:function(){this._chessGridBgList=[]},pushChessGridBg:function(t){this._chessGridBgList.push(t)},setOpacity:function(t){for(var e=0;e<this._chessGridBgList.length;e++)this._chessGridBgList[e].setOpacity(t)},updateBottomInnerFilletOpacity:function(t){for(var e=0;e<this._chessGridBgList.length;e++){var i=this._chessGridBgList[e],l=i.getLeftBottomInnerFillet();l&&l.setOpacity(t);var n=i.getRightBottomInnerFillet();n&&n.setOpacity(t)}}}),ChessGridBg=cc.Class.extend({_leftTopInnerFillet:null,_rightTopInnerFillet:null,_leftBottomInnerFillet:null,_rightBottomInnerFillet:null,_leftTopOuterFillet:null,_rightTopOuterFillet:null,_leftBottomOuterFillet:null,_rightBottomOuterFillet:null,_leftEdge:null,_rightEdge:null,_topEdge:null,_bottomEdge:null,_middleView:null,ctor:function(){this._leftTopInnerFillet=null,this._rightTopInnerFillet=null,this._leftBottomInnerFillet=null,this._rightBottomInnerFillet=null,this._leftTopOuterFillet=null,this._rightTopOuterFillet=null,this._leftBottomOuterFillet=null,this._rightBottomOuterFillet=null,this._leftEdge=null,this._rightEdge=null,this._topEdge=null,this._bottomEdge=null,this._middleView=null},setOpacity:function(t){this._leftTopInnerFillet&&this._leftTopInnerFillet.setOpacity(t),this._rightTopInnerFillet&&this._rightTopInnerFillet.setOpacity(t),this._leftBottomInnerFillet&&this._leftBottomInnerFillet.setOpacity(t),this._rightBottomInnerFillet&&this._rightBottomInnerFillet.setOpacity(t),this._leftTopOuterFillet&&this._leftTopOuterFillet.setOpacity(t),this._rightTopOuterFillet&&this._rightTopOuterFillet.setOpacity(t),this._leftBottomOuterFillet&&this._leftBottomOuterFillet.setOpacity(t),this._rightBottomOuterFillet&&this._rightBottomOuterFillet.setOpacity(t),this._leftEdge&&this._leftEdge.setOpacity(t),this._rightEdge&&this._rightEdge.setOpacity(t),this._topEdge&&this._topEdge.setOpacity(t),this._bottomEdge&&this._bottomEdge.setOpacity(t),this._middleView&&this._middleView.setOpacity(t)},setLeftTopOuterFillet:function(t){this._leftTopOuterFillet=t},getLeftTopOuterFillet:function(){return this._leftTopOuterFillet},setRightTopOuterFillet:function(t){this._rightTopOuterFillet=t},getRightTopOuterFillet:function(){return this._rightTopOuterFillet},setLeftBottomOuterFillet:function(t){this._leftBottomOuterFillet=t},getLeftBottomOuterFillet:function(){return this._leftBottomOuterFillet},setRightBottomOuterFillet:function(t){this._rightBottomOuterFillet=t},getRightBottomOuterFillet:function(){return this._rightBottomOuterFillet},setLeftEdge:function(t){this._leftEdge=t},getLeftEdge:function(){return this._leftEdge},setRightEdge:function(t){this._rightEdge=t},getRightEdge:function(){return this._rightEdge},setTopEdge:function(t){this._topEdge=t},getTopEdge:function(){return this._topEdge},setBottomEdge:function(t){this._bottomEdge=t},getBottomEdge:function(){return this._bottomEdge},setMiddleView:function(t){this._middleView=t},getMiddleView:function(){return this._middleView},setLeftTopInnerFillet:function(t){this._leftTopInnerFillet=t},getLeftTopInnerFillet:function(){return this._leftTopInnerFillet},setRightTopInnerFillet:function(t){this._rightTopInnerFillet=t},getRightTopInnerFillet:function(){return this._rightTopInnerFillet},setLeftBottomInnerFillet:function(t){this._leftBottomInnerFillet=t},getLeftBottomInnerFillet:function(){return this._leftBottomInnerFillet},setRightBottomInnerFillet:function(t){this._rightBottomInnerFillet=t},getRightBottomInnerFillet:function(){return this._rightBottomInnerFillet}});
var ChessBoardScrollController={_chessBoard:null,_chessBoardBg:null,_sodaWater:null,_sodaBubble:null,_startRowIndex:null,_maxRow:null,_viewportRow:null,_chessHeight:null,_delegate:null,_bGameStartScroll:null,_chessBoardScrollData:null,init:function(o){this._startRowIndex=0,this._maxRow=o.row,this._viewportRow=o.viewportRow,this._chessHeight=o.chessHeight,this._bGameStartScroll=!0},destroy:function(){this._chessBoard=null,this._chessBoardBg=null,this._sodaBubble=null,this._sodaWater=null,this._startRowIndex=null,this._maxRow=null,this._viewportRow=null,this._chessHeight=null,this._delegate=null,this._bGameStartScroll=null},jumpToInitialPosition:function(){puzzleGame.IsNormalDigger()?this.jumpToBottom():puzzleGame.IsSodaDigger()},scroll:function(o,t){this._bGameStartScroll=!0;var s=this;function l(){s._bGameStartScroll=!1,s._chessBoard.getGrid().recoveryChessOutOfViewport(),"function"==typeof t&&t()}puzzleGame.IsNormalDigger()?this.scrollToTop(l):puzzleGame.IsSodaDigger()&&this.scrollToBottom(function(){this.scrollToRow(o,l)}.bind(this))},setDelegate:function(o){this._delegate=o},setSodaWater:function(o){this._sodaWater=o},setSodaBubble:function(o){this._sodaBubble=o},setChessBoard:function(o){this._chessBoard=o},setChessBoardBg:function(o){this._chessBoardBg=o},jumpToBottom:function(){var o=this._maxRow-this._viewportRow;this._scrollToRow(o,0)},jumpToTop:function(){this._scrollToRow(0,null)},scrollToTop:function(o){this._scrollToRow(0,null,o)},scrollToBottom:function(o){var t=this._maxRow-this._viewportRow;this._scrollToRow(t,null,o)},scrollToRow:function(o,t){this._scrollToRow(o,null,t)},setChessBoardScrollData:function(o){this._chessBoardScrollData=o},_scrollToRow:function(o,t,s){var l=this._maxRow-this._viewportRow;if(o>l)return console.log("over maxRow("+l+") : "+o),void("function"==typeof s&&s());if(o<0)return console.log("less than minRow(0) : "+o),void("function"==typeof s&&s());var e=o;if(e==this._startRowIndex)return console.log("row same"),void("function"==typeof s&&s());var a=this,r=2,i=e-this._startRowIndex,n=i*this._chessHeight;t=null!=t?t:Math.abs(n/GameDataConfig.CHESS_BOARD_SCROLL_SPEED);function h(){0==--r&&(a._startRowIndex=e,a._bGameStartScroll||a._chessBoard.getGrid().removeChessFromChessGridMoveOutOfViewport(i),a._delegate.onChessBoardScrollComplete(),AnimationManager.onScrollChessBoardComplete(),"function"==typeof s&&s())}AnimationManager.onChessBoardWaitScroll(function(){AnimationManager.onChessBoardDoScroll(),AnimationManager.onStartScrollChessBoard(),a._delegate.onChessBoardStartScroll(),a._chessBoardBg.scrollToRow(e,t,h),a._bGameStartScroll||null==a._chessBoardScrollData||(a._getChessGridDataList(function(o){a._chessBoard.getGrid().refreshLocalChessGrid(o,i)}),a._chessBoardScrollData=null),a._chessBoard.getGrid().scrollToRow(e,t,h),a._sodaWater&&a._sodaWater.scroll({y:n},t,h),a._sodaBubble&&a._sodaBubble.scroll({y:n},t,h)})},_getChessGridDataList:function(o){for(var t=[],s=this._chessBoardScrollData.nodeDataList,l=this._chessBoardScrollData.newStartRow,e=0;e<s.length;e++){var a=s[e];if(null!=a){for(var r=[],i=a.chess_data,n=0;n<i.length;n++){var h=i[n];if(null==h)r.push(null);else{h.pos.row+=l;var c=GameUtil.createChessData(h,GameDataConfig.CHESS_GRID_WIDTH,GameDataConfig.CHESS_GRID_HEIGHT);r.push(c)}}a.pos.row+=l,t.push(new ChessGridData(a.pos.row,a.pos.col,r))}}"function"==typeof o&&o(t)}};
var ChessGrid=cc.Class.extend({_gridPosition:null,_size:null,_position:null,_chessList:null,ctor:function(){this._chessList=[]},setGridPosition:function(s){this._gridPosition=s},getGridPosition:function(){return this._gridPosition},updateGridPosition:function(s,i){this._gridPosition.row=s,this._gridPosition.col=i;for(var t=0,n=this._chessList.length;t<n;t++){var e=this._chessList[t];null!=e&&e.setGridPosition(s,i)}},setSize:function(s){this._size=s},setPosition:function(s){this._position=s},pushChess:function(s){this._chessList.push(s)},setChess:function(s,i){this._chessList[s]=i},getChess:function(s){return this._chessList[s]},getChessList:function(){return this._chessList},getTopChess:function(){for(var s=this._chessList.length-1;s>=0;s--)if(null!=this._chessList[s])return this._chessList[s];return null},getTopFeaturesChess:function(){for(var s=this._chessList.length-1;s>=0;s--){var i=this._chessList[s];if(null!=i&&i.getLogicOrder()<GameDataConfig.ChessLogicOrder.ORDER_5)return i}return null}});
var ChessGridRow=cc.Node.extend({_chessGridList:null,ctor:function(){this._super(),this._chessGridList=[]},pushChessGrid:function(s){this._chessGridList.push(s)},setPosition:function(s,t){this._super(s,t);for(var i=this.getPositionY(),e=0;e<this._chessGridList.length;e++)for(var n=this._chessGridList[e].getChessList(),o=0;o<n.length;o++){var c=n[o];c&&c.setPositionY(i)}},setOpacity:function(s){this._super(s);for(var t=0;t<this._chessGridList.length;t++)for(var i=this._chessGridList[t].getChessList(),e=0;e<i.length;e++){var n=i[e];n&&n.setOpacity(s)}},runMoveAction:function(s,t,i){if(t<=0){var e=this.getPositionX(),n=this.getPositionY()+s;return this.setPosition(e,n),void("function"==typeof i&&i())}var o=new cc.MoveBy(t,cc.p(0,s)),c=new cc.CallFunc(function(){"function"==typeof i&&i()}),h=new cc.Sequence(o,c);this.runAction(h)}});
var Grid=ccui.Layout.extend({_globalChessGridList:null,_globalChessGridRowList:null,_viewportChessGridList:null,_gridPositionList:null,_chessWidth:null,_chessHeight:null,_maxRow:null,_maxCol:null,_viewportRow:null,_viewportCol:null,_touchListener:null,_rect:null,_delegate:null,_touchPoint:null,_minSlideDistance:null,_chessAddedList:null,_bearChessList:null,_startRowIndex:null,_touchMovePoint:null,_cutOffGridPositionMap:null,ctor:function(s){this._super(),this._startRowIndex=0,this._minSlideDistance=10,this._maxRow=s.gridRow,this._maxCol=s.gridCol,this._viewportRow=s.viewportRow,this._viewportCol=s.viewportCol,this._chessWidth=s.chessWidth,this._chessHeight=s.chessHeight,this._gridPositionList=[],this._globalChessGridList=[],this._viewportChessGridList=[],this._globalChessGridRowList=[],this._chessAddedList=[],this._bearChessList=[],this._cutOffGridPositionMap={},this._rect=cc.rect(GameDataConfig.CHESS_BOARD_MASK_EXTEND/2,GameDataConfig.CHESS_BOARD_MASK_EXTEND/2,s.viewportCol*s.chessWidth,s.viewportRow*s.chessHeight),this.setClippingEnabled(!0),this.setAnchorPoint(.5,.5),this.setContentSize(this._rect.width+GameDataConfig.CHESS_BOARD_MASK_EXTEND,this._rect.height+GameDataConfig.CHESS_BOARD_MASK_EXTEND),this._initGridPositionList(),ChessCacheManager.init(),ChessCacheManager.setGridInit(!0),this._initChessGrids(s.chessGridDataList),ChessCacheManager.setGridInit(!1),this._initTouchListener();var e=this._startRowIndex+this._viewportRow-1;this._updateChessGridRowOpacity(this._startRowIndex,e),this._updateViewportChessGridList(),ChessCacheManager.preCreateChess(),this.scheduleUpdate()},getGridPosition:function(s,e){if(null!=this._gridPositionList[s]&&null!=this._gridPositionList[s][e]){var t=this._gridPositionList[s][e];return cc.p(t.x,t.y)}t=this._calcGridPosition(s,e);return this._gridPositionList[s]=[],this._gridPositionList[s][e]=t,cc.p(t.x,t.y)},getChessGrid:function(s){var e=this.convertToNodeSpace(s.getLocation());if(cc.rectContainsPoint(this._rect,e)){var t=this._convertLocalPointToGridPosition(e);return this._getChessGridInViewport(t.row,t.col)}return null},setDelegate:function(s){this._delegate=s},setTouchEnabled:function(s){this._touchListener.setEnabled(s)},rearrangeChess:function(s,e,t){var i=this.getChess(s.gridPosition.row,s.gridPosition.col,s.extendData.chessLogicOrder);if(null!=i){var o=this.getGridPosition(e.row,e.col);i.onRearranged(cc.p(o.x,o.y),t)}return i},removeChessByGridPosition:function(s,e){var t=s.row,i=s.col,o=this.getChess(t,i,e);null!=o&&(this._updateChessGrid(t,i,null,e),this._pushChessToChessCacheMap(o))},removeChess:function(s){var e=s.gridPosition.row,t=s.gridPosition.col,i=s.extendData.chessLogicOrder,o=this.getChess(e,t,i);null!=o&&(this._updateChessGrid(e,t,null,i),this._pushChessToChessCacheMap(o))},turnChessToClicked:function(s){var e=this.getChess(s.gridPosition.row,s.gridPosition.col,s.extendData.chessLogicOrder);null!=e&&e.onClicked()},devourChess:function(s){var e=s.gridPosition.row,t=s.gridPosition.col,i=s.extendData.chessLogicOrder,o=this.getChess(e,t,i);return null!=o&&(o.onDevoured(),this._updateChessGrid(e,t,null,i),this._pushChessToChessCacheMap(o)),o},absorbChess:function(s,e){var t=s.from.row,i=s.from.col,o=s.chessLogicOrder,r=this.getChess(t,i,o);if(null!=r){r.setLocalZOrder(GameDataConfig.ZOrder.ABSORBED_CHESS);var h=this.getGridPosition(s.to.row,s.to.col);this._updateChessGrid(t,i,null,o),r.onAbsorbed(h,function(s){s.setRotation(0),this._pushChessToChessCacheMap(s),"function"==typeof e&&e(s)}.bind(this))}return r},changeChess:function(s,e){s&&this.removeChess(s),this.addChess(e);var t=e.gridPosition.row,i=e.gridPosition.col,o=e.extendData.chessLogicOrder,r=this.getChess(t,i,o);return this._updateChessGrid(t,i,r,o),r},synthesisChess:function(s){this._removeAndAddChess(s)},resetChess:function(s){this._removeAndAddChess(s)},addChessToChessGrid:function(s,e){this.addChess(s);var t=s.gridPosition.row,i=s.gridPosition.col,o=s.extendData.chessLogicOrder,r=this.getChess(t,i,o);this._updateChessGrid(t,i,r,o),"function"==typeof e&&e(r)},addChess:function(s,e){var t=ChessCacheManager.getChess(s),i=t.chess;if(null!=i){t.bCreate?this.addChild(i):(null==i.getParent()&&this.addChild(i),i.reset(s)),i.setDelegate(this),i.setLocalZOrder(s.extendData.chessLogicOrder*GameDataConfig.ZOrder.CHESS),i.setPosition(this.getGridPosition(s.gridPosition.row,s.gridPosition.col)),i.setOpacity(255),i.finish();var o=s.gridPosition.row,r=s.gridPosition.col;this._chessAddedList[o]=this._chessAddedList[o]||[],this._chessAddedList[o][r]=this._chessAddedList[o][r]||{},this._chessAddedList[o][r][s.extendData.chessLogicOrder]=i,"function"==typeof e&&e(i)}},fireChess:function(s){var e=s.gridPosition.row,t=s.gridPosition.col,i=s.extendData.chessLogicOrder,o=this.getChess(e,t,i);return null!=o&&(o.fire(),this._updateChessGrid(e,t,null,i)),o},crushChess:function(s){var e=s.gridPosition.row,t=s.gridPosition.col,i=s.extendData.chessLogicOrder,o=this.getChess(e,t,i);return null!=o&&(o.onCrush(),this._updateChessGrid(e,t,null,i)),o},attackChess:function(s){var e=this.getChess(s.gridPosition.row,s.gridPosition.col,s.extendData.chessLogicOrder);return null!=e&&e.onAttacked(s),e},dropChess:function(s,e){var t=s.path[0],i=s.extendData.chessLogicOrder,o={bFromChessGrid:!1},r=this.getChess(t.row,t.col,i,o);if(null!=r){var h=s.path[s.path.length-1];r.setGridPosition(h.row,h.col);var n=this.getGridPosition(t.row,t.col);r.setPosition(n),o.bFromChessGrid&&this._updateChessGrid(t.row,t.col,null,i);var a=r.getLocalZOrder()+GameDataConfig.ZOrder.MAX_CHESS;r.setLocalZOrder(a);var c=this._createOriginalDropPath(s);r.onDrop(c,function(s){var t=i*GameDataConfig.ZOrder.CHESS;s.setLocalZOrder(t),this._updateChessGrid(h.row,h.col,s),"function"==typeof e&&e(s)}.bind(this))}return r},moveChess:function(s,e){var t=s.chessData.gridPosition,i=s.chessData.extendData.chessLogicOrder,o=this.getChess(t.row,t.col,i);if(null!=o){var r=s.to;o.setGridPosition(r.row,r.col);var h=this.getGridPosition(r.row,r.col);this._updateChessGrid(t.row,t.col,null,i),o.onMove(h,function(s){this._updateChessGrid(r.row,r.col,s,i),"function"==typeof e&&e(s)}.bind(this))}return o},moveScaleInChess:function(s,e){var t=s.chessData.gridPosition,i=s.chessData.extendData.chessLogicOrder,o=this.getChess(t.row,t.col,i);if(null!=o){var r=MoveDataHandler.getMoveScaleInChessData(s,this.getGridPosition.bind(this));this._updateChessGrid(t.row,t.col,null,i),o.moveScaleIn(r,function(s){this._pushChessToChessCacheMap(s),"function"==typeof e&&e(s)}.bind(this))}return o},moveScaleOutChess:function(s,e){var t=MoveDataHandler.getMoveScaleOutChessData(s,this.getGridPosition.bind(this));s.chessData.gridPosition=s.to,this.addChess(s.chessData);var i=s.chessData.gridPosition,o=s.chessData.extendData.chessLogicOrder,r=this.getChess(i.row,i.col,o);return null!=r&&(r.setScale(0),r.setPosition(t.originalPosition),r.moveScaleOut(t.targetPosition,function(s){this._updateChessGrid(i.row,i.col,s,o),"function"==typeof e&&e(s)}.bind(this))),r},divideChess:function(s){var e=s.chessData.gridPosition,t=e.row,i=e.col,o=s.chessData.extendData.chessLogicOrder,r=this.getChess(t,i,o);return null!=r&&(r.onDivide(),this._updateChessGrid(t,i,null,o),this._pushChessToChessCacheMap(r)),r},swapChess:function(s,e,t){var i=this.getChess(s.row,s.col);i.setUserData(this.getGridPosition(e.row,e.col)),i.onSwap(e);var o=this.getChess(e.row,e.col);o.setUserData(this.getGridPosition(s.row,s.col));var r=i.getLogicOrder()*GameDataConfig.ZOrder.CHESS;o.onSwap(s,function(){i.setLocalZOrder(r),o.setLocalZOrder(r),"function"==typeof t&&t()}),this._updateChessGrid(e.row,e.col,i),this._updateChessGrid(s.row,s.col,o),i.setLocalZOrder(r+1),o.setLocalZOrder(r)},tempSwapChess:function(s,e,t,i){var o=this.getChess(s.row,s.col);o.setUserData(this.getGridPosition(e.row,e.col)),o.onTempSwap(e);var r=this.getChess(e.row,e.col);r.setUserData(this.getGridPosition(s.row,s.col));var h=o.getLogicOrder()*GameDataConfig.ZOrder.CHESS;r.onTempSwap(s,function(){o.setLocalZOrder(h),r.setLocalZOrder(h),"function"==typeof t&&t()},i),o.setLocalZOrder(h+1),r.setLocalZOrder(h)},recoveryChessOutOfViewport:function(){this._removeChessFromChessGridBySection(0,this._startRowIndex-1),this._removeChessFromChessGridBySection(this._startRowIndex+this._viewportRow,this._maxRow-1)},refreshLocalChessGrid:function(s,e){var t=-1,i=-1;if(e<0?(t=this._startRowIndex+e,i=this._startRowIndex-1):i=(t=this._startRowIndex+this._viewportRow)+e-1,-1!=t&&-1!=i){for(var o=[],r=0,h=s.length;r<h;r++){if((a=s[r]).gridPosition.row>=t&&a.gridPosition.row<=i){var n=this._getChessGrid(a.gridPosition.row,a.gridPosition.col);this._removeAllChessFromChessGrid(n),o.push({chessGrid:n,chessGridData:a})}if(a.gridPosition.row>i)break}for(r=0,h=o.length;r<h;r++){n=o[r].chessGrid;var a=o[r].chessGridData;this._resetChessGrid(n,a)}}else console.log("row index error")},getChess:function(s,e,t,i){var o=this._getChessFromChessAddedList(s,e,t);return null==o?(o=this._getChessFromChessGridInViewport(s,e,t),null!=i&&(i.bFromChessGrid=!0)):null!=i&&(i.bFromChessGrid=!1),o},scrollToRow:function(s,e,t){this._updateChessGridRowOpacity(0,this._maxRow-1);var i=(s-this._startRowIndex)*this._chessHeight,o=this,r=this._maxRow;function h(){if(0==--r){o._startRowIndex=s;var e=o._startRowIndex+o._viewportRow-1;o._updateChessGridRowOpacity(o._startRowIndex,e),o._updateViewportChessGridList(),"function"==typeof t&&t()}}for(var n=0;n<this._maxRow;n++){var a=this._globalChessGridRowList[n];e=e||0,a.runMoveAction(i,e,h)}},getBearChess:function(s){return s<this._bearChessList.length&&this._bearChessList[s]},initBearChess:function(s){for(var e=0;e<s.length;e++){var t=s[e];if(null!=t){var i=new IceBearChess(t);if(null!=i){var o=this._calcGridPosition(t.StartRow,t.StartCol),r=i.getOffset(this._chessWidth,this._chessHeight);o.x+=r.width,o.y+=r.height,i.setPosition(o),i.finish(),this._bearChessList[e]=i,this.addChild(i,GameDataConfig.ChessLogicOrder.ORDER_0)}}}},removeChessFromChessGridMoveOutOfViewport:function(s){var e=-1,t=-1;s<0?t=(e=this._startRowIndex+this._viewportRow)-s-1:(e=this._startRowIndex-s,t=this._startRowIndex-1),this._removeChessFromChessGridBySection(e,t)},update:function(s){if(null!=this._touchMovePoint){var e=this.convertToNodeSpace(this._touchMovePoint.getLocation());Math.abs(e.x-this._touchPoint.x)>Math.abs(e.y-this._touchPoint.y)?e.x-this._touchPoint.x>=this._minSlideDistance?this._trySwap(this._touchPoint,0,1):e.x-this._touchPoint.x<-this._minSlideDistance&&this._trySwap(this._touchPoint,0,-1):e.y-this._touchPoint.y>=this._minSlideDistance?this._trySwap(this._touchPoint,-1,0):e.y-this._touchPoint.y<-this._minSlideDistance&&this._trySwap(this._touchPoint,1,0),this._touchMovePoint=null}},_createOriginalDropPath:function(s){for(var e={pathList:[],scaleFlag:!1},t=0,i=s.path.length;t<i;t++){var o=this.getGridPosition(s.path[t].row,s.path[t].col);e.pathList.push({viewPosition:o})}return e},_createDropPath:function(s){var e=this;function t(t,i){if(null==e._cutOffGridPositionMap[t])return!1;if(null==e._cutOffGridPositionMap[t][i])return!1;var o=s.path.length-1;return(t!=s.path[o].row||i!=s.path[o].col||e._cutOffGridPositionMap[t][i].chessType!=RemoveLogic.we4Proto.ChessType.STIT_CHONGDONG1)&&(t==s.path[0].row&&i==s.path[0].col&&e._cutOffGridPositionMap[t][i].chessType==RemoveLogic.we4Proto.ChessType.STIT_CHONGDONG1||(t!=s.path[0].row||i!=s.path[0].col||e._cutOffGridPositionMap[t][i].chessType!=RemoveLogic.we4Proto.ChessType.STIT_CHONGDONG2))}var i={pathList:[],scaleFlag:!1},o=null,r=null,h=!1;function n(s){var t=e.getGridPosition(o,r);i.pathList.push({viewPosition:t,bScaleIn:s}),!0!==s&&!1!==s||(i.scaleFlag=!0)}for(var a=0,c=s.path.length;a<c;a++)o=s.path[a].row,r=s.path[a].col,t(o,r)?n(h=!h):n(null);return i},_removeChessFromChessGridBySection:function(s,e){for(var t=0;t<this._maxRow;t++)if(t>=s&&t<=e)for(var i=0;i<this._maxCol;i++){var o=this._getChessGrid(t,i);this._removeAllChessFromChessGrid(o)}},_removeAllChessFromChessGrid:function(s){if(null!=s)for(var e=s.getChessList(),t=0,i=e.length;t<i;t++){var o=e[t];null!=o&&(this._pushChessToChessCacheMap(o),s.setChess(t,null))}else console.log("chessGrid is null")},_resetChessGrid:function(s,e){for(var t=0,i=e.chessDataList.length;t<i;t++){var o=e.chessDataList[t];if(null!=o){var r=ChessCacheManager.getChess(o),h=r.chess;null!=h&&(r.bCreate?this.addChild(h):(null==h.getParent()&&this.addChild(h),h.reset(o)),h.setOpacity(255),h.setDelegate(this),h.setLocalZOrder(o.extendData.chessLogicOrder*GameDataConfig.ZOrder.CHESS),h.setPosition(this.getGridPosition(o.gridPosition.row,o.gridPosition.col)),h.finish(),s.setChess(t,h))}}},_updateChessGridRowOpacity:function(s,e){if(s<0&&(s=0),s>=this._maxRow&&(s=this._maxRow-1),e<0&&(e=0),e>=this._maxRow&&(e=this._maxRow-1),s!=e){for(var t=this,i=0;i<s;i++)o(i,0);for(i=s;i<=e;i++)o(i,255);for(i=e+1;i<this._maxRow;i++)o(i,0)}function o(s,e){var i=t._globalChessGridRowList[s];i&&i.setOpacity(e)}},_updateViewportChessGridList:function(){this._viewportChessGridList=[];for(var s=0;s<this._viewportRow;s++){this._viewportChessGridList[s]=[];for(var e=this._startRowIndex+s,t=0;t<this._viewportCol;t++){var i=this._globalChessGridList[e][t];i.updateGridPosition(s,t),this._viewportChessGridList[s][t]=i}}},_removeAndAddChess:function(s){this.removeChess(s),this.addChess(s);var e=s.gridPosition.row,t=s.gridPosition.col,i=s.extendData.chessLogicOrder,o=this.getChess(e,t,i);this._updateChessGrid(e,t,o,i)},_initTouchListener:function(){this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1,onTouchBegan:this._onTouchBegan.bind(this),onTouchMoved:this._onTouchMoved.bind(this),onTouchEnded:this._onTouchEnded.bind(this),onTouchCancelled:this._onTouchCancelled.bind(this)}),cc.eventManager.addListener(this._touchListener,this)},_initGridPositionList:function(){for(var s=this._viewportRow+8,e=this._viewportCol,t=-8;t<s;t++){this._gridPositionList[t]=[];for(var i=0;i<e;i++)this._gridPositionList[t][i]=this._calcGridPosition(t,i)}},_calcGridPosition:function(s,e){return cc.p((e+.5)*this._chessWidth+GameDataConfig.CHESS_BOARD_MASK_EXTEND/2,this._rect.height-(s+1)*this._chessHeight+this._chessHeight/2+GameDataConfig.CHESS_BOARD_MASK_EXTEND/2)},_initChessGrids:function(s){for(var e=0;e<this._maxRow;e++){this._globalChessGridList[e]=[];for(var t=new ChessGridRow,i=0;i<this._maxCol;i++){(r=new ChessGrid).setGridPosition(new GridPosition(e,i)),r.setSize({width:this._chessWidth,height:this._chessHeight});var o=this.getGridPosition(e,i);r.setPosition(cc.p(o.x,o.y)),this._globalChessGridList[e][i]=r,t.pushChessGrid(r)}o=this.getGridPosition(e,0);t.setPosition(o),this.addChild(t),this._globalChessGridRowList[e]=t}e=null,i=null;for(var r=null,h=null,n=null,a=null,c=0;c<s.length;c++){var d=s[c];e=d.gridPosition.row,i=d.gridPosition.col,r=this._getChessGrid(e,i);for(var l=0;l<d.chessDataList.length;l++){if(n=null,null!=(h=d.chessDataList[l])){switch(null!=(n=(a=ChessCacheManager.getChess(h)).chess)&&(a.bCreate?this.addChild(n):(null==n.getParent()&&this.addChild(n),n.reset(h)),n.setDelegate(this),n.setOpacity(255),n.setLocalZOrder(h.extendData.chessLogicOrder*GameDataConfig.ZOrder.CHESS),n.setPosition(this.getGridPosition(e,i)),n.finish()),h.chessType){case RemoveLogic.we4Proto.ChessType.STIT_CHONGDONG1:this._cutOffGridPositionMap[e]=this._cutOffGridPositionMap[e]||[],this._cutOffGridPositionMap[e][i]={bScaleIn:!0,chessType:RemoveLogic.we4Proto.ChessType.STIT_CHONGDONG1};break;case RemoveLogic.we4Proto.ChessType.STIT_CHONGDONG2:this._cutOffGridPositionMap[e]=this._cutOffGridPositionMap[e]||[],this._cutOffGridPositionMap[e][i]={bScaleIn:!1,chessType:RemoveLogic.we4Proto.ChessType.STIT_CHONGDONG2}}if(h.chessType==RemoveLogic.we4Proto.ChessType.STIT_CONVEYER)switch(h.extendData.conveyer_data.direction){case RemoveLogic.weTypeModule.ConveyerDirection.Conveyer_Broken_Out_Up:case RemoveLogic.weTypeModule.ConveyerDirection.Conveyer_Broken_Out_Down:case RemoveLogic.weTypeModule.ConveyerDirection.Conveyer_Broken_Out_Left:case RemoveLogic.weTypeModule.ConveyerDirection.Conveyer_Broken_Out_Right:case RemoveLogic.weTypeModule.ConveyerDirection.Conveyer_Broken_In_Up:case RemoveLogic.weTypeModule.ConveyerDirection.Conveyer_Broken_In_Down:case RemoveLogic.weTypeModule.ConveyerDirection.Conveyer_Broken_In_Left:case RemoveLogic.weTypeModule.ConveyerDirection.Conveyer_Broken_In_Right:(h=Util.clone(h)).chessType=RemoveLogic.we4Proto.ChessType.STIT_CONVEYERLIGHT,h.colorType=RemoveLogic.we4Proto.ChessColor.kChessColorNone,h.extendData.chessLogicOrder=GameDataConfig.ChessLogicOrder.ORDER_5,null!=(n=(a=ChessCacheManager.getChess(h)).chess)&&(a.bCreate?this.addChild(n):(null==n.getParent()&&this.addChild(n),n.reset(h)),n.setDelegate(this),n.setOpacity(255),n.setLocalZOrder(h.extendData.chessLogicOrder*GameDataConfig.ZOrder.CHESS),n.setPosition(this.getGridPosition(e,i)),n.finish())}}r.pushChess(n)}}},_updateChessGrid:function(s,e,t,i){var o=this._getChessGridInViewport(s,e);if(null!=o){var r=null!=t?t.getLogicOrder():null!=i?i:GameDataConfig.ChessLogicOrder.ORDER_2;o.setChess(r,t)}},_pushChessToChessCacheMap:function(s){ChessCacheManager.cacheChess(s)},_onTouchBegan:function(s,e){var t=e.getCurrentTarget().convertToNodeSpace(s.getLocation());if(cc.rectContainsPoint(this._rect,t)){this._touchPoint=t;var i=this._convertLocalPointToGridPosition(t),o=this._getTopFeaturesChessFromChessGridInViewport(i.row,i.col);return!(null!=o&&o.getLogicOrder()==GameDataConfig.ChessLogicOrder.ORDER_2?this._delegate.onChessTouched(o):this._delegate.onChessTouched(null))}return this._delegate.onChessTouched(null),!1},_onTouchMoved:function(s,e){null!=this._touchPoint&&(this._touchMovePoint=s)},_onTouchEnded:function(s,e){},_onTouchCancelled:function(s,e){},_trySwap:function(s,e,t){var i=this._convertLocalPointToGridPosition(s),o=this._getTopFeaturesChessFromChessGridInViewport(i.row,i.col);if(null!=o){var r=this._getTopFeaturesChessFromChessGridInViewport(i.row+e,i.col+t);null!=r&&(this._touchPoint=null,this._delegate.onTrySwap(o.getGridPosition(),r.getGridPosition()))}},_convertLocalPointToGridPosition:function(s){var e=s.x-GameDataConfig.CHESS_BOARD_MASK_EXTEND/2,t=this._rect.height+GameDataConfig.CHESS_BOARD_MASK_EXTEND/2-s.y,i=Math.floor(t/this._chessHeight),o=Math.floor(e/this._chessWidth);return new GridPosition(i,o)},_getChessGridInViewport:function(s,e){return s>=this._viewportRow||s<0?null:e>=this._viewportCol||e<0?null:this._viewportChessGridList[s][e]},_getChessGrid:function(s,e){return s>=this._maxRow||s<0?null:e>=this._maxCol||e<0?null:this._globalChessGridList[s][e]},_getTopFeaturesChessFromChessGridInViewport:function(s,e){var t=this._getChessGridInViewport(s,e);return null!=t?t.getTopFeaturesChess():null},_getChessFromChessGridInViewport:function(s,e,t){var i=this._getChessGridInViewport(s,e);if(null!=i){var o=null!=t?t:GameDataConfig.ChessLogicOrder.ORDER_2;return i.getChess(o)}return null},_getChessFromChessAddedList:function(s,e,t){if(null!=this._chessAddedList[s]&&null!=this._chessAddedList[s][e]){var i=null!=t?t:GameDataConfig.ChessLogicOrder.ORDER_2,o=this._chessAddedList[s][e][i];return this._chessAddedList[s][e][i]=null,o}return null},onExit:function(){this._super(),this.unscheduleUpdate();var s=this;function e(e){if(null!=e)for(var t=e.getChessList(),i=0,o=t.length;i<o;i++){var r=t[i];null!=r&&s._pushChessToChessCacheMap(r)}}for(var t=0;t<this._maxRow;t++)for(var i=0;i<this._maxCol;i++)e(this._globalChessGridList[t][i]);ChessCacheManager.onExitSingleGame()},onChessCrush:function(s){null!=s&&this._pushChessToChessCacheMap(s)}});
var ChessBoardHelper={_chessBoard:null,_delegate:null,_bLastpang:!1,_bUseTaskModal:!0,init:function(s){this._delegate=s,this._chessBoard=s._chessBoard},destroy:function(){this._delegate=null,this._chessBoard=null,this._bLastpang=!1},playSwapAnimation:function(s){console.log("swap animation data =============================="),console.log(s),this._swapChess(s.from,s.to,s.result)},playRemoveAnimation:function(s){console.log("crush animation data ==============================");var a=s.data.attack_type;switch(a){case RemoveLogic.we4Proto.AttackType.Attack_Normal:case RemoveLogic.we4Proto.AttackType.Attack_Disappear:this._playChessOrdinaryCrushAnimation(s);break;case RemoveLogic.we4Proto.AttackType.Attack_Lastpang:this._playChessLastPangCrushAnimation(s);break;default:this._playSpecialChessCrushAnimation(s)}this._playCrushSound(a,s.data.rounds);var e=s.data.add_chess;if(null!=e)for(var t=0,i=e.length;t<i;t++){var o=this._createChessData(e[t]);this._synthesisChessByChessData(o)}},playAdventureSuccessAnimation:function(s){AnimationManager.playAdventureSuccessAnimation({level:s.data.level})},playStepRewardAnimation:function(s){this._bLastpang=!0,AnimationManager.pause(),LastPang.init(s),StepRewardWindow.Show(function(){LastPang.play()}.bind(this))},playRearrangeAnimation:function(s){console.log("rearrange animation data =============================="),console.log(s);for(var a=[],e=0,t=s.data.length;e<t;e++){var i=s.data[e],o=this._createChessData(i.chessData),n=new GridPosition(i.position.row,i.position.col);a.push({chessData:o,targetGridPosition:n})}RearrangeProp.rearrangeChesses(a)},playMoveAnimation:function(s){console.log("move animation data =============================="),console.log(s);var a=this._createMoveData(s);this._moveChess(a)},playTranslateAnimation:function(s){console.log("translate animation data =============================="),console.log(s);var a=this._createMoveData(s);this._translateChess(a)},playDivideAnimation:function(s){console.log("divide animation data =============================="),console.log(s);for(var a=this._createChessData(s.src_chess),e=[],t=0,i=s.split_chess.length;t<i;t++){var o=this._createChessData(s.split_chess[t]);e.push(o)}var n=new DivideData(a,e);this._divideChess(n)},playSwapPropAnimation:function(s){console.log("swap prop animation data =============================="),console.log(s);for(var a=0,e=s.data.length;a<e;a++){var t=this._createChessData(s.data[a]);this._resetChess(t)}},playGhostChess2GhostChessAnimation:function(s){console.log("gas to gas animation data ==============================");for(var a=0,e=s.data.length;a<e;a++){var t=s.data[a];this._triggerGhostAbsorb(t.row,t.col)}null!=(t=s.data[0])&&this._ghostChess2GhostChess(t.row,t.col)},playGlassesPropAnimation:function(s){console.log("glasses prop animation data =============================="),console.log(s);var a=this._createChessData(s.newChess);this._synthesisChessByChessData(a)},playAttackChessAnimation:function(s){console.log("attack chess animation data =============================="),console.log(s);var a=this._createChessData(s);this._attackChess(a)},playDevourChessAnimation:function(s){console.log("devour chess animation data =============================="),console.log(s);for(var a=0,e=s.replaceList.length;a<e;a++){for(var t=s.replaceList[a],i=this._createChessData(t.from),o=[],n=0,r=t.removed.length;n<r;n++){var h=this._createChessData(t.removed[n]);o.push(h)}var c=[];for(n=0,r=t.created.length;n<r;n++){h=this._createChessData(t.created[n]);c.push(h)}this._devourChess(i,o,c)}},playCollectBearAnimation:function(s){if(console.log("collect bear animation data =============================="),console.log(s),this._bUseTaskModal){var a={fun:this._chessBoard.onCollectBear,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(a)}else this._chessBoard.onCollectBear(s)},playColorChangeAnimation:function(s){for(var a=Object.keys(s),e=0,t=a.length;e<t;e++){var i=a[e];if("animation_id"!=i){var o=this._createChessData(s[i].oldChessData),n=this._createChessData(s[i].newChessData);if(this._bUseTaskModal){var r={fun:this._chessBoard.changeColorChess,funCaller:this._chessBoard,arguments:[o,n]};AnimationManager.getAnimationTaskHandler().pushTask(r,!0)}else this._chessBoard.changeColorChess(o,n)}}},playBombTickAnimation:function(s){var a=this._createChessData(s.chessData);if(this._bUseTaskModal){var e={fun:this._chessBoard.bombChessTick,funCaller:this._chessBoard,arguments:[a]};AnimationManager.getAnimationTaskHandler().pushTask(e)}else this._chessBoard.bombChessTick(a)},playBombFiredAnimation:function(s){var a=this._createChessData(s.chessData);if(this._bUseTaskModal){var e={fun:this._chessBoard.bombChessFired,funCaller:this._chessBoard,arguments:[a]};AnimationManager.getAnimationTaskHandler().pushTask(e)}else this._chessBoard.bombChessFired(a)},playBombReviveAnimation:function(s){var a=this._createChessData(s.newChess);this._addChessToChessGrid(a)},playBombAddStepAnimation:function(s){var a=this._createChessData(s.chessData),e=s.tick;if(this._bUseTaskModal){var t={fun:this._chessBoard.bombChessAddStep,funCaller:this._chessBoard,arguments:[a,e]};AnimationManager.getAnimationTaskHandler().pushTask(t)}else this._chessBoard.bombChessAddStep(a,e)},playScaleMoveAnimation:function(s){console.log("scale move animation data =============================="),console.log(s);var a=this._createChessData(s.chess_data,s.chess_layer);a.gridPosition.row=s.src_pos.row,a.gridPosition.col=s.src_pos.col;var e=new GridPosition(s.dest_pos.row,s.dest_pos.col),t=new MoveData(a,e),i=s.isScaleIn;this._moveScaleChess(i,t)},playDropAnimation:function(s){console.log("drop animation data =============================="),console.log(s);var a=!0,e=s.data.dropList.length,t=0,i=s.data.rounds,o=this;this.lastDropRound=i;function n(){a&&(a=!1,MusicManager.playEffect(MusicEffectFiles.Audio_A_ground)),++t==e&&(console.log("dropRound : "+s.data.rounds+"  dropCount : "+e),o._bLastpang?AnimationManager.isAnimationQueueEmpty()&&o._playDropEncourageSound(i):o._playDropEncourageSound(i))}for(var r=!1,h=0;h<s.data.dropList.length;h++){var c=s.data.dropList[h];if(c.new_flag){var l=Util.clone(c.chess_data);l.pos.row=c.path[0].row,l.pos.col=c.path[0].col;var d=this._createChessData(l);if(this._addChess(d),null!=c.top_chess){console.log("error logic?");var _=Util.clone(c.top_chess);_.pos.row=c.path[0].row,_.pos.col=c.path[0].col;d=this._createChessData(_);this._addChess(d)}r||l.type==RemoveLogic.we4Proto.ChessType.CT_COLLECTBALLOON&&(r=!0)}for(var u=new DropData({chessLogicOrder:c.chess_data.layer}),g=0;g<c.path.length;g++)u.push(c.path[g].row,c.path[g].col);if(null!=c.top_chess){var f=u.clone();f.extendData.chessLogicOrder=c.top_chess.layer,this._dropChess(f,n)}this._dropChess(u,n)}r&&MusicManager.playEffect(MusicEffectFiles.Audio_G_ballooncreate)},getLastDropRound:function(){return this.lastDropRound},_createMoveData:function(s){var a=this._createChessData(s.chess_data,s.chess_layer);a.gridPosition.row=s.src_pos.row,a.gridPosition.col=s.src_pos.col;var e=new GridPosition(s.dest_pos.row,s.dest_pos.col);return new MoveData(a,e)},_playDropEncourageSound:function(s){3==s?(MusicManager.playEffect(MusicEffectFiles.Audio_V_newcombo3),DropEncourage.Show(GameDataConfig.EncourageTitleConfig.LI_HAI)):4==s?(MusicManager.playEffect(MusicEffectFiles.Audio_V_newcombo4),DropEncourage.Show(GameDataConfig.EncourageTitleConfig.SHUANG)):5==s?(MusicManager.playEffect(MusicEffectFiles.Audio_V_newcombo5),DropEncourage.Show(GameDataConfig.EncourageTitleConfig.CHAO_ZAN)):6==s?(MusicManager.playEffect(MusicEffectFiles.Audio_V_newcombo6),DropEncourage.Show(GameDataConfig.EncourageTitleConfig.WAI_SAI)):7==s?(MusicManager.playEffect(MusicEffectFiles.Audio_V_newcombo7),DropEncourage.Show(GameDataConfig.EncourageTitleConfig.GAN_DE_PIAO_LIANG)):8==s?(MusicManager.playEffect(MusicEffectFiles.Audio_V_newcombo8),DropEncourage.Show(GameDataConfig.EncourageTitleConfig.JING_CAI_JUE_LUN)):9==s?(MusicManager.playEffect(MusicEffectFiles.Audio_V_newcombo9),DropEncourage.Show(GameDataConfig.EncourageTitleConfig.CHU_SHEN_RU_HUA)):10==s?(MusicManager.playEffect(MusicEffectFiles.Audio_V_newcombo10),DropEncourage.Show(GameDataConfig.EncourageTitleConfig.BU_KE_SI_YI)):s>=11&&(MusicManager.playEffect(MusicEffectFiles.Audio_V_newcombo11),DropEncourage.Show(GameDataConfig.EncourageTitleConfig.WU_YU_LUN_BI))},_playCrushSound:function(s,a){console.log("playCrushEffect crushRound : "+a),1==a&&s==RemoveLogic.we4Proto.AttackType.Attack_Normal&&MusicManager.playEffect(MusicEffectFiles.Audio_G_elimination),2==a?MusicManager.playEffect(MusicEffectFiles.Audio_G_dropelimination1):3==a?MusicManager.playEffect(MusicEffectFiles.Audio_G_dropelimination2):4==a?MusicManager.playEffect(MusicEffectFiles.Audio_G_dropelimination3):a>=5&&MusicManager.playEffect(MusicEffectFiles.Audio_G_dropelimination4)},playLastPangRadialAnimation:function(s,a){for(var e=a.data.bomb_chess,t=0,i=e.length;t<i;t++){var o=this._createChessData(e[t]);this._turnChessToClicked(o)}var n=a.data.bomb_chess[0];this._triggerLastPangRadial(n.pos.row,n.pos.col,a.data.extendData.petPositionInGrid,a.data.extendData.effectLayer,s)},_playChessLastPangCrushAnimation:function(s){for(var a=s.data.bg_chess,e=0,t=a.length;e<t;e++)this._playChessOriginalCrushEffect(a[e]);var i=s.data.bomb_chess;for(e=0,t=i.length;e<t;e++){var o=this._createChessData(i[e]);this._crushChess(o,!0),this._chessCrushByRadial(o.gridPosition.row,o.gridPosition.col,s.data.extendData.crushScore,s.data.extendData.effectLayer)}var n=s.data.top_chess;for(e=0,t=n.length;e<t;e++)this._playChessOriginalCrushEffect(n[e])},_playChessOrdinaryCrushAnimation:function(s){for(var a=s.data.bg_chess,e=s.data.changed_chess.bottom,t=0,i=e.length;t<i;t++){var o=e[t];if(!this._containChessData(a,o[1])){var n=this._createChessData(o[0]),r=this._createChessData(o[1]);this._changeChess(n,r)}}var h=s.data.bomb_chess,c=s.data.changed_chess.middle;for(t=0,i=c.length;t<i;t++){o=c[t];if(!this._containChessData(h,o[1])){n=this._createChessData(o[0]),r=this._createChessData(o[1]);this._changeChess(n,r)}}var l=s.data.top_chess,d=s.data.changed_chess.top;for(t=0,i=d.length;t<i;t++){o=d[t];if(!this._containChessData(l,o[1])){n=this._createChessData(o[0]),r=this._createChessData(o[1]);this._changeChess(n,r)}}for(t=0,i=a.length;t<i;t++)this._playChessOriginalCrushEffect(a[t]);for(t=0,i=h.length;t<i;t++)this._playChessOriginalCrushEffect(h[t]);for(t=0,i=l.length;t<i;t++)this._playChessOriginalCrushEffect(l[t]);for(t=0,i=(a=s.data.add_bg_chess).length;t<i;t++){var _=this._createChessData(a[t]);this._resetChess(_,!0)}var u=s.data.soda_bubble;this._updateSodaWaterLineRise(u)},_playChessOriginalCrushEffect:function(s){var a=this._createChessData(s);this._crushChess(a)},_createChessData:function(s){var a=GameDataConfig.CHESS_GRID_WIDTH,e=GameDataConfig.CHESS_GRID_HEIGHT;return GameUtil.createChessData(s,a,e)},_containChessData:function(s,a){for(var e=s.length;e--;)if(s[e].pos.row===a.pos.row&&s[e].pos.col===a.pos.col&&GameDataConfig.MultistageChessConfig[a.type])return!0;return!1},_playSpecialChessCrushAnimation:function(s){switch(s.data.attack_type){case RemoveLogic.we4Proto.AttackType.Attack_HorizontalShockWave:case RemoveLogic.we4Proto.AttackType.Attack_VerticalShockWave:this._playDirectionShockWaveAnimation(s);break;case RemoveLogic.we4Proto.AttackType.Attack_CrossShockWave:this._playCrossShockWaveAnimation(s);break;case RemoveLogic.we4Proto.AttackType.Attack_Hurricane:case RemoveLogic.we4Proto.AttackType.Attack_BigHurricane:this._playHurricaneAnimation(s);break;case RemoveLogic.we4Proto.AttackType.Attack_ThickCrossShockWave:this._playThickCrossShockWaveAnimation(s);break;case RemoveLogic.we4Proto.AttackType.Attack_Gas:this._playGhostChess2OrdinaryChessAnimation(s);break;case RemoveLogic.we4Proto.AttackType.Attack_GasSpecial:this._playGhostChess2SpecialChessAnimation(s);break;case RemoveLogic.we4Proto.AttackType.Attack_Gas2Gas:this._playGhostChess2GhostChessAnimation(s);break;default:console.log("unKnown attack type : "+s.data.attack_type)}},_playThickCrossShockWaveAnimation:function(s){var a=s.data.special_pos.row,e=s.data.special_pos.col;this._playShockWaveAnimation(a,e,!0),this._playShockWaveAnimation(a-1,e,!0),this._playShockWaveAnimation(a+1,e,!0),this._playShockWaveAnimation(a,e,!1),this._playShockWaveAnimation(a,e-1,!1),this._playShockWaveAnimation(a,e+1,!1),this._playChessOrdinaryCrushAnimation(s)},_playHurricaneAnimation:function(s){this._playChessOrdinaryCrushAnimation(s)},_playGhostChess2GhostChessAnimation:function(s){this._playChessOrdinaryCrushAnimation(s)},_playDirectionShockWaveAnimation:function(s){var a=s.data.special_pos,e=s.data.attack_type==RemoveLogic.we4Proto.AttackType.Attack_HorizontalShockWave;this._playShockWaveAnimation(a.row,a.col,e),this._playChessOrdinaryCrushAnimation(s)},_playCrossShockWaveAnimation:function(s){var a=s.data.special_pos;this._playShockWaveAnimation(a.row,a.col,!0),this._playShockWaveAnimation(a.row,a.col,!1),this._playChessOrdinaryCrushAnimation(s)},_playGhostChess2OrdinaryChessAnimation:function(s){var a=s.data.special_pos;null!=a&&this._triggerGhostAbsorb(a.row,a.col),this._playAbsorbChessAnimation(s),this._playChessOrdinaryCrushAnimation(s)},_playGhostChess2DirectionChessAnimation:function(s){},_playGhostChess2BombChessAnimation:function(s){},_playGhostChess2SpecialChessAnimation:function(s){var a=s.data.special_pos;null!=a&&this._triggerGhostSing(a.row,a.col);for(var e=s.data.add_chess,t=0,i=e.length;t<i;t++){var o=this._createChessData(e[t]);this._resetChess(o)}s.data.add_chess=[],this._playChessOrdinaryCrushAnimation(s),GasSpecial.init(),AnimationManager.pause(),GasSpecial.play(function(){AnimationManager.resume()})},_playAbsorbChessAnimation:function(s){for(var a=s.data.special_pos,e=s.data.bomb_chess,t=0,i=e.length;t<i;t++){var o=e[t];if(o.type==RemoveLogic.we4Proto.ChessType.CT_NormalUnit){var n=new AbsorbData(o.pos.row,o.pos.col,o.layer,a.row,a.col);this._absorbChess(n)}else this._playChessOriginalCrushEffect(o)}},_attackChess:function(s){if(this._bUseTaskModal){var a={fun:this._chessBoard.attackChess,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(a)}else this._chessBoard.attackChess(s)},_devourChess:function(s,a,e){if(this._bUseTaskModal){var t={fun:this._chessBoard.devourChess,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(t)}else this._chessBoard.devourChess(s,a,e)},_absorbChess:function(s){if(this._bUseTaskModal){var a={fun:this._chessBoard.absorbChess,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(a)}else this._chessBoard.absorbChess(s)},_changeChess:function(s,a){if(this._bUseTaskModal){var e={fun:this._chessBoard.changeChess,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(e)}else this._chessBoard.changeChess(s,a)},_dropChess:function(s,a){if(this._bUseTaskModal){var e={fun:this._chessBoard.dropChess,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(e,!0)}else this._chessBoard.dropChess(s,a)},_addChess:function(s,a){if(this._bUseTaskModal){var e={fun:this._chessBoard.addChess,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(e)}else this._chessBoard.addChess(s,a)},_addChessToChessGrid:function(s,a){if(this._bUseTaskModal){var e={fun:this._chessBoard.addChessToChessGrid,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(e)}else this._chessBoard.addChessToChessGrid(s,a)},_moveChess:function(s,a){if(this._bUseTaskModal){var e={fun:this._chessBoard.moveChess,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(e,!0)}else this._chessBoard.moveChess(s,a)},_moveScaleChess:function(s,a,e){if(this._bUseTaskModal){var t={fun:this._chessBoard.moveScaleChess,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(t,!0)}else this._chessBoard.moveScaleChess(s,a,e)},_translateChess:function(s,a){if(this._bUseTaskModal){var e={fun:this._chessBoard.translateChess,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(e,!0)}else this._chessBoard.translateChess(s,a)},_divideChess:function(s,a){if(this._bUseTaskModal){var e={fun:this._chessBoard.divideChess,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(e,!0)}else this._chessBoard.divideChess(s,a)},_synthesisChessByChessData:function(s){if(this._bUseTaskModal){var a={fun:this._chessBoard.synthesisChess,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(a)}else this._chessBoard.synthesisChess(s)},_resetChess:function(s,a){if(this._bUseTaskModal){var e={fun:this._chessBoard.resetChess,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(e,!0)}else this._chessBoard.resetChess(s,a)},_updateSodaWaterLineRise:function(s){if(this._bUseTaskModal){var a={fun:this._delegate.updateSodaWaterLineRise,funCaller:this._delegate,arguments:[s]};AnimationManager.getAnimationTaskHandler().pushTask(a)}else this._delegate.updateSodaWaterLineRise(s)},_swapChess:function(s,a,e){if(this._bUseTaskModal){var t={fun:this._chessBoard.swapChess,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(t)}else this._chessBoard.swapChess(s,a,e)},_swapChessByProp:function(s,a){this._chessBoard.removeChessByGridPosition(s.getGridPosition(),s.getLogicOrder()),this._chessBoard.removeChessByGridPosition(a.getGridPosition(),a.getLogicOrder())},_crushChess:function(s,a){if(this._bUseTaskModal){var e={fun:this._chessBoard.crushChess,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(e)}else this._chessBoard.crushChess(s,a)},_triggerGhostAbsorb:function(s,a){if(this._bUseTaskModal){var e={fun:this._chessBoard.onTriggerGhostAbsorb,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(e)}else this._chessBoard.onTriggerGhostAbsorb(s,a)},_ghostChess2GhostChess:function(s,a){if(this._bUseTaskModal){var e={fun:this._chessBoard.onGhostChess2GhostChess,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(e)}else this._chessBoard.onGhostChess2GhostChess(s,a)},_turnChessToClicked:function(s){if(this._bUseTaskModal){var a={fun:this._chessBoard.turnChessToClicked,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(a)}else this._chessBoard.turnChessToClicked(s)},_triggerLastPangRadial:function(s,a,e,t,i){if(this._bUseTaskModal){var o={fun:this._chessBoard.onTriggerLastPangRadial,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(o)}else this._chessBoard.onTriggerLastPangRadial(s,a,e,t,i)},_chessCrushByRadial:function(s,a,e,t){if(this._bUseTaskModal){var i={fun:this._chessBoard.onChessCrushByRadial,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(i)}else this._chessBoard.onChessCrushByRadial(s,a,e,t)},_playShockWaveAnimation:function(s,a,e){if(this._bUseTaskModal){var t={fun:this._chessBoard.onTriggerDirectionCrush,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(t)}else this._chessBoard.onTriggerDirectionCrush(s,a,e)},_triggerGhostSing:function(s,a){if(this._bUseTaskModal){var e={fun:this._chessBoard.onTriggerGhostSing,funCaller:this._chessBoard,arguments:arguments};AnimationManager.getAnimationTaskHandler().pushTask(e)}else this._chessBoard.onTriggerGhostSing(s,a)},onRearrangeChess:function(s,a,e){return this._chessBoard.rearrangeChess(s,a,e)},onResetChess:function(s){this._resetChess(s)},onTriggerSwapProp:function(s,a){if(null!=s&&null!=a)if(this._bUseTaskModal){var e={fun:this._swapChessByProp,funCaller:this,arguments:[s,a]};AnimationManager.getAnimationTaskHandler().pushTask(e,!0)}else this._swapChessByProp(s,a)}};
var ChessCacheManager={_preCreateOperateList:null,_updateProxy:null,_createCountSecondFrame:1,_chessCacheMap:{},_bPreCreateFinish:!1,_bGridInit:!1,_bInit:!1,_createMap:{},init:function(){if(!this._bInit){this._bInit=!0;var e=RemoveLogic.we4Proto.ChessType;for(var a in e)this._chessCacheMap[e[a]]=[]}},setGridInit:function(e){this._bGridInit=e},onExitSingleGame:function(){for(var e in this._chessCacheMap)for(var a=this._chessCacheMap[e],s=0,t=a.length;s<t;s++){var r=a[s];null!=r&&(r.turnToIdle(),r.setOpacity(0),r.setParent(null))}this._updateProxy&&this._updateProxy.release(),this._updateProxy=null,this._log()},getChessCount:function(e){return null!=this._chessCacheMap[e]?this._chessCacheMap[e].length:-1},preCreateChess:function(){this._preCreateOperateList=[],this._initPreCreateList(),this._startUpdateProxy()},getChess:function(e){var a={bCreate:!1,chess:null},s=this._chessCacheMap[e.chessType],t=null;return null!=s?null==(t=s.pop())&&(t=this._createChess(e),a.bCreate=!0):(t=this._createChess(e),a.bCreate=!0),a.chess=t,a},createAndCacheChess:function(e){var a=this._createChess(e);this.cacheChess(a)},cacheChess:function(e){if(null!=e){e.setOpacity&&e.setOpacity(0);var a=e.getChessType();null==this._chessCacheMap[a]&&(this._chessCacheMap[a]=[]);for(var s=!1,t=this._chessCacheMap[a],r=t.length-1;r>=0;r--)e==t[r]&&(s=!0);s||(GameUtil.pauseAllAnimation(e),this._chessCacheMap[a].push(e))}},_log:function(){var e=0,a=0,s=0;for(var t in this._createMap){var r=this._createMap[t];e+=r.preCreate,a+=r.initCreate,s+=r.dynamicCreate}console.log("====================棋子  第"+GameProxy.getStageId()+"关===================="),console.log("预创建("+e+"),初始化创建("+a+"),动态创建("+s+"),缓存数量("+this._getCacheChessCount()+")"),console.log("================棋子创建详情================"),e>0||a>0||s>0?console.log(this._createMap):console.log("没有预创建,初始化创建,动态创建棋子"),this._createMap={}},_getCacheChessCount:function(){var e=0;for(var a in this._chessCacheMap)e+=this._chessCacheMap[a].length;return e},_createChess:function(e){var a=RemoveLogic.we4Proto.ChessType,s=null;switch(e.chessType){case a.CT_NormalUnit:s=new OrdinaryChess(e);break;case a.STIT_ICE:case a.STIT_ICE_BEAR_UNDER:case a.STIT_DEEPICE:case a.STIT_BOX:case a.STIT_BOX_TWO:case a.STIT_BOX_THREE:case a.STIT_BOX_FOUR:case a.STIT_CAGE:case a.STIT_CAGE2:case a.STIT_DONUTSBOMB:case a.CT_CLODS0:case a.CT_CLODS1:case a.STIT_BLUEBERRY:case a.STIT_CANDYPAPER1:case a.STIT_CANDYPAPER2:case a.STIT_CANDYPAPER3:case a.STIT_CANDYPAPER4:case a.STIT_CANDYPAPER5:case a.CT_COLLECTCANDY:case a.STIT_COLLECT_POINT_IN_SODA:s=new StaticChess(e);break;case a.CT_SodaBottle:s=new SodaBottleChess(e);break;case a.CT_COLLECTBALLOON:case a.STIT_COLLECTBALLOON_POINT:case a.STIT_COLLECTCANDY_POINT:case a.STIT_CHONGDONG1:case a.STIT_CHONGDONG2:case a.STIT_MAOQIU1:case a.STIT_LITTLEMUSHROOM:s=new DynamicChess(e);break;case a.STIT_MAOQIU2:s=new CloudChess(e);break;case a.STIT_CANDYPOT:s=new BeAttackChess(e);break;case a.STIT_HUGEMUSHROOM:s=new MushroomChess(e);break;case a.CT_SpecialVerticalShockWave:case a.CT_SpecialHorizontalShockWave:s=new DirectionChess(e);break;case a.CT_SpecialHurricane:s=new BombChess(e);break;case a.CT_SpecialGas:s=new GhostChess(e);break;case a.CT_Chameleon:s=new ChameleonChess(e);break;case a.CT_TICKBOMB:s=new TickBombChess(e);break;case a.CT_STEPBONUS:s=new StaticTagChess(e);break;case a.STIT_CONVEYER:s=new ConveyerChess(e);break;case a.STIT_CONVEYERLIGHT:s=new ConveyerLight(e);break;default:console.log("unKnown chessType : "+e.chessType)}return this._recordCreate(s,e),s},_recordCreate:function(e,a){if(null!=e){null==this._createMap[a.chessType]&&(this._createMap[a.chessType]={preCreate:0,dynamicCreate:0,initCreate:0});var s=this._createMap[a.chessType];this._bGridInit?s.initCreate++:this._bPreCreateFinish?s.dynamicCreate++:s.preCreate++}},_initPreCreateList:function(){this._preCreateOperateList=this._preCreateOperateList.concat(OriginalChessPreCreate.getPreCreateList()),this._preCreateOperateList=this._preCreateOperateList.concat(SpecialChessPreCreate.getPreCreateList()),this._createCountSecondFrame=0!=this._preCreateOperateList.length?Math.ceil(this._preCreateOperateList.length/GameDataConfig.GAME_START_ANIMATION_TOTAL_FRAME):2},_startUpdateProxy:function(){this._bPreCreateFinish=!1,0!=this._preCreateOperateList.length?(null==this._updateProxy&&(this._updateProxy=new UpdateProxy(this._onUpdate.bind(this))),this._updateProxy.start()):this._bPreCreateFinish=!0},_onUpdate:function(e){for(var a=0;a<this._createCountSecondFrame;a++){var s=this._preCreateOperateList.shift();null!=s&&s.fun.apply(s.funCaller,s.arguments)}0==this._preCreateOperateList.length&&(this._updateProxy.pause(),this._bPreCreateFinish=!0)}},OriginalChessPreCreate={_bGet:!1,getPreCreateList:function(){if(this._bGet)return[];var e=RemoveLogic.we4Proto.ChessType,a={pos:{row:0,col:0},color:RemoveLogic.we4Proto.ChessColor.kChessColorYellow,type:null},s=GameUtil.createChessData(a,GameDataConfig.CHESS_GRID_WIDTH,GameDataConfig.CHESS_GRID_HEIGHT),t=[];function r(e,a){var r=ChessCacheManager.getChessCount(a);if(-1!=r&&r<e){var C=e-r;s.chessType=a;for(var i=0;i<C;i++)pushPreCreateOperate(t,ChessCacheManager.createAndCacheChess,ChessCacheManager,[s.clone()])}}return r(2,e.CT_SpecialGas),r(4,e.CT_SpecialHurricane),r(4,e.CT_SpecialVerticalShockWave),r(4,e.CT_SpecialHorizontalShockWave),r(64,e.CT_NormalUnit),this._bGet=0==t.length,t}},SpecialChessPreCreate={getPreCreateList:function(){var e=ChessCacheManager.createAndCacheChess.bind(ChessCacheManager),a=[],s={pos:{row:0,col:0},color:RemoveLogic.we4Proto.ChessColor.kChessColorNone,type:RemoveLogic.we4Proto.ChessType.CT_None},t=GameUtil.createChessData(s,GameDataConfig.CHESS_GRID_WIDTH,GameDataConfig.CHESS_GRID_HEIGHT);function r(s,r){var C=ChessCacheManager.getChessCount(s);if(C<r){var i=r-C;t.chessType=s;for(var h=0;h<i;h++)pushPreCreateOperate(a,e,null,[t.clone()])}}RemoveLogic.we4Proto.ChessType;var C=new StageId(GameProxy.getStageId(),0),i=puzzleGame.getContainChessType(C);for(var h in i){var c=GameDataConfig.MultistageChessCrushConfig[h];if(null!=c)for(var n=0,o=c.length;n<o;n++){var _=i[h];_>GameDataConfig.CHESS_PRE_CREATE_MAX_LIMIT&&(_=GameDataConfig.CHESS_PRE_CREATE_MAX_LIMIT),r(c[n],_)}}return a}};
var puzzleGame=null,GameProxy={_stageId:1,_startItemIdList:[],_randomItemId:0,_settlementSuccessResult:null,_settlementFailResult:null,createPuzzleGame:function(){console.log("createPuzzleGame"),puzzleGame=new PuzzleGameDelegate},init:function(){return null==puzzleGame&&(puzzleGame=new PuzzleGameDelegate),puzzleGame.init(),puzzleGame},destroy:function(){},getStageId:function(){return this._stageId},setStageId:function(e){this._stageId=e},getSimpleStageData:function(e,t){e=e||this._stageId;puzzleGame.loadStage(new StageId(e,GameUtil.getStageSubId(e)),function(){puzzleGame.simple_stage_info(function(e){e=new SimpleStageData(e);"function"==typeof t&&t(e)}.bind(this))}.bind(this))},getStartItemIdList:function(){return this._startItemIdList},startGame:function(e,t,a){puzzleGame.eventManager.bind("GAMESTART",function(){"function"==typeof t&&t()}),e=e||{stockItemDataList:[],costItemDataList:[],itemIdList:[],randomItemId:0},this._startItemIdList=e.itemIdList,this._randomItemId=e.randomItemId,this._randomItemId&&(this._startItemIdList=[].concat(this._startItemIdList),this._startItemIdList.pop());var n=new StageStartRequest(this._stageId,parseInt((new Date).getTime()/1e3),e.stockItemDataList,e.costItemDataList),s=this,i=GameService.createCallBackMap(function(t,a){var n=t;s._stageId=n.stage_id;for(var i=new StageId(s._stageId,0),r=[],l=0,o=e.stockItemDataList.length;l<o;l++)r.push(e.stockItemDataList[l]);for(l=0,o=e.costItemDataList.length;l<o;l++)r.push(e.costItemDataList[l].item_id);var c=new StageStartInfo(n.random_seed,r,i);puzzleGame.run(c)},function(e,t){TipWindow.Show(e.ret_desc),TopGoldBar.Show(),"function"==typeof a&&a()});GameService.stageStart(n,i)},startGameByRecord:function(e){var t=HistoryRecord.getRecordByStage(e);return null==t?(HistoryRecord.isUsingHistory=!1,!1):(HistoryRecord.curUsingRecord=t,HistoryRecord.curInputIndex=0,(puzzleGame=new PuzzleGameDelegate).eventManager.bind("GAMESTART",function(){puzzleGame.simple_stage_info(function(e){FrameController.GetInstance().start("MainGamePage",new PageOptions(PageType.replace,resGroup.MainGamePageRes,new MainPageData(e)))}.bind(this))}),puzzleGame.run(t.start_info),!0)},_startPKMatch:function(e,t,a,n){console.warn("开始pk赛"),puzzleGame.eventManager.bind("GAMESTART",function(){"function"==typeof a&&a()}),bChallengeMode=!0;var s=new PkMatchStartRequest(e,t),i=GameService.createCallBackMap(function(e,a){var n=new StageId(t,0),s=new StageStartInfo(e.random_seed,[],n);puzzleGame.run(s)},function(e,t){TipWindow.Show(e.ret_desc),TopGoldBar.Show(),"function"==typeof n&&n()});GameService.arenaMatchStart(s,i)},getSettlementSuccessResult:function(){return this._settlementSuccessResult},getSettlementFailResult:function(){return this._settlementFailResult},stageReport:function(e,t){this._settlementSuccessResult=null,this._settlementFailResult=null;var a=puzzleGame.getRecord();(a=a||{}).fail_reason=e,GameService.stageReport(a,function(e,a){null!=a?(this._settlementSuccessResult=a,eventDispatcher.dispatchEvent(EventID.SETTLEMENT_SUCCESS)):(this._settlementFailResult=e,eventDispatcher.dispatchEvent(EventID.SETTLEMENT_FAIL,{error:e})),t&&t(e,a)}.bind(this))},stageReportOnExit:function(){if(puzzleGame){var e=puzzleGame.getRecord();e.game_result=3,GameService.stageReport(e,null,!0)}},pkMatchReport:function(e,t){this._settlementSuccessResult=null,this._settlementFailResult=null;var a=puzzleGame.getRecord();(a=a||{}).fail_reason=e,a.arena_match_id=NetData.arena_match.arena_match_id,GameService.arenaMatchReport(a,function(e,a){null!=a?(this._settlementSuccessResult=a,eventDispatcher.dispatchEvent(EventID.SETTLEMENT_SUCCESS)):(this._settlementFailResult=e,eventDispatcher.dispatchEvent(EventID.SETTLEMENT_FAIL,{error:e})),t&&t(e,a)}.bind(this))},pkMatchReportOnExit:function(){if(puzzleGame){console.log("pkMatchReportOnExit");var e=puzzleGame.getRecord();e.game_result=3,e.arena_match_id=NetData.arena_match.arena_match_id,GameService.arenaMatchReport(e,null,!0)}}};
var AutoPlayLogic={_listenerList:null,_maskWindow:null,start:function(){if(bAutoPlay){if(!GuideAuxiliaryData.isNeedGuide(GameProxy.getStageId())){var t=new WindowBase;WindowManager.GetInstance().showWindow(t,null,!1,2*GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,null),this._maskWindow=t;var e=FrameController.GetInstance()._curPage;this._listenerList=[];var i=this,n=!1;Util.registerListener(this._listenerList,EventID.ALL_ANIMATION_PLAY_COMPLETE,function(){n||s()}),Util.registerListener(this._listenerList,EventID.ON_ADD_STEP_WINDOW_SHOW,function(){Util.unRegisterListeners(this._listenerList),WindowManager.GetInstance().destroyWindow(t),AddStepWindow.GetInstance()._onCloseButtonTouched(null,ccui.Widget.TOUCH_ENDED)}),Util.registerListener(this._listenerList,EventID.ON_READY_GO_EFFECT_COMPLETE,function(){s()}),Util.registerListener(this._listenerList,EventID.ON_REARRANGE_CHESS_TIP_EFFECT_START_PLAY,function(){n=!0}),Util.registerListener(this._listenerList,EventID.ON_REARRANGE_CHESS_COMPLETE,function(){n=!1,s()}),Util.registerListener(this._listenerList,EventID.ON_NETWORK_TIP_WINDOW_SHOW,function(){i.destroy()})}}function s(){puzzleGame.findActive([],[],function(t,i){2==t.length&&e._chessBoard.onTrySwap(t[0],t[1])})}},destroy:function(){Util.unRegisterListeners(this._listenerList),WindowManager.GetInstance().destroyWindow(this._maskWindow)}};
var GasSpecial={_updateProxy:null,_timer:null,_animationDataListAggregate:null,_bLock:!1,_finishCallBack:null,init:function(){if(!this._bLock){this.destroy(),this._updateProxy=new UpdateProxy(this._update.bind(this)),this._updateProxy.pause();var i=new Timer;i.setDuration(.3),i.setTimeUp(this._onReachCrushTime.bind(this)),i.pause(),this._timer=i,this._animationDataListAggregate=[],this._initAnimationDataListAggregate(this._animationDataListAggregate)}},destroy:function(){this._updateProxy&&this._updateProxy.release(),this._updateProxy=null,this._timer=null,this._animationDataListAggregate=null,this._bLock=!1},play:function(i){this._finishCallBack=i,this._bLock||(this._bLock=!0,this._timer.start(),this._updateProxy.start(),this._startAnimation())},_initAnimationDataListAggregate:function(i){var t=puzzleGame.getAnimation();if(null!=t){this._isHaveEndGasChess2SpecialChessAnimationData(t)||(i.push(t),this._initAnimationDataListAggregate(i))}},_isHaveEndGasChess2SpecialChessAnimationData:function(i){for(var t=!1,a=0,n=i.length;a<n;a++)if(RemoveLogic.we4Proto.AnimationId.gas_special_end==i[a].animation_id){t=!0;break}return t},_startAnimation:function(){var i=this._animationDataListAggregate.shift();null!=i?puzzleGame.eventManager.trigger("START_ANIMATION",i):("function"==typeof this._finishCallBack&&this._finishCallBack(),this._finishCallBack=null,this.destroy(),AnimationManager.onGasChess2SpecialChessEffectFinish())},_update:function(i){this._timer.update(i)},_onReachCrushTime:function(){this._startAnimation()}};
var MoveDataHandler={getMoveScaleInChessData:function(o,t){var e=this._calcMoveScaleChessDirection(o),a=t(o.to.row,o.to.col);return a.x+=o.chessData.size.width*e.x,a.y+=o.chessData.size.width*e.y,a},getMoveScaleOutChessData:function(o,t){var e=this._calcMoveScaleChessDirection(o),a=t(o.to.row,o.to.col);a.x+=o.chessData.size.width*e.x,a.y+=o.chessData.size.width*e.y;return{originalPosition:a,targetPosition:t(o.to.row,o.to.col)}},_calcMoveScaleChessDirection:function(o){var t=o.to.row-o.chessData.gridPosition.row,e=o.to.col-o.chessData.gridPosition.col,a=0,s=0;return 0==t&&e>0?a=-.5:0==t&&e<0?a=.5:t>0&&0==e?s=.5:t<0&&0==e?s=-.5:console.log("row and col same"),{x:a,y:s}}};
var GameState={success:1,fail:2,running:3},MainGamePageViewZOrder={};MainGamePageViewZOrder.GAME_BG=1,MainGamePageViewZOrder.PANEL=4,MainGamePageViewZOrder.CHESS_BOARD_BACKGROUND=5,MainGamePageViewZOrder.SODA_WATER=7,MainGamePageViewZOrder.PROP_MODAL_LAYER=10,MainGamePageViewZOrder.CHESS_BOARD=12,MainGamePageViewZOrder.SODA_BUBBLE=15,MainGamePageViewZOrder.UI_LAYER=20,MainGamePageViewZOrder.EFFECT_LAYER=30,MainGamePageViewZOrder.TOUCH_LAYER=40,page.MainGamePage=page.BasePage.extend({_processView:null,_pageOptions:null,_scoreBgPanel:null,_surplusStepText:null,_actionScoreText:null,_actionProcessBar:null,_chessBoard:null,_chessBoardBg:null,_collectMaterialList:null,_originalPassConditionList:null,_effectLayer:null,_propModalLayer:null,_petPositionInGrid:null,_addStepUseCount:null,_addStepLimit:null,_swapChessTip:null,_bPlayingAnimation:!1,_bPlayingPropAnimation:!1,_bWaitHandlePropAnimationPlayCompleteLogic:!1,_scoreStarViewList:[],_bNeedCheckTenStepTip:!0,_bNeedCheckFiveStepTip:!0,_bNeedCheckGuideAddThreeStep:!0,_gameState:null,_listenerList:null,_petView:null,_sodaWater:null,_sodaBubble:null,_chessBoardWorldDataList:null,_startRow:null,_bInitFinished:!1,onCreate:function(e){AutoPlayLogic.start(),LogPanel.addInfo("MainGamePage:onCreate("+GameProxy.getStageId()+")"),window.enterGamePageCount++,this._pageOptions=e,this._collectMaterialList=[],this._listenerList=[],this._addStepUseCount=0,chessBoardRow=e.pageData.chessBoardRow,chessBoardCol=e.pageData.chessBoardCol,viewportRow=e.pageData.chessBoardViewportRow,viewportCol=e.pageData.chessBoardViewportCol,this._startRow=0,this._gameState=GameState.running;var t=ConfigLoader.getPropGoodsConfig(GameDataConfig.ADD_FIVE_STEP_PROP_ITEM_ID);this._addStepLimit=t.price_pkg_cnt,puzzleGame.getWorldNodeDataList(function(t){if(PreHandleGameResLogic.stop(!0),AnimationCacheManager.init(),AnimationCacheManager.preCreateAnimation(),this._startRow=puzzleGame.GetStartRow(),this._chessBoardWorldDataList=t,this._initChessBoard(),this._initView(e),this._initAnimationManager(),this._registerListener(),this._checkGameType(),AnimationManager._onAnimationQueueUpdate(),this._onPassConditionEffectComplete(),Timeout.register(function(){}.bind(this),5e3),HistoryRecord.isUsingHistory){var i=new cc.LabelTTF(""+HistoryRecord.curUsingRecord.input.length,"Arial",40);this.historyInputLabel=i,i.setColor(cc.color.BLACK),i.setAnchorPoint(cc.p(.5,1)),i.setPosition(cc.p(cc.winSize.width/2,cc.winSize.height-10)),this.addChild(i,10)}ShowOffDataCollect.init(),this._bInitFinished=!0,resGroup.MainGamePageRes.bgImage_jpg=null}.bind(this))},_checkGameType:function(){puzzleGame.IsSodaGame()&&this._initSodaWater(),puzzleGame.IsDiggerType()&&(ChessBoardScrollController.init(this._chessBoard.getChessBoardData()),ChessBoardScrollController.setChessBoard(this._chessBoard),ChessBoardScrollController.setChessBoardBg(this._chessBoardBg),ChessBoardScrollController.setSodaWater(this._sodaWater),ChessBoardScrollController.setSodaBubble(this._sodaBubble),ChessBoardScrollController.setDelegate(this),ChessBoardScrollController.jumpToInitialPosition())},_onPassConditionEffectComplete:function(){puzzleGame.IsDiggerType()?ChessBoardScrollController.scroll(this._startRow,this._showReadyGoWindow.bind(this)):this._showReadyGoWindow()},_showReadyGoWindow:function(){ReadyGoWindow.Show(function(){console.log("还有"+AnimationCacheManager._preCreateOperateList.length+"个特效未创建"),console.log("还有"+ChessCacheManager._preCreateOperateList.length+"个棋子未创建");var e=GuideAuxiliaryData.isNeedGuide(GameProxy.getStageId()),t=GuideResHandler.isGuideResLoaded(GameProxy.getStageId());e&&t?(GuideAuxiliaryData.setMiddlePanel(this._middlePanel),GuideAuxiliaryData.setChessBoard(this._chessBoard),GuideAuxiliaryData.setPropModalLayer(this._propModalLayer),GuideManager.GetInstance().guide()):this._swapChessTip.start()}.bind(this))},_initAnimationManager:function(){var e={};for(var t in this._collectMaterialList){var i=this._collectMaterialList[t];if(null!=i)for(var a=0;a<i.length;a++){var o=i[a],n=o.passConditionData.collectType;e[n]=e[n]||{},e[n].position=o.collectMaterialPosition}}ChessBoardHelper.init(this),AnimationManager.init(e,this._effectLayer),AnimationManager.start()},_registerListener:function(){puzzleGame.eventManager.bind("START_ANIMATION",this._onStartAnimation.bind(this)),puzzleGame.eventManager.bind("ON_ONE_BATCH_ANIMATION_PLAY_COMPLETE",this._onOneBatchAnimationPlayComplete.bind(this)),puzzleGame.eventManager.bind("START_PLAY_PROP_ANIMATION",this._onStartPlayPropAnimation.bind(this)),puzzleGame.eventManager.bind("PROP_ANIMATION_PLAY_COMPLETE",this._onPropAnimationPlayComplete.bind(this)),puzzleGame.eventManager.bind("PLAY_INPUT",this._onPlayInput.bind(this)),Util.registerListener(this._listenerList,EventID.ON_CHESS_CRUSH,this._onChessCrush.bind(this)),Util.registerListener(this._listenerList,EventID.ON_USE_PROP,this._onUseProp.bind(this)),Util.registerListener(this._listenerList,EventID.ON_WINDOW_RESIZE,this._onWindowResize.bind(this)),Util.registerListener(this._listenerList,EventID.ON_GUIDE_COMPLETE,this._onGuideComplete.bind(this)),Util.registerListener(this._listenerList,EventID.ON_NETWORK_TIP_WINDOW_CANCEL,this._onNetworkTipWindowCancel.bind(this)),Util.registerListener(this._listenerList,EventID.AUTO_REARRANGE_CHESS,this._onAutoRearrangeChess.bind(this)),Util.registerListener(this._listenerList,EventID.ON_WX_SHOW,this._onWxShow.bind(this))},_onWxShow:function(){var e=window.getWXLaunchOptionsSync();"groupRank"==e.query.from&&e.shareTicket?wx.showModal({title:"提示",content:"您还在游戏中, 是否退出本局查看群排行?",confirmText:"退出查看",cancelText:"稍后再看",success:function(e){e.confirm?PageUtil.switchPageTo("StageMapPage",PageType.replace,ResObjects.getResObject(ResObjectConfig.allStage),null,null):e.cancel&&console.log("用户点击取消")}}):"PKRank"!=e.query.from||"1044"!=e.scene&&"1088"!=e.scene||wx.showModal({title:"提示",content:"您还在游戏中, 是否退出本局查看群排行?",confirmText:"退出查看",cancelText:"稍后再看",success:function(t){t.confirm?(e.query.from="",GameUtil.saveArenaMatchData(e),PageUtil.switchPageWithLoading("PKRank",PageType.replace,ResObjects.getResObject(ResObjectConfig.PKRank))):t.cancel&&console.log("用户点击取消")}})},_onNetworkTipWindowCancel:function(){this._gameState==GameState.running?WindowManager.GetInstance().hideAllWindow():(PageUtil.switchPageTo("StageMapPage",PageType.replace,ResObjects.getResObject(ResObjectConfig.allStage)),ResLoader.hideLoadingWindow())},_onGuideComplete:function(){this._swapChessTip.start()},_onWindowResize:function(){UIHelper.adjustUILayout(this)},_onChessCrush:function(e){var t=e.userData.chess;switch(t.getChessType()){case RemoveLogic.we4Proto.ChessType.CT_STEPBONUS:this._stepBonusChessCrush(t)}},_onUseProp:function(e){if(null!=e.userData&&null!=e.userData.touchedChess){var t=e.userData.touchedChess;switch(t.getChessType()){case RemoveLogic.we4Proto.ChessType.CT_STEPBONUS:this._stepBonusChessCrush(t)}}},updateSodaWaterLineRise:function(e){if(cc.isNumber(e))for(var t=0;t<e;t++)this._sodaWater&&this._sodaWater.onWaterLineRise();else console.log("crushSodaBubbleChessCount is not number type")},_stepBonusChessCrush:function(e){var t={};t.position=e.getPosition(),t.fromPosition=cc.p(t.position.x,t.position.y);var i=this._surplusStepText.convertToWorldSpaceAR(cc.p(0,0));t.toPosition=this._getPositionRelativeToGrid(i),t.step=e.getChessData().extendData.step_bonus_data.step_bonus,t.chess=e,t.viewRoot=this._effectLayer,AnimationManager.playStepChessAddStepEffect(t)},_onPlayInput:function(e){if(e)switch(e.op){case RemoveLogic.we4Proto.InputOp.kOpSlide:this._chessBoard._trySwap(Util.clone(e.from),Util.clone(e.to));break;case RemoveLogic.we4Proto.InputOp.kOpUseItem:var t=e.item_id,i=this._propModalLayer._propItemMap[t];switch(null!=i&&i.setUseEnable(!0),t){case RemoveLogic.we4Proto.ItemId.itemHammer:i._onPropItemTouched(null,ccui.Widget.TOUCH_ENDED);var a=this._chessBoard.getGrid()._getChessGridInViewport(e.from.row,e.from.col);this._propModalLayer._checkTriggerProp(a);break;case RemoveLogic.we4Proto.ItemId.itemGlass:i._onPropItemTouched(null,ccui.Widget.TOUCH_ENDED);a=this._chessBoard.getGrid()._getChessGridInViewport(e.from.row,e.from.col);this._propModalLayer._checkTriggerProp(a),Timeout.register(function(){var t=this._chessBoard.getGrid()._getChessGridInViewport(e.to.row,e.to.col);this._propModalLayer._checkTriggerProp(t)}.bind(this),600);break;case RemoveLogic.we4Proto.ItemId.itemRearrange:i._onPropItemTouched(null,ccui.Widget.TOUCH_ENDED);break;case RemoveLogic.we4Proto.ItemId.itemSwap:i._onPropItemTouched(null,ccui.Widget.TOUCH_ENDED);a=this._chessBoard.getGrid()._getChessGridInViewport(e.from.row,e.from.col);this._propModalLayer._checkTriggerProp(a),Timeout.register(function(){var t=this._chessBoard.getGrid()._getChessGridInViewport(e.to.row,e.to.col);this._propModalLayer._checkTriggerProp(t)}.bind(this),400);break;case RemoveLogic.we4Proto.ItemId.itemStepInner:i._onPropItemTouched(null,ccui.Widget.TOUCH_ENDED);break;case RemoveLogic.we4Proto.ItemId.itemRespawn:puzzleGame.respawn(new RemoveLogic.we4Proto.RespawnInfo)}break;case RemoveLogic.we4Proto.InputOp.kOpRespawn:puzzleGame.respawn(new RemoveLogic.we4Proto.RespawnInfo)}},_onAutoRearrangeChess:function(){this._onStartPlayPropAnimation()},_onStartPlayPropAnimation:function(){this._bPlayingPropAnimation=!0,this._swapChessTip.onStartPlayPropAnimation(),this._propModalLayer.onStartPlayPropAnimation(),this._chessBoard.onStartPlayPropAnimation()},_onPropAnimationPlayComplete:function(){AnimationManager.isAnimationQueueEmpty()?this._handlePropAnimationPlayCompleteLogic():this._bWaitHandlePropAnimationPlayCompleteLogic=!0},_handlePropAnimationPlayCompleteLogic:function(){this._bPlayingPropAnimation=!1,this._swapChessTip.onPropAnimationPlayComplete(),this._propModalLayer.onPropAnimationPlayComplete(),this._chessBoard.onPropAnimationPlayComplete()},_onOneBatchAnimationPlayComplete:function(){AnimationManager.isNeedCallContinueOnAnimationComplete()&&(console.log("AnimationManager.isNeedCallContinueOnAnimationComplete"),puzzleGame.continue_(),puzzleGame.getGameStatus(function(e){LogPanel.addInfo("continue(complete)("+e+")")})),puzzleGame.getGameStatus(function(e){switch(LogPanel.addInfo("gameStatus("+e+")"),e){case RemoveLogic.weTypeModule.PuzzleGameState.PGS_SUCCESS_END:this._swapChessTip.onTurnToSuccessState(),MaskWindow.Show(),Timeout.register(function(){this._adventureSuccess(),MaskWindow.Hide()}.bind(this),500);break;case RemoveLogic.weTypeModule.PuzzleGameState.PGS_FAIL_END:this._swapChessTip.onTurnToFailState();var t=this._addStepUseCount<this._addStepLimit,i=parseInt(this._surplusStepText.getString());t&&AnimationManager.__needAddStep--?this._showAddStepWindow():i>0?this._adventureFail():t?this._showAddStepWindow():this._adventureFail()}AnimationManager.isAnimationQueueEmpty()&&this._gameState==GameState.running?(this._bWaitHandlePropAnimationPlayCompleteLogic&&(this._bWaitHandlePropAnimationPlayCompleteLogic=!1,this._handlePropAnimationPlayCompleteLogic()),this._bPlayingAnimation=!1,this._swapChessTip.onAllAnimationsPlayComplete(),this._chessBoard.onAllAnimationsPlayComplete(),this._propModalLayer.onAllAnimationsPlayComplete(),eventDispatcher.dispatchEvent(EventID.ALL_ANIMATION_PLAY_COMPLETE)):this._gameState==GameState.success||(this._gameState,GameState.fail)}.bind(this))},_showAddStepWindow:function(){AddStepWindow.Show(this._addStepUseCount,function(){this._addStepUseCount++,puzzleGame.respawn(new RemoveLogic.we4Proto.RespawnInfo),this._swapChessTip.onRespawn()}.bind(this),function(){this._adventureFail()}.bind(this))},_adventureSuccess:function(){if(AnimationManager.pause(),MusicManager.stopAllSound(),this._swapChessTip.onAdventureSuccess(),bChallengeMode)return PageUtil.switchPageWithLoading("RinkMatchResultPage",PageType.replace,ResObjects.getResObject(ResObjectConfig.ringMatchResult),{score:this._actionScoreText.getTargetNumber()}),GameProxy.pkMatchReport(0),void puzzleGame.logFullRecordString();var e=this._getStarCount();window.subBeyondFriend.oldStaticsNtf.stage_statics.max_stage_id=NetData.statics_ntf.stage_statics.max_stage_id,window.subBeyondFriend.oldStaticsNtf.stage_statics.star_count=NetData.statics_ntf.stage_statics.star_count,window.subBeyondFriend.newStaticsNtf.stage_statics.max_stage_id=this._pageOptions.pageData.level,window.subBeyondFriend.newStaticsNtf.stage_statics.star_count=NetData.statics_ntf.stage_statics.star_count+e,console.warn("====",window.subBeyondFriend),StageJumpData.recordOldData(),ShowOffDataCollect.stat({starCount:e}),GameProxy.stageReport(0),puzzleGame.logFullRecordString(),GameSettlementSuccessPageData.level=this._pageOptions.pageData.level,GameSettlementSuccessPageData.score=this._actionScoreText.getTargetNumber(),GameSettlementSuccessPageData.starCount=e,ResObjects.getResObject(ResObjectConfig.gameSuccess).setStar(e);var t=ShowOffDataCollect.getData();t?ShowOff.show(t,this._goSuccessPage.bind(this)):this._goSuccessPage()},_goSuccessPage:function(){PageUtil.switchPageWithLoading("GameSettlementSuccessPage",PageType.replace,ResObjects.getResObject(ResObjectConfig.gameSuccess),GameSettlementSuccessPageData)},_adventureFail:function(){AnimationManager.pause(),ShowOffDataCollect.addFail(),this._initGameSettlementDescribe(),this._gameState=GameState.fail,MusicManager.stopAllSound(),this._swapChessTip.onAdventureFail(),this._propModalLayer.onAdventureFail();var e=GameSettlementFailPageData.failReason,t=null!=e?e.ID:-1;GameProxy.stageReport(t),puzzleGame.logFullRecordString(),GameResultFailWindow.Show(function(){PageUtil.switchPageWithLoading("GameSettlementFailPage",PageType.replace,ResObjects.getResObject(ResObjectConfig.gameFail),GameSettlementFailPageData)}.bind(this))},_onStartAnimation:function(e){this._bPlayingAnimation=!0,this._swapChessTip.onStartPlayAnimation(),this._chessBoard.onStartPlayAnimation(),this._propModalLayer.onStartPlayAnimation();for(var t=0,i=e.length;t<i;t++)this._playAnimation(e[t])},_playAnimation:function(e){switch(e.animation_id){case RemoveLogic.we4Proto.AnimationId.swap:ChessBoardHelper.playSwapAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.step:this._playStepAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.score:this._playScoreAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.pass_condition:this._playPassConditionAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.remove:ChessBoardHelper.playRemoveAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.drop:ChessBoardHelper.playDropAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.chess_move:ChessBoardHelper.playMoveAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.generate_attack:ChessBoardHelper.playAttackChessAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.replace_chess:ChessBoardHelper.playDevourChessAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.collect_ice_bear:ChessBoardHelper.playCollectBearAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.maoqiu_split:ChessBoardHelper.playDivideAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.gas_to_gas:ChessBoardHelper.playGhostChess2GhostChessAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.rolling_board:this._playRollChessBoardAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.itemStep:this._playAddStepAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.itemRearrange:ChessBoardHelper.playRearrangeAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.itemSwap:ChessBoardHelper.playSwapPropAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.itemGlass:ChessBoardHelper.playGlassesPropAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.pass_through:AnimationCacheManager.preCreateLastpangAnimation(),ShowOffDataCollect.passThrough(),this._gameState=GameState.success,this._bNeedCheckFiveStepTip=!1,this._bNeedCheckTenStepTip=!1,this._bNeedCheckGuideAddThreeStep=!1,e.data={},e.data.level=this._pageOptions.pageData.level,ChessBoardHelper.playAdventureSuccessAnimation(e),this._propModalLayer.onPlayAdventureSuccessAnimation(),LogPanel.addInfo("冒险成功");break;case RemoveLogic.we4Proto.AnimationId.step_reward_begin:var t={};t.currentScore=this._actionScoreText.getNumber(),t.petPositionInGrid=this._petPositionInGrid,t.effectLayer=this._effectLayer,e.data={},e.data.extendData=t,ChessBoardHelper.playStepRewardAnimation(e),LogPanel.addInfo("步数奖励");break;case RemoveLogic.we4Proto.AnimationId.change_color:ChessBoardHelper.playColorChangeAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.tickbomb_tick:ChessBoardHelper.playBombTickAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.tickbomb_bomb:ChessBoardHelper.playBombFiredAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.tickbomb_replace:ChessBoardHelper.playBombReviveAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.bomb_add_tick:ChessBoardHelper.playBombAddStepAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.scale_move:ChessBoardHelper.playScaleMoveAnimation(e);break;case RemoveLogic.we4Proto.AnimationId.conveyer_move:ChessBoardHelper.playTranslateAnimation(e);break;default:console.log("unKnown animation id : "+e.animation_id)}},onTrySwapChess:function(){if(Util.getInt(this._surplusStepText.getString())>0)return!0;return this._addStepUseCount<this._addStepLimit&&this._showAddStepWindow(),!1},_playRollChessBoardAnimation:function(e){console.log("roll animation data =============================="),console.log(e),ChessBoardScrollController.setChessBoardScrollData(e),ChessBoardScrollController.scrollToRow(e.newStartRow)},_playStepAnimation:function(e){var t=Math.max(0,e.step);this._surplusStepText.setString(t),this._bNeedCheckGuideAddThreeStep&&GameDataConfig.SHOW_GUIDE_USE_STEP_INNER_PROP_STEP==t&&(this._bNeedCheckGuideAddThreeStep=!1,this._propModalLayer.onGuideAddThreeStep(t)),this._bNeedCheckTenStepTip&&10==t?(this._bNeedCheckTenStepTip=!1,GameUtil.registerNextFrameCall(function(){StepTip.Show(10)})):this._bNeedCheckFiveStepTip&&5==t&&(this._bNeedCheckFiveStepTip=!1,GameUtil.registerNextFrameCall(function(){StepTip.Show(5)}))},_playAddStepAnimation:function(e){var t=Util.getInt(this._surplusStepText.getString());t+=e.step,this._surplusStepText.setString(t)},_playScoreAnimation:function(e){console.log("score animation data =============================="),console.log(e),this._actionScoreText.setNumber(e.score);var t=1.1*this._pageOptions.pageData.score,i=e.score/t*100;this._actionProcessBar&&this._actionProcessBar.setPercentWithAction(i),this._checkPlayReachStarLevelAnimation()},_playPassConditionAnimation:function(e){console.log("passCondition animation data =============================="),console.log(e);for(var t=e.data,i=0,a=t.length;i<a;i++){var o=t[i];switch(o.pass_type){case RemoveLogic.we4Proto.PassConditionType.kPassCondCollectChess:case RemoveLogic.we4Proto.PassConditionType.kPassCondCollectColor:this._updateCollectMaterialCount(o)}}},_initGameSettlementDescribe:function(){var e=[];for(var t in this._collectMaterialList){var i=this._collectMaterialList[t];if(null!=i)for(var a=0;a<i.length;a++){var o=i[a],n=o.passConditionData.type,s=o.passConditionData.collectType,r=o.passConditionData.data1,l=o.hookView.getOpacity()>0;e.push({passConditionType:n,collectType:s,count:r,bFinish:l})}}t=0;for(var c=this._originalPassConditionList.length;t<c;t++){var d=this._originalPassConditionList[t];if(d.type==RemoveLogic.we4Proto.PassConditionType.kPassCondScore){n=d.type,s=d.collectType,r=d.data1,l=this._actionScoreText.getNumber()>=r;e.push({passConditionType:n,collectType:s,count:r,bFinish:l});break}}SettlementDescribe.setPassConditionDataList(e),GameSettlementFailPageData.failReason=SettlementDescribe.getFailDescribe()},_updateCollectMaterialCount:function(e){var t=this._collectMaterialList[e.pass_type];if(null!=t)for(var i=0,a=t.length;i<a;i++){var o=t[i];if(o.passConditionData.collectType==e.collect_type){var n=o.passConditionData.data1-e.result1,s=n<=0?255:0,r=n<=0?0:255;o.hookView.setOpacity(s),o.text.setOpacity(r);var l="";switch(o.passConditionData.crushType){case RemoveLogic.we4Proto.CollectType.kCollectCrush:l="X"+n;break;case RemoveLogic.we4Proto.CollectType.kCollectAdd:l=e.result1+"/"+o.passConditionData.data1}o.text.setString(l)}}},_initView:function(e){this._middlePanel.setLocalZOrder(MainGamePageViewZOrder.PANEL),this._rightPanel.setLocalZOrder(MainGamePageViewZOrder.PANEL),this._leftPanel.setLocalZOrder(MainGamePageViewZOrder.PANEL),this._topPanel.setLocalZOrder(MainGamePageViewZOrder.PANEL),this._bottomPanel.setLocalZOrder(MainGamePageViewZOrder.PANEL);(i=UIHelper.createImage({imageFileName:resGroup.MainGamePageRes.bgImage_jpg,position:UIHelper.getCenterPosition()})).setName("bgImage"),this.addChild(i,MainGamePageViewZOrder.GAME_BG);var t=new cc.Node;t.setContentSize(this._middlePanel.getContentSize()),this._middlePanel.addChild(t,MainGamePageViewZOrder.UI_LAYER);(i=UIHelper.createButton({normalFile:"btn_pause.png",bPlistTexture:!0,bPressedActionEnabled:!0,position:cc.p(568,958),bTouchEnable:!0})).addTouchEventListener(this._onPauseButtonTouched,this),t.addChild(i);var i=UIHelper.createImage({imageFileName:"battle_pet.png",bPlistTexture:!0,anchorPoint:cc.p(.5,0),position:cc.p(320,910)});t.addChild(i),this._petPositionInGrid=this._getPositionRelativeToGrid(i.getPosition());i=UIHelper.createImage({imageFileName:"bar_score.png",bPlistTexture:!0,position:cc.p(320,879)});t.addChild(i);var a=i;if(!bChallengeMode){i=UIHelper.createImage({imageFileName:"bar_level_process_B.png",bPlistTexture:!0,position:cc.p(320,824)});t.addChild(i);i=UIHelper.createLoadingBar({bPlistTexture:!0,imageFileName:"bar_yellow.png",percent:0,anchorPoint:cc.p(0,0),position:cc.p(152,819)});t.addChild(i),this._processView=i,this._actionProcessBar=new ActionLoadingBar(i),this._actionProcessBar.setActionTime(1),this._actionProcessBar.setActionEnable(!0),t.addChild(this._actionProcessBar);var o=7,n=this._processView.getContentSize().width,s=1.1*e.pageData.score,r=n/s*e.pageData.oneStarScore;this._scoreStarViewList[0]=this._addStar(cc.p(r,o));r=n/s*e.pageData.twoStarScore;this._scoreStarViewList[1]=this._addStar(cc.p(r,o));r=n/s*e.pageData.threeStarScore;this._scoreStarViewList[2]=this._addStar(cc.p(r,o))}if(this._initPropModalLayer(),bChallengeMode){o=this._bottomPanel.getContentSize().height/2;var l=UIHelper.createImage({imageFileName:res.challenge_mode_tips_png,bPlistTexture:!1,anchorPoint:cc.p(.5,.5),position:cc.p(320,o)});t.addChild(l)}else{this._initPropItem(t);var c=new cc.LabelBMFont(String(e.pageData.level),res.number_gold_fnt);c.setAnchorPoint(0,.5),c.setPosition(75,827),t.addChild(c)}var d=new cc.LabelBMFont(String(e.pageData.step),res.number_blue_fnt);d.setPosition(105,881),t.addChild(d),this._surplusStepText=d;var h=new cc.LabelBMFont("0",res.number_white_fnt);h.setAnchorPoint(0,.5),h.setPosition(470,881),t.addChild(h),this._actionScoreText=new ActionText(h),this._actionScoreText.setActionEnable(!0),this._actionScoreText.setWithCommaEnable(!0),this._actionScoreText.setActionTime(1),t.addChild(this._actionScoreText);var p=UIHelper.createPanel({anchorPoint:a.getAnchorPoint(),position:a.getPosition(),size:a.getContentSize()});t.addChild(p,MainGamePageViewZOrder.PANEL),this._scoreBgPanel=p,this._passCondition(e.pageData.passCondition,p),this._initEffectLayer(),this._initSwapTip(),UIHelper.adjustUILayout(this)},_initSwapTip:function(){var e=new SwapChessTip(this._chessBoard);this.addChild(e,MainGamePageViewZOrder.TOUCH_LAYER),this._swapChessTip=e},_initPropModalLayer:function(){var e=new PropModalLayer(this._chessBoard.getGrid());e.setDelegate(this),e.pushZOrder(MainGamePageViewZOrder.PROP_MODAL_LAYER),e.pushZOrder(MainGamePageViewZOrder.CHESS_BOARD),this._middlePanel.addChild(e,MainGamePageViewZOrder.PROP_MODAL_LAYER),this._propModalLayer=e},_initEffectLayer:function(){var e=this._chessBoard.getGrid(),t=new cc.Node;t.setAnchorPoint(e.getAnchorPoint()),t.setPosition(e.getPosition()),t.setContentSize(e.getContentSize()),this._middlePanel.addChild(t,MainGamePageViewZOrder.EFFECT_LAYER),this._effectLayer=t},_initPropItem:function(e){var t=new SortViewGroup;t.setViewHorizontalSpacing(30),t.setMidX(this._bottomPanel.getContentSize().width/2);var i=this._bottomPanel.getContentSize().height/2,a=!GuideAuxiliaryData.isNeedGuide(GameProxy.getStageId());this._createPropItem(RemoveLogic.we4Proto.ItemId.itemHammer,i,t,a,e),this._createPropItem(RemoveLogic.we4Proto.ItemId.itemStepInner,i,t,!1,e),this._createPropItem(RemoveLogic.we4Proto.ItemId.itemSwap,i,t,a,e),this._createPropItem(RemoveLogic.we4Proto.ItemId.itemGlass,i,t,a,e),this._createPropItem(RemoveLogic.we4Proto.ItemId.itemRearrange,i,t,a,e),t.sort();for(var o=t.getViewList(),n=0,s=o.length;n<s;n++)o[n].updatePosition()},_createPropItem:function(e,t,i,a,o){var n=new PropItem(e,o);return n.setPositionY(t),n.setDelegate(this._propModalLayer),n.setCount(this._getPropCount(e)),n.setUseEnable(a),this._propModalLayer.pushPropItem(n),this._bottomPanel.addChild(n),i.addView(n),n},_getPropCount:function(e){if(HistoryRecord.isUsingHistory)return 10;for(var t=0,i=0,a=NetData.item_list.item.length;i<a;i++){var o=NetData.item_list.item[i];if(o.id==e){t=o.count;break}}return t},_checkPlayReachStarLevelAnimation:function(){if(!bChallengeMode){var e=this,t=this._actionScoreText.getTargetNumber();t>=this._pageOptions.pageData.oneStarScore&&t<this._pageOptions.pageData.twoStarScore?i(0):t>=this._pageOptions.pageData.twoStarScore&&t<this._pageOptions.pageData.threeStarScore?i(1):t>=this._pageOptions.pageData.threeStarScore&&i(2)}function i(t){for(var i=0;i<=t;i++)e._scoreStarViewList[i].loadTexture("icon_star.png",ccui.Widget.PLIST_TEXTURE);var a=e._scoreStarViewList[t];if(!a.getUserData()){a.setUserData(!0);var o={};o.viewRoot=a,o.position=cc.p(a.getContentSize().width/2,a.getContentSize().height/2),AnimationManager.playReachStarLevelEffect(o)}}},_getStarCount:function(){var e=1,t=this._actionScoreText.getTargetNumber();return t>=this._pageOptions.pageData.oneStarScore&&t<this._pageOptions.pageData.twoStarScore?e=1:t>=this._pageOptions.pageData.twoStarScore&&t<this._pageOptions.pageData.threeStarScore?e=2:t>=this._pageOptions.pageData.threeStarScore&&(e=3),e},_initChessBoard:function(){for(var e=[],t=Util.clone(this._chessBoardWorldDataList),i=puzzleGame.getCollectUnderIceList(),a=this._startRow,o=0;o<t.length;o++){var n=t[o];if(null!=n){for(var s=[],r=n.chess_data,l=0;l<r.length;l++){var c=r[l];if(null==c)s.push(null);else{c.pos.row+=a;var d=GameUtil.createChessData(c,GameDataConfig.CHESS_GRID_WIDTH,GameDataConfig.CHESS_GRID_HEIGHT);s.push(d)}}n.pos.row+=a,e.push(new ChessGridData(n.pos.row,n.pos.col,s))}}var h=new ChessBoardData(chessBoardRow,chessBoardCol,viewportRow,viewportCol,GameDataConfig.CHESS_GRID_WIDTH,GameDataConfig.CHESS_GRID_HEIGHT,e),p=new ChessBoard(h);i&&i.length>0&&p.initBearChess(i),p.setDelegate(this),this._middlePanel.addChild(p,MainGamePageViewZOrder.CHESS_BOARD),this._chessBoard=p;var g=new ChessBoardBackground(h);this._middlePanel.addChild(g,MainGamePageViewZOrder.CHESS_BOARD_BACKGROUND),this._chessBoardBg=g},_initSodaWater:function(){var e={};e.size=this._chessBoard.getGrid().getContentSize(),e.anchorPoint=this._chessBoard.getGrid().getAnchorPoint();var t=this._chessBoard.getGrid().getPosition();e.position=t,e.chessGridSize=cc.size(GameDataConfig.CHESS_GRID_WIDTH,GameDataConfig.CHESS_GRID_HEIGHT),e.waterLine=puzzleGame.GetSodaLine();for(var i=[],a=0;a<chessBoardRow;a++){i[a]=[];for(var o=0;o<chessBoardCol;o++)i[a][o]={viewStatus:0}}for(var n=this._startRow,s=Util.clone(this._chessBoardWorldDataList),r=0;r<s.length;r++){var l=s[r];null!=l&&(l.pos.row+=n,i[l.pos.row][l.pos.col].viewStatus=1)}e.chessBoardRow=chessBoardRow,e.chessBoardCol=chessBoardCol,e.viewportRow=viewportRow,e.viewportCol=viewportCol,e.chessGridData=i,this._sodaBubble=new SodaBubble(e),this._middlePanel.addChild(this._sodaBubble,MainGamePageViewZOrder.SODA_BUBBLE),this._sodaWater=new SodaWater(e),this._middlePanel.addChild(this._sodaWater,MainGamePageViewZOrder.SODA_WATER)},_passCondition:function(e,t){this._originalPassConditionList=e.concat();var i=new ccui.Layout;i.setContentSize(280,65),i.setAnchorPoint(cc.p(.5,.5)),i.setPosition(285,35),i.setScale(e.length>=4?.72:1),t.addChild(i,2);for(var a=0,o=e.length;a<o;a++)if(e[a].type==RemoveLogic.we4Proto.PassConditionType.kPassCondAllStep){e.splice(a,1);break}var n=new SortViewGroup;n.setViewHorizontalSpacing(10),n.setMidX(140);for(a=0,o=e.length;a<o;a++){switch((h=e[a]).type){case RemoveLogic.we4Proto.PassConditionType.kPassCondScore:1==e.length&&this._addPassConditionScore(h,i);break;case RemoveLogic.we4Proto.PassConditionType.kPassCondCollectColor:var s=this._addPassConditionCollectColor(h,i);n.addView(s);break;case RemoveLogic.we4Proto.PassConditionType.kPassCondCollectChess:s=this._addPassConditionCollectChess(h,i);n.addView(s)}}n.sort();var r=n.getViewList();for(a=0,o=r.length;a<o;a++){var l=(s=r[a]).getChildByName("collect"),c=l.getChildByName("hook"),d=s.getChildByName("number"),h=s.getUserData(),p=this._getCollectMaterialPositionInGrid(l);this._collectMaterialList[h.type]=this._collectMaterialList[h.type]||[],this._collectMaterialList[h.type].push({text:d,hookView:c,collectMaterialPosition:p,passConditionData:h})}},_addPassConditionScore:function(e,t){var i=new ccui.Text;i.setFontName("Microsoft YaHei"),i.setFontSize(22),i.setString(cc.formatStr(Language.getString(LanguageKey.SCORE_PASSCONDITION),e.data1)),i.setPosition(t.getContentSize().width/2,t.getContentSize().height/2),t.addChild(i)},_addPassConditionCollectChess:function(e,t){var i=GameDataConfig.CollectEffectConfig[e.collectType],a=null!=i&&null!=i.chessView?i.chessView.image1:"";return this._addCollectMaterial(a,e,t)},_addPassConditionCollectColor:function(e,t){var i=GameDataConfig.ColorChessViewConfig[e.collectType],a=null!=i?i.image1:"";return this._addCollectMaterial(a,e,t)},_addCollectMaterial:function(e,t,i){var a=new ccui.Layout;i.addChild(a);var o=i.getContentSize().height,n=new cc.Sprite;n.initWithSpriteFrameName(e),n.setAnchorPoint(0,.5),n.setPosition(0,o/2),n.setName("collect"),n.getContentSize().height>=o&&n.setScale((o-10)/n.getContentSize().height),a.addChild(n);var s=new cc.Sprite;s.initWithSpriteFrameName("icon_hook.png"),s.setAnchorPoint(1,0),s.setPosition(n.getBoundingBox().width+s.getBoundingBox().width/2,0),s.setName("hook"),s.setOpacity(0),n.addChild(s);var r=n.getBoundingBox().width+5,l="";switch(t.crushType){case RemoveLogic.we4Proto.CollectType.kCollectCrush:l="X"+t.data1;break;case RemoveLogic.we4Proto.CollectType.kCollectAdd:l=t.result1+"/"+t.data1}var c=new cc.LabelBMFont(l,res.number_white_fnt);return c.setAnchorPoint(0,.5),c.setPosition(r,o/2),c.setName("number"),a.addChild(c),r+=c.getBoundingBox().width,a.setContentSize(r-5,o),a.setUserData(t),a},_getCollectMaterialPositionInGrid:function(e){function t(e,i,a){var o=e.getParent();o!=i?(a.x+=o.getPositionX()-o.getBoundingBox().width*o.getAnchorPoint().x,a.y+=o.getPositionY()-o.getBoundingBox().height*o.getAnchorPoint().y,t(o,i,a)):(a.x+=o.getPositionX()-o.getBoundingBox().width*o.getAnchorPoint().x,a.y+=o.getPositionY()-o.getBoundingBox().height*o.getAnchorPoint().y)}var i=e.getPosition();return t(e,this._scoreBgPanel,i),i.x+=e.getBoundingBox().width*(.5-e.getAnchorPoint().x),i.y+=e.getBoundingBox().height*(.5-e.getAnchorPoint().y),i=this._getPositionRelativeToGrid(i)},_addStar:function(e){var t=UIHelper.createImage({imageFileName:"icon_star_gray.png",bPlistTexture:!0,position:e});return this._processView.addChild(t),t},_sTouchTimeout:0,_onPauseButtonTouched:function(e,t){if(ccui.Widget.TOUCH_BEGAN==t){var i=this;this._sTouchTimeout=Timeout.register(function(){var e={};e._playingEffectCount=AnimationManager._playingEffectCount,e._executingEffectLogicCount=AnimationManager._executingEffectLogicCount,e.isHaveTaskRunning=AnimationManager._animationTaskHandler.isHaveTaskRunning(),e._waitChessBoardStableFunList_length=AnimationManager._waitChessBoardStableFunList.length,e.aniNum=puzzleGame.getAnimationNum(),e._bPlayedEffect=AnimationManager._bPlayedEffect,e._propModalLayer_active=i._propModalLayer.isActivate(),e._bPlayingAnimation=i._bPlayingAnimation,e._bPlayingPropAnimation=i._bPlayingPropAnimation,console.log("cannotTouchLog : "+JSON.stringify(e)),PauseWindow.Show()},3e3)}if(ccui.Widget.TOUCH_ENDED==t&&(clearTimeout(this._sTouchTimeout),this._sTouchTimeout=null,!this._propModalLayer.isActivate()&&!this._bPlayingAnimation&&!this._bPlayingPropAnimation)){if(HistoryRecord.isUsingHistory){var a=HistoryRecord.curUsingRecord.input;if(HistoryRecord.curInputIndex<a.length){var o=a[HistoryRecord.curInputIndex];return HistoryRecord.curInputIndex++,this.historyInputLabel.setString(a.length-HistoryRecord.curInputIndex),void puzzleGame.eventManager.trigger("PLAY_INPUT",o)}HistoryRecord.isUsingHistory=!1}PauseWindow.Show(),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch)}},_getPositionRelativeToGrid:function(e){var t=this._chessBoard.getGrid(),i=t.getAnchorPoint(),a=t.getContentSize(),o=t.getPosition(),n=cc.p(o.x-a.width*i.x,o.y-a.height*i.y);return e.x-=n.x,e.y-=n.y,e},onEnter:function(){wx.triggerGC&&wx.triggerGC(),MusicManager.stopMusic();var e=[MusicEffectFiles.Audio_bgm_game_puzzle],t=e[Util.getRandom(0,e.length-1)];if(MusicManager.playMusic(t,!0),!this._bInitFinished){var i=this._enterCallBack;this._enterCallBack=null;var a=setInterval(function(){this._bInitFinished&&(clearInterval(a),"function"==typeof i&&i())}.bind(this),1/15)}this._super()},onExit:function(){this._chessBoard.getGrid().removeFromParent(!1),Timeout.clear(),GameUtil.pauseAllAnimation(this);var e=this.getAverageFrameRate();console.log("MainGamePage average frame rate : "+e),LastPang.destroy(),ChessBoardHelper.destroy(),AnimationManager.destroy(),GameProxy.destroy(),ChessBoardScrollController.destroy(),GuidePopup.Destroy(),GuideManager.DestroyInstance(),MusicManager.stopMusic(),DropEncourage.Destroy(),Util.unRegisterListeners(this._listenerList),this._listenerList=[],AutoPlayLogic.destroy(),cc.director.getActionManager().pauseAllRunningActions(),GameResultSuccessWindow.Hide(),GameResultFailWindow.Hide(),this._super()},onActivateProp:function(){this._chessBoard.onActivateProp()},onUnActivateProp:function(){this._chessBoard.onUnActivateProp()},onTriggerPropSuccess:function(e){if(null!=e){if(e.getItemId()==RemoveLogic.we4Proto.ItemId.itemStepInner){var t={},i=e.convertToWorldSpaceAR(cc.p(0,0));t.position=this._getPositionRelativeToGrid(i),t.fromPosition=cc.p(t.position.x,t.position.y);i=this._surplusStepText.convertToWorldSpaceAR(cc.p(0,0));t.toPosition=this._getPositionRelativeToGrid(i),t.viewRoot=this._effectLayer,t.step=3,MaskWindow.Show(),AnimationManager.playUseAddThreeStepPropEffect(t,function(){MaskWindow.Destroy()}.bind(this))}}},onTriggerPropFail:function(e){},onPropModalLayerTouched:function(e){return this._chessBoard.getChessGrid(e)},onPropUnEnough:function(e){BuyPropWindow.Show({itemId:e},function(){console.log("close")}.bind(this),function(e){this._propModalLayer.onBuyPropSuccess(e)}.bind(this))},onPropOverUseLimit:function(e){TipWindow.Show(cc.formatStr(Language.getString(LanguageKey.PROP_OVER_USE_LIMIT),e.getPropName()))},onChessBoardStartScroll:function(){this._bPlayingAnimation=!0,this._swapChessTip.onChessBoardStartScroll(),this._chessBoard.onStartScroll(),this._propModalLayer.onChessBoardStartScroll()},onChessBoardScrollComplete:function(){this._bPlayingAnimation=!1,this._swapChessTip.onChessBoardScrollComplete(),this._chessBoard.onScrollComplete(),this._propModalLayer.onChessBoardScrollComplete()}});
var MaskWindow=WindowBase.extend({ctor:function(){this._super()},onShowNotify:function(){},onShow:function(){},onHideNotify:function(){},onHide:function(){},onDestroyNotify:function(){},onDestroy:function(){},onCover:function(){},onResume:function(){}});MaskWindow.GetInstance=function(){return null==MaskWindow._instance&&(MaskWindow._instance=new MaskWindow),MaskWindow._instance},MaskWindow.Show=function(){var n=MaskWindow.GetInstance();WindowManager.GetInstance().showWindow(n,null,!1,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,MaskWindow.Destroy)},MaskWindow.Hide=function(){WindowManager.GetInstance().hideWindow(MaskWindow._instance)},MaskWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(MaskWindow._instance),MaskWindow._instance=null};
var PassConditionWindow=WindowBase.extend({_cloudEffect:null,_maskImage:null,_completeCallBack:null,ctor:function(){this._super();var e=UIHelper.createImage({imageFileName:res.mask_png,position:UIHelper.getCenterPosition(),scale:Math.max(cc.winSize.width/4,cc.winSize.height/4),opacity:180});this.addChild(e),this._maskImage=e,this._cloudEffect=new CloudEffect,this._cloudEffect.setPosition(UIHelper.getCenterPosition()),this._cloudEffect.setPokeCloudEventCallBack(this._onPokeCloud.bind(this)),this.addChild(this._cloudEffect)},setCompleteCallBack:function(e){this._completeCallBack=e},_onPokeCloud:function(e){var t=new cc.FadeOut(e);this._maskImage.runAction(t),MusicManager.playEffect(MusicEffectFiles.Audio_UI_clouddisappear)},onShowNotify:function(){this._maskImage.setOpacity(180),this._cloudEffect.play(function(){PassConditionWindow.Hide(),"function"==typeof this._completeCallBack&&this._completeCallBack()}.bind(this))},setPassConditionList:function(e){for(var t=null,n=0,o=e.length;n<o;n++)if(e[n].type==RemoveLogic.we4Proto.PassConditionType.kPassCondScore){t=e.splice(n,1)[0];break}t&&e.push(t);var i=UIHelper.seekWidgetByName(this._cloudEffect._node,"Panel_1",NodeType.PANEL);i.removeAllChildren();var a=UIHelper.createImage({imageFileName:"passConditionTitle.png",bPlistTexture:!0,position:cc.p(i.getContentSize().width/2,250)});i.addChild(a);var s=cc.p(i.getContentSize().width/2,i.getContentSize().height-120);this._conditionScale=e.length>=4?.75:1;for(n=0,o=e.length;n<o;n++){var d=e[n];a=null;switch(d.type){case RemoveLogic.we4Proto.PassConditionType.kPassCondScore:a=this._addScore(d,i);break;case RemoveLogic.we4Proto.PassConditionType.kPassCondCollectColor:a=this._addPassConditionCollectColor(d,i);break;case RemoveLogic.we4Proto.PassConditionType.kPassCondCollectChess:a=this._addPassConditionCollectChess(d,i)}null!=a&&(a.setPosition(s),s.y-=a.getBoundingBox().height,s.y-=10)}},_addScore:function(e,t){var n=new ccui.Layout;n.setAnchorPoint(.5,0),n.setScale(this._conditionScale),n.setCascadeColorEnabled(!0),n.setCascadeOpacityEnabled(!0),t.addChild(n);var o=new cc.LabelBMFont("0",res.number_blue_fnt);o.setAnchorPoint(1,.5),o.setScale(1.7),o.setString(Util.getNumberWithComma(e.data1)),n.addChild(o);var i=o.getBoundingBox().height,a=UIHelper.createImage({imageFileName:"fen.png",bPlistTexture:!0,anchorPoint:cc.p(1,0)});n.addChild(a),i=Math.max(i,a.getBoundingBox().height),n.setContentSize(t.getContentSize().width,i);var s=n.getBoundingBox().width,d=(s-(o.getBoundingBox().width+a.getBoundingBox().width))/2;return a.setPosition(s-d,-a.getBoundingBox().width/2),o.setPosition(a.getPositionX()-a.getBoundingBox().width-5,0),n},_addPassConditionCollectChess:function(e,t){var n=GameDataConfig.CollectEffectConfig[e.collectType],o=null!=n&&null!=n.chessView?n.chessView.image1:"";return this._addCollectMaterial(o,e,t)},_addPassConditionCollectColor:function(e,t){var n=GameDataConfig.ColorChessViewConfig[e.collectType],o=null!=n?n.image1:"";return this._addCollectMaterial(o,e,t)},_addCollectMaterial:function(e,t,n){var o=new ccui.Layout;o.setAnchorPoint(.5,0),o.setScale(this._conditionScale),o.setCascadeColorEnabled(!0),o.setCascadeOpacityEnabled(!0),n.addChild(o);var i=new cc.Sprite;i.initWithSpriteFrameName(e),i.setAnchorPoint(1,0),o.addChild(i);var a=i.getBoundingBox().height,s=new cc.LabelBMFont("X"+t.data1,res.number_blue_fnt);s.setScale(1.7),s.setAnchorPoint(1,.5),o.addChild(s),a=Math.max(a,s.getBoundingBox().height),o.setContentSize(n.getContentSize().width,a);var d=o.getBoundingBox().width,l=(d-(s.getBoundingBox().width+i.getBoundingBox().width))/2;return s.setPosition(d-l,i.getBoundingBox().height/2),i.setPosition(s.getPositionX()-s.getBoundingBox().width-10,0),o},onShow:function(){},onHideNotify:function(){},onHide:function(){},onDestroyNotify:function(){},onDestroy:function(){},onCover:function(){},onResume:function(){}});PassConditionWindow.GetInstance=function(){return null==PassConditionWindow._instance&&(PassConditionWindow._instance=new PassConditionWindow),PassConditionWindow._instance},PassConditionWindow.Show=function(e,t,n){var o=PassConditionWindow.GetInstance();o.setPassConditionList(e),o.setCompleteCallBack(t),WindowManager.GetInstance().showWindow(o,null,!1,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,n,PassConditionWindow.Destroy)},PassConditionWindow.Hide=function(){WindowManager.GetInstance().hideWindow(PassConditionWindow._instance)},PassConditionWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(PassConditionWindow._instance),PassConditionWindow._instance=null};var CloudEffect=Effect.extend({_pokeCloudEventCallBack:null,ctor:function(){this._super(res.cloud_json);var e=UIHelper.seekWidgetByName(this._node,"Panel_1",NodeType.PANEL);e&&e.setBackGroundColorType(ccui.Layout.BG_COLOR_NONE),Timeout.register(function(){"function"==typeof this._pokeCloudEventCallBack&&this._pokeCloudEventCallBack(1.2)}.bind(this),85/FRAME_SECOND*1e3)},setPokeCloudEventCallBack:function(e){this._pokeCloudEventCallBack=e},play:function(e){this._super(!1),this.setPlayCompleteCallBack(function(){"function"==typeof e&&e()}.bind(this))}});
var PauseWindow=WindowBase.extend({ctor:function(){this._super();var e=UIHelper.createImage({imageFileName:"bg_dialog.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(512,510),capInsets:cc.rect(0,72,512,22),position:UIHelper.getPosition(320,564)});this.addChild(e);var t=UIHelper.createImage({imageFileName:"pause_title.png",bPlistTexture:!0,position:cc.p(e.getContentSize().width/2,470)});e.addChild(t);var n=bChallengeMode?335:365;(t=UIHelper.createButton({normalFile:"btn_back_game_N.png",bPlistTexture:!0,bPressedActionEnabled:!0,position:cc.p(256,n),bTouchEnable:!0})).addTouchEventListener(this._onBackGameButtonTouched,this),e.addChild(t);(t=UIHelper.createButton({normalFile:"btm_replay_game_N.png",bPlistTexture:!0,bPressedActionEnabled:!0,position:cc.p(256,265),bTouchEnable:!0})).addTouchEventListener(this._onReplayButtonTouched,this),e.addChild(t),t.setVisible(!bChallengeMode);var o=bChallengeMode?215:165;(t=UIHelper.createButton({normalFile:"btn_exit_game_N.png",bPlistTexture:!0,bPressedActionEnabled:!0,position:cc.p(256,o),bTouchEnable:!0})).addTouchEventListener(this._onExitGameButtonTouched,this),e.addChild(t)},_onBackGameButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(PauseWindow.Destroy(),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch))},_onReplayButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(puzzleGame.logFullRecordString(),bChallengeMode?(PauseWindow.Destroy(),GameProxy.pkMatchReportOnExit(),PageUtil.switchPageTo("StageMapPage",PageType.replace,ResObjects.getResObject(ResObjectConfig.allStage))):(GameProxy.stageReportOnExit(),PageUtil.switchPageTo("StageMapPage",PageType.replace,ResObjects.getResObject(ResObjectConfig.allStage),null,function(){GameProxy.init(),PropSelectWindow.Show(!1),PauseWindow.Destroy()}.bind(this))),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch))},_onExitGameButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(puzzleGame.logFullRecordString(),bChallengeMode?GameProxy.pkMatchReportOnExit():GameProxy.stageReportOnExit(),PageUtil.switchPageTo("StageMapPage",PageType.replace,ResObjects.getResObject(ResObjectConfig.allStage)),PauseWindow.Destroy(),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch))},onShowNotify:function(){},onShow:function(){},onHideNotify:function(){},onHide:function(){},onDestroyNotify:function(){},onDestroy:function(){},onCover:function(){},onResume:function(){}});PauseWindow.GetInstance=function(){return null==PauseWindow._instance&&(PauseWindow._instance=new PauseWindow),PauseWindow._instance},PauseWindow.Show=function(){var e=PauseWindow.GetInstance(),t=WindowAction.getScaleEaseElasticOutAction(e);WindowManager.GetInstance().showWindow(e,t,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,PauseWindow.Destroy)},PauseWindow.Hide=function(){WindowManager.GetInstance().hideWindow(PauseWindow._instance)},PauseWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(PauseWindow._instance),PauseWindow._instance=null};
var AddThreeStepProp={_delegate:null,_bTrigger:!1,destroy:function(){this._bTrigger=!1},onUnActivate:function(){},onActivate:function(e){this._bTrigger||(this._delegate=e,this._delegate.onTryTriggerProp(function(){this._bTrigger=!0,puzzleGame.eventManager.trigger("START_PLAY_PROP_ANIMATION");var e=new Input(RemoveLogic.we4Proto.InputOp.kOpUseItem,null,null,RemoveLogic.we4Proto.ItemId.itemStepInner);puzzleGame.input(e,function(e){e?(eventDispatcher.dispatchEvent(EventID.ON_USE_PROP),this._delegate.onTriggerPropSuccess()):this._delegate.onTriggerPropFail(),this._bTrigger=!1,puzzleGame.eventManager.trigger("PROP_ANIMATION_PLAY_COMPLETE")}.bind(this))}.bind(this),function(){this._bTrigger=!1,this._delegate.onTriggerPropFail()}.bind(this)))},onCheckTrigger:function(e){}};
var ChoseChessDirection={left:1,right:2,top:3,bottom:4,leftTop:5,leftBottom:6,rightTop:7,rightBottom:8},GlassesPropTargetChess=[];function initGlassesPropTargetChess(){GlassesPropTargetChess=[RemoveLogic.we4Proto.ChessType.CT_NormalUnit,RemoveLogic.we4Proto.ChessType.CT_SpecialVerticalShockWave,RemoveLogic.we4Proto.ChessType.CT_SpecialHorizontalShockWave,RemoveLogic.we4Proto.ChessType.CT_SpecialHurricane,RemoveLogic.we4Proto.ChessType.CT_STEPBONUS,RemoveLogic.we4Proto.ChessType.CT_Chameleon,RemoveLogic.we4Proto.ChessType.CT_TICKBOMB]}var GlassesProp={_bSelect:!1,_horizontalChess:null,_verticalChess:null,_delegate:null,_bTrigger:!1,_line1View:null,_line2View:null,_touchedChess:null,_clickedStateChess:null,destroy:function(){this._bSelect=!1,this._clickedStateChess&&this._clickedStateChess.removeFromParent(),ChessCacheManager.cacheChess(this._clickedStateChess),this._clickedStateChess=null,this._horizontalChess&&this._horizontalChess.removeFromParent(),this._horizontalChess=null,this._verticalChess&&this._verticalChess.removeFromParent(),this._verticalChess=null,this._line1View&&this._line1View.removeFromParent(),this._line1View=null,this._line2View&&this._line2View.removeFromParent(),this._line2View=null,this._touchedChess=null,this._bTrigger=!1},onActivate:function(e){this._delegate=e},onUnActivate:function(){this._touchedChess=null,this._bSelect=!1,this._clickedStateChess&&this._clickedStateChess.removeFromParent(),ChessCacheManager.cacheChess(this._clickedStateChess),this._clickedStateChess=null,this._horizontalChess&&this._horizontalChess.setOpacity(0),this._verticalChess&&this._verticalChess.setOpacity(0),this._line1View&&this._line1View.setOpacity(0),this._line2View&&this._line2View.setOpacity(0)},onCheckTrigger:function(e){if(!this._bTrigger)if(null!=e)if(this._bSelect)this._sureChoseChess(e);else{var t=e.getTopFeaturesChess();this._touchedChess=t,null!=t&&t.getLogicOrder()==GameDataConfig.ChessLogicOrder.ORDER_2&&-1!=GlassesPropTargetChess.indexOf(t.getChessType())?(this._bSelect=!0,this._showOptionChess(t),this._delegate.topLocalZOrder(),MusicManager.playEffect(MusicEffectFiles.Audio_G_changetoshock1)):this._delegate.onTriggerPropFail()}else this._delegate.onTriggerPropFail()},_sureChoseChess:function(e){var t=e.getGridPosition(),s=t.row,i=t.col;this._horizontalChess.getRow()!=s||this._horizontalChess.getCol()!=i?this._verticalChess.getRow()!=s||this._verticalChess.getCol()!=i?this._delegate.onTriggerPropFail():this._tryTriggerProp(this._verticalChess):this._tryTriggerProp(this._horizontalChess)},_tryTriggerProp:function(e){if(this._touchedChess.getChessType()==e.getChessType())return this._bTrigger=!1,void this._delegate.onTriggerPropFail();this._delegate.onTryTriggerProp(function(){puzzleGame.eventManager.trigger("START_PLAY_PROP_ANIMATION");var t=e.getGridPosition(),s=this._touchedChess.getGridPosition(),i=new Input(RemoveLogic.we4Proto.InputOp.kOpUseItem,s,t,RemoveLogic.we4Proto.ItemId.itemGlass,e.getChessType());puzzleGame.input(i,function(t){t?(LogPanel.addInfo("戴眼镜成功"),eventDispatcher.dispatchEvent(EventID.ON_USE_PROP,{itemId:RemoveLogic.we4Proto.ItemId.itemGlass,touchedChess:this._touchedChess,targetChess:e}),this._delegate.onTriggerPropSuccess(),MusicManager.playEffect(MusicEffectFiles.Audio_G_changetoshock2)):(LogPanel.addInfo("戴眼镜失败"),this._delegate.onTriggerPropFail()),this._bTrigger=!1,puzzleGame.eventManager.trigger("PROP_ANIMATION_PLAY_COMPLETE")}.bind(this))}.bind(this),function(){this._bTrigger=!1,this._delegate.onTriggerPropFail()}.bind(this))},_showOptionChess:function(e){for(var t=e.getRow(),s=e.getCol(),i=-1,o=-1;;){if(0==t&&0==s){i=ChoseChessDirection.right,o=ChoseChessDirection.bottom;break}if(t==viewportRow-1&&0==s){i=ChoseChessDirection.right,o=ChoseChessDirection.top;break}if(0==t&&s==viewportCol-1){i=ChoseChessDirection.left,o=ChoseChessDirection.bottom;break}if(t==viewportRow-1&&s==viewportCol-1){i=ChoseChessDirection.left,o=ChoseChessDirection.top;break}if(0==s){i=ChoseChessDirection.rightTop,o=ChoseChessDirection.rightBottom;break}if(s==viewportCol-1){i=ChoseChessDirection.leftTop,o=ChoseChessDirection.leftBottom;break}if(0==t){i=ChoseChessDirection.leftBottom,o=ChoseChessDirection.rightBottom;break}if(t==viewportRow-1){i=ChoseChessDirection.leftTop,o=ChoseChessDirection.rightTop;break}if(t>viewportRow/2){i=ChoseChessDirection.leftTop,o=ChoseChessDirection.rightTop;break}if(t<=viewportRow/2){i=ChoseChessDirection.leftBottom,o=ChoseChessDirection.rightBottom;break}}var h=this._delegate.getImitateGrid();this._horizontalChess=this._createChess(this._horizontalChess,i,RemoveLogic.we4Proto.ChessType.CT_SpecialHorizontalShockWave,e,h),this._verticalChess=this._createChess(this._verticalChess,o,RemoveLogic.we4Proto.ChessType.CT_SpecialVerticalShockWave,e,h),this._createClickedStateChess(e,h),this._line1View=this._createLine(this._line1View,e.getPosition(),this._horizontalChess.getPosition(),h),this._line2View=this._createLine(this._line2View,e.getPosition(),this._verticalChess.getPosition(),h)},_createClickedStateChess:function(e,t){var s=e.cloneChessData(),i=ChessCacheManager.getChess(s),o=i.chess;null!=o&&(i.bCreate||(o.removeFromParent(),o.reset(s)),t.addChild(o),o.setDelegate(null),o.setPosition(e.getPosition()),o.setOpacity(255),o.finish(),o.onClicked()),this._clickedStateChess=o},_createChess:function(e,t,s,i,o){var h=0,r=0;switch(t){case ChoseChessDirection.left:h=0,r=-1;break;case ChoseChessDirection.right:h=0,r=1;break;case ChoseChessDirection.top:h=-1,r=0;break;case ChoseChessDirection.bottom:h=1,r=0;break;case ChoseChessDirection.leftTop:h=-1,r=-1;break;case ChoseChessDirection.leftBottom:h=1,r=-1;break;case ChoseChessDirection.rightTop:h=-1,r=1;break;case ChoseChessDirection.rightBottom:h=1,r=1}if(null==e){var a=i.getRow()+h,n=i.getCol()+r;(c=i.cloneChessData()).gridPosition.row=a,c.gridPosition.col=n,c.chessType=s;var l=new DirectionChess(c);o.addChild(l),e=l}else{var c;(c=e.cloneChessData()).colorType=i.getColorType(),c.gridPosition.row=i.getRow()+h,c.gridPosition.col=i.getCol()+r,e.reset(c),e.finish()}var C=i.getPositionX()+r*i.getWidth(),g=i.getPositionY()-h*i.getHeight();return e.setPosition(C,g),e.setOpacity(255),console.log("x : "+C+" , y : "+g),e},_createLine:function(e,t,s,i){null==e&&((e=new cc.Sprite).initWithSpriteFrameName("glasses_prop_line.png"),i.addChild(e)),e.setOpacity(255),e.setPosition(cc.pMidpoint(t,s));var o=cc.pToAngle(cc.pSub(t,s));return o=(180*o/Math.PI+360)%360,e.setRotation(-o),e}};
var HammerProp={_delegate:null,_bTrigger:!1,destroy:function(){this._bTrigger=!1},onActivate:function(e){this._delegate=e},onUnActivate:function(){},onCheckTrigger:function(e){if(!this._bTrigger)if(null!=e){var i=e.getTopFeaturesChess();null!=i?this._delegate.onTryTriggerProp(function(){this._bTrigger=!0,puzzleGame.eventManager.trigger("START_PLAY_PROP_ANIMATION"),MusicManager.playEffect(MusicEffectFiles.Audio_G_disappear);var e=i.getGridPosition(),t=new Input(RemoveLogic.we4Proto.InputOp.kOpUseItem,e,e,RemoveLogic.we4Proto.ItemId.itemHammer);puzzleGame.validInput(t,function(e){if(e){var r={};r.viewRoot=this._delegate.getGrid(),r.position=i.getPosition(),AnimationManager.playHammerPropEffect(r,function(){puzzleGame.input(t,function(e){e&&(eventDispatcher.dispatchEvent(EventID.ON_USE_PROP),this._delegate.onTriggerPropSuccess())}.bind(this))}.bind(this),function(){this._bTrigger=!1,puzzleGame.eventManager.trigger("PROP_ANIMATION_PLAY_COMPLETE")}.bind(this))}else this._bTrigger=!1,puzzleGame.eventManager.trigger("PROP_ANIMATION_PLAY_COMPLETE"),this._delegate.onTriggerPropFail()}.bind(this))}.bind(this),function(){this._delegate.onTriggerPropFail()}.bind(this)):this._delegate.onTriggerPropFail()}else this._delegate.onTriggerPropFail()}};
var PropItem=cc.Node.extend({_bgEffect:null,_bgImage:null,_countText:null,_count:null,_itemId:null,_delegate:null,_propCountTextBgView:null,_maskView:null,_useLimit:null,_useCount:null,_touchPanel:null,_iconView:null,_bOverLimit:!1,_propConfig:null,ctor:function(t,e){this._super(),this._itemId=t,this._useCount=0,this._propConfig=ConfigLoader.getPropConfig(t);var i=UIHelper.createImage({imageFileName:"prop_bg.png",bPlistTexture:!0});e.addChild(i),this._bgImage=i;var n=i.getContentSize();this.setContentSize(n),this.setAnchorPoint(.5,.5);var o=cc.p(n.width/2,n.height/2);this._bgImage.setPosition(o);var s=UIHelper.createPanel({anchorPoint:cc.p(.5,.5),position:o,size:i.getContentSize(),bTouchEnable:!0});s.addTouchEventListener(this._onPropItemTouched,this),this.addChild(s),this._touchPanel=s,this._propCountTextBgView=this._createPropCountTextBgView(e),this._maskView=this._createPropMaskView(e),this._countText=this._createPropItemCountText(e),this._iconView=this._createPropIconView(t,e)},_createPropCountTextBgView:function(t){var e=UIHelper.createImage({imageFileName:"prop_count_bg.png",bPlistTexture:!0});return t.addChild(e,8),e},_createPropMaskView:function(t){var e=UIHelper.createImage({imageFileName:"prop_bg.png",bPlistTexture:!0,opacity:0});return e.setColor(0,0,0),e.setOpacity(170),t.addChild(e,6),e},_createPropItemCountText:function(t){var e=new cc.LabelBMFont("0",res.number_white_fnt);return e.setScale(.8),e.setPosition(200,200),t.addChild(e,10),e},_createPropIconView:function(t,e){var i=UIHelper.createImage({imageFileName:GameDataConfig.PropViewConfig[t].image1,bPlistTexture:!0});return e.addChild(i,5),i},updatePosition:function(){var t=this.getPosition();this._iconView.setPosition(t),this._maskView.setPosition(t),this._bgImage.setPosition(t);var e=this.getContentSize();this._propCountTextBgView.setPosition(t.x+e.width/2,t.y-e.height/2+10),this._countText.setPosition(this._propCountTextBgView.getPosition())},setDelegate:function(t){this._delegate=t},getItemId:function(){return this._itemId},setCount:function(t){this._count!==t&&(this._count=t,this._count>0?this._countText.setString(t):this._countText.setString("+"))},getCount:function(){return this._count},onSelected:function(){var t=this._bgImage.getContentSize(),e=cc.p(t.width/2,t.height/2),i=AnimationCacheManager.getEffect(EffectCacheType.PROP_ITEM_BG).effect;null!=i&&(i.removeFromParent(),i.setOpacity(255),i.setPosition(e),this.addChild(i),i.play(!0),this._bgEffect=i)},onUnSelected:function(){AnimationCacheManager.cacheEffect(EffectCacheType.PROP_ITEM_BG,this._bgEffect)},onUse:function(){this.setCount(this._count-1),this._useCount++,this._bOverLimit=this._useCount>=this._propConfig.use_limit,this.setLight(!this._bOverLimit)},onAdd:function(t){var e=this._count+t;this.setCount(e)},setUseEnable:function(t){this._touchPanel.setTouchEnabled(t),this.setLight(t)},setLight:function(t){var e=t?0:180;this._maskView.setOpacity(e)},isOverLimit:function(){return this._bOverLimit},getPropName:function(){return this._propConfig.item_name},getUseLimit:function(){return this._propConfig.use_limit},onExit:function(){this._super(),AnimationCacheManager.cacheEffect(EffectCacheType.PROP_ITEM_BG,this._bgEffect)},_onPropItemTouched:function(t,e){switch(e){case ccui.Widget.TOUCH_BEGAN:this._bgImage.setScale(1.1);break;case ccui.Widget.TOUCH_ENDED:this._bgImage.setScale(1),this._delegate.onTouchPropItem(this);break;case ccui.Widget.TOUCH_CANCELED:this._bgEffect&&this._bgEffect.setOpacity(0),this._bgImage.setScale(1)}}});
var PropModalLayer=cc.Node.extend({_selectedPropItem:null,_bActivateModal:!1,_bCanActivate:!0,_maskImage:null,_zOrderList:null,_delegate:null,_grid:null,_imitateGrid:null,_bPlayingAnimation:!1,_bPlayingPropAnimation:!1,_propItemMap:null,_stepInnerBgEffect:null,_listenerList:null,ctor:function(e){this._super(),this._listenerList=[],this._propItemMap=[],this._zOrderList=[],this._grid=e;var t=GameCommonDef.DESIGN_RESOLUTION_SIZE;this.setAnchorPoint(cc.p(.5,.5)),this.setPosition(cc.p(GameCommonDef.DESIGN_RESOLUTION_SIZE.width/2,iphoneXMode?GameCommonDef.DESIGN_RESOLUTION_SIZE.height/2:cc.visibleRect.center.y)),this.setScale(puzzleGame.GetScale()),this.setContentSize(t);var i=UIHelper.createImage({imageFileName:res.mask_png,position:cc.p(t.width/2,t.height/2),opacity:0});this.addChild(i),this._maskImage=i;(i=new cc.Node).setAnchorPoint(.5,.5),i.setPosition(e.getPosition()),i.setContentSize(e.getContentSize()),this.addChild(i),this._imitateGrid=i,Util.registerListener(this._listenerList,EventID.ON_NETWORK_TIP_WINDOW_CANCEL,this._onNetworkTipWindowCancel.bind(this)),this._initTouchListener()},pushPropItem:function(e){this._propItemMap[e.getItemId()]=e},getPropItem:function(e){return this._propItemMap[e]},getImitateGrid:function(){return this._imitateGrid},getGrid:function(){return this._grid},isActivate:function(){return this._bActivateModal},setDelegate:function(e){this._delegate=e},pushZOrder:function(e){this._zOrderList.push(e)},topLocalZOrder:function(){this.setLocalZOrder(this._zOrderList[this._zOrderList.length-1])},_activateModal:function(){this._touchListener.setEnabled(!0),this._bActivateModal=!0;var e=this.getScale(),t=Math.max(cc.winSize.width/e/4,cc.winSize.height/e/4);this._maskImage.setScale(t),this._maskImage.setOpacity(180),this._selectedPropItem.onSelected(),this._delegate.onActivateProp(),this._activateProp(),MusicManager.playEffect(MusicEffectFiles.Audio_G_useitem)},_unActivateModal:function(){this._touchListener.setEnabled(!1),this._unActivateProp(),this._bActivateModal=!1,this._maskImage.setOpacity(0),this._selectedPropItem&&this._selectedPropItem.onUnSelected(),this._selectedPropItem=null,this._delegate.onUnActivateProp()},_initTouchListener:function(){this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this._onTouchBegan.bind(this)}),cc.eventManager.addListener(this._touchListener,this),this._touchListener.setEnabled(!1)},_onTouchBegan:function(e,t){if(this._bActivateModal){var i=this._delegate.onPropModalLayerTouched(e);this._checkTriggerProp(i)}return!0},_checkTriggerProp:function(e){if(null!=this._selectedPropItem){var t=this._selectedPropItem.getItemId();switch(t){case RemoveLogic.we4Proto.ItemId.itemHammer:HammerProp.onCheckTrigger(e);break;case RemoveLogic.we4Proto.ItemId.itemStepInner:AddThreeStepProp.onCheckTrigger(e);break;case RemoveLogic.we4Proto.ItemId.itemSwap:SwapProp.onCheckTrigger(e);break;case RemoveLogic.we4Proto.ItemId.itemGlass:GlassesProp.onCheckTrigger(e);break;case RemoveLogic.we4Proto.ItemId.itemRearrange:RearrangeProp.onCheckTrigger(e);break;default:console.log("unKnown itemId : "+t)}}},_activateProp:function(){var e=this._selectedPropItem.getItemId();switch(e){case RemoveLogic.we4Proto.ItemId.itemHammer:HammerProp.onActivate(this);break;case RemoveLogic.we4Proto.ItemId.itemStepInner:AddThreeStepProp.onActivate(this);break;case RemoveLogic.we4Proto.ItemId.itemSwap:SwapProp.onActivate(this);break;case RemoveLogic.we4Proto.ItemId.itemGlass:GlassesProp.onActivate(this);break;case RemoveLogic.we4Proto.ItemId.itemRearrange:RearrangeProp.onActivate(this),RearrangeProp.onCheckTrigger(null);break;default:console.log("unKnown itemId : "+e)}},_unActivateProp:function(){if(null!=this._selectedPropItem){var e=this._selectedPropItem.getItemId();switch(e){case RemoveLogic.we4Proto.ItemId.itemHammer:HammerProp.onUnActivate();break;case RemoveLogic.we4Proto.ItemId.itemStepInner:AddThreeStepProp.onUnActivate();break;case RemoveLogic.we4Proto.ItemId.itemSwap:SwapProp.onUnActivate();break;case RemoveLogic.we4Proto.ItemId.itemGlass:GlassesProp.onUnActivate();break;case RemoveLogic.we4Proto.ItemId.itemRearrange:RearrangeProp.onUnActivate();break;default:console.log("unKnown itemId : "+e)}}},_onNetworkTipWindowCancel:function(){MaskWindow.Hide(),this._unActivateModal()},onTouchPropItem:function(e){if(this._bCanActivate&&!this._bPlayingAnimation&&!this._bPlayingPropAnimation){if(e.getCount()<=0)return this._unActivateModal(),void this._delegate.onPropUnEnough(e.getItemId());if(e.isOverLimit())return this._delegate.onPropOverUseLimit(e),void(this._selectedPropItem=null);if(this.setLocalZOrder(this._zOrderList[0]),null==this._selectedPropItem)return this._selectedPropItem=e,void this._activateModal();this._selectedPropItem!=e?this._selectedPropItem==e||this._unActivateModal():this._unActivateModal()}},onTryTriggerProp:function(e,t){HistoryRecord.isUsingHistory,"function"==typeof e&&e()},onTriggerPropSuccess:function(){if(null!=this._selectedPropItem){this._delegate.onTriggerPropSuccess(this._selectedPropItem),this._selectedPropItem.onUse(),this._selectedPropItem.getItemId()==RemoveLogic.we4Proto.ItemId.itemStepInner&&(this._stepInnerBgEffect&&this._stepInnerBgEffect.removeFromParent(),this._stepInnerBgEffect=null);var e=new StageUseItemRequest(GameProxy.getStageId(),this._selectedPropItem.getItemId());GameService.stageItemUse(e)}this._unActivateModal()},onTriggerPropFail:function(){this._delegate.onTriggerPropFail(this._selectedPropItem),this._unActivateModal()},onStartPlayAnimation:function(){this._bPlayingAnimation=!0},onAllAnimationsPlayComplete:function(){this._bPlayingAnimation=!1},onStartPlayPropAnimation:function(){this._bPlayingPropAnimation=!0},onPropAnimationPlayComplete:function(){this._bPlayingPropAnimation=!1},onPlayAdventureSuccessAnimation:function(){this._bCanActivate=!1},onAdventureFail:function(){this._bCanActivate=!1},onBuyPropSuccess:function(e){var t=e.id,i=this._propItemMap[t];null!=i?i.onAdd(e.count):console.log("can't find propItem")},onGuideAddThreeStep:function(){if(!GuideAuxiliaryData.isNeedGuide(GameProxy.getStageId())){var e=this._propItemMap[RemoveLogic.we4Proto.ItemId.itemStepInner];if(null!=e){if(!e.getUserData()){e.setUseEnable(!0),e.setUserData(!0);var t=new StepInnerBgEffect;t.setPosition(e.getPositionX()+10,e.getPositionY()-5),t.setScale(1.3),e.getParent().addChild(t,e.getLocalZOrder()-1),t.play(),this._stepInnerBgEffect=t}}}},onChessBoardStartScroll:function(){this._bPlayingAnimation=!0},onChessBoardScrollComplete:function(){this._bPlayingAnimation=!1},onExit:function(){this._super(),GlassesProp.destroy(),HammerProp.destroy(),RearrangeProp.destroy(),SwapProp.destroy(),AddThreeStepProp.destroy(),Util.unRegisterListeners(this._listenerList)}});
var RearrangeEffectWindow=WindowBase.extend({_completeCallBack:null,_effect:null,ctor:function(){this._super();var e=new RearrangeEffect;e.setPlayCompleteCallBack(this._onEffectPlayComplete.bind(this)),e.setPosition(UIHelper.getCenterPosition()),this.addChild(e),this._effect=e},_onEffectPlayComplete:function(){"function"==typeof this._completeCallBack&&this._completeCallBack(),RearrangeEffectWindow.Hide()},setCompleteCallBack:function(e){this._completeCallBack=e},onShowNotify:function(){this._effect.play()},onShow:function(){},onHideNotify:function(){},onHide:function(){},onDestroyNotify:function(){},onDestroy:function(){},onCover:function(){},onResume:function(){}});RearrangeEffectWindow.GetInstance=function(){return null==RearrangeEffectWindow._instance&&(RearrangeEffectWindow._instance=new RearrangeEffectWindow),RearrangeEffectWindow._instance},RearrangeEffectWindow.Show=function(e){var n=RearrangeEffectWindow.GetInstance();n.setCompleteCallBack(e),WindowManager.GetInstance().showWindow(n,null,!1,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,RearrangeEffectWindow.Destroy)},RearrangeEffectWindow.Hide=function(){WindowManager.GetInstance().hideWindow(RearrangeEffectWindow._instance)},RearrangeEffectWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(RearrangeEffectWindow._instance),RearrangeEffectWindow._instance=null};var RearrangeEffect=Effect.extend({ctor:function(){this._super(res.rearrange_json);var e=UIHelper.seekWidgetByName(this._node,"Panel_1",NodeType.PANEL);e.setBackGroundColorType(ccui.Layout.BG_COLOR_NONE);var n=UIHelper.createImage({imageFileName:res.mask_png,position:UIHelper.getCenterPosition(),scale:Math.max(cc.winSize.width/4,cc.winSize.height/4),opacity:180});n.setPosition(e.getContentSize().width/2,e.getContentSize().height/2),e.addChild(n)},play:function(){this._super(!1)}});
var RearrangeProp={_rearrangeCount:null,_rearrangeDataList:null,_delegate:null,_bTrigger:!1,destroy:function(){this._rearrangeCount=null,this._rearrangeDataList=null,this._delegate=null,this._bTrigger=!1},onActivate:function(e){this._delegate=e},onUnActivate:function(){this._delegate=null},onCheckTrigger:function(){this._bTrigger||this._delegate.onTryTriggerProp(function(){this._bTrigger=!0,puzzleGame.eventManager.trigger("START_PLAY_PROP_ANIMATION"),puzzleGame.input(new Input(RemoveLogic.we4Proto.InputOp.kOpUseItem,null,null,RemoveLogic.we4Proto.ItemId.itemRearrange)),eventDispatcher.dispatchEvent(EventID.ON_USE_PROP)}.bind(this),function(){this._bTrigger=!1,this._delegate.onTriggerPropFail()}.bind(this))},rearrangeChesses:function(e){this._rearrangeCount=0,this._rearrangeDataList=e,this._bTrigger||eventDispatcher.dispatchEvent(EventID.AUTO_REARRANGE_CHESS),eventDispatcher.dispatchEvent(EventID.ON_REARRANGE_CHESS_TIP_EFFECT_START_PLAY),MusicManager.playEffect(MusicEffectFiles.Audio_G_rearrangement),RearrangeEffectWindow.Show(function(){AnimationManager.onRearrangeChessTipEffectPlayComplete(),this._delegate&&this._delegate.onTriggerPropSuccess();for(var t=0,r=e.length;t<r;t++){null!=ChessBoardHelper.onRearrangeChess(e[t].chessData,e[t].targetGridPosition,this._onRearrangeChessComplete.bind(this))&&this._rearrangeCount++}}.bind(this))},_onRearrangeChessComplete:function(){if(this._rearrangeCount--,0==this._rearrangeCount){for(var e=0,t=this._rearrangeDataList.length;e<t;e++)ChessBoardHelper.onResetChess(this._rearrangeDataList[e].chessData);this._bTrigger=!1,puzzleGame.eventManager.trigger("PROP_ANIMATION_PLAY_COMPLETE"),AnimationManager.onAllChessRearrangeComplete(),eventDispatcher.dispatchEvent(EventID.ON_REARRANGE_CHESS_COMPLETE)}}};
var SwapProp={_firstChess:null,_secondChess:null,_from:null,_to:null,_delegate:null,_bTrigger:!1,destroy:function(){this._firstChess=null,this._secondChess=null,this._from=null,this._to=null,this._bTrigger=!1},onActivate:function(e){this._delegate=e},onUnActivate:function(){this._firstChess=null,this._secondChess=null,this._from=null,this._to=null,AnimationManager.onTriggerSwapPropFail()},onCheckTrigger:function(e){if(!this._bTrigger)if(null!=e){var i=e.getTopFeaturesChess();if(null!=i)if(i.getLogicOrder()==GameDataConfig.ChessLogicOrder.ORDER_2)if(i!=this._firstChess)if(i.getChessType()==RemoveLogic.we4Proto.ChessType.CT_SpecialGas||i.getColorType()!=RemoveLogic.we4Proto.ChessColor.kChessColorNone){if(null==this._firstChess){this._firstChess=i,this._from=i.getGridPosition();var t={};return t.viewRoot=this._delegate.getGrid(),t.position=i.getPosition(),AnimationManager.playSwapPropApertureEffect(t),void MusicManager.playEffect(MusicEffectFiles.Audio_G_exchange1)}null==this._secondChess&&this._delegate.onTryTriggerProp(function(){this._secondChess=i,this._to=i.getGridPosition();(e={}).viewRoot=this._delegate.getGrid(),e.position=i.getPosition(),AnimationManager.playSwapPropApertureEffect(e);var e;(e={}).viewRoot=this._delegate.getGrid(),e.firstPosition=this._firstChess.getPosition(),e.secondPosition=this._secondChess.getPosition(),this._bTrigger=!0,puzzleGame.eventManager.trigger("START_PLAY_PROP_ANIMATION"),MusicManager.playEffect(MusicEffectFiles.Audio_G_exchange2),AnimationManager.playSwapPropFlashOfLightEffect(e,function(){ChessBoardHelper.onTriggerSwapProp(this._firstChess,this._secondChess)}.bind(this),function(){var e=new Input(RemoveLogic.we4Proto.InputOp.kOpUseItem,this._from,this._to,RemoveLogic.we4Proto.ItemId.itemSwap);puzzleGame.input(e,function(e){e?(eventDispatcher.dispatchEvent(EventID.ON_USE_PROP),this._delegate.onTriggerPropSuccess()):this._delegate.onTriggerPropFail()}.bind(this))}.bind(this),function(){this._bTrigger=!1,puzzleGame.eventManager.trigger("PROP_ANIMATION_PLAY_COMPLETE")}.bind(this))}.bind(this),function(){this._bTrigger=!1,this._delegate.onTriggerPropFail()}.bind(this))}else this._delegate.onTriggerPropFail();else this._delegate.onTriggerPropFail();else this._delegate.onTriggerPropFail();else this._delegate.onTriggerPropFail()}else this._delegate.onTriggerPropFail()}};
var SodaBubble=ccui.Layout.extend({_chessGridWidth:0,_chessGridHeight:0,_chessBoardRow:0,_chessBoardCol:0,_preRow:0,_contentView:null,_contentViewRoot:null,_chessGridData:null,ctor:function(e){this._super(),SodaBubble._instance=this,this._preRow=0,this._chessGridWidth=e.chessGridSize.width,this._chessGridHeight=e.chessGridSize.height,this._chessBoardRow=e.chessBoardRow,this._chessBoardCol=e.chessBoardCol,this._chessGridData=e.chessGridData,this.setClippingEnabled(!0),this.setAnchorPoint(e.anchorPoint),this.setScale(puzzleGame.GetScale()),this.setContentSize(e.size),this.setPosition(cc.pAdd(e.position,puzzleGame.GetScalePositionAdd())),this._contentViewRoot=new ccui.Layout,this._contentViewRoot.setPosition(GameDataConfig.CHESS_BOARD_MASK_EXTEND/2,GameDataConfig.CHESS_BOARD_MASK_EXTEND/2),this._contentViewRoot.setContentSize(e.viewportCol*this._chessGridWidth,e.viewportRow*this._chessGridHeight),this._contentViewRoot.setClippingEnabled(!0),this.addChild(this._contentViewRoot);var t=(e.viewportRow-e.chessBoardRow)*e.chessGridSize.height;this._contentView=new cc.Node,this._contentView.setPositionY(t),this._contentViewRoot.addChild(this._contentView)},scroll:function(e,t,i){if(t<=0)return this._contentViewRoot.setClippingEnabled(!0),void("function"==typeof i&&i());var o=new cc.MoveBy(t,cc.p(0,e.y)),s=new cc.CallFunc(function(){this._contentViewRoot.setClippingEnabled(!0),"function"==typeof i&&i()}.bind(this)),n=new cc.Sequence(o,s);this._contentView.runAction(n),this._contentViewRoot.setClippingEnabled(!1)},onUpdateBubble:function(e,t,i){for(var o=this._preRow;o<e;o++)for(var s=i[t-o-1],n=Util.getRandom(2,4),c=0;c<n;c++){var h=Util.getRandom(0,this._chessBoardCol-1);if(0!=s[h].viewStatus){var a=cc.p(this._chessGridWidth*(h+1-.5),this._chessGridHeight*(o+1-.5)),d=new Effect(res.waveebubbleffects_json);d.setPosition(a),d.play(!0),this._contentView.addChild(d)}}this._preRow=e},onResetBubble:function(){this._contentView.removeAllChildren(),this._preRow=0}});SodaBubble.onUpdateBubble=function(e,t,i){SodaBubble._instance&&SodaBubble._instance.onUpdateBubble(e,t,i)},SodaBubble.onResetBubble=function(){SodaBubble._instance&&SodaBubble._instance.onResetBubble()};
var SodaWater=ccui.Layout.extend({_chessGridWidth:0,_chessGridHeight:0,_chessBoardRow:0,_chessBoardCol:0,_animationCount:0,_chessGridData:null,_effectView:null,_contentView:null,_contentViewRoot:null,_animationUpdate:null,_action:null,_currentRow:0,_preRow:0,_startRow:0,ctor:function(t){this._super(),this.setClippingEnabled(!0),this.setAnchorPoint(t.anchorPoint),this.setScale(puzzleGame.GetScale()),this.setContentSize(t.size),this.setPosition(cc.pAdd(t.position,puzzleGame.GetScalePositionAdd())),this._chessGridWidth=t.chessGridSize.width,this._chessGridHeight=t.chessGridSize.height,this._chessBoardCol=t.chessBoardCol,this._preRow=0,this._contentViewRoot=new ccui.Layout,this._contentViewRoot.setPosition(GameDataConfig.CHESS_BOARD_MASK_EXTEND/2,GameDataConfig.CHESS_BOARD_MASK_EXTEND/2),this._contentViewRoot.setContentSize(t.viewportCol*this._chessGridWidth,t.viewportRow*this._chessGridHeight),this._contentViewRoot.setClippingEnabled(!0),this.addChild(this._contentViewRoot);var i=(t.viewportRow-t.chessBoardRow)*t.chessGridSize.height;this._contentView=new cc.Node,this._contentView.setPositionY(i),this._contentViewRoot.addChild(this._contentView),this._getGridInfo(t),this._animationUpdate=new UpdateProxy(this._animationOnUpdate.bind(this)),this._animationUpdate.start()},scroll:function(t,i,e){if(i<=0)return this._contentViewRoot.setClippingEnabled(!0),void("function"==typeof e&&e());var s=new cc.MoveBy(i,cc.p(0,t.y)),o=new cc.CallFunc(function(){this._contentViewRoot.setClippingEnabled(!0),"function"==typeof e&&e()}.bind(this)),n=new cc.Sequence(s,o);this._contentView.runAction(n),this._contentViewRoot.setClippingEnabled(!1)},_initWater:function(){this._initWaterEffect(),this._currentRow>0?this._animationCount++:this._currentRow=0},_initWaterEffect:function(){if(!this._effectView){this._effectView=UIHelper.createPanel({anchorPoint:cc.p(0,0),position:cc.p(0,0),size:cc.size(this._chessGridWidth*this._chessBoardCol,this._chessGridHeight)}),this._contentView.addChild(this._effectView);for(var t=0;t<this._chessBoardCol;t++){var i=cc.p(this._chessGridWidth*t,this._chessGridHeight*(this._startRow-1)),e=new SodaWaterEffect(this._chessGridWidth,this._chessGridHeight,i);e.setTag(t),e.setOpacity(0),this._effectView.addChild(e)}}},_animationOnUpdate:function(t){if(!(this._animationCount<=0||this._action&&!this._action.isDone())){var i=this._chessBoardRow-1;if(this._currentRow-1>i&&this._preRow<i&&(this._currentRow=i+1),this._currentRow-1<=i){var e=this._chessGridData[this._chessBoardRow-this._currentRow],s=this._currentRow+this._startRow;this._updateWaterEffect(e),this._updateWater(s),SodaBubble.onUpdateBubble(s,this._chessBoardRow,this._chessGridData)}this._animationCount=0,this._animationUpdate.pause()}},_updateWaterEffect:function(t){for(var i=0;i<this._effectView.childrenCount;i++){var e=t[i],s=this._effectView.getChildByTag(i);0==e.viewStatus?s.setOpacity(0):s.setOpacity(255),s.isShowEffect(!0)}var o=cc.moveTo(.25,cc.p(this._effectView.getPositionX(),this._chessGridHeight*this._currentRow-1));this._action=this._effectView.runAction(o)},_updateWater:function(t){if(!(t-1<=0)){var i=t-this._preRow-1,e=UIHelper.createPanel({anchorPoint:cc.p(0,0),position:cc.p(0,this._preRow*this._chessGridHeight),size:cc.size(this._chessGridWidth*this._chessBoardCol,this._chessGridHeight*i)});e.setScale(1,0),this._contentView.addChild(e);for(var s=0;s<i;s++)for(var o=this._chessGridData[this._chessBoardRow-this._preRow-s-1],n=0;n<this._chessBoardCol;n++){if(0!=o[n].viewStatus){var h=UIHelper.createImage({imageFileName:"obstacle/wave/wave_middle.png",bPlistTexture:!0,anchorPoint:cc.p(0,0),position:cc.p(this._chessGridWidth*n+1,this._chessGridHeight*s),opacity:89});h.setScaleX(this._chessGridWidth/h.getContentSize().width),h.setScaleY(this._chessGridHeight/h.getContentSize().height),e.addChild(h)}}var a=cc.scaleTo(.25,1,1);e.runAction(a),this._preRow=t-1}},_getGridInfo:function(t){for(var i=t.chessGridData,e=0,s=0;s<i.length;s++){for(var o=i[s],n=!1,h=0;h<o.length;h++)if(1===o[h].viewStatus){n=!0;break}if(n)break;i.shift(),e++}for(s=i.length-1;s>=0;s--){for(o=i[s],n=!1,h=0;h<o.length;h++)if(1===o[h].viewStatus){n=!0;break}if(n)break;i.pop(),e++,this._startRow++}this._currentRow=t.chessBoardRow-t.waterLine,this._chessBoardRow=t.chessBoardRow-e,this._chessGridData=i,this._initWater()},onResetWater:function(){this._currentRow=0,this._preRow=0,this._contentView.removeAllChildren(),this._effectView=null,this._initWaterEffect(),SodaBubble.onResetBubble()},onWaterLineRise:function(){this._animationCount++,this._currentRow++,this._animationUpdate&&this._animationUpdate.resume()},destroy:function(){this._animationUpdate.release(),this._animationUpdate=null}});
var SodaWaterEffect=cc.Node.extend({_effect:null,ctor:function(e,t,i){this._super(),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0),this.setContentSize(e,t),this.setPosition(i);var c=cc.p(.5*e,t*(50/t)),s=new Effect(res.waveeffectstop1_json);s.setPosition(c),s.play(!0,Util.getRandom(0,10)),this.addChild(s);var f=cc.p(.5*e,t*(50/t));this._effect=new Effect(res.waveeffectstop2_json);var a=cc.fadeOut(.01);this._effect.runAction(a),this._effect.setPosition(f),this._effect.play(!0,Util.getRandom(0,10)),this.addChild(this._effect),this._effect.setOpacity(0);var n=UIHelper.createImage({imageFileName:"obstacle/wave/wave_middle.png",bPlistTexture:!0,anchorPoint:cc.p(0,0),position:cc.p(0,1),opacity:89}),o=t*(55/t);n.setScaleX(e/n.getContentSize().width),n.setScaleY(o/n.getContentSize().height),this.addChild(n)},isShowEffect:function(e){if(e){this._effect.setOpacity(255);var t=cc.fadeIn(.02);this._effect.runAction(t),Timeout.register(this._scaleEffect.bind(this),250)}else this._effect.setOpacity(0)},_scaleEffect:function(){var e=cc.fadeOut(.15);this._effect.runAction(e),Timeout.register(this._closeEffect.bind(this),400)},_closeEffect:function(){this._effect.setOpacity(0)}});
var Boundary={left:1,right:2},Direction={leftToRight:1,rightToLeft:2,topToBottom:3,bottomToTop:4},SortViewGroup=cc.Class.extend({_viewList:null,_sortDirection:null,_viewHorizontalSpacing:null,_midX:null,ctor:function(){this._viewList=[],this._viewHorizontalSpacing=0,this._sortDirection=Direction.leftToRight},getViewCount:function(){return null!=this._viewList?this._viewList.length:0},setSortDirection:function(t){this._sortDirection=t},getSortDirection:function(){return this._sortDirection},setViewHorizontalSpacing:function(t){this._viewHorizontalSpacing=t},getViewHorizontalSpacing:function(){return this._viewHorizontalSpacing},setMidX:function(t){this._midX=t},getMidX:function(){return this._midX},addView:function(t){this._viewList.push(t)},getViewList:function(){return this._viewList},removeAllView:function(){this._viewList=[]},insertView:function(t,i){this._viewList[i]=t},sort:function(){this._sortViewsPosition(this._viewList,this._viewHorizontalSpacing,this._midX,this._sortDirection)},offsetX:function(t){if(null!=t)if("number"==typeof t){if(0!=t)for(var i in this._viewList){var e=this._viewList[i],n=e.getPositionX();e.setPositionX(n+t)}}else console.log("offsetValue type error")},setX:function(t){if(null!=t)if("number"==typeof t){var i=t-this.getLeftX();this.offsetX(i)}else console.log("offsetValue type error")},getWidth:function(){var t=0;for(var i in this._viewList){t+=this._viewList[i].getContentSize().width*this._viewList[i].getScaleX()+this._viewHorizontalSpacing}return t-=this._viewHorizontalSpacing},getLeftX:function(){var t=this._viewList[0];return this._getX(Boundary.left,t)},getRightX:function(){var t=this._viewList[this._viewList.length-1];return this._getX(Boundary.right,t)},_getX:function(t,i){if(null==i||null==i.getParent())return null;var e=i.getParent().convertToWorldSpaceAR(i.getPosition()).x,n=i.getContentSize().width,o=i.getAnchorPoint().x,r=i.getScaleX();switch(t){case Boundary.left:return e-n*o*r;case Boundary.right:return e+n*(1-o)*r}return null},_sortViewsPosition:function(t,i,e,n){if(null!=t&&0!=t.length)if(1!=t.length){var o=(n=n||Direction.leftToRight)==Direction.leftToRight?0:t.length-1,r=t[0].getParent();if(null!=r){for(var s=1;s<t.length;s++)if(t[s].getParent()!==r)return void console.log("parent not same");i=i||0;var l=0;l=v(t[o],l,n);var g=t.length;if(Direction.leftToRight==n)for(s=1;s<g;s++)w(t[s],l,n),l=v(t[s],l,n);else if(Direction.rightToLeft==n)for(s=g-2;s>=0;s--)w(t[s],l,n),l=v(t[s],l,n);if(null!=e){var h=0;for(var s in t){h+=t[s].getBoundingBox().width+i}h-=i;var f=t[0],u=f.getAnchorPoint(),c=e-(f.getPositionX()-f.getBoundingBox().width*u.x+h/2);for(var s in t)t[s].setPositionX(t[s].getPositionX()+c)}}else console.log("parent is null")}else if(null!=e){var a=t[0];a.setPositionX(e-(.5-a.getAnchorPoint().x)*a.getBoundingBox().width)}function v(t,e,n){var o=t.getPosition(),r=t.getBoundingBox().width,s=t.getAnchorPoint();return Direction.leftToRight==n?e=o.x+r*(1-s.x)+i:Direction.rightToLeft==n&&(e=o.x-r*s.x-i),e}function w(t,i,e){var n=t.getBoundingBox().width,o=t.getAnchorPoint(),r=0;Direction.leftToRight==e?r=i+n*o.x:Direction.rightToLeft==e&&(r=i-n*(1-o.x)),t.setPositionX(r)}}});
var ReadyGoWindow=WindowBase.extend({_effect:null,_completeCallBack:null,ctor:function(){this._super();var n=new Effect(res.guideplayer_json);n.setPosition(cc.winSize.width/2,0),n.setPlayCompleteCallBack(this._onEffectPlayComplete.bind(this)),this.addChild(n),this._effect=n},setCompleteCallBack:function(n){this._completeCallBack=n},_onEffectPlayComplete:function(){var n=new cc.FadeOut(.5),e=new cc.CallFunc(function(){ReadyGoWindow.Hide(),"function"==typeof this._completeCallBack&&this._completeCallBack(),eventDispatcher.dispatchEvent(EventID.ON_READY_GO_EFFECT_COMPLETE)}.bind(this)),o=new cc.Sequence(n,e);this._effect.runAction(o)},onShowNotify:function(){this._effect.setOpacity(255),this._effect.play(!1),MusicManager.playEffect(MusicEffectFiles.Audio_V_ready)},onShow:function(){},onHideNotify:function(){},onHide:function(){},onDestroyNotify:function(){},onDestroy:function(){},onCover:function(){},onResume:function(){}});ReadyGoWindow.GetInstance=function(){return null==ReadyGoWindow._instance&&(ReadyGoWindow._instance=new ReadyGoWindow),ReadyGoWindow._instance},ReadyGoWindow.Show=function(n){var e=ReadyGoWindow.GetInstance();e.setCompleteCallBack(n),WindowManager.GetInstance().showWindow(e,null,!1,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,ReadyGoWindow.Destroy)},ReadyGoWindow.Hide=function(){WindowManager.GetInstance().hideWindow(ReadyGoWindow._instance)},ReadyGoWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(ReadyGoWindow._instance),ReadyGoWindow._instance=null};
var StepTip=cc.Layer.extend({_surplusStep:null,ctor:function(){this._super()},setSurplusStep:function(e){this._surplusStep=e},onShow:function(){var e=res.guideplayer5steps_json;switch(this._surplusStep){case 5:e=res.guideplayer5steps_json,MusicManager.playEffect(MusicEffectFiles.Audio_UI_step5);break;case 10:e=res.guideplayer10steps_json,MusicManager.playEffect(MusicEffectFiles.Audio_UI_step10)}var t=AnimationCacheManager.getEffect(EffectCacheType.STEP_TIP,{tag:e}).effect;null==t&&(console.log("step effect is null"),t=new Effect(e)),t.setPosition(0,cc.winSize.height/2),t.setOpacity(255),t.setPlayCompleteCallBack(function(){AnimationCacheManager.cacheEffect(EffectCacheType.STEP_TIP,t),t.removeFromParent()}.bind(this)),null==t.getParent()&&this.addChild(t),t.play(!1)}});StepTip.GetInstance=function(){return null==StepTip._instance&&(StepTip._instance=new StepTip),StepTip._instance},StepTip.Show=function(e){var t=StepTip.GetInstance();t.setSurplusStep(e),t.onShow(),null==t.getParent()&&cc.director.getRunningScene().addChild(t,GameCommonDef.LAYER_Z_ORDER_POP_UP)},StepTip.Destroy=function(){StepTip._instance&&StepTip._instance.removeFromParent(),StepTip._instance=null};
var SwapChessTip=cc.Node.extend({_touchListener:null,_chessBoard:null,_timeHandler:null,_time:null,_bCanCountDown:null,_bCanStartTimer:null,_tipAudio:null,ctor:function(n){this._super(),this._bCanStartTimer=!1,this._bCanCountDown=!0,this._time=6e3,this._chessBoard=n,this.setContentSize(GameCommonDef.DESIGN_RESOLUTION_SIZE),this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!1,onTouchBegan:this._onTouchBegan.bind(this),onTouchMoved:this._onTouchMoved.bind(this),onTouchEnded:this._onTouchEnded.bind(this),onTouchCancelled:this._onTouchCancelled.bind(this)}),cc.eventManager.addListener(this._touchListener,this)},_startCountDown:function(){this._bCanCountDown&&(this._stopCountDown(),this._startTimer())},_startTimer:function(){this._bCanStartTimer&&(this._timeHandler=Timeout.register(function(){var n=this;puzzleGame.findActive([],[],function(t,o){o.push(t[0]),2==t.length&&n._chessBoard.onTipSwapChess(t[0],t[1],o)})}.bind(this),this._time))},_stopCountDown:function(){clearTimeout(this._timeHandler),this._timeHandler=null,AnimationManager.hideGuideSwapChessEffect()},_onTouchBegan:function(n,t){return this._stopCountDown(),!0},_onTouchMoved:function(n,t){},_onTouchEnded:function(n,t){this._startCountDown()},_onTouchCancelled:function(n,t){},onChessBoardStartScroll:function(){this._bCanCountDown=!1,this._stopCountDown()},onChessBoardScrollComplete:function(){this._bCanCountDown=!0,this._startCountDown()},onStartPlayAnimation:function(){this._bCanCountDown=!1,this._stopCountDown()},onAllAnimationsPlayComplete:function(){this._bCanCountDown=!0,this._startCountDown()},onStartPlayPropAnimation:function(){this._bCanCountDown=!1,this._stopCountDown()},onPropAnimationPlayComplete:function(){this._bCanCountDown=!0,this._startCountDown()},onAdventureSuccess:function(){this._bCanCountDown=!1,this._stopCountDown()},onAdventureFail:function(){this._bCanCountDown=!1,this._stopCountDown()},onTurnToSuccessState:function(){this._bCanCountDown=!1,this._stopCountDown()},onTurnToFailState:function(){this._bCanCountDown=!1,this._stopCountDown()},onRespawn:function(){this._bCanCountDown=!0,this._startCountDown()},start:function(){this._bCanStartTimer=!0,this._startCountDown()},onExit:function(){this._super(),clearTimeout(this._timeHandler),this._timeHandler=null}});
var NetworkRetryWindow=WindowBase.extend({_content:null,_contentText:null,_maxWidth:null,_cancelButtonTouchedCallBackList:null,_retryButtonTouchedCallBackList:null,_sureButtonTouchedCallBackList:null,_bShow:!1,_cancelButton:null,_sureButton:null,_retryButton:null,_bSingleButtonModel:!1,ctor:function(){this._super(),this._cancelButtonTouchedCallBackList=[],this._retryButtonTouchedCallBackList=[],this._sureButtonTouchedCallBackList=[];var t=cc.size(555,390);this._maxWidth=t.width-40;var e=UIHelper.createImage({imageFileName:"bg_dialog.png",bPlistTexture:!0,bScale9Enabled:!0,size:t,capInsets:cc.rect(0,72,512,22),position:UIHelper.getPosition(320,570)});this.addChild(e);(o=UIHelper.createButton({normalFile:"m_green_btn.png",bPlistTexture:!0,bPressedActionEnabled:!0,position:cc.p(.7*t.width,50),bTouchEnable:!0})).addTouchEventListener(this._onCancelButtonTouched,this),e.addChild(o),this._cancelButton=o;var n=UIHelper.createImage({imageFileName:"btn_title_cancel.png",bPlistTexture:!0,position:cc.p(o.getContentSize().width/2,o.getContentSize().height/2+10)});o.addChild(n);(o=UIHelper.createButton({normalFile:"m_red_btn.png",bPlistTexture:!0,bPressedActionEnabled:!0,position:cc.p(.3*t.width,50),bTouchEnable:!0})).addTouchEventListener(this._onRetryButtonTouched,this),e.addChild(o),this._retryButton=o;n=UIHelper.createImage({imageFileName:"btn_title_retry.png",bPlistTexture:!0,position:cc.p(o.getContentSize().width/2,o.getContentSize().height/2+10)});o.addChild(n);var o;(o=UIHelper.createButton({normalFile:"m_red_btn.png",bPlistTexture:!0,bPressedActionEnabled:!0,position:cc.p(.5*t.width,50),bTouchEnable:!0})).addTouchEventListener(this._onSureButtonTouched,this),e.addChild(o),this._sureButton=o;n=UIHelper.createImage({imageFileName:"btn_title_sure.png",bPlistTexture:!0,position:cc.p(o.getContentSize().width/2,o.getContentSize().height/2+10)});o.addChild(n);n=UIHelper.createText({position:cc.p(t.width/2,230),fontSize:28,fontColor:cc.color(255,255,255),content:"",bIgnoreSize:!0});e.addChild(n),this._contentText=n},isShow:function(){return this._bShow},setSingleButtonModel:function(t){this._bSingleButtonModel=t},pushCancelButtonTouchedCallBack:function(t,e){this._cancelButtonTouchedCallBackList.push({fun:t,param:e})},pushRetryButtonTouchedCallBack:function(t,e){this._retryButtonTouchedCallBackList.push({fun:t,param:e})},pushSureButtonTouchedCallBack:function(t,e){this._sureButtonTouchedCallBackList.push({fun:t,param:e})},_onCancelButtonTouched:function(t,e){if(ccui.Widget.TOUCH_ENDED==e){NetworkRetryWindow.Hide(),eventDispatcher.dispatchEvent(EventID.ON_NETWORK_TIP_WINDOW_CANCEL);var n=this._cancelButtonTouchedCallBackList.concat();this._cancelButtonTouchedCallBackList=[],this._retryButtonTouchedCallBackList=[];for(var o=0,i=n.length;o<i;o++){var c=n[o].fun,a=n[o].param;"function"==typeof c&&c(a)}}},_onRetryButtonTouched:function(t,e){if(ccui.Widget.TOUCH_ENDED==e){NetworkRetryWindow.Hide(),eventDispatcher.dispatchEvent(EventID.ON_NETWORK_TIP_WINDOW_RETRY);var n=this._retryButtonTouchedCallBackList.concat();this._cancelButtonTouchedCallBackList=[],this._retryButtonTouchedCallBackList=[];for(var o=0,i=n.length;o<i;o++){var c=n[o].fun,a=n[o].param;"function"==typeof c&&c(a)}}},_onSureButtonTouched:function(t,e){if(ccui.Widget.TOUCH_ENDED==e){NetworkRetryWindow.Hide(),eventDispatcher.dispatchEvent(EventID.ON_NETWORK_TIP_WINDOW_CANCEL);var n=this._sureButtonTouchedCallBackList.concat();this._sureButtonTouchedCallBackList=[];for(var o=0,i=n.length;o<i;o++){var c=n[o].fun,a=n[o].param;"function"==typeof c&&c(a)}}},setContent:function(t){this._content=t},onShowNotify:function(){this._retryButton.setVisible(!this._bSingleButtonModel),this._cancelButton.setVisible(!this._bSingleButtonModel),this._sureButton.setVisible(this._bSingleButtonModel),eventDispatcher.dispatchEvent(EventID.ON_NETWORK_TIP_WINDOW_SHOW),this._bShow=!0,null!=this._content&&UIHelper.subsectionTextForUIText(this._contentText,this._content,this._maxWidth),this._content=null},onShow:function(){},onHideNotify:function(){this._bShow=!1},onHide:function(){},onDestroyNotify:function(){this._bShow=!1},onDestroy:function(){},onCover:function(){},onResume:function(){}});NetworkRetryWindow.GetInstance=function(){return null==NetworkRetryWindow._instance&&(NetworkRetryWindow._instance=new NetworkRetryWindow),NetworkRetryWindow._instance},NetworkRetryWindow.Show=function(t,e,n,o,i){var c=NetworkRetryWindow.GetInstance();if(c.setSingleButtonModel(!1),c.setContent(t),c.pushCancelButtonTouchedCallBack(n,i),c.pushRetryButtonTouchedCallBack(e,o),!c.isShow()){var a=WindowAction.getScaleEaseElasticOutAction(c);WindowManager.GetInstance().showWindow(c,a,!1,GameCommonDef.LAYER_Z_ORDER_RETRY_WINDOW,!1,null,null,NetworkRetryWindow.Destroy)}},NetworkRetryWindow.ShowSureButton=function(t,e,n){var o=NetworkRetryWindow.GetInstance();if(o.setSingleButtonModel(!0),o.setContent(t),o.pushSureButtonTouchedCallBack(e,n),!o.isShow()){var i=WindowAction.getScaleEaseElasticOutAction(o);WindowManager.GetInstance().showWindow(o,i,!1,GameCommonDef.LAYER_Z_ORDER_RETRY_WINDOW,!1,null,null,NetworkRetryWindow.Destroy)}},NetworkRetryWindow.Hide=function(){WindowManager.GetInstance().hideWindow(NetworkRetryWindow._instance)},NetworkRetryWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(NetworkRetryWindow._instance),NetworkRetryWindow._instance=null};
var AboutUsWindow=WindowBase.extend({ctor:function(){this._super(),this._initUI()},_initUI:function(){var t=this.width/720,n=this.height/1136,i=Math.max(n,t),o=UIHelper.createPanel({anchorPoint:cc.p(.5,.5),position:cc.p(.5*this.width,.5*this.height),size:cc.size(720,1136),backgroundImage:"res/pages/setting/about_us_bg.jpg",bTouchEnable:!0});o.setScale(i),this.addChild(o),o.addTouchEventListener(this._onBackButtonTouched,this);var e=new cc.Sprite;e.initWithSpriteFrameName("about_us_title.png"),e.setPosition(cc.p(.5*this.width,.9*this.height));var s=UIHelper.createText({position:cc.p(.5*e.width,-60),anchorPoint:cc.p(.5,0),fontSize:30,fontColor:cc.color("#835335"),content:NetData.user_info.nickname});e.addChild(s);var c=new cc.Sprite;c.initWithSpriteFrameName("about_us_tips.png"),c.setPosition(cc.p(s.getPosition().x,s.getPosition().y-30)),e.addChild(c),this.addChild(e);var a=new cc.Sprite;a.initWithSpriteFrameName("about_us_footer.png"),a.setPosition(cc.p(.5*this.width,80)),this.addChild(a)},onShowNotify:function(){},onShow:function(){},onHideNotify:function(){},onHide:function(){},onDestroyNotify:function(){},onDestroy:function(){},onCover:function(){},onResume:function(){},_onBackButtonTouched:function(t,n){ccui.Widget.TOUCH_ENDED==n&&(MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),AboutUsWindow.Destroy())}});AboutUsWindow.GetInstance=function(){return null==AboutUsWindow._instance&&(AboutUsWindow._instance=new AboutUsWindow),AboutUsWindow._instance},AboutUsWindow.Show=function(){ResLoader.showSubResLoadingWindow(ResObjects.getResObject(ResObjectConfig.setting),function(){var t=AboutUsWindow.GetInstance();WindowManager.GetInstance().showWindow(t,null,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,AboutUsWindow.Destroy)})},AboutUsWindow.Hide=function(){WindowManager.GetInstance().hideWindow(AboutUsWindow._instance)},AboutUsWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(AboutUsWindow._instance),AboutUsWindow._instance=null};
var AcceptWindow=WindowBase.extend({_content:null,_contentText:null,_title:null,_titleText:null,_imgRes:null,_imgSprite:null,_maxWidth:null,_sureButtonTouchedCallBack:null,_rootNode:null,_bgView:null,ctor:function(){this._super();var t=cc.size(488,470);this._maxWidth=t.width-40;var e=UIHelper.createImage({imageFileName:"bg_dialog.png",bPlistTexture:!0,bScale9Enabled:!0,size:t,capInsets:cc.rect(0,72,512,22),position:UIHelper.getPosition(320,546)});this.addChild(e);var n=UIHelper.createButton({normalFile:"m_green_btn.png",bPlistTexture:!0,bPressedActionEnabled:!0,position:cc.p(t.width/2,50),bTouchEnable:!0});n.addTouchEventListener(this._onSureButtonTouched,this),e.addChild(n,0,10);var i=new cc.Sprite;i.initWithSpriteFrameName("m_word_get.png"),i.setPosition(85,33),n.addChild(i,1),n=UIHelper.createText({position:cc.p(t.width/2,428),fontSize:30,fontColor:cc.color(255,255,255),content:"",bIgnoreSize:!0}),e.addChild(n),this._titleText=n,n=UIHelper.createText({position:cc.p(t.width/2,182),fontSize:28,fontColor:cc.color(255,255,255),content:"",bIgnoreSize:!0}),e.addChild(n),this._contentText=n;var o=ccs.load(res.message_json,GameDataConfig.EFFECT_ROOT_PATH);o?(o.node.setPosition(t.width/2,280),e.addChild(o.node,0),this._rootNode=o.node):console.log("null == root.node"),o.node.stopAllActions(),o.node.runAction(o.action),o.action.gotoFrameAndPlay(0,o.action.getDuration(),0,!0);var c=new cc.Sprite;c.initWithSpriteFrameName("prop_swap.png"),c.setAnchorPoint(.5,.5),c.setPosition(314,600),e.addChild(c,0),this._imgSprite=c,this._bgView=e},setSureButtonTouchedCallBack:function(t){this._sureButtonTouchedCallBack=t},_onSureButtonTouched:function(t,e){ccui.Widget.TOUCH_ENDED==e&&("function"==typeof this._sureButtonTouchedCallBack&&this._sureButtonTouchedCallBack(),AcceptWindow.Hide(),AcceptWindow.Destroy())},setContent:function(t,e,n){this._title=t,this._content=e,this._imgRes=n},onShowNotify:function(){null!=this._content&&null!=this._titleText&&(UIHelper.subsectionTextForUIText(this._contentText,this._content,this._maxWidth),UIHelper.subsectionTextForUIText(this._titleText,this._title,this._maxWidth)),this._content=null,this._title=null,this._imgSprite&&(this._imgSprite.removeFromParent(!0),this._imgSprite=null);var t=new cc.Sprite;t.initWithSpriteFrameName(this._imgRes),t.setAnchorPoint(.5,.5);var e=this._titleText.getPosition();t.setPosition(e.x,e.y-140),this._bgView.addChild(t,0),this._imgSprite=t},onShow:function(){},onHideNotify:function(){},onHide:function(){},onDestroyNotify:function(){},onDestroy:function(){this._rootNode&&this._rootNode.stopAllActions()},onCover:function(){},onResume:function(){}});AcceptWindow.GetInstance=function(){return null==AcceptWindow._instance&&(AcceptWindow._instance=new AcceptWindow),AcceptWindow._instance},AcceptWindow.Show=function(t,e,n,i){var o=AcceptWindow.GetInstance();o.setContent(t,e,n),o.setSureButtonTouchedCallBack(i);var c=WindowAction.getScaleEaseElasticOutAction(o);WindowManager.GetInstance().showWindow(o,c,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,AcceptWindow.Destroy)},AcceptWindow.Hide=function(){WindowManager.GetInstance().hideWindow(AcceptWindow._instance)},AcceptWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(AcceptWindow._instance),AcceptWindow._instance=null};
var ClearanceFriend=cc.Node.extend({_bgView:null,ctor:function(){this._super();var e=UIHelper.createImage({imageFileName:"bg_clearance_friend.png",bPlistTexture:!0});this.addChild(e),this._bgView=e},showClearanceFriend:function(e){if(null!=e&&0!=e.length){var t=new SortViewGroup;this._bgView.removeAllChildren();for(var i=0,a=e.length;i<a;i++){var n=new ClearanceFriendItem(e[i]);n.setDelegate(this),n.setPositionY(20),this._bgView.addChild(n),t.addView(n)}var r=t.getViewList(),o=r.length,l=r[0];if(l.setPositionX(20),1!=o){var c=(this._bgView.getContentSize().width-40-l.getContentSize().width*o)/(o-1);t.setViewHorizontalSpacing(c),t.sort()}}},onHeadImageTouched:function(e){e.isPlayer()||e.isProhibitTakeHeart()||e.isTakeHeart()||console.log("take heart")}}),ClearanceFriendItem=cc.Node.extend({_takeHeartView:null,_delegate:null,_bTakeHeart:!1,_clearanceFriendData:null,ctor:function(e){this._super(),this._clearanceFriendData=e,this.setContentSize(175,256);var t=e.bPlayer?"bg_player_head.png":"bg_friend_head.png",i=UIHelper.createImage({imageFileName:t,bPlistTexture:!0,anchorPoint:cc.p(0,.5),position:cc.p(0,40),bScale9Enabled:!0,capInsets:cc.rect(5,5,7,8),size:cc.size(68,68)});this.addChild(i);var a=i;GameUtil._loadAvatar(e.headUrl,function(e){var t=e.getContentSize();e.setScaleX(64/t.width),e.setScaleY(64/t.height),e.setAnchorPoint(cc.p(.5,.5)),e.setPosition(a.getContentSize().width/2,a.getContentSize().height/2),a.addChild(e)});var n=UIHelper.createPanel({anchorPoint:i.getAnchorPoint(),position:i.getPosition(),size:i.getContentSize(),bTouchEnable:!0});if(n.addTouchEventListener(this._onHeadImageTouched,this),this.addChild(n),!e.bPlayer){var r=(e.bProhibitTakeHeart,"icon_take_heart.png");i=UIHelper.createImage({imageFileName:r,bPlistTexture:!0,position:cc.p(60,15)});this.addChild(i),this._takeHeartView=i}t=e.bPlayer?"bg_player_level.png":"bg_friend_level.png",i=UIHelper.createImage({imageFileName:t,bPlistTexture:!0,position:cc.p(100,66)});this.addChild(i);var o=e.bPlayer?res.number_brown_fnt:res.number_blue_fnt,l=e.bPlayer?16.8/35:16.8/24;(c=new cc.LabelBMFont(e.level,o)).setScale(l),c.setPosition(i.getContentSize().width/2,i.getContentSize().height/2),i.addChild(c);i=UIHelper.createText({position:cc.p(74,38),anchorPoint:cc.p(0,.5),fontSize:20,fontColor:cc.color(255,255,255),bIgnoreSize:!0});UIHelper.clipLongTextLabel(i,e.nickName,20,100),this.addChild(i);var c;(c=new cc.LabelBMFont(Util.getNumberWithComma(e.score),res.number_white_fnt)).setAnchorPoint(0,.5),c.setScale(.7),c.setPosition(74,12),this.addChild(c)},isPlayer:function(){return this._clearanceFriendData.bPlayer},isProhibitTakeHeart:function(){return this._clearanceFriendData.bProhibitTakeHeart},isTakeHeart:function(){return this._bTakeHeart},onTakeHeartSuccess:function(){this._bTakeHeart=!0},setDelegate:function(e){this._delegate=e},_onHeadImageTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&this._delegate.onHeadImageTouched(this)}});
var MaxMailCount={MAX_SYSTEM_MAIL_COUNT:100,MAX_FRIEND_MAIL_COUNT:50},MailType={MAIL_TYPE_NULL:0,MAIL_TYPE_FRIEND:1,MAIL_TYPE_SYSTEM:2,MAIL_TYPE_ALL:3,MAIL_TYPE_COUNT:4},MailSubType={MAIL_SUB_TYPE_NULL:0,MAIL_SUB_TYPE_HEART_SEND:101,MAIL_SUB_TYPE_NOTIFY:201,MAIL_SUB_TYPE_REWARD:202},MailAttach={article_type:1,article_subtype:2,article_id:3,article_count:4},MailDetail={mail_index:1,type:MailType.MAIL_TYPE_NULL,sub_type:MailSubType.MAIL_SUB_TYPE_NULL,subject:"",content:"",from:"",from_nick:"",from_pic:"",send_timestamp:0,expire_timestamp:10,attach_list:[]},EmailData=cc.Class.extend({_systemMailData:null,_friendMailData:null,ctor:function(){this._systemMailData=[],this._friendMailData=[]},createTestData:function(){for(var a=[],t=0;t<12;++t){var i={mail_index:1,type:Math.round(100*Math.random())%2+1,sub_type:Math.round(100*Math.random())%2*100+1,subject:"邮件标题 "+t,content:"恭喜你，获得了道具，赶快点击来看看吧,看看吧 "+t,from:"发件人 "+t,from_nick:"发件人昵称"+t+"比较长",from_pic:"http://wx.qlogo.cn/mmopen/nBcYE97sU469sibp82Dp7xVezjAaiaS1ic1XSOBg3FLnd18TVfcicRU53I3aD2MB1bjrW2iatP1QiaPW3NdY5llUb14JiaEHgibZAbdz/0",send_timestamp:.001*Date.now()-259200,expire_timestamp:.001*Date.now()+172800,attach_list:[]},e={article_type:ArticleType.ARTICLE_TYPE_ATTR,article_subtype:1+Math.round(100*Math.random())%4,article_id:Math.round(100*Math.random())%10+1,article_count:100*t};i.attach_list.push(e),a.push(i)}return a},saveMailData:function(a){var t;for(var i in a)(t=a[i])&&MailType.MAIL_TYPE_FRIEND==t.type?this._friendMailData.length<MaxMailCount.MAX_FRIEND_MAIL_COUNT&&this._friendMailData.push(t):t&&MailType.MAIL_TYPE_SYSTEM==t.type&&this._systemMailData.length<MaxMailCount.MAX_SYSTEM_MAIL_COUNT&&(t.unread=!0,this._systemMailData.push(t))},getSystemMailData:function(){return this._systemMailData},getFriendMailData:function(){return this._friendMailData},getMailTotalCount:function(){return this._systemMailData.length+this._friendMailData.length},clearAllData:function(a){switch(a){case MailType.MAIL_TYPE_SYSTEM:this._systemMailData.splice(0),this._systemMailData=[];break;case MailType.MAIL_TYPE_FRIEND:this._friendMailData.splice(0),this._friendMailData=[];break;case MailType.MAIL_TYPE_ALL:this._systemMailData.splice(0),this._systemMailData=[],this._friendMailData.splice(0),this._friendMailData=[]}}});EmailData.getInstance=function(){return null==EmailData._instance&&(EmailData._instance=new EmailData),EmailData._instance};var emailData=EmailData.getInstance();
var EmailWindow=WindowBase.extend({_friendMailList:null,_systemMailList:null,_friendTabButton:null,_systemTabButton:null,_getAllBtn:null,_cryBear:null,_bottomMore:null,_bkgWidth:616,_bkgHeight:700,_itemHeight:120,ctor:function(){this._super(),this.initView()},initView:function(){var e=cc.winSize.width,t=cc.winSize.height,i=UIHelper.createPanel({anchorPoint:cc.p(.5,.5),position:UIHelper.getCenterPosition(),size:cc.size(e,t),bTouchEnable:!1});this.addChild(i);var n=cc.size(this._bkgWidth,this._bkgHeight),s=UIHelper.createImage({imageFileName:"m_bkg.png",bPlistTexture:!0,bScale9Enabled:!0,size:n,capInsets:cc.rect(0,118,this._bkgWidth,10),position:cc.p(e/2,t/2)});s.setAnchorPoint(.5,.5),i.addChild(s,0);var a=UIHelper.createButton({normalFile:"btn_back_N.png",bPlistTexture:!0,position:cc.p(e/2-s.width/2+40,t/2+s.height/2-36),bTouchEnable:!0});a.addTouchEventListener(this._onBackButtonTouched,this),i.addChild(a,1);var o=new cc.LabelTTF("收件箱","Arial",36,cc.size(120,40));o.setAnchorPoint(.5,.5),o.setPosition(e/2,a.getPositionY()-20),o.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),i.addChild(o,1),this._friendMailList=this.createList(),this._friendMailList.addEventListener(this.onFriendItemSelected.bind(this)),i.addChild(this._friendMailList,1),this.initFriendList(),this._systemMailList=this.createList(),this._systemMailList.addEventListener(this.onSystemItemSelected.bind(this)),i.addChild(this._systemMailList,1),this.initSystemList(),this._friendTabButton=UIHelper.createButton({normalFile:"m_page_2.png",pressedFile:"m_page_1.png",bPlistTexture:!0,position:cc.p(e/2,t/2+204),bTouchEnable:!0}),this._friendTabButton.setAnchorPoint(1,.5),this._friendTabButton.addTouchEventListener(this._onFriendTabTouched,this),i.addChild(this._friendTabButton,1);var l=new cc.Sprite;l.initWithSpriteFrameName("m_friend_n.png"),l.setPosition(150,56),this._friendTabButton.addChild(l,1,10);var c=new cc.Sprite;c.initWithSpriteFrameName("m_friend_s.png"),c.setPosition(150,56),this._friendTabButton.addChild(c,1,12),this._systemTabButton=UIHelper.createButton({normalFile:"m_page_2.png",pressedFile:"m_page_1.png",bPlistTexture:!0,position:cc.p(e/2,t/2+204),bTouchEnable:!0}),this._systemTabButton.setAnchorPoint(0,.5),this._systemTabButton.addTouchEventListener(this._onSystemTabTouched,this),i.addChild(this._systemTabButton,1),(l=new cc.Sprite).initWithSpriteFrameName("m_system_s.png"),l.setPosition(150,56),this._systemTabButton.addChild(l,1,10),(c=new cc.Sprite).initWithSpriteFrameName("m_system_n.png"),c.setPosition(150,56),this._systemTabButton.addChild(c,1,12);var r=UIHelper.createButton({normalFile:"m_get_all.png",bPlistTexture:!0,position:cc.p(e/2,t/2-412),bTouchEnable:!0});r.addTouchEventListener(this._onGetAllButtonTouched,this),i.addChild(r,1),this._getAllBtn=r,this._getAllBtn.setVisible(!1);var d=ccs.load(res.nomessage_json);if(d){d.node.setPosition(e/2,520),i.addChild(d.node,0),this._cryBear=d;var h=new cc.LabelTTF("哎呦，好像没有新邮件耶！","Arial",24,cc.size(300,40));h.setAnchorPoint(.5,0),h.setPosition(10,-120),h.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),d.node.addChild(h,1)}else console.log("null == nomessage_json");var _=UIHelper.createImage({imageFileName:"rank_bottom.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(this._bkgWidth-4,27),capInsets:cc.rect(30,0,4,27),position:cc.p(e/2,t/2-344)});_.setAnchorPoint(.5,0),i.addChild(_,1),(_=new cc.Sprite).initWithSpriteFrameName("rank_arrow.png"),_.setPosition(e/2,t/2-336),_.setVisible(!1),i.addChild(_,1),this._bottomMore=_;var u=this._systemMailList.getChildrenCount(),m=this._friendMailList.getChildrenCount();u>0&&0==m?this._onSystemTabTouched():0<m&&0==u?this._onFriendTabTouched():this._onSystemTabTouched()},_updateCryBearStatus:function(e){var t=this._cryBear.node;t.stopAllActions();var i=this._cryBear.action;e?(t.setVisible(!0),t.runAction(i),i.gotoFrameAndPlay(0,i.getDuration(),0,!0)):t.setVisible(!1)},_onFriendTabTouched:function(){this._friendMailList.setVisible(!0),this._systemMailList.setVisible(!1),this._friendTabButton._onPressStateChangedToPressed(),this._friendTabButton.setTouchEnabled(!1),this._systemTabButton._onPressStateChangedToNormal(),this._systemTabButton.setTouchEnabled(!0);var e=this._friendTabButton.getChildByTag(10);e&&e.setVisible(!1);var t=this._friendTabButton.getChildByTag(12);t&&t.setVisible(!0),(e=this._systemTabButton.getChildByTag(10))&&e.setVisible(!1),(t=this._systemTabButton.getChildByTag(12))&&t.setVisible(!0);var i=this._friendMailList.getChildrenCount();i>0?(this._getAllBtn.setVisible(!0),this._updateCryBearStatus(!1)):(this._getAllBtn.setVisible(!1),this._updateCryBearStatus(!0)),i>4?this._bottomMore.setVisible(!0):this._bottomMore.setVisible(!1)},_onSystemTabTouched:function(){this._friendMailList.setVisible(!1),this._systemMailList.setVisible(!0),this._friendTabButton._onPressStateChangedToNormal(),this._friendTabButton.setTouchEnabled(!0),this._systemTabButton._onPressStateChangedToPressed(),this._systemTabButton.setTouchEnabled(!1);var e=this._friendTabButton.getChildByTag(10);e&&e.setVisible(!0);var t=this._friendTabButton.getChildByTag(12);t&&t.setVisible(!1),(e=this._systemTabButton.getChildByTag(10))&&e.setVisible(!0),(t=this._systemTabButton.getChildByTag(12))&&t.setVisible(!1);var i=this._systemMailList.getChildrenCount();i>0?this._updateCryBearStatus(!1):this._updateCryBearStatus(!0),i>4?this._bottomMore.setVisible(!0):this._bottomMore.setVisible(!1),this._getAllBtn.setVisible(!1)},_onBackButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(EmailWindow.Destroy(),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch))},createList:function(){var e=new ccui.ListView;return e.setAnchorPoint(cc.p(.5,.5)),e.setPosition(cc.winSize.width/2,cc.winSize.height/2-72),e.setDirection(ccui.ScrollView.DIR_VERTICAL),e.setScrollBarEnabled(!1),e.setBounceEnabled(!0),e.setTouchEnabled(!0),e.setContentSize(this._bkgWidth,this._bkgHeight-190),e},initFriendList:function(){for(var e,t,i=emailData.getFriendMailData(),n=i.length,s=0;s<n;s++)t=i[s],e=this.createFriendItem(s,t),this._friendMailList.pushBackCustomItem(e)},initSystemList:function(){for(var e,t,i=emailData.getSystemMailData(),n=i.length,s=0;s<n;s++)t=i[s],e=this.createSystemItem(s,t),this._systemMailList.pushBackCustomItem(e)},createFriendItem:function(e,t){var i=UIHelper.createPanel({anchorPoint:cc.p(0,0),position:cc.p(0,0),size:cc.size(this._bkgWidth-140,this._itemHeight)}),n=UIHelper.createImage({imageFileName:"m_head_frame.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(72,72),capInsets:cc.rect(5,5,2,2),position:cc.p(62,this._itemHeight/2+4)});n.setAnchorPoint(.5,.5),i.addChild(n,0),GameUtil._loadAvatar(t.from_pic,function(e){console.log("add avatar");var t=e.getContentSize();e.setScaleX(64/t.width),e.setScaleY(64/t.height),e.setAnchorPoint(cc.p(.5,0)),e.setPosition(62,32),i.addChild(e)});var s=t.from_nick,a=new cc.LabelTTF(s,"Arial",24,cc.size(260,30));a.setAnchorPoint(0,.5),a.setPosition(120,86),a.setHorizontalAlignment(cc.TEXT_ALIGNMENT_LEFT),i.addChild(a,1);var o=t.expire_timestamp-.001*Date.now(),l="送了你一颗爱心（还剩"+(o=Math.floor(o/86400)+1)+"天）",c=new cc.LabelTTF("","Arial",22,cc.size(380,24));c.setString(l),c.setAnchorPoint(0,.5),c.setPosition(120,44),c.setHorizontalAlignment(cc.TEXT_ALIGNMENT_LEFT),i.addChild(c,1);var r=new cc.Sprite;r.initWithSpriteFrameName("m_time_bottom.png"),r.setPosition(448,90),i.addChild(r);var d=.001*Date.now()-t.send_timestamp;if(d<=86400)l="今天";else if(d>86400&&d<172800)l="昨天";else{var h=new Date(1e3*t.send_timestamp);l=h.getMonth()+1+"月"+h.getDate()+"日"}(c=new cc.LabelTTF(l,"Arial",18,cc.size(100,22))).setString(l),c.setFontFillColor(cc.color(32,178,170)),c.setAnchorPoint(.5,.5),c.setPosition(50,12),c.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),r.addChild(c,0);var _=UIHelper.createButton({normalFile:"m_heart.png",bPlistTexture:!0,position:cc.p(540,56),bTouchEnable:!0});i.addChild(_);var u=UIHelper.createImage({imageFileName:"rank_inter_s.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(this._bkgWidth-16,2),capInsets:cc.rect(10,0,2,2),position:cc.p(this._bkgWidth/2,1)});return i.addChild(u),i},createSystemItem:function(e,t){var i=UIHelper.createPanel({anchorPoint:cc.p(0,0),position:cc.p(0,0),bTouchEnable:!0,size:cc.size(this._bkgWidth-140,this._itemHeight)}),n=new cc.Sprite,s=Math.round(100*Math.random())%4+1;n.initWithSpriteFrameName("m_sys_"+s+".png"),n.setPosition(64,60),i.addChild(n),(n=new cc.Sprite).initWithSpriteFrameName("m_unread.png"),n.setPosition(40,86),i.addChild(n,0,1e3),t.unread?n.setVisible(!0):n.setVisible(!1);var a=t.subject,o=new cc.LabelTTF(a,"Arial",26,cc.size(180,34));o.setAnchorPoint(0,.5),o.setPosition(120,84),o.setHorizontalAlignment(cc.TEXT_ALIGNMENT_LEFT),i.addChild(o,1);var l=t.content,c=new cc.LabelTTF("","Arial",22,cc.size(365,30));l.length>16&&(l=UIHelper.clipLongTextLabel(c,l,22,356,16)),c.setString(l),c.setAnchorPoint(0,.5),c.setPosition(120,38),c.setHorizontalAlignment(cc.TEXT_ALIGNMENT_LEFT),i.addChild(c,1);var r=t.expire_timestamp-.001*Date.now();a="有效期还有"+(r=(r=Math.floor(r/86400)+1)>0?r:0)+"天",(o=new cc.LabelTTF(a,"Arial",18,cc.size(140,30))).setPosition(380,78),o.setHorizontalAlignment(cc.TEXT_ALIGNMENT_LEFT),i.addChild(o,1);var d=UIHelper.createButton({normalFile:"m_get.png",bPlistTexture:!0,position:cc.p(540,56),bTouchEnable:!0});d.addTouchEventListener(this._onGetBtnTouched,this),i.addChild(d);var h=UIHelper.createImage({imageFileName:"rank_inter_s.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(this._bkgWidth-16,1),capInsets:cc.rect(10,0,2,1),position:cc.p(this._bkgWidth/2,0)});return i.addChild(h),i},onSystemItemSelected:function(e,t){switch(t){case ccui.ListView.ON_SELECTED_ITEM_END:var i=e,n=i.getCurSelectedIndex();console.log("onSystemItemSelected: curIndex= "+n);var s=i.getItem(n).getChildByTag(1e3);1==s.isVisible()&&s.setVisible(!1);var a=emailData.getSystemMailData()[n];a.unread=!1;var o=a.subject,l=a.content,c=this;OKCancelWindow.Show(o,l,function(){c._showMailAcceptWindow(n)})}},onFriendItemSelected:function(e,t){switch(t){case ccui.ListView.ON_SELECTED_ITEM_END:var i=e,n=i.getCurSelectedIndex();console.log("onFriendItemSelected: curIndex= "+n);var s=emailData.getFriendMailData(),a=s[n];NetLoadingWindow.Show();var o={type:MailType.MAIL_TYPE_FRIEND,mail_index:a.mail_index},l=this;GameService.updateMail(o,function(e,t){if(NetLoadingWindow.Hide(),e)console.log("err code: "+e.ret),TipWindow.Show(e.ret_desc);else{console.log("updateMail data: ",t),i.removeItem(n),s.splice(n,1);var o=i.getChildrenCount();l.onItemRemoved(o),o<=1&&l._getAllBtn.setVisible(!1),a.sub_type=1e3,eventDispatcher.dispatchEvent(EventID.READ_MAIL_EVENT)}})}},_onGetBtnTouched:function(e,t){if(ccui.Widget.TOUCH_ENDED==t){OKCancelWindow.Hide(),OKCancelWindow.Destroy();var i=this._systemMailList.getCurSelectedIndex();console.log("_onGetBtnTouched: ",i),this._showMailAcceptWindow(i)}},_onGetAllButtonTouched:function(e,t){if(ccui.Widget.TOUCH_ENDED==t){var i=this._friendMailList.getChildrenCount();NetLoadingWindow.Show();var n=this,s={type:MailType.MAIL_TYPE_FRIEND};GameService.updateBatchMail(s,function(e,t){if(NetLoadingWindow.Hide(),e)console.log("err code: "+e.ret),TipWindow.Show(e.ret_desc);else{console.log("updateBatchMail data: ",t),n._friendMailList.removeAllChildren();var s=emailData.getFriendMailData();s.splice(0),n._bottomMore.setVisible(!1),n._getAllBtn.setVisible(!1);var a="主人，又收到了  "+i+" 颗爱心";TipWindow.Show(a,function(){console.log("accepted all hearts"),n._systemMailList.getChildrenCount()>0?n._onSystemTabTouched():n._updateCryBearStatus(!0)});for(var o in s)s[o].sub_type=1e3}})}},_showMailAcceptWindow:function(){var e=this._systemMailList,t=e.getCurSelectedIndex(),i=emailData.getSystemMailData(),n=i[t],s=n.subject,a=n.attach_list[0],o="",l=a.article_count;switch(a.article_subtype){case ArticleSubType.ARTICLE_SUB_TYPE_HEART:o="爱心";break;case ArticleSubType.ARTICLE_SUB_TYPE_DIAMONDS:o="钻石";break;case ArticleSubType.ARTICLE_SUB_TYPE_COIN:o="金币";break;case ArticleSubType.ARTICLE_SUB_TYPE_PROP:o="冒险道具"}var c=o+l+" 个",r=GameUtil.getGoodsImageById(a.article_type,a.article_subtype,a.article_id);null==r&&console.log("null == imgRes!");var d=this;AcceptWindow.Show(s,c,r,function(){console.log("accepted button touched"),NetLoadingWindow.Show();var s={type:MailType.MAIL_TYPE_SYSTEM,mail_index:n.mail_index};GameService.updateMail(s,function(s,a){if(NetLoadingWindow.Hide(),s)console.log("err code: "+s.ret),TipWindow.Show(s.ret_desc);else{console.log("updateMail data: ",a),0<=t&&(e.removeItem(t),i.splice(t,1));var o=e.getChildrenCount();d.onItemRemoved(o),n.sub_type=1e3,eventDispatcher.dispatchEvent(EventID.READ_MAIL_EVENT)}})})},onItemRemoved:function(e){0==e&&this._updateCryBearStatus(!0),4>=e&&this._bottomMore.setVisible(!1)},getUnreadNum:function(){var e=0,t=emailData.getFriendMailData();for(var i in t)1e3==t[i].sub_type&&(e+=1);t=emailData.getSystemMailData();var n;for(i=0;n=t[i];++i)n.unread||(e+=1);var s=emailData.getMailTotalCount()-e;return s=s<0?0:s},onShow:function(){this._super();this._cryBear.node.isVisible()&&this._updateCryBearStatus(!0)},onHideNotify:function(){TopGoldBar.Show()},onHide:function(){this._super()},onDestroyNotify:function(){TopGoldBar.Show()},onDestroy:function(){this._super(),this._friendMailList.removeAllChildren(),this._systemMailList.removeAllChildren()}});EmailWindow.GetInstance=function(){return null==EmailWindow._instance&&(EmailWindow._instance=new EmailWindow),EmailWindow._instance},EmailWindow.Show=function(){ResLoader.showSubResLoadingWindow(ResObjects.getResObject(ResObjectConfig.email),function(){var e=EmailWindow.GetInstance(),t=WindowAction.getScaleEaseElasticOutAction(e);WindowManager.GetInstance().showWindow(e,t,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,EmailWindow.Destroy)})},EmailWindow.Hide=function(){WindowManager.GetInstance().hideWindow(EmailWindow._instance)},EmailWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(EmailWindow._instance),EmailWindow._instance=null};
var FeedbackWindow=WindowBase.extend({ctor:function(){this._super(),this._initUI()},_initUI:function(){this.styleNode=document.createElement("style"),this.styleNode.innerHTML="#webView {   width: 100%;   height: 100%;   z-index: 10000;   background-color: rgb(255, 255, 255); \tposition: absolute;   bottom: 0px;   left: 0px;   -webkit-overflow-scrolling: touch;    overflow: auto;  }  #webView iframe {   width: 100%;   height: 100%;\tborder: none; } #backButton {   position: fixed;   width: 60px;   height: 20px;   background-color: rgba(0, 0, 0, 0.6);   border-radius: 20px;\talign-items: center;   z-index: 10000;   top: 6px;   left: 5px;   padding:3px 1px 3px 2px; }",document.body.appendChild(this.styleNode);var e=NetData.user_info.headimgurl,n=NetData.user_info.nickname,t=NetData.user_info.openid;(null===n||void 0===n||n.length<=0)&&(n=" ");var o=CryptoJs.MD5(t+"kLBa7840"),i=encodeURIComponent(e),d="openid="+t+"&nickname="+encodeURIComponent(n)+"&headimgurl="+i+"&token="+o,c=CryptoJs.des("kLBa7840",d,1,0,0,1),a=CryptoJs.stringToHex(c);console.log("===2. DES 加密得到字符串::",a,c);var s="https://support.qq.com/embed/app/2186?data="+a;this.webView=document.createElement("div"),this.webView.setAttribute("id","webView"),this.webView.innerHTML='<iframe src="'+s+'" style="width: 100%; height: 100%;" frameborder="0"></iframe>',document.body.appendChild(this.webView),this.backButton=document.createElement("div"),this.backButton.setAttribute("id","backButton"),this.backButton.innerHTML='<button style="background: none;width: 100%; height: 100%; border: none;font-size: 14px; color: #fff; align-self: center">返回</button>',document.body.appendChild(this.backButton),cc.sys.isMobile?this.backButton.addEventListener("touchend",this._onBackButtonTouched):this.backButton.addEventListener("mouseup",this._onBackButtonTouched)},_onBackButtonTouched:function(){MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),FeedbackWindow.Destroy()},onShowNotify:function(){},onShow:function(){},onHideNotify:function(){TopGoldBar.Show()},onHide:function(){},onDestroyNotify:function(){TopGoldBar.Show()},onDestroy:function(){document.body.removeChild(this.webView),document.body.removeChild(this.styleNode),document.body.removeChild(this.backButton)},onCover:function(){},onResume:function(){}});FeedbackWindow.GetInstance=function(){return null==FeedbackWindow._instance&&(FeedbackWindow._instance=new FeedbackWindow),FeedbackWindow._instance},FeedbackWindow.Show=function(){var e=FeedbackWindow.GetInstance();WindowManager.GetInstance().showWindow(e,null,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,FeedbackWindow.Destroy)},FeedbackWindow.Hide=function(){WindowManager.GetInstance().hideWindow(FeedbackWindow._instance)},FeedbackWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(FeedbackWindow._instance),FeedbackWindow._instance=null};
var GmDialog={show:function(){if(!Service.Util.isProductEnv||!Service.Util.isProductEnv()){NetLoadingWindow.Show(),GameService.getGmCmdInfo({},function(t,n){n&&n.cmd_info_list&&(NetLoadingWindow.Hide(),GmDialogC.Show(n.cmd_info_list||[]))})}},_addDom:function(t){var n=this;Service.Util.insertStyle("\n #gm-mask{\n  \tbackground: #000;\n  \tposition: absolute;\n  \tleft:0;\n  \ttop:0;\n  \tbottom:0;\n  \tright:0;\n  \tz-index: 999;\n  \topacity: 0.6;\n  }\n  #gm-dialog{\n  \tcolor: #333;\n  \tfont-size: 12px;\n  \tbackground: #44b7c4;\n  \tposition: absolute;\n  \ttop: 15px;\n  \tleft: 15px;\n  \tright: 15px;\n  \tbottom: 80px;\n  \toverflow: auto;\n    -webkit-overflow-scrolling: touch;\n  \tz-index: 1000;\n  \tborder-radius: 10px\n  }\n  #gm-dialog input{\n  \tborder: 1px solid #1b4f54;\n  \tpadding: 4px;\n  \twidth: 120px;\n  }\n  #gm-nav{\n  \twidth: 110px;\n  \tfloat: left;\n  \tpadding-top:20px;\n  }\n  #gm-nav a{\n  \tdisplay: block;\n  \tbackground: #1b4f54;\n  \tcolor: #fff;\n  \ttext-decoration: none;\n  \tpadding: 10px;\n  \tmargin-bottom: 10px;\n  \tborder-top-right-radius: 20px;\n  \tborder-bottom-right-radius: 20px\n  }\n  #gm-nav a.active{\n  \tbackground: #cccc33;\n  \tcolor: #333\n  }\n  #gm-content{\n  \toverflow: hidden;\n  \tmargin-left: 130px;\n  \tpadding-top: 20px;\n  \tpadding-right: 15px;\n  }\n  .gm-content-item{\n  \tdisplay:none;\n  }\n  .gm-content-item.active{\n  \tdisplay:block;\n  }\n  .gm-item-param{\n  \tpadding: 10px 0\n  }\n  .gm-item-param-tt{\n  \tpadding-bottom: 5px \n  }\n\n  #gm-btn-wrapper{\n  \tposition: fixed;\n  \tbottom:20px;\n  \tleft:20px;\n  \tright:20px;\n  \ttext-align: center;\n  \tz-index: 1001\n  }\n  #gm-btn{\n  \tdisplay: inline-block;\n  \tpadding: 10px 100px;\n  \tbackground-color: #6cc644;\n    border: 1px solid #5aad35;\n    color: #fff;\n    text-decoration: none;\n    border-radius: 10px;\n  font-size: 16px\n}\n  #gm-close{\n\tfont-size: 24px;\n    color: #fff;\n    font-weight: bold;\n    position: absolute;\n    right: 0;\n    top: 0;\n    width: 40px;\n    height: 30px;\n    text-align: center;\n    padding-top: 5px;\n    text-decoration: none;\n  }\n","gmStyle");var e=document.createElement("div");e.id="gm-wrapper",e.innerHTML=Service.Util.tmpl('<div id="gm-mask"></div><div id="gm-dialog"><div id="gm-nav"><% for (var i=0, item; item = data[i]; i++) { %><a class="gm-nav-item" data-id="<%=item.cmd_id.id%>" data-index="<%=i%>" href="javascript:;"><%=item.cmd_id.name%></a><% } %></div><div id="gm-content"><% for (var i=0, item; item = data[i]; i++) { %><div class="gm-content-item" data-id="<%=item.cmd_id.id%>" data-index="<%=i%>"><% for (var j=0, jtem; jtem = item.cmd_param[j]; j++) { %><% if (jtem.param_desc) { %><div class="gm-item-param"><div class="gm-item-param-tt"><%=jtem.param_desc%></div><div><input type="text" value="<%=jtem.param%>"/></div></div><% } %><% } %></div><% } %></div><a href="javascript:;" id="gm-close">×</a></div><div id="gm-btn-wrapper"><a id="gm-btn" href="javascript:;">提交</a></div>',{data:t}),document.body.appendChild(e),X8SDK.isWX()&&(document.getElementById("gm-dialog").style.top="55px");var i="mousedown";("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)&&(i="touchstart");document.getElementById("gm-nav").addEventListener(i,function(t){var e=t.target;if(e&&/gm-nav-item/.test(e.className)){var i=e.getAttribute("data-index");n.activeNav(i)}},!1),this.activeNav(0);document.getElementById("gm-btn").addEventListener(i,function(t){n.submit()},!1);document.getElementById("gm-close").addEventListener(i,function(t){document.body.removeChild(e)},!1)},activeNav:function(t){var n=document.getElementById("gm-nav"),e=n.querySelectorAll("a"),i=document.getElementById("gm-content"),a=i.querySelectorAll(".gm-content-item"),o=e[t],d=a[t],m=i.querySelector(".active"),r=n.querySelector(".active");m&&(m.className="gm-content-item"),r&&(r.className="gm-nav-item"),o&&(o.className="gm-nav-item active"),d&&(d.className="gm-content-item active")},submit:function(){var t=document.getElementById("gm-content").querySelector(".active"),n=document.getElementById("gm-btn");if(!n.getAttribute("data-disabled")&&t){for(var e,i=parseInt(t.getAttribute("data-id")),a=t.querySelectorAll("input"),o=[],d=0;e=a[d];d++)o.push(parseInt(e.value));n.innerHTML="正在提交",n.style.opacity=.8,n.setAttribute("data-disabled",!0),GameService.setGmCmdInfo({cmd_id:i,param:o},function(t,e){n.innerHTML="提交",n.style.opacity=1,n.removeAttribute("data-disabled"),e?ShowOffDataCollect.removeStorage("stars","last_share"):console.log(JSON.stringify(t))})}}};
var GmDialogC=WindowBase.extend({_list:null,_bInit:!1,_contentNode:null,_currentItem:null,_inputList:[],_drawNode:null,_mask:null,_buttonText:null,ctor:function(){this._super();var t=UIHelper.createPanel({colorType:ccui.Layout.BG_COLOR_SOLID,bgColor:cc.color(68,183,196),size:cc.size(cc.winSize.width-60,cc.winSize.height-200),position:cc.p(30,150)});this.addChild(t);var e=UIHelper.createPanel({colorType:ccui.Layout.BG_COLOR_SOLID,bgColor:cc.color(108,198,68),size:cc.size(cc.winSize.width-200,80),position:cc.p(t.getContentSize().width/2,-70),anchorPoint:cc.p(.5,.5),bTouchEnable:!0});e.addClickEventListener(this._onCommitButtonClicked.bind(this)),t.addChild(e);var i=UIHelper.createText({fontSize:30,fontColor:cc.color(255,255,255),content:"提交",position:cc.p(e.getContentSize().width/2,e.getContentSize().height/2)});e.addChild(i),this._buttonText=i;var n=UIHelper.createList({contentSize:cc.size(250,t.getContentSize().height-60),position:cc.p(0,30),bounceEnabled:!0});n.setItemsMargin(10),t.addChild(n,1),this._list=n,this._contentNode=UIHelper.createPanel({size:cc.size(t.getContentSize().width-n.getContentSize().width-20,n.getContentSize().height),anchorPoint:cc.p(1,0),position:cc.p(t.getContentSize().width,n.getPositionY())}),t.addChild(this._contentNode);var o=UIHelper.createPanel({size:cc.size(50,50),position:cc.p(t.getContentSize().width-25,25),anchorPoint:cc.p(.5,.5),bTouchEnable:!0});o.addClickEventListener(this._onButtonBgClicked.bind(this)),t.addChild(o);i=UIHelper.createText({fontSize:30,fontColor:cc.color(255,255,255),content:"关闭",anchorPoint:cc.p(1,.5),position:cc.p(o.getContentSize().width/2,o.getContentSize().height)});o.addChild(i);var c=UIHelper.createPanel({size:cc.winSize,bTouchEnable:!0});c.setVisible(!1),this.addChild(c),this._mask=c},_drawCloseButton:function(){this._drawNode.clear(),this._drawNode.drawSegment(cc.p(20,20),cc.p(30,30),3),this._drawNode.drawSegment(cc.p(20,30),cc.p(30,20),3)},_onButtonBgClicked:function(){GmDialogC.Hide()},setDataList:function(t){this._dataList=t},_createListItem:function(t){var e=UIHelper.createPanel({colorType:ccui.Layout.BG_COLOR_SOLID,bgColor:cc.color(27,79,84),size:cc.size(this._list.getContentSize().width,80),bTouchEnable:!0,anchorPoint:cc.p(.5,.5)});e.addClickEventListener(this._onItemClicked.bind(this)),e.setUserData(t);var i=UIHelper.createText({fontSize:25,fontColor:cc.color(255,255,255),content:t.cmd_id.name,position:cc.p(e.getContentSize().width/2,e.getContentSize().height/2)});return e.addChild(i),e},_onItemClicked:function(t){if(null!=t){null!=this._currentItem&&this._currentItem.setBackGroundColor(cc.color(27,79,84)),t.setBackGroundColor(cc.color(204,204,51)),this._currentItem=t,this._contentNode.removeAllChildren(),this._inputList=[];for(var e=t.getUserData().cmd_param,i=null,n=this._contentNode.getContentSize().width,o=this._contentNode.getContentSize().height-10,c=this._contentNode,s=0,r=e.length;s<r;s++){if(""==(i=e[s]).param_desc)return;var a=UIHelper.createText({fontSize:30,fontColor:cc.color(0,0,0),anchorPoint:cc.p(0,1)});UIHelper.subsectionTextForUIText(a,i.param_desc,n,cc.TEXT_ALIGNMENT_LEFT),a.setPosition(0,o),c.addChild(a),o-=a.getContentSize().height,o-=20;var l=new ccui.TextField;l.setTextColor(cc.color(0,0,0)),l.setFontSize(30),l.setAnchorPoint(cc.p(0,1)),l.setContentSize(n,80),l.setPosition(0,o),l.setString(i.param),l.setUserData(t.getUserData()),c.addChild(l),this._inputList.push(l),o-=50,o-=10}}},_onCommitButtonClicked:function(){console.log("_onCommitButtonClicked");for(var t=[],e=0,i=this._inputList.length;e<i;e++)console.log(parseInt(this._inputList[e].getString())),t.push(parseInt(this._inputList[e].getString()));this._buttonText.setString("正在提交");var n=this._inputList[0].getUserData().cmd_id.id;this._mask.setVisible(!0),GameService.setGmCmdInfo({cmd_id:n,param:t},function(t,e){this._buttonText.setString("提交"),this._mask.setVisible(!1),e?alert("提交成功"):alert(JSON.stringify(t))}.bind(this))},onShowNotify:function(){if(this._super(),this._buttonText.setString("提交"),this._bInit)this._selectFirst();else{this._bInit=!0;for(var t=0,e=this._dataList.length;t<e;t++){var i=this._createListItem(this._dataList[t]);this._list.pushBackCustomItem(i)}this._selectFirst()}},_selectFirst:function(){var t=this._list.getItems()[0];this._onItemClicked(t)},onShow:function(){this._super()},onHideNotify:function(){this._super()},onHide:function(){this._super()},onDestroyNotify:function(){this._super()},onDestroy:function(){this._super()},onCover:function(){this._super()},onResume:function(){this._super()},onWindowResize:function(){this._super()},adjust:function(){this._super()}});GmDialogC.GetInstance=function(){return null==GmDialogC._instance&&(GmDialogC._instance=new GmDialogC),GmDialogC._instance},GmDialogC.Show=function(t){var e=GmDialogC.GetInstance();e.setDataList(t),WindowManager.GetInstance().showWindow(e,null,!1,1e3,!1,null,null,GmDialogC.Destroy)},GmDialogC.Hide=function(){WindowManager.GetInstance().hideWindow(GmDialogC._instance)},GmDialogC.Destroy=function(){WindowManager.GetInstance().destroyWindow(GmDialogC._instance),GmDialogC._instance=null};
var HeartRecoveryType={MAX_HEART_COUNT:1,COUNT_DOWN:2,OVER_MAX_HEART_COUNT:3},HeartRecoveryLogic={_countdownTimer:null,_lastRecoveryTime:null,_updateProxy:null,_hideTime:null,_heartCount:null,_recoverType:null,_listenerList:null,init:function(){console.info("HeartRecoveryLogic init"),this._hideTime=null,this._listenerList=[],Util.registerListener(this._listenerList,EventID.AT_HEART,this._onHeartUpdate.bind(this)),wx.onShow(function(e){this._onShow()}.bind(this)),wx.onHide(function(){this._onHide()}.bind(this));var e=new CountDownTimer;e.setCountTime(HeartConfig.sec_per_heart),e.setSecondTimerDuration(1),e.setSecondTimeCallBack(this._onSecondElapse.bind(this)),e.setCountTimeCallBack(this._onReachTime.bind(this)),this._countdownTimer=e,this._updateProxy=new UpdateProxy(this._onUpdate.bind(this)),this._updateProxy.start(),this._calcTimerElapseAndCheckStart(),this._dispatchEvent()},_calcTimerElapseAndCheckStart:function(){if(this._heartCount=NetData.heart.count,this._lastRecoveryTime!=NetData.heart.last_update_time)if(this._lastRecoveryTime=NetData.heart.last_update_time,this._heartCount<HeartConfig.max_pool_buf){var e=NetData.now_unix_timestamp-this._lastRecoveryTime;e%=HeartConfig.sec_per_heart,this._countdownTimer.setElapse(e),this._countdownTimer.start()}else this._countdownTimer.setElapse(0),this._countdownTimer.pause()},destroy:function(){this._updateProxy&&this._updateProxy.release()},getHeartRecoveryType:function(){return this._recoverType},getHeartCount:function(){return this._heartCount},getTime:function(){return Util.formatTime(this._countdownTimer.getSurplusTime(),TimeFormatType.ms)},onDeductHeart:function(){this._heartCount--,this._checkStartTimer(),this._dispatchEvent()},_onHeartUpdate:function(){this._calcTimerElapseAndCheckStart(),this._dispatchEvent()},_onUpdate:function(e){this._countdownTimer.update(e)},_onSecondElapse:function(e){this._dispatchEvent()},_onReachTime:function(){this._countdownTimer.pause(),this._recoveryHeart(1),this._checkStartTimer(),this._dispatchEvent()},_checkStartTimer:function(){this._heartCount<HeartConfig.max_pool_buf?this._countdownTimer.isRunning()||(this._countdownTimer.setCountTime(HeartConfig.sec_per_heart),this._countdownTimer.start()):(this._countdownTimer.setElapse(0),this._countdownTimer.pause())},_dispatchEvent:function(){this._heartCount>HeartConfig.max_pool_buf?this._recoverType=HeartRecoveryType.OVER_MAX_HEART_COUNT:this._heartCount==HeartConfig.max_pool_buf?this._recoverType=HeartRecoveryType.MAX_HEART_COUNT:this._recoverType=HeartRecoveryType.COUNT_DOWN,eventDispatcher.dispatchEvent(EventID.HEART_RECOVERY)},_onHide:function(){console.info("onHide ",this._heartCount),console.info("onHide ",HeartConfig.max_pool_buf),this._heartCount<HeartConfig.max_pool_buf&&(this._hideTime=(new Date).getTime(),console.info("onHide ",this._hideTime)),this._countdownTimer.pause()},_onShow:function(){if(console.info("onShow 1"),null!=this._hideTime){console.info("onShow 2"),this._countdownTimer.resume();var e=((new Date).getTime()-this._hideTime)/1e3,t=this._countdownTimer.getSurplusTime();if(console.info("onShow 3 ",e),e>t){e-=t,this._recoveryHeart(1);var i=Math.floor(e/HeartConfig.sec_per_heart);this._recoveryHeart(i),console.info("onShow 4"),this._heartCount<HeartConfig.max_pool_buf?(e%=HeartConfig.sec_per_heart,this._countdownTimer.setElapse(e),console.info("onShow 5")):(this._countdownTimer.pause(),console.info("onShow 6"))}else{var o=this._countdownTimer.getElapse();o+=e,this._countdownTimer.setElapse(o),console.info("onShow 7")}this._checkStartTimer(),this._dispatchEvent(),this._hideTime=null}},_recoveryHeart:function(e){this._heartCount+=e,this._heartCount>HeartConfig.max_pool_buf&&(this._heartCount=HeartConfig.max_pool_buf)}};
var InputRecordWindow=WindowBase.extend({_okBtnCallBack:null,_textField:null,ctor:function(){this._super();var n=cc.size(cc.winSize.width-100,400),o=UIHelper.createPanel({anchorPoint:cc.p(.5,.5),colorType:ccui.Layout.BG_COLOR_SOLID,position:UIHelper.getCenterPosition(),bgColor:cc.color(0,0,0),size:n,bTouchEnable:!0,touchListener:null});this.addChild(o);var e=UIHelper.createPanel({anchorPoint:cc.p(.5,.5),colorType:ccui.Layout.BG_COLOR_SOLID,position:cc.p(n.width/2,n.height/2+50),bgColor:cc.color(0,0,170),size:cc.size(cc.winSize.width-150,50),bTouchEnable:!1,touchListener:null});o.addChild(e);var t=new ccui.TextField;this._textField=t,t.setColor(cc.color(255,255,255)),t.setAnchorPoint(cc.p(.5,.5)),t.setPlaceHolder("输入Record的json串"),t.setContentSize(cc.size(cc.winSize.width-150,50)),t.setPosition(cc.p(n.width/2,n.height/2+50)),o.addChild(t);var i=UIHelper.createButton({normalFile:"m_green_btn.png",pressedFile:"m_green_btn.png",bPlistTexture:!0,position:UIHelper.getPosition(n.width/2,n.height/2-100),bTouchEnable:!0});i.addTouchEventListener(this._onOkTouched,this),o.addChild(i)},_onOkTouched:function(n,o){if(ccui.Widget.TOUCH_ENDED==o){var e=this._textField.getString();this._okBtnCallBack&&this._okBtnCallBack(e),InputRecordWindow.Destroy(),TopGoldBar.Hide()}},setOkBtnCallBack:function(n){this._okBtnCallBack=n},onShowNotify:function(){},onShow:function(){},onHideNotify:function(){},onHide:function(){},onDestroyNotify:function(){},onDestroy:function(){},onCover:function(){},onResume:function(){}});InputRecordWindow.GetInstance=function(){return null==InputRecordWindow._instance&&(InputRecordWindow._instance=new InputRecordWindow),InputRecordWindow._instance},InputRecordWindow.Show=function(n,o){var e=InputRecordWindow.GetInstance();e.setOkBtnCallBack(n);WindowManager.GetInstance().showWindow(e,null,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,function(){InputRecordWindow.Destroy()},o,InputRecordWindow.Destroy)},InputRecordWindow.Hide=function(){WindowManager.GetInstance().hideWindow(InputRecordWindow._instance)},InputRecordWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(InputRecordWindow._instance),InputRecordWindow._instance=null};
var MiniMapWindow=WindowBase.extend({_map:null,_mapStageList:[],_detailsList:[],_itemHeight:200,_proPanelWidth:400,REWARD_STATUS:{UNKNOWN:0,CAN_GET:1,CAN_NOT_GET:2,FINISHED:3},ctor:function(e){this._super(),this._map=e,this.initView(),this._initMapList()},initView:function(){var e=cc.winSize.width,t=cc.winSize.height,i=UIHelper.createPanel({anchorPoint:cc.p(.5,.5),position:UIHelper.getCenterPosition(),size:cc.size(e,t),bTouchEnable:!1});this.addChild(i),this._mapStageList=this.createList(),this._mapStageList.setPosition(0,t/2-this._mapStageList.height/2),i.addChild(this._mapStageList,1)},createList:function(){var e=MAX_STAGE_ID/MaxItemNumPerPage*this._itemHeight;e=e>cc.winSize.height?cc.winSize.height:e;var t=new TableView(this,cc.size(cc.winSize.width,e));return t.setAnchorPoint(.5,.5),t.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),t.setDelegate(this),t.setVerticalFillOrder(cc.TABLEVIEW_FILL_BOTTOMUP),t.setBounceable(!1),t},_initMapList:function(){this._detailsList.splice(0);for(var e,t=[],i=MAX_STAGE_ID/MaxItemNumPerPage,a=1;a<=i;++a){e={isActive:!1,starNum:0,curRewardId:0,rewardType:this.REWARD_STATUS.UNKNOWN,rewardNum:0};var s=GameUtil.getStarNumByStageID((a-1)*MaxItemNumPerPage);e.isActive=s>0||-1==s,e.starNum=GameUtil.getStarNumByMapID(a),e.rewardNum=GameUtil.getRewardNumByMapID(a),e.curRewardId=GameUtil.getStarRewardID(e.starNum)-e.rewardNum,e.rewardNum>0?e.rewardType=this.REWARD_STATUS.CAN_GET:0==e.rewardNum&&(e.starNum>=90?e.rewardType=this.REWARD_STATUS.FINISHED:e.rewardType=this.REWARD_STATUS.CAN_NOT_GET),t.push(e)}this._detailsList=t,this._mapStageList.reloadData();var n=cc.winSize.height/2-this._itemHeight/2-Math.floor(this._map.max_stage_id/MaxItemNumPerPage)*this._itemHeight;n=Math.min(0,Math.max(n,-MAX_STAGE_ID/MaxItemNumPerPage*this._itemHeight+cc.winSize.height)),this._mapStageList.setContentOffset(cc.p(0,n))},createDisabledItem:function(e){var t=cc.winSize.width,i=UIHelper.createPanel({anchorPoint:cc.p(.5,0),position:cc.p(t/2,0),size:cc.size(640,this._itemHeight)}),a=UIHelper.createImage({imageFileName:"mm_bkg_no.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(502,174),capInsets:cc.rect(40,0,2,0),position:cc.p(320,this._itemHeight/2)});a.setName("bkgImage"),i.addChild(a);var s=UIHelper.createImage({imageFileName:"mm_reward_no.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(440,105),capInsets:cc.rect(110,0,4,0),anchorPoint:cc.p(0,0),position:cc.p(100,this._itemHeight/2-66)});i.addChild(s);var n=new cc.Sprite;n.initWithSpriteFrameName("mm_lock.png"),n.setPosition(150,this._itemHeight/2-10),i.addChild(n);var r=this._createProgressPanel(e);return i.addChild(r),i},createActiveItem:function(e){var t=cc.winSize.width,i=UIHelper.createPanel({anchorPoint:cc.p(.5,0),position:cc.p(t/2,0),size:cc.size(640,this._itemHeight)}),a=UIHelper.createImage({imageFileName:"mm_bkg_yes.png",bPlistTexture:!0,size:cc.size(502,174),position:cc.p(320,this._itemHeight/2)});a.setName("bkgImage"),i.addChild(a);var s=new cc.Sprite;s.initWithSpriteFrameName("mm_p_blue.png"),s.setPosition(0,this._itemHeight/2-50),s.setName("stageNum"),i.addChild(s);var n=UIHelper.createText({position:cc.p(35,11),fontSize:18,fontColor:cc.color(255,255,255),bIgnoreSize:!0});s.addChild(n,0,111);var r=UIHelper.createImage({imageFileName:"mm_reward_yes.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(440,105),capInsets:cc.rect(110,0,4,0),anchorPoint:cc.p(0,0),position:cc.p(100,this._itemHeight/2-66)});i.addChild(r);var o=UIHelper.createButton({normalFile:"mm_gift.png",bPlistTexture:!0,position:cc.p(150,this._itemHeight/2-10),bTouchEnable:!0});o.setName("giftBtn"),o.addTouchEventListener(this._onGiftButtonTouched,this);var c=o.width,l=new cc.Sprite;l.initWithSpriteFrameName("m_red_pot.png"),l.setPosition(.9*c,.9*c),l.setVisible(!1),o.addChild(l,0,100);var d=new cc.LabelTTF("","Arial",12,cc.size(16,16));d.setAnchorPoint(.5,.5),d.setPosition(.9*c,.9*c),d.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),d.setVisible(!1),o.addChild(d,0,101),i.addChild(o);var h=UIHelper.createImage({imageFileName:"mm_mask.png",bPlistTexture:!0,position:cc.p(150,this._itemHeight/2-10),bTouchEnable:!1});h.setName("finishedBtn"),i.addChild(h),h.setVisible(!1);var m=new cc.Sprite;m.initWithSpriteFrameName("mm_finished.png"),m.setPosition(38,42),h.addChild(m);var g=UIHelper.createImage({imageFileName:"mm_mask.png",bPlistTexture:!0,position:cc.p(150,this._itemHeight/2-10),bTouchEnable:!1});g.setName("canNotGetBtn"),i.addChild(g),g.setVisible(!1),(m=new cc.Sprite).initWithSpriteFrameName("mm_wenhao.png"),m.setPosition(38,42),g.addChild(m);var _=UIHelper.createImage({imageFileName:"mm_p_yellow.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(10,16),capInsets:cc.rect(10,0,2,0),position:cc.p(194,this._itemHeight/2-12)});_.setAnchorPoint(0,.5),_.setName("progressImg"),i.addChild(_);var u=new cc.Sprite;u.initWithSpriteFrameName("mm_star.png"),u.setPosition(200,this._itemHeight/2-12),u.setName("starImg"),i.addChild(u);var p=this._createProgressPanel(e);i.addChild(p);var w=e*MaxItemNumPerPage+1,S=(e+1)*MaxItemNumPerPage,N=StageJumpData.isHoldMulti(w,S);if(N>0){var I=new cc.Sprite("#jump_total_hold_bg.png");I.setPosition(60,p.height-30),i.addChild(I);var T=new cc.LabelTTF(""+N,"Arial",22);T.setPosition(.6*I.width,.4*I.height),I.addChild(T)}return i},_createProgressPanel:function(e){var t=UIHelper.createPanel({anchorPoint:cc.p(0,0),position:cc.p(190,0),size:cc.size(this._proPanelWidth,this._itemHeight)});t.setName("proPanel");var i=new cc.Sprite;i.initWithSpriteFrameName("mm_name.png"),i.setPosition(-40,this._itemHeight-32),t.addChild(i);var a=e*MaxItemNumPerPage+1,s=new cc.LabelBMFont("",res.number_white_fnt);s.setAnchorPoint(0,.5),s.setPosition(0,this._itemHeight-36),s.setString(a.toString(),!1),s.setName("stage_left"),t.addChild(s);var n=0;n=a>=100?48:a<100&&a>=10?26:8;var r=UIHelper.createText({content:"-",position:cc.p(20+n,this._itemHeight-30),fontSize:36,fontColor:cc.color(255,255,255),bIgnoreSize:!0});r.setName("stage_-"),t.addChild(r),a=(e+1)*MaxItemNumPerPage,(s=new cc.LabelBMFont("",res.number_white_fnt)).setAnchorPoint(0,.5),s.setPosition(30+n,this._itemHeight-36),s.setString(a.toString(),!1),s.setName("stage_right"),t.addChild(s);for(var o,c=0;c<5;++c)(o=new cc.Sprite).initWithSpriteFrameName("mm_arrow_s.png"),o.setPosition(64+65*c,this._itemHeight/2+2),t.addChild(o);var l,d=0;for(c=0;c<5;++c)l=new cc.LabelBMFont("",res.number_white_fnt),d=(d=20*(c+1))>80?90:d,l.setString(d.toString(),!1),l.setPosition(64+65*c,this._itemHeight/2+24),t.addChild(l);return t},_onItemBkgTouched:function(e){console.log("_onItemBkgTouched "+e);var t,i=NetData.statics_ntf.stage_statics.max_stage_id;t=e*MaxItemNumPerPage<=i&&i<(e+1)*MaxItemNumPerPage?i+1:(t=e*MaxItemNumPerPage+3)>MAX_STAGE_ID?MAX_STAGE_ID:t,console.log("jump stage to "+t),this._map.showJumpStageAni(t),this._onExitTouched()},_onGiftButtonTouched:function(e,t){if(ccui.Widget.TOUCH_ENDED==t){var i=e.getParent(),a=this._getItemBtnIndex(i),s=this._detailsList[a];console.log("_onGiftButtonTouched "+a);var n=a+1,r=this.getCurRewardPack(n,s.curRewardId);if(s.rewardNum>0){var o={map_id:n};NetLoadingWindow.Show();var c=this;GameService.getRewardByMapID(o,function(e,t){if(NetLoadingWindow.Hide(),e)if(console.log("err code: "+e.ret),-1600==e.ret){console.log("不满足集星礼物领取条件"),s.rewardNum=0,s.curRewardId=GameUtil.getStarRewardID(s.starNum)-s.rewardNum,GameUtil.setRewardNumByMapID(n,0);var a=0;a=s.starNum<90?c.REWARD_STATUS.CAN_NOT_GET:c.REWARD_STATUS.FINISHED,c._updateGiftBtnStatus(i,a,s.rewardNum),eventDispatcher.dispatchEvent(EventID.STAR_GIFT_NUM_CHANGED)}else TipWindow.Show(e.ret_desc);else{s.rewardNum=t.get_star_reward_res.star_reward_num,s.curRewardId=GameUtil.getStarRewardID(s.starNum)-s.rewardNum,GameUtil.setRewardNumByMapID(n,t.get_star_reward_res.star_reward_num);a=0;a=t.get_star_reward_res.star_reward_num>0?c.REWARD_STATUS.CAN_GET:s.starNum<90?c.REWARD_STATUS.CAN_NOT_GET:c.REWARD_STATUS.FINISHED,c._updateGiftBtnStatus(i,a,s.rewardNum),eventDispatcher.dispatchEvent(EventID.STAR_GIFT_NUM_CHANGED),r&&c.showGetRewardEffect(r)}})}else r&&StarRewardPreview.Show({map:this._map,curRewardId:s.curRewardId,star_num:s.starNum,map_id:n,reward_list:r,stageDataList:this._map.stageDataList})}},_onExitTouched:function(){MiniMapWindow.Destroy()},_getItemBtnIndex:function(e){return e.getParent().getIdx()},scrollViewDidScroll:function(e){},tableCellTouched:function(e,t){var i=t.getIdx();console.log("cell touched at index: "+i),this._mapStageList._bClickPanel?this._onItemBkgTouched(i):this._onExitTouched()},tableCellSizeForIndex:function(e,t){return cc.size(cc.winSize.width,this._itemHeight)},tableCellAtIndex:function(e,t){console.log("tableCellAtIndex "+t);var i,a=t,s=this._detailsList[a],n=e.dequeueCell();if(null==n){if(n=new cc.TableViewCell,null==s)return console.log("null == itemData"),n;var r=s.isActive,o=this.createActiveItem(a);o.setTag(100),n.addChild(o),r?(o.setVisible(!0),i=o):o.setVisible(!1);var c=this.createDisabledItem(a);c.setTag(200),n.addChild(c),r?c.setVisible(!1):(c.setVisible(!0),i=c)}else{if(null==s)return console.log("cell: null == itemData"),n;s.isActive?((i=n.getChildByTag(100)).setVisible(!0),n.getChildByTag(200).setVisible(!1)):((i=n.getChildByTag(200)).setVisible(!0),n.getChildByTag(100).setVisible(!1))}var l=0,d=i.getChildByName("progressImg"),h=s.starNum;h=(h=h>90?90:h)>80?80+2*(h-80):h,d&&(l=Math.round(h*this._proPanelWidth/120),d.setContentSize(l,16));var m=i.getChildByName("starImg");m&&(l=l<10?10+l:l,m.setPositionX(184+l));var g=i.getChildByName("stageNum");if(g){l=l<32?32:l,g.setPositionX(184+l);var _=g.getChildByTag(111);if(_){var u=s.starNum>90?90:s.starNum;_.setString(u+" / 90")}}var p=i.getChildByName("proPanel");g=p.getChildByName("stage_left"),h=a*MaxItemNumPerPage+1,g&&g.setString(h.toString(),!1);var w=0;return w=h>=100?48:h<100&&h>=10?26:8,(g=p.getChildByName("stage_-"))&&g.setPositionX(20+w),g=p.getChildByName("stage_right"),h=(a+1)*MaxItemNumPerPage,g&&(g.setString(h.toString(),!1),g.setPositionX(30+w)),this._updateGiftBtnStatus(i,s.rewardType,s.rewardNum),n},_updateGiftBtnStatus:function(e,t,i){var a=e.getChildByName("giftBtn");if(null!=a){var s=e.getChildByName("finishedBtn"),n=e.getChildByName("canNotGetBtn"),r=a.getChildByTag(100),o=a.getChildByTag(101);this.REWARD_STATUS.CAN_GET==t?(a.setVisible(!0),a.setTouchEnabled(!0),i>0?(r.setVisible(!0),o.setVisible(!0),o.setString(i)):(r.setVisible(!1),o.setVisible(!1)),s.setVisible(!1),n.setVisible(!1)):this.REWARD_STATUS.CAN_NOT_GET==t?(a.setVisible(!0),a.setTouchEnabled(!0),r.setVisible(!1),o.setVisible(!1),s.setVisible(!1),n.setVisible(!0)):this.REWARD_STATUS.FINISHED==t&&(a.setVisible(!0),a.setTouchEnabled(!1),r.setVisible(!1),o.setVisible(!1),s.setVisible(!0),n.setVisible(!1))}},numberOfCellsInTableView:function(e){return this._detailsList?this._detailsList.length:0},onShow:function(){this._super()},onHideNotify:function(){TopGoldBar.Show()},onDestroyNotify:function(){TopGoldBar.Show()},onDestroy:function(){this._super(),this._mapStageList.removeAllChildren(),this._mapStageList.removeFromParent(!0),this._mapStageList=null},getCurRewardPack:function(e,t){var i=cc.loader.cache[res.map_conf_bin_json],a=cc.loader.cache[res.MapStarRewardPool_bin_json];i=i&&i.list_data||[],a=a&&a.list_data||[];e=e;for(var s=t,n=0,r=[],o=null,c=0;c<i.length;c++){if((l=i[c]).map_id==e){n=l.star_reward_list[s-1];break}}for(c=0;c<a.length;c++){var l;if((l=a[c]).id==n){o=l;break}}if(o)for(c=0;c<o.reward_cnt;c++)r.push(o.reward_list[c]);return r},showGetRewardEffect:function(e){var t=cc.winSize.width,i=cc.winSize.height,a=new Mask;a.setGrey(!0),this.addChild(a,1);var s=UIHelper.createPanel({position:UIHelper.getCenterPosition(),anchorPoint:cc.p(.5,.5),bTouchEnable:!0,size:cc.size(t,i)});a.addChild(s,2);var n=new GiftShineEffect;n.visible=!1,n.setPosition(UIHelper.getCenterPosition()),n.setScale(3.5),s.addChild(n);var r=new GiftGetEffect;r.setPosition(UIHelper.getCenterPosition()),r.setScale(1.5),r.play(),s.addChild(r);var o=new GiftLightEffect;o.visible=!1,o.setPosition(UIHelper.getCenterPosition()),o.setScale(1.5),s.addChild(o);var c=UIHelper.seekWidgetByName(r,"Panel_8");c.setBackGroundColorType(ccui.Layout.BG_COLOR_NONE);var l=this.createRewardList(e);l.setPosition(cc.p(100,100)),c.addChild(l),Timeout.register(function(){o.play(),o.visible=!0,n.play(),n.visible=!0},2200),Timeout.register(function(){a.removeFromParent()},4e3)},createRewardList:function(e){var t=UIHelper.createList({anchorPoint:cc.p(.5,.5),contentSize:cc.size(300,120*e.length),direction:ccui.ScrollView.DIR_VERTICAL,bounceEnabled:!1,touchEnabled:!1});t.setScale(.8);for(var i=0;i<e.length;i++){var a=e[i],s=UIHelper.createPanel({size:cc.size(300,120)});t.pushBackCustomItem(s);var n=GameUtil.getGoodsImageById(a.article_type,a.article_subtype,a.article_id),r=UIHelper.createImage({imageFileName:n,bPlistTexture:!0,anchorPoint:cc.p(.5,.5),position:cc.p(150,70)});r.setScale(.8),s.addChild(r);var o=new cc.LabelBMFont("X"+a.article_count,res.number_stage_y_fnt);o.setPosition(150,2),o.setAnchorPoint(cc.p(.5,0)),o.setScale(.8),s.addChild(o)}return t}});MiniMapWindow.GetInstance=function(e){return null==MiniMapWindow._instance&&(MiniMapWindow._instance=new MiniMapWindow(e)),MiniMapWindow._instance},MiniMapWindow.Show=function(e,t){ResLoader.showSubResLoadingWindow(ResObjects.getResObject(ResObjectConfig.miniMap),function(){var i=MiniMapWindow.GetInstance(e),a=WindowAction.getScaleEaseElasticOutAction(i);t&&(a=null),WindowManager.GetInstance().showWindow(i,a,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,MiniMapWindow.Destroy)})},MiniMapWindow.Hide=function(){WindowManager.GetInstance().hideWindow(MiniMapWindow._instance)},MiniMapWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(MiniMapWindow._instance),MiniMapWindow._instance=null};
var NotifyType={sendHeart:1,inviteMatch:2},NotifyWindow=WindowBase.extend({_panel:null,config:{openid:"",notifyType:NotifyType.sendHeart},ctor:function(){this._super();var e=UIHelper.createImage({imageFileName:"bg_dialog.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(512,520),capInsets:cc.rect(0,72,512,22),position:cc.p(cc.winSize.width/2,cc.winSize.height/2)});this.addChild(e);var t=UIHelper.createPanel({anchorPoint:e.getAnchorPoint(),position:e.getPosition(),size:e.getContentSize()});this.addChild(t),this._panel=t;var i=UIHelper.createImage({imageFileName:"cm_gray_bg.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(410,140),capInsets:cc.rect(0,0,10,10),position:cc.p(256,333)});e.addChild(i);var n=UIHelper.createButton({normalFile:"m_green_btn.png",bPressedActionEnabled:!0,bPlistTexture:!0,position:cc.p(124,55),bTouchEnable:!0});n.addTouchEventListener(this._onCloseButtonTouched,this),e.addChild(n);var o=new cc.Sprite;o.initWithSpriteFrameName("cm_next_time.png"),o.setPosition(cc.p(85,40)),n.addChild(o);var c=UIHelper.createButton({normalFile:"m_red_btn.png",bPressedActionEnabled:!0,bPlistTexture:!0,position:cc.p(387,55),bTouchEnable:!0});c.addTouchEventListener(this._onSureButtonTouched,this),e.addChild(c);var a=new cc.Sprite;a.initWithSpriteFrameName("cm_tell_he.png"),a.setPosition(cc.p(85,40)),c.addChild(a)},_onCloseButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(console.log("_onCloseButtonTouched"),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),NotifyWindow.Destroy())},_onSureButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(console.log("_onSureButtonTouched"),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),NetLoadingWindow.Show(),this._sendNotifyFriendRequest(),NotifyWindow.Destroy())},_sendNotifyFriendRequest:function(){switch(this.config.notifyType){case NotifyType.sendHeart:this._sendNotifySendHeartRequest();break;case NotifyType.inviteMatch:this._sendNotifyInviteMatchRequest()}},_sendNotifySendHeartRequest:function(){GameService.sendHeartNtf({friend_openid:this.config.openid},function(e,t){NetLoadingWindow.Hide(),e&&(console.log("送心通知失败"),TipWindow.Show(e.ret_desc))})},_sendNotifyInviteMatchRequest:function(){NetLoadingWindow.Hide(),"function"==typeof this.config.successCallBack&&this.config.successCallBack()},onShowNotify:function(){var e=this._panel;e.removeAllChildren();var t=new cc.Sprite,i=this._getIconFrameName();t.initWithSpriteFrameName(i),t.setPosition(cc.p(256,356)),e.addChild(t);var n=this._getDescribeContent(),o=UIHelper.createText({position:cc.p(256,293),anchorPoint:cc.p(.5,.5),fontSize:24,fontColor:cc.color(59,189,191),content:n});e.addChild(o,1);i=this._getPlatformIconFrameName();var c=new cc.Sprite;c.setAnchorPoint(cc.p(.5,0)),c.initWithSpriteFrameName(i),c.setPosition(cc.p(111,158)),e.addChild(c);n=this._getTipContent();var a=UIHelper.createText({position:cc.p(151,182),anchorPoint:cc.p(0,.5),fontSize:35,fontColor:cc.color(255,255,255),content:n});e.addChild(a,1)},_getTipContent:function(){var e="";switch(this.config.notifyType){case NotifyType.sendHeart:e="wechat"==GameService.pf?Language.getString(LanguageKey.NOTIFY_FRIEND_BY_WECHAT):Language.getString(LanguageKey.NOTIFY_FRIEND_BY_QQ);break;case NotifyType.inviteMatch:e=Language.getString(LanguageKey.NOTIFY_FRIEND_GO_ONLINE_NOW)}return e},_getPlatformIconFrameName:function(){return"wechat"==GameService.pf?"logo_weixin.png":"logo_qq.png"},_getDescribeContent:function(){var e="";switch(this.config.notifyType){case NotifyType.sendHeart:e=Language.getString(LanguageKey.SEND_HEART_SUCCESS);break;case NotifyType.inviteMatch:e=Language.getString(LanguageKey.NOTIFY_FRIEND_GET_REWARD)}return e},_getIconFrameName:function(){var e="";switch(this.config.notifyType){case NotifyType.sendHeart:case NotifyType.inviteMatch:e="cm_heart_arrived.png"}return e},setConfig:function(e){this.config=e}});NotifyWindow.GetInstance=function(){return null==NotifyWindow._instance&&(NotifyWindow._instance=new NotifyWindow),NotifyWindow._instance},NotifyWindow.Show=function(e){var t=NotifyWindow.GetInstance();t.setConfig(e);var i=WindowAction.getScaleEaseElasticOutAction(t);WindowManager.GetInstance().showWindow(t,i,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,NotifyWindow.Destroy)},NotifyWindow.Hide=function(){WindowManager.GetInstance().hideWindow(NotifyWindow._instance)},NotifyWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(NotifyWindow._instance),NotifyWindow._instance=null};
var OKCancelWindow=WindowBase.extend({_title:null,_titleText:null,_content:null,_contentText:null,_maxWidth:null,_sureButtonTouchedCallBack:null,ctor:function(){this._super();var t=cc.size(480,400);this._maxWidth=t.width-40;var n=UIHelper.createImage({imageFileName:"bg_dialog.png",bPlistTexture:!0,bScale9Enabled:!0,size:t,capInsets:cc.rect(0,72,512,22),position:UIHelper.getPosition(320,570)});this.addChild(n);(i=UIHelper.createButton({normalFile:"m_green_btn.png",bPlistTexture:!0,bPressedActionEnabled:!0,position:cc.p(t.width/2-120,50),bTouchEnable:!0})).addTouchEventListener(this._onCancelButtonTouched,this),n.addChild(i);var e=new cc.Sprite;e.initWithSpriteFrameName("btn_title_cancel.png"),e.setPosition(85,40),i.addChild(e,1);(i=UIHelper.createButton({normalFile:"m_red_btn.png",bPlistTexture:!0,bPressedActionEnabled:!0,position:cc.p(t.width/2+120,50),bTouchEnable:!0})).addTouchEventListener(this._onSureButtonTouched,this),n.addChild(i),(e=new cc.Sprite).initWithSpriteFrameName("btn_title_sure.png"),e.setPosition(85,40),i.addChild(e,1);var i=UIHelper.createText({position:cc.p(t.width/2,356),fontSize:30,fontColor:cc.color(255,255,255),content:"",bIgnoreSize:!0});n.addChild(i),this._titleText=i,i=UIHelper.createText({position:cc.p(t.width/2,230),fontSize:26,fontColor:cc.color(255,255,255),content:"",bIgnoreSize:!1}),n.addChild(i),this._contentText=i},setSureButtonTouchedCallBack:function(t){this._sureButtonTouchedCallBack=t},_onCancelButtonTouched:function(t,n){ccui.Widget.TOUCH_ENDED==n&&(OKCancelWindow.Hide(),OKCancelWindow.Destroy())},_onSureButtonTouched:function(t,n){ccui.Widget.TOUCH_ENDED==n&&("function"==typeof this._sureButtonTouchedCallBack&&this._sureButtonTouchedCallBack(),OKCancelWindow.Hide(),OKCancelWindow.Destroy())},setContent:function(t,n){this._title=t,this._content=n},onShowNotify:function(){null!=this._content&&(UIHelper.subsectionTextForUIText(this._contentText,this._content,this._maxWidth),this._contentText.setTextHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),UIHelper.subsectionTextForUIText(this._titleText,this._title,this._maxWidth)),this._content=null,this._title=null},onShow:function(){},onHideNotify:function(){},onHide:function(){},onDestroyNotify:function(){},onDestroy:function(){},onCover:function(){},onResume:function(){}});OKCancelWindow.GetInstance=function(){return null==OKCancelWindow._instance&&(OKCancelWindow._instance=new OKCancelWindow),OKCancelWindow._instance},OKCancelWindow.Show=function(t,n,e){var i=OKCancelWindow.GetInstance();i.setContent(t,n),i.setSureButtonTouchedCallBack(e);var o=WindowAction.getScaleEaseElasticOutAction(i);WindowManager.GetInstance().showWindow(i,o,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,OKCancelWindow.Destroy)},OKCancelWindow.Hide=function(){WindowManager.GetInstance().hideWindow(OKCancelWindow._instance)},OKCancelWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(OKCancelWindow._instance),OKCancelWindow._instance=null};
var AnimationEffectPreCreateLogic={_preCreateOperateList:null,_updateProxy:null,_createCountSecondFrame:2,startPreCreate:function(){AnimationCacheManager.init(),this._preCreateOperateList=[],this._preCreateOperateList=this._preCreateOperateList.concat(OriginalAnimationPreCreate.getPreCreateList()),this._updateProxy=new UpdateProxy(this._onUpdate.bind(this)),this._updateProxy.start(),console.log("AnimationEffectPreCreateLogic.startPreCreate : "+this._preCreateOperateList.length)},stopPreCreate:function(){console.log("AnimationEffectPreCreateLogic.stopPreCreate"),this._updateProxy&&this._updateProxy.release(),AnimationCacheManager._log()},_onUpdate:function(e){for(var t=0;t<this._createCountSecondFrame;t++){var r=this._preCreateOperateList.shift();null!=r&&r.fun.apply(r.funCaller,r.arguments)}0==this._preCreateOperateList.length&&this._updateProxy.pause()}},ChessPreCreateLogic={_preCreateOperateList:null,_updateProxy:null,_createCountSecondFrame:1,startPreCreate:function(){ChessCacheManager.init(),this._preCreateOperateList=[],this._preCreateOperateList=this._preCreateOperateList.concat(OriginalChessPreCreate.getPreCreateList()),this._updateProxy=new UpdateProxy(this._onUpdate.bind(this)),this._updateProxy.start(),console.log("ChessPreCreateLogic.startPreCreate : "+this._preCreateOperateList.length)},stopPreCreate:function(){console.log("ChessPreCreateLogic.stopPreCreate"),this._updateProxy&&this._updateProxy.release(),this._preCreateOperateList=[],ChessCacheManager._log()},_onUpdate:function(e){for(var t=0;t<this._createCountSecondFrame;t++){var r=this._preCreateOperateList.shift();null!=r&&r.fun.apply(r.funCaller,r.arguments)}0==this._preCreateOperateList.length&&this._updateProxy.pause()}};
var PreHandleGameResLogic={_bCallStop:!1,_bOpen:!0,_bLoading:!1,_bCallStopInMainGamePage:!1,handle:function(){if(this._bOpen&&!this._bLoading){this._bLoading=!0,this._bCallStop=!1;var e=ResObjects.getResObject(ResObjectConfig.preLoadGame);ResLoader.silenceLoadRes(e,function(){this._bLoading=!1,this._bCallStop||(AnimationEffectPreCreateLogic.startPreCreate(),ChessPreCreateLogic.startPreCreate())}.bind(this),function(){this._bLoading=!1}.bind(this))}},stop:function(e){this._bOpen&&(this._bCallStop=!0,this._bCallStopInMainGamePage=e,AnimationEffectPreCreateLogic.stopPreCreate(),ChessPreCreateLogic.stopPreCreate())}};
var PreloadStageResLogic={_bLoading:!1,_bLoadedBgRes:!1,preLoadStageRes:function(e){this._bLoading||(this._bLoading=!0,RemoveLogic.StageLoader.loadStage(e,function(){var a=ResObjects.getResObject(ResObjectConfig.preloadStage);a.setStageId(e),ResLoader.silenceLoadRes(a,function(){console.warn("preLoadStageRes ok"),this._bLoading=!1}.bind(this),function(){console.warn("preLoadStageRes failed"),this._bLoading=!1}.bind(this))}))},loadNextStage:function(){console.info("loadNextStage=========");var e=GameProxy.getStageId();if(console.info("currentStageId: "+e),last_max_stage_id<e&&e<MAX_STAGE_ID){var a=e+1;this.preLoadStageRes(new StageId(a,0))}if(!this._bLoadedBgRes){var t=new ResObject(subResList.GameBgRes);ResLoader.silenceLoadRes(t,function(){console.warn("preLoadBgRes ok"),this._bLoadedBgRes=!0}.bind(this),function(){console.warn("preLoadBgRes failed")}.bind(this))}},loadMaxStage:function(){console.info("loadMaxStage=========");var e=NetData.statics_ntf.stage_statics.max_stage_id,a=e<MAX_STAGE_ID?e+1:MAX_STAGE_ID;this.preLoadStageRes(new StageId(a,0))}};
var RankType="friendRank",RankListWindow=WindowBase.extend({_rankList:null,_detailsList:[],_bottomMore:null,_bkgWidth:620,_bkgHeight:1020,_itemHeight:110,_currPageIndex:1,_currItemNum:0,_listenerList:null,ctor:function(){this._super(),this._listenerList=[],Util.registerListener(this._listenerList,EventID.REFRESH_RANK_EVENT,this._refreshRankList.bind(this));var e=rankData.getRankListData();this._currPageIndex=rankData._currPageID,e&&e.length>0&&(rankData.freshRankIndex(),this.initRankList(!1)),this.initView(),this.scheduleUpdate()},update:function(){this.mypanel&&this.subTex&&this._rankList&&(0==this.updateStep++&&(this.subTex.initWithElement(sharedCanvas),this.subTex.handleLoadedTexture()),window.subUpdateRate.RANK==this.updateStep&&(this.updateStep=0))},initView:function(){this.updateStep=0;var e=cc.winSize.width,t=cc.winSize.height,i=UIHelper.createPanel({anchorPoint:cc.p(.5,.5),position:UIHelper.getCenterPosition(),size:cc.size(e,t),bTouchEnable:!1});this.addChild(i);var n=cc.size(this._bkgWidth,this._bkgHeight),a=UIHelper.createImage({imageFileName:"m_bkg.png",bPlistTexture:!0,bScale9Enabled:!0,size:n,capInsets:cc.rect(0,118,620,10),position:cc.p(e/2,t/2)});a.setAnchorPoint(.5,.5),i.addChild(a,0);var s=UIHelper.createButton({normalFile:"btn_back_N.png",bPlistTexture:!0,position:cc.p(e/2-a.width/2+40,t/2+a.height/2-36),bTouchEnable:!0});s.addTouchEventListener(this._onBackButtonTouched,this),i.addChild(s,0);var r=subRectMap("Rank");this.subTex=new cc.Texture2D,this.subTex.initWithElement(sharedCanvas),this.subTex.handleLoadedTexture(),this._rankList=new cc.Sprite(this.subTex,r),this._rankList.setAnchorPoint(cc.p(0,0)),this._rankList.setPosition(e/2-a.width/2,t/2-a.height/2),i.addChild(this._rankList,0);var o={req:RankType,data:{userInfo:NetData.user_info,staticsNtf:NetData.statics_ntf,screenWidth:e,screenHeight:t,bgWidth:a.width,bgHeight:a.height,windowWidth:window.innerWidth,windowHeight:window.innerHeight},rect:r};wx.postMessage(o);var c=UIHelper.createImage({imageFileName:"rank_bottom_blue.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(this._bkgWidth-14,18),capInsets:cc.rect(30,0,4,18),position:cc.p(e/2,t/2-this._bkgHeight/2+7)});c.setAnchorPoint(.5,0),i.addChild(c,0),(c=new cc.Sprite).initWithSpriteFrameName("rank_arrow.png"),c.setPosition(e/2,t/2-396),c.setVisible(!1),i.addChild(c,0),this._bottomMore=c;var d="friendRank"==RankType?"好友排行榜":"群排行榜",l=new cc.LabelTTF(d,"Arial",40,cc.size(356,42));l.setAnchorPoint(.5,.5),l.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),l.setPosition(e/2,s.getPositionY()-26),i.addChild(l),this._detailsList.length>6?this._bottomMore.setVisible(!0):this._bottomMore.setVisible(!1),this.mypanel=i,this.screenWidth=e,this.screenHeight=t,this.bgView=a},_getPageDataFromServer:function(e,t){var i={rank_type:RankType.RANK_TYPE_MAX_STAGE,page_id:e,page_size:MaxItemNumPerPage},n=this;GameService.updateRankListByPage(i,function(e,i){e?console.log("err code: "+e.ret):(n._currPageIndex=i.page_id,rankData.addRankListData(i),t?t():n.initRankList(!0),rankData._dataModified=!1)})},_onBackButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(Util.unRegisterListeners(this._listenerList),wx.postMessage({req:"close"}),this._rankList.removeAllChildren(),this._rankList.removeFromParent(!0),this._rankList=null,this._detailsList.splice(0),RankListWindow.Destroy(),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch))},createList:function(){var e=new cc.TableView(this,cc.size(this._bkgWidth,this._bkgHeight-146));return e.setAnchorPoint(0,0),e.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),e.setDelegate(this),e.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),e},initRankList:function(e){for(var t,i,n=[],a=rankData.getRankListDataByID(this._currPageIndex),s=a.length,r=[],o=0;o<s;++o)t={openid:(i=a[o]).openid,stage_id:i.stage_id,star_count:i.star_count,recv_heart_state:i.recv_heart_state,is_in_cd:i.is_in_cd,last_send_heart_time:i.last_send_heart_time},n.push(t),r.push(i.openid);console.log("initRankList: total= "+s),this._detailsList=n,console.log("RankListWindow: avatarList.length= "+r.length),e&&GameService.getPlayerBaseinfo({openid_list:r},function(e,t){e&&console.log("RankListWindow: 拉取基本信息失败")})},createRankItem:function(){var e=UIHelper.createPanel({anchorPoint:cc.p(0,0),position:cc.p(0,0),size:cc.size(this._bkgWidth-140,this._itemHeight)}),t=UIHelper.createImage({imageFileName:"rank_bkg_mine.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(this._bkgWidth-18,this._itemHeight),capInsets:cc.rect(4,4,2,2),position:cc.p(this._bkgWidth/2,this._itemHeight/2+4)});t.setName("bkgImage"),t.setVisible(!1),e.addChild(t);var i=new cc.LabelBMFont("",res.number_white_fnt);i.setAnchorPoint(.5,.5),i.setPosition(58,50),i.setName("index"),e.addChild(i);var n=new cc.Sprite;n.initWithSpriteFrameName("m_head_frame.png"),n.setPosition(58,50),n.setName("crown"),e.addChild(n);var a=UIHelper.createImage({imageFileName:"m_head_frame.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(66,66),capInsets:cc.rect(5,5,2,2),position:cc.p(150,this._itemHeight/2-10)});a.setAnchorPoint(.5,.5),a.setName("avatar"),e.addChild(a,0);var s=new cc.LabelTTF("","Arial",18,cc.size(356,24));s.setAnchorPoint(0,.5),s.setPosition(116,92),s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_LEFT),s.setName("nickName"),e.addChild(s,1);var r=new cc.LabelTTF("","Arial",26,cc.size(380,36));r.setString("冒险          关"),r.setAnchorPoint(0,.5),r.setPosition(306,36),r.setHorizontalAlignment(cc.TEXT_ALIGNMENT_LEFT),e.addChild(r,1),(i=new cc.LabelBMFont("",res.number_white_fnt)).setAnchorPoint(.5,.5),i.setPosition(392,38),i.setName("stageNum"),e.addChild(i);var o=UIHelper.createImage({imageFileName:"m_text_bottom.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(92,26),capInsets:cc.rect(27,10,4,4),position:cc.p(396,88)}),c=new cc.Sprite;c.initWithSpriteFrameName("rank_star.png"),c.setPosition(24,13),o.addChild(c),e.addChild(o),(i=new cc.LabelBMFont("",res.number_gold_fnt)).setAnchorPoint(.5,.5),i.setPosition(410,88),i.setName("starNum"),e.addChild(i);var d=new ccui.Layout;d.setContentSize(50,50),d.setPosition(512,38),d.setName("heartPanel"),e.addChild(d),(o=UIHelper.createImage({imageFileName:"m_text_bottom.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(80,23),capInsets:cc.rect(27,10,4,4),position:cc.p(536,94)})).setName("timeBottom"),o.setVisible(!1),e.addChild(o),(r=new cc.LabelTTF("","Arial",18,cc.size(100,24))).setFontFillColor(cc.color(255,255,255)),r.setAnchorPoint(.5,.5),r.setPosition(538,94),r.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),r.setName("timeLeft"),r.setVisible(!1),e.addChild(r,0);var l=UIHelper.createImage({imageFileName:"rank_inter_s.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(this._bkgWidth-16,2),capInsets:cc.rect(10,0,2,2),position:cc.p(this._bkgWidth/2,1)});return e.addChild(l),e},_createPageButton:function(e){var t=cc.p(this._bkgWidth/2,this._bkgHeight/2),i=UIHelper.createPanel({anchorPoint:cc.p(.5,.5),position:t,size:cc.size(this._bkgWidth,this._bkgHeight),bTouchEnable:!1}),n=null;if(t=cc.p(this._bkgWidth/2,50),e){(n=UIHelper.createButton({normalFile:"rank_btn_pre.png",bPlistTexture:!0,position:t,bTouchEnable:!0})).addTouchEventListener(this._onUpPageBtnTouched,this),i.addChild(n);var a=UIHelper.createImage({imageFileName:"rank_inter_s.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(this._bkgWidth-16,2),capInsets:cc.rect(10,0,2,2),position:cc.p(this._bkgWidth/2,1)});i.addChild(a)}else(n=UIHelper.createButton({normalFile:"rank_btn_next.png",bPlistTexture:!0,position:t,bTouchEnable:!0})).addTouchEventListener(this._onDownPageBtnTouched,this),i.addChild(n);return i},_onUpPageBtnTouched:function(e,t){if(ccui.Widget.TOUCH_ENDED==t){console.log("_onUpPageBtnTouched"),this._currPageIndex-=1;var i=e.getParent();i.removeAllChildren(!0);var n=ccs.load(res.loading2_json);n.node.setPosition(this._bkgWidth/2,32),i.addChild(n.node),n.node.runAction(n.action),n.action.gotoFrameAndPlay(0,n.action.getDuration(),0,!0);var a=this,s=this._currPageIndex;this._getPageDataFromServer(s,function(){if(n.node.stopAllActions(),n.node.removeFromParent(!0),i=null,a.initRankList(!0),this._currPageIndex>1){var e=this._rankList.getContentOffset();e.y+=this._itemHeight+6,a._rankList.setContentOffset(e)}})}},_onDownPageBtnTouched:function(e,t){if(ccui.Widget.TOUCH_ENDED==t){console.log("_onDownPageBtnTouched"),this._currPageIndex+=1;var i=e.getParent();i.removeAllChildren(!0);var n=ccs.load(res.loading2_json);n.node.setPosition(this._bkgWidth/2,32),i.addChild(n.node),n.node.runAction(n.action),n.action.gotoFrameAndPlay(0,n.action.getDuration(),0,!0);var a=this,s=this._currPageIndex;this._getPageDataFromServer(s,function(){n.node.stopAllActions(),n.node.removeFromParent(!0),i=null,a.initRankList(!0);var e=a._rankList.getContentOffset();e.y+=a._itemHeight+6,a._rankList.setContentOffset(e)})}},updateButton:function(e,t){return},_getBtnRankIndex:function(e){var t=e.getParent(),i=this._currPageIndex>1?-1:0,n=t.getIdx();return n+=i},_onRankOffTouched:function(e,t){var i=e.getParent().getParent(),n=this._getBtnRankIndex(i),a=this._detailsList[n],s=this;RejectWindow.Show("拒收好友爱心",function(e){e&&(NetLoadingWindow.Show(),rankData._dataModified=!0,GameService.setProfile({recv_heart_state:0},function(){console.log("_onRankOffTouched: recv_heart_state= 1"),NetLoadingWindow.Hide(),a.recv_heart_state=0;var e=null!=NetData.map_friend_ntf.friend_list?NetData.map_friend_ntf.friend_list[n]:null;e&&(e.recv_heart_state=0),s.updateButton(i,a)}))})},_onRankOnBtnTouched:function(e,t){if(ccui.Widget.TOUCH_ENDED==t){var i=e.getParent().getParent(),n=this._getBtnRankIndex(i),a=this._detailsList[n];NetLoadingWindow.Show();var s=this;GameService.setProfile({recv_heart_state:1},function(){console.log("_onRankOnBtnTouched: recv_heart_state= 1"),NetLoadingWindow.Hide(),rankData._dataModified=!0,a.recv_heart_state=1;var e=null!=NetData.map_friend_ntf.friend_list?NetData.map_friend_ntf.friend_list[n]:null;e&&(e.recv_heart_state=1),s.updateButton(i,a)})}},_onSendBtnTouched:function(e,t){if(ccui.Widget.TOUCH_ENDED==t){var i=e.getParent().getParent(),n=this._getBtnRankIndex(i),a=this._detailsList[n],s=rankData.getRankListDataByID(this._currPageIndex)[n];NetLoadingWindow.Show();var r=this;GameUtil.sendHeartToFriend(a.openid,function(e){NetLoadingWindow.Hide(),a.is_in_cd=!0,s.is_in_cd=!0;var t=.001*Date.now();a.last_send_heart_time=t,s.last_send_heart_time=t;var o=null!=NetData.map_friend_ntf.friend_list?NetData.map_friend_ntf.friend_list[n]:null;o&&(o.is_in_cd=!0,o.last_send_heart_time=t),r.updateButton(i,a),r._showTimeCount(i,t),eventDispatcher.dispatchEvent(EventID.RANK_SEND_HEART_EVENT,a.openid)})}},_showTimeCount:function(e,t){var i=e.getChildByName("timeBottom");if(1!=i.isVisible()){i.setVisible(!0);var n=e.getChildByName("timeLeft");n.setVisible(!0);var a=0,s=t;s=s<=0?.001*Date.now()-100:s,a=this._getLeftTime(s),n.setString(a);var r=this;this.schedule(function(){a=r._getLeftTime(s),n.setString(a)},1,4,0,""),this.scheduleOnce(function(){i.setVisible(!1),n.setVisible(!1)},4.2,"")}},_onSendOKBtnTouched:function(e,t){if(ccui.Widget.TOUCH_ENDED==t){var i=e.getParent().getParent(),n=this._getBtnRankIndex(i),a=this._detailsList[n];this._showTimeCount(i,a.last_send_heart_time)}},_getLeftTime:function(e){var t=.001*Date.now()-e;if((t=Math.round(10800-t))<0||t>10800)return t="3:00:00";var i=Math.floor(t/3600),n=Math.floor((t-60*i*60)/60);n<10&&(n="0"+n);var a=t-60*i*60-60*n;return a<10&&(a="0"+a),t=i+":"+n+":"+a},scrollViewDidScroll:function(e){},tableCellTouched:function(e,t){console.log("cell touched at index: "+t.getIdx())},tableCellSizeForIndex:function(e,t){var i=cc.size(this._bkgWidth,this._itemHeight);return i.height+=5,i},tableCellAtIndex:function(e,t){console.log("tableCellAtIndex "+t);var i=e.dequeueCell(),n=null;if(null==i)i=new cc.TableViewCell,(n=this.createRankItem()).setTag(10),i.addChild(n);else{n=i.getChildByTag(10);var a=i.getChildByTag(2);a&&a.removeFromParent(!0),n.setVisible(!0)}var s=t;s+=this._currPageIndex>1?-1:0;var r=this._detailsList[s];if(null==r)return console.log("Error:null == itemData)"),i;var o=n.getChildByName("index"),c=n.getChildByName("crown"),d=s;if(0<=d&&d<3){c.setVisible(!0),o.setVisible(!1);var l=this._getNoItemResName(d);c.initWithSpriteFrameName(l)}else c.setVisible(!1),o.setVisible(!0),o.setString(s+(this._currPageIndex-1)*MaxItemNumPerPage+1);var h=rankData.getAvatarDataByOpenid(r.openid);if(console.log("itemData.openid= "+r.openid),(o=n.getChildByName("nickName")).setString(""),h){var _=h.nick||"",g=12,u=_.substring(0,g).replace(/[^\x00-\xff]/g,"rr").length-g;_.length>g&&(g=g-u+Math.ceil(u/2),_=UIHelper.clipLongTextLabel(o,_,22,350,g+4)),o.setString(_)}else console.log("Error:null == avatarData");(o=n.getChildByName("stageNum")).setString(r.stage_id),o=n.getChildByName("starNum");var m=r.star_count;m=m>3*r.stage_id?3*r.stage_id:m,o.setString(m),this.updateButton(n,r);var p=n.getChildByName("avatar");return p.removeAllChildren(!0),h&&h.avatar?(h.avatar.removeFromParent(),p.addChild(h.avatar),h.avatar.setPosition(30,30)):console.log("Error:null == avatarData && avatarData.avatar"),i},numberOfCellsInTableView:function(e){var t=0;return this._detailsList?(t=this._detailsList.length,this._currPageIndex>1&&(t+=1),rankData._totalPage-this._currPageIndex>0&&(t+=1),this._currItemNum=t,t):t},_getNoItemResName:function(e){var t=null;if(1==this._currPageIndex)switch(e){case 0:t="rank_no_1.png";break;case 1:t="rank_no_2.png";break;case 2:t="rank_no_3.png"}else switch(e){case 0:t="rank_gold.png";break;case 1:t="rank_brone.png";break;case 2:t="rank_silver.png"}return t},_refreshRankList:function(){this._rankList&&this._rankList.reloadData()},onShow:function(){this._super()},onHideNotify:function(){TopGoldBar.Show()},onDestroyNotify:function(){TopGoldBar.Show()}});RankListWindow.GetInstance=function(){return null==RankListWindow._instance&&(RankListWindow._instance=new RankListWindow),RankListWindow._instance},RankListWindow.Show=function(e){RankListWindow.Destroy(),RankType=e,ResLoader.showSubResLoadingWindow(ResObjects.getResObject(ResObjectConfig.rankList),function(){var e=RankListWindow.GetInstance(),t=WindowAction.getScaleEaseElasticOutAction(e);WindowManager.GetInstance().showWindow(e,t,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,RankListWindow.Destroy)})},RankListWindow.Hide=function(){WindowManager.GetInstance().hideWindow(RankListWindow._instance)},RankListWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(RankListWindow._instance),RankListWindow._instance=null};
var RejectWindow=WindowBase.extend({_title:null,_titleText:null,_maxWidth:null,_buttonTouchedCallBack:null,ctor:function(){this._super();var e=cc.size(480,460);this._maxWidth=e.width-124;var t=UIHelper.createImage({imageFileName:"bg_dialog.png",bPlistTexture:!0,bScale9Enabled:!0,size:e,capInsets:cc.rect(0,72,512,22),position:UIHelper.getPosition(320,570)});this.addChild(t);var n=UIHelper.createButton({normalFile:"m_red_btn.png",bPlistTexture:!0,bPressedActionEnabled:!0,position:cc.p(e.width/2-120,50),bTouchEnable:!0});n.addTouchEventListener(this._onSureButtonTouched,this),t.addChild(n);(i=new cc.Sprite).initWithSpriteFrameName("dailog_reject.png"),i.setPosition(84,38),n.addChild(i,1),(n=UIHelper.createButton({normalFile:"m_green_btn.png",bPlistTexture:!0,bPressedActionEnabled:!0,position:cc.p(e.width/2+120,50),bTouchEnable:!0})).addTouchEventListener(this._onCancelButtonTouched,this),t.addChild(n),(i=new cc.Sprite).initWithSpriteFrameName("dailog_cancel.png"),i.setPosition(84,38),n.addChild(i,1),n=UIHelper.createText({position:cc.p(e.width/2,356),fontSize:32,fontColor:cc.color(255,255,255),content:"",bIgnoreSize:!0}),t.addChild(n),this._titleText=n;var i;(i=new cc.Sprite).initWithSpriteFrameName("dailog_avatar.png"),i.setAnchorPoint(.5,.5),i.setPosition(e.width/2-100,300),t.addChild(i),(i=new cc.Sprite).initWithSpriteFrameName("dailog_heart.png"),i.setAnchorPoint(.5,.5),i.setPosition(e.width/2,330),t.addChild(i),(i=new cc.Sprite).initWithSpriteFrameName("dailog_send.png"),i.setAnchorPoint(.5,.5),i.setPosition(e.width/2,290),t.addChild(i),(i=UIHelper.createImage({imageFileName:"m_head_frame.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(68,68),capInsets:cc.rect(5,5,2,2),position:cc.p(e.width/2+100,300)})).setAnchorPoint(.5,.5),t.addChild(i);var o=UIHelper.createText({position:cc.p(e.width/2,220),fontSize:32,fontColor:cc.color(255,255,255),content:"确定拒收好友送的爱心吗",bIgnoreSize:!1});t.addChild(o);var c=UIHelper.createText({position:cc.p(e.width/2,160),fontSize:28,fontColor:cc.color(255,255,255),content:"拒收后好友将不可以再送心给你",bIgnoreSize:!1});t.addChild(c)},setSureButtonTouchedCallBack:function(e){this._buttonTouchedCallBack=e},_onCancelButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&("function"==typeof this._buttonTouchedCallBack&&this._buttonTouchedCallBack(!1),RejectWindow.Hide(),RejectWindow.Destroy())},_onSureButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&("function"==typeof this._buttonTouchedCallBack&&this._buttonTouchedCallBack(!0),RejectWindow.Hide(),RejectWindow.Destroy())},setContent:function(e){this._title=e},onShowNotify:function(){null!=this._content&&UIHelper.subsectionTextForUIText(this._titleText,this._title,this._maxWidth),this._title=null},onShow:function(){},onHideNotify:function(){},onHide:function(){},onDestroyNotify:function(){},onDestroy:function(){},onCover:function(){},onResume:function(){}});RejectWindow.GetInstance=function(){return null==RejectWindow._instance&&(RejectWindow._instance=new RejectWindow),RejectWindow._instance},RejectWindow.Show=function(e,t){var n=RejectWindow.GetInstance();n.setContent(e),n.setSureButtonTouchedCallBack(t);var i=WindowAction.getScaleEaseElasticOutAction(n);WindowManager.GetInstance().showWindow(n,i,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,RejectWindow.Destroy)},RejectWindow.Hide=function(){WindowManager.GetInstance().hideWindow(RejectWindow._instance)},RejectWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(RejectWindow._instance),RejectWindow._instance=null};
var ROW_HORIZONTAL_SPACE=40,ROW_HEIGHT=99,set_show_env_switch=!1,SettingWindow=WindowBase.extend({_uploadTimeout:null,_hitVerCount:0,_openEnvSwitchTimeout:null,_hitHeadImgCount:0,_copyOpenIdTimeout:null,_hitNickNameCount:0,ctor:function(){this._super(),this._initUI()},_initUI:function(){var e=UIHelper.createImage({imageFileName:"setting_bg.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(580,470),capInsets:cc.rect(30,70,550,10),position:UIHelper.getPosition(320,564)});this.addChild(e);var t=UIHelper.createButton({normalFile:"btn_back_N.png",bPlistTexture:!0,position:cc.p(20,e.height-36),bTouchEnable:!0});t.addTouchEventListener(this._onBackButtonTouched,this),e.addChild(t);var i=window.GetCurVersion&&window.GetCurVersion()||"",n=this._createTitle(cc.p(ROW_HORIZONTAL_SPACE,.5*ROW_HEIGHT),"当前版本："+i);e.addChild(n),n.setTouchEnabled(!0),n.addTouchEventListener(this._onVerTextTouched,this),e.addChild(this._createLine(cc.p(.5*e.width,ROW_HEIGHT))),e.addChild(this._createTitle(cc.p(ROW_HORIZONTAL_SPACE,1.5*ROW_HEIGHT),"关于我们"));var o=UIHelper.createPanel({anchorPoint:cc.p(1,.5),position:cc.p(e.width,1.5*ROW_HEIGHT),size:cc.size(550,70),bTouchEnable:!0}),c=new cc.Sprite;c.initWithSpriteFrameName("icon_arrow.png"),c.setPosition(cc.p(o.width-ROW_HORIZONTAL_SPACE-15,.5*o.height)),o.addChild(c),o.addTouchEventListener(this._onAboutUsButtonTouched,this),e.addChild(o),e.addChild(this._createLine(cc.p(.5*e.width,2*ROW_HEIGHT))),e.addChild(this._createTitle(cc.p(ROW_HORIZONTAL_SPACE,2.5*ROW_HEIGHT),"昵称"));var a=subRectMap("USER_NICK"),s={req:"USER_NICK",data:{openId:"selfOpenId",color:"#ffffff",fontSize:32,align:"right"},rect:a};wx.postMessage(s);var d=this.nickNameTex=new cc.Texture2D;d.initWithElement(sharedCanvas),d.handleLoadedTexture();var h=new cc.Sprite(d,a);h.setAnchorPoint(cc.p(1,.5)),h.setPosition(cc.p(e.width-ROW_HORIZONTAL_SPACE,2.5*ROW_HEIGHT)),e.addChild(h);var r=UIHelper.createPanel({anchorPoint:cc.p(1,.5),position:cc.p(e.width-ROW_HORIZONTAL_SPACE,2.55*ROW_HEIGHT),size:cc.size(320,72),bTouchEnable:!0});r.addTouchEventListener(this._onNickTouched,this),e.addChild(r),e.addChild(this._createLine(cc.p(.5*e.width,3*ROW_HEIGHT))),e.addChild(this._createTitle(cc.p(ROW_HORIZONTAL_SPACE,3.5*ROW_HEIGHT),"头像"));var u=subRectMap("USER_HEAD"),l={req:"USER_HEAD",data:{openId:"selfOpenId"},rect:u};wx.postMessage(l);var _=this.headFrameTex=new cc.Texture2D;_.initWithElement(sharedCanvas),_.handleLoadedTexture();var p=new cc.Sprite(_,u);p.setAnchorPoint(cc.p(1,.5)),p.setPosition(cc.p(e.width-ROW_HORIZONTAL_SPACE,3.55*ROW_HEIGHT)),e.addChild(p);var f=UIHelper.createPanel({anchorPoint:cc.p(1,.5),position:cc.p(e.width-ROW_HORIZONTAL_SPACE,3.55*ROW_HEIGHT),size:cc.size(72,72),bTouchEnable:!0});f.addTouchEventListener(this._onHeadTouched,this),e.addChild(f),this.step=0},_createTitle:function(e,t){return UIHelper.createText({position:e,anchorPoint:cc.p(0,.5),fontSize:30,fontColor:cc.color(255,255,255),content:t,fontName:"Arial"})},_createLine:function(e){var t=new cc.Sprite;return t.initWithSpriteFrameName("separate_line.png"),t.setPosition(e),t},_switchValueChanged:function(e,t){if(MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),t)GameService.setProfile({recv_heart_state:t?1:0},function(){console.log("switchValueChanged is "+t),NetLoadingWindow.Hide();var e,i=NetData.map_friend_ntf.friend_list;for(var n in i)if(e=i[n],NetData.user_info.openid==e.openid){e.recv_heart_state=t?1:0;break}rankData._dataModified=!0});else{RejectWindow.Show("拒收好友爱心",function(i){i?(NetLoadingWindow.Show(),GameService.setProfile({recv_heart_state:t?1:0},function(){console.log("switchValueChanged is "+t),NetLoadingWindow.Hide();var e,i=NetData.map_friend_ntf.friend_list;for(var n in i)if(e=i[n],NetData.user_info.openid==e.openid){e.recv_heart_state=t?1:0;break}rankData._dataModified=!0})):e.setOn(!0)})}},_musicValueChanged:function(e,t){if(t==ccui.Slider.EVENT_PERCENT_CHANGED){var i=e.getPercent()/100;MusicManager.setMusicVolume(i),StorageManager.setMusicVolume(i)}},_soundValueChanged:function(e,t){if(t==ccui.Slider.EVENT_PERCENT_CHANGED){var i=e.getPercent(),n=i/100;0!=i?(MusicManager.setEffectEnable(!0),StorageManager.openEffect()):(MusicManager.setEffectEnable(!1),StorageManager.closeEffect()),MusicManager.setEffectsVolume(n),StorageManager.setEffectVolume(n)}},_onBackButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),SettingWindow.Destroy(),TopGoldBar.Show())},_onAboutUsButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),AboutUsWindow.Show())},_onVerTextTouched:function(e,t){if(ccui.Widget.TOUCH_ENDED==t){var i=this;null==this._uploadTimeout&&(this._uploadTimeout=Timeout.registerEx(function(){console.log("upload time out callback"),i._uploadTimeout=null,i._hitVerCount=0},1e3)),this._hitVerCount++,this._hitVerCount>=4&&(this._hitVerCount=0,console.log("upload log file"),wx.showToast({title:"正在上传日志"}),Service.Log.uploadAllLog())}},_onHeadTouched:function(e,t){if(ccui.Widget.TOUCH_ENDED==t){var i=this;null==this._openEnvSwitchTimeout&&(this._openEnvSwitchTimeout=Timeout.registerEx(function(){console.log("open env switch time out callback"),i._openEnvSwitchTimeout=null,i._hitHeadImgCount=0},1e3)),this._hitHeadImgCount++,this._hitHeadImgCount>=4&&window.showEnvSwitch&&(this._hitHeadImgCount=0,set_show_env_switch||(set_show_env_switch=!0,UIHelper.attachChangeEnvPanel(cc.p(20,cc.winSize.height-20),cc.director.getRunningScene()),console.log("show env switch"),wx.showToast({title:"打开切换环境开关"})))}},_onNickTouched:function(e,t){if(ccui.Widget.TOUCH_ENDED==t){var i=this;null==this._copyOpenIdTimeout&&(this._copyOpenIdTimeout=Timeout.registerEx(function(){console.log("copy OpenId time out callback"),i._copyOpenIdTimeout=null,i._hitNickNameCount=0},1e3)),this._hitNickNameCount++,this._hitNickNameCount>=4&&(this._hitNickNameCount=0,console.log("copy openid"),wx.showToast({title:"OpenId已复制到剪贴板"}),wx.setClipboardData({data:NetData.user_info.openid,success:function(e){console.log(JSON.stringify(e))}}))}},onShowNotify:function(){},onShow:function(){this.scheduleUpdate()},onHideNotify:function(){},onHide:function(){},onDestroyNotify:function(){},onDestroy:function(){},onCover:function(){},onResume:function(){},update:function(){this.nickNameTex&&this.headFrameTex&&(0==this.step++&&(this.nickNameTex.initWithElement(sharedCanvas),this.nickNameTex.handleLoadedTexture(),this.headFrameTex.initWithElement(sharedCanvas),this.headFrameTex.handleLoadedTexture()),this.step>=window.subUpdateRate.SETTING&&(this.step=0))}});SettingWindow.GetInstance=function(){return null==SettingWindow._instance&&(SettingWindow._instance=new SettingWindow),SettingWindow._instance},SettingWindow.Show=function(){ResLoader.showSubResLoadingWindow(ResObjects.getResObject(ResObjectConfig.setting),function(){var e=SettingWindow.GetInstance(),t=WindowAction.getScaleEaseElasticOutAction(e);WindowManager.GetInstance().showWindow(e,t,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,SettingWindow.Destroy)})},SettingWindow.Hide=function(){WindowManager.GetInstance().hideWindow(SettingWindow._instance)},SettingWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(SettingWindow._instance),SettingWindow._instance=null};
var PropUseCountMap={},Prop=cc.Class.extend({_originalPropDescribe:null,_propDescribeText:null,_propSelectItemList:null,_bBackStageSelectWindow:!0,_selectViewList:null,_selectViewDice:null,_selectCount:null,_propSelectItemMap:null,_diamondsCostText:null,_coinCostText:null,_redLineText:null,_discountPanel:null,_bgView:null,_root:null,ctor:function(e,t){this._propSelectItemMap={},this._selectCount=0,this._selectViewList=[],this._propSelectItemList=[],this._originalPropDescribe=cc.formatStr(Language.getString(LanguageKey.PROP_USE_LIMIT),GameDataConfig.PROP_CAN_USE_COUNT),this._root=t,this._bgView=e;var i=UIHelper.createText({fontSize:20,content:Language.getString(LanguageKey.PROP_DESC),position:cc.p(52,65),anchorPoint:cc.p(0,.5),fontColor:cc.color(94,52,40)});e.addChild(i);i=UIHelper.createText({fontSize:20,content:this._originalPropDescribe,bIgnoreSize:!0,position:cc.p(170,65),anchorPoint:cc.p(0,.5),fontColor:cc.color(255,255,255)});e.addChild(i),this._propDescribeText=i;i=UIHelper.createText({fontSize:20,content:Language.getString(LanguageKey.TOTAL_COST),position:cc.p(30,335),anchorPoint:cc.p(0,.5),fontColor:cc.color(72,102,49)});e.addChild(i);i=UIHelper.createImage({imageFileName:"icon_diamonds.png",bPlistTexture:!0,position:cc.p(125,335),scale:.5});e.addChild(i);i=UIHelper.createText({fontSize:20,content:"0",position:cc.p(145,335),anchorPoint:cc.p(0,.5),fontColor:cc.color(72,102,49)});e.addChild(i),this._diamondsCostText=i;i=UIHelper.createImage({imageFileName:"coin_big.png",bPlistTexture:!0,position:cc.p(233,335),scale:.9});e.addChild(i);i=UIHelper.createText({fontSize:20,content:"0",position:cc.p(255,335),anchorPoint:cc.p(0,.5),fontColor:cc.color(72,102,49),bIgnoreSize:!0});e.addChild(i),this._coinCostText=i;(i=UIHelper.createText({fontSize:20,content:"-",fontColor:cc.color(255,0,0),bVisible:!1,bIgnoreSize:!0})).setName("redLineView"),this._coinCostText.addChild(i),this._redLineText=i,this._initPropSelectItemList(),this._initSelectViewList(),this._updateDefaultSelectedProp(),this._updateLuckyDiceItem()},_updateDefaultSelectedProp:function(){var e;if(!GuideAuxiliaryData.isNeedGuide(GameProxy.getStageId())){var t=GameProxy.getStartItemIdList();if(Util.isArray(t))for(var i=0,n=Math.min(t.length,GameDataConfig.PROP_CAN_USE_COUNT-1);i<n;i++){var o=t[i];if(null!=(e=this._propSelectItemMap[o]))if(e.getItemCount()>0)e.setUserData({bDefaultSelected:!0}),e.turnToSelectedState();else{GameUtil.isWealthEnough(e.getPriceType(),e.getPrice())&&(e.setUserData({bDefaultSelected:!0}),e.turnToSelectedState())}}}},_updateLuckyDiceItem:function(){var e=this._propSelectItemMap[GameDataConfig.LUCKY_DICE_ID];NetData.random_item_info_ntf.random_item_id?(e._choseView.setVisible(!0),this._selectViewDice.setVisible(!0),e.updateItemAndPrice(NetData.random_item_info_ntf.random_item_id,GameDataConfig.LUCKY_DICE_DISCOUNT_PRICE)):(e._choseView.setVisible(!1),this._selectViewDice.setVisible(!1),e.updateItemAndPrice(GameDataConfig.LUCKY_DICE_ID,GameDataConfig.LUCKY_DICE_PRICE))},_initPropSelectItemList:function(){for(var e=[],t=0,i=NetData.item_list.item.length;t<i;t++){var n=NetData.item_list.item[t];e.push({itemId:n.id,count:n.count})}var o=GuideAuxiliaryData.isNeedGuide(GameProxy.getStageId()),a=[];for(t=0,i=e.length;t<i;t++){var s=e[t].itemId,c=ConfigLoader.getPropConfig(s);if(c&&0==c.use_sence){var l=ConfigLoader.getPropGoodsConfig(s);if(l){var r=null!=PropUseCountMap[s]?PropUseCountMap[s].useCount:0,d=e[t].count;NetData.random_item_info_ntf.random_item_id==s&&d--,a.push({itemId:s,name:c.item_name,describe:c.desc,count:d,pricePackageCount:l.price_pkg_cnt,pricePackageList:l.price_pkg_list,priceType:l.price_type,configId:l.id,bCanUse:!o,useCount:r})}}}var p={itemId:GameDataConfig.LUCKY_DICE_ID,name:"幸运骰子",describe:"幸运骰子",count:0,pricePackageCount:GameDataConfig.LUCKY_DICE_ID,pricePackageList:[{price:GameDataConfig.LUCKY_DICE_PRICE}],priceType:PriceType.DIAMONDS,configId:GameDataConfig.LUCKY_DICE_ID,bCanUse:!o,useCount:10},u=[];u.push(cc.p(80,185)),u.push(cc.p(230,185)),u.push(cc.p(380,185)),u.push(cc.p(530,185)),a=a.splice(0,GameDataConfig.PROP_CAN_USE_COUNT-1);var g=this._bgView;for(t=0,i=u.length;t<i;t++){n=3==t?p:a[t];var h=new PropSelectItem(n);h.setPosition(u[t]),h.setDelegate(this),g.addChild(h),this._propSelectItemList.push(h),null!=n&&(this._propSelectItemMap[n.itemId]=h)}},_initSelectViewList:function(){var e=[];e.push(cc.p(479,589)),e.push(cc.p(509,589)),e.push(cc.p(539,589)),e.push(cc.p(579,589));for(var t=this._bgView,i=0,n=e.length;i<n;i++){var o=UIHelper.createImage({imageFileName:3==i?"prop_count_dice.png":"prop_count.png",bPlistTexture:!0,position:e[i],bVisible:!1});t.addChild(o),3==i?this._selectViewDice=o:this._selectViewList.push(o)}},setBackStageSelectWindow:function(e){this._bBackStageSelectWindow=e},onPropSelectItemTouched:function(e){var t=this._getSelectViewCount(),i=e.getItemId(),n=this;if(t>=GameDataConfig.PROP_CAN_USE_COUNT)return!1;if(e.getItemCount()>0)return this._selectPropItem(e),!0;GameUtil.isWealthEnough(e.getPriceType(),e.getPrice())?i==GameDataConfig.LUCKY_DICE_ID?("function"==typeof this._luckyDiceWindowShowCallBack&&this._luckyDiceWindowShowCallBack(),LuckyDiceWindow.show(e.getPrice(),function(e){LuckyDiceWindow.destroy(),"function"==typeof n._luckyDiceWindowCloseCallBack&&n._luckyDiceWindowCloseCallBack(),n._updateLuckyDiceItem(),console.log("======随机骰子======",e)})):this._selectPropItem(e):e.getPriceType()==PriceType.DIAMONDS&&wx.getSystemInfoSync().system.indexOf("iOS")>=0?TipWindow.Show("钻石不足！",function(){console.error("iOS 不能购买")}):GameUtil.showExchangeWindowByPriceType(e.getPriceType(),function(){e.turnToSelectedState()}.bind(this))},setLuckyDiceWindowCloseCallBack:function(e){this._luckyDiceWindowCloseCallBack=e},setLuckyDiceWindowShowCallBack:function(e){this._luckyDiceWindowShowCallBack=e},_selectPropItem:function(e){e.onSelected(),this._propDescribeText.setString(e.getItemDescribe()),this._selectCount++,this._updateSelectViewList(),this._updateCost(e,1),this._updateDiscountView(),this._updateGoldBar(e,-1);var t=e.getUserData();null!=t?(t.bDefaultSelected||MusicManager.playEffect(MusicEffectFiles.Audio_UI_buyitem),t.bDefaultSelected=!1):MusicManager.playEffect(MusicEffectFiles.Audio_UI_buyitem)},_updateGoldBar:function(e,t){if(!(e.getItemCount()>0)){var i=0,n=0,o=e.isDiscount()?e.getDiscountPrice():e.getPrice();switch(e.getPriceType()){case PriceType.DIAMONDS:n=o,TopGoldBar.GetInstance().addDiamond(n*t);break;case PriceType.GOLD:i=o,TopGoldBar.GetInstance().addGold(i*t)}console.log("diamondsCost : "+n*t+" coinCost : "+i*t)}},_updateDiscountView:function(){for(var e=0,t=0,i=0,n=this._propSelectItemList.length;i<n;i++){var o=this._propSelectItemList[i];o.isSelected()&&o.getItemCount()<=0&&o.isDiscount()&&o.getPriceType()==PriceType.GOLD&&(e++,t+=o.getDiscountPrice())}var a=e>0;if(a){null==this._discountPanel&&this._createDiscountPanel();var s=ccui.helper.seekWidgetByName(this._discountPanel,"costView");s.setString(t);var c=ccui.helper.seekWidgetByName(this._discountPanel,"bgView"),l=s.getContentSize().width+30;c.setContentSize(l,c.getContentSize().height),s.setPositionX(l/2);ccui.helper.seekWidgetByName(this._discountPanel,"describeView").setPositionX(l+5);var r=this._coinCostText.getContentSize().width/this._redLineText.getContentSize().width;r*=2,this._redLineText.setScaleX(r),this._redLineText.setPosition(this._coinCostText.getContentSize().width/2,this._coinCostText.getContentSize().height/2)}this._redLineText.setVisible(a),this._discountPanel&&this._discountPanel.setVisible(a)},_createDiscountPanel:function(){var e=UIHelper.createPanel({anchorPoint:cc.p(0,.5),position:cc.p(330,335),size:cc.size(200,50)});this._bgView.addChild(e),this._discountPanel=e;var t=cc.p(0,e.getContentSize().height/2),i=UIHelper.createImage({imageFileName:"bg_prop_discount.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(100,32),capInsets:cc.rect(14,14,2,2),anchorPoint:cc.p(0,.5),position:t});i.setName("bgView"),e.addChild(i);(n=UIHelper.createText({fontSize:20,fontColor:cc.color(255,255,255),bIgnoreSize:!0,position:cc.p(0,i.getContentSize().height/2)})).setName("costView"),i.addChild(n);var n;(n=UIHelper.createText({fontSize:20,content:Language.getString(LanguageKey.CONTINUOUS_USE_DISCOUNT),fontColor:cc.color(72,102,49),position:t,anchorPoint:cc.p(0,.5)})).setName("describeView"),e.addChild(n)},_updateCost:function(e,t){if(!(e.getItemCount()>0)){switch(e.getPriceType()){case PriceType.DIAMONDS:var i=Util.getInt(this._diamondsCostText.getString());i+=t*e.getPrice(),this._diamondsCostText.setString(i);break;case PriceType.GOLD:i=Util.getInt(this._coinCostText.getString());i+=t*e.getPrice(),this._coinCostText.setString(i)}}},onPropSelectItemUnSelected:function(e){this._propDescribeText.setString(this._originalPropDescribe),this._selectCount--,this._updateSelectViewList(),this._updateGoldBar(e,1),this._updateCost(e,-1),this._updateDiscountView(),MusicManager.playEffect(MusicEffectFiles.Audio_UI_cancelitem)},_getSelectViewCount:function(){for(var e=0,t=0,i=this._selectViewList.length;t<i;t++)this._selectViewList[t].isVisible()&&e++;return e},_updateSelectViewList:function(){for(var e=0,t=this._selectViewList.length;e<t;e++)this._selectViewList[e]&&this._selectViewList[e].setVisible(!1);for(t=Math.min(this._selectViewList.length,this._selectCount),e=0;e<t;e++)this._selectViewList[e]&&this._selectViewList[e].setVisible(!1)},recoveryTopGoldBar:function(){for(var e=0,t=this._propSelectItemList.length;e<t;e++){var i=this._propSelectItemList[e];i.isSelected()&&this._updateGoldBar(i,1)}},onStartAdventure:function(e){if(HeartRecoveryLogic.getHeartCount()<=0)ExchangeWindow.show({exchangeType:ExchangeWindow.Type.HEART,buySuccessCallBack:function(){ExchangeWindow.destroy()}});else{HeartRecoveryLogic.onDeductHeart(),bChallengeMode=!1;for(var t=[],i=[],n=[],o=0,a=this._propSelectItemList.length;o<a;o++){var s=this._propSelectItemList[o],c=s.getItemId();if(s.isSelected()){if(s.getItemCount()<=0){var l=new CostItem(c,s.getConfigId(),s.getPackageIndex());n.push(l)}else i.push(c);t.push(c),PropUseCountMap[c]=PropUseCountMap[c]||{useCount:0},PropUseCountMap[c].useCount++}else delete PropUseCountMap[c]}NetData.random_item_info_ntf.random_item_id&&(i.push(NetData.random_item_info_ntf.random_item_id),t.push(NetData.random_item_info_ntf.random_item_id));var r=e.getPositionY()-(cc.winSize.height/2-460),d=new HeartEffect,p=UIHelper.getCenterPosition();p.y+=r,d.setPosition(p),this._root.addChild(d),d.play(function(){"function"==typeof this._heartEffectCompleteCallBack&&this._heartEffectCompleteCallBack(),PageUtil.startGame({stockItemDataList:i,costItemDataList:n,itemIdList:t,randomItemId:NetData.random_item_info_ntf.random_item_id})}.bind(this)),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch)}},setHeartEffectCompleteCallBack:function(e){this._heartEffectCompleteCallBack=e}}),Stage=cc.Class.extend({_bgView:null,_passConditionPanel:null,_sureAdventureCallBack:null,_titleView:null,_loadStageConfigFinishCallBack:null,_backCallBack:null,ctor:function(e,t,i){this._bgView=t;var n=t.getContentSize(),o=n.width,a=n.height,s=t.getContentSize(),c=UIHelper.createPanel({anchorPoint:t.getAnchorPoint(),position:cc.p(s.width/2,s.height/2),size:s});t.addChild(c),this._passConditionPanel=c;var l=GameProxy.getStageId(),r=UIHelper.createText({fontSize:45,content:cc.formatStr(Language.getString(LanguageKey.STAGE),l),position:cc.p(o/2,a-30),fontColor:cc.color(255,255,255)});t.addChild(r);(r=UIHelper.createImage({imageFileName:"title.png",bPlistTexture:!0,position:cc.p(154,546),bVisible:!1})).setUserData(r.getPositionY()),t.addChild(r),this._titleView=r;r=UIHelper.createImage({imageFileName:"pet.png",bPlistTexture:!0,position:cc.p(460,474)});t.addChild(r);(r=UIHelper.createButton({normalFile:"btn_back_N.png",bPlistTexture:!0,position:cc.p(32,a-30),bTouchEnable:!0})).addTouchEventListener(this._onBackButtonTouched,this),t.addChild(r);(r=UIHelper.createButton({normalFile:"btn_adventure_n.png",pressedFile:"btn_adventure_p.png",bPlistTexture:!0,position:UIHelper.getPosition(320,256),bTouchEnable:!0})).addTouchEventListener(this._onStartAdventureButtonTouched,this),i.addChild(r),UIHelper.setViewToCenter(t,r,20);if(t.setPositionY(t.getPositionY()-45),r.setPositionY(r.getPositionY()-45),e&&e.detail&&e.img){c=new cc.Sprite;this.loadRemoteImage(c,res.new_element_panel_png);c.setPosition(300,670),t.addChild(c);var d=s.width/2-90,p=UIHelper.createText({position:cc.p(d,670),fontSize:28,fontColor:cc.color(255,255,255),content:"",bIgnoreSize:!1});p.setAnchorPoint(0,.5),UIHelper.subsectionTextForUIText(p,e.detail,290,cc.TEXT_ALIGNMENT_LEFT),t.addChild(p),d-=106;var u=new cc.Sprite;235==e.stageId?this.loadElementEffect(u):this.loadRemoteImage(u,e.img),u.setAnchorPoint(0,.5),u.setPosition(d,670),t.addChild(u)}else{var g=GameUtil.getStarNumByStageID(l);this._addStart(g)}},addJumpHoldTip:function(){var e=UIHelper.createButton({normalFile:"jump-btn-hold.png",bPlistTexture:!0,position:cc.p(this._bgView.width-70,112),bTouchEnable:!0});this._bgView.addChild(e);var t=StageJumpData.isHold(GameProxy.getStageId()),i=new cc.LabelBMFont(""+t,res.number_white_fnt);i.setPosition(.62*e.width,.36*e.height),i.setScaleX(.9),e.addChild(i)},showElementEffect:function(e){var t=new Effect(res.waveelemennt_json);t.setPosition(40,0),t.play(!0),e.addChild(t)},loadElementEffect:function(e){var t=this,i=ResObjects.getResObject(ResObjectConfig.newElementWave);if(i.isLoaded())this.showElementEffect(e);else{var n=i.getResList();n instanceof Array||(n=[]),cc.loader.load(n,function(n,o){n?console.log("load resImgList failed : "+n):(i.onLoadFinish(),t.showElementEffect(e))})}},loadRemoteImage:function(e,t){cc.loader.loadImg(t,function(i,n){if(i)console.log("load remote image failed : "+i);else{var o=GameUtil.getAndCacheTexture(t,n),a=o.getContentSize(),s=new cc.SpriteFrame;s.initWithTexture(o,cc.rect(0,0,a.width,a.height)),e.initWithSpriteFrame(s)}})},setLoadStageConfigFinishCallBack:function(e){this._loadStageConfigFinishCallBack=e},_initPassConditionView:function(){var e=GameProxy.getStageId();GameProxy.getSimpleStageData(e,function(e){"function"==typeof this._loadStageConfigFinishCallBack&&this._loadStageConfigFinishCallBack();for(var t=0,i=0,n=e.passCondition.length;i<n;i++){(c=e.passCondition[i]).type!=RemoveLogic.we4Proto.PassConditionType.kPassCondAllStep&&t++}var o=this._titleView.getUserData(),a=0;t<=3?(a=496,this._titleView.setPositionY(o)):(a=540,this._titleView.setPositionY(o+44)),this._titleView.setVisible(!0);var s=1;for(i=0,n=e.passCondition.length;i<n;i++){var c;(c=e.passCondition[i]).type!=RemoveLogic.we4Proto.PassConditionType.kPassCondAllStep&&(this._passCondition(c,s,a),s++)}}.bind(this))},_onBackButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(this._backCallBack&&this._backCallBack(),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch))},_addStart:function(e){var t=UIHelper.createImage({imageFileName:"no_star_middle.png",bPlistTexture:!0,position:cc.p(184,655),scale:.8,rotation:-14});if(this._bgView.addChild(t),t=UIHelper.createImage({imageFileName:"no_star_middle.png",bPlistTexture:!0,position:cc.p(305,670)}),this._bgView.addChild(t),t=UIHelper.createImage({imageFileName:"no_star_middle.png",bPlistTexture:!0,position:cc.p(429,655),scale:.8,rotation:14}),this._bgView.addChild(t),!(e<=0)){var i=[],n=UIHelper.createImage({imageFileName:"star_middle.png",bPlistTexture:!0,position:cc.p(184,655),scale:.8,rotation:-14});this._bgView.addChild(n),i.push(n);n=UIHelper.createImage({imageFileName:"star_middle.png",bPlistTexture:!0,position:cc.p(305,670)});this._bgView.addChild(n),i.push(n);n=UIHelper.createImage({imageFileName:"star_middle.png",bPlistTexture:!0,position:cc.p(429,655),scale:.8,rotation:14});this._bgView.addChild(n),i.push(n);for(var o=e=Math.max(1,e),a=i.length;o<a;o++)i[o].removeFromParent()}},_onStartAdventureButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&("function"==typeof this._sureAdventureCallBack&&this._sureAdventureCallBack(e),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch))},setSureAdventureCallBack:function(e){this._sureAdventureCallBack=e},setBackCallBack:function(e){this._backCallBack=e},_passCondition:function(e,t,i){var n=i-42*(t-1),o="mission_"+t+".png",a=UIHelper.createImage({imageFileName:o,bPlistTexture:!0,position:cc.p(76,n)});this._passConditionPanel.addChild(a);var s=this._getDescribe(e);a=UIHelper.createText({fontSize:25,content:s,anchorPoint:COMMON_ANCHOR.leftMid,position:cc.p(102,n)});this._passConditionPanel.addChild(a)},_getDescribe:function(e){return PassConditionDescribe.getDescribe(e.type,e.collectType,e.data1)},initPassConditionView:function(){this._passConditionPanel&&this._passConditionPanel.removeAllChildren(),this._initPassConditionView()}}),StagePropWindow=WindowBase.extend({_stage:null,_prop:null,_bgView:null,ctor:function(e){this._super();var t=UIHelper.createImage({imageFileName:"bg_stage_prop.png",bPlistTexture:!0,position:UIHelper.getPosition(320,688)});this.addChild(t),this._bgView=t,this._stage=new Stage(e,t,this)},refreshProp:function(){null==this._prop&&this._bgView&&(this._prop=new Prop(this._bgView,this),this._prop.setLuckyDiceWindowCloseCallBack(function(){StagePropWindow.Show()}.bind(this)),this._prop.setLuckyDiceWindowShowCallBack(function(){StagePropWindow.Hide()}.bind(this)),this._prop.setHeartEffectCompleteCallBack(function(){}.bind(this)))},setLoadStageConfigFinishCallBack:function(e){null!=this._stage?this._stage.setLoadStageConfigFinishCallBack(e):console.warn("[stagePropWindow setLoadStageConfigFinishCallBack] this._state is null")},setSureAdventureCallBack:function(e){if(null!=this._stage){var t=this;this._stage.setSureAdventureCallBack(function(e){t._prop&&t._prop.onStartAdventure(e)}.bind(this))}else console.warn("[stagePropWindow setSureAdventureCallBack] this._state is null")},setBackCallBack:function(e){if(null!=this._stage){var t=this;this._stage.setBackCallBack(function(){"function"==typeof e&&e(),t._prop&&t._prop.recoveryTopGoldBar(),StagePropWindow.Destroy()}.bind(this))}else console.warn("[stagePropWindow setBackCallBack] this._state is null")},onShowNotify:function(){null!=this._stage?this._stage.initPassConditionView():console.warn("[stagePropWindow onShowNotify] this._state is null")},onShow:function(){PreHandleGameResLogic.handle()},onHideNotify:function(){},onHide:function(){},onDestroyNotify:function(){},onDestroy:function(){},onCover:function(){},onResume:function(){}});StagePropWindow.GetInstance=function(e){return null==StagePropWindow._instance&&(StagePropWindow._instance=new StagePropWindow(e)),StagePropWindow._instance},StagePropWindow.Show=function(e,t,i,n){ResLoader.showSubResLoadingWindow(ResObjects.getResObject(ResObjectConfig.stageProp),function(){PassConditionDescribe.init(),GameProxy.init();var o=StagePropWindow.GetInstance(n);o.setLoadStageConfigFinishCallBack(function(){puzzleGame.simple_stage_info(function(e){GuideResHandler.loadRes(e),StagePropWindow&&StagePropWindow._instance&&StagePropWindow._instance.refreshProp&&StagePropWindow._instance.refreshProp()}.bind(this))}),o.setSureAdventureCallBack(e),o.setBackCallBack(i);var a=WindowAction.getScaleEaseElasticOutAction(o);WindowManager.GetInstance().showWindow(o,a,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,t,StagePropWindow.Destroy)})},StagePropWindow.Hide=function(){WindowManager.GetInstance().hideWindow(StagePropWindow._instance)},StagePropWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(StagePropWindow._instance),StagePropWindow._instance=null};
var StarRewardPreview=WindowBase.extend({config:{map:null,curRewardId:0,star_num:0,map_id:0,reward_list:null,stageDataList:[]},_itemList:null,_stageList:null,_leftStarNum:null,_isInit:!1,ctor:function(){this._super();var e=UIHelper.createPanel({position:UIHelper.getCenterPosition(),anchorPoint:cc.p(.5,.5),size:cc.size(620,760)});this.addChild(e);var t=UIHelper.createImage({imageFileName:"srp_middle.png",bPlistTexture:!0,bScale9Enabled:!0,anchorPoint:cc.p(.5,1),size:cc.size(609,583),capInsets:cc.rect(3,0,4,583),position:cc.p(310,688)}),i=UIHelper.createImage({imageFileName:"srp_top_bg.png",bPlistTexture:!0,bScale9Enabled:!1,anchorPoint:cc.p(.5,1),position:cc.p(304,583)});t.addChild(i),e.addChild(t);var n=UIHelper.createImage({imageFileName:"srp_top.png",bPlistTexture:!0,bScale9Enabled:!1,anchorPoint:cc.p(.5,1),position:cc.p(310,760)});e.addChild(n);var a=UIHelper.createImage({imageFileName:"srp_bottom.png",bPlistTexture:!0,bScale9Enabled:!1,anchorPoint:cc.p(.5,0),position:cc.p(310,0)});e.addChild(a);var r=UIHelper.createImage({imageFileName:"srp_title.png",bPlistTexture:!0,bScale9Enabled:!1,anchorPoint:cc.p(.5,.5),position:cc.p(310,760)});e.addChild(r);var c=UIHelper.createButton({normalFile:"srp_sure_btn.png",bPressedActionEnabled:!0,bPlistTexture:!0,position:cc.p(310,50),bTouchEnable:!0});c.addTouchEventListener(this._onSureButtonTouched,this),e.addChild(c);var o=UIHelper.createText({fontSize:24,content:"还差",position:cc.p(140,634),anchorPoint:cc.p(0,.5),fontColor:cc.color(255,255,255)});e.addChild(o);var s=UIHelper.createText({fontSize:24,content:"颗星就可以领取奖励了",position:cc.p(260,634),anchorPoint:cc.p(0,.5),fontColor:cc.color(255,255,255)});e.addChild(s);var l=new cc.LabelBMFont("0",res.number_brown_fnt);l.setAnchorPoint(.5,.5),l.setPosition(225,634),e.addChild(l,1),this._leftStarNum=l,this._itemList=UIHelper.createList({position:cc.p(310,463),anchorPoint:cc.p(.5,0),contentSize:cc.size(125,150),direction:ccui.ScrollView.DIR_HORIZONTAL,bounceEnabled:!1,touchEnabled:!1}),e.addChild(this._itemList);var d=UIHelper.createText({fontSize:24,content:"重玩以下关卡可获得更多星星",position:cc.p(305,408),anchorPoint:cc.p(.5,.5),fontColor:cc.color(255,255,255)});e.addChild(d),this._stageList=UIHelper.createList({position:cc.p(310,130),anchorPoint:cc.p(.5,0),contentSize:cc.size(500,240),direction:ccui.ScrollView.DIR_VERTICAL,bounceEnabled:!1,touchEnabled:!1}),e.addChild(this._stageList)},createItem:function(e){var t=UIHelper.createImage({imageFileName:"srp_reward_item_bg.png",bPlistTexture:!0,bScale9Enabled:!1,anchorPoint:cc.p(.5,.5),position:cc.p(310,760)}),i=GameUtil.getGoodsImageById(e.article_type,e.article_subtype,e.article_id),n=UIHelper.createImage({imageFileName:i,bPlistTexture:!0,anchorPoint:cc.p(.5,.5),position:cc.p(62,90)});t.addChild(n);var a=new cc.LabelBMFont(String("X"+e.article_count),res.number_gold_big_fnt);return a.setPosition(62,20),a.setAnchorPoint(cc.p(.5,.5)),a.setScale(.8),t.addChild(a),t},createStageListRow:function(e){for(var t=UIHelper.createList({contentSize:cc.size(500,120),direction:ccui.ScrollView.DIR_HORIZONTAL,bounceEnabled:!1,touchEnabled:!1}),i=0;i<e.length;i++){var n=this.config.stageDataList[e[i]-1];t.pushBackCustomItem(this.createStageItem(e[i],n.star_level))}return t},createStageItem:function(e,t){var i=UIHelper.createPanel({anchorPoint:cc.p(.5,.5),size:cc.size(125,120),bTouchEnable:!0});i.setTag(e),i.addTouchEventListener(this._onStageTouched,this);var n=new cc.LabelBMFont("",res.number_stage_y_fnt),a=new cc.Sprite;a.initWithSpriteFrameName("n_m_btn_100.png"),a.setAnchorPoint(.5,.5),a.setPosition(62,60),i.addChild(a),n.setScale(.9),n.setAnchorPoint(cc.p(.5,.5)),a.addChild(n,0),n.setPosition(cc.p(65,58)),n.setString(e,!0);for(var r=0;r<3;++r){var c=new cc.Sprite;c.setTag(11+r),c.initWithSpriteFrameName("n_m_btn_star.png"),c.setPosition(46+20*r,20),c.setVisible(!1),a.addChild(c,0)}var o=a.getChildByTag(11),s=a.getChildByTag(12),l=a.getChildByTag(13);return t>=1&&o.setVisible(!0),t>=2&&s.setVisible(!0),t>=3&&l.setVisible(!0),a.setScale(.9),i},getNoFullStarStageList:function(e){for(var t=this.config.stageDataList,i=t.length,n=[],a=[],r=30*(e-1),c=r+30,o=r;o<c&&o<i;o++)t[o]&&t[o].star_level<3&&a.push(o+1);var s=0,l=[];for(o=0;o<a.length;o++)l.push(a[o]),4==++s&&(n.push(l),s=0,l=[]);return l.length>0&&n.push(l),n},refreshView:function(){this.fillItemList(this.config.reward_list),this._leftStarNum.setString(this.getLeftStarNum());var e=this.getNoFullStarStageList(this.config.map_id);this.fillStageList(e)},fillItemList:function(e){for(var t=0,i=[],n=0;n<e.length;n++){0!=(a=e[n]).article_type&&(t++,i.push(a))}this._itemList.setContentSize(cc.size(150*t-25,150)),this._itemList.setItemsMargin(25);for(n=0;n<i.length;n++){var a=i[n];this._itemList.pushBackCustomItem(this.createItem(a))}},fillStageList:function(e){for(var t=0;t<e.length;t++){var i=this.createStageListRow(e[t]);this._stageList.pushBackCustomItem(i)}},_onSureButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(console.log("_onSureButtonTouched"),StarRewardPreview.Destroy())},_onStageTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(console.log("_onStageTouched "+e.getTag()),this.showStageView(e.getTag()))},setConfig:function(e){this._isInit||(this.config=e,this.refreshView(),this._isInit=!0)},getLeftStarNum:function(){return[20,40,60,80,90][this.config.curRewardId-1]-this.config.star_num},showStageView:function(e){MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),GameProxy.setStageId(e);var t=this.config,i=this.config.map;StarRewardPreview.Destroy(),MiniMapWindow.Destroy(),SureAdventureWindow.Show(function(){PropSelectWindow.Show()},null,function(){MiniMapWindow.Show(i,!0),StarRewardPreview.Show(t,!0)})}});StarRewardPreview.GetInstance=function(){return null==StarRewardPreview._instance&&(StarRewardPreview._instance=new StarRewardPreview),StarRewardPreview._instance},StarRewardPreview.Show=function(e,t){ResLoader.showSubResLoadingWindow(ResObjects.getResObject(ResObjectConfig.starRewardPreview),function(){var i=StarRewardPreview.GetInstance();i.setConfig(e);var n=WindowAction.getScaleEaseElasticOutAction(i);t&&(n=null),WindowManager.GetInstance().showWindow(i,n,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,StarRewardPreview.Destroy)})},StarRewardPreview.Hide=function(){WindowManager.GetInstance().hideWindow(StarRewardPreview._instance)},StarRewardPreview.Destroy=function(){WindowManager.GetInstance().destroyWindow(StarRewardPreview._instance),StarRewardPreview._instance=null};
var SureAdventureWindow={};SureAdventureWindow.Show=function(e,n,o,r){StagePropWindow.Show(e,n,o,r)},SureAdventureWindow.Hide=function(){StagePropWindow.Hide()},SureAdventureWindow.Destroy=function(){StagePropWindow.Destroy()};
var TableView=cc.TableView.extend({_oldPos:null,_alphaY:0,_bClickPanel:!1,onTouchBegan:function(o,i){return this._oldPos=o.getLocation(),cc.TableView.prototype.onTouchBegan.call(this,o,i)},onTouchMoved:function(o,i){var t=o.getLocation();this._oldPos&&(this._alphaY+=Math.abs(t.y-this._oldPos.y)),this._oldPos=t,this._alphaY>12&&(this._alphaY=0,cc.TableView.prototype.onTouchMoved.call(this,o,i))},onTouchEnded:function(o,i){console.log("onTouchEnded ");var t=o.getLocation(),c=cc.winSize.width/2-250,e=cc.winSize.width/2+250;t.x<c||t.x>e?this._bClickPanel=!1:this._bClickPanel=!0,this._alphaY=0,cc.TableView.prototype.onTouchEnded.call(this,o,i)}});
var ActContentType={ACTIVITY_CONTENT_TYPE_NULL:0,ACTIVITY_CONTENT_TYPE_PICTURE:1,ACTIVITY_CONTENT_TYPE_TEXT:2,ACTIVITY_CONTENT_TYPE_TASK:3},TaskCenterData=cc.Class.extend({_act_conf_json:null,_task_conf_json:null,_RewardPool_json:null,_bRequest:!1,_bNeedUpdate:!1,ctor:function(){},getActInfoFromNetData:function(){var t=NetData.act_info_ntf.act_info_list;return t&&t.length>0?t:(console.log("null == NetData.act_info_ntf.act_info_list!"),t=[])},getTaskInfoByID:function(t){null==this._act_conf_json&&(this._act_conf_json=cc.loader.cache[res.ActQuestConf_bin_json]),null==this._task_conf_json&&(this._task_conf_json=cc.loader.cache[res.ActQuestElementConf_bin_json]),null==this._RewardPool_json&&(this._RewardPool_json=cc.loader.cache[res.ActQuestRewardPool_bin_json]);for(var e,n=this._act_conf_json&&this._act_conf_json.list_data||[],a=this._task_conf_json&&this._task_conf_json.list_data||[],s=this._RewardPool_json&&this._RewardPool_json.list_data||[],_=[],o=0;e=n[o];o++)if(t==e.quest_id){_=e.elements_id;break}var r,c,i=[];for(o=0;c=_[o];++o){for(var l,f=0;l=a[f];++f)if(c==l.element_id){r=l;break}if(null==r){console.log("null == taskData");break}var u=s[r.reward_id-1],d=GameUtil.getTaskProgressInfoById(2,r.element_id);i.push({taskId:r.element_id,state:d&&d.state||0,desc:r.quest_desc,target:r.upper_limit,progress:d&&d.process||0,reward_list:u.reward_list})}return i},getActInfoFromServer:function(){if(!this._bRequest){this._bRequest=!0;var t=this;GameService.getActCenterInfo({act_id_list:[]},function(e,n){t._bRequest=!1,e&&(console.log("err code: "+e.ret),TipWindow.Show(e.ret_desc))})}},getTaskNeedAwardIdList:function(){var t=NetData.quest_info_ntf.quest_info_list,e=[];if(t)for(var n=0;n<t.length;n++){var a=t[n];a&&2==a.quest_source&&1==a.state&&e.push(a.element_id)}return e}});TaskCenterData.getInstance=function(){return null==TaskCenterData._instance&&(TaskCenterData._instance=new TaskCenterData),TaskCenterData._instance};var taskCenterData=TaskCenterData.getInstance();
var TaskCenterWindow=WindowBase.extend({panelWidth:0,panelHeight:0,_oldSelectedIndex:0,_onSBTouched:!1,_mainPanel:null,_activityListView:null,_taskMainContent:null,_noticeMainContent:null,_taskListView:null,_activityDataList:[],_currSelectedTaskList:[],ctor:function(){this._super(),this._listenerList=[],Util.registerListener(this._listenerList,EventID.ON_WINDOW_RESIZE,this._onWindowResize.bind(this)),this.initView()},initView:function(){var e=this.panelWidth=600,t=this.panelHeight=880;this.itemHeight=160,this.listHeight=480,this.listWidth=e-18;var i=this._mainPanel=UIHelper.createImage({imageFileName:"t_c_dialog.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(e,t),capInsets:cc.rect(0,84,e,20),position:UIHelper.getCenterPosition(),anchorPoint:cc.p(.5,.5)});this.addChild(i);var n=UIHelper.createImage({imageFileName:"t_c_flag_l.png",bPlistTexture:!0,anchorPoint:cc.p(0,1),position:cc.p(0,t-30)});i.addChild(n);var c=UIHelper.createImage({imageFileName:"t_c_flag_r.png",bPlistTexture:!0,anchorPoint:cc.p(1,1),position:cc.p(e,t-30)});i.addChild(c);var a=UIHelper.createImage({imageFileName:"t_c_title.png",bPlistTexture:!0,anchorPoint:cc.p(.5,1),position:cc.p(e/2,t+38)});i.addChild(a);var o=UIHelper.createButton({normalFile:"btn_back_N.png",bPlistTexture:!0,anchorPoint:cc.p(.5,.5),position:cc.p(35,t-18),bTouchEnable:!0});o.addClickEventListener(this._onBackBtnTouched.bind(this)),i.addChild(o),this.onActivityNotified()},onActivityNotified:function(){this._clearAllData();var e=this._mainPanel,t=this.panelHeight-60;this._createTabListView(e,t,154),t-=154;var i=this._noticeMainContent=UIHelper.createImage({imageFileName:"t_c_content_bg.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(this.listWidth,t-24),capInsets:cc.rect(3,4,40,30),position:cc.p(this.panelWidth/2,t),anchorPoint:cc.p(.5,1)});i.setVisible(!1),e.addChild(i,1,200),i=this._taskMainContent=UIHelper.createImage({imageFileName:"t_c_content_bg.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(this.listWidth,t-84),capInsets:cc.rect(3,4,40,30),position:cc.p(this.panelWidth/2,t),anchorPoint:cc.p(.5,1)});var n=UIHelper.createImage({imageFileName:"t_c_time.png",bPlistTexture:!0,anchorPoint:cc.p(0,1),position:cc.p(20,i.height-10)});i.addChild(n);var c=UIHelper.createText({fontSize:20,fontName:"Microsoft YaHei",content:"",position:cc.p(140,i.height-10),anchorPoint:cc.p(0,1),fontColor:cc.color(220,220,60)});c.setName("activityTime"),i.addChild(c);var a=UIHelper.createText({fontSize:20,fontName:"Microsoft YaHei",content:"",size:cc.size(400,80),position:cc.p(140,i.height-44),anchorPoint:cc.p(0,1),fontColor:cc.color(220,220,220)});a.ignoreContentAdaptWithSize(!1),a.setName("activityDetail"),i.addChild(a);var o=this.createList();i.addChild(o);var s=UIHelper.createButton({normalFile:"t_c_in.png",bPlistTexture:!0,anchorPoint:cc.p(.5,.5),position:cc.p(this.panelWidth/2,-42),bTouchEnable:!0});s.addClickEventListener(this._onTakeInBtnTouched.bind(this)),i.addChild(s),i.setVisible(!1),e.addChild(i,1,201),this._onTaskItemSelected(0)},_createTabListView:function(e,t,i){var n=this._activityDataList=taskCenterData.getActInfoFromNetData(),c=n.length;if(0!=c){var a=UIHelper.createImage({imageFileName:"t_c_arrow_l.png",bPlistTexture:!0,position:cc.p(4,t-i/2),anchorPoint:cc.p(0,.5)});e.addChild(a);var o=UIHelper.createImage({imageFileName:"t_c_arrow_r.png",bPlistTexture:!0,position:cc.p(this.listWidth+14,t-i/2),anchorPoint:cc.p(1,.5)});e.addChild(o);var s=new ccui.ListView;s.setAnchorPoint(cc.p(0,1)),s.setPosition(40,t),s.setDirection(ccui.ScrollView.DIR_HORIZONTAL),s.setScrollBarEnabled(!1),s.setBounceEnabled(!0),s.setTouchEnabled(!0),s.setContentSize(this.listWidth-64,i),s.addEventListener(this._onActivityItemSelected.bind(this)),e.addChild(s),this._activityListView=s;for(var r,l=0;l<c;l++){r=n[l];var d=UIHelper.createPanel({anchorPoint:cc.p(0,0),position:cc.p(0,0),size:cc.size(130,150),bTouchEnable:!0}),h=UIHelper.createImage({imageFileName:"t_c_item_bkg.png",bPlistTexture:!0,position:cc.p(65,75),anchorPoint:cc.p(.5,.5)});d.addChild(h,0,100);var p=UIHelper.createImage({imageFileName:"t_c_item_s.png",bPlistTexture:!0,position:cc.p(65,67),anchorPoint:cc.p(.5,.5)});d.addChild(p,0,101),0==l?(p.setVisible(!0),this._oldSelectedIndex=0):p.setVisible(!1);var _="t_c_item_"+r.act_icon+".png";(h=UIHelper.createImage({imageFileName:_,bPlistTexture:!0,position:cc.p(65,75),anchorPoint:cc.p(.5,.5)})).setScale(.8),d.addChild(h);var u=UIHelper.createText({fontSize:20,fontName:"Microsoft YaHei",content:r.act_name,position:cc.p(65,42),anchorPoint:cc.p(.5,.5),fontColor:cc.color(255,255,255)});if(d.addChild(u),0!=r.quest_id){for(var g,m=!1,T=taskCenterData.getTaskInfoByID(r.quest_id),I=0;g=T[I];++I)if(1==g.state){m=!0;break}m&&l>0&&UIHelper.attachRedPot(d,cc.p(120,126))}s.pushBackCustomItem(d)}}else{var C=Language.getString(LanguageKey.NOTICE_NO_ACTIVITY),f=UIHelper.createText({fontSize:26,fontName:"Microsoft YaHei",content:C,position:cc.p(this.listWidth/2,this.listHeight),anchorPoint:cc.p(.5,.5),fontColor:cc.color(255,255,255)});e.addChild(f)}},createList:function(){var e=this._taskListView=new ccui.ListView;return e.setAnchorPoint(cc.p(0,1)),e.setPosition(0,this.listHeight),e.setDirection(ccui.ScrollView.DIR_VERTICAL),e.setScrollBarEnabled(!1),e.setBounceEnabled(!0),e.setTouchEnabled(!0),e.setContentSize(this.listWidth,this.listHeight),e},createListItem:function(e,t){var i=this.itemHeight,n={size:cc.size(this.listWidth,i)};(e+1)%2&&(n.bgColor=cc.color(1,134,149),n.colorType=ccui.Layout.BG_COLOR_SOLID);var c=UIHelper.createPanel(n),a=UIHelper.createText({fontSize:24,fontName:"Microsoft YaHei",content:t.desc,position:cc.p(12,146),anchorPoint:cc.p(0,1),fontColor:cc.color(255,255,255)});c.addChild(a);for(var o,s=t.reward_list,r=0;(o=s[r])&&(0!=o.article_type||0!=o.article_subtype||0!=o.article_id);++r){var l=this.createGrid(o,r);c.addChild(l)}var d=this.createRightEle(t,e);return c.addChild(d),c},createGrid:function(e,t){var i=UIHelper.createImage({imageFileName:"t_c_grid.png",bPlistTexture:!0,size:cc.size(86,86),position:cc.p(16+112*t,this.itemHeight/2-26),anchorPoint:cc.p(0,.5)}),n=GameUtil.getGoodsImageById(e.article_type,e.article_subtype,e.article_id),c=UIHelper.createImage({imageFileName:n,bPlistTexture:!0,anchorPoint:cc.p(.5,.5),position:cc.p(43,43)});c.setScale(.8),i.addChild(c);var a=UIHelper.createImage({imageFileName:"t_c_p_mask.png",bPlistTexture:!0,anchorPoint:cc.p(0,0),position:cc.p(7,10)});i.addChild(a);var o=UIHelper.createText({fontSize:18,fontName:"Microsoft YaHei",content:"x"+e.article_count,position:cc.p(36,22),anchorPoint:cc.p(.5,1),fontColor:cc.color(255,255,255)});return a.addChild(o),i},createRightEle:function(e,t){var i,n=e.state;if(2==n)i=this._createSignedTag();else if(1==n)(i=UIHelper.createButton({normalFile:"t_c_btn.png",bPlistTexture:!0,anchorPoint:cc.p(1,.5),position:cc.p(this.listWidth-32,this.itemHeight/2-8),bTouchEnable:!0})).setTag(t),i.addClickEventListener(this._onGetBtnTouched.bind(this));else if(0==n){i=UIHelper.createImage({imageFileName:"t_c_p_bkg.png",bPlistTexture:!0,anchorPoint:cc.p(1,.5),position:cc.p(this.listWidth-32,this.itemHeight/2)});var c=e.target,a=e.progress>=c?c:e.progress,o=Math.round(158*a/c),s=UIHelper.createImage({imageFileName:"t_c_p_upper.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(o,19),capInsets:cc.rect(18,0,2,0),anchorPoint:cc.p(0,.5),position:cc.p(2,14)});i.addChild(s,0);var r=UIHelper.createText({fontSize:22,fontName:"Microsoft YaHei",content:"进行中...",position:cc.p(82,-24),anchorPoint:cc.p(.5,.5),fontColor:cc.color(255,255,255)});i.addChild(r,0);var l=a+"/"+c,d=UIHelper.createText({fontSize:18,fontName:"Microsoft YaHei",content:l,position:cc.p(82,14),anchorPoint:cc.p(.5,.5),fontColor:cc.color(255,255,255)});i.addChild(d,0)}else console.log("status == undefined!");return i},_onTakeInBtnTouched:function(){console.log("_onTakeInBtnTouched"),this._onBackBtnTouched()},_onActivityItemSelected:function(e,t){switch(t){case ccui.ListView.ON_SELECTED_ITEM_END:var i=e,n=i.getCurSelectedIndex();if(this._oldSelectedIndex==n)return;var c=i.getItem(n);UIHelper.removeRedPot(c);var a=c.getChildByTag(101);a.setVisible(!0),(a=(c=i.getItem(this._oldSelectedIndex)).getChildByTag(101)).setVisible(!1),this._oldSelectedIndex=n,console.log("_onActivityItemSelected: curIndex= "+n),this._onTaskItemSelected(n)}},_onTaskItemSelected:function(e){var t=this._activityDataList[e];if(t){var i=t.content_type,n=this._noticeMainContent,c=this._taskMainContent;switch(i){case ActContentType.ACTIVITY_CONTENT_TYPE_PICTURE:case ActContentType.ACTIVITY_CONTENT_TYPE_TEXT:var a=n.getChildByTag(111);a&&a.removeFromParent();var o=n.getContentSize().height,s=this._createNoticePanel(t,o);n.addChild(s,0,111),n.setVisible(!0),c.setVisible(!1);break;case ActContentType.ACTIVITY_CONTENT_TYPE_TASK:n.setVisible(!1),c.setVisible(!0);var r=t.quest_id;this._updateTaskList(t,r);break;default:console.log("error contentType!")}}else console.log("null == activityData!")},_createNoticePanel:function(e,t){var i=UIHelper.createPanel({anchorPoint:cc.p(0,0),position:cc.p(0,0),size:cc.size(this.listWidth,t),bTouchEnable:!0}),n=e.act_content;if("http:"==n.substr(0,5)||"https:"==n.substr(0,6))n=(n=n.replace("https:","")).replace("http:",""),cc.loader.loadImg(n,function(e,c){if(e)console.log("cc.loader.loadImg: error!");else{var a=GameUtil.getAndCacheTexture(n,c);if(a instanceof cc.Texture2D){var o=new cc.Sprite(a);o.setAnchorPoint(.5,.5),o.setPosition(i.width/2,t/2),o.setScaleX((i.width-8)/o.width),o.setScaleY((t-8)/o.height),i.addChild(o,0)}}});else{var c=e.act_content,a=UIHelper.createText({fontSize:26,fontName:"Microsoft YaHei",content:c,size:cc.size(this.listWidth-80,t-320),position:cc.p(40,t-60),anchorPoint:cc.p(0,1),fontColor:cc.color(220,220,220)});a.ignoreContentAdaptWithSize(!1),i.addChild(a,1)}var o=UIHelper.createButton({normalFile:"m_red_btn.png",bPlistTexture:!0,position:cc.p(this.listWidth/2,60),anchorPoint:cc.p(.5,.5),bTouchEnable:!0});i.addChild(o,1);var s=UIHelper.createText({fontSize:28,fontName:"Microsoft YaHei",content:"了解详情",position:cc.p(o.width/2,42),anchorPoint:cc.p(.5,.5),fontColor:cc.color(250,250,250)});return o.addChild(s,1),o.addClickEventListener(function(){e.jump_type;var t=e.jump_data;console.log("noticeItem.jump_data= "+t)}),i},_updateTaskList:function(e,t){var i=new Date(1e3*e.start_time);i=i.getMonth()+1+"月"+i.getDate()+"日";var n=new Date(1e3*e.end_time),c=i+"--"+(n=n.getMonth()+1+"月"+n.getDate()+"日"),a=this._taskMainContent.getChildByName("activityTime");a&&a.setString(c);var o=e.act_content,s=this._taskMainContent.getChildByName("activityDetail");s&&s.setString(o);var r=this._taskListView;r.removeAllItems();for(var l,d,h=this._currSelectedTaskList=taskCenterData.getTaskInfoByID(t),p=h.length,_=0,u=0;u<p;u++)d=h[u],l=this.createListItem(u,d),r.pushBackCustomItem(l),1==d.state&&(_=u);if(_>0){var g=_/p;Timeout.register(function(){r.jumpToPercentVertical(100*g)},10)}},_onGetBtnTouched:function(e){if(!this._onSBTouched){this._onSBTouched=!0,MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch);var t=e.getTag(),i=this._currSelectedTaskList[t];if(1==i.state){var n={quest_source:2,element_id:i.taskId},c=this;function a(){c._onSBTouched=!1}var o=GameService.createCallBackMap(function(t,n){a(),i.state=2;var o=e.getParent();e.setVisible(!1),e.removeFromParent();var s=c._createSignedTag();o.addChild(s)},function(e,t){a(),console.log("GameService.takeTaskAward: error= "+e)},null,null,function(){a()});GameService.takeTaskAward(n,o)}}},_onBackBtnTouched:function(){MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),TaskCenterWindow.Destroy()},_createSignedTag:function(){return UIHelper.createImage({imageFileName:"t_c_checked.png",bPlistTexture:!0,size:cc.size(85,82),position:cc.p(this.listWidth-35-40,this.itemHeight/2),anchorPoint:cc.p(1,.5)})},_playSignEffect:function(e){e.setVisible(!1);var t=e.getParent();t&&t.addChild(this._createSignedTag())},_clearAllData:function(){this._oldSelectedIndex=0,this._onSBTouched=!1,this._activityListView&&(this._activityListView.removeAllItems(),this._activityListView.removeFromParent()),this._taskListView&&this._taskListView.removeAllItems(),this._taskMainContent&&this._taskMainContent.removeAllChildren(),this._taskMainContent&&this._taskMainContent.removeFromParent(),this._noticeMainContent&&this._noticeMainContent.removeAllChildren(),this._noticeMainContent&&this._noticeMainContent.removeFromParent(),this._activityDataList&&this._activityDataList.splice(0),this._currSelectedTaskList&&this._currSelectedTaskList.splice(0)},_onWindowResize:function(){UIHelper.adjustBgImage(this.bgImage),this.panel&&this.panel.setPosition(UIHelper.getCenterPosition())},onShow:function(){this._super()},onHide:function(){this._super()},onHideNotify:function(){TopGoldBar.Show()},onDestroyNotify:function(){TopGoldBar.Show()},onDestroy:function(){this._super(),Util.unRegisterListeners(this._listenerList),this._listenerList=null,this._taskListView&&this._taskListView.removeAllItems()}});TaskCenterWindow.GetInstance=function(){return null==TaskCenterWindow._instance&&(TaskCenterWindow._instance=new TaskCenterWindow),TaskCenterWindow._instance},TaskCenterWindow.Show=function(){ResLoader.showSubResLoadingWindow(ResObjects.getResObject(ResObjectConfig.taskCenter),function(){var e=TaskCenterWindow.GetInstance(),t=WindowAction.getScaleEaseElasticOutAction(e);WindowManager.GetInstance().showWindow(e,t,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,TaskCenterWindow.Destroy)})},TaskCenterWindow.Hide=function(){WindowManager.GetInstance().hideWindow(TaskCenterWindow._instance)},TaskCenterWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(TaskCenterWindow._instance),TaskCenterWindow._instance=null},TaskCenterWindow.updateView=function(){TaskCenterWindow._instance?TaskCenterWindow._instance.onActivityNotified():taskCenterData._bNeedUpdate=!0};
var TaskWindow=WindowBase.extend({_dialogPanel:null,_taskList:null,_taskData:null,_rewardList:null,_rewardData:null,curActivityValue:0,ctor:function(){this._super(),this.initView()},initView:function(){var e=UIHelper.createPanel({anchorPoint:COMMON_ANCHOR.midCenter,position:UIHelper.getCenterPosition(),size:cc.size(620,910),bTouchEnable:!1});this._dialogPanel=e,this.addChild(e);var t=UIHelper.createImage({imageFileName:"task_bg.png",bPlistTexture:!0,bScale9Enabled:!0,anchorPoint:COMMON_ANCHOR.leftBottom,size:cc.size(620,910),capInsets:cc.rect(0,70,620,30),position:cc.p(0,0)});e.addChild(t);var i=UIHelper.createButton({normalFile:"btn_back_N.png",bPlistTexture:!0,position:cc.p(38,890),bTouchEnable:!0});i.addTouchEventListener(this._onBackButtonTouched,this),e.addChild(i,1);var a=UIHelper.createImage({imageFileName:"task_title.png",bPlistTexture:!0,position:cc.p(312,876)});e.addChild(a),this.initTaskData(),this._taskList=this.createTaskList(),e.addChild(this._taskList,1),this.initTaskList();var n=this.createRewardPanel();e.addChild(n,1)},onEnter:function(){this._super(),this._listenerList=[]},onExit:function(){this._super(),Util.unRegisterListeners(this._listenerList),this._listenerList=null},_onBackButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),TaskWindow.Destroy())},createRewardPanel:function(){var e=UIHelper.createPanel({anchorPoint:COMMON_ANCHOR.midBottom,position:cc.p(310,650),size:cc.size(550,180)}),t=UIHelper.createImage({imageFileName:"task_progress_bar_0.png",bPlistTexture:!0,bScale9Enabled:!0,anchorPoint:COMMON_ANCHOR.midCenter,size:cc.size(450,17),capInsets:cc.rect(10,0,10,17),position:cc.p(265,53)});e.addChild(t);var i=UIHelper.createImage({imageFileName:"task_progress_bar_1.png",bPlistTexture:!0,bScale9Enabled:!0,anchorPoint:COMMON_ANCHOR.leftMid,size:cc.size(444*Math.min(1,this.curActivityValue/120),13),capInsets:cc.rect(10,0,20,10),position:cc.p(44,54)});e.addChild(i);var a=UIHelper.createImage({imageFileName:"task_activity_panel.png",bPlistTexture:!0,anchorPoint:COMMON_ANCHOR.midTop,position:cc.p(i.getContentSize().width,-3)});i.addChild(a);var n=new cc.LabelBMFont(""+this.curActivityValue,res.number_white_fnt);n.setName("activity"),n.setScale(.8),n.setAnchorPoint(0,.5),n.setPosition(80,14),a.addChild(n);var o=UIHelper.createList({anchorPoint:COMMON_ANCHOR.leftBottom,contentSize:cc.size(452,120),direction:ccui.ScrollView.DIR_HORIZONTAL,bounceEnabled:!1,touchEnabled:!1,position:cc.p(93,60)});e.addChild(o),this._rewardList=o;for(var r=0;r<4;r++){var s=this.createGiftItem(r,this._rewardData[r]);o.pushBackCustomItem(s)}return e},createGiftItem:function(e,t){var i=e+1,a=UIHelper.createPanel({anchorPoint:COMMON_ANCHOR.leftBottom,position:cc.p(0,0),size:cc.size(113,120)}),n=UIHelper.createImage({imageFileName:"task_light.png",bPlistTexture:!0,anchorPoint:COMMON_ANCHOR.midCenter,position:cc.p(56,50)});n.setName("light"),n.setScale(.8),a.addChild(n),1==t.state?(n.setVisible(!0),n.runAction(cc.repeatForever(cc.rotateBy(3,360)))):n.setVisible(!1);var o=UIHelper.createImage({imageFileName:"task_gift_"+i+".png",bPlistTexture:!0,anchorPoint:COMMON_ANCHOR.midBottom,position:cc.p(56,5)});a.addChild(o),o.setTouchEnabled(!0),o.setTag(e),o.addTouchEventListener(this._onGiftTouched,this);var r=UIHelper.createImage({imageFileName:"task_arrow.png",bPlistTexture:!0,anchorPoint:COMMON_ANCHOR.midBottom,position:cc.p(56,-5)});a.addChild(r);var s=new cc.LabelBMFont(""+t.target,res.number_white_fnt);s.setAnchorPoint(.5,0),s.setPosition(56,85),a.addChild(s);var c=UIHelper.createImage({imageFileName:"task_icon_done.png",bPlistTexture:!0,anchorPoint:COMMON_ANCHOR.midCenter,position:cc.p(86,25)});return c.setName("icon_done"),a.addChild(c),2==t.state?c.setVisible(!0):c.setVisible(!1),a},createGiftPreviewWindow:function(e){for(var t=[],i=0;i<e.length;i++){var a=e[i];t.push({icon:GameUtil.getGoodsImageById(a.article_type,a.article_subtype,a.article_id),amount:a.article_count,probability:!1})}var n=UIHelper.createRewardPreviewPanel(t);return n.setAnchorPoint(0,1),n},createTaskList:function(){return UIHelper.createList({backgroundImage:"task_list_bg.png",bBgScale9Enabled:!0,bPlistTexture:!0,anchorPoint:COMMON_ANCHOR.midBottom,contentSize:cc.size(570,615),direction:ccui.ScrollView.DIR_VERTICAL,bounceEnabled:!0,touchEnabled:!0,position:cc.p(310,20)})},createItem:function(e,t){var i=UIHelper.createPanel({anchorPoint:COMMON_ANCHOR.leftBottom,position:cc.p(0,0),size:cc.size(570,123)}),a=new cc.Sprite;a.initWithSpriteFrameName("task_icon_"+(e%4+1)+".jpg"),a.setName("icon"),a.setPosition(30,70),a.setAnchorPoint(0,.5),i.addChild(a);var n=UIHelper.createText({position:cc.p(130,105),anchorPoint:COMMON_ANCHOR.leftTop,fontSize:20,fontColor:cc.color(255,255,255),content:t.desc});i.addChild(n);var o=UIHelper.createText({position:cc.p(130,78),anchorPoint:COMMON_ANCHOR.leftTop,fontSize:20,fontColor:cc.color(255,255,255),content:"活跃度："});i.addChild(o);var r=new cc.LabelBMFont(""+t.activity,res.number_gold_big_fnt);r.setName("activity"),r.setAnchorPoint(0,.5),r.setPosition(220,65),i.addChild(r);var s=UIHelper.createImage({imageFileName:"task_progress_bar_0.png",bPlistTexture:!0,bScale9Enabled:!0,anchorPoint:COMMON_ANCHOR.leftBottom,size:cc.size(200,17),capInsets:cc.rect(10,0,10,17),position:cc.p(130,30)});i.addChild(s);var c=UIHelper.createImage({imageFileName:"task_progress_bar_1.png",bPlistTexture:!0,bScale9Enabled:!0,anchorPoint:COMMON_ANCHOR.leftBottom,size:cc.size(t.progress/t.target*194,13),capInsets:cc.rect(10,0,20,10),position:cc.p(133,33)});i.addChild(c);var l=UIHelper.createText({position:cc.p(230,39),anchorPoint:COMMON_ANCHOR.midCenter,fontSize:14,fontColor:cc.color(255,255,255),content:t.progress+"/"+t.target});i.addChild(l);var d=UIHelper.createButton({normalFile:"task_btn_go.png",disabledFile:"task_btn_done.png",bPlistTexture:!0,position:cc.p(470,62),bTouchEnable:!0});d.setTag(e),d.addTouchEventListener(this._onJumpBtnTouched,this),0!=t.state&&d.setEnabled(!1),i.addChild(d);var h=UIHelper.createImage({imageFileName:"task_s_line.png",bPlistTexture:!0,bScale9Enabled:!0,anchorPoint:COMMON_ANCHOR.midBottom,size:cc.size(530,15),capInsets:cc.rect(20,0,12,15),position:cc.p(285,0)});return i.addChild(h),i},_onJumpBtnTouched:function(e,t){if(ccui.Widget.TOUCH_ENDED==t){MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),console.log(e.getTag());var i=e.getTag();TaskWindow.Destroy(),4==i&&ShareForGift.onTouched()}},_onGiftTouched:function(e,t){var i=e.getTag(),a=this._rewardData[i],n=this;if(ccui.Widget.TOUCH_BEGAN==t&&(clearTimeout(this._previewTimeout),this._previewPanel&&(this._previewPanel.removeFromParent(),this._previewPanel=null),1!=a.state&&(this._previewTimeout=Timeout.register(function(){var e=[cc.p(220,840),cc.p(350,840),cc.p(100,840),cc.p(230,840)],t=n.createGiftPreviewWindow(n._rewardData[i].rewardList);t.setPosition(e[i]),n._dialogPanel.addChild(t,2),n._previewPanel=t},100))),ccui.Widget.TOUCH_ENDED==t||ccui.Widget.TOUCH_CANCELED==t)if(console.log(e.getTag()),1==a.state&&ccui.Widget.TOUCH_ENDED==t){MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch);var o={quest_source:1,element_id:a.taskId};NetLoadingWindow.Show();n=this;var r=GameService.createCallBackMap(function(e,t){NetLoadingWindow.Hide(),a.state=2;var o=n._rewardList.getItem(i),r=o.getChildByName("light"),s=o.getChildByName("icon_done");r.setVisible(!1),s.setVisible(!0),n.showGetRewardEffect(a.rewardList)},function(e,t){NetLoadingWindow.Hide()},null,null,function(){NetLoadingWindow.Hide()});GameService.takeTaskAward(o,r)}else if(clearTimeout(this._previewTimeout),this._previewPanel)return this._previewPanel.removeFromParent(),void(this._previewPanel=null)},initTaskData:function(){this._taskData=[],this._rewardData=[];var e=cc.loader.cache[res.EverydayActivityQuestElementConf_bin_json],t=cc.loader.cache[res.EverydayActivityQuestRewardPool_bin_json];e=e&&e.list_data||[],t=t&&t.list_data||[];for(var i=0;i<4;i++){var a=t[(s=e[i]).reward_id-1],n=GameUtil.getTaskProgressInfoById(1,s.element_id),o=[];for(var r in a.reward_list)1==a.reward_list[r].article_type&&o.push(a.reward_list[r]);this._rewardData.push({taskId:s.element_id,state:n&&n.state||0,target:s.upper_limit,rewardList:o}),3===i&&(this.curActivityValue=n&&n.process||0)}for(i=4;i<e.length;i++){var s;a=t[(s=e[i]).reward_id-1],n=GameUtil.getTaskProgressInfoById(1,s.element_id);this._taskData.push({taskId:s.element_id,state:n&&n.state||0,desc:s.quest_desc,target:s.upper_limit,progress:n&&n.process||0,activity:a.reward_list[0].article_count})}console.log("每日任务奖励数据"),console.log(JSON.stringify(this._rewardData))},initTaskList:function(){for(var e=0,t=this._taskData.length;e<t;e++){var i=this.createItem(e,this._taskData[e]);this._taskList.pushBackCustomItem(i)}},showGetRewardEffect:function(e){var t=cc.winSize.width,i=cc.winSize.height,a=new Mask;a.setGrey(!0),this.addChild(a,1);var n=UIHelper.createPanel({position:UIHelper.getCenterPosition(),anchorPoint:COMMON_ANCHOR.midCenter,bTouchEnable:!0,size:cc.size(t,i)});a.addChild(n,2);var o=new GiftShineEffect;o.visible=!1,o.setPosition(UIHelper.getCenterPosition()),o.setScale(3.5),n.addChild(o);var r=new GiftGetEffect;r.setPosition(UIHelper.getCenterPosition()),r.setScale(1.5),r.play(),n.addChild(r);var s=new GiftLightEffect;s.visible=!1,s.setPosition(UIHelper.getCenterPosition()),s.setScale(1.5),n.addChild(s);var c=UIHelper.seekWidgetByName(r,"Panel_8");c.setBackGroundColorType(ccui.Layout.BG_COLOR_NONE);var l=this.createRewardList(e);l.setPosition(100,100),c.addChild(l),Timeout.register(function(){s.play(),s.visible=!0,o.play(),o.visible=!0},2200),Timeout.register(function(){a.removeFromParent()},4e3)},createRewardList:function(e){var t=UIHelper.createList({anchorPoint:COMMON_ANCHOR.midCenter,contentSize:cc.size(300,120*e.length),direction:ccui.ScrollView.DIR_VERTICAL,bounceEnabled:!1,touchEnabled:!1});t.setScale(.8);for(var i=0;i<e.length;i++){var a=e[i],n=UIHelper.createPanel({size:cc.size(300,120)});t.pushBackCustomItem(n);var o=GameUtil.getGoodsImageById(a.article_type,a.article_subtype,a.article_id),r=UIHelper.createImage({imageFileName:o,bPlistTexture:!0,anchorPoint:COMMON_ANCHOR.midCenter,position:cc.p(150,70)});r.setScale(.8),n.addChild(r);var s=new cc.LabelBMFont("X"+a.article_count,res.number_stage_y_fnt);s.setPosition(150,2),s.setAnchorPoint(.5,0),s.setScale(.8),n.addChild(s)}return t},onHideNotify:function(){this._super(),TopGoldBar.Show()},onDestroyNotify:function(){this._super(),TopGoldBar.Show()}});TaskWindow.GetInstance=function(){return null==TaskWindow._instance&&(TaskWindow._instance=new TaskWindow),TaskWindow._instance},TaskWindow.Show=function(e,t){ResLoader.showSubResLoadingWindow(ResObjects.getResObject(ResObjectConfig.task),function(){var e=TaskWindow.GetInstance();if(null==e.parent){var i=WindowAction.getScaleEaseElasticOutAction(e);WindowManager.GetInstance().showWindow(e,i,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,t,TaskWindow.Destroy)}})},TaskWindow.Hide=function(){WindowManager.GetInstance().hideWindow(TaskWindow._instance)},TaskWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(TaskWindow._instance),TaskWindow._instance=null};
var tempDiamonds=0,tempGold=0,TopGoldBar=cc.Layer.extend({diamondLabel:null,goldLabel:null,heartLabel:null,_heartLabelOriginPos:null,_leftHeartLabel:null,_leftHeartCircle:null,_listenerList:null,diamondNum:0,goldNum:0,heartNum:0,_sortViewGroup:null,_totalWidth:0,_touchEnable:!0,ctor:function(){this._super(),this.initView(),this._updateHeartLabel(),this._listenerList=[],Util.registerListener(this._listenerList,EventID.AT_DIAMOND,function(){this.refreshView()}.bind(this)),Util.registerListener(this._listenerList,EventID.AT_MONEY,function(){this.refreshView()}.bind(this)),Util.registerListener(this._listenerList,EventID.HEART_RECOVERY,this._onHeartRecovery.bind(this)),Util.registerListener(this._listenerList,EventID.ON_WINDOW_RESIZE,this.onWindowResize.bind(this))},isWXMode:function(){return!0},initView:function(){if(this.isWXMode())return this.initViewInWX();var e=new SortViewGroup,o=cc.winSize.height-10,t=0;t+=(i=this.createItemPanel({id:1,icon:"tgb_diamond.png",size:cc.size(210,66),pos:cc.p(10,o),anchor:COMMON_ANCHOR.leftTop})).getContentSize().width,e.addView(i);t+=(i=this.createItemPanel({id:2,icon:"tgb_gold.png",size:cc.size(220,66),pos:cc.p(220,o),anchor:COMMON_ANCHOR.leftTop})).getContentSize().width,e.addView(i);var i;t+=(i=this.createItemPanel({id:3,icon:"tgb_heart.png",size:cc.size(190,66),pos:cc.p(cc.winSize.width-10,o),anchor:COMMON_ANCHOR.rightTop})).getContentSize().width,e.addView(i);var n=(cc.winSize.width-t-20)/(e.getViewCount()-1);e.setMidX(cc.winSize.width/2),e.setViewHorizontalSpacing(n),e.sort(),this._sortViewGroup=e,this._totalWidth=t,this._touchEnable=!0},initViewInWX:function(){var e=cc.winSize.height-(iphoneXMode?88:10),o=0;o+=this.createItemPanel({id:1,icon:"tgb_diamond.png",size:cc.size(210,66),pos:cc.p(5,e),anchor:COMMON_ANCHOR.leftTop,tgbBg:wx.getSystemInfoSync().system.indexOf("iOS")>=0&&"tgb_bg_panel_pure.png"}).getContentSize().width;o+=this.createItemPanel({id:2,icon:"tgb_gold.png",size:cc.size(220,66),pos:cc.p(170,e),anchor:COMMON_ANCHOR.leftTop}).getContentSize().width;o+=this.createItemPanel({id:3,icon:"tgb_heart.png",size:cc.size(160,66),pos:cc.p(340,e),anchor:COMMON_ANCHOR.leftTop}).getContentSize().width,this._totalWidth=o,this._touchEnable=!0},createItemPanel:function(e){var o=UIHelper.createImage({imageFileName:e.tgbBg||"tgb_bg_panel.png",bPlistTexture:!0,bScale9Enabled:!0,size:e.size,capInsets:cc.rect(30,0,20,66),position:cc.p(e.pos.x,e.pos.y),anchorPoint:e.anchor});this.isWXMode()&&o.setScale(.8),this.addChild(o);var t=new cc.Sprite;t.initWithSpriteFrameName(e.icon),t.setAnchorPoint(.5,0),t.setPosition(40,13),o.addChild(t);var i=new cc.LabelBMFont("0",res.number_white_fnt);i.setAnchorPoint(1,.5),i.setScale(.8),i.setPosition(e.size.width-55,30),o.addChild(i);var n=UIHelper.createPanel({anchorPoint:COMMON_ANCHOR.leftBottom,position:cc.p(0,0),size:e.size,bTouchEnable:!0});if(o.addChild(n),1==e.id)this.diamondLabel=i,n.addTouchEventListener(this._onDiamondBtnTouched,this);else if(2==e.id)t.setPositionY(t.getPositionY()-2),this.goldLabel=i,n.addTouchEventListener(this._onGoldBtnTouched,this);else if(3==e.id){this.heartLabel=i,this._heartLabelOriginPos=i.getPosition(),n.addTouchEventListener(this._onHeartBtnTouched,this);var c=new cc.LabelBMFont("0",res.number_white_fnt);c.setAnchorPoint(.5,.5),c.setPosition(75,-10),o.addChild(c),this._leftHeartLabel=c}return o},refreshView:function(){this.diamondNum=NetData.diamond.count,this.goldNum=NetData.money.count,this.diamondLabel.setString(this.diamondNum),tempDiamonds=this.diamondNum,this.goldLabel.setString(this.goldNum),tempGold=this.goldNum,this._updateHeartLabel()},addDiamond:function(e){this.diamondNum+=e,this.diamondLabel.setString(this.diamondNum),tempDiamonds=this.diamondNum},addGold:function(e){this.goldNum+=e,this.goldLabel.setString(this.goldNum),tempGold=this.goldNum},_onDiamondBtnTouched:function(e,o){if(this._touchEnable)if(wx.getSystemInfoSync().system.indexOf("iOS")>=0)console.error("iOS 不能买钻石");else{var t=this;if(window.showGmPanel&&ccui.Widget.TOUCH_BEGAN==o&&(this._gmTimeout=Timeout.register(function(){t._openGm=!0,GmDialog&&GmDialog.show()},3e3)),ccui.Widget.TOUCH_ENDED==o){if(clearTimeout(this._gmTimeout),this._openGm)return void(this._openGm=!1);console.log("diamond"),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),ExchangeWindow.show({exchangeType:ExchangeWindow.Type.DIAMOND})}}},_onGoldBtnTouched:function(e,o){ccui.Widget.TOUCH_BEGAN==o||ccui.Widget.TOUCH_ENDED==o&&this._touchEnable&&(clearTimeout(this._autoPlayTimeout),console.log("gold"),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),ExchangeWindow.show({exchangeType:ExchangeWindow.Type.GOLD}))},_onHeartBtnTouched:function(e,o){ccui.Widget.TOUCH_BEGAN==o||ccui.Widget.TOUCH_ENDED==o&&this._touchEnable&&(clearTimeout(this._recordTimeout),this._recordTimeout=null,console.log("heart"),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),ExchangeWindow.show({exchangeType:ExchangeWindow.Type.HEART}))},_startShowRecordWindowTimer:function(){var e=this;this._recordTimeout=Timeout.register(function(){InputRecordWindow.Show(function(e){GameProxy.init();var o={start_info:{random_seed:1513320744,item_id_list:[],stage_id:{id:1002,sub_id:0}},input:[{op:0,from:{row:5,col:2},to:{row:6,col:2},item_id:0,value1:0,value2:0},{op:0,from:{row:5,col:4},to:{row:6,col:4},item_id:0,value1:0,value2:0},{op:0,from:{row:6,col:3},to:{row:5,col:3},item_id:0,value1:0,value2:0},{op:0,from:{row:6,col:1},to:{row:7,col:1},item_id:0,value1:0,value2:0},{op:0,from:{row:2,col:5},to:{row:3,col:5},item_id:0,value1:0,value2:0},{op:0,from:{row:7,col:1},to:{row:6,col:1},item_id:0,value1:0,value2:0},{op:0,from:{row:6,col:5},to:{row:7,col:5},item_id:0,value1:0,value2:0},{op:0,from:{row:5,col:2},to:{row:5,col:3},item_id:0,value1:0,value2:0},{op:0,from:{row:3,col:6},to:{row:4,col:6},item_id:0,value1:0,value2:0},{op:0,from:{row:6,col:2},to:{row:7,col:2},item_id:0,value1:0,value2:0},{op:0,from:{row:4,col:2},to:{row:5,col:2},item_id:0,value1:0,value2:0},{op:0,from:{row:2,col:5},to:{row:3,col:5},item_id:0,value1:0,value2:0},{op:0,from:{row:4,col:1},to:{row:4,col:2},item_id:0,value1:0,value2:0},{op:0,from:{row:7,col:2},to:{row:6,col:2},item_id:0,value1:0,value2:0},{op:0,from:{row:6,col:2},to:{row:7,col:2},item_id:0,value1:0,value2:0},{op:0,from:{row:4,col:3},to:{row:5,col:3},item_id:0,value1:0,value2:0},{op:0,from:{row:6,col:3},to:{row:5,col:3},item_id:0,value1:0,value2:0},{op:0,from:{row:5,col:5},to:{row:5,col:6},item_id:0,value1:0,value2:0},{op:0,from:{row:2,col:2},to:{row:2,col:3},item_id:0,value1:0,value2:0},{op:0,from:{row:2,col:3},to:{row:3,col:3},item_id:0,value1:0,value2:0},{op:0,from:{row:7,col:5},to:{row:7,col:6},item_id:0,value1:0,value2:0},{op:0,from:{row:5,col:4},to:{row:5,col:5},item_id:0,value1:0,value2:0},{op:0,from:{row:3,col:4},to:{row:4,col:4},item_id:0,value1:0,value2:0},{op:0,from:{row:6,col:5},to:{row:7,col:5},item_id:0,value1:0,value2:0},{op:0,from:{row:2,col:2},to:{row:2,col:3},item_id:0,value1:0,value2:0},{op:0,from:{row:6,col:5},to:{row:6,col:6},item_id:0,value1:0,value2:0},{op:0,from:{row:5,col:5},to:{row:5,col:6},item_id:0,value1:0,value2:0}],game_result:1,game_info:{crush_chess_count:[{type:3,count:408},{type:4,count:5},{type:5,count:3},{type:6,count:6},{type:7,count:3},{type:3,count:408},{type:4,count:5},{type:5,count:3},{type:6,count:6},{type:7,count:3}],crush_color_count:[{color:0,count:106},{color:1,count:81},{color:2,count:78},{color:3,count:86},{color:4,count:71},{color:-1,count:3},{color:0,count:106},{color:1,count:81},{color:2,count:78},{color:3,count:86},{color:4,count:71},{color:-1,count:3}],add_chess_count:[{type:4,count:5},{type:5,count:3},{type:6,count:6},{type:7,count:3},{type:4,count:5},{type:5,count:3},{type:6,count:6},{type:7,count:3}],add_color_count:[{color:0,count:3},{color:1,count:4},{color:2,count:2},{color:3,count:3},{color:4,count:2},{color:-1,count:3},{color:0,count:3},{color:1,count:4},{color:2,count:2},{color:3,count:3},{color:4,count:2},{color:-1,count:3}],slide_count:30,attack_count:[{attack:1,count:66},{attack:2,count:5},{attack:3,count:3},{attack:4,count:6},{attack:8,count:3},{attack:1,count:66},{attack:2,count:5},{attack:3,count:3},{attack:4,count:6},{attack:8,count:3}],drop_round_count:[23,11,3,3],used_item:[],score:86800,star_level:1},fail_reason:0,arena_match_id:0xd11167315400000},t=o.start_info.stage_id.id;GameProxy.setStageId(t),puzzleGame.loadStage(new StageId(t,GameUtil.getStageSubId(t)),function(){t>=0&&(HistoryRecord.isUsingHistory=!0,HistoryRecord.curUsingRecord=o,HistoryRecord.curInputIndex=0,ResLoader.showPageResLoadingWindow(0,ResObjects.getResObject(ResObjectConfig.mainGame),function(){puzzleGame.eventManager.bind("GAMESTART",function(){puzzleGame.simple_stage_info(function(e){PageUtil.switchPageTo("MainGamePage",PageType.replace,ResObjects.getResObject(ResObjectConfig.mainGame),new SimpleStageData(e),function(){ResLoader.hideLoadingWindow()})}.bind(this))}),puzzleGame.run(o.start_info)}.bind(this),function(){ResLoader.hideLoadingWindow()}))})},e)},3e3)},_onHeartRecovery:function(){this._updateHeartLabel()},_updateHeartLabel:function(){var e=HeartRecoveryLogic.getHeartRecoveryType();switch(e){case HeartRecoveryType.OVER_MAX_HEART_COUNT:case HeartRecoveryType.MAX_HEART_COUNT:this._leftHeartLabel.setVisible(!1),this.heartLabel.setString(HeartRecoveryLogic.getHeartCount());break;case HeartRecoveryType.COUNT_DOWN:this._leftHeartLabel.setVisible(!0),this.heartLabel.setString(HeartRecoveryLogic.getHeartCount()),this._leftHeartLabel.setString(HeartRecoveryLogic.getTime());break;default:console.log("unKnown heartRecoveryType : "+e)}},setTouchEnable:function(e){this._touchEnable=e},onWindowResize:function(){if(!this.isWXMode()){var e=this._sortViewGroup,o=(cc.winSize.width-this._totalWidth-20)/(e.getViewCount()-1);e.setMidX(cc.winSize.width/2),e.setViewHorizontalSpacing(o),e.sort()}}});TopGoldBar.Show=function(){if(null==TopGoldBar._instance){TopGoldBar._instance=new TopGoldBar;cc.director.getRunningScene().addChild(TopGoldBar._instance,GameCommonDef.LAYER_Z_ORDER_TIP_UI)}TopGoldBar._instance.setVisible(!0),TopGoldBar._instance.refreshView()},TopGoldBar.Hide=function(){TopGoldBar._instance&&TopGoldBar._instance.setVisible(!1)},TopGoldBar.GetInstance=function(){return TopGoldBar._instance},TopGoldBar.Destroy=function(){TopGoldBar._instance&&TopGoldBar._instance.removeFromParent(),TopGoldBar._instance=null};
var TipWindow=WindowBase.extend({_content:null,_contentText:null,_maxWidth:null,_sureButtonTouchedCallBack:null,_align:null,_fontSize:null,_title:null,ctor:function(){this._super();var t=cc.size(555,390);this._maxWidth=t.width-40;var n=UIHelper.createImage({imageFileName:"bg_dialog.png",bPlistTexture:!0,bScale9Enabled:!0,size:t,capInsets:cc.rect(0,72,512,22),position:UIHelper.getPosition(320,570)});this.addChild(n);var e=UIHelper.createButton({normalFile:"m_red_btn.png",bPlistTexture:!0,bPressedActionEnabled:!0,position:cc.p(t.width/2,50),bTouchEnable:!0});e.addTouchEventListener(this._onSureButtonTouched,this),n.addChild(e);var i=UIHelper.createImage({imageFileName:"btn_title_sure.png",bPlistTexture:!0,position:cc.p(e.getContentSize().width/2,e.getContentSize().height/2+10)});e.addChild(i);i=UIHelper.createText({position:cc.p(t.width/2,230),fontSize:28,fontColor:cc.color(255,255,255),content:"",bIgnoreSize:!0});n.addChild(i),this._contentText=i;i=UIHelper.createText({position:cc.p(t.width/2,t.height-35),fontSize:28,fontColor:cc.color(255,255,255),content:"",bIgnoreSize:!0});n.addChild(i),this._titleText=i},setSureButtonTouchedCallBack:function(t){this._sureButtonTouchedCallBack=t},_onSureButtonTouched:function(t,n){if(ccui.Widget.TOUCH_ENDED==n){var e;"function"==typeof this._sureButtonTouchedCallBack&&(e=!!this._sureButtonTouchedCallBack()),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),!e&&TipWindow.Hide()}},setContent:function(t,n,e,i){this._title=i,this._content=t,this._align=n,this._fontSize=e},onShowNotify:function(){null!=this._content&&("number"==typeof this._fontSize&&this._contentText.setFontSize(this._fontSize),UIHelper.subsectionTextForUIText(this._contentText,this._content,this._maxWidth,this._align)),null!=this._title?this._titleText.setString(this._title):this._titleText.setString(""),this._title=null,this._align=null,this._content=null,this._fontSize=null},onShow:function(){},onHideNotify:function(){},onHide:function(){},onDestroyNotify:function(){},onDestroy:function(){},onCover:function(){},onResume:function(){}});TipWindow.GetInstance=function(){return null==TipWindow._instance&&(TipWindow._instance=new TipWindow),TipWindow._instance},TipWindow.Show=function(t,n,e,i,o,c){var l=TipWindow.GetInstance();l.setContent(t,e,i,o),l.setSureButtonTouchedCallBack(n);var s=WindowAction.getScaleEaseElasticOutAction(l);WindowManager.GetInstance().showWindow(l,s,!0,GameCommonDef.LAYER_Z_ORDER_TIP_UI,!1,null,c,TipWindow.Destroy)},TipWindow.Hide=function(){WindowManager.GetInstance().hideWindow(TipWindow._instance)},TipWindow.Destroy=function(){WindowManager.GetInstance().destroyWindow(TipWindow._instance),TipWindow._instance=null};
var MusicEffectFiles={Audio_V_ready:"res/sound/V_ready",Audio_A_select:"res/sound/A_select",Audio_A_falsemove:"res/sound/A_falsemove",Audio_A_highlight:"res/sound/A_highlight",Audio_A_ground:"res/sound/A_ground",Audio_UI_touch:"res/sound/UI_touch",Audio_UI_heartexplode:"res/sound/UI_heartexplode",Audio_UI_coin:"res/sound/UI_coin",Audio_UI_buyitem:"res/sound/UI_buyitem",Audio_UI_cancelitem:"res/sound/UI_cancelitem",Audio_UI_scoreinc:"res/sound/UI_scoreinc",Audio_UI_buydiamond:"res/sound/UI_buydiamond",Audio_UI_buycoin:"res/sound/UI_buycoin",Audio_UI_buyheart:"res/sound/UI_buyheart",Audio_timi:"res/sound/timi",Audio_login:"res/sound/login",Audio_G_icebroken:"res/sound/G_icebroken",Audio_G_boxbroken:"res/sound/G_boxbroken",Audio_G_lockbroken:"res/sound/G_lockbroken",Audio_G_ballooncreate:"res/sound/G_ballooncreate",Audio_G_balloonget:"res/sound/G_balloonget",Audio_G_balloonretroaction:"res/sound/G_balloonretroaction",Audio_G_shockwave:"res/sound/G_shockwave",Audio_G_bomb:"res/sound/G_bomb",Audio_G_ghostabsorb:"res/sound/G_ghostabsorb",Audio_G_ghostabsorb_loop:"res/sound/G_ghostabsorb_loop",Audio_G_ghostsing:"res/sound/G_ghostsing",Audio_G_ghostsing_loop:"res/sound/G_ghostsing_loop",Audio_G_produceshock:"res/sound/G_produceshock",Audio_G_producebomb:"res/sound/G_producebomb",Audio_G_produceghost:"res/sound/G_produceghost",Audio_G_useitem:"res/sound/G_useitem",Audio_G_disappear:"res/sound/G_disappear",Audio_G_exchange1:"res/sound/G_exchange1",Audio_G_exchange2:"res/sound/G_exchange2",Audio_G_changetoshock1:"res/sound/G_changetoshock1",Audio_G_changetoshock2:"res/sound/G_changetoshock2",Audio_G_rearrangement:"res/sound/G_rearrangement",Audio_G_backstep:"res/sound/G_backstep",Audio_G_elimination:"res/sound/G_elimination",Audio_G_dropelimination1:"res/sound/G_dropelimination1",Audio_G_dropelimination2:"res/sound/G_dropelimination2",Audio_G_dropelimination3:"res/sound/G_dropelimination3",Audio_G_dropelimination4:"res/sound/G_dropelimination4",Audio_V_newcombo3:"res/sound/V_newcombo3",Audio_V_newcombo4:"res/sound/V_newcombo4",Audio_V_newcombo5:"res/sound/V_newcombo5",Audio_V_newcombo6:"res/sound/V_newcombo6",Audio_V_newcombo7:"res/sound/V_newcombo7",Audio_V_newcombo8:"res/sound/V_newcombo8",Audio_V_newcombo9:"res/sound/V_newcombo9",Audio_V_newcombo10:"res/sound/V_newcombo10",Audio_V_newcombo11:"res/sound/V_newcombo11",Audio_bgm_game_puzzle:"res/sound/bgm_game_puzzle",Audio_bgm_game_puzzle2:"res/sound/bgm_game_puzzle2",Audio_UI_guide:"res/sound/UI_guide",Audio_UI_star:"res/sound/UI_star",Audio_UI_step5:"res/sound/UI_step5",Audio_UI_step10:"res/sound/UI_step10",Audio_UI_stagewin:"res/sound/UI_stagewin",Audio_UI_stagefail:"res/sound/UI_stagefail",Audio_UI_lastpang:"res/sound/UI_lastpang",Audio_G_xray:"res/sound/G_xray",Audio_UI_clouddisappear:"res/sound/UI_clouddisappear",Audio_UI_stagewinscore:"res/sound/UI_stagewinscore",Audio_UI_stagewinstar:"res/sound/UI_stagewinstar",Audio_UI_stagewinstar2:"res/sound/UI_stagewinstar2",Audio_UI_stagewinstar3:"res/sound/UI_stagewinstar3",Audio_UI_stagefailscore:"res/sound/UI_stagefailscore",Audio_UI_newstage1:"res/sound/UI_newstage1",Audio_UI_newstage2:"res/sound/UI_newstage2",Audio_G_addtimefly:"res/sound/G_addtimefly",Audio_G_addtimeretroaction:"res/sound/G_addtimeretroaction",Audio_G_popboom:"res/sound/G_popboom",Audio_G_popget:"res/sound/G_popget",Audio_G_popretroaction:"res/sound/G_popretroaction",Audio_G_chocolatebroken:"res/sound/G_chocolatebroken",Audio_G_bombboom:"res/sound/G_bombboom",Audio_G_grass:"res/sound/G_grass",Audio_G_timebomb:"res/sound/G_timebomb",Audio_UI_starrewardbox:"res/sound/UI_starrewardbox",Audio_G_candycreate:"res/sound/G_candycreate",Audio_G_candyget:"res/sound/G_candyget",Audio_G_candyjarhit:"res/sound/G_candyjarhit",Audio_G_candyretroaction:"res/sound/G_candyretroaction",Audio_G_jellybroken:"res/sound/G_jellybroken",Audio_G_abaorelease:"res/sound/G_abaorelease",Audio_G_abaoretroaction:"res/sound/G_abaoretroaction"};
var MusicManager={_fileExtension:".mp3",_bEffectEnable:!0,_bMusicEnable:!0,_wxAudioMusicContext:wx.createInnerAudioContext(),init:function(n,i,e,t){console.log("MusicManager.init : "+n+","+i),GameUtil.isNoSound(window._launchOptions)&&(console.log("关闭声音开关"),n=!1,i=!1),this.setMusicEnable(n),this.setEffectEnable(i),this.setMusicVolume(e),this.setEffectsVolume(t),this.bindEvent()},bindEvent:function(){var n=this;wx.onHide(function(){n._wxAudioMusicContext&&n._wxAudioMusicContext.pause()}),wx.onShow(function(){n._wxAudioMusicContext&&n._wxAudioMusicContext.play()}),wx.onAudioInterruptionBegin&&(wx.onAudioInterruptionBegin(function(){console.log("onAudioInterruptionBegin"),n._wxAudioMusicContext&&n._wxAudioMusicContext.pause()}),wx.onAudioInterruptionEnd(function(){console.log("onAudioInterruptionEnd "),n._wxAudioMusicContext&&n._wxAudioMusicContext.play()}))},getLoginBgMusicRes:function(){return MusicEffectFiles.Audio_login+this._fileExtension},setEffectEnable:function(n){this._bEffectEnable!==n&&(this._bEffectEnable=n,!1===this._bEffectEnable&&cc.audioEngine.stopAllEffects())},isEffectEnable:function(){return this._bEffectEnable},setMusicEnable:function(n){this._bMusicEnable!==n&&(this._bMusicEnable=n,!1===this._bMusicEnable&&cc.audioEngine.stopMusic())},isMusicEnable:function(){return this._bMusicEnable},setEffectsVolume:function(n){cc.audioEngine.setEffectsVolume(n)},getEffectsVolume:function(){return cc.audioEngine.getEffectsVolume()},setMusicVolume:function(n){cc.audioEngine.setMusicVolume(n)},getMusicVolume:function(){return cc.audioEngine.getMusicVolume()},playMusic:function(n,i){if(this._bMusicEnable){var e=this,t=n+this._fileExtension;this._wxAudioMusicContext.destroy(),this._wxAudioMusicContext=wx.createInnerAudioContext(),LocalResManager.enable?LocalResManager.loadAudio(t,function(n,t){e._wxAudioMusicContext.src=t,e._wxAudioMusicContext.loop=!!i,e._wxAudioMusicContext.play()}):(e._wxAudioMusicContext.src=t,e._wxAudioMusicContext.loop=!!i,e._wxAudioMusicContext.play())}},stopMusic:function(){cc.audioEngine.isMusicPlaying()&&cc.audioEngine.stopMusic()},pauseMusic:function(){cc.audioEngine.pauseMusic()},resumeMusic:function(){cc.audioEngine.resumeMusic()},isMusicPlaying:function(){return cc.audioEngine.isMusicPlaying()},playEffect:function(n,i,e){this._bEffectEnable&&LocalResManager.enable&&LocalResManager.loadAudio(n+this._fileExtension,function(n,t){var o=wx.createInnerAudioContext();o.src=t,o.loop=!!e,o.play(),o.onEnded(function(){o.destroy()}),i&&i(o)})},preLoadEffect:function(n){},pauseEffect:function(n){cc.audioEngine.pauseEffect(n)},stopEffect:function(n){n&&n.stop&&n.destroy()},pauseAllEffects:function(){cc.audioEngine.pauseAllEffects()},resumeAllEffects:function(){cc.audioEngine.pauseAllEffects()},stopAllEffects:function(){cc.audioEngine.stopAllEffects()},stopAllSound:function(){this.stopAllEffects(),this.stopMusic()}};
var SoundCacheManager={_bPreLoaded:!1,preLoad:function(){if(MusicManager.isEffectEnable()&&!this._bPreLoaded){this._bPreLoaded=!0;var i=[];i.push(MusicEffectFiles.Audio_UI_clouddisappear),i.push(MusicEffectFiles.Audio_V_ready),i.push(MusicEffectFiles.Audio_A_select),i.push(MusicEffectFiles.Audio_G_elimination),i.push(MusicEffectFiles.Audio_A_ground),i.push(MusicEffectFiles.Audio_A_falsemove),i.push(MusicEffectFiles.Audio_G_bomb),i.push(MusicEffectFiles.Audio_G_shockwave),i.push(MusicEffectFiles.Audio_V_newcombo3),i.push(MusicEffectFiles.Audio_G_dropelimination1),i.push(MusicEffectFiles.Audio_V_newcombo4),i.push(MusicEffectFiles.Audio_G_dropelimination2),i.push(MusicEffectFiles.Audio_V_newcombo5),i.push(MusicEffectFiles.Audio_G_dropelimination3),i.push(MusicEffectFiles.Audio_V_newcombo6),i.push(MusicEffectFiles.Audio_G_dropelimination4),i.push(MusicEffectFiles.Audio_V_newcombo7),function(i,e,s){var u=setInterval(function(){if(0!=i.length){var e=i.shift();MusicManager.preLoadEffect(e)}else clearInterval(u),"function"==typeof s&&s()}.bind(this),e)}(i,200)}}};
var hex_chr="0123456789abcdef",CryptoJs={des:function(t,i,r,h,e,s){var n,f,a,g,c,x,l,o,y,A,d,b,u,p,C=new Array(16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756),w=new Array(-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344),m=new Array(520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584),k=new Array(8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928),v=new Array(256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080),_=new Array(536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312),j=new Array(2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154),S=new Array(268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696),D=this.des_createKeys(t),M=0,K=i.length,T=0,H=32==D.length?3:9;for(o=3==H?r?new Array(0,32,2):new Array(30,-2,-2):r?new Array(0,32,2,62,30,-2,64,96,2):new Array(94,62,-2,32,64,2,30,-2,-2),2==s?i+="        ":1==s?(a=8-K%8,i+=String.fromCharCode(a,a,a,a,a,a,a,a),8==a&&(K+=8)):s||(i+="\0\0\0\0\0\0\0\0"),result="",tempresult="",1==h&&(y=e.charCodeAt(M++)<<24|e.charCodeAt(M++)<<16|e.charCodeAt(M++)<<8|e.charCodeAt(M++),d=e.charCodeAt(M++)<<24|e.charCodeAt(M++)<<16|e.charCodeAt(M++)<<8|e.charCodeAt(M++),M=0);M<K;){for(x=i.charCodeAt(M++)<<24|i.charCodeAt(M++)<<16|i.charCodeAt(M++)<<8|i.charCodeAt(M++),l=i.charCodeAt(M++)<<24|i.charCodeAt(M++)<<16|i.charCodeAt(M++)<<8|i.charCodeAt(M++),1==h&&(r?(x^=y,l^=d):(A=y,b=d,y=x,d=l)),x^=(a=252645135&(x>>>4^l))<<4,x^=(a=65535&(x>>>16^(l^=a)))<<16,x^=a=858993459&((l^=a)>>>2^x),x^=a=16711935&((l^=a<<2)>>>8^x),x=(x^=(a=1431655765&(x>>>1^(l^=a<<8)))<<1)<<1|x>>>31,l=(l^=a)<<1|l>>>31,f=0;f<H;f+=3){for(u=o[f+1],p=o[f+2],n=o[f];n!=u;n+=p)g=l^D[n],c=(l>>>4|l<<28)^D[n+1],a=x,x=l,l=a^(w[g>>>24&63]|k[g>>>16&63]|_[g>>>8&63]|S[63&g]|C[c>>>24&63]|m[c>>>16&63]|v[c>>>8&63]|j[63&c]);a=x,x=l,l=a}l=l>>>1|l<<31,l^=a=1431655765&((x=x>>>1|x<<31)>>>1^l),l^=(a=16711935&(l>>>8^(x^=a<<1)))<<8,l^=(a=858993459&(l>>>2^(x^=a)))<<2,l^=a=65535&((x^=a)>>>16^l),l^=a=252645135&((x^=a<<16)>>>4^l),x^=a<<4,1==h&&(r?(y=x,d=l):(x^=A,l^=b)),tempresult+=String.fromCharCode(x>>>24,x>>>16&255,x>>>8&255,255&x,l>>>24,l>>>16&255,l>>>8&255,255&l),512==(T+=8)&&(result+=tempresult,tempresult="",T=0)}return result+tempresult},des_createKeys:function(t){pc2bytes0=new Array(0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964),pc2bytes1=new Array(0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697),pc2bytes2=new Array(0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272),pc2bytes3=new Array(0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144),pc2bytes4=new Array(0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256),pc2bytes5=new Array(0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488),pc2bytes6=new Array(0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746),pc2bytes7=new Array(0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568),pc2bytes8=new Array(0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578),pc2bytes9=new Array(0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488),pc2bytes10=new Array(0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800),pc2bytes11=new Array(0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744),pc2bytes12=new Array(0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128),pc2bytes13=new Array(0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261);for(var i,r,h,e=t.length>8?3:1,s=new Array(32*e),n=new Array(0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0),f=0,a=0,g=0;g<e;g++){left=t.charCodeAt(f++)<<24|t.charCodeAt(f++)<<16|t.charCodeAt(f++)<<8|t.charCodeAt(f++),right=t.charCodeAt(f++)<<24|t.charCodeAt(f++)<<16|t.charCodeAt(f++)<<8|t.charCodeAt(f++),h=252645135&(left>>>4^right),right^=h,left^=h<<4,h=65535&(right>>>-16^left),left^=h,right^=h<<-16,h=858993459&(left>>>2^right),right^=h,left^=h<<2,h=65535&(right>>>-16^left),left^=h,right^=h<<-16,h=1431655765&(left>>>1^right),right^=h,left^=h<<1,h=16711935&(right>>>8^left),left^=h,right^=h<<8,h=1431655765&(left>>>1^right),right^=h,left^=h<<1,h=left<<8|right>>>20&240,left=right<<24|right<<8&16711680|right>>>8&65280|right>>>24&240,right=h;for(var c=0;c<n.length;c++)n[c]?(left=left<<2|left>>>26,right=right<<2|right>>>26):(left=left<<1|left>>>27,right=right<<1|right>>>27),left&=-15,right&=-15,i=pc2bytes0[left>>>28]|pc2bytes1[left>>>24&15]|pc2bytes2[left>>>20&15]|pc2bytes3[left>>>16&15]|pc2bytes4[left>>>12&15]|pc2bytes5[left>>>8&15]|pc2bytes6[left>>>4&15],h=65535&((r=pc2bytes7[right>>>28]|pc2bytes8[right>>>24&15]|pc2bytes9[right>>>20&15]|pc2bytes10[right>>>16&15]|pc2bytes11[right>>>12&15]|pc2bytes12[right>>>8&15]|pc2bytes13[right>>>4&15])>>>16^i),s[a++]=i^h,s[a++]=r^h<<16}return s},stringToHex:function(t){for(var i="",r=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"),h=0;h<t.length;h++)i+=r[t.charCodeAt(h)>>4]+r[15&t.charCodeAt(h)];return i},hexToString:function(t){for(var i="",r="0x"==t.substr(0,2)?2:0;r<t.length;r+=2){var h=parseInt(t.substr(r,2),16);i+=String.fromCharCode(h)}return i},MD5:function(t){x=this.str2blks_MD5(t);var r=1732584193,h=-271733879,e=-1732584194,s=271733878;for(i=0;i<x.length;i+=16){var n=r,f=h,a=e,g=s;r=this.ff(r,h,e,s,x[i+0],7,-680876936),s=this.ff(s,r,h,e,x[i+1],12,-389564586),e=this.ff(e,s,r,h,x[i+2],17,606105819),h=this.ff(h,e,s,r,x[i+3],22,-1044525330),r=this.ff(r,h,e,s,x[i+4],7,-176418897),s=this.ff(s,r,h,e,x[i+5],12,1200080426),e=this.ff(e,s,r,h,x[i+6],17,-1473231341),h=this.ff(h,e,s,r,x[i+7],22,-45705983),r=this.ff(r,h,e,s,x[i+8],7,1770035416),s=this.ff(s,r,h,e,x[i+9],12,-1958414417),e=this.ff(e,s,r,h,x[i+10],17,-42063),h=this.ff(h,e,s,r,x[i+11],22,-1990404162),r=this.ff(r,h,e,s,x[i+12],7,1804603682),s=this.ff(s,r,h,e,x[i+13],12,-40341101),e=this.ff(e,s,r,h,x[i+14],17,-1502002290),h=this.ff(h,e,s,r,x[i+15],22,1236535329),r=this.gg(r,h,e,s,x[i+1],5,-165796510),s=this.gg(s,r,h,e,x[i+6],9,-1069501632),e=this.gg(e,s,r,h,x[i+11],14,643717713),h=this.gg(h,e,s,r,x[i+0],20,-373897302),r=this.gg(r,h,e,s,x[i+5],5,-701558691),s=this.gg(s,r,h,e,x[i+10],9,38016083),e=this.gg(e,s,r,h,x[i+15],14,-660478335),h=this.gg(h,e,s,r,x[i+4],20,-405537848),r=this.gg(r,h,e,s,x[i+9],5,568446438),s=this.gg(s,r,h,e,x[i+14],9,-1019803690),e=this.gg(e,s,r,h,x[i+3],14,-187363961),h=this.gg(h,e,s,r,x[i+8],20,1163531501),r=this.gg(r,h,e,s,x[i+13],5,-1444681467),s=this.gg(s,r,h,e,x[i+2],9,-51403784),e=this.gg(e,s,r,h,x[i+7],14,1735328473),h=this.gg(h,e,s,r,x[i+12],20,-1926607734),r=this.hh(r,h,e,s,x[i+5],4,-378558),s=this.hh(s,r,h,e,x[i+8],11,-2022574463),e=this.hh(e,s,r,h,x[i+11],16,1839030562),h=this.hh(h,e,s,r,x[i+14],23,-35309556),r=this.hh(r,h,e,s,x[i+1],4,-1530992060),s=this.hh(s,r,h,e,x[i+4],11,1272893353),e=this.hh(e,s,r,h,x[i+7],16,-155497632),h=this.hh(h,e,s,r,x[i+10],23,-1094730640),r=this.hh(r,h,e,s,x[i+13],4,681279174),s=this.hh(s,r,h,e,x[i+0],11,-358537222),e=this.hh(e,s,r,h,x[i+3],16,-722521979),h=this.hh(h,e,s,r,x[i+6],23,76029189),r=this.hh(r,h,e,s,x[i+9],4,-640364487),s=this.hh(s,r,h,e,x[i+12],11,-421815835),e=this.hh(e,s,r,h,x[i+15],16,530742520),h=this.hh(h,e,s,r,x[i+2],23,-995338651),r=this.ii(r,h,e,s,x[i+0],6,-198630844),s=this.ii(s,r,h,e,x[i+7],10,1126891415),e=this.ii(e,s,r,h,x[i+14],15,-1416354905),h=this.ii(h,e,s,r,x[i+5],21,-57434055),r=this.ii(r,h,e,s,x[i+12],6,1700485571),s=this.ii(s,r,h,e,x[i+3],10,-1894986606),e=this.ii(e,s,r,h,x[i+10],15,-1051523),h=this.ii(h,e,s,r,x[i+1],21,-2054922799),r=this.ii(r,h,e,s,x[i+8],6,1873313359),s=this.ii(s,r,h,e,x[i+15],10,-30611744),e=this.ii(e,s,r,h,x[i+6],15,-1560198380),h=this.ii(h,e,s,r,x[i+13],21,1309151649),r=this.ii(r,h,e,s,x[i+4],6,-145523070),s=this.ii(s,r,h,e,x[i+11],10,-1120210379),e=this.ii(e,s,r,h,x[i+2],15,718787259),h=this.ii(h,e,s,r,x[i+9],21,-343485551),r=this.add(r,n),h=this.add(h,f),e=this.add(e,a),s=this.add(s,g)}return this.rhex(r)+this.rhex(h)+this.rhex(e)+this.rhex(s)},str2blks_MD5:function(t){for(nblk=1+(t.length+8>>6),blks=new Array(16*nblk),i=0;i<16*nblk;i++)blks[i]=0;for(i=0;i<t.length;i++)blks[i>>2]|=t.charCodeAt(i)<<i%4*8;return blks[i>>2]|=128<<i%4*8,blks[16*nblk-2]=8*t.length,blks},ii:function(t,i,r,h,e,s,n){return this.cmn(r^(i|~h),t,i,e,s,n)},hh:function(t,i,r,h,e,s,n){return this.cmn(i^r^h,t,i,e,s,n)},gg:function(t,i,r,h,e,s,n){return this.cmn(i&h|r&~h,t,i,e,s,n)},ff:function(t,i,r,h,e,s,n){return this.cmn(i&r|~i&h,t,i,e,s,n)},add:function(t,i){var r=(65535&t)+(65535&i);return(t>>16)+(i>>16)+(r>>16)<<16|65535&r},rhex:function(t){for(str="",j=0;j<=3;j++)str+=hex_chr.charAt(t>>8*j+4&15)+hex_chr.charAt(t>>8*j&15);return str},cmn:function(t,i,r,h,e,s){return this.add(this.rol(this.add(this.add(i,t),this.add(h,s)),e),r)},rol:function(t,i){return t<<i|t>>>32-i}};
var GameUtil={_tryLoadAvatarFrequency:5,isWealthEnough:function(e,t){var a=!1;switch(e){case PriceType.DIAMONDS:a=tempDiamonds>=t;break;case PriceType.GOLD:a=tempGold>=t}return a},showExchangeWindowByPriceType:function(e,t){var a=e==PriceType.DIAMONDS?ExchangeWindow.Type.DIAMOND:ExchangeWindow.Type.GOLD;a==ExchangeWindow.Type.DIAMOND&&wx.getSystemInfoSync().system.indexOf("iOS")>=0?console.error("iOS 不能购买"):ExchangeWindow.show({exchangeType:a,buySuccessCallBack:t})},getAllStageDataList:function(){var e=[],t=NetData.stage_ntf.info_list;if(t){var a;for(var n in t){var r=(a=t[n].stage_info_arry).length;r=r<MaxItemNumPerPage?r:MaxItemNumPerPage;for(var i,o=0;o<r;++o)e[(i=a[o]).stage_id-1]=i}}return e},getStageRewardNum:function(){var e=NetData.stage_ntf.info_list,t=0;if(e){var a;for(var n in e)t+=(a=e[n].star_reward_num)>0?a:0}return t},getRewardNumByMapID:function(e){var t=0;if(NetData.stage_ntf.info_list){var a;for(var n in NetData.stage_ntf.info_list)(a=NetData.stage_ntf.info_list[n])&&a.map_id==e&&(t=a.star_reward_num)}return t},setRewardNumByMapID:function(e,t){if(NetData.stage_ntf.info_list){var a;for(var n in NetData.stage_ntf.info_list)(a=NetData.stage_ntf.info_list[n])&&a.map_id==e&&(a.star_reward_num=t)}},getStarNumByMapID:function(e){if(NetData.stage_ntf.info_list)for(var t in NetData.stage_ntf.info_list){var a=NetData.stage_ntf.info_list[t];if(a&&a.map_id==e){var n=0,r=a.stage_info_arry;for(var i in r)data=r[i],n+=data.star_level;return n}}return 0},getStarRewardID:function(e){return e<20?1:e>=20&&e<40?2:e>=40&&e<60?3:e>=60&&e<80?4:e>=80&&e<90?5:6},getAllStarNum:function(){var e=this.getAllStageDataList(),t=0;for(var a in e)data=e[a],t+=data.star_level;return t},getStarNumByStageID:function(e){if(e<1)return-1;var t,a=this.getAllStageDataList();for(var n in a)if((t=a[n])&&t.stage_id==e)return t.star_level;return 0},_getTsSurfix:function(e,t){return/\?/.test(e)?"&_t="+t:"?_t="+t},_loadAvatar:function(e,t,a){var n=this,r=e,i=function(n){if(null!=n)if(n instanceof cc.Texture2D){cc.log("Remote texture loaded: "+e);var r=new cc.Sprite(n);t(r,a)}else cc.log("Fail to load remote texture")};e&&cc.loader.loadImg(e,function(o,s){if(o)return n._tryLoadAvatarFrequency<=0?i(o):void Timeout.register(function(){n._loadAvatar(r,t,a),n._tryLoadAvatarFrequency--},500);try{var u=GameUtil.getAndCacheTexture(e,s);i&&i(u),n._tryLoadAvatarFrequency=5}catch(i){if(window.LogPanel&&LogPanel.addInfo("头像异常: "+r),n._tryLoadAvatarFrequency<=0)return;delete cc.loader.cache[e],n._loadAvatar(r,t,a),n._tryLoadAvatarFrequency--}})},getGoodsImageById:function(e,t,a){var n=null;switch(e){case ArticleType.ARTICLE_TYPE_ATTR:switch(t){case ArticleSubType.ARTICLE_SUB_TYPE_HEART:n="prop_heart.png";break;case ArticleSubType.ARTICLE_SUB_TYPE_DIAMONDS:n="prop_diamond.png";break;case ArticleSubType.ARTICLE_SUB_TYPE_COIN:n="prop_coin.png";break;case ArticleSubType.ARTICLE_SUB_TYPE_PROP:var r=GameDataConfig.PropViewConfig[a];n=null!=r?r.image1:null;break;default:console.log("unKnown subType : "+t)}break;default:console.log("unKnown type : "+e)}return n},getTaskProgressInfoById:function(e,t){var a=NetData.quest_info_ntf.quest_info_list;if(a)for(var n in a){var r=a[n];if(r&&r.element_id==t&&r.quest_source==e)return r}return null},isTaskNeedAward:function(e){var t=!1,a=NetData.quest_info_ntf.quest_info_list;if(a)for(var n=0;n<a.length;n++){var r=a[n];if(r&&r.quest_source==e&&1==r.state){t=!0;break}}return t},sendHeartToFriend:function(e,t){NetLoadingWindow.Show(),GameService.sendHeart({friend_openid:e},function(a,n){if(NetLoadingWindow.Hide(),a){console.log("送心失败");if(-1510==a.ret){for(var r=0,i=(o=NetData.map_friend_ntf.friend_list).length;r<i;r++)if(o[r].openid===e){o[r].recv_heart_state=0;break}TipWindow.Show("好友拒绝接收爱心"),t(e,-1)}else TipWindow.Show("送心失败")}else{var o;for(r=0,i=(o=NetData.map_friend_ntf.friend_list).length;r<i;r++)if(o[r].openid===e){o[r].is_in_cd=1;break}t(e),NotifyWindow.Show({openid:e,notifyType:NotifyType.sendHeart})}})},getStageSubId:function(e){var t=0;if(ConfigData&&ConfigData.StageVersionConf&&ConfigData.StageVersionConf.list_data&&ConfigData.StageVersionConf.list_data.length){var a=ConfigData.StageVersionConf.list_data.filter(function(t){return t.stageId==e})[0];a&&(t=Number(a.sub_id)||0)}return t},createChessData:function(e,t,a,n){var r=e.pos.row,i=e.pos.col,o=e.color,s=e.type;n=n||{};if(null!=e.layer?n.chessLogicOrder=e.layer:(n.chessLogicOrder=GameDataConfig.ChessLogicOrder.ORDER_2,console.log("find chess layer fail")),null!=e.mushroom_data){var u=e.mushroom_data;n.mushroomData=new MushroomData(u.max_health,u.current_health,u.attack_value)}e.bomb_data&&(n.bomb_data=e.bomb_data),e.step_bonus_data&&(n.step_bonus_data=e.step_bonus_data),e.conveyer_data&&(n.conveyer_data=e.conveyer_data);return new ChessData(r,i,t,a,o,s,n)},getItem:function(e,t){if(null!=NetData&&null!=NetData.item_list&&null!=NetData.item_list.item)for(var a=0,n=NetData.item_list.item.length;a<n;a++){var r=NetData.item_list.item[a];if(r.id==e)return t?Util.clone(r):r}return console.log("getItem config is null : "+e),null},getAndCacheTexture:function(e,t){if(t instanceof cc.Texture2D)return t;var a=cc.textureCache.handleLoadedTexture(e,t);return cc.loader.cache[e]=a,a},isAttributeExist:function(e){if("string"==typeof e){var t=e.indexOf(".");if(-1!=t){var a=e.slice(0,t);return Util.isAttributeExist(window[a],e.slice(t+1))}return null!=window[e]}return!1},registerNextFrameCall:function(e){window.requestAnimFrame(function(){"function"==typeof e&&e()})},pauseAllAnimation:function(e){if(null!=e)for(var t=null,a=e.getChildren(),n=0,r=a.length;n<r;n++)(t=a[n])instanceof Effect&&t.pause(),this.pauseAllAnimation(t)},isArenaMatch:function(e){return"PKRank"==e.query.from&&("1044"==e.scene||"1088"==e.scene)},saveArenaMatchData:function(e){NetData.arena_match={arena_match_id:parseInt(e.query.arena_match_id,10),stage_bin_path:e.query.stage_bin_path,stage_id:parseInt(e.query.stage_id,10),created_time:parseInt(e.query.created_time,10),serverEnv:e.query.serverEnv},console.error(JSON.stringify(NetData.arena_match))},getArenaMatchOffDays:function(e){var t=e?parseInt(e.query.created_time,10):NetData.arena_match.created_time,a=(new Date).getTime()/1e3-t,n=Math.ceil(a/86400);return console.warn("pkrank，过期时间="+n),n},isNoSound:function(e){var t=!1;return Service.Util.isDevTool()&&"noSound"==e.query.gameMode&&(t=!0),t}};
var ObjectArray=cc.Class.extend({_array:null,ctor:function(){this._array=[]},addObject:function(t){null!=t&&(this._retainObject(t),this._array.push(t))},getObjectByIndex:function(t){return this._checkIndex(t)?this._array[t]:null},removeObject:function(t){if(null!=t){var e=this._array.indexOf(t);e>-1?(this._array.splice(e,1),this._releaseObject(t)):console.log("object is no in array")}},removeObjectByIndex:function(t){if(this._checkIndex(t)){var e=this._array.splice(t,1);this._releaseObject(e)}},removeFirstObject:function(){if(!this.isEmpty()){var t=this._array.shift();this._releaseObject(t)}},removeLastObject:function(){if(!this.isEmpty()){var t=this._array.pop();this._releaseObject(t)}},removeAllObject:function(){for(var t in this._array){var e=this._array.splice(t,1);this._releaseObject(e)}this._array=[]},getFirstObject:function(){return this.isEmpty()?null:this._array[0]},getLastObject:function(){return this.isEmpty()?null:this._array[this._array.length-1]},isEmpty:function(){return 0==this._array.length},size:function(){return this._array.length},_checkIndex:function(t){if(t<0)return!1;return!(t>=this._array.length)},_retainObject:function(t){if(t&&t.retain)t.retain();else if(Util.isArray(t)||Util.isObject(t))for(var e in t)this._retainObject(t[e])},_releaseObject:function(t){if(t&&t.release)t.release();else if(Util.isArray(t)||Util.isObject(t))for(var e in t)this._releaseObject(t[e])}});
var PageUtil={_listenerList:null,_registerListener:function(){null==this._listenerList&&(this._listenerList=[],Util.registerListener(this._listenerList,EventID.ON_NETWORK_TIP_WINDOW_CANCEL,function(){PageUtil.switchPageTo("StageMapPage",PageType.replace,ResObjects.getResObject(ResObjectConfig.allStage),null,function(){ResLoader.hideLoadingWindow()}),Util.unRegisterListeners(this._listenerList),this._listenerList=null}.bind(this)))},_unRegisterListener:function(){Util.unRegisterListeners(this._listenerList),this._listenerList=null},startPage:function(e,t,i,n,a){var s=null!=i?i.getResList():[];FrameController.GetInstance().start(e,new PageOptions(t,s,n),a)},startPageWithLoading:function(e,t,i,n,a){this.startPage("LoadingTransitionPage",PageType.replace,null,null,function(){Timeout.register(function(){this.switchPageWithLoading(e,t,i,n,a)}.bind(this),0)}.bind(this))},switchPageTo:function(e,t,i,n,a){this._unRegisterListener(),FrameController.GetInstance().switchPageTo(e,new PageOptions(t,i.getResList(),n),function(){"function"==typeof a&&a()}.bind(this))},switchPageWithLoading:function(e,t,i,n,a){this._registerListener();(new Date).getTime();ResLoader.showPageResLoadingWindow(1,i,function(){this.switchPageTo(e,t,i,n,function(){"function"==typeof a&&a(),ResLoader.hideLoadingWindow()}.bind(this))}.bind(this))},startGame:function(e){var t=null,i=[];Util.registerListener(i,EventID.ON_NETWORK_TIP_WINDOW_CANCEL,function(){"function"==typeof t&&t()});var n=!1,a=!1,s=!1;function o(){s||n&&a&&(s=!0,Util.unRegisterListeners(i),puzzleGame.simple_stage_info(function(e){PageUtil.switchPageTo("MainGamePage",PageType.replace,ResObjects.getResObject(ResObjectConfig.mainGame),new SimpleStageData(e),function(){ResLoader.hideLoadingWindow(),StagePropWindow.Destroy()})}))}var g=!1;t=function(){g||(g=!0,Util.unRegisterListeners(i),PageUtil.switchPageTo("StageMapPage",PageType.replace,ResObjects.getResObject(ResObjectConfig.allStage),null,function(){ResLoader.hideLoadingWindow(),StagePropWindow.Destroy()}))},PageResLoadingWindow.Show();var r=new StageId(GameProxy.getStageId(),0);puzzleGame.loadStage(r,function(){ResLoader.showPageResLoadingWindow(0,ResObjects.getResObject(ResObjectConfig.mainGame),function(){n=!0,o()},function(){t()}),GameProxy.startGame(e,function(){a=!0,o()},function(){t()})})},startPKMatch:function(){var e=NetData.arena_match;if(e){wx.showLoading({title:"开局准备中...",mask:!0}),GameProxy.init(),GameProxy.setStageId(e.stage_id);var t=null,i=[];Util.registerListener(i,EventID.ON_NETWORK_TIP_WINDOW_CANCEL,function(){"function"==typeof t&&t()});var n=!1,a=!1,s=!1,o=!1;t=function(){o||(o=!0,Util.unRegisterListeners(i),PageUtil.switchPageTo("StageMapPage",PageType.replace,ResObjects.getResObject(ResObjectConfig.allStage),null,function(){ResLoader.hideLoadingWindow()}))};var g=new StageId(e.stage_id,0);puzzleGame.loadStage(g,function(){wx.hideLoading(),ResLoader.showPageResLoadingWindow(0,ResObjects.getResObject(ResObjectConfig.mainGame),function(){console.log("pk match load res success"),n=!0,r()},function(){t()}),GameProxy._startPKMatch(e.arena_match_id,e.stage_id,function(){console.log("pk match start game success"),a=!0,r()},function(){t()})},function(){wx.hideLoading()})}function r(){s||n&&a&&(console.log("---EnterMainGamePage"),s=!0,Util.unRegisterListeners(i),puzzleGame.simple_stage_info(function(e){PageUtil.switchPageTo("MainGamePage",PageType.replace,ResObjects.getResObject(ResObjectConfig.mainGame),new SimpleStageData(e),function(){ResLoader.hideLoadingWindow()})}))}}};
!function(e){function t(n){if(i[n])return i[n].exports;var a=i[n]={exports:{},id:n,loaded:!1};return e[n].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var i={};t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";i(1),i(62),i(64),i(65)},function(e,t,i){"use strict";i(2),i(3),i(41),i(51),i(52),i(61)},function(e,t){"use strict";page.PKRank=page.BasePage.extend({tex:null,topHeight:300,rankItemHeight:120,onCreate:function(e){var t=this;WindowManager.GetInstance().hideAllWindow(),this.step=0,this._listenerList=[],Util.registerListener(this._listenerList,EventID.ON_WX_SHOW,this._onWxShow.bind(this)),this.posRankTop=cc.p(cc.winSize.width/2,cc.winSize.height/2+220),this.commonWidth=620,this.initSharedTexture(),this.createBG(),this.createBtns(),this.fetchRankData(function(){t.createListView(),t.createTopView(),t.scheduleUpdate()})},_onWxShow:function(){var e=window.getWXLaunchOptionsSync();GameUtil.isArenaMatch(e)&&(e.query.from="",GameUtil.saveArenaMatchData(e),console.warn("===",page.PKRank),setTimeout(function(){PageUtil.switchPageWithLoading("PKRank",PageType.replace,ResObjects.getResObject(ResObjectConfig.PKRank))},800))},fetchRankData:function(e){var t=this;GameService.getArenaMatchRank({arena_match_id:NetData.arena_match.arena_match_id},function(i,n){return console.error("pkranklist=======!!"+JSON.stringify(i)+" | "+JSON.stringify(n)),i?(window.serverEnv!=NetData.arena_match.serverEnv&&(i.server="你所在的星球错误!"),void window.alert(JSON.stringify(i))):(t.rankData=n,void(e&&e()))})},initSharedTexture:function(){this.tex=new cc.Texture2D,this.updateAllHeadTexture()},updateAllHeadTexture:function(){this.tex.initWithElement(sharedCanvas),this.tex.handleLoadedTexture()},update:function(){0==this.step++&&this.updateAllHeadTexture(),this.step>=30&&(this.step=0)},getRect:function(e,t){switch(e){case"LIST_HEAD":return cc.rect(0,72*(t+1),72,72);case"LIST_NICK":return cc.rect(74,72*(t+1),180,72)}},createBG:function(){var e=new cc.Sprite(res.pkrank_bg_jpg);e.setPosition(cc.visibleRect.center),this.addChild(e)},createTopView:function(){var e=new cc.Sprite("#pkrank-master-bg.png");e.setAnchorPoint(cc.p(.5,0)),e.setPosition(cc.p(this.posRankTop.x,this.posRankTop.y)),this.addChild(e);var t=this.getRankingItem({type:"MASTER",index:this.masterIndex,bg:"empty",openid:this.rankData.owner_openid,score:this.masterScore});t.setPosition(cc.p(e.width/2,e.height/2)),e.addChild(t)},createBtns:function(){var e=UIHelper.createButton({normalFile:"btn_back_N.png",anchorPoint:COMMON_ANCHOR.leftTop,bPlistTexture:!0,bTouchEnable:!0});e.setPosition(10,cc.winSize.height-15),e.addTouchEventListener(function(e,t){ccui.Widget.TOUCH_ENDED==t&&PageUtil.switchPageTo("StageMapPage",PageType.replace,ResObjects.getResObject(ResObjectConfig.allStage),null,null)},this),this.addChild(e);var t=UIHelper.createButton({normalFile:"pkrank-btn-fight.png",bPlistTexture:!0,bTouchEnable:!0});t.setPosition(.5*cc.winSize.width,cc.winSize.height/2-455),t.addTouchEventListener(function(e,t){ccui.Widget.TOUCH_ENDED==t&&(GameUtil.getArenaMatchOffDays()>1?window.alert("群擂台已失效，请重新发起"):PageUtil.startPKMatch())},this),this.addChild(t)},createListView:function(){var e=UIHelper.createImage({imageFileName:"pkrank-panel.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(this.commonWidth,600),capInsets:cc.rect(309,100,1,1),anchorPoint:cc.p(.5,1),position:this.posRankTop});this.addChild(e);var t=new cc.Sprite("#pkrank-panel-title.png");t.setPosition(cc.p(e.width/2,e.height-40)),e.addChild(t);var i=this.listView=new ccui.ListView;i.setAnchorPoint(cc.p(.5,1)),i.setDirection(ccui.ScrollView.DIR_VERTICAL),i.setTouchEnabled(!0),i.setBounceEnabled(!0),i.setScrollBarEnabled(!1),i.setContentSize(cc.size(this.commonWidth,470)),i.setPosition(cc.p(this.posRankTop.x,this.posRankTop.y-90)),this.addChild(i),this.masterScore=-1,this.masterIndex=-1,this.myIndex=-1;for(var n=this.rankData.rank_list.length,a=0;a<n;a++){var o=this.rankData.rank_list[a];o.openid==this.rankData.owner_openid&&(this.masterScore=o.score,this.masterIndex=a),o.openid==NetData.user_info.openid&&(this.myIndex=a),this.listView.pushBackCustomItem(this.getRankingItem({type:"RANK",index:a,bg:o.openid==NetData.user_info.openid?"lightblue":"empty",openid:o.openid,score:o.score})),a<n-1&&this.listView.pushBackCustomItem(this.getRankLine())}-1==this.myIndex&&this.listView.pushBackCustomItem(this.getRankingItem({type:"RANK",index:n,showRank:!1,bg:"lightblue",openid:NetData.user_info.openid,score:this.rankData.my_score||-1}))},getRankingItem:function(e){var t=e.index,i=this.commonWidth,n=new ccui.Layout;n.setContentSize(cc.size(i,94));var a=UIHelper.createImage({imageFileName:"pkrank-"+e.bg+"-bg.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(i-18,94),capInsets:cc.rect(10,10,1,1),position:cc.p(i/2,47)});if(t>=0&&!1!==e.showRank){var o=void 0;(o=t<=2?new cc.Sprite("#pkrank_rank_"+(t+1)+".png"):new cc.LabelBMFont(""+(t+1),res.number_white_big_fnt)).setPosition(cc.p(.09*i,45.12)),a.addChild(o)}var s=this.getRect("LIST_HEAD",e.index),r={req:"USER_HEAD",data:{openId:e.openid},rect:s};wx.postMessage(r);var c=new cc.Sprite(this.tex,s);if(c.setPosition(cc.p(.25*i,47)),a.addChild(c),"MASTER"==e.type){var l=new cc.LabelTTF("擂主","Arial",25);l.setAnchorPoint(cc.p(0,.5)),l.setPosition(cc.p(.33*i+3,65.8)),a.addChild(l)}var h="MASTER"==e.type?.33:.5,u="MASTER"==e.type?.9:1,d=this.getRect("LIST_NICK",e.index),p={req:"USER_NICK",data:{openId:e.openid,color:"#ffffff",fontSize:32,align:"left"},rect:d};wx.postMessage(p);var f=new cc.Sprite(this.tex,d);f.setAnchorPoint(cc.p(0,.5)),f.setPosition(cc.p(.33*i,94*h)),f.setScale(u),a.addChild(f);var _=e.score;if(_>=0){var g=new cc.LabelTTF("最高得分","Arial",25);g.setAnchorPoint(cc.p(0,.5)),g.setPosition(cc.p(.6*i,70.5)),a.addChild(g);var b=parseInt(_,10).toLocaleString(),m=new cc.LabelBMFont(b,res.number_white_big_fnt);m.setAnchorPoint(cc.p(1,.5)),m.setPosition(cc.p(.94*i,31.96)),a.addChild(m)}else{var y=new cc.Sprite("#pkrank-not-in-rank.png");y.setAnchorPoint(cc.p(1,.5)),y.setPosition(cc.p(.94*i,43.24)),y.setScale(1.5),a.addChild(y)}return"MASTER"==e.type?a:(n.addChild(a),n)},getRankLine:function(){var e=this.commonWidth,t=new ccui.Layout;t.setContentSize(cc.size(e,2));var i=UIHelper.createImage({imageFileName:"pkrank-line.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(e-18,2),capInsets:cc.rect(10,1,1,0),position:cc.p(e/2,1)});return t.addChild(i),t},onExit:function(){this._super(),Util.unRegisterListeners(this._listenerList),this._listenerList=null}})},function(e,t,i){"use strict";i(4),i(22),i(31),i(36),i(38)},function(e,t,i){"use strict";var n=i(5),a=i(18),o=i(21),s=-1,r=0,c=1,l=2,h=0,u=1,d=2,p={};page.StageMapPage=page.BasePage.extend({_rootRes:"res/pages/allStage/",bgFragList:[],bgBkgImgList:[],stageBtnList:[],stageNumList:[],stageInfoLabelList:[],avatarPanelList:[],userBaseInfoList:[],bgLayer:null,mapAniLayer:null,mapFgAniLayer:null,bgImgLayer:null,stageLayer:null,stageNumLayer:null,stageInfoLayer:null,playerInfoLayer:null,cloudLayer:null,screenEffectLayer:null,uiLayer:null,mapSize:null,fragSize:null,curMapPos:cc.p(0,0),newMapCloudEffect:null,_beganPosY:0,_moveBeganPosY:0,_beganTime:0,_scrollSpeed:0,_slowDown:4,_maxScrollSpeed:300,isScrolling:!1,selectedStageId:0,isShowNextStageAni:!1,showCallback:null,lastPassedStageId:null,noMusic:!1,getMail:!1,playerPosPanel:null,stageDataList:[],realStageConfig:[],resBkgImgConfig:[],max_stage_id:0,activeStagePool:[],inactiveStagePool:[],curStagePool:[],avatarPanelPool:[],newLabelPool:[],stageNumYPool:[],stageNumWPool:[],bgImgFragPool:[],resBkgImgPos:[],mapAniSectionObj:{},_listenerList:null,_mailBtn:null,_miniMapBtn:null,_taskBtn:null,_actCenterBtn:null,_alreadyUpdatedMail:!1,_isLoadingCloudAni:!1,_leftBottomPanel:null,_rightBottomPanel:null,_oldScreenWidth:0,_shareGift:{btnName:"_shareGift_btn",iconTex:"btn_back_N.png"},aniPosOffset:null,onCreate:function(e){XCXSDK.clearCustomShareData(),this.reset(),ShareForGift.listen(),Timeout.register(function(){var e=GameUtil.getAllStageDataList();e&&e.length>=3?(AutoWindowManager.init(),setTimeout(function(){PreloadStageResLogic.loadMaxStage()},1e3)):(NoticeWindow.Start("cross"),setTimeout(function(){PreloadStageResLogic.loadMaxStage()},100))},1e3),this._listenerList=[],Util.registerListener(this._listenerList,EventID.MAIL_LIST_NTF,this.onUpdateMailResData.bind(this)),Util.registerListener(this._listenerList,EventID.READ_MAIL_EVENT,this.onReadMailContent.bind(this)),Util.registerListener(this._listenerList,EventID.PLAYER_BASEINFO_NTF,this.refreshFriendsAvatar.bind(this)),Util.registerListener(this._listenerList,EventID.RANK_SEND_HEART_EVENT,this.refreshFriendsStatus.bind(this)),Util.registerListener(this._listenerList,EventID.ON_WINDOW_RESIZE,this.onWindowResize.bind(this)),Util.registerListener(this._listenerList,EventID.STAR_GIFT_NUM_CHANGED,this.updateMiniMapBtn.bind(this)),Util.registerListener(this._listenerList,EventID.ON_SHARE_GIFT_CONFIG,this.initShareForGift.bind(this)),Util.registerListener(this._listenerList,EventID.ON_GAME_IN_IFRAME_HIDE,this._onGameInIFrameHide.bind(this)),Util.registerListener(this._listenerList,EventID.ON_GAME_IN_IFRAME_SHOW,this._onGameInIFrameShow.bind(this)),Util.registerListener(this._listenerList,EventID.ON_GAME_IN_IFRAME_CLOSE,this._onGameInIFrameClose.bind(this)),Util.registerListener(this._listenerList,EventID.QUEST_INFO_NTF,this._onUpdateTaskBtn.bind(this)),Util.registerListener(this._listenerList,EventID.ACT_INFO_NTF,this._onActivityNotified.bind(this)),Util.registerListener(this._listenerList,EventID.RANK_REWARD_NTF,this._onRankRewardNotify.bind(this)),Util.registerListener(this._listenerList,EventID.ON_WX_SHOW,this._onWxShow.bind(this)),window.DEBUG&&console.log("user_info : "+JSON.stringify(NetData.user_info)),e.pageData&&(this.isShowNextStageAni=e.pageData.showNextStageAni,this.showCallback=e.pageData.callback,this.noMusic=e.pageData.noMusic,this.getMail=e.pageData.getMail,e.pageData.firstToMap&&GameProxy.createPuzzleGame()),this.sectionHeight=3316,this.topMargin=200,this.bottomMargin=0,this.sectionCount=MAX_STAGE_ID/MaxItemNumPerPage,this.mapSize=cc.size(cc.winSize.width,this.sectionHeight*this.sectionCount+this.bottomMargin+this.topMargin),this.fragSize=cc.size(cc.winSize.width,1120),this.newMapCloudEffect=null,this._isLoadingCloudAni=!1,NetData.statics_ntf.stage_statics.max_stage_id||(NetData.statics_ntf.stage_statics={max_stage_id:0});var t=[];NetData.stage_ntf.info_list&&(t=GameUtil.getAllStageDataList()),this.max_stage_id=NetData.statics_ntf.stage_statics.max_stage_id,-1==last_max_stage_id&&(this.lastPassedStageId=this.max_stage_id),last_max_stage_id=this.max_stage_id,this.stageDataList=t,this.lastPassedStageId||(this.lastPassedStageId=GameProxy.getStageId()),this.lastPassedStageId>MAX_STAGE_ID&&(this.lastPassedStageId=this.max_stage_id);var i=this;this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(e,t){return i.touchedBegan(e,t)},onTouchMoved:function(e,t){return i.touchedMoved(e,t)},onTouchCancelled:function(e,t){return i.touchedCancelled(e,t)},onTouchEnded:function(e,t){i.touchedEnded(e,t)}}),cc.eventManager.addListener(this._touchListener,this),p={9:{desc:"新元素-冰块：冰块可以打碎哦~",resList:[res.n_m_elem_9_png]},21:{desc:"新元素-气球：气球可以收集哦~",resList:[res.n_m_elem_21_png]},41:{desc:"新元素-木箱：木箱可以打碎哦~",resList:[res.n_m_elem_41_png]},61:{desc:"新元素-虫洞：虫洞可以传送棋子到制定位置~",resList:[res.n_m_elem_61_png]},71:{desc:"新元素-牢笼：牢笼中的棋子不能交换位置~",resList:[res.n_m_elem_71_png]},91:{desc:"新元素-甜甜圈：甜甜圈下有新区域哦~",resList:[res.n_m_elem_91_png]},99:{desc:"新元素-气泡：消除气泡水面会上升哦~",resList:[res.n_m_elem_99_png]},131:{desc:"新元素-草坪：草坪可以铺开哦~",resList:[res.n_m_elem_131_png]},151:{desc:"新元素-糖果罐：糖果罐会掉出糖果哦~",resList:[res.n_m_elem_151_png]},164:{desc:"新元素-彩旗线：气球浮到彩旗线上收集哦~",resList:[res.n_m_elem_164_png]},181:{desc:"新元素-大蘑菇：大蘑菇会生小蘑菇哦~~",resList:[res.n_m_elem_181_png]},187:{desc:"新元素-果冻：果冻可以打开哦~",resList:[res.n_m_elem_187_png]},204:{desc:"新元素-白云：白云会飘来飘去哦~",resList:[res.n_m_elem_204_png]},235:{desc:"新元素-深水区：气球浮到彩旗线上收集哦~",resList:["n_m_elem_235_png"]},246:{desc:"新元素—炸弹棋子：倒计时结束前没有被消除，棋子会爆炸哦~",resList:[res.n_m_elem_246_png]},258:{desc:"新元素—传送带:传送带上的元素会移动哦",resList:[res.n_m_elem_258_png]},263:{desc:"新元素—变色棋子：变色棋子会变颜色哦~",resList:[res.n_m_elem_263_png]},342:{desc:"新元素—加步棋子：消除加步棋子可以增加步数哦~",resList:[res.n_m_elem_342_png]}},this._initAniPos(),this.initView();var n=cc.winSize.height/2;this.jumpToStage(this.lastPassedStageId+1,n);var a=last_max_stage_id<MAX_STAGE_ID?last_max_stage_id+1:MAX_STAGE_ID;if(this.isShowNextStageAni){var o=this.createPlayerPosPanel();this.playerPosPanel=o,this.addAvatarPanelToStage(a-1,o,NetData.user_info.openid),this.prePlayStageAni(a),this.playOpenNextStageAni(),rankData._dataModified=!0}else{o=this.createPlayerPosPanel();this.playerPosPanel=o,this.addAvatarPanelToStage(a,o,NetData.user_info.openid),this.hideFriendPanelInStage(a),this.showCallback&&this.showCallback()}},hideFriendPanelInStage:function(e){this.avatarPanelList[e-1]&&this.avatarPanelList[e-1].panel.setVisible(!1)},_getVisibleSection:function(){for(var e=-this.curMapPos.y,t=e+cc.winSize.height,i=[],n=0;n<this.sectionCount;n++){var a=this.bottomMargin+n*this.sectionHeight,o=a+this.sectionHeight;(a<=t&&o>=t||o>=e&&a<=e)&&i.push(n+1)}return i},_getDifferenceSection:function(){var e=this._getVisibleSection(),t={add:[],remove:[]};if(!this.visibleSection||this.visibleSection.join("_")!=e.join("_"))if(this.visibleSection){for(var i=0;n=e[i];i++)this.visibleSection.indexOf(n)<0&&t.add.push(n);var n;for(i=0;n=this.visibleSection[i];i++)e.indexOf(n)<0&&t.remove.push(n)}else t.add=e;return this.visibleSection=e,t},_getBkgImgConfig:function(){var e=this.resBkgImgConfig;return e.length<=0&&(e=this.resBkgImgConfig=[{id:1,resObj:ResObjects.getResObject(ResObjectConfig.mapBkg1),height:1658,offsetY:0},{id:2,resObj:ResObjects.getResObject(ResObjectConfig.mapBkg2),height:1658,offsetY:0},{id:3,resObj:ResObjects.getResObject(ResObjectConfig.mapBkg3),height:1658,offsetY:0},{id:4,resObj:ResObjects.getResObject(ResObjectConfig.mapBkg4),height:1658,offsetY:0},{id:5,resObj:ResObjects.getResObject(ResObjectConfig.mapBkg5),height:1658,offsetY:0},{id:6,resObj:ResObjects.getResObject(ResObjectConfig.mapBkg6),height:1658,offsetY:0},{id:7,resObj:ResObjects.getResObject(ResObjectConfig.mapBkg7),height:1658,offsetY:0},{id:8,resObj:ResObjects.getResObject(ResObjectConfig.mapBkg8),height:1659,offsetY:0}]),e},_loadBkgImg:function(e){var t=this,i=this._getBkgImgConfig();!function(e){var n=e%i.length,a=i[n],o=a.resObj;if(a.loaded){var s=o.getResList();t._showBkgImg(e,s[0])}else if(!a.isLoading){a.isLoading=!0;var r=o.getResList();r instanceof Array||(r=[]),cc.loader.load(r,function(i,n){if(a.isLoading=!1,i)a.loaded=!1,console.log("_loadBkgImg failed : "+i);else{a.loaded=!0,o.onLoadFinish();var s=o.getResList();t._showBkgImg(e,s[0]),console.log("_loadBkgImg: cc.loader.load= ",r)}})}}(e)},_showBkgImg:function(e,t){if(i=this.bgBkgImgList[e])console.log("_showBkgImg: return!");else{var i,n=this.resBkgImgPos[e];(i=new cc.Sprite(t))&&(i.setAnchorPoint(0,.5),i.setScaleX(cc.winSize.width/640),i.setPosition(n),this.bgImgLayer&&this.bgImgLayer.addChild(i),this.bgBkgImgList[e]=i),console.log("_showBkgImg: index= "+e)}},_getNewElementByStageID:function(e){return p[e]},_initAniPos:function(){var e=320*Math.max(1,1.775/(cc.winSize.height/cc.winSize.width)),t=this.sectionHeight/2,i=this.bottomMargin+829,n=this.bottomMargin+829,a=this.bottomMargin+829,o=this.bottomMargin+829;this.aniPosOffset={1:[cc.p(e,i+28),cc.p(e,t+i-78)],2:[cc.p(e,n+10),cc.p(e+2,t+n-80)],3:[cc.p(e,a+64),cc.p(e,t+a-80)],4:[cc.p(e+2,o+30),cc.p(e,t+o-80)]}},_getAniPos:function(e){if(e){var t=this.sectionHeight;if(e){var i=[],n=this.aniPosOffset[(e-1)%4+1];return i.push(cc.p(n[0].x,t*(e-1)+n[0].y)),i.push(cc.p(n[1].x,t*(e-1)+n[1].y)),i}return this.aniPosOffset[1]}console.log("_getAniPos: pageIndex error.")},_getAniRes:function(){var e=this.resMap;return e||(e=this.resMap={1:{bgAni:!1,resObj:ResObjects.getResObject(ResObjectConfig.mapEffect1),effectName:[res.newmap11_json,res.newmap12_json]},2:{bgAni:!0,resObj:ResObjects.getResObject(ResObjectConfig.mapEffect2),effectName:[res.newmap21_json,res.newmap22_json]},3:{bgAni:!1,resObj:ResObjects.getResObject(ResObjectConfig.mapEffect3),effectName:[res.newmap31_json,res.newmap32_json]},4:{bgAni:!1,resObj:ResObjects.getResObject(ResObjectConfig.mapEffect4),effectName:[res.newmap41_json,res.newmap42_json]}}),e},_getCloudAniConfig:function(e){for(var t=cc.winSize.width/2,i=this.sectionHeight,n=cc.winSize.height/3,a=80,o=null,s=0,r=this.sectionCount;s<r;s++)if(a=80+this.bottomMargin+(s+1)*i,a+n>e&&a-n<e+cc.winSize.height){o={pos:cc.p(t,a),airBalloon:"map/newmap1/newmap301.png"};break}return o},_loadMapAni:function(e){for(var t=this,i=this._getAniRes(),n=0,a=e.length;n<a;n++){!function(n){var a=e[n],o=(a-1)%4+1,s=i[o];if(s.loaded)t._showMapAni(a);else{s.loaded=!0;var r=s.resObj;ResLoader.silenceLoadRes(r,function(){t._showMapAni(a)},function(){s.loaded=!1,console.log("load mapAni resoures failed : "+o)})}}(n)}},_showMapAni:function(e){if(!(this.visibleSection&&this.visibleSection.indexOf(e)<0)){var t=this._getAniRes(),i=this._getAniPos(e),n=t[(e-1)%4+1],a=this.mapAniSectionObj[e],o=cc.winSize.width/385;if(a){n.bgAni?this.mapAniLayer&&(a.removeFromParent(),this.mapAniLayer.addChild(a)):this.mapFgAniLayer&&(a.removeFromParent(),this.mapFgAniLayer.addChild(a));for(var s=0,r=i.length;s<r;s++){var c=a.getChildByTag(s);c&&(c.setPosition(i[s]),c.play(!0))}}else{var l=new cc.Layer;l.setName("mapAniSection"+e),n.effectName.forEach(function(e,t){var n=new Effect(e);n.setScale(o,640/385),n.setPosition(i[t]),n.play(!0),l.addChild(n,0,t)}),this.mapAniSectionObj[e]=l,n.bgAni?this.mapAniLayer&&this.mapAniLayer.addChild(l):this.mapFgAniLayer&&this.mapFgAniLayer.addChild(l)}}},refreshMapAni:function(){var e=this;clearTimeout(this.refreshMapTimeout),this.refreshMapTimeout=Timeout.register(function(){var t=e._getDifferenceSection(),i=e._getAniRes();t.remove.length&&t.remove.forEach(function(t){var n=null;n=i[(t-1)%4+1].bgAni?e.mapAniLayer:e.mapFgAniLayer;var a=UIHelper.seekWidgetByName(n,"mapAniSection"+t);a&&a.removeFromParent(!0)}),t.add.length&&e._loadMapAni(t.add)},100)},playCloudAni:function(e){var t=this._getCloudAniConfig(e);if(!t)return console.log("cloud config is null : "+e),void(this.newMapCloudEffect&&this.newMapCloudEffect.setVisible(!1));if(this.newMapCloudEffect)return this.newMapCloudEffect.isVisible()||this.newMapCloudEffect.setVisible(!0),void this.newMapCloudEffect.setPosition(t.pos);if(this._isLoadingCloudAni)console.log("loading cloud ani res");else{var i=this,n=function(e){if(console.log("playCloudAni"),i.cloudLayer){var t=new Effect(res.newmapelament1_json);i.newMapCloudEffect=t,t.setPosition(e.pos),t.setScale(1.2),t.play(!0),i.cloudLayer.addChild(t)}};!function(e){i._isLoadingCloudAni=!0;var t=ResObjects.getResObject(ResObjectConfig.newMapCloud);t.isLoaded()?(i._isLoadingCloudAni=!1,n(e)):ResLoader.silenceLoadRes(t,function(){i._isLoadingCloudAni=!1,n(e)},function(){i._isLoadingCloudAni=!1,console.log("load CloudAni resoures failed")})}(t)}},playMiddleCloudAni:function(e,t){var i=this,n=function(){var n=new Effect(res.newmapelament1_json);n.setPosition(e),n.play(!0),i.cloudLayer.addChild(n,1,10+t),console.log("add: mapAniCloud_"+t)};!function(){var e=ResObjects.getResObject(ResObjectConfig.cloud);if(e.isLoaded())n();else{var t=e.getResList();t instanceof Array||(t=[]),cc.loader.load(t,function(t,i){t?console.log("load resImgList failed : "+t):(e.onLoadFinish(),n())})}}()},initFriendsAvatarPanel:function(){var e=NetData.map_friend_ntf.friend_list||[];console.log("friendsList: "+e);for(var t=e.length,i=this.avatarPanelList,n=[],a=0;a<t;a++){var o=e[a];if(n.push(o.openid),!i[o.stage_id-1]&&o.openid!==NetData.user_info.openid){var s=h;0==o.recv_heart_state?s=d:1==o.is_in_cd&&(s=u);var r=this.createFriendPosPanel(o.openid,s);this.addAvatarPanelToStage(o.stage_id,r,o.openid)}}n.length!=NetData.player_baseinfo_ntf.baseinfo_list.length?(console.log("getPlayerBaseinfo : "+JSON.stringify(n)),GameService.getPlayerBaseinfo({openid_list:n},function(e,t){e&&(console.log("拉取好友基本信息失败"),TipWindow.Show(e.ret_desc))})):NetData.player_baseinfo_ntf.baseinfo_list.length>0&&this.refreshFriendsAvatar()},refreshFriendsAvatar:function(){console.log("refreshFriendsAvatar"),this.updateAvatarUrlList();for(var e=this.avatarPanelList,t=e.length,i=null,n=null,a=this,o=0;o<t;o++)e[o]&&e[o].openid!==NetData.user_info.openid&&(i=e[o].panel,n=this.getHeadUrlByOpenId(e[o].openid),GameUtil._loadAvatar(n,function(e,t){var i=e.getContentSize();e.setScaleX(72/i.width),e.setScaleY(72/i.height),e.setAnchorPoint(.5,0),e.setPosition(38,18);var n=a._getClippingAvatar();n.addChild(e),n.setPosition(40,40),t.addChild(n)},i))},refreshFriendsStatus:function(){console.log("refreshFriendsStatus");for(var e=this.avatarPanelList,t=e.length,i=null,n=0;n<t;n++)if(e[n]&&e[n].openid!==NetData.user_info.openid){var a=this.getFriendDataByOpenId(e[n].openid)||{};i=e[n].panel;var o=h;0==a.recv_heart_state?o=d:1==a.is_in_cd&&(o=u);var s=i.getChildByTag(1),r=i.getChildByTag(2);o==d?(r.initWithSpriteFrameName("icon_prohibit_take_heart.png"),s.setTouchEnabled(!1)):o==u?(r.initWithSpriteFrameName("icon_already_take_heart.png"),s.setTouchEnabled(!1)):(r.initWithSpriteFrameName("icon_take_heart.png"),s.setTouchEnabled(!0))}},updateAvatarUrlList:function(){var e=NetData.player_baseinfo_ntf.baseinfo_list;if(e){for(var t,i=this.userBaseInfoList,n=0,a=e.length;n<a;n++){t=e[n];for(var o,s=!1,r=0,c=i.length;r<c;r++)if(o=i[r],t.openid===o.openid){s=!0;break}s||this.userBaseInfoList.push(t)}console.log("updateAvatarUrlList: this.userBaseInfoList.length= "+this.userBaseInfoList.length)}},getHeadUrlByOpenId:function(e){var t=this.userBaseInfoList;if(t)for(var i=0,n=t.length;i<n;i++)if(t[i].openid===e)return t[i].pic;return""},getFriendDataByOpenId:function(e){var t=NetData.map_friend_ntf.friend_list;if(t)for(var i=0,n=t.length;i<n;i++)if(t[i].openid===e)return t[i];return null},initPool:function(){for(var e=0;e<20;e++)this.inactiveStagePool.push(this.createStageBtn(s,1))},initView:function(){this.bgLayer=new cc.Layer,this.bgLayer.setPosition(this.curMapPos),this._leftPanel.addChild(this.bgLayer,0),this.bgImgLayer=new cc.Layer,this.bgImgLayer.setPosition(this.curMapPos),this._leftPanel.addChild(this.bgImgLayer,1),this.mapAniLayer=new cc.Layer,this.mapAniLayer.setPosition(this.curMapPos),this._middlePanel.addChild(this.mapAniLayer,2),this.stageLayer=new cc.Layer,this.stageLayer.setPosition(this.curMapPos),this._middlePanel.addChild(this.stageLayer,3),this.stageNumLayer=new cc.Layer,this.stageNumLayer.setPosition(this.curMapPos),this._middlePanel.addChild(this.stageNumLayer,3),this.mapFgAniLayer=new cc.Layer,this.mapFgAniLayer.setPosition(this.curMapPos),this._middlePanel.addChild(this.mapFgAniLayer,3),this.stageInfoLayer=new cc.Layer,this.stageInfoLayer.setPosition(this.curMapPos),this._middlePanel.addChild(this.stageInfoLayer,4);var e=new cc.Layer;this.playerInfoLayer=e,this._middlePanel.addChild(e,4),this.cloudLayer=new cc.Layer,this.cloudLayer.setPosition(this.curMapPos),this._middlePanel.addChild(this.cloudLayer,5),this._rightPanel.setLocalZOrder(4),this._rightPanel.setPositionX(cc.winSize.width),this.screenEffectLayer=new cc.Layer,this.addChild(this.screenEffectLayer,6),this.initPool();for(var t=Math.ceil(this.mapSize.height/this.fragSize.height),i=0;i<t;i++)this.bgFragList.push(null);for(i=0;i<MAX_STAGE_ID;i++)this.avatarPanelList.push(null);var n=Math.ceil(MAX_STAGE_ID/MaxItemNumPerPage),a=2*n;for(i=0;i<a;i++)this.bgBkgImgList.push(null);var s,r,c,l=this.sectionHeight,h=[],u=this._getBkgImgConfig(),d=u.length;for(i=0;i<n;++i){c=(r=u[2*i%d]).height,s=this.bottomMargin+c/2+r.offsetY+i*l,h.push(cc.p(0,s)),s+=c,h.push(cc.p(0,s))}this.resBkgImgPos=h;var p,f,_=function(e){var t=e%120,i=0;return t<30?i=92:30<=t&&t<60?i=78:60<=t&&t<90?i=140:90<=t&&t<120&&(i=108),i},g=(cc.winSize.width-640)/2+64;for(i=0;i<MAX_STAGE_ID;i++){f=Math.floor(i/30),p=this.bottomMargin+f*this.sectionHeight+_(i);var b=AllStageConfig[i%30];s=p+(this.sectionHeight-b.pos.y);this.stageBtnList.push(null),this.stageNumList.push(null),this.stageInfoLabelList.push(null);var m=i-120*Math.floor(i/120);m=b.img+2*Math.floor(m/30),this.realStageConfig.push({level:i+1,imgID:m,position:cc.p(g+b.pos.x,s)})}this.friendsManager=new o(this.playerInfoLayer,this.realStageConfig),this.initBottom(),this.initShareForGift()},_onWxShow:function(){this.initGroupRank(),this.initPKRank()},initGroupRank:function(){var e=window.getWXLaunchOptionsSync();if("groupRank"==e.query.from&&e.shareTicket){e.query.from="";var t=this;setTimeout(function(){t._doShare2Group(e.shareTicket)},800)}},initPKRank:function(){var e=this,t=window.getWXLaunchOptionsSync();console.error(t),GameUtil.isArenaMatch(t)&&(t.query.from="",GameUtil.saveArenaMatchData(t),console.warn("===",page.PKRank),setTimeout(function(){TopGoldBar.Hide(),e.friendsManager.clear(),PageUtil.switchPageWithLoading("PKRank",PageType.replace,ResObjects.getResObject(ResObjectConfig.PKRank))},800))},initBottom:function(){var e=cc.winSize.width,t=new cc.Layer;t.setAnchorPoint(0,0),t.setPosition(0,iphoneXMode?68:0),t.setContentSize(110,130),this.addChild(t,4),this._leftBottomPanel=t;var i=new cc.Layer;i.setAnchorPoint(0,0),i.setPosition(e,iphoneXMode?68:0),i.setContentSize(.2*e,130),this.addChild(i,4),this._rightBottomPanel=i;var n=UIHelper.createImage({imageFileName:"btn_left_bkg.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(88,166),capInsets:cc.rect(0,50,88,10),position:cc.p(60,30)});n.setAnchorPoint(.5,0),n.setVisible(!1),t.addChild(n,0,123);(l=UIHelper.createButton({normalFile:"btn_more.png",anchorPoint:COMMON_ANCHOR.midCenter,bPlistTexture:!0,bTouchEnable:!0})).setPosition(60,60),l.addTouchEventListener(this._onMoreBtnTouched,this),t.addChild(l);var a=-(l=UIHelper.createButton({normalFile:"btn_map.png",anchorPoint:COMMON_ANCHOR.midCenter,bPlistTexture:!0,bTouchEnable:!0})).getContentSize().width/2-10;l.setPosition(a,65),l.addTouchEventListener(this._onMiniMapBtnTouched,this),i.addChild(l);var o=new cc.Sprite;o.initWithSpriteFrameName("m_red_pot.png"),o.setPosition(82,82),o.setVisible(!1),l.addChild(o,0,1e3);var s=new cc.LabelTTF("","Arial",18,cc.size(45,20));s.setAnchorPoint(.5,.5),s.setPosition(82,83),s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.setVisible(!1),l.addChild(s,0,1001),this._miniMapBtn=l;var r=new cc.Sprite("#jump-small-star.png");r.setPosition(l.x-25,l.y-36),i.addChild(r);var c=this.holdStarCount=new cc.LabelBMFont(""+StageJumpData.getTotalStars(),res.number_white_blue_fnt);c.setPosition(l.x+14,l.y-44),c.setScaleY(1.1),i.addChild(c),a=a-(l=UIHelper.createButton({normalFile:"btn_mail.png",anchorPoint:COMMON_ANCHOR.midCenter,bPlistTexture:!0,bTouchEnable:!0})).getContentSize().width-10,l.setPosition(a,65),l.addTouchEventListener(this._onMailBtnTouched,this),i.addChild(l),(o=new cc.Sprite).initWithSpriteFrameName("m_red_pot.png"),o.setPosition(82,82),o.setVisible(!1),l.addChild(o,0,2e3),(s=new cc.LabelTTF("","Arial",18,cc.size(45,20))).setAnchorPoint(.5,.5),s.setPosition(82,83),s.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),s.setVisible(!1),l.addChild(s,0,2001),this._mailBtn=l,a=a-(l=UIHelper.createButton({normalFile:"btn_task.png",anchorPoint:COMMON_ANCHOR.midCenter,bPlistTexture:!0,bTouchEnable:!0})).getContentSize().width-10,l.setPosition(a,65),l.addTouchEventListener(this._onActCenterBtnTouched,this),this._actCenterBtn=l,i.addChild(l),GameUtil.isTaskNeedAward(2)&&UIHelper.attachRedPot(l,cc.p(80,80)),a=a-(l=UIHelper.createButton({normalFile:"btn_task_daily.png",anchorPoint:COMMON_ANCHOR.midCenter,bPlistTexture:!0,bTouchEnable:!0})).getContentSize().width-10,l.setPosition(a,65),l.addTouchEventListener(this._onDailyTaskBtnTouched,this),i.addChild(l),this._taskBtn=l,GameUtil.isTaskNeedAward(1)&&UIHelper.attachRedPot(l,cc.p(80,80));var l;a=a-(l=UIHelper.createButton({normalFile:"btn_share.png",anchorPoint:COMMON_ANCHOR.midCenter,bPlistTexture:!0,bTouchEnable:!0})).getContentSize().width-10,l.setPosition(a,65),l.addTouchEventListener(this._onShareBtnTouched,this),l.setName(this._shareGift.btnName),i.addChild(l),WeekMatchEnterHandler.createEnter(this._rightPanel),(l=UIHelper.createButton({normalFile:"btn_f_rank.png",anchorPoint:COMMON_ANCHOR.rightMid,bPlistTexture:!0,bTouchEnable:!0})).setPosition(this._rightPanel.getContentSize().width-10,cc.winSize.height-210),l.addTouchEventListener(this._onFriendRankBtnTouched,this),this._rightPanel.addChild(l,1),(l=UIHelper.createButton({normalFile:"btn_w_rank.png",anchorPoint:COMMON_ANCHOR.rightMid,bPlistTexture:!0,bTouchEnable:!0})).setPosition(this._rightPanel.getContentSize().width-10,cc.winSize.height-350),l.addTouchEventListener(this._onRankBtnTouched,this),this._rightPanel.addChild(l,1),(l=UIHelper.createButton({normalFile:"btn_pkrank_entry.png",anchorPoint:COMMON_ANCHOR.rightMid,bPlistTexture:!0,bTouchEnable:!0})).setPosition(this._rightPanel.getContentSize().width-15,cc.winSize.height-490),l.addTouchEventListener(this._onMatchBtnTouched,this),this._rightPanel.addChild(l,1),new MenuGroupLT(this)},_onGameInIFrameShow:function(){},_onGameInIFrameHide:function(){},_onGameInIFrameClose:function(){},initShareForGift:function(){if(this._rightBottomPanel){var e=this._rightBottomPanel.getChildByName(this._shareGift.btnName);e&&(e.setVisible(ShareForGift.inTimeRange()),this.initShareForGiftRedDot())}},initShareForGiftRedDot:function(){var e=this;Timeout.register(function(){if(e._rightBottomPanel){var t=e._rightBottomPanel.getChildByName(e._shareGift.btnName);if(t){if(!(i=ShareForGift.hasRedDot()))return void t.removeAllChildrenWithCleanup();var i;(i=new cc.Sprite).initWithSpriteFrameName("s_red_pot.png"),i.setPosition(.88*t.width,.82*t.height),t.addChild(i)}}},500)},_onShareBtnTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),ShareForGift.onTouched())},_onWXCircleTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(this._onMorePanelTouched(e,t),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),X8SDK.openUrlWithExtraWebview({url:"http://game.weixin.qq.com/cgi-bin/h5/static/community/club_index.html?appid=wx4b05dce3b041cd62"}))},_onQQTribeTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(this._onMorePanelTouched(e,t),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),X8SDK.openUrlWithExtraWebview({url:"https://buluo.qq.com/p/barindex.html?bid=368973"}))},_onFeedbackBtnTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(console.log("_onFeedbackBtnTouched"),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),TopGoldBar.Hide(),FeedbackWindow.Show(),this._onMorePanelTouched(e,t))},_onSettingBtnTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(console.log("_onSettingBtnTouched"),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),TopGoldBar.Hide(),SettingWindow.Show(),this._onMorePanelTouched(e,t))},_onMiniMapBtnTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(console.log("_onMiniMapBtnTouched"),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),TopGoldBar.Hide(),MiniMapWindow.Show(this))},_onMailBtnTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(console.log("_onMailBtnTouched"),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),TopGoldBar.Hide(),EmailWindow.Show())},_onFriendRankBtnTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(console.log("_onFriendRankBtnTouched"),Util.unRegisterListener(this._listenerList,EventID.PLAYER_BASEINFO_NTF),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),TopGoldBar.Hide(),RankListWindow.Show("friendRank"))},_onRankBtnTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(console.log("_onRankBtnTouched"),Util.unRegisterListener(this._listenerList,EventID.PLAYER_BASEINFO_NTF),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),n.show())},_doShare2Group:function(e){RankListWindow.Show("groupRank")},_onMatchBtnTouched:function(e,t){if(ccui.Widget.TOUCH_ENDED==t){console.log("_onMatchBtnTouched");"1"!=wx.getStorageSync("pkrank_show")?a.show(this._doRunPKRankShare):this._doRunPKRankShare()}},_doRunPKRankShare:function(){wx.showLoading({title:"擂台赛准备中...",mask:!0}),console.warn("pkrank","================"),GameService.getArenaMatchId(null,function(e,t){if(console.warn("pkrank","====",e,JSON.stringify(t)),wx.hideLoading(),e)window.alert("擂台赛准备失败!");else{var i=t.arena_match_id,n=new Long(i.low,i.high).toString();console.warn("pkrank","====",n),NetData.arena_match={arena_match_id:n,stage_bin_path:t.stage_bin_path,stage_id:t.stage_id,created_time:t.created_time,serverEnv:window.serverEnv};var a="from=PKRank&serverEnv="+window.serverEnv+"&created_time="+t.created_time+"&arena_match_id="+n+"&stage_bin_path="+t.stage_bin_path+"&stage_id="+t.stage_id;console.warn("pkrank","====",a),XCXSDK.setCustomShareData({title:"我发起了一场爱消除群擂台赛, 谁来和我一战?",imageUrl:window.remoteResPath+"res/shareimg2/pkrank.png",query:a},function(e){console.warn("setCustomShareData",JSON.stringify(e)),e&&e.shareTickets&&e.shareTickets.length&&e.shareTickets.length>0&&e.groupMsgInfos&&e.groupMsgInfos.length&&e.groupMsgInfos.length>0?(wx.showLoading({title:"擂台赛准备开始...",mask:!0}),wx.getShareInfo({shareTicket:e.shareTickets[0],success:function(t){wx.hideLoading(),console.warn("getShareInfo - 1",JSON.stringify(t)),PageUtil.startPKMatch(),GameService.arenaMatchSahre({arena_match_id:n,group_msg_ticket:e.groupMsgInfos[0].groupMsgTicket,expire_time:e.groupMsgInfos[0].expiresIn,encrypted_data:t.encryptedData,iv:t.iv},function(e,t){console.warn("pkrank","====",e,t)})},fail:function(e){wx.hideLoading(),window.alert("获取必要数据失败!"),console.warn("getShareInfo - 0",e)}})):e&&e.shareTickets&&!e.groupMsgInfos?window.alert("群擂台赛功能只针对新版本微信开放哦！"):window.alert("要选择分享到微信群才能发起群擂台赛哦！")},function(e){e.errMsg.indexOf("cancel")<0&&window.alert("分享失败")}),XCXSDK.customShare()}})},_onActCenterBtnTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(console.log("_onActCenterBtnTouched"),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),TopGoldBar.Hide(),TaskCenterWindow.Show())},_onRankRewardNotify:function(){},_onActivityNotified:function(){TaskCenterWindow.updateView()},_onDailyTaskBtnTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(console.log("_onDailyTaskBtnTouched"),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),TopGoldBar.Hide(),TaskWindow.Show())},_onMoreBtnTouched:function(e,t){if(ccui.Widget.TOUCH_ENDED==t){console.log("_onMoreBtnTouched"),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch);var i=this._leftBottomPanel.getChildByTag(123);i&&i.setVisible(!0);var n=UIHelper.createPanel({anchorPoint:COMMON_ANCHOR.leftBottom,position:cc.p(0,0),size:cc.size(cc.winSize.width,cc.winSize.height),bTouchEnable:!0});this._leftBottomPanel.addChild(n,10,111),n.addTouchEventListener(this._onMorePanelTouched,this);var a=UIHelper.createButton({normalFile:"btn_left_setting.png",anchorPoint:COMMON_ANCHOR.midCenter,bPlistTexture:!0,bTouchEnable:!0}),o=152;a.setPosition(60,o),a.addTouchEventListener(this._onSettingBtnTouched,this),n.addChild(a),o+=88}},_onMorePanelTouched:function(e,t){if(ccui.Widget.TOUCH_ENDED==t){console.log("_onMorePanelTouched");var i=this._leftBottomPanel.getChildByTag(111);i.setVisible(!1),i&&i.removeFromParent(!0);var n=this._leftBottomPanel.getChildByTag(123);n&&n.setVisible(!1)}},onEnter:function(){if(wx.triggerGC&&wx.triggerGC(),TopGoldBar.Show(),this._super(),this.noMusic||(MusicManager.stopMusic(),MusicManager.playMusic(MusicEffectFiles.Audio_login,!0)),this.getMail)this.onReqMailList();else{var e=0;e=EmailWindow._instance?EmailWindow._instance.getUnreadNum():emailData.getMailTotalCount(),this.updateMailBtn(e)}setTimeout(function(){taskCenterData.getActInfoFromServer()},100),this.updateMiniMapBtn(),this.initGroupRank(),this.initPKRank()},onExit:function(){var e=this.getAverageFrameRate();console.log("StageMapPage average frame rate : "+e),this._super(),Util.unRegisterListeners(this._listenerList),this._listenerList=null,this.friendsManager.clear(),null!=this._touchListener&&(cc.eventManager.removeListener(this._touchListener),UIHelper.release(this._touchListener)),this.reset()},reset:function(){this.clearArray(this.bgFragList),this.clearArray(this.bgBkgImgList),this.clearArray(this.stageBtnList),this.clearArray(this.stageNumList),this.clearArray(this.stageInfoLabelList),this.clearArray(this.avatarPanelList),this.bgFragList=[],this.bgBkgImgList=[],this.stageBtnList=[],this.stageNumList=[],this.stageInfoLabelList=[],this.avatarPanelList=[],this.bgLayer=null,this.mapAniLayer=null,this.mapFgAniLayer=null,this.bgImgLayer=null,this.stageLayer=null,this.stageNumLayer=null,this.stageInfoLayer=null,this.playerInfoLayer=null,this.cloudLayer=null,this.screenEffectLayer=null,this.uiLayer=null,this.mapSize=null,this.fragSize=null,this.curMapPos=cc.p(0,0),this.newMapCloudEffect=null,this.isShowNextStageAni=!1,this.showCallback=null,this.lastPassedStageId=null,this.playerPosPanel=null,this.stageDataList=[],this.realStageConfig=[],this.clearArray(this.activeStagePool),this.clearArray(this.inactiveStagePool),this.clearArray(this.curStagePool),this.clearArray(this.newLabelPool),this.clearArray(this.stageNumYPool),this.clearArray(this.stageNumWPool),this.activeStagePool=[],this.inactiveStagePool=[],this.curStagePool=[],this.newLabelPool=[],this.stageNumYPool=[],this.stageNumWPool=[],this.mapAniSectionObj={},this.clearArray(this.bgImgFragPool),this.bgImgFragPool=[],this._oldScreenWidth=cc.winSize.width},clearArray:function(e){for(var t=e.length,i=0;i<t;i++)e[i]=null},getTouchedBtnStarItem:function(e){for(var t=this.stageBtnList,i=this.realStageConfig,n=t.length,a=this.curMapPos.y,o=0;o<n;o++){if(t[o]&&o<=this.max_stage_id){var s=i[o].position,r=s.y+a,c=cc.rect(s.x-60,r-60,120,120);if(cc.rectContainsPoint(c,e))return void(this.selectedStageId=o+1)}}this.selectedStageId=0},showStageView:function(e){MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),GameProxy.setStageId(this.selectedStageId);var t={stageId:e,img:"",detail:""};if(e>this.max_stage_id){var i=this._getNewElementByStageID(e);i?(t.img=i.resList[0]||"",t.detail=i.desc):t=null}else t=null;SureAdventureWindow.Show(function(){console.warn("SureAdventureWindow.Show callback"),PropSelectWindow.Show()}.bind(this),this,null,t),SoundCacheManager.preLoad()},touchedBegan:function(e,t){if(this.isShowNextStageAni)return!1;this.isScrolling=!1;var i=e.getLocation();return this._beganPosY=i.y,this._moveBeganPosY=this._beganPosY,this._beganTime=Date.now(),this.getTouchedBtnStarItem(i),!0},touchedMoved:function(e,t){var i=this._beganPosY,n=e.getLocation().y,a=n-i;if(this.isScrolling)this._beganPosY=n;else{if(Math.abs(a)<10)return;this.isScrolling=!0,this.selectedStageId=0}a=this.curMapPos.y+a,this.refreshView(a)},touchedEnded:function(e,t){this.isScrolling=!1;var i=this.selectedStageId;if(i>0)return this.showStageView(i),void(this.selectedStageId=0)},touchedCancelled:function(e,t){},jumpToStage:function(e,t){e<1?e=1:e>MAX_STAGE_ID&&(e=MAX_STAGE_ID);var i=this.realStageConfig[e-1],n=t-(i?i.position.y:0);this.refreshView(n)},showJumpStageAni:function(e){var t=new Effect(res.cloudmask_json);this.screenEffectLayer&&(this.screenEffectLayer.addChild(t,1),t.setPosition(cc.winSize.width/2,cc.winSize.height/2),t.play(!1),t.setPlayCompleteCallBack(function(){t.removeFromParent(!0)}));var i=this;Timeout.register(function(){var t=cc.winSize.height/2;i.jumpToStage(e,t)},800)},refreshView:function(e){this.curMapPos.y=e,this.curMapPos.y>0&&(this.curMapPos.y=0),this.curMapPos.y<-(this.mapSize.height-cc.winSize.height)&&(this.curMapPos.y=-(this.mapSize.height-cc.winSize.height)),this.bgLayer.setPosition(this.curMapPos),this.mapAniLayer.setPosition(this.curMapPos),this.mapFgAniLayer.setPosition(this.curMapPos),this.bgImgLayer.setPosition(this.curMapPos),this.stageLayer.setPosition(this.curMapPos),this.stageNumLayer.setPosition(this.curMapPos),this.stageInfoLayer.setPosition(this.curMapPos),this.playerInfoLayer.setPosition(this.curMapPos),this.cloudLayer.setPosition(this.curMapPos);for(var t=-this.curMapPos.y,i=t+cc.winSize.height,n=this.bgFragList.length,a=0;a<n;a++){var o=a*this.fragSize.height;if((r=(a+1)*this.fragSize.height)<t||o>i)this.bgFragList[a]&&(this.bgFragList[a].removeFromParent(),this.bgFragList[a]=null);else if(r>=t&&o<=i&&!this.bgFragList[a]){var s=new cc.Sprite(this._rootRes+"map_bg_"+a%2+".jpg");s.setAnchorPoint(0,0),s.setPosition(0,o),s.setScaleX(cc.winSize.width/640),this.bgLayer.addChild(s),this.bgFragList[a]=s}}var r,c,l,h,u=this._getBkgImgConfig(),d=this.bgBkgImgList.length,p=u.length,f=.3*cc.winSize.height;for(a=0;a<d;a++)l=a%p,h=u[l],c=this.resBkgImgPos[a],o=c.y-h.height/2,r=c.y+h.height/2,r<t-f||o>i+f?this.bgBkgImgList[a]&&(this.bgBkgImgList[a].removeFromParent(),this.bgBkgImgList[a]=null,console.log("remove background image: index= "+a)):r>=t-f&&o<=i+f&&null==this.bgBkgImgList[a]&&(console.log("load background image: index= "+a),this._loadBkgImg(a));var _=-this.curMapPos.y-100,g=-this.curMapPos.y+cc.winSize.height+100,b=(n=MAX_STAGE_ID,this.stageBtnList),m=this.stageNumList,y=this.realStageConfig,w=this.stageDataList;for(a=0;a<n;a++){var v=y[a];v.position.y>=_&&v.position.y<=g?(this.friendsManager.showFriend(a),b[a]||(b[a]=this.createStageBtnByStage(a+1,w[a],v))):(this.friendsManager.hideFriend(a),b[a]&&(this.recycleStageBtn(a+1,b[a],m[a]),b[a]=null,m[a]=null))}this.refreshMapAni(),this.playCloudAni(-e)},getStageBtn:function(e,t){var i=null;return(i=s==e||l==e?this.inactiveStagePool.shift():c==e?this.activeStagePool.shift():this.curStagePool.shift())||(i=this.createStageBtn(e,t.imgID)),i},getStageNum:function(e){var t=null;return(t=s==e||l==e?this.stageNumWPool.shift():this.stageNumYPool.shift())||(t=this.createStageNum(e)),t},recycleStageBtn:function(e,t,i){if(t){t.setVisible(!1),t.stopAllActions(),this.stageInfoLabelList[e-1]&&(this.recycleNewLabel(this.stageInfoLabelList[e-1]),this.stageInfoLabelList[e-1]=null);var n=s;e<=this.max_stage_id?n=c:e==this.max_stage_id+1&&(n=r),StageJumpData.isHold(e)&&(n=l),s==n||l==n?this.inactiveStagePool.push(t):c==n?this.activeStagePool.push(t):this.curStagePool.push(t),this.recycleStageNum(n,i)}},recycleStageNum:function(e,t){t&&(t.setVisible(!1),s==e||l==e?this.stageNumWPool.push(t):this.stageNumYPool.push(t))},createStageBtn:function(e,t){var i="";i=s==e?"n_m_btn_"+t+".png":c==e?"n_m_btn_100.png":l==e?"jump-stage-btn-jumped.png":"n_m_btn_100.png";var n=new cc.Sprite;if(n.initWithSpriteFrameName(i),n.setTag(0),n.setVisible(!1),e>0)for(var a=0;a<3;++a){var o=new cc.Sprite;o.setTag(11+a),o.initWithSpriteFrameName("n_m_btn_star.png"),o.setPosition(46+20*a,20),o.setVisible(!1),n.addChild(o,0)}return this.stageLayer.addChild(n),n},createStageNum:function(e){var t;return s==e||l==e?(console.log("create stage num : w"),t=new cc.LabelBMFont("",res.number_stage_w_fnt)):(console.log("create stage num : y"),t=new cc.LabelBMFont("",res.number_stage_y_fnt)),t.setScale(.9),t.setAnchorPoint(.5,.5),t.setVisible(!1),this.stageNumLayer.addChild(t),t},createStageBtnByStage:function(e,t,i){t=t||{};var n=-1,a=s;e<=this.max_stage_id?(n=t.star_level,a=c):e==this.max_stage_id+1&&(a=r,n=0),StageJumpData.isHold(e)&&(a=l);var o=this.getStageBtn(a,i);o.setPosition(i.position),o.setVisible(!0);var h=this.getStageNum(a);h.setPosition(i.position),h.setPositionY(h.getPositionY()+15),h.setVisible(!0),this.stageNumList[e-1]=h,h.setString(e);var u;if(e>this.max_stage_id+1){u="n_m_btn_"+i.imgID+".png";this._getNewElementByStageID(e)&&this.showNewElementLabel(e,i.position)}else u="n_m_btn_100.png";if(StageJumpData.isHold(e)&&(u="jump-stage-btn-jumped.png"),o.initWithSpriteFrameName(u),a>0)try{var d=o.getChildByTag(11),p=o.getChildByTag(12),f=o.getChildByTag(13);d.setVisible(!1),p.setVisible(!1),f.setVisible(!1),n>=1&&d.setVisible(!0),n>=2&&p.setVisible(!0),n>=3&&f.setVisible(!0)}catch(e){}return o},_onPaoPaoActionPlay:function(e){var t=e.getChildByTag(103);if(t){this.schedule(function(){var e=cc.sequence(cc.scaleTo(.2,1.1,1.1).easing(cc.easeQuadraticActionOut()),cc.scaleTo(.2,.8,.8).easing(cc.easeQuadraticActionOut()),cc.scaleTo(.2,1,1).easing(cc.easeQuadraticActionOut()),cc.delayTime(4),cc.fadeOut(.4));t.setVisible(!0),t.setOpacity(255),t.runAction(e)},8,3,2,"")}},addAvatarPanelToStage:function(e,t,i){e=e<MAX_STAGE_ID?e:MAX_STAGE_ID;var n=this.realStageConfig[e-1];if(n){var a=n.position;t.setPosition(a.x,a.y+30),null==t.getParent()&&this.playerInfoLayer.addChild(t,1),i!==NetData.user_info.openid&&(this.avatarPanelList[e-1]={panel:t,openid:i})}else console.log("addAvatarPanelToStage, stage错误, stageId="+e)},_getClippingAvatar:function(){var e=new cc.ClippingNode,t=new cc.Sprite;return t.setPosition(40,50),t.initWithSpriteFrameName("n_m_btn_mask.png"),t.setScale(.95),e.setStencil(t),e.setAnchorPoint(.5,.5),e.setAlphaThreshold(0),e.setContentSize(80,80),e},createPlayerPosPanel:function(){var e=new cc.Sprite;e.initWithSpriteFrameName("playerPos.png"),e.setAnchorPoint(.5,0),e.setLocalZOrder(1);var t=this.friendsManager.getUserHead(),i=t.getContentSize();t.setScaleX(72/i.width),t.setScaleY(72/i.height),t.setAnchorPoint(.5,0),t.setPosition(38,18);var n=this._getClippingAvatar();n.addChild(t),n.setPosition(42,45),e.addChild(n,0,102);var a=UIHelper.createPanel({anchorPoint:COMMON_ANCHOR.midBottom,position:cc.p(38,18),size:cc.size(65,65),bTouchEnable:!0});return e.addChild(a,1),a.addTouchEventListener(this._onSelfAvatarPanel,this),e},_onSelfAvatarPanel:function(e,t){},createFriendPosPanel:function(e,t){var i=new cc.Sprite;i.initWithSpriteFrameName("friendPos.png"),i.setAnchorPoint(.5,0);var n=UIHelper.createPanel({anchorPoint:COMMON_ANCHOR.midBottom,position:cc.p(38,18),size:cc.size(65,65),bTouchEnable:!0});n.setName(e),n.setTag(1),i.addChild(n,1),n.addTouchEventListener(this._onGiftHeartBtnTouched,this);var a=new cc.Sprite;return t==d?(a.initWithSpriteFrameName("icon_prohibit_take_heart.png"),n.setTouchEnabled(!1)):t==u?(a.initWithSpriteFrameName("icon_already_take_heart.png"),n.setTouchEnabled(!1)):(a.initWithSpriteFrameName("icon_take_heart.png"),n.setTouchEnabled(!0)),a.setAnchorPoint(.5,0),a.setPosition(75,0),a.setName("status"),a.setTag(2),i.addChild(a,2),i},_onGiftHeartBtnTouched:function(e,t){if(ccui.Widget.TOUCH_ENDED==t){var i=e.getName();e.getParent().getChildByName("status"),console.log("_onGiftHeartBtnTouched : "+i)}},prePlayStageAni:function(e){var t=e-1,i=this.realStageConfig[t];this.recycleStageBtn(e,this.stageBtnList[t],this.stageNumList[t]),this.stageBtnList[t]=null,this.stageNumList[t]=null;var n=this.getStageBtn(s,i);n.setPosition(i.position),n.setVisible(!0),this.stageBtnList[t]=n},playOpenNextStageAni:function(){var e=this;Timeout.register(function(){var t=cc.sequence(cc.scaleTo(.2,1,.6).easing(cc.easeQuadraticActionOut()),cc.scaleTo(.25,.6,1.2).easing(cc.easeQuadraticActionOut()),cc.scaleTo(.2,.01,.01).easing(cc.easeQuadraticActionOut()),cc.callFunc(e.onPanelDisappear,e));e.playerPosPanel.runAction(t),MusicManager.playEffect(MusicEffectFiles.Audio_UI_newstage1)},200)},onPanelDisappear:function(){var e=this;Timeout.register(function(){e.stageBtnList[e.max_stage_id]&&e.stageBtnList[e.max_stage_id].removeFromParent(),e.stageBtnList[e.max_stage_id]=null;var t=e.realStageConfig[e.max_stage_id];e.stageBtnList[e.max_stage_id]=e.createStageBtnByStage(e.max_stage_id+1,e.stageDataList[e.max_stage_id],t),e.addAvatarPanelToStage(e.max_stage_id+1,e.playerPosPanel,NetData.user_info.openid);var i=cc.sequence(cc.scaleTo(.25,.8,1.2).easing(cc.easeQuadraticActionOut()),cc.scaleTo(.2,1,.8).easing(cc.easeQuadraticActionOut()),cc.scaleTo(.25,1,1).easing(cc.easeQuadraticActionOut()),cc.callFunc(e.onPanelAppear,e));e.playerPosPanel.runAction(i),MusicManager.playEffect(MusicEffectFiles.Audio_UI_newstage2)},600)},onPanelAppear:function(){console.log("onPanelAppear"),this.isShowNextStageAni=!1,this.hideFriendPanelInStage(this.max_stage_id+1),this.showCallback&&this.showCallback()},onReqMailList:function(){if(!this._alreadyUpdatedMail){var e={type:MailType.MAIL_TYPE_ALL};GameService.getMailList(e,function(e,t){e?console.log("onReqMailList: err code: "+e.ret):console.log("onReqMailList response OK")}),this._alreadyUpdatedMail=!0}},onReadMailContent:function(){var e=this._mailBtn.getChildByTag(2001),t=this._mailBtn.getChildByTag(2e3),i=EmailWindow._instance.getUnreadNum();i<=0?(e&&e.setVisible(!1),t&&t.setVisible(!1)):i>0&&e&&e.setString(i)},onUpdateMailResData:function(){var e=NetData.mail_list_ntf.type;emailData.clearAllData(e);var t=NetData.mail_list_ntf.mail_list;if(t){emailData.saveMailData(t);var i=emailData.getMailTotalCount();this.updateMailBtn(i)}else console.log("onUpdateMailResData: null == dataList, error! ");EmailWindow.Destroy()},updateMiniMapBtn:function(){console.log("updateMiniMapBtn");var e=GameUtil.getStageRewardNum(),t=this._miniMapBtn.getChildByTag(1001),i=this._miniMapBtn.getChildByTag(1e3);t&&i&&(e<=0?(t.setVisible(!1),i.setVisible(!1)):(i.setVisible(!0),t.setVisible(!0),t.setString(e)))},_onUpdateTaskBtn:function(){console.log("_onUpdateTaskBtn"),GameUtil.isTaskNeedAward(1)?UIHelper.attachRedPot(this._taskBtn,cc.p(80,80)):UIHelper.removeRedPot(this._taskBtn),GameUtil.isTaskNeedAward(2)?UIHelper.attachRedPot(this._actCenterBtn,cc.p(80,80)):UIHelper.removeRedPot(this._actCenterBtn)},updateMailBtn:function(e){var t=this._mailBtn.getChildByTag(2001),i=this._mailBtn.getChildByTag(2e3);if(t&&i)return e<=0?(t.setVisible(!1),void i.setVisible(!1)):(i.setVisible(!0),t.setVisible(!0),void t.setString(e))},getNewLabel:function(){var e=this.newLabelPool.shift();return e||(console.log("new element label"),e=new cc.Sprite,e.initWithSpriteFrameName("n_m_btn_new.png"),e.setAnchorPoint(.5,0),this.stageInfoLayer.addChild(e)),e},showNewElementLabel:function(e,t){var i=this.stageInfoLabelList[e-1];i||(i=this.getNewLabel(),this.stageInfoLabelList[e-1]=i),i.setVisible(!0),i.setPosition(t.x,t.y+30)},recycleNewLabel:function(e){e.setVisible(!1),this.newLabelPool.push(e)},onWindowResize:function(){var e=this,t=cc.winSize.width;console.log("StageMapPage onWindowResize: newWidth= "+t);var i=(t-this._oldScreenWidth)/2;console.log("change= "+i);var n;for(var a in this.realStageConfig)n=this.realStageConfig[a],n.position.x+=i;var o=this._middlePanel.getPositionX()+i;this._middlePanel.setPositionX(o),this._rightPanel.setPositionX(cc.winSize.width);var s,r=t/640;for(var a in this.bgFragList)s=this.bgFragList[a],s&&s.setScaleX(r);for(var a in this.bgBkgImgList)s=this.bgBkgImgList[a],s&&s.setScaleX(r);var c=t,l=t/385,h=this.visibleSection||[],u=this._getAniRes();h.forEach(function(t){var i=u[(t-1)%4+1],n=e._getAniPos(t),a=null;a=i.bgAni?e.mapAniLayer:e.mapFgAniLayer;var o=UIHelper.seekWidgetByName(a,"mapAniSection"+t);if(o)for(var s=0,r=n.length;s<r;s++){var c=o.getChildByTag(s);c&&(c.setScaleX(l),c.setPosition(n[s]))}}),this._rightBottomPanel.setPosition(c,0),this._oldScreenWidth=c},onJumpStage:function(){this.holdStarCount.setString(StageJumpData.getTotalStars())},resetStageBtn:function(e,t){try{var i=this.stageBtnList[e-1],n=i.getChildByTag(1),a="",o=null;switch(t){case l:a="jump-stage-btn-jumped.png",o=res.number_stage_w_fnt;break;case r:a="n_m_btn_100.png",o=res.number_stage_y_fnt;break;default:a="n_m_btn_100.png",o=res.number_stage_w_fnt}i.initWithSpriteFrameName(a),n.removeFromParent(!0);var s=new cc.LabelBMFont(e,o);s.setTag(1),s.setScale(.9),s.setAnchorPoint(.5,.5),i.addChild(s,0),s.setPosition(65,58)}catch(e){}}})},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(6),s=(i(17),function(e){function t(){var e,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var s=arguments.length,r=Array(s),c=0;c<s;c++)r[c]=arguments[c];return i=a=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r))),a.$resGroupList=[ResObjects.getResObject(ResObjectConfig.rankGroupGuide)],a.$prefab=o.Prefabs.NORMAL2,a.$title=!1,a.$width=560,a.$height=290,a.$btns=[],n(a,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),a(t,[{key:"onBtnTouched",value:function(){this.destroy()}},{key:"render",value:function(){var e=new cc.Sprite(res["rank-group-guide-title_png"]);e.setPosition(this.$panelTopRect.center),this.$panel.addChild(e);var t=UIHelper.createButton({normalFile:res["rank-group-guide-bg_png"],position:this.$panelCenterRect.center,bPlistTexture:!1,bTouchEnable:!1,bScale9Enabled:!0,capInsets:cc.rect(23,22,1,1),size:cc.size(500,225)});this.$panel.addChild(t);var i=new cc.LabelTTF("您的当前成绩","Arial",30);i.setAnchorPoint(.5,.5),i.setPosition(cc.pAdd(this.$panelCenterRect.center,cc.p(0,70))),i.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.$panel.addChild(i);var n=new cc.LabelTTF("冒险           关","Arial",50);n.setAnchorPoint(.5,.5),n.setPosition(cc.pAdd(this.$panelCenterRect.center,cc.p(0,5))),n.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.$panel.addChild(n);var a=new cc.LabelBMFont(""+GameUtil.getAllStageDataList().length,res.number_white_big_fnt);a.setScale(1.2),a.setPosition(cc.pAdd(this.$panelCenterRect.center,cc.p(27,10))),this.$panel.addChild(a);var o=new cc.Sprite(res["rank-group-guide-starbg_png"]);o.setPosition(cc.pAdd(this.$panelCenterRect.center,cc.p(0,-75))),this.$panel.addChild(o);var s=new cc.LabelBMFont(""+GameUtil.getAllStarNum(),res.number_gold_big_fnt);s.setPosition(cc.pAdd(this.$panelCenterRect.center,cc.p(20,-75))),this.$panel.addChild(s);var r=UIHelper.createButton({normalFile:res["rank-group-guide-btn_png"],position:this.$panelBottomRect.center,bPlistTexture:!1,bTouchEnable:!0});r.addTouchEventListener(this._onSureBtnTouched,this),this.$panel.addChild(r)}},{key:"_onSureBtnTouched",value:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(XCXSDK.setCustomShareData({title:"本群排行在此，看看你排第几",imageUrl:window.remoteResPath+"res/shareimg2/rank.png",query:"from=groupRank"},function(e){e.shareTickets?wx.showModal({title:"分享成功",content:"请在微信聊天窗口中点击查看群排行",showCancel:!1}):wx.showModal({title:"",content:"要选择分享到微信群才能查看排行榜哦！",showCancel:!1})},function(){}),XCXSDK.customShare(),this.destroy())}}]),t}());e.exports=s},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(7),s=i(16),r=function(e){function t(){var e,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,c=Array(r),l=0;l<r;l++)c[l]=arguments[l];return i=a=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),a.$prefab=o.Prefabs.NORMAL,a.$btns=[new s],n(a,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),a(t,[{key:"onBtnTouched",value:function(e){this.destroy()}}]),t}();e.exports=r},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(8).WindowManager,s=i(12),r=i(13),c=function(e){function t(){var e,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=Array(o),r=0;r<o;r++)s[r]=arguments[r];return i=a=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),a.$$_panel=null,a.$$_timer=null,a.$$_loadingIsShow=!1,a.$$_loadingShowTime=0,a.$$_loadingShowDelay=500,a.$$_loadingMinShowTime=600,a.$actionOut=null,a.$prefab=t.Prefabs.NONE,a.$width=480,a.$height=180,a.$offset=cc.p(0,15),a.$title=!1,a.$btns=[],a.$btnSpace=250,a.$closeBtn=!0,a.$closeStyle=t.CloseBtn.Back,n(a,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),a(t,[{key:"beforeShow",value:function(){}},{key:"beforeDestroy",value:function(){}},{key:"onBtnTouched",value:function(e){}},{key:"$$_beforeShow",value:function(){this.beforeShow(),this.$$_tryShowLoading()}},{key:"$$_beforeDestroy",value:function(){this.beforeDestroy()}},{key:"$$_afterLoadRes",value:function(e){this.$$_tryHideLoading(e)}},{key:"$$_tryShowLoading",value:function(){var e=this;this.$$_timer=setTimeout(function(){e.$$_loadingIsShow=!0,e.$$_loadingShowTime=(new Date).getTime(),NetLoadingWindow.Show()},this.$$_loadingShowDelay)}},{key:"$$_tryHideLoading",value:function(e){var t=this;if(this.$$_loadingIsShow){var i=this.$$_loadingMinShowTime-((new Date).getTime()-this.$$_loadingShowTime);setTimeout(function(){NetLoadingWindow.Destroy(),e.apply(t)},i)}else clearTimeout(this.$$_timer),e.apply(this)}},{key:"$$_beforeRender",value:function(){this.$$_appendPanel(),this.$$_addBtns(),this.$$_addTitle()}},{key:"$$_afterRender",value:function(){this.$$_addBackBtn(),this.$$_addCloseBtn()}},{key:"$$_appendPanel",value:function(){this.$prefab.preRender(this)}},{key:"$$_addBtns",value:function(){var e=this;if(this.$btns instanceof Array){var t=(this.$btns.length-1)/2,i=this.$$_panel;this.$btns.forEach(function(n,a){var o=(a-t)*e.$btnSpace,s=cc.p(i.width/2+o,e.$panelBottomRect.center.y);n.node.setPosition(s),i.addChild(n.node),n.node.addClickEventListener(function(t){var i=t.getUserData(),n=i.tag,a=i.data,o=n.slice(0,1).toUpperCase()+n.slice(1),s=e["onBtn"+o];s&&s.apply(e,[t,n,a]),e.onBtnTouched(t,n,a)},1e3)})}}},{key:"$$_addTitle",value:function(){if(this.$title&&this.$panelTopRect){var e=new cc.LabelTTF(this.$title,"Arial",this.$prefab.topTitleFontSize);e.setAnchorPoint(.5,.5),e.setPosition(this.$panelTopRect.center),e.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),this.$$_panel.addChild(e)}}},{key:"$$_addBackBtn",value:function(){var e=this;if(this.$prefab.btnBack){var t=r.create("dialog_close_btn_back.png");t.setPosition(cc.pAdd(this.$panelTopRect.left,this.$prefab.btnBack)),this.$$_panel.addChild(t),t.addClickEventListener(function(){e.destroy()})}}},{key:"$$_addCloseBtn",value:function(){}},{key:"$$_computeVisibleRect",value:function(e){return!!this.$prefab.bgVisible&&(e.top=cc.pAdd(e.center,cc.p(0,e.height/2)),e.bottom=cc.pAdd(e.center,cc.p(0,-e.height/2)),e.left=cc.pAdd(e.center,cc.p(-e.width/2,0)),e.right=cc.pAdd(e.center,cc.p(e.width/2,0)),e.topLeft=cc.pAdd(e.center,cc.p(-e.width/2,e.height/2)),e.topRight=cc.pAdd(e.center,cc.p(e.width/2,e.height/2)),e.bottomLeft=cc.pAdd(e.center,cc.p(-e.width/2,-e.height/2)),e.bottomRight=cc.pAdd(e.center,cc.p(e.width/2,-e.height/2)),e)}},{key:"$panel",get:function(){return this.$$_panel}},{key:"$panelCenterRect",get:function(){var e=this.$prefab;return this.$$_computeVisibleRect({width:this.$width,height:this.$height,center:cc.p((this.$width+e.marginLeft+e.marginRight)/2,(this.$height+e.marginTop+e.marginBottom)/2+(e.marginBottom-e.marginTop)/2)})}},{key:"$panelTopRect",get:function(){var e=this.$prefab;return this.$$_computeVisibleRect({width:this.$width,height:e.marginTop-e.shadowTop,center:cc.p((this.$width+e.marginLeft+e.marginRight)/2,this.$height+e.marginTop+e.marginBottom-e.marginTop/2-e.shadowTop/2)})}},{key:"$panelBottomRect",get:function(){var e=this.$prefab;return this.$$_computeVisibleRect({width:this.$width,height:e.marginBottom-e.shadowBottom,center:cc.p((this.$width+e.marginLeft+e.marginRight)/2,e.marginBottom/2+e.shadowBottom/2)})}}]),t}();c.Prefabs=s,c.CloseBtn={X:"x",Back:"back"},e.exports=c},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(9).EventManager,s=i(10),r=s.ActionsIn,c=s.ActionsOut,l=i(11),h=t.WindowManager=function(e){function t(){var e,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=Array(o),c=0;c<o;c++)s[c]=arguments[c];return i=a=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),a.$$_cls=null,a.$$_root=null,a.$$_node=null,a.$$_view=null,a.$$_args=[],a.$$_resGroupListDefault=[ResObjects.getResObject(ResObjectConfig.dialog)],a.$root=null,a.$resGroupList=[],a.$bgOpacity=180,a.$zOrder=GameCommonDef.LAYER_Z_ORDER_POP_UP,a.$swallowTouches=!0,a.$touchEnable=!0,a.$actionIn=r.ScaleEaseElasticOut,n(a,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),a(t,[{key:"show",value:function(){for(var e=this,t=arguments.length,i=Array(t),n=0;n<t;n++)i[n]=arguments[n];this.$$_args=i,!1!==this.$$_beforeShow()&&(this.$$_initRoot(),this.$$_beforeLoadResGroup(),this.$$_loadResGroupList(function(){e.$$_initView(),e.$$_beforeRender(),e.render(),e.$$_afterRender(),e.$$_addToRoot(),e.$$_bindEvent(),e.$$_runActionIn(),e.listen(EventID.DESTROY_ALL_WINDOW,function(){e.destroy()})}))}},{key:"refresh",value:function(){}},{key:"destroy",value:function(){this.$$_cls.destroy()}},{key:"async",value:function(e){e()}},{key:"render",value:function(){}},{key:"onTouchBegan",value:function(){}},{key:"onTouchEnded",value:function(){}},{key:"afterActionIn",value:function(){}},{key:"$$_destroy",value:function(){try{this.$$_beforeDestroy(),this.$$_unListenAll(),this.$$_node.removeFromParent(!0)}catch(e){}}},{key:"$$_beforeLoadResGroup",value:function(){}},{key:"$$_beforeShow",value:function(){}},{key:"$$_beforeDestroy",value:function(){}},{key:"$$_afterLoadRes",value:function(e){e()}},{key:"$$_initRoot",value:function(){this.$root?this.$$_root=this.$root:this.$$_root=cc.director.getRunningScene()}},{key:"$$_loadResGroupList",value:function(e){var t=this;l.parallel({res:function(e){var i=t.$$_resGroupListDefault.concat(t.$resGroupList);l.each(i,function(e,t){ResLoader.silenceLoadRes(e,function(e){t()},function(){t("timeout")})},function(t){e(t)})},async:function(e){t.async(e)}},function(i){i?NetworkRetryWindow.Show(Language.getString(LanguageKey.NET_ERROR),function(){t.$$_loadResGroupList(e)},function(){NetLoadingWindow.Hide(),t.destroy()}):t.$$_afterLoadRes(e)})}},{key:"$$_initView",value:function(){var e=cc.visibleRect;this.$$_node=new cc.Layer;var t=new cc.Sprite(res.mask_png);t.setPosition(e.center),t.setScaleX(e.width/4),t.setScaleY(e.height/4),t.opacity=this.$bgOpacity,this.$$_node.addChild(t),this.$$_view=new cc.Layer,this.$$_view.setCascadeColorEnabled(!0),this.$$_view.setCascadeOpacityEnabled(!0),this.$$_node.addChild(this.$$_view)}},{key:"$$_beforeRender",value:function(){}},{key:"$$_afterRender",value:function(){}},{key:"$$_addToRoot",value:function(){this.$$_root.addChild(this.$$_node,this.$zOrder)}},{key:"$$_bindEvent",value:function(){cc.eventManager.addListener({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:this.$swallowTouches,onTouchBegan:this.$$_onTouchBgBegan.bind(this),onTouchEnded:this.$$_onTouchEnded.bind(this)},this.$$_node)}},{key:"$$_onTouchBgBegan",value:function(){return this.$touchEnable&&this.onTouchBegan.apply(this),!0}},{key:"$$_onTouchEnded",value:function(){return this.$touchEnable&&this.onTouchEnded.apply(this),!0}},{key:"$$_runActionIn",value:function(){var e=this;this.$actionIn&&this.$actionIn.apply(r,[this.$$_view,function(){e.afterActionIn()}])}},{key:"$args",get:function(){return this.$$_args}},{key:"$view",get:function(){return this.$$_view}}],[{key:"show",value:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];this.$$_instance?this.$$_instance.refresh.apply(this.$$_instance,t):(this.$$_instance=new this,this.$$_instance.$$_cls=this,this.$$_instance.show.apply(this.$$_instance,t))}},{key:"destroy",value:function(){this.$$_instance&&(this.$$_instance.$$_destroy(),this.$$_instance=null)}}]),t}();h.ActionsIn=r,h.ActionsOut=c},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();t.EventManager=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.$$_eventList=[]}return i(e,[{key:"listen",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this,n=function(){for(var e=arguments.length,n=Array(e),a=0;a<e;a++)n[a]=arguments[a];t.apply(i,n)};eventDispatcher.addListener(e,n),this.$$_eventList.push({name:e,callback:t,factFunc:n})}},{key:"unlisten",value:function(e,t){for(var i=0;i<this.$$_eventList.length;i++){var n=this.$$_eventList[i];t?n.name==e&&n.callback==t&&eventDispatcher.removeListener(e,n.factFunc):n.name==e&&eventDispatcher.removeListener(e,n.factFunc)}}},{key:"$$_unListenAll",value:function(){for(;this.$$_eventList.length;){var e=this.$$_eventList.pop();eventDispatcher.removeListener(e.name,e.factFunc)}}}]),e}()},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionsIn={ScaleEaseElasticOut:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};e.setScale(.9);var i=cc.scaleTo(1,1).easing(cc.easeElasticOut(.25));e.runAction(cc.sequence(i,cc.callFunc(function(){t()})))}},t.ActionsOut={QuickScaleOut:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};e.runAction(cc.sequence(cc.scaleTo(1.2,0),cc.callFunc(function(){t()})))}}},function(e,t,i){var n,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){"use strict";function i(){}function o(e){return Array.isArray(e)&&e.length>0}function s(e){var t=!1;return function(){t||(t=!0,e.apply(c,arguments))}}function r(e){var t=!1;return function(){t||(t=!0,e.apply(this,arguments))}}var c;c="object"==("undefined"==typeof window?"undefined":a(window))&&this===window?window:"object"==("undefined"==typeof global?"undefined":a(global))&&this===global?global:this;var l=Object.keys,h={each:function(e,t,n){n=r(n||i);var a=e.length;if(!o(e))return n();var c=0;!function(e,t){var i,n=e.length;for(i=0;i<n;i++)t(e[i])}(e,function(e){t(e,s(function(e){e?(n(e),n=i):++c>=a&&n(null)}))})},eachSeries:function(e,t,n){n=r(n||i);var a=e.length;if(!o(e))return n();var c=0;!function o(){t(e[c],s(function(e){e?(n(e),n=i):++c<a?o():n(null)}))}()},parallel:function(e,t){var i,n,s,r,c,h=[],u=0;if(o(e))n=e.length,r=[];else{if(!("object"===(void 0===(d=e)?"undefined":a(d))&&l(d).length>0))return t();c=!0,i=l(e),n=i.length,r={}}var d;for(s=0;s<n;s++)c?h.push({k:i[s],t:e[i[s]]}):h.push({k:s,t:e[s]});h.forEach(function(e){e.t(function(i,a){return i?t(i):(r[e.k]=a,void(++u==n&&t(null,r)))})})},series:function(e,t){function i(o){e[o](function(e,s){return e?t(e):(a[o]=s,o<n-1?i(o+1):t(null,a))})}if(!o(e))return t();var n=e.length,a=[];i(0)}};void 0!==e&&e.exports?e.exports=h:void 0===(n=function(){return h}.apply(t,[]))||(e.exports=n)}()},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),n=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.bgVisible=!0,this.bgTex=!1,this.capInsets=cc.rect(0,0,1,1),this.marginLeft=7,this.marginRight=7,this.marginTop=0,this.marginBottom=0,this.shadowTop=0,this.shadowBottom=0,this.topTitleFontSize=34,this.btnBack=!1;for(var i in t)this[i]=t[i]}return i(e,[{key:"preRender",value:function(e){this.bgVisible&&(e.$panelCenterRect.width,e.$$_panel=UIHelper.createImage({imageFileName:this.bgTex,bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(e.$width+this.marginLeft+this.marginRight,e.$height+this.marginTop+this.marginBottom),capInsets:this.capInsets,position:cc.pAdd(cc.visibleRect.center,e.$offset)}),e.$$_view.addChild(e.$$_panel))}}]),e}();t.NONE=new n({bgVisible:!1}),t.NORMAL=new n({bgTex:"dialog_panel_bg_0.png",capInsets:cc.rect(44,80,1,1),marginTop:69,marginBottom:104,shadowTop:6,shadowBottom:5}),t.NORMAL2=new n({bgTex:"dialog_panel_bg_0.png",capInsets:cc.rect(44,80,1,1),marginTop:69,marginBottom:104,shadowTop:6,shadowBottom:5,btnBack:cc.p(38,18)}),t.SIMPLE1=new n({bgTex:"dialog_panel_bg_1.png",capInsets:cc.rect(42,80,1,1),marginTop:68,marginBottom:6,shadowTop:6,shadowBottom:6}),t.SIMPLE2=new n({bgTex:"dialog_panel_bg_2.png",capInsets:cc.rect(44,80,1,1),marginTop:76,marginBottom:6,shadowTop:6,shadowBottom:6,topTitleFontSize:36,btnBack:cc.p(32,8)}),t.SIMPLE3=new n({bgTex:"dialog_panel_bg_3.png",capInsets:cc.rect(44,119,1,1),marginTop:114,marginBottom:6,shadowTop:6,shadowBottom:6,topTitleFontSize:40})},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=i(14).Base,o=function(e){function t(){var e,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=Array(o),r=0;r<o;r++)s[r]=arguments[r];return i=a=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),a.texture="",a.label=!1,a.tag="unknow",a.touchEnable=!0,n(a,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),t}();e.exports=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(15);(t.Base=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.texture=null,this.label=null,this.labelOffset=cc.p(0,0),this.tag="unknowName",this.data=null,this.touchEnable=!0,this.$$_opts={},this.$$_node=!1,"string"==(void 0===t?"undefined":n(t)).toLowerCase()&&(t={texture:t}),this.$$_opts=t}return a(e,[{key:"node",get:function(){return this.$$_node||(this.$$_init(),this.beforeShow(),this.$$_node=this.$$_getNode()),this.$$_node}},{key:"position",set:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];this.node.setPosition.apply(this.node,t)}},{key:"parent",set:function(e){e.addChild(this.node)}}],[{key:"create",value:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return(new(Function.prototype.bind.apply(this,[null].concat(t)))).node}}]),a(e,[{key:"$$_init",value:function(){for(var e in this.$$_opts)this[e]=this.$$_opts[e]}},{key:"beforeShow",value:function(){}},{key:"addChild",value:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];this.node.addChild.apply(this.node,t)}},{key:"$$_getNode",value:function(){var e=UIHelper.createButton({normalFile:this.texture,bPlistTexture:!0,bTouchEnable:!0});if(e.setUserData({tag:this.tag,data:this.data}),this.label){var t=this.$$_findTex(),i=void 0;i=t?new cc.Sprite(t):new cc.LabelTTF(this.label,"Arial",32);var n=cc.p(e.width/2,e.height/2);i.setPosition(cc.pAdd(n,this.labelOffset)),e.addChild(i)}return e}},{key:"$$_findTex",value:function(){var e=o[this.label];return!!e&&"#dialog_txt_"+e+".png"}}]),e}()).Color={Red:"red",Green:"green"}},function(e,t){"use strict";e.exports={"知道了":"isee","确定":"sure","重试":"retry","取消":"cancel","领取":"accept","分享游戏":"share","告诉TA":"tellta","拒收":"reject"}},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(14).Base,s=function(e){function t(){var e,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=Array(o),r=0;r<o;r++)s[r]=arguments[r];return i=a=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),a.texture="dialog_red_btn_m.png",a.label="知道了",a.labelOffset=cc.p(0,7),a.tag="ok",a.touchEnable=!0,a.color=t.Color.Red,n(a,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),a(t,[{key:"beforeShow",value:function(){this.texture="dialog_"+this.color+"_btn_m.png"}}]),t}();e.exports=s},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(14).Base,s=function(e){function t(){var e,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=Array(o),r=0;r<o;r++)s[r]=arguments[r];return i=a=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),a.texture="dialog_red_btn_lr.png",a.label="知道了",a.labelOffset=cc.p(0,7),a.tag="ok",a.touchEnable=!0,a.color=t.Color.Red,n(a,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),a(t,[{key:"beforeShow",value:function(){this.texture="dialog_"+this.color+"_btn_lr.png"}}]),t}();e.exports=s},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(19),s=(i(20),null),r=function(e){function t(){var e,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=Array(o),r=0;r<o;r++)s[r]=arguments[r];return i=a=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),a.$resGroupList=[ResObjects.getResObject(ResObjectConfig.PKRank)],a.buyBtn=null,a.noMoreBtn=null,a.dontShow=!0,n(a,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),a(t,[{key:"beforeShow",value:function(){s=this.$args[0]}},{key:"render",value:function(){var e=this.$view,t=new cc.Sprite("#pkrank-guide-bg.png");t.setPosition(cc.visibleRect.center),e.addChild(t);var i=this.buyBtn=UIHelper.createButton({normalFile:"pkrank-buide-btn-fight.png",position:cc.p(t.width/2,120),bPlistTexture:!0,bTouchEnable:!0});i.addTouchEventListener(this._onBtnTouched,this),t.addChild(i);var n=UIHelper.createButton({normalFile:"btn_back_N.png",position:cc.p(34,t.height-12),bPlistTexture:!0,bTouchEnable:!0});n.addTouchEventListener(this._onCloseBtnTouched,this),t.addChild(n);var a=UIHelper.createButton({normalFile:"pkrank-guide-checkbox-bg.png",anchorPoint:cc.p(1,.5),position:cc.p(.43*t.width,40),bPlistTexture:!0,bTouchEnable:!0});a.addTouchEventListener(this._onNoMoreTouched,this),t.addChild(a);var o=this.noMoreBtn=UIHelper.createButton({normalFile:"pkrank-guide-checkbox.png",anchorPoint:cc.p(1,.5),position:cc.p(.43*t.width,40),bPlistTexture:!0,bTouchEnable:!1});t.addChild(o);var s=UIHelper.createButton({normalFile:"pkrank-guide-label.png",anchorPoint:cc.p(0,.5),position:cc.p(.44*t.width,40),bPlistTexture:!0,bTouchEnable:!0});s.addTouchEventListener(this._onNoMoreTouched,this),t.addChild(s)}},{key:"_onBtnTouched",value:function(e,t){ccui.Widget.TOUCH_ENDED==t&&s&&(this.dontShow&&wx.setStorageSync("pkrank_show","1"),this.destroy(),s())}},{key:"_onNoMoreTouched",value:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(this.dontShow=!this.dontShow,this.noMoreBtn.setVisible(this.dontShow))}},{key:"_onCloseBtnTouched",value:function(e,t){ccui.Widget.TOUCH_ENDED==t&&this.destroy()}}]),t}();e.exports=r},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=i(7),o=function(e){function t(){var e,i,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var s=arguments.length,r=Array(s),c=0;c<s;c++)r[c]=arguments[c];return i=o=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r))),o.$prefab=a.Prefabs.NONE,n(o,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),t}();e.exports=o},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(7),s=i(16),r=function(e){function t(){var e,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,c=Array(r),l=0;l<r;l++)c[l]=arguments[l];return i=a=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),a.$prefab=o.Prefabs.NORMAL,a.$btns=[new s],a.$txt="",a.$okCallback=function(){},n(a,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),a(t,[{key:"beforeShow",value:function(){this.$txt=this.$args[0],this.$okCallback=this.$args[1]||function(){}}},{key:"onBtnTouched",value:function(e){this.$okCallback(),this.destroy()}},{key:"render",value:function(){var e=UIHelper.createText({position:cc.p(this.$panel.width/2,.55*this.$panel.height),fontSize:28,fontColor:cc.color(255,255,255),content:this.$txt,bIgnoreSize:!1});this.$panel.addChild(e),UIHelper.subsectionTextForUIText(e,this.$txt,450)}}]),t}();e.exports=r},function(e,t){"use strict";var i,n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=cc.Sprite.extend({_hp:null,_mp:null,ctor:function(e){this._super(i,e)},unuse:function(){this.retain(),this.removeFromParent()},reuse:function(e){i.initWithElement(sharedCanvas),i.handleLoadedTexture(),this.initWithTexture(i,e)}}),o=function(){function e(t,i){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),wx.postMessage({req:"FRIENDS_HEAD_CLEAR"}),this.step=0,this.initAllHeadTexture()}return n(e,[{key:"initAllHeadTexture",value:function(){i=new cc.Texture2D,this.updateAllHeadTexture(),this.scheduleUpdate()}},{key:"scheduleUpdate",value:function(){var e=this;requestAnimationFrame(function(){0==e.step%window.subUpdateRate.FRIEND&&e.updateAllHeadTexture(),e.step++,e.step<600&&e.scheduleUpdate()})}},{key:"updateAllHeadTexture",value:function(){i.initWithElement(sharedCanvas),i.handleLoadedTexture(),this.testTex&&this.DEBUG&&(this.testTex.initWithElement(sharedCanvas),this.testTex.handleLoadedTexture())}},{key:"getUserHead",value:function(){var e=subRectMap("USER_HEAD"),t={req:"USER_HEAD",data:{openId:NetData.user_info.openid},rect:e};return console.log("wx.postMessage = USER_HEAD"),wx.postMessage(t),this.getFriendHead(e)}},{key:"getFriendHead",value:function(e){return cc.pool.hasObject(a)?(console.log("====from cache"),cc.pool.getFromPool(a,e)):(console.log("====from new create"),new a(e))}},{key:"showFriend",value:function(e){}},{key:"hideFriend",value:function(e){}},{key:"noticeSubField",value:function(e){var t=e%36,i={req:"FRIENDS_HEAD",data:{id:e,userInfo:NetData.user_info,staticsNtf:NetData.statics_ntf},rect:subRectMap("MyFriendHead",t)};return wx.postMessage(i),i.rect}},{key:"clear",value:function(){}}]),e}();e.exports=o},function(e,t,i){"use strict";i(23)},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=(i(24),i(26),i(29)),o=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.parent=t,this.init()}return n(e,[{key:"init",value:function(){var e=this,t=0;if(!Service.Util.getClient().isIOS){[a].forEach(function(i){var n=new i(e.parent);n.isValid()&&(n.index=t++,n.render())})}}}]),e}();window.MenuGroupLT=o},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(25).computeYPos,o=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.index=0,this.parent=t}return n(e,[{key:"isValid",value:function(){return!0}},{key:"render",value:function(){var e=UIHelper.createButton({normalFile:"jlq.png",anchorPoint:cc.p(0,.5),bPlistTexture:!0,bTouchEnable:!0});e.setPosition(10,a(this.index)),e.addTouchEventListener(this._onBtnTouched,this),this.parent.addChild(e,1)}},{key:"_onBtnTouched",value:function(e,t){if(ccui.Widget.TOUCH_ENDED==t){var i="";i=X8SDK.isWX()?"https://game.weixin.qq.com/cgi-bin/h5/static/group/index.html?appid=wx4b05dce3b041cd62&group=2":"https://youxi.vip.qq.com/m/act/a83fbf4a42_ldt3_203190.html?_wv=1&_wwv=4",X8SDK.openUrlWithExtraWebview({url:i})}}}]),e}();e.exports=o},function(e,t){"use strict";t.computeYPos=function(e){return cc.winSize.height-(200+110*e)}},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(25).computeYPos,o=i(27),s=i(28),r=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.index=0,this.parent=t,this.locStorageKey=Util.getBaseStorageKey(!0)+"desktop"}return n(e,[{key:"isValid",value:function(){return this.listenTaskOper(),this.btnName="btn_guide_entry.png",!0}},{key:"render",value:function(){var e=this.btn=UIHelper.createButton({normalFile:this.btnName,anchorPoint:cc.p(0,.5),bPlistTexture:!0,bTouchEnable:!0});e.setPosition(10,a(this.index)),e.addTouchEventListener(this.onBtnTouched,this),this.parent.addChild(e,1),this.checkReddot()}},{key:"onBtnTouched",value:function(e,t){ccui.Widget.TOUCH_ENDED==t&&this.showGuideDesktopWindow()}},{key:"showGuideDesktopWindow",value:function(){var e=this;o.show(function(){e.removeReddot()})}},{key:"checkReddot",value:function(){if(!wx.getStorageSync(this.locStorageKey)){var e=this.redPot=new cc.Sprite;e.initWithSpriteFrameName("m_red_pot.png"),e.setPosition(96,96),e.setScale(.8),this.btn.addChild(e)}}},{key:"removeReddot",value:function(){wx.setStorageSync(this.locStorageKey,1),this.redPot&&this.redPot.removeFromParent()}},{key:"listenTaskOper",value:function(){var e=eventDispatcher.addListener(EventID.STICKY_CALLBACK,function(){s.isDone()||wx.setTopBarText({text:"爱消除乐园: 任务完成，点击领取奖励"}),s.set("isDone.fav",1),setTimeout(function(){eventDispatcher.removeListener(EventID.STICKY_CALLBACK,e)},0)})}},{key:"showBtn",value:function(e,t,i){this.listenTaskOper(),this.btnName="btn_guide_entry.png";var n=this.btn=UIHelper.createButton({normalFile:this.btnName,anchorPoint:i,bPlistTexture:!0,bTouchEnable:!0});n.setPosition(t),n.addTouchEventListener(this.onBtnTouched,this),e.addChild(n,1),this.checkReddot()}}]),e}();window.GuideSticky=r,e.exports=r},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(6),s=i(20),r=cc.p(0,0),c=cc.p(0,1),l=i(28),h=function(e){function t(){var e,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=Array(o),r=0;r<o;r++)s[r]=arguments[r];return i=a=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),a.$resGroupList=[ResObjects.getResObject(ResObjectConfig.guideDesktop)],a.$width=580,a.$title="游戏入口添加引导",n(a,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),a(t,[{key:"beforeShow",value:function(){this.$height=465,this.contentWidth=550,this.contentHeight=this.$height-20,this.callback=this.$args&&this.$args[0],this.listener={};var e=wx.getStorageSync(l.cacheKey);e&&(l.data=JSON.parse(e))}},{key:"async",value:function(e){var t=this;cc.loader.load(res.EntranceGuideRewardPool_json,function(i,n){try{var a=n[0].list_data[0].reward_list;t.conf=a,e()}catch(e){t.conf=[{article_type:1,article_subtype:2,article_id:0,article_count:100,probability:100,article_ext1:"0",article_ext2:"0"},{article_type:1,article_subtype:3,article_id:0,article_count:8888,probability:100,article_ext1:"0",article_ext2:"0"},{article_type:1,article_subtype:4,article_id:11,article_count:5,probability:100,article_ext1:"0",article_ext2:"0"},{article_type:0,article_subtype:0,article_id:0,article_count:0,probability:0,article_ext1:"0",article_ext2:"0"},{article_type:0,article_subtype:0,article_id:0,article_count:0,probability:0,article_ext1:"0",article_ext2:"0"}]}})}},{key:"render",value:function(){var e=this.$panel,t=this.contentWidth,i=this.contentHeight,n=this.wrapper=UIHelper.createPanel({position:this.$panelCenterRect.center,anchorPoint:cc.p(.5,.5),size:cc.size(t,i)});this.showDeskGuide?this.renderContent(0):this.renderContent(1),e.addChild(n)}},{key:"renderContent",value:function(e){var t=this.contentHeight;0===e?(this.renderItem({id:1,x:0,y:t-10}),this.renderItem({id:2,x:0,y:t-260})):this.renderItem({id:2,x:0,y:t-10}),this.renderReward({x:0,y:185}),this.registerTaskCallback(e)}},{key:"renderItem",value:function(e){var t=this,i=e.id,n="gd-tt-"+i+".png",a=1===i?["gd-key1.png","gd-key2.png"]:["gd-key1.png","gd-key2.png","gd-key3.png"],o=this.contentWidth,s=(this.contentHeight,UIHelper.createPanel({position:cc.p(e.x,e.y),anchorPoint:c,size:cc.size(o,240)})),l=UIHelper.createImage({imageFileName:n,bPlistTexture:!0,position:cc.p(10,235),anchorPoint:c}),h=UIHelper.createImage({imageFileName:"gd-item-bg.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(o,201),capInsets:cc.rect(10,0,17,201),position:r,anchorPoint:r}),u=UIHelper.createImage({imageFileName:a[0],bPlistTexture:!0,position:cc.p(2,4),anchorPoint:r}),d=UIHelper.createImage({imageFileName:"gd-txt-undo.png",bPlistTexture:!0,position:cc.p(400,100),anchorPoint:r}),p=UIHelper.createButton({normalFile:"gd-btn-square.png",bPlistTexture:!0,anchorPoint:r,position:cc.p(365,15),bTouchEnable:!0}),f=UIHelper.createImage({imageFileName:"gd-txt-next.png",bPlistTexture:!0,anchorPoint:cc.p(.5,.5),position:cc.p(85.5,44)}),_=UIHelper.createButton({normalFile:"gd-btn-square.png",bPlistTexture:!0,anchorPoint:r,position:cc.p(365,15),bTouchEnable:!0});_.setVisible(!1);var g=UIHelper.createImage({imageFileName:"gd-txt-return.png",bPlistTexture:!0,anchorPoint:cc.p(.5,.5),position:cc.p(85.5,44)});p.addChild(f),_.addChild(g),p.addClickEventListener(function(e){t._onBtnNextTouched(p,_,u,i,a)}),_.addClickEventListener(function(e){t._onBtnReturnTouched(p,_,u,i,a)}),h.addChild(u),h.addChild(d),h.addChild(p),h.addChild(_),s.addChild(l),s.addChild(h),this.wrapper.addChild(s);var b=function(){d.loadTexture("gd-txt-done.png",ccui.Widget.PLIST_TEXTURE)};1==i?this.taskDone_desktop=b:2==i&&(this.taskDone_fav=b)}},{key:"_onBtnNextTouched",value:function(e,t,i,n,a){var o="index_"+n;void 0==this[o]&&(this[o]=0),a.length>this[o]+1&&(this[o]++,i.loadTexture(a[this[o]],ccui.Widget.PLIST_TEXTURE),this[o]+1>=a.length&&(e.setVisible(!1),t.setVisible(!0)))}},{key:"_onBtnReturnTouched",value:function(e,t,i,n,a){var o="index_"+n;this[o]=0,i.loadTexture(a[this[o]],ccui.Widget.PLIST_TEXTURE),e.setVisible(!0),t.setVisible(!1)}},{key:"renderReward",value:function(e){for(var t,i=this,n=this.contentWidth,a=UIHelper.createPanel({position:cc.p(e.x,e.y),anchorPoint:c,size:cc.size(n,180)}),o=UIHelper.createImage({imageFileName:"gd-tt-3.png",bPlistTexture:!0,position:cc.p(10,175),anchorPoint:c}),s=UIHelper.createImage({imageFileName:"gd-reward-bg.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(n,140),capInsets:cc.rect(3,4,40,30),position:r,anchorPoint:r}),l=UIHelper.createPanel({position:cc.p(20,25),anchorPoint:r,size:cc.size(270,90)}),h=this.conf,u=0;(t=h[u])&&(0!=t.article_type||0!=t.article_subtype||0!=t.article_id);u++){var d=this.createGrid(t,u);l.addChild(d)}var p=UIHelper.createButton({normalFile:"gd-btn-receive-disabled.png",bPlistTexture:!0,anchorPoint:cc.p(1,0),position:cc.p(n-15,30),bTouchEnable:!1}),f=UIHelper.createButton({normalFile:"gd-btn-receive.png",bPlistTexture:!0,anchorPoint:cc.p(1,0),position:cc.p(n-15,30),bTouchEnable:!0});f.setVisible(!1),f.addClickEventListener(function(e){i._onBtnReceiveTouched(),i.changeReceiveBtn(0)}),this.changeReceiveBtn=function(e){1==e?(f.setVisible(!0),p.setVisible(!1)):(f.setVisible(!1),p.setVisible(!0))},s.addChild(l),s.addChild(p),s.addChild(f),a.addChild(o),a.addChild(s),this.wrapper.addChild(a)}},{key:"_onBtnReceiveTouched",value:function(){var e=this;NetLoadingWindow.Show(),GameService.entranceGuideReport(function(t,i){t?-1601==t.ret?(NetLoadingWindow.Hide(),l.set("receive",1),e.destroy(),s.show(t.ret_desc),wx.setTopBarText({text:"爱消除乐园"}),e.callback&&e.callback()):(NetLoadingWindow.Hide(),s.show(t.ret_desc)):(NetLoadingWindow.Hide(),l.set("receive",1),e.destroy(),s.show("领取成功!"),wx.setTopBarText({text:"爱消除乐园"}),e.callback&&e.callback())})}},{key:"createGrid",value:function(e,t){var i=UIHelper.createImage({imageFileName:"gd-reward-grid.png",bPlistTexture:!0,size:cc.size(86,86),position:cc.p(100*t,0),anchorPoint:r}),n=GameUtil.getGoodsImageById(e.article_type,e.article_subtype,e.article_id),a=UIHelper.createImage({imageFileName:n,bPlistTexture:!0,anchorPoint:cc.p(.5,.5),position:cc.p(43,43)});a.setScale(.8);var o=UIHelper.createImage({imageFileName:"gd-grid-mask.png",bPlistTexture:!0,anchorPoint:r,position:cc.p(7,9)}),s=UIHelper.createText({fontSize:18,fontName:"Microsoft YaHei",content:"x"+e.article_count,position:cc.p(36,20),anchorPoint:cc.p(.5,1),fontColor:cc.color(255,255,255)});return o.addChild(s),i.addChild(a),i.addChild(o),i}},{key:"checkIsDone",value:function(){var e=!0,t=l.data;for(var i in t.isDone)t.isDone[i]?this["taskDone_"+i]&&this["taskDone_"+i]():e=!1;e&&!t.receive&&this.changeReceiveBtn&&this.changeReceiveBtn(1)}},{key:"registerTaskCallback",value:function(e){var t=this,i=l.data;1===e&&void 0!==i.isDone.desktop&&delete i.isDone.desktop,this.listener.fav=eventDispatcher.addListener(EventID.STICKY_CALLBACK,function(){t.checkIsDone()}),this.listener.desktop=eventDispatcher.addListener(EventID.SENDDESKTOPCALLBACK,function(){t.checkIsDone()}),this.checkIsDone()}},{key:"beforeDestroy",value:function(){eventDispatcher.removeListener(EventID.SHARECALLBACK,this.listener.fav),eventDispatcher.removeListener(EventID.SENDDESKTOPCALLBACK,this.listener.desktop),this.listener={}}}]),t}();e.exports=h},function(e,t){"use strict";var i={cacheKey:Util.getBaseStorageKey(!0)+"desktopData",data:{isDone:{desktop:0,fav:0},receive:0},set:function(e,t){var n=e.split(".");n.length>1?this.data[n[0]][n[1]]=t:this.data[e]=t,wx.setStorageSync(this.cacheKey,JSON.stringify(i.data))},isDone:function(){var e=wx.getStorageSync(this.cacheKey)||'{"receive":0}';return JSON.parse(e).receive}};e.exports=i},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=(i(11),i(25)).computeYPos,o=i(30),s=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.index=0,this.parent=t}return n(e,[{key:"isValid",value:function(){try{return!window.NetData.oneyuan_buy_time.low&&!window.hide1yuan}catch(e){return!1}}},{key:"render",value:function(){var e=UIHelper.createButton({normalFile:"btn_one_buy.png",anchorPoint:cc.p(0,.5),bPlistTexture:!0,bTouchEnable:!0});e.setPosition(10,a(this.index)),e.addTouchEventListener(this.onBtnTouched,this),this.parent.addChild(e,1)}},{key:"onBtnTouched",value:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(o.show(),o.$$_instance.setOuterBtn(e))}}]),e}();e.exports=s},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(19),s=i(20),r=!1,c=function(e){function t(){var e,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=Array(o),r=0;r<o;r++)s[r]=arguments[r];return i=a=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),a.$resGroupList=[ResObjects.getResObject(ResObjectConfig.yuan1)],a.conf=null,a.buyBtn=null,a.outerBtn=null,n(a,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),a(t,[{key:"beforeShow",value:function(){this.conf=this.$args[0]}},{key:"async",value:function(e){var t=this;cc.loader.load(res.OneyuanRewardPool_bin_json,function(i,n){try{var a=n[0].list_data[0];t.conf=a,e()}catch(e){s.show("资源加载出现错误!")}})}},{key:"render",value:function(){var e=this.$view,t=new cc.Sprite("#yuan1_bg.png");t.setPosition(cc.visibleRect.center),e.addChild(t);var i=this.buyBtn=UIHelper.createButton({normalFile:"yuan1_btn.png",position:cc.p(t.width/2,105),bPlistTexture:!0,bTouchEnable:!0});i.addTouchEventListener(this._onBtnTouched,this),t.addChild(i);var n=UIHelper.createButton({normalFile:"btn_back_N.png",position:cc.p(34,t.height-12),bPlistTexture:!0,bTouchEnable:!0});n.addTouchEventListener(this._onCloseBtnTouched,this),t.addChild(n);for(var a=0;a<this.conf.reward_cnt;a++){var o=this.conf.reward_list[a],s=GameUtil.getGoodsImageById(o.article_type,o.article_subtype,o.article_id);if(s){var r=new cc.Sprite("#"+s);r.setPosition(this.getRewardIconPos(a)),t.addChild(r);var c=new cc.LabelBMFont("X"+o.article_count,res.number_white_fnt);c.setScaleX(.65),c.setScaleY(.7),c.setPosition(this.getRewardNumberPos(a)),t.addChild(c)}}this.resetBuyBtn()}},{key:"resetBuyBtn",value:function(){r&&this.buyBtn.setColor(cc.color(80,80,80,255))}},{key:"getRewardIconPos",value:function(e){var t=87+144*e;return cc.p(t,296)}},{key:"getRewardNumberPos",value:function(e){var t=this.getRewardIconPos(e);return cc.pAdd(t,cc.p(0,-65))}},{key:"pay",value:function(){var e=this;Midas.recharge({count:10,onSuccess:function(){r=!0,e.destroy(),e.hideOuterBtn(),NetLoadingWindow.Show();GameService.buyDiamondReport({buy_diamond_num:0,cost_rmb_num:0},function(e,t){console.warn(e,t),e?(NetLoadingWindow.Destroy(),console.log("err code: "+e.ret),s.show("上报钻石购买失败("+e.ret_desc+")")):(MusicManager.playEffect(MusicEffectFiles.Audio_UI_buydiamond),GameService.reportOneYuanBuy({},function(e,t){NetLoadingWindow.Destroy(),e?s.show("购买成功！由于网络原因，奖励将会稍晚发放。"):s.show("购买成功！感谢您的支持。");var i={type:MailType.MAIL_TYPE_ALL};GameService.getMailList(i,function(e,t){e?console.log("onReqMailList: err code: "+e.ret):console.log("onReqMailList response OK")})}))})},onClose:function(){}})}},{key:"_onBtnTouched",value:function(e,t){if(ccui.Widget.TOUCH_ENDED==t){if(r)return;this.pay()}}},{key:"_onCloseBtnTouched",value:function(e,t){ccui.Widget.TOUCH_ENDED==t&&this.destroy()}},{key:"setOuterBtn",value:function(e){this.outerBtn=e}},{key:"hideOuterBtn",value:function(){this.outerBtn&&this.outerBtn.setVisible(!1),window.hide1yuan=!0}}]),t}();e.exports=c},function(e,t,i){"use strict";var n=i(32);window.ShareForGift=new n},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(33),o=i(34),s=i(20),r=i(35),c=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this._data=null,this._listenerList=[],this._key="_sharegift_today_take_award_num",this._config=null}return n(e,[{key:"listen",value:function(){this.setRedDotData(),eventDispatcher.addListener(EventID.SHARE_INFO_NTF,this.setRedDotData.bind(this))}},{key:"inTimeRange",value:function(){if(!X8SDK.isQQ()&&!X8SDK.isWX())return!1;var e=this._config;return!!e&&(0==e.begin_time||0==e.end_time||Time.todayInTime(e.begin_time,e.end_time))}},{key:"isShowTimeRange",value:function(){var e=this._config;return 0!=e.begin_time&&0!=e.end_time}},{key:"loadConfig",value:function(){var e=this;console.warn("loadConfig"),o(function(t){e._config=t,eventDispatcher.dispatchEvent(EventID.ON_SHARE_GIFT_CONFIG)},function(){})}},{key:"onTouched",value:function(){this.hasRedDot()?this.showReceiveAwardWindow():a.show()}},{key:"showReceiveAwardWindow",value:function(){var e=this,t="钻石 "+e._data.available_award_num+" 个";r.show("分享奖励",t,"prop_diamond.png",function(){NetLoadingWindow.Show(),GameService.takeShareAward({award_num:e._data.available_award_num},function(t,i){NetLoadingWindow.Destroy(),t?s.show(t.ret_desc+"("+t.ret+")",function(){a.show()}):(e._data.today_take_award_num+=0+e._data.available_award_num,e._data.available_award_num=0,FrameController.GetInstance().getCurPage().initShareForGiftRedDot(),a.show())})})}},{key:"setRedDotData",value:function(){NetData&&void 0!==NetData.share_info_ntf.available_award_num&&(this._data=NetData.share_info_ntf,this._config||this.loadConfig())}},{key:"hasRedDot",value:function(){return(this._data&&this._data.available_award_num)>0}},{key:"getAwardNum",value:function(){var e=this._data.today_take_award_num;return(0==this._data.is_first_share?this._config.first_share_award:0)+e}}]),e}();e.exports=c},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(34),s=i(19),r=i(35),c=function(e){function t(){var e,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=Array(o),r=0;r<o;r++)s[r]=arguments[r];return i=a=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),a.$resGroupList=[ResObjects.getResObject(ResObjectConfig.shareGift)],n(a,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s),a(t,[{key:"render",value:function(){this.initShare();var e=this.$view,t=UIHelper.createImage({imageFileName:"share_gift_bg.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(608,700),capInsets:cc.rect(38,200,1,1),position:cc.p(.5*cc.winSize.width,.5*cc.winSize.height-18)});e.addChild(t);var i=UIHelper.createButton({normalFile:"btn_back_N.png",anchorPoint:cc.p(.5,.5),position:cc.p(40,t.height-16),bPlistTexture:!0,bTouchEnable:!0});i.addTouchEventListener(this._onCloseBtnTouched,this),t.addChild(i);var n=UIHelper.createButton({normalFile:"rect_btn_red.png",position:cc.p(t.width/2,52),bPlistTexture:!0,bTouchEnable:!0});n.addTouchEventListener(this._onShareBtnTouched,this),t.addChild(n);var a=new cc.Sprite("#share_gift_guide_btn_title.png");a.setPosition(n.x,n.y+7),t.addChild(a);var o=new cc.Sprite("#share_gift_title.png");if(o.setPosition(t.width/2,t.height-25),t.addChild(o),ShareForGift.isShowTimeRange()){var s=UIHelper.createImage({imageFileName:"share_gift_time.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(410,23),capInsets:cc.rect(27,12,1,1),position:cc.p(.5*t.width,t.height-90)});t.addChild(s)}var r=new cc.Sprite("#share_gift_diamond_bg.png");r.setAnchorPoint(cc.p(.5,1)),r.setPosition(t.width/2,t.height-106),t.addChild(r);var c=new cc.Sprite("#share_gift_title2.png");c.setPosition(t.width/2,.44*t.height),t.addChild(c);var l=new cc.Sprite("#share_gift_progress.png");l.setPosition(t.width/2,.33*t.height),t.addChild(l);var h=ShareForGift._config.first_share_award+ShareForGift._config.max_award_per_day,u=450*ShareForGift.getAwardNum()/h,d=UIHelper.createImage({imageFileName:"share_gift_progress_bar.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(u,16),capInsets:cc.rect(18,8,0,0),anchorPoint:cc.p(0,.5),position:cc.p(l.x-l.width/2+16,l.y-16)});if(t.addChild(d),ShareForGift.isShowTimeRange()){var p="活动时间："+Time.num2cn(ShareForGift._config.begin_time)+" - "+Time.num2cn(ShareForGift._config.end_time),f=new cc.LabelTTF(p,"Arial",18,cc.size(608,23));f.setAnchorPoint(.5,.5),f.setPosition(s.x,s.y),f.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.addChild(f)}var _=new cc.LabelTTF("好游戏，共分享！好友点击有惊喜喔！","Arial",21,cc.size(608,40));_.setAnchorPoint(.5,.5),_.setPosition(t.width/2,.205*t.height),_.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.addChild(_)}},{key:"_onCloseBtnTouched",value:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(XCXSDK.clearCustomShareData(),this.destroy())}},{key:"initShare",value:function(){var e=this;XCXSDK.setCustomShareData({title:"老铁，好游戏，一起玩！",imageUrl:window.remoteResPath+"res/shareimg2/bonus.png",query:"from=sharegift"},function(){NetData.share_info_ntf.is_first_share&&(NetLoadingWindow.Show(),GameService.share({},function(t,i){NetLoadingWindow.Destroy(),t?TipManager.GetInstance().showTip(JSON.stringify(t)):e.showShareReward()}))},function(){})}},{key:"_onShareBtnTouched",value:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(this.destroy(),XCXSDK.customShare(),XCXSDK.clearCustomShareData())}},{key:"showShareReward",value:function(){o(function(e){var t="钻石 "+e.first_share_award+" 个";r.show("分享奖励",t,"prop_diamond.png")})}}]),t}();e.exports=c},function(e,t){"use strict";var i=null;e.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};if(i)e(i);else{var n=res.share_conf_bin_json,a=new ResObject([n]);ResLoader.silenceLoadRes(a,function(){var t=cc.loader.cache[n].list_data[0];console.log("get share_conf_bin_json success"),console.warn(JSON.stringify(t)),i=t,e(t)},function(){t()})}}},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(7),s=i(16),r=function(e){function t(){var e,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,c=Array(r),l=0;l<r;l++)c[l]=arguments[l];return i=a=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),a.$prefab=o.Prefabs.NORMAL,a.$resGroupList=[ResObjects.getResObject(ResObjectConfig.dialogRewardBox)],a.$btns=[new s({color:s.Color.Green,label:"领取"})],a.$width=480,a.$height=280,a.$acceptMsg="",a.$acceptItem="",a.$okCallback=function(){},n(a,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),a(t,[{key:"beforeShow",value:function(){this.$title=this.$args[0],this.$acceptMsg=this.$args[1];var e=this.$acceptItem=this.$args[2];this.$okCallback=this.$args[3]||function(){},e&&e.article_type&&(this.$acceptItem=GameUtil.getGoodsImageById(e.article_type,e.article_subtype,e.article_id))}},{key:"onBtnTouched",value:function(){this.$okCallback(),this.destroy()}},{key:"render",value:function(){var e=new cc.Sprite("#"+this.$acceptItem);e.setPosition(cc.pAdd(this.$panelCenterRect.center,cc.p(0,30))),this.$panel.addChild(e);var t=new cc.LabelTTF(this.$acceptMsg,"Arial",30);t.setPosition(cc.pAdd(this.$panelCenterRect.center,cc.p(0,-60))),this.$panel.addChild(t);var i=new Effect(res.message_json);i.setPosition(this.$panelCenterRect.center),this.$panel.addChild(i),i.play(!0)}}]),t}();e.exports=r},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(37),s=i(20),r=i(13),c=function(e){function t(){var e,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=Array(o),r=0;r<o;r++)s[r]=arguments[r];return i=a=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),a.$resGroupList=[ResObjects.getResObject(ResObjectConfig.exchange)],a.$width=605,a.$height=630,a.type=0,a.callback=function(){},a.itemCount=5,a.itemList=[],a.texHash={sep:"ex_separate_line.png",btn:"ex_btn_buy.png"},a.ExchangeConfig={1:{title:"购买爱心",titleIconOffset:cc.p(-70,-2),tex:"ex_icon_heart_%s.png",banner:"ex_advert_heart.png",amountPlus:!1,payIcon:"ex_icon_diamond_0.png",payIconOffset:cc.p(-19,0)},2:{title:"购买钻石",titleIconOffset:cc.p(-72,4),tex:"ex_icon_diamond_%s.png",banner:"ex_advert_gold.png",amountPlus:!0,payIcon:"ex_rmb.png",payIconOffset:cc.p(0,0)},3:{title:"购买金币",titleIconOffset:cc.p(-70,4),tex:"ex_icon_gold_%s.png",banner:"ex_advert_gold.png",amountPlus:!1,payIcon:"ex_icon_diamond_0.png",payIconOffset:cc.p(-19,0)}},a.buyMsgMap={1:"购买%s颗爱心成功！",3:"购买%s金币成功！"},a.inited=!1,n(a,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),a(t,[{key:"beforeShow",value:function(){this.type=this.$args[0].exchangeType,this.callback=this.$args[0].buySuccessCallBack||function(){}}},{key:"refresh",value:function(e){this.inited&&this.type!=e.exchangeType&&(this.type=e.exchangeType,this.callback=e.buySuccessCallBack||function(){},this.adapteByConf())}},{key:"render",value:function(){var e=this.title=new cc.LabelTTF("","Arial",36);e.setPosition(cc.pAdd(this.$panelTopRect.center,cc.p(40,0))),this.$panel.addChild(e);var t=this.titleIcon=new cc.Sprite;this.$panel.addChild(t);var i=this.banner=new cc.Sprite;i.setScale(this.$width/424),i.setAnchorPoint(cc.p(.5,1)),i.setPosition(this.$panelCenterRect.top),this.$panel.addChild(i);for(var n=0;n<this.itemCount;n++)this.createItemUnit(n);this.inited=!0,this.adapteByConf()}},{key:"createItemUnit",value:function(e){var t=this,i={},n=(this.$height-110-20)/5,a=(4.5-e)*n+20,o=i.icon=new cc.Sprite;o.setPosition(.13*this.$panelCenterRect.width,a),this.$panel.addChild(o);var s=i.amount1=new cc.LabelBMFont("",res.number_white_fnt);s.setAnchorPoint(0,.5),s.setPosition(.23*this.$panelCenterRect.width,a),this.$panel.addChild(s);var c=i.amount2=new cc.LabelBMFont("",res.number_stage_y_fnt);c.setAnchorPoint(0,.5),c.setPosition(.33*this.$panelCenterRect.width,a),this.$panel.addChild(c);var l=i.btn=r.create(this.texHash.btn);l.setPosition(cc.p(.83*this.$panelCenterRect.width,a)),l.addClickEventListener(function(){t.onBuyBtnPress(e)}),this.$panel.addChild(l);var h=i.btnIcon=new cc.Sprite;h.y=a+4,this.$panel.addChild(h);var u=i.price=new cc.LabelBMFont("",res.number_white_fnt);if(u.setPosition(.86*this.$panelCenterRect.width,a+2),this.$panel.addChild(u),e<this.itemCount-1){var d=new cc.Sprite("#"+this.texHash.sep);d.setScaleX(29),d.setPosition(.51*this.$panelCenterRect.width,a-n/2),this.$panel.addChild(d)}this.itemList.push(i)}},{key:"beforeDestroy",value:function(){MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),eventDispatcher.dispatchEvent(EventID.SHOW_MERGE_NTF)}},{key:"adapteByConf",value:function(){var e=this.ExchangeConfig[this.type];if(e){this.title.setString(e.title),this.titleIcon.initWithSpriteFrameName(cc.formatStr(e.tex,"0")),this.titleIcon.setPosition(cc.pAdd(this.$panelTopRect.center,e.titleIconOffset)),this.banner.initWithSpriteFrameName(e.banner);for(var t=this.getPriceList(),i=0;i<this.itemCount;i++)this.adapteItemUnitByConf(e,i,t.price_pkg_list[i])}else s.show("配置错误("+this.type+")")}},{key:"adapteItemUnitByConf",value:function(e,t,i){var n=this.itemList[t];if(n){var a=i.amount-10*i.price;n.icon.initWithSpriteFrameName(cc.formatStr(e.tex,""+t)),n.amount2.setVisible(!1),e.amountPlus?n.amount1.setString("X"+(i.amount-a)):n.amount1.setString("X"+i.amount),n.btnIcon.initWithSpriteFrameName(e.payIcon),n.btnIcon.x=.76*this.$panelCenterRect.width+e.payIconOffset.x,n.price.setString(""+i.price)}}},{key:"getPriceList",value:function(){for(var e=ConfigData.GoodsConf.list_data,t=0;t<e.length;t++){var i=e[t];if(1==i.type&&i.subtype==this.type)return i}}},{key:"onBuyBtnPress",value:function(e){switch(this.type){case t.Type.GOLD:case t.Type.HEART:this.doBuy1(e);break;case t.Type.DIAMOND:this.doBuy2(e)}}},{key:"doBuy1",value:function(e){var i=this,n=NetData.diamond.count,a=this.getPriceList(),o=a.price_pkg_list[e];if(o.price>n)s.show("钻石不足！",function(){wx.getSystemInfoSync().system.indexOf("iOS")>=0?console.error("iOS 不能购买"):this.refresh({exchangeType:t.Type.DIAMOND})});else{var r=[];Util.registerListener(r,EventID.ON_NETWORK_TIP_WINDOW_SHOW,function(){Util.unRegisterListeners(r),NetLoadingWindow.Hide()}.bind(this)),Util.registerListener(r,EventID.ON_NETWORK_TIP_WINDOW_CANCEL,function(){Util.unRegisterListeners(r),NetLoadingWindow.Hide()}.bind(this)),NetLoadingWindow.Show();var c=new BuyGoodsRequest(null,a.type,a.subtype,o.amount,a.id,e+1);GameService.buyGoods(c,function(e,n){if(Util.unRegisterListeners(r),NetLoadingWindow.Hide(),e)s.show(e.ret_desc,function(){-1104==e.ret&&(wx.getSystemInfoSync().system.indexOf("iOS")>=0?console.error("iOS 不能购买"):i.refresh({exchangeType:t.Type.DIAMOND}))});else{MusicManager.playEffect(MusicEffectFiles.Audio_UI_buycoin);var a=cc.formatStr(i.buyMsgMap[i.type],o.amount);s.show(a,function(){i.type==t.Type.GOLD&&eventDispatcher.dispatchEvent(EventID.SHOW_MERGE_NTF)}),i.callback(i.type)}})}}},{key:"doBuy2",value:function(e){var t=this,i=this.getPriceList().price_pkg_list[e],n=10*i.price;Midas.recharge({count:n,onSuccess:function(){console.warn("success",n);GameService.buyDiamondReport({buy_diamond_num:0,cost_rmb_num:0},function(e,n){console.warn(e,n),e?(console.log("err code: "+e.ret),s.show("上报钻石购买失败("+e.ret_desc+")",function(){eventDispatcher.dispatchEvent(EventID.SHOW_MERGE_NTF)})):(s.show("购买"+i.amount+"钻石成功！",function(){eventDispatcher.dispatchEvent(EventID.SHOW_MERGE_NTF)}),MusicManager.playEffect(MusicEffectFiles.Audio_UI_buydiamond),t.callback(t.type))})}})}}]),t}();c.Type={HEART:1,DIAMOND:2,GOLD:3},e.exports=window.ExchangeWindow=c},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=i(7),o=function(e){function t(){var e,i,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var s=arguments.length,r=Array(s),c=0;c<s;c++)r[c]=arguments[c];return i=o=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r))),o.$prefab=a.Prefabs.SIMPLE2,n(o,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),t}();e.exports=o},function(e,t,i){"use strict";var n=(i(39),i(40),{});n.Show=function(){StagePropWindow.Show()},n.Hide=function(){StagePropWindow.Hide()},n.Destroy=function(){StagePropWindow.Destroy()},e.exports=window.PropSelectWindow=n},function(e,t){"use strict";var i=cc.Node.extend({_bSelected:!1,_choseView:null,_button:null,_itemData:null,_delegate:null,_price:null,_discountPrice:null,_packageIndex:null,ctor:function(e){this._super(),this._itemData=e,null!=e?this._unEmptyView(e):(this._itemData={itemId:-1,configId:-1,count:-1,priceType:-1,describe:""},this._emptyView())},isDiscount:function(){return null!=this._discountPrice&&null!=this._price&&this._discountPrice!=this._price},getDiscountPrice:function(){return this._discountPrice},setDelegate:function(e){this._delegate=e},_emptyView:function(){var e=UIHelper.createImage({imageFileName:"btn_prop_lock_N.png",bPlistTexture:!0});this.addChild(e);e=UIHelper.createImage({imageFileName:"title_coming_soon.png",position:cc.p(0,80),bPlistTexture:!0});this.addChild(e)},getItemId:function(){return this._itemData.itemId},getItemCount:function(){return this._itemData.count},getPrice:function(){return this._price},getPriceType:function(){return this._itemData.priceType},getItemDescribe:function(){return this._itemData.describe},getConfigId:function(){return this._itemData.configId},getPackageIndex:function(){return this._packageIndex},updateItemAndPrice:function(e,t){var i=GameUtil.getGoodsImageById(1,4,e);i&&this._imgView.initWithSpriteFrameName(i),this._labelPriceView&&this._labelPriceView.setString(t);var n=(GameDataConfig.PropTitleViewConfig[e]||{}).image1;n&&this._titleView.loadTexture(n,ccui.Widget.PLIST_TEXTURE),this._price=t},_unEmptyView:function(e){var t=e.bCanUse;(o=UIHelper.createButton({normalFile:"btn_prop_N.png",pressedFile:"btn_prop_P.png",bPlistTexture:!0})).setTouchEnabled(!1),this.addChild(o),this._button=o;var i=o.getContentSize(),n=UIHelper.createPanel({anchorPoint:o.getAnchorPoint(),position:o.getPosition(),size:i,bTouchEnable:t});if(n.addTouchEventListener(this._onItemPanelTouched,this),this.addChild(n),null!=GameDataConfig.PropTitleViewConfig[e.itemId]){var a=GameDataConfig.PropTitleViewConfig[e.itemId].image1,o=UIHelper.createImage({imageFileName:a,position:cc.p(0,80),bPlistTexture:!0});this.addChild(o),this._titleView=o}o=new cc.Sprite;var s=GameUtil.getGoodsImageById(1,4,e.itemId);if(o.initWithSpriteFrameName(s),o.setPosition(0,18),this.addChild(o),this._imgView=o,t)if(e.count>0){o=UIHelper.createImage({imageFileName:"title_free.png",position:cc.p(0,-47),bPlistTexture:!0});this.addChild(o)}else{a="coin_big.png";var r=1;switch(e.priceType){case PriceType.DIAMONDS:a="icon_diamonds.png",r=.5;break;case PriceType.GOLD:a="coin_big.png",r=1}o=UIHelper.createImage({imageFileName:a,scale:r,bPlistTexture:!0,position:cc.p(-35,-45)});this.addChild(o);var c=0,l=0;if(e.pricePackageCount>0&&(l=e.pricePackageList[0].price,c=1,e.useCount>0)){for(var h=[],u=0,d=e.pricePackageList.length;u<d;u++)e.pricePackageList[u].price>0&&h.push(e.pricePackageList[u]);var p=Math.min(e.useCount,h.length-1);this._discountPrice=h[p].price,c=p+1}this._price=l,this._packageIndex=c;(o=new cc.LabelBMFont(l,res.number_white_fnt)).setAnchorPoint(0,.5),o.setPosition(-18,-47),o.setScale(.9),this.addChild(o),this._labelPriceView=o}else{(o=new cc.Sprite).initWithSpriteFrameName(s),o.setColor(cc.color(0,0,0)),o.setOpacity(178),o.setPosition(0,18),this.addChild(o);o=UIHelper.createText({fontSize:20,content:Language.getString(LanguageKey.TEMPORARILY_UNAVAILABLE),bIgnoreSize:!0,position:cc.p(0,-43),fontColor:cc.color(255,255,255)});this.addChild(o)}o=UIHelper.createImage({imageFileName:"icon_chose.png",bPlistTexture:!0,position:cc.p(35,-35),bVisible:!1});if(this.addChild(o),this._choseView=o,t&&e.count>0){var f=UIHelper.createImage({imageFileName:"bg_prop_count.png",bPlistTexture:!0,position:cc.p(40,20)});this.addChild(f);o=UIHelper.createText({fontSize:20,content:e.count,bIgnoreSize:!0,position:cc.p(f.getContentSize().width/2,f.getContentSize().height/2),fontColor:cc.color(255,255,255)});f.addChild(o)}},_onItemPanelTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&this._updateSelectState()},_updateSelectState:function(){this._bSelected?(this._bSelected=!1,this._button.setBrightStyle(ccui.Widget.BRIGHT_STYLE_NORMAL),this._delegate.onPropSelectItemUnSelected(this),this._choseView.setVisible(!1)):this._delegate.onPropSelectItemTouched(this)},onSelected:function(){this._bSelected=!0,this._button.setBrightStyle(ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT),this._choseView.setVisible(!0)},turnToSelectedState:function(){this._bSelected=!1,this._updateSelectState()},isSelected:function(){return this._bSelected}});e.exports=window.PropSelectItem=i},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(19),s=i(20),r=function(e){function t(){var e,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=Array(o),r=0;r<o;r++)s[r]=arguments[r];return i=a=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),a._diceDefaultEffect=null,a._diceLotteryEffect=null,a._diceResultEffect=null,a._sureButton=null,a._cancelButton=null,a._titleText=null,a._resultText=null,a._resultGoods=null,a._nextText=null,a._dimondImage=null,a._cancelText=null,a._sureText=null,a._price=0,a._touchCallback=null,a.buyDiceResult=null,n(a,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),a(t,[{key:"beforeShow",value:function(){this._price=this.$args[0],this._touchCallback=this.$args[1],this.listen(EventID.ON_NETWORK_TIP_WINDOW_CANCEL,this.onWeakNetworkCancel)}},{key:"render",value:function(){this._price,this.width=this.$view.width,this.height=this.$view.height,this._dimondImage=UIHelper.createImage({imageFileName:"icon_diamonds.png",bPlistTexture:!0,position:cc.p(.5*this.width-55,.3*this.height+80),scale:.6}),this.$view.addChild(this._dimondImage),this._sureButton=UIHelper.createButton({normalFile:"round_btn_red_sure.png",bPlistTexture:!0,anchorPoint:cc.p(.5,.5),position:cc.p(.735*this.width,.28*this.height),bTouchEnable:!0}),this.$view.addChild(this._sureButton),this._sureText=UIHelper.createImage({imageFileName:"btn_title_sure_yellow.png",bPlistTexture:!0,position:cc.p(.5*this._sureButton.width,.5*this._sureButton.height+10),scale:1}),this._sureButton.addChild(this._sureText),this._sureButton.addTouchEventListener(this._onLottery,this),this._cancelButton=UIHelper.createButton({normalFile:"round_btn_green_cancel.png",bPlistTexture:!0,anchorPoint:cc.p(.5,.5),position:cc.p(.265*this.width,.28*this.height),bTouchEnable:!0}),this.$view.addChild(this._cancelButton),this._cancelButton.addTouchEventListener(this._onQuitLottery,this),this._cancelText=UIHelper.createImage({imageFileName:"btn_title_cancel_yellow.png",bPlistTexture:!0,position:cc.p(.5*this._cancelButton.width,.5*this._cancelButton.height+10),scale:1}),this._cancelButton.addChild(this._cancelText),NetData.random_item_info_ntf.random_item_id?this._showRollResult():this._showDefaultEffect()}},{key:"_showDefaultEffect",value:function(){this._hideRollResult(),this._hideRollDice(),null===this._diceDefaultEffect?(this._diceDefaultEffect=new Effect(res.giftdiscover_json),this._diceDefaultEffect.setPosition(.5*this.width,.57*this.height),this.$view.addChild(this._diceDefaultEffect),this._diceDefaultEffect.play(!0)):(this._diceDefaultEffect.setVisible(!0),this._diceDefaultEffect.play(!0)),this._titleText?this._titleText.setVisible(!0):(this._titleText=UIHelper.createText({fontSize:32,content:cc.formatStr(Language.getString(LanguageKey.LUCKY_DICE_TITLE_TEXT),GameDataConfig.LUCKY_DICE_PRICE),position:cc.p(.5*this.width,.3*this.height+80),anchorPoint:cc.p(.5,.5),fontColor:cc.color.WHITE}),this.$view.addChild(this._titleText)),this._dimondImage&&(this._dimondImage.setPosition(.5*this.width-55,.3*this.height+80),this._dimondImage.setVisible(!0))}},{key:"_hideDefaultEffect",value:function(){this._diceDefaultEffect&&this._diceDefaultEffect.setVisible(!1),this._titleText&&this._titleText.setVisible(!1),this._dimondImage&&!NetData.random_item_info_ntf.random_item_id&&this._dimondImage.setVisible(!1)}},{key:"_showRollResult",value:function(){this._hideRollDice(),this._hideDefaultEffect(),null===this._diceResultEffect?(this._diceResultEffect=new Effect(res.giftdiscoveraction2_json),this._diceResultEffect.setPosition(.5*this.width,.57*this.height),this.$view.addChild(this._diceResultEffect),this._diceResultEffect.play(!0)):(this._diceResultEffect.setVisible(!0),this._diceResultEffect.play(!0));var e=GameUtil.getGoodsImageById(1,4,NetData.random_item_info_ntf.random_item_id);e||console.warn("_showRollResult:","Not found resource by random_item_id: "+NetData.random_item_info_ntf.random_item_id),null===this._resultGoods?(this._resultGoods=UIHelper.createImage({imageFileName:e,bPlistTexture:!0,position:cc.p(.5*this.width,.57*this.height),scale:2}),this._resultGoods.setVisible(!0),this.$view.addChild(this._resultGoods)):(this._resultGoods.loadTexture(e,ccui.Widget.PLIST_TEXTURE),this._resultGoods.setVisible(!0));var t=(ConfigData.ItemConf.list_data.filter(function(e){return e.id==NetData.random_item_info_ntf.random_item_id})[0]||{}).desc||"";this._resultText?(this._resultText.setString(t),this._resultText.setVisible(!0)):(this._resultText=UIHelper.createText({fontSize:32,content:t,position:cc.p(.5*this.width,.3*this.height+80),anchorPoint:cc.p(.5,.5),fontColor:cc.color.WHITE}),this.$view.addChild(this._resultText)),this._showNextText(),this._updateBtns()}},{key:"_hideRollResult",value:function(){this._resultText&&this._resultText.setVisible(!1),this._diceResultEffect&&this._diceResultEffect.setVisible(!1),this._resultGoods&&this._resultGoods.setVisible(!1)}},{key:"_showNextText",value:function(){this._nextText?this._nextText.setVisible(!0):(this._nextText=UIHelper.createText({fontSize:30,content:cc.formatStr(Language.getString(LanguageKey.LUCKY_DICE_NEXT_TEXT),GameDataConfig.LUCKY_DICE_DISCOUNT_PRICE),position:cc.p(this.width-15,.3*this.height-100),anchorPoint:cc.p(1,.5),fontColor:cc.color.WHITE}),this.$view.addChild(this._nextText)),this._dimondImage&&(this._dimondImage.setPosition(this.width-180,.3*this.height-100),this._dimondImage.setVisible(!0))}},{key:"_hideNextText",value:function(){this._nextText&&this._nextText.setVisible(!1),this._dimondImage&&this._dimondImage.setVisible(!1)}},{key:"_showRollDice",value:function(){this._hideDefaultEffect(),this._hideRollResult(),null===this._diceLotteryEffect?(this._diceLotteryEffect=new Effect(res.giftdiscoveraction1_json),this._diceLotteryEffect.setPosition(.5*this.width,.57*this.height),this._diceLotteryEffect.setPlayCompleteCallBack(function(){this._playAniCallback&&this._playAniCallback()}.bind(this)),this.$view.addChild(this._diceLotteryEffect),this._diceLotteryEffect.play(!1)):(this._diceLotteryEffect.setVisible(!0),this._diceLotteryEffect.play(!0))}},{key:"_hideRollDice",value:function(){this._diceLotteryEffect&&this._diceLotteryEffect.setVisible(!1)}},{key:"_enableBtns",value:function(){this._sureButton&&this._sureButton.setTouchEnabled(!0),this._cancelButton&&this._cancelButton.setTouchEnabled(!0)}},{key:"_disableBtns",value:function(){this._sureButton&&this._sureButton.setTouchEnabled(!1),this._cancelButton&&this._cancelButton.setTouchEnabled(!1)}},{key:"_updateBtns",value:function(){NetData.random_item_info_ntf.random_item_id?(this._cancelText.loadTexture("btn_title_this_yellow.png",ccui.Widget.PLIST_TEXTURE),this._sureText.loadTexture("btn_title_again_yellow.png",ccui.Widget.PLIST_TEXTURE)):(this._cancelText.loadTexture("btn_title_cancel_yellow.png",ccui.Widget.PLIST_TEXTURE),this._sureText.loadTexture("btn_title_sure_yellow.png",ccui.Widget.PLIST_TEXTURE))}},{key:"_onLottery",value:function(e,t){var i=this;if(ccui.Widget.TOUCH_ENDED==t){MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch);var n=new BuyGoodsRequest(12,1,4,1,15,NetData.random_item_info_ntf.random_item_id?2:1);this.buyDiceResult=null,this._showRollDice(),GameService.buyGoods(n,function(e,t){i.buyDiceResult={error:e,data:t}}),this._disableBtns()}}},{key:"_playAniCallback",value:function(){return this.buyDiceResult&&this.buyDiceResult.weak_network?(NetData.random_item_info_ntf.random_item_id?this._showRollResult():this._showDefaultEffect(),void this._enableBtns()):this.buyDiceResult?this.buyDiceResult&&this.buyDiceResult.error?this.handleError(this.buyDiceResult.error):(this._showRollResult(),void this._enableBtns()):this._showRollDice()}},{key:"handleError",value:function(e){s.show(e.ret_desc,function(){-1104==e.ret&&(wx.getSystemInfoSync().system.indexOf("iOS")>=0?console.error("iOS 不能购买"):ExchangeWindow.show({exchangeType:ExchangeWindow.Type.DIAMOND}))}),NetData.random_item_info_ntf.random_item_id?this._showRollResult():this._showDefaultEffect(),this._enableBtns(),console.error("buyGoodsError:",e)}},{key:"onWeakNetworkCancel",value:function(){this.buyDiceResult={weak_network:!0}}},{key:"_onQuitLottery",value:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),this._touchCallback&&this._touchCallback(!1))}}]),t}();e.exports=window.LuckyDiceWindow=r},function(e,t,i){"use strict";i(42),i(46),i(47);var n=i(49).LastPangCls;window.LastPang=new n},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(43),o=i(44),s=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this._isshowing=!1}return n(e,[{key:"show",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._isshowing||(this._isshowing=!0,o.show(t,i),setTimeout(function(){e._isshowing=!1},500))}}]),e}();window.ShowOff=new s,window.ShowOffDataCollect=new a},function(e,t){"use strict";var i=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"init",value:function(){var e=this;if(this.data)for(var t in this.data){this.data[t].value=0}else this.data={clearance:{cid:5,value:0},tryTimes:{cid:3,value:0},collectStars:{cid:6,value_old:0,value:0},lastStep:{cid:1,value:0},breakOutLast:{cid:2,value:0}},cc.loader.load(res.flaunt_conf_bin_json,function(t,i){if(!t&&i){if(i){if(e.config=i[0],e.configMap={},!e.config||!e.config.list_data)return;for(var n,a=0;n=e.config.list_data[a];a++){var o=n.id;e.configMap[o]?(e.configMap[o]=[e.configMap[o]],e.configMap[o].push(n)):e.configMap[o]=n}for(var s in e.data){var r=e.data[s];o=r.cid;r.config=e.configMap[o]||{}}}}else console.log("炫耀配置加载失败="+res.flaunt_conf_bin_json)})}},{key:"stat",value:function(e){var t=GameProxy.getStageId(),i=this.data;if(this.isUnpassStage()){MAX_STAGE_ID==t&&(i.clearance.value=1);var n=this.getStorage("failStage",t)||0;i.tryTimes.value=n}e.starCount=parseInt(e.starCount);var a=GameUtil.getStarNumByStageID(t)||0;e.starCount>a?e.starCount-=a:e.starCount=0,i.collectStars.value_old=GameUtil.getAllStarNum(),i.collectStars.value=GameUtil.getAllStarNum()+e.starCount}},{key:"getData",value:function(){for(var e in this.data){var t=this.data[e],i=t.value,n=t.config;if(console.log("检查炫耀"),console.log("检查炫耀key="+e),console.log("检查炫耀item="+JSON.stringify(t)),!n)return null;if(i){if("clearance"==e)return t;if("tryTimes"==e)for(var a=0,o=n.length;a<o;a++){var s=n[a];if(this._isInStage(s)){if(i>parseInt(s.param1))return this.removeStorage("failStage"),t}}if("collectStars"==e)for(var r=n.param1.split(","),c=0,l=r.length;c<l;c++){var h=parseInt(r[c],10);if(t.value_old<h&&i>=h)return t}if("lastStep"==e&&this._isInStage(n))return t;if("breakOutLast"==e&&this._isInStage(n)){if(i>parseInt(n.param1))return t}}}return null}},{key:"getStorageKey",value:function(){if(this.storageKey)return this.storageKey;var e=Util.getBaseStorageKey();return this.storageKey=e+"_showoff",this.storageKey}},{key:"addStorage",value:function(e,t,i,n){if(wx.setStorageSync)try{var a=this.getStorageKey(),o=wx.getStorageSync(a),s=o&&JSON.parse(o)||{};if(s[e]){var r=s[e];r[t]&&n?r[t]+=i:r[t]=i}else s[e]={},s[e][t]=i;wx.setStorageSync(a,JSON.stringify(s))}catch(e){}}},{key:"removeStorage",value:function(e,t){if(wx.setStorageSync)try{var i=this.getStorageKey(),n=wx.getStorageSync(i),a=n&&JSON.parse(n)||{};a[e]&&a[e][t]?delete a[e][t]:a[e]&&!t&&delete a[e],wx.setStorageSync(i,JSON.stringify(a))}catch(e){}}},{key:"getStorage",value:function(e,t){if(wx.getStorageSync)try{var i=this.getStorageKey();console.error(i);var n=wx.getStorageSync(i),a=n&&JSON.parse(n)||{};return a[e]&&a[e][t]?a[e][t]:a[e]&&!t?a[e]:null}catch(e){}}},{key:"addFail",value:function(){if(this.isUnpassStage()){var e=GameProxy.getStageId();this.addStorage("failStage",e,1,!0)}}},{key:"passThrough",value:function(){var e=ChessBoardHelper.getLastDropRound&&ChessBoardHelper.getLastDropRound();console.log("检查炫耀, puzzleGame.getSuccessStep() = "+puzzleGame.getSuccessStep()),console.log("检查炫耀, puzzleGame.getSuccessStep() == 0 = "+(0==puzzleGame.getSuccessStep())),0==puzzleGame.getSuccessStep()&&(console.log("检查炫耀, try _addLastStep"),this._addLastStep()),this._addBreakOutLast(e||0)}},{key:"isUnpassStage",value:function(){return GameProxy.getStageId()>NetData.statics_ntf.stage_statics.max_stage_id}},{key:"_addLastStep",value:function(){console.log("检查炫耀, _addLastStep"),this.isUnpassStage()&&(console.log("检查炫耀, _addLastStep, isUnpassStage"),this.data.lastStep.value=1)}},{key:"_addBreakOutLast",value:function(e){this.isUnpassStage()&&(this.data.breakOutLast.value=e)}},{key:"_isInStage",value:function(e){var t=GameProxy.getStageId(),i=e.begin_stage,n=e.end_stage;return t>=i&&(t<=n||0==n)}}]),e}();e.exports=n},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(45),s=i(11),r=i(19),c=function(e){function t(){var e,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=Array(o),r=0;r<o;r++)s[r]=arguments[r];return i=a=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),a.$resGroupList=[ResObjects.getResObject(ResObjectConfig.flaunt)],n(a,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r),a(t,[{key:"beforeShow",value:function(){this.data=this.$args[0],this.callback=this.$args[1],this.initShare()}},{key:"render",value:function(){var e=this.getMatchConf();if(!e)return console.error(this.data),void(this.callback&&this.callback());var t=this.$view,i=new cc.ParticleSystem(res.soccerstarpalur1_plist);i.setPosition(cc.winSize.width/2,cc.winSize.height),t.addChild(i);var n=new cc.ParticleSystem(res.soccerstarpalur2_plist);n.setPosition(cc.winSize.width/2,cc.winSize.height),t.addChild(n);var a=new cc.ParticleSystem(res.soccerstarpalur3_plist);a.setPosition(cc.winSize.width/2,cc.winSize.height),t.addChild(a);var o=new Effect(res["flaunt"+e.tex+"_json"]);o.setPosition(cc.winSize.width/2,.52*cc.winSize.height),o.play(!0),t.addChild(o);var s=new cc.Sprite("#flaunt_title_bg.png");s.setAnchorPoint(cc.p(1,.5)),s.setPosition(.5*cc.winSize.width+1,.73*cc.winSize.height),t.addChild(s);var r=new cc.Sprite("#flaunt_title_bg.png");r.setAnchorPoint(cc.p(1,.5)),r.setPosition(.5*cc.winSize.width-1,s.y),r.setRotationY(180),t.addChild(r);var c=new cc.Sprite("#flaunt"+e.tex+".png");c.setPosition(.5*cc.winSize.width,s.y+40),t.addChild(c);var l=UIHelper.createImage({imageFileName:"flaunt_msg_bg.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(200,45),capInsets:cc.rect(40,22,0,1),anchorPoint:cc.p(1,.5),position:cc.p(.5*cc.winSize.width,.345*cc.winSize.height)});t.addChild(l);var h=UIHelper.createImage({imageFileName:"flaunt_msg_bg.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(200,45),capInsets:cc.rect(40,22,0,1),anchorPoint:cc.p(1,.5),position:cc.p(.5*cc.winSize.width,l.y)});h.setRotationY(180),t.addChild(h);var u=UIHelper.createButton({normalFile:"flaunt_btn_normal.png",pressedFile:"flaunt_btn_pressed.png",position:cc.p(cc.winSize.width/2,.24*cc.winSize.height),bPlistTexture:!0,bTouchEnable:!0});u.addTouchEventListener(this.onOkBtnTouched,this),t.addChild(u);var d=cc.formatStr(e.copy_right,this.data.value||""),p=new cc.LabelTTF(d,"Arial",22,cc.size(608,24));p.setPosition(l.x,l.y),p.setHorizontalAlignment(cc.TEXT_ALIGNMENT_CENTER),t.addChild(p);var f=UIHelper.createButton({normalFile:"btn_close_N.png",position:cc.p(cc.winSize.width-50,.81*cc.winSize.height),bPlistTexture:!0,bTouchEnable:!0});f.addTouchEventListener(this.onCloseBtnTouched,this),t.addChild(f)}},{key:"getMatchConf",value:function(){if(!this.data.config)return null;this.data.config instanceof Array&&(this.data.config=this.data.config[0]);this.data.config.tex={1:"2qiadaohaochu",2:"1chushenruhua",3:"3wuyulunbi",5:"1chushenruhua",6:"3wuyulunbi"}[this.data.cid];return this.data.config.shareimg={1:"flaunt_laststep",2:"flaunt_greatx",3:"flaunt_retry",5:"flaunt_passall",6:"flaunt_stars"}[this.data.cid],this.data.config}},{key:"getRewardDetail",value:function(e){for(var t=e.length,i=this.getMatchConf(),n=0;n<t;n++){var a=e[n];if(a.id==i.reward_pool_id)return a.reward_list[0]}return null}},{key:"initShare",value:function(){var e=this,t=this.getMatchConf();console.log("share:"+JSON.stringify(t)),XCXSDK.setCustomShareData({title:cc.formatStr(t.share_copy_right,this.data.value||""),imageUrl:window.remoteResPath+"res/shareimg2/"+t.shareimg+".png",query:"from="+t.shareimg},function(){e.requestReward()},function(){})}},{key:"onOkBtnTouched",value:function(e,t){ccui.Widget.TOUCH_ENDED==t&&XCXSDK.customShare()}},{key:"onCloseBtnTouched",value:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(XCXSDK.clearCustomShareData(),this.applyCallback())}},{key:"applyCallback",value:function(){this.destroy(),this.callback&&this.callback()}},{key:"requestReward",value:function(){var e=this,t=Time.stamp2num(Time.today());return Time.stamp2num(1e3*NetData.last_flaunt_time.low)>=t?void this.applyCallback():void s.parallel({cmd:function(t){GameService.firstFlaunt({reward_pool_id:e.data.config.reward_pool_id},function(e,i){e||!i?t(!0):(NetData.last_flaunt_time=i.last_flaunt_time,t(null))})},conf:function(t){cc.loader.load(res.FlauntRewardPool_bin_json,function(i,n){if(i)t(i);else{var a=e.getRewardDetail(n[0].list_data);a?t(null,a):t(!0)}})}},function(t,i){return t?void e.applyCallback():void e.playGetRewardAnimation(i.conf)})}},{key:"playGetRewardAnimation",value:function(e){var t=this;this.destroy(),o.show(e,function(){t.callback&&t.callback()})}}]),t}();e.exports=c},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(7),s=function(e){function t(){var e,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var s=arguments.length,r=Array(s),c=0;c<s;c++)r[c]=arguments[c];return i=a=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r))),a.$prefab=o.Prefabs.NONE,a.$resGroupList=[ResObjects.getResObject(ResObjectConfig.dialogRewardBox)],a.$touchEnable=!1,a.$data=null,a.$callback=null,n(a,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),a(t,[{key:"beforeShow",value:function(){this.$data=this.$args[0]||{},this.$callback=this.$args[1]||function(){}}},{key:"onTouchEnded",value:function(){this.destroy(),this.$callback()}},{key:"render",value:function(){var e=this,t=(cc.winSize.width,cc.winSize.height,cc.visibleRect.center),i=this.$data,n=new GiftShineEffect;n.visible=!1,n.setPosition(t),this.$view.addChild(n);var a=new GiftGetEffect;a.setPosition(t),a.play(),this.$view.addChild(a);var o=new GiftLightEffect;o.visible=!1,o.setPosition(t),this.$view.addChild(o);var s=UIHelper.seekWidgetByName(a,"Panel_8");s.setBackGroundColorType(ccui.Layout.BG_COLOR_NONE);var r=UIHelper.createImage({imageFileName:GameUtil.getGoodsImageById(i.article_type,i.article_subtype,i.article_id),bPlistTexture:!0,position:cc.p(s.width/2,s.height/2)});s.addChild(r);var c=new cc.LabelBMFont("X "+i.article_count,res.number_gold_big_fnt);c.setAnchorPoint(.5,0),c.setPosition(cc.p(s.width/2,20)),c.setScale(1.75),s.addChild(c),setTimeout(function(){o.play(),o.visible=!0,n.play(),n.visible=!0},2200),setTimeout(function(){e.$touchEnable=!0},3200)}}]),t}();e.exports=s},function(e,t){"use strict";var i=cc.Sprite.extend({_colorMap:{0:"yellow",1:"red",2:"orange",3:"green",4:"blue",5:"purple"},getTexture:function(e){if(e){return"obstacle/colorchangrd/colorchanged"+this._colorMap[e.colorType]+".png"}return"obstacle/colorchangrd/colorchanged.png"},unuse:function(){this.removeFromParent()},reuse:function(e){this.initWithSpriteFrameName(this.getTexture(e)),this.setAnchorPoint(.5,.5),this.opacity=255}});i.create=function(e){if(cc.pool.hasObject(i))return cc.pool.getFromPool(i,e);var t=new i;return t.reuse(e),t},window.ChameleonChess=ChessBase.extend({_animalView:null,ctor:function(e){this._super(e);var t=this._animalView=i.create(e);this.addChild(t)},changeColor:function(e){var t=this;AnimationManager._increaseExecutingEffectLogicCount();var n=i.create();this.addChild(n,-1);var a=i.create(e);this.addChild(a,-2);cc.async.series({multi:function(e){t._animalView.runAction(cc.sequence(cc.fadeOut(.5),cc.callFunc(function(){cc.pool.putInPool(t._animalView),e(null)})))},target:function(e){n.runAction(cc.sequence(cc.fadeOut(.5),cc.callFunc(function(){cc.pool.putInPool(n),e(null)})))}},function(){t._animalView=a,t._animalView.setZOrder(0),t._chessData=e,AnimationManager._reduceExecutingEffectLogicCount(),AnimationManager._reduceWaitChessBoardStableCount()})},reset:function(e){this._super(e),this._animalView.reuse(e)}})},function(e,t,i){"use strict";var n=i(48),a=n.TickBomb1IdleEffect,o=n.TickBomb1ClickEffect,s=n.TickBomb1DropEffect,r=n.TickBomb1ClearUpEffect,c=n.TickBomb2IdleEffect,l=n.TickBomb2ClickEffect,h=n.TickBomb2DropEffect,u=n.TickBomb2ClearUpEffect,d=n.TickBombBrokenEffect;window.TickBombChess=ChessBase.extend({_list:[["_bomb1Idle",a],["_bomb1Click",o],["_bomb1Drop",s,!0],["_bomb1ClearUp",r,!0],["_bomb2Idle",c],["_bomb2Click",l],["_bomb2Drop",h,!0],["_bomb2ClearUp",u,!0],["_bombBroken",d,!0]],_bombView:[],_numberView:[],_maxNumber:0,_number:0,_forceStat:!1,ctor:function(e){var t=this;this._super(e),this._appendCache={},this._bombView=[],this._numberView=[],this._maxNumber=0,this._number=0,this._forceStat=!1,this._list.forEach(function(i){var n=t[i[0]]=new i[1];n.setColorType(e.colorType),t.addChild(n),t._bombView.push(n)}),this.changeNumber(e.extendData.bomb_data.tick_count),this._maxNumber||(this._maxNumber=e.extendData.bomb_data.tick_count)},fire:function(){AnimationManager.__needAddStep=1,AnimationManager._increaseExecutingEffectLogicCount(),this._resetStat("broken")},addStep:function(e){var t=Math.min(this._maxNumber,this._number+e);this.changeNumber(t)},changeNumber:function(e){this._number=e,this._numberView.forEach(function(e){e.removeFromParent()}),this._numberView=[];if(e>=10&&e<100){var t=~~(e/10),i=e%10,n=new cc.Sprite("#obstacle/stepscounter/white"+t+".png"),a=new cc.Sprite("#obstacle/stepscounter/white"+i+".png");n.anchorX=.9,a.anchorX=.1,n.scale=a.scale=.9,n.x=a.x=15,n.y=a.y=-17,this.addChild(n),this.addChild(a),this._numberView.push(n),this._numberView.push(a)}else if(e>=0&&e<10){var o=new cc.Sprite("#obstacle/stepscounter/white"+e+".png");o.scale=.9,o.x=15,o.y=-17,this.addChild(o),this._numberView.push(o)}this._resetStat()},_resetStat:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"idle";if(!this._forceStat){this._list.forEach(function(t){e[t[0]].setOpacity(0),e[t[0]].pause()});var i=this._number>2?1:2;switch(t){case"idle":var n="_bomb"+i+"Idle";this._fixAnimationBug(n),this[n].setOpacity(255),this[n].play(!0);break;case"click":n="_bomb"+i+"Click";this._fixAnimationBug(n),this[n].setOpacity(255),this[n].play(!0);break;case"drop":n="_bomb"+i+"Drop";this._fixAnimationBug(n),this[n].setOpacity(255),this[n].play(!1,function(){e._resetStat()});break;case"broken":n="_bombBroken";this._fixAnimationBug(n),this._forceStat=!0,this._numberView.forEach(function(e){e.removeFromParent()}),this.setZOrder(999),this[n].setOpacity(255),this[n].play(!1,function(){setTimeout(function(){AnimationManager._reduceExecutingEffectLogicCount(),e._forceStat=!1,e.onCrush()},100)})}}},_fixAnimationBug:function(e){},reset:function(e){this._bombView.forEach(function(t){t.setColorType(e.colorType)}),this.changeNumber(e.extendData.bomb_data.tick_count),this._resetStat(),this._super(e)},turnToIdle:function(){this._super(),this._resetStat()},onCrush:function(){this._clearAllState(),this._delegate.onChessCrush(this)},onClicked:function(){this._super(),this._resetStat("click")},onDropEffectStartPlay:function(e,t){this._super(e,t)},onDropEffectPlayComplete:function(){this._super()},onRearranged:function(e,t){this._super(e,t),this._resetStat()},onDrop:function(e,t){this._super(e,t),this._resetStat("drop")}})},function(e,t){"use strict";var i=Effect.extend({_bombSprite:null,_numSprite:null,ctor:function(e){this._super(e),this._bombSprite=UIHelper.seekWidgetByName(this._node,"boomblue_1",NodeType.SPRITE),this._numSprite=UIHelper.seekWidgetByName(this._bombSprite,"white4_14",NodeType.SPRITE)},setColorType:function(e){this._bombSprite.setSpriteFrame("obstacle/bomb/boom"+{0:"yellow",1:"red",2:"brown",3:"green",4:"blue",5:"purple"}[e]+".png")},play:function(e,t){this._super(e),this.setPlayCompleteCallBack(function(){t&&t()})}});t.TickBomb1IdleEffect=i.extend({ctor:function(){this._super(res.bomb1hold_json)}}),t.TickBomb1ClickEffect=i.extend({ctor:function(){this._super(res.bomb1click_json)}}),t.TickBomb1DropEffect=i.extend({ctor:function(){this._super(res.bomb1drop_json)}}),t.TickBomb1ClearUpEffect=i.extend({ctor:function(){this._super(res.bomb1clearup_json)}}),t.TickBomb2IdleEffect=i.extend({ctor:function(){this._super(res.bomb2hold_json)}}),t.TickBomb2ClickEffect=i.extend({ctor:function(){this._super(res.bomb2click_json)}}),t.TickBomb2DropEffect=i.extend({ctor:function(){this._super(res.bomb2drop_json)}}),t.TickBomb2ClearUpEffect=i.extend({ctor:function(){this._super(res.bomb2clearup_json)}}),t.TickBombBrokenEffect=i.extend({ctor:function(){this._super(res.bombbroken_json)}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(50),a=function(){function e(){this._animationDataListAggregate=[],this._lastpangRadialDataListAggregate=[],this._lastScore=0}return Object.defineProperty(e.prototype,"Timer",{get:function(){return Timer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"UpdateProxy",{get:function(){return UpdateProxy},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"puzzleGame",{get:function(){return puzzleGame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"AnimationManager",{get:function(){return AnimationManager},enumerable:!0,configurable:!0}),e.prototype.init=function(e){this.destroy(),this._updateProxy=new this.UpdateProxy(this._update.bind(this)),this._updateProxy.pause();var t=new this.Timer;t.setDuration(.2),t.setTimeUp(this._onReachLaunchRadialTime.bind(this)),t.pause(),this._timer=t,this._lastScore=e.data.extendData.currentScore,this._petPositionInGrid=e.data.extendData.petPositionInGrid,this._effectLayer=e.data.extendData.effectLayer,this._animationDataListAggregate=[],this._lastpangRadialDataListAggregate=[],this._initAnimationDataListAggregate()},e.prototype.destroy=function(){this._lastScore=null,this._updateProxy&&this._updateProxy.release(),this._updateProxy=null,this._timer&&this._timer.pause(),this._timer=null,this._animationDataListAggregate=[]},e.prototype.play=function(){this._timer.start(),this._updateProxy.start(),this._startAnimation()},e.prototype.triggerLastpangRadialCrush=function(e){var t=this._lastpangRadialDataListAggregate.shift();if(null!=t){e=Util.clone(e);this._coverAnimation(t.animationDataList,e,RemoveLogic.we4Proto.AnimationId.score),this._coverAnimation(t.animationDataList,e,RemoveLogic.we4Proto.AnimationId.step),this.puzzleGame.eventManager.trigger("START_ANIMATION",e)}},e.prototype._update=function(e){this._timer.update(e)},e.prototype._coverAnimation=function(e,t,i){for(var n=-1,a=0,o=e.length;a<o;a++)if(e[a].animation_id==i){n=a;break}if(-1!=n)for(a=0,o=t.length;a<o;a++)if(t[a].animation_id==i){t[a]=e[n];break}},e.prototype._onReachLaunchRadialTime=function(){this._startAnimation()},e.prototype._startAnimation=function(){var e=this._animationDataListAggregate.shift();return e?void(e.animationDataList&&e.removeAnimationData?ChessBoardHelper.playLastPangRadialAnimation(e.animationDataList,e.removeAnimationData):e.animationDataList&&!e.removeAnimationData&&this.puzzleGame.eventManager.trigger("START_ANIMATION",e.animationDataList)):(this.destroy(),void this.AnimationManager.resume())},e.prototype._initAnimationDataListAggregate=function(){var e=this.puzzleGame.getAnimation();if(e&&e.length){var t,i=new n.LastPangAnimationCls(e);i.ids.step_reward_end||(i.ids.remove&&i.ids.score?(i.addRemoveScoreEntendData(this),t={animationDataList:i.list,removeAnimationData:i.removeData},this._lastpangRadialDataListAggregate.push(t)):(i.ids.generate_attack,t={animationDataList:e}),this._animationDataListAggregate.push(t),this._initAnimationDataListAggregate())}},e}();t.LastPangCls=a},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){return this._aniidmap=null,this.ids={},this.indexs={},t=e,"[object Array]"===Object.prototype.toString.call(t)?(this._data=e,void this.findAnimation()):void console.error("LastPangAnimation must instanceof Array ");var t}return Object.defineProperty(e.prototype,"RemoveLogic",{get:function(){return RemoveLogic},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animaIdMap",{get:function(){if(!this._aniidmap){var e={},t=this.RemoveLogic.we4Proto.AnimationId;for(var i in t)e[t[i]]=i;this._aniidmap=e}return this._aniidmap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"list",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"removeData",{get:function(){var e=this.indexs.remove;return this._data[e]},enumerable:!0,configurable:!0}),e.prototype.addRemoveScoreEntendData=function(e){var t=this.indexs.score,i=this.indexs.remove,n=this._data[t].score-e._lastScore;e._lastScore=this._data[t].score;var a={crushScore:n,petPositionInGrid:e._petPositionInGrid,effectLayer:e._effectLayer};this._data[i].data.extendData=a},e.prototype.findAnimation=function(){for(var e=this.RemoveLogic.we4Proto,t=0;t<this._data.length;t++){var i=this._data[t],n=this.animaIdMap[i.animation_id];if(n){if(i.animation_id==e.AnimationId.remove&&i.data.attack_type!=e.AttackType.Attack_Lastpang)continue;this.ids[n]=!0,this.indexs[n]=t}}},e}();t.LastPangAnimationCls=i},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(6);!function(e){function t(){var e,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=Array(o),r=0;r<o;r++)s[r]=arguments[r];return i=a=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),a.$width=487,a.$height=310,n(a,i)}(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)})(t,o),a(t,[{key:"render",value:function(){var e=this.$panel,t=new cc.Sprite("#share_icon1.png");t.setPosition(.3*e.width,.48*e.height),cc.sys.os==cc.sys.OS_ANDROID&&t.setRotation(90),e.addChild(t);var i=new cc.Sprite("#share_arrow.png");i.setPosition(.5*e.width,t.y),e.addChild(i);var n=new cc.Sprite("#share_icon2.png");n.setPosition(.7*e.width,t.y-15),e.addChild(n);var a=UIHelper.createText({position:cc.p(e.width/2,.715*e.height),anchorPoint:cc.p(.5,.5),fontSize:27,fontColor:cc.color("#FFFFFF"),content:"点击菜单并分享好友即可"});e.addChild(a)}}])}()},function(e,t,i){"use strict";i(53)},function(e,t,i){"use strict";var n=i(54),a=i(60),o={},s={_gameEnterList:[],_rewardEnterList:[],_viewList:[],_enterRoot:null,_weekMatchWindowMap:{},_weekMatchDataMap:{},init:function(){if(this._checkWeekMatchList())for(var e=0,t=NetData.week_match_info_ntf.week_match_list.length;e<t;e++){var i=NetData.week_match_info_ntf.week_match_list[e];if(null!=i){var n={enter:"",reward:"",rankType:-1,resObject:null};switch(i.match_id){case WeekMatchId.MERGED:n.enterFlag="icon_new_play_model.png",n.enter="btn_merged_week_match.png",n.reward="btn_week_match_reward.png",n.rankType=RankType.RANK_TYPE_WEEKMATCH_MASTER_MERGER,n.resObject=ResObjects.getResObject(ResObjectConfig.mergedWeekMatch);break;case WeekMatchId.HEX_CRUSH:n.enterFlag="icon_new_week_match.png",n.enter="btn_hex_crush_week_match.png",n.reward="btn_week_match_reward.png",n.rankType=RankType.RANK_TYPE_WEEKMATCH_SIX_CORNER_ELIM,n.resObject=ResObjects.getResObject(ResObjectConfig.hexCrushWeekMatch)}o[i.match_id]=n}}},createEnter:function(e){if(this._enterRoot=e,this.destroyEnter(),this._checkWeekMatchList()){for(var t=0,i=NetData.week_match_info_ntf.week_match_list.length;t<i;t++){var n=NetData.week_match_info_ntf.week_match_list[t];null!=n&&this._createEnterButton(n,e)}this._sortView()}},_sortView:function(){for(var e=0,t=0,i=this._viewList.length;t<i;t++)this._viewList[t].getContentSize().width>e&&(e=this._viewList[t].getContentSize().width);var n=this._enterRoot.getContentSize().width-e/2-5,a=cc.winSize.height-300,o=null,s=null;for(t=0,i=this._viewList.length;t<i;t++)o=this._viewList[t],o.setPosition(n,a),a-=o.getContentSize().height/2,s=this._viewList[t+1],null!=s&&(a-=s.getContentSize().height/2+20)},_checkWeekMatchList:function(){return GameUtil.isAttributeExist("NetData.week_match_info_ntf.week_match_list")?!!Util.isArray(NetData.week_match_info_ntf.week_match_list)||(console.log("NetData.week_match_info_ntf.week_match_list isnot Array"),!1):(console.log("NetData.week_match_info_ntf.week_match_list isnot exist"),!1)},_createEnterButton:function(e){var t=e.match_id,i=GameUtil.isAttributeExist("NetData.now_unix_timestamp.low")&&Util.isAttributeExist(e,"start_time.low")&&Util.isAttributeExist(e,"end_time.low")&&e.start_time.low<NetData.now_unix_timestamp.low&&NetData.now_unix_timestamp.low<e.end_time.low,n=o[t],a=null!=this._getRankRewardNtf(n.rankType);i&&!a?this._createGameEnterButton(n,e):StorageManager.recordClearWeekMatchLocalStorageFlag(e.match_id,!0),a&&this._createRewardEnterButton(n,e)},_getRankRewardNtf:function(e){for(var t=0,i=NetData.rank_reward_ntf.length;t<i;t++)if(e==NetData.rank_reward_ntf[t].rank_type)return NetData.rank_reward_ntf[t];return null},_createGameEnterButton:function(e,t){var i=UIHelper.createButton({normalFile:e.enter,anchorPoint:cc.p(.5,.5),bPlistTexture:!0,bTouchEnable:!0});i.addClickEventListener(this._onGameEnterButtonClicked.bind(this)),i.setUserData(t),this._enterRoot.addChild(i,1);var n=UIHelper.createImage({imageFileName:e.enterFlag,bPlistTexture:!0,position:cc.p(20,i.getContentSize().height-10)});i.addChild(n),this._gameEnterList.push(i),this._viewList.push(i)},_createRewardEnterButton:function(e,t){var i=UIHelper.createButton({normalFile:e.reward,anchorPoint:cc.p(.5,.5),bPlistTexture:!0,bTouchEnable:!0});i.setUserData(t),i.addClickEventListener(this._onRewardEnterButtonClicked.bind(this)),this._enterRoot.addChild(i,1),this._rewardEnterList.push(i),this._viewList.push(i)},_onRewardEnterButtonClicked:function(e){console.log("week match reward button clicked");var t=e.getUserData(),i=o[t.match_id],n=this._getRankRewardNtf(i.rankType);if(null!=n&&null!=n.reward_pool_apd){for(var a=[],s=0,r=n.reward_pool_apd.length;s<r;s++)for(var c=n.reward_pool_apd[s],l=0,h=c.reward_list.length;l<h;l++)a.push(c.reward_list[l]);WeekMatchRewardWindow.Show(n,a,this._onWeekMatchRewardWindowGetButtonClicked.bind(this)),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch)}},_onWeekMatchRewardWindowGetButtonClicked:function(e){for(var t=0,i=NetData.rank_reward_ntf.length;t<i;t++)if(e.rank_type==NetData.rank_reward_ntf[t].rank_type){NetData.rank_reward_ntf.splice(t,1);break}this.createEnter(this._enterRoot)},_onGameEnterButtonClicked:function(e){function t(){delete c._weekMatchWindowMap[s],WindowManager.GetInstance().destroyWindow(r)}console.log("week match button clicked");var i=e.getUserData(),s=i.match_id,r=this._weekMatchWindowMap[s],c=this;if(null==r){var l=this._weekMatchDataMap[s];null==l&&(l=new a(i),l.loadFirstPageRankData(),this._weekMatchDataMap[s]=l),ResLoader.showSubResLoadingWindow(o[s].resObject,function(){(r=new n(l)).setBackButtonClickedCallBack(t),this._weekMatchWindowMap[s]=r,WindowManager.GetInstance().showWindow(r,null,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,t)}.bind(this))}MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch)},destroyEnter:function(){function e(e){if(Util.isArray(e)){for(var t=0,i=e.length;t<i;t++){var n=e[t];n&&n.removeFromParent&&n.removeFromParent()}e.length=0}}e(this._gameEnterList),e(this._rewardEnterList),this._viewList=[]}};e.exports=window.WeekMatchEnterHandler=s},function(e,t,i){"use strict";var n=i(55),a=i(56),o=i(57),s=i(58),r=i(20),c=i(59),l=WindowBase.extend({_rankDataList:null,_weekMatchTableItemSize:null,_weekMatchTableView:null,_dialogBgView:null,_bgView:null,_listenerList:null,_crownViewList:null,_notInvolvedViewList:null,_pageId:-1,_totalPage:null,_chestRewardViewMap:null,_currentChestRewardView:null,_loadingRankDataEffect:null,_weekMatchTicketCountText:null,_ticketCountBg:null,_weekMatchData:null,_backButtonClickedCallBack:null,_viewData:null,ctor:function(e){this._super(),this._weekMatchData=e,this._initData(),this._initView(),this._initWeekMeekTableView(),this._registerListener(),this._requestRankData(!1)},setBackButtonClickedCallBack:function(e){this._backButtonClickedCallBack=e},_initData:function(){this._weekMatchTableItemSize=cc.size(605,96),this._listenerList=[],this._crownViewList=[],this._notInvolvedViewList=[],this._rankDataList=[],this._chestRewardViewMap={},this._initViewData()},_initViewData:function(){var e={},t={},i={},n={},a={};this._viewData={shareData:e,ruleData:t,notifyData:i,viewData:n,subscribeData:a};var o=this._weekMatchData.getMatchId();switch(this._configData=WeekMatchConfig[o],o){case WeekMatchId.MERGED:e.describe=Language.getString(LanguageKey.WEEK_MATCH_MERGED_SHARE_DESCRIBE),t.resObject=ResObjects.getResObject(ResObjectConfig.mergedRule),t.bgFileName=res.dialog_bg_merged_rule_png,i.shareTitle=Language.getString(LanguageKey.WEEK_MATCH_INVITE_TITLE),i.shareDescribe=Language.getString(LanguageKey.WEEK_MATCH_MERGED_INVITE_DESCRIBE),a.resObject=ResObjects.getResObject(ResObjectConfig.weekMatchMergedSubscribe),a.textKey="merged",n.titleFileName="icon_merged_week_match_title.png";break;case WeekMatchId.HEX_CRUSH:e.describe=Language.getString(LanguageKey.WEEK_MATCH_HEX_CRUSH_SHARE_DESCRIBE),t.resObject=ResObjects.getResObject(ResObjectConfig.hexCrushRule),t.bgFileName=res.dialog_bg_hex_crush_rule_png,i.shareTitle=Language.getString(LanguageKey.WEEK_MATCH_INVITE_TITLE),i.shareDescribe=Language.getString(LanguageKey.WEEK_MATCH_HEX_CRUSH_INVITE_DESCRIBE),a.resObject=ResObjects.getResObject(ResObjectConfig.weekMatchHexSubscribe),a.textKey="hex",n.titleFileName="icon_hex_crush_week_match_title.png"}},_registerListener:function(){Util.registerListener(this._listenerList,EventID.ON_WINDOW_RESIZE,this._onWindowResize.bind(this)),Util.registerListener(this._listenerList,EventID.WEEK_MATCH_SETTLEMENT_SUCCESS,this._onWeekMatchSettlementSuccess.bind(this)),Util.registerListener(this._listenerList,EventID.AT_ITEM,this._onItemChange.bind(this)),Util.registerListener(this._listenerList,EventID.WEEK_MATCH_INFO_NTF,this._onWeekMatchInfoNotify.bind(this)),Util.registerListener(this._listenerList,EventID.LOAD_WEEK_MATCH_GAME,this._onLoadWeekMatchGame.bind(this)),Util.registerListener(this._listenerList,EventID.ON_SHARE_WEEK_MATCH,this._onShareWeekMatch.bind(this)),Util.registerListener(this._listenerList,EventID.ON_WEEK_MATCH_RESULT_WINDOW_DESTROY,this._onWeekMatchResultWindowDestroy.bind(this))},_onWeekMatchResultWindowDestroy:function(){this._updateTicketCount()},_onShareWeekMatch:function(e){var t=this,i=e.userData.customShareSuccessCallBack,n=e.userData.customShareFailCallBack,a=e.userData.weekMatchShareCallBack;X8SDK.customShare({desc:t._viewData.shareData.describe},function(){"function"==typeof i&&i(),GameService.weekMatchShare({match_id:t._weekMatchData.getMatchId()},function(e,t){"function"==typeof a&&a(e,t)})},function(){"function"==typeof n&&n()})},_onLoadWeekMatchGame:function(){this._loadWeekMatchGame()},_onWeekMatchInfoNotify:function(){this._weekMatchData.refresh(),this._updateTicketCount()},_onItemChange:function(){this._updateTicketCount()},_onWeekMatchSettlementSuccess:function(){this._weekMatchData.clearAllRankData(),this._pageId=-1,this._totalPage=null,this._rankDataList=[],this._requestRankData(!1)},_onWindowResize:function(){UIHelper.adjustBgImage(this._bgView)},_initView:function(){var e=UIHelper.createImage({imageFileName:res.lr_bg_jpg,position:UIHelper.getCenterPosition()});UIHelper.adjustBgImage(e),this.addChild(e),this._bgView=e;var t=cc.size(620,590);e=UIHelper.createImage({imageFileName:"n_g_dialog.png",bPlistTexture:!0,bScale9Enabled:!0,size:t,capInsets:cc.rect(204,72,212,34),position:UIHelper.getPosition(320,733)});this.addChild(e),this._dialogBgView=e;e=UIHelper.createImage({imageFileName:this._viewData.viewData.titleFileName,bPlistTexture:!0,position:cc.p(310,565)});this._dialogBgView.addChild(e);(e=UIHelper.createButton({normalFile:"btn_back_N.png",bPlistTexture:!0,position:cc.p(40,570),bTouchEnable:!0})).addClickEventListener(this._onBackButtonClicked.bind(this)),this._dialogBgView.addChild(e);(e=UIHelper.createButton({normalFile:"btn_share_text.png",bPlistTexture:!0,position:cc.p(566,558),bTouchEnable:!0})).addClickEventListener(this._onShareButtonClicked.bind(this)),this._dialogBgView.addChild(e);(e=UIHelper.createButton({normalFile:"btn_starg_game_N.png",bPlistTexture:!0,bPressedActionEnabled:!0,position:UIHelper.getPosition(320,130),bTouchEnable:!0})).addClickEventListener(this._onStartGameButtonClicked.bind(this)),this.addChild(e,1);var i=e;e=UIHelper.createImage({imageFileName:"icon_week_match_ticket_cout.png",bPlistTexture:!0,position:cc.p(310,106)});i.addChild(e);var n=e;this._ticketCountBg=e;e=UIHelper.createText({fontSize:20,position:cc.p(72,36),fontColor:cc.color(156,96,0)});n.addChild(e),this._weekMatchTicketCountText=e;var a=t.width;(o=this._createTopLine()).setPosition(a/2,515),o.setScaleY(-1),this._dialogBgView.addChild(o,1);var o;(o=this._createBottomLine()).setPosition(a/2,16),this._dialogBgView.addChild(o,1);(e=UIHelper.createButton({normalFile:"btn_rule.png",bPlistTexture:!0,bPressedActionEnabled:!0,position:UIHelper.getPosition(65,84),bTouchEnable:!0})).addClickEventListener(this._onRuleButtonClicked.bind(this)),this.addChild(e);e=UIHelper.createImage({imageFileName:"bg_day_match_chest.png",bPlistTexture:!0,position:UIHelper.getPosition(320,314)});this.addChild(e);var s=e;(r=new Effect(res.miaowancomplete_json)).setPosition(s.getContentSize().width/2,400),r.play(!0),s.addChild(r);(e=new cc.ParticleSystem(res.soccerstarpalur3_plist)).setPosition(cc.winSize.width/2,cc.winSize.height),this.addChild(e,10);(e=new cc.ParticleSystem(res.soccerstarpalur2_plist)).setPosition(cc.winSize.width/2,cc.winSize.height),this.addChild(e);(e=UIHelper.createImage({imageFileName:"icon_silver_chest.png",bPlistTexture:!0,position:cc.p(155,133)})).setTouchEnabled(!0),e.addTouchEventListener(this._onSilverChestTouched,this),s.addChild(e);(e=UIHelper.createImage({imageFileName:"icon_gold_chest.png",bPlistTexture:!0,position:cc.p(309,158)})).setTouchEnabled(!0),e.addTouchEventListener(this._onGoldChestTouched,this),s.addChild(e);(e=UIHelper.createImage({imageFileName:"icon_copper_chest.png",bPlistTexture:!0,position:cc.p(466,122)})).setTouchEnabled(!0),e.addTouchEventListener(this._onCopperChestTouched,this),s.addChild(e);e=UIHelper.createImage({imageFileName:"rank_no_1.png",bPlistTexture:!0});this._crownViewList.push(e);e=UIHelper.createImage({imageFileName:"rank_no_2.png",bPlistTexture:!0});this._crownViewList.push(e);e=UIHelper.createImage({imageFileName:"rank_no_3.png",bPlistTexture:!0});this._crownViewList.push(e);var r;(r=new Effect(res.loading2_json)).setPosition(this._dialogBgView.getContentSize().width/2,this._dialogBgView.getContentSize().height/2),r.setVisible(!1),this._dialogBgView.addChild(r,10),this._loadingRankDataEffect=r,this._subscribeInit()},_subscribeInit:function(){var e=this;X8SDK.isWX()&&X8SDK.getWXListSubscribe(function(t){if(t&&t.subscribeList&&t.subscribeList.length){var i,n=e._configData.subscribeId;t.subscribeList.forEach(function(e){e.id==n&&(i=e)}),i&&(e.subscribeItemData=i,e._subscribeIconRefresh())}})},_subscribeIconRefresh:function(){var e=this;if(this.subscribeIcon&&this.subscribeIcon.removeFromParent(),this.subscribeItemData.status)this.subscribeIcon=UIHelper.createButton({normalFile:"btn_unsubscribe.png",bPlistTexture:!0,bPressedActionEnabled:!0,position:UIHelper.getPosition(575,84),bTouchEnable:!0}),this.subscribeIcon.addClickEventListener(this._onSubscribeButtonClicked.bind(this)),this.addChild(this.subscribeIcon);else{var t="res/effect/platform/mailbox.json";cc.loader.load(t,function(i,n){if(!i){var a=cc.p(.5,.5),o=cc.p(52.5,56.5),s=cc.size(105,113);e.subscribeIcon=UIHelper.createPanel({position:UIHelper.getPosition(575,88),anchorPoint:a,size:s});var r=new Effect(t);r.setPosition(o),e.subscribeIcon.addChild(r),r.play();var c=UIHelper.createPanel({position:o,anchorPoint:a,size:s,bTouchEnable:!0});e.subscribeIcon.addChild(c),c.addClickEventListener(e._onSubscribeButtonClicked.bind(e)),e.addChild(e.subscribeIcon)}})}},_showLoadingRankDataView:function(){this._loadingRankDataEffect.setVisible(!0),this._loadingRankDataEffect.play(!0),this._weekMatchTableView.setTouchEnabled(!1)},_hideLoadingRankDataView:function(){this._loadingRankDataEffect.setVisible(!1),this._weekMatchTableView.setTouchEnabled(!0)},_createBottomLine:function(){var e=this._dialogBgView.getContentSize().width,t=UIHelper.createImage({imageFileName:"rank_bottom.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(e-10,20),capInsets:cc.rect(30,0,4,27)}),i=new cc.Sprite;return i.initWithSpriteFrameName("rank_arrow.png"),i.setPosition(e/2,7),t.addChild(i),t},_createTopLine:function(){var e=this._dialogBgView.getContentSize().width,t=UIHelper.createImage({imageFileName:"icon_line_yellow.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(e-10,15),capInsets:cc.rect(2,2,10,10)}),i=new cc.Sprite;return i.initWithSpriteFrameName("rank_arrow.png"),i.setPosition(e/2,7),t.addChild(i),t},_initWeekMeekTableView:function(){var e=cc.size(this._weekMatchTableItemSize.width,5*this._weekMatchTableItemSize.height),t=cc.p(7,23),i=new cc.TableView(this,e);i.setDelegate(this),i.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),i.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN),i.setPosition(t),i.reloadData(),this._dialogBgView.addChild(i),this._weekMatchTableView=i},_onSilverChestTouched:function(e,t){ccui.Widget.TOUCH_BEGAN===t?(e.setLocalZOrder(2),this._showChestReward({rank:2,viewRoot:e}),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch)):ccui.Widget.TOUCH_ENDED!==t&&ccui.Widget.TOUCH_CANCELED!==t||(e.setLocalZOrder(1),this._hideChestReward())},_onGoldChestTouched:function(e,t){ccui.Widget.TOUCH_BEGAN===t?(e.setLocalZOrder(2),this._showChestReward({rank:1,viewRoot:e}),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch)):ccui.Widget.TOUCH_ENDED!==t&&ccui.Widget.TOUCH_CANCELED!==t||(e.setLocalZOrder(1),this._hideChestReward())},_onCopperChestTouched:function(e,t){ccui.Widget.TOUCH_BEGAN===t?(e.setLocalZOrder(2),this._showChestReward({rank:3,viewRoot:e}),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch)):ccui.Widget.TOUCH_ENDED!==t&&ccui.Widget.TOUCH_CANCELED!==t||(e.setLocalZOrder(1),this._hideChestReward())},_showChestReward:function(e){var t=e.rank,i=this._chestRewardViewMap[t];if(null==i){var n=this._createRewardData(e);(i=UIHelper.createRewardPreviewPanel(n)).setPosition(e.viewRoot.getContentSize().width/2,e.viewRoot.getContentSize().height+10),e.viewRoot.addChild(i),this._chestRewardViewMap[t]=i}this._currentChestRewardView&&this._currentChestRewardView.setVisible(!1),this._currentChestRewardView=i,this._currentChestRewardView.setVisible(!0)},_createRewardData:function(e){switch(e.rank){case 1:110;break;case 2:111;break;case 3:112;break;default:112}var t=[],i=ConfigLoader.getWeekMatchRewardConfig(this._weekMatchData.getMatchId(),e.rank);if(null==i)return t;var n=ConfigLoader.getRewardConfig(i.reward_pool_id);if(null==n)return t;for(var a=n.reward_list,o=0,s=n.reward_cnt;o<s;o++){e=a[o];var r=GameUtil.getGoodsImageById(e.article_type,e.article_subtype,e.article_id),c=e.article_count;t.push({icon:r,amount:c,probability:!1})}return t},_hideChestReward:function(){this._currentChestRewardView&&this._currentChestRewardView.setVisible(!1),this._currentChestRewardView=null},_onBackButtonClicked:function(e){"function"==typeof this._backButtonClickedCallBack&&this._backButtonClickedCallBack(this),console.log("back button clicked"),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch)},_onShareButtonClicked:function(e){MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),console.log("share button clicked");eventDispatcher.dispatchEvent(EventID.ON_SHARE_WEEK_MATCH,{customShareSuccessCallBack:function(){},customShareFailCallBack:function(){TipWindow.Show(Language.getString(LanguageKey.SHARE_FAIL))},weekMatchShareCallBack:function(e,t){if(null==e)Reporter.Beacon.onEvent(272,"Week_Match_share");else{var i=null!=e.ret_desc?e.ret_desc:Language.getString(LanguageKey.SHARE_FAIL);TipWindow.Show(i)}}})},_onRuleButtonClicked:function(e){MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),console.log("rule button clicked"),s.Show(this._viewData.ruleData)},_onSubscribeButtonClicked:function(e){MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch);var t=this,i=this._viewData.subscribeData,n=this.subscribeItemData.status?"已取消"+this._configData.name+"周赛提醒":"已订阅参赛提醒",a=this.subscribeItemData.status?1:0;c.show({$width:490,$height:350,$resGroupList:[i.resObject],render:function(){var e=UIHelper.createPanel({position:this.$panelCenterRect.center,anchorPoint:cc.p(.5,.5),size:cc.size(410,280)}),n=t.subscribeItemData.status?res["un_ss_text_"+i.textKey+"_jpg"]:res["ss_text_"+i.textKey+"_jpg"],a=UIHelper.createImage({imageFileName:n,position:cc.p(0,280),anchorPoint:cc.p(0,1)});e.addChild(a);var o=t.subscribeItemData.status?res.un_ss_title_jpg:res.ss_title_jpg,s=cc.p(0,0),r=UIHelper.createImage({imageFileName:o,position:s,anchorPoint:s});return e.addChild(r),e},okCallback:function(){NetLoadingWindow.Show(),X8SDK.setWXListSubscribe({subscribeId:[t._configData.subscribeId],subscribeType:a},function(){NetLoadingWindow.Hide(),r.show(n),t.subscribeItemData.status=!t.subscribeItemData.status,t._subscribeIconRefresh()},function(){NetLoadingWindow.Hide(),r.show("操作失败, 请重新尝试")}),t.subscribeItemData.status?Reporter.Beacon.onEvent(276,"Week_Match_sub_cancel"):Reporter.Beacon.onEvent(275,"Week_Match_sub")}})},_onStartGameButtonClicked:function(e){console.log("start game button clicked"),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch);this._getTicketCount()>0?this._loadWeekMatchGame():o.Show(this._weekMatchData,function(){"function"==typeof this._backButtonClickedCallBack&&this._backButtonClickedCallBack(this)}.bind(this))},_loadWeekMatchGame:function(){var e=this._weekMatchData.getMatchId();Service.AppManager.loadGame(WeekMatchConfig[e].htmlIndexPath,e)},_getTicketCount:function(){var e=this._weekMatchData.getTicketId(),t=GameUtil.getItem(e),i=0;if(null!=t){i=t.count;var n=this._weekMatchData.getWeekMatchItem();if(Util.isAttributeExist(n,"last_play_time")&&GameUtil.isAttributeExist("NetData.now_unix_timestamp.low")){0!=Util.getDiffDay(NetData.now_unix_timestamp.low,n.last_play_time)&&i++}}if(0==i){"run"==StorageManager.getWeekMatchGameState(this._weekMatchData.getMatchId())&&i++}return i},_requestRankData:function(e){null!=this._totalPage&&this._pageId>=this._totalPage-1||(this._showLoadingRankDataView(),this._pageId++,this._weekMatchData.getWeekMatchRankData(this._pageId,function(e){this._hideLoadingRankDataView(),this._handleRankResponseData(e),this._refreshMergedWeekMatchTableView()}.bind(this),e))},_handleRankResponseData:function(e){this._totalPage=this._weekMatchData.getTotalPage();for(var t=0!=this._rankDataList.length?this._rankDataList[this._rankDataList.length-1].rank:0,i=e.weekMatchFriendList,n=0,a=i.length;n<a;n++){var o=i[n],s=o.openid,r=this._weekMatchData.getPlayerBaseInfo(s);if(null!=r){t++;var c=this._weekMatchData.isInvited(s),l=new MergedWeekMatchData(s,t,r.pic,r.nick,o.week_score,c);this._rankDataList.push(l)}}},_refreshMergedWeekMatchTableView:function(){var e=this._weekMatchTableView.getContainer().getContentSize();if(0!=e.width&&0!=e.height){this._weekMatchTableView.reloadData();var t=this._weekMatchTableView.getContainer().getContentSize();if(t.height>this._weekMatchTableView.getContentSize().height){var i=this._weekMatchTableView.getContentOffset();this._weekMatchTableView.setContentOffset(cc.p(i.x,e.height-t.height))}}else this._weekMatchTableView.reloadData()},recycleCrownView:function(e,t){null!=t&&(this._crownViewList[e-1]=t)},getCrownView:function(e){return this._crownViewList[e-1]},recycleNotInvolvedView:function(e){e&&this._notInvolvedViewList.push(e)},getNotInvolvedView:function(){var e=this._notInvolvedViewList.pop();return null==e&&(e=UIHelper.createImage({imageFileName:"icon_not_involved.png",bPlistTexture:!0})),e},tableCellWillRecycle:function(e,t){if(null!=t){var i=t.getChildByName("mergedDayMatchItem");i&&i.onWillRecycle()}},tableCellSizeForIndex:function(e,t){return this._weekMatchTableItemSize},tableCellAtIndex:function(e,t){var i=e.dequeueCell(),a=null;null==i?(i=new cc.TableViewCell,(a=new n({size:this._weekMatchTableItemSize})).setDelegate(this),a.setName("mergedDayMatchItem"),i.addChild(a)):a=i.getChildByName("mergedDayMatchItem");var o=this._rankDataList[t];a.refresh(o);var s=t==this._rankDataList.length-1;return a.setLast(s),i},bounceFinish:function(e){this._weekMatchTableView._scrollDistance.y>0&&this._requestRankData(!0)},numberOfCellsInTableView:function(e){return this._rankDataList.length},onInviteFriend:function(e){var t=this,i=e.getMergedDayMatchData().openId;this._viewData.notifyData.openid=i,this._viewData.notifyData.successCallBack=function(){e.onInviteFriendSuccess(),t._weekMatchData.onNotifyFriendSuccess(i),Reporter.Beacon.onEvent(274,"Week_Match_invite")},a.Show(this._viewData.notifyData),console.log("onInviteFriend")},onShowNotify:function(){TopGoldBar.Hide(),this._updateTicketCount()},_updateTicketCount:function(){var e=this._getTicketCount();this._weekMatchTicketCountText.setString(cc.formatStr(Language.getString(LanguageKey.WEEK_MATCH_TICKET_COUT),e)),this._ticketCountBg.setVisible(e>0)},onShow:function(){this._weekMatchData.refresh()},onHideNotify:function(){TopGoldBar.Show(),this._hideLoadingRankDataView()},onHide:function(){},onDestroyNotify:function(){TopGoldBar.Show(),Util.unRegisterListeners(this._listenerList);for(var e=0,t=this._crownViewList.length;e<t;e++)this._crownViewList[e]&&this._crownViewList[e].removeFromParent();this._crownViewList=[];for(e=0,t=this._notInvolvedViewList.length;e<t;e++)this._notInvolvedViewList[e]&&this._notInvolvedViewList[e].removeFromParent();this._notInvolvedViewList=[],this._hideLoadingRankDataView()},onDestroy:function(){},onCover:function(){},onResume:function(){}});e.exports=l},function(e,t){"use strict";var i=cc.Node.extend({_rankText:null,_headImagePanel:null,_nameText:null,_scoreText:null,_inviteButton:null,_delegate:null,_mergedWeekMatchData:null,_lineView:null,_crownView:null,_notInvolvedView:null,_noScoreView:null,ctor:function(e){this._super();var t=e.size;this.setContentSize(t);var i=t.height/2,n=UIHelper.createImage({imageFileName:"rank_inter_s.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(t.width,5),capInsets:cc.rect(10,0,2,2),position:cc.p(t.width/2,1)});this.addChild(n),this._lineView=n;(n=new cc.LabelBMFont("0",res.number_white_fnt)).setPosition(60,i),n.setScale(1.5),this.addChild(n),this._rankText=n;n=UIHelper.createPanel({position:cc.p(157,i)});this.addChild(n),this._headImagePanel=n;n=UIHelper.createText({fontSize:30,content:"--",position:cc.p(210,i),fontColor:cc.color(255,255,255),anchorPoint:cc.p(0,.5)});this.addChild(n),this._nameText=n;(n=new cc.LabelBMFont("0",res.number_white_fnt)).setPosition(490,i),n.setScale(1.5),this.addChild(n),this._scoreText=n;(n=UIHelper.createButton({normalFile:"btn_invite_N.png",disabledFile:"btn_invite_D.png",bPlistTexture:!0,position:cc.p(490,i),bTouchEnable:!0})).addClickEventListener(this._onInviteButtonClicked.bind(this)),this.addChild(n),this._inviteButton=n;n=UIHelper.createImage({imageFileName:"icon_no_score.png",bPlistTexture:!0,position:cc.p(490,i)});this.addChild(n),this._noScoreView=n},_onInviteButtonClicked:function(e){console.log("invite button clicked"),this._mergedWeekMatchData.bInvited||this._delegate.onInviteFriend(this),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch)},getMergedDayMatchData:function(){return this._mergedWeekMatchData},setDelegate:function(e){this._delegate=e},setLast:function(e){this._lineView.setVisible(!e)},setCrown:function(e){},refresh:function(e){this._mergedWeekMatchData=e,this._rankText.setString(e.rank),UIHelper.clipLongTextLabel(this._nameText,e.name,this._nameText.getFontSize(),130),this._headImagePanel.removeAllChildren();var t=this;GameUtil._loadAvatar(e.headImgUrl,function(e){var i=e.getContentSize();e.setScaleX(64/i.width),e.setScaleY(64/i.height),t._headImagePanel.addChild(e)}),this._scoreText.setString(Util.getNumberWithComma(e.score));var i=e.score>0;if(i){var n=this._delegate.getCrownView(e.rank);null!=n&&(n.setPosition(this._rankText.getPosition()),this.addChild(n)),this._rankText.setVisible(!n),this._crownView=n}else{e.bInvited?this._inviteButton.setEnabled(!1):this._inviteButton.setEnabled(!0);var a=this._delegate.getNotInvolvedView();a.setPosition(this._rankText.getPosition()),this.addChild(a),this._notInvolvedView=a,this._rankText.setVisible(!1)}this._scoreText.setVisible(i),this._inviteButton.setVisible(!i),this._noScoreView.setVisible(!i);var o=e.openId==NetData.user_info.openid;i||(this._noScoreView.setVisible(o),this._inviteButton.setVisible(!o))},onInviteFriendSuccess:function(){this._mergedWeekMatchData.bInvited=!0,this._inviteButton.setEnabled(!1)},onWillRecycle:function(){null!=this._crownView&&(this._crownView.removeFromParent(),this._delegate.recycleCrownView(this._mergedWeekMatchData.rank,this._crownView)),this._crownView=null,null!=this._notInvolvedView&&(this._notInvolvedView.removeFromParent(),this._delegate.recycleNotInvolvedView(this._notInvolvedView)),this._notInvolvedView=null}});e.exports=i},function(e,t){"use strict";var i=WindowBase.extend({_config:{openid:"",successCallBack:null},ctor:function(){this._super();var e=UIHelper.createImage({imageFileName:"bg_dialog.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(512,520),capInsets:cc.rect(0,72,512,22),position:cc.p(cc.winSize.width/2,cc.winSize.height/2)});this.addChild(e);var t=UIHelper.createImage({imageFileName:"bg_go_online_invitation_reward.png",bPlistTexture:!0,position:cc.p(256,333)});e.addChild(t);var i=UIHelper.createButton({normalFile:"m_green_btn.png",bPressedActionEnabled:!0,bPlistTexture:!0,position:cc.p(124,55),bTouchEnable:!0});i.addTouchEventListener(this._onCloseButtonTouched,this),e.addChild(i);var n=new cc.Sprite;n.initWithSpriteFrameName("btn_title_cancel.png"),n.setPosition(cc.p(85,40)),i.addChild(n);var a=UIHelper.createButton({normalFile:"m_red_btn.png",bPressedActionEnabled:!0,bPlistTexture:!0,position:cc.p(387,55),bTouchEnable:!0});a.addTouchEventListener(this._onSureButtonTouched,this),e.addChild(a);var o=new cc.Sprite;o.initWithSpriteFrameName("title_go_online.png"),o.setPosition(cc.p(85,40)),a.addChild(o);var s=new SortViewGroup,r=this._getPlatformIconFrameName(),c=new cc.Sprite;c.initWithSpriteFrameName(r),c.setPosition(cc.p(111,182)),e.addChild(c),s.addView(c);var l=UIHelper.createText({position:cc.p(151,182),fontSize:35,fontColor:cc.color(255,255,255),content:Language.getString(LanguageKey.NOTIFY_FRIEND_GO_ONLINE_NOW)});e.addChild(l,1),s.addView(l),s.setViewHorizontalSpacing(10),s.setMidX(e.getContentSize().width/2),s.sort()},setConfig:function(e){this._config=e},_onCloseButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(console.log("_onCloseButtonTouched"),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),i.Destroy())},_onSureButtonTouched:function(e,t){ccui.Widget.TOUCH_ENDED==t&&(console.log("_onSureButtonTouched"),MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),this._sendNotifyInviteMatchRequest())},_sendNotifyInviteMatchRequest:function(){var e=!1,t=Timeout.register(function(){e=!0,NetLoadingWindow.Hide(),TipWindow.Show(Language.getString(LanguageKey.INVITE_FRIEND_NOTIFY_FAIL))},5e3);NetLoadingWindow.Show();var n=this;GameService.sendNtf({friend_openid:this._config.openid,title:this._config.shareTitle,description:this._config.shareDescribe,fail_desc:Language.getString(LanguageKey.INVITE_FRIEND_NOTIFY_FAIL)},function(a,o){e||(clearTimeout(t),NetLoadingWindow.Hide(),null==a?("function"==typeof n._config.successCallBack&&n._config.successCallBack(),i.Destroy()):(null!=a.iRet?(a.ret_desc,a.iRet):a.ret_desc,TipWindow.Show(a.ret_desc)))})},_getPlatformIconFrameName:function(){return"wechat"==GameService.pf?"logo_weixin.png":"logo_qq.png"},onShowNotify:function(){}});i.GetInstance=function(){return null==i._instance&&(i._instance=new i),i._instance},i.Show=function(e){ResLoader.showSubResLoadingWindow(ResObjects.getResObject(ResObjectConfig.notifyGoOnline),function(){var t=i.GetInstance();t.setConfig(e);var n=WindowAction.getScaleEaseElasticOutAction(t);WindowManager.GetInstance().showWindow(t,n,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,i.Destroy)})},i.Hide=function(){WindowManager.GetInstance().hideWindow(i._instance)},i.Destroy=function(){WindowManager.GetInstance().destroyWindow(i._instance),i._instance=null},e.exports=i},function(e,t){"use strict";var i=WindowBase.extend({_bgView:null,_weekMatchData:null,_handleAddCountByPlayGameCallBack:null,ctor:function(){this._super(),this._initView()},setWeekMatchData:function(e){this._weekMatchData=e},setHandleAddCountByPlayGameCallBack:function(e){this._handleAddCountByPlayGameCallBack=e},_initView:function(){var e=cc.size(630,600),t=UIHelper.createImage({imageFileName:"task_bg.png",bPlistTexture:!0,bScale9Enabled:!0,size:e,capInsets:cc.rect(0,70,620,30),position:UIHelper.getPosition(320,600)});this.addChild(t),this._bgView=t;t=UIHelper.createImage({imageFileName:"title_add_week_match_count.png",bPlistTexture:!0,position:cc.p(300,560)});this._bgView.addChild(t);(t=UIHelper.createButton({normalFile:"btn_close_N.png",bPlistTexture:!0,position:cc.p(597,565),bTouchEnable:!0})).addClickEventListener(this._onCloseButtonClicked.bind(this)),this._bgView.addChild(t)},_initAddCountModelListView:function(){var e=new ccui.ListView;e.setDirection(ccui.ScrollView.DIR_VERTICAL),e.setGravity(ccui.ListView.GRAVITY_CENTER_HORIZONTAL),e.setItemsMargin(25),e.setScrollBarEnabled(!1),e.setContentSize(610,475),e.setPosition(10,35),e.setClippingEnabled(!1),this._bgView.addChild(e);var t=this._createAddCountByCoin();e.pushBackCustomItem(t);t=this._createAddCountByPlayGame();e.pushBackCustomItem(t);t=this._createAddCountByShareGame();e.pushBackCustomItem(t)},_createAddCountByCoin:function(){var e=new o;return e.setAddCountType(n.diamond),e.setDelegate(this),e},_createAddCountByPlayGame:function(){var e=NetData.week_match_info_ntf.normstage_play_num,t=this._weekMatchData.getSendTicketNormstageNum();e=Math.min(e,t);var i=new s({currentCount:e,totalCount:t});return i.setAddCountType(n.playGame),i.setDelegate(this),i},_createAddCountByShareGame:function(){var e=!1,t=this._weekMatchData.getWeekMatchItem();if(Util.isAttributeExist(t,"last_share_time.low")&&GameUtil.isAttributeExist("NetData.now_unix_timestamp.low")){e=0==Util.getDiffDay(NetData.now_unix_timestamp.low,t.last_share_time.low)}var i=new r({bShared:e});return i.setAddCountType(n.shareGame),i.setDelegate(this),i},_onCloseButtonClicked:function(e){MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),i.Destroy()},onSureAddPartakeMatchCount:function(e){MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch);switch(e.getAddCountType()){case n.diamond:this._handleAddCountByDiamond();break;case n.playGame:this._handleAddCountByPlayGame();break;case n.shareGame:this._handleAddCountByShareGame()}},_handleAddCountByDiamond:function(){var e=this._weekMatchData.getTicketId(),t=ConfigLoader.getPropGoodsConfig(e);if(null!=t){var i="",n=t.price_pkg_list[0].price;switch(t.price_type){case PriceType.DIAMONDS:i=cc.formatStr(Language.getString(LanguageKey.USE_DIAMONDS_BUY_WEEK_MATCH_TICKET),n);break;case PriceType.GOLD:i=cc.formatStr(Language.getString(LanguageKey.USE_COIN_BUY_WEEK_MATCH_TICKET),n)}OKCancelWindow.Show("",i,function(){this._buyWeekMatchTicket(t)}.bind(this))}},_handleAddCountByPlayGame:function(){"function"==typeof this._handleAddCountByPlayGameCallBack&&this._handleAddCountByPlayGameCallBack(),i.Destroy()},_handleAddCountByShareGame:function(){eventDispatcher.dispatchEvent(EventID.ON_SHARE_WEEK_MATCH,{customShareSuccessCallBack:function(){},customShareFailCallBack:function(){TipWindow.Show(Language.getString(LanguageKey.SHARE_FAIL))},weekMatchShareCallBack:function(e,t){if(null==e)TipWindow.Show(Language.getString(LanguageKey.SHARE_SUCCESS),function(){i.Destroy(),eventDispatcher.dispatchEvent(EventID.LOAD_WEEK_MATCH_GAME)}),Reporter.Beacon.onEvent(272,"Week_Match_share");else{var n=null!=e.ret_desc?e.ret_desc:Language.getString(LanguageKey.SHARE_FAIL);TipWindow.Show(n)}}})},_buyWeekMatchTicket:function(e,t){var n=e.price_type,a=e.price_pkg_list[0].price;if(GameUtil.isWealthEnough(n,a)){var o=e.article_id,s=e.price_pkg_list[0].amount,r=new BuyStagePropRequest(o,s,1);NetLoadingWindow.Show(),GameService.buyGoods(r,function(e,n){null!=n?("function"==typeof t&&t(n),NetLoadingWindow.Hide(),BuyPropWindow.Destroy(),i.Destroy(),TipWindow.Show(Language.getString(LanguageKey.BUY_PROP_SUCCESS),function(){eventDispatcher.dispatchEvent(EventID.LOAD_WEEK_MATCH_GAME)})):(NetLoadingWindow.Hide(),TipWindow.Show(e.ret_desc))}.bind(this))}else GameUtil.showExchangeWindowByPriceType(n)},onShowNotify:function(){this._initAddCountModelListView()},onShow:function(){},onHideNotify:function(){},onHide:function(){},onDestroyNotify:function(){},onDestroy:function(){},onCover:function(){},onResume:function(){}});i.GetInstance=function(){return null==i._instance&&(i._instance=new i),i._instance},i.Show=function(e,t){ResLoader.showSubResLoadingWindow(ResObjects.getResObject(ResObjectConfig.weekMatchCount),function(){var n=i.GetInstance();n.setWeekMatchData(e),n.setHandleAddCountByPlayGameCallBack(t),WindowManager.GetInstance().showWindow(n,null,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,i.Destroy)})},i.Hide=function(){WindowManager.GetInstance().hideWindow(i._instance)},i.Destroy=function(){WindowManager.GetInstance().destroyWindow(i._instance),i._instance=null};var n={diamond:1,playGame:2,shareGame:3},a=ccui.Widget.extend({_addCountType:null,_delegate:null,_option:null,ctor:function(e){this._super(),this._option=e},setAddCountType:function(e){this._addCountType=e},getAddCountType:function(){return this._addCountType},setDelegate:function(e){this._delegate=e},_sureAddCount:function(){this._delegate.onSureAddPartakeMatchCount(this)}}),o=a.extend({ctor:function(e){this._super(e);var t=UIHelper.createButton({normalFile:"item_add_count_3.png",bPlistTexture:!0,bPressedActionEnabled:!0,bTouchEnable:!0,anchorPoint:cc.p(0,0)});t.setZoomScale(.005),t.addClickEventListener(this._onSureButtonClicked.bind(this)),this.addChild(t),this.setContentSize(t.getContentSize())},_onSureButtonClicked:function(e){this._sureAddCount()}}),s=a.extend({ctor:function(e){this._super(e),e.currentCount<e.totalCount?this._enableSelectModel(e):this._unEnableSelectModel()},_enableSelectModel:function(e){(a=UIHelper.createButton({normalFile:"item_add_count_2.png",bPlistTexture:!0,bPressedActionEnabled:!0,bTouchEnable:!0,anchorPoint:cc.p(0,0)})).setZoomScale(.005),a.addClickEventListener(this._onSureButtonClicked.bind(this)),this.addChild(a),this.setContentSize(a.getContentSize());var t=a;(a=new ExtendLoadingBar({middleBarSpriteFrameName:"bar_red.png",rightBarSpriteFrameName:"bar_red_with_sharp.png",size:cc.size(330,15)})).setPosition(7,9);var i=e.currentCount/e.totalCount*100;a.setPercent(i),t.addChild(a);var n=e.currentCount+"/"+e.totalCount,a=UIHelper.createText({fontSize:20,content:n,position:cc.p(175,15),fontColor:cc.color(255,255,255)});t.addChild(a)},_unEnableSelectModel:function(){var e=UIHelper.createButton({normalFile:"item_add_count_2.png",disabledFile:"item_add_count_gray_2.png",bPlistTexture:!0,bPressedActionEnabled:!0,bTouchEnable:!0,anchorPoint:cc.p(0,0)});e.setEnabled(!1),this.addChild(e),this.setContentSize(e.getContentSize())},_onSureButtonClicked:function(e){this._sureAddCount()}}),r=a.extend({ctor:function(e){this._super(e),e.bShared?this._unEnableSelectModel():this._enableSelectModel()},_enableSelectModel:function(){var e=UIHelper.createButton({normalFile:"item_add_count_1.png",bPlistTexture:!0,bPressedActionEnabled:!0,bTouchEnable:!0,anchorPoint:cc.p(0,0)});e.setZoomScale(.005),e.addClickEventListener(this._onSureButtonClicked.bind(this)),this.addChild(e),this.setContentSize(e.getContentSize())},_unEnableSelectModel:function(){var e=UIHelper.createButton({normalFile:"item_add_count_1.png",disabledFile:"item_add_count_gray_1.png",bPlistTexture:!0,bPressedActionEnabled:!0,bTouchEnable:!0,anchorPoint:cc.p(0,0)});e.setEnabled(!1),this.addChild(e),this.setContentSize(e.getContentSize())},_onSureButtonClicked:function(e){this._sureAddCount()}});e.exports=i},function(e,t){"use strict";var i=WindowBase.extend({ctor:function(e){this._super();var t=UIHelper.createImage({imageFileName:e.bgFileName,position:UIHelper.getPosition(320,558)});this.addChild(t);var i=UIHelper.createButton({normalFile:"m_red_btn.png",bPressedActionEnabled:!0,bPlistTexture:!0,position:cc.p(t.getContentSize().width/2,58),bTouchEnable:!0});i.addClickEventListener(this._onSureButtonClicked.bind(this)),t.addChild(i);var n=new cc.Sprite;n.initWithSpriteFrameName("btn_title_isee.png"),n.setPosition(cc.p(i.getContentSize().width/2,40)),i.addChild(n)},_onSureButtonClicked:function(e){MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),console.log("sure button clicked"),i.Destroy()},onShowNotify:function(){},onShow:function(){},onHideNotify:function(){},onHide:function(){},onDestroyNotify:function(){},onDestroy:function(){},onCover:function(){},onResume:function(){}});i.GetInstance=function(e){return null==i._instance&&(i._instance=new i(e)),i._instance},i.Show=function(e){ResLoader.showSubResLoadingWindow(e.resObject,function(){var t=i.GetInstance(e);WindowManager.GetInstance().showWindow(t,null,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,i.Destroy)})},i.Hide=function(){WindowManager.GetInstance().hideWindow(i._instance)},i.Destroy=function(){WindowManager.GetInstance().destroyWindow(i._instance),i._instance=null},e.exports=i},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(7),s=i(16),r=function(e){function t(){var e,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var r=arguments.length,c=Array(r),l=0;l<r;l++)c[l]=arguments[l];return i=a=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),a.$prefab=o.Prefabs.NORMAL,a.$btns=[new s({color:s.Color.Green,label:"取消",tag:"cancel"}),new s({color:s.Color.Red,label:"确定",tag:"ok"})],n(a,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o),a(t,[{key:"beforeShow",value:function(){this.options=this.$args[0],this.options.$resGroupList&&(this.$resGroupList=this.options.$resGroupList),this.options.$width&&(this.$width=this.options.$width),this.options.$height&&(this.$height=this.options.$height)}},{key:"onBtnTouched",value:function(e,t){"ok"==t?this.options.okCallback&&this.options.okCallback():this.options.cancelCallback&&this.options.cancelCallback(),this.destroy()}},{key:"render",value:function(){if("function"==typeof this.options.render)this.$panel.addChild(this.options.render.call(this));else{var e=UIHelper.createText({position:cc.p(this.$panel.width/2,.55*this.$panel.height),fontSize:28,fontColor:cc.color(255,255,255),content:this.options.text,bIgnoreSize:!1});this.$panel.addChild(e),UIHelper.subsectionTextForUIText(e,this.options.text,450)}}}]),t}();e.exports=r},function(e,t){"use strict";var i=cc.Class.extend({_rankDataHandler:null,_weekMatchItem:null,_rankType:null,ctor:function(e){this._weekMatchItem=e,this._rankType=WeekMatchConfig[e.match_id].rankType,this._rankDataHandler=new RankData,this._checkClearInviteFriendLocalData()},refresh:function(){if(GameUtil.isAttributeExist("NetData.week_match_info_ntf.week_match_list"))if(Util.isArray(NetData.week_match_info_ntf.week_match_list))for(var e=0,t=NetData.week_match_info_ntf.week_match_list.length;e<t;e++){var i=NetData.week_match_info_ntf.week_match_list[e];if(i.match_id==this._weekMatchItem.match_id){this._weekMatchItem=i;break}}else console.log("NetData.week_match_info_ntf.week_match_list isnot Array");else console.log("NetData.week_match_info_ntf.week_match_list isnot exist")},getTicketId:function(){return this._weekMatchItem.ticket_id},getWeekMatchItem:function(){return this._weekMatchItem},getSendTicketNormstageNum:function(){return this._weekMatchItem.send_ticket_normstage_num},getMatchId:function(){return this._weekMatchItem.match_id},getTotalPage:function(){return this._rankDataHandler._totalPage},_checkClearInviteFriendLocalData:function(){GameUtil.isAttributeExist("NetData.week_match_info_ntf.rank_end_time.low")&&GameUtil.isAttributeExist("NetData.now_unix_timestamp.low")&&NetData.now_unix_timestamp.low>NetData.week_match_info_ntf.rank_end_time.low&&(StorageManager.clearWeekMatchInviteFriendData(this._weekMatchItem.match_id),StorageManager.clearWeekMatchGameState(this._weekMatchItem.match_id))},loadFirstPageRankData:function(){this.getWeekMatchRankData(0,null,!1),console.log("loadFirstPageRankData")},getWeekMatchRankData:function(e,t,i){var n=this._rankDataHandler.getRandPageDataByPageId(e+1);if(null==n){i&&NetLoadingWindow.Show();var a={rank_type:this._rankType,page_id:e,page_size:30},o=this;GameService.updateRankListByPage(a,function(e,n){null==e?function(e,t){for(var i=[],n=0,a=e.week_match_friend_list.length;n<a;n++){var o=e.week_match_friend_list[n];i.push(o.openid)}GameService.getPlayerBaseinfo({openid_list:i},function(e,i){null==e?"function"==typeof t&&t():console.log("WeekMatchData: 拉取基本信息失败")})}(n,function(){i&&NetLoadingWindow.Hide(),o._rankDataHandler.addRankListData(n);var e=o._rankDataHandler.getRandPageDataByPageId(n.page_id);"function"==typeof t&&t(e)}):console.log("err code: "+e.ret)})}else"function"==typeof t&&t(n)},getPlayerBaseInfo:function(e){if(e==NetData.user_info.openid)return{openid:NetData.user_info.openid,nick:NetData.user_info.nickname,pic:NetData.user_info.headimgurl};if(GameUtil.isAttributeExist("NetData.player_baseinfo_ntf.baseinfo_list")){var t=NetData.player_baseinfo_ntf.baseinfo_list;if(null!=t&&t.length>0)for(var i=0,n=t.length;i<n;i++){var a=t[i];if(e==a.openid)return a}}return null},onNotifyFriendSuccess:function(e){StorageManager.addWeekMatchInviteFriendData(this._weekMatchItem.match_id,e)},isInvited:function(e){var t=StorageManager.getWeekMatchInviteFriend(this._weekMatchItem.match_id);if(null==t)return!1;return-1!=t.indexOf(e)},clearAllRankData:function(){this._rankDataHandler.clearAllData()}});e.exports=i},function(e,t){"use strict";var i=WindowBase.extend({_rankRewardNtf:null,_rankRewardList:null,_rewardBgView:null,_getButtonClickedCallBack:null,ctor:function(){this._super(),this._initView()},_initView:function(){var e=UIHelper.createImage({imageFileName:"bg_dialog.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(570,540),capInsets:cc.rect(0,72,512,22),position:UIHelper.getPosition(320,612)});this.addChild(e);var t=e.getContentSize().width/2,i=UIHelper.createImage({imageFileName:"bg_light.png",bPlistTexture:!0,position:cc.p(t,600)});e.addChild(i);i=UIHelper.createImage({imageFileName:"icon_my_reward.png",bPlistTexture:!0,position:cc.p(t,525)});e.addChild(i);i=UIHelper.createImage({imageFileName:"icon_invole_reward.png",bPlistTexture:!0,position:cc.p(t,360)});e.addChild(i);i=UIHelper.createImage({imageFileName:"bg_reward.png",bPlistTexture:!0,position:cc.p(t,212)});e.addChild(i),this._rewardBgView=i;(i=UIHelper.createButton({normalFile:"rect_btn_red.png",bPlistTexture:!0,bPressedActionEnabled:!0,position:cc.p(t,52),bTouchEnable:!0})).addClickEventListener(this._onGetButtonClicked.bind(this)),e.addChild(i);var n=new cc.Sprite;n.initWithSpriteFrameName("m_word_get.png"),n.setPosition(i.getContentSize().width/2,35),i.addChild(n,1)},_onGetButtonClicked:function(e){MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),"function"==typeof this._getButtonClickedCallBack&&this._getButtonClickedCallBack(this._rankRewardNtf),this.setConfig(null,null,null),i.Destroy()},setConfig:function(e,t,i){this._rankRewardNtf=e,this._rankRewardList=t,this._getButtonClickedCallBack=i},onShowNotify:function(){this._rewardBgView.removeAllChildren();var e="";e=this._rankRewardNtf.total_rank>5?this._rankRewardNtf.self_rank>3?cc.formatStr(Language.getString(LanguageKey.WEEK_MATCH_REWARD_TITLE_1),this._rankRewardNtf.self_rank):cc.formatStr(Language.getString(LanguageKey.WEEK_MATCH_REWARD_TITLE_3),this._rankRewardNtf.self_rank):cc.formatStr(Language.getString(LanguageKey.WEEK_MATCH_REWARD_TITLE_2),this._rankRewardNtf.self_rank);var t=UIHelper.createText({fontSize:25,content:e,position:cc.p(20,106),fontColor:cc.color(42,146,158),anchorPoint:cc.p(0,.5)});this._rewardBgView.addChild(t);var i=UIHelper.createPanel({anchorPoint:cc.p(.5,0),position:cc.p(258,10),size:cc.size(480,60)});this._rewardBgView.addChild(i);for(var n=new SortViewGroup,a=0,o=this._rankRewardList.length;a<o;a++){var s=this._createRewardItem(this._rankRewardList[a]);s.setPosition(10,30-s.getContentSize().height/2),i.addChild(s),n.addView(s)}n.sort()},_createRewardItem:function(e){var t="";t=e.article_type==ArticleType.ARTICLE_TYPE_ATTR&&e.article_subtype==ArticleSubType.ARTICLE_SUB_TYPE_COIN?"icon_coin_reward.png":GameUtil.getGoodsImageById(e.article_type,e.article_subtype,e.article_id);var i=UIHelper.createImage({imageFileName:t,bPlistTexture:!0,anchorPoint:cc.p(0,.5)}),n=new cc.LabelBMFont("X"+e.article_count,res.number_white_fnt);n.setAnchorPoint(0,.5);var a=i.getContentSize().width+5+n.getContentSize().width,o=Math.max(i.getContentSize().height,n.getContentSize().height),s=UIHelper.createPanel({size:cc.size(a,o)});return i.setPosition(0,o/2),s.addChild(i),n.setPosition(i.getContentSize().width+5,o/2),s.addChild(n),s},onShow:function(){},onHideNotify:function(){},onHide:function(){},onDestroyNotify:function(){},onDestroy:function(){},onCover:function(){},onResume:function(){}});i.GetInstance=function(){return null==i._instance&&(i._instance=new i),i._instance},i.Show=function(e,t,n){ResLoader.showSubResLoadingWindow(ResObjects.getResObject(ResObjectConfig.weekMatchReward),function(){var a=i.GetInstance();a.setConfig(e,t,n),WindowManager.GetInstance().showWindow(a,null,!0,GameCommonDef.LAYER_Z_ORDER_POP_UP,!1,null,null,i.Destroy)})},i.Hide=function(){WindowManager.GetInstance().hideWindow(i._instance)},i.Destroy=function(){WindowManager.GetInstance().destroyWindow(i._instance),i._instance=null},e.exports=window.WeekMatchRewardWindow=i},function(e,t,i){"use strict";function n(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(63),s=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.map=!1}return a(e,[{key:"init",value:function(){var e,t=this;if(!this.map){var i=RemoveLogic.we4Proto.PassConditionType;this.map=(e={},n(e,i.kPassCondCollectChess,{}),n(e,i.kPassCondScore,{}),n(e,i.kPassCondCollectColor,{}),e),o.forEach(function(e){-1!=e.passConditionType&&(t.map[e.passConditionType][e.collectType]=e.successDescribe)})}}},{key:"getDescribe",value:function(e,t,i){try{var n=this.map[e][t];return cc.formatStr(n,i)}catch(e){return""}}}]),e}();window.PassConditionDescribe=new s},function(e,t){"use strict";e.exports=[{ID:1,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"最少要完成%d次消除",failDescribe:"没有完成%d次消除...",priority:1},{ID:2,passConditionType:2,collectType:"0",colorType:9,successDescribe:"要达到%d分哦!",failDescribe:"分数没达到一星分数%d分喔",priority:2},{ID:3,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"打倒本关BOSS",failDescribe:"没有打倒boss，子弹和宠物都太弱了呢",priority:3},{ID:4,passConditionType:1,collectType:"63",colorType:9,successDescribe:"收集%d个木箱!",failDescribe:">o<还有没打破的木箱喔",priority:4},{ID:5,passConditionType:8,collectType:"0",colorType:0,successDescribe:"收集%d个黄色棋子!",failDescribe:">_<没有消除足够的动物头像喔",priority:4},{ID:5,passConditionType:8,collectType:"1",colorType:1,successDescribe:"收集%d个红色棋子!",failDescribe:">_<没有消除足够的动物头像喔",priority:4},{ID:5,passConditionType:8,collectType:"2",colorType:2,successDescribe:"收集%d个棕色棋子!",failDescribe:">_<没有消除足够的动物头像喔",priority:4},{ID:5,passConditionType:8,collectType:"3",colorType:3,successDescribe:"收集%d个绿色棋子!",failDescribe:">_<没有消除足够的动物头像喔",priority:4},{ID:5,passConditionType:8,collectType:"4",colorType:4,successDescribe:"收集%d个蓝色棋子!",failDescribe:">_<没有消除足够的动物头像喔",priority:4},{ID:5,passConditionType:8,collectType:"5",colorType:5,successDescribe:"收集%d个紫色棋子!",failDescribe:">_<没有消除足够的动物头像喔",priority:4},{ID:6,passConditionType:1,collectType:"54",colorType:9,successDescribe:"收集%d块冰块!",failDescribe:"呜呜ToT，冰块没消完",priority:5},{ID:7,passConditionType:1,collectType:"8",colorType:9,successDescribe:"收集%d个气球!",failDescribe:">_<还有热气球没有收集到呢",priority:6},{ID:8,passConditionType:1,collectType:"9",colorType:9,successDescribe:"收集%d个糖果!",failDescribe:"ToT还有糖果没有收集到呢",priority:7},{ID:9,passConditionType:1,collectType:"95",colorType:9,successDescribe:"收集%d个果冻!",failDescribe:"ToT还有果冻没有收集到呢",priority:7},{ID:10,passConditionType:1,collectType:"69",colorType:9,successDescribe:"收集%d个大蘑菇!",failDescribe:">o<还有大蘑菇没打碎喔",priority:8},{ID:11,passConditionType:1,collectType:"68",colorType:9,successDescribe:"收集%d个甜甜圈!",failDescribe:">o<还有甜甜圈没被引爆喔",priority:9},{ID:12,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"消除足够的动物头像",failDescribe:">_<没有消除足够的动物头像喔",priority:10},{ID:13,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"消除足够的特殊头像",failDescribe:">_<没有消除足够的特殊头像喔",priority:11},{ID:14,passConditionType:1,collectType:"52",colorType:9,successDescribe:"铺满%d块草坪!",failDescribe:">o< 还需要铺上更多草坪喔",priority:12},{ID:15,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"",failDescribe:"炸弹爆炸了！ToT",priority:13},{ID:16,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"限时达到%d分",failDescribe:"",priority:14},{ID:17,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"拯救%d只阿宝",failDescribe:">o<还有阿宝被困在冰块下",priority:15},{ID:18,passConditionType:1,collectType:"91",colorType:9,successDescribe:"收集%d朵白云!",failDescribe:">o<还有白云没消除喔",priority:16},{ID:19,passConditionType:1,collectType:"15",colorType:9,successDescribe:"收集%d个泡泡!",failDescribe:">_<还没有收集到足够的气泡",priority:17},{ID:20,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"打倒本关BOSS",failDescribe:"没有打倒boss，是时候升级子弹咯",priority:3},{ID:21,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"打倒本关BOSS",failDescribe:"没有打倒boss，宠物等级不够高哦",priority:3},{ID:22,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"打倒本关BOSS",failDescribe:"没有打倒boss，该换只高星宠物咯",priority:3},{ID:23,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"打倒本关BOSS",failDescribe:"没有打倒boss，再变强一点点也许就赢了",priority:3},{ID:24,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"消除%d个果冻",failDescribe:">_<还有果冻没有消除喔",priority:18},{ID:25,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"收集%d朵四叶花",failDescribe:">o<没有收集足够的四叶花",priority:19},{ID:26,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"收集%d朵五叶花",failDescribe:">o<没有收集足够的五叶花",priority:20},{ID:27,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"收集%d个蝴蝶结",failDescribe:">o<没有收集足够的蝴蝶结",priority:21},{ID:28,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"收集%d个卜卜头",failDescribe:">o<没有收集足够的卜卜头",priority:22},{ID:29,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"收集%d个红包",failDescribe:">o<没有收集足够的红包",priority:23},{ID:30,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"收集%d朵樱花",failDescribe:">o<没有收集足够的樱花",priority:24},{ID:31,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"收集%d列小火车",failDescribe:">o<没有收集足够的小火车",priority:25},{ID:32,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"铺好%d块路段",failDescribe:">_<还有破路段没铺好喔",priority:26},{ID:33,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"抓到%d只小鸡仔",failDescribe:">o<没有抓到足够的小鸡仔",priority:27},{ID:34,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"收集到%d个晴天娃娃",failDescribe:">_<还有晴天娃娃没有收集到",priority:28},{ID:35,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"收集到%d个铃铛",failDescribe:">o<没有收集到足够的铃铛喔",priority:29},{ID:36,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"消除%d只章鱼",failDescribe:">o<还有章鱼没有消除掉喔",priority:30},{ID:37,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"收集到%d个星星",failDescribe:">_<没有收集到足够的星星",priority:31},{ID:38,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"收集到%d缕阳光",failDescribe:">_<没有收集到足够的阳光",priority:32},{ID:39,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"收集到%d枚金币",failDescribe:">o<没有收集到足够的金币呢",priority:33},{ID:40,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"打倒%d个绑匪兔",failDescribe:">o<还没有打倒绑匪兔…",priority:34},{ID:41,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"救出%d个仙人掌",failDescribe:">_<没有救出所有的仙人掌",priority:35},{ID:42,passConditionType:1,collectType:"41",colorType:9,successDescribe:"收集%d个小熊!",failDescribe:">o<没有收集足够的小熊",priority:7},{ID:100,passConditionType:-1,collectType:"",colorType:-1,successDescribe:"策划好坏",failDescribe:"ToT走投无路了呢",priority:100}]},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(63),o=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this._describeConfigList=[],this._passConditionDataList=[]}return n(e,[{key:"init",value:function(){for(var e=a,t=0;t<e.length;t++){var i=e[t];if(i.collectType&&i.collectType.length){var n=Util.clone(i);n.collectType=Util.splitStringToIntArray(n.collectType),this._describeConfigList.push(n)}}}},{key:"setPassConditionDataList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._passConditionDataList=e}},{key:"getFailDescribe",value:function(){var e=this._getDescribe(),t=e.resultList,i=e.warnList;if(0==t.length)return console.log("Error: 找不到失败描述: "+JSON.stringify(i)),null;if(1==t.length)return t[0];t.sort(function(e,t){return t.priority-e.priority});t[0].priority;t.forEach(function(e,t){e.priority,1});return t[Util.getRandom(0,0)]}},{key:"getSuccessDescribe",value:function(){var e=this._getDescribe(),t=e.resultList,i=e.warnList;return 0==t.length?(console.log("Error: 找不到成功描述: "+JSON.stringify(i)),"unKnown"):1==t.length?t[0]:(t.sort(function(e,t){return t.priority-e.priority}),t[0])}},{key:"_getDescribe",value:function(){var e=this._passConditionDataList,t=this._describeConfigList,i=[],n=[];return e.forEach(function(e){e.bFinish||(t.forEach(function(t){t.passConditionType===e.passConditionType&&t.collectType.forEach(function(n){if(n===e.collectType){var a=Util.clone(t);return a.successDescribe=cc.formatStr(a.successDescribe,e.count),a.failDescribe=cc.formatStr(a.failDescribe,e.count),void i.push(a)}})}),n.push(e))}),{resultList:i,warnList:n}}}]),e}();window.SettlementDescribe=new o},function(e,t,i){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),o=i(66),s=i(19),r=i(20),c=i(11),l=function(e){function t(){var e,i,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,s=Array(o),r=0;r<o;r++)s[r]=arguments[r];return i=a=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),a.$resGroupList=[ResObjects.getResObject(ResObjectConfig.jumpStage)],a.stageId=-1,n(a,i)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s),a(t,[{key:"beforeShow",value:function(){this.stageId=this.$args[0]}},{key:"render",value:function(){var e=this,t=this.$view,i=cc.p(cc.winSize.width/2,.47*cc.winSize.height),n=cc.pAdd(i,cc.p(0,115)),a=cc.pAdd(n,cc.p(0,-140)),s=cc.pAdd(a,cc.p(0,-105)),r=new Effect(res.jumppass2_json);r.setPosition(i),r.play(!0),t.addChild(r);var c=new cc.Sprite("#jump-bubble.png");c.setPosition(n),t.addChild(c);var l=new cc.Sprite("#jump-currhold.png");l.setPosition(n.x,n.y+60),t.addChild(l);var h=new cc.Sprite("#jump-star-yellow.png");h.setPosition(n.x-60,n.y),t.addChild(h);var u=new cc.Sprite("#jump-char.png");u.setPosition(a),t.addChild(u);var d=new cc.Sprite("#jump-title.png");d.setPosition(c.x,c.y+210),t.addChild(d);var p=UIHelper.createButton({normalFile:"jump-btn-dojump.png",bPlistTexture:!0,position:s,bTouchEnable:!0});p.addTouchEventListener(function(t,i){ccui.Widget.TOUCH_ENDED==i&&e.onDoJump()},this),t.addChild(p);var f=new cc.LabelBMFont(""+o.getJumpCostStarCount(this.stageId),res.number_white_fnt);f.setPosition(p.x+85,p.y+2),f.setScale(1.4),t.addChild(f);var _=new cc.LabelBMFont(""+o.getTotalStars(),res.number_white_fnt);_.setPosition(h.x+85,h.y-2),_.setScale(1.55),t.addChild(_);var g=new cc.LabelBMFont(""+this.stageId,res.number_gold_big_fnt);g.setPosition(d.x+42,d.y-4),g.setScale(1.5),t.addChild(g);var b=new cc.LabelTTF("过关后抵押的星星会返还哦!","Arial",24);b.setPosition(p.x,p.y-75),t.addChild(b);var m=this.jumpEffect=new Effect(res.jumppass3_json);m.setPosition(i),t.addChild(m);var y=new Effect(res.jumppass1_json);y.setPosition(i),y.play(!0),t.addChild(y);var w=UIHelper.createButton({normalFile:"btn_close_N.png",bPlistTexture:!0,position:cc.p(cc.visibleRect.width-80,d.y+50),bTouchEnable:!0});w.addTouchEventListener(function(t,i){ccui.Widget.TOUCH_ENDED==i&&e.destroy()},this),t.addChild(w)}},{key:"onDoJump",value:function(){var e=this,t=void 0,i=void 0,n=FrameController.GetInstance().getCurPage();return n&&n.onJumpStage?void c.parallel({effect:function(t){e.jumpEffect.play(!1),setTimeout(function(){t()},2e3)},listen:function(n){t=function(t){var a=e.getLastMaxStageId(t.userData);a>=e.stageId&&(i=a,n())},eventDispatcher.addBehaviorListener(EventID.STAGE_NTF,t)},jump:function(i){GameService.jumpStage({stage_id:e.stageId},function(n,a){n?(e.clearStageNtfListener(t),r.show(n.ret_desc)):a&&a.stage_id==e.stageId?i():(e.clearStageNtfListener(t),r.show("服务器忙，请稍后再试!(1)"))})}},function(a,o){if(e.clearStageNtfListener(t),e.destroy(),SureAdventureWindow.Destroy(),n.onJumpStage(),n.resetStageBtn(e.stageId,StageBtnState.JUMP),e.stageId<MAX_STAGE_ID){var s=e.stageId+1;n.resetStageBtn(s,StageBtnState.YELLOW),n.lastPassedStageId=i,n.max_stage_id=i,n.playOpenNextStageAni()}}):void r.show("服务器忙，请稍后再试!(0)")}},{key:"getLastMaxStageId",value:function(e){var t=e.info_list,i=t[t.length-1].stage_info_arry;return i[i.length-1].stage_id}},{key:"clearStageNtfListener",value:function(e){eventDispatcher.removeListener(EventID.STAGE_NTF,e)}}]),t}();e.exports=window.JumpStageDialog=l},function(e,t){"use strict";var i=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),n=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.oldJumpStageList=[],this.data={},this.bindEvent()}return i(e,[{key:"bindEvent",value:function(){var e=this;eventDispatcher.addBehaviorListener(EventID.STAGE_JUMP_INFO_NTF,function(t){e.data=t.userData})}},{key:"getJumpCostStarCount",value:function(e){return this.data.cur_can_jump_stage===parseInt(e,10)?this.data.cur_jump_stage_cost_star:0}},{key:"getTotalHoldStars",value:function(){try{var e=0;return this.data.jump_stage_list.forEach(function(t){e+=t.detain_star}),e}catch(e){return 0}}},{key:"getTotalStars",value:function(){return GameUtil.getAllStarNum()-this.getTotalHoldStars()}},{key:"canJump",value:function(e){return this.getJumpCostStarCount(e)>1}},{key:"isHold",value:function(e){try{for(var t=this.data.jump_stage_list,i=t.length,n=0;n<i;n++)if(t[n].stage_id==e)return t[n].detain_star;return 0}catch(e){return 0}}},{key:"isHoldMulti",value:function(e,t){for(var i=0,n=e;n<=t;n++)i+=this.isHold(n);return i}},{key:"recordOldData",value:function(){this.data.jump_stage_list?this.oldJumpStageList=this.data.jump_stage_list.slice(0):this.oldJumpStageList=[]}},{key:"isPassedHoldStage",value:function(e){for(var t=this.oldJumpStageList,i=0;i<t.length;i++)if(t[i].stage_id==e)return t[i].detain_star;return 0}}]),e}();e.exports=window.StageJumpData=new n}]);
var bDebug=!0,disableRecordPanel=!1,iphoneXMode=!1;cc.game.onStart=function(){GlobalObject.init(),console.log("cc.game.onStart");var e=wx.getSystemInfoSync();console.log("model : "+e.model);var o=e.screenHeight/e.screenWidth;cc.view.enableRetina(!0),cc.view.adjustViewPort(!0),o>1.8?(console.log("适配 iphone X"),iphoneXMode=!0,GameCommonDef.RESOLUTION_POLICY=cc.ResolutionPolicy.FIXED_WIDTH,cc.view.setDesignResolutionSize(GameCommonDef.DESIGN_RESOLUTION_SIZE.width,GameCommonDef.DESIGN_RESOLUTION_SIZE.height,cc.ResolutionPolicy.FIXED_WIDTH)):cc.view.setDesignResolutionSize(GameCommonDef.DESIGN_RESOLUTION_SIZE.width,GameCommonDef.DESIGN_RESOLUTION_SIZE.height,cc.ResolutionPolicy.FIXED_HEIGHT),cc.view.setOrientation(cc.ORIENTATION_PORTRAIT),(bDebug=0!==cc.game.config[cc.game.CONFIG_KEY.debugMode])&&window.DEBUG||(console.log=function(){}),console.log("winSize width: "+cc.winSize.width+", height: "+cc.winSize.height),window._launchOptions=wx.getLaunchOptionsSync(),window.getWXLaunchOptionsSync=function(){return window._launchOptions},GameUtil.isNoSound(window._launchOptions)&&(console.log("关闭声音开关"),MusicManager._bEffectEnable=!1,MusicManager._bMusicEnable=!1),wx.onShow(function(e){console.warn("回到前台"),console.warn("onShow.options = "+JSON.stringify(e||{})),XCXSDK.clearCustomShareData(),window._launchOptions=e;var o=window.getWXLaunchOptionsSync();if(GameUtil.isArenaMatch(o)){if(GameUtil.getArenaMatchOffDays(o)>30)return o.query.from="",void window.alert("群擂台已失效，请重新发起");var n=FrameController.GetInstance().getCurPageID();"MainGamePage"!=n&&"StageMapPage"!=n&&""!=n&&"PKRank"!=n&&(window.alert("需回到冒险大地图才可查看!"),o.query.from="")}eventDispatcher.dispatchEvent(EventID.ON_WX_SHOW)}),window.enterGamePageCount=0,wx.onHide(function(){console.warn("隐藏到后台");var e=FrameController.GetInstance().getCurPageID();window.enterGamePageCount>5&&"MainGamePage"!=e&&wx.exitMiniProgram()}),wx.onStickyStatusChange(function(e){e.isSticky?(console.log("被显示在聊天顶部"),eventDispatcher.dispatchEvent(EventID.STICKY_CALLBACK)):console.log("被取消显示在聊天顶部")}),window.isNetworkConnected=!0,wx.getNetworkType({success:function(e){console.warn(e.networkType);"none"==e.networkType?(console.warn("网络不可用"),window.isNetworkConnected=!1):(console.warn("网络可用"),window.isNetworkConnected=!0)}}),window.onNetworkChangeCallbacks={},wx.onNetworkStatusChange(function(e){console.warn("网络状态发生了变化"),console.warn(e.isConnected),console.warn(e.networkType),window.isNetworkConnected=e.isConnected;for(var o=window.onNetworkChangeCallbacks,n=Object.keys(o),i=null,t=0;t<n.length;t++)"function"==typeof(i=o[n[t]])&&i(e.isConnected)});cc.view.setResizeCallback(function(){eventDispatcher.dispatchEvent(EventID.ON_WINDOW_RESIZE)}),window.loginCallBack=function(){console.log("loginCallBack called"),HeartRecoveryLogic.init(),LoginLoadDelegate.onLoginFinished(),Loader.load()},window.loadConfigCallBack=function(){LoginLoadDelegate.onLoadConfigFinished()},1==NetData.loginStatus&&loginCallBack(),1==NetData.loadConfigStatus&&loadConfigCallBack(),LoginLoadDelegate.loadLoginBgMusic();var n=cc.LoaderScene.preload([],function(){},this);window.showEnvSwitch&&UIHelper.attachChangeEnvPanel(cc.p(20,cc.winSize.height-20),n);loadResources(function(){cc.profiler.init(),console.log("start run scene"),ResObjects.init(),GameDataDefine.init()});var i=function(){n._label.setString("Loading... 0%");var e={resObject:ResObjects.getResObject(ResObjectConfig.preLoad),loadingCallBack:function(e){n._label.setString("Loading... "+e+"%")},loadResSuccessCallBack:function(){n._label.setVisible(!1),window.noticeTip=function(){Service.subTipsEvent&&Service.subTipsEvent(function(e){TipWindow.Show(e.content,function(){return wx.exitMiniProgram(),"function"==typeof e.onClose&&e.onClose()},e.align||"",null,"公告",n)})},1==NetData.loadNoticeStatus&&noticeTip(),Service.getTipBlock&&Service.getTipBlock()||(LoginGameWindow.Show(function(){NoticeWindow.Destroy(),PageUtil.startPageWithLoading("StageMapPage",PageType.replace,ResObjects.getResObject(ResObjectConfig.allStage),{noMusic:!0,getMail:!0,firstToMap:!0})},!0,function(){},function(){},n),LoginLoadDelegate.onLoadResFinished())}};ResLoader._loadRes(e)};cc.loader.load(["res/pages/logo/timi_log.jpg","res/pages/logo/logo.jpg","res/pages/logo/logo_health_tips.png"],function(e,o){if(null==e){var t=new cc.Sprite("res/pages/logo/logo.jpg");t.setAnchorPoint(.5,.5),t.setPosition(cc.winSize.width/2,cc.winSize.height/2),t.setName("logo"),n.addChild(t),UIHelper.adjustLoginBg(t);var a=new cc.Sprite("res/pages/logo/logo_health_tips.png");a.setAnchorPoint(.5,0),a.setPosition(cc.winSize.width/2,20),a.setName("logo_tips"),n.addChild(a);var c=new cc.Sprite("res/pages/logo/timi_log.jpg");c.setPosition(cc.winSize.width/2,cc.winSize.height/2),c.setName("timi_logo"),n._logo.addChild(c),UIHelper.adjustLoginBg(c),setTimeout(function(){n._logo.removeFromParent(),n._logo=null},2500),setTimeout(function(){i()},3e3)}},this)},cc.game.run(); 
 			});
 		define("LocalResManager.js", function(require, module, exports){ 			
(function(){!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define("LocalResManager",[],b):"object"==typeof exports?exports.LocalResManager=b():a.LocalResManager=b()}(this,function(){return function(b){function c(e){if(d[e])return d[e].exports;var f=d[e]={exports:{},id:e,loaded:!1};return b[e].call(f.exports,f,f.exports,c),f.loaded=!0,f.exports}var d={};return c.m=b,c.c=d,c.p="",c(0)}([function(b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var d=function(){function b(b,c){for(var d,a=0;a<c.length;a++)d=c[a],d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(b,d.key,d)}return function(c,d,e){return d&&b(c.prototype,d),e&&b(c,e),c}}(),f=wx.getFileSystemManager(),a=function(){function a(){c(this,a),this.enable=!0,this.versionFile=wx.env.USER_DATA_PATH+"/ver.txt",this.resPath=wx.env.USER_DATA_PATH+"/res",this.gameVersion=window.GetCurVersion(),this.imageLoadingCache={},this.resLoadingCache={},this.downloadStartPoint={},this._loadCount=0,this._mkdirTryCount=0,this.enable&&this.checkVersion()}return d(a,[{key:"getUrl",value:function(a){return this.isInitLocal(a)?a:"https"!=a.slice(0,5)&&"//"!=a.slice(0,2)?window.remoteResPath+a:a}},{key:"isInitLocal",value:function(a){return"res/project.json"===a||"res/resource.json"===a||"res/pages/logo/timi_log.jpg"===a||"res/pages/logo/logo.jpg"===a||"res/pages/logo/logo_health_tips.png"===a||"res/effect/plist/Plist5.plist"===a||"res/effect/plist/Plist5.png"===a||"res/effect/loading/loading1.json"===a||"res/effect/loading/loading2.json"===a||"res/pages/login/loginUI.plist"===a||"res/pages/login/loginUI.png"===a||"res/mask.png"===a||"res/default.plist"===a||"res/default.png"===a||"res/effect/default_effect.json"===a||"res/pages/preRes/preResPlist.plist"===a||"res/pages/preRes/preResPlist.png"===a||"res/pages/ringMatchResult/mr_words_djjx.png"===a}},{key:"forceLocal",value:function(){}},{key:"checkVersion",value:function(){console.debug("LocalResManager->checkVersion");var a=!1;try{f.accessSync(this.versionFile),console.debug("LocalResManager->checkVersion : \u6709\u7248\u672C\u6587\u4EF6"),a=!0}catch(a){console.debug(a.message+","+a.stack),console.debug("LocalResManager->checkVersion : \u65E0\u7248\u672C\u6587\u4EF6"),this.tryWriteVersion(),this.tryMkdir()}a&&this.tryCompareVersion()}},{key:"resetMkdirTryCount",value:function(){this._mkdirTryCount=3}},{key:"tryWriteVersion",value:function(){console.debug("LocalResManager->tryWriteVersion");try{f.writeFileSync(this.versionFile,this.gameVersion,"utf8"),console.debug("LocalResManager->tryWriteVersion \u6210\u529F")}catch(a){console.debug("LocalResManager->tryWriteVersion error: "+a.message+","+a.stack)}}},{key:"tryMkdir",value:function(a){console.debug("LocalResManager->tryMkdir"),this.resetMkdirTryCount(),this._tryMkdir(!!a)}},{key:"_tryMkdir",value:function(a){console.debug("LocalResManager->_tryMkdir");try{f.mkdirSync(this.resPath),console.debug("LocalResManager->_tryMkdir \u6210\u529F")}catch(b){console.debug("LocalResManager->_tryMkdir error: "+b.message+","+b.stack),this._mkdirTryCount--?(console.debug("LocalResManager->_tryMkdir \u91CD\u8BD5"),this._tryMkdir(a)):a&&wx.showModal({title:"",content:"\u6587\u4EF6\u5939\u521B\u5EFA\u5931\u8D25!"+this.resPath,showCancel:!1}),console.debug("LocalResManager->_tryMkdir \u5931\u8D25")}}},{key:"tryCompareVersion",value:function(){console.debug("LocalResManager->tryCompareVersion");var a=!1;try{a=f.readFileSync(this.versionFile,"utf8")}catch(a){return console.debug(a.message+","+a.stack),void this.tryMkdir()}if(console.debug("LocalResVersion = "+a),console.debug("GameVersion = "+this.gameVersion),a!=this.gameVersion){console.debug("LocalResManager->tryCompareVersion \u7248\u672C\u4E0D\u4E00\u81F4");try{f.accessSync(this.resPath),console.debug("LocalResManager->tryCompareVersion res\u76EE\u5F55\u5B58\u5728")}catch(a){console.debug("LocalResManager->tryCompareVersion res\u76EE\u5F55\u4E0D\u5B58\u5728"+a.message+","+a.stack),this.tryMkdir()}try{console.debug("LocalResManager->tryCompareVersion \u5C1D\u8BD5\u6E05\u7406");var b=f.readdirSync(this.resPath)||[];console.debug("LocalResManager->tryCompareVersion "+b.length+"\u4E2A\u6587\u4EF6\u53EF\u4EE5\u6E05\u7406");for(var c=0;c<b.length;c++)f.unlinkSync(this.resPath+"/"+b[c]);console.debug("LocalResManager->tryCompareVersion \u6E05\u7406\u5B8C\u6BD5")}catch(a){console.debug("LocalResManager->tryCompareVersion \u6E05\u7406 error: "+a.message+","+a.stack)}this.tryWriteVersion()}else console.debug("LocalResManager->tryCompareVersion \u9632\u6B62\u8D70\u7F13\u5B58\u903B\u8F91\u65F6\u6CA1\u6709res\u76EE\u5F55"),this.tryMkdir()}},{key:"exists",value:function(a,b,c){f.access({path:a,success:function(){b&&b()},fail:function(a){c&&c(a)}})}},{key:"getRemoteUrl",value:function(a){return"https"!=a.slice(0,5)&&"//"!=a.slice(0,2)?window.remoteResPath+a+"?_t="+this._loadCount++:a}},{key:"getLocalPath",value:function(a){return this.resPath+"/"+a.replace(/(\\|\/)/g,"_")}},{key:"getResPath",value:function(a){return a.replace(window.remoteResPath,"")}},{key:"_loadRes",value:function(b,c,d,e,a){var f=this;if(b=this.getResPath(b),this.resLoadingCache[b])return void(c&&this.resLoadingCache[b].push(c));if(0==b.indexOf("http"))return void(a&&a(b));this.resLoadingCache[b]=[c];var g=this.getLocalPath(b);this.exists(g,function(){d&&d(b,g)},function(){var a=f.getRemoteUrl(b);console.warn("remote "+a),f.downloadStartPoint[b]=new Date().getTime(),wx.downloadFile({url:a,success:function(c){if(200==c.statusCode){console.warn("save file "+a);var h=new Date().getTime()-f.downloadStartPoint[b];console.warn("down load delta time:"+h+"ms "+a),f._saveToLocal(c.tempFilePath,g,function(){console.warn("sf ok  "+a),d&&d(b,g)},function(){f._emitFailCallbackList(b,"save file fail"),e&&e(b,f.getRemoteUrl(b))})}else console.warn("no save "+a),f._emitFailCallbackList(b,"down load fail "+c.statusCode),e&&e(b,f.getRemoteUrl(b))},fail:function(c){console.warn("fail read file remote "+a),console.warn(c);var d=new Date().getTime()-f.downloadStartPoint[b];console.warn("wait time:"+d+"ms "+a),f._emitFailCallbackList(b,c),e&&e(b,f.getRemoteUrl(b))}})})}},{key:"loadTxt",value:function(a){var b=this,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this._loadRes(a,c,function(a,c){b._loadTxtLocal(a,c)},function(){},function(a){b._loadTxtRemote(a,c)})}},{key:"loadAudio",value:function(a){var b=this,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this._loadRes(a,c,function(a,c){b._emitResCallbackList(a,c)},function(){},function(){})}},{key:"loadImage",value:function(a){var b=this,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this._loadRes(a,c,function(a,c){b._loadImageLocal(a,c)},function(){},function(a){b._loadImageRemote(a,c)})}},{key:"_loadTxtLocal",value:function(a,b){var c=this;f.readFile({filePath:b,encoding:"utf8",success:function(b){c._emitResCallbackList(a,b.data)},fail:function(a){console.error("_loadTxtLocal1",a)}})}},{key:"_loadTxtRemote",value:function(a,b){var c=new window.XMLHttpRequest;c.timeout=1e4,c.open("GET",a,!0),c.setRequestHeader("Accept-Charset","utf-8"),c.onreadystatechange=function(){4===c.readyState&&(200===c.status?b(null,c.responseText):b({status:c.status,errorMessage:"load "+a+" failed!"},null))}}},{key:"_loadImageLocal",value:function(b,c){var d=this,e=new Image;e.src=c,e.onload=function(){d._emitResCallbackList(b,e)},e.onerror=function(){d._emitFailCallbackList(b,"_loadImageLocal fail!")}}},{key:"_loadImageRemote",value:function(a,b){console.warn("_loadImageRemote : "+a);var c=new Image;c.src=a,c.onload=function(){b&&b(null,c)},c.onerror=function(a){console.warn("_loadImageRemote err"),console.error(a),b&&b({error:a})}}},{key:"_saveToLocal",value:function(b,c,d,g){f.saveFile({tempFilePath:b,filePath:c,success:function(){d&&d()},fail:function(a){console.warn("copy from["+b+"] to["+c+"] fail! = "+JSON.stringify(a)),g&&g()}})}},{key:"_emitResCallbackList",value:function(b,c){for(var d=this.resLoadingCache[b],e=0;e<d.length;e++)d[e]&&d[e](null,c);delete this.resLoadingCache[b]}},{key:"_emitFailCallbackList",value:function(b,c){for(var d=this.resLoadingCache[b],e=0;e<d.length;e++)d[e]&&d[e](c);delete this.resLoadingCache[b]}}]),a}();b.exports=new a}])})})(); 
 			});
 		define("RemoveLogic.js", function(require, module, exports){ 			
(function(){!function(a,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("protobufjs"),require("path"),require("fs")):"function"==typeof define&&define.amd?define("RemoveLogic",["protobufjs","path","fs"],e):"object"==typeof exports?exports.RemoveLogic=e(require("protobufjs"),require("path"),require("fs")):a.RemoveLogic=e(a.protobufjs,a.path,a.fs)}(this,function(a,o,t){var l=Math.round,S=Math.floor,E=Math.abs;return function(_){function e(n){if(t[n])return t[n].exports;var r=t[n]={exports:{},id:n,loaded:!1};return _[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var t={};return e.m=_,e.c=t,e.p="",e(0)}([function(a,e,t){"use strict";"undefined"==typeof window&&t(1);var n=t(5);a.exports=n},function(a,e,t){"use strict";t(2),t(3),t(4)},function(_,e,t){var R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},n,s;!function(a,r){"use strict";n=r,s="function"==typeof n?n.call(e,t,e,_):n,!(void 0!==s&&(_.exports=s))}(void 0,function(){var r=String.prototype,g=Array,n=g.prototype,k=Object,a=k.prototype,B=Function,o=B.prototype,Ge=String,_=Ge.prototype,ea=Number,s=ea.prototype,i=n.slice,l=n.splice,c=n.push,C=n.unshift,d=n.concat,p=n.join,T=o.call,I=o.apply,y=Math.max,N=Math.min,u=a.toString,h="function"==typeof Symbol&&"symbol"===R(Symbol.toStringTag),m=Function.prototype.toString,O=/^\s*class /,L=function(_){try{var e=m.call(_),t=e.replace(/\/\/.*\n/g,""),n=t.replace(/\/\*[.\s\S]*\*\//g,""),o=n.replace(/\n/gm," ").replace(/ {2}/g," ");return O.test(o)}catch(a){return!1}},A=function(a){try{return!L(a)&&(m.call(a),!0)}catch(a){return!1}},M=function(a){if(!a)return!1;if("function"!=typeof a&&"object"!==("undefined"==typeof a?"undefined":R(a)))return!1;if(h)return A(a);if(L(a))return!1;var o=u.call(a);return"[object Function]"===o||"[object GeneratorFunction]"===o},v=RegExp.prototype.exec,P=function(a){try{return v.call(a),!0}catch(a){return!1}},M,G;G=function(a){return"object"===("undefined"==typeof a?"undefined":R(a))&&(h?P(a):u.call(a)==="[object RegExp]")};var t=r.valueOf,w=function(a){try{return t.call(a),!0}catch(a){return!1}},f;f=function(a){return"string"==typeof a||"object"===("undefined"==typeof a?"undefined":R(a))&&(h?w(a):u.call(a)==="[object String]")};var D=k.defineProperty&&function(){try{var a={};for(var o in k.defineProperty(a,"x",{enumerable:!1,value:a}),a)return!1;return a.x===a}catch(a){return!1}}(),b=function(_){var e;return e=D?function(a,e,t,_){!_&&e in a||k.defineProperty(a,e,{configurable:!0,enumerable:!1,writable:!0,value:t})}:function(a,e,t,n){!n&&e in a||(a[e]=t)},function(t,n,o){for(var a in n)_.call(n,a)&&e(t,a,n[a],o)}}(a.hasOwnProperty),U=function(a){var o="undefined"==typeof a?"undefined":R(a);return null===a||"object"!==o&&"function"!==o},H=ea.isNaN||function(a){return a!==a},Q={ToInteger:function(a){var o=+a;return H(o)?o=0:0!=o&&o!=1/0&&o!=-(1/0)&&(o=(0<o||-1)*S(E(o))),o},ToPrimitive:function(e){var t,n,o;if(U(e))return e;if(n=e.valueOf,M(n)&&(t=n.call(e),U(t)))return t;if(o=e.toString,M(o)&&(t=o.call(e),U(t)))return t;throw new TypeError},ToObject:function(a){if(null==a)throw new TypeError("can't convert "+a+" to object");return k(a)},ToUint32:function(a){return a>>>0}},e=function(){};b(o,{bind:function(a){var t=this;if(!M(t))throw new TypeError("Function.prototype.bind called on incompatible "+t);for(var n=i.call(arguments,1),r=function(){if(this instanceof E){var o=I.call(t,this,d.call(n,i.call(arguments)));return k(o)===o?o:this}return I.call(t,a,d.call(n,i.call(arguments)))},s=y(0,t.length-n.length),_=[],l=0,E;l<s;l++)c.call(_,"$"+l);return E=B("binder","return function ("+p.call(_,",")+"){ return binder.apply(this, arguments); }")(r),t.prototype&&(e.prototype=t.prototype,E.prototype=new e,e.prototype=null),E}});var W=T.bind(a.hasOwnProperty),Z=T.bind(a.toString),V=T.bind(i),F=I.bind(i),Y=T.bind(_.slice),x=T.bind(_.split),z=T.bind(_.indexOf),K=T.bind(c),J=T.bind(a.propertyIsEnumerable),X=T.bind(n.sort),q=g.isArray||function(a){return"[object Array]"===Z(a)},j=1!==[].unshift(0);b(n,{unshift:function(){return C.apply(this,arguments),this.length}},j),b(g,{isArray:q});var $=k("a"),te="a"!==$[0]||!(0 in $),oe=function(a){var _=!0,t=!0,n=!1;if(a)try{a.call("foo",function(a,e,t){"object"!==("undefined"==typeof t?"undefined":R(t))&&(_=!1)}),a.call([1],function(){"use strict";t="string"==typeof this},"x")}catch(a){n=!0}return!!a&&!n&&_&&t};b(n,{forEach:function(e){var t=Q.ToObject(this),o=te&&f(this)?x(this,""):t,a=-1,_=Q.ToUint32(o.length),r;if(1<arguments.length&&(r=arguments[1]),!M(e))throw new TypeError("Array.prototype.forEach callback must be a function");for(;++a<_;)a in o&&("undefined"==typeof r?e(o[a],a,t):e.call(r,o[a],a,t))}},!oe(n.forEach)),b(n,{map:function(e){var t=Q.ToObject(this),a=te&&f(this)?x(this,""):t,n=Q.ToUint32(a.length),r=g(n),s;if(1<arguments.length&&(s=arguments[1]),!M(e))throw new TypeError("Array.prototype.map callback must be a function");for(var i=0;i<n;i++)i in a&&("undefined"==typeof s?r[i]=e(a[i],i,t):r[i]=e.call(s,a[i],i,t));return r}},!oe(n.map)),b(n,{filter:function(e){var t=Q.ToObject(this),a=te&&f(this)?x(this,""):t,r=Q.ToUint32(a.length),i=[],s,n;if(1<arguments.length&&(n=arguments[1]),!M(e))throw new TypeError("Array.prototype.filter callback must be a function");for(var l=0;l<r;l++)l in a&&(s=a[l],("undefined"==typeof n?e(s,l,t):e.call(n,s,l,t))&&K(i,s));return i}},!oe(n.filter)),b(n,{every:function(e){var t=Q.ToObject(this),o=te&&f(this)?x(this,""):t,a=Q.ToUint32(o.length),_;if(1<arguments.length&&(_=arguments[1]),!M(e))throw new TypeError("Array.prototype.every callback must be a function");for(var r=0;r<a;r++)if(r in o&&("undefined"==typeof _?!e(o[r],r,t):!e.call(_,o[r],r,t)))return!1;return!0}},!oe(n.every)),b(n,{some:function(e){var t=Q.ToObject(this),o=te&&f(this)?x(this,""):t,a=Q.ToUint32(o.length),_;if(1<arguments.length&&(_=arguments[1]),!M(e))throw new TypeError("Array.prototype.some callback must be a function");for(var r=0;r<a;r++)if(r in o&&("undefined"==typeof _?e(o[r],r,t):e.call(_,o[r],r,t)))return!0;return!1}},!oe(n.some));var ae=!1;n.reduce&&(ae="object"===R(n.reduce.call("es5",function(a,e,t,n){return n}))),b(n,{reduce:function(e){var t=Q.ToObject(this),n=te&&f(this)?x(this,""):t,o=Q.ToUint32(n.length);if(!M(e))throw new TypeError("Array.prototype.reduce callback must be a function");if(0===o&&1===arguments.length)throw new TypeError("reduce of empty array with no initial value");var a=0,_;if(2<=arguments.length)_=arguments[1];else for(;;){if(a in n){_=n[a++];break}if(++a>=o)throw new TypeError("reduce of empty array with no initial value")}for(;a<o;a++)a in n&&(_=e(_,n[a],a,t));return _}},!ae);var ne=!1;n.reduceRight&&(ne="object"===R(n.reduceRight.call("es5",function(a,e,t,n){return n}))),b(n,{reduceRight:function(e){var t=Q.ToObject(this),n=te&&f(this)?x(this,""):t,o=Q.ToUint32(n.length);if(!M(e))throw new TypeError("Array.prototype.reduceRight callback must be a function");if(0===o&&1===arguments.length)throw new TypeError("reduceRight of empty array with no initial value");var a=o-1,_;if(2<=arguments.length)_=arguments[1];else for(;;){if(a in n){_=n[a--];break}if(0>--a)throw new TypeError("reduceRight of empty array with no initial value")}if(0>a)return _;do a in n&&(_=e(_,n[a],a,t));while(a--);return _}},!ne);var aa=n.indexOf&&-1!==[0,1].indexOf(1,2);b(n,{indexOf:function(a){var e=te&&f(this)?x(this,""):Q.ToObject(this),t=Q.ToUint32(e.length);if(0===t)return-1;var n=0;for(1<arguments.length&&(n=Q.ToInteger(arguments[1])),n=0<=n?n:y(0,t+n);n<t;n++)if(n in e&&e[n]===a)return n;return-1}},aa);var se=n.lastIndexOf&&-1!==[0,1].lastIndexOf(0,-3);b(n,{lastIndexOf:function(a){var e=te&&f(this)?x(this,""):Q.ToObject(this),t=Q.ToUint32(e.length);if(0===t)return-1;var n=t-1;for(1<arguments.length&&(n=N(n,Q.ToInteger(arguments[1]))),n=0<=n?n:t-E(n);0<=n;n--)if(n in e&&a===e[n])return n;return-1}},se);var _e=function(){var a=[1,2],e=a.splice();return 2===a.length&&q(e)&&0===e.length}();b(n,{splice:function(){return 0===arguments.length?[]:l.apply(this,arguments)}},!_e);var ta=function(){var a={};return n.splice.call(a,0,0,1),1===a.length}();b(n,{splice:function(a,e){if(0===arguments.length)return[];var o=arguments;return this.length=y(Q.ToInteger(this.length),0),0<arguments.length&&"number"!=typeof e&&(o=V(arguments),2>o.length?K(o,this.length-a):o[1]=Q.ToInteger(e)),l.apply(this,o)}},!ta);var oa=function(){var a=new g(1e5);return a[8]="x",a.splice(1,1),7===a.indexOf("x")}(),na=function(){var a=256,e=[];return e[a]="a",e.splice(a+1,0,"b"),"a"===e[a]}();b(n,{splice:function(l,e){for(var t=Q.ToObject(this),o=[],a=Q.ToUint32(t.length),r=Q.ToInteger(l),i=0>r?y(a+r,0):N(r,a),s=N(y(Q.ToInteger(e),0),a-i),_=0,C;_<s;)C=Ge(i+_),W(t,C)&&(o[_]=t[C]),_+=1;var n=V(arguments,2),p=n.length,E;if(p<s){_=i;for(;_<a-s;)C=Ge(_+s),E=Ge(_+p),W(t,C)?t[E]=t[C]:delete t[E],_+=1;_=a;for(;_>a-s+p;)delete t[_-1],_-=1}else if(p>s)for(_=a-s;_>i;)C=Ge(_+s-1),E=Ge(_+p-1),W(t,C)?t[E]=t[C]:delete t[E],_-=1;_=i;for(var T=0;T<n.length;++T)t[_]=n[T],_+=1;return t.length=a-s+p,o}},!oa||!na);var _a=n.join,Ce;try{Ce="1,2,3"!==Array.prototype.join.call("123",",")}catch(a){Ce=!0}Ce&&b(n,{join:function(a){var o="undefined"==typeof a?",":a;return _a.call(f(this)?x(this,""):this,o)}},Ce);var Ee="1,2"!==[1,2].join(void 0);Ee&&b(n,{join:function(a){var o="undefined"==typeof a?",":a;return _a.call(this,o)}},Ee);var pe=function(){for(var e=Q.ToObject(this),a=Q.ToUint32(e.length),t=0;t<arguments.length;)e[a+t]=arguments[t],t+=1;return e.length=a+t,a+t},ra=function(){var a={},e=Array.prototype.push.call(a,void 0);return 1!==e||1!==a.length||"undefined"!=typeof a[0]||!W(a,0)}();b(n,{push:function(){return q(this)?c.apply(this,arguments):pe.apply(this,arguments)}},ra);var Te=function(){var a=[],e=a.push(void 0);return 1!==e||1!==a.length||"undefined"!=typeof a[0]||!W(a,0)}();b(n,{push:pe},Te),b(n,{slice:function(){var e=f(this)?x(this,""):this;return F(e,arguments)}},te);var Ie=function(){try{return[1,2].sort(null),[1,2].sort({}),!0}catch(a){}return!1}(),ye=function(){try{return[1,2].sort(/a/),!1}catch(a){}return!0}(),sa=function(){try{return[1,2].sort(void 0),!0}catch(a){}return!1}();b(n,{sort:function(e){if("undefined"==typeof e)return X(this);if(!M(e))throw new TypeError("Array.prototype.sort callback must be a function");return X(this,e)}},Ie||!sa||!ye);var ia=!J({toString:null},"toString"),ve=J(function(){},"prototype"),fe=!W("x","0"),me=function(a){var e=a.constructor;return e&&e.prototype===a},Oe={$window:!0,$console:!0,$parent:!0,$self:!0,$frame:!0,$frames:!0,$frameElement:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$external:!0,$width:!0,$height:!0},Le=function(){if("undefined"==typeof window)return!1;for(var a in window)try{!Oe["$"+a]&&W(window,a)&&null!==window[a]&&"object"===R(window[a])&&me(window[a])}catch(a){return!0}return!1}(),la=function(a){if("undefined"==typeof window||!Le)return me(a);try{return me(a)}catch(a){return!1}},Me=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],Re=Me.length,ge=function(a){return"[object Arguments]"===Z(a)},Pe=ge(arguments)?ge:function(e){return null!==e&&"object"===("undefined"==typeof e?"undefined":R(e))&&"number"==typeof e.length&&0<=e.length&&!q(e)&&M(e.callee)};b(k,{keys:function(e){var _=M(e),r=Pe(e),l=null!==e&&"object"===("undefined"==typeof e?"undefined":R(e)),d=l&&f(e);if(!l&&!_&&!r)throw new TypeError("Object.keys called on a non-object");var i=[];if(d&&fe||r)for(var s=0;s<e.length;++s)K(i,Ge(s));if(!r)for(var p in e)ve&&_&&"prototype"===p||!W(e,p)||K(i,Ge(p));if(ia)for(var T=la(e),I=0,E;I<Re;I++)E=Me[I],T&&"constructor"===E||!W(e,E)||K(i,E);return i}});var ke=k.keys&&function(){return 2===k.keys(arguments).length}(1,2),Ea=k.keys&&function(){var a=k.keys(arguments);return 1!==arguments.length||1!==a.length||1!==a[0]}(1),we=k.keys;b(k,{keys:function(a){return we(Pe(a)?V(a):a)}},!ke||Ea);var be=0!==new Date(-0xc782b5b342b24).getUTCMonth(),He=new Date(-0x55d318d56a724),Qe=new Date(14496624e5),We="Mon, 01 Jan -45875 11:59:59 GMT"!==He.toUTCString(),Ze=He.getTimezoneOffset(),Ve,Be;-720>Ze?(Ve="Tue Jan 02 -45875"!==He.toDateString(),Be=!/^Thu Dec 10 2015 \d\d:\d\d:\d\d GMT[-+]\d\d\d\d(?: |$)/.test(Qe+"")):(Ve="Mon Jan 01 -45875"!==He.toDateString(),Be=!/^Wed Dec 09 2015 \d\d:\d\d:\d\d GMT[-+]\d\d\d\d(?: |$)/.test(Qe+""));var Ue=T.bind(Date.prototype.getFullYear),Fe=T.bind(Date.prototype.getMonth),Ye=T.bind(Date.prototype.getDate),xe=T.bind(Date.prototype.getUTCFullYear),ze=T.bind(Date.prototype.getUTCMonth),je=T.bind(Date.prototype.getUTCDate),Ke=T.bind(Date.prototype.getUTCDay),Je=T.bind(Date.prototype.getUTCHours),Xe=T.bind(Date.prototype.getUTCMinutes),qe=T.bind(Date.prototype.getUTCSeconds),$e=T.bind(Date.prototype.getUTCMilliseconds),Ca=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],da=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],pa=function(a,e){return Ye(new Date(e,a,0))};b(Date.prototype,{getFullYear:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var a=Ue(this);return 0>a&&11<Fe(this)?a+1:a},getMonth:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var a=Ue(this),e=Fe(this);return 0>a&&11<e?0:e},getDate:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var a=Ue(this),e=Fe(this),t=Ye(this);if(0>a&&11<e){if(12===e)return t;var n=pa(0,a+1);return n-t+1}return t},getUTCFullYear:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var a=xe(this);return 0>a&&11<ze(this)?a+1:a},getUTCMonth:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var a=xe(this),e=ze(this);return 0>a&&11<e?0:e},getUTCDate:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var a=xe(this),e=ze(this),t=je(this);if(0>a&&11<e){if(12===e)return t;var n=pa(0,a+1);return n-t+1}return t}},be),b(Date.prototype,{toUTCString:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var _=Ke(this),e=je(this),t=ze(this),n=xe(this),o=Je(this),a=Xe(this),r=qe(this);return Ca[_]+", "+(10>e?"0"+e:e)+" "+da[t]+" "+n+" "+(10>o?"0"+o:o)+":"+(10>a?"0"+a:a)+":"+(10>r?"0"+r:r)+" GMT"}},be||We),b(Date.prototype,{toDateString:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var a=this.getDay(),e=this.getDate(),t=this.getMonth(),n=this.getFullYear();return Ca[a]+" "+da[t]+" "+(10>e?"0"+e:e)+" "+n}},be||Ve),(be||Be)&&(Date.prototype.toString=function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var C=this.getDay(),e=this.getDate(),t=this.getMonth(),n=this.getFullYear(),o=this.getHours(),a=this.getMinutes(),r=this.getSeconds(),i=this.getTimezoneOffset(),s=S(E(i)/60),_=S(E(i)%60);return Ca[C]+" "+da[t]+" "+(10>e?"0"+e:e)+" "+n+" "+(10>o?"0"+o:o)+":"+(10>a?"0"+a:a)+":"+(10>r?"0"+r:r)+" GMT"+(0<i?"-":"+")+(10>s?"0"+s:s)+(10>_?"0"+_:_)},D&&k.defineProperty(Date.prototype,"toString",{configurable:!0,enumerable:!1,writable:!0}));var Ta=-621987552e5,Ia="-000001",ca=Date.prototype.toISOString&&-1===new Date(Ta).toISOString().indexOf(Ia),ua=Date.prototype.toISOString&&"1969-12-31T23:59:59.999Z"!==new Date(-1).toISOString(),ya=T.bind(Date.prototype.getTime);b(Date.prototype,{toISOString:function(){if(!isFinite(this)||!isFinite(ya(this)))throw new RangeError("Date.prototype.toISOString called on non-finite value.");var a=xe(this),e=ze(this);a+=S(e/12),e=(e%12+12)%12;var t=[e+1,je(this),Je(this),Xe(this),qe(this)];a=(0>a?"-":9999<a?"+":"")+Y("00000"+E(a),0<=a&&9999>=a?-4:-6);for(var n=0;n<t.length;++n)t[n]=Y("00"+t[n],-2);return a+"-"+V(t,0,2).join("-")+"T"+V(t,2).join(":")+"."+Y("000"+$e(this),-3)+"Z"}},ca||ua);var Sa=function(){try{return Date.prototype.toJSON&&null===new Date(NaN).toJSON()&&-1!==new Date(Ta).toJSON().indexOf(Ia)&&Date.prototype.toJSON.call({toISOString:function(){return!0}})}catch(a){return!1}}();Sa||(Date.prototype.toJSON=function(){var e=k(this),a=Q.ToPrimitive(e);if("number"==typeof a&&!isFinite(a))return null;var t=e.toISOString;if(!M(t))throw new TypeError("toISOString property is not callable");return t.call(e)});var Na=Date.prototype.toLocaleString;Date.prototype.toLocaleString=function(){try{return Na()}catch(a){return""}};var ha=1e15===Date.parse("+033658-09-27T01:46:40.000Z"),Oa=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"))||!isNaN(Date.parse("2012-12-31T23:59:60.000Z")),La=isNaN(Date.parse("2000-01-01T00:00:00.000Z"));if(La||Oa||!ha){var ma=2147483647,Aa=H(new Date(1970,0,1,0,0,0,ma+1).getTime());Date=function(y){var e=function(l,d,o,a,r,i,s){var _=arguments.length,T;if(this instanceof y){var I=i,c=s;if(Aa&&7<=_&&s>ma){var E=S(s/ma)*ma,C=S(E/1e3);I+=C,c-=1e3*C}T=1===_&&Ge(l)===l?new y(e.parse(l)):7<=_?new y(l,d,o,a,r,I,c):6<=_?new y(l,d,o,a,r,I):5<=_?new y(l,d,o,a,r):4<=_?new y(l,d,o,a):3<=_?new y(l,d,o):2<=_?new y(l,d):1<=_?new y(l instanceof y?+l:l):new y}else T=y.apply(this,arguments);return U(T)||b(T,{constructor:e},!0),T},c=/^(\d{4}|[+-]\d{6})(?:-(\d{2})(?:-(\d{2})(?:T(\d{2}):(\d{2})(?::(\d{2})(?:(\.\d{1,}))?)?(Z|(?:([-+])(\d{2}):(\d{2})))?)?)?)?$/,_=[0,31,59,90,120,151,181,212,243,273,304,334,365],n=function(a,e){var t=1<e?1:0;return _[e]+S((a-1969+t)/4)-S((a-1901+t)/100)+S((a-1601+t)/400)+365*(a-1970)},a=function(e){var t=0,n=e;if(Aa&&n>ma){var o=S(n/ma)*ma,a=S(o/1e3);t+=a,n-=1e3*a}return ea(new y(1970,0,1,0,0,t,n))};for(var o in y)W(y,o)&&(e[o]=y[o]);b(e,{now:y.now,UTC:y.UTC},!0),e.prototype=y.prototype,b(e.prototype,{constructor:e},!0);return b(e,{parse:function(e){var t=c.exec(e);if(t){var o=ea(t[1]),r=ea(t[2]||1)-1,_=ea(t[3]||1)-1,s=ea(t[4]||0),l=ea(t[5]||0),u=ea(t[6]||0),E=S(1e3*ea(t[7]||0)),C=!(!t[4]||t[8]),p="-"===t[9]?1:-1,d=ea(t[10]||0),T=ea(t[11]||0),I;return s<(0<l||0<u||0<E?24:25)&&60>l&&60>u&&1e3>E&&-1<r&&12>r&&24>d&&60>T&&-1<_&&_<n(o,r+1)-n(o,r)&&(I=60*(24*(n(o,r)+_)+s+d*p),I=1e3*(60*(I+l+T*p)+u)+E,C&&(I=a(I)),-864e13<=I&&864e13>=I)?I:NaN}return y.parse.apply(this,arguments)}}),e}(Date)}Date.now||(Date.now=function(){return new Date().getTime()});var Ma=s.toFixed&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==0xde0b6b3a7640080.toFixed(0)),Ra={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function(a,e){for(var t=-1,n=e;++t<Ra.size;)n+=a*Ra.data[t],Ra.data[t]=n%Ra.base,n=S(n/Ra.base)},divide:function(a){for(var e=Ra.size,t=0;0<=--e;)t+=Ra.data[e],Ra.data[e]=S(t/a),t=t%a*Ra.base},numToString:function(){for(var a=Ra.size,e="";0<=--a;)if(""!==e||0===a||0!==Ra.data[a]){var t=Ge(Ra.data[a]);""===e?e=t:e+=Y("0000000",0,7-t.length)+t}return e},pow:function a(e,t,n){return 0===t?n:1==t%2?a(e,t-1,n*e):a(e*e,t/2,n)},log:function(a){for(var e=0,t=a;4096<=t;)e+=12,t/=4096;for(;2<=t;)e+=1,t/=2;return e}};b(s,{toFixed:function(l){var e,t,E,o,a,C,i,s;if(e=ea(l),e=H(e)?0:S(e),0>e||20<e)throw new RangeError("Number.toFixed called with invalid number of decimals");if(t=ea(this),H(t))return"NaN";if(-1e21>=t||1e21<=t)return Ge(t);if(E="",0>t&&(E="-",t=-t),o="0",1e-21<t)if(a=Ra.log(t*Ra.pow(2,69,1))-69,C=0>a?t*Ra.pow(2,-a,1):t/Ra.pow(2,a,1),C*=4503599627370496,a=52-a,0<a){for(Ra.multiply(0,C),i=e;7<=i;)Ra.multiply(1e7,0),i-=7;for(Ra.multiply(Ra.pow(10,i,1),0),i=a-1;23<=i;)Ra.divide(8388608),i-=23;Ra.divide(1<<i),Ra.multiply(1,1),Ra.divide(2),o=Ra.numToString()}else Ra.multiply(0,C),Ra.multiply(1<<-a,0),o=Ra.numToString()+Y("0.00000000000000000000",2,2+e);return 0<e?(s=o.length,o=s<=e?E+Y("0.0000000000000000000",0,e-s+2)+o:E+Y(o,0,s-e)+"."+Y(o,s-e)):o=E+o,o}},Ma);var Pa=function(){try{return"1"===1 .toPrecision(void 0)}catch(a){return!0}}(),ga=s.toPrecision;b(s,{toPrecision:function(a){return"undefined"==typeof a?ga.call(this):ga.call(this,a)}},Pa),2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||1<".".split(/()()/).length?!function(){var t="undefined"==typeof /()??/.exec("")[1];_.split=function(n,d){var p=this+"";if("undefined"==typeof n&&0===d)return[];if(!G(n))return x(this,n,d);var r=[],T=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.unicode?"u":"")+(n.sticky?"y":""),I=0,u=new RegExp(n.source,T+"g"),E,i,s,_;t||(E=new RegExp("^"+u.source+"$(?!\\s)",T));var y="undefined"==typeof d?4294967295:Q.ToUint32(d);for(i=u.exec(p);i&&(s=i.index+i[0].length,!(s>I&&(K(r,Y(p,I,i.index)),!t&&1<i.length&&i[0].replace(E,function(){for(var a=1;a<arguments.length-2;a++)"undefined"==typeof arguments[a]&&(i[a]=void 0)}),1<i.length&&i.index<p.length&&c.apply(r,V(i,1)),_=i[0].length,I=s,r.length>=y)));)u.lastIndex===i.index&&u.lastIndex++,i=u.exec(p);return I===p.length?!_&&u.test("")||K(r,""):K(r,Y(p,I)),r.length>y?V(r,0,y):r}}():["0"].length&&(_.split=function(a,o){return"undefined"==typeof a&&0===o?[]:x(this,a,o)});var Ga=_.replace,va=function(){var a=[];return"x".replace(/x(.)?/g,function(e,t){K(a,t)}),1===a.length&&"undefined"==typeof a[0]}();va||(_.replace=function(_,n){var e=M(n),a=G(_)&&/\)[*?]/.test(_.source);if(e&&a){var t=function(o){var e=arguments.length,t=_.lastIndex;_.lastIndex=0;var a=_.exec(o)||[];return _.lastIndex=t,K(a,arguments[e-2],arguments[e-1]),n.apply(this,a)};return Ga.call(this,_,t)}return Ga.call(this,_,n)});var Da=_.substr,ka="".substr&&"b"!=="0b".substr(-1);b(_,{substr:function(a,e){var t=a;return 0>a&&(t=y(this.length+a,0)),Da.call(this,t,e)}},ka);var Ba="\t\n\x0B\f\r \xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF",wa=/^[	\n\v\f\r   ᠎             　\u2028\u2029﻿][	\n\v\f\r   ᠎             　\u2028\u2029﻿]*/,fa=/[	\n\v\f\r   ᠎             　\u2028\u2029﻿][	\n\v\f\r   ᠎             　\u2028\u2029﻿]*$/,ba=_.trim&&(Ba.trim()||!"\u200B".trim());b(_,{trim:function(){if("undefined"==typeof this||null===this)throw new TypeError("can't convert "+this+" to object");return Ge(this).replace(wa,"").replace(fa,"")}},ba);var Ua=T.bind(r.trim),Ha=_.lastIndexOf&&-1!=="abc\u3042\u3044".lastIndexOf("\u3042\u3044",2);b(_,{lastIndexOf:function(l){if("undefined"==typeof this||null===this)throw new TypeError("can't convert "+this+" to object");for(var e=Ge(this),t=Ge(l),n=1<arguments.length?ea(arguments[1]):NaN,o=H(n)?1/0:Q.ToInteger(n),a=N(y(o,0),e.length),r=t.length,i=a+r;0<i;){i=y(0,i-r);var s=z(Y(e,i,a+r),t);if(-1!==s)return i+s}return-1}},Ha);var Qa=_.lastIndexOf;if(b(_,{lastIndexOf:function(){return Qa.apply(this,arguments)}},1!==_.lastIndexOf.length),8===parseInt(Ba+"08")&&22===parseInt(Ba+"0x16")||(parseInt=function(_){var e=/^[-+]?0[xX]/;return function(t,n){var o=Ua(t+""),a=ea(n)||(e.test(o)?16:10);return _(o,a)}}(parseInt)),1/parseFloat("-0")!=-(1/0)&&(parseFloat=function(a){return function(e){var t=Ua(e+""),n=a(t);return 0===n&&"-"===Y(t,0,1)?-0:n}}(parseFloat)),"RangeError: test"!==new RangeError("test")+""){var Wa=function(){if("undefined"==typeof this||null===this)throw new TypeError("can't convert "+this+" to object");var a=this.name;"undefined"==typeof a?a="Error":"string"!=typeof a&&(a=Ge(a));var o=this.message;return"undefined"==typeof o?o="":"string"!=typeof o&&(o=Ge(o)),a?o?a+": "+o:a:o};Error.prototype.toString=Wa}if(D){var Za=function(a,e){if(J(a,e)){var t=Object.getOwnPropertyDescriptor(a,e);t.configurable&&(t.enumerable=!1,Object.defineProperty(a,e,t))}};Za(Error.prototype,"message"),""!==Error.prototype.message&&(Error.prototype.message=""),Za(Error.prototype,"name")}if("/a/gim"!==/a/gim+""){var Va=function(){var a="/"+this.source+"/";return this.global&&(a+="g"),this.ignoreCase&&(a+="i"),this.multiline&&(a+="m"),a};RegExp.prototype.toString=Va}})},function(){"use strict";"function"!=typeof Object.assign&&(Object.assign=function(_){if(void 0===_||null===_)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(_),t=1,n;t<arguments.length;t++)if(n=arguments[t],void 0!==n&&null!==n)for(var o in n)n.hasOwnProperty(o)&&(e[o]=n[o]);return e})},function(){"use strict";var e=JSON.stringify;JSON.stringify=function(){try{return e.apply(JSON,arguments)}catch(a){return""}}},function(N,e,t){"use strict";function O(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},a=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),r=r||t(6),i=i||t(13),s=(r.eventId,s||t(29)),_=_||t(45),l=l||t(30),u=u||t(16),c=c||t(32),h=h||t(58),L=L||t(59),C=C||t(60),p=p||t(25),n=n||t(40),d=d||t(15),T=[108,244,267,385],y=function(){function d(e,a){O(this,d),this._workerMode=e,e&&(a&&"undefined"!=typeof console&&void 0!=("undefined"==typeof console?"undefined":o(console))||(self.console={log:function(){}})),console.log("new PuzzleGame"),i.curBoard=this.curBoard=new s(this),i.dataEventManager=this.eventManager=new r.eventManager(this),i.scoreManager=this.scoreManager=new r.scoreManager(this),i.stageManager=this.stageManager=new r.stageManager(this),i.aniManager=this.aniManager=new r.aniManager(this),i.passConditionManager=this.passConditionManager=new r.passConditionManager(this),i.moduleManager=this.moduleManager=new _,i.stateMachine=this.stateMachine=new l.PuzzleChessResolver,i.tableManager=this.tableManager=new u.TableManager,i.ruleManager=this.ruleManager=new c.RuleManager_,i.envManager=this.envManager=new h.EnvManager_,i.dataCollector=this.dataCollector=new L,i.itemManager=this.itemManager=new C.ItemManager_,i.recordManager=this.recordManager=new r.recordManager(this),i.statManager=this.statManager=new r.statManager(this),p.reset(),this.eventManager.globalBind(),i.envManager.SetIsWorkerMode(e)}return a(d,[{key:"Release",value:function(){p.reset(),i.Release(),this.curBoard=null,this.eventManager=null,this.scoreManager=null,this.stageManager=null,this.aniManager=null,this.passConditionManager=null,this.moduleManager=null,this.stateMachine=null,this.tableManager=null,this.ruleManager=null,this.envManager=null,this.dataCollector=null,this.itemManager=null,this.recordManager=null,this.statManager=null}},{key:"loadStage",value:function(a,_,e){var t=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;this.stageManager.loadStage(a,function(a){_&&_(a)},e,t)}},{key:"isNode",value:function(){return"undefined"==typeof window&&!this.isWorkerMode()}},{key:"isWorkerMode",value:function(){return this._workerMode}},{key:"getAnimation",value:function(){return this.aniManager.getAnimation()}},{key:"getAnimationNum",value:function(){return this.aniManager.getAnimationQueue().length}},{key:"getAnimationQueue",value:function(){return this.aniManager.getAnimationQueue()}},{key:"getStep",value:function(){return this.stageManager.getStep()}},{key:"getSuccessStep",value:function(){return this.stageManager.getSuccessStep()}},{key:"getStage",value:function(a){return this.stageManager.getStage(a)}},{key:"simple_stage_info",value:function(){return this.stageManager.simple_stage_info()}},{key:"getContainChessType",value:function(a){return this.stageManager.getContainChessType(a)}},{key:"checkPass",value:function(){return this.passConditionManager.getStatus()}},{key:"GetSodaLine",value:function(){return this.envManager.GetSodaLine()}},{key:"GetStartRow",value:function(){return this.curBoard.GetStartRow()}},{key:"IsSodaGame",value:function(){return this.stageManager.IsSodaGame()}},{key:"run",value:function(_,e){var t=this,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return!this.curBoard.inited_&&(this.loadStage(_.stage_id,function(){t.isSpecialStage(_.stage_id.id)&&(console.log("\u8FD9\u662F\u4E00\u4E2A\u7279\u6B8A\u5173\u5361"),t.envManager.isCollectSkidding=!1),t.stageManager.SaveStartInfo(_),t.recordManager.SetStarInfo(_),t.curBoard.Initializie(),n&&n()},e,o),!0)}},{key:"runWithRecord",value:function(_){var e=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},n=_.start_info;console.log("timePoint num is "+p.data.length),console.log("random num is "+p.randNumList.length),this.loadStage(n.stage_id,function(){e.isSpecialStage(n.stage_id.id)&&(console.log("\u8FD9\u662F\u4E00\u4E2A\u7279\u6B8A\u5173\u5361"),e.envManager.isCollectSkidding=!1),e.stageManager.SaveStartInfo(n),e.recordManager.SetStarInfo(n),e.curBoard.Initializie();var o=e.stateMachine.RunCycleReqStep(_);console.log("runLogic Times: "+p.runLogicTimes),0==o?t(!0,p.data):t(!1,p.data)})}},{key:"getRecord",value:function(){return this.recordManager.GetRecordOut()}},{key:"reset",value:function(){}},{key:"stop",value:function(){}},{key:"respawn",value:function(a){return i.curBoard.OnRespawn(a),!0}},{key:"isValidInput",value:function(){}},{key:"input",value:function(a){return!!this.validInput(a)&&this.stateMachine.Input(a)}},{key:"validInput",value:function(a){switch(a.op){case r.we4Proto.InputOp.kOpUseItem:return i.itemManager.ValidItemInput(a);case r.we4Proto.InputOp.kOpSlide:var e=E(a.from.row-a.to.row),t=E(a.from.col-a.to.col);if(0==e&&1==t||1==e&&0==t)return!0;}return!1}},{key:"enableAnimation",value:function(){}},{key:"getGameStatus",value:function(){return i.curBoard.GetGameState()}},{key:"continue_",value:function(){return i.stateMachine.Continue()}},{key:"release_",value:function(){i.curBoard=this.curBoard=null,i.dataEventManager=this.eventManager=null,i.scoreManager=this.scoreManager=null,i.stageManager=this.stageManager=null,i.aniManager=this.aniManager=null,i.passConditionManager=this.passConditionManager=null,i.moduleManager=this.moduleManager=null,i.stateMachine=this.stateMachine=null,i.tableManager=this.tableManager=null,i.ruleManager=this.ruleManager=null,i.envManager=this.envManager=null,i.dataCollector=this.dataCollector=null,i.itemManager=this.itemManager=null,i.recordManager=this.recordManager=null,i.statManager=this.statManager=null,i.eventManager=null,i.boardViewer=null}},{key:"getBoardInfo",value:function(){}},{key:"getModuleData",value:function(a){return i.moduleManager.GetModuleData(a,null)}},{key:"getPassCondition",value:function(){}},{key:"findActive",value:function(a,e){return null!=a&&(a=a||[],e=e||[],i.boardViewer.FindActiveItem(a,e))}},{key:"getNodeDataList",value:function(){for(var _=[],e=i.boardViewer,t=e.NodeCount(),n=0;n<t;n++){var o=e.GetNodeIndex(n),a=null;o&&o.IsAvailable()&&(a=o.ToNodeData()),_.push(a)}return _}},{key:"getWorldNodeDataList",value:function(){for(var _=[],e=this.curBoard.world_board_,t=e.length,n=0,o;n<t;n++)o=null,e[n]&&e[n].IsAvailable()&&(o=e[n].ToNodeData()),_.push(o);return _}},{key:"Local2World",value:function(a){return this.curBoard.Local2World(a)}},{key:"World2Local",value:function(a){return this.curBoard.World2Local(a)}},{key:"IsDiggerType",value:function(){return this.stageManager.IsDiggerType()}},{key:"IsNormalDigger",value:function(){return this.stageManager.IsNormalDigger()}},{key:"IsSodaDigger",value:function(){return this.stageManager.IsSodaDigger()}},{key:"logInputRecord",value:function(){var E=this.getRecord();console.log("Input Record:"),console.log("________________________________________________________________"),console.log("random_seed: "+E.start_info.random_seed),console.log("stage_id: "+E.start_info.stage_id.id),console.log("*****************************************************************");for(var e=E.input,t=e.length,n=0;n<t;n++){var o=e[n],a=o.op,r=o.from,i=o.to,s=o.item_type,_=o.value1,l=o.value2;console.log("input<"+(n+1)+">: [type:"+a+"  ("+r.row+","+r.col+")->("+i.row+","+i.col+")  item_type:"+s+"  val1:"+_+"  val2:"+l+"]")}console.log("*****************************************************************")}},{key:"logRecordString",value:function(){var a=this.getRecord(),e={start_info:a.start_info,input:a.input},t=JSON.stringify(e);console.log("Recrod Json String-------------------"),console.log(t)}},{key:"logFullRecordString",value:function(){var a=this.getRecord(),e=JSON.stringify(a);console.log("FullRecrod Json String-------------------"),console.log(e),this.logRandNumList()}},{key:"logRandNumList",value:function(){var a=JSON.stringify(p.randNumList);console.log("Rand Num List -------------"+p.randNumList.length),console.log(a)}},{key:"getChessboardLog",value:function(){return p.randNumList}},{key:"getCollectUnderIceList",value:function(){return n.PuzzleIceBearUtil.GetInstance().m_VecCollectUnderIce}},{key:"GetScale",value:function(){return 8/this.stageManager.Col()}},{key:"GetScalePositionAdd",value:function(){var a=this.GetScale();return 1<=a?{x:0,y:0}:{x:-2,y:7}}},{key:"isSpecialStage",value:function(a){for(var e=!1,t=0;t<T.length;t++)if(T[t]==a){e=!0;break}return e}}]),d}();N.exports={PuzzleGame:y,configProto:r.configProto,we4Proto:r.we4Proto,weTypeModule:r.weTypeModule,StageLoader:d}},function(a,e,t){"use strict";var n={eventManager:t(7),stageManager:t(9),scoreManager:t(21),aniManager:t(22),passConditionManager:t(26),recordManager:t(27),statManager:t(28),eventId:t(8),configProto:t(11),we4Proto:t(12),weTypeModule:t(17)};a.exports=n},function(_,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),s=t(8),a=function(){function a(e){n(this,a),this.gameIns=e}return o(a,[{key:"bind",value:function(a,e){return this._events=this._events||{},this._events[a]=this._events[a]||[],this._events[a].push(e),e}},{key:"unbind",value:function(a,e){this._events=this._events||{},!1!=a in this._events&&this._events[a].splice(this._events[a].indexOf(e),1)}},{key:"trigger",value:function(a){if(this._events=this._events||{},!1!=a in this._events)for(var e=0;e<this._events[a].length;e++)this._events[a][e].apply(this,Array.prototype.slice.call(arguments,1))}},{key:"globalBind",value:function(){var _=this.gameIns.scoreManager,e=this.gameIns.passConditionManager,t=this.gameIns.aniManager,n=this.gameIns.stageManager,o=this.gameIns.statManager,a=[_,n,e,t,o];this.bind(s.SWAP,function(a){n.responseEvent(s.SWAP,a),t.responseEvent(s.SWAP,a),o.responseEvent(s.SWAP,a)}),this.bind(s.END_ONE_REMOVE_ROUND,function(a){t.responseEvent(s.END_ONE_REMOVE_ROUND,a)}),this.bind(s.REMOVE,function(o){a.forEach(function(e){e.responseEvent(s.REMOVE,o.data||{})})}),this.bind(s.DROP,function(a){t.responseEvent(s.DROP,a)})}}]),a}();_.exports=a},function(a){"use strict";a.exports={DATACHANGE:"DATACHANGE",GAMESTART:"GAMESTART",SWAP:"SWAP",REMOVE:"REMOVE",DROP:"DROP",PASSCONDITION:"PASSCONDITION",START_ANIMATION:"START_ANIMATION",ON_ONE_BATCH_ANIMATION_PLAY_COMPLETE:"ON_ONE_BATCH_ANIMATION_PLAY_COMPLETE",END_ONE_REMOVE_ROUND:"END_ONE_REMOVE_ROUND",START_PLAY_PROP_ANIMATION:"START_PLAY_PROP_ANIMATION",PROP_ANIMATION_PLAY_COMPLETE:"PROP_ANIMATION_PLAY_COMPLETE"}},function(C,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),d=t(10),a=t(8),i=t(11),s=t(12),_=t(13),r=t(14),u=t(15),l=function(a){_.envManager.GetIsWorkerMode()?postMessage({msg:"LogPanel",data:a}):"undefined"!=typeof LogPanel&&LogPanel.addInfo(a)},E=function(){function E(e){n(this,E),this.gameIns=e,this.data={},this.step=0,this.step_success=0,this.simple_stage_info_=new s.SimpleStageInfo,this.start_info_=new s.StartInfo,this.extra_used_step_=0,this._isConveyer=!1}return o(E,[{key:"init",value:function(){this.step=this.data.step_num,this.condition=this.data.pass_condition,this.parseInternal()}},{key:"Decode",value:function(){for(var E=this.data.board_col,e=0,t=0,n=0,o=_.worldViewer,a=this.data.board_grid,r=a.length,i=0,y;i<r;i++){y=a[i],e=S(i/E),t=i%E;var u=o.GetNode(e,t);if(null!=u)for(var c=y.one_grid,N=c.length,C=0,p;C<N;C++){p=c[C],u.AddChessByElement(p);var d=_.tableManager.ElementIDToChessType(p.element_id);d==s.ChessType.STIT_BLUEBERRY&&n++}}n&&_.passConditionManager.initGLassCount(n);var T="\u5173\u5361\u89E3\u6790(puzzle_stage:"+this.data.puzzle_stage+", board_grid:"+r+", pass_condition "+this.data.pass_condition.length+")";return l(T),!0}},{key:"SaveStartInfo",value:function(a){this.start_info_=a}},{key:"start_info",value:function(){return this.start_info_}},{key:"config",value:function(){return this.data}},{key:"Row",value:function(){return this.data.board_row}},{key:"Col",value:function(){return this.data.board_col}},{key:"ScreenRow",value:function(){return this.simple_stage_info_.screen_row}},{key:"ScreenCol",value:function(){return this.simple_stage_info_.screen_col}},{key:"MaxColorCount",value:function(){return this.data.chess_color}},{key:"simple_stage_info",value:function(){return this.simple_stage_info_}},{key:"parseInternal",value:function(){this.simple_stage_info_.board_row=this.data.board_row,this.simple_stage_info_.board_col=this.data.board_col,this.simple_stage_info_.color_num=this.data.chess_color,this.simple_stage_info_.screen_row=this.data.board_col,this.simple_stage_info_.screen_col=this.data.board_col,this.simple_stage_info_.time_limit=this.data.time_num,this.simple_stage_info_.step_limit=this.data.step_num,this.simple_stage_info_.play_type=this.data.play_type,this.simple_stage_info_.puzzle_stage=this.data.puzzle_stage,this.simple_stage_info_.star_score=[this.data.onestar_score,this.data.twostar_score,this.data.threestar_score],this.simple_stage_info_.pass_condition=this.gameIns.passConditionManager.parsePassCondition(this.data),this.fillSimpleInfoWidthDesc()}},{key:"fillSimpleInfoWidthDesc",value:function(){if(this.data.puzzle_desc&&this.data.puzzle_desc.length)for(var a=0,t;t=this.data.puzzle_desc[a];a++)t.desc_type==i.DESC_TYPE.DESC_NEW_GUILD&&(this.simple_stage_info_.newbie_id=t.desc_data1)}},{key:"responseEvent",value:function(o,e){o==a.SWAP&&(3!=e.result||e.item||this.reduceStep(1))}},{key:"IsDiggerType",value:function(){var a=this.data.play_type;return i.PUZZLE_PLAYTYPE.PLAY_TYPE_DIGGER_SODA==a||i.PUZZLE_PLAYTYPE.PLAY_TYPE_DIGGER_MOSHING==a||i.PUZZLE_PLAYTYPE.PLAY_TYPE_DIGGER_ONEBYONE==a}},{key:"IsStoneDigger",value:function(){return this.data.play_type==i.PUZZLE_PLAYTYPE.PLAY_TYPE_DIGGER_ONEBYONE}},{key:"IsNormalDigger",value:function(){return this.data.play_type==i.PUZZLE_PLAYTYPE.PLAY_TYPE_DIGGER_MOSHING}},{key:"IsSodaGame",value:function(){return this.data.play_type==i.PUZZLE_PLAYTYPE.PLAY_TYPE_SODA||this.data.play_type==i.PUZZLE_PLAYTYPE.PLAY_TYPE_DIGGER_SODA}},{key:"IsSodaDigger",value:function(){return this.data.play_type==i.PUZZLE_PLAYTYPE.PLAY_TYPE_DIGGER_SODA}},{key:"IsConveyer",value:function(){return this._isConveyer}},{key:"PlayType",value:function(){return this.data.play_type}},{key:"GetDescValue",value:function(_){for(var e=this.data.puzzle_desc,t=e.length,n=0,o;n<t;n++)if(o=e[n],o.desc_type==_)return o.desc_data1;return-1}},{key:"loadStage",value:function(n){var E=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},C=this,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){},o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a=n.id+"_"+n.sub_id;console.log("loadStage "+a);var i=function(t){C.data=t,u.setStage(t,a),C.init(),E&&E(C.data)};if(u.hasStage(a))i(u.getStage(a));else if(this.gameIns.isNode()){var _=r.PuzzleConfig,s=t(19),p=t(20),c=getStagePath&&getStagePath()||"",T=s.resolve(c,this.getStageFileName(n)),I=p.createReadStream(T),y=[];I.on("data",function(a){y.push(a)}).on("end",function(){y=Buffer.concat(y);var a=_.decode(y);i(a)})}else{var S=0,N=function(){S<5?(S++,setTimeout(function(){h()},1e3)):e&&e()},h=function(){var e=o?o:window.remoteResPath,_=r.PuzzleConfig,a=d.Util.XHR();a.open("GET",e+"config/stage/"+C.getStageFileName(n),!0),a.responseType="arraybuffer",a.onload=function(){try{if(a.response.byteLength){var e=_.decode(a.response);i(e)}else l("Stage parse failed(length)"),console.log("Stage parse failed(length)"),N()}catch(a){l("Stage parse failed"),console.log("Stage parse failed"),N()}},a.onerror=function(){console.log("xhr.onerror"),N()},a.send(null)};h()}}},{key:"getFragmentName",value:function(_){var e=[0,0,0,0];_=_.toString().split("");for(var t=_.length,n=0;n<t;n++){var o=e.length-(n+1),a=_.pop();0<=o?e[o]=a:e.unshift(a)}return e.join("")}},{key:"getStageFileName",value:function(a){var e=this.getFragmentName(a.id),t=this.getFragmentName(a.sub_id);return"stage_"+e+"_"+t+".bin"}},{key:"getStage",value:function(a){if(a){var e=a.id+"_"+a.sub_id;return u.getStage(e)}return this.data}},{key:"getContainChessType",value:function(l){for(var e={},t=this.getStage(l),n=t.board_grid,o=n.length,a=0;a<o;a++)for(var r=n[a],S=r.one_grid,u=S.length,c=0;c<u;c++){var N=S[c],E=_.tableManager.ElementIDToChessType(N.element_id);E!=s.ChessType.STIT_NONE&&(void 0==e[E]?e[E]=1:e[E]+=1)}for(var a=0,C;a<t.pass_condition.length;a++)if(C=t.pass_condition[a],C.cond_type!=i.PASS_CONDITION_TYPE.PASS_CONDITION_AIBAO){var E=_.tableManager.GetChessTypeByConditionType(C.cond_type);void 0==e[E]?e[E]=1:e[E]+=1}else e[s.ChessType.STIT_ICE_BEAR_UNDER]=1;for(var p=_.stageManager.config().appear_rule,a=0,d=p.length,T;a<d;a++)if(T=p[a],0<T.appear_type){var I=T.appear_element,E=_.tableManager.ElementIDToChessType(I.element_id);E!=s.ChessType.STIT_NONE&&(void 0==e[E]?e[E]=1:e[E]+=1)}return e}},{key:"RecordSuccessStep",value:function(){this.step_success=0+this.step,_.envManager.GetIsWorkerMode()&&postMessage({msg:"UpdateData",data:[{key:"getSuccessStep",data:this.step_success}]})}},{key:"getSuccessStep",value:function(){return this.step_success}},{key:"getStep",value:function(){return this.step}},{key:"addStep",value:function(a){this.step+=a}},{key:"reduceStep",value:function(a){console.log("StageManager.reduceStep:"+a),this.step-=a}},{key:"GetMaxStep",value:function(){return this.data.step_num+_.envManager.GetAdditionSteps()}},{key:"GetRemainStep",value:function(){return this.step}},{key:"AddMaxStep",value:function(a){_.envManager.SetAdditionSteps(_.envManager.GetAdditionSteps()+a)}},{key:"ConsumeStep",value:function(a){this.extra_used_step_+=a,this.reduceStep(a)}},{key:"OnRespawn",value:function(){this.AddMaxStep(5+_.envManager.GetPetTalentRespawnAddSteps()),this.addStep(5+_.envManager.GetPetTalentRespawnAddSteps()),_.aniManager.GenerateAddFiveStepAnimation(),this.simple_stage_info_.set_step_limit=this.GetMaxStep()}}]),E}();C.exports=E},function(e){e.exports=a},function(a){"use strict";var e=function(){this.element_id=0,this.element_data1=0,this.element_data2=0,this.element_data3=0};a.exports={PUZZLE_GAME_ID:{GAME_ID_INVALID:0,GAME_ID_WEPANG:1,GAME_ID_ARRAY_LEN:3},PUZZLE_CRUSH_METHOD:{CRUSH_METHOD_INVALID:0,CRUSH_METHOD_3_MATCH:1,CRUSH_METHOD_TOUCH:2,CRUSH_METHOD_LINECONNECTION:3},PUZZLE_PURPOSE:{PUZZLE_PURPOSE_INVALID:0,PUZZLE_PURPOSE_NORMAL:1,PUZZLE_PURPOSE_ACTIVITY:2,PUZZLE_PURPOSE_WEEKLY:3},PUZZLE_PLAYTYPE:{PLAYTYPE_INVALID:0,PLAYTYPE_LIMITED_STEP:1,NOUSE_PLAYTYPE_STEP_OVER:2,PLAYTYPE_LIMITED_TIME:3,PLAY_TYPE_SODA:4,PLAY_TYPE_DIGGER_MOSHING:5,PLAY_TYPE_DIGGER_SODA:6,PLAY_TYPE_DIGGER_ONEBYONE:7,PLAY_TYPE_WEEKLY2_PETS_GO_HOME:8,PLAY_TYPE_WEEKLY3_AI_ALPHAGO:9,PLAY_TYPE_WEEKLY1_KO_BOSS:10},DESC_TYPE:{DESC_INVALID:0,NOUSE_DESC_BOSS_ID:1,NOUSE_DESC_BOSS_BLOOD:2,DESC_NEW_GUILD:3,DESC_SODA_LINE:4,DESC_SCREEN_ROW:5,DESC_SCREEN_COL:6,DESC_WEEKLY_BOSS_BLOOD:7,DESC_ICE_BEAR_LITTLE_NUM:10,DESC_ICE_BEAR_MIDDLE_NUM:11,DESC_ICE_BEAR_BIG_NUM:12,DESC_WEELY_AI_INTELLIGENCE:13,DESC_3_PIECE_MAOMAOCHONG:15,DESC_4_PIECE_MAOMAOCHONG:16,DESC_5_PIECE_MAOMAOCHONG:17,DESC_6_PIECE_MAOMAOCHONG:18,DESC_NEW_PLAYING:19,DESC_FORCE_SPECIFY_CHESS_COLOR:20,DESC_EGG_NEST_SPECIFY_GRID_PRIOR_PROBABILITY:21,DESC_POWERFUL_EGG_NEST_SPECIFY_GRID_PRIOR_PROBABILITY:22,DESC_OUTSIDE_MONSTER_PK_PET:23},PASS_CONDITION_TYPE:{PASS_CONDITION_INVALID:0,PASS_CONDITION_SCORE:1,PASS_CONDITION_BOSS:2,PASS_CONDITION_STEP_OVER:3,PASS_CONDITION_COLLECT_BALLOON:10,PASS_CONDITION_COLLECT_CANDY:11,PASS_CONDITION_COLLECT_SUNNY_DOLL:12,PASS_CONDITION_COLLECT_NORMAL_1:21,PASS_CONDITION_COLLECT_NORMAL_2:22,PASS_CONDITION_COLLECT_NORMAL_3:23,PASS_CONDITION_COLLECT_NORMAL_4:24,PASS_CONDITION_COLLECT_NORMAL_5:25,PASS_CONDITION_COLLECT_NORMAL_6:26,PASS_CONDITION_COLLECT_NORMAL_7:27,PASS_CONDITION_COLLECT_QIZI_SHOCKWAVE:30,PASS_CONDITION_COLLECT_QIZI_BLAST:31,PASS_CONDITION_COLLECT_QIZI_GHOST:32,PASS_CONDITION_COLLECT_BOTTOM_ICE:40,PASS_CONDITION_COLLECT_WOODENBOX:41,PASS_CONDITION_GENERATE_GRASS:42,PASS_CONDITION_AIBAO:43,PASS_CONDITION_SODA_QIZI:44,PASS_CONDITION_WIPEOUT_MAOQIU:45,PASS_CONDITION_COLLECT_PAPER:46,PASS_CONDITION_COLLECT_CLOUD_JEWEL:47,PASS_CONDITION_COLLECT_CLOUD_REDPACKET:48,PASS_CONDITION_COLLECT_4COLOR_CLOVER:49,PASS_CONDITION_COLLECT_5COLOR_FLOWER:50,PASS_CONDITION_COLLECT_BOBOTOU:51,PASS_CONDITION_COLLECT_YINGHUA:52,PASS_CONDITION_COLLECT_MAOMAOCHONG:53,PASS_CONDITION_COLLECT_JINGLE_BELL:54,PASS_CONDITION_COLLECT_HAWK_AND_CHICKEN_CHICKEN:55,PASS_CONDITION_PAVER_PATH:56,PASS_CONDITION_ELIMINATE_MUSHROOM_BIG:57,PASS_CONDITION_COLLECT_DOUGHNUT:58,PASS_CONDITION_COLLECT_STAR_TANK_STAR:59,PASS_CONDITION_ELIMINATE_FOAM_GUN:60,PASS_CONDITION_COLLECT_SUN_TANK_SUN:61,PASS_CONDITION_ELIMINATE_WE6_HEXAGON_MONSTER:62,PASS_CONDITION_ELIMINATE_WEP_SQUARE_MONSTER_STAGE:63,PASS_CONDITION_ELIMINATE_WEP_SQUARE_MONSTER_WEEKLY:64,PASS_CONDITION_ELIMINATE_WEP_SQUARE_SONW_MONSTER:65,PASS_CONDITION_COLLECT_GOLD_COIN:66,PASS_CONDITION_ELIMINATE_SHIELD:67},GRID_ELEMENT_ID:{ELEMENT_ID_INVALID:0,ELEMENT_QIGE_NULL:1,ELEMENT_QIGE_CONTAINER:2,ELEMENT_QIGE_CONTAINER_1:3,ELEMENT_QIGE_CONTAINER_2:4,ELEMENT_QIGE_SODALINE:6,ELEMENT_QIGE_SODALINE_1:7,ELEMENT_QIGE_SODALINE_2:8,ELEMENT_QIGE_CLEAR:100,ELEMENT_QIGE_END:199,ELEMENT_GONGNENG_BEGIN:1e3,ELEMENT_GONGNENG_WORMHOLE_START:1001,ELEMENT_GONGNENG_WORMHOLE_END:1002,ELEMENT_GONGNENG_BARRIER_RIGHTUP:1003,ELEMENT_GONGNENG_BARRIER_RIGHTDOWN:1004,ELEMENT_GONGNENG_BARRIER_DOWN:1005,ELEMENT_GONGNENG_BARRIER_RIGHT:1006,ELEMENT_GONGNENG_VERTICAL_TUNNEL_START:1007,ELEMENT_GONGNENG_VERTICAL_TUNNEL_END:1008,ELEMENT_GONGNENG_DROPPIONT_NORMAL:1010,ELEMENT_GONGNENG_DROPPIONT_SPECIAL:1011,ELEMENT_GONGNENG_APPEARPIONT_UP:1012,ELEMENT_GONGNENG_DROPPIONT_VALVEGATE:1013,ELEMENT_GONGNENG_APPEARPIONT_UP_VALVEGATE:1014,ELEMENT_GONGNENG_COLLECTPIONT_BALLOON:1020,ELEMENT_GONGNENG_COLLECTPIONT_SUGAR:1021,ELEMENT_GONGNENG_COLLECTPIONT_SODA:1022,ELEMENT_GONGNENG_COLLECTPIONT_CAOLIU:1024,ELEMENT_GONGNENG_TRAPDOOR_FRONT:1030,ELEMENT_GONGNENG_TRAPDOOR_BACK:1031,ELEMENT_GONGNENG_BLACKHOLE_ARRAY:1032,ELEMENT_GONGNENG_MAOMAOCHONG:1040,ELEMENT_GONGNENG_CONVEYOR:1060,ELEMENT_GONGNENG_CONVEYOR_UP:1061,ELEMENT_GONGNENG_CONVEYOR_DOWN:1062,ELEMENT_GONGNENG_CONVEYOR_RIGHT:1063,ELEMENT_GONGNENG_CONVEYOR_LEFT:1064,ELEMENT_GONGNENG_CONVEYOR_UP_RIGHT:1065,ELEMENT_GONGNENG_CONVEYOR_DOWN_RIGHT:1066,ELEMENT_GONGNENG_CONVEYOR_UP_LEFT:1067,ELEMENT_GONGNENG_CONVEYOR_DOWN_LEFT:1068,ELEMENT_GONGNENG_GOHOME_PATH:1080,ELEMENT_GONGNENG_PAVER_PATH:1100,ELEMENT_GONGNENG_END:1999,ELEMENT_QIDI_BEGIN:2e3,ELEMENT_QIDI_GRASSLAND:2001,ELEMENT_QIDI_WITHERED_GRASS:2002,ELEMENT_QIDI_ICE_1L:2005,ELEMENT_QIDI_ICE_2L:2006,ELEMENT_QIDI_ICE_3L:2007,ELEMENT_QIDI_ICE_4L:2008,ELEMENT_QIDI_ICE_5L:2009,ELEMENT_QIDI_ABAO:2010,ELEMENT_QIDI_ABAO_LITTLE:2011,ELEMENT_QIDI_ABAO_MIDDLE:2012,ELEMENT_QIDI_ABAO_BIG:2013,ELEMENT_QIDI_HONEY:2020,ELEMENT_QIDI_END:2999,ELEMENT_QIMIAN_BEGIN:3e3,ELEMENT_QIMIAN_CAGE_1L:3005,ELEMENT_QIMIAN_CAGE_2L:3006,ELEMENT_QIMIAN_CAGE_3L:3007,ELEMENT_QIMIAN_CAGE_4L:3008,ELEMENT_QIMIAN_CAGE_5L:3009,ELEMENT_QIMIAN_PAPER_1L:3010,ELEMENT_QIMIAN_PAPER_2L:3011,ELEMENT_QIMIAN_PAPER_3L:3012,ELEMENT_QIMIAN_PAPER_4L:3013,ELEMENT_QIMIAN_PAPER_5L:3014,ELEMENT_QIMIAN_MAOQIU_1L:3015,ELEMENT_QIMIAN_MAOQIU_2L:3016,ELEMENT_QIMIAN_MAOQIU_3L:3017,ELEMENT_QIMIAN_MAOQIU_4L:3018,ELEMENT_QIMIAN_MAOQIU_5L:3019,ELEMENT_QIMIAN_FOAM:3020,ELEMENT_QIMIAN_SNAIL_POO:3021,ELEMENT_QIMIAN_SNAIL:3030,ELEMENT_QIMIAN_SNAIL_LEFT:3031,ELEMENT_QIMIAN_SNAIL_RIGHT:3032,ELEMENT_QIMIAN_SNAIL_UP:3033,ELEMENT_QIMIAN_SNAIL_DOWN:3034,ELEMENT_QIMIAN_SNAIL_LEFTUP:3035,ELEMENT_QIMIAN_SNAIL_LEFTDOWN:3036,ELEMENT_QIMIAN_SNAIL_RIGHTUP:3037,ELEMENT_QIMIAN_SNAIL_RIGHTDOWN:3038,ELEMENT_QIMIAN_END:3999,ELEMENT_QIZI_BEGIN:4e3,ELEMENT_QIZI_NORMAL:4010,ELEMENT_QIZI_NORMAL_1:4011,ELEMENT_QIZI_NORMAL_2:4012,ELEMENT_QIZI_NORMAL_3:4013,ELEMENT_QIZI_NORMAL_4:4014,ELEMENT_QIZI_NORMAL_5:4015,ELEMENT_QIZI_NORMAL_6:4016,ELEMENT_QIZI_NORMAL_7:4017,ELEMENT_QIZI_NORMAL_RANDOM:4018,ELEMENT_QIZI_SHOCKWAVE_UP_DOWN:4020,ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_1:4021,ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_2:4022,ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_3:4023,ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_4:4024,ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_5:4025,ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_6:4026,ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_7:4027,ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_RANDOM:4028,ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT:4030,ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_1:4031,ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_2:4032,ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_3:4033,ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_4:4034,ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_5:4035,ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_6:4036,ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_7:4037,ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_RANDOM:4038,ELEMENT_QIZI_SHOCKWAVE_LEFTUP_RINGHTDOWN:4040,ELEMENT_QIZI_SHOCKWAVE_LEFTUP_RINGHTDOWN_1:4041,ELEMENT_QIZI_SHOCKWAVE_LEFTUP_RINGHTDOWN_2:4042,ELEMENT_QIZI_SHOCKWAVE_LEFTUP_RINGHTDOWN_3:4043,ELEMENT_QIZI_SHOCKWAVE_LEFTUP_RINGHTDOWN_4:4044,ELEMENT_QIZI_SHOCKWAVE_LEFTUP_RINGHTDOWN_5:4045,ELEMENT_QIZI_SHOCKWAVE_LEFTUP_RINGHTDOWN_6:4046,ELEMENT_QIZI_SHOCKWAVE_LEFTUP_RINGHTDOWN_7:4047,ELEMENT_QIZI_SHOCKWAVE_LEFTUP_RINGHTDOWN_RANDOM:4048,ELEMENT_QIZI_SHOCKWAVE_LEFTDOWN_RINGHTUP:4050,ELEMENT_QIZI_SHOCKWAVE_LEFTDOWN_RINGHTUP_1:4051,ELEMENT_QIZI_SHOCKWAVE_LEFTDOWN_RINGHTUP_2:4052,ELEMENT_QIZI_SHOCKWAVE_LEFTDOWN_RINGHTUP_3:4053,ELEMENT_QIZI_SHOCKWAVE_LEFTDOWN_RINGHTUP_4:4054,ELEMENT_QIZI_SHOCKWAVE_LEFTDOWN_RINGHTUP_5:4055,ELEMENT_QIZI_SHOCKWAVE_LEFTDOWN_RINGHTUP_6:4056,ELEMENT_QIZI_SHOCKWAVE_LEFTDOWN_RINGHTUP_7:4057,ELEMENT_QIZI_SHOCKWAVE_LEFTDOWN_RINGHTUP_RANDOM:4058,ELEMENT_QIZI_BLAST_CYCLONE:4060,ELEMENT_QIZI_BLAST_CYCLONE_1:4061,ELEMENT_QIZI_BLAST_CYCLONE_2:4062,ELEMENT_QIZI_BLAST_CYCLONE_3:4063,ELEMENT_QIZI_BLAST_CYCLONE_4:4064,ELEMENT_QIZI_BLAST_CYCLONE_5:4065,ELEMENT_QIZI_BLAST_CYCLONE_6:4066,ELEMENT_QIZI_BLAST_CYCLONE_7:4067,ELEMENT_QIZI_BLAST_CYCLONE_RANDOM:4068,ELEMENT_QIZI_BLAST_TRIANGLE:4070,ELEMENT_QIZI_BLAST_TRIANGLE_1:4071,ELEMENT_QIZI_BLAST_TRIANGLE_2:4072,ELEMENT_QIZI_BLAST_TRIANGLE_3:4073,ELEMENT_QIZI_BLAST_TRIANGLE_4:4074,ELEMENT_QIZI_BLAST_TRIANGLE_5:4075,ELEMENT_QIZI_BLAST_TRIANGLE_6:4076,ELEMENT_QIZI_BLAST_TRIANGLE_7:4077,ELEMENT_QIZI_BLAST_TRIANGLE_RANDOM:4078,ELEMENT_QIZI_BLAST_SNOWFLAKE:4080,ELEMENT_QIZI_BLAST_SNOWFLAKE_1:4081,ELEMENT_QIZI_BLAST_SNOWFLAKE_2:4082,ELEMENT_QIZI_BLAST_SNOWFLAKE_3:4083,ELEMENT_QIZI_BLAST_SNOWFLAKE_4:4084,ELEMENT_QIZI_BLAST_SNOWFLAKE_5:4085,ELEMENT_QIZI_BLAST_SNOWFLAKE_6:4086,ELEMENT_QIZI_BLAST_SNOWFLAKE_7:4087,ELEMENT_QIZI_BLAST_SNOWFLAKE_RANDOM:4088,ELEMENT_QIZI_BLAST_SUNFLOWER:4090,ELEMENT_QIZI_BLAST_SUNFLOWER_1:4091,ELEMENT_QIZI_BLAST_SUNFLOWER_2:4092,ELEMENT_QIZI_BLAST_SUNFLOWER_3:4093,ELEMENT_QIZI_BLAST_SUNFLOWER_4:4094,ELEMENT_QIZI_BLAST_SUNFLOWER_5:4095,ELEMENT_QIZI_BLAST_SUNFLOWER_6:4096,ELEMENT_QIZI_BLAST_SUNFLOWER_7:4097,ELEMENT_QIZI_BLAST_SUNFLOWER_RANDOM:4098,ELEMENT_QIZI_STEPBOMB:4100,ELEMENT_QIZI_STEPBOMB_1:4101,ELEMENT_QIZI_STEPBOMB_2:4102,ELEMENT_QIZI_STEPBOMB_3:4103,ELEMENT_QIZI_STEPBOMB_4:4104,ELEMENT_QIZI_STEPBOMB_5:4105,ELEMENT_QIZI_STEPBOMB_6:4106,ELEMENT_QIZI_STEPBOMB_7:4107,ELEMENT_QIZI_STEPBOMB_RANDOM:4108,ELEMENT_QIZI_EXTRASTEP:4110,ELEMENT_QIZI_EXTRASTEP_1:4111,ELEMENT_QIZI_EXTRASTEP_2:4112,ELEMENT_QIZI_EXTRASTEP_3:4113,ELEMENT_QIZI_EXTRASTEP_4:4114,ELEMENT_QIZI_EXTRASTEP_5:4115,ELEMENT_QIZI_EXTRASTEP_6:4116,ELEMENT_QIZI_EXTRASTEP_7:4117,ELEMENT_QIZI_EXTRASTEP_RANDOM:4118,ELEMENT_QIZI_EXTRATIME:4120,ELEMENT_QIZI_EXTRATIME_1:4121,ELEMENT_QIZI_EXTRATIME_2:4122,ELEMENT_QIZI_EXTRATIME_3:4123,ELEMENT_QIZI_EXTRATIME_4:4124,ELEMENT_QIZI_EXTRATIME_5:4125,ELEMENT_QIZI_EXTRATIME_6:4126,ELEMENT_QIZI_EXTRATIME_7:4127,ELEMENT_QIZI_EXTRATIME_RANDOM:4128,ELEMENT_QIZI_SODA_BUBBLE:4130,ELEMENT_QIZI_SODA_BUBBLE_1:4131,ELEMENT_QIZI_SODA_BUBBLE_2:4132,ELEMENT_QIZI_SODA_BUBBLE_3:4133,ELEMENT_QIZI_SODA_BUBBLE_4:4134,ELEMENT_QIZI_SODA_BUBBLE_5:4135,ELEMENT_QIZI_SODA_BUBBLE_6:4136,ELEMENT_QIZI_SODA_BUBBLE_7:4137,ELEMENT_QIZI_SODA_BUBBLE_RANDOM:4138,ELEMENT_QIZI_GOHOME_SMALL_MONSTER:4140,ELEMENT_QIZI_GOHOME_SMALL_MONSTER_1:4141,ELEMENT_QIZI_GOHOME_SMALL_MONSTER_2:4142,ELEMENT_QIZI_GOHOME_SMALL_MONSTER_3:4143,ELEMENT_QIZI_GOHOME_SMALL_MONSTER_4:4144,ELEMENT_QIZI_GOHOME_SMALL_MONSTER_5:4145,ELEMENT_QIZI_GOHOME_SMALL_MONSTER_6:4146,ELEMENT_QIZI_GOHOME_SMALL_MONSTER_7:4147,ELEMENT_QIZI_GOHOME_SMALL_MONSTER_RANDOM:4148,ELEMENT_QIZI_GOHOME_BIG_MONSTER:4150,ELEMENT_QIZI_GOHOME_BIG_MONSTER_1:4151,ELEMENT_QIZI_GOHOME_BIG_MONSTER_2:4152,ELEMENT_QIZI_GOHOME_BIG_MONSTER_3:4153,ELEMENT_QIZI_GOHOME_BIG_MONSTER_4:4154,ELEMENT_QIZI_GOHOME_BIG_MONSTER_5:4155,ELEMENT_QIZI_GOHOME_BIG_MONSTER_6:4156,ELEMENT_QIZI_GOHOME_BIG_MONSTER_7:4157,ELEMENT_QIZI_GOHOME_BIG_MONSTER_RANDOM:4158,ELEMENT_QIZI_PAVER:4160,ELEMENT_QIZI_PAVER_1:4161,ELEMENT_QIZI_PAVER_2:4162,ELEMENT_QIZI_PAVER_3:4163,ELEMENT_QIZI_PAVER_4:4164,ELEMENT_QIZI_PAVER_5:4165,ELEMENT_QIZI_PAVER_6:4166,ELEMENT_QIZI_PAVER_7:4167,ELEMENT_QIZI_PAVER_RANDOM:4168,ELEMENT_QIZI_JINGLE_BELL_1L:4170,ELEMENT_QIZI_JINGLE_BELL_1L_1:4171,ELEMENT_QIZI_JINGLE_BELL_1L_2:4172,ELEMENT_QIZI_JINGLE_BELL_1L_3:4173,ELEMENT_QIZI_JINGLE_BELL_1L_4:4174,ELEMENT_QIZI_JINGLE_BELL_1L_5:4175,ELEMENT_QIZI_JINGLE_BELL_1L_6:4176,ELEMENT_QIZI_JINGLE_BELL_1L_7:4177,ELEMENT_QIZI_JINGLE_BELL_1L_RANDOM:4178,ELEMENT_QIZI_JINGLE_BELL_2L:4180,ELEMENT_QIZI_JINGLE_BELL_2L_1:4181,ELEMENT_QIZI_JINGLE_BELL_2L_2:4182,ELEMENT_QIZI_JINGLE_BELL_2L_3:4183,ELEMENT_QIZI_JINGLE_BELL_2L_4:4184,ELEMENT_QIZI_JINGLE_BELL_2L_5:4185,ELEMENT_QIZI_JINGLE_BELL_2L_6:4186,ELEMENT_QIZI_JINGLE_BELL_2L_7:4187,ELEMENT_QIZI_JINGLE_BELL_2L_RANDOM:4188,ELEMENT_QIZI_TREASURE_BOX:4190,ELEMENT_QIZI_TREASURE_BOX_1:4191,ELEMENT_QIZI_TREASURE_BOX_2:4192,ELEMENT_QIZI_TREASURE_BOX_3:4193,ELEMENT_QIZI_TREASURE_BOX_4:4194,ELEMENT_QIZI_TREASURE_BOX_5:4195,ELEMENT_QIZI_TREASURE_BOX_6:4196,ELEMENT_QIZI_TREASURE_BOX_7:4197,ELEMENT_QIZI_TREASURE_BOX_RANDOM:4198,ELEMENT_QIZI_EGG_NEST_1L:4200,ELEMENT_QIZI_EGG_NEST_1L_1:4201,ELEMENT_QIZI_EGG_NEST_1L_2:4202,ELEMENT_QIZI_EGG_NEST_1L_3:4203,ELEMENT_QIZI_EGG_NEST_1L_4:4204,ELEMENT_QIZI_EGG_NEST_1L_5:4205,ELEMENT_QIZI_EGG_NEST_1L_6:4206,ELEMENT_QIZI_EGG_NEST_1L_7:4207,ELEMENT_QIZI_EGG_NEST_1L_RANDOM:4208,ELEMENT_QIZI_EGG_NEST_2L:4210,ELEMENT_QIZI_EGG_NEST_2L_1:4211,ELEMENT_QIZI_EGG_NEST_2L_2:4212,ELEMENT_QIZI_EGG_NEST_2L_3:4213,ELEMENT_QIZI_EGG_NEST_2L_4:4214,ELEMENT_QIZI_EGG_NEST_2L_5:4215,ELEMENT_QIZI_EGG_NEST_2L_6:4216,ELEMENT_QIZI_EGG_NEST_2L_7:4217,ELEMENT_QIZI_EGG_NEST_2L_RANDOM:4218,ELEMENT_QIZI_GHOST:4501,ELEMENT_QIZI_CHANGE_COLOR:4502,ELEMENT_QIZI_GOLD_COIN:4503,ELEMENT_QIZI_4COLOR_CLOVER:4504,ELEMENT_QIZI_5COLOR_FLOWER:4505,ELEMENT_QIZI_GOHOME_MONSTER_NEST:4506,ELEMENT_QIZI_CHANGE_COLOR_JINGLE_BELL_1L:4507,ELEMENT_QIZI_CHANGE_COLOR_JINGLE_BELL_2L:4508,ELEMENT_QIZI_CHANGE_COLOR_JINGLE_BELL_3L:4509,ELEMENT_QIZI_WOODENBOX_1L:4510,ELEMENT_QIZI_WOODENBOX_2L:4511,ELEMENT_QIZI_WOODENBOX_3L:4512,ELEMENT_QIZI_WOODENBOX_4L:4513,ELEMENT_QIZI_WOODENBOX_5L:4514,ELEMENT_QIZI_DIGGER_CHOCOLATE_1L:4515,ELEMENT_QIZI_DIGGER_CHOCOLATE_2L:4516,ELEMENT_QIZI_DIGGER_CHOCOLATE_3L:4517,ELEMENT_QIZI_DIGGER_CHOCOLATE_4L:4518,ELEMENT_QIZI_DIGGER_CHOCOLATE_5L:4519,ELEMENT_QIZI_DIGGER_CLOUD_1L:4520,ELEMENT_QIZI_DIGGER_CLOUD_2L:4521,ELEMENT_QIZI_DIGGER_CLOUD_3L:4522,ELEMENT_QIZI_DIGGER_CLOUD_4L:4523,ELEMENT_QIZI_DIGGER_CLOUD_5L:4524,ELEMENT_QIZI_DIGGER_CLOUD_JEWEL_1L:4525,ELEMENT_QIZI_DIGGER_CLOUD_JEWEL_2L:4526,ELEMENT_QIZI_DIGGER_CLOUD_JEWEL_3L:4527,ELEMENT_QIZI_DIGGER_CLOUD_JEWEL_4L:4528,ELEMENT_QIZI_DIGGER_CLOUD_JEWEL_5L:4529,ELEMENT_QIZI_DIGGER_CLOUD_REDPACKET_1L:4530,ELEMENT_QIZI_DIGGER_CLOUD_REDPACKET_2L:4531,ELEMENT_QIZI_DIGGER_CLOUD_REDPACKET_3L:4532,ELEMENT_QIZI_DIGGER_CLOUD_REDPACKET_4L:4533,ELEMENT_QIZI_DIGGER_CLOUD_REDPACKET_5L:4534,ELEMENT_QIZI_YINGHUACHUAN_1P:4535,ELEMENT_QIZI_YINGHUACHUAN_2P:4536,ELEMENT_QIZI_YINGHUACHUAN_3P:4537,ELEMENT_QIZI_YINGHUACHUAN_4P:4538,ELEMENT_QIZI_YINGHUACHUAN_5P:4539,ELEMENT_ID_QIZI_BOBOTOU_1L:4540,ELEMENT_ID_QIZI_BOBOTOU_2L:4541,ELEMENT_ID_QIZI_BOBOTOU_3L:4542,ELEMENT_ID_QIZI_BOBOTOU_4L:4543,ELEMENT_ID_QIZI_BOBOTOU_5L:4544,ELEMENT_QIZI_COLLECT_BALLOON:4550,ELEMENT_QIZI_COLLECT_CANDY:4551,ELEMENT_QIZI_SUNNY_DOLL_1:4552,ELEMENT_QIZI_SUNNY_DOLL_2:4553,ELEMENT_QIZI_SUNNY_DOLL_3:4554,ELEMENT_QIZI_COLLECT_4:4555,ELEMENT_QIZI_COLLECT_5:4556,ELEMENT_QIZI_COLLECT_6:4557,ELEMENT_QIZI_COLLECT_7:4558,ELEMENT_QIZI_COLLECT_8:4559,ELEMENT_QIZI_BUCKET:4560,ELEMENT_QIZI_WATER:4561,ELEMENT_QIZI_MUSHROOM_BIG:4562,ELEMENT_QIZI_MUSHROOM_SMALL:4563,ELEMENT_QIZI_GOHOME_START:4564,ELEMENT_QIZI_GOHOME_END:4565,ELEMENT_QIZI_DOUGHNUT:4566,ELEMENT_QIZI_CANDY_JAR:4567,ELEMENT_QIZI_HAWK_AND_CHICKEN_HAWK:4568,ELEMENT_QIZI_HAWK_AND_CHICKEN_CHICKEN:4569,ELEMENT_QIZI_HAWK_AND_CHICKEN_BIGCHICKEN:4570,ELEMENT_QIZI_STAR_TANK_TANK:4571,ELEMENT_QIZI_STAR_TANK_STAR:4572,ELEMENT_QIZI_SUN_TANK_TANK:4573,ELEMENT_QIZI_SUN_TANK_SUN:4574,ELEMENT_QIZI_ANTI_SHOCKWAVE_STONE:4575,ELEMENT_QIZI_COLOR_HATCHING_EGG:4576,ELEMENT_QIZI_GOHOME_ANGER_FRUIT:4577,ELEMENT_QIZI_FOAM_GUN:4580,ELEMENT_QIZI_FOAM_GUN_LEFT:4581,ELEMENT_QIZI_FOAM_GUN_RIGHT:4582,ELEMENT_QIZI_FOAM_GUN_UP:4583,ELEMENT_QIZI_FOAM_GUN_DOWN:4584,ELEMENT_QIZI_FOAM_GUN_LEFTUP:4585,ELEMENT_QIZI_FOAM_GUN_LEFTDOWN:4586,ELEMENT_QIZI_FOAM_GUN_RIGHTUP:4587,ELEMENT_QIZI_FOAM_GUN_RIGHTDOWN:4588,ELEMENT_QIZI_WEP_WOODENBOX_STONE_12:4590,ELEMENT_QIZI_WEP_WOODENBOX_STONE_23:4591,ELEMENT_QIZI_WEP_WOODENBOX_STONE_34:4592,ELEMENT_QIZI_WEP_WOODENBOX_STONE_41:4593,ELEMENT_QIZI_WE6_WOODENBOX_STONE_123:4594,ELEMENT_QIZI_WE6_WOODENBOX_STONE_234:4595,ELEMENT_QIZI_WE6_WOODENBOX_STONE_345:4596,ELEMENT_QIZI_WE6_WOODENBOX_STONE_456:4597,ELEMENT_QIZI_WE6_WOODENBOX_STONE_561:4598,ELEMENT_QIZI_WE6_WOODENBOX_STONE_612:4599,ELEMENT_QIZI_WE6_HEXAGON_MONSTER_CENTER_1L:4600,ELEMENT_QIZI_WE6_HEXAGON_MONSTER_EDGE_1L:4601,ELEMENT_QIZI_WE6_HEXAGON_MONSTER_CENTER_2L:4602,ELEMENT_QIZI_WE6_HEXAGON_MONSTER_EDGE_2L:4603,ELEMENT_QIZI_WE6_HEXAGON_MONSTER_CENTER_3L:4604,ELEMENT_QIZI_WE6_HEXAGON_MONSTER_EDGE_3L:4605,ELEMENT_QIZI_WE6_HEXAGON_MONSTER_CENTER_4L:4606,ELEMENT_QIZI_WE6_HEXAGON_MONSTER_EDGE_4L:4607,ELEMENT_QIZI_WE6_HEXAGON_MONSTER_CENTER_5L:4608,ELEMENT_QIZI_WE6_HEXAGON_MONSTER_EDGE_5L:4609,ELEMENT_QIZI_WEP_SQUARE_MONSTER_STAGE_CENTER:4610,ELEMENT_QIZI_WEP_SQUARE_MONSTER_STAGE_EDGE:4611,ELEMENT_QIZI_WEP_SQUARE_MONSTER_STAGE_1:4612,ELEMENT_QIZI_WEP_SQUARE_MONSTER_STAGE_2:4613,ELEMENT_QIZI_WEP_SQUARE_MONSTER_WEEKLY_CENTER:4615,ELEMENT_QIZI_WEP_SQUARE_MONSTER_WEEKLY_EDGE:4616,ELEMENT_QIZI_WEP_SQUARE_MONSTER_WEEKLY_1:4617,ELEMENT_QIZI_WEP_SQUARE_MONSTER_WEEKLY_2:4618,ELEMENT_QIZI_WEP_SQUARE_SNOW_MONSTER_CENTER:4620,ELEMENT_QIZI_WEP_SQUARE_SNOW_MONSTER_EDGE:4621,ELEMENT_QIZI_WEP_SQUARE_SNOW_MONSTER_1:4622,ELEMENT_QIZI_WEP_SQUARE_SNOW_MONSTER_2:4623,ELEMENT_QIZI_SUPPER_SHOCKWAVE_CANNON:4630,ELEMENT_QIZI_SUPPER_SHOCKWAVE_CANNON_LEFT:4631,ELEMENT_QIZI_SUPPER_SHOCKWAVE_CANNON_RIGHT:4632,ELEMENT_QIZI_SUPPER_SHOCKWAVE_CANNON_UP:4633,ELEMENT_QIZI_SUPPER_SHOCKWAVE_CANNON_DOWN:4634,ELEMENT_QIZI_SUPPER_SHOCKWAVE_CANNON_LEFTUP:4635,ELEMENT_QIZI_SUPPER_SHOCKWAVE_CANNON_LEFTDOWN:4636,ELEMENT_QIZI_SUPPER_SHOCKWAVE_CANNON_RIGHTUP:4637,ELEMENT_QIZI_SUPPER_SHOCKWAVE_CANNON_RIGHTDOWN:4638,ELEMENT_ID_QIZI_SHIELD_1L:4640,ELEMENT_ID_QIZI_SHIELD_2L:4641,ELEMENT_ID_QIZI_SHIELD_3L:4642,ELEMENT_ID_QIZI_SHIELD_4L:4643,ELEMENT_ID_QIZI_SHIELD_5L:4644,ELEMENT_QIZI_END:9999},APPEAR_RULE_TYPE:{APPEAR_RULE_INVALID:0,APPEAR_COLLECT_STEP:1,APPEAR_COLLECT_REMAIN:2,APPEAR_EXTRASTEP_STEP:3,APPEAR_EXTRASTEP_PROBABILITY:4,APPEAR_CHANGE_COLOR_STEP:5,APPEAR_CHANGE_COLOR_PROBABILITY:6,APPEAR_BOBOTOU_STEP:7,APPEAR_BOBOTOU_PROBABILITY:8,APPEAR_EXTRATIME_STEP:9,APPEAR_EXTRATIME_PROBABILITY:10,APPEAR_STEPBOMB_STEP:11,APPEAR_STEPBOMB_PROBABILITY:12,APPEAR_SODA_BUBBLE_STEP:13,APPEAR_SODA_BUBBLE_REMAIN:14,APPEAR_GOHOME_MOSTER_RISE_AGAIN:15,APPEAR_GOHOME_MOSTER_PER_PET_WALKSTEP:16,APPEAR_GOHOME_MOSTER_PER_USER_FINGERSLIDING:17,APPEAR_GOHOME_MOSTER_USER_FINGERSLIDING:18,APPEAR_JINGLE_BELL_STEP:19,APPEAR_JINGLE_BELL_PROBABILITY:20,APPEAR_JINGLE_BELL_CIRCLE:21,APPEAR_SODA_BUBBLE_CIRCLE:22,APPEAR_GOLD_COIN_STEP:23,APPEAR_GOLD_COIN_PROBABILITY:24,APPEAR_TREASURE_BOX_STEP:25,APPEAR_TREASURE_BOX_PROBABILITY:26,APPEAR_TREASURE_BOX_TRANSFORMATION:27},CHESS_COLOR:{CHESS_COLOR_INVALID:0,CHESS_COLOR_1:1,CHESS_COLOR_2:2,CHESS_COLOR_3:3,CHESS_COLOR_4:4,CHESS_COLOR_5:5,CHESS_COLOR_6:6,CHESS_COLOR_7:7,CHESS_COLOR_RANDOM:8},CONNECTED_DIRECTION:{CONNECTED_DIRECTION_INVALID:0,CONNECTED_DIRECTION_LEFT:1,CONNECTED_DIRECTION_RIGHT:2,CONNECTED_DIRECTION_UP:3,CONNECTED_DIRECTION_DOWN:4,CONNECTED_DIRECTION_LEFTUP:5,CONNECTED_DIRECTION_LEFTDOWN:6,CONNECTED_DIRECTION_RIGHTUP:7,CONNECTED_DIRECTION_RIGHTDOWN:8},DescItem:function(){this.desc_type=0,this.desc_data1=0,this.desc_data2=0},PassConditionItem:function(){this.cond_type=0,this.cond_data1=0,this.cond_data2=0},GridElement:e,BoardOneGrid:function(){this.one_grid=[]},BoardAppearRule:function(){this.appear_type=1,this.appear_element=new e,this.appear_pos=0,this.appear_data1=0,this.appear_data2=0},PuzzleConfig:function(){this.game_id=1,this.cursh_method=0,this.puzzle_purpose=0,this.puzzle_stage=0,this.puzzle_ver=0,this.puzzle_degree=0,this.play_type=0,this.step_num=0,this.time_num=0,this.board_row=9,this.board_col=9,this.chess_color=7,this.onestar_score=1200,this.twostar_score=2400,this.threestar_score=3600,this.puzzle_desc=[],this.pass_condition=[],this.board_grid=[],this.appear_rule=[],this.word_to_user="",this.modify_username=""}}},function(a,e,t){"use strict";var n=(t(11),{kInvalid:1,kFail:2,kSwap:3}),_=function(){this.row=0,this.col=0},r=function(){this.conveyerID=-1,this.direction=-1},s=function(){this.tick_count=0},i=function(){this.step_bonus=0},l=function(){this.max_health=0,this.current_health=0,this.attack_value=0},E=function(){this.type=0,this.horizontal=0},C=function(){this.id=0,this.sub_id=0},d=function(){this.random_seed=0,this.item_id_list=[],this.stage_id=new C},p=function(){this.crush_chess_count=[],this.crush_color_count=[],this.add_chess_count=[],this.add_color_count=[],this.slide_count=0,this.attack_count=[],this.drop_round_count=[],this.used_item=[],this.score=0};a.exports={SlideResult:n,InputOp:{kOpSlide:0,kOpUseItem:1,kOpRespawn:2},InputResult:{kInputSucc:0,kInputFail:1,kInputFailFence:2,kInputForbidden:3},GameStatus:{kGameRunning:0,kGamePass:1,kGameFail:2},ChessLayer:{kChessLayer0:0,kChessLayer1:1,kChessLayer2:2,kChessLayer3:3,kChessLayer4:4,kChessLayerNum:5,kChessLayerFeature:2e3},ChessType:{STIT_NONE:0,CT_START:1,CT_None:2,CT_NormalUnit:3,CT_SpecialVerticalShockWave:4,CT_SpecialHorizontalShockWave:5,CT_SpecialHurricane:6,CT_SpecialGas:7,CT_COLLECTBALLOON:8,CT_COLLECTCANDY:9,CT_CLODS0:10,CT_CLODS1:11,CT_GIFT:12,CT_TICKBOMB:13,CT_TIMEBONUS:14,CT_SodaBottle:15,CT_STEPBONUS:16,CT_Chameleon:17,CT_COMBINATION1:18,CT_COMBINATION2:19,CT_COMBINATION3:20,STIT_DROP_POINT:24,STIT_COLLECTBALLOON_POINT:25,STIT_COLLECTCANDY_POINT:26,STIT_DROP_POINT_IN_SODA:27,STIT_COLLECT_POINT_IN_SODA:28,STIT_COLLECT_POINT_IN_SODA_LEFT:29,STIT_COLLECT_POINT_IN_SODA_RIGHT:30,STIT_COLLECT_POINT_IN_SODA_BOTH:31,STIT_CHONGDONG1:32,STIT_CHONGDONG2:33,STIT_CONVEYER:34,STIT_CONVEYERLIGHT:35,STIT_FENCE_RIGHT:39,STIT_FENCE_BOTTOM:40,STIT_COLLECT_UNDER_ICE:41,STIT_LOCKER:43,STIT_NOUSE:51,STIT_BLUEBERRY:52,STIT_BAD_BLUEBERRY:53,STIT_ICE:54,STIT_DEEPICE:55,STIT_ICE_BEAR_UNDER:56,STIT_BOX:63,STIT_BOX_TWO:64,STIT_BOX_THREE:65,STIT_BOX_FOUR:66,STIT_CANDYPOT:67,STIT_DONUTSBOMB:68,STIT_HUGEMUSHROOM:69,STIT_LITTLEMUSHROOM:70,STIT_COMMONCLOUD1:71,STIT_COMMONCLOUD2:72,STIT_STONECLOUD1:73,STIT_STONECLOUD2:74,STIT_COLORCOLLECTION:75,STIT_ANIMAL_GO_HOME_ANIMAL:76,STIT_REDPACKET1:77,STIT_REDPACKET2:78,STIT_SOKOBAN_MAN:84,STIT_SOKOBAN_BOX:85,STIT_SUNNYDOLL1:87,STIT_SMALL_BELL:90,STIT_MAOQIU1:91,STIT_MAOQIU2:92,STIT_CAGE:93,STIT_CAGE2:94,STIT_CANDYPAPER1:95,STIT_CANDYPAPER2:96,STIT_CANDYPAPER3:97,STIT_CANDYPAPER4:98,STIT_CANDYPAPER5:99,STIT_BIG_BELL:100,STIT_Chameleon_SMALL_BELL:101,STIT_Chameleon_BIG_BELL:102,STIT_FOAM_CELL:108,STIT_FOAM_MACHINE:109,STIT_STONE:126,STIT_CANNON:132,STIT_EGG_NEST1:133,STIT_EGG_NEST2:134,STIT_DROP_VALVE:136,STIT_ANIMAL_GO_HOME_NEST:139,STIT_DROP_VALVE_IN_SODA:143},ChessColor:{kChessColorYellow:0,kChessColorRed:1,kChessColorBrown:2,kChessColorGreen:3,kChessColorBlue:4,kChessColorPurple:5,kChessColorWhite:6,kChessColorRandom:7,kChessColorTransparent:8,kChessColorNone:9,kChessColorCombination1:101,kChessColorCombination2:102,kChessColorCombination3:103},AttackType:{Attack_None:0,Attack_Normal:1,Attack_VerticalShockWave:2,Attack_HorizontalShockWave:3,Attack_Hurricane:4,Attack_CrossShockWave:5,Attack_ThickCrossShockWave:6,Attack_BigHurricane:7,Attack_Gas:8,Attack_Gas2Gas:9,Attack_Disappear:10,Attack_Bomb:11,Attack_Lastpang:12,Attack_GasSpecial:13,Attack_GasShockSave:14,Attack_GasHurricane:15,Attack_ShockWave:16},ItemId:{itemStepOut:1,itemGas:2,itemShockWave:3,itemHammer:4,itemSwap:5,itemGlass:6,itemRearrange:7,itemRollback:8,itemStepInner:9,itemRespawn:11,itemRandom:12,itemAddStep_1:13,itemAddStep_2:14,itemScoreAdd_5:15,itemScoreAdd_7:16,itemScoreAdd_9:17,itemHurricane:18},CollectType:{kCollectNoUse:1,kCollectCrush:2,kCollectAdd:3},PassConditionType:{kPassCondCollectChess:1,kPassCondScore:2,kPassCondBoss:3,kPassCondWeekGame1:4,kPassCondWeekGame2:5,kPassCondWeekGame3:6,kPassCondAllStep:7,kPassCondCollectColor:8,kPassCondLimitedStep:9,kPassCondDeadGame:11,kPassCondTickBomb:12},CrushRule:{kCrushNone:0,kCrushRule1:1,kCrushRule2:2,kCrushRule3:3},DropRule:{kDropNone:0,kDropRule1:1,kDropRule2:2,kDropRule3:3},AnimationId:{empty:0,swap:1,score:2,pass_condition:3,step:4,remove:5,drop:6,itemStep:7,itemGlass:8,itemRearrange:9,itemSwap:10,pass_through:11,step_reward_begin:12,step_reward_end:13,gas_special_end:14,gas_to_gas:15,rolling_board:16,generate_attack:17,replace_chess:18,collect_ice_bear:19,chess_move:20,maoqiu_split:21,change_color:22,bomb_warning:23,bomb_add_tick:24,tickbomb_bomb:25,tickbomb_tick:26,tickbomb_replace:27,scale_move:28,conveyer_move:29},Position:_,Input:function(){this.op=0,this.from=new _,this.to=new _,this.item_id=0,this.value1=0,this.value2=0},ChessData:function(){this.layer=-1,this.type=0,this.color=0,this.value=[],this.pos=new _,this.bomb_data=new s,this.step_bonus_data=new i,this.mushroom_data=new l,this.ice_bear_data=new E,this.conveyer_data=new r},NodeData:function(){this.chess_data=[],this.pos=new _},StageID:C,ChessCountItem:function(a,e){this.type=a,this.count=e},ColorCountItem:function(a,e){this.color=a,this.count=e},AttackCountItem:function(a,e){this.attack=a,this.count=e},StartInfo:d,RespawnInfo:function(){this.bullet_attack=0},GameInfo:p,PassConditionData:function(){this.pass_type=0,this.value1=0,this.value2=0,this.collect_type=0,this.result1=0,this.result2=0,this.is_fail=!1,this.is_ignore=!1,this.status=0,this.CollectType=0},PassCondition:function(){this.data=[],this.game_status=0},SimpleStageInfo:function(){this.pass_condition=[],this.step_limit=0,this.time_limit=0,this.play_type=0,this.color_num=0,this.board_row=0,this.board_col=0,this.screen_row=0,this.screen_col=0,this.boss_id=0,this.star_score=[],this.newbie_id=0,this.new_chess_type=0,this.new_chess_desc=""},StatisticData:function(){this.CrushChessCount=[],this.CrushColorCount=[],this.AddChessCount=[],this.AddColorCount=[],this.slide_count=0},Record:function(){this.start_info=new d,this.input=[],this.game_result=0,this.game_info=new p},ChessProperties:function(){this.attack_type=[],this.Layer=0,this.drop_rule=0,this.crush_rule=0,this.UseRearrange=!1,this.StopDrop=!1,this.StopDropIn=!1,this.StopSlide=!1,this.StopJoin=!1,this.UseSpecial=!1,this.UseSwap=!1,this.CanUseHammer=!1,this.CanCrushAround=!1,this.ForbidContinuousCrush=!1,this.IsCollection=!1,this.CanBeReplace=!1,this.CanSetCandy=!1,this.CanSetMaoqiu=!1,this.CanSetBlueberry=!1,this.CanSwapGhost=!1,this.CanSetStartItem=!1,this.CanChangeColor=!1,this.CanRandomColor=!1,this.CanAttackIce=!1,this.CanUseLastpang=!1,this.IsSpecialChess1=!1,this.IsSpecialChess2=!1,this.NextType=0,this.HP=0,this.Color=0,this.Score=0,this.ChessType=0,this.CanBeAroundCrushed=!1,this.CanSlide=!1,this.collect_type=0,this.Compatible4GridBoss=!1},ChessPropertiesArray:function(){this.items=[]},ModuleData:function(){this.value=[]},ConveyerPosition:function(){this.pos=[]},ConveyerData:function(){this.path=[]}}},function(a){"use strict";var e={curBoard:null,boardViewer:null,worldViewer:null,eventManager:null,moduleManager:null,stateMachine:null,stageManager:null,scoreManager:null,tableManager:null,passConditionManager:null,aniManager:null,envManager:null,ruleManager:null,dataEventManager:null,dataCollector:null,itemManager:null,recordManager:null,statManager:null};e.Release=function(){console.log("Mgr Release"),this.curBoard=null,this.boardViewer=null,this.worldViewer=null,this.eventManager=null,this.moduleManager=null,this.stateMachine=null,this.stageManager=null,this.scoreManager=null,this.tableManager=null,this.passConditionManager=null,this.aniManager=null,this.envManager=null,this.ruleManager=null,this.dataEventManager=null,this.dataCollector=null,this.itemManager=null,this.recordManager=null,this.statManager=null},a.exports=e},function(a,e,t){"use strict";a.exports=t(10).newBuilder({}).import({package:null,messages:[{name:"DescItem",fields:[{rule:"optional",type:"DESC_TYPE",name:"desc_type",id:1},{rule:"optional",type:"int32",name:"desc_data1",id:2},{rule:"optional",type:"int32",name:"desc_data2",id:3}]},{name:"PassConditionItem",fields:[{rule:"optional",type:"PASS_CONDITION_TYPE",name:"cond_type",id:1},{rule:"optional",type:"int32",name:"cond_data1",id:2},{rule:"optional",type:"int32",name:"cond_data2",id:3}]},{name:"BoardOneGrid",fields:[{rule:"repeated",type:"GridElement",name:"one_grid",id:1}]},{name:"GridElement",fields:[{rule:"optional",type:"GRID_ELEMENT_ID",name:"element_id",id:1},{rule:"optional",type:"int32",name:"element_data1",id:2},{rule:"optional",type:"int32",name:"element_data2",id:3},{rule:"optional",type:"int32",name:"element_data3",id:4}]},{name:"BoardAppearRule",fields:[{rule:"optional",type:"APPEAR_RULE_TYPE",name:"appear_type",id:1},{rule:"optional",type:"GridElement",name:"appear_element",id:2},{rule:"optional",type:"int32",name:"appear_pos",id:3},{rule:"optional",type:"int32",name:"appear_data1",id:4},{rule:"optional",type:"int32",name:"appear_data2",id:5}]},{name:"PuzzleConfig",fields:[{rule:"optional",type:"PUZZLE_GAME_ID",name:"game_id",id:1,options:{default:"GAME_ID_WEPANG"}},{rule:"optional",type:"PUZZLE_CRUSH_METHOD",name:"cursh_method",id:2,options:{default:"CRUSH_METHOD_3_MATCH"}},{rule:"optional",type:"PUZZLE_PURPOSE",name:"puzzle_purpose",id:3},{rule:"optional",type:"int32",name:"puzzle_stage",id:4,options:{default:88}},{rule:"optional",type:"int32",name:"puzzle_ver",id:5},{rule:"optional",type:"int32",name:"puzzle_degree",id:6},{rule:"optional",type:"PUZZLE_PLAYTYPE",name:"play_type",id:7},{rule:"optional",type:"int32",name:"step_num",id:8},{rule:"optional",type:"int32",name:"time_num",id:9},{rule:"optional",type:"int32",name:"board_row",id:10,options:{default:9}},{rule:"optional",type:"int32",name:"board_col",id:11,options:{default:9}},{rule:"optional",type:"int32",name:"chess_color",id:12,options:{default:7}},{rule:"optional",type:"int32",name:"onestar_score",id:13,options:{default:1200}},{rule:"optional",type:"int32",name:"twostar_score",id:14,options:{default:2400}},{rule:"optional",type:"int32",name:"threestar_score",id:15,options:{default:3600}},{rule:"repeated",type:"DescItem",name:"puzzle_desc",id:21},{rule:"repeated",type:"PassConditionItem",name:"pass_condition",id:22},{rule:"repeated",type:"BoardOneGrid",name:"board_grid",id:23},{rule:"repeated",type:"BoardAppearRule",name:"appear_rule",id:24},{rule:"optional",type:"string",name:"word_to_user",id:25},{rule:"optional",type:"string",name:"modify_username",id:50}]}],enums:[{name:"PUZZLE_GAME_ID",values:[{name:"GAME_ID_INVALID",id:0},{name:"GAME_ID_WEPANG",id:1},{name:"GAME_ID_WE6",id:2},{name:"GAME_ID_ARRAY_LEN",id:3}]},{name:"PUZZLE_CRUSH_METHOD",values:[{name:"CRUSH_METHOD_INVALID",id:0},{name:"CRUSH_METHOD_3_MATCH",id:1},{name:"CRUSH_METHOD_TOUCH",id:2},{name:"CRUSH_METHOD_LINECONNECTION",id:3}]},{name:"PUZZLE_PURPOSE",values:[{name:"PUZZLE_PURPOSE_INVALID",id:0},{name:"PUZZLE_PURPOSE_NORMAL",id:1},{name:"PUZZLE_PURPOSE_ACTIVITY",id:2},{name:"PUZZLE_PURPOSE_WEEKLY",id:3}]},{name:"PUZZLE_PLAYTYPE",values:[{name:"PLAYTYPE_INVALID",id:0},{name:"PLAYTYPE_LIMITED_STEP",id:1},{name:"NOUSE_PLAYTYPE_STEP_OVER",id:2},{name:"PLAYTYPE_LIMITED_TIME",id:3},{name:"PLAY_TYPE_SODA",id:4},{name:"PLAY_TYPE_DIGGER_MOSHING",id:5},{name:"PLAY_TYPE_DIGGER_SODA",id:6},{name:"PLAY_TYPE_DIGGER_ONEBYONE",id:7},{name:"PLAY_TYPE_WEEKLY2_PETS_GO_HOME",id:8},{name:"PLAY_TYPE_WEEKLY3_AI_ALPHAGO",id:9},{name:"PLAY_TYPE_WEEKLY1_KO_BOSS",id:10}]},{name:"DESC_TYPE",values:[{name:"DESC_INVALID",id:0},{name:"NOUSE_DESC_BOSS_ID",id:1},{name:"NOUSE_DESC_BOSS_BLOOD",id:2},{name:"DESC_NEW_GUILD",id:3},{name:"DESC_SODA_LINE",id:4},{name:"DESC_SCREEN_ROW",id:5},{name:"DESC_SCREEN_COL",id:6},{name:"DESC_WEEKLY_BOSS_BLOOD",id:7},{name:"DESC_ICE_BEAR_LITTLE_NUM",id:10},{name:"DESC_ICE_BEAR_MIDDLE_NUM",id:11},{name:"DESC_ICE_BEAR_BIG_NUM",id:12},{name:"DESC_WEELY_AI_INTELLIGENCE",id:13},{name:"DESC_3_PIECE_MAOMAOCHONG",id:15},{name:"DESC_4_PIECE_MAOMAOCHONG",id:16},{name:"DESC_5_PIECE_MAOMAOCHONG",id:17},{name:"DESC_6_PIECE_MAOMAOCHONG",id:18},{name:"DESC_NEW_PLAYING",id:19}]},{name:"PASS_CONDITION_TYPE",values:[{name:"PASS_CONDITION_INVALID",id:0},{name:"PASS_CONDITION_SCORE",id:1},{name:"PASS_CONDITION_BOSS",id:2},{name:"PASS_CONDITION_STEP_OVER",id:3},{name:"PASS_CONDITION_COLLECT_BALLOON",id:10},{name:"PASS_CONDITION_COLLECT_CANDY",id:11},{name:"PASS_CONDITION_COLLECT_SUNNY_DOLL",id:12},{name:"PASS_CONDITION_COLLECT_NORMAL_1",id:21},{name:"PASS_CONDITION_COLLECT_NORMAL_2",id:22},{name:"PASS_CONDITION_COLLECT_NORMAL_3",id:23},{name:"PASS_CONDITION_COLLECT_NORMAL_4",id:24},{name:"PASS_CONDITION_COLLECT_NORMAL_5",id:25},{name:"PASS_CONDITION_COLLECT_NORMAL_6",id:26},{name:"PASS_CONDITION_COLLECT_NORMAL_7",id:27},{name:"PASS_CONDITION_COLLECT_QIZI_SHOCKWAVE",id:30},{name:"PASS_CONDITION_COLLECT_QIZI_BLAST",id:31},{name:"PASS_CONDITION_COLLECT_QIZI_GHOST",id:32},{name:"PASS_CONDITION_COLLECT_BOTTOM_ICE",id:40},{name:"PASS_CONDITION_COLLECT_WOODENBOX",id:41},{name:"PASS_CONDITION_GENERATE_GRASS",id:42},{name:"PASS_CONDITION_AIBAO",id:43},{name:"PASS_CONDITION_SODA_QIZI",id:44},{name:"PASS_CONDITION_WIPEOUT_MAOQIU",id:45},{name:"PASS_CONDITION_COLLECT_PAPER",id:46},{name:"PASS_CONDITION_COLLECT_CLOUD_JEWEL",id:47},{name:"PASS_CONDITION_COLLECT_CLOUD_REDPACKET",id:48},{name:"PASS_CONDITION_COLLECT_4COLOR_CLOVER",id:49},{name:"PASS_CONDITION_COLLECT_5COLOR_FLOWER",id:50},{name:"PASS_CONDITION_COLLECT_BOBOTOU",id:51},{name:"PASS_CONDITION_COLLECT_YINGHUA",id:52},{name:"PASS_CONDITION_COLLECT_MAOMAOCHONG",id:53},{name:"PASS_CONDITION_COLLECT_JINGLE_BELL",id:54},{name:"PASS_CONDITION_COLLECT_HAWK_AND_CHICKEN_CHICKEN",id:55},{name:"PASS_CONDITION_PAVER_PATH",id:56},{name:"PASS_CONDITION_ELIMINATE_MUSHROOM_BIG",id:57},{name:"PASS_CONDITION_COLLECT_DOUGHNUT",id:58},{name:"PASS_CONDITION_COLLECT_STAR_TANK_STAR",id:59},{name:"PASS_CONDITION_ELIMINATE_FOAM_GUN",id:60},{name:"PASS_CONDITION_COLLECT_SUN_TANK_SUN",id:61},{name:"PASS_CONDITION_ELIMINATE_WE6_HEXAGON_MONSTER",id:62},{name:"PASS_CONDITION_ELIMINATE_WEP_SQUARE_MONSTER_STAGE",id:63},{name:"PASS_CONDITION_ELIMINATE_WEP_SQUARE_MONSTER_WEEKLY",id:64},{name:"PASS_CONDITION_ELIMINATE_WEP_SQUARE_SONW_MONSTER",id:65},{name:"PASS_CONDITION_COLLECT_GOLD_COIN",id:66},{name:"PASS_CONDITION_ELIMINATE_SHIELD",id:67}]},{name:"GRID_ELEMENT_ID",values:[{name:"ELEMENT_ID_INVALID",id:0},{name:"ELEMENT_QIGE_NULL",id:1},{name:"ELEMENT_QIGE_CONTAINER",id:2},{name:"ELEMENT_QIGE_CONTAINER_1",id:3},{name:"ELEMENT_QIGE_CONTAINER_2",id:4},{name:"ELEMENT_QIGE_SODALINE",id:6},{name:"ELEMENT_QIGE_SODALINE_1",id:7},{name:"ELEMENT_QIGE_SODALINE_2",id:8},{name:"ELEMENT_QIGE_CLEAR",id:100},{name:"ELEMENT_QIGE_END",id:199},{name:"ELEMENT_GONGNENG_BEGIN",id:1e3},{name:"ELEMENT_GONGNENG_WORMHOLE_START",id:1001},{name:"ELEMENT_GONGNENG_WORMHOLE_END",id:1002},{name:"ELEMENT_GONGNENG_BARRIER_RIGHTUP",id:1003},{name:"ELEMENT_GONGNENG_BARRIER_RIGHTDOWN",id:1004},{name:"ELEMENT_GONGNENG_BARRIER_DOWN",id:1005},{name:"ELEMENT_GONGNENG_BARRIER_RIGHT",id:1006},{name:"ELEMENT_GONGNENG_VERTICAL_TUNNEL_START",id:1007},{name:"ELEMENT_GONGNENG_VERTICAL_TUNNEL_END",id:1008},{name:"ELEMENT_GONGNENG_DROPPIONT_NORMAL",id:1010},{name:"ELEMENT_GONGNENG_DROPPIONT_SPECIAL",id:1011},{name:"ELEMENT_GONGNENG_APPEARPIONT_UP",id:1012},{name:"ELEMENT_GONGNENG_COLLECTPIONT_BALLOON",id:1020},{name:"ELEMENT_GONGNENG_COLLECTPIONT_SUGAR",id:1021},{name:"ELEMENT_GONGNENG_COLLECTPIONT_SODA",id:1022},{name:"ELEMENT_GONGNENG_COLLECTPIONT_CAOLIU",id:1024},{name:"ELEMENT_GONGNENG_TRAPDOOR_FRONT",id:1030},{name:"ELEMENT_GONGNENG_TRAPDOOR_BACK",id:1031},{name:"ELEMENT_GONGNENG_BLACKHOLE_ARRAY",id:1032},{name:"ELEMENT_GONGNENG_MAOMAOCHONG",id:1040},{name:"ELEMENT_GONGNENG_CONVEYOR",id:1060},{name:"ELEMENT_GONGNENG_CONVEYOR_UP",id:1061},{name:"ELEMENT_GONGNENG_CONVEYOR_DOWN",id:1062},{name:"ELEMENT_GONGNENG_CONVEYOR_RIGHT",id:1063},{name:"ELEMENT_GONGNENG_CONVEYOR_LEFT",id:1064},{name:"ELEMENT_GONGNENG_CONVEYOR_UP_RIGHT",id:1065},{name:"ELEMENT_GONGNENG_CONVEYOR_DOWN_RIGHT",id:1066},{name:"ELEMENT_GONGNENG_CONVEYOR_UP_LEFT",id:1067},{name:"ELEMENT_GONGNENG_CONVEYOR_DOWN_LEFT",id:1068},{name:"ELEMENT_GONGNENG_GOHOME_PATH",id:1080},{name:"ELEMENT_GONGNENG_PAVER_PATH",id:1100},{name:"ELEMENT_GONGNENG_END",id:1999},{name:"ELEMENT_QIDI_BEGIN",id:2e3},{name:"ELEMENT_QIDI_GRASSLAND",id:2001},{name:"ELEMENT_QIDI_WITHERED_GRASS",id:2002},{name:"ELEMENT_QIDI_ICE_1L",id:2005},{name:"ELEMENT_QIDI_ICE_2L",id:2006},{name:"ELEMENT_QIDI_ICE_3L",id:2007},{name:"ELEMENT_QIDI_ICE_4L",id:2008},{name:"ELEMENT_QIDI_ICE_5L",id:2009},{name:"ELEMENT_QIDI_END",id:2999},{name:"ELEMENT_QIMIAN_BEGIN",id:3e3},{name:"ELEMENT_QIMIAN_CAGE_1L",id:3005},{name:"ELEMENT_QIMIAN_CAGE_2L",id:3006},{name:"ELEMENT_QIMIAN_CAGE_3L",id:3007},{name:"ELEMENT_QIMIAN_CAGE_4L",id:3008},{name:"ELEMENT_QIMIAN_CAGE_5L",id:3009},{name:"ELEMENT_QIMIAN_PAPER_1L",id:3010},{name:"ELEMENT_QIMIAN_PAPER_2L",id:3011},{name:"ELEMENT_QIMIAN_PAPER_3L",id:3012},{name:"ELEMENT_QIMIAN_PAPER_4L",id:3013},{name:"ELEMENT_QIMIAN_PAPER_5L",id:3014},{name:"ELEMENT_QIMIAN_MAOQIU_1L",id:3015},{name:"ELEMENT_QIMIAN_MAOQIU_2L",id:3016},{name:"ELEMENT_QIMIAN_MAOQIU_3L",id:3017},{name:"ELEMENT_QIMIAN_MAOQIU_4L",id:3018},{name:"ELEMENT_QIMIAN_MAOQIU_5L",id:3019},{name:"ELEMENT_QIMIAN_FOAM",id:3020},{name:"ELEMENT_QIMIAN_SNAIL_POO",id:3021},{name:"ELEMENT_QIMIAN_SNAIL",id:3030},{name:"ELEMENT_QIMIAN_SNAIL_LEFT",id:3031},{name:"ELEMENT_QIMIAN_SNAIL_RIGHT",id:3032},{name:"ELEMENT_QIMIAN_SNAIL_UP",id:3033},{name:"ELEMENT_QIMIAN_SNAIL_DOWN",id:3034},{name:"ELEMENT_QIMIAN_SNAIL_LEFTUP",id:3035},{name:"ELEMENT_QIMIAN_SNAIL_LEFTDOWN",id:3036},{name:"ELEMENT_QIMIAN_SNAIL_RIGHTUP",id:3037},{name:"ELEMENT_QIMIAN_SNAIL_RIGHTDOWN",id:3038},{name:"ELEMENT_QIMIAN_END",id:3999},{name:"ELEMENT_QIZI_BEGIN",id:4e3},{name:"ELEMENT_QIZI_NORMAL",id:4010},{name:"ELEMENT_QIZI_NORMAL_1",id:4011},{name:"ELEMENT_QIZI_NORMAL_2",id:4012},{name:"ELEMENT_QIZI_NORMAL_3",id:4013},{name:"ELEMENT_QIZI_NORMAL_4",id:4014},{name:"ELEMENT_QIZI_NORMAL_5",id:4015},{name:"ELEMENT_QIZI_NORMAL_6",id:4016},{name:"ELEMENT_QIZI_NORMAL_7",id:4017},{name:"ELEMENT_QIZI_NORMAL_RANDOM",id:4018},{name:"ELEMENT_QIZI_SHOCKWAVE_UP_DOWN",id:4020},{name:"ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_1",id:4021},{name:"ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_2",id:4022},{name:"ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_3",id:4023},{name:"ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_4",id:4024},{name:"ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_5",id:4025},{name:"ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_6",id:4026},{name:"ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_7",id:4027},{name:"ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_RANDOM",id:4028},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT",id:4030},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_1",id:4031},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_2",id:4032},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_3",id:4033},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_4",id:4034},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_5",id:4035},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_6",id:4036},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_7",id:4037},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_RANDOM",id:4038},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFTUP_RINGHTDOWN",id:4040},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFTUP_RINGHTDOWN_1",id:4041},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFTUP_RINGHTDOWN_2",id:4042},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFTUP_RINGHTDOWN_3",id:4043},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFTUP_RINGHTDOWN_4",id:4044},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFTUP_RINGHTDOWN_5",id:4045},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFTUP_RINGHTDOWN_6",id:4046},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFTUP_RINGHTDOWN_7",id:4047},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFTUP_RINGHTDOWN_RANDOM",id:4048},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFTDOWN_RINGHTUP",id:4050},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFTDOWN_RINGHTUP_1",id:4051},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFTDOWN_RINGHTUP_2",id:4052},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFTDOWN_RINGHTUP_3",id:4053},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFTDOWN_RINGHTUP_4",id:4054},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFTDOWN_RINGHTUP_5",id:4055},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFTDOWN_RINGHTUP_6",id:4056},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFTDOWN_RINGHTUP_7",id:4057},{name:"ELEMENT_QIZI_SHOCKWAVE_LEFTDOWN_RINGHTUP_RANDOM",id:4058},{name:"ELEMENT_QIZI_BLAST_CYCLONE",id:4060},{name:"ELEMENT_QIZI_BLAST_CYCLONE_1",id:4061},{name:"ELEMENT_QIZI_BLAST_CYCLONE_2",id:4062},{name:"ELEMENT_QIZI_BLAST_CYCLONE_3",id:4063},{name:"ELEMENT_QIZI_BLAST_CYCLONE_4",id:4064},{name:"ELEMENT_QIZI_BLAST_CYCLONE_5",id:4065},{name:"ELEMENT_QIZI_BLAST_CYCLONE_6",id:4066},{name:"ELEMENT_QIZI_BLAST_CYCLONE_7",id:4067},{name:"ELEMENT_QIZI_BLAST_CYCLONE_RANDOM",id:4068},{name:"ELEMENT_QIZI_BLAST_TRIANGLE",id:4070},{name:"ELEMENT_QIZI_BLAST_TRIANGLE_1",id:4071},{name:"ELEMENT_QIZI_BLAST_TRIANGLE_2",id:4072},{name:"ELEMENT_QIZI_BLAST_TRIANGLE_3",id:4073},{name:"ELEMENT_QIZI_BLAST_TRIANGLE_4",id:4074},{name:"ELEMENT_QIZI_BLAST_TRIANGLE_5",id:4075},{name:"ELEMENT_QIZI_BLAST_TRIANGLE_6",id:4076},{name:"ELEMENT_QIZI_BLAST_TRIANGLE_7",id:4077},{name:"ELEMENT_QIZI_BLAST_TRIANGLE_RANDOM",id:4078},{name:"ELEMENT_QIZI_BLAST_SNOWFLAKE",id:4080},{name:"ELEMENT_QIZI_BLAST_SNOWFLAKE_1",id:4081},{name:"ELEMENT_QIZI_BLAST_SNOWFLAKE_2",id:4082},{name:"ELEMENT_QIZI_BLAST_SNOWFLAKE_3",id:4083},{name:"ELEMENT_QIZI_BLAST_SNOWFLAKE_4",id:4084},{name:"ELEMENT_QIZI_BLAST_SNOWFLAKE_5",id:4085},{name:"ELEMENT_QIZI_BLAST_SNOWFLAKE_6",id:4086},{name:"ELEMENT_QIZI_BLAST_SNOWFLAKE_7",id:4087},{name:"ELEMENT_QIZI_BLAST_SNOWFLAKE_RANDOM",id:4088},{name:"ELEMENT_QIZI_BLAST_SUNFLOWER",id:4090},{name:"ELEMENT_QIZI_BLAST_SUNFLOWER_1",id:4091},{name:"ELEMENT_QIZI_BLAST_SUNFLOWER_2",id:4092},{name:"ELEMENT_QIZI_BLAST_SUNFLOWER_3",id:4093},{name:"ELEMENT_QIZI_BLAST_SUNFLOWER_4",id:4094},{name:"ELEMENT_QIZI_BLAST_SUNFLOWER_5",id:4095},{name:"ELEMENT_QIZI_BLAST_SUNFLOWER_6",id:4096},{name:"ELEMENT_QIZI_BLAST_SUNFLOWER_7",id:4097},{name:"ELEMENT_QIZI_BLAST_SUNFLOWER_RANDOM",id:4098},{name:"ELEMENT_QIZI_STEPBOMB",id:4100},{name:"ELEMENT_QIZI_STEPBOMB_1",id:4101},{name:"ELEMENT_QIZI_STEPBOMB_2",id:4102},{name:"ELEMENT_QIZI_STEPBOMB_3",id:4103},{name:"ELEMENT_QIZI_STEPBOMB_4",id:4104},{name:"ELEMENT_QIZI_STEPBOMB_5",id:4105},{name:"ELEMENT_QIZI_STEPBOMB_6",id:4106},{name:"ELEMENT_QIZI_STEPBOMB_7",id:4107},{name:"ELEMENT_QIZI_STEPBOMB_RANDOM",id:4108},{name:"ELEMENT_QIZI_EXTRASTEP",id:4110},{name:"ELEMENT_QIZI_EXTRASTEP_1",id:4111},{name:"ELEMENT_QIZI_EXTRASTEP_2",id:4112},{name:"ELEMENT_QIZI_EXTRASTEP_3",id:4113},{name:"ELEMENT_QIZI_EXTRASTEP_4",id:4114},{name:"ELEMENT_QIZI_EXTRASTEP_5",id:4115},{name:"ELEMENT_QIZI_EXTRASTEP_6",id:4116},{name:"ELEMENT_QIZI_EXTRASTEP_7",id:4117},{name:"ELEMENT_QIZI_EXTRASTEP_RANDOM",id:4118},{name:"ELEMENT_QIZI_EXTRATIME",id:4120},{name:"ELEMENT_QIZI_EXTRATIME_1",id:4121},{name:"ELEMENT_QIZI_EXTRATIME_2",id:4122},{name:"ELEMENT_QIZI_EXTRATIME_3",id:4123},{name:"ELEMENT_QIZI_EXTRATIME_4",id:4124},{name:"ELEMENT_QIZI_EXTRATIME_5",id:4125},{name:"ELEMENT_QIZI_EXTRATIME_6",id:4126},{name:"ELEMENT_QIZI_EXTRATIME_7",id:4127},{name:"ELEMENT_QIZI_EXTRATIME_RANDOM",id:4128},{name:"ELEMENT_QIZI_SODA_BUBBLE",id:4130},{name:"ELEMENT_QIZI_SODA_BUBBLE_1",id:4131},{name:"ELEMENT_QIZI_SODA_BUBBLE_2",id:4132},{name:"ELEMENT_QIZI_SODA_BUBBLE_3",id:4133},{name:"ELEMENT_QIZI_SODA_BUBBLE_4",id:4134},{name:"ELEMENT_QIZI_SODA_BUBBLE_5",id:4135},{name:"ELEMENT_QIZI_SODA_BUBBLE_6",id:4136},{name:"ELEMENT_QIZI_SODA_BUBBLE_7",id:4137},{name:"ELEMENT_QIZI_SODA_BUBBLE_RANDOM",id:4138},{name:"ELEMENT_QIZI_GOHOME_SMALL_MONSTER",id:4140},{name:"ELEMENT_QIZI_GOHOME_SMALL_MONSTER_1",id:4141},{name:"ELEMENT_QIZI_GOHOME_SMALL_MONSTER_2",id:4142},{name:"ELEMENT_QIZI_GOHOME_SMALL_MONSTER_3",id:4143},{name:"ELEMENT_QIZI_GOHOME_SMALL_MONSTER_4",id:4144},{name:"ELEMENT_QIZI_GOHOME_SMALL_MONSTER_5",id:4145},{name:"ELEMENT_QIZI_GOHOME_SMALL_MONSTER_6",id:4146},{name:"ELEMENT_QIZI_GOHOME_SMALL_MONSTER_7",id:4147},{name:"ELEMENT_QIZI_GOHOME_SMALL_MONSTER_RANDOM",id:4148},{name:"ELEMENT_QIZI_GOHOME_BIG_MONSTER",id:4150},{name:"ELEMENT_QIZI_GOHOME_BIG_MONSTER_1",id:4151},{name:"ELEMENT_QIZI_GOHOME_BIG_MONSTER_2",id:4152},{name:"ELEMENT_QIZI_GOHOME_BIG_MONSTER_3",id:4153},{name:"ELEMENT_QIZI_GOHOME_BIG_MONSTER_4",id:4154},{name:"ELEMENT_QIZI_GOHOME_BIG_MONSTER_5",id:4155},{name:"ELEMENT_QIZI_GOHOME_BIG_MONSTER_6",id:4156},{name:"ELEMENT_QIZI_GOHOME_BIG_MONSTER_7",id:4157},{name:"ELEMENT_QIZI_GOHOME_BIG_MONSTER_RANDOM",id:4158},{name:"ELEMENT_QIZI_PAVER",id:4160},{name:"ELEMENT_QIZI_PAVER_1",id:4161},{name:"ELEMENT_QIZI_PAVER_2",id:4162},{name:"ELEMENT_QIZI_PAVER_3",id:4163},{name:"ELEMENT_QIZI_PAVER_4",id:4164},{name:"ELEMENT_QIZI_PAVER_5",id:4165},{name:"ELEMENT_QIZI_PAVER_6",id:4166},{name:"ELEMENT_QIZI_PAVER_7",id:4167},{name:"ELEMENT_QIZI_PAVER_RANDOM",id:4168},{name:"ELEMENT_QIZI_JINGLE_BELL_1L",id:4170},{name:"ELEMENT_QIZI_JINGLE_BELL_1L_1",id:4171},{name:"ELEMENT_QIZI_JINGLE_BELL_1L_2",id:4172},{name:"ELEMENT_QIZI_JINGLE_BELL_1L_3",id:4173},{name:"ELEMENT_QIZI_JINGLE_BELL_1L_4",id:4174},{name:"ELEMENT_QIZI_JINGLE_BELL_1L_5",id:4175},{name:"ELEMENT_QIZI_JINGLE_BELL_1L_6",id:4176},{name:"ELEMENT_QIZI_JINGLE_BELL_1L_7",id:4177},{name:"ELEMENT_QIZI_JINGLE_BELL_1L_RANDOM",id:4178},{name:"ELEMENT_QIZI_JINGLE_BELL_2L",id:4180},{name:"ELEMENT_QIZI_JINGLE_BELL_2L_1",id:4181},{name:"ELEMENT_QIZI_JINGLE_BELL_2L_2",id:4182},{name:"ELEMENT_QIZI_JINGLE_BELL_2L_3",id:4183},{name:"ELEMENT_QIZI_JINGLE_BELL_2L_4",id:4184},{name:"ELEMENT_QIZI_JINGLE_BELL_2L_5",id:4185},{name:"ELEMENT_QIZI_JINGLE_BELL_2L_6",id:4186},{name:"ELEMENT_QIZI_JINGLE_BELL_2L_7",id:4187},{name:"ELEMENT_QIZI_JINGLE_BELL_2L_RANDOM",id:4188},{name:"ELEMENT_QIZI_TREASURE_BOX",id:4190},{name:"ELEMENT_QIZI_TREASURE_BOX_1",id:4191},{name:"ELEMENT_QIZI_TREASURE_BOX_2",id:4192},{name:"ELEMENT_QIZI_TREASURE_BOX_3",id:4193},{name:"ELEMENT_QIZI_TREASURE_BOX_4",id:4194},{name:"ELEMENT_QIZI_TREASURE_BOX_5",id:4195},{name:"ELEMENT_QIZI_TREASURE_BOX_6",id:4196},{name:"ELEMENT_QIZI_TREASURE_BOX_7",id:4197},{name:"ELEMENT_QIZI_TREASURE_BOX_RANDOM",id:4198},{name:"ELEMENT_QIZI_EGG_NEST_1L",id:4200},{name:"ELEMENT_QIZI_EGG_NEST_1L_1",id:4201},{name:"ELEMENT_QIZI_EGG_NEST_1L_2",id:4202},{name:"ELEMENT_QIZI_EGG_NEST_1L_3",id:4203},{name:"ELEMENT_QIZI_EGG_NEST_1L_4",id:4204},{name:"ELEMENT_QIZI_EGG_NEST_1L_5",id:4205},{name:"ELEMENT_QIZI_EGG_NEST_1L_6",id:4206},{name:"ELEMENT_QIZI_EGG_NEST_1L_7",id:4207},{name:"ELEMENT_QIZI_EGG_NEST_1L_RANDOM",id:4208},{name:"ELEMENT_QIZI_EGG_NEST_2L",id:4210},{name:"ELEMENT_QIZI_EGG_NEST_2L_1",id:4211},{name:"ELEMENT_QIZI_EGG_NEST_2L_2",id:4212},{name:"ELEMENT_QIZI_EGG_NEST_2L_3",id:4213},{name:"ELEMENT_QIZI_EGG_NEST_2L_4",id:4214},{name:"ELEMENT_QIZI_EGG_NEST_2L_5",id:4215},{name:"ELEMENT_QIZI_EGG_NEST_2L_6",id:4216},{name:"ELEMENT_QIZI_EGG_NEST_2L_7",id:4217},{name:"ELEMENT_QIZI_EGG_NEST_2L_RANDOM",id:4218},{name:"ELEMENT_QIZI_GHOST",id:4501},{name:"ELEMENT_QIZI_CHANGE_COLOR",id:4502},{name:"ELEMENT_QIZI_GOLD_COIN",id:4503},{name:"ELEMENT_QIZI_4COLOR_CLOVER",id:4504},{name:"ELEMENT_QIZI_5COLOR_FLOWER",id:4505},{name:"ELEMENT_QIZI_GOHOME_MONSTER_NEST",id:4506},{name:"ELEMENT_QIZI_CHANGE_COLOR_JINGLE_BELL_1L",id:4507},{name:"ELEMENT_QIZI_CHANGE_COLOR_JINGLE_BELL_2L",id:4508},{name:"ELEMENT_QIZI_CHANGE_COLOR_JINGLE_BELL_3L",id:4509},{name:"ELEMENT_QIZI_WOODENBOX_1L",id:4510},{name:"ELEMENT_QIZI_WOODENBOX_2L",id:4511},{name:"ELEMENT_QIZI_WOODENBOX_3L",id:4512},{name:"ELEMENT_QIZI_WOODENBOX_4L",id:4513},{name:"ELEMENT_QIZI_WOODENBOX_5L",id:4514},{name:"ELEMENT_QIZI_DIGGER_CHOCOLATE_1L",id:4515},{name:"ELEMENT_QIZI_DIGGER_CHOCOLATE_2L",id:4516},{name:"ELEMENT_QIZI_DIGGER_CHOCOLATE_3L",id:4517},{name:"ELEMENT_QIZI_DIGGER_CHOCOLATE_4L",id:4518},{name:"ELEMENT_QIZI_DIGGER_CHOCOLATE_5L",id:4519},{name:"ELEMENT_QIZI_DIGGER_CLOUD_1L",id:4520},{name:"ELEMENT_QIZI_DIGGER_CLOUD_2L",id:4521},{name:"ELEMENT_QIZI_DIGGER_CLOUD_3L",id:4522},{name:"ELEMENT_QIZI_DIGGER_CLOUD_4L",id:4523},{name:"ELEMENT_QIZI_DIGGER_CLOUD_5L",id:4524},{name:"ELEMENT_QIZI_DIGGER_CLOUD_JEWEL_1L",id:4525},{name:"ELEMENT_QIZI_DIGGER_CLOUD_JEWEL_2L",id:4526},{name:"ELEMENT_QIZI_DIGGER_CLOUD_JEWEL_3L",id:4527},{name:"ELEMENT_QIZI_DIGGER_CLOUD_JEWEL_4L",id:4528},{name:"ELEMENT_QIZI_DIGGER_CLOUD_JEWEL_5L",id:4529},{name:"ELEMENT_QIZI_DIGGER_CLOUD_REDPACKET_1L",id:4530},{name:"ELEMENT_QIZI_DIGGER_CLOUD_REDPACKET_2L",id:4531},{name:"ELEMENT_QIZI_DIGGER_CLOUD_REDPACKET_3L",id:4532},{name:"ELEMENT_QIZI_DIGGER_CLOUD_REDPACKET_4L",id:4533},{name:"ELEMENT_QIZI_DIGGER_CLOUD_REDPACKET_5L",id:4534},{name:"ELEMENT_QIZI_YINGHUACHUAN_1P",id:4535},{name:"ELEMENT_QIZI_YINGHUACHUAN_2P",id:4536},{name:"ELEMENT_QIZI_YINGHUACHUAN_3P",id:4537},{name:"ELEMENT_QIZI_YINGHUACHUAN_4P",id:4538},{name:"ELEMENT_QIZI_YINGHUACHUAN_5P",id:4539},{name:"ELEMENT_ID_QIZI_BOBOTOU_1L",id:4540},{name:"ELEMENT_ID_QIZI_BOBOTOU_2L",id:4541},{name:"ELEMENT_ID_QIZI_BOBOTOU_3L",id:4542},{name:"ELEMENT_ID_QIZI_BOBOTOU_4L",id:4543},{name:"ELEMENT_ID_QIZI_BOBOTOU_5L",id:4544},{name:"ELEMENT_QIZI_COLLECT_BALLOON",id:4550},{name:"ELEMENT_QIZI_COLLECT_CANDY",id:4551},{name:"ELEMENT_QIZI_SUNNY_DOLL_1",id:4552},{name:"ELEMENT_QIZI_SUNNY_DOLL_2",id:4553},{name:"ELEMENT_QIZI_SUNNY_DOLL_3",id:4554},{name:"ELEMENT_QIZI_COLLECT_4",id:4555},{name:"ELEMENT_QIZI_COLLECT_5",id:4556},{name:"ELEMENT_QIZI_COLLECT_6",id:4557},{name:"ELEMENT_QIZI_COLLECT_7",id:4558},{name:"ELEMENT_QIZI_COLLECT_8",id:4559},{name:"ELEMENT_QIZI_BUCKET",id:4560},{name:"ELEMENT_QIZI_WATER",id:4561},{name:"ELEMENT_QIZI_MUSHROOM_BIG",id:4562},{name:"ELEMENT_QIZI_MUSHROOM_SMALL",id:4563},{name:"ELEMENT_QIZI_GOHOME_START",id:4564},{name:"ELEMENT_QIZI_GOHOME_END",id:4565},{name:"ELEMENT_QIZI_DOUGHNUT",id:4566},{name:"ELEMENT_QIZI_CANDY_JAR",id:4567},{name:"ELEMENT_QIZI_HAWK_AND_CHICKEN_HAWK",id:4568},{name:"ELEMENT_QIZI_HAWK_AND_CHICKEN_CHICKEN",id:4569},{name:"ELEMENT_QIZI_HAWK_AND_CHICKEN_BIGCHICKEN",id:4570},{name:"ELEMENT_QIZI_STAR_TANK_TANK",id:4571},{name:"ELEMENT_QIZI_STAR_TANK_STAR",id:4572},{name:"ELEMENT_QIZI_SUN_TANK_TANK",id:4573},{name:"ELEMENT_QIZI_SUN_TANK_SUN",id:4574},{name:"ELEMENT_QIZI_ANTI_SHOCKWAVE_STONE",id:4575},{name:"ELEMENT_QIZI_COLOR_HATCHING_EGG",id:4576},{name:"ELEMENT_QIZI_GOHOME_ANGER_FRUIT",id:4577},{name:"ELEMENT_QIZI_FOAM_GUN",id:4580},{name:"ELEMENT_QIZI_FOAM_GUN_LEFT",id:4581},{name:"ELEMENT_QIZI_FOAM_GUN_RIGHT",id:4582},{name:"ELEMENT_QIZI_FOAM_GUN_UP",id:4583},{name:"ELEMENT_QIZI_FOAM_GUN_DOWN",id:4584},{name:"ELEMENT_QIZI_FOAM_GUN_LEFTUP",id:4585},{name:"ELEMENT_QIZI_FOAM_GUN_LEFTDOWN",id:4586},{name:"ELEMENT_QIZI_FOAM_GUN_RIGHTUP",id:4587},{name:"ELEMENT_QIZI_FOAM_GUN_RIGHTDOWN",id:4588},{name:"ELEMENT_QIZI_WEP_WOODENBOX_STONE_12",id:4590},{name:"ELEMENT_QIZI_WEP_WOODENBOX_STONE_23",id:4591},{name:"ELEMENT_QIZI_WEP_WOODENBOX_STONE_34",id:4592},{name:"ELEMENT_QIZI_WEP_WOODENBOX_STONE_41",id:4593},{name:"ELEMENT_QIZI_WE6_WOODENBOX_STONE_123",id:4594},{name:"ELEMENT_QIZI_WE6_WOODENBOX_STONE_234",id:4595},{name:"ELEMENT_QIZI_WE6_WOODENBOX_STONE_345",id:4596},{name:"ELEMENT_QIZI_WE6_WOODENBOX_STONE_456",id:4597},{name:"ELEMENT_QIZI_WE6_WOODENBOX_STONE_561",id:4598},{name:"ELEMENT_QIZI_WE6_WOODENBOX_STONE_612",id:4599},{name:"ELEMENT_QIZI_WE6_HEXAGON_MONSTER_CENTER_1L",id:4600},{name:"ELEMENT_QIZI_WE6_HEXAGON_MONSTER_EDGE_1L",id:4601},{name:"ELEMENT_QIZI_WE6_HEXAGON_MONSTER_CENTER_2L",id:4602},{name:"ELEMENT_QIZI_WE6_HEXAGON_MONSTER_EDGE_2L",id:4603},{name:"ELEMENT_QIZI_WE6_HEXAGON_MONSTER_CENTER_3L",id:4604},{name:"ELEMENT_QIZI_WE6_HEXAGON_MONSTER_EDGE_3L",id:4605},{name:"ELEMENT_QIZI_WE6_HEXAGON_MONSTER_CENTER_4L",id:4606},{name:"ELEMENT_QIZI_WE6_HEXAGON_MONSTER_EDGE_4L",id:4607},{name:"ELEMENT_QIZI_WE6_HEXAGON_MONSTER_CENTER_5L",id:4608},{name:"ELEMENT_QIZI_WE6_HEXAGON_MONSTER_EDGE_5L",id:4609},{name:"ELEMENT_QIZI_WEP_SQUARE_MONSTER_STAGE_CENTER",id:4610},{name:"ELEMENT_QIZI_WEP_SQUARE_MONSTER_STAGE_EDGE",id:4611},{name:"ELEMENT_QIZI_WEP_SQUARE_MONSTER_STAGE_1",id:4612},{name:"ELEMENT_QIZI_WEP_SQUARE_MONSTER_STAGE_2",id:4613},{name:"ELEMENT_QIZI_WEP_SQUARE_MONSTER_WEEKLY_CENTER",id:4615},{name:"ELEMENT_QIZI_WEP_SQUARE_MONSTER_WEEKLY_EDGE",id:4616},{name:"ELEMENT_QIZI_WEP_SQUARE_MONSTER_WEEKLY_1",id:4617},{name:"ELEMENT_QIZI_WEP_SQUARE_MONSTER_WEEKLY_2",id:4618},{name:"ELEMENT_QIZI_WEP_SQUARE_SNOW_MONSTER_CENTER",id:4620},{name:"ELEMENT_QIZI_WEP_SQUARE_SNOW_MONSTER_EDGE",id:4621},{name:"ELEMENT_QIZI_WEP_SQUARE_SNOW_MONSTER_1",id:4622},{name:"ELEMENT_QIZI_WEP_SQUARE_SNOW_MONSTER_2",id:4623},{name:"ELEMENT_QIZI_SUPPER_SHOCKWAVE_CANNON",id:4630},{name:"ELEMENT_QIZI_SUPPER_SHOCKWAVE_CANNON_LEFT",id:4631},{name:"ELEMENT_QIZI_SUPPER_SHOCKWAVE_CANNON_RIGHT",id:4632},{name:"ELEMENT_QIZI_SUPPER_SHOCKWAVE_CANNON_UP",id:4633},{name:"ELEMENT_QIZI_SUPPER_SHOCKWAVE_CANNON_DOWN",id:4634},{name:"ELEMENT_QIZI_SUPPER_SHOCKWAVE_CANNON_LEFTUP",id:4635},{name:"ELEMENT_QIZI_SUPPER_SHOCKWAVE_CANNON_LEFTDOWN",id:4636},{name:"ELEMENT_QIZI_SUPPER_SHOCKWAVE_CANNON_RIGHTUP",id:4637},{name:"ELEMENT_QIZI_SUPPER_SHOCKWAVE_CANNON_RIGHTDOWN",id:4638},{name:"ELEMENT_ID_QIZI_SHIELD_1L",id:4640},{name:"ELEMENT_ID_QIZI_SHIELD_2L",id:4641},{name:"ELEMENT_ID_QIZI_SHIELD_3L",id:4642},{name:"ELEMENT_ID_QIZI_SHIELD_4L",id:4643},{name:"ELEMENT_ID_QIZI_SHIELD_5L",id:4644},{name:"ELEMENT_QIZI_END",id:9999}]},{name:"APPEAR_RULE_TYPE",values:[{name:"APPEAR_RULE_INVALID",id:0},{name:"APPEAR_COLLECT_STEP",id:1},{name:"APPEAR_COLLECT_REMAIN",id:2},{name:"APPEAR_EXTRASTEP_STEP",id:3},{name:"APPEAR_EXTRASTEP_PROBABILITY",id:4},{name:"APPEAR_CHANGE_COLOR_STEP",id:5},{name:"APPEAR_CHANGE_COLOR_PROBABILITY",id:6},{name:"APPEAR_BOBOTOU_STEP",id:7},{name:"APPEAR_BOBOTOU_PROBABILITY",id:8},{name:"APPEAR_EXTRATIME_STEP",id:9},{name:"APPEAR_EXTRATIME_PROBABILITY",id:10},{name:"APPEAR_STEPBOMB_STEP",id:11},{name:"APPEAR_STEPBOMB_PROBABILITY",id:12},{name:"APPEAR_SODA_BUBBLE_STEP",id:13},{name:"APPEAR_SODA_BUBBLE_REMAIN",id:14},{name:"APPEAR_GOHOME_MOSTER_RISE_AGAIN",id:15},{name:"APPEAR_GOHOME_MOSTER_PER_PET_WALKSTEP",id:16},{name:"APPEAR_GOHOME_MOSTER_PER_USER_FINGERSLIDING",id:17},{name:"APPEAR_GOHOME_MOSTER_USER_FINGERSLIDING",id:18},{name:"APPEAR_JINGLE_BELL_STEP",id:19},{name:"APPEAR_JINGLE_BELL_PROBABILITY",id:20},{name:"APPEAR_JINGLE_BELL_CIRCLE",id:21},{name:"APPEAR_SODA_BUBBLE_CIRCLE",id:22},{name:"APPEAR_GOLD_COIN_STEP",id:23},{name:"APPEAR_GOLD_COIN_PROBABILITY",id:24},{name:"APPEAR_TREASURE_BOX_STEP",id:25},{name:"APPEAR_TREASURE_BOX_PROBABILITY",id:26},{name:"APPEAR_TREASURE_BOX_TRANSFORMATION",id:27}]}]}).build()},function(l,e,t){"use strict";var E=t(10),o=t(14),n=t(16),r=t(11),i=t(12),a={};l.exports={getStage:function(t){return console.info("\u4ECEStageLoaded\u53D6\u51FA\u6570\u636E\uFF1A"+t),a[t]},hasStage:function(t){return a[t]},loadStage:function(C){var _=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},e=this,t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){},n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,r=C.id+"_"+C.sub_id;console.info("loadStage\uFF1A== "+r);var i=function(t){a[r]=t,_&&_(t)};if(a[r])console.info("\u4ECEStageLoaded\u53D6\u51FA\u6570\u636E\u76F4\u63A5\u8FD4\u56DE\uFF1A"+r),i(a[r]);else{var s=0,l=function(){s<5?(s++,console.info("\u7B2C"+s+"\u6B21\u91CD\u8BD5"),setTimeout(function(){d()},1e3)):t&&t()},d=function(){var a=n?n:window.remoteResPath,r=o.PuzzleConfig,s=E.Util.XHR(),t=a+"config/stage/"+e.getStageFileName(C);s.open("GET",t,!0),console.info("\u8D44\u6E90\u8DEF\u5F84\uFF1A"+t),s.responseType="arraybuffer",s.onload=function(){try{if(s.response.byteLength){var e=r.decode(s.response);i(e)}else console.info("Stage parse failed(length)"),l()}catch(a){console.info("Stage parse failed"),l()}},s.onerror=function(){console.info("xhr.onerror"),l()},s.send(null)};d()}},getFragmentName:function(_){var e=[0,0,0,0];_=_.toString().split("");for(var t=_.length,n=0;n<t;n++){var o=e.length-(n+1),a=_.pop();0<=o?e[o]=a:e.unshift(a)}return e.join("")},getStageFileName:function(a){var e=this.getFragmentName(a.id),t=this.getFragmentName(a.sub_id);return"stage_"+e+"_"+t+".bin"},setStage:function(o,e){a[e]=o},getContainChessType:function(s){console.log("StageLoader.getContainChessType");var e={},t=s.id+"_"+s.sub_id,O=this.getStage(t);if(!O)return e;for(var L=new n.TableManager,a=O.board_grid,_=a.length,l=0;l<_;l++)for(var u=a[l],c=u.one_grid,h=c.length,E=0;E<h;E++){var C=c[E],p=L.ElementIDToChessType(C.element_id);p!=i.ChessType.STIT_NONE&&(void 0==e[p]?e[p]=1:e[p]+=1)}for(var l=0,d;l<O.pass_condition.length;l++)if(d=O.pass_condition[l],d.cond_type!=r.PASS_CONDITION_TYPE.PASS_CONDITION_AIBAO){var p=L.GetChessTypeByConditionType(d.cond_type);void 0==e[p]?e[p]=1:e[p]+=1}else e[i.ChessType.STIT_ICE_BEAR_UNDER]=1;for(var T=O.appear_rule,l=0,I=T.length,y;l<I;l++)if(y=T[l],0<y.appear_type){var S=y.appear_element,p=L.ElementIDToChessType(S.element_id);p!=i.ChessType.STIT_NONE&&(void 0==e[p]?e[p]=1:e[p]+=1)}return e}}},function(E,e,t){"use strict";function C(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),d=t(12),r=t(17),a=t(11),s=t(18),_=[{ChessType:d.ChessType.CT_NormalUnit,attack_type:[d.AttackType.Attack_Normal,d.AttackType.Attack_VerticalShockWave,d.AttackType.Attack_HorizontalShockWave,d.AttackType.Attack_Hurricane,d.AttackType.Attack_CrossShockWave,d.AttackType.Attack_ThickCrossShockWave,d.AttackType.Attack_BigHurricane,d.AttackType.Attack_Gas,d.AttackType.Attack_Gas2Gas,d.AttackType.Attack_Disappear,d.AttackType.Attack_Bomb,d.AttackType.Attack_Lastpang,d.AttackType.Attack_GasSpecial,d.AttackType.Attack_ShockWave],Layer:1,drop_rule:1,crush_rule:1,UseRearrange:!0,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!0,CanCrushAround:!0,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!0,CanSetCandy:!0,CanSetMaoqiu:!0,CanSetBlueberry:!0,CanSwapGhost:!0,CanSetStartItem:!0,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!0,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:d.ChessType.STIT_NONE,HP:0,Color:-1,Score:100,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:d.CollectType.kCollectCrush,Compatible4GridBoss:!0},{ChessType:d.ChessType.CT_SpecialVerticalShockWave,attack_type:[d.AttackType.Attack_Normal,d.AttackType.Attack_VerticalShockWave,d.AttackType.Attack_HorizontalShockWave,d.AttackType.Attack_Hurricane,d.AttackType.Attack_CrossShockWave,d.AttackType.Attack_ThickCrossShockWave,d.AttackType.Attack_BigHurricane,d.AttackType.Attack_Gas,d.AttackType.Attack_Gas2Gas,d.AttackType.Attack_Disappear,d.AttackType.Attack_Bomb,d.AttackType.Attack_Lastpang,d.AttackType.Attack_GasSpecial,d.AttackType.Attack_ShockWave],Layer:1,drop_rule:1,slide_rule:1,crush_rule:1,bomb_rule:2,UseRearrange:!0,UseSpecial:!0,UseSwap:!0,CanUseHammer:!0,CanSetCandy:!0,CanSetMaoqiu:!0,CanBeReplace:!0,CanSetBlueberry:!0,CanSwapGhost:!0,CanAttackIce:!0,IsSpecialChess1:!0,CanCrushAround:!0,CanUseLastpang:!0,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,IsSpecialChess2:!1,NextType:d.ChessType.STIT_NONE,HP:0,Color:-1,Score:0,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:d.CollectType.kCollectCrush,Compatible4GridBoss:!0},{ChessType:d.ChessType.CT_SpecialHorizontalShockWave,attack_type:[d.AttackType.Attack_Normal,d.AttackType.Attack_VerticalShockWave,d.AttackType.Attack_HorizontalShockWave,d.AttackType.Attack_Hurricane,d.AttackType.Attack_CrossShockWave,d.AttackType.Attack_ThickCrossShockWave,d.AttackType.Attack_BigHurricane,d.AttackType.Attack_Gas,d.AttackType.Attack_Gas2Gas,d.AttackType.Attack_Disappear,d.AttackType.Attack_Bomb,d.AttackType.Attack_Lastpang,d.AttackType.Attack_GasSpecial,d.AttackType.Attack_ShockWave],Layer:1,drop_rule:1,slide_rule:1,crush_rule:1,bomb_rule:3,UseRearrange:!0,UseSpecial:!0,UseSwap:!0,CanUseHammer:!0,CanSetCandy:!0,CanSetMaoqiu:!0,CanBeReplace:!0,CanSetBlueberry:!0,CanSwapGhost:!0,CanAttackIce:!0,IsSpecialChess1:!0,CanCrushAround:!0,CanUseLastpang:!0,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,IsSpecialChess2:!1,NextType:d.ChessType.STIT_NONE,HP:0,Color:-1,Score:0,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:d.CollectType.kCollectCrush,Compatible4GridBoss:!0},{ChessType:d.ChessType.CT_SpecialHurricane,attack_type:[d.AttackType.Attack_Normal,d.AttackType.Attack_VerticalShockWave,d.AttackType.Attack_HorizontalShockWave,d.AttackType.Attack_Hurricane,d.AttackType.Attack_CrossShockWave,d.AttackType.Attack_ThickCrossShockWave,d.AttackType.Attack_BigHurricane,d.AttackType.Attack_Gas,d.AttackType.Attack_Gas2Gas,d.AttackType.Attack_Disappear,d.AttackType.Attack_Bomb,d.AttackType.Attack_Lastpang,d.AttackType.Attack_GasSpecial,d.AttackType.Attack_GasShockSave,d.AttackType.Attack_GasHurricane,d.AttackType.Attack_ShockWave],Layer:1,drop_rule:1,slide_rule:1,crush_rule:1,bomb_rule:4,UseRearrange:!0,UseSpecial:!0,UseSwap:!0,CanUseHammer:!0,CanSetCandy:!0,CanSetMaoqiu:!0,CanBeReplace:!0,CanSetBlueberry:!0,CanSwapGhost:!0,CanAttackIce:!0,IsSpecialChess1:!0,CanCrushAround:!0,CanUseLastpang:!0,Score:0,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,IsSpecialChess2:!1,NextType:d.ChessType.STIT_NONE,HP:0,Color:-1,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:d.CollectType.kCollectCrush,Compatible4GridBoss:!0},{ChessType:d.ChessType.CT_SpecialGas,attack_type:[d.AttackType.Attack_Normal,d.AttackType.Attack_VerticalShockWave,d.AttackType.Attack_HorizontalShockWave,d.AttackType.Attack_Hurricane,d.AttackType.Attack_CrossShockWave,d.AttackType.Attack_ThickCrossShockWave,d.AttackType.Attack_BigHurricane,d.AttackType.Attack_Gas,d.AttackType.Attack_Gas2Gas,d.AttackType.Attack_Disappear,d.AttackType.Attack_Bomb,d.AttackType.Attack_Lastpang,d.AttackType.Attack_GasSpecial,d.AttackType.Attack_GasShockSave,d.AttackType.Attack_GasHurricane,d.AttackType.Attack_ShockWave],Layer:1,drop_rule:1,slide_rule:1,crush_rule:1,UseRearrange:!0,UseSpecial:!1,UseSwap:!0,CanUseHammer:!1,CanSwapGhost:!0,CanSetMaoqiu:!0,CanSetCandy:!0,CanSetBlueberry:!0,CanBeReplace:!0,CanAttackIce:!0,IsSpecialChess1:!0,IsSpecialChess2:!0,CanChangeColor:!1,CanCrushAround:!0,Score:5e3,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanSetStartItem:!1,CanRandomColor:!0,CanUseLastpang:!1,NextType:d.ChessType.STIT_NONE,HP:0,Color:-1,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:d.CollectType.kCollectCrush,Compatible4GridBoss:!0},{ChessType:d.ChessType.STIT_NOUSE,attack_type:[],CanSetCandy:!1,CanBeReplace:!1,CanSetBlueberry:!0,Layer:d.ChessLayer.kChessLayerFeature,drop_rule:0,crush_rule:0,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!1,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanSetMaoqiu:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:d.ChessType.STIT_NONE,HP:0,Color:-1,Score:0,CanBeAroundCrushed:!1,CanSlide:!1,collect_type:d.CollectType.kCollectCrush,Compatible4GridBoss:!0},{attack_type:[],Layer:1,drop_rule:1,crush_rule:3,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!1,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!0,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:1e4,ChessType:8,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!0},{attack_type:[],Layer:1,drop_rule:1,crush_rule:3,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!1,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!0,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:1e4,ChessType:9,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!0},{attack_type:[],Layer:2e3,drop_rule:0,crush_rule:0,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!1,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!0,CanSetCandy:!0,CanSetMaoqiu:!1,CanSetBlueberry:!0,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:25,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!0},{attack_type:[],Layer:2e3,drop_rule:0,crush_rule:0,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!1,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!0,CanSetCandy:!0,CanSetMaoqiu:!1,CanSetBlueberry:!0,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:26,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!0},{attack_type:[],Layer:0,drop_rule:0,crush_rule:0,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!1,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!0,CanSetCandy:!0,CanSetMaoqiu:!0,CanSetBlueberry:!0,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:52,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:3,Compatible4GridBoss:!0},{attack_type:[],Layer:0,drop_rule:0,crush_rule:0,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!1,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!0,CanSetCandy:!0,CanSetMaoqiu:!0,CanSetBlueberry:!0,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:53,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:3,Compatible4GridBoss:!0},{attack_type:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16,15],Layer:0,drop_rule:0,crush_rule:2,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!1,CanCrushAround:!1,ForbidContinuousCrush:!0,IsCollection:!1,CanBeReplace:!0,CanSetCandy:!0,CanSetMaoqiu:!0,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:54,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!0},{attack_type:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16,15],Layer:0,drop_rule:0,crush_rule:2,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!1,CanCrushAround:!1,ForbidContinuousCrush:!0,IsCollection:!1,CanBeReplace:!0,CanSetCandy:!0,CanSetMaoqiu:!0,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:54,HP:0,Color:-1,Score:0,ChessType:55,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!0},{attack_type:[],Layer:2e3,drop_rule:0,crush_rule:0,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!1,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!0,CanSetCandy:!0,CanSetMaoqiu:!1,CanSetBlueberry:!0,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:24,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!0},{attack_type:[],Layer:2e3,drop_rule:0,crush_rule:0,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!1,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!0,CanSetCandy:!0,CanSetMaoqiu:!1,CanSetBlueberry:!0,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:32,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!0},{attack_type:[],Layer:2e3,drop_rule:0,crush_rule:0,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!1,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!0,CanSetCandy:!0,CanSetMaoqiu:!1,CanSetBlueberry:!0,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:33,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!0},{attack_type:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16,15],Layer:1,drop_rule:0,crush_rule:1,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:63,CanBeAroundCrushed:!0,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16,15],Layer:1,drop_rule:0,crush_rule:1,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:63,HP:0,Color:-1,Score:0,ChessType:64,CanBeAroundCrushed:!0,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16,15],Layer:1,drop_rule:0,crush_rule:1,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:64,HP:0,Color:-1,Score:0,ChessType:65,CanBeAroundCrushed:!0,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16,15],Layer:1,drop_rule:0,crush_rule:1,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:65,HP:0,Color:-1,Score:0,ChessType:66,CanBeAroundCrushed:!0,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[2,3,4,5,6,7,10,11,9],Layer:1,drop_rule:0,crush_rule:1,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!0,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:67,CanBeAroundCrushed:!1,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16,15],Layer:2,drop_rule:0,crush_rule:1,UseRearrange:!1,StopDrop:!0,StopDropIn:!0,StopSlide:!0,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!0,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!1,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:8,Score:0,ChessType:93,CanBeAroundCrushed:!1,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16,15],Layer:2,drop_rule:0,crush_rule:1,UseRearrange:!1,StopDrop:!0,StopDropIn:!0,StopSlide:!0,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!0,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!1,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:93,HP:0,Color:8,Score:0,ChessType:94,CanBeAroundCrushed:!1,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[1,2,3,4,9,5,6,7,10,11,12],Layer:2,drop_rule:0,crush_rule:1,UseRearrange:!1,StopDrop:!0,StopDropIn:!0,StopSlide:!0,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!0,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:95,CanBeAroundCrushed:!0,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[1,2,3,4,9,5,6,7,10,11,12],Layer:2,drop_rule:0,crush_rule:1,UseRearrange:!1,StopDrop:!0,StopDropIn:!0,StopSlide:!0,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!0,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:95,HP:0,Color:-1,Score:0,ChessType:96,CanBeAroundCrushed:!0,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[1,2,3,4,9,5,6,7,10,11,12],Layer:2,drop_rule:0,crush_rule:1,UseRearrange:!1,StopDrop:!0,StopDropIn:!0,StopSlide:!0,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!0,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:96,HP:0,Color:-1,Score:0,ChessType:97,CanBeAroundCrushed:!0,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[1,2,3,4,9,5,6,7,10,11,12],Layer:2,drop_rule:0,crush_rule:1,UseRearrange:!1,StopDrop:!0,StopDropIn:!0,StopSlide:!0,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!0,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:97,HP:0,Color:-1,Score:0,ChessType:98,CanBeAroundCrushed:!0,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[1,2,3,4,9,5,6,7,10,11,12],Layer:2,drop_rule:0,crush_rule:1,UseRearrange:!1,StopDrop:!0,StopDropIn:!0,StopSlide:!0,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!0,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:98,HP:0,Color:-1,Score:0,ChessType:99,CanBeAroundCrushed:!0,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[1,2,3,4,5,6,7,8,9,10,11,12,13,16],Layer:1,drop_rule:1,crush_rule:1,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!0,CanCrushAround:!0,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!0,CanSetBlueberry:!0,CanSwapGhost:!0,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!0,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:100,ChessType:15,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!0},{attack_type:[],Layer:2e3,drop_rule:0,crush_rule:0,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!1,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!0,CanSetCandy:!0,CanSetMaoqiu:!1,CanSetBlueberry:!0,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:27,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!0},{attack_type:[],Layer:2e3,drop_rule:0,crush_rule:0,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!1,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!0,CanSetCandy:!0,CanSetMaoqiu:!1,CanSetBlueberry:!0,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:28,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!0},{attack_type:[],Layer:2e3,drop_rule:0,crush_rule:0,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!1,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!0,CanSetCandy:!0,CanSetMaoqiu:!1,CanSetBlueberry:!0,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:29,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!0},{attack_type:[],Layer:2e3,drop_rule:0,crush_rule:0,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!1,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!0,CanSetCandy:!0,CanSetMaoqiu:!1,CanSetBlueberry:!0,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:30,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!0},{attack_type:[],Layer:2e3,drop_rule:0,crush_rule:0,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!1,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!0,CanSetCandy:!0,CanSetMaoqiu:!1,CanSetBlueberry:!0,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:31,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!0},{attack_type:[],Layer:2e3,drop_rule:0,crush_rule:0,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!1,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!0,CanSetCandy:!0,CanSetMaoqiu:!1,CanSetBlueberry:!0,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:143,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!0},{attack_type:[2,3,5,6,4,7,10,9],Layer:1,drop_rule:0,crush_rule:1,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!0,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:2500,ChessType:68,CanBeAroundCrushed:!0,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16,15],Layer:1,drop_rule:0,crush_rule:1,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:100,Color:-1,Score:0,ChessType:69,CanBeAroundCrushed:!0,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[1,2,3,4,5,6,7,8,9,10,11,12,13,16],Layer:1,drop_rule:0,crush_rule:1,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!0,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:70,CanBeAroundCrushed:!0,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16,15],Layer:1,drop_rule:0,crush_rule:1,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!0,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:71,CanBeAroundCrushed:!0,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16,15],Layer:1,drop_rule:0,crush_rule:1,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!0,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:71,HP:0,Color:-1,Score:0,ChessType:72,CanBeAroundCrushed:!0,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16,15],Layer:1,drop_rule:0,crush_rule:1,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!0,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:73,CanBeAroundCrushed:!0,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16,15],Layer:1,drop_rule:0,crush_rule:1,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!0,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:73,HP:0,Color:-1,Score:0,ChessType:74,CanBeAroundCrushed:!0,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16,15],Layer:1,drop_rule:1,crush_rule:1,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:10,CanBeAroundCrushed:!0,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16,15],Layer:1,drop_rule:1,crush_rule:1,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:10,HP:0,Color:-1,Score:0,ChessType:11,CanBeAroundCrushed:!0,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[],Layer:2e3,drop_rule:0,crush_rule:0,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!1,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!0,CanSetCandy:!0,CanSetMaoqiu:!1,CanSetBlueberry:!0,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:41,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!0},{attack_type:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,16,15],Layer:0,drop_rule:0,crush_rule:2,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!1,CanCrushAround:!1,ForbidContinuousCrush:!0,IsCollection:!1,CanBeReplace:!0,CanSetCandy:!0,CanSetMaoqiu:!0,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:56,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!0},{attack_type:[1,2,3,4,5,6,7,8,9,10,11,12,13,16],Layer:2,drop_rule:0,crush_rule:1,UseRearrange:!1,StopDrop:!1,StopDropIn:!0,StopSlide:!0,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:91,CanBeAroundCrushed:!0,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[2,3,4,5,6,7,8,9,10,11,12,13,16],Layer:2,drop_rule:0,crush_rule:1,UseRearrange:!1,StopDrop:!1,StopDropIn:!0,StopSlide:!0,StopJoin:!1,UseSpecial:!1,UseSwap:!1,CanUseHammer:!0,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!1,CanSetBlueberry:!1,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!1,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:91,HP:0,Color:-1,Score:0,ChessType:92,CanBeAroundCrushed:!1,CanSlide:!1,collect_type:2,Compatible4GridBoss:!0},{attack_type:[1,2,3,4,5,6,7,8,9,10,11,12,13,16],Layer:1,drop_rule:1,crush_rule:1,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!0,CanCrushAround:!0,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!0,CanSetCandy:!0,CanSetMaoqiu:!0,CanSetBlueberry:!0,CanSwapGhost:!0,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!0,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:1e4,ChessType:13,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!0},{attack_type:[1,2,3,4,5,6,7,8,9,10,11,12,13,16],Layer:1,drop_rule:1,crush_rule:1,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!0,CanCrushAround:!0,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!1,CanSetCandy:!1,CanSetMaoqiu:!0,CanSetBlueberry:!0,CanSwapGhost:!0,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!0,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:100,ChessType:16,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!0},{attack_type:[1,2,3,4,5,6,7,8,9,10,11,12,13,16],Layer:1,drop_rule:1,crush_rule:1,UseRearrange:!0,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!0,CanCrushAround:!0,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!0,CanSetCandy:!0,CanSetMaoqiu:!0,CanSetBlueberry:!0,CanSwapGhost:!0,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!0,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:100,ChessType:17,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!0},{attack_type:[],Layer:2e3,drop_rule:0,crush_rule:0,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!1,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!0,CanSetCandy:!0,CanSetMaoqiu:!1,CanSetBlueberry:!0,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:34,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!1},{attack_type:[],Layer:2e3,drop_rule:0,crush_rule:0,UseRearrange:!1,StopDrop:!1,StopDropIn:!1,StopSlide:!1,StopJoin:!1,UseSpecial:!0,UseSwap:!0,CanUseHammer:!1,CanCrushAround:!1,ForbidContinuousCrush:!1,IsCollection:!1,CanBeReplace:!0,CanSetCandy:!0,CanSetMaoqiu:!1,CanSetBlueberry:!0,CanSwapGhost:!1,CanSetStartItem:!1,CanChangeColor:!0,CanRandomColor:!0,CanAttackIce:!1,CanUseLastpang:!0,IsSpecialChess1:!1,IsSpecialChess2:!1,NextType:0,HP:0,Color:-1,Score:0,ChessType:35,CanBeAroundCrushed:!1,CanSlide:!0,collect_type:2,Compatible4GridBoss:!1}],i=[[a.GRID_ELEMENT_ID.ELEMENT_QIGE_CONTAINER,r.MovingItemType.MIT_NONE,d.ChessType.STIT_NONE],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_NORMAL_1,r.MovingItemType.MIT_0,d.ChessType.CT_NormalUnit],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_NORMAL_2,r.MovingItemType.MIT_1,d.ChessType.CT_NormalUnit],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_NORMAL_3,r.MovingItemType.MIT_2,d.ChessType.CT_NormalUnit],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_NORMAL_4,r.MovingItemType.MIT_3,d.ChessType.CT_NormalUnit],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_NORMAL_5,r.MovingItemType.MIT_4,d.ChessType.CT_NormalUnit],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_NORMAL_6,r.MovingItemType.MIT_5,d.ChessType.CT_NormalUnit],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_NORMAL_7,r.MovingItemType.MIT_6,d.ChessType.CT_NormalUnit],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_NORMAL_RANDOM,r.MovingItemType.MIT_RANDOM,d.ChessType.CT_NormalUnit],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_1,r.MovingItemType.MIT_0,d.ChessType.CT_SpecialVerticalShockWave],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_2,r.MovingItemType.MIT_1,d.ChessType.CT_SpecialVerticalShockWave],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_3,r.MovingItemType.MIT_2,d.ChessType.CT_SpecialVerticalShockWave],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_4,r.MovingItemType.MIT_3,d.ChessType.CT_SpecialVerticalShockWave],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_5,r.MovingItemType.MIT_4,d.ChessType.CT_SpecialVerticalShockWave],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_6,r.MovingItemType.MIT_5,d.ChessType.CT_SpecialVerticalShockWave],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_7,r.MovingItemType.MIT_6,d.ChessType.CT_SpecialVerticalShockWave],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SHOCKWAVE_UP_DOWN_RANDOM,r.MovingItemType.MIT_RANDOM,d.ChessType.CT_SpecialVerticalShockWave],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_1,r.MovingItemType.MIT_0,d.ChessType.CT_SpecialHorizontalShockWave],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_2,r.MovingItemType.MIT_1,d.ChessType.CT_SpecialHorizontalShockWave],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_3,r.MovingItemType.MIT_2,d.ChessType.CT_SpecialHorizontalShockWave],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_4,r.MovingItemType.MIT_3,d.ChessType.CT_SpecialHorizontalShockWave],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_5,r.MovingItemType.MIT_4,d.ChessType.CT_SpecialHorizontalShockWave],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_6,r.MovingItemType.MIT_5,d.ChessType.CT_SpecialHorizontalShockWave],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_7,r.MovingItemType.MIT_6,d.ChessType.CT_SpecialHorizontalShockWave],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SHOCKWAVE_LEFT_RIGHT_RANDOM,r.MovingItemType.MIT_RANDOM,d.ChessType.CT_SpecialHorizontalShockWave],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_BLAST_CYCLONE_1,r.MovingItemType.MIT_0,d.ChessType.CT_SpecialHurricane],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_BLAST_CYCLONE_2,r.MovingItemType.MIT_1,d.ChessType.CT_SpecialHurricane],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_BLAST_CYCLONE_3,r.MovingItemType.MIT_2,d.ChessType.CT_SpecialHurricane],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_BLAST_CYCLONE_4,r.MovingItemType.MIT_3,d.ChessType.CT_SpecialHurricane],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_BLAST_CYCLONE_5,r.MovingItemType.MIT_4,d.ChessType.CT_SpecialHurricane],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_BLAST_CYCLONE_6,r.MovingItemType.MIT_5,d.ChessType.CT_SpecialHurricane],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_BLAST_CYCLONE_7,r.MovingItemType.MIT_6,d.ChessType.CT_SpecialHurricane],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_BLAST_CYCLONE_RANDOM,r.MovingItemType.MIT_RANDOM,d.ChessType.CT_SpecialHurricane],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_GHOST,r.MovingItemType.MIT_NONE,d.ChessType.CT_SpecialGas],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_COLLECT_CANDY,r.MovingItemType.MIT_NONE,d.ChessType.CT_COLLECTCANDY],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_DIGGER_CHOCOLATE_1L,r.MovingItemType.MIT_NONE,d.ChessType.CT_CLODS0],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_DIGGER_CHOCOLATE_2L,r.MovingItemType.MIT_NONE,d.ChessType.CT_CLODS1],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_STEPBOMB_1,r.MovingItemType.MIT_0,d.ChessType.CT_TICKBOMB],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_STEPBOMB_2,r.MovingItemType.MIT_1,d.ChessType.CT_TICKBOMB],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_STEPBOMB_3,r.MovingItemType.MIT_2,d.ChessType.CT_TICKBOMB],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_STEPBOMB_4,r.MovingItemType.MIT_3,d.ChessType.CT_TICKBOMB],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_STEPBOMB_5,r.MovingItemType.MIT_4,d.ChessType.CT_TICKBOMB],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_STEPBOMB_6,r.MovingItemType.MIT_5,d.ChessType.CT_TICKBOMB],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_STEPBOMB_7,r.MovingItemType.MIT_6,d.ChessType.CT_TICKBOMB],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_STEPBOMB_RANDOM,r.MovingItemType.MIT_RANDOM,d.ChessType.CT_TICKBOMB],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SODA_BUBBLE_1,r.MovingItemType.MIT_0,d.ChessType.CT_SodaBottle],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SODA_BUBBLE_2,r.MovingItemType.MIT_1,d.ChessType.CT_SodaBottle],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SODA_BUBBLE_3,r.MovingItemType.MIT_2,d.ChessType.CT_SodaBottle],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SODA_BUBBLE_4,r.MovingItemType.MIT_3,d.ChessType.CT_SodaBottle],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SODA_BUBBLE_5,r.MovingItemType.MIT_4,d.ChessType.CT_SodaBottle],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SODA_BUBBLE_6,r.MovingItemType.MIT_5,d.ChessType.CT_SodaBottle],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SODA_BUBBLE_7,r.MovingItemType.MIT_6,d.ChessType.CT_SodaBottle],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_SODA_BUBBLE_RANDOM,r.MovingItemType.MIT_RANDOM,d.ChessType.CT_SodaBottle],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_EXTRASTEP_1,r.MovingItemType.MIT_0,d.ChessType.CT_STEPBONUS],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_EXTRASTEP_2,r.MovingItemType.MIT_1,d.ChessType.CT_STEPBONUS],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_EXTRASTEP_3,r.MovingItemType.MIT_2,d.ChessType.CT_STEPBONUS],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_EXTRASTEP_4,r.MovingItemType.MIT_3,d.ChessType.CT_STEPBONUS],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_EXTRASTEP_5,r.MovingItemType.MIT_4,d.ChessType.CT_STEPBONUS],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_EXTRASTEP_6,r.MovingItemType.MIT_5,d.ChessType.CT_STEPBONUS],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_EXTRASTEP_7,r.MovingItemType.MIT_6,d.ChessType.CT_STEPBONUS],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_EXTRASTEP_RANDOM,r.MovingItemType.MIT_RANDOM,d.ChessType.CT_STEPBONUS],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_CHANGE_COLOR,r.MovingItemType.MIT_RANDOM,d.ChessType.CT_Chameleon],[a.GRID_ELEMENT_ID.ELEMENT_GONGNENG_DROPPIONT_NORMAL,r.MovingItemType.MIT_NONE,d.ChessType.STIT_DROP_POINT],[a.GRID_ELEMENT_ID.ELEMENT_GONGNENG_COLLECTPIONT_SUGAR,r.MovingItemType.MIT_NONE,d.ChessType.STIT_COLLECTCANDY_POINT],[a.GRID_ELEMENT_ID.ELEMENT_GONGNENG_APPEARPIONT_UP,r.MovingItemType.MIT_NONE,d.ChessType.STIT_DROP_POINT_IN_SODA],[a.GRID_ELEMENT_ID.ELEMENT_GONGNENG_COLLECTPIONT_SODA,r.MovingItemType.MIT_NONE,d.ChessType.STIT_COLLECT_POINT_IN_SODA],[a.GRID_ELEMENT_ID.ELEMENT_GONGNENG_WORMHOLE_START,r.MovingItemType.MIT_NONE,d.ChessType.STIT_CHONGDONG1],[a.GRID_ELEMENT_ID.ELEMENT_GONGNENG_WORMHOLE_END,r.MovingItemType.MIT_NONE,d.ChessType.STIT_CHONGDONG2],[a.GRID_ELEMENT_ID.ELEMENT_GONGNENG_CONVEYOR,r.MovingItemType.MIT_NONE,d.ChessType.STIT_CONVEYER],[a.GRID_ELEMENT_ID.ELEMENT_GONGNENG_BARRIER_RIGHT,r.MovingItemType.MIT_NONE,d.ChessType.STIT_FENCE_RIGHT],[a.GRID_ELEMENT_ID.ELEMENT_GONGNENG_BARRIER_DOWN,r.MovingItemType.MIT_NONE,d.ChessType.STIT_FENCE_BOTTOM],[a.GRID_ELEMENT_ID.ELEMENT_QIDI_ABAO,r.MovingItemType.MIT_NONE,d.ChessType.STIT_COLLECT_UNDER_ICE],[a.GRID_ELEMENT_ID.ELEMENT_QIGE_NULL,r.MovingItemType.MIT_NONE,d.ChessType.STIT_NOUSE],[a.GRID_ELEMENT_ID.ELEMENT_QIDI_GRASSLAND,r.MovingItemType.MIT_NONE,d.ChessType.STIT_BLUEBERRY],[a.GRID_ELEMENT_ID.ELEMENT_QIDI_WITHERED_GRASS,r.MovingItemType.MIT_NONE,d.ChessType.STIT_BAD_BLUEBERRY],[a.GRID_ELEMENT_ID.ELEMENT_QIDI_ICE_1L,r.MovingItemType.MIT_NONE,d.ChessType.STIT_ICE],[a.GRID_ELEMENT_ID.ELEMENT_QIDI_ICE_2L,r.MovingItemType.MIT_NONE,d.ChessType.STIT_DEEPICE],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_WOODENBOX_1L,r.MovingItemType.MIT_NONE,d.ChessType.STIT_BOX],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_WOODENBOX_2L,r.MovingItemType.MIT_NONE,d.ChessType.STIT_BOX_TWO],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_WOODENBOX_3L,r.MovingItemType.MIT_NONE,d.ChessType.STIT_BOX_THREE],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_WOODENBOX_4L,r.MovingItemType.MIT_NONE,d.ChessType.STIT_BOX_FOUR],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_CANDY_JAR,r.MovingItemType.MIT_NONE,d.ChessType.STIT_CANDYPOT],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_DOUGHNUT,r.MovingItemType.MIT_NONE,d.ChessType.STIT_DONUTSBOMB],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_MUSHROOM_BIG,r.MovingItemType.MIT_NONE,d.ChessType.STIT_HUGEMUSHROOM],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_MUSHROOM_SMALL,r.MovingItemType.MIT_NONE,d.ChessType.STIT_LITTLEMUSHROOM],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_DIGGER_CLOUD_1L,r.MovingItemType.MIT_NONE,d.ChessType.STIT_COMMONCLOUD1],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_DIGGER_CLOUD_2L,r.MovingItemType.MIT_NONE,d.ChessType.STIT_COMMONCLOUD2],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_DIGGER_CLOUD_JEWEL_1L,r.MovingItemType.MIT_NONE,d.ChessType.STIT_STONECLOUD1],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_DIGGER_CLOUD_JEWEL_2L,r.MovingItemType.MIT_NONE,d.ChessType.STIT_STONECLOUD2],[a.GRID_ELEMENT_ID.ELEMENT_QIZI_COLLECT_BALLOON,r.MovingItemType.MIT_NONE,d.ChessType.CT_COLLECTBALLOON],[a.GRID_ELEMENT_ID.ELEMENT_GONGNENG_COLLECTPIONT_BALLOON,r.MovingItemType.MIT_NONE,d.ChessType.STIT_COLLECTBALLOON_POINT],[a.GRID_ELEMENT_ID.ELEMENT_QIMIAN_MAOQIU_1L,r.MovingItemType.MIT_NONE,d.ChessType.STIT_MAOQIU1],[a.GRID_ELEMENT_ID.ELEMENT_QIMIAN_MAOQIU_2L,r.MovingItemType.MIT_NONE,d.ChessType.STIT_MAOQIU2],[a.GRID_ELEMENT_ID.ELEMENT_QIMIAN_CAGE_1L,r.MovingItemType.MIT_NONE,d.ChessType.STIT_CAGE],[a.GRID_ELEMENT_ID.ELEMENT_QIMIAN_CAGE_2L,r.MovingItemType.MIT_NONE,d.ChessType.STIT_CAGE2],[a.GRID_ELEMENT_ID.ELEMENT_QIMIAN_PAPER_1L,r.MovingItemType.MIT_NONE,d.ChessType.STIT_CANDYPAPER1],[a.GRID_ELEMENT_ID.ELEMENT_QIMIAN_PAPER_2L,r.MovingItemType.MIT_NONE,d.ChessType.STIT_CANDYPAPER2],[a.GRID_ELEMENT_ID.ELEMENT_QIMIAN_PAPER_3L,r.MovingItemType.MIT_NONE,d.ChessType.STIT_CANDYPAPER3],[a.GRID_ELEMENT_ID.ELEMENT_QIMIAN_PAPER_4L,r.MovingItemType.MIT_NONE,d.ChessType.STIT_CANDYPAPER4],[a.GRID_ELEMENT_ID.ELEMENT_QIMIAN_PAPER_5L,r.MovingItemType.MIT_NONE,d.ChessType.STIT_CANDYPAPER5],[a.GRID_ELEMENT_ID.ELEMENT_GONGNENG_APPEARPIONT_UP_VALVEGATE,r.MovingItemType.MIT_NONE,d.ChessType.STIT_DROP_VALVE_IN_SODA]],n=function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:d.PassConditionType.kPassCondScore,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:d.ChessType.STIT_NONE,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:r.MovingItemType.MIT_NONE;C(this,o),this.pass_type=e,this.chess_type=t,this.chess_color=n},l=function(){function t(){C(this,t),this.config=_,this.ChessPropertiesTable_={},this.PassConditionTable_={},this.mElementToChessMap={},this.inited_=!1,this.Init()}return o(t,[{key:"Init",value:function(){this.inited_||(this.ChessPropertiesTableInit(),this.PassConditionTableInit(),this.InitElementMap(),this.inited_=!0)}},{key:"ChessPropertiesTableInit",value:function(){for(var a=_.length,e=0,t;e<a;e++)t=_[e],this.ChessPropertiesTable_[t.ChessType]=t}},{key:"PassConditionTableInit",value:function(){var t=this.PassConditionTable_;t[a.PASS_CONDITION_TYPE.PASS_CONDITION_STEP_OVER]=new n(d.PassConditionType.kPassCondAllStep),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_SCORE]=new n(d.PassConditionType.kPassCondScore),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_BOSS]=new n(d.PassConditionType.kPassCondBoss),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_COLLECT_BALLOON]=new n(d.PassConditionType.kPassCondCollectChess,d.ChessType.CT_COLLECTBALLOON),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_COLLECT_NORMAL_1]=new n(d.PassConditionType.kPassCondCollectColor,d.ChessType.CT_NormalUnit,r.MovingItemType.MIT_0),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_COLLECT_NORMAL_2]=new n(d.PassConditionType.kPassCondCollectColor,d.ChessType.CT_NormalUnit,r.MovingItemType.MIT_1),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_COLLECT_NORMAL_3]=new n(d.PassConditionType.kPassCondCollectColor,d.ChessType.CT_NormalUnit,r.MovingItemType.MIT_2),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_COLLECT_NORMAL_4]=new n(d.PassConditionType.kPassCondCollectColor,d.ChessType.CT_NormalUnit,r.MovingItemType.MIT_3),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_COLLECT_NORMAL_5]=new n(d.PassConditionType.kPassCondCollectColor,d.ChessType.CT_NormalUnit,r.MovingItemType.MIT_4),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_COLLECT_NORMAL_6]=new n(d.PassConditionType.kPassCondCollectColor,d.ChessType.CT_NormalUnit,r.MovingItemType.MIT_5),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_COLLECT_QIZI_SHOCKWAVE]=new n(d.PassConditionType.kPassCondCollectChess,d.ChessType.CT_SpecialHorizontalShockWave),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_COLLECT_QIZI_BLAST]=new n(d.PassConditionType.kPassCondCollectChess,d.ChessType.CT_SpecialHurricane),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_COLLECT_QIZI_GHOST]=new n(d.PassConditionType.kPassCondCollectChess,d.ChessType.CT_SpecialGas),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_COLLECT_BOTTOM_ICE]=new n(d.PassConditionType.kPassCondCollectChess,d.ChessType.STIT_ICE),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_SODA_QIZI]=new n(d.PassConditionType.kPassCondCollectChess,d.ChessType.CT_SodaBottle),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_COLLECT_WOODENBOX]=new n(d.PassConditionType.kPassCondCollectChess,d.ChessType.STIT_BOX),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_COLLECT_DOUGHNUT]=new n(d.PassConditionType.kPassCondCollectChess,d.ChessType.STIT_DONUTSBOMB),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_COLLECT_CLOUD_JEWEL]=new n(d.PassConditionType.kPassCondCollectChess,d.ChessType.STIT_STONECLOUD1),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_COLLECT_CLOUD_REDPACKET]=new n(d.PassConditionType.kPassCondCollectChess,d.ChessType.STIT_REDPACKET1),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_GENERATE_GRASS]=new n(d.PassConditionType.kPassCondCollectChess,d.ChessType.STIT_BLUEBERRY),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_AIBAO]=new n(d.PassConditionType.kPassCondCollectChess,d.ChessType.STIT_COLLECT_UNDER_ICE),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_COLLECT_CANDY]=new n(d.PassConditionType.kPassCondCollectChess,d.ChessType.CT_COLLECTCANDY),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_WIPEOUT_MAOQIU]=new n(d.PassConditionType.kPassCondCollectChess,d.ChessType.STIT_MAOQIU1),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_COLLECT_PAPER]=new n(d.PassConditionType.kPassCondCollectChess,d.ChessType.STIT_CANDYPAPER1),t[a.PASS_CONDITION_TYPE.PASS_CONDITION_ELIMINATE_MUSHROOM_BIG]=new n(d.PassConditionType.kPassCondCollectChess,d.ChessType.STIT_HUGEMUSHROOM)}},{key:"GetChessTypeByConditionType",value:function(a){var e=this.PassConditionTable_[a];return null==e?null:e.chess_type}},{key:"GetElementMap",value:function(){return this.mElementToChessMap}},{key:"ChessPropertiesTable",value:function(){return this.ChessPropertiesTable_}},{key:"InitElementMap",value:function(){for(var a=i.length,e=0;e<a;e++){var t=i[e],n=new s.ChessDesc;n.type=t[2],n.color=t[1],this.mElementToChessMap[t[0]]=n}}},{key:"VaildElement",value:function(t){switch(t.element_id){case a.GRID_ELEMENT_ID.ELEMENT_QIGE_CONTAINER:return!1;default:return!0;}}},{key:"ElementToChess",value:function(a){var e=new s.ChessDesc,t=this.mElementToChessMap[a.element_id];return t&&(e.type=t.type,e.color=t.color,e.attach.iElementId=a.element_id,a.element_data1&&(e.attach.iVal1=a.element_data1),a.element_data2&&(e.attach.iVal2=a.element_data2),a.element_data3&&(e.attach.iVal3=a.element_data3),this.CheckTypeByAttachData(e.type,e.attach)),e}},{key:"ElementIDToChessType",value:function(a){var e=d.ChessType.STIT_NONE,t=this.mElementToChessMap[a];return t&&(e=t.type),e}},{key:"CheckTypeByAttachData",value:function(){}}]),t}();E.exports={PassConditionDesc:n,TableManager:l}},function(s,e,t){"use strict";function E(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},a=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),n=n||t(12),r={kUnknown:0,kUp:1,kDown:2,kLeft:3,kRight:4,kLeftUp:5,kRightUp:6,kLeftDown:7,kRightDown:8},i=function(){function _(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1;if(E(this,_),"object"==("undefined"==typeof e?"undefined":o(e))){var n=e;this.row=n.row,this.col=n.col}else this.row=e,this.col=a}return a(_,[{key:"copyData",value:function(a){this.row=a.row,this.col=a.col}},{key:"isEqual",value:function(a){return this.row==a.row&&this.col==a.col}},{key:"isNotEqual",value:function(a){return!this.isEqual(a)}},{key:"isLessThan",value:function(a){return this.row==a.row?this.col<a.col:this.row<a.row}},{key:"addPos",value:function(e){var a=new _(this);return a.row+=e.row,a.col+=e.col,a}},{key:"minuPos",value:function(e){var a=new _(this);return a.row-=e.row,a.col-=e.col,a}},{key:"Swap",value:function(a){var e=this.row,t=this.col;this.row=a.row,this.col=a.col,a.row=e,a.col=t}},{key:"IsValid",value:function(){return-1!=this.row&&-1!=this.col}},{key:"Reset",value:function(){this.row=-1,this.col=-1}},{key:"Direction",value:function(a){if(this.row==a.row){if(this.col+1==a.col)return r.kRight;if(this.col-1==a.col)return r.kLeft}else if(this.col==a.col){if(this.row+1==a.row)return r.kDown;if(this.row-1==a.row)return r.kUp}return r.kUnknown}},{key:"ToPosition",value:function(){var a=new n.Position;return a.row=this.row,a.col=this.col,a}}]),_}();s.exports={DEBUG:!1,GridDirection:r,GridPosition:i,Ref_Adapter:function a(e){E(this,a),this.val=e},ConveyerItem:function a(e,t){E(this,a),this.curPos=new i(e),this.nextPos=new i(t)},ChessLayer:n.ChessLayer,kChessLayerBottom:n.ChessLayer.kChessLayer0,kChessLayerChess:n.ChessLayer.kChessLayer1,StaticItemType:n.ChessType,MovingItemType:{MIT_0:n.ChessColor.kChessColorYellow,MIT_1:n.ChessColor.kChessColorRed,MIT_2:n.ChessColor.kChessColorBrown,MIT_3:n.ChessColor.kChessColorGreen,MIT_4:n.ChessColor.kChessColorBlue,MIT_5:n.ChessColor.kChessColorPurple,MIT_6:n.ChessColor.kChessColorWhite,MIT_NONE:n.ChessColor.kChessColorNone,MIT_RANDOM:n.ChessColor.kChessColorRandom,MIT_TRANSPARENT:n.ChessColor.kChessColorTransparent},DropWay:{DropWay_Fall:0,DropWay_Float:1,DropWay_Path:2,DropWay_L2R:3,DropWay_R2L:4,DropWay_Teleport:5},AttackItemType:n.AttackType,ItemId:n.ItemId,ExchangItemResult:{EIR_None:0,EIR_NormalExchangeSucc:1,EIR_ExchangeFailed:2,ERI_ExchangeFailedFence:3},IceCollectType:{None:0,One_And_Two:1,Two_And_Three:2,Three_And_Five:3},"RayFaceType ":{LastPangRay:0,BulletRay:1,WeekGameSkillChess:2},CollectionColor:{CCC_NONE:-1,CCC_RED:0,CCC_YELLOW:1,CCC_GREEN:2,CCC_BLUE:3,CCC_BROWN:4,CCC_COUNT:5},CollectionColorType:{CCCT_NONE:0,CCCT_1:1,CCCT_2:2,CCCT_3:3,CCCT_4:4,CCCT_5:5},LittleBatchIndexStruct:function a(){E(this,a),this.m_extra_intervalue_value=0,this.m_parent_batch_index=0,this.m_self_batch_index=0},PuzzleGameState:{PGS_NONE:0,PGS_PLAYING:1,PGS_LASTPANG:2,PGS_SUCCESS_END:3,PGS_FAIL_END:4},BackGroundItemType:{BGIT_BLANK:1,BGIT_NONE:-1},PointBombType:{Bomb_NormalUnit_type:0,Bomb_VerticalShockWave_type:1,Bomb_HorizontalShockWave_type:2,Bomb_Hurricane_type:3,Bomb_Gas_type:4,Bomb_Gas_Gas_type:5,Bomb_Special_Gas_type:6,Bomb_CrossShockWave_type:7,Bomb_BigHurricane_type:8,Bomb_ThickCrossShock_type:9,Bomb_LastPang_type:10,Bomb_Unit_Fly_Gas_type:11,AttachCount_Minus:12},ConveyerDirection:{Conveyer_None:-1,Conveyer_Up:0,Conveyer_Down:1,Conveyer_Left:2,Conveyer_Right:3,Conveyer_TopLeft_Right:4,Conveyer_TopLeft_Down:5,Conveyer_TopRight_Left:6,Conveyer_TopRight_Down:7,Conveyer_BottomLeft_Right:8,Conveyer_BottomLeft_Up:9,Conveyer_BottomRight_Left:10,Conveyer_BottomRight_Up:11,Conveyer_Broken_Out_Up:12,Conveyer_Broken_Out_Down:13,Conveyer_Broken_Out_Left:14,Conveyer_Broken_Out_Right:15,Conveyer_Broken_In_Up:16,Conveyer_Broken_In_Down:17,Conveyer_Broken_In_Left:18,Conveyer_Broken_In_Right:19},GAS_GAS_BATCH_EXTRA_INTER_VALUE:500,SPECIAL_ITEM_BATCH_EXTRA_INTER_VALUE:100,GAS_MARK_OTHER_ITEM_EXTRA_INTER_VALUE:300,GIFT_ITEM_INCLUDE_MAX_TOOL_TYPE:3}},function(l,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),a=a||t(12),r=r||t(17),i=function(){function a(){n(this,a),this.iVal1=0,this.iVal2=0,this.iVal3=0,this.iElementId=0}return o(a,[{key:"copyDataFrom",value:function(a){null!=a&&(this.iVal1=a.iVal1,this.iVal2=a.iVal2,this.iVal3=a.iVal3,this.iElementId=a.iElementId)}}]),a}(),E=function(){function t(){n(this,t),this.attack_type=a.AttackType.Attack_Normal,this.src=new r.GridPosition,this.other=new r.GridPosition,this.join=0,this.depth=0,this.special_bomb=!1,this.around_attack=!1,this.batch=new r.LittleBatchIndexStruct}return o(t,[{key:"copyDataFrom",value:function(a){this.attack_type=a.attack_type,this.src=new r.GridPosition(a.src),this.other=new r.GridPosition(a.other),this.join=a.join,this.depth=a.depth,this.special_bomb=a.special_bomb,this.around_attack=a.around_attack}}]),t}(),C=function(){function a(){n(this,a)}return o(a,[{key:"PreInit",value:function(){}},{key:"Release",value:function(){}},{key:"Backup",value:function(){return null}},{key:"Restore",value:function(){}},{key:"SetActive",value:function(){}},{key:"Active",value:function(){return!1}},{key:"GetAttach",value:function(){return null}},{key:"SetAttach",value:function(){}},{key:"OnCreate",value:function(){}},{key:"OnSlide",value:function(){}},{key:"OnDestroy",value:function(){}},{key:"OnDrop",value:function(){}},{key:"OnGenerated",value:function(){}},{key:"Remove",value:function(){}},{key:"Init",value:function(){}},{key:"Attribute",value:function(){return null}},{key:"CanCrush",value:function(){return!0}},{key:"Crush",value:function(){return!0}},{key:"ActiveChessBuffer",value:function(){return 1<arguments.length&&void 0!==arguments[1]&&arguments[1],!0}},{key:"IsType",value:function(){return!0}},{key:"Type",value:function(){return 0}},{key:"CreateChangeAnim",value:function(){}},{key:"GetNode",value:function(){return null}},{key:"SetNode",value:function(){}},{key:"ToChessData",value:function(){return null}},{key:"GetEmptyChessData",value:function(){return null}},{key:"CrushMark",value:function(){return 0}},{key:"SetCrushMark",value:function(){}},{key:"Color",value:function(){return 0}},{key:"SetColor",value:function(){}},{key:"NextChess",value:function(){return null}},{key:"SetNextChess",value:function(){}},{key:"NextType",value:function(){return 0}}]),a}();l.exports={PuzzleStaticItemAttachData:i,ChessDesc:function a(e){n(this,a),this.type=0,this.color=0,this.attach=new i,null!=e&&(this.type=e.type,this.color=e.type,this.attach.copyDataFrom(e))},AttackInfo:E,ChessInterface:C}},function(a){a.exports=o},function(a){a.exports=t},function(d,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),a=t(8),r=t(12),i=t(13),s={},_=r.AttackType;s[_.Attack_CrossShockWave]=5e3,s[_.Attack_ThickCrossShockWave]=1e4,s[_.Attack_BigHurricane]=15e3,s[_.Attack_Gas2Gas]=2e4,s[_.Attack_GasSpecial]=2e4,s[_.Attack_Lastpang]=1400,s[_.Attack_Hurricane]=2500,s[_.Attack_HorizontalShockWave]=1e3,s[_.Attack_VerticalShockWave]=1e3,s[_.Attack_Gas]=5e3;var p={},T=r.ChessType;p[T.CT_COLLECTBALLOON]=1e4,p[T.CT_COLLECTCANDY]=1e4;var I={1:0,2:100,3:200,4:500,5:1000},E=function(){function _(e){n(this,_),this.gameIns=e,this.score=0,this.lastRound=1}return o(_,[{key:"responseEvent",value:function(o,e){o==a.REMOVE&&this.resolve(e)}},{key:"resolve",value:function(_){var e=_.bomb_chess,E=0,t=0,o=s[_.attack_type]||0,a=_.rounds;1<a&&this.lastRound!=a&&(t=5<a?I[5]:I[a]||0),this.lastRound=a,e.forEach(function(n){var e=n.type,t=n.color;if(e==r.ChessType.CT_NormalUnit){E+=100;var o=i.passConditionManager.getCollectColor();o&&o==t&&(E+=1e4)}else p[e]&&(E+=p[e])}),this.score+=l((E+t+o)*(1+i.envManager.GetAdditionScoreRate()))}},{key:"getScore",value:function(){return this.score}},{key:"addScore",value:function(a){this.score+=l(a*(1+i.envManager.GetAdditionScoreRate()))}},{key:"getStar",value:function(){var a=this.score,e=i.stageManager.simple_stage_info(),t=e.star_score,n=1;return a>=t[1]&&a<t[2]?n=2:a>=t[2]&&(n=3),n}},{key:"AddScoreAddition",value:function(a){i.envManager.SetAdditionScoreRate(i.envManager.GetAdditionScoreRate()+a/100)}}]),_}();d.exports=E},function(C,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),a=t(8),r=t(12),i=t(17),d=t(23),_=t(13),s=s||t(24),l=r.AnimationId,p=i.DEBUG,T=function(){function r(e){n(this,r),this.gameIns=e,this.queue=[],this.removeCache=[]}return o(r,[{key:"responseEvent",value:function(o,e){this.gameIns.isNode()||(o===a.SWAP?(this.pushSingleAnimation(l.swap,e),console.log("swap aniData : "+JSON.stringify(e))):o===a.REMOVE?this.resolveRemove(e):o===a.DROP?this.pushSingleAnimation(l.drop,e):o===a.END_ONE_REMOVE_ROUND?this.triggerRemoveAnimation():void 0)}},{key:"pushSingleAnimation",value:function(a,e){if(!this.gameIns.isNode()){var t=this.generateAnimation(a,e);this.pushAnimation([t])}}},{key:"pushBatchAnimation",value:function(a){if(!this.gameIns.isNode()){for(var e=[],t=0,n;t<a.length;t++)n=a[t],e.push(this.generateAnimation(n.id,n.data));this.pushAnimation(e)}}},{key:"generateAnimation",value:function(a,o){return Object.assign({animation_id:a},o)}},{key:"resolveRemove",value:function(a){var o=this.generateAnimation(l.remove,{data:a});p?this.triggerRemoveAnimation(o):this.removeCache.push(o)}},{key:"triggerRemoveAnimation",value:function(_){var e=this.gameIns.scoreManager.getScore(),E=d.clone(this.gameIns.passConditionManager.getPassCondition()),C=this.gameIns.stageManager.getStep(),T=this.generateAnimation(l.step,{step:C}),a=this.generateAnimation(l.pass_condition,{data:E}),r=this.generateAnimation(l.score,{score:e});if(_&&p)this.pushAnimation([T,_,a,r]);else{if(!this.removeCache.length)return;var i=[];i.push(T),i=i.concat(this.removeCache),i.push(a),i.push(r),this.pushAnimation(i),this.removeCache=[]}}},{key:"getAnimation",value:function(){return this.queue.shift()}},{key:"pushAnimation",value:function(a){_.envManager.GetIsWorkerMode()?postMessage({msg:"addAnimation",data:{aniData:a,state:_.curBoard.GetGameState()}}):this.queue.push(a)}},{key:"getAnimationQueue",value:function(){return this.queue}},{key:"logAniQueue",value:function(){for(var a=this.queue.length,e=this.queue,t=0;t<a;t++)console.log(e[t])}},{key:"GenerateItemStepAnimation",value:function(a){this.pushSingleAnimation(l.itemStep,a)}},{key:"GenerateItemGlassAnimation",value:function(a){this.pushSingleAnimation(l.itemGlass,a)}},{key:"GenerateItemSwapAnimation",value:function(a){this.pushSingleAnimation(l.itemSwap,a)}},{key:"GenerateItemRearrangeAnimation",value:function(){this.pushSingleAnimation(l.itemRearrange,{data:function(){for(var s=_.boardViewer.Row(),e=_.boardViewer.Col(),t=[],n=[],o=0;o<s;o++)for(var a=0,r;a<e;a++)r=_.boardViewer.GetNode(o,a),r&&r.NeedReArrange()&&t.push(r);var l=t.length;if(0==l)return{};for(var E=parseInt(l/4+Math.random()*l/2),C=0,d;C<l;++C)d=(C+E)%l,n.push({chessData:t[C].ToChessData(),position:new i.GridPosition(t[d].GetPosition())});return n}()})}},{key:"GeneratePassThroughAnimation",value:function(a){this.pushSingleAnimation(l.pass_through,a)}},{key:"GenerateStepRewardBeginAnimation",value:function(a){console.log("\u6B65\u6570\u5956\u52B1\u5F00\u59CB"),this.pushSingleAnimation(l.step_reward_begin,a)}},{key:"GenerateStepRewardEndAnimation",value:function(a){console.log("\u6B65\u6570\u5956\u52B1\u7ED3\u675F"),this.pushSingleAnimation(l.step_reward_end,a)}},{key:"GenerateReplace",value:function(a){this.pushSingleAnimation(l.replace_chess,a)}},{key:"GenerateAttack",value:function(a){this.pushSingleAnimation(l.generate_attack,a)}},{key:"handleOverageStep",value:function(){var a=this.gameIns.scoreManager.getScore(),_=this.gameIns.stageManager.getStep(),r=this.generateAnimation(l.step,{step:_}),n=this.generateAnimation(l.score,{score:a});this.pushAnimation([r,n])}},{key:"GenerateAddFiveStepAnimation",value:function(){var e=this.gameIns.stageManager.getStep(),a=this.generateAnimation(l.step,{step:e});this.pushAnimation([a])}},{key:"GenerateGasSpecialEndAnimation",value:function(a){this.pushSingleAnimation(l.gas_special_end,a)}},{key:"GenerateGas2GasAnimation",value:function(a){this.pushSingleAnimation(l.gas_to_gas,{data:a})}},{key:"GenerateRollingBoardAni",value:function(a,o){_.envManager.GetIsWorkerMode()&&postMessage({msg:"UpdateData",data:[{key:"GetStartRow",data:o}]}),this.pushSingleAnimation(l.rolling_board,{startRow:a,newStartRow:o,nodeDataList:this.gameIns.getWorldNodeDataList()})}},{key:"GenerateCollectIceBearAni",value:function(a){this.pushSingleAnimation(l.collect_ice_bear,{id:a})}},{key:"GenerateMaoQiuJumpAni",value:function(a,r,s,i){_.dataCollector.addAniCollect("maoqiu",l.chess_move,{chess_layer:a,chess_data:r,src_pos:s,dest_pos:i})}},{key:"GenerateMaoQiuSplitAni",value:function(a,o){_.dataCollector.addAniCollect("maoqiu",l.maoqiu_split,{src_chess:a,split_chess:o})}},{key:"GenerateEmptyAni",value:function(){this.pushSingleAnimation(l.empty,null)}},{key:"GenerateChangeColorAni",value:function(a){this.pushSingleAnimation(l.change_color,a)}},{key:"GenerateBombWarningAni",value:function(a){this.pushSingleAnimation(l.bomb_warning,a)}},{key:"GenerateBombAddTickAni",value:function(a){_.dataCollector.addAniCollect("tickbomb",l.bomb_add_tick,a)}},{key:"GenerateTickbombBombAni",value:function(a){_.dataCollector.addAniCollect("tickbomb",l.tickbomb_bomb,a)}},{key:"GenerateTickbombTickAni",value:function(a){_.dataCollector.addAniCollect("tickbomb",l.tickbomb_tick,a)}},{key:"GenerateTickbombReplaceAni",value:function(a){_.dataCollector.addAniCollect("tickbomb",l.tickbomb_replace,a)}},{key:"GenerateConveyerTransferAni",value:function(a,r,s,i){_.dataCollector.addAniCollect("conveyer",l.conveyer_move,{chess_layer:a,chess_data:r,src_pos:s,dest_pos:i})}},{key:"GenerateConveyerChessScaleMoveAni",value:function(s,i,E,C,d,p){_.dataCollector.addAniCollect("conveyer",l.scale_move,{chess_layer:s,chess_data:i,src_pos:E,dest_pos:C,isScaleIn:d,direction:p})}}]),r}();C.exports=T},function(a){"use strict";var _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},s={clone:function(o){if(null==o||"object"!=("undefined"==typeof o?"undefined":_(o)))return o;var n=o.constructor?new o.constructor:{};for(var t in o){var a=o[t];n[t]="object"===("undefined"==typeof a?"undefined":_(a))?s.clone(a):a}return n},isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},isObject:function(a){return"object"===("undefined"==typeof a?"undefined":_(a))},getRandom:function(a,e){var t=Math.random();return a+l(t*(e-a))},arrayCopy:function(a,e){if(null!=a&&null!=e){a.splice(0,a.length);for(var t=e.length,n=0;n<t;n++)a.push(e[n])}},arrayDeepCopy:function(o,e){if(null!=o&&null!=e){o.splice(0,o.length);for(var t=e.length,n=0;n<t;n++)this.isObject(e[n])?o.push(s.clone(e[n])):o.push(e[n])}},unique:function(o,e){for(var t=[],n=0,a=o.length;n<a;n++){for(var _=n+1;_<a;_++)e(o[n],o[_])&&(_=++n);t.push(o[n])}s.arrayCopy(o,t)},removeElement:function(o,e){for(var t=[],n=0,a=o.length;n<a;n++)e(o[n])||t.push(o[n]);s.arrayCopy(o,t)},findEleInArr:function(a,e){for(var t=0,n=a.length;t<n;t++)if(e(a[t]))return!0;return!1}};a.exports=s},function(E,e,t){"use strict";function n(a,e,t){for(var n=0;n<t;n++)a[n]=e[n]}function o(){console.log("PuzzleGenerateNumbers");for(var a=0,e;624>a;++a)e=(32768&r[a])+(32767&r[(a+1)%624]),r[a]=r[(a+397)%624]^e>>1,1==e%2&&(r[a]=2567483615^r[a])}var a=a||t(25),r=Array(624),i=0,s=Array(624),_=0;E.exports={RandPushBack:function(){_=i,n(s,r,624)},RandPopUp:function(){i=_,n(r,s,624)},GetCurPuzzleSeed:function(a,e){r[0]=a;for(var t=1;624>t;++t)r[t]=1812433253*(r[t-1]^r[t-1]>>30)+t;for(var t=0;t<e/624+1;++t)o();var n=r[e%624];return n^=n>>11,n^=2636928640&n<<7,n^=4022730752&n<<15,n^=n>>18},PuzzleSrand:function(o){console.log("PuzzleSrand : "+o),a.curRandNumCount=0,a.randNumList=[],i=0,r[0]=o;for(var e=1;624>e;++e)r[e]=1812433253*(r[e-1]^r[e-1]>>30)+e},PuzzleRand:function(n){0==i&&o();var e=r[i];return e^=e>>11,e^=2636928640&e<<7,e^=4022730752&e<<15,e^=e>>18,i=(i+1)%624,a.CountARandNum(e,n),e}}},function(a){"use strict";var e={data:[],curStatItem:null,runLogicTimes:0,randNumList:[],curRandNumCount:0,logicLog:{initBoard:"",dropList:[]}};e.reset=function(){this.data=[],this.curStatItem=null,this.runLogicTimes=0,this.randNumList=[],this.curRandNumCount=0},e.startPoint=function(a){this.curStatItem&&this.endPoint(),this.curStatItem={tag:a,startTime:new Date().getTime(),endTime:0,cousumedTime:0}},e.endPoint=function(){var a=this.curStatItem;if(a){var e=new Date().getTime();a.endTime=e,a.cousumedTime=e-a.startTime,this.data.push(a)}this.curStatItem=null},e.addItem=function(a){this.data.push(a)},e.clear=function(){this.data.splice(0,this.data.length)},e.CountARandNum=function(a,e){this.randNumList.push([e,a]),this.curRandNumCount++},e.recordInitBoard=function(_){for(var e=_.world_node_count_,t=_.world_board_,n="",o=0;o<e;o++){var a=t[o],r=a.ChessType(),i=a.ChessColor();n+="("+r+","+i+")"}this.logicLog.initBoard=n},e.recordOneDrop=function(a,o){this.logicLog.dropList.push({randCount:a,data:o})},a.exports=e},function(l,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),E=(t(8),t(13)),r=t(11),C=t(12),a=function(){function a(e){n(this,a),this.gameIns=e,this.passStatus=C.GameStatus.kGameRunning,this.passCon_list=[],this.gameFailedFlag=!1}return o(a,[{key:"responseEvent",value:function(a,e){this.update(a,e)}},{key:"getPassCondition",value:function(){return this.passCon_list}},{key:"update",value:function(r,e){if("REMOVE"==r){var s=e.top_chess||[],n=e.bomb_chess||[],o=e.bg_chess||[],a=e.add_bg_chess||[],i=E.stageManager.getStep();this.passCon_list.forEach(function(_){var e=_.pass_type;e==C.PassConditionType.kPassCondScore?_.result1=E.scoreManager.getScore():e==C.PassConditionType.kPassCondAllStep?_.result1=i:(s.forEach(function(a){e==C.PassConditionType.kPassCondCollectChess&&a.type==_.collect_type&&(_.result1+=1)}),n.forEach(function(a){e==C.PassConditionType.kPassCondCollectChess?a.type==_.collect_type&&(_.result1+=1):e==C.PassConditionType.kPassCondCollectColor&&a.color==_.collect_type&&(_.result1+=1)}),o.forEach(function(a){e==C.PassConditionType.kPassCondCollectChess&&a.type==_.collect_type&&(_.result1+=1)}),a.forEach(function(a){e==C.PassConditionType.kPassCondCollectChess&&a.type==_.collect_type&&(_.result1+=1)}))})}}},{key:"specialCollect",value:function(a,e){this.passCon_list.forEach(function(t){t.pass_type==C.PassConditionType.kPassCondCollectChess&&t.collect_type==a&&(t.result1+=e)})}},{key:"initGLassCount",value:function(a){a&&this.passCon_list.forEach(function(e){e.pass_type==C.PassConditionType.kPassCondCollectChess&&e.collect_type===C.ChessType.STIT_BLUEBERRY&&(e.result1+=a)})}},{key:"parsePassCondition",value:function(s){var e=s.pass_condition,t=e.length,n=E.tableManager.PassConditionTable_,o=E.tableManager.ChessPropertiesTable();this.passCon_list=[];for(var a=0,_;a<t;a++)if(_=e[a],_.cond_type!=r.PASS_CONDITION_TYPE.PASS_CONDITION_INVALID){var i=new C.PassConditionData;i.collect_type=C.ChessType.STIT_NONE,i.value1=_.cond_data1,i.value2=_.cond_data2,i.result1=0,i.result2=0;var l=n[_.cond_type];i.pass_type=l.pass_type,l.pass_type==C.PassConditionType.kPassCondCollectChess?(i.collect_type=l.chess_type,i.CollectType=o[l.chess_type].collect_type):l.pass_type==C.PassConditionType.kPassCondCollectColor&&(i.collect_type=l.chess_color,i.CollectType=o[l.chess_type].collect_type,this.collect_chess_color=l.chess_color),this.passCon_list.push(i)}return this.passCon_list}},{key:"getCollectColor",value:function(){return this.collect_chess_color}},{key:"getStatus",value:function(){if(this.gameFailedFlag)return C.GameStatus.kGameFail;var a=C.GameStatus.kGameRunning,_=[],t=E.stageManager.getStep();this.passCon_list.forEach(function(a){var e=a.pass_type;e==C.PassConditionType.kPassCondAllStep?0>=t?_.push(1):_.push(0):a.result1>=a.value1?_.push(1):_.push(0)});var e=0>_.indexOf(0);return a=e?C.GameStatus.kGamePass:0>=t?C.GameStatus.kGameFail:C.GameStatus.kGameRunning}},{key:"UpdatePassCondition",value:function(){}},{key:"GameFail",value:function(){this.gameFailedFlag=!0}},{key:"ClearFail",value:function(){this.gameFailedFlag=!1}}]),a}();l.exports=a},function(_,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),a=t(12),r=t(13),i=function(){function _(e){n(this,_),this.gameIns=e,this.record_out_=new a.Record}return o(_,[{key:"SetStarInfo",value:function(a){this.record_out_.start_info=a}},{key:"AddInput",value:function(){if(!this.gameIns.isNode())if(1==arguments.length)this.record_out_.input.push(arguments[0]);else{var o=arguments[0],e=arguments[1],t=new a.Input;t.op=a.InputOp.kOpSlide,t.from=Object.assign({},o),t.to=Object.assign({},e),this.AddInput(t)}}},{key:"AddRespawnInfo",value:function(){var e=new a.Input;e.op=a.InputOp.kOpUseItem,e.item_id=a.ItemId.itemRespawn,this.AddInput(e),r.statManager.AddUsedItem(a.ItemId.itemRespawn)}},{key:"GetRecordOut",value:function(){var a=r.passConditionManager.getStatus();return this.record_out_.game_result=a,this.record_out_.game_info=r.statManager.getGameInfo(),this.record_out_}},{key:"Flush",value:function(){}}]),_}();_.exports=i},function(l,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),a=t(8),r=t(12),i=t(13),s=function(){function _(e){n(this,_),this.gameIns=e,this.gameInfo=new r.GameInfo,this.infoMap={crush_chess_count:{},crush_color_count:{},add_chess_count:{},add_color_count:{},attack_count:{}}}return o(_,[{key:"responseEvent",value:function(o,e){this.gameIns.isNode()||(o==a.SWAP?this.resolveSwap(e):o==a.REMOVE&&this.resolveRemove(e))}},{key:"resolveSwap",value:function(a){3!=a.result||a.item||(console.log("StatManager.resolveSwap"),this.gameInfo.slide_count++)}},{key:"resolveRemove",value:function(_){var s=this,e=_.bomb_chess,t=_.add_chess,o=_.attack_type;if(e.forEach(function(a){var e=a.type,t=a.color;s.infoMap.crush_chess_count[e]?s.infoMap.crush_chess_count[e]+=1:s.infoMap.crush_chess_count[e]=1,s.infoMap.crush_color_count[t]?s.infoMap.crush_color_count[t]+=1:s.infoMap.crush_color_count[t]=1}),t.forEach(function(a){var e=a.type,t=a.color;s.infoMap.add_chess_count[e]?s.infoMap.add_chess_count[e]+=1:s.infoMap.add_chess_count[e]=1,s.infoMap.add_color_count[t]?s.infoMap.add_color_count[t]+=1:s.infoMap.add_color_count[t]=1}),this.infoMap.attack_count[o]?this.infoMap.attack_count[o]+=1:this.infoMap.attack_count[o]=1,1<_.rounds){var a=_.rounds;5<a&&(a=5),a-=2,this.gameInfo.drop_round_count[a]?this.gameInfo.drop_round_count[a]+=1:this.gameInfo.drop_round_count[a]=1}}},{key:"AddUsedItem",value:function(a){this.gameInfo.used_item.push(a)}},{key:"getGameInfo",value:function(){for(var a in this.infoMap.crush_chess_count)this.gameInfo.crush_chess_count.push(new r.ChessCountItem(parseInt(a),this.infoMap.crush_chess_count[a]));for(var a in this.infoMap.crush_color_count)this.gameInfo.crush_color_count.push(new r.ColorCountItem(parseInt(a),this.infoMap.crush_color_count[a]));for(var a in this.infoMap.add_chess_count)this.gameInfo.add_chess_count.push(new r.ChessCountItem(parseInt(a),this.infoMap.add_chess_count[a]));for(var a in this.infoMap.add_color_count)this.gameInfo.add_color_count.push(new r.ColorCountItem(parseInt(a),this.infoMap.add_color_count[a]));for(var a in this.infoMap.attack_count)this.gameInfo.attack_count.push(new r.AttackCountItem(parseInt(a),this.infoMap.attack_count[a]));return this.gameInfo.score=i.scoreManager.getScore(),this.gameInfo.star_level=i.scoreManager.getStar(),this.gameInfo}}]),_}();l.exports=s},function(N,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),O=O||t(24),L=L||t(12),m=m||t(13),r=r||t(30),_=_||t(34),s=s||t(17),a=a||t(31),i=i||t(8),l=l||t(33),E=E||t(41),C=C||t(42),p=p||t(43),d=d||t(44),T=T||t(25),I=[387],c=function(){function T(e){n(this,T),this.gameIns=e,this.inited_=!1,this.start_row_=0,this.world_row_=0,this.world_col_=0,this.world_node_count_=0,this.world_board_=[],this.board_data_backup_=[],this.board_ref_backup_=[],this.drop_stop_row_,this.remove_state_,this.game_state_,this.drop_round_=0,this.special_bomb=[],this.ignore_round_=!1,this.inited_=!1,this.local_=null,this.world_=null}return o(T,[{key:"Initializie",value:function(){if(!this.inited_){O.PuzzleSrand(m.stageManager.start_info().random_seed),this.SetRemoveState(r.RemoveLogicState.REMOVE_INITIAL_STATE),this.drop_round_=0,this.ignore_round_=!1,m.tableManager.Init();for(var i=this.world_row_=m.stageManager.Row(),e=this.world_col_=m.stageManager.Col(),t=this.world_node_count_=i*e,n=this.world_board_,o=0;o<t;o++)n.push(new _);this.start_row_=0,this.drop_stop_row_=i,this.break_balance_=!1,this.game_state_=s.PuzzleGameState.PGS_NONE,this.InitBoardViewer(),this.InitEmptyNode(),m.eventManager=new l.EventManager_,m.moduleManager.Init(this),m.stageManager.Decode(),this.world_.GenerateRandom(m.stageManager.MaxColorCount()),this.InitBoardNodeData(this.GetStartRow()),this.RollingBoard(this.GetStartRow()),m.itemManager.Init(),m.stateMachine.Initialize(),this.SetGameState(s.PuzzleGameState.PGS_PLAYING),this.inited_=!0,this.OnGameStart()}}},{key:"Release",value:function(){if(this.inited_){this.OnGameRelease(),this.last_pang_&&(this.last_pang_=null);for(var a=this.world_row_*this.world_col_,e=0;e<a;e++)this.world_board_[e]=null;this.world_board_=null,m.moduleManager.Release(),m.ruleManager.Release(),m.envManager.Release(),m.tableManager.Release()}}},{key:"Reset",value:function(){}},{key:"GetStartRow",value:function(){return this.start_row_}},{key:"ApplyAddGasProp",value:function(){this.ApplyAddSpecialItemProp(L.ChessType.CT_SpecialGas)}},{key:"ApplyAddWaveProp",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=L.ChessType.CT_SpecialHorizontalShockWave;0==a?e=0==O.PuzzleRand("cb(258)")%2?L.ChessType.CT_SpecialHorizontalShockWave:L.ChessType.CT_SpecialVerticalShockWave:1==a?e=L.ChessType.CT_SpecialHorizontalShockWave:2==a&&(e=L.ChessType.CT_SpecialVerticalShockWave),this.ApplyAddSpecialItemProp(e)}},{key:"ApplyAddHurricanProp",value:function(){this.ApplyAddSpecialItemProp(L.ChessType.CT_SpecialHurricane)}},{key:"JudgeCanUserDisappearItem",value:function(s,e){if(!m.boardViewer.ValidPos(s,e))return!1;var t=m.boardViewer.GetNode(s,e),n=t.GetTop();if(null==n)return!1;var o=n.Attribute();if(null==o)return!1;if(!o.CanUseHammer)return!1;for(var a=o.attack_type.length,r=0;r<a;r++)if(L.AttackType.Attack_Disappear==o.attack_type[r])return!0;return!1}},{key:"JudgeCanUserChangeItem",value:function(a,e){if(!m.boardViewer.ValidPos(a,e))return!1;var t=m.boardViewer.GetNode(a,e);return t.CanUseSwap()}},{key:"JudgeCanUserSpecialItem",value:function(a,e){if(!m.boardViewer.ValidPos(a,e))return!1;var t=m.boardViewer.GetNode(a,e);return t.CanUseSpecial()}},{key:"IsValidWorldPos",value:function(a){return!(0>a.row||a.row>=this.world_row_)&&!(0>a.col||a.col>=this.world_col_)}},{key:"InitBoardNodeData",value:function(s){for(var e=m.stageManager.simple_stage_info().screen_row,t=this.world_row_,n=this.world_col_,o=this.world_board_,a=0;a<t;a++)for(var r=0,i;r<n;r++)i=o[a*n+r],a>=s&&a<s+e?(i.InitAllChess(),i.SetActive(!0)):(i.InitAllChess(),i.SetActive(!1));for(var l=this.board_data_backup_,C=this.board_ref_backup_,d=0;d<t*n;d++)l.push(new _),C.push(new _)}},{key:"RollingBoard",value:function(s){for(var e=m.stageManager.simple_stage_info().screen_row,t=this.start_row_*this.world_col_,n=t+e*this.world_col_,o=this.world_row_*this.world_col_,a;t<n&&t<o;)a=this.world_board_[t],a.SetVisible(!1),t++;for(this.start_row_=s,t=this.start_row_*this.world_col_,n=t+e*this.world_col_;t<n&&t<o;){var a=this.world_board_[t];a.SetVisible(!0),t++}var r=m.stageManager.simple_stage_info().screen_row,i=m.stageManager.simple_stage_info().screen_col;t=this.start_row_*this.world_col_,this.local_.SetRange(t,r,i,this.start_row_,0)}},{key:"Local2World",value:function(a){return new s.GridPosition(a.row+this.start_row_,a.col)}},{key:"World2Local",value:function(a){return new s.GridPosition(a.row-this.start_row_,a.col)}},{key:"GetWorldNode",value:function(a){return this.world_.GetNode(a)}},{key:"GetNodeIndex",value:function(a){return this.local_.GetNodeIndex(a)}},{key:"GetWorldNodeIndex",value:function(a){return this.world_.GetNodeIndex(a)}},{key:"OnGameStart",value:function(){var a=new l.PuzzleEvent;a.event_id=l.PuzzleEvent.kEventGameStart,m.eventManager.Forward(a),m.passConditionManager.UpdatePassCondition(),this.SetGameState(s.PuzzleGameState.PGS_PLAYING),this.CheckDeadGame();var e=new d;e.firstCalculFillMode(m.worldViewer),m.dataEventManager.trigger(i.GAMESTART),this.logChessBoardColor(),this.logChessBoardIce()}},{key:"OnGameEnd",value:function(){m.envManager.Update()}},{key:"OnGameRelease",value:function(){}},{key:"OnGameFail",value:function(){this.SetGameState(s.PuzzleGameState.PGS_FAIL_END),this.OnGameEnd()}},{key:"OnGameSuccess",value:function(){this.SetGameState(s.PuzzleGameState.PGS_SUCCESS_END),this.OnGameEnd()}},{key:"OnUseItem",value:function(a){var e=new l.UseItemEvent;e.itemid=a.item_type,m.eventManager.Forward(e),this.ignore_round_=!0,m.recordManager.AddInput(a),m.statManager.AddUsedItem(a.item_id)}},{key:"OnBalanceState",value:function(){var a=new l.PuzzleEvent;return a.event_id=l.PuzzleEvent.kEventBalanceState,m.dataCollector.beginOnceAniCollect("maoqiu"),m.eventManager.Forward(a),m.dataCollector.endOnceAniCollect("maoqiu"),this.break_balance_?(m.aniManager.GenerateEmptyAni(),this.break_balance_=!1,1):this.GetGameState()==s.PuzzleGameState.PGS_FAIL_END||this.GetGameState()==s.PuzzleGameState.PGS_SUCCESS_END?0:this.GetGameState()==s.PuzzleGameState.PGS_LASTPANG?0==this.StartLastPang()?(this.OnGameSuccess(),0):1:(this.CheckGameOver(),this.GetGameState()==s.PuzzleGameState.PGS_LASTPANG?1:0)}},{key:"OnCrushDropState",value:function(){var a=new l.PuzzleEvent;a.event_id=l.PuzzleEvent.kEventCrushDropState,m.eventManager.Forward(a)}},{key:"OnSlide",value:function(a,e){var t=new l.SlideEvent;t.from.copyData(a),t.to.copyData(e),m.eventManager.Forward(t),m.recordManager.AddInput(a,e)}},{key:"OnReArrange",value:function(){var a=new l.PuzzleEvent;a.event_id=l.PuzzleEvent.kEventReArrange,m.eventManager.Forward(a)}},{key:"OnLastpang",value:function(){}},{key:"OnRespawn",value:function(a){this.SetGameState(s.PuzzleGameState.PGS_PLAYING),this.CheckToReArrange(),m.stageManager.OnRespawn();var e=new l.RespawnEvent;e.respawn_type_=l.RespawnEvent.kRespawnEnd,m.eventManager.Forward(e),m.passConditionManager.UpdatePassCondition(),this.CheckGameOver(),this.GetGameState()==s.PuzzleGameState.PGS_LASTPANG&&this.SetRemoveState(r.RemoveLogicState.REMOVE_CRUSH_DROP_STATE),m.recordManager.AddRespawnInfo(a)}},{key:"OnStop",value:function(){this.OnGameEnd()}},{key:"BreakBalance",value:function(){this.GetRemoveState()!=r.RemoveLogicState.REMOVE_BANLANCE_STATE&&this.GetRemoveState()!=r.RemoveLogicState.REMOVE_INITIAL_STATE||(this.break_balance_=!0)}},{key:"IsBalanceBreak",value:function(){return this.break_balance_}},{key:"SetGameState",value:function(a){this.game_state_=a}},{key:"GetGameState",value:function(){return this.game_state_}},{key:"SetRemoveState",value:function(a){this.remove_state_=a}},{key:"GetRemoveState",value:function(){return this.remove_state_}},{key:"set_dropround",value:function(a){this.drop_round_=a}},{key:"get_dropround",value:function(){return this.drop_round_}},{key:"DoDrop",value:function(){var a=m.stageManager.start_info(),e=null;this.isUseOldDrop(a.stage_id.id)?(console.log("use old drop"),e=new E):e=new d,e.DoDrop(m.worldViewer),m.dataCollector.collectOneDropData(this.drop_round_+1)}},{key:"board_info",value:function(){return this.board_info_}},{key:"ReArrange",value:function(){var a=new C(m.boardViewer);a.Rearrange(),this.OnReArrange()}},{key:"CheckToReArrange",value:function(){if(console.log("\u68C0\u67E5\u662F\u5426\u9700\u8981\u91CD\u6392"),this.GetGameState()==s.PuzzleGameState.PGS_PLAYING){var a=[],e=[];m.boardViewer.FindActiveItem(a,e)||(console.log("\u6CA1\u6709\u53EF\u6D88\u9664\u7684\uFF0C\u5C1D\u8BD5\u91CD\u6392"),this.ReArrange(),m.boardViewer.FindActiveItem(a,e)?(m.aniManager.GenerateItemRearrangeAnimation(),console.log("\u91CD\u6392\u6210\u529F"),this.SetRemoveState(r.RemoveLogicState.REMOVE_INITIAL_STATE)):(console.log("\u91CD\u6392\u4EE5\u540E\u8FD8\u662F\u6CA1\u6709\u53EF\u6D88\u9664\u7684\uFF0C\u6E38\u620F\u53EA\u80FD\u7ED3\u675F"),m.curBoard.OnGameFail()))}}},{key:"InitEmptyNode",value:function(){for(var _=this.world_row_,e=this.world_col_,t=this.world_board_,n=0;n<_;n++)for(var o=0,a;o<e;o++)a=t[n*e+o],a.SetPosition(new s.GridPosition(n,o))}},{key:"InitBoardViewer",value:function(){this.world_=new a.BoardViewer(this.world_board_),this.local_=new a.BoardViewer(this.world_board_),m.boardViewer=this.local_,m.worldViewer=this.world_;var o=m.stageManager.simple_stage_info().screen_row,e=m.stageManager.simple_stage_info().screen_col;this.local_.SetRange(0,o,e,this.start_row_,0),this.world_.SetRange(0,this.world_row_,this.world_col_,0,0)}},{key:"StartLastPang",value:function(){return null==this.last_pang_&&(this.SetGameState(s.PuzzleGameState.PGS_LASTPANG),this.OnLastpang(),this.last_pang_=new p(m.boardViewer),m.stateMachine.ResetDropTime()),this.last_pang_.Do()}},{key:"CheckGameOver",value:function(){var a=m.passConditionManager.getStatus();if(a==L.GameStatus.kGameFail)return void this.OnGameFail();if(a==L.GameStatus.kGamePass){if(m.stageManager.RecordSuccessStep(),null==this.last_pang_&&m.aniManager.GeneratePassThroughAnimation(),0==this.StartLastPang())return void this.OnGameSuccess();this.SetGameState(s.PuzzleGameState.PGS_LASTPANG)}}},{key:"CheckDeadGame",value:function(){m.boardViewer.FindActiveItem([],[])||this.ReArrange()}},{key:"ApplyAddSpecialItemProp",value:function(r){for(var e=m.boardViewer.Row()*m.boardViewer.Col(),t=O.PuzzleRand("cb(807)")%e,n=0;n<e;n++,t++){var o=S(t%e/m.boardViewer.Col()),a=t%e%m.boardViewer.Col(),_=m.boardViewer.GetNode(o,a);if(_&&_.GetChessByType(L.ChessType.CT_NormalUnit)&&_.NeedReArrange())return void _.AddChess(r,_.ChessColor())}}},{key:"logChessBoardColor",value:function(){}},{key:"logChessBoardIce",value:function(){}},{key:"clearSpecialBombList",value:function(){this.special_bomb=[]}},{key:"cacheSpecialBomb",value:function(a){this.special_bomb.push(a)}},{key:"handleSpecialBomb",value:function(a){for(var e=this.special_bomb,t;0<e.length;)t=e.shift(),m.dataCollector.startOneRemove(t.info.attack_type,t.info.attack_type,a,t.info.src,t.info.other),t.Bomb(),m.dataCollector.endOneRemove()}},{key:"isUseOldDrop",value:function(a){for(var e=!1,t=0;t<I.length;t++)if(I[t]==a){e=!0;break}return e}}]),T}();N.exports=c},function(d,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),O=O||t(13),r=r||t(17),T=T||t(12),s=s||t(31),I=I||t(18),a=a||t(23),i=i||t(8),l=l||t(33),y=y||t(25),E={REMOVE_INITIAL_STATE:0,REMOVE_GENERAL_MOVE_STATE:1,REMOVE_BANLANCE_STATE:2,REMOVE_CRUSH_DROP_STATE:3,REMOVE_END_STATE:4,DIGGER_BOARD_MOVE_STATE:5,REMOVE_WAIT_INPUT_STATE:6},_=function(){function _(e){n(this,_),this.gameIns=e,this.m_DropTimes=0,this.m_iComboTimes=0,this.m_keepAnimationFlg=!1,this.error_slide_balance_=!1,this.slide_from_=new r.GridPosition,this.slide_to_=new r.GridPosition,this.cycle_drop_round_=1,this.gas_special_swap_flag=!1}return o(_,[{key:"Initialize",value:function(){this.m_DropTimes=0,this.m_iComboTimes=0,this.m_keepAnimationFlg=!1}},{key:"Input",value:function(a){console.log("PuzzleChessResolver.Input");var e=this.GetGameState();if(e==r.PuzzleGameState.PGS_LASTPANG||e==r.PuzzleGameState.PGS_SUCCESS_END)return console.log("\u9519\u8BEF\u8F93\u5165"),!1;this.ResetDropTime();var t=!1;switch(a.op){case T.InputOp.kOpSlide:t=this.RunOneSlideStep(a),t&&this.SetRemoveLogicStage(E.REMOVE_GENERAL_MOVE_STATE);break;case T.InputOp.kOpUseItem:t=O.itemManager.ItemInput(a),t&&(O.curBoard.OnUseItem(a),O.curBoard.IsBalanceBreak()&&(O.curBoard.break_balance_=!1,this.SetRemoveLogicStage(E.REMOVE_CRUSH_DROP_STATE)));}return O.envManager.GetIsWorkerMode()&&(this.cycle_drop_round_=0,this.CycleRunRemoveLogicMachine(this.cycle_drop_round_)),t}},{key:"RunOneSlideStep",value:function(C){this.ResetDropTime();var e=new r.GridPosition(C.from.row,C.from.col),t=new r.GridPosition(C.to.row,C.to.col),n=this.JudgeOneSlide(e,t),o=O.boardViewer.GetNode(e.row,e.col),a=O.boardViewer.GetNode(t.row,t.col),s=null,_=null;return o&&(s=o.ToChessData()),a&&(_=a.ToChessData()),n==r.ExchangItemResult.EIR_ExchangeFailed?(this.SetRemoveLogicStage(E.REMOVE_BANLANCE_STATE),this.error_slide_balance_=!0,O.dataEventManager.trigger(i.SWAP,{from:C.from,to:C.to,result:2}),console.log("swap failed input : "+JSON.stringify(C)),console.log("swap failed"),!1):n==r.ExchangItemResult.EIR_None?(this.SetRemoveLogicStage(E.REMOVE_BANLANCE_STATE),this.error_slide_balance_=!0,!1):n==r.ExchangItemResult.ERI_ExchangeFailedFence?(this.SetRemoveLogicStage(E.REMOVE_BANLANCE_STATE),this.error_slide_balance_=!0,!1):(this.SaveSlide(e,t),O.dataEventManager.trigger(i.SWAP,{from:C.from,to:C.to,result:3}),console.log("swap ok input : "+JSON.stringify(C)),console.log("swap ok"),this.SetRemoveLogicStage(E.REMOVE_GENERAL_MOVE_STATE),!0)}},{key:"CycleRunRemoveLogicMachine",value:function(a){console.log("CycleRunRemoveLogicMachine");for(var e=0;;)switch(O.curBoard.GetRemoveState()){case E.REMOVE_GENERAL_MOVE_STATE:this.RemoveGeneralMoveStateFunction();break;case E.REMOVE_BANLANCE_STATE:this.RemoveBalanceStateFunction();break;case E.REMOVE_CRUSH_DROP_STATE:if(this.RemoveCrushDropStateFunction(),e++,y.runLogicTimes++,0!=a&&e==a)return console.log("PuzzleChessResolver.JumpOut"),"undefined"!=typeof LogPanel&&LogPanel.addInfo("JO"),!1;break;case E.DIGGER_BOARD_MOVE_STATE:if(this.SetRemoveLogicStage(E.REMOVE_BANLANCE_STATE),0!=a)return!1;break;case E.REMOVE_INITIAL_STATE:if(O.curBoard.logChessBoardIce(),O.envManager.GetIsWorkerMode()){var t=O.aniManager.GenerateEmptyAni();postMessage({msg:"addAnimation",data:{aniData:t,state:O.curBoard.GetGameState()}})}return!0;case E.REMOVE_END_STATE:return!0;default:return!0;}}},{key:"Continue",value:function(){return console.log("PuzzleChessResolver.Continue"),console.log("RemoveState: "+O.curBoard.GetRemoveState()),"undefined"!=typeof LogPanel&&LogPanel.addInfo("CT"),this.CycleRunRemoveLogicMachine(this.cycle_drop_round_)}},{key:"RunCycleReqStep",value:function(s){y.runLogicTimes=0;var e=0;this.cycle_drop_round_=0;var t=s.game_info.score,n=s.game_info.star_level,o=0;s.input&&(o=s.input.length);for(var a=0;a<o;a++){var _=s.input[a],i=new r.GridPosition,l=new r.GridPosition;switch(_.from&&(i.row=_.from.row,i.col=_.from.col),_.to&&(l.row=_.to.row,l.col=_.to.col),_.op){case T.InputOp.kOpSlide:var E=this.RunOneSlideStep(_);if(!E)return e=O.scoreManager.getScore(),e>=t-100&&e<=t+100?0:(console.log("\u8FD9\u6B65\u8FD0\u884C\u5931\u8D25\uFF0C\u76F4\u63A5\u9000\u51FA"),3);this.CycleRunRemoveLogicMachine(this.cycle_drop_round_);break;case T.InputOp.kOpUseItem:switch(_.item_id){case T.ItemId.itemRearrange:case T.ItemId.itemSwap:case T.ItemId.itemHammer:case T.ItemId.itemStepInner:case T.ItemId.itemGlass:var I=this.Input(_);I&&this.CycleRunRemoveLogicMachine(0);break;case T.ItemId.itemRespawn:var C=new T.RespawnInfo;C.bullet_attack=5,O.curBoard.OnRespawn(C),this.CycleRunRemoveLogicMachine(0);}break;case T.InputOp.kOpRespawn:var C=new T.RespawnInfo;C.bullet_attack=5,O.curBoard.OnRespawn(C),this.CycleRunRemoveLogicMachine(0);}}var p=O.scoreManager.getScore();if(p<t-1e3)return 1;if(O.passConditionManager.getStatus()!=s.game_result)return 2;var d=O.scoreManager.getStar();return d<n?3:0}},{key:"SetRemoveLogicStage",value:function(a){O.curBoard.SetRemoveState(a)}},{key:"GetGameState",value:function(){return O.curBoard.GetGameState()}},{key:"JudgeOneSlide",value:function(_,e){var t=s.FailReason.kFailSwapUnknown;if(!O.boardViewer.CanSlideSwap(_,e,t))return r.ExchangItemResult.EIR_None;var n=new r.GridPosition(_),o=new r.GridPosition(e);return O.boardViewer.CheckSwap(n,o,null)?r.ExchangItemResult.EIR_NormalExchangeSucc:O.boardViewer.CheckSpecialSwap(n,o)?r.ExchangItemResult.EIR_NormalExchangeSucc:r.ExchangItemResult.EIR_ExchangeFailed}},{key:"SaveSlide",value:function(a,e){this.slide_from_.copyData(a),this.slide_to_.copyData(e)}},{key:"IsSpecialSwap",value:function(_,e){var t=O.boardViewer.GetNode(_.row,_.col),n=O.boardViewer.GetNode(e.row,e.col),o=t.GetChess(),a=n.GetChess();return null!=o&&null!=a&&(o.Attribute().IsSpecialChess1&&a.Attribute().IsSpecialChess1||o.Attribute().IsSpecialChess2&&a.Attribute().CanSwapGhost||a.Attribute().IsSpecialChess2&&o.Attribute().CanSwapGhost)}},{key:"ExchangeGridChessman",value:function(a,_,t){"number"==typeof a&&(t=a,a=this.slide_from_,_=this.slide_to_);var n=1;O.boardViewer.SlideSwap(a,_),O.boardViewer.CollectSomething(n,a),O.boardViewer.CollectSomething(n,_)}},{key:"SlideNormalChess",value:function(a){var e=new r.LittleBatchIndexStruct;e.m_self_batch_index=1,e.m_parent_batch_index=a,O.curBoard.clearSpecialBombList();var t=1;O.dataCollector.startOneRemove(T.AttackType.Attack_Normal,1,t),this.MatchAt(e,this.slide_from_),this.MatchAt(e,this.slide_to_),O.dataCollector.endOneRemove(),O.curBoard.handleSpecialBomb(t),O.dataEventManager.trigger(i.END_ONE_REMOVE_ROUND)}},{key:"SlideSpecialChess",value:function(){var e=new r.LittleBatchIndexStruct;e.m_parent_batch_index=0,e.m_self_batch_index=1;var t=new I.AttackInfo;t.attack_type=T.AttackType.Attack_Normal,t.other=new r.GridPosition(this.slide_from_),t.src=new r.GridPosition(this.slide_to_),t.join=1,t.special_bomb=!0,t.batch=e;var n=new l.CrushNodeEvent;n.attack_type=T.AttackType.Attack_Normal,n.ani_batch_id=e.m_self_batch_index,n.src=new r.GridPosition(this.slide_to_),n.nodes.push(new r.GridPosition(t.src)),n.nodes.push(new r.GridPosition(t.other));var o=O.boardViewer.GetNode(t.src.row,t.src.col),a=O.boardViewer.GetNode(t.other.row,t.other.col),_=a.GetChess();this.gas_special_swap_flag=!1;var s=1;O.curBoard.clearSpecialBombList(),O.dataCollector.startOneRemove(T.AttackType.Attack_Normal,1,s),_.Attribute().IsSpecialChess2?a.Crush(t):o.Crush(t),O.eventManager.Forward(n),O.dataCollector.endOneRemove(),O.curBoard.handleSpecialBomb(s),O.dataEventManager.trigger(i.END_ONE_REMOVE_ROUND),this.gas_special_swap_flag&&O.aniManager.GenerateGasSpecialEndAnimation()}},{key:"MatchAt",value:function(r,e){var t=[];if(O.boardViewer.FindJoinPosition(e,t),3>t.length)return!1;var n=new I.AttackInfo;n.attack_type=T.AttackType.Attack_Normal,n.batch=r,n.depth=0,n.join=1,n.src=e;for(var o=t.length,a=0,s;a<o;a++)s=O.boardViewer.GetNode(t[a].row,t[a].col),s&&s.Crush(n);var _=new l.CrushNodeEvent;return _.src=e,_.nodes=t,_.attack_type=T.AttackType.Attack_Normal,_.ani_batch_id=1,O.eventManager.Forward(_),!0}},{key:"MatchAll",value:function(){var e=new r.LittleBatchIndexStruct;e.m_self_batch_index=1;for(var t=[],n=[],o=O.boardViewer.Row(),s=O.boardViewer.Col(),_=o-1;0<=_;_--)for(var i=0;i<s;i++){var E=new r.GridPosition(_,i),C=O.boardViewer.GetNode(E.row,E.col);if(!(C.IsChessGridEmpty()||C.GetMark()||a.findEleInArr(n,function(a){return E.isEqual(a)})||O.boardViewer.CollectSomething(1,E))){var p=[];if(O.boardViewer.FindJoinPosition(E,p),3<=p.length){var d=new l.CrushNodeEvent;d.src=E,d.nodes=p,d.ani_batch_id=e.m_self_batch_index,t.push(d)}3<p.length;for(var c=p.length,u=0;u<c;u++)n.push(p[u])}}if(0!=n.length){this.m_iComboTimes++;var y=1+this.m_iComboTimes;O.curBoard.clearSpecialBombList(),O.dataCollector.startOneRemove(T.AttackType.Attack_Normal,1,y);var S=new I.AttackInfo;S.attack_type=T.AttackType.Attack_Normal,S.batch=e,S.depth=0,S.join=1;for(var N=n.length,h=0,L;h<N;h++)L=O.boardViewer.GetNode(n[h].row,n[h].col),L&&L.Crush(S);for(var u=0;u<t.length;u++)O.eventManager.Forward(t[u]);O.dataCollector.endOneRemove(),O.curBoard.handleSpecialBomb(y)}}},{key:"ResetDropTime",value:function(){this.m_DropTimes=0,this.m_iComboTimes=0,O.curBoard.set_dropround(0)}},{key:"RemoveGeneralMoveStateFunction",value:function(){var a=1;this.ExchangeGridChessman(a),O.curBoard.OnSlide(this.slide_from_,this.slide_to_),this.IsSpecialSwap(this.slide_from_,this.slide_to_)?this.SlideSpecialChess():this.SlideNormalChess(a),O.boardViewer.Sweep(),this.SetRemoveLogicStage(E.REMOVE_CRUSH_DROP_STATE)}},{key:"RemoveBalanceStateFunction",value:function(){this.MatchAll(this.m_DropTimes);var a=O.boardViewer.Sweep();return 0<a?(O.dataEventManager.trigger(i.END_ONE_REMOVE_ROUND),void this.SetRemoveLogicStage(E.REMOVE_CRUSH_DROP_STATE)):0==O.curBoard.OnBalanceState()?(this.SetRemoveLogicStage(E.REMOVE_INITIAL_STATE),O.curBoard.CheckToReArrange(),void this.ResetDropTime()):void this.SetRemoveLogicStage(E.REMOVE_CRUSH_DROP_STATE)}},{key:"RemoveCrushDropStateFunction",value:function(){O.curBoard.OnCrushDropState(),O.curBoard.DoDrop(),this.m_DropTimes+=1,O.curBoard.set_dropround(this.m_DropTimes),O.envManager.SetDropSequence(O.envManager.GetDropSequence()+1),this.SetRemoveLogicStage(E.REMOVE_BANLANCE_STATE)}}]),_}();d.exports={RemoveLogicState:E,PuzzleChessResolver:_}},function(p,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function T(a){if(!a.CanSlide())return!1;if(a.HasCollectChess()||a.IsCombinationChess())return!1;var e=a.ChessColor();return e>=y.MovingItemType.MIT_0&&e<=y.MovingItemType.MIT_6}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},o=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),I=I||t(12),y=y||t(17),N=N||t(23),_=_||t(24),s=s||t(13),i=i||t(32),l=l||t(18),E=E||t(8),r=function(){function r(e){n(this,r),this.board_=e,this.start_=0,this.row_=0,this.col_=0,this.row_offset_=0,this.col_offset_=0}return o(r,[{key:"ValidPos",value:function(a,e){return 0<=a&&a<this.row_&&0<=e&&e<this.col_}},{key:"GetColorByPos",value:function(a){var e=this.GetNode(a.row,a.col);return e?e.Color():y.MovingItemType.MIT_NONE}},{key:"GetNode",value:function(o,e){var t=arguments[0];return"object"==("undefined"==typeof t?"undefined":a(t))&&(o=t.row,e=t.col),this.ValidPos(o,e)?this.board_[this.start_+o*this.col_+e]:null}},{key:"GetNodeIndex",value:function(a){return 0<=a&&(a<this.NodeCount()?this.board_[this.start_+a]:null)}},{key:"GetAroundNode",value:function(_,e){for(var t=[new y.GridPosition(-1,0),new y.GridPosition(1,0),new y.GridPosition(0,-1),new y.GridPosition(0,1)],a=0,r,n;4>a;a++){r=_.row+t[a].row,n=_.col+t[a].col;var o=this.GetNode(r,n);null!=o&&e.push(o)}}},{key:"AddChess",value:function(_,e){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:y.MovingItemType.MIT_NONE,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=this.GetNode(_);null!=o&&o.AddChessType(e,n,t)}},{key:"CrushNode",value:function(_,e,t){var n=1;s.dataCollector.startOneRemove(e,1,n);var o=new l.AttackInfo;o.batch=t,o.attack_type=e,o.depth=0,o.join=1,o.src=_.GetPosition();var a=_.Crush(o);return s.dataCollector.endOneRemove(),s.curBoard.handleSpecialBomb(n),s.dataEventManager.trigger(E.END_ONE_REMOVE_ROUND),a}},{key:"RemoveChess",value:function(a,e){var t=this.GetNode(a);null!=t&&t.RemoveChess(e)}},{key:"HasChessType",value:function(a,e){var t=this.GetNode(a);return null!=t&&t.HasChessType(e)}},{key:"Position",value:function(a){return new y.GridPosition(a.row-this.row_offset_,a.col-this.col_offset_)}},{key:"GetPosByIndex",value:function(a){var e=this.col_;if(a-=this.row_offset_*e,0>a||a>=this.NodeCount())return new y.GridPosition(-1,-1);var t=S(a/e),n=a%e;return new y.GridPosition(t,n)}},{key:"IsPosInViewer",value:function(a){return!(0>a.row||a.row>=this.row_||0>a.col||a.col>=this.col_)}},{key:"NodeCount",value:function(){return this.row_*this.col_}},{key:"Row",value:function(){return this.row_}},{key:"Col",value:function(){return this.col_}},{key:"SetRange",value:function(_,e,t,n,o){this.start_=_,this.row_=e,this.col_=t,this.row_offset_=n,this.col_offset_=o}},{key:"CanSlideSwap",value:function(a,e){if(2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,a.isEqual(e))return!1;var t=this.GetNode(a.row,a.col),n=this.GetNode(e.row,e.col);return null!=t&&null!=n&&t.CanSlide()&&n.CanSlide()&&!(a.row>e.row&&n.HasChessType(I.ChessType.STIT_FENCE_BOTTOM))&&!(a.row<e.row&&t.HasChessType(I.ChessType.STIT_FENCE_BOTTOM))&&!(a.col>e.col&&n.HasChessType(I.ChessType.STIT_FENCE_RIGHT))&&!(a.col<e.col&&t.HasChessType(I.ChessType.STIT_FENCE_RIGHT))}},{key:"SlideSwap",value:function(a,e){var t=this.GetNode(a.row,a.col),n=this.GetNode(e.row,e.col);return null!=t&&null!=n&&(t.SlideSwap(n),!0)}},{key:"CheckSwap",value:function(l,e,t){if(!this.CanSlideSwap(l,e))return!1;var n=this.GetNode(l.row,l.col),o=this.GetNode(e.row,e.col);this.SlideSwap(l,e);var a=[],r=[],i=this.CheckRowJoin(l,n.ChessColor(),a),s=this.CheckColJoin(l,n.ChessColor(),r),_=[],C=[],d=this.CheckRowJoin(e,o.ChessColor(),_),p=this.CheckColJoin(e,o.ChessColor(),C);return this.SlideSwap(l,e),null!=t&&t.splice(0,t.length),3<=i?(l.Swap(e),t&&N.arrayCopy(t,a),!0):3<=s?(l.Swap(e),t&&N.arrayCopy(t,r),!0):3<=d?(t&&N.arrayCopy(t,_),!0):3<=p&&(t&&N.arrayCopy(t,C),!0)}},{key:"CheckSpecialSwap",value:function(a,e){if(!this.CanSlideSwap(a,e))return!1;var t=this.GetNode(a.row,a.col),n=this.GetNode(e.row,e.col);return t.HasSpecialChess()&&n.HasSpecialChess()||(t.HasChessType(I.ChessType.CT_SpecialGas)?T(n):!!n.HasChessType(I.ChessType.CT_SpecialGas)&&!!T(t)&&(a.row+=e.row,a.col+=e.col,e.row=a.row-e.row,e.col=a.col-e.col,a.row-=e.row,a.col-=e.col,!0))}},{key:"ValidUserSlide",value:function(a,e){return this.CheckSwap(a,e,null)||this.CheckSpecialSwap(a,e)}},{key:"FindActiveItem",value:function(a,e){return this.FindActiveItemInternal(a,e)}},{key:"CollectActiveItem",value:function(_){var e=_ instanceof Array;e&&_.splice(0,_.length);for(var t=this.Row(),n=this.Col(),o=0;o<t;o++)for(var a=0;a<n;a++){var r=new y.GridPosition(o,a),i=new y.GridPosition(o,a),s=new y.GridPosition(o,a),l=[];s.row+=1,this.CheckSwap(i,s,l)&&(e?(_.push(i),_.push(s)):_(i,s,l)),i.row=s.row=r.row,i.col=s.col=r.col,s.col+=1,this.CheckSwap(i,s,l)&&(e?(_.push(i),_.push(s)):_(i,s,l));var d=[];this.GetAroundNode(r,d);for(var T=d.length,I=0,E;I<T;++I)if(E=d[I],null!=E){i.row=r.row,i.col=r.col;var C=E.GetPosition();s.row=C.row,s.col=C.col,i.Direction(s)!=y.GridDirection.kLeft&&i.Direction(s)!=y.GridDirection.kUp&&this.CheckSpecialSwap(i,s)&&e&&(_.push(i),_.push(s))}}}},{key:"GetAllCrush",value:function(l,e,t){var n=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],o=this.GetNode(l.row,l.col),a=this.GetNode(e.row,e.col);if(null!=o&&null!=a){var r=[],i=[],s=[];this.SlideSwap(l,e),this.CheckJoin(l,o.Color(),r,i,s)&&N.arrayCopy(t,s),r.splice(0,r.length),i.splice(0,i.length),s.splice(0,s.length),this.CheckJoin(e,a.Color(),r,i,s)&&N.arrayCopy(t,s),this.SlideSwap(l,e),N.unique(t,function(a,e){return a.isEqual(e)}),n||N.removeElement(t,function(a){return l.isEqual(a)||e.isEqual(a)})}}},{key:"CanDropTo",value:function(a,e){var t=this.GetNode(a.row,a.col),n=this.GetNode(e.row,e.col);return null!=t&&null!=n&&t.CanDropTo(n)}},{key:"DropTo",value:function(a,e){if(!this.CanDropTo(a,e))return!1;var t=this.GetNode(a.row,a.col),n=this.GetNode(e.row,e.col);return null!=t&&null!=n&&t.DropTo(n)}},{key:"CheckJoin",value:function(_){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:-1,t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;if(_=new y.GridPosition(_.row,_.col),-1==e){var a=this.GetNode(_.row,_.col);if(!a||!a.GetChess())return!1;e=a.ChessColor()}var a=this.GetNode(_.row,_.col);return(null==a||null==a.GetChess()||!a.GetChess().Attribute().StopJoin)&&!(3>this.CheckRowJoin(_,e,t)&&3>this.CheckColJoin(_,e,n))&&(null!=o&&(o.splice(0,o.length),null!=t&&2<=t.length&&N.arrayCopy(o,t),null!=n&&2<=n.length&&N.arrayCopy(o,n),o.push(_)),!0)}},{key:"CheckColJoin",value:function(_,e,t){for(var n=this.Row(),o=_.row,a=_.row,r=_.row-1;0<=r&&this.CheckPosJoin(r,_.col,e);r--)o=r,t&&t.push(new y.GridPosition(r,_.col));for(var r=_.row+1;r<n&&this.CheckPosJoin(r,_.col,e);r++)a=r,t&&t.push(new y.GridPosition(r,_.col));return a-o+1}},{key:"CheckRowJoin",value:function(_,e,t){null!=t&&t.splice(0,t.length);for(var n=_.col,o=_.col,a=_.col-1;0<=a&&this.CheckPosJoin(_.row,a,e);a--)n=a,t&&t.push(new y.GridPosition(_.row,a));for(var r=this.Col(),a=_.col+1;a<r&&this.CheckPosJoin(_.row,a,e);a++)o=a,t&&t.push(new y.GridPosition(_.row,a));return o-n+1}},{key:"CheckPosJoin",value:function(a,e,t){var n=this.GetNode(a,e);return null!=n&&n.CheckMovingItemPosJoin(t)}},{key:"FindJoinPosition",value:function(a,e){var t=s.ruleManager.GetRule(i.RuleType.kCoreRule);t&&t.FindJoinPosition(a,e)}},{key:"GenerateRandom",value:function(s){var e=[y.MovingItemType.MIT_0,y.MovingItemType.MIT_1,y.MovingItemType.MIT_2,y.MovingItemType.MIT_3,y.MovingItemType.MIT_4,y.MovingItemType.MIT_5];s>e.length&&(s=e.length);for(var t=[],n=null,o=this.NodeCount(),a=this.board_,r=this.start_;r<o;r++)n=a[r],n.ChessColor()==y.MovingItemType.MIT_RANDOM&&(n.SetChessColor(e[_.PuzzleRand("bv(623)")%s]),t.push(n));this.CheckJoinNode(t)}},{key:"CheckAndFixDeadGame",value:function(){}},{key:"DropStopRow",value:function(){var a=s.envManager.GetSodaLine(),e=this.Position(new y.GridPosition(a,0));return e.row}},{key:"FindConnectedNode",value:function(_,e){var t=this.GetNode(_.row,_.col);if(null!=t){this.FindNodeRecursion(t,e);for(var n=e.length,o=0,a;o<n;o++)a=e[o],a.SetSearchFlag(0)}}},{key:"FindCrushNode",value:function(){}},{key:"Sweep",value:function(){for(var a=0,e=null,t=this.NodeCount(),n=0;n<t;n++)e=this.GetNodeIndex(n),a+=e.Sweep();return a}},{key:"CollectSomething",value:function(l,e){var t=s.boardViewer.GetNode(e.row,e.col);if(t.HasChessType(I.ChessType.CT_COMBINATION3))return this.CollectCombination(l,e);if(!t.HasCollectChess()||t.HasChessSurface())return!1;var n=t.HasOneOf(I.ChessType.STIT_COLLECTCANDY_POINT),E=t.HasOneOf(I.ChessType.STIT_COLLECTBALLOON_POINT)||t.IsStaticItemCollectPointInSoda();if(!E&&!n)return!1;t.MarkChess(1);var C=(t.IsStaticItemCollectPointInSoda(),t.HasChessType(I.ChessType.CT_COLLECTBALLOON)),r=t.HasChessType(I.ChessType.CT_COLLECTCANDY),i=t.HasChessType(I.ChessType.STIT_SUNNYDOLL1);return C||r?(s.dataCollector.startOneRemove(I.AttackType.Attack_Normal,1,0),s.dataCollector.addCrushChess(t.ToChessData()),s.dataCollector.endOneRemove(),!0):i&&0!=l}},{key:"CollectCombination",value:function(a,e){var t=s.boardViewer.GetNode(e.row,e.col),n=new l.AttackInfo;return n.batch.m_self_batch_index=a,n.attack_type=I.AttackType.Attack_Normal,n.depth=0,n.join=1,n.src=e,t.Crush(n),!0}},{key:"SetNewColor",value:function(_){for(var e=s.ruleManager.GetRule(i.RuleType.kCoreRule),t=[y.MovingItemType.MIT_0,y.MovingItemType.MIT_1,y.MovingItemType.MIT_2,y.MovingItemType.MIT_3,y.MovingItemType.MIT_4,y.MovingItemType.MIT_5],n=_.ChessColor(),o=t.length,a=0;a<o;a++)if(t[a]!=n&&(_.SetChessColor(t[a]),!e.CheckJoin(this,new y.GridPosition(_.GetWorldPosition()),_.ChessColor())))return}},{key:"CheckJoinNode",value:function(_){for(var e=s.ruleManager.GetRule(i.RuleType.kCoreRule),t=_.length,n=0,o;n<t;n++)o=_[n],e.CheckJoin(this,new y.GridPosition(o.GetWorldPosition()),o.ChessColor())&&this.SetNewColor(o)}},{key:"FindNodeRecursion",value:function(_,e){if(0==_.SearchFlag()){var t=[];this.GetAroundNode(_.GetPosition(),t),e.push(_),_.SetSearchFlag(1);for(var n=_.Color(),o=t.length,a=0;a<o;a++)null!=t[a]&&null!=t[a].GetChess()&&t[a].CheckMovingItemPosJoin(n)&&this.FindNodeRecursion(t[a],e)}}},{key:"FindActiveItemInternal",value:function(_,e){if(null==e)return!1;for(var t=N.getRandom(0,1)%2,n=this.Row()-1;0<=n;n--)for(var o=0;o<=this.Col();o++){var a=0==t?o:this.Col()-o-1,r=new y.GridPosition(n,a),i=new y.GridPosition(r.row,r.col);i.row-=1;var s=this.CheckSpecialSwap(r,i);if(s)return _.push(r),_.push(i),!0;if(i.copyData(r),i.col+=1,s=this.CheckSpecialSwap(r,i))return _.push(r),_.push(i),!0;i.copyData(r),i.row-=1;var l=this.CheckSwap(r,i,e);if(l)return _.push(r),_.push(i),!0;i.copyData(r),i.col+=1;var E=this.CheckSwap(r,i,e);if(E)return _.push(r),_.push(i),!0}return!1}}]),r}();p.exports={FailReason:{kFailSwapUnknown:0,kFailSwapFence:1},BoardViewer:r}},function(C,e,t){"use strict";function n(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==typeof o||"function"==typeof o)?o:a}function o(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}function a(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function r(a){for(var e=a.length,t=0,n;t<e;t++)n=s.boardViewer.GetNode(a[t].row,a[t].col),n&&n.SetSearchFlag(0)}var i=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),s=s||t(13),_={kCoreRule:0,kInputRule:1,kRuleNum:2},d=function(){function t(){a(this,t),this.rule_type_=0}return i(t,[{key:"set_rule_type",value:function(a){this.rule_type_=a}},{key:"rule_type",value:function(){return this.rule_type_}}]),t}(),p=function(_){function e(){return a(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return o(e,_),i(e,[{key:"CheckJoin",value:function(){3<arguments.length&&void 0!==arguments[3]?arguments[3]:null}},{key:"FindJoinPosition",value:function(a,e){this.FindJoinPositionR(a,e),r(e)}},{key:"NextDropPosition",value:function(){}},{key:"NextSideDropPosition",value:function(){}},{key:"GetAround",value:function(){}},{key:"GetDirectionCount",value:function(){}},{key:"FindJoinPositionR",value:function(_,e){var t=s.boardViewer.GetNode(_.row,_.col);if(null!=t&&2!=t.SearchFlag()){var n=[];if(this.CheckJoin(s.boardViewer,_,t.ChessColor(),n)){0==t.SearchFlag()&&e.push(_),t.SetSearchFlag(2);for(var o=n.length,a=0,r;a<o;a++)r=s.boardViewer.GetNode(n[a].row,n[a].col),null!=r&&(1<=r.SearchFlag()||(r.SetSearchFlag(1),e.push(n[a])));for(var a=0;a<o;a++)this.FindJoinPositionR(n[a],e)}}}}]),e}(d),T=function(){function t(){a(this,t),this.rules_=Array(_.kRuleNum)}return i(t,[{key:"Init",value:function(){}},{key:"Release",value:function(){}},{key:"AddRule",value:function(a){return!(0>a.rule_type()||a.rule_type()>=_.kRuleNum)&&(this.rules_[a.rule_type()]=a,!0)}},{key:"GetRule",value:function(a){return 0>a||a>=_.kRuleNum?null:this.rules_[a]}}]),t}();C.exports={RuleType:_,Rule:d,RuleAttribute:function(){this.EnableSideFall=!1},CoreRule:p,RuleManager_:T}},function(c,e,t){"use strict";function n(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==typeof o||"function"==typeof o)?o:a}function o(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}function a(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),i=t(17),s=t(12),_=_||t(13),l=function t(){a(this,t),this.event_id=0};l.kEventSlide=1,l.kEventGameStart=2,l.kEventGameRelease=4,l.kEventUseItem=8,l.kEventBalanceState=16,l.kEventCrushDropState=32,l.kEventBackup=64,l.kEventRollback=128,l.kEventDiggerMove=256,l.kEventCrushNode=1024,l.kEventPetTalent=2048,l.kEventAddSpecialChess=4096,l.kEventSweepChess=8192,l.kEventRoundEnd=16384,l.kEventReArrange=32768,l.kEventLastpang=65536,l.kEventRespawn=131072;var u=function(a,e){return e.priority-a.priority},E=function(_){function r(){a(this,r);var t=n(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t.event_id=l.kEventDiggerMove,t.move_state=0,t}return o(r,_),r}(l),M=function(_){function r(){a(this,r);var t=n(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t.event_id=l.kEventSlide,t.from=new i.GridPosition,t.to=new i.GridPosition,t}return o(r,_),r}(l),R=function(_){function r(){a(this,r);var t=n(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t.event_id=l.kEventSweepChess,t.chess=null,t}return o(r,_),r}(l),P=function(_){function r(){a(this,r);var t=n(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t.event_id=l.kEventAddSpecialChess,t.pos=new i.GridPosition,t}return o(r,_),r}(l),g=function(_){function r(){a(this,r);var t=n(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t.src=new i.GridPosition,t.nodes=[],t.event_id=l.kEventCrushNode,t.attack_type=s.AttackType.Attack_Normal,t.ani_batch_id=-1,t.around_attack=!1,t}return o(r,_),r}(l),G=function(_){function r(){a(this,r);var t=n(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t.event_id=l.kEventUseItem,t.itemid=0,t}return o(r,_),r}(l),D=function(_){function r(){a(this,r);var t=n(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t.game_state_=0,t}return o(r,_),r}(l),k=function(_){function r(){a(this,r);var t=n(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t.event_id=l.kEventRespawn,t.respawn_type_=l.kRespawnStart,t}return o(r,_),r}(l);k.kRespawnStart=1,k.kRespawnEnd=2,k.kRespawnCancel=3;var B=function(_){function r(){a(this,r);var t=n(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t.success_=0,t}return o(r,_),r}(l),w=function(){function t(){a(this,t),this.in_forward_=0,this.queue_=[]}return r(t,[{key:"AddWrapper",value:function(a){this.queue_.push(a),this.queue_.sort(u)}},{key:"UnrefWrapper",value:function(a){var e=this.queue_.indexOf(a);0<=e&&this.queue_.splice(e,1)}},{key:"RemoveWrapper",value:function(a){a.is_deleated=!0,0==this.in_forward_&&this.UnrefWrapper(a)}},{key:"ForwardEvent",value:function(s){this.in_forward_++;for(var e=0,n;n=this.queue_[e];e++)if(n&&!n.is_deleated&&n.listener&&n.listener.events()&s.event_id){if(s.event_id==l.kEventGameStart)n.listener.OnEvent(s);else{var t=n.listener.GetActiver();(!t||t&&t.Active())&&n.listener.OnEvent(s)}if(s.event_id==l.kEventBalanceState&&_.curBoard.IsBalanceBreak())break}if(this.in_forward_--,0==this.in_forward_)for(var i=0,r;r=this.queue_[i];i++)r.is_deleated&&this.UnrefWrapper(r)}}]),t}(),b=function(){function _(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:-1;a(this,_),this.key_=e,this.em_=t,this.events_=n,this.RemoveFromEventQueue()}return r(_,[{key:"RemoveFromEventQueue",value:function(){this.em_&&this.em_.RemoveListener(this)}},{key:"OnEvent",value:function(){}},{key:"RequestEvent",value:function(a){this.events_=a}},{key:"events",value:function(){return this.events_}},{key:"GetActiver",value:function(){return null}},{key:"Release",value:function(){}}]),_}(),U=function t(){a(this,t),this.listener=null,this.priority=0,this.key=0,this.is_deleated=!1},H=function(){function _(){a(this,_),this.queue_=[],this.listener_map_={};for(var e=0;e<_.kMaxQueueNum;e++)this.queue_[e]=new w;this.next_key_=_.kEventMaxKey}return r(_,[{key:"AddEventListener",value:function(){var e=0,a,t,n;if(3<arguments.length?(a=0>=arguments.length?void 0:arguments[0],t=1>=arguments.length?void 0:arguments[1],n=2>=arguments.length?void 0:arguments[2],e=(3>=arguments.length?void 0:arguments[3])||0):(a=this.queue_[0],t=0>=arguments.length?void 0:arguments[0],n=1>=arguments.length?void 0:arguments[1],e=(2>=arguments.length?void 0:arguments[2])||0),0!=e&&this.FindListener(e))return!1;if(e>=_.kEventMaxKey||0>e)return!1;if(-1!=t.key_)return!1;t.em_=this;var o=new U;return o.listener=t,o.priority=n,o.key=0==e?this.GenerateNewKey():e,t.key_=o.key,a.AddWrapper(o),this.listener_map_[o.key]=o,!0}},{key:"RemoveListener",value:function(_){if("number"==typeof _){var s=this.listener_map_[_];if(s){var t=this.queue_[0];t.RemoveWrapper(s);var n=s.listener;n.key_=-1,n.Release(),delete this.listener_map_[_]}}else{var o=_,a=this.FindListener(o.key_);a==o&&this.RemoveListener(o.key_)}}},{key:"FindListener",value:function(a){return this.listener_map_[a]&&this.listener_map_[a].listener}},{key:"Forward",value:function(a){return this.queue_[0].ForwardEvent(a)}},{key:"GenerateNewKey",value:function(){return++this.next_key_}}]),_}();H.kEventMaxKey=1e4,H.kMaxQueueNum=1;var Q=function(_){function e(){return a(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return o(e,_),r(e,[{key:"OnEvent",value:function(){}}]),e}(b);c.exports={EventPri:{kEventPriDropPoint:0,kEventPriPuzzleItemGuide:1,kEventPriPuzzleHelper:2,kEventPriTickBomb:3,kEventPriPetTalent:4,kEventPriDigger:5,kEventPriMushroom:6,kEventPriSunEnergyWell:7,kEventPriSunEnergyWellBegin:8,kEventPriStuckMonster:9,kEvent4GridBossPlaceholder:10,kEvent4GridBoss:11,kEventPriIceBear:12,kEventPriStarPot:13,kEventPriCandyPot:14,kEventPriAnimal:15,kEventPriMonster:16,kEventPriAniGoHome:17,kEventPriNest:18,kEventMaoMaoChong:19,kEventAllLockerDone:20,kEventLocker:21,kEventPriSokoban:22,kEventPaverGlobalEnd:23,kEventPaver:24,kEventPaverRoad:25,kEventPaverGlobalBegin:26,kEventPriMaoqiuSplit:27,kEventPriMaoqiuJump:28,kEventPriChameleon:29,kEventPriBlackhole:30,kEventPriConveyer:31,kEventPriBlueberry:32,kEventPriGlobalBlueberry:33,kEventPriSpecialChess:34,kEventPriCombination:35,kEventPriRobot:36,kEventPriAlphaGoPlayer:37,kEventPriUserPlayer:38,kEventPriPlayerVsAlphaGo:39,kEventPriBoss:40,kEventPriFoamMachine:41,kEventPriMax:4e3},EventKey:{kEventKeyMushroom:1,kEventKeyFoamMachine:2,kEventKeyIceBear:3,kEventKeyRedPacket:4,kEventKeyMaoqiuJump:5,kEventKeyMaoqiuSplit:6,kEventKeyAllLockerDone:7,kEventKeyDigger:8,kEventkeySunEnergyWellBegin:9,kEventKeyPaverGlobalEnd:10,kEventKeyPaverGlobalBegin:11,kEventKeyScore:12,kEventKeyAlphaGoPlayer:13,kEventKeyUserPlayer:14,kEventKeyPlayerVsAlphaGo:15,kEventKeyTickBomb:16,kEventKeyPuzzleHelper:17,kEventKeyChameleon:18,kEventKeyConveyer:19},PuzzleEvent:l,DiggerMoveEvent:E,SlideEvent:M,SweepChessEvent:R,AddSpecialChessEvent:P,CrushNodeEvent:g,UseItemEvent:G,GameEndEvent:D,RespawnEvent:k,BuyStepEvent:B,EventQueue:w,EventListener:b,EventListenerWrapper:U,EventManager_:H,BoardEventListener:Q}},function(T,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),I=I||t(17),y=y||t(12),a=a||t(11),r=r||t(24),i=i||t(13),l=l||t(18),_=_||t(35),u=u||t(33),s=s||t(36),E=E||t(37),C=C||t(40),p=function(){function a(){n(this,a),this.chesses_=[],this.search_flag_=0,this.m_movingItemData=new _.PuzzleMovingItemData,this.last_drop_sequence_=0,this.is_backup_node_=!1,this.pos_=new I.GridPosition,this.adapter_=new s,this.chess_generator_=null,this.chess_bits_=Array(136),this.available_=!0,this._fillMode=0,this.Init()}return o(a,[{key:"copyFrom",value:function(_){this.m_movingItemData=_.m_movingItemData,this.last_drop_sequence_=_.last_drop_sequence_,this.pos_=new I.GridPosition(_.pos_),this.search_flag_=_.search_flag_,this.CopyChessTypeBit(_.chess_bits_);for(var e=this.chesses_.length,t=this.chesses_,n=0;n<e;n++)this.ClearChessPtr(n),t[n]=null;this.chesses_=[];var o=_.chesses_.length,a=_.chesses_;t=this.chesses_;for(var n=0;n<o;n++)t.push(a[n])}},{key:"Init",value:function(){this.last_drop_sequence_=-1,this.search_flag_=0,this.is_backup_node_=!1,this.chess_generator_=null,this.available_=!0,this.chesses_=Array(y.ChessLayer.kChessLayerNum);var a=this.chess_bits_;for(var e in a)a[e]=!1}},{key:"Release",value:function(){this.m_movingItemData.ReturnObject();for(var a=null,e=this.chesses_.length,t=this.chesses_,n=0;n<e;n++)a=t[n],null!=a&&(this.IsBackupNode()||a.SetActive(!1),a.OnDestroy(),t[n]=null);this.chesses_=[]}},{key:"Clear",value:function(){this.m_movingItemData.ReturnObject(),this.RemoveAll()}},{key:"IsStaticBlueBerry",value:function(){return this.HasChessType(y.ChessType.STIT_BLUEBERRY)}},{key:"GetJustDrop",value:function(){return this.m_movingItemData.m_bJustDrop}},{key:"SetJustDrop",value:function(a){this.m_movingItemData.m_bJustDrop=a}},{key:"SetStepBonus",value:function(a){this.m_movingItemData.m_nStepBonus=a}},{key:"GetStepBonus",value:function(){return this.m_movingItemData.m_nStepBonus}},{key:"GetDropPath",value:function(){return this.m_movingItemData.m_DropPath}},{key:"SetDropPath",value:function(a){this.m_movingItemData.m_DropPath=a}},{key:"ClearDropPath",value:function(){this.m_movingItemData.m_DropPath=[]}},{key:"AddPathPoint",value:function(a){this.m_movingItemData.m_DropPath.push(a)}},{key:"GetDropNewFlag",value:function(){return this.m_movingItemData.m_drop_new_flag}},{key:"SetDropNewFlag",value:function(a){this.m_movingItemData.m_drop_new_flag=a}},{key:"SetAttachStaticType",value:function(a){this.m_movingItemData.m_attachStaticType=a}},{key:"GetAttachStaticType",value:function(){return this.m_movingItemData.m_attachStaticType}},{key:"SetGiftAttr",value:function(a){this.m_movingItemData.m_GiftAttr=a}},{key:"GetGiftAttr",value:function(){return this.m_movingItemData.m_GiftAttr}},{key:"CheckMovingItemPosJoin",value:function(a){if(a==I.MovingItemType.MIT_RANDOM||a==I.MovingItemType.MIT_NONE||a==I.MovingItemType.MIT_TRANSPARENT)return!1;var e=null,t=this.chesses_;for(var n in t)if(e=t[n],null!=e&&e.Attribute().StopJoin)return!1;return this.Color()==a}},{key:"CopyMovigItemData",value:function(a){this.m_movingItemData.CopyOtherMovingItemData(a)}},{key:"IsChessGridEmpty",value:function(){return null==this.GetChess()}},{key:"IsCombinationChess",value:function(){return this.HasOneOf(y.ChessType.CT_COMBINATION1)||this.HasOneOf(y.ChessType.CT_COMBINATION2)||this.HasOneOf(y.ChessType.CT_COMBINATION3)}},{key:"IsMovingItemClods",value:function(){var a=this.GetChess();return null!=a&&(a.Type()==y.ChessType.CT_CLODS0||a.Type()==y.ChessType.CT_CLODS1)}},{key:"IsNormalItem",value:function(){return this.ChessColor()>=I.MovingItemType.MIT_0&&this.ChessColor()<=I.MovingItemType.MIT_5}},{key:"HasShockWave",value:function(){return this.HasOneOf(y.ChessType.CT_SpecialHorizontalShockWave)||this.HasOneOf(y.ChessType.CT_SpecialVerticalShockWave)}},{key:"IsAvailable",value:function(){return this.available_}},{key:"CanGenerateCandy",value:function(){if(!this.available_)return!1;var a=null,e=this.chesses_;for(var t in e)if(a=e[t],null!=a&&!a.Attribute().CanSetCandy)return!1;return!0}},{key:"CanBeReplace",value:function(){if(!this.available_)return!1;var a=null,e=this.chesses_;for(var t in e)if(a=e[t],null!=a&&!a.Attribute().CanBeReplace)return!1;return!0}},{key:"Compatible4GridBoss",value:function(){if(!this.available_)return!1;var a=null,e=this.chesses_;for(var t in e)if(a=e[t],null!=a&&!a.Attribute().Compatible4GridBoss)return!1;return!0}},{key:"CanReplaceByStartProps",value:function(){var a=this.GetTop();return null!=a&&a.Attribute().CanSetStartItem}},{key:"CanUseSpecial",value:function(){if(!this.available_)return!1;if(null==this.GetChess())return!1;var a=null,e=this.chesses_;for(var t in e)if(a=e[t],null!=a&&!a.Attribute().UseSpecial)return!1;return!0}},{key:"CanUseSwap",value:function(){if(!this.available_)return!1;if(null==this.GetChess())return!1;var a=null,e=this.chesses_;for(var t in e)if(a=e[t],null!=a&&!a.Attribute().UseSwap)return!1;return!0}},{key:"CanUseLastpang",value:function(){if(!this.available_)return!1;if(null==this.GetChess())return!1;var a=null,e=this.chesses_;for(var t in e)if(a=e[t],null!=a&&!a.Attribute().CanUseLastpang)return!1;return!0}},{key:"CanSetBlueberry",value:function(){if(!this.available_)return!1;var a=null,e=this.chesses_;for(var t in e)if(a=e[t],null!=a&&!a.Attribute().CanSetBlueberry)return!1;return!0}},{key:"CanBlockBlueberry",value:function(){return!!this.available_&&!this.CanSetBlueberry()}},{key:"NeedReArrange",value:function(){var a=[y.ChessType.CT_NormalUnit,y.ChessType.CT_COMBINATION1,y.ChessType.CT_COMBINATION2,y.ChessType.CT_COMBINATION3,y.ChessType.CT_SpecialVerticalShockWave,y.ChessType.CT_SpecialHorizontalShockWave,y.ChessType.CT_SpecialHurricane,y.ChessType.CT_SpecialGas,y.ChessType.CT_Chameleon],e=this.GetChess();if(null==e)return!1;if(this.HasChessSurface())return!1;for(var t=a.length,n=0;n<t;n++)if(e.Type()==a[n])return!0;return!1}},{key:"CanGenerateNewChess",value:function(){return null!=this.chess_generator_&&null==this.GetChess()&&!this.HasChessSurface()}},{key:"GenerateNewChess",value:function(n,e){if(null==this.chess_generator_)return!1;var t=this.chess_generator_.Generate(this,e);if(!t)return!1;for(;1<=n;){var _=null;_=e?new I.GridPosition(this.GetWorldPosition().row+n,this.GetWorldPosition().col):new I.GridPosition(this.GetWorldPosition().row-n,this.GetWorldPosition().col),n--,this.AddPathPoint(i.curBoard.World2Local(_))}return this.SetJustDrop(!0),this.AddPathPoint(i.curBoard.World2Local(this.GetWorldPosition())),this.SetDropNewFlag(!0),!0}},{key:"HasChessSurface",value:function(){for(var a=y.ChessLayer.kChessLayer2;a<y.ChessLayer.kChessLayerNum;a++)if(null!=this.GetLayer(a))return!0;return!1}},{key:"GetPosition",value:function(){return i.curBoard.World2Local(this.pos_)}},{key:"GetPositionInBoard",value:function(a){return a.Position(this.pos_)}},{key:"GetWorldPosition",value:function(){return this.pos_}},{key:"SetPosition",value:function(a){this.pos_=a}},{key:"Crush",value:function(a){return this.CommonCrush(a)}},{key:"UserDisappearItem",value:function(a){return this.CommonCrush(a)}},{key:"CanCrushAround",value:function(){var e=this.GetTop();if(null==e)return!1;var a=e.Attribute();return null!=a&&a.CanCrushAround}},{key:"CanDrop",value:function(_){if(!this.available_)return!1;for(var e=!1,t=null,n=this.chesses_.length,o=this.chesses_,a=0;a<n;a++)if(t=o[a],null!=t)if(!(t.Attribute().drop_rule==y.DropRule.kDropNone))e=!0;else if(t.Attribute().StopDrop)return!1;return(_!=I.DropWay.DropWay_Fall||!this.HasChessType(y.ChessType.STIT_FENCE_BOTTOM))&&(!this.HasCollectChess()||!(this.HasOneOf(y.ChessType.STIT_COLLECTCANDY_POINT)||this.HasOneOf(y.ChessType.STIT_COLLECTBALLOON_POINT)||this.HasOneOf(y.ChessType.STIT_COLLECT_POINT_IN_SODA)||this.HasOneOf(y.ChessType.STIT_COLLECT_POINT_IN_SODA_BOTH)||this.HasOneOf(y.ChessType.STIT_COLLECT_POINT_IN_SODA_LEFT)||this.HasOneOf(y.ChessType.STIT_COLLECT_POINT_IN_SODA_RIGHT)))&&e}},{key:"CanDropIn",value:function(_,e){if(!this.available_)return!1;var r=this.chesses_.length,n=this.chesses_;if(r<y.ChessLayer.kChessLayerNum)return!1;if(n[I.kChessLayerChess])return!1;for(var o=0;o<r;o++)if(n[o]&&o!=I.kChessLayerChess&&n[o].Attribute().StopDropIn)return!1;return!this.HasChessType(y.ChessType.STIT_FENCE_BOTTOM)||_!=I.DropWay.DropWay_Float||!!e&&this.HasChessType(y.ChessType.STIT_DROP_POINT_IN_SODA)}},{key:"CanDropTo",value:function(a){var e=null;return e=a instanceof I.GridPosition?i.boardViewer.GetNode(a.row,a.col):a,!!e&&(E.WormholeModule.GetExitPos(this).isEqual(e.GetWorldPosition())?this.CanDropAcrossWormhole(e):this.GetPosition().col==e.GetPosition().col?this.CanVerticalDropTo(e):this.CanSideDropTo(e))}},{key:"DropTo",value:function(a){var e=null;if(e=a instanceof I.GridPosition?i.boardViewer.GetNode(a.row,a.col):a,!e)return!1;if(!this.CanDropTo(e))return!1;var _=this.GetChess();if(this.SwapLayer(e,I.kChessLayerChess),0==e.GetDropPath().length){var n=this.GetPosition();e.AddPathPoint(new I.GridPosition(n.row,n.col))}return e.AddPathPoint(new I.GridPosition(e.GetPosition())),e.SetJustDrop(!0),this.m_movingItemData.ReturnObject(),this.HasChessType(y.ChessType.STIT_MAOQIU1)&&(this.MoveChessTo(y.ChessType.STIT_MAOQIU1,e),e.GetMovingItemP().m_attachStaticType=y.ChessType.STIT_MAOQIU1),this.HasChessType(y.ChessType.STIT_MAOQIU2)&&(this.MoveChessTo(y.ChessType.STIT_MAOQIU2,e),e.GetMovingItemP().m_attachStaticType=y.ChessType.STIT_MAOQIU2),_&&_.OnDrop(this.GetPosition(),e.GetPosition()),!0}},{key:"CanSlide",value:function(){if(!this.available_)return!1;if(null==this.GetChess())return!1;var a=null,e=this.chesses_;for(var t in e)if(a=e[t],null!=a&&!a.Attribute().CanSlide)return!1;return!0}},{key:"SlideSwap",value:function(e){var t=null;if(t=e instanceof I.GridPosition?i.boardViewer.GetNode(e):e){var n=new a;this.SlideTo(n),t.SlideTo(this),n.SlideTo(t)}}},{key:"CanJoin3Crush",value:function(){var a=null;if(null==this.chesses_[1])return!1;for(var e=!1,_=(this.chesses_.length,this.chesses_),n=y.ChessLayer.kChessLayerNum-1;0<=n;n--)if(a=_[n],null!=a){if(a.Attribute().StopJoin)return!1;if(a.Color()==I.MovingItemType.MIT_NONE&&!e)return!1;a.Color()!=I.MovingItemType.MIT_TRANSPARENT&&(e=!0)}return e}},{key:"BackupTo",value:function(_,e){_.RemoveAll(),_.m_movingItemData=this.m_movingItemData,_.last_drop_sequence_=this.last_drop_sequence_,_.pos_=new I.GridPosition(this.pos_),_.chess_generator_=this.chess_generator_,_.CopyChessTypeBit(this.chess_bits_);for(var t=this.chesses_.length,n=this.chesses_,o=0,a;o<t;o++)if(a=n[o],null!=a){var r=a.Backup();_.AddChessPtr(r)}e&&this.ShallowCopyTo(e)}},{key:"RollbackFrom",value:function(_,e){this.RemoveAll(),this.m_movingItemData=_.m_movingItemData,this.last_drop_sequence_=_.last_drop_sequence_,this.pos_=new I.GridPosition(_.pos_),this.chess_generator_=_.chess_generator_,this.CopyChessTypeBit(_.chess_bits_),e&&this.ShallowCopyFrom(e);for(var t=this.chesses_.length,n=this.chesses_,o=0,a;o<t;o++)a=n[o],null!=a&&(a.SetNode(this),a.Restore(_.chesses_[o]));_.RemoveAll(),e&&e.RemoveAll()}},{key:"AllocChessType",value:function(_){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:I.MovingItemType.MIT_NONE;if(3<arguments.length&&void 0!==arguments[3]&&arguments[3],_==y.ChessType.CT_None||_==y.ChessType.STIT_NONE)return null;if(_==y.ChessType.STIT_NOUSE){for(var n=this.chesses_.length,o=0;o<n;o++)this.ClearChessPtr(o);this.chesses_=Array(y.ChessLayer.kChessLayerNum)}switch(_){case y.ChessType.CT_NormalUnit:case y.ChessType.CT_SpecialHorizontalShockWave:case y.ChessType.CT_SpecialVerticalShockWave:case y.ChessType.CT_SpecialHurricane:break;case y.ChessType.CT_SpecialGas:t=I.MovingItemType.MIT_NONE;}if(_==y.ChessType.STIT_BLUEBERRY&&this.HasChessType(y.ChessType.STIT_BLUEBERRY)||_==y.ChessType.STIT_BAD_BLUEBERRY&&this.HasChessType(y.ChessType.STIT_BAD_BLUEBERRY))return null;var a=i.moduleManager.NewChess(_);return a?(a.SetColor(t),a.SetAttach(e),a):null}},{key:"AddChessType",value:function(_){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:I.MovingItemType.MIT_NONE,n=3<arguments.length&&void 0!==arguments[3]&&arguments[3],o=this.AllocChessType(_,e,t,n);o&&this.InitChess(o)}},{key:"AddChessByElement",value:function(a){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!i.tableManager.VaildElement(a))return!1;var t=i.tableManager.ElementToChess(a);return t.type!=y.ChessType.STIT_NONE&&(e&&t.color==I.MovingItemType.MIT_RANDOM&&(t.color=r.PuzzleRand("cn(788)")%i.stageManager.MaxColorCount()),this.AddChessType(t.type,t.attach,t.color,!0),!0)}},{key:"AddChess",value:function(a){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:I.MovingItemType.MIT_NONE,t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;a instanceof l.ChessInterface?this.InitChess(a):this.AddChessType(a,t,e)}},{key:"SetChessTypeBit",value:function(a){this.chess_bits_[a]=!0,this.available_=!this.HasChessType(y.ChessType.STIT_NOUSE)}},{key:"ClearChessTypeBit",value:function(a){this.chess_bits_[a]=!1,this.available_=!this.HasChessType(y.ChessType.STIT_NOUSE)}},{key:"CopyChessTypeBit",value:function(a){for(var e=this.chess_bits_.length,t=this.chess_bits_,n=0;n<e;n++)t[n]=a[n];this.available_=!this.HasChessType(y.ChessType.STIT_NOUSE)}},{key:"DropNewChess",value:function(a,e){HasOneOf(y.ChessType.STIT_DROP_POINT)&&this.AddChess(a,e)}},{key:"GetChess",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:I.kChessLayerChess;return this.GetLayer(a)}},{key:"ToChessData",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:I.kChessLayerChess,e=null,t=this.GetLayer(a);return t?e=t.ToChessData():(e=new y.ChessData,e.type=y.ChessType.STIT_NONE,e.color=I.MovingItemType.MIT_NONE,e.pos.row=this.pos_.row,e.pos.col=this.pos_.col),e}},{key:"GetEmptyChessData",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:I.kChessLayerChess,e=new y.ChessData,t=this.GetLayer(a);return t?t.GetEmptyChessData():(e.type=y.ChessType.STIT_NONE,e.color=I.MovingItemType.MIT_NONE,e.pos.row=this.pos_.row,e.pos.col=this.pos_.col,e)}},{key:"GetChessByType",value:function(a){return this.FindChess(a)}},{key:"GetTop",value:function(){for(var a=this.chesses_,e=y.ChessLayer.kChessLayerNum-1;e>=y.ChessLayer.kChessLayer0;e--)if(null!=a[e])return a[e];return null}},{key:"GetFeature",value:function(a){var e=this.FindFeautre(a);return-1==e?null:this.chesses_[e]}},{key:"GetAllChess",value:function(a){for(var e=this.chesses_,t=0;t<y.ChessLayer.kChessLayerNum;t++)a.push(e[t])}},{key:"GetAll",value:function(a){for(var e=this.chesses_.length,t=this.chesses_,n=0;n<e;n++)null!=t[n]&&a.push(t[n])}},{key:"FindAttach",value:function(a){var e=this.FindChess(a);return null==e?null:e.GetAttach()}},{key:"ClearChess",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:I.kChessLayerChess,e=this.GetLayer(a);null!=e&&(this.RemoveLayer(a),a==I.kChessLayerChess&&this.m_movingItemData.ReturnObject())}},{key:"ConveyerMoveTo",value:function(a){for(var e=0,t;e<y.ChessLayer.kChessLayerNum;e++)t=this.chesses_[e],null!=t&&a.AddChessPtr(t);a.m_movingItemData.CopyOtherMovingItemData(this.m_movingItemData);for(var e=0;e<y.ChessLayer.kChessLayerNum;e++)this.SetChessPtr(e)}},{key:"ConveyerCopyChessTo",value:function(a,e){if(this.HasChessType(a)){var t=this.FindAttach(a);e.AddChessType(a,t)}}},{key:"MoveTo",value:function(_){var e=_.GetWorldPosition();_.Clear(),_.copyFrom(this),this.Clear(),_.SetPosition(e);for(var t=_.chesses_.length,n=_.chesses_,o=0,a;o<t;o++)a=n[o],null!=a&&a.SetNode(_);return!0}},{key:"MoveLayerTo",value:function(a,e){var t=this.GetLayer(a);return null!=t&&(e.GetLayer(a)&&e.RemoveLayer(a),this.SwapLayer(e,a),!0)}},{key:"MoveChessTo",value:function(a,e){var t=this.FindChess(a);if(null==t)return!1;if(e.FindChess(a))return!1;var n=t.Attribute().Layer;return n==y.ChessLayer.kChessLayerFeature?(this.RemoveChess(t),e.AddChessPtr(t),!0):null==e.chesses_[n]&&(this.SwapLayer(e,n),!0)}},{key:"CopyTo",value:function(){return!1}},{key:"CopyLayerTo",value:function(){return!1}},{key:"CopyChessTo",value:function(){return!1}},{key:"DeepCopyTo",value:function(a){return this.BackupTo(a,null),!0}},{key:"DeepCopyLayerTo",value:function(a,e){var t=this.GetLayer(a);return null!=t&&!e.GetLayer(a)&&(e.AddChessPtr(t.Backup()),!0)}},{key:"DeepCopyChessTo",value:function(a,e){var t=e.FindChess(a);return null==t&&(t=this.FindChess(a),null!=t&&(e.AddChessPtr(t.Backup()),!0))}},{key:"MarkChess",value:function(a){var e=this.GetLayer(I.kChessLayerChess);null!=e&&e.SetCrushMark(a)}},{key:"GetMark",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:I.kChessLayerChess,e=this.GetLayer(a);return null==e?0:e.CrushMark()}},{key:"ChessType",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:I.kChessLayerChess,e=this.GetChess(a);return null==e?I.MovingItemType.STIT_NONE:e.Type()}},{key:"ChessColor",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:I.kChessLayerChess,e=this.GetChess(a);return null==e?I.MovingItemType.MIT_NONE:e.Color()}},{key:"SetChessColor",value:function(a){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:I.kChessLayerChess,t=this.GetChess(e);t&&t.SetColor(a)}},{key:"Color",value:function(){for(var a=y.ChessLayer.kChessLayerNum,e=this.chesses_,t;0<--a;)if(t=e[a],null!=t){if(t.Color()==I.MovingItemType.MIT_NONE)return I.MovingItemType.MIT_NONE;if(t.Color()!=I.MovingItemType.MIT_TRANSPARENT)return t.Color()}return I.MovingItemType.MIT_NONE}},{key:"SetActive",value:function(_){for(var e=this.chesses_.length,t=this.chesses_,n=0,o;n<e;n++)o=t[n],null!=o&&o.SetActive(_)}},{key:"SetVisible",value:function(a){a?this.SetActive(!0):this.SetActive(!1)}},{key:"InitAllChess",value:function(){for(var _=this.chesses_.length,e=this.chesses_,t=0,n;t<_;t++)if(n=e[t],null!=n){var o=n.GetAttach();n.SetNode(this),n.OnCreate(),n.Init(o)}}},{key:"HasChessType",value:function(a){return this.chess_bits_[a]}},{key:"HasOneOf",value:function(a){return this.HasChessType(a)}},{key:"HasSpecialChess",value:function(){return this.HasOneOf(y.ChessType.CT_SpecialVerticalShockWave)||this.HasOneOf(y.ChessType.CT_SpecialHorizontalShockWave)||this.HasOneOf(y.ChessType.CT_SpecialHurricane)||this.HasOneOf(y.ChessType.CT_SpecialGas)}},{key:"HasCollectChess",value:function(a){var o=this.GetChess();return null!=o&&o.Attribute().IsCollection&&(!a||o.Type()==a)}},{key:"HasClods",value:function(){return this.HasOneOf(y.ChessType.CT_CLODS0)||this.HasOneOf(y.ChessType.CT_CLODS1)}},{key:"GetLayer",value:function(a){return this.chesses_[a]}},{key:"SetLayer",value:function(a,e){this.chesses_[a]&&(this.chesses_[a].SetActive(!1),this.ClearChessPtr(a)),this.SetChessPtr(a,e)}},{key:"RemoveChess",value:function(_){for(var e=_ instanceof l.ChessInterface,t=this.chesses_.length,n=this.chesses_,o=0;o<y.ChessLayer.kChessLayerNum;o++)null!=n[o]&&(e?n[o]==_&&this.ClearChessPtr(o):n[o].Type()==_&&this.ClearChessPtr(o));for(var o=y.ChessLayer.kChessLayerNum;o<t;o++)null!=n[o]&&(e?n[o]==_&&(this.ClearChessPtr(o),n.splice(o,1)):n[o].Type()==_&&(this.ClearChessPtr(o),n.splice(o,1)))}},{key:"MarkSweepByLayer",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:I.kChessLayerChess;if(!(a<y.ChessLayer.kChessLayer0||a>=y.ChessLayer.kChessLayerNum)){var e=this.GetLayer(a);null!=e&&(e.SetCrushMark(1),this.SweepChess(e))}}},{key:"MarkSweepByType",value:function(a){var e=this.FindChess(a);null!=e&&(e.SetCrushMark(1),this.SweepChess(e))}},{key:"MarkSweepByChess",value:function(a){null!=a&&(a.SetCrushMark(1),this.SweepChess(a))}},{key:"Sweep",value:function(){for(var a=null,e=0,t=y.ChessLayer.kChessLayerNum-1;t>=y.ChessLayer.kChessLayer0;t--)null!=(a=this.GetLayer(t))&&this.SweepChess(a)&&e++;return e}},{key:"SearchFlag",value:function(){return this.search_flag_}},{key:"SetSearchFlag",value:function(a){this.search_flag_=a}},{key:"adapter",value:function(){return this.adapter_}},{key:"MarkAsBackupNode",value:function(){this.is_backup_node_=!0}},{key:"IsBackupNode",value:function(){return this.is_backup_node_}},{key:"SetChessGenerator",value:function(a){this.chess_generator_=a}},{key:"InitChess",value:function(_){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],t=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=_.Attribute().Layer;if(!(0>n||(n==y.ChessLayer.kChessLayerFeature?this.AddFeautrePtr(_):this.SetLayer(n,_),_.SetNode(this),_.OnCreate(),_.Init(_.GetAttach()),_.SetActive(!0),t&&_.OnGenerated(),e))){if(y.ChessType.STIT_COLLECT_UNDER_ICE==_.Type()){var o=this.GetPosition();C.PuzzleIceBearUtil.GetInstance().InsertCollectUnderIceThing(o.row,o.col)}var a=_.Attribute();a&&(a.IsSpecialChess1||a.IsSpecialChess2)}}},{key:"ToNodeData",value:function(){if(!this.IsAvailable())return new y.NodeData;for(var _=null,e=new y.NodeData,t=e.chess_data,n=this.chesses_,o=n.length,a=0;a<o;a++)_=n[a],_?t.push(_.ToChessData()):t.push(null);var r=this.GetPosition();return e.pos.row=r.row,e.pos.col=r.col,e}},{key:"ToRealChessDataList",value:function(){for(var a=[],e=this.chesses_,t=0,n;3>t;t++)n=e[t],n?a.push(n.ToChessData()):a.push(null);return a}},{key:"GetMovingItemDataCite",value:function(){return this.m_movingItemData}},{key:"GetMovingItemP",value:function(){return this.m_movingItemData}},{key:"LayerOfChess",value:function(a){return a.Attribute().Layer}},{key:"AddChessPtr",value:function(a){a.SetNode(this);var e=this.LayerOfChess(a);return e==y.ChessLayer.kChessLayerFeature?void this.AddFeautrePtr(a):void this.SetChessPtr(e,a)}},{key:"RemoveAll",value:function(){this.ReleaseAllChess(),this.m_movingItemData.ReturnObject()}},{key:"FindChess",value:function(_){for(var e=this.chesses_.length,t=this.chesses_,n=0,o;n<e;n++)if(o=t[n],null!=o&&o.Type()==_)return o;return null}},{key:"FindFeautre",value:function(_){var e=this.chesses_.length,t=this.chesses_;if(e<=y.ChessLayer.kChessLayerNum)return-1;for(var n=y.ChessLayer.kChessLayerNum,a;n<e&&(a=t[n],null!=a);n++)if(a.Type()==_)return n;return-1}},{key:"AddFeautrePtr",value:function(a){var e=this.FindFeautre(a.Type());return-1==e?(this.chesses_.push(a),this.SetChessPtr(this.chesses_.length-1,a),void a.SetNode(this)):void this.SetChessPtr(e,a)}},{key:"CommonCrush",value:function(_){var e=!1,t=new l.AttackInfo;t.copyDataFrom(_);for(var n=y.ChessLayer.kChessLayerNum-1,o;n>=y.ChessLayer.kChessLayer0;n--)o=this.GetLayer(n),o&&this.CommonCrushChess(o,t)&&(e=!0);return e&&(this.last_drop_sequence_=i.envManager.GetDropSequence()),e}},{key:"InternalCrush",value:function(a,e){return a.Crush(e)}},{key:"CommonCrushChess",value:function(a,e){var t=a.Attribute();return!!a.CanCrush(e)&&(!t.ForbidContinuousCrush||i.envManager.GetDropSequence()!=this.last_drop_sequence_)&&!!this.InternalCrush(a,e)&&(a.SetCrushMark(e.join),t.ForbidContinuousCrush||t.NextType==y.ChessType.STIT_NONE||(console.log("\u68CB\u5B50\u5141\u8BB8\u88AB\u8FDE\u7EED\u6D88\u9664"),this.SweepChess(a)),a.Attribute().CanCrushAround&&this.DoCrushAround(e,this.GetPosition()),!0)}},{key:"CommonSweepChess",value:function(t){if(0==t.CrushMark())return!1;var e=t.Attribute();i.scoreManager.AddCrushChess(t),t.SetActive(!1);var o=t.NextChess();return t.OnDestroy(),this.RemoveChess(t),null!=o&&this.AddChess(o),e.Layer==I.kChessLayerChess&&null==this.GetLayer(e.Layer)&&this.m_movingItemData.ReturnObject(),!0}},{key:"SwapLayer",value:function(r,e){var t=r.chesses_,n=this.chesses_,o=t[e];if(r.SetChessPtr(e,n[e]),this.SetChessPtr(e,o),n[e]&&n[e].SetNode(this),t[e]&&t[e].SetNode(r),e==I.kChessLayerChess){var a=new _.PuzzleMovingItemData;a.CopyOtherMovingItemData(this.m_movingItemData),this.m_movingItemData.CopyOtherMovingItemData(r.m_movingItemData),r.m_movingItemData.CopyOtherMovingItemData(a)}}},{key:"DoCrushAround",value:function(r,e){var t=e.row,n=e.col,o=[];o.push(new I.GridPosition(t-1,n)),o.push(new I.GridPosition(t+1,n)),o.push(new I.GridPosition(t,n-1)),o.push(new I.GridPosition(t,n+1));var a=new l.AttackInfo;a.copyDataFrom(r),a.src=new I.GridPosition(e),a.attack_type=y.AttackType.Attack_Normal,a.around_attack=!0;var s=new u.CrushNodeEvent;s.attack_type=y.AttackType.Attack_Normal,s.src=new I.GridPosition(e),s.ani_batch_id=r.batch.m_self_batch_index,s.around_attack=!0;for(var _=o.length,c=0;c<_;c++){var E=o[c],C=E.row,p=E.col;if(i.boardViewer.ValidPos(C,p)){var d=i.boardViewer.GetNode(C,p);d.Crush(a),s.nodes.push(new I.GridPosition(d.GetPosition()))}}i.eventManager.Forward(s)}},{key:"SweepChess",value:function(a){if(0==a.CrushMark())return!1;var e=a.Attribute();a.SetActive(!1);var t=new u.SweepChessEvent;t.chess=a,i.eventManager.Forward(t);var n=a.NextChess();return a.OnDestroy(),this.RemoveChess(a),null!=n&&this.AddChess(n),e.Layer==y.ChessLayer.kChessLayerChess&&null==this.GetLayer(e.Layer)&&this.m_movingItemData.ReturnObject(),!0}},{key:"SlideTo",value:function(a){null!=this.chesses_[I.kChessLayerChess]&&this.SwapLayer(a,I.kChessLayerChess)}},{key:"ReleaseAllChess",value:function(){for(var a=this.chesses_.length,e=0;e<a;e++)this.ClearChessPtr(e);this.chesses_=[]}},{key:"SendBoardEvent",value:function(a){i.eventManager.Forward(a)}},{key:"CanDropAcrossWormhole",value:function(a){return!!this.CanDrop(I.DropWay.DropWay_Teleport)&&!!a.CanDropIn(I.DropWay.DropWay_Teleport)}},{key:"CanVerticalDropTo",value:function(a){var e=I.DropWay.DropWay_Fall;return a.GetPosition().row<this.GetPosition().row&&(e=I.DropWay.DropWay_Float),!!this.CanDrop(e)&&!!a.CanDropIn(e)&&!(a.GetPosition().row>this.GetPosition().row&&this.HasOneOf(y.ChessType.STIT_FENCE_BOTTOM))&&!(a.GetPosition().row<this.GetPosition().row&&a.HasOneOf(y.ChessType.STIT_FENCE_BOTTOM))}},{key:"CanSideDropTo",value:function(_){var e=I.DropWay.DropWay_Fall;if(_.GetPosition().row<this.GetPosition().row&&(e=I.DropWay.DropWay_Float),this.HasOneOf(y.ChessType.CT_CLODS0)||this.HasOneOf(y.ChessType.CT_CLODS1))return!1;if(!this.CanDrop(e))return!1;if(!_.CanDropIn(e))return!1;var t=this.GetPosition(),n=_.GetPosition();if(n.col>t.col&&e==I.DropWay.DropWay_Fall&&(this.HasOneOf(y.ChessType.STIT_FENCE_RIGHT)||this.HasOneOf(y.ChessType.STIT_FENCE_BOTTOM)))return!1;if(n.col<t.col&&e==I.DropWay.DropWay_Fall){if(this.HasOneOf(y.ChessType.STIT_FENCE_BOTTOM))return!1;var o=i.boardViewer.GetNode(t.row,t.col-1);if(o&&o.HasOneOf(y.ChessType.STIT_FENCE_RIGHT))return!1}if(n.col>t.col&&e==I.DropWay.DropWay_Float){if(this.HasChessType(y.ChessType.STIT_FENCE_RIGHT))return!1;var a=i.boardViewer.GetNode(t.row-1,t.col);if(a&&a.HasChessType(y.ChessType.STIT_FENCE_BOTTOM))return!1}if(n.col<t.col&&e==I.DropWay.DropWay_Float){var o=i.boardViewer.GetNode(t.row,t.col-1);if(o&&o.HasChessType(y.ChessType.STIT_FENCE_RIGHT))return!1;var a=i.boardViewer.GetNode(t.row-1,t.col);if(a&&a.HasChessType(y.ChessType.STIT_FENCE_BOTTOM))return!1}return!0}},{key:"SetChessPtr",value:function(a){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.chesses_[a]&&this.ClearChessTypeBit(this.chesses_[a].Type()),e&&this.SetChessTypeBit(e.Type()),this.chesses_[a]=e}},{key:"ClearChessPtr",value:function(a){this.chesses_[a]&&(this.ClearChessTypeBit(this.chesses_[a].Type()),this.chesses_[a].Release(),this.chesses_[a]=null)}},{key:"ShallowCopyTo",value:function(_){_.ReleaseAllChess();for(var e=this.chesses_.length,t=this.chesses_,n=_.chesses_,o=0;o<e;o++)n.push(t[o])}},{key:"ShallowCopyFrom",value:function(_){this.ReleaseAllChess();for(var e=this.chesses_,t=_.chesses_.length,n=_.chesses_,o=0;o<t;o++)e.push(n[o])}},{key:"RemoveLayer",value:function(a){this.ClearChessPtr(a)}},{key:"IsStaticItemCandyPaper",value:function(){return this.HasChessType(y.ChessType.STIT_CANDYPAPER1)||this.HasChessType(y.ChessType.STIT_CANDYPAPER2)||this.HasChessType(y.ChessType.STIT_CANDYPAPER3)||this.HasChessType(y.ChessType.STIT_CANDYPAPER4)||this.HasChessType(y.ChessType.STIT_CANDYPAPER5)}},{key:"IsStaticItemMaoQiu",value:function(){return this.HasChessType(y.ChessType.STIT_MAOQIU1)||this.HasChessType(y.ChessType.STIT_MAOQIU2)}},{key:"IsStaticItemCollectPointInSoda",value:function(){var a=this.HasChessType(y.ChessType.STIT_COLLECT_POINT_IN_SODA)||this.HasChessType(y.ChessType.STIT_COLLECT_POINT_IN_SODA_LEFT)||this.HasChessType(y.ChessType.STIT_COLLECT_POINT_IN_SODA_RIGHT)||this.HasChessType(y.ChessType.STIT_COLLECT_POINT_IN_SODA_BOTH);return a}},{key:"IsStaticItemCollectUnderIce",value:function(){return this.HasChessType(y.ChessType.STIT_COLLECT_UNDER_ICE)}},{key:"IsStaticIceArea",value:function(){return this.IsStaticItemIce()||this.IsStaticItemDeepIce()}},{key:"IsStaticItemIce",value:function(){return this.IsStaticItemIceWithBearUnder()||this.IsStaticItemIceWithoutBearUnder()}},{key:"IsStaticItemIceWithBearUnder",value:function(){return this.HasChessType(y.ChessType.STIT_ICE_BEAR_UNDER)}},{key:"IsStaticItemIceWithoutBearUnder",value:function(){return this.HasChessType(y.ChessType.STIT_ICE)}},{key:"IsStaticItemDeepIce",value:function(){return this.HasChessType(y.ChessType.STIT_DEEPICE)}},{key:"IsStaticItemBox",value:function(){return this.HasChessType(y.ChessType.STIT_BOX)}},{key:"IsStaticItemBoxTwo",value:function(){return this.HasChessType(y.ChessType.STIT_BOX_TWO)}},{key:"IsStaticItemBoxThree",value:function(){return this.HasChessType(y.ChessType.STIT_BOX_THREE)}},{key:"IsStaticItemBoxFour",value:function(){return this.HasChessType(y.ChessType.STIT_BOX_FOUR)}},{key:"IsStaticItemCage",value:function(){return this.HasOneOf(y.ChessType.STIT_CAGE)||this.HasOneOf(y.ChessType.STIT_CAGE2)}},{key:"IsStaticItemBoxOrCage",value:function(){return this.HasOneOf(y.ChessType.STIT_CAGE)||this.HasOneOf(y.ChessType.STIT_CAGE2)||this.HasChessType(y.ChessType.STIT_BOX)||this.HasChessType(y.ChessType.STIT_BOX_TWO)||this.HasChessType(y.ChessType.STIT_BOX_THREE)||this.HasChessType(y.ChessType.STIT_BOX_FOUR)}},{key:"GetTickbombTick",value:function(){var a=this.GetChess();if(null==a)return 0;if(a.Type()!=y.ChessType.CT_TICKBOMB)return 0;return a.tick()}},{key:"setFillMode",value:function(a){this._fillMode=a}},{key:"getFillMode",value:function(){return this._fillMode}}]),a}();T.exports=p},function(_,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),a=a||t(17),r=r||t(12),i=function(){function _(){n(this,_),this.m_GiftAttr=null,this.m_nStepBonus=0,this.m_bJustDrop=!1,this.m_drop_new_flag=!1,this.m_attachStaticType=0,this.m_DropPath=[],this.ReturnObject()}return o(_,[{key:"ReturnObject",value:function(){this.m_DropPath=[],this.m_bJustDrop=!1,this.m_drop_new_flag=!1,this.m_attachStaticType=r.ChessType.STIT_NONE,this.m_nStepBonus=0}},{key:"ResetDropPath",value:function(){this.m_DropPath=[]}},{key:"AddPathPoint",value:function(o){var e=new a.GridPosition(o);this.m_DropPath.push(e)}},{key:"GetDropDepth",value:function(){return this.m_DropPath}},{key:"ClearDropDepth",value:function(){this.m_DropPath=[]}},{key:"GetJustDrop",value:function(){return this.m_bJustDrop}},{key:"SetJustDrop",value:function(a){this.m_bJustDrop=a}},{key:"CopyOtherMovingItemData",value:function(_){if(this.ReturnObject(),_){this.m_bJustDrop=_.m_bJustDrop;for(var e=this.m_DropPath,t=_.m_DropPath,n=t.length,o=0;o<n;o++)e.push(t[o]);this.m_drop_new_flag=_.m_drop_new_flag,this.m_attachStaticType=_.m_attachStaticType,this.m_nStepBonus=_.m_nStepBonus}}},{key:"SetGiftAttr",value:function(a){this.m_GiftAttr=a}},{key:"GetGiftAttr",value:function(){return this.m_GiftAttr}},{key:"SlideSwap",value:function(e){var a=new _;a.CopyOtherMovingItemData(this),CopyOtherMovingItemData(e),e.CopyOtherMovingItemData(a)}}]),_}();_.exports={PuzzleMovingItemData:i}},function(a){"use strict";a.exports=function(){this.NextNode=null}},function(y,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function o(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==typeof o||"function"==typeof o)?o:a}function a(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}function r(a,e){return a.HasChessType(E.ChessType.STIT_CHONGDONG1)&&(e=i(a,e)),a.HasChessType(E.ChessType.STIT_CHONGDONG2)&&(e=s(a,e)),e}function i(_,e){var t=_.GetFeature(E.ChessType.STIT_CHONGDONG1);if(null==t)return e;var n=t.GetAttach(),o=new S.GridPosition(_.GetWorldPosition()),a=C.envManager.GetSodaLine(),r=C.worldViewer.GetPosByIndex(n.iVal1).row,i=C.worldViewer.GetPosByIndex(n.iVal1).col;return o.row<a&&r<a&&(e.row=r,e.col=i),e}function s(_,e){var t=_.GetFeature(E.ChessType.STIT_CHONGDONG2);if(null==t)return e;var n=t.GetAttach(),o=new S.GridPosition(_.GetWorldPosition()),a=C.envManager.GetSodaLine(),r=C.worldViewer.GetPosByIndex(n.iVal1).row,i=C.worldViewer.GetPosByIndex(n.iVal1).col;return o.row>=a&&r>=a&&(e.row=r,e.col=i),e}var _=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),l=function _(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:_(a,t,n)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(n)},u=u||t(38),c=c||t(39),S=S||t(17),E=E||t(12),C=C||t(13),p=function(s){function i(){n(this,i);var a=o(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,E.ChessType.STIT_CHONGDONG1));return a.save_=null,a}return a(i,s),_(i,[{key:"Init",value:function(a){l(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"Init",this).call(this,a);var e=this.GetNodeAdapter();this.save_=e.NextNode,e.NextNode=r}}]),i}(c.BasicChess),N=function(s){function i(){n(this,i);var a=o(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,E.ChessType.STIT_CHONGDONG2));return a.save_=null,a}return a(i,s),_(i,[{key:"Init",value:function(a){l(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"Init",this).call(this,a);var e=this.GetNodeAdapter();this.save_=e.NextNode,e.NextNode=r}}]),i}(c.BasicChess),h=function(s){function i(){return n(this,i),o(this,(i.__proto__||Object.getPrototypeOf(i)).call(this))}return a(i,s),_(i,[{key:"Init",value:function(a){return l(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"Init",this).call(this,a),this.RegisterChess(E.ChessType.STIT_CHONGDONG1),this.RegisterChess(E.ChessType.STIT_CHONGDONG2),!0}},{key:"NewChess",value:function(a){return a==E.ChessType.STIT_CHONGDONG1?(this.newChessCount++,new p):a==E.ChessType.STIT_CHONGDONG2?(this.newChessCount++,new N):null}}],[{key:"GetExitPos",value:function(a){var e=new S.GridPosition(-1,-1);return r(a,e)}}]),i}(u);y.exports={Wormhole1:p,Wormhole2:N,WormholeModule:h}},function(_,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),a=a||t(13),r=function(){function t(){n(this,t),this.board_=null,this.newChessCount=0,this.chessesPool=[],this.isUsePool=!1}return o(t,[{key:"Init",value:function(a){return this.board_=a,!0}},{key:"Release",value:function(){}},{key:"showNewCount",value:function(a){console.log(a+" new ches count is : "+this.newChessCount)}},{key:"NewChess",value:function(){return null}},{key:"RegisterChess",value:function(t){return a.moduleManager.RegisterChess(t,this)}},{key:"SetModuleData",value:function(){}},{key:"GetModuleData",value:function(){return null}},{key:"PreAllocChess",value:function(a,e){for(var t=this.chessesPool,n=0;n<a;n++)t.push(e())}},{key:"GetChessFromPool",value:function(){return this.chessesPool.shift()}},{key:"RecycleChess",value:function(a){this.isUsePool&&this.chessesPool.push(a)}}]),t}();_.exports=r},function(T,e,t){"use strict";function I(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function o(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==typeof o||"function"==typeof o)?o:a}function a(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var n=function _(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:_(a,t,n)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(n)},r=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),s=s||t(18),_=_||t(23),i=i||t(17),l=l||t(12),c=c||t(13),u=u||t(38),E=function(n){function E(a){I(this,E);var e=o(this,(E.__proto__||Object.getPrototypeOf(E)).call(this));return e.color_=i.MovingItemType.MIT_NONE,e.node_=null,e.attach_=new s.PuzzleStaticItemAttachData,e.active_=!1,e.is_backup_=!1,e.crush_mark_=0,e.next_chess_=null,e.attr_=null,null!=a&&(e.attr_=c.tableManager.ChessPropertiesTable()[a],e.InitWithAttr(),c.moduleManager.module_types_[a].newChessCount++),e}return a(E,n),r(E,[{key:"copyDataFrom",value:function(a){this.attr_=a.attr_,this.color_=a.color_,this.attach_.copyDataFrom(a.attach_),this.active_=a.active_,this.crush_mark_=a.crush_mark_,this.next_chess_=a.next_chess_}},{key:"PreInit",value:function(a){this.color_=i.MovingItemType.MIT_NONE,this.node_=null,this.active_=!1,this.is_backup_=!1,this.crush_mark_=0,this.next_chess_=null,this.attr_=c.tableManager.ChessPropertiesTable()[a],this.InitWithAttr()}},{key:"Release",value:function(){c.moduleManager.module_types_[this.Type()].RecycleChess(this)}},{key:"Backup",value:function(){var a=c.moduleManager.NewChess(this.attr_.ChessType,!0);return a.copyDataFrom(this),a}},{key:"Restore",value:function(a){this.copyDataFrom(a)}},{key:"SetActive",value:function(a){this.active_=a}},{key:"Active",value:function(){return this.active_}},{key:"OnCreate",value:function(){}},{key:"OnSlide",value:function(){}},{key:"OnDestroy",value:function(){}},{key:"OnDrop",value:function(){}},{key:"OnGenerated",value:function(){}},{key:"Remove",value:function(){this.GetNode().RemoveChess(this)}},{key:"ToChessData",value:function(){var a=new l.ChessData;a.layer=this.attr_.Layer,a.type=this.Type(),a.color=this.Color();var e=this.GetNode().GetPosition();return a.pos.row=e.row,a.pos.col=e.col,this.Type()==l.ChessType.CT_STEPBONUS&&(a.step_bonus_data.step_bonus=this.GetNode().GetStepBonus()),a}},{key:"GetEmptyChessData",value:function(){var a=new l.ChessData,e=this.GetNode().GetPosition();return a.pos.row=e.row,a.pos.col=e.col,a}},{key:"Init",value:function(a){a&&this.attach_.copyDataFrom(a),this.Type()==l.ChessType.CT_STEPBONUS&&this.GetNode().SetStepBonus(this.attach_.iVal1),this.active_=!0}},{key:"NextType",value:function(){return this.Attribute().NextType}},{key:"GetAttach",value:function(){return this.attach_}},{key:"SetAttach",value:function(a){a&&this.attach_.copyDataFrom(a)}},{key:"Attribute",value:function(){return this.attr_}},{key:"GiftChessCrush",value:function(){var e=this.attr_;return e.ChessType==l.ChessType.CT_GIFT}},{key:"ActiveChessBuffer",value:function(){var e=(!(1<arguments.length&&void 0!==arguments[1])||arguments[1],!1),t=c.stageManager,n=c.envManager;switch(this.attr_.ChessType){case l.ChessType.CT_STEPBONUS:var o=this.attach_.iVal1;c.stageManager.AddMaxStep(o),c.stageManager.addStep(o),c.aniManager.GenerateItemStepAnimation({step:o});break;case l.ChessType.CT_SodaBottle:if(t.IsSodaGame()){var _=n.GetSodaLine()-1;n.SetSodaLine(0>_?0:_),c.dataCollector.addSodaBubbleNum()}}return e}},{key:"Crush",value:function(a){return!!this.ActiveChessBuffer(a.batch.m_self_batch_index)||(this.CreateNextChess(),this.CreateChangeAnim(a),!0)}},{key:"CanCrush",value:function(a){var e=this.attr_;if(e.crush_rule==l.CrushRule.kCrushNone)return!1;if(0<this.CrushMark()||this.CrushMark()==a.join)return!1;if(!this.ValidAttack(a))return!1;var t=e.Layer+1;return t>=l.ChessLayer.kChessLayerNum||null==this.node_.GetChess(t)}},{key:"CrushMark",value:function(){return this.crush_mark_}},{key:"SetCrushMark",value:function(a){this.crush_mark_=a}},{key:"ToChangedData",value:function(){var a=this.ToChessData(),e=_.clone(a);return e.type=this.NextType(),[a,e]}},{key:"CreateChangeAnim",value:function(a){switch(a.batch.m_self_batch_index,this.attr_.ChessType){case l.ChessType.STIT_STONECLOUD1:c.dataCollector.addCrushChess(this.ToChessData());break;case l.ChessType.STIT_STONECLOUD2:c.dataCollector.addChangedChess(this.ToChangedData());break;case l.ChessType.CT_CLODS0:c.dataCollector.addCrushChess(this.ToChessData());break;case l.ChessType.STIT_LITTLEMUSHROOM:c.dataCollector.addCrushChess(this.ToChessData());break;case l.ChessType.CT_CLODS1:c.dataCollector.addChangedChess(this.ToChangedData());break;case l.ChessType.CT_NormalUnit:case l.ChessType.STIT_BOX:case l.ChessType.CT_Chameleon:case l.ChessType.CT_STEPBONUS:case l.ChessType.CT_TICKBOMB:case l.ChessType.CT_SodaBottle:c.dataCollector.addCrushChess(this.ToChessData());break;case l.ChessType.STIT_CANDYPAPER1:case l.ChessType.STIT_CAGE:c.dataCollector.addCrushTopChess(this.ToChessData());break;case l.ChessType.STIT_CANDYPAPER2:case l.ChessType.STIT_CANDYPAPER3:case l.ChessType.STIT_CANDYPAPER4:case l.ChessType.STIT_CANDYPAPER5:case l.ChessType.STIT_CAGE2:c.dataCollector.addChangedTopChess(this.ToChangedData());break;case l.ChessType.STIT_BOX_TWO:case l.ChessType.STIT_BOX_THREE:case l.ChessType.STIT_BOX_FOUR:c.dataCollector.addChangedChess(this.ToChangedData());}return 0}},{key:"IsType",value:function(a){return this.attr_.ChessType==a}},{key:"Type",value:function(){return this.attr_.ChessType}},{key:"GetNode",value:function(){return this.node_}},{key:"GetAroundNode",value:function(a){var e=this.GetPosition(),t=e.row,n=e.col;a.push(c.boardViewer.GetNode(new i.GridPosition(t-1,n))),a.push(c.boardViewer.GetNode(new i.GridPosition(t+1,n))),a.push(c.boardViewer.GetNode(new i.GridPosition(t,n-1))),a.push(c.boardViewer.GetNode(new i.GridPosition(t,n+1)))}},{key:"SetNode",value:function(a){this.node_=a}},{key:"Color",value:function(){return this.color_}},{key:"SetColor",value:function(a){this.attr_.CanChangeColor&&(this.color!=i.MovingItemType.MIT_RANDOM||this.attr_.CanChangeColor)&&(this.color_=a)}},{key:"GetPosition",value:function(){return this.node_.GetPosition()}},{key:"NextChess",value:function(){return this.next_chess_}},{key:"SetNextChess",value:function(a){this.next_chess_=a}},{key:"GetBoard",value:function(){return c.curBoard}},{key:"GetEventManager",value:function(){return c.envManager}},{key:"AddEventListener",value:function(a,e){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,n=this.GetBoard();return null!=n&&c.eventManager.AddEventListener(a,e,t)}},{key:"RemoveListener",value:function(a){c.eventManager.RemoveListener(a)}},{key:"RemoveSelf",value:function(){var a=this.node_;a&&a.RemoveChess(this.Type())}},{key:"BreakBalance",value:function(){var a=this.GetBoard();a&&a.BreakBalance()}},{key:"GetNodeAdapter",value:function(){return this.GetNode().adapter()}},{key:"ValidAttack",value:function(a){if(a.around_attack)return!!this.Attribute().CanBeAroundCrushed;for(var e=this.attr_.attack_type,t=e.length,n=0;n<t;n++)if(a.attack_type==e[n])return!0;return!1}},{key:"SetAttribute",value:function(a){var e=this.attr_.ChessType;this.attr_=_.clone(a),this.InitWithAttr(),this.node_.ClearChessTypeBit(e),this.node_.SetChessTypeBit(this.attr_.ChessType)}},{key:"CreateNextChess",value:function(){if(this.NextType()!=l.ChessType.STIT_NONE){var a=this.node_.AllocChessType(this.NextType(),this.attach_,this.Color(),!1);a&&this.SetNextChess(a)}}},{key:"InitWithAttr",value:function(){this.attr_.hasOwnProperty("Color")&&(this.color_=this.attr_.Color)}}]),E}(s.ChessInterface),y=function(_){function s(a,e){I(this,s);var t=o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,a));return t.key_=-1,t.em_=null,t.events_=-1,t.RemoveFromEventQueue(),t.event_priority_=e,t}return a(s,_),r(s,[{key:"PreInit",value:function(a){n(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"PreInit",this).call(this,a)}},{key:"Release",value:function(){}},{key:"copyData",value:function(a){this.copyDataFrom(a),this.event_priority_=a.event_priority_}},{key:"Init",value:function(a){n(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"Init",this).call(this,a),this.AddEventListener(this,this.event_priority_)}},{key:"OnDestroy",value:function(){}},{key:"Backup",value:function(){var a=n(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"Backup",this).call(this);return a.event_priority_=this.event_priority_,a}},{key:"Restore",value:function(a){n(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"Restore",this).call(this,a),this.event_priority_=a.event_priority_}},{key:"GetActiver",value:function(){return this}},{key:"RemoveFromEventQueue",value:function(){this.em_&&this.em_.RemoveListener(this)}},{key:"OnEvent",value:function(){}},{key:"RequestEvent",value:function(a){this.events_=a}},{key:"events",value:function(){return this.events_}},{key:"Release",value:function(){}}]),s}(E),S=function(_){function s(){I(this,s);var a=o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return a.pass_contidition_to_chess_map_={},a}return a(s,_),r(s,[{key:"Init",value:function(a){return n(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"Init",this).call(this,a),this.RegisterChess(l.ChessType.STIT_CANDYPAPER5),this.RegisterChess(l.ChessType.STIT_CANDYPAPER4),this.RegisterChess(l.ChessType.STIT_CANDYPAPER3),this.RegisterChess(l.ChessType.STIT_CANDYPAPER2),this.RegisterChess(l.ChessType.STIT_CANDYPAPER1),this.RegisterChess(l.ChessType.STIT_CAGE),this.RegisterChess(l.ChessType.STIT_CAGE2),this.RegisterChess(l.ChessType.STIT_COMMONCLOUD2),this.RegisterChess(l.ChessType.STIT_COMMONCLOUD1),this.RegisterChess(l.ChessType.STIT_STONECLOUD1),this.RegisterChess(l.ChessType.STIT_STONECLOUD2),this.RegisterChess(l.ChessType.STIT_BOX),this.RegisterChess(l.ChessType.STIT_BOX_TWO),this.RegisterChess(l.ChessType.STIT_BOX_THREE),this.RegisterChess(l.ChessType.STIT_BOX_FOUR),this.RegisterChess(l.ChessType.STIT_COLLECT_UNDER_ICE),this.RegisterChess(l.ChessType.STIT_COLLECT_POINT_IN_SODA),this.RegisterChess(l.ChessType.STIT_COLLECT_POINT_IN_SODA_LEFT),this.RegisterChess(l.ChessType.STIT_COLLECT_POINT_IN_SODA_RIGHT),this.RegisterChess(l.ChessType.STIT_COLLECT_POINT_IN_SODA_BOTH),this.RegisterChess(l.ChessType.STIT_COLLECTBALLOON_POINT),this.RegisterChess(l.ChessType.STIT_COLLECTCANDY_POINT),this.RegisterChess(l.ChessType.STIT_FENCE_BOTTOM),this.RegisterChess(l.ChessType.STIT_FENCE_RIGHT),this.RegisterChess(l.ChessType.STIT_NOUSE),this.RegisterChess(l.ChessType.STIT_BLUEBERRY),this.RegisterChess(l.ChessType.STIT_BAD_BLUEBERRY),this.RegisterChess(l.ChessType.CT_NormalUnit),this.RegisterChess(l.ChessType.CT_COLLECTBALLOON),this.RegisterChess(l.ChessType.CT_CLODS0),this.RegisterChess(l.ChessType.CT_CLODS1),this.RegisterChess(l.ChessType.CT_STEPBONUS),this.RegisterChess(l.ChessType.CT_SodaBottle),this.isUsePool=!0,this.isUsePool&&this.PreAllocChess(150,function(){return new E(null)}),!0}},{key:"NewChess",value:function(a){var e=null;return this.isUsePool?(e=this.GetChessFromPool(),e?e.PreInit(a):e=new E(a)):e=new E(a),e}}]),s}(u);T.exports={BasicChess:E,BasicEventChess:y,BasicModule:S}},function(M,e,t){"use strict";function R(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==typeof o||"function"==typeof o)?o:a}function o(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}function a(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function n(a,e){var t=d.boardViewer.GetNode(a,e);return null!=t&&t.HasChessType(C.ChessType.STIT_DEEPICE)}function r(a,e){var t=d.boardViewer.GetNode(a,e);return null!=t&&t.HasChessType(C.ChessType.STIT_ICE_BEAR_UNDER)}function s(a,e){var t=d.boardViewer.GetNode(a,e);return null!=t&&t.HasChessType(C.ChessType.STIT_ICE)}function _(a,e){return r(a,e)||s(a,e)}function P(a,e){return _(a,e)||n(a,e)}function i(a,e){return a.iType>e.iType?-1:1}var l=function _(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:_(a,t,n)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(n)},c=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),E=E||t(38),C=C||t(12),p=p||t(11),g=g||t(17),d=d||t(13),T=T||t(33),I=I||t(23),u=u||t(24),G=function(){function t(){a(this,t),this.iBiggestType=g.IceCollectType.None,this.m_BeginGridPos=new g.GridPosition,this.m_EndGridPos=new g.GridPosition,this.iRowCount=0,this.iColCount=0}return c(t,[{key:"copyDataFrom",value:function(a){this.iBiggestType=a.iBiggestType,this.m_BeginGridPos.row=a.m_BeginGridPos.row,this.m_BeginGridPos.col=a.m_BeginGridPos.col,this.m_EndGridPos.row=a.m_EndGridPos.row,this.m_EndGridPos.col=a.m_EndGridPos.col,this.iRowCount=a.iRowCount,this.iColCount=a.iColCount}}]),t}(),y=function t(){a(this,t),this.iType=g.IceCollectType.None,this.StartRow=-1,this.StartCol=-1,this.bHorizontal=!1,this.bShow=!1,this.iCount=0},D={Direction_None:0,Direction_Left:1,Direction_UpLeft:2,Direction_Up:3,Direction_UpRight:4,Direction_Right:5,Direction_RightDown:6,Direction_Down:7,Direction_DownLeft:8},S=function(){function t(){a(this,t),this.m_VecCollectUnderIce=[],this.m_pPuzzleChessBoard=null,this.m_IceArea=[]}return c(t,null,[{key:"GetInstance",value:function(){return t._instance||(t._instance=new t),t._instance}}]),c(t,[{key:"ClearData",value:function(){this.m_VecCollectUnderIce=[]}},{key:"Initialize",value:function(e){for(var n=[p.DESC_TYPE.DESC_ICE_BEAR_LITTLE_NUM,p.DESC_TYPE.DESC_ICE_BEAR_MIDDLE_NUM,p.DESC_TYPE.DESC_ICE_BEAR_BIG_NUM],o=[g.IceCollectType.One_And_Two,g.IceCollectType.Two_And_Three,g.IceCollectType.Three_And_Five],a=0;a<3;a++)for(var r=d.stageManager.GetDescValue(n[a]),i=0,s;i<r;i++)s=new y,s.iType=o[a],t.GetInstance().PushCollectUnderIce(s);this.m_pPuzzleChessBoard=e}},{key:"PushCollectUnderIce",value:function(a){this.m_VecCollectUnderIce.push(a)}},{key:"SortCollectUnderIce",value:function(){this.m_VecCollectUnderIce.sort(i)}},{key:"GetCollectUnderIceCount",value:function(){return this.m_VecCollectUnderIce.length}},{key:"GetCollectUnderIce",value:function(a){return a>this.m_VecCollectUnderIce.length-1?null:this.m_VecCollectUnderIce[a]}},{key:"SetCollectUnderIceValue",value:function(_,e,t,n){if(!(_>this.m_VecCollectUnderIce.length-1)){var o=this.m_VecCollectUnderIce[_];o.StartRow=e,o.StartCol=t,o.bHorizontal=n}}},{key:"AddAllCollectUnderIce",value:function(){for(var a=this.m_VecCollectUnderIce.length,e=0,t;e<a;e++)t=this.m_VecCollectUnderIce[e],this.AddCollectUnderIce(t)}},{key:"CollectUnderIceThing",value:function(n,e){for(var t=this.m_VecCollectUnderIce.length,o=0;o<t;o++){var a=this.m_VecCollectUnderIce[o],_=new g.Ref_Adapter(-1),r=new g.Ref_Adapter(-1);this.GetCollectUnderIceHeightAndWidth(a.iType,a.bHorizontal,_,r),n>=a.StartRow&&e>=a.StartCol&&n<=a.StartRow+(_.val-1)&&e<=a.StartCol+(r.val-1)&&(a.iCount--,0==a.iCount&&(d.aniManager.GenerateCollectIceBearAni(o),d.passConditionManager.specialCollect(C.ChessType.STIT_COLLECT_UNDER_ICE,1)))}}},{key:"ShowCollectUnderIceThing",value:function(E,e,t,n,o,a){for(var r=this.m_VecCollectUnderIce.length,i=0;i<r;i++){var s=this.m_VecCollectUnderIce[i],_=new g.Ref_Adapter(-1),l=new g.Ref_Adapter(-1);if(this.GetCollectUnderIceHeightAndWidth(s.iType,s.bHorizontal,_,l),0<=s.StartRow&&0<=s.StartCol&&!s.bShow&&E>=s.StartRow&&e>=s.StartCol&&E<=s.StartRow+(_.val-1)&&e<=s.StartCol+(l.val-1))return s.bShow=!0,t.val=s.StartRow,n.val=s.StartCol,a.val=s.iType,o.val=s.bHorizontal,!0}return!1}},{key:"ReSetAllCollectUnderIceThing",value:function(){for(var a=this.m_VecCollectUnderIce.length,e=0,t;e<a;e++)t=this.m_VecCollectUnderIce[e],t.bShow=!1,t.iCount=0}},{key:"GetCollectUnderIceHeightAndWidth",value:function(a,e,t,n){a===g.IceCollectType.One_And_Two?e?(t.val=1,n.val=2):(t.val=2,n.val=1):a===g.IceCollectType.Two_And_Three?e?(t.val=2,n.val=3):(t.val=3,n.val=2):a===g.IceCollectType.Three_And_Five?e?(t.val=3,n.val=5):(t.val=5,n.val=3):void 0}},{key:"InsertCollectUnderIceThing",value:function(_,e){for(var t=this.m_VecCollectUnderIce.length,n=0;n<t;n++){var o=this.m_VecCollectUnderIce[n],a=new g.Ref_Adapter(-1),r=new g.Ref_Adapter(-1);this.GetCollectUnderIceHeightAndWidth(o.iType,o.bHorizontal,a,r),_>=o.StartRow&&e>=o.StartCol&&_<=o.StartRow+(a.val-1)&&e<=o.StartCol+(r.val-1)&&o.iCount++}}},{key:"AgainStatisticsIceBearData",value:function(){for(var _=d.boardViewer.Row(),e=d.boardViewer.Col(),t=0;t<_;t++)for(var n=0,o;n<e;n++)o=d.boardViewer.GetNode(t,n),o.IsStaticItemCollectUnderIce()&&this.InsertCollectUnderIceThing(t,n)}},{key:"AddCollectUnderIce",value:function(s){var e=new g.Ref_Adapter(0),t=new g.Ref_Adapter(0);if(this.GetCollectUnderIceHeightAndWidth(s.iType,s.bHorizontal,e,t),!(0>s.StartRow||0>s.StartCol))for(var n=0;n<e.val;n++)for(var o=0;o<t.val;o++){var a=new g.GridPosition(n+s.StartRow,o+s.StartCol),r=d.boardViewer.GetNode(a);null!=r&&(r.HasChessType(C.ChessType.STIT_COLLECT_UNDER_ICE)||r.AddChess(C.ChessType.STIT_COLLECT_UNDER_ICE),_(n+s.StartRow,o+s.StartCol)&&(r.RemoveChess(C.ChessType.STIT_ICE),r.AddChess(C.ChessType.STIT_ICE_BEAR_UNDER)))}}},{key:"FindAllIceArea",value:function(){this.m_IceArea=[];for(var E=[],e=d.boardViewer.Row(),t=d.boardViewer.Col(),n=0;n<e;n++)for(var o=0;o<t;o++)if(P(n,o)){var a=new g.GridPosition(n,o);E.push(a)}do{var r=this.FindGreatestIceArea(E);0<=r.iColCount&&0<=r.iRowCount&&this.m_IceArea.push(r);for(var i=0;i<E.length;){for(var s=!1,_=E[i],l=0,C;l<this.m_IceArea.length;l++)if(C=this.m_IceArea[l],_.row>=C.m_BeginGridPos.row&&_.col>=C.m_BeginGridPos.col&&_.row<=C.m_EndGridPos.row&&_.col<=C.m_EndGridPos.col){s=!0;break}s?E.splice(i,1):i++}}while(0<E.length)}},{key:"PushAllCollectUnderIceArea",value:function(){for(var E=[],e=0;e<this.m_IceArea.length;e++){var t=this.m_IceArea[e],n=[];n.push(t),E.push(n)}for(var o=this.GetCollectUnderIceCount(),e=0;e<o;e++){var a=this.GetCollectUnderIce(e),r=0,i=0;a.iType==g.IceCollectType.Three_And_Five?(r=3,i=5):a.iType==g.IceCollectType.Two_And_Three?(r=2,i=3):a.iType==g.IceCollectType.One_And_Two&&(r=1,i=2);var s=new g.Ref_Adapter(0),_=new g.Ref_Adapter(-1),l=new g.Ref_Adapter(-1),C=new g.Ref_Adapter(!1);this.PushCollectUnderIceArea(r,i,s,l,_,C,E)&&this.SetCollectUnderIceValue(e,l.val,_.val,C.val)}return!0}},{key:"RandomSetCollectUnderIceArea",value:function(){for(var E=[],e=d.boardViewer.Row(),t=d.boardViewer.Col(),n=0;n<e;n++)for(var o=0;o<t;o++)if(P(n,o)){var a=new g.GridPosition(n,o);E.push(a)}for(var r=this.GetCollectUnderIceCount(),i=0;i<r;i++){var s=new g.Ref_Adapter(0),_=new g.Ref_Adapter(0),l=this.GetCollectUnderIce(i);this.GetCollectUnderIceHeightAndWidth(l.iType,l.bHorizontal,s,_);for(var n=0;n<s.val;n++)for(var o=0;o<_.val;o++)this.ClearGridInCollectUnderIce(E,l)}for(var i=0;i<r;i++){var l=this.GetCollectUnderIce(i),C=I.clone(l);this.AddGridInCollectUnderIce(E,l),this.RandomSetPosition(E,C)&&(0>C.StartRow||0>C.StartCol,this.ClearGridInCollectUnderIce(E,C),this.SetCollectUnderIceValue(i,C.StartRow,C.StartCol,C.bHorizontal))}return!0}},{key:"FindGreatestIceArea",value:function(_){for(var e=new G,t=!0,n=_.length,o=0;o<n;o++){var a=_[o],r=new G;this.FindMaxArea(_,a.row,a.col,r),t?(e.copyDataFrom(r),t=!1):e.iColCount*e.iRowCount<r.iRowCount*r.iColCount&&1!=r.iRowCount&&1!=r.iColCount&&e.copyDataFrom(r)}return e}},{key:"FindMaxArea",value:function(T,e,t,n){var o=[new g.GridPosition(e,t)],a={};a[D.Direction_Left]=!0,a[D.Direction_Up]=!0,a[D.Direction_Right]=!0,a[D.Direction_Down]=!0,a[D.Direction_UpLeft]=!0,a[D.Direction_UpRight]=!0,a[D.Direction_RightDown]=!0,a[D.Direction_DownLeft]=!0;var r=[],i=[],s=[],_=[],l=[],c=[],u=[],E=[];r.push(new g.GridPosition(e,t)),i.push(new g.GridPosition(e,t)),s.push(new g.GridPosition(e,t)),_.push(new g.GridPosition(e,t));var C=-1;if(!P(e,t))return!1;var p=new g.Ref_Adapter(e),d=new g.Ref_Adapter(t),I=new g.Ref_Adapter(t),y=new g.Ref_Adapter(e);do{if(l=[],c=[],u=[],E=[],a[D.Direction_Left])for(var S=r.length,N=0,h=0,O;h<S;h++){if(O=r[h],!this.LeftFind(T,O.row,O.col)){a[D.Direction_DownLeft]=!1,a[D.Direction_Left]=!1,this.ClearCol(l,O.col-1),C=O.col-1;break}a[D.Direction_Left]&&l.push(new g.GridPosition(O.row,O.col-1)),N==r.length-1&&a[D.Direction_UpLeft]&&(this.IsIceCanUse(T,O.row-1,O.col-1)?(l.push(new g.GridPosition(O.row-1,O.col-1)),c.unshift(new g.GridPosition(O.row-1,O.col-1))):(a[D.Direction_UpLeft]=!1,a[D.Direction_Up]=!1)),N++}if(a[D.Direction_Up])for(var S=i.length,N=0,h=0,O;h<S;h++){if(O=i[h],!this.UpFind(T,O.row,O.col)){a[D.Direction_UpLeft]=!1,a[D.Direction_Up]=!1,this.ClearRow(c,O.row-1),this.ClearRow(l,O.row-1);break}a[D.Direction_Up]&&c.push(new g.GridPosition(O.row-1,O.col)),N==i.length-1&&a[D.Direction_UpRight]&&(this.IsIceCanUse(T,O.row-1,O.col+1)?(c.push(new g.GridPosition(O.row-1,O.col+1)),u.unshift(new g.GridPosition(O.row-1,O.col+1))):(a[D.Direction_UpRight]=!1,a[D.Direction_Right]=!1)),N++}if(a[D.Direction_Right])for(var S=s.length,N=0,h=0,O;h<S;h++){if(O=s[h],!this.RightFind(T,O.row,O.col)){a[D.Direction_UpRight]=!1,a[D.Direction_Right]=!1,this.ClearCol(u,O.col+1),this.ClearCol(c,O.col+1);break}a[D.Direction_Right]&&u.push(new g.GridPosition(O.row,O.col+1)),N==s.length-1&&a[D.Direction_RightDown]&&(this.IsIceCanUse(T,O.row+1,O.col+1)?(u.push(new g.GridPosition(O.row+1,O.col+1)),E.unshift(new g.GridPosition(O.row+1,O.col+1))):(a[D.Direction_RightDown]=!1,a[D.Direction_Down]=!1)),N++}if(a[D.Direction_Down])for(var S=_.length,N=0,h=0,O;h<S;h++){if(O=_[h],!this.DownFind(T,O.row,O.col)){a[D.Direction_RightDown]=!1,a[D.Direction_Down]=!1,this.ClearRow(E,O.row+1),this.ClearRow(u,O.row+1);break}a[D.Direction_Down]&&E.push(new g.GridPosition(O.row+1,O.col)),N==_.length-1&&a[D.Direction_DownLeft]&&(this.IsIceCanUse(T,O.row+1,O.col-1)?(l.unshift(new g.GridPosition(O.row+1,O.col-1)),E.push(new g.GridPosition(O.row+1,O.col-1))):(a[D.Direction_DownLeft]=!1,a[D.Direction_Left]=!1,this.ClearCol(l,O.col-1),this.ClearCol(c,O.col-1)),-1!=C&&(this.ClearCol(l,C),this.ClearCol(E,C))),N++}if(0<l.length||0<c.length||0<u.length||0<E.length){r=[],i=[],s=[],_=[];for(var L=null,h=0;h<l.length;h++)L=l[h],r.push(L);for(var h=0;h<c.length;h++)L=c[h],i.push(L);for(var h=0;h<u.length;h++)L=u[h],s.push(L);for(var h=0;h<E.length;h++)L=E[h],_.push(L);this.FindRect(o,p,d,y,I),this.FindRect(r,p,d,y,I),this.FindRect(i,p,d,y,I),this.FindRect(s,p,d,y,I),this.FindRect(_,p,d,y,I)}}while(a[D.Direction_Left]||a[D.Direction_Up]||a[D.Direction_Right]||a[D.Direction_Down]);var m=new G;return m.iColCount=I.val-d.val+1,m.iRowCount=y.val-p.val+1,m.m_BeginGridPos.row=p.val,m.m_BeginGridPos.col=d.val,m.m_EndGridPos.row=y.val,m.m_EndGridPos.col=I.val,m.iBiggestType=3<=m.iColCount&&5<=m.iRowCount||3<=m.iRowCount&&5<=m.iColCount?g.IceCollectType.Three_And_Five:2<=m.iColCount&&3<=m.iRowCount||2<=m.iRowCount&&3<=m.iColCount?g.IceCollectType.Two_And_Three:1<=m.iColCount&&2<=m.iRowCount||1<=m.iRowCount&&2<=m.iColCount?g.IceCollectType.One_And_Two:g.IceCollectType.None,n.copyDataFrom(m),!0}},{key:"ClearRow",value:function(a,e){for(var t=0,n;t<a.length;)n=a[t],n.row==e?a.splice(t,1):t++}},{key:"ClearCol",value:function(a,e){for(var t=0,n;t<a.length;)n=a[t],n.col==e?a.splice(t,1):t++}},{key:"LeftFind",value:function(a,e,t){return!(0>t-1)&&this.IsIceCanUse(a,e,t-1)}},{key:"UpFind",value:function(a,e,t){return!(0>e-1)&&this.IsIceCanUse(a,e-1,t)}},{key:"RightFind",value:function(a,e,t){return!(t+1>d.boardViewer.Col())&&this.IsIceCanUse(a,e,t+1)}},{key:"DownFind",value:function(a,e,t){return!(e+1>d.boardViewer.Row())&&this.IsIceCanUse(a,e+1,t)}},{key:"IsIceCanUse",value:function(_,e,t){if(0>e||0>t||t>d.boardViewer.Col()||e>d.boardViewer.Row())return!1;for(var n=!1,s=_.length,a=0,r;a<s;a++)if(r=_[a],r.row==e&&r.col==t){n=!0;break}return!!n&&!!P(e,t)}},{key:"ClearGridInCollectUnderIce",value:function(_,e){for(var t=0;t<_.length;){var n=_[t],o=new g.Ref_Adapter(0),a=new g.Ref_Adapter(0);this.GetCollectUnderIceHeightAndWidth(e.iType,e.bHorizontal,o,a),n.row>=e.StartRow&&n.col>=e.StartCol&&n.row<=e.StartRow+(o.val-1)&&n.col<=e.StartCol+(a.val-1)?_.splice(t,1):t++}}},{key:"PushCollectUnderIceArea",value:function(C,e,t,n,o,a,r){var i=!1,d=0,_=0;for(_=0;_<r.length;_++){for(var l=0;l<r[_].length&&(r[_][l].iRowCount>r[_][l].iColCount?r[_][l].iColCount>=e?(a.val=!0,t.val=_,n.val=r[_][l].m_BeginGridPos.row,o.val=r[_][l].m_BeginGridPos.col,i=!0,d=l):r[_][l].iColCount>=C&&r[_][l].iRowCount>=e&&(a.val=!1,t.val=_,n.val=r[_][l].m_BeginGridPos.row,o.val=r[_][l].m_BeginGridPos.col,i=!0,d=l):r[_][l].iRowCount>=e?(a.val=!1,t.val=_,n.val=r[_][l].m_BeginGridPos.row,o.val=r[_][l].m_BeginGridPos.col,i=!0,d=l):r[_][l].iColCount>=e&&r[_][l].iRowCount>=C&&(a.val=!0,t.val=_,n.val=r[_][l].m_BeginGridPos.row,o.val=r[_][l].m_BeginGridPos.col,i=!0,d=l),!i);l++);if(i)break}if(i){var p=new G,T=new G,I=r[_][d];r[_].splice(d,1),a.val&&(I.iColCount-e)*I.iRowCount>(I.iRowCount-C)*I.iColCount?(p.iColCount=I.iColCount-e,p.iRowCount=I.iRowCount,p.m_BeginGridPos.col=I.m_BeginGridPos.col+e,p.m_BeginGridPos.row=I.m_BeginGridPos.row,p.m_EndGridPos.col=I.m_EndGridPos.col,p.m_EndGridPos.row=I.m_EndGridPos.row,T.iColCount=e,T.iRowCount=I.iRowCount-C,T.m_BeginGridPos.col=I.m_BeginGridPos.col,T.m_BeginGridPos.row=I.m_BeginGridPos.row+C,T.m_EndGridPos.col=I.m_BeginGridPos.col+e,T.m_EndGridPos.row=I.m_EndGridPos.row):a.val&&(I.iColCount-e)*I.iRowCount<=(I.iRowCount-C)*I.iColCount?(T.iColCount=I.iColCount-e,T.iRowCount=C,T.m_BeginGridPos.col=I.m_BeginGridPos.col+e,T.m_BeginGridPos.row=I.m_BeginGridPos.row,T.m_EndGridPos.col=I.m_EndGridPos.col,T.m_EndGridPos.row=I.m_BeginGridPos.row+C,p.iColCount=I.iColCount,p.iRowCount=I.iRowCount-C,p.m_BeginGridPos.col=I.m_BeginGridPos.col,p.m_BeginGridPos.row=I.m_BeginGridPos.row+C,p.m_EndGridPos.col=I.m_EndGridPos.col,p.m_EndGridPos.row=I.m_EndGridPos.row):!a.val&&(I.iColCount-C)*I.iRowCount<=(I.iRowCount-e)*I.iColCount?(T.iColCount=I.iColCount-C,T.iRowCount=e,T.m_BeginGridPos.col=I.m_BeginGridPos.col+C,T.m_BeginGridPos.row=I.m_BeginGridPos.row,T.m_EndGridPos.col=I.m_EndGridPos.col,T.m_EndGridPos.row=I.m_BeginGridPos.row+e,p.iColCount=I.iColCount,p.iRowCount=I.iRowCount-e,p.m_BeginGridPos.col=I.m_BeginGridPos.col,p.m_BeginGridPos.row=I.m_BeginGridPos.row+e,p.m_EndGridPos.col=I.m_EndGridPos.col,p.m_EndGridPos.row=I.m_EndGridPos.row):!a.val&&(I.iColCount-C)*I.iRowCount>(I.iRowCount-e)*I.iColCount&&(p.iColCount=I.iColCount-C,p.iRowCount=I.iRowCount,p.m_BeginGridPos.col=I.m_BeginGridPos.col+C,p.m_BeginGridPos.row=I.m_BeginGridPos.row,p.m_EndGridPos.col=I.m_EndGridPos.col,p.m_EndGridPos.row=I.m_EndGridPos.row,T.iColCount=C,T.iRowCount=I.iRowCount-e,T.m_BeginGridPos.col=I.m_BeginGridPos.col,T.m_BeginGridPos.row=I.m_BeginGridPos.row+e,T.m_EndGridPos.col=I.m_BeginGridPos.col+C,T.m_EndGridPos.row=I.m_EndGridPos.row),(1<p.iColCount&&0<p.iRowCount||1<p.iRowCount&&0<p.iColCount)&&r[_].push(p),(1<T.iColCount&&0<T.iRowCount||1<T.iRowCount&&0<T.iColCount)&&r[_].push(T)}return i}},{key:"AddGridInCollectUnderIce",value:function(_,e){var t=new g.Ref_Adapter(0),n=new g.Ref_Adapter(0);this.GetCollectUnderIceHeightAndWidth(e.iType,e.bHorizontal,t,n);for(var o=0;o<t.val;o++)for(var a=0;a<n.val;a++)_.push(new g.GridPosition(e.StartRow+o,e.StartCol+a))}},{key:"RandomSetPosition",value:function(l,e){var t=[];I.arrayDeepCopy(t,l);do{var n=u.PuzzleRand("ib(645)")%t.length,a=t[n],r=new g.Ref_Adapter(0),i=new g.Ref_Adapter(0),s=u.PuzzleRand("ib(650)")%2,_;if(_=1!=s,this.GetCollectUnderIceHeightAndWidth(e.iType,_,r,i),this.CanSetCollectUnderIce(l,a,r.val,i.val))return e.StartRow=a.row,e.StartCol=a.col,e.bHorizontal=_,!0;if(this.GetCollectUnderIceHeightAndWidth(e.iType,!_,r,i),this.CanSetCollectUnderIce(l,a,r.val,i.val))return e.StartRow=a.row,e.StartCol=a.col,e.bHorizontal=!_,!0;t.splice(n,1)}while(0<t.length);return!1}},{key:"CanSetCollectUnderIce",value:function(E,e,t,n){for(var o=0;o<t;o++)for(var a=0,r;a<n;a++){r=new g.GridPosition,r.row=e.row+o,r.col=e.col+a;for(var i=E.length,s=!1,C=0,l;C<i;C++)l=E[C],r.isEqual(l)&&(s=!0);if(!s)return!1}return!0}},{key:"FindRect",value:function(_,e,t,n,o){for(var a=_.length,r=0,i;r<a;r++)i=_[r],e.val>i.row&&(e.val=i.row),t.val>i.col&&(t.val=i.col),n.val<i.row&&(n.val=i.row),o.val<i.col&&(o.val=i.col);return!0}}]),t}(),N=function(n){function _(){return a(this,_),R(this,(_.__proto__||Object.getPrototypeOf(_)).call(this))}return o(_,n),c(_,[{key:"Init",value:function(a){return l(_.prototype.__proto__||Object.getPrototypeOf(_.prototype),"Init",this).call(this,a),d.eventManager.AddEventListener(new h(d.curBoard),T.EventPri.kEventPriIceBear,T.EventKey.kEventKeyIceBear),!0}},{key:"Release",value:function(){d.eventManager.RemoveListener(T.EventKey.kEventKeyIceBear),l(_.prototype.__proto__||Object.getPrototypeOf(_.prototype),"Release",this).call(this)}},{key:"NewChess",value:function(){return null}}],[{key:"InitializeIceBearSite",value:function(){S.GetInstance().ClearData(),S.GetInstance().Initialize(d.curBoard),S.GetInstance().FindAllIceArea(),S.GetInstance().SortCollectUnderIce(),S.GetInstance().PushAllCollectUnderIceArea(),S.GetInstance().RandomSetCollectUnderIceArea(),S.GetInstance().AddAllCollectUnderIce()}}]),_}(E),h=function(n){function e(){a(this,e);var t=R(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.RequestEvent(T.PuzzleEvent.kEventGameStart|T.PuzzleEvent.kEventRollback|T.PuzzleEvent.kEventRespawn),t}return o(e,n),c(e,[{key:"Release",value:function(){delete this}},{key:"OnEvent",value:function(a){switch(a.event_id){case T.PuzzleEvent.kEventGameStart:N.InitializeIceBearSite();break;case T.PuzzleEvent.kEventRollback:case T.PuzzleEvent.kEventRespawn:S.GetInstance().ReSetAllCollectUnderIceThing(),S.GetInstance().AgainStatisticsIceBearData();}}}]),e}(T.BoardEventListener);M.exports={IceArea:G,CollectUnderIce:y,PuzzleIceBearUtil:S,IceBearModule:N,IceBearListener:h}},function(E,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),d=d||t(17),a=a||t(31),r=r||t(13),s=s||t(12),T=T||t(24),_={DIRECTION_LEFT_TO_RIGHT:0,DIRECTION_RIGHT_TO_LEFT:1},i=function(){function a(){n(this,a),this.mSodaRow=0,this.mMaxDropRow=0,this.mDropWay=0,this.mBoardView=null,this.mDropPointCountVec=[]}return o(a,[{key:"DoDrop",value:function(a){this.DoDropByDropWay(d.DropWay.DropWay_Fall,a),this.DoDropByDropWay(d.DropWay.DropWay_Float,a)}},{key:"DoDropByDropWay",value:function(a,e){if(a==d.DropWay.DropWay_Fall||a==d.DropWay.DropWay_Float)for(this.mDropWay=a,this.mBoardView=e,this.mSodaRow=r.envManager.GetSodaLine(),this.mDropPointCountVec=[];;)if(!this.DoVerticalDrop()&&!this.DoObliqueDrop())break}},{key:"IsNodeStopCollectChess",value:function(a){var e=this.mBoardView.GetNode(a.row,a.col);if(!e||!e.IsAvailable())return!0;for(var _=[s.ChessType.STIT_CANNON,s.ChessType.STIT_STONE,s.ChessType.STIT_CANDYPOT,s.ChessType.STIT_EGG_NEST1,s.ChessType.STIT_EGG_NEST2,s.ChessType.STIT_ANIMAL_GO_HOME_NEST],n=_.length-1;0<=n;n--)if(e.HasChessType(_[n]))return!0;return!1}},{key:"IsChessEmpty",value:function(a){var e=this.mBoardView.GetNode(a.row,a.col);return e&&null==e.GetChess()}},{key:"IsDropPoint",value:function(a){return!!(this.mDropWay==d.DropWay.DropWay_Fall&&a.HasOneOf(s.ChessType.STIT_DROP_POINT)||this.mDropWay==d.DropWay.DropWay_Fall&&a.HasOneOf(s.ChessType.STIT_DROP_VALVE)||this.mDropWay==d.DropWay.DropWay_Float&&a.HasOneOf(s.ChessType.STIT_DROP_POINT_IN_SODA)||this.mDropWay==d.DropWay.DropWay_Float&&a.HasOneOf(s.ChessType.STIT_DROP_VALVE_IN_SODA))}},{key:"IsCollectObjectReach",value:function(_,e){var t=this.mBoardView.GetNode(e.row,e.col);if(!t)return!1;var r=t.HasChessType(s.ChessType.STIT_COLLECTBALLOON_POINT)||t.IsStaticItemCollectPointInSoda(),o=t.HasChessType(s.ChessType.STIT_COLLECTCANDY_POINT);return!!(_.HasChessType(s.ChessType.CT_COLLECTBALLOON)&&r||_.HasChessType(s.ChessType.STIT_SUNNYDOLL1)&&r||_.HasChessType(s.ChessType.CT_COLLECTCANDY)&&o)}},{key:"IsNodeCanDrop",value:function(a){return!!a&&!!(a.CanDrop(this.mDropWay)||a.CanDropIn(this.mDropWay,!0)||a.HasOneOf(s.ChessType.STIT_CHONGDONG1)||a.HasOneOf(s.ChessType.STIT_CHONGDONG2))}},{key:"GetDropRowStart",value:function(){var a=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],e=this.mDropWay==d.DropWay.DropWay_Fall?this.mSodaRow-1:this.mSodaRow;if(a&&this.mBoardView==r.worldViewer){var t=r.curBoard.GetStartRow(),n=t+r.boardViewer.Row()-1;this.mDropWay==d.DropWay.DropWay_Fall&&e>n?e=n:this.mDropWay==d.DropWay.DropWay_Float&&e<t&&(e=t)}return e}},{key:"GetDropRowEnd",value:function(){return this.mDropWay==d.DropWay.DropWay_Fall?-1:this.mBoardView.Row()}},{key:"GetDropRowVar",value:function(){return this.mDropWay==d.DropWay.DropWay_Fall?-1:1}},{key:"GetDropColStart",value:function(a){return a==_.DIRECTION_LEFT_TO_RIGHT?0:this.mBoardView.Col()-1}},{key:"GetDropColEnd",value:function(a){return a==_.DIRECTION_LEFT_TO_RIGHT?this.mBoardView.Col():-1}},{key:"GetDropColVar",value:function(a){return a==_.DIRECTION_LEFT_TO_RIGHT?1:-1}},{key:"GetNextDropRow",value:function(a){return this.mDropWay==d.DropWay.DropWay_Fall&&a+1<this.mSodaRow?a+1:this.mDropWay==d.DropWay.DropWay_Float&&a-1>=this.mSodaRow?a-1:-1}},{key:"SetMaxDropRow",value:function(a){this.mMaxDropRow=a}},{key:"IsUnderMaxDropRow",value:function(a){return this.mDropWay==d.DropWay.DropWay_Fall&&a<=this.mMaxDropRow||this.mDropWay==d.DropWay.DropWay_Float&&a>=this.mMaxDropRow}},{key:"DoVerticalDrop",value:function(){var r=T.PuzzleRand("d(124)")%2,e=this.GetDropRowStart(),t=this.GetDropRowEnd(),n=this.GetDropRowVar(),o=this.GetDropColStart(r),a=this.GetDropColEnd(r),i=this.GetDropColVar(r);this.SetMaxDropRow(e);for(var s=!1,_=e,l=o;_!=t;){for(;l!=a;){var I=!1,c=new d.GridPosition(_,l),E=this.mBoardView.GetNode(c.row,c.col);if(this.IsNodeCanDrop(E)){I=this.TryToCreateChess(E,I);var C=this.TryToDropChess(c,I,s);I=C.isDropFromPoint,s=C.isDrop,s=this.TryToSlideCollectChess(E,s)}I||(l+=i)}_+=n,l=o}return s}},{key:"DoObliqueDrop",value:function(){var r=T.PuzzleRand("d(157)")%2,e=this.GetDropRowStart(),t=this.GetDropRowEnd(),n=this.GetDropRowVar(),o=this.GetDropColStart(r),a=this.GetDropColEnd(r),i=this.GetDropColVar(r);this.SetMaxDropRow(e);for(var s=e,_=o;s!=t;){for(;_!=a;){do{var l=new d.GridPosition(s,_),C=this.mBoardView.GetNode(l.row,l.col);if(!C||!C.CanDrop(this.mDropWay))break;if(this.IsCollectObjectReach(C,l))break;var p=this.GetNextDropRow(s);if(this.mBoardView.DropTo(l,new d.GridPosition(p,l.col-1))||this.mBoardView.DropTo(l,new d.GridPosition(p,l.col+1)))return!0}while(0);_+=i}s+=n,_=o}return!1}},{key:"TryToCreateChess",value:function(_,e){if(!_.IsChessGridEmpty()||!_.CanDropIn(this.mDropWay,!0))return e;if(this.IsDropPoint(_)){var t=new d.GridPosition(_.GetPosition());this.mDropPointCountVec.push(t);for(var n=this.mDropPointCountVec.length,o=0,a=0;a<n;a++)this.mDropPointCountVec[a].isEqual(t)&&o++;_.GenerateNewChess(o,this.mDropWay==d.DropWay.DropWay_Float,!1),e=!0}return e}},{key:"TryToDropChess",value:function(_,e,r){for(var s=this.GetNextDropNode(this.mBoardView,_),o;this.IsUnderMaxDropRow(s.row)&&(o=this.mBoardView.GetNode(_.row,_.col),!this.IsCollectObjectReach(o,_))&&!!this.mBoardView.DropTo(_,s);)this.IsDropPoint(o)&&(e=!0),_.copyData(s),s=this.GetNextDropNode(this.mBoardView,_),r=!0;return{isDropFromPoint:e,isDrop:r}}},{key:"TryToSlideCollectChess",value:function(_,e){var t=_.GetPositionInBoard(this.mBoardView),n=this.GetNextDropRow(t.row);if(!this.IsUnderMaxDropRow(n))return e;if(!_.HasCollectChess()||!this.IsNodeStopCollectChess(new d.GridPosition(n,t.col)))return e;if(this.IsCollectObjectReach(_,t))return e;var o=[];o[0]=new d.GridPosition(n,t.col+1),o[1]=new d.GridPosition(n,t.col-1);for(var a=0;2>a;a++)if(this.IsChessEmpty(o[a])&&this.mBoardView.CanDropTo(t,o[a]))return this.mBoardView.DropTo(t,o[a]),e=!0;return e}},{key:"GetNextDropNode",value:function(_,e){var t=new d.GridPosition(-1,e.col);this.mDropWay==d.DropWay.DropWay_Fall?(t.row=e.row+1,t.row>=_.DropStopRow()&&(t.row=-1)):this.mDropWay==d.DropWay.DropWay_Float&&(t.row=e.row-1,t.row<_.DropStopRow()&&(t.row=-1));var n=_.GetNode(e),o=n.adapter();return o.NextNode&&(t=o.NextNode(n,t),t=_.Position(t)),t}}]),a}();E.exports=i},function(E,e,t){"use strict";function C(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),d=d||t(17),r=r||t(12),p=p||t(24),a=a||t(13),_=function a(e,t){C(this,a),this.type=e,this.color=t},n=function(){function n(e){C(this,n),this.mResortBoardView=e,this.mResortFlag=[],this.mResortSpecial=[],this.mPosDispel=[new d.GridPosition,new d.GridPosition,new d.GridPosition],this.mResortNormalNum=0,this.mColorDispel=0,this.mChessTypeCount=a.stageManager.MaxColorCount()}return o(n,[{key:"Rearrange",value:function(){this.mResortFlag=Array(this.mResortBoardView.NodeCount()),this.RearrangeBoardInit();var a=this.FindAndSetDispel();return this.ResetSpecialChess(),this.ResetNormalChess(),a}},{key:"RearrangeBoardInit",value:function(){this.mResortNormalNum=0,this.mResortSpecial=[];for(var i=0;i<this.mResortBoardView.Row();i++)for(var e=0,t;e<this.mResortBoardView.Col();e++)if(t=this.mResortBoardView.GetNode(i,e),t&&t.NeedReArrange()){var n=t.GetChess().Type(),o=t.GetChess().Color();if(this.SetResortFlag(i,e,!0),n==r.ChessType.CT_NormalUnit)this.mResortNormalNum++,t.SetChessColor(d.MovingItemType.MIT_NONE);else{var a=new _(n,o);this.mResortSpecial.push(a),t.AddChessType(r.ChessType.CT_NormalUnit,null,d.MovingItemType.MIT_NONE),t.SetChessColor(d.MovingItemType.MIT_NONE)}}else this.SetResortFlag(i,e,!1)}},{key:"FindAndSetDispel",value:function(){for(var _=this.mResortBoardView.Row()*this.mResortBoardView.Col(),e=p.PuzzleRand("rge(64)")%_,t=0;t<_;t++,e++){var n=S(e%_/this.mResortBoardView.Col()),o=e%_%this.mResortBoardView.Col(),a=new d.GridPosition(n,o);if(this.CheckDispelAndSetColor(a,!0)||this.CheckDispelAndSetColor(a,!1))return!0}return!1}},{key:"CheckDispelAndSetColor",value:function(a,e){return!!(this.CheckDispelPos(a,e)&&this.IsStableUnitSameColor(this.mPosDispel,3)&&this.SetDispelColor())}},{key:"GetSpecialCountByColor",value:function(a){for(var e=0,t=this.mResortSpecial.length,n=0;n<t;n++)this.mResortSpecial[n].color==a&&e++;return e}},{key:"PopSpecialTypeByColor",value:function(a){for(var e=r.ChessType.CT_NormalUnit,t=this.mResortSpecial.length,n=0;n<t;n++)if(this.mResortSpecial[n].color==a){e=this.mResortSpecial[n].type,this.mResortSpecial.splice(n,1);break}return e}},{key:"SetDispelColor",value:function(){var r=1;-1==this.mColorDispel&&(this.mColorDispel=p.PuzzleRand("rge(112)")%this.mChessTypeCount,r=this.mChessTypeCount);for(var e=!1,s=0;s<r;s++){for(var n=[,,,],o=0,a=0;3>a;a++)this.GetResortFlag(this.mPosDispel[a].row,this.mPosDispel[a].col)?(n[a]=this.mResortBoardView.GetNode(this.mPosDispel[a]),n[a].SetChessColor(this.mColorDispel),o++):n[a]=null;if(!this.mResortBoardView.CheckJoin(this.mPosDispel[0])&&!this.mResortBoardView.CheckJoin(this.mPosDispel[1])&&!this.mResortBoardView.CheckJoin(this.mPosDispel[2])){if(o>this.mResortNormalNum){var i=o-this.mResortNormalNum;if(this.GetSpecialCountByColor(this.mColorDispel)<i)continue;for(var a=0;3>a;a++)if(n[a]){var _=this.PopSpecialTypeByColor(this.mColorDispel);if(n[a].AddChessType(_,null,this.mColorDispel),0>=--i)break}}e=!0;break}this.mColorDispel=(this.mColorDispel+1)%this.mChessTypeCount}if(!e&&r==this.mChessTypeCount)for(var l=[101,102],E=0;2>E;E++)if(3<=this.GetSpecialCountByColor(l[E])){for(var a=0;3>a;a++){var n=this.mResortBoardView.GetNode(this.mPosDispel[a]),_=this.PopSpecialTypeByColor(l[E]);n.AddChessType(_)}e=!0;break}for(var a=0;3>a;a++)if(e)this.SetResortFlag(this.mPosDispel[a].row,this.mPosDispel[a].col,!1);else if(this.GetResortFlag(this.mPosDispel[a].row,this.mPosDispel[a].col)){var n=this.mResortBoardView.GetNode(this.mPosDispel[a]);n.SetChessColor(d.MovingItemType.MIT_NONE)}return e}},{key:"ResetSpecialChess",value:function(){for(var r=this.mResortBoardView.Row()*this.mResortBoardView.Col(),e=this.mResortSpecial.length,t=0;t<e;t++)for(var n=this.mResortSpecial[t],o=p.PuzzleRand("rge(188)")%r,a=0;a<r;a++,o++){var s=S(o%r/this.mResortBoardView.Col()),_=o%r%this.mResortBoardView.Col();if(this.GetResortFlag(s,_)){var i=this.mResortBoardView.GetNode(s,_);if(i.AddChessType(n.type,null,n.color),!this.mResortBoardView.CheckJoin(new d.GridPosition(s,_),n.color)){this.SetResortFlag(s,_,!1);break}i.RemoveChess(n.type)}}return this.mResortSpecial=[],!0}},{key:"ResetNormalChess",value:function(){for(var _=0;_<this.mResortBoardView.Row();_++)for(var e=0;e<this.mResortBoardView.Col();e++)if(this.GetResortFlag(_,e))for(var t=p.PuzzleRand("rge(212)")%this.mChessTypeCount,n=0,o;;){if(o=this.mResortBoardView.GetNode(_,e),o.GetChessByType(r.ChessType.CT_NormalUnit)?o.SetChessColor(t):o.AddChessType(r.ChessType.CT_NormalUnit,null,t),!this.mResortBoardView.CheckJoin(new d.GridPosition(_,e),t))break;if(t=(t+1)%this.mChessTypeCount,n++>this.mChessTypeCount)break}return!0}},{key:"CheckDispelPos",value:function(r,e){for(var t=e?0:1,E=e?1:0,C=0;3>C;C++){this.mPosDispel[C]=new d.GridPosition(r.row+C*t,r.col+C*E);var a=this.mResortBoardView.GetNode(this.mPosDispel[C]);if(!a||!a.GetChess(d.kChessLayerChess))return!1}var p=this.mPosDispel[0].addPos(new d.GridPosition(-t,-E)),s=this.mPosDispel[2].addPos(new d.GridPosition(t,E));if(this.mResortBoardView.CanSlideSwap(this.mPosDispel[0],p))return this.mPosDispel[0]=p,!0;if(this.mResortBoardView.CanSlideSwap(this.mPosDispel[2],s))return this.mPosDispel[2]=s,!0;for(var C=0;3>C;C++){var _=this.mPosDispel[C].addPos(new d.GridPosition(-E,-t)),l=this.mPosDispel[C].addPos(new d.GridPosition(E,t));if(this.mResortBoardView.CanSlideSwap(this.mPosDispel[C],_))return this.mPosDispel[C]=_,!0;if(this.mResortBoardView.CanSlideSwap(this.mPosDispel[C],l))return this.mPosDispel[C]=l,!0}return!1}},{key:"IsStableUnitSameColor",value:function(a,e){this.mColorDispel=-1;for(var t=0;t<e;t++)if(!this.GetResortFlag(a[t].row,a[t].col)){var n=this.mResortBoardView.GetNode(a[t]);if(!n||!n.CanJoin3Crush())return!1;if(-1==this.mColorDispel)this.mColorDispel=n.ChessColor();else if(n.ChessColor()!=this.mColorDispel)return!1}return!0}},{key:"SetResortFlag",value:function(a,e,t){var n=a*this.mResortBoardView.Col()+e;this.mResortFlag[n]=t}},{key:"GetResortFlag",value:function(a,e){var t=a*this.mResortBoardView.Col()+e;return this.mResortFlag[t]}}]),n}();E.exports=n},function(E,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),C=C||t(13),a=a||t(17),r=r||t(12),s=s||t(24),_=function(){function _(e){n(this,_),this.viewer_=e,this.current_phase_=0}return o(_,[{key:"Do",value:function(){var a=0;if(0==this.current_phase_){if(a=this.Phase1(),0!=a)return a;this.current_phase_++}if(1==this.current_phase_&&(this.current_phase_++,a=this.Phase2(),0!=a))return a;if(2==this.current_phase_){if(console.log("\u9636\u6BB5\u4E09"),a=this.Phase1(),0!=a)return a;this.current_phase_++}return 0}},{key:"Phase1",value:function(){for(var _=null,e=0,t=this.viewer_,n=t.NodeCount(),o=0;o<n;o++)if(_=t.GetNodeIndex(o),!_.HasChessSurface()){var a=_.GetChess();if(null!=a&&(a.Attribute().IsSpecialChess1||a.Attribute().IsSpecialChess2)&&this.CrushNode(_)){e++;break}}return e}},{key:"Phase2",value:function(){var r=C.stageManager.GetRemainStep();if(0==r)return 0;for(var e=[],t=null,n=this.viewer_,o=n.NodeCount(),a=0;a<o;a++)t=n.GetNodeIndex(a),null!=t&&e.push(t);C.aniManager.GenerateStepRewardBeginAnimation();for(var i=0,s=-1;i<2*r;){0==++i%2&&C.stageManager.ConsumeStep(1);var _=this.PopRandTargetNode(e);if(!_)break;s=this.LaunchRayToNode(_,s)}for(C.aniManager.GenerateStepRewardEndAnimation();0<C.stageManager.GetRemainStep();){var E=C.stageManager.GetRemainStep();C.stageManager.ConsumeStep(E),C.scoreManager.addScore(3e3*E),C.aniManager.handleOverageStep()}return this.viewer_.Sweep(),C.stateMachine.m_DropTimes=-1,C.curBoard.set_dropround(-1),i}},{key:"CrushNode",value:function(o){var e=new a.LittleBatchIndexStruct;e.m_parent_batch_index=0,e.m_self_batch_index=0;var t=this.viewer_.CrushNode(o,r.AttackType.Attack_Normal,e);return t&&this.viewer_.Sweep(),t}},{key:"PopRandTargetNode",value:function(_){for(var e=_.length,t=s.PuzzleRand("lp(151)"),n=0;n<e;n++){var o=(t+n)%e,a=_[o];if(a.Sweep(),a.CanUseLastpang())return _[o]=_[e-1],_.pop(),a}return null}},{key:"LaunchRayToNode",value:function(o,e){var t=(o.ChessColor(),o.ChessType(),o.GetPosition().row,o.GetPosition().col,o.GetTickbombTick(),new a.LittleBatchIndexStruct);return t.m_parent_batch_index=0,t.m_self_batch_index=0,this.viewer_.CrushNode(o,r.AttackType.Attack_Lastpang,t),e}}]),_}();E.exports=_},function(E,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),O=O||t(17),a=a||t(31),r=r||t(13),s=s||t(12),d=d||t(24),_={DIRECTION_LEFT_TO_RIGHT:0,DIRECTION_RIGHT_TO_LEFT:1},l={NFM_Unknow:0,NFM_Vertical:1,NFM_Sideslip:2,NFM_Sideslip_Left:3,NFM_Sideslip_Right:4},i=function(){function c(){n(this,c),this.mSodaRow=0,this.mMaxDropRow=0,this.mDropWay=0,this.mBoardView=null,this.mDropPointCountVec=[],this.needReCalculate=!1}return o(c,[{key:"resetFillModeFlag",value:function(){if(c.isNeedCalculFillMode)for(var e=r.worldViewer.NodeCount(),a=0,t;a<e;a++)t=r.worldViewer.GetNodeIndex(a),t.setFillMode(l.NFM_Unknow)}},{key:"firstCalculFillMode",value:function(e){c.isNeedCalculFillMode=!0,this.mDropWay=O.DropWay.DropWay_Fall,this.mBoardView=e,this.mSodaRow=r.envManager.GetSodaLine();var t=this.GetDropRowStart(),n=this.GetDropRowEnd(),o=this.GetDropRowVar();this.SetMaxDropRow(t),this.needReCalculate=!1,this.CalculateFillModeFlag(this.mDropWay,n-o,t-o,-o),c.isNeedCalculFillMode=r.envManager.GetIsHaveStopDropChess()||r.stageManager.IsSodaGame()||r.stageManager.IsDiggerType()||r.stageManager.IsConveyer()}},{key:"DoDrop",value:function(a){this.resetFillModeFlag(),this.DoDropByDropWay(O.DropWay.DropWay_Fall,a),r.stageManager.IsSodaGame()&&this.DoDropByDropWay(O.DropWay.DropWay_Float,a)}},{key:"DoDropByDropWay",value:function(a,e){a!=O.DropWay.DropWay_Fall&&a!=O.DropWay.DropWay_Float||(this.mDropWay=a,this.mBoardView=e,this.mSodaRow=r.envManager.GetSodaLine(),this.mDropPointCountVec=[],this.DoVerticalDrop())}},{key:"IsNodeStopCollectChess",value:function(a){var e=this.mBoardView.GetNode(a.row,a.col);if(!e||!e.IsAvailable())return!0;for(var _=[s.ChessType.STIT_CANNON,s.ChessType.STIT_STONE,s.ChessType.STIT_CANDYPOT,s.ChessType.STIT_EGG_NEST1,s.ChessType.STIT_EGG_NEST2,s.ChessType.STIT_ANIMAL_GO_HOME_NEST],n=_.length-1;0<=n;n--)if(e.HasChessType(_[n]))return!0;return!1}},{key:"IsChessEmpty",value:function(a){var e=this.mBoardView.GetNode(a.row,a.col);return e&&null==e.GetChess()}},{key:"IsDropPoint",value:function(a){return!!(this.mDropWay==O.DropWay.DropWay_Fall&&a.HasOneOf(s.ChessType.STIT_DROP_POINT)||this.mDropWay==O.DropWay.DropWay_Fall&&a.HasOneOf(s.ChessType.STIT_DROP_VALVE)||this.mDropWay==O.DropWay.DropWay_Float&&a.HasOneOf(s.ChessType.STIT_DROP_POINT_IN_SODA)||this.mDropWay==O.DropWay.DropWay_Float&&a.HasOneOf(s.ChessType.STIT_DROP_VALVE_IN_SODA))}},{key:"IsCollectObjectReach",value:function(_,e){var t=this.mBoardView.GetNode(e.row,e.col);if(!t)return!1;var r=t.HasChessType(s.ChessType.STIT_COLLECTBALLOON_POINT)||t.IsStaticItemCollectPointInSoda(),o=t.HasChessType(s.ChessType.STIT_COLLECTCANDY_POINT);return!!(_.HasChessType(s.ChessType.CT_COLLECTBALLOON)&&r||_.HasChessType(s.ChessType.STIT_SUNNYDOLL1)&&r||_.HasChessType(s.ChessType.CT_COLLECTCANDY)&&o)}},{key:"IsNodeCanDrop",value:function(a){return!!a&&!!(a.CanDrop(this.mDropWay)||a.CanDropIn(this.mDropWay,!0)||a.HasOneOf(s.ChessType.STIT_CHONGDONG1)||a.HasOneOf(s.ChessType.STIT_CHONGDONG2))}},{key:"GetDropRowStart",value:function(){var a=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],e=this.mDropWay==O.DropWay.DropWay_Fall?this.mSodaRow-1:this.mSodaRow;if(a&&this.mBoardView==r.worldViewer){var t=r.curBoard.GetStartRow(),n=t+r.boardViewer.Row()-1;this.mDropWay==O.DropWay.DropWay_Fall&&e>n?e=n:this.mDropWay==O.DropWay.DropWay_Float&&e<t&&(e=t)}return e}},{key:"GetDropRowEnd",value:function(){return this.mDropWay==O.DropWay.DropWay_Fall?-1:this.mBoardView.Row()}},{key:"GetDropRowVar",value:function(){return this.mDropWay==O.DropWay.DropWay_Fall?-1:1}},{key:"GetDropColStart",value:function(a){return a==_.DIRECTION_LEFT_TO_RIGHT?0:this.mBoardView.Col()-1}},{key:"GetDropColEnd",value:function(a){return a==_.DIRECTION_LEFT_TO_RIGHT?this.mBoardView.Col():-1}},{key:"GetDropColVar",value:function(a){return a==_.DIRECTION_LEFT_TO_RIGHT?1:-1}},{key:"GetNextDropRow",value:function(a){return this.mDropWay==O.DropWay.DropWay_Fall&&a+1<this.mSodaRow?a+1:this.mDropWay==O.DropWay.DropWay_Float&&a-1>=this.mSodaRow?a-1:-1}},{key:"SetMaxDropRow",value:function(a){this.mMaxDropRow=a}},{key:"IsUnderMaxDropRow",value:function(a){return this.mDropWay==O.DropWay.DropWay_Fall&&a<=this.mMaxDropRow||this.mDropWay==O.DropWay.DropWay_Float&&a>=this.mMaxDropRow}},{key:"DoVerticalDrop",value:function(){var r=d.PuzzleRand("d(124)")%2,e=this.GetDropRowStart(),t=this.GetDropRowEnd(),n=this.GetDropRowVar(),l=this.GetDropColStart(r),a=this.GetDropColEnd(r),i=this.GetDropColVar(r);this.SetMaxDropRow(e),this.needReCalculate=!1,this.CalculateFillModeFlag(this.mDropWay,t-n,e-n,-n);for(var s=!1,_=e,T=l;_!=t;){for(;T!=a;){var I=!1,c=new O.GridPosition(_,T),E=this.mBoardView.GetNode(c.row,c.col);if(this.IsNodeCanDrop(E)){I=this.TryToCreateChess(E,I);var C=this.TryToDropChess(c,I,s,E.HasCollectChess());I=C.isDropFromPoint,s=C.isDrop}I||(T+=i)}_+=n,T=l}if(this.needReCalculate)for(s=!1,_=e,T=l;_!=t;){for(;T!=a;){var I=!1,c=new O.GridPosition(_,T),E=this.mBoardView.GetNode(c.row,c.col);if(this.IsNodeCanDrop(E)){I=this.TryToCreateChess(E,I);var C=this.TryToDropChess(c,I,s);I=C.isDropFromPoint,s=C.isDrop}I||(T+=i)}_+=n,T=l}return s}},{key:"DoObliqueDrop",value:function(){var r=d.PuzzleRand("d(157)")%2,e=this.GetDropRowStart(),t=this.GetDropRowEnd(),n=this.GetDropRowVar(),o=this.GetDropColStart(r),a=this.GetDropColEnd(r),i=this.GetDropColVar(r);this.SetMaxDropRow(e);for(var s=e,_=o;s!=t;){for(;_!=a;){do{var l=new O.GridPosition(s,_),C=this.mBoardView.GetNode(l.row,l.col);if(!C||!C.CanDrop(this.mDropWay))break;if(this.IsCollectObjectReach(C,l))break;var p=this.GetNextDropRow(s);if(this.mBoardView.DropTo(l,new O.GridPosition(p,l.col-1))||this.mBoardView.DropTo(l,new O.GridPosition(p,l.col+1)))return!0}while(0);_+=i}s+=n,_=o}return!1}},{key:"TryToCreateChess",value:function(_,e){if(!_.IsChessGridEmpty()||!_.CanDropIn(this.mDropWay,!0))return e;if(this.IsDropPoint(_)){var t=new O.GridPosition(_.GetPosition());this.mDropPointCountVec.push(t);for(var n=this.mDropPointCountVec.length,o=0,a=0;a<n;a++)this.mDropPointCountVec[a].isEqual(t)&&o++;_.GenerateNewChess(o,this.mDropWay==O.DropWay.DropWay_Float,!1),e=!0}return e}},{key:"TryToDropChess",value:function(_,e,s,i){for(var o=this.GetNextDropNode(this.mBoardView,_),a;this.IsUnderMaxDropRow(o.row)&&(a=this.mBoardView.GetNode(_.row,_.col),!this.IsCollectObjectReach(a,_))&&!(!this.mBoardView.DropTo(_,o)&&!this.TryToSideSlipDrop(_,o,i));)this.IsDropPoint(a)&&(e=!0),_.copyData(o),o=this.GetNextDropNode(this.mBoardView,_),s=!0;return{isDropFromPoint:e,isDrop:s}}},{key:"TryToSideSlipDrop",value:function(s,e,t){var n=this.GetNextDropRow(s.row),o=[];o[0]=new O.GridPosition(n,s.col-1),o[1]=new O.GridPosition(n,s.col+1);for(var a=0,i;2>a;a++)if(i=this.mBoardView.GetNode(o[a]),i&&(i.getFillMode()!=l.NFM_Vertical||t&&r.envManager.isCollectSkidding)&&this.IsChessEmpty(o[a])&&this.mBoardView.CanDropTo(s,o[a]))return this.mBoardView.DropTo(s,o[a]),e.row=o[a].row,e.col=o[a].col,!0;return!1}},{key:"TryToSlideCollectChess",value:function(_,e){var t=_.GetPositionInBoard(this.mBoardView),n=this.GetNextDropRow(t.row);if(!this.IsUnderMaxDropRow(n))return e;if(!_.HasCollectChess()||!this.IsNodeStopCollectChess(new O.GridPosition(n,t.col)))return e;if(this.IsCollectObjectReach(_,t))return e;var o=[];o[0]=new O.GridPosition(n,t.col+1),o[1]=new O.GridPosition(n,t.col-1);for(var a=0;2>a;a++)if(this.IsChessEmpty(o[a])&&this.mBoardView.CanDropTo(t,o[a]))return this.mBoardView.DropTo(t,o[a]),e=!0;return e}},{key:"GetNextDropNode",value:function(_,e){var t=new O.GridPosition(-1,e.col);this.mDropWay==O.DropWay.DropWay_Fall?(t.row=e.row+1,t.row>=_.DropStopRow()&&(t.row=-1)):this.mDropWay==O.DropWay.DropWay_Float&&(t.row=e.row-1,t.row<_.DropStopRow()&&(t.row=-1));var n=_.GetNode(e),o=n.adapter();return o.NextNode&&(t=o.NextNode(n,t),t=_.Position(t)),t}},{key:"logFillModeFlag",value:function(){var _=this.mBoardView;console.log("\u586B\u5145\u6A21\u5F0F\u9635\u5217\uFF1A");for(var e=_.Row(),t=_.Col(),n=0;n<e;n++){for(var o=""+n+": ",a=0;a<t;a++){var r=_.GetNode(n,a),i=r.getFillMode();o+=i+","}console.log(o)}}},{key:"IsChessCanDropFromNode",value:function(_,e){if(!_.available_)return!1;for(var t=!0,n=null,o=_.chesses_.length,a=_.chesses_,i=0;i<o;i++)if(n=a[i],null!=n){if(1==i&&n.Attribute().drop_rule==s.DropRule.kDropNone){t=!1;break}if(n.Attribute().StopDrop){t=!1;break}}return t&&e==O.DropWay.DropWay_Fall&&_.HasChessType(s.ChessType.STIT_FENCE_BOTTOM)&&(t=!1),t||r.envManager.SetIsHaveStopDropChess(!0),t}},{key:"IsChessCanSlideFromNode",value:function(a){if(!a.available_)return!1;return!a.HasOneOf(s.ChessType.CT_CLODS0)&&!a.HasOneOf(s.ChessType.CT_CLODS1)&&!0}},{key:"CalculateFillModeFlag",value:function(e,t,n,o){if(c.isNeedCalculFillMode){var a=this.mBoardView,r=0,s=a.Col(),_=!1;this.needReCalculate&&(_=!0);for(var i=t,h=r;i!=n;){for(;h!=s;){do{var E=a.GetNode(i,h),L=new O.GridPosition(i,h);if(!E||!E.IsAvailable())break;E.getFillMode()!=l.NFM_Vertical&&this.IsDropPoint(E)&&E.setFillMode(l.NFM_Vertical);var p=this.IsChessCanDropFromNode(E,e);if(E.getFillMode()==l.NFM_Unknow&&!E.CanDrop(e))break;var d=this.GetNextDropNode(this.mBoardView,L);if(0<=d.row&&(e==O.DropWay.DropWay_Fall&&d.row<=L.row?this.needReCalculate=!0:e==O.DropWay.DropWay_Float&&d.row>=L.row&&(this.needReCalculate=!0)),this.IsUnderMaxDropRow(d.row)){var T=a.GetNode(d.row,d.col);T&&T.IsAvailable()&&T.getFillMode()!=l.NFM_Vertical&&p&&T.setFillMode(l.NFM_Vertical)}var I=this.GetNextDropRow(L.row);if(!this.IsUnderMaxDropRow(I))break;var y=[];y[0]=new O.GridPosition(I,L.col+1),y[1]=new O.GridPosition(I,L.col-1);for(var S=0,N;2>S;S++)N=a.GetNode(y[S]),N&&N.IsAvailable()&&N.getFillMode()==l.NFM_Unknow&&p&&this.IsChessCanSlideFromNode(E,e)&&N.setFillMode(l.NFM_Sideslip)}while(0);h+=1}i+=o,h=r}!_&&this.needReCalculate&&this.CalculateFillModeFlag(e,t,n,o),this.logFillModeFlag()}}}]),c}();i.isNeedCalculFillMode=!0,E.exports=i},function(O,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),a=a||t(29),r=r||t(11),i=i||t(13),s=s||t(18),_=_||t(39),l=l||t(46),u=u||t(47),c=c||t(48),h=h||t(49),E=E||t(37),C=C||t(50),p=p||t(51),d=d||t(52),T=T||t(40),I=I||t(53),y=y||t(54),S=S||t(55),N=N||t(56),L=L||t(57),A=function(){function a(){n(this,a),this.module_map_={},this.module_types_={},this.module_pass_condition_={}}return o(a,[{key:"Init",value:function(a){var e=null;e=new _.BasicModule,e.Init(a),this.AddModule("BasicModule",e),e=new l.SpecialChessModule,e.Init(a),this.AddModule("SpecialChessModule",e),e=new u.WE4CoreModule,e.Init(a),this.AddModule("WE4CoreModule",e),e=new c.DropPointModule,e.Init(a),this.AddModule("DropPointModule",e),e=new h.IceModule,e.Init(a),this.AddModule("IceModule",e),e=new E.WormholeModule,e.Init(a),this.AddModule("WormholeModule",e),e=new p.BlueberryModule,e.Init(a),this.AddModule("BlueberryModule",e),e=new y.MushroomModule,e.Init(a),this.AddModule("MushroomModule",e),e=new d.CandyPotModule,e.Init(a),this.AddModule("CandyPotModule",e),e=new C.DiggerModule,e.Init(a),this.AddModule(C.DiggerModule.sModuleName,e),e=new T.IceBearModule,e.Init(a),this.AddModule("IceBearModule",e),e=new I.MaoqiuModule,e.Init(a),this.AddModule("MaoqiuModule",e),e=new S.TickBombModule,e.Init(a),this.AddModule("TickBombModule",e),e=new N.ChameleonModule,e.Init(a),this.AddModule("ChameleonModule",e),e=new L.ConveyerModule,e.Init(a),this.AddModule("ConveyerModule",e)}},{key:"Release",value:function(){this.module_map_={},this.module_types_={}}},{key:"AddModule",value:function(a,e){var t=this.module_map_;t[a]||(t[a]=e)}},{key:"FindModule",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return this.module_map_[a]}},{key:"NewChess",value:function(a){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],t=this.module_types_[a];return null==t?null:t.NewChess(a,e)}},{key:"RegisterChess",value:function(a,e){var t=this.module_types_;return!t[a]&&(t[a]=e,!0)}},{key:"AddElementMap",value:function(){}},{key:"GetModuleData",value:function(a,e){var t=this.FindModule(a);return null==t?null:t.GetModuleData(e)}},{key:"showAllModuleNewCount",value:function(){var a=this.module_map_;a.BasicModule.showNewCount("BasicModule"),a.SpecialChessModule.showNewCount("SpecialChessModule"),a.DropPointModule.showNewCount("DropPointModule"),a.IceModule.showNewCount("IceModule"),a.WormholeModule.showNewCount("WormholeModule"),a.BlueberryModule.showNewCount("BlueberryModule"),a.CandyPotModule.showNewCount("CandyPotModule"),a.MushroomModule.showNewCount("MushroomModule")}}]),a}();O.exports=A},function(P,e,t){"use strict";function G(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function o(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==typeof o||"function"==typeof o)?o:a}function a(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}function r(n,e){var t=new T.CrushNodeEvent;t.src=new k.GridPosition(e.src),t.attack_type=C.AttackType.Attack_Gas,t.ani_batch_id=e.batch.m_self_batch_index;for(var o=E.PuzzleRand("sp(41)")%d.stageManager.MaxColorCount(),a=n.GetPosition(),r=a.row,p=a.col,s=d.boardViewer.Row(),_=d.boardViewer.Col(),l=0;l<s;l++)for(var I=0;I<_;I++)if(l!=r||I!=p){var c=d.boardViewer.GetNode(l,I);c.IsChessGridEmpty()||o!=c.ChessColor()||0<c.GetMark()||c.ChessColor()==o&&(C.ChessType.CT_NormalUnit==c.ChessType()||C.ChessType.CT_STEPBONUS==c.ChessType()||C.ChessType.CT_TICKBOMB==c.ChessType()||C.ChessType.CT_Chameleon==c.ChessType()||C.ChessType.CT_SodaBottle==c.ChessType()?c.Crush(e)&&c.GetMark():c.Crush(e),t.nodes.push(new k.GridPosition(c.GetPosition())))}d.eventManager.Forward(t)}function i(a,e){var t=new T.CrushNodeEvent,n=a;if(n)switch(e.attack_type){case C.AttackType.Attack_Hurricane:case C.AttackType.Attack_HorizontalShockWave:case C.AttackType.Attack_VerticalShockWave:t.src=new k.GridPosition(n.GetPosition()),t.attack_type=e.attack_type,t.ani_batch_id=e.batch.m_self_batch_index,t.nodes=v.GetAttackRange(t.attack_type,e.src),v.CrushNodesByPosVec(e,t.nodes),d.eventManager.Forward(t);break;case C.AttackType.Attack_Gas:r(a,e);}}function D(a,e,t){var n=a;switch(t.attackType){case C.AttackType.Attack_GasSpecial:n.MarkAllSpecial(e,t.chessColor,t.chessSpecial);break;case C.AttackType.Attack_Gas2Gas:n.MarkGas2Gas(e);break;case C.AttackType.Attack_Gas:n.MarkGasExplosion(e,t.chessColor);break;case C.AttackType.Attack_CrossShockWave:case C.AttackType.Attack_BigHurricane:case C.AttackType.Attack_ThickCrossShockWave:n.MarkByAttackType(e,t.attackType);}}function s(_,e,t,n,o){if(_.ChessColor()!=t||_.IsStaticItemCandyPaper())return!1;if(_.GetMark())return!1;var a=p.clone(e);a.attack_type=C.AttackType.Attack_GasSpecial;var r=_.HasChessSurface();if(r)return _.Crush(a)&&o.push(new k.GridPosition(_.GetPosition())),!1;var i=_.GetLayer(k.kChessLayerChess);return i.Attribute().IsSpecialChess1?(_.MarkChess(e.join),n.push(_),o.push(new k.GridPosition(_.GetPosition())),!1):_.CanUseSpecial()?(i.ActiveChessBuffer(e.batch.m_self_batch_index,!1),n.push(_),o.push(new k.GridPosition(_.GetPosition())),!0):(_.Crush(a)&&(_.Sweep(),o.push(new k.GridPosition(_.GetPosition()))),!1)}var n=function _(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:_(a,t,n)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(n)},_=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),l=l||t(38),c=c||t(39),k=k||t(17),C=C||t(12),E=E||t(24),d=d||t(13),p=p||t(23),T=T||t(33),I=I||t(8),u={LD_HORIZONTAL:0,LD_VERTICAL:1},y={AD_LEFT:0,AD_RIGHT:1,AD_UP:2,AD_DOWN:3,AD_NUM:4},N=function(){this.attackType=0,this.chessColor=0,this.chessSpecial=0},h=[];h.push(new k.GridPosition(0,-1)),h.push(new k.GridPosition(0,1)),h.push(new k.GridPosition(-1,0)),h.push(new k.GridPosition(1,0));var m=function(n){function r(){G(this,r);var a=o(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return a.RequestEvent(T.PuzzleEvent.kEventCrushNode),a}return a(r,n),_(r,[{key:"OnEvent",value:function(a){switch(a.event_id){case T.PuzzleEvent.kEventCrushNode:this.OnCrushNode(a);}}},{key:"OnCrushNode",value:function(a){if(!(a.attack_type!=C.AttackType.Attack_Normal||a.around_attack||4>a.nodes.length)){var e=d.boardViewer.GetNode(a.src.row,a.src.col);!e||e.ChessColor()<k.MovingItemType.MIT_0||e.ChessColor()>k.MovingItemType.MIT_5||this.AddSpecialChess(a.src,a.nodes,a.ani_batch_id)}}},{key:"AddSpecialChess",value:function(n,e){var t=this.TryGeneralSpecialChess(e);if(t!=C.ChessType.STIT_NONE){var o=this.TryFindNoSpeicalItemData(n,e);if(o){var a;o.ToChessData();var _=o.ChessColor();o.MarkSweepByLayer(),o.AddChess(t,_),a=o.ToChessData(),d.dataCollector.addSpecialChess(a)}}}},{key:"CanGenerateSpecial",value:function(a){return!!a&&!(a.HasSpecialChess()||a.HasChessType(C.ChessType.CT_GIFT)||a.HasChessSurface())}},{key:"TryFindNoSpeicalItemData",value:function(_,e){for(var t=e.length,n=E.PuzzleRand("sp(260)"),o=0,a;o<=t;o++,n++){if(a=d.boardViewer.GetNode(_.row,_.col),this.CanGenerateSpecial(a))return a;n%=t,_=e[n]}return null}},{key:"GeneralSpecialChess",value:function(_){for(var e=C.ChessType.STIT_NONE,t=d.boardViewer.GetColorByPos(_),n=_.row,o=_.row,a=_.col,r=_.col;d.boardViewer.GetColorByPos(new k.GridPosition(_.row,a-1))==t;)--a;for(;d.boardViewer.GetColorByPos(new k.GridPosition(_.row,r+1))==t;)++r;for(;d.boardViewer.GetColorByPos(new k.GridPosition(n-1,_.col))==t;)--n;for(;d.boardViewer.GetColorByPos(new k.GridPosition(o+1,_.col))==t;)++o;return 4<=r-a||4<=o-n?e=C.ChessType.CT_SpecialGas:2<=r-a&&2<=o-n?e=C.ChessType.CT_SpecialHurricane:3<=r-a?e=C.ChessType.CT_SpecialVerticalShockWave:3<=o-n&&(e=C.ChessType.CT_SpecialHorizontalShockWave),e}},{key:"TryGeneralSpecialChess",value:function(_){for(var e=C.ChessType.STIT_NONE,t=_.length,n=0,o;n<t;n++)o=this.GeneralSpecialChess(_[n]),o>e&&(e=o);return e}}]),r}(T.BoardEventListener),v={mCheckStopAttackFlag:!1,GetAttackRange:function(_,e){var t=[],n=this.mCheckStopAttackFlag;if(this.mCheckStopAttackFlag=!0,_==C.AttackType.Attack_HorizontalShockWave)this.GetAttackRangeInLine(e,u.LD_HORIZONTAL,t);else if(_==C.AttackType.Attack_VerticalShockWave)this.GetAttackRangeInLine(e,u.LD_VERTICAL,t);else if(_==C.AttackType.Attack_CrossShockWave)this.GetAttackRangeInLine(e,u.LD_HORIZONTAL,t),this.GetAttackRangeByDirection(e,y.AD_UP,t),this.GetAttackRangeByDirection(e,y.AD_DOWN,t);else if(_==C.AttackType.Attack_ThickCrossShockWave)this.GetAttackRangeInLine(e,u.LD_HORIZONTAL,t),this.GetAttackRangeInLine(new k.GridPosition(e.row-1,e.col),u.LD_HORIZONTAL,t),this.GetAttackRangeInLine(new k.GridPosition(e.row+1,e.col),u.LD_HORIZONTAL,t),this.GetAttackRangeByDirection(new k.GridPosition(e.row-1,e.col-1),y.AD_UP,t,!0),this.GetAttackRangeByDirection(new k.GridPosition(e.row-1,e.col),y.AD_UP,t,!0),this.GetAttackRangeByDirection(new k.GridPosition(e.row-1,e.col+1),y.AD_UP,t,!0),this.GetAttackRangeByDirection(new k.GridPosition(e.row+1,e.col-1),y.AD_DOWN,t,!0),this.GetAttackRangeByDirection(new k.GridPosition(e.row+1,e.col),y.AD_DOWN,t,!0),this.GetAttackRangeByDirection(new k.GridPosition(e.row+1,e.col+1),y.AD_DOWN,t,!0);else if(_==C.AttackType.Attack_Hurricane){var o=2,a=2*o+1,r=[0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0];this.GetAttackRangeByArray(e,r,a,t)}else if(_==C.AttackType.Attack_BigHurricane){var o=4,a=2*o+1,r=[0,0,0,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,1,0,0,0];this.GetAttackRangeByArray(e,r,a,t)}return this.mCheckStopAttackFlag=n,t},GetAttackRangeByDirection:function(o,e,t){if(!(0>e||e>=y.AD_NUM))for(var n=o.addPos(h[e]);d.boardViewer.IsPosInViewer(n);)t.push(n),this.mCheckStopAttackFlag,n=n.addPos(h[e])},GetAttackRangeInLine:function(a,e,t){t.push(a),e==u.LD_HORIZONTAL?(this.GetAttackRangeByDirection(a,y.AD_LEFT,t),this.GetAttackRangeByDirection(a,y.AD_RIGHT,t)):e==u.LD_VERTICAL&&(this.GetAttackRangeByDirection(a,y.AD_UP,t),this.GetAttackRangeByDirection(a,y.AD_DOWN,t))},GetAttackRangeByArray:function(_,e,t,n){for(var o=new k.GridPosition(-S(t/2),-S(t/2)),a=0;a<t;a++)for(var r=0;r<t;r++)if(1==e[a*t+r]){var i=new k.GridPosition(_.row+a+o.row,_.col+r+o.col);n.push(i)}},RefreshBatchData:function(){1<arguments.length&&void 0!==arguments[1]&&arguments[1]},ChangeNormalAndCrush:function(a,e){var t=d.boardViewer.GetNode(e);if(t){var n=t.ChessColor();(n<k.MovingItemType.MIT_0||n>k.MovingItemType.MIT_5)&&(n=E.PuzzleRand("sp(440)")%d.stageManager.MaxColorCount()),t.MarkSweepByLayer(),t.AddChess(C.ChessType.CT_NormalUnit,n),t.Crush(a)}},CrushNodesByPosVec:function(_,e){for(var t=e.length,n=d.boardViewer,o=0,a;o<t;o++)a=n.GetNode(e[o].row,e[o].col),a&&a.Crush(_)}},B={CombinationWithGas:function(_,e){console.log("CombinationSpecial.CombinationWithGas");var t=d.boardViewer,n=t.GetNode(_.src),o=t.GetNode(_.other),a=(n.HasChessType(C.ChessType.CT_SpecialGas)?n:o,n.HasChessType(C.ChessType.CT_SpecialGas)?o:n),r=new k.GridPosition(e.GetPosition()),i=new k.GridPosition(r.isEqual(_.src)?_.other:_.src),s=k.PointBombType.Bomb_Gas_type,l=new N;l.chessColor=a.ChessColor(),a.HasShockWave()?(s=k.PointBombType.Bomb_Special_Gas_type,l.attackType=C.AttackType.Attack_GasSpecial,l.chessSpecial=C.ChessType.CT_SpecialHorizontalShockWave):a.HasChessType(C.ChessType.CT_SpecialHurricane)?(s=k.PointBombType.Bomb_Special_Gas_type,l.attackType=C.AttackType.Attack_GasSpecial,l.chessSpecial=C.ChessType.CT_SpecialHurricane):a.HasChessType(C.ChessType.CT_SpecialGas)?l.attackType=C.AttackType.Attack_Gas2Gas:l.attackType=C.AttackType.Attack_Gas,d.dataCollector.addCrushChess(e.ToChessData()),l.attackType!=C.AttackType.Attack_Gas&&v.ChangeNormalAndCrush(_,i),l.attackType==C.AttackType.Attack_Gas2Gas&&(d.aniManager.GenerateGas2GasAnimation([new k.GridPosition(e.GetPosition()),new k.GridPosition(i)]),d.dataEventManager.trigger(I.END_ONE_REMOVE_ROUND));var E=p.clone(_);return E.src=new k.GridPosition(e.GetPosition()),E.other=new k.GridPosition(i),E.attack_type=l.attackType,d.curBoard.cacheSpecialBomb(new f(D,e,E,l)),l.attackType},CombinationWithoutGas:function(_,e){var t=k.PointBombType.Bomb_NormalUnit_type,n=d.boardViewer.GetNode(_.src),o=d.boardViewer.GetNode(_.other),a=new N;if(a.attackType=C.AttackType.Attack_None,n.HasShockWave()&&o.HasShockWave()?(a.attackType=C.AttackType.Attack_CrossShockWave,t=k.PointBombType.Bomb_CrossShockWave_type):n.HasChessType(C.ChessType.CT_SpecialHurricane)&&o.HasChessType(C.ChessType.CT_SpecialHurricane)?(a.attackType=C.AttackType.Attack_BigHurricane,t=k.PointBombType.Bomb_BigHurricane_type):(n.HasShockWave()&&o.HasChessType(C.ChessType.CT_SpecialHurricane)||o.HasShockWave()&&n.HasChessType(C.ChessType.CT_SpecialHurricane))&&(a.attackType=C.AttackType.Attack_ThickCrossShockWave,t=k.PointBombType.Bomb_ThickCrossShock_type),a.attackType!=C.AttackType.Attack_None){v.ChangeNormalAndCrush(_,_.other),d.dataCollector.addCrushChess(e.ToChessData());var r=p.clone(_);r.attack_type=a.attackType,d.curBoard.cacheSpecialBomb(new f(D,e,r,a))}return a.attackType},Combination:function(_,e){var t=d.boardViewer.GetNode(_.src),n=d.boardViewer.GetNode(_.other),o=C.AttackType.Attack_None;return v.RefreshBatchData(_,!0),t.HasChessType(C.ChessType.CT_SpecialGas)||n.HasChessType(C.ChessType.CT_SpecialGas)?o=this.CombinationWithGas(_,e):t.HasSpecialChess()&&n.HasSpecialChess()&&(o=this.CombinationWithoutGas(_,e)),o!=C.AttackType.Attack_None}},w=function(r){function l(a){return G(this,l),o(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,a))}return a(l,r),_(l,[{key:"PreInit",value:function(a){n(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"PreInit",this).call(this,a)}},{key:"Release",value:function(){n(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"Release",this).call(this)}},{key:"Crush",value:function(a){return a.special_bomb?(a.special_bomb=!1,B.Combination(a,this)):this.SingleCrush(a)}},{key:"SingleCrush",value:function(a){var e=C.AttackType.Attack_None,t=k.PointBombType.Bomb_NormalUnit_type;switch(this.Attribute().ChessType){case C.ChessType.CT_SpecialHorizontalShockWave:e=C.AttackType.Attack_HorizontalShockWave,t=k.PointBombType.Bomb_HorizontalShockWave_type;break;case C.ChessType.CT_SpecialVerticalShockWave:e=C.AttackType.Attack_VerticalShockWave,t=k.PointBombType.Bomb_VerticalShockWave_type;break;case C.ChessType.CT_SpecialHurricane:e=C.AttackType.Attack_Hurricane,t=k.PointBombType.Bomb_Hurricane_type;break;case C.ChessType.CT_SpecialGas:if(a.attack_type==C.AttackType.Attack_Disappear)return!1;e=C.AttackType.Attack_Gas,t=k.PointBombType.Bomb_Gas_type;break;default:return!1;}var n=p.clone(a);return n.attack_type=e,n.src=new k.GridPosition(this.GetPosition()),v.RefreshBatchData(n,!1),d.dataCollector.addCrushChess(this.ToChessData()),d.curBoard.cacheSpecialBomb(new f(i,this,n)),!0}},{key:"MarkGas2Gas",value:function(_){var e=p.clone(_);e.attack_type=C.AttackType.Attack_Gas2Gas,e.depth++;var t=new T.CrushNodeEvent;t.src=new k.GridPosition(_.src),t.attack_type=C.AttackType.Attack_Gas2Gas,t.ani_batch_id=e.batch.m_self_batch_index;for(var n=d.boardViewer,a=n.NodeCount(),r=0,s;r<a;r++)s=n.GetNodeIndex(r),s&&s.Crush(e)&&t.nodes.push(new k.GridPosition(s.GetPosition()));d.eventManager.Forward(t)}},{key:"MarkByAttackType",value:function(a,e){var t=p.clone(a);t.attack_type=e,t.depth++;var n=new T.CrushNodeEvent;n.src=new k.GridPosition(a.src),n.attack_type=e,n.ani_batch_id=a.batch.m_self_batch_index,n.nodes=v.GetAttackRange(e,a.src),v.CrushNodesByPosVec(t,n.nodes),d.eventManager.Forward(n)}},{key:"MarkAllSpecial",value:function(l,e,t){for(var n=[],a=[],r=d.boardViewer,i=r.NodeCount(),y=0,_;y<i;y++){_=r.GetNodeIndex(y);var o,u;o=_.ToChessData(),u=p.clone(o),t!=C.ChessType.CT_SpecialHorizontalShockWave&&t!=C.ChessType.CT_SpecialVerticalShockWave||(t=0==E.PuzzleRand("sp(695)")%2?C.ChessType.CT_SpecialHorizontalShockWave:C.ChessType.CT_SpecialVerticalShockWave),u.type=t,s(_,l,e,n,a)&&(_.AddChess(t,e),_.MarkChess(l.join),d.dataCollector.addSpecialChess(_.ToChessData()))}var c=new T.CrushNodeEvent;c.src=new k.GridPosition(l.src),c.attack_type=C.AttackType.Attack_GasSpecial,c.ani_batch_id=l.batch.m_self_batch_index,c.nodes=a,d.eventManager.Forward(c);for(var S=k.GAS_MARK_OTHER_ITEM_EXTRA_INTER_VALUE,h=n.length,N=0;N<h;N++){d.dataCollector.endOneRemove(),d.dataEventManager.trigger(I.END_ONE_REMOVE_ROUND);var O=p.clone(l);O.attack_type=C.AttackType.Attack_GasSpecial,O.depth++,O.other=new k.GridPosition(-1,-1),d.dataCollector.startOneRemove(O.attack_type,1,1),n[N].MarkChess(0),n[N].Crush(O),d.dataCollector.endOneRemove(),d.curBoard.handleSpecialBomb(1),S+=k.GAS_MARK_OTHER_ITEM_EXTRA_INTER_VALUE}d.stateMachine.gas_special_swap_flag=!0}},{key:"MarkGasExplosion",value:function(_,e){var t=new T.CrushNodeEvent;t.src=new k.GridPosition(_.src),t.attack_type=C.AttackType.Attack_Gas,t.ani_batch_id=_.batch.m_self_batch_index;for(var n=d.boardViewer,a=n.NodeCount(),r=0,s;r<a;r++)s=n.GetNodeIndex(r),s&&s.ChessColor()==e&&(s.IsStaticItemCandyPaper()||s.GetMark()||(C.ChessType.CT_NormalUnit==s.ChessType()||C.ChessType.CT_STEPBONUS==s.ChessType()||C.ChessType.CT_TICKBOMB==s.ChessType()||C.ChessType.CT_Chameleon==s.ChessType()||C.ChessType.CT_SodaBottle==s.ChessType()?s.Crush(_)&&s.GetMark():s.Crush(_),t.nodes.push(new k.GridPosition(s.GetPosition()))));d.eventManager.Forward(t)}}]),l}(c.BasicChess),f=function(){function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;G(this,o),this.func=e,this.chess=t,this.info=n,this.data=a}return _(o,[{key:"Bomb",value:function(){this.data?this.func(this.chess,this.info,this.data):this.func(this.chess,this.info)}}]),o}(),b=function(r){function s(){G(this,s);var a=o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return a.listener_=null,a}return a(s,r),_(s,[{key:"Init",value:function(a){return n(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"Init",this).call(this,a),this.RegisterChess(C.ChessType.CT_SpecialHorizontalShockWave),this.RegisterChess(C.ChessType.CT_SpecialVerticalShockWave),this.RegisterChess(C.ChessType.CT_SpecialGas),this.RegisterChess(C.ChessType.CT_SpecialHurricane),this.listener_=new m,d.eventManager.AddEventListener(this.listener_,T.EventPri.kEventPriSpecialChess),this.isUsePool=!0,this.isUsePool&&this.PreAllocChess(10,function(){return new w(null)}),!0}},{key:"Release",value:function(){d.eventManager.RemoveListener(this.listener_),this.listener_=null,n(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"Release",this).call(this)}},{key:"NewChess",value:function(a){var e=null;return this.isUsePool?(e=this.GetChessFromPool(),e?e.PreInit(a):e=new w(a)):e=new w(a),e}}]),s}(l);P.exports={SpecialChessListener:m,SpecialMethod:v,CombinationSpecial:B,SpecialChess:w,SpecialChessBomb:f,SpecialChessModule:b}},function(C,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function o(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==typeof o||"function"==typeof o)?o:a}function a(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var r=function _(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:_(a,t,n)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(n)},i=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),s=s||t(38),_=_||t(32),l=l||t(17),d=d||t(13),p=function(_){function e(){return n(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return a(e,_),i(e,[{key:"CheckJoin",value:function(_,e,t,n){var o=_.GetNode(e.row,e.col);if(!o.CanJoin3Crush())return!1;var a=!1;3<=this.CheckRowJoin(_,e,t,n)?a=!0:n&&n.splice(0,n.length);var r=0;if(n&&(r=n.length),3<=this.CheckColJoin(_,e,t,n))a=!0;else if(n){var i=n.length-r;n.splice(r,i)}return a}},{key:"GetDirectionCount",value:function(){return 4}},{key:"GetAround",value:function(_,e){for(var t=[new l.GridPosition(-1,0),new l.GridPosition(1,0),new l.GridPosition(0,-1),new l.GridPosition(0,1)],a=0,r,n;4>a;a++)r=_.row+t[a].row,n=_.col+t[a].col,e.push(new l.GridPosition(r,n))}},{key:"NextDropPosition",value:function(a){return new l.GridPosition(a.row+1,a.col)}},{key:"NextSideDropPosition",value:function(a){return new l.GridPosition(a.row+1,a.col)}},{key:"CheckRowJoin",value:function(_,e,t,n){for(var o=e.col,a=e.col,r=e.col-1;0<=r&&_.CheckPosJoin(e.row,r,t);r--)o=r,n&&n.push(new l.GridPosition(e.row,r));for(var i=_.Col(),r=e.col+1;r<i&&_.CheckPosJoin(e.row,r,t);r++)a=r,n&&n.push(new l.GridPosition(e.row,r));return a-o+1}},{key:"CheckColJoin",value:function(_,e,t,n){for(var o=_.Row(),a=e.row,r=e.row,i=e.row-1;0<=i&&_.CheckPosJoin(i,e.col,t);i--)a=i,n&&n.push(new l.GridPosition(i,e.col));for(var i=e.row+1;i<o&&_.CheckPosJoin(i,e.col,t);i++)r=i,n&&n.push(new l.GridPosition(i,e.col));return r-a+1}}]),e}(_.CoreRule),T=function(s){function l(){n(this,l);var a=o(this,(l.__proto__||Object.getPrototypeOf(l)).call(this));return a.rule_=null,a}return a(l,s),i(l,[{key:"Init",value:function(a){return r(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"Init",this).call(this,a),this.rule_=new p,this.rule_.set_rule_type(_.RuleType.kCoreRule),d.ruleManager.AddRule(this.rule_),!0}},{key:"Release",value:function(){}}]),l}(s);C.exports={GameRule4:p,WE4CoreModule:T}},function(S,e,t){"use strict";function N(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function o(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==typeof o||"function"==typeof o)?o:a}function a(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var n=function _(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:_(a,t,n)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(n)},r=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),i=i||t(17),_=_||t(12),s=s||t(11),u=u||t(13),l=l||t(24),c=c||t(39),E=E||t(38),C=C||t(23),p=p||t(33),d=function(n){function s(){N(this,s);var a=o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return a.m_iCurCollect=0,a.m_iCurBubble=0,a.m_iCurBell=0,a.m_iGeIndex=0,a.m_iCurRand=0,a.m_bCollectRemainDopped=!1,a.m_bSodaBubbleRemainDopped=!1,a.m_bBellCycleDopped=!1,a.m_bSodaBubbleCycleDopped=!1,a}return a(s,n),r(s,[{key:"OnEvent",value:function(a){switch(a.event_id){case p.PuzzleEvent.kEventSlide:case p.PuzzleEvent.kEventUseItem:this.ResetStepDropFlg();break;case p.PuzzleEvent.kEventCrushDropState:this.CalcuCurRemainChess();}}},{key:"CalcuCurRemainChess",value:function(){this.m_iCurCollect=0,this.m_iCurBubble=0,this.m_iCurBell=0,this.m_iGeIndex=0,this.m_iCurRand=0;for(var a=0,e=null,t=u.boardViewer.NodeCount(),n=0;n<t;n++)e=u.boardViewer.GetNodeIndex(n),e.HasChessType(_.ChessType.CT_SodaBottle)?this.m_iCurBubble++:e.HasChessType(_.ChessType.CT_COLLECTBALLOON)?this.m_iCurCollect++:e.HasOneOf(_.ChessType.STIT_SMALL_BELL)||e.HasOneOf(_.ChessType.STIT_BIG_BELL)||e.HasOneOf(_.ChessType.STIT_Chameleon_SMALL_BELL)||e.HasOneOf(_.ChessType.STIT_Chameleon_BIG_BELL)?this.m_iCurBell++:e.IsChessGridEmpty()&&e.IsAvailable()&&a++;3<a&&(a=3,this.m_iCurRand=l.PuzzleRand("dp(73)")%a)}},{key:"ResetStepDropFlg",value:function(){this.m_bCollectRemainDopped=!1,this.m_bSodaBubbleRemainDopped=!1,this.m_bBellCycleDopped=!1,this.m_bSodaBubbleCycleDopped=!1}},{key:"MatchRand",value:function(){return this.m_iGeIndex>=this.m_iCurRand}},{key:"GetCurCollect",value:function(){return this.m_iCurCollect}},{key:"GetCurBubble",value:function(){return this.m_iCurBubble}},{key:"GetCurBell",value:function(){return this.m_iCurBell}},{key:"IncGeIndex",value:function(){this.m_iGeIndex++}}]),s}(p.EventListener),h=function(E){function C(a,e){N(this,C);var t=o(this,(C.__proto__||Object.getPrototypeOf(C)).call(this,a));return t.dropModule=e,t.listenner_=null,t.m_bIsFloat=!1,t}return a(C,E),r(C,[{key:"PreInit",value:function(a){n(C.prototype.__proto__||Object.getPrototypeOf(C.prototype),"PreInit",this).call(this,a)}},{key:"Release",value:function(){}},{key:"Generate",value:function(a,e){var t=this.InternalGenerate(a,e);return t&&this.listenner_.IncGeIndex(),t}},{key:"Backup",value:function(){var a=n(C.prototype.__proto__||Object.getPrototypeOf(C.prototype),"Backup",this).call(this);return a}},{key:"Restore",value:function(a){n(C.prototype.__proto__||Object.getPrototypeOf(C.prototype),"Restore",this).call(this,a)}},{key:"SetNode",value:function(a){n(C.prototype.__proto__||Object.getPrototypeOf(C.prototype),"SetNode",this).call(this,a),a.SetChessGenerator(this)}},{key:"SetListenner",value:function(a){this.listenner_=a}},{key:"NeedDrop",value:function(a,e,t){var n=!1;return!(-1==a&&!this.m_bIsFloat||-2==a&&this.m_bIsFloat||-10==a?n=!0:e==a&&(n=!0),!(n&&this.listenner_&&this.listenner_.MatchRand()))&&(t===s.APPEAR_RULE_TYPE.APPEAR_COLLECT_STEP||t===s.APPEAR_RULE_TYPE.APPEAR_EXTRASTEP_STEP||t===s.APPEAR_RULE_TYPE.APPEAR_CHANGE_COLOR_STEP||t===s.APPEAR_RULE_TYPE.APPEAR_BOBOTOU_STEP||t===s.APPEAR_RULE_TYPE.APPEAR_EXTRATIME_STEP||t===s.APPEAR_RULE_TYPE.APPEAR_STEPBOMB_STEP||t===s.APPEAR_RULE_TYPE.APPEAR_SODA_BUBBLE_STEP||t===s.APPEAR_RULE_TYPE.APPEAR_JINGLE_BELL_STEP||t===s.APPEAR_RULE_TYPE.APPEAR_GOLD_COIN_STEP||(t===s.APPEAR_RULE_TYPE.APPEAR_COLLECT_REMAIN?!this.listenner_.m_bCollectRemainDopped:t===s.APPEAR_RULE_TYPE.APPEAR_SODA_BUBBLE_REMAIN?!this.listenner_.m_bSodaBubbleRemainDopped:t===s.APPEAR_RULE_TYPE.APPEAR_JINGLE_BELL_CIRCLE?!this.listenner_.m_bBellCycleDopped:t===s.APPEAR_RULE_TYPE.APPEAR_SODA_BUBBLE_CIRCLE&&!this.listenner_.m_bSodaBubbleCycleDopped))}},{key:"NeedProbDrop",value:function(a,e){if(-1==a){if(!this.m_bIsFloat)return!0;}else if(-2==a){if(this.m_bIsFloat)return!0;}else if(e==a||-10==a)return!0;return!1}},{key:"AddNormalOrGiftChessType",value:function(a,e,t){if(!this.CanDropGift())return void a.AddChessType(_.ChessType.CT_NormalUnit,null,e[l.PuzzleRand("dp(202)")%t])}},{key:"InternalGenerate",value:function(_,e){var t=[i.MovingItemType.MIT_0,i.MovingItemType.MIT_1,i.MovingItemType.MIT_2,i.MovingItemType.MIT_3,i.MovingItemType.MIT_4,i.MovingItemType.MIT_5];this.m_bIsFloat=e;var n=u.stageManager.config(),o=n.chess_color;(0>=o||o>t.length)&&(o=t.length);var a=n.threestar_score;if(0>=a&&u.curBoard.GetGameState()==i.PuzzleGameState.PGS_LASTPANG&&(o=t.length),0>=n.appear_rule.length)return this.AddNormalOrGiftChessType(_,t,o),!0;for(var r=u.boardViewer.Col(),c=new i.GridPosition(_.GetWorldPosition()),h=c.row*r+c.col,E=u.stageManager.GetMaxStep()-u.stageManager.GetRemainStep(),C=this.listenner_.GetCurCollect(),p=this.listenner_.GetCurBubble(),d=this.listenner_.GetCurBell(),T=this.dropModule.GetCopyRule(),I=T.length,y=0;y<I;y++){var S=T[y],N=T[y];switch(S.appear_type){case s.APPEAR_RULE_TYPE.APPEAR_EXTRASTEP_STEP:case s.APPEAR_RULE_TYPE.APPEAR_CHANGE_COLOR_STEP:case s.APPEAR_RULE_TYPE.APPEAR_BOBOTOU_STEP:case s.APPEAR_RULE_TYPE.APPEAR_EXTRATIME_STEP:case s.APPEAR_RULE_TYPE.APPEAR_STEPBOMB_STEP:case s.APPEAR_RULE_TYPE.APPEAR_SODA_BUBBLE_STEP:case s.APPEAR_RULE_TYPE.APPEAR_JINGLE_BELL_STEP:case s.APPEAR_RULE_TYPE.APPEAR_GOLD_COIN_STEP:case s.APPEAR_RULE_TYPE.APPEAR_COLLECT_STEP:if(E>=S.appear_data1){var L=S.appear_pos;if(this.NeedDrop(L,h,S.appear_type)){var A=S.appear_element;if(_.AddChessByElement(A,!0))return N.appear_type=s.APPEAR_RULE_TYPE.APPEAR_RULE_INVALID,!0}}break;case s.APPEAR_RULE_TYPE.APPEAR_SODA_BUBBLE_REMAIN:if(p<=S.appear_data1&&E>=S.appear_data2){var L=S.appear_pos;if(this.NeedDrop(L,h,S.appear_type)){var A=S.appear_element;if(_.AddChessByElement(A,!0))return this.listenner_.m_bSodaBubbleRemainDopped=!0,!0}}break;case s.APPEAR_RULE_TYPE.APPEAR_COLLECT_REMAIN:if(C<=S.appear_data1&&E>=S.appear_data2){var A=S.appear_element,L=S.appear_pos;if(this.NeedDrop(L,h,S.appear_type)&&_.AddChessByElement(A,!0))return this.listenner_.m_bCollectRemainDopped=!0,!0}break;case s.APPEAR_RULE_TYPE.APPEAR_CHANGE_COLOR_PROBABILITY:case s.APPEAR_RULE_TYPE.APPEAR_BOBOTOU_PROBABILITY:case s.APPEAR_RULE_TYPE.APPEAR_EXTRATIME_PROBABILITY:case s.APPEAR_RULE_TYPE.APPEAR_STEPBOMB_PROBABILITY:case s.APPEAR_RULE_TYPE.APPEAR_JINGLE_BELL_PROBABILITY:case s.APPEAR_RULE_TYPE.APPEAR_GOLD_COIN_PROBABILITY:case s.APPEAR_RULE_TYPE.APPEAR_EXTRASTEP_PROBABILITY:var m=l.PuzzleRand("dp(351)")%100;if(m<S.appear_data1){var L=S.appear_pos;if(this.NeedProbDrop(L,h)){var A=S.appear_element;if(_.AddChessByElement(A,!0))return!0}}break;case s.APPEAR_RULE_TYPE.APPEAR_GOHOME_MOSTER_RISE_AGAIN:case s.APPEAR_RULE_TYPE.APPEAR_GOHOME_MOSTER_PER_PET_WALKSTEP:case s.APPEAR_RULE_TYPE.APPEAR_GOHOME_MOSTER_PER_USER_FINGERSLIDING:case s.APPEAR_RULE_TYPE.APPEAR_GOHOME_MOSTER_USER_FINGERSLIDING:break;case s.APPEAR_RULE_TYPE.APPEAR_SODA_BUBBLE_CIRCLE:if(p<=S.appear_data1){var L=S.appear_pos;if(this.NeedDrop(L,h,S.appear_type)){var A=S.appear_element;if(_.AddChessByElement(A,!0))return this.listenner_.m_bSodaBubbleCycleDopped=!0,!0}}break;case s.APPEAR_RULE_TYPE.APPEAR_JINGLE_BELL_CIRCLE:if(d<=S.appear_data1){var L=S.appear_pos;if(this.NeedDrop(L,h,S.appear_type)){var A=S.appear_element;if(_.AddChessByElement(A,!0))return this.listenner_.m_bBellCycleDopped=!0,!0}}}}return this.AddNormalOrGiftChessType(_,t,o),!0}},{key:"CanDropGift",value:function(){return!(1<=1)}}]),C}(c.BasicChess),O=function(s){function i(){N(this,i);var a=o(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return a.copyAppearRule=[],a.appear_rule_backup_=[],a.listenner_=null,a}return a(i,s),r(i,[{key:"Init",value:function(a){return n(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"Init",this).call(this,a),this.listenner_=null,this.copyAppearRule=[],C.arrayDeepCopy(this.copyAppearRule,u.stageManager.config().appear_rule),this.RegisterChess(_.ChessType.STIT_DROP_POINT),this.RegisterChess(_.ChessType.STIT_DROP_POINT_IN_SODA),!0}},{key:"NewChess",value:function(a){this.newChessCount++,null==this.listenner_&&(this.listenner_=new d,this.listenner_&&u.eventManager.AddEventListener(this.listenner_,p.EventPri.kEventPriDropPoint));var e=new h(a,this);return e&&e.SetListenner(this.listenner_),e}},{key:"GetCopyRule",value:function(){return this.copyAppearRule}},{key:"Release",value:function(){this.listenner_&&(this.listenner_=null),n(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"Release",this).call(this)}},{key:"Save",value:function(){}},{key:"Load",value:function(){}}]),i}(E);S.exports={DropListener:d,DropPoint:h,DropPointModule:O}},function(T,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function o(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==typeof o||"function"==typeof o)?o:a}function a(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var r=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),i=function _(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:_(a,t,n)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(n)},s=s||t(38),_=_||t(39),l=l||t(12),I=I||t(13),c=c||t(40),u=function(_){function s(a){return n(this,s),o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,a))}return a(s,_),r(s,[{key:"PreInit",value:function(a){i(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"PreInit",this).call(this,a)}},{key:"Release",value:function(){}},{key:"CanCrush",value:function(a){if(this.CrushMark()==a.join||0<this.CrushMark())return!1;if(!this.ValidAttack(a))return!1;var e=this.Attribute().Layer+1;if(e>=l.ChessLayer.kChessLayerNum)return!1;var t=this.GetNode().GetChess(e);return null!=t&&!!t.Attribute().CanAttackIce&&0!=t.CrushMark()}}]),s}(_.BasicChess),y=function(_){function e(){return n(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,l.ChessType.STIT_DEEPICE))}return a(e,_),r(e,[{key:"NextType",value:function(){return this.GetNode().HasChessType(l.ChessType.STIT_COLLECT_UNDER_ICE)?l.ChessType.STIT_ICE_BEAR_UNDER:l.ChessType.STIT_ICE}},{key:"Crush",value:function(){return this.CreateNextChess(),I.dataCollector.addChangedBgChess(this.ToChangedData()),!0}}]),e}(u),S=function(_){function s(a){return n(this,s),o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,a))}return a(s,_),r(s,[{key:"Crush",value:function(a){var e=i(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"Crush",this).call(this,a);if(e){I.dataCollector.addCrushBgChess(this.ToChessData());var t=this.GetPosition();this.GetNode().RemoveChess(l.ChessType.STIT_COLLECT_UNDER_ICE),c.PuzzleIceBearUtil.GetInstance().CollectUnderIceThing(t.row,t.col,a.batch.m_self_batch_index)}return e}}]),s}(u),N=function(_){function s(){return n(this,s),o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this))}return a(s,_),r(s,[{key:"Init",value:function(a){i(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"Init",this).call(this,a),this.RegisterChess(l.ChessType.STIT_ICE),this.RegisterChess(l.ChessType.STIT_DEEPICE),this.RegisterChess(l.ChessType.STIT_ICE_BEAR_UNDER)}},{key:"NewChess",value:function(a){return a==l.ChessType.STIT_ICE||a==l.ChessType.STIT_ICE_BEAR_UNDER?(this.newChessCount++,new S(a)):a==l.ChessType.STIT_DEEPICE?(this.newChessCount++,new y):null}}]),s}(s);T.exports={IceChess:u,DeepIce:y,NormalIce:S,IceModule:N}},function(O,e,t){"use strict";function L(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function o(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==typeof o||"function"==typeof o)?o:a}function a(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}function r(l,e){var t=l,n=t.GetPosition().row,o=t.GetPosition().col,a=C.boardViewer.Col(),r=n-2;0>r&&(r=0);var E=o-2;0>E&&(E=0);var s=E,_=o+2;for(_>a&&(_=a-1),e.attack_type=m.AttackType.Attack_Bomb;r<=n;r++)for(E=s;E<=_;E++)if(n!=r||o!=E){var d=C.boardViewer.GetNode(r,E);null!=d&&d.Crush(e)}}var i=function _(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:_(a,t,n)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(n)},n=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),_=_||t(39),s=s||t(46),l=l||t(23),c=c||t(17),m=m||t(12),E=E||t(11),C=C||t(13),p=p||t(38),d=d||t(33),T={kDiggerNormal:0,kDiggerSokoban:1},I=function(_){function r(a){L(this,r);var e=o(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return e.need_handle_=!1,e.board_=a,e.m_StartRow=0,e.m_StartRowBack=0,e.m_HeighestBalloonRow=C.worldViewer.Row(),e.notify_move_=!1,e.notify_new_start_=0,e.digger_type_=T.kDiggerNormal,e}return a(r,_),n(r,[{key:"OnEvent",value:function(a){switch(a.event_id){case d.PuzzleEvent.kEventSlide:case d.PuzzleEvent.kEventUseItem:case d.PuzzleEvent.kEventPetTalent:case d.PuzzleEvent.kEventCrushNode:this.need_handle_=!0;break;case d.PuzzleEvent.kEventBalanceState:this.need_handle_&&(this.OnBalanceState(),this.need_handle_=!1);break;case d.PuzzleEvent.kEventGameStart:this.OnGameStart();break;default:}}},{key:"Save",value:function(){this.m_StartRowBack=this.m_StartRow}},{key:"Load",value:function(){this.m_StartRow=this.m_StartRowBack,this.board_.RollingBoard(this.m_StartRow)}},{key:"SetNeedHandle",value:function(a){this.need_handle_=a}},{key:"NotifyMove",value:function(a){0>a&&(a=0);var e=C.stageManager.Row()-C.stageManager.ScreenRow();a>e&&(a=e),this.notify_move_=!0,this.notify_new_start_=a}},{key:"Release",value:function(){}},{key:"OnGameStart",value:function(){this.RefreshData(),this.board_.RollingBoard(this.m_StartRow)}},{key:"OnBalanceState",value:function(){var E=0,e={newStartRow:0},t=!1,n=this.GetSodaMoveNewStartRow(e),o=this.GetStoneMoveNewStartRow(e);if(n||o?(E=this.board_.GetStartRow(),t=!0):this.notify_move_&&(E=this.m_StartRow,this.notify_move_=!1,e.newStartRow=this.notify_new_start_,E!=e.newStartRow&&(t=!0),this.m_StartRow=e.newStartRow),t){this.m_StartRow=this.CalculateBoardStartRow();var a=new d.DiggerMoveEvent;if(C.eventManager.Forward(a),this.board_.RollingBoard(e.newStartRow),C.aniManager.GenerateRollingBoardAni(E,e.newStartRow),n)for(var r=C.boardViewer.Row(),i=C.boardViewer.Col(),s=[],_=0;_<r;++_)for(var l=0;l<i;++l){var p=C.boardViewer.GetNode(_,l),T=!0;p&&(T=!p.HasChessType(m.ChessType.STIT_LOCKER)&&!p.IsAvailable()),s.push(T)}a.move_state=1,C.eventManager.Forward(a),this.board_.BreakBalance()}}},{key:"GetFirstCloudLine",value:function(){for(var _=C.stageManager.Row(),e=C.stageManager.Col(),t=this.m_StartRow;t<_;t++)for(var n=0,o;n<e;n++)if(o=this.board_.GetWorldNode(new c.GridPosition(t,n)),o.HasOneOf(m.ChessType.STIT_COMMONCLOUD1)||o.HasOneOf(m.ChessType.STIT_COMMONCLOUD2)||o.HasOneOf(m.ChessType.STIT_STONECLOUD1)||o.HasOneOf(m.ChessType.STIT_STONECLOUD2)||o.HasOneOf(m.ChessType.STIT_REDPACKET1)||o.HasOneOf(m.ChessType.STIT_REDPACKET2))return t;return-1}},{key:"GetFirstBombLine",value:function(){for(var _=C.stageManager.Row(),e=C.stageManager.Col(),t=this.m_StartRow;t<_;t++)for(var n=0,o;n<e;n++)if(o=this.board_.GetWorldNode(new c.GridPosition(t,n)),o.HasChessType(m.ChessType.STIT_DONUTSBOMB))return t;return-1}},{key:"CalculateSodaStartRow",value:function(){var a=C.stageManager.PlayType();if(E.PUZZLE_PLAYTYPE.PLAY_TYPE_DIGGER_SODA!=a)return-1;if(this.m_HeighestBalloonRow==C.stageManager.Row())return-1;var e=this.m_HeighestBalloonRow<C.envManager.GetSodaLine()?2:C.stageManager.ScreenRow()-3;var t=this.m_HeighestBalloonRow-e;return t+C.stageManager.ScreenRow()>C.stageManager.Row()&&(t=C.stageManager.Row()-C.stageManager.ScreenRow()),0>t&&(t=0),t}},{key:"RefreshHeighestBalloonRow",value:function(){this.m_HeighestBalloonRow=C.stageManager.Row();for(var a=null,e=C.worldViewer,t=e.NodeCount(),n=0;n<t;n++)a=e.GetNodeIndex(n),(a.ChessType()==m.ChessType.CT_COLLECTBALLOON||a.HasChessType(m.ChessType.STIT_LOCKER))&&this.m_HeighestBalloonRow>a.GetWorldPosition().row&&(this.m_HeighestBalloonRow=a.GetWorldPosition().row)}},{key:"CalculateStoneStartRow",value:function(){if(C.stageManager.PlayType()!=E.PUZZLE_PLAYTYPE.PLAY_TYPE_DIGGER_ONEBYONE&&C.stageManager.PlayType()!=E.PUZZLE_PLAYTYPE.PLAY_TYPE_DIGGER_MOSHING)return-1;var _=C.stageManager.Row(),e=C.stageManager.ScreenRow();if(-1==this.m_StartRow)return 0;var t=this.GetFirstCloudLine(),n=this.GetFirstBombLine(),o=-1;if(-1!=t){if(4<this.m_StartRow+e-t)return this.m_StartRow;o=-1!=n&&t+3>=n?n-e+1:t+3-e+1}else o=-1==n?_-e:n-e+1;return 0>o?this.m_StartRow:o+e-1>=_&&(o=_-e,0>o)?0:o}},{key:"GetSodaMoveNewStartRow",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{newStartRow:0},e=C.stageManager.PlayType();return E.PUZZLE_PLAYTYPE.PLAY_TYPE_DIGGER_SODA==e&&(this.RefreshHeighestBalloonRow(),a.newStartRow=this.CalculateSodaStartRow(),!(a.newStartRow==this.m_StartRow||0>a.newStartRow))}},{key:"GetStoneMoveNewStartRow",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{newStartRow:0};return(C.stageManager.PlayType()==E.PUZZLE_PLAYTYPE.PLAY_TYPE_DIGGER_ONEBYONE||C.stageManager.PlayType()==E.PUZZLE_PLAYTYPE.PLAY_TYPE_DIGGER_MOSHING)&&(a.newStartRow=this.CalculateStoneStartRow(),!(a.newStartRow==this.m_StartRow||0>a.newStartRow))}},{key:"CalculateBoardStartRow",value:function(){var a=0;switch(C.stageManager.PlayType()){case E.PUZZLE_PLAYTYPE.PLAY_TYPE_DIGGER_SODA:a=this.CalculateSodaStartRow();break;case E.PUZZLE_PLAYTYPE.PLAY_TYPE_DIGGER_ONEBYONE:case E.PUZZLE_PLAYTYPE.PLAY_TYPE_DIGGER_MOSHING:a=this.CalculateStoneStartRow();}return this.digger_type_==T.kDiggerSokoban&&(a=this.notify_new_start_),a}},{key:"RefreshData",value:function(){if(C.stageManager.IsDiggerType()){for(var a=null,e=C.worldViewer,t=e.NodeCount(),n=0;n<t;n++)if(a=e.GetNodeIndex(n),a.HasChessType(m.ChessType.STIT_SOKOBAN_MAN)){this.digger_type_=T.kDiggerSokoban;break}this.RefreshHeighestBalloonRow(),this.m_StartRow=this.CalculateBoardStartRow()}}},{key:"GetStartRow",value:function(){return this.m_StartRow}}],[{key:"MoveScreen",value:function(a,e){a.isEqual(e)}}]),r}(d.BoardEventListener),u=function(_){function E(){return L(this,E),o(this,(E.__proto__||Object.getPrototypeOf(E)).call(this,m.ChessType.STIT_DONUTSBOMB))}return a(E,_),n(E,[{key:"PreInit",value:function(a){i(E.prototype.__proto__||Object.getPrototypeOf(E.prototype),"PreInit",this).call(this,a)}},{key:"Release",value:function(){}},{key:"Crush",value:function(a){var e=this.ToChessData();C.dataCollector.addCrushChess(e);var t=C.eventManager.FindListener(d.EventKey.kEventKeyDigger);t&&t.SetNeedHandle(!0);var n=l.clone(a);return n.around_attack=!1,C.curBoard.cacheSpecialBomb(new s.SpecialChessBomb(r,this,n)),!0}}]),E}(_.BasicChess),h=function(_){function r(){L(this,r);var a=o(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return a.listener_=null,a}return a(r,_),n(r,[{key:"Init",value:function(a){if(i(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"Init",this).call(this,a),this.RegisterChess(m.ChessType.STIT_DONUTSBOMB),C.stageManager.IsDiggerType()?(this.listener_=new I(a),C.eventManager.AddEventListener(this.listener_,d.EventPri.kEventPriDigger,d.EventKey.kEventKeyDigger)):this.listener_=null,C.envManager.SetSodaLine(C.stageManager.Row()),C.stageManager.IsSodaGame()){var e=C.stageManager.GetDescValue(E.DESC_TYPE.DESC_SODA_LINE);-1==e&&(e=0);var t=C.stageManager.Row()-e;C.envManager.SetSodaLine(t)}return!0}},{key:"Release",value:function(){this.listener_&&C.eventManager.RemoveListener(this.listener_),this.listener_=null,i(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"Release",this).call(this)}},{key:"NewChess",value:function(a){return a==m.ChessType.STIT_DONUTSBOMB?(this.newChessCount++,new u):null}}],[{key:"GetBoardStartRow",value:function(){var a=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],e=C.moduleManager.FindModule(r.sModuleName);return e&&e.listener_?(a&&e.listener_.RefreshData(),e.listener_.GetStartRow()):0}}]),r}(p);h.sModuleName="DiggerModule",O.exports={DiggerListener:I,DonutsBomb:u,DiggerModule:h}},function(S,e,t){"use strict";function N(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function o(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==typeof o||"function"==typeof o)?o:a}function a(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}function O(a,e){return a.row>e.row?-1:a.row<e.row?1:a.col>e.col?-1:a.col<e.col?1:0}function i(a,e){return a.row<e.row?-1:a.row>e.row?1:a.col<e.col?-1:a.col>e.col?1:0}var n=function _(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:_(a,t,n)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(n)},_=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),L=L||t(33),u=u||t(12),c=c||t(17),r=r||t(38),E=E||t(13),s=s||t(39),l=l||t(23),C=function(n){function e(){N(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return a.RequestEvent(L.PuzzleEvent.kEventCrushNode),a}return a(e,n),_(e,[{key:"OnEvent",value:function(C){if(E.curBoard.GetGameState()!=c.PuzzleGameState.PGS_LASTPANG&&C.event_id==L.PuzzleEvent.kEventCrushNode){var e=C;if(!e.around_attack){var t=E.boardViewer.GetNode(e.src),n=u.ChessType.STIT_BLUEBERRY,o=this.GetOppositeBlueberry(n);if(e.attack_type==u.AttackType.Attack_Normal)return this.AddNormal(e,n),void this.AddNormal(e,o);if(t.HasChessType(u.ChessType.STIT_BLUEBERRY))n=u.ChessType.STIT_BLUEBERRY;else{if(!t.HasChessType(u.ChessType.STIT_BAD_BLUEBERRY))return;n=u.ChessType.STIT_BAD_BLUEBERRY}o=this.GetOppositeBlueberry(n);var a=[];if(e.attack_type==u.AttackType.Attack_HorizontalShockWave||e.attack_type==u.AttackType.Attack_VerticalShockWave||e.attack_type==u.AttackType.Attack_CrossShockWave)a=this.ClassifyNodesByDirection(e.src,e.nodes,a),this.HandleDirectionalCrush(e.ani_batch_id,a,n);else if(e.attack_type==u.AttackType.Attack_ThickCrossShockWave){var r=[];r.push(l.clone(e.src)),r.push(new c.GridPosition(e.src.row-1,e.src.col)),r.push(new c.GridPosition(e.src.row+1,e.src.col)),r.push(new c.GridPosition(e.src.row,e.src.col+1)),r.push(new c.GridPosition(e.src.row,e.src.col-1)),a=[,,,,,];for(var i=0;5>i;++i)a[i]=[],a[i]=this.ClassifyNodesByDirection(r[i],e.nodes,a[i]),this.HandleDirectionalCrush(e.ani_batch_id,a[i],n)}else for(var s=0,_;s<e.nodes.length;s++)_=E.boardViewer.GetNode(e.nodes[s]),null!=_&&_.CanSetBlueberry()&&(_.HasChessType(n)||(this.RemoveOppositeBlueberry(_,n),_.AddChess(n),E.dataCollector.addBgChess(_.ToChessData(0))))}}}},{key:"AverageBlueberry",value:function(){}},{key:"AddNormal",value:function(_,e){var t=!1,a=_.nodes.length,r,n;for(r=0;r<a;r++)if(n=E.boardViewer.GetNode(_.nodes[r]),n.HasChessType(e)&&!(n.HasOneOf(u.ChessType.STIT_CAGE)||n.HasOneOf(u.ChessType.STIT_CAGE2)||n.HasOneOf(u.ChessType.STIT_FOAM_CELL))){t=!0;break}if(t)for(r=0;r<a;r++)n=E.boardViewer.GetNode(_.nodes[r]),n.CanSetBlueberry()&&(n.HasChessType(e)||(this.RemoveOppositeBlueberry(n,e),n.AddChess(e),E.dataCollector.addBgChess(n.ToChessData(0))))}},{key:"ClassifyNodesByDirection",value:function(s,e,t){for(var n=[],o=[],a=[],r=[],_=0,l;_<e.length;_++)l=e[_],l.isEqual(s)||(l.col==s.col?l.row<s.row?n.push(new c.GridPosition(l)):l.row>s.row&&o.push(new c.GridPosition(l)):l.row==s.row&&(l.col<s.col?a.push(new c.GridPosition(l)):l.col>s.col&&r.push(new c.GridPosition(l))));return n.sort(O),a.sort(O),r.sort(i),o.sort(i),t.push(n),t.push(o),t.push(a),t.push(r),t}},{key:"HandleDirectionalCrush",value:function(_,e,t){for(var n=e.length,o=0;o<n;o++)for(var a=e[o].length,r=0,i;r<a;r++)i=E.boardViewer.GetNode(e[o][r]),null!=i&&i.CanSetBlueberry()&&(i.HasChessType(t)||(this.RemoveOppositeBlueberry(i,t),i.AddChess(t),E.dataCollector.addBgChess(i.ToChessData(0))))}},{key:"GetOppositeBlueberry",value:function(a){return a==u.ChessType.STIT_BLUEBERRY?u.ChessType.STIT_BAD_BLUEBERRY:a==u.ChessType.STIT_BAD_BLUEBERRY?u.ChessType.STIT_BLUEBERRY:u.ChessType.STIT_NONE}},{key:"RemoveOppositeBlueberry",value:function(a,e){if(null==a)return!1;var t=this.GetOppositeBlueberry(e);return!!a.HasChessType(t)&&(a.ToChessData(0),a.RemoveChess(t),!0)}}]),e}(L.BoardEventListener),d=function(r){function s(){N(this,s);var a=o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return a.listener_=null,a}return a(s,r),_(s,[{key:"Init",value:function(a){return n(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"Init",this).call(this,a),this.RegisterChess(u.ChessType.STIT_BLUEBERRY),this.RegisterChess(u.ChessType.STIT_BAD_BLUEBERRY),this.listener_=new C(a),E.eventManager.AddEventListener(this.listener_,L.EventPri.kEventPriGlobalBlueberry),!0}},{key:"Release",value:function(){E.eventManager.RemoveListener(this.listener_),this.listener_=null,n(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"Release",this).call(this)}},{key:"NewChess",value:function(a){return this.newChessCount++,new p(a)}}]),s}(r),p=function(r){function s(a){return N(this,s),o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,a,L.EventPri.kEventPriBlueberry))}return a(s,r),_(s,[{key:"PreInit",value:function(a){n(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"PreInit",this).call(this,a)}},{key:"Release",value:function(){}},{key:"Init",value:function(){}},{key:"OnEvent",value:function(){}},{key:"Backup",value:function(){}},{key:"Restore",value:function(){}},{key:"PostInit",value:function(){}}]),s}(s.BasicEventChess);S.exports={Blueberry:p,BlueberryModule:d,BlueberryListener:C}},function(d,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function o(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==typeof o||"function"==typeof o)?o:a}function a(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var r=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),i=function _(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:_(a,t,n)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(n)},s=s||t(33),_=_||t(12),l=l||t(17),T=T||t(38),I=I||t(13),c=c||t(39),E=function(E){function C(a){return n(this,C),o(this,(C.__proto__||Object.getPrototypeOf(C)).call(this,a,s.EventPri.kEventPriCandyPot))}return a(C,E),r(C,[{key:"Init",value:function(a){i(C.prototype.__proto__||Object.getPrototypeOf(C.prototype),"Init",this).call(this,a)}},{key:"Backup",value:function(){}},{key:"Restore",value:function(){}},{key:"OnEvent",value:function(a){if(a.event_id===s.PuzzleEvent.kEventCrushDropState&&this.need_put_candy_){this.need_put_candy_=!1;var e=I.boardViewer.GetNode(this.candy_pos_);if(e.CanGenerateCandy()){var t=e.ToChessData();e.AddChess(_.ChessType.CT_COLLECTCANDY),I.aniManager.GenerateReplace({replaceList:[{from:this.ToChessData(),removed:[t],created:[e.ToChessData()]}]})}}}},{key:"Crush",value:function(a){var e=(a.batch,this.GetPosition()),t=new l.GridPosition(e.row+1,e.col),n=I.boardViewer.GetNode(t);return n&&(this.need_put_candy_=!0,this.candy_pos_=t),I.aniManager.GenerateAttack(this.ToChessData()),!1}}]),C}(c.BasicEventChess),u=function(s){function l(a){return n(this,l),o(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,a))}return a(l,s),r(l,[{key:"Init",value:function(a){return i(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"Init",this).call(this,a),this.RegisterChess(_.ChessType.STIT_CANDYPOT),this.RegisterChess(_.ChessType.CT_COLLECTCANDY),!0}},{key:"NewChess",value:function(a){return a==_.ChessType.STIT_CANDYPOT?(this.newChessCount++,new E(a)):a==_.ChessType.CT_COLLECTCANDY?(this.newChessCount++,new c.BasicChess(a)):null}}]),l}(T);d.exports={CandyPotModule:u,CandyPot:E}},function(O,e,t){"use strict";function L(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function o(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==typeof o||"function"==typeof o)?o:a}function a(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}function r(_,e){var t=E.boardViewer.GetNode(_,e);if(null==t)return!1;if(!t.IsAvailable())return!1;if(null==t.GetChess())return!1;var n=[];t.GetAllChess(n);for(var o=0;o<A.ChessLayer.kChessLayerNum;o++)if(n[o]&&n[o].Attribute()&&!n[o].Attribute().CanSetMaoqiu)return!1;return!0}function n(a,e,t,n){r(e-1,t)&&n.push(new c.GridPosition(e-1,t)),r(e+1,t)&&n.push(new c.GridPosition(e+1,t)),r(e,t-1)&&n.push(new c.GridPosition(e,t-1)),r(e,t+1)&&n.push(new c.GridPosition(e,t+1))}var s=function _(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:_(a,t,n)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(n)},_=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),i=i||t(38),A=A||t(12),l=l||t(11),c=c||t(17),E=E||t(13),C=C||t(33),p=p||t(23),M=M||t(24),d=d||t(39),T=function(r){function s(a){L(this,s);var e=o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return e.board_=a,e.need_handle_=!1,e.jump_list_={},e}return a(s,r),_(s,[{key:"OnEvent",value:function(a){switch(a.event_id){case C.PuzzleEvent.kEventSlide:this.need_handle_=!0;break;case C.PuzzleEvent.kEventBalanceState:this.OnBalanceState();break;case C.PuzzleEvent.kEventGameRelease:return void delete this;default:}}},{key:"Release",value:function(){delete this}},{key:"OnBalanceState",value:function(){if(this.need_handle_&&this.board_.GetGameState()!=c.PuzzleGameState.PGS_LASTPANG){this.need_handle_=!1;for(var s=[],e=null,t=E.boardViewer.NodeCount(),C=0;C<t;C++)if(e=E.boardViewer.GetNodeIndex(C),e.HasChessType(A.ChessType.STIT_MAOQIU1))s.push(e.GetPosition());else if(e.HasChessType(A.ChessType.STIT_MAOQIU2)){var o=e.GetChess(A.ChessLayer.kChessLayer2);if(null==o)continue;if(o.need_split())continue;s.push(e.GetPosition())}if(0!=s.length){for(var a=s.length,C=0;C<a;C++){var r=s[C],i=r.row,_=r.col,l=[];if(n(this.board_,i,_,l),!(0>=l.length)){var d=M.PuzzleRand("mq(115)"),T=l.length,p=l[d%T],I=A.ChessType.STIT_MAOQIU1;E.boardViewer.HasChessType(r,A.ChessType.STIT_MAOQIU2)&&(I=A.ChessType.STIT_MAOQIU2);var u=E.boardViewer.GetNode(new c.GridPosition(i,_)),y=E.boardViewer.GetNode(new c.GridPosition(p));null!=u&&null!=y&&(E.aniManager.GenerateMaoQiuJumpAni(2,u.ToChessData(2),u.GetPosition(),p),u.MoveChessTo(I,y))}}this.board_.BreakBalance()}}}}]),s}(C.BoardEventListener),I=function(s){function i(a){L(this,i);var e=o(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.board_=a,e.split_list_={},e}return a(i,s),_(i,[{key:"OnEvent",value:function(a){switch(a.event_id){case C.PuzzleEvent.kEventBalanceState:this.OnBalanceState();break;case C.PuzzleEvent.kEventGameRelease:return void delete this;default:}}},{key:"Release",value:function(){delete this}},{key:"OnBalanceState",value:function(){if(this.board_.GetGameState()!=c.PuzzleGameState.PGS_LASTPANG){for(var s=[],e=null,t=E.boardViewer.NodeCount(),i=0;i<t;i++)if(e=E.boardViewer.GetNodeIndex(i),e.HasChessType(A.ChessType.STIT_MAOQIU2)){var o=e.GetChess(A.ChessLayer.kChessLayer2);null!=o&&o.need_split()&&(s.push(e.GetPosition()),o.set_need_split(!1))}for(var a=s.length,i=0;i<a;i++){var C=s[i],_=C.row,l=C.col,T=[];n(this.board_,_,l,T);var u=E.boardViewer.GetNode(C).ToChessData(2),p=[];if(E.boardViewer.RemoveChess(C,A.ChessType.STIT_MAOQIU2),r(_,l)&&(E.boardViewer.AddChess(C,A.ChessType.STIT_MAOQIU1),p.push(E.boardViewer.GetNode(C).ToChessData(2))),0<T.length){var d=M.PuzzleRand("mq(219)")%T.length,I=T[d];E.boardViewer.AddChess(I,A.ChessType.STIT_MAOQIU1),p.push(E.boardViewer.GetNode(I).ToChessData(2))}0<p.length&&E.aniManager.GenerateMaoQiuSplitAni(u,p)}}}}]),i}(C.BoardEventListener),u=function(n){function r(a){L(this,r);var e=o(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,a));return e.spliter_=null,e.jumper_=null,e}return a(r,n),_(r,[{key:"Init",value:function(){var a=null;this.Type()==A.ChessType.STIT_MAOQIU2&&(a=E.eventManager.FindListener(C.EventKey.kEventKeyMaoqiuSplit),null==a?(this.spliter_=new I(E.curBoard),this.AddEventListener(this.spliter_,C.EventKey.kEventPriMaoqiuSplit,C.EventKey.kEventKeyMaoqiuSplit)):this.spliter_=a),a=E.eventManager.FindListener(C.EventKey.kEventKeyMaoqiuJump),null==a?(this.jumper_=new T(E.curBoard),this.AddEventListener(this.jumper_,C.EventKey.kEventPriMaoqiuJump,C.EventKey.kEventKeyMaoqiuJump)):this.jumper_=a}},{key:"Backup",value:function(){}},{key:"Restore",value:function(){}}]),r}(d.BasicChess),h=function(n){function r(){L(this,r);var a=o(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,A.ChessType.STIT_MAOQIU2));return a.need_split_=!1,a}return a(r,n),_(r,[{key:"need_split",value:function(){return this.need_split_}},{key:"set_need_split",value:function(a){this.need_split_=a}},{key:"Crush",value:function(a){return a.batch,!this.need_split_&&(this.need_split_=!0,E.aniManager.GenerateAttack(this.ToChessData()),!1)}},{key:"Backup",value:function(){}},{key:"Restore",value:function(){}}]),r}(u),R=function(n){function r(){return L(this,r),o(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,A.ChessType.STIT_MAOQIU1))}return a(r,n),_(r,[{key:"Crush",value:function(a){var e=s(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"Crush",this).call(this,a);return e&&E.dataCollector.addCrushTopChess(this.ToChessData()),e}}]),r}(u),P=function(n){function r(){return L(this,r),o(this,(r.__proto__||Object.getPrototypeOf(r)).call(this))}return a(r,n),_(r,[{key:"Init",value:function(a){return s(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"Init",this).call(this,a),this.RegisterChess(A.ChessType.STIT_MAOQIU1),this.RegisterChess(A.ChessType.STIT_MAOQIU2),!0}},{key:"Release",value:function(){E.eventManager.RemoveListener(C.EventKey.kEventKeyMaoqiuSplit),E.eventManager.RemoveListener(C.EventKey.kEventKeyMaoqiuJump),s(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"Release",this).call(this)}},{key:"NewChess",value:function(a){return a==A.ChessType.STIT_MAOQIU1?new R:a==A.ChessType.STIT_MAOQIU2?new h:null}}]),r}(i);O.exports={MaoqiuJumpListener:T,MaoqiuSplitListener:I,Maoqiu:u,Maoqiu2:h,Maoqiu1:R,MaoqiuModule:P}},function(I,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function o(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==typeof o||"function"==typeof o)?o:a}function a(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var r=function _(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:_(a,t,n)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(n)},i=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),s=s||t(33),_=_||t(12),l=l||t(17),u=u||t(38),c=c||t(13),y=y||t(39),E=function(r){function E(a){return n(this,E),o(this,(E.__proto__||Object.getPrototypeOf(E)).call(this,a))}return a(E,r),i(E,[{key:"OnEvent",value:function(a){switch(a.event_id){case s.PuzzleEvent.kEventBalanceState:this.MushroomAction(),this.need_handle_=!1;break;case s.PuzzleEvent.kEventSlide:this.need_handle_=!0;break;case s.PuzzleEvent.kEventUseItem:this.need_handle_=!1;break;default:}}},{key:"MushroomAction",value:function(){this.need_handle_&&c.curBoard.GetGameState()!=l.PuzzleGameState.PGS_LASTPANG&&this.CreateLittleMushroomInBoard()}},{key:"SetNeedHandle",value:function(a){this.need_handle_=a}},{key:"CreateLittleMushroomInBoard",value:function(){for(var l=c.boardViewer.Row(),e=c.boardViewer.Col(),t=[],E=0;E<l;E++)for(var o=0,a;o<e;o++)if(a=c.boardViewer.GetNode(E,o),a.HasOneOf(_.ChessType.STIT_HUGEMUSHROOM)){var r=this.CreateLittleMushroom(E,o);if(r){var i=r.ToChessData();r.ClearChess(),r.AddChess(_.ChessType.STIT_LITTLEMUSHROOM),t.push({from:a.ToChessData(),removed:[i],created:[r.ToChessData()]})}}t.length&&c.aniManager.GenerateReplace({replaceList:t})}},{key:"PositionCanCreateLittleMushroom",value:function(a,e){var t=c.boardViewer.GetNode(a,e);return!!t&&!!t.CanBeReplace()&&t}},{key:"CreateLittleMushroom",value:function(_,e){for(var t=[new l.GridPosition(-1,0),new l.GridPosition(-1,1),new l.GridPosition(0,1),new l.GridPosition(1,1),new l.GridPosition(1,0),new l.GridPosition(1,-1),new l.GridPosition(0,-1),new l.GridPosition(-1,-1)],n=0;8>n;n++){var o=_+t[n].row,a=e+t[n].col,r=this.PositionCanCreateLittleMushroom(o,a);if(r)return r}return!1}}]),E}(s.BoardEventListener),S=function(l){function E(a){return n(this,E),o(this,(E.__proto__||Object.getPrototypeOf(E)).call(this,a))}return a(E,l),i(E,[{key:"Init",value:function(a){r(E.prototype.__proto__||Object.getPrototypeOf(E.prototype),"Init",this).call(this,a),this.attach_.iVal1=30,this.attach_.iVal2=30,this.attach_.iVal3=30}},{key:"ToChessData",value:function(a){var e=r(E.prototype.__proto__||Object.getPrototypeOf(E.prototype),"ToChessData",this).call(this,a),t=e.mushroom_data;return t.max_health=this.attach_.iVal1,t.current_health=this.attach_.iVal3,t.attack_value=this.attach_.iVal2,e}},{key:"Backup",value:function(){}},{key:"Crush",value:function(a){return this.Attack(a)}},{key:"UseItemHammer",value:function(a){return this.Attack(a)}},{key:"FishMissle",value:function(a){return this.Attack(a)}},{key:"Attack",value:function(r){var e=0;switch(r.attack_type){case _.AttackType.Attack_BigHurricane:e=20;break;case _.AttackType.Attack_VerticalShockWave:case _.AttackType.Attack_HorizontalShockWave:case _.AttackType.Attack_ThickCrossShockWave:case _.AttackType.Attack_Hurricane:case _.AttackType.Attack_CrossShockWave:case _.AttackType.Attack_Disappear:case _.AttackType.Attack_Gas2Gas:case _.AttackType.Attack_Bomb:e=10;break;case _.AttackType.Attack_Normal:case _.AttackType.Attack_Gas:case _.AttackType.Attack_Lastpang:e=3;break;default:return!1;}var t=(r.batch,this.GetNode().GetPosition(),this.GetNode().FindAttach(this.Attribute().ChessType));if(null==t)return!1;var n=c.eventManager.FindListener(s.EventKey.kEventKeyMushroom);n&&n.SetNeedHandle(!1);var o=t.iVal3-e;return t.iVal3=0>=o?0:o,t.iVal2=e,c.aniManager.GenerateAttack(this.ToChessData()),0>=t.iVal3&&(c.dataCollector.addCrushChess(this.ToChessData()),!0)}}]),E}(y.BasicChess),N=function(_){function l(a){return n(this,l),o(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,a))}return a(l,_),i(l,[{key:"Crush",value:function(a){var e=r(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"Crush",this).call(this,a);if(e){var t=c.eventManager.FindListener(s.EventKey.kEventKeyMushroom);t&&t.SetNeedHandle(!1)}return e}}]),l}(y.BasicChess),h=function(l){function C(a){return n(this,C),o(this,(C.__proto__||Object.getPrototypeOf(C)).call(this,a))}return a(C,l),i(C,[{key:"Init",value:function(a){return r(C.prototype.__proto__||Object.getPrototypeOf(C.prototype),"Init",this).call(this,a),this.RegisterChess(_.ChessType.STIT_HUGEMUSHROOM),this.RegisterChess(_.ChessType.STIT_LITTLEMUSHROOM),!0}},{key:"Release",value:function(){this.listenner_&&c.eventManager.RemoveListener(s.EventKey.kEventKeyMushroom),r(C.prototype.__proto__||Object.getPrototypeOf(C.prototype),"Release",this).call(this)}},{key:"NewChess",value:function(a){return a==_.ChessType.STIT_HUGEMUSHROOM?(null==this.listenner_&&(this.listenner_=new E(c.curBoard),c.eventManager.AddEventListener(this.listenner_,s.EventPri.kEventPriMushroom,s.EventKey.kEventKeyMushroom)),new S(a)):a==_.ChessType.STIT_LITTLEMUSHROOM?new N(a):null}}]),C}(u);I.exports={Mushroom:S,LittleMushroom:N,MushroomListener:E,MushroomModule:h}},function(I,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function o(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==typeof o||"function"==typeof o)?o:a}function a(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var r=function _(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:_(a,t,n)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(n)},i=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),s=s||t(33),_=_||t(12),l=l||t(17),u=u||t(38),c=c||t(13),y=y||t(39),E=E||t(23),C=function(r){function l(){n(this,l);var a=o(this,(l.__proto__||Object.getPrototypeOf(l)).call(this));return a.need_handle_=!1,a._have_explosion=!1,a.RequestEvent(s.PuzzleEvent.kEventBalanceState|s.PuzzleEvent.kEventSlide|s.PuzzleEvent.kEventRespawn),a}return a(l,r),i(l,[{key:"OnEvent",value:function(a){switch(c.dataCollector.beginOnceAniCollect("tickbomb"),a.event_id){case s.PuzzleEvent.kEventRespawn:this._have_explosion=!1,this.OnRespawn(a);break;case s.PuzzleEvent.kEventSlide:this.Forward();break;case s.PuzzleEvent.kEventBalanceState:this.CheckFail();}c.dataCollector.endOnceAniCollect("tickbomb")}},{key:"Release",value:function(){}},{key:"Forward",value:function(){for(var t=!1,e=null,n=c.boardViewer,o=n.NodeCount(),a=0;a<o;a++)if(e=n.GetNodeIndex(a),e.HasChessType(_.ChessType.CT_TICKBOMB)){var r=e.GetChess();null!=r&&(r.Forward(0),2>=r.tick()&&(t=!0))}t&&c.aniManager.GenerateBombWarningAni()}},{key:"AddTick",value:function(t){for(var e=null,n=c.boardViewer,o=n.NodeCount(),a=0;a<o;a++)if(e=n.GetNodeIndex(a),e.HasChessType(_.ChessType.CT_TICKBOMB)){var r=e.GetChess();null!=r&&r.AddTick(0,t)}}},{key:"OnRespawn",value:function(a){var e=a;if(e.respawn_type_!=s.RespawnEvent.kRespawnStart)return e.respawn_type_==s.RespawnEvent.kRespawnEnd?(this.ReplaceBomb(),this.AddTick(5+c.envManager.GetPetTalentInAddSteps()),void c.passConditionManager.ClearFail()):void 0}},{key:"Bomb",value:function(a){if(0!=a.length)for(var e=0,t;e<a.length;e++)t=a[e],null!=t&&t.Bomb(0)}},{key:"CheckFail",value:function(){if(!this._have_explosion){for(var s=[],e=null,t=c.boardViewer,n=t.NodeCount(),o=0;o<n;o++)if(e=t.GetNodeIndex(o),e.HasChessType(_.ChessType.CT_TICKBOMB)){var a=e.GetChess();0>=a.tick()&&(c.passConditionManager.UpdatePassCondition(),c.passConditionManager.getStatus()!=_.GameStatus.kGamePass&&(this._have_explosion=!0,c.passConditionManager.GameFail(),s.push(a)))}this.Bomb(s)}}},{key:"ReplaceBomb",value:function(){for(var l=null,e=c.boardViewer,t=e.NodeCount(),n=0;n<t;n++)if(l=e.GetNodeIndex(n),l.HasChessType(_.ChessType.CT_TICKBOMB)){var o=l.GetChess();if(null!=o&&!(0<o.tick())){var a=o.Color(),r=l.ToChessData();l.RemoveChess(o),l.AddChess(_.ChessType.CT_NormalUnit,a);var E=l.ToChessData();c.aniManager.GenerateTickbombReplaceAni({oldChess:r,newChess:E})}}}}]),l}(s.BoardEventListener),S=function(s){function l(){n(this,l);var a=o(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,_.ChessType.CT_TICKBOMB));return a.tick_=0,a.init_tick_=0,a}return a(l,s),i(l,[{key:"Backup",value:function(){}},{key:"Restore",value:function(){}},{key:"Init",value:function(a){this.init_tick_=a.iVal1,this.tick_=a.iVal1,this.attach_.iVal2=this.tick_}},{key:"ToChessData",value:function(){var a=r(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"ToChessData",this).call(this);return a.bomb_data.tick_count=this.tick_,a}},{key:"Crush",value:function(a){return r(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"Crush",this).call(this,a)}},{key:"OnCreate",value:function(){}},{key:"Forward",value:function(){this.tick_--,0>this.tick_&&(this.tick_=0),this.attach_.iVal2=this.tick_;var e=this.ToChessData();c.aniManager.GenerateTickbombTickAni({chessData:e})}},{key:"AddTick",value:function(a,e){var t=this.ToChessData(),_=this.tick_;this.tick_+=e,this.tick_>this.init_tick_&&(this.tick_=this.init_tick_),this.attach_.iVal2=this.tick_,this.ToChessData(),c.aniManager.GenerateBombAddTickAni({chessData:t,tick:this.tick_-_})}},{key:"Bomb",value:function(){if(!(0<this.tick_)){var e=this.ToChessData();c.aniManager.GenerateTickbombBombAni({chessData:e})}}},{key:"tick",value:function(){return this.tick_}}]),l}(y.BasicChess),N=function(l){function E(){n(this,E);var a=o(this,(E.__proto__||Object.getPrototypeOf(E)).call(this));return a.listenner_=null,a}return a(E,l),i(E,[{key:"Init",value:function(a){return r(E.prototype.__proto__||Object.getPrototypeOf(E.prototype),"Init",this).call(this,a),this.listenner_=null,this.RegisterChess(_.ChessType.CT_TICKBOMB),!0}},{key:"Release",value:function(){this.listenner_&&(c.eventManager.RemoveListener(this.listenner_),this.listenner_=null),r(E.prototype.__proto__||Object.getPrototypeOf(E.prototype),"Release",this).call(this)}},{key:"NewChess",value:function(a){return a==_.ChessType.CT_TICKBOMB?(null==this.listenner_&&(this.listenner_=new C,c.eventManager.AddEventListener(this.listenner_,s.EventPri.kEventPriTickBomb,s.EventKey.kEventKeyTickBomb)),new S):null}}]),E}(u);I.exports={TickBombListener:C,TickBomb:S,TickBombModule:N}},function(T,e,t){"use strict";function I(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function o(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==typeof o||"function"==typeof o)?o:a}function a(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var n=function _(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:_(a,t,n)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(n)},r=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),s=s||t(33),_=_||t(12),l=l||t(17),i=i||t(38),u=u||t(13),c=c||t(24),E=E||t(39),C=function(n){function i(a){I(this,i);var e=o(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return e.need_handle_=!1,e.board_=a,e}return a(i,n),r(i,[{key:"OnEvent",value:function(a){switch(a.event_id){case s.PuzzleEvent.kEventSlide:this.need_handle_=!0;break;case s.PuzzleEvent.kEventUseItem:this.need_handle_=!1;break;case s.PuzzleEvent.kEventBalanceState:this.need_handle_&&(this.OnBalanceState(),this.need_handle_=!1);break;default:}}},{key:"Release",value:function(){}},{key:"OnBalanceState",value:function(){for(var E=[],e=u.boardViewer.Row(),t=u.boardViewer.Col(),n=0;n<e;++n)for(var o=0,a;o<t;++o)a=u.boardViewer.GetNode(n,o),a.HasOneOf(_.ChessType.CT_Chameleon,_.ChessType.STIT_Chameleon_SMALL_BELL,_.ChessType.STIT_Chameleon_BIG_BELL)&&E.push(new l.GridPosition(n,o));if(0<E.length){var r=[];if(6>u.stageManager.MaxColorCount())return void console.log("\u53D8\u8272\u68CB\u5B50\u5B58\u5728\u7684\u60C5\u51B5\u4E0B\uFF0C\u68CB\u76D8\u989C\u8272\u4E0D\u80FD\u4F4E\u4E8E6\u79CD");for(var i=[],s=0;s<6;++s)i.push(l.MovingItemType.MIT_0+s);for(var s=0;s<E.length;++s){var N=E[s],n=N.row,o=N.col,a=u.boardViewer.GetNode(n,o),C=a.ChessColor(),p=i.concat();C>=l.MovingItemType.MIT_0&&C<l.MovingItemType.MIT_5&&(p[C]=l.MovingItemType.MIT_5),p.pop();for(var d=l.MovingItemType.MIT_NONE,T;0<p.length&&(T=c.PuzzleRand("chml(93)")%p.length,d=p[T],!!u.boardViewer.CheckJoin(new l.GridPosition(n,o),d));)d=l.MovingItemType.MIT_NONE,p[T]=p[p.length-1],p.pop();if(d==l.MovingItemType.MIT_NONE)return;var I=a.ToChessData();a.SetChessColor(d);var h=a.ToChessData();r.push({oldChessData:I,newChessData:h})}0<r.length&&u.aniManager.GenerateChangeColorAni(r)}}}]),i}(s.BoardEventListener),y=function(i){function l(){I(this,l);var a=o(this,(l.__proto__||Object.getPrototypeOf(l)).call(this));return a.listenner_=null,a}return a(l,i),r(l,[{key:"Init",value:function(a){return n(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"Init",this).call(this,a),this.listener_=null,this.RegisterChess(_.ChessType.CT_Chameleon),!0}},{key:"Release",value:function(){this.listener_&&u.eventManager.RemoveListener(this.listener_),n(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"Release",this).call(this)}},{key:"NewChess",value:function(a){var e=new E.BasicChess(a);return null==this.listener_&&(this.listener_=u.eventManager.FindListener(s.EventKey.kEventKeyChameleon),null==this.listener_&&(this.listener_=new C(u.curBoard),u.eventManager.AddEventListener(this.listener_,s.EventPri.kEventPriChameleon,s.EventKey.kEventKeyChameleon))),e}}]),l}(i);T.exports={ChameleonListener:C,ChameleonModule:y}},function(N,e,t){"use strict";function O(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}function o(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==typeof o||"function"==typeof o)?o:a}function a(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}var n=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),r=function _(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(void 0===o){var a=Object.getPrototypeOf(e);return null===a?void 0:_(a,t,n)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(n)},s=s||t(33),U=U||t(12),H=H||t(17),_=_||t(38),u=u||t(13),i=i||t(24),l=l||t(39),h=h||t(34),p=p||t(23),d=function(_,e,t,n,o,a){this.m_from_row=_.row,this.m_from_col=_.col,this.m_to_row=e.row,this.m_to_col=e.col,this.source=new H.GridPosition(t),this.direction=n,this.chesses=o,this.move_type=a},T=function(_){function s(a){O(this,s);var e=o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,a));return e.listener_=null,e.conveyerID=-1,e}return a(s,_),n(s,[{key:"OnCreate",value:function(){s.mAddConveyerUnit&&this.listener_&&this.listener_.AddConveyerUnit(this)}},{key:"ToChessData",value:function(){var a=r(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"ToChessData",this).call(this);return a.conveyer_data.direction=this.attach_.iVal1,a.conveyer_data.conveyerID=this.conveyerID,a}}]),s}(l.BasicChess);T.mAddConveyerUnit=!0;var E=function(_){function r(a){O(this,r);var e=o(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return e.need_handle_=!1,e.board_=a,e.m_Conveyer=[],e}return a(r,_),n(r,[{key:"OnEvent",value:function(a){switch(u.dataCollector.beginOnceAniCollect("conveyer"),a.event_id){case s.PuzzleEvent.kEventSlide:this.need_handle_=!0;break;case s.PuzzleEvent.kEventBalanceState:this.need_handle_&&(this.OnBalanceState(),this.need_handle_=!1);break;case s.PuzzleEvent.kEventGameStart:this.HandleConveyerDirection();break;default:return;}u.dataCollector.endOnceAniCollect("conveyer")}},{key:"Release",value:function(){}},{key:"GetConveyer",value:function(){return this.m_Conveyer}},{key:"AddConveyerUnit",value:function(N){var e=N.GetAttach(),t=u.stageManager.Row(),n=u.stageManager.Col(),o=N.GetPosition().row,a=N.GetPosition().col,r=e.iVal1,i=S(e.iVal2/n),s=e.iVal2%n;if(0>r)return!1;if(0>i||i>=t||0>s||s>=n)return!1;if(o==i&&a==s)return!1;for(N.conveyerID=r;r>=this.m_Conveyer.length;)this.m_Conveyer.push([]);for(var _=this.m_Conveyer[r],l=null,c=null,E=0,C;E<_.length;E++)C=_[E],C.nextPos.row==o&&C.nextPos.col==a&&(l=C),C.nextPos.row==i&&C.nextPos.col==s&&(c=C);if(l&&c){-1==c.curPos.row&&(c.curPos.row=o,c.curPos.col=a);var p=_.indexOf(l),d=_.indexOf(c);if(p+1!=d)for(var T=0;;)if(p<d){if(_.splice(p+1+T,0,_[d+T]),_.splice(d+1+T,1),d+T==_.length-1)break;var I=_[d+T+1];if(-1==I.curPos.row)break;T++}else{_.splice(p+1,0,_[d]),_.splice(d,1);var I=_[d];if(-1==I.curPos.row||I.nextPos.row==o&&I.nextPos.col==a)break}}else l?_.indexOf(l)+1==_.length?_.push(new H.ConveyerItem(new H.GridPosition(o,a),new H.GridPosition(i,s))):_.splice(_.indexOf(l)+1,0,new H.ConveyerItem(new H.GridPosition(o,a),new H.GridPosition(i,s))):c?(-1==c.curPos.row&&(c.curPos.row=o,c.curPos.col=a),_.splice(_.indexOf(c),0,new H.ConveyerItem(new H.GridPosition(-1,-1),new H.GridPosition(o,a)))):(_.push(new H.ConveyerItem(new H.GridPosition(-1,-1),new H.GridPosition(o,a))),_.push(new H.ConveyerItem(new H.GridPosition(o,a),new H.GridPosition(i,s))));return!0}},{key:"OnBalanceState",value:function(){if(H.PuzzleGameState.PGS_LASTPANG!=this.board_.GetGameState()){var a=this.m_Conveyer;0<a.length&&this.ConveyerWalkOneStep()&&this.board_.BreakBalance()}}},{key:"ConveyerWalkOneStep",value:function(){for(var l=!1,e=0,t=this.m_Conveyer.length;e<t;e++){var n=this.m_Conveyer[e],o=n.length;if(!(1>=o)){l=!0;var a=o-1,r=n[a].curPos.row,i=n[a].curPos.col,s=this.board_.GetWorldNode(new H.GridPosition(r,i));if(s){T.mAddConveyerUnit=!1;var _=new h;_.SetPosition(new H.GridPosition(s.GetWorldPosition())),s.ConveyerMoveTo(_),s.ConveyerCopyChessTo(U.ChessType.STIT_CONVEYER,_),T.mAddConveyerUnit=!0;for(var I=[],E=null,C=a;0<=C;C--){var c=C,y=C-1,S=new H.GridPosition(n[c].curPos),N=this.board_.GetWorldNode(S),v=null;if(-1==y)y=a,v=_;else{var m=new H.GridPosition(n[y].curPos);v=this.board_.GetWorldNode(m)}var O=v.ToRealChessDataList();v.ConveyerMoveTo(N),null==N.FindAttach(U.ChessType.STIT_CONVEYER)&&console.log("\u8FD9\u91CC\u5E94\u8BE5\u629B\u5F02\u5E38\u7684\u5427");var L=N.FindAttach(U.ChessType.STIT_CONVEYER).iVal1,A=new H.GridPosition(n[y].curPos),M=new H.GridPosition(n[c].curPos),R=n[y].curPos,g=new H.GridPosition(-1,-1),P=0;H.ConveyerDirection.Conveyer_Broken_In_Up==L?(A=new H.GridPosition(M.row+1,M.col),E=p.clone(O),P=1):H.ConveyerDirection.Conveyer_Broken_In_Down==L?(A=new H.GridPosition(M.row-1,M.col),E=p.clone(O),P=1):H.ConveyerDirection.Conveyer_Broken_In_Left==L?(A=new H.GridPosition(M.row,M.col+1),E=p.clone(O),P=1):H.ConveyerDirection.Conveyer_Broken_In_Right==L?(A=new H.GridPosition(M.row,M.col-1),E=p.clone(O),P=1):H.ConveyerDirection.Conveyer_Broken_Out_Up==L?(I.push(new d(n[y].curPos,n[c].curPos,g,H.ConveyerDirection.Conveyer_Up,O,P)),A=n[c].curPos,M=new H.GridPosition(A.row-1,A.col),R=null,O=E,E=null,P=-1):H.ConveyerDirection.Conveyer_Broken_Out_Down==L?(I.push(new d(n[y].curPos,n[c].curPos,g,H.ConveyerDirection.Conveyer_Down,O,P)),A=n[c].curPos,M=new H.GridPosition(A.row+1,A.col),R=null,O=E,E=null,P=-1):H.ConveyerDirection.Conveyer_Broken_Out_Left==L?(I.push(new d(n[y].curPos,n[c].curPos,g,H.ConveyerDirection.Conveyer_Left,O,P)),A=n[c].curPos,M=new H.GridPosition(A.row,A.col-1),R=null,O=E,E=null,P=-1):H.ConveyerDirection.Conveyer_Broken_Out_Right==L?(I.push(new d(n[y].curPos,n[c].curPos,g,H.ConveyerDirection.Conveyer_Right,O,P)),A=n[c].curPos,M=new H.GridPosition(A.row,A.col+1),R=null,O=E,E=null,P=-1):R=null,R&&g.copyData(R),I.push(new d(A,M,g,L,O,P))}for(var G=0;G<I.length;G++){var k=I[G],D=k.chesses;if(0==k.move_type)for(var w=0,f;w<D.length;w++)f=D[w],f&&u.aniManager.GenerateConveyerTransferAni(w,f,new H.GridPosition(k.m_from_row,k.m_from_col),new H.GridPosition(k.m_to_row,k.m_to_col));else for(var w=0,f;w<D.length;w++)f=D[w],f&&u.aniManager.GenerateConveyerChessScaleMoveAni(w,f,new H.GridPosition(k.m_from_row,k.m_from_col),new H.GridPosition(k.m_to_row,k.m_to_col),-1==k.move_type,k.direction)}}}}return l}},{key:"HandleConveyerDirection",value:function(){var l=1,e=1;0<this.m_Conveyer.length&&(u.stageManager._isConveyer=!0);for(var t=0,n=this.m_Conveyer.length;t<n;t++){var o=this.m_Conveyer[t],a=o.length;if(!(1>=a)){var r,i;e=l;for(var s=0,_;s<a;s++){_=0,_=0==s?a-1:s-1,r=o[_].curPos.row,i=o[_].curPos.col;var c=o[s].curPos.row,E=o[s].curPos.col,C=o[s].nextPos.row,p=o[s].nextPos.col,d=this.board_.GetWorldNode(new H.GridPosition(c,E));if(d){var T=null;if(null==d.FindAttach(U.ChessType.STIT_CONVEYER)&&console.log("\u65E0\u6548\u7684\u4F20\u9001\u5E26\u8282\u70B9"),T=d.FindAttach(U.ChessType.STIT_CONVEYER),r==C&&i==p?c==C?E>p?T.iVal1=H.ConveyerDirection.Conveyer_Left:T.iVal1=H.ConveyerDirection.Conveyer_Right:E==p?c>C?T.iVal1=H.ConveyerDirection.Conveyer_Up:T.iVal1=H.ConveyerDirection.Conveyer_Down:console.log("\u4E0D\u8FDE\u7EED\u7684\u4F20\u9001\u5E26\u8DEF\u5F84"):c==C?E==p+1?i==E&&r+1==c?T.iVal1=H.ConveyerDirection.Conveyer_BottomRight_Left:r==c&&E+1==i?T.iVal1=H.ConveyerDirection.Conveyer_Left:i==E&&r==c+1?T.iVal1=H.ConveyerDirection.Conveyer_TopRight_Left:T.iVal1=H.ConveyerDirection.Conveyer_Broken_In_Left:E>p?i==E&&r+1==c?T.iVal1=H.ConveyerDirection.Conveyer_Broken_Out_Down:r==c&&E+1==i?T.iVal1=H.ConveyerDirection.Conveyer_Broken_Out_Left:i==E&&r==c+1?T.iVal1=H.ConveyerDirection.Conveyer_Broken_Out_Up:i+1==E&&r==c?T.iVal1=H.ConveyerDirection.Conveyer_Broken_Out_Right:console.log("\u4E0D\u8FDE\u7EED\u7684\u4F20\u9001\u5E26\u8DEF\u5F84"):E+1==p?i==E&&r+1==c?T.iVal1=H.ConveyerDirection.Conveyer_BottomLeft_Right:r==c&&i+1==E?T.iVal1=H.ConveyerDirection.Conveyer_Right:i==E&&r==c+1?T.iVal1=H.ConveyerDirection.Conveyer_TopLeft_Right:T.iVal1=H.ConveyerDirection.Conveyer_Broken_In_Right:i==E&&r+1==c?T.iVal1=H.ConveyerDirection.Conveyer_Broken_Out_Down:r==c&&i+1==E?T.iVal1=H.ConveyerDirection.Conveyer_Broken_Out_Right:i==E&&r==c+1?T.iVal1=H.ConveyerDirection.Conveyer_Broken_Out_Up:i==E+1&&r==c?T.iVal1=H.ConveyerDirection.Conveyer_Broken_Out_Left:console.log("\u4E0D\u8FDE\u7EED\u7684\u4F20\u9001\u5E26\u8DEF\u5F84"):E==p?c==C+1?r==c&&i+1==E?T.iVal1=H.ConveyerDirection.Conveyer_BottomRight_Up:i==E&&c+1==r?T.iVal1=H.ConveyerDirection.Conveyer_Up:r==c&&i==E+1?T.iVal1=H.ConveyerDirection.Conveyer_BottomLeft_Up:T.iVal1=H.ConveyerDirection.Conveyer_Broken_In_Up:c>C?r==c&&i+1==E?T.iVal1=H.ConveyerDirection.Conveyer_Broken_Out_Right:i==E&&c+1==r?T.iVal1=H.ConveyerDirection.Conveyer_Broken_Out_Up:r==c&&i==E+1?T.iVal1=H.ConveyerDirection.Conveyer_Broken_Out_Left:r+1==c&&i==E?T.iVal1=H.ConveyerDirection.Conveyer_Broken_Out_Down:console.log("\u4E0D\u8FDE\u7EED\u7684\u4F20\u9001\u5E26\u8DEF\u5F84"):c+1==C?r==c&&i+1==E?T.iVal1=H.ConveyerDirection.Conveyer_TopRight_Down:i==E&&r+1==c?T.iVal1=H.ConveyerDirection.Conveyer_Down:r==c&&i==E+1?T.iVal1=H.ConveyerDirection.Conveyer_TopLeft_Down:T.iVal1=H.ConveyerDirection.Conveyer_Broken_In_Down:r==c&&i+1==E?T.iVal1=H.ConveyerDirection.Conveyer_Broken_Out_Right:i==E&&r+1==c?T.iVal1=H.ConveyerDirection.Conveyer_Broken_Out_Down:r==c&&i==E+1?T.iVal1=H.ConveyerDirection.Conveyer_Broken_Out_Left:r==c+1&&i==E?T.iVal1=H.ConveyerDirection.Conveyer_Broken_Out_Up:console.log("\u4E0D\u8FDE\u7EED\u7684\u4F20\u9001\u5E26\u8DEF\u5F84"):r+1==c&&i==E?T.iVal1=H.ConveyerDirection.Conveyer_Broken_Out_Down:r==c+1&&i==E?T.iVal1=H.ConveyerDirection.Conveyer_Broken_Out_Up:i+1==E&&r==c?T.iVal1=H.ConveyerDirection.Conveyer_Broken_Out_Right:i==E+1&&r==c?T.iVal1=H.ConveyerDirection.Conveyer_Broken_Out_Left:console.log("\u4E0D\u8FDE\u7EED\u7684\u4F20\u9001\u5E26\u8DEF\u5F84"),T.iVal1>=H.ConveyerDirection.Conveyer_Broken_In_Up&&T.iVal1<=H.ConveyerDirection.Conveyer_Broken_In_Right){T.iVal2=l,++l;var I=this.board_.GetWorldNode(new H.GridPosition(r,i));if(!I)continue;null==I.FindAttach(U.ChessType.STIT_CONVEYER)&&console.log("\u65E0\u6548\u7684\u4F20\u9001\u5E26\u8282\u70B9")}else if(T.iVal1>=H.ConveyerDirection.Conveyer_Broken_Out_Up&&T.iVal1<=H.ConveyerDirection.Conveyer_Broken_Out_Right){T.iVal2=s==a-1?e:l;var I=this.board_.GetWorldNode(new H.GridPosition(C,p));if(!I)continue;null==I.FindAttach(U.ChessType.STIT_CONVEYER)&&console.log("\u65E0\u6548\u7684\u4F20\u9001\u5E26\u8282\u70B9")}}}}}}}]),r}(s.BoardEventListener),C=function(_){function i(){O(this,i);var a=o(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return a.listener_=null,a.conveyer_data_=new U.ConveyerData,a}return a(i,_),n(i,[{key:"Init",value:function(a){return r(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"Init",this).call(this,a),this.RegisterChess(U.ChessType.STIT_CONVEYER),this.RegisterChess(U.ChessType.STIT_CONVEYERLIGHT),this.listener_=new E(a),u.eventManager.AddEventListener(this.listener_,s.EventPri.kEventPriConveyer,s.EventKey.kEventKeyConveyer),!0}},{key:"Release",value:function(){u.eventManager.RemoveListener(this.listener_),r(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"Release",this).call(this)}},{key:"NewChess",value:function(a){var e=new T(a);return e.listener_=this.listener_,e}},{key:"GetModuleData",value:function(){if(0==this.conveyer_data_.path.length&&this.listener_)for(var e=this.listener_.GetConveyer(),t=0;t<e.length;t++){var n=e[t],o=new U.ConveyerPosition;this.conveyer_data_.path.push(o);for(var a=0;a<n.length;a++){var r=n[a].curPos.row,i=n[a].curPos.col,s=new U.Position;o.pos.push(s),s.row=r,s.col=i}}return this.conveyer_data_}}]),i}(_);N.exports={ConveyerChess:T,ConveyerListener:E,ConveyerModule:C}},function(_,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),a=a||t(12),r=function t(){n(this,t),this.SodaLine=0,this.DropSequence=0,this.AdditionSteps=0,this.AdditionScoreRate=0,this.PetTalentOutAddSteps=0,this.PetTalentInAddSteps=0,this.PetTalentRespawnAddSteps=0,this.GameInfo=new a.GameInfo,this.haveStopDropChess=!1},l=function(){function a(){n(this,a),this.data_=new r,this.isWorkerMode=!1,this.isCollectSkidding=!0}return o(a,[{key:"SetSodaLine",value:function(a){this.data_.SodaLine=a}},{key:"GetSodaLine",value:function(){return this.data_.SodaLine}},{key:"SetDropSequence",value:function(a){this.data_.DropSequence=a}},{key:"GetDropSequence",value:function(){return this.data_.DropSequence}},{key:"SetAdditionSteps",value:function(a){this.data_.AdditionSteps=a}},{key:"GetAdditionSteps",value:function(){return this.data_.AdditionSteps}},{key:"SetAdditionScoreRate",value:function(a){this.data_.AdditionScoreRate=a}},{key:"GetAdditionScoreRate",value:function(){return this.data_.AdditionScoreRate}},{key:"SetPetTalentOutAddSteps",value:function(a){this.data_.PetTalentOutAddSteps=a}},{key:"GetPetTalentOutAddSteps",value:function(){return this.data_.PetTalentOutAddSteps}},{key:"SetPetTalentInAddSteps",value:function(a){this.data_.PetTalentInAddSteps=a}},{key:"GetPetTalentInAddSteps",value:function(){return this.data_.PetTalentInAddSteps}},{key:"SetPetTalentRespawnAddSteps",value:function(a){this.data_.PetTalentRespawnAddSteps=a}},{key:"GetPetTalentRespawnAddSteps",value:function(){return this.data_.PetTalentRespawnAddSteps}},{key:"SetIsHaveStopDropChess",value:function(a){this.data_.haveStopDropChess=a}},{key:"GetIsHaveStopDropChess",value:function(){return this.data_.haveStopDropChess}},{key:"SetIsWorkerMode",value:function(a){this.isWorkerMode=a}},{key:"GetIsWorkerMode",value:function(){return this.isWorkerMode}},{key:"GameInfo",value:function(){return this.data_.GameInfo}},{key:"Save",value:function(){}},{key:"Load",value:function(){}},{key:"Update",value:function(){this.GameInfo()}},{key:"Init",value:function(){}},{key:"Release",value:function(){}}]),a}();_.exports={EnvData:r,EnvManager_:l}},function(E,e,t){"use strict";function n(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),O=O||t(8),r=r||t(13),a=a||t(17),s=s||t(12),_=_||t(23),i=function(){function t(){n(this,t),this.curRemoveData=null,this.batchAniData={}}return o(t,[{key:"startOneRemove",value:function(_,r,t){var s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;this.curRemoveData&&this.endOneRemove(),this.curRemoveData={bg_chess:[],bomb_chess:[],top_chess:[],special_pos:s,special_pos2:i,add_chess:[],add_bg_chess:[],changed_chess:{top:[],middle:[],bottom:[]},soda_bubble:0,attack_type:_,rounds:t}}},{key:"addCrushChess",value:function(a){this.curRemoveData&&this.curRemoveData.bomb_chess.push(a)}},{key:"addCrushBgChess",value:function(a){this.curRemoveData&&this.curRemoveData.bg_chess.push(a)}},{key:"addCrushTopChess",value:function(a){this.curRemoveData&&this.curRemoveData.top_chess.push(a)}},{key:"addChangedChess",value:function(a){this.curRemoveData&&this.curRemoveData.changed_chess.middle.push(a)}},{key:"addChangedBgChess",value:function(a){this.curRemoveData&&this.curRemoveData.changed_chess.bottom.push(a)}},{key:"addChangedTopChess",value:function(a){this.curRemoveData&&this.curRemoveData.changed_chess.top.push(a)}},{key:"addSpecialChess",value:function(a){this.curRemoveData&&this.curRemoveData.add_chess.push(a)}},{key:"addBgChess",value:function(a){this.curRemoveData&&this.curRemoveData.add_bg_chess.push(a)}},{key:"addSodaBubbleNum",value:function(){this.curRemoveData&&this.curRemoveData.soda_bubble++}},{key:"endOneRemove",value:function(){this.curRemoveData&&r.dataEventManager.trigger(O.REMOVE,{data:this.curRemoveData}),this.curRemoveData=null}},{key:"beginOnceAniCollect",value:function(a){this.batchAniData[a]&&this.endOnceAniCollect(a),this.batchAniData[a]=[]}},{key:"addAniCollect",value:function(a,e,o){this.batchAniData[a].push({id:e,data:o})}},{key:"endOnceAniCollect",value:function(a){this.batchAniData[a]&&0<this.batchAniData[a].length&&r.aniManager.pushBatchAnimation(this.batchAniData[a]),this.batchAniData[a]=null}},{key:"collectOneDropData",value:function(i){for(var l=0,t=r.stageManager.ScreenRow(),n=r.stageManager.ScreenCol(),o=r.stageManager.Row(),L=[],A=[],c=0;c<o;c++)for(var h=0,E;h<n;h++)if(E=r.curBoard.GetWorldNode(new a.GridPosition(c,h)),E&&E.GetJustDrop()){var C=E.GetDropPath(),M=C.length,d=E.GetDropNewFlag(),R=C[M-1].row;if(0>R||R>=t){E.SetJustDrop(!1),E.SetDropNewFlag(!1),E.ClearDropPath();continue}for(var I=0,y;1>I;++I)y=C[I],(0>y.row||y.row>=t)&&(d=!0);if(d){for(var S=C[0].row,N=C[0].col,P=C[M-1].col;_.findEleInArr(A,function(t){return t.isEqual(new a.GridPosition(S,N))});)N==P?C[0].row<C[1].row?S--:S++:N=P;C[0].row=S,C[0].col=N,A.push(new a.GridPosition(S,N))}l++;var g=null;(E.HasChessType(s.ChessType.STIT_MAOQIU1)||E.HasChessType(s.ChessType.STIT_MAOQIU2))&&(g=E.ToChessData(2)),L.push({chess_data:E.ToChessData(),top_chess:g,new_flag:d,path:C}),E.SetDropNewFlag(!1),E.SetAttachStaticType(0),E.SetJustDrop(!1),E.ClearDropPath()}return 0<L.length?r.dataEventManager.trigger(O.DROP,{data:{dropList:L,rounds:i}}):r.aniManager.GenerateEmptyAni(),l}}]),t}();E.exports=i},function(y,e,t){"use strict";function n(a,o){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o&&("object"==typeof o||"function"==typeof o)?o:a}function o(a,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);a.prototype=Object.create(o&&o.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(a,o):a.__proto__=o)}function a(a,e){if(!(a instanceof e))throw new TypeError("Cannot call a class as a function")}var r=function(){function a(a,_){for(var t=0,n;t<_.length;t++)n=_[t],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(a,n.key,n)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),i=i||t(12),s=s||t(17),_=_||t(13),l=l||t(33),u=u||t(8),c=function(){function t(){a(this,t),this.enable_=!0}return r(t,[{key:"Use",value:function(){}},{key:"Valid",value:function(){}},{key:"GetItemId",value:function(){}},{key:"SetEnable",value:function(a){this.enable_=a}},{key:"Enable",value:function(){return this.enable_}}]),t}(),S=function(E){function e(){return a(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return o(e,E),r(e,[{key:"Use",value:function(a){return this.UseHammer(a)}},{key:"Valid",value:function(s){if(!this.Enable())return!1;var e=_.boardViewer.GetNode(s.from);if(null==e)return!1;var t=e.GetTop();if(null==t)return!1;var n=t.Attribute();if(null==n)return!1;if(!n.CanUseHammer)return!1;for(var o=n.attack_type.length,a=0;a<o;a++)if(i.AttackType.Attack_Disappear==n.attack_type[a])return!0;return!1}},{key:"GetItemId",value:function(){return i.ItemId.itemHammer}},{key:"UseHammer",value:function(r){console.log("UseHammer : "+JSON.stringify(r));var e={attack_type:i.AttackType.Attack_Disappear,depth:0,join:1,src:new s.GridPosition(r.from)},t=1;_.dataCollector.startOneRemove(i.AttackType.Attack_Disappear,1,t);var n=_.boardViewer.GetNode(r.from).Crush(e);if(n){var o=new l.CrushNodeEvent;o.src=new s.GridPosition(r.from),o.nodes.push(new s.GridPosition(o.src)),o.attack_type=i.AttackType.Attack_Disappear,_.eventManager.Forward(o)}return _.dataCollector.endOneRemove(),_.curBoard.handleSpecialBomb(t),_.dataEventManager.trigger(u.END_ONE_REMOVE_ROUND),_.boardViewer.Sweep(),_.curBoard.BreakBalance(),!0}}]),e}(c),N=function(l){function e(){return a(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return o(e,l),r(e,[{key:"Use",value:function(a){this.ExchangeGridChessman(new s.GridPosition(a.from),new s.GridPosition(a.to));var e=_.boardViewer.GetNode(a.from),t=_.boardViewer.GetNode(a.to);return _.aniManager.GenerateItemSwapAnimation({data:[e.ToChessData(),t.ToChessData()]}),_.curBoard.BreakBalance(),!0}},{key:"Valid",value:function(a){var e=_.boardViewer.GetNode(a.from);return!!e&&e.CanUseSwap()}},{key:"GetItemId",value:function(){return i.ItemId.itemSwap}},{key:"ExchangeGridChessman",value:function(n,e){var t=1;_.boardViewer.SlideSwap(n,e);var o=_.boardViewer.CollectSomething(t,n);_.boardViewer.CollectSomething(t,e)&&(o=!0),o&&_.dataEventManager.trigger(u.END_ONE_REMOVE_ROUND)}}]),e}(c),O=(function(_){function e(){return a(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return o(e,_),r(e,[{key:"Use",value:function(){}},{key:"Valid",value:function(){return!0}},{key:"GetItemId",value:function(){return i.ItemId.itemRollback}}]),e}(c),function(s){function e(){return a(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return o(e,s),r(e,[{key:"Use",value:function(r){var e=_.boardViewer.GetNode(r.from);if(!e||!e.GetChess())return!1;var s=r.value1;if(s!=i.ChessType.CT_SpecialHorizontalShockWave&&s!=i.ChessType.CT_SpecialVerticalShockWave)return!1;e.GetChess().ActiveChessBuffer(0,!1);var n=e.ToChessData();e.AddChessType(s,null,e.ChessColor());var l=e.ToChessData();return _.aniManager.GenerateItemGlassAnimation({oldChess:n,newChess:l}),!0}},{key:"Valid",value:function(a){var e=_.boardViewer.GetNode(a.from);return!!e&&e.CanUseSpecial()}},{key:"GetItemId",value:function(){return i.ItemId.itemGlass}}]),e}(c)),L=function(s){function e(){return a(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return o(e,s),r(e,[{key:"Use",value:function(){return _.stageManager.addStep(3),_.aniManager.GenerateItemStepAnimation({step:3}),!0}},{key:"Valid",value:function(){return!0}},{key:"GetItemId",value:function(){return i.ItemId.itemStepInner}}]),e}(c),m=function(s){function e(){return a(this,e),n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))}return o(e,s),r(e,[{key:"Use",value:function(){return _.curBoard.ReArrange(),_.aniManager.GenerateItemRearrangeAnimation(),!0}},{key:"Valid",value:function(){return!0}},{key:"GetItemId",value:function(){return i.ItemId.itemRearrange}}]),e}(c),A=function(){function t(){a(this,t),this.item_map_={}}return r(t,[{key:"Init",value:function(){this.Register(new S),this.Register(new N),this.Register(new O),this.Register(new L),this.Register(new m);var a=_.stageManager.start_info();return this.ProcStartItem(a),!0}},{key:"Register",value:function(a){var e=a.GetItemId();return this.item_map_[e]=a,!0}},{key:"Release",value:function(){}},{key:"ValidItemInput",value:function(a){if(!a.item_id)return!1;if(a.op!=i.InputOp.kOpUseItem)return!1;var e=a.item_id;return this.item_map_[e]&&this.item_map_[e].Valid(a)}},{key:"EnableItem",value:function(a,e){this.item_map_[a]&&this.item_map_[a].SetEnable(e)}},{key:"ItemInput",value:function(a){if(a.op!=i.InputOp.kOpUseItem)return!1;var e=a.item_id;return this.item_map_[e]&&this.item_map_[e].Use(a)}},{key:"ProcStartItem",value:function(a){for(var e=a.item_id_list||[],t=0,n;t<e.length;t++)n=e[t],n==i.ItemId.itemStepOut?(_.stageManager.AddMaxStep(3),_.stageManager.addStep(3),_.aniManager.GenerateItemStepAnimation({step:3})):n==i.ItemId.itemGas?_.curBoard.ApplyAddGasProp():n==i.ItemId.itemShockWave?_.curBoard.ApplyAddWaveProp(0):n==i.ItemId.itemAddStep_1?(_.stageManager.AddMaxStep(1),_.stageManager.addStep(1),_.aniManager.GenerateItemStepAnimation({step:1})):n==i.ItemId.itemAddStep_2?(_.stageManager.AddMaxStep(2),_.stageManager.addStep(2),_.aniManager.GenerateItemStepAnimation({step:2})):n==i.ItemId.itemScoreAdd_5?_.scoreManager.AddScoreAddition(5):n==i.ItemId.itemScoreAdd_7?_.scoreManager.AddScoreAddition(7):n==i.ItemId.itemScoreAdd_9?_.scoreManager.AddScoreAddition(9):n==i.ItemId.itemHurricane&&_.curBoard.ApplyAddHurricanProp()}}]),t}();y.exports={PuzzleItem:c,ItemHammer:S,ItemSwap:N,ItemGlass:O,ItemStep:L,ItemRearrage:m,ItemManager_:A}}])})})(); 
 			});
 		define("Service.js", function(require, module, exports){ 			
(function(){!function(n,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("protobufjs")):"function"==typeof define&&define.amd?define("Service",["protobufjs"],e):"object"==typeof exports?exports.Service=e(require("protobufjs")):n.Service=e(n.protobufjs)}(this,function(n){var d=Math.abs;return function(a){function e(n){if(t[n])return t[n].exports;var l=t[n]={exports:{},id:n,loaded:!1};return a[n].call(l.exports,l,l.exports,e),l.loaded=!0,l.exports}var t={};return e.m=a,e.c=t,e.p="",e(0)}([function(A,e,t){"use strict";t(1),t(61);var I=t(63),n=t(64),N=t(65),a=t(66),r=t(67),l=t(69),s=t(80),_=t(81),M=t(84),O=t(87);O.init();var b,p=function(){var t=b?200:1e3;clearTimeout(b),b=setTimeout(function(){var t=document.getElementById("portraitTip");document.documentElement.clientWidth>document.documentElement.clientHeight?t||(t=document.createElement("div"),t.id="portraitTip",t.style.backgroundImage="url("+GetConvertResUrl("res/portrait_bg.jpg")+")",document.body.appendChild(t)):t&&document.body.removeChild(t)},t)},m=n.getClient();m.isMobile&&(window.addEventListener("resize",p),p());var f=function(i){"auto"==i&&(a.isWX()?i=I.flag.wechat:a.isQQ()&&(i=I.flag.qq)),N.pf=i;var o=function(){wx.showModal({title:"\u63D0\u793A",content:"\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC\u540E\u70B9\u51FB\u91CD\u8BD5",confirmText:"\u91CD\u8BD5",showCancel:!1,success:function(n){n&&n.confirm?(console.log("\u7528\u6237\u70B9\u51FB\u91CD\u8BD5"),t&&t()):(console.log("\u7528\u6237\u70B9\u4E86\u8499\u5C42"),t&&t())},fail:function(t){console.log("wx.showModal error",t),wx.exitMiniProgram()}})},t=function(){l.init(i,function(){N.loginStatus=1,window.loginCallBack&&window.loginCallBack()},function(t){var e=t?"("+JSON.stringify(t)+")":"";console.log("\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC\u540E\u91CD\u8BD5"+e),o&&o()})};t()},L=function(){if(a.isQQ()||a.isWX())N.pfMode=0,N.loginStatus=0,f("auto");else{N.pfMode=1;var t=localStorage.loginMode;t?(N.loginStatus=0,f(t)):N.loginStatus=2}},y=function(){r.init(function(){N.loadConfigStatus=1,window.loadConfigCallBack&&window.loadConfigCallBack()})},h={content:"",align:"",isBlock:!1,onClose:function(){return!0}},g=function(){return h.isBlock},k=function(){var t=s.getNotice();t?Object.assign(h,t):s.getNoticeByServerTime(function(t){t&&(Object.assign(h,t),S(h))})},R=function(){},S=function(){R(h)};!function(){N.loadNoticeStatus=0;var t=window.remoteResPath+"config/common/notice.json";n.loadJson(t,function(a,e,t){var n=e;null!=n&&(s.init(n,t),k(),N.loadNoticeStatus=1,window.noticeTip&&window.noticeTip()),g()||L()}),y()}(),A.exports={init:f,Util:n,Config:I,getTipBlock:g,subTipsEvent:function(t){"function"==typeof t&&(R=t,h.content&&S(h))},AppManager:_,CmdManager:M,Log:O},window.Service=A.exports},function(i,e,t){"use strict";t(2),t(3),t(4)},function(l,e,t){var n,_,O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(o,a){"use strict";n=a,_="function"==typeof n?n.call(e,t,e,l):n,!(void 0!==_&&(l.exports=_))}(void 0,function(){var D,w,U=Math.floor,e=String.prototype,Le=Array,t=Le.prototype,Nt=Object,n=Nt.prototype,o=Function,i=o.prototype,Mt=String,a=Mt.prototype,ht=Number,l=ht.prototype,r=t.slice,_=t.splice,u=t.push,s=t.unshift,m=t.concat,p=t.join,c=i.call,E=i.apply,y=Math.max,f=Math.min,T=n.toString,g="function"==typeof Symbol&&"symbol"===O(Symbol.toStringTag),R=Function.prototype.toString,C=/^\s*class /,S=function(a){try{var e=R.call(a),t=e.replace(/\/\/.*\n/g,""),n=t.replace(/\/\*[.\s\S]*\*\//g,""),i=n.replace(/\n/gm," ").replace(/ {2}/g," ");return C.test(i)}catch(t){return!1}},A=function(t){try{return!S(t)&&(R.call(t),!0)}catch(t){return!1}},D=function(n){if(!n)return!1;if("function"!=typeof n&&"object"!==("undefined"==typeof n?"undefined":O(n)))return!1;if(g)return A(n);if(S(n))return!1;var i=T.call(n);return"[object Function]"===i||"[object GeneratorFunction]"===i},I=RegExp.prototype.exec,N=function(t){try{return I.call(t),!0}catch(t){return!1}};w=function(t){return"object"===("undefined"==typeof t?"undefined":O(t))&&(g?N(t):T.call(t)==="[object RegExp]")};var M,h=e.valueOf,b=function(t){try{return h.call(t),!0}catch(t){return!1}};M=function(t){return"string"==typeof t||"object"===("undefined"==typeof t?"undefined":O(t))&&(g?b(t):T.call(t)==="[object String]")};var L=Nt.defineProperty&&function(){try{var n={};for(var i in Nt.defineProperty(n,"x",{enumerable:!1,value:n}),n)return!1;return n.x===n}catch(t){return!1}}(),k=function(l){var e;return e=L?function(a,e,t,o){!o&&e in a||Nt.defineProperty(a,e,{configurable:!0,enumerable:!1,writable:!0,value:t})}:function(a,e,t,n){!n&&e in a||(a[e]=t)},function(t,n,i){for(var o in n)l.call(n,o)&&e(t,o,n[o],i)}}(n.hasOwnProperty),P=function(n){var i="undefined"==typeof n?"undefined":O(n);return null===n||"object"!==i&&"function"!==i},G=ht.isNaN||function(t){return t!==t},F={ToInteger:function(n){var i=+n;return G(i)?i=0:0!=i&&i!=1/0&&i!=-(1/0)&&(i=(0<i||-1)*U(d(i))),i},ToPrimitive:function(e){var t,n,i;if(P(e))return e;if(n=e.valueOf,D(n)&&(t=n.call(e),P(t)))return t;if(i=e.toString,D(i)&&(t=i.call(e),P(t)))return t;throw new TypeError},ToObject:function(t){if(null==t)throw new TypeError("can't convert "+t+" to object");return Nt(t)},ToUint32:function(t){return t>>>0}},q=function(){};k(i,{bind:function(l){var t=this;if(!D(t))throw new TypeError("Function.prototype.bind called on incompatible "+t);for(var n,i=r.call(arguments,1),e=function(){if(this instanceof n){var a=E.call(t,this,m.call(i,r.call(arguments)));return Nt(a)===a?a:this}return E.call(t,l,m.call(i,r.call(arguments)))},a=y(0,t.length-i.length),s=[],_=0;_<a;_++)u.call(s,"$"+_);return n=o("binder","return function ("+p.call(s,",")+"){ return binder.apply(this, arguments); }")(e),t.prototype&&(q.prototype=t.prototype,n.prototype=new q,q.prototype=null),n}});var v=c.bind(n.hasOwnProperty),x=c.bind(n.toString),W=c.bind(r),H=E.bind(r),K=c.bind(a.slice),Q=c.bind(a.split),Y=c.bind(a.indexOf),B=c.bind(u),j=c.bind(n.propertyIsEnumerable),V=c.bind(t.sort),J=Le.isArray||function(t){return"[object Array]"===x(t)},X=1!==[].unshift(0);k(t,{unshift:function(){return s.apply(this,arguments),this.length}},X),k(Le,{isArray:J});var z=Nt("a"),$="a"!==z[0]||!(0 in z),Z=function(a){var o=!0,t=!0,n=!1;if(a)try{a.call("foo",function(t,e,n){"object"!==("undefined"==typeof n?"undefined":O(n))&&(o=!1)}),a.call([1],function(){"use strict";t="string"==typeof this},"x")}catch(t){n=!0}return!!a&&!n&&o&&t};k(t,{forEach:function(e){var t,l=F.ToObject(this),i=$&&M(this)?Q(this,""):l,o=-1,a=F.ToUint32(i.length);if(1<arguments.length&&(t=arguments[1]),!D(e))throw new TypeError("Array.prototype.forEach callback must be a function");for(;++o<a;)o in i&&("undefined"==typeof t?e(i[o],o,l):e.call(t,i[o],o,l))}},!Z(t.forEach)),k(t,{map:function(e){var t,n=F.ToObject(this),o=$&&M(this)?Q(this,""):n,a=F.ToUint32(o.length),_=Le(a);if(1<arguments.length&&(t=arguments[1]),!D(e))throw new TypeError("Array.prototype.map callback must be a function");for(var l=0;l<a;l++)l in o&&("undefined"==typeof t?_[l]=e(o[l],l,n):_[l]=e.call(t,o[l],l,n));return _}},!Z(t.map)),k(t,{filter:function(e){var t,n,_=F.ToObject(this),o=$&&M(this)?Q(this,""):_,a=F.ToUint32(o.length),d=[];if(1<arguments.length&&(n=arguments[1]),!D(e))throw new TypeError("Array.prototype.filter callback must be a function");for(var l=0;l<a;l++)l in o&&(t=o[l],("undefined"==typeof n?e(t,l,_):e.call(n,t,l,_))&&B(d,t));return d}},!Z(t.filter)),k(t,{every:function(e){var t,l=F.ToObject(this),i=$&&M(this)?Q(this,""):l,o=F.ToUint32(i.length);if(1<arguments.length&&(t=arguments[1]),!D(e))throw new TypeError("Array.prototype.every callback must be a function");for(var a=0;a<o;a++)if(a in i&&("undefined"==typeof t?!e(i[a],a,l):!e.call(t,i[a],a,l)))return!1;return!0}},!Z(t.every)),k(t,{some:function(e){var t,l=F.ToObject(this),i=$&&M(this)?Q(this,""):l,o=F.ToUint32(i.length);if(1<arguments.length&&(t=arguments[1]),!D(e))throw new TypeError("Array.prototype.some callback must be a function");for(var a=0;a<o;a++)if(a in i&&("undefined"==typeof t?e(i[a],a,l):e.call(t,i[a],a,l)))return!0;return!1}},!Z(t.some));var te=!1;t.reduce&&(te="object"===O(t.reduce.call("es5",function(a,e,t,n){return n}))),k(t,{reduce:function(e){var t=F.ToObject(this),n=$&&M(this)?Q(this,""):t,i=F.ToUint32(n.length);if(!D(e))throw new TypeError("Array.prototype.reduce callback must be a function");if(0===i&&1===arguments.length)throw new TypeError("reduce of empty array with no initial value");var o,a=0;if(2<=arguments.length)o=arguments[1];else for(;;){if(a in n){o=n[a++];break}if(++a>=i)throw new TypeError("reduce of empty array with no initial value")}for(;a<i;a++)a in n&&(o=e(o,n[a],a,t));return o}},!te);var ne=!1;t.reduceRight&&(ne="object"===O(t.reduceRight.call("es5",function(a,e,t,n){return n}))),k(t,{reduceRight:function(e){var t=F.ToObject(this),n=$&&M(this)?Q(this,""):t,i=F.ToUint32(n.length);if(!D(e))throw new TypeError("Array.prototype.reduceRight callback must be a function");if(0===i&&1===arguments.length)throw new TypeError("reduceRight of empty array with no initial value");var o,a=i-1;if(2<=arguments.length)o=arguments[1];else for(;;){if(a in n){o=n[a--];break}if(0>--a)throw new TypeError("reduceRight of empty array with no initial value")}if(0>a)return o;do a in n&&(o=e(o,n[a],a,t));while(a--);return o}},!ne);var ie=t.indexOf&&-1!==[0,1].indexOf(1,2);k(t,{indexOf:function(a){var e=$&&M(this)?Q(this,""):F.ToObject(this),t=F.ToUint32(e.length);if(0===t)return-1;var n=0;for(1<arguments.length&&(n=F.ToInteger(arguments[1])),n=0<=n?n:y(0,t+n);n<t;n++)if(n in e&&e[n]===a)return n;return-1}},ie);var oe=t.lastIndexOf&&-1!==[0,1].lastIndexOf(0,-3);k(t,{lastIndexOf:function(a){var e=$&&M(this)?Q(this,""):F.ToObject(this),t=F.ToUint32(e.length);if(0===t)return-1;var n=t-1;for(1<arguments.length&&(n=f(n,F.ToInteger(arguments[1]))),n=0<=n?n:t-d(n);0<=n;n--)if(n in e&&a===e[n])return n;return-1}},oe);var le=function(){var n=[1,2],e=n.splice();return 2===n.length&&J(e)&&0===e.length}();k(t,{splice:function(){return 0===arguments.length?[]:_.apply(this,arguments)}},!le);var se=function(){var n={};return t.splice.call(n,0,0,1),1===n.length}();k(t,{splice:function(i,e){if(0===arguments.length)return[];var a=arguments;return this.length=y(F.ToInteger(this.length),0),0<arguments.length&&"number"!=typeof e&&(a=W(arguments),2>a.length?B(a,this.length-i):a[1]=F.ToInteger(e)),_.apply(this,a)}},!se);var Ut=function(){var t=new Le(1e5);return t[8]="x",t.splice(1,1),7===t.indexOf("x")}(),Ft=function(){var n=256,e=[];return e[n]="a",e.splice(n+1,0,"b"),"a"===e[n]}();k(t,{splice:function(_,e){for(var t,n=F.ToObject(this),i=[],o=F.ToUint32(n.length),a=F.ToInteger(_),r=0>a?y(o+a,0):f(a,o),l=f(y(F.ToInteger(e),0),o-r),s=0;s<l;)t=Mt(r+s),v(n,t)&&(i[s]=n[t]),s+=1;var d,m=W(arguments,2),u=m.length;if(u<l){s=r;for(;s<o-l;)t=Mt(s+l),d=Mt(s+u),v(n,t)?n[d]=n[t]:delete n[d],s+=1;s=o;for(;s>o-l+u;)delete n[s-1],s-=1}else if(u>l)for(s=o-l;s>r;)t=Mt(s+l-1),d=Mt(s+u-1),v(n,t)?n[d]=n[t]:delete n[d],s-=1;s=r;for(var p=0;p<m.length;++p)n[s]=m[p],s+=1;return n.length=o-l+u,i}},!Ut||!Ft);var qt,pe=t.join;try{qt="1,2,3"!==Array.prototype.join.call("123",",")}catch(t){qt=!0}qt&&k(t,{join:function(n){var i="undefined"==typeof n?",":n;return pe.call(M(this)?Q(this,""):this,i)}},qt);var me="1,2"!==[1,2].join(void 0);me&&k(t,{join:function(n){var i="undefined"==typeof n?",":n;return pe.call(this,i)}},me);var fe=function(){for(var e=F.ToObject(this),t=F.ToUint32(e.length),n=0;n<arguments.length;)e[t+n]=arguments[n],n+=1;return e.length=t+n,t+n},xt=function(){var n={},e=Array.prototype.push.call(n,void 0);return 1!==e||1!==n.length||"undefined"!=typeof n[0]||!v(n,0)}();k(t,{push:function(){return J(this)?u.apply(this,arguments):fe.apply(this,arguments)}},xt);var ye=function(){var n=[],e=n.push(void 0);return 1!==e||1!==n.length||"undefined"!=typeof n[0]||!v(n,0)}();k(t,{push:fe},ye),k(t,{slice:function(){var e=M(this)?Q(this,""):this;return H(e,arguments)}},$);var he=function(){try{return[1,2].sort(null),[1,2].sort({}),!0}catch(t){}return!1}(),ge=function(){try{return[1,2].sort(/a/),!1}catch(t){}return!0}(),Wt=function(){try{return[1,2].sort(void 0),!0}catch(t){}return!1}();k(t,{sort:function(e){if("undefined"==typeof e)return V(this);if(!D(e))throw new TypeError("Array.prototype.sort callback must be a function");return V(this,e)}},he||!Wt||!ge);var Ht=!j({toString:null},"toString"),Se=j(function(){},"prototype"),Ce=!v("x","0"),Ae=function(n){var e=n.constructor;return e&&e.prototype===n},Ie={$window:!0,$console:!0,$parent:!0,$self:!0,$frame:!0,$frames:!0,$frameElement:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$external:!0,$width:!0,$height:!0},Ne=function(){if("undefined"==typeof window)return!1;for(var t in window)try{!Ie["$"+t]&&v(window,t)&&null!==window[t]&&"object"===O(window[t])&&Ae(window[t])}catch(t){return!0}return!1}(),Kt=function(t){if("undefined"==typeof window||!Ne)return Ae(t);try{return Ae(t)}catch(t){return!1}},ve=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],we=ve.length,Oe=function(t){return"[object Arguments]"===x(t)},be=Oe(arguments)?Oe:function(e){return null!==e&&"object"===("undefined"==typeof e?"undefined":O(e))&&"number"==typeof e.length&&0<=e.length&&!J(e)&&D(e.callee)};k(Nt,{keys:function(e){var a=D(e),_=be(e),s=null!==e&&"object"===("undefined"==typeof e?"undefined":O(e)),E=s&&M(e);if(!s&&!a&&!_)throw new TypeError("Object.keys called on a non-object");var r=[];if(E&&Ce||_)for(var l=0;l<e.length;++l)B(r,Mt(l));if(!_)for(var d in e)Se&&a&&"prototype"===d||!v(e,d)||B(r,Mt(d));if(Ht)for(var u,m=Kt(e),c=0;c<we;c++)u=ve[c],m&&"constructor"===u||!v(e,u)||B(r,u);return r}});var De=Nt.keys&&function(){return 2===Nt.keys(arguments).length}(1,2),Qt=Nt.keys&&function(){var t=Nt.keys(arguments);return 1!==arguments.length||1!==t.length||1!==t[0]}(1),Pe=Nt.keys;k(Nt,{keys:function(t){return Pe(be(t)?W(t):t)}},!De||Qt);var Ge,Ue,xe=0!==new Date(-0xc782b5b342b24).getUTCMonth(),Fe=new Date(-0x55d318d56a724),qe=new Date(14496624e5),We="Mon, 01 Jan -45875 11:59:59 GMT"!==Fe.toUTCString(),He=Fe.getTimezoneOffset();-720>He?(Ge="Tue Jan 02 -45875"!==Fe.toDateString(),Ue=!/^Thu Dec 10 2015 \d\d:\d\d:\d\d GMT[-+]\d\d\d\d(?: |$)/.test(qe+"")):(Ge="Mon Jan 01 -45875"!==Fe.toDateString(),Ue=!/^Wed Dec 09 2015 \d\d:\d\d:\d\d GMT[-+]\d\d\d\d(?: |$)/.test(qe+""));var Ke=c.bind(Date.prototype.getFullYear),Qe=c.bind(Date.prototype.getMonth),Ye=c.bind(Date.prototype.getDate),Be=c.bind(Date.prototype.getUTCFullYear),je=c.bind(Date.prototype.getUTCMonth),Je=c.bind(Date.prototype.getUTCDate),Ve=c.bind(Date.prototype.getUTCDay),Xe=c.bind(Date.prototype.getUTCHours),ze=c.bind(Date.prototype.getUTCMinutes),$e=c.bind(Date.prototype.getUTCSeconds),Ze=c.bind(Date.prototype.getUTCMilliseconds),et=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],tt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],nt=function(n,e){return Ye(new Date(e,n,0))};k(Date.prototype,{getFullYear:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var t=Ke(this);return 0>t&&11<Qe(this)?t+1:t},getMonth:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var n=Ke(this),e=Qe(this);return 0>n&&11<e?0:e},getDate:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var a=Ke(this),e=Qe(this),t=Ye(this);if(0>a&&11<e){if(12===e)return t;var n=nt(0,a+1);return n-t+1}return t},getUTCFullYear:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var t=Be(this);return 0>t&&11<je(this)?t+1:t},getUTCMonth:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var n=Be(this),e=je(this);return 0>n&&11<e?0:e},getUTCDate:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var a=Be(this),e=je(this),t=Je(this);if(0>a&&11<e){if(12===e)return t;var n=nt(0,a+1);return n-t+1}return t}},xe),k(Date.prototype,{toUTCString:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var l=Ve(this),e=Je(this),t=je(this),n=Be(this),i=Xe(this),o=ze(this),a=$e(this);return et[l]+", "+(10>e?"0"+e:e)+" "+tt[t]+" "+n+" "+(10>i?"0"+i:i)+":"+(10>o?"0"+o:o)+":"+(10>a?"0"+a:a)+" GMT"}},xe||We),k(Date.prototype,{toDateString:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var a=this.getDay(),e=this.getDate(),t=this.getMonth(),n=this.getFullYear();return et[a]+" "+tt[t]+" "+(10>e?"0"+e:e)+" "+n}},xe||Ge),(xe||Ue)&&(Date.prototype.toString=function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var m=this.getDay(),e=this.getDate(),t=this.getMonth(),n=this.getFullYear(),i=this.getHours(),o=this.getMinutes(),a=this.getSeconds(),r=this.getTimezoneOffset(),l=U(d(r)/60),s=U(d(r)%60);return et[m]+" "+tt[t]+" "+(10>e?"0"+e:e)+" "+n+" "+(10>i?"0"+i:i)+":"+(10>o?"0"+o:o)+":"+(10>a?"0"+a:a)+" GMT"+(0<r?"-":"+")+(10>l?"0"+l:l)+(10>s?"0"+s:s)},L&&Nt.defineProperty(Date.prototype,"toString",{configurable:!0,enumerable:!1,writable:!0}));var it=-621987552e5,ot="-000001",at=Date.prototype.toISOString&&-1===new Date(it).toISOString().indexOf(ot),rt=Date.prototype.toISOString&&"1969-12-31T23:59:59.999Z"!==new Date(-1).toISOString(),lt=c.bind(Date.prototype.getTime);k(Date.prototype,{toISOString:function(){if(!isFinite(this)||!isFinite(lt(this)))throw new RangeError("Date.prototype.toISOString called on non-finite value.");var a=Be(this),e=je(this);a+=U(e/12),e=(e%12+12)%12;var t=[e+1,Je(this),Xe(this),ze(this),$e(this)];a=(0>a?"-":9999<a?"+":"")+K("00000"+d(a),0<=a&&9999>=a?-4:-6);for(var n=0;n<t.length;++n)t[n]=K("00"+t[n],-2);return a+"-"+W(t,0,2).join("-")+"T"+W(t,2).join(":")+"."+K("000"+Ze(this),-3)+"Z"}},at||rt);var st=function(){try{return Date.prototype.toJSON&&null===new Date(NaN).toJSON()&&-1!==new Date(it).toJSON().indexOf(ot)&&Date.prototype.toJSON.call({toISOString:function(){return!0}})}catch(t){return!1}}();st||(Date.prototype.toJSON=function(){var e=Nt(this),t=F.ToPrimitive(e);if("number"==typeof t&&!isFinite(t))return null;var n=e.toISOString;if(!D(n))throw new TypeError("toISOString property is not callable");return n.call(e)});var _t=Date.prototype.toLocaleString;Date.prototype.toLocaleString=function(){try{return _t()}catch(t){return""}};var dt=1e15===Date.parse("+033658-09-27T01:46:40.000Z"),Yt=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"))||!isNaN(Date.parse("2012-12-31T23:59:60.000Z")),ct=isNaN(Date.parse("2000-01-01T00:00:00.000Z"));if(ct||Yt||!dt){var pt=2147483647,mt=G(new Date(1970,0,1,0,0,0,pt+1).getTime());Date=function(T){var e=function(_,E,i,o,a,r,l){var s,d=arguments.length;if(this instanceof T){var u=r,c=l;if(mt&&7<=d&&l>pt){var p=U(l/pt)*pt,m=U(p/1e3);u+=m,c-=1e3*m}s=1===d&&Mt(_)===_?new T(e.parse(_)):7<=d?new T(_,E,i,o,a,u,c):6<=d?new T(_,E,i,o,a,u):5<=d?new T(_,E,i,o,a):4<=d?new T(_,E,i,o):3<=d?new T(_,E,i):2<=d?new T(_,E):1<=d?new T(_ instanceof T?+_:_):new T}else s=T.apply(this,arguments);return P(s)||k(s,{constructor:e},!0),s},u=/^(\d{4}|[+-]\d{6})(?:-(\d{2})(?:-(\d{2})(?:T(\d{2}):(\d{2})(?::(\d{2})(?:(\.\d{1,}))?)?(Z|(?:([-+])(\d{2}):(\d{2})))?)?)?)?$/,l=[0,31,59,90,120,151,181,212,243,273,304,334,365],n=function(i,e){var t=1<e?1:0;return l[e]+U((i-1969+t)/4)-U((i-1901+t)/100)+U((i-1601+t)/400)+365*(i-1970)},o=function(e){var t=0,n=e;if(mt&&n>pt){var i=U(n/pt)*pt,o=U(i/1e3);t+=o,n-=1e3*o}return ht(new T(1970,0,1,0,0,t,n))};for(var i in T)v(T,i)&&(e[i]=T[i]);k(e,{now:T.now,UTC:T.UTC},!0),e.prototype=T.prototype,k(e.prototype,{constructor:e},!0);return k(e,{parse:function(e){var t=u.exec(e);if(t){var i,a=ht(t[1]),l=ht(t[2]||1)-1,r=ht(t[3]||1)-1,_=ht(t[4]||0),d=ht(t[5]||0),s=ht(t[6]||0),p=U(1e3*ht(t[7]||0)),m=!(!t[4]||t[8]),c="-"===t[9]?1:-1,E=ht(t[10]||0),y=ht(t[11]||0);return _<(0<d||0<s||0<p?24:25)&&60>d&&60>s&&1e3>p&&-1<l&&12>l&&24>E&&60>y&&-1<r&&r<n(a,l+1)-n(a,l)&&(i=60*(24*(n(a,l)+r)+_+E*c),i=1e3*(60*(i+d+y*c)+s)+p,m&&(i=o(i)),-864e13<=i&&864e13>=i)?i:NaN}return T.parse.apply(this,arguments)}}),e}(Date)}Date.now||(Date.now=function(){return new Date().getTime()});var ft=l.toFixed&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==0xde0b6b3a7640080.toFixed(0)),Et={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function(a,e){for(var t=-1,n=e;++t<Et.size;)n+=a*Et.data[t],Et.data[t]=n%Et.base,n=U(n/Et.base)},divide:function(i){for(var e=Et.size,t=0;0<=--e;)t+=Et.data[e],Et.data[e]=U(t/i),t=t%i*Et.base},numToString:function(){for(var i=Et.size,e="";0<=--i;)if(""!==e||0===i||0!==Et.data[i]){var t=Mt(Et.data[i]);""===e?e=t:e+=K("0000000",0,7-t.length)+t}return e},pow:function a(e,t,n){return 0===t?n:1==t%2?a(e,t-1,n*e):a(e*e,t/2,n)},log:function(i){for(var e=0,t=i;4096<=t;)e+=12,t/=4096;for(;2<=t;)e+=1,t/=2;return e}};k(l,{toFixed:function(_){var e,t,d,i,o,m,r,l;if(e=ht(_),e=G(e)?0:U(e),0>e||20<e)throw new RangeError("Number.toFixed called with invalid number of decimals");if(t=ht(this),G(t))return"NaN";if(-1e21>=t||1e21<=t)return Mt(t);if(d="",0>t&&(d="-",t=-t),i="0",1e-21<t)if(o=Et.log(t*Et.pow(2,69,1))-69,m=0>o?t*Et.pow(2,-o,1):t/Et.pow(2,o,1),m*=4503599627370496,o=52-o,0<o){for(Et.multiply(0,m),r=e;7<=r;)Et.multiply(1e7,0),r-=7;for(Et.multiply(Et.pow(10,r,1),0),r=o-1;23<=r;)Et.divide(8388608),r-=23;Et.divide(1<<r),Et.multiply(1,1),Et.divide(2),i=Et.numToString()}else Et.multiply(0,m),Et.multiply(1<<-o,0),i=Et.numToString()+K("0.00000000000000000000",2,2+e);return 0<e?(l=i.length,i=l<=e?d+K("0.0000000000000000000",0,e-l+2)+i:d+K(i,0,l-e)+"."+K(i,l-e)):i=d+i,i}},ft);var yt=function(){try{return"1"===1 .toPrecision(void 0)}catch(t){return!0}}(),gt=l.toPrecision;k(l,{toPrecision:function(t){return"undefined"==typeof t?gt.call(this):gt.call(this,t)}},yt),2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||1<".".split(/()()/).length?!function(){var t="undefined"==typeof /()??/.exec("")[1];a.split=function(n,E){var y=this+"";if("undefined"==typeof n&&0===E)return[];if(!w(n))return Q(this,n,E);var a,r,l,s,f=[],d=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.unicode?"u":"")+(n.sticky?"y":""),T=0,c=new RegExp(n.source,d+"g");t||(a=new RegExp("^"+c.source+"$(?!\\s)",d));var p="undefined"==typeof E?4294967295:F.ToUint32(E);for(r=c.exec(y);r&&(l=r.index+r[0].length,!(l>T&&(B(f,K(y,T,r.index)),!t&&1<r.length&&r[0].replace(a,function(){for(var t=1;t<arguments.length-2;t++)"undefined"==typeof arguments[t]&&(r[t]=void 0)}),1<r.length&&r.index<y.length&&u.apply(f,W(r,1)),s=r[0].length,T=l,f.length>=p)));)c.lastIndex===r.index&&c.lastIndex++,r=c.exec(y);return T===y.length?!s&&c.test("")||B(f,""):B(f,K(y,T)),f.length>p?W(f,0,p):f}}():["0"].length&&(a.split=function(n,i){return"undefined"==typeof n&&0===i?[]:Q(this,n,i)});var Tt=a.replace,Rt=function(){var i=[];return"x".replace(/x(.)?/g,function(e,t){B(i,t)}),1===i.length&&"undefined"==typeof i[0]}();Rt||(a.replace=function(l,n){var e=D(n),t=w(l)&&/\)[*?]/.test(l.source);if(e&&t){var i=function(i){var e=arguments.length,t=l.lastIndex;l.lastIndex=0;var o=l.exec(i)||[];return l.lastIndex=t,B(o,arguments[e-2],arguments[e-1]),n.apply(this,o)};return Tt.call(this,l,i)}return Tt.call(this,l,n)});var St=a.substr,Ct="".substr&&"b"!=="0b".substr(-1);k(a,{substr:function(i,e){var t=i;return 0>i&&(t=y(this.length+i,0)),St.call(this,t,e)}},Ct);var At="\t\n\x0B\f\r \xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF",It=/^[	\n\v\f\r   ᠎             　\u2028\u2029﻿][	\n\v\f\r   ᠎             　\u2028\u2029﻿]*/,vt=/[	\n\v\f\r   ᠎             　\u2028\u2029﻿][	\n\v\f\r   ᠎             　\u2028\u2029﻿]*$/,wt=a.trim&&(At.trim()||!"\u200B".trim());k(a,{trim:function(){if("undefined"==typeof this||null===this)throw new TypeError("can't convert "+this+" to object");return Mt(this).replace(It,"").replace(vt,"")}},wt);var Ot=c.bind(e.trim),bt=a.lastIndexOf&&-1!=="abc\u3042\u3044".lastIndexOf("\u3042\u3044",2);k(a,{lastIndexOf:function(_){if("undefined"==typeof this||null===this)throw new TypeError("can't convert "+this+" to object");for(var e=Mt(this),t=Mt(_),n=1<arguments.length?ht(arguments[1]):NaN,i=G(n)?1/0:F.ToInteger(n),o=f(y(i,0),e.length),a=t.length,d=o+a;0<d;){d=y(0,d-a);var l=Y(K(e,d,o+a),t);if(-1!==l)return d+l}return-1}},bt);var Lt=a.lastIndexOf;if(k(a,{lastIndexOf:function(){return Lt.apply(this,arguments)}},1!==a.lastIndexOf.length),8===parseInt(At+"08")&&22===parseInt(At+"0x16")||(parseInt=function(l){var e=/^[-+]?0[xX]/;return function(t,n){var i=Ot(t+""),o=ht(n)||(e.test(i)?16:10);return l(i,o)}}(parseInt)),1/parseFloat("-0")!=-(1/0)&&(parseFloat=function(a){return function(e){var t=Ot(e+""),n=a(t);return 0===n&&"-"===K(t,0,1)?-0:n}}(parseFloat)),"RangeError: test"!==new RangeError("test")+""){var Dt=function(){if("undefined"==typeof this||null===this)throw new TypeError("can't convert "+this+" to object");var n=this.name;"undefined"==typeof n?n="Error":"string"!=typeof n&&(n=Mt(n));var i=this.message;return"undefined"==typeof i?i="":"string"!=typeof i&&(i=Mt(i)),n?i?n+": "+i:n:i};Error.prototype.toString=Dt}if(L){var kt=function(i,e){if(j(i,e)){var t=Object.getOwnPropertyDescriptor(i,e);t.configurable&&(t.enumerable=!1,Object.defineProperty(i,e,t))}};kt(Error.prototype,"message"),""!==Error.prototype.message&&(Error.prototype.message=""),kt(Error.prototype,"name")}if("/a/gim"!==/a/gim+""){var Pt=function(){var t="/"+this.source+"/";return this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),t};RegExp.prototype.toString=Pt}})},function(){"use strict";"function"!=typeof Object.assign&&(Object.assign=function(a){if(void 0===a||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var e,i=Object(a),t=1;t<arguments.length;t++)if(e=arguments[t],void 0!==e&&null!==e)for(var n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);return i})},function(){"use strict";var e=JSON.stringify;JSON.stringify=function(){try{return e.apply(JSON,arguments)}catch(t){return""}}},,,,,,function(e){e.exports=n},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(l,e,t){"use strict";function n(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function a(a,o){for(var t,i=0;i<o.length;i++)t=o[i],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),o=t(62),a=function(){function t(){n(this,t),this.map={},this.dataHistory={}}return i(t,[{key:"addListener",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,_=this.map[a];_||(_=this.map[a]=[]);var i=this._findSameCallback(_,e);if(!(0<=i))return _.push({callback:e,priority:l}),_.sort(function(n,e){return e.priority-n.priority}),e}},{key:"addBehaviorListener",value:function(){for(var a=arguments.length,e=Array(a),t=0;t<a;t++)e[t]=arguments[t];this.addListener.apply(this,e);var n=e[0],i=this.dataHistory[n];void 0!==i&&this.dispatchEvent(n,i)}},{key:"removeListener",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},t=this.map[a];if(t){var n=this._findSameCallback(t,e);0<=n&&t.splice(n,1)}}},{key:"removeAllListeners",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";this.map[t]=[]}},{key:"dispatchEvent",value:function(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.dataHistory[i]=a;var o=this.map[i];o&&o.forEach(function(o){o.callback({eventName:i,userData:a})})}},{key:"_findSameCallback",value:function(i,e){for(var t=0;t<i.length;t++)if(i[t].callback==e)return t;return-1}}]),t}();window.eventDispatcher=l.exports=new a,window.EventID=o},function(t){"use strict";t.exports={LOGOUT:"LOGOUT",PLAYER_INFO_NTF:"PLAYER_INFO_NTF",STAGE_NTF:"STAGE_NTF",AT_HEART:"AT_HEART",AT_DIAMOND:"AT_DIAMOND",AT_MONEY:"AT_MONEY",AT_ITEM:"AT_ITEM",STATICS_NTF:"STATICS_NTF",MAP_FRIEND_NTF:"MAP_FRIEND_NTF",PLAYER_BASEINFO_NTF:"PLAYER_BASEINFO_NTF",MAIL_LIST_NTF:"MAIL_LIST_NTF",SETTLEMENT_SUCCESS:"SETTLEMENT_SUCCESS",SETTLEMENT_FAIL:"SETTLEMENT_FAIL",READ_MAIL_EVENT:"READ_MAIL_EVENT",HEART_RECOVERY:"HEART_RECOVERY",BUY_DIAMOND_SUCCESS:"BUY_DIAMOND_SUCCESS",STAR_GIFT_NUM_CHANGED:"STAR_GIFT_NUM_CHANGED",ON_NETWORK_TIP_WINDOW_CANCEL:"ON_NETWORK_TIP_WINDOW_CANCEL",ON_NETWORK_TIP_WINDOW_RETRY:"ON_NETWORK_TIP_WINDOW_RETRY",ON_NETWORK_TIP_WINDOW_SHOW:"ON_NETWORK_TIP_WINDOW_SHOW",RANK_SEND_HEART_EVENT:"RANK_SEND_HEART_EVENT",ON_WINDOW_RESIZE:"ON_WINDOW_RESIZE",PAGE_CHANGED:"PAGE_CHANGED",ALL_ANIMATION_PLAY_COMPLETE:"ALL_ANIMATION_PLAY_COMPLETE",ON_GUIDE_COMPLETE:"ON_GUIDE_COMPLETE",ON_USE_PROP:"ON_USE_PROP",ON_SHARE:"ON_SHARE",ON_SHARE_SUCCESS:"ON_SHARE_SUCCESS",ON_SHARE_FAIL:"ON_SHARE_FAIL",ON_SHARE_GIFT_CONFIG:"ON_SHARE_GIFT_CONFIG",SHARE_INFO_NTF:"SHARE_INFO_NTF",QUEST_INFO_NTF:"QUEST_INFO_NTF",SHOW_MERGE_NTF:"SHOW_MERGE_NTF",ON_GAME_IN_IFRAME_SHOW:"ON_GAME_IN_IFRAME_SHOW",ON_GAME_IN_IFRAME_HIDE:"ON_GAME_IN_IFRAME_HIDE",ON_GAME_IN_IFRAME_CLOSE:"ON_GAME_IN_IFRAME_CLOSE",WEEK_MATCH_INFO_NTF:"WEEK_MATCH_INFO_NTF",ACT_INFO_NTF:"ACT_INFO_NTF",STAGE_JUMP_INFO_NTF:"STAGE_JUMP_INFO_NTF",REFRESH_RANK_EVENT:"REFRESH_RANK_EVENT",WEEK_MATCH_SETTLEMENT_SUCCESS:"WEEK_MATCH_SETTLEMENT_SUCCESS",RANK_REWARD_NTF:"RANK_REWARD_NTF",DESTROY_ALL_WINDOW:"DESTROY_ALL_WINDOW",HIDE_ALL_WINDOW:"HIDE_ALL_WINDOW",LOAD_WEEK_MATCH_GAME:"LOAD_WEEK_MATCH_GAME",ON_ADD_STEP_WINDOW_SHOW:"ON_ADD_STEP_WINDOW_SHOW",ON_READY_GO_EFFECT_COMPLETE:"ON_READY_GO_EFFECT_COMPLETE",ON_REARRANGE_CHESS_TIP_EFFECT_START_PLAY:"ON_REARRANGE_CHESS_TIP_EFFECT_START_PLAY",ON_REARRANGE_CHESS_COMPLETE:"ON_REARRANGE_CHESS_COMPLETE",ON_CHESS_CRUSH:"ON_CHESS_CRUSH",ON_SHARE_WEEK_MATCH:"ON_SHARE_WEEK_MATCH",ON_WEEK_MATCH_RESULT_WINDOW_DESTROY:"ON_WEEK_MATCH_RESULT_WINDOW_DESTROY",SENDDESKTOPCALLBACK:"SENDDESKTOPCALLBACK",SHARECALLBACK:"SHARECALLBACK",STICKY_CALLBACK:"STICKY_CALLBACK",AUTO_REARRANGE_CHESS:"AUTO_REARRANGE_CHESS",ON_WX_SHOW:"ON_WX_SHOW"}},function(t){"use strict";t.exports={host:{daily:"wss://social.qq.com/axc_daily",test:"wss://social.qq.com/axc_test",deploy:"wss://social.qq.com/axc_online",online:"wss://h5xcx.h5game.qq.com/axc_online"},flag:{wechat:"wechat",qq:"qq_m"},appid:"wx4b05dce3b041cd62",qqappid:"1105851156",timeout:15e3,timeoutLong:3e4,heart:6e4}},function(l,e,t){"use strict";var _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n=t(63),o={},i={readLocalConfig:function(i,a){var t=wx.getFileSystemManager&&wx.getFileSystemManager().readFile||wx.readFile;if(t)return t({filePath:i,encoding:"utf8",success:function(t){var e=JSON.parse(t.data);a&&a(null,e)},fail:function(n){var e=n.errMsg||n;"string"!=typeof e&&(e=JSON.stringify(e)),cb({status:500,errorMessage:e},null)}})},loadJson:function(a,l){var t;try{t=new XMLHttpRequest}catch(t){}var n=function(){if(o[a]&&5<=o[a]){var e=t.getResponseHeader("date");l(!0,null,new Date(e))}else o[a]?o[a]+=1:o[a]=1,setTimeout(function(){i.loadJson(a,l)},200)};t&&(t.onreadystatechange=function(){if(4===t.readyState)if(200===t.status){var i=t.responseText;i=JSON.parse(i);var e=t.getResponseHeader("date");l&&l(null,i,new Date(e))}else n()},t.onerror=n,t.open("GET",a,!0),t.send())},tmpl:function(){var d={},i=function(t){return 0==t?t:(t=(t||"").toString(),t.replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;"))},e=function(a,e){if(e)for(var t in e){var n=new RegExp("<%#\\s?"+t+"%>","g");a=a.replace(n,e[t])}return a};return function t(n,o,a){var r=!/\W/.test(n);r||(n=e(n,a));var l=r?d[n]=d[n]||t(e(document.getElementById(n).innerHTML,a)):new Function("obj","_escape","var _p='';with(obj){_p+='"+n.replace(/[\r\t\n]/g," ").split("\\'").join("\\\\'").split("'").join("\\'").split("<%").join("\t").replace(/\t-(.*?)%>/g,"'+$1+'").replace(/\t=(.*?)%>/g,"'+_escape($1)+'").split("\t").join("';").split("%>").join("_p+='")+"';} return _p;"),s=function(t){return l(t,i)};return o?s(o):s}}(),insertStyle:function(i,a){var t=function(){var t=document.createElement("style");t.type="text/css",a&&(t.id=a),document.getElementsByTagName("head")[0].appendChild(t),i&&("object"===("undefined"==typeof i?"undefined":_(i))&&(i=i.join("")),t.styleSheet?t.styleSheet.cssText=i:t.appendChild(document.createTextNode(i)))};a?!document.getElementById(a)&&t():t()},showNetworkTip:function(n,e){this._isCanShowNetworkRetryWindow()&&NetworkRetryWindow.Show(Language.getString(LanguageKey.NET_ERROR),function(){n&&n()},function(){window.NetLoadingWindow&&NetLoadingWindow.Hide(),e&&e()})},showNetworkNoRetryTip:function(t){this._isCanShowNetworkRetryWindow()&&NetworkRetryWindow.ShowSureButton(Language.getString(LanguageKey.NET_ERROR_2),function(){window.NetLoadingWindow&&NetLoadingWindow.Hide(),t&&t()})},_isCanShowNetworkRetryWindow:function(){return window.NetworkRetryWindow&&window.Language&&window.cc&&window.cc.director.getRunningScene()},isTestEnv:function(){return"test"==window.serverEnv},isDailyEnv:function(){return"daily"==window.serverEnv},isProductEnv:function(){return"deploy"==window.serverEnv||"online"==window.serverEnv},isUnProductEnv:function(){return!this.isProductEnv()},getUrl:function(){var t="";return this.getLoginPf().isWX&&(this.isProductEnv()||this.isTestEnv())?t=location.protocol+"//h5game.qq.com/hpang/wxShareProxy.html":(t=location.protocol+"//h5game.qq.com"+location.pathname+"?_wv=131840&_wwv=4",this.isUnProductEnv()&&(t+="&wegame_test=1")),t},getClient:function(){var a=wx.getSystemInfoSync(),e=a.system,t=/ios/i.test(e),o=/Android/i.test(e);return{isMobile:!0,isAndroid:o,isIOS:t}},isDevTool:function(){var t=wx.getSystemInfoSync();return"devtools"==t.platform},getLoginPf:function(){return{isWX:NetData.pf==n.flag.wechat,isQQ:NetData.pf==n.flag.qq}},queryStringToJSON:function(){var t=wx.getLaunchOptionsSync().query;return t},_preventEvt:function(t){t.preventDefault(),t.stopPropagation()},bindTap:function(l,_,m){var n=this,e=this.getClient().isMobile;if(e){var i,a;l.addEventListener("touchstart",function(o){var e=o.touches[0];i=e.clientX,a=e.clientY,m&&n._preventEvt(o)}),l.addEventListener("touchend",function(t){var e=t.changedTouches[0],o=e.clientX,l=e.clientY;6>d(i-o)&&6>d(a-l)&&_&&_.call(null,t),m&&n._preventEvt(t)})}else l.addEventListener("click",function(t){_&&_.call(null,t),m&&n._preventEvt(t)})},getPhoneFlag:function(){var a=navigator.userAgent,e="",t=/(iPhone)|(iPad)|(iPod)/i.exec(a);if(t&&t[0])return e=t[0];var n=/;\s?([^;]+?)\s?(Build)?\//,i=n.exec(a);return i&&i[1]&&(e=i[1].replace(/\//g,"_").replace(/\s/g,"_")),e}};l.exports=i},function(t){"use strict";var e={user_info:{code:"",openid:"",nick:"",headimgurl:""},now_unix_timestamp:"",last_sign_time:"",month_sign_days:"",entrance_guide_time:"",new_user_award_info:{activity_end_time:0,last_take_time:0,already_take_days:0},heart:{},diamond:{},money:{},item_list:{item:[]},player_info_ntf:{},random_item_info_ntf:{},stage_ntf:{},statics_ntf:{stage_statics:{max_stage_id:0}},mail_list_ntf:{type:0,mail_list:[]},player_baseinfo_ntf:{baseinfo_list:[]},map_friend_ntf:{friend_list:[]},quest_info_ntf:{quest_info_list:[]},pf:"",pfMode:0,loginStatus:0,loadConfigStatus:0,share_info_ntf:{},week_match_info_ntf:{},rank_reward_ntf:[],reward_pool_apd:[],act_info_ntf:{act_info_list:[]}};window.NetData=e,t.exports=e},function(l,e,t){"use strict";var _=t(63),i=t(64),n=(t(65),{_pageTitle:"\u7231\u6D88\u9664\u4E50\u56ED",_logoUrl:"http://h5game.qq.com/hpang_logo.png",appid:_.appid,qqappid:_.qqappid,init:function(){console.log("meanwang : X8SDK init called")},checkLogin:function(){console.logError("X8SDK check login called")},share:function(){},shareMessage:function(){},customShare:function(){},_restoreDefaultShare:function(){clearTimeout(this.restoreShareTimeout),this.share()},_extendShareCfg:function(a){a=a||{};var e={image_url:this._logoUrl,title:this._pageTitle,desc:"\u65E0\u9700\u4E0B\u8F7D\u5B89\u88C5, \u70B9\u5F00\u5C31\u53EF\u76F4\u63A5\u73A9\u7684\u7231\u6D88\u9664"};for(var t in a)e[t]=a[t];return this.pf==_.flag.wechat?e.wx_share_url=i.getUrl():(e.share_url=i.getUrl(),e.sourceName="\u7231\u6D88\u9664\u4E50\u56ED"),e},isQQ:function(){return!1},isWX:function(){return!0},loadJS:function(){},getLandingState:function(){return{}},getNewAccessToken:function(){},setQQScoreBatch:function(t){t.qqappid=this.qqappid;var e=0,n=navigator.userAgent,o=/Android/.test(n),a=/iPhone|iPad|iPod/.test(n);o?e=1:a&&(e=2),t.qqscorelist.push({type:12,bcover:1,data:e,expires:0})},setWXScoreBatch:function(){},setWXBasicReport:function(){},setWXReport:function(){},sendDesktop:function(){},addQQGameShortcut:function(){},getWxFullUrl:function(){var n=i.isUnProductEnv()?"&wegame_test=1":"",e="https://game.weixin.qq.com/cgi-bin/h5/static/gameloading/index.html?appid="+this.appid+n+"#wechat_redirect";return e},sendHeartNtf:function(n,e){this.sendNtf({friend_openid:n.friend_openid,title:"\u7231\u6D88\u9664\u9001\u5FC3",description:"\u6211\u9001\u4E86\u9897\u5FC3\u7ED9\u4F60,\u4F60\u80FD\u9001\u6211\u4E00\u9897\u5417?",fail_desc:"\u9001\u5FC3\u901A\u77E5\u5931\u8D25"},e)},sendNtf:function(){},openUrlWithExtraWebview:function(){},closeWXWindow:function(){},onGameVisibilityChange:function(){},promiseWeixinJSBridge:function(){},setCloseTip:function(){},_setCloseWindowConfirmDialogInfo:function(){},_setOnCloseHandler:function(){},onFreshToken:function(){},getNetworkInfo:function(){},getWXListSubscribe:function(){},setWXListSubscribe:function(){}});window.X8SDK=n,l.exports=n},function(a,e,t){"use strict";var n=t(64),l=t(68);a.exports={basePath:"/config/common/",url:[{key:"ItemConf",val:"ItemConf.bin.json"},{key:"GoodsConf",val:"GoodsConf.bin.json"},{key:"StageVersionConf",val:"StageVersionConf.bin.json"}],init:function(a){var o=this,e=this.url.length,_=function(){e--,0>=e&&a&&a()};this.url.forEach(function(t){var i=t.key,e=t.val;return"GoodsConf"==i&&window.testGoodsData?(l[i]=testGoodsData,void _()):void o.load(e,function(n,e){e&&(l[i]=e,_())})})},load:function(i,e){n.readLocalConfig("config/common/"+i,e)}}},function(t){"use strict";var e={ItemConf:{},GoodsConf:{},FirstRewardPool:{}};window.ConfigData=e,t.exports=e},function(d,e,t){"use strict";var n=t(63),i=t(70),o=(t(64),t(65)),a=t(66),r=t(71),l=t(74),s=(t(78),{flag:n.flag,init:function(i,e,t){console.log("gameService \u521D\u59CB\u5316"),this._registerMainTimeout(),this.pf=i,l.init(e,t)},_initMain:function(){var t=this;r.init(),a.share(),a.sendDesktop();try{a.isWX()&&!window.DEBUG&&window.GetCurVersion&&setTimeout(function(){a.setWXBasicReport({game_version:GetCurVersion()}),a.setWXReport({type:"login"})},2e3)}catch(t){}a.onFreshToken(function(){t._refreshAccessToken()}),this._setWxFont(),a.setCloseTip()},_refreshAccessToken:function(){var n=a.getLandingState()||{},e={};this.pf==this.flag.wechat?e={buff:n.access_token}:this.pf==this.flag.qq&&(e={buff:n.pay_token}),this.refreshAccessToken({atk:e},function(){})},_setWxFont:function(){a.promiseWeixinJSBridge(function(){try{WeixinJSBridge.invoke("setFontSizeCallback",{fontSize:0}),WeixinJSBridge.on("menu:setfont",function(){WeixinJSBridge.invoke("setFontSizeCallback",{fontSize:0})})}catch(t){}})},_registerSdkTimeout:function(){var e=this;this._clearSdkTimeout(),this.sdkTimeout=setTimeout(function(){e.clearMainTimeout(),console.log("sdk\u5F02\u5E38\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC\u540E\u91CD\u8BD5")},n.timeoutLong)},_clearSdkTimeout:function(){clearTimeout(this.sdkTimeout),this.sdkTimeout=null},_registerMainTimeout:function(){this.clearMainTimeout()},clearMainTimeout:function(){clearTimeout(this.mainTimeout),this.mainTimeout=null},_reportPT:function(l){var e=this;setTimeout(function(){try{var n=l.game_info.score,_=o.statics_ntf.stage_statics.max_stage_id;e.pf==e.flag.qq&&a.setQQScoreBatch({qqscorelist:[{type:3,bcover:0,data:n,expires:parseInt(new Date().getTime()/1e3)},{type:19,bcover:1,data:_,expires:0}]},function(){})}catch(t){}},1e3)},createCallBackMap:function(l,e,t,n,i,o){return Service.CmdManager.createCallBackMap(l,e,t,n,i,o)},heartbeat:function(n,e){l.heartbeat(n,e)},getStageInfo:function(n,e){l.request(i.MC_STAGE_INFO_REQ.cmd,n,e)},unlockStage:function(n,e){l.request(i.MC_STAGE_UNLOCK_REQ.cmd,n,e)},stageStart:function(n,e){return Service.CmdManager.doCmd(i.MC_STAGE_START_REQ.cmd,n,e,!0,!0)},getStageRank:function(n,e){l.request(i.MC_STAGE_RANK_REQ.cmd,n,e)},stageItemUse:function(n,e){l.request(i.MC_STAGE_USE_ITEM_REQ.cmd,n,e,!0)},stageReport:function(a,e,t){l.request(i.MC_STAGE_REPORT_REQ.cmd,a,e,t)},buyGoods:function(a,e,t){console.log("buyGoods: "+JSON.stringify(a)),l.request(i.MC_BUY_GOODS_REQ.cmd,a,e,t)},buyDiamondReport:function(n,e){console.log("buyDiamondReport"),l.request(i.MC_BUY_DIAMOND_REPORT_REQ.cmd,n,e)},getMapFriend:function(n,e){l.request(i.MC_GET_MAP_FRIEND_REQ.cmd,n,e,!0)},getPlayerBaseinfo:function(n,e){l.request(i.MC_GET_PLAYER_BASEINFO_REQ.cmd,n,e,!0)},getMailList:function(n,e){l.request(i.MC_GET_MAIL_LIST_REQ.cmd,n,e,!0)},updateMail:function(n,e){l.request(i.MC_UPDATE_MAIL_REQ.cmd,n,e)},updateBatchMail:function(n,e){l.request(i.MC_UPDATE_MAIL_BATCH_REQ.cmd,n,e)},updateRankListByPage:function(n,e){this.updateGroupRankList(n,e)},updateGroupRankList:function(n,a){wx.getShareInfo({shareTicket:n&&n.shareTicket?n.shareTicket:"",success:function(t){console.log("getShareInfo success",t),l.request(i.MC_GET_GROUP_RANK_REQ.cmd,{encrypted_data:t.encryptedData,iv:t.iv},function(t,e){a&&a(t,e)})},fail:function(t){console.log("getShareInfo fail",t),a&&a({msg:t.errMsg},null)}})},getRewardByMapID:function(n,e){l.request(i.MC_GET_STAR_REWARD_REQ.cmd,n,e)},getGmCmdInfo:function(n,e){l.request(i.MC_GM_CMD_INFO_REQ.cmd,n,e)},setGmCmdInfo:function(n,e){l.request(i.MC_GM_CMD_SET_REQ.cmd,n,e)},sendHeart:function(n,e){l.request(i.MC_SEND_HEART_REQ.cmd,n,e)},sendHeartNtf:function(n,e){a.sendHeartNtf(n,e)},sendNtf:function(n,e){a.sendNtf(n,e)},setProfile:function(n,e){l.request(i.MC_PROFILE_SETTING_REQ.cmd,n,e)},getNotice:function(n,e){l.request(i.GET_NOTICE_REQ.cmd,n,e,!0)},sign:function(n,e){l.request(i.SIGN_REQ.cmd,n,e)},takeNewUserAward:function(n,e){l.request(i.MC_Take_NEW_USER_AWARD_REQ.cmd,n,e)},share:function(n,a){l.request(i.MC_SHARE_REQ.cmd,n,function(t,e){o.share_info_ntf.is_first_share=e&&void 0!=e.is_first_share?e.is_first_share:0,a&&a(t,e)})},takeShareAward:function(n,e){l.request(i.MC_TAKE_SHARE_AWARD_REQ.cmd,n,e)},takeTaskAward:function(n,e){return Service.CmdManager.doCmd(i.MC_QUEST_REWARD_REQ.cmd,n,e,!0,!1)},firstFlaunt:function(n,e){l.request(i.MC_FLAUNT_REQ.cmd,n,e)},refreshAccessToken:function(n,e){l.request(i.MC_REFRESH_ACCESS_TOKEN_REQ.cmd,n,e)},reportOneYuanBuy:function(n,e){l.request(i.MC_ONEYUAN_BUY_REPORT_REQ.cmd,n,e)},weekMatchStart:function(n,e){l.request(i.MC_WEEK_MATCH_START_REQ.cmd,n,e)},weekMatchReport:function(n,e){l.request(i.MC_WEEK_MATCH_REPORT_REQ.cmd,n,e)},weekMatchShare:function(n,e){l.request(i.MC_WEEK_MATCH_SHARE_REQ.cmd,n,e)},getActCenterInfo:function(n,e){l.request(i.MC_GET_ACT_INFO_REQ.cmd,n,e)},jumpStage:function(n,e){l.request(i.MC_STAGE_JUMP_REQ.cmd,n,e)},entranceGuideReport:function(t){l.request(i.MC_ENTRANCE_GUIDE_REPORT_REQ.cmd,{},t)},getArenaMatchId:function(n,e){l.request(i.MC_GET_ARENA_MATCH_ID_REQ.cmd,n,e)},arenaMatchSahre:function(n,e){l.request(i.MC_ARENA_MATCH_SHARE_REQ.cmd,n,e)},arenaMatchStart:function(n,e){return Service.CmdManager.doCmd(i.MC_ARENA_MATCH_START_REQ.cmd,n,e,!0,!0)},arenaMatchReport:function(a,e,t){l.request(i.MC_ARENA_MATCH_REPORT_REQ.cmd,a,e,t)},getArenaMatchRank:function(n,e){l.request(i.MC_GET_ARENA_MATCH_RANK_REQ.cmd,n,e)}});window.GameService=s,d.exports=s},function(t){"use strict";t.exports={MC_LOGIN_REQ:{cmd:1001,bodyKey:"login_req"},MC_LOGIN_RES:{cmd:1002,bodyKey:"login_res"},MC_LOGOUT_NTF:{cmd:1031,bodyKey:"log_out_ntf",push:!0,eventId:"LOGOUT"},MC_LOGOUT_REPORT:{cmd:1032,bodyKey:""},MC_PLAYER_INFO_NTF:{cmd:1005,bodyKey:"player_info_ntf",push:!0,eventId:"PLAYER_INFO_NTF",dataKey:"player_info_ntf"},MC_ATTR_NTF:{cmd:1006,bodyKey:"attr_ntf",push:!0,eventId:{1:"AT_HEART",2:"AT_DIAMOND",3:"AT_MONEY",4:"AT_ITEM"},dataKey:{1:"heart",2:"diamond",3:"money",4:"item_list"}},MC_STAGE_NTF:{cmd:1007,bodyKey:"stage_ntf",push:!0,incremental:!0,eventId:"STAGE_NTF",dataKey:"stage_ntf"},MC_STATICS_NTF:{cmd:1008,bodyKey:"statics_ntf",push:!0,eventId:"STATICS_NTF",dataKey:"statics_ntf"},MC_STAGE_INFO_REQ:{cmd:1009,bodyKey:"stage_info_req"},MC_STAGE_INFO_RES:{cmd:1010,bodyKey:"stage_info_res"},MC_STAGE_START_REQ:{cmd:1014,bodyKey:"stage_start_req"},MC_STAGE_START_RES:{cmd:1015,bodyKey:"stage_start_res"},MC_STAGE_REPORT_REQ:{cmd:1016,bodyKey:"stage_report_req"},MC_STAGE_REPORT_RES:{cmd:1017,bodyKey:"stage_report_res"},MC_STAGE_RANK_REQ:{cmd:1018,bodyKey:"stage_rank_req"},MC_STAGE_RANK_RES:{cmd:1019,bodyKey:"stage_rank_res"},MC_STAGE_USE_ITEM_REQ:{cmd:1020,bodyKey:"stage_use_item_req"},MC_STAGE_USE_ITEM_RES:{cmd:1021,bodyKey:"stage_use_item_res"},MC_GET_STAR_REWARD_REQ:{cmd:1022,bodyKey:"get_star_reward_req"},MC_GET_STAR_REWARD_RES:{cmd:1023,bodyKey:"get_star_reward_res"},MC_REWARD_POOL_APD:{cmd:1050,bodyKey:"reward_pool_apd"},MC_BUY_GOODS_REQ:{cmd:1100,bodyKey:"buy_goods_req"},MC_BUY_GOODS_RES:{cmd:1101,bodyKey:"buy_goods_res"},MC_BUY_DIAMOND_REPORT_REQ:{cmd:1102,bodyKey:"buy_diamond_report_req"},MC_BUY_DIAMOND_REPORT_RES:{cmd:1103,bodyKey:"buy_diamond_report_res"},MC_RANDOM_ITEM_INFO_NTF:{cmd:1104,bodyKey:"random_item_info_ntf",push:!0,eventId:"RANDOM_ITEM_INFO_NTF",dataKey:"random_item_info_ntf"},MC_GET_MAIL_LIST_REQ:{cmd:1130,bodyKey:"get_mail_list_req"},MC_GET_MAIL_LIST_RES:{cmd:1131,bodyKey:"get_mail_list_res"},MC_MAIL_LIST_NTF:{cmd:1132,bodyKey:"mail_list_ntf",push:!0,eventId:"MAIL_LIST_NTF",dataKey:"mail_list_ntf"},MC_UPDATE_MAIL_REQ:{cmd:1133,bodyKey:"update_mail_req"},MC_UPDATE_MAIL_RES:{cmd:1134,bodyKey:"update_mail_res"},MC_UPDATE_MAIL_BATCH_REQ:{cmd:1135,bodyKey:"update_mail_batch_req"},MC_UPDATE_MAIL_BATCH_RES:{cmd:1136,bodyKey:"update_mail_batch_res"},MC_GET_PLAYER_BASEINFO_REQ:{cmd:1150,bodyKey:"get_player_baseinfo_req"},MC_GET_PLAYER_BASEINFO_RES:{cmd:1152,bodyKey:"get_player_baseinfo_res"},MC_GET_PLAYER_BASEINFO_NTF:{cmd:1151,bodyKey:"get_player_baseinfo_ntf",push:!0,eventId:"PLAYER_BASEINFO_NTF",dataKey:"player_baseinfo_ntf"},MC_GET_MAP_FRIEND_REQ:{cmd:1160,bodyKey:"get_map_friend_req"},MC_GET_MAP_FRIEND_RES:{cmd:1162,bodyKey:"get_map_friend_res"},MC_GET_MAP_FRIEND_NTF:{cmd:1161,bodyKey:"get_map_friend_ntf",push:!0,eventId:"MAP_FRIEND_NTF",dataKey:"map_friend_ntf"},MC_SEND_HEART_REQ:{cmd:1163,bodyKey:"send_heart_req"},MC_SEND_HEART_RES:{cmd:1164,bodyKey:"send_heart_res"},MC_GET_RANK_REQ:{cmd:1165,bodyKey:"get_rank_req"},MC_GET_RANK_RES:{cmd:1166,bodyKey:"get_rank_res"},MC_GET_GROUP_RANK_REQ:{cmd:1168,bodyKey:"get_group_rank_req"},MC_GET_GROUP_RANK_RES:{cmd:1169,bodyKey:"get_group_rank_res"},MC_GM_CMD_INFO_REQ:{cmd:1180,bodyKey:"gm_cmd_info_req"},MC_GM_CMD_INFO_RES:{cmd:1181,bodyKey:"gm_cmd_info_res"},MC_GM_CMD_SET_REQ:{cmd:1182,bodyKey:"gm_set_req"},MC_GM_CMD_SET_RES:{cmd:1183,bodyKey:"gm_set_res"},MC_HEARTBEAT_REQ:{cmd:1190,bodyKey:"heartbeat_req"},MC_HEARTBEAT_RES:{cmd:1191,bodyKey:"heartbeat_res"},MC_REFRESH_ACCESS_TOKEN_REQ:{cmd:1192,bodyKey:"refresh_access_token_req"},MC_REFRESH_ACCESS_TOKEN_RES:{cmd:1193,bodyKey:"refresh_access_token_res"},MC_PROFILE_SETTING_REQ:{cmd:1200,bodyKey:"profile_setting_req"},MC_PROFILE_SETTING_RES:{cmd:1201,bodyKey:"profile_setting_res"},MC_SEND_HEART_NOTIFY_REQ:{cmd:1220,bodyKey:"send_heart_ntf_req"},MC_SEND_HEART_NOTIFY_RES:{cmd:1221,bodyKey:"send_heart_ntf_res"},GET_NOTICE_REQ:{cmd:1230,bodyKey:"get_notice_req"},GET_NOTICE_RES:{cmd:1231,bodyKey:"get_notice_res"},SIGN_REQ:{cmd:1340,bodyKey:"sign_req"},SIGN_RES:{cmd:1341,bodyKey:"sign_res"},MC_Take_NEW_USER_AWARD_REQ:{cmd:1342,bodyKey:"take_new_user_award_req"},MC_Take_NEW_USER_AWARD_RES:{cmd:1343,bodyKey:"take_new_user_award_res"},MC_SHARE_INFO_NTF:{cmd:1350,push:!0,bodyKey:"share_info_ntf",eventId:"SHARE_INFO_NTF",dataKey:"share_info_ntf"},MC_SHARE_REQ:{cmd:1351,bodyKey:"share_req"},MC_SHARE_RES:{cmd:1352,bodyKey:"share_res"},MC_TAKE_SHARE_AWARD_REQ:{cmd:1353,bodyKey:"take_share_award_req"},MC_TAKE_SHARE_AWARD_RES:{cmd:1354,bodyKey:"take_share_award_res"},MC_FLAUNT_REQ:{cmd:1355,bodyKey:"flaunt_req"},MC_FLAUNT_RES:{cmd:1356,bodyKey:"flaunt_res"},MC_QUEST_INFO_NTF:{cmd:1360,push:!0,incremental:!0,bodyKey:"quest_info_ntf",eventId:"QUEST_INFO_NTF",dataKey:"quest_info_ntf"},MC_QUEST_REWARD_REQ:{cmd:1365,bodyKey:"quest_reward_req"},MC_QUEST_REWARD_RES:{cmd:1366,bodyKey:"quest_reward_res"},MC_ONEYUAN_BUY_REPORT_REQ:{cmd:1105},MC_ONEYUAN_BUY_REPORT_RES:{cmd:1106},MC_WEEK_MATCH_START_REQ:{cmd:1370,bodyKey:"week_match_start_req"},MC_WEEK_MATCH_START_RES:{cmd:1371,bodyKey:"week_match_start_res"},MC_WEEK_MATCH_REPORT_REQ:{cmd:1372,bodyKey:"week_match_report_req"},MC_WEEK_MATCH_REPORT_RES:{cmd:1373,bodyKey:"week_match_report_res"},MC_WEEK_MATCH_SHARE_REQ:{cmd:1374,bodyKey:"week_match_share_req"},MC_WEEK_MATCH_SHARE_RES:{cmd:1375,bodyKey:"week_match_share_res"},MC_WEEK_MATCH_INFO_NTF:{cmd:1376,bodyKey:"week_match_info_ntf",push:!0,eventId:"WEEK_MATCH_INFO_NTF",dataKey:"week_match_info_ntf"},MC_GET_ACT_INFO_REQ:{cmd:1362,bodyKey:"get_act_info_req"},MC_GET_ACT_INFO_RES:{cmd:1363,bodyKey:"get_act_info_res"},MC_ACT_INFO_NTF:{cmd:1364,bodyKey:"act_info_ntf",push:!0,eventId:"ACT_INFO_NTF",dataKey:"act_info_ntf"},MC_STAGE_JUMP_INFO_NTF:{cmd:1026,push:!0,eventId:"STAGE_JUMP_INFO_NTF",dataKey:"stage_jump_info_ntf",bodyKey:"stage_jump_info_ntf"},MC_RANK_REWARD_INFO_NTF:{cmd:1167,push:!0,eventId:"RANK_REWARD_NTF",dataKey:"rank_reward_ntf",bodyKey:"rank_reward_ntf"},MC_STAGE_JUMP_REQ:{cmd:1024,bodyKey:"stage_jump_req"},MC_STAGE_JUMP_RES:{cmd:1025,bodyKey:"stage_jump_res"},MC_ENTRANCE_GUIDE_REPORT_REQ:{cmd:1357,bodyKey:"entrance_guide_report_req"},MC_ENTRANCE_GUIDE_REPORT_RES:{cmd:1358,bodyKey:"entrance_guide_report_res"},MC_GET_ARENA_MATCH_ID_REQ:{cmd:1380,bodyKey:"get_arena_match_id_req"},MC_GET_ARENA_MATCH_ID_RES:{cmd:1381,bodyKey:"get_arena_match_id_res"},MC_ARENA_MATCH_SHARE_REQ:{cmd:1382,bodyKey:"arena_match_share_req"},MC_ARENA_MATCH_SHARE_RES:{cmd:1383,bodyKey:"arena_match_share_res"},MC_ARENA_MATCH_START_REQ:{cmd:1384,bodyKey:"arena_match_start_req"},MC_ARENA_MATCH_START_RES:{cmd:1385,bodyKey:"arena_match_start_res"},MC_ARENA_MATCH_REPORT_REQ:{cmd:1386,bodyKey:"arena_match_report_req"},MC_ARENA_MATCH_REPORT_RES:{cmd:1387,bodyKey:"arena_match_report_res"},MC_GET_ARENA_MATCH_RANK_REQ:{cmd:1388,bodyKey:"get_arena_match_rank_req"},MC_GET_ARENA_MATCH_RANK_RES:{cmd:1389,bodyKey:"get_arena_match_rank_res"}}},function(l,e,t){"use strict";var _=t(64),n=(t(66),t(72)),i={inited:!1,init:function(n){var e=this;e.inited=!0,n&&n()},recharge:function(i){var e=this;return n.onLine?(i.count=i.count.toString(),void(this.inited?this._recharge(i):this.init(function(){e._recharge(i)}))):_.showNetworkTip(function(){e.recharge(i)})},_recharge:function(i){var e=_.getClient();console.log("\u73AF\u5883",_.isUnProductEnv());var t=i.count,a={mode:"game",env:_.isUnProductEnv()?1:0,offerId:e.isIOS?"1450013469":"1450013468",platform:e.isIOS?"iap":"android",buyQuantity:+t,zoneId:1,success:function(){i.onSuccess&&i.onSuccess()},fail:function(e){console.log("\u652F\u4ED8\u5931\u8D25:",e.errMsg,e.errCode),i.onClose&&i.onClose()}};console.log("\u652F\u4ED8\u53C2\u6570",JSON.stringify(a)),wx.requestMidasPayment(a)}};window.Midas=i,l.exports=i},function(m,e,t){"use strict";var E,i=t(70),n=t(73),y=t(63),r=(window.protobufjs,null),l=null,s=null,_=null;wx.onSocketOpen(function(t){console.log("wx.onSocketOpen called",t),r&&r(t)}),wx.onSocketMessage(function(t){l&&l(t)}),wx.onSocketClose(function(t){console.error("wx.onSocketClose called",t),s&&s(t)}),wx.onSocketError(function(t){console.error("wx.onSocketError called",t),_&&_(t)});var a=function(){r=null,l=null,s=null,_=null},o={ORIGIN:"origin",INITIALED:"initialed",AUTHORIZING:"authorizing",SOCKET_CONNECTING:"socket_connecting",SOCKET_CONNECTED:"socket_connected",SOCKET_CONNECT_FAILED:"socket_connect_failed",SERVER_LOGINING:"server_logining",READY:"ready"},d=function(i){for(var e in o.ORIGIN,i=i||{},this.options={host:"",pb:!0,reconnectFun:null,onResponse:function(){}},i)this.options[e]=i[e];this.options.pb&&(E=n.Msg),this.socket=null};d.onLine=!0,d.needOpenidWhenLogin=!1,d.prototype={open:function(i,p,t){var u=this;this.socket&&this.close(),this.connecting=!0,this.connected=!1,r=function(e){console.log("socket onOpen",e),u.connecting=!1,u.connected=!0,i&&i()},l=function(i){console.log("socket onSocketMessage");var e={};try{e="string"==typeof i.data?JSON.parse(i.data):u.options.pb?E.decode(i.data):i.data}catch(n){var t="onmessage\u5F02\u5E38("+n.name+": "+n.message+")";console.log(t),window.BJ_REPORT&&BJ_REPORT.report&&BJ_REPORT.report(t)}u.options.onResponse(e)},_=function(t){console.log("socket oneSocketError",t),t=t||{},u.connecting=!1,u.connected=!1,d.needOpenidWhenLogin=!1,p&&p(),a()},s=function(n){console.log("socket onSocketClose",n),n=n||{},u.connecting=!1,u.connected=!1,d.needOpenidWhenLogin=!1,wx.closeSocket(),t&&t(),a()};var e=wx.getSystemInfoSync(),n=e&&e.system&&0<=e.system.toLowerCase().indexOf("ios")?102:101,o=y.host[window.serverEnv]+"?account_value=&account_type=4098&token=&appid=wxb71036a9cc71fba9&client_type="+n;console.log("start connect :"+o),wx.connectSocket({url:o,method:"GET",success:function(t){console.log("WebSocket\u521B\u5EFA\u6210\u529F",t)},fail:function(t){console.log(t),console.log("WebSocket\u521B\u5EFA\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\uFF01"),u.connecting=!1},complete:function(){console.log("WebSocket\u521B\u5EFA\u8FC7\u7A0B\u6267\u884C\u5B8C\u6BD5\uFF01")}})},send:function(o){var e=this;if(e.connecting)return void console.log("socket is now connecting,cmd "+o.head.cmd+" returned");if(e.connected){o.head.cmd!=i.MC_LOGIN_REQ.cmd||d.needOpenidWhenLogin?o.head.openid||(o.head.openid=""):o.head.openid="",o.head.cmd==i.MC_STAGE_REPORT_REQ.cmd;try{if(this.options.pb){o=JSON.parse(JSON.stringify(o));var t=new E(o),n=t.toArrayBuffer();wx.sendSocketMessage({data:n})}else{var n=JSON.stringify(o);wx.sendSocketMessage({data:n})}}catch(t){t=t||{};var l="send\u5F02\u5E38("+t.name+": "+t.message+")";console.log(l)}}else this.options.reconnectFun&&this.options.reconnectFun(o)},close:function(){}},function(){void 0!=navigator.onLine&&(d.onLine=navigator.onLine),window.addEventListener("offline",function(){d.onLine=!1}),window.addEventListener("online",function(){d.onLine=!0})}(),window.Network=d,m.exports=d},function(i,e,t){"use strict";i.exports=t(10).newBuilder({}).import({package:null,messages:[{name:"Common",fields:[],messages:[{name:"StageID",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"optional",type:"int32",name:"sub_id",id:2}]},{name:"StartInfo",fields:[{rule:"optional",type:"StageID",name:"stage_id",id:1},{rule:"optional",type:"uint64",name:"random_seed",id:2},{rule:"repeated",type:"int32",name:"item_id_list",id:3}]},{name:"StageInfo",fields:[{rule:"optional",type:"int32",name:"stage_id",id:1},{rule:"optional",type:"int32",name:"score",id:2},{rule:"optional",type:"int32",name:"star_level",id:3}]},{name:"Position",fields:[{rule:"optional",type:"int32",name:"row",id:1},{rule:"optional",type:"int32",name:"col",id:2}]},{name:"Input",fields:[{rule:"optional",type:"int32",name:"op",id:1},{rule:"optional",type:"Position",name:"from",id:2},{rule:"optional",type:"Position",name:"to",id:3},{rule:"optional",type:"int32",name:"item_id",id:4},{rule:"optional",type:"int32",name:"value1",id:5},{rule:"optional",type:"int32",name:"value2",id:6}]},{name:"ChessCountItem",fields:[{rule:"optional",type:"int32",name:"type",id:1},{rule:"optional",type:"int32",name:"count",id:2}]},{name:"ColorCountItem",fields:[{rule:"optional",type:"int32",name:"color",id:1},{rule:"optional",type:"int32",name:"count",id:2}]},{name:"AttackCountItem",fields:[{rule:"optional",type:"int32",name:"attack",id:1},{rule:"optional",type:"int32",name:"count",id:2}]},{name:"GameInfo",fields:[{rule:"repeated",type:"ChessCountItem",name:"crush_chess_count",id:1},{rule:"repeated",type:"ColorCountItem",name:"crush_color_count",id:2},{rule:"repeated",type:"ChessCountItem",name:"add_chess_count",id:3},{rule:"repeated",type:"ColorCountItem",name:"add_color_count",id:4},{rule:"repeated",type:"AttackCountItem",name:"attack_count",id:5},{rule:"repeated",type:"int32",name:"drop_round_count",id:6},{rule:"repeated",type:"int32",name:"used_item",id:7},{rule:"optional",type:"int32",name:"slide_count",id:8},{rule:"optional",type:"int32",name:"score",id:9},{rule:"optional",type:"int32",name:"star_level",id:10}]},{name:"StageStatics",fields:[{rule:"optional",type:"int32",name:"max_stage_id",id:1},{rule:"optional",type:"int32",name:"star_count",id:2},{rule:"optional",type:"uint64",name:"max_stage_timestamp",id:3},{rule:"optional",type:"int32",name:"max_stage_score",id:4}]},{name:"Notice",fields:[{rule:"optional",type:"int32",name:"content_type",id:1},{rule:"optional",type:"string",name:"title",id:2},{rule:"optional",type:"string",name:"content",id:3},{rule:"optional",type:"string",name:"url",id:4}]},{name:"JumpOneStageInfo",fields:[{rule:"optional",type:"int32",name:"stage_id",id:1},{rule:"optional",type:"int32",name:"detain_star",id:2},{rule:"optional",type:"uint64",name:"update_time",id:3}]},{name:"Heart",fields:[{rule:"optional",type:"int32",name:"count",id:1},{rule:"optional",type:"uint64",name:"last_update_time",id:2},{rule:"optional",type:"int32",name:"pool_count",id:3},{rule:"optional",type:"uint64",name:"pool_update_time",id:4},{rule:"optional",type:"int32",name:"is_heart_frozen",id:5},{rule:"optional",type:"uint64",name:"frozen_expire_time",id:6}]},{name:"Diamond",fields:[{rule:"repeated",type:"int32",name:"count",id:1}]},{name:"Money",fields:[{rule:"optional",type:"int32",name:"count",id:1}]},{name:"Item",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"optional",type:"int32",name:"count",id:2}]},{name:"ItemList",fields:[{rule:"repeated",type:"Item",name:"item",id:1}]},{name:"AttrValue",fields:[{rule:"optional",type:"Heart",name:"heart",id:1},{rule:"optional",type:"Diamond",name:"diamond",id:2},{rule:"optional",type:"Money",name:"money",id:3},{rule:"optional",type:"ItemList",name:"item_list",id:4}]},{name:"Attr",fields:[{rule:"optional",type:"int32",name:"type",id:1},{rule:"optional",type:"AttrValue",name:"value",id:2}]},{name:"RankData",fields:[{rule:"optional",type:"int32",name:"period_id",id:1},{rule:"optional",type:"int32",name:"first_rank_cond",id:2},{rule:"optional",type:"int32",name:"second_rank_cond",id:3},{rule:"optional",type:"uint64",name:"update_timestamp",id:4}]},{name:"MailAttach",fields:[{rule:"optional",type:"int32",name:"article_type",id:1},{rule:"optional",type:"int32",name:"article_subtype",id:2},{rule:"optional",type:"int32",name:"article_id",id:3},{rule:"optional",type:"int32",name:"article_count",id:4}]},{name:"MailDetail",fields:[{rule:"optional",type:"int32",name:"mail_index",id:1},{rule:"optional",type:"MailType",name:"type",id:2,options:{default:"MAIL_TYPE_NULL"}},{rule:"optional",type:"MailSubType",name:"sub_type",id:3,options:{default:"MAIL_SUB_TYPE_NULL"}},{rule:"optional",type:"string",name:"subject",id:4},{rule:"optional",type:"string",name:"content",id:5},{rule:"optional",type:"string",name:"from",id:6},{rule:"optional",type:"string",name:"from_nick",id:7},{rule:"optional",type:"string",name:"from_pic",id:8},{rule:"optional",type:"uint64",name:"send_timestamp",id:9},{rule:"optional",type:"uint64",name:"expire_timestamp",id:10},{rule:"repeated",type:"MailAttach",name:"attach_list",id:11}]}],enums:[{name:"InputOp",values:[{name:"kOpSlide",id:0},{name:"kOpUseItem",id:1},{name:"kOpRespawn",id:2}]},{name:"PassConditionType",values:[{name:"kPassCondCollectChess",id:1},{name:"kPassCondScore",id:2},{name:"kPassCondBoss",id:3},{name:"kPassCondWeekGame1",id:4},{name:"kPassCondWeekGame2",id:5},{name:"kPassCondWeekGame3",id:6},{name:"kPassCondAllStep",id:7},{name:"kPassCondCollectColor",id:8},{name:"kPassCondLimitedStep",id:9},{name:"kPassCondDeadGame",id:11},{name:"kPassCondTickBomb",id:12}]},{name:"OSPlatfrom",values:[{name:"OS_PLAT_ID_ALL",id:-1},{name:"OS_PLAT_ID_IOS",id:0},{name:"OS_PLAT_ID_ANDROID",id:1},{name:"OS_PLAT_ID_PC",id:2},{name:"OS_PLAT_ID_COUNT",id:3}]},{name:"Gender",values:[{name:"GENDER_NULL",id:0},{name:"GENDER_MALE",id:1},{name:"GENDER_FEMALE",id:2}]},{name:"AccountType",values:[{name:"ACCOUNT_TYPE_QQ",id:1},{name:"ACCOUNT_TYPE_WX",id:2},{name:"ACCOUNT_TYPE_GUEST",id:3}]},{name:"NoticeType",values:[{name:"LOGIN_NOTICE",id:1}]},{name:"NoticeContentType",values:[{name:"TEXT_TYPE",id:1},{name:"FIGURE_TYPE",id:2}]},{name:"MaxRankCount",values:[{name:"MAX_ARENA_RANK_COUNT",id:500}]},{name:"AttrType",values:[{name:"AT_NULL",id:0},{name:"AT_HEART",id:1},{name:"AT_DIAMOND",id:2},{name:"AT_MONEY",id:3},{name:"AT_ITEM",id:4},{name:"AT_COUNT",id:5}]},{name:"ReasonType",values:[{name:"REASON_NULL",id:0},{name:"REASON_BUY_GOODS",id:1},{name:"REASON_GET_MAIL_ATTACH",id:2},{name:"REASON_NEW_GUIDE",id:3},{name:"REASON_STAGE_START",id:4},{name:"REASON_STAGE_INNER",id:5},{name:"REASON_STAGE_REPORT",id:6},{name:"REASON_UNLOCK_STAGE",id:7},{name:"REASON_LOGIN_DAILY",id:8},{name:"REASON_GM",id:9},{name:"REASON_STAGE_REPORT_FIRST",id:10},{name:"REASON_WEEKMATCH_RANK",id:11},{name:"REASON_DAILY_SIGN",id:12},{name:"REASON_MAP_STAR_REWARD",id:13},{name:"REASON_ITEM_USE",id:14},{name:"REASON_MONTH_SIGN",id:15},{name:"REASON_SHARE",id:16},{name:"REASON_REDRAW_RANDOM_ITEM",id:17},{name:"REASON_DRAW_RANDOM_ITEM",id:18},{name:"REASON_FLAUNT",id:19},{name:"REASON_TAKE_NEW_USER_AWARD",id:20},{name:"REASON_WEEK_QUEST",id:21},{name:"REASON_ACT_QUEST",id:22},{name:"REASON_WEEKMATCH_GET",id:23},{name:"REASON_COLLECT_STAR_QUEST",id:24},{name:"REASON_NEWBIES_QUEST",id:25},{name:"REASON_COMMON_QUEST",id:26},{name:"REASON_EVERYDAT_ACTIVITY_QUEST",id:27},{name:"REASON_ONEYUAN_BUY",id:28},{name:"REASON_WEEK_MATCH_START",id:29},{name:"REASON_WEEK_MATCH_SHARE",id:30},{name:"REASON_WEEK_MATCH_FIVE_NORMSTAGE",id:31},{name:"REASON_ENTRANCE_GUIDE",id:32}]},{name:"RankType",values:[{name:"RANK_TYPE_NULL",id:0},{name:"RANK_TYPE_MAX_STAGE",id:1},{name:"RANK_TYPE_WEEKMATCH_MASTER_MERGER",id:2},{name:"RANK_TYPE_WEEKMATCH_SIX_CORNER_ELIM",id:3},{name:"RANK_TYPE_COUNT",id:4}]},{name:"MaxMailCount",values:[{name:"MAX_SYSTEM_MAIL_COUNT",id:100},{name:"MAX_FRIEND_MAIL_COUNT",id:50}]},{name:"MailType",values:[{name:"MAIL_TYPE_NULL",id:0},{name:"MAIL_TYPE_FRIEND",id:1},{name:"MAIL_TYPE_SYSTEM",id:2},{name:"MAIL_TYPE_ALL",id:3},{name:"MAIL_TYPE_COUNT",id:4}]},{name:"MailSubType",values:[{name:"MAIL_SUB_TYPE_NULL",id:0},{name:"MAIL_SUB_TYPE_HEART_SEND",id:101},{name:"MAIL_SUB_TYPE_NOTIFY",id:201},{name:"MAIL_SUB_TYPE_REWARD",id:202}]}]},{name:"CSProto",fields:[],messages:[{name:"StageInfoReq",fields:[{rule:"optional",type:"int32",name:"map_id",id:1}]},{name:"StageInfoList",fields:[{rule:"optional",type:"int32",name:"map_id",id:1},{rule:"repeated",type:"Common.StageInfo",name:"stage_info_arry",id:2},{rule:"optional",type:"int32",name:"star_reward_num",id:3}]},{name:"StageNtf",fields:[{rule:"repeated",type:"StageInfoList",name:"info_list",id:1}]},{name:"StageInfoRes",fields:[{rule:"optional",type:"int32",name:"map_id",id:1}]},{name:"CostItem",fields:[{rule:"optional",type:"uint32",name:"item_id",id:1},{rule:"optional",type:"int32",name:"conf_id",id:2},{rule:"optional",type:"int32",name:"conf_pkg_id",id:3}]},{name:"StageStartReq",fields:[{rule:"optional",type:"int32",name:"stage_id",id:1},{rule:"optional",type:"uint64",name:"start_time",id:2},{rule:"repeated",type:"int32",name:"item_id_list",id:3},{rule:"repeated",type:"CostItem",name:"cost_item_list",id:4}]},{name:"StageStartRes",fields:[{rule:"optional",type:"int32",name:"stage_id",id:1},{rule:"optional",type:"int32",name:"random_seed",id:2}]},{name:"StageUseItemReq",fields:[{rule:"optional",type:"int32",name:"stage_id",id:1},{rule:"optional",type:"int32",name:"item_id",id:2}]},{name:"StageUseItemRes",fields:[{rule:"optional",type:"int32",name:"stage_id",id:1},{rule:"optional",type:"int32",name:"item_id",id:2}]},{name:"StageReportReq",fields:[{rule:"optional",type:"Common.StartInfo",name:"start_info",id:1},{rule:"repeated",type:"Common.Input",name:"input",id:2},{rule:"optional",type:"int32",name:"game_result",id:3},{rule:"optional",type:"Common.GameInfo",name:"game_info",id:4},{rule:"optional",type:"int32",name:"fail_reason",id:5}]},{name:"StageReportRes",fields:[{rule:"optional",type:"int32",name:"game_result",id:1},{rule:"optional",type:"Common.StageInfo",name:"stage_info",id:2},{rule:"optional",type:"int32",name:"reward_money",id:3}]},{name:"GetStarRewardReq",fields:[{rule:"optional",type:"uint32",name:"map_id",id:1}]},{name:"GetStarRewardRes",fields:[{rule:"optional",type:"int32",name:"star_reward_num",id:1}]},{name:"StageJumpReq",fields:[{rule:"optional",type:"int32",name:"stage_id",id:1}]},{name:"StageJumpRes",fields:[{rule:"optional",type:"int32",name:"stage_id",id:1}]},{name:"StageJumpInfoNtf",fields:[{rule:"repeated",type:"Common.JumpOneStageInfo",name:"jump_stage_list",id:1},{rule:"optional",type:"int32",name:"cur_can_jump_stage",id:2},{rule:"optional",type:"int32",name:"cur_jump_stage_cost_star",id:3}]},{name:"LogoutNtf",fields:[{rule:"optional",type:"int32",name:"reason",id:1}]},{name:"AuthToken",fields:[{rule:"optional",type:"string",name:"buff",id:1},{rule:"optional",type:"uint64",name:"expire_time",id:2}]},{name:"LoginReq",fields:[{rule:"optional",type:"string",name:"from_openid",id:1},{rule:"optional",type:"string",name:"code",id:2},{rule:"optional",type:"string",name:"nick",id:3},{rule:"optional",type:"string",name:"pic",id:4}]},{name:"NewUserAwardInfo",fields:[{rule:"optional",type:"uint64",name:"activity_end_time",id:1},{rule:"optional",type:"uint64",name:"last_take_time",id:2},{rule:"optional",type:"int32",name:"already_take_days",id:3},{rule:"optional",type:"string",name:"openid",id:4}]},{name:"LoginRes",fields:[{rule:"optional",type:"uint64",name:"now_unix_timestamp",id:2},{rule:"optional",type:"uint64",name:"last_sign_time",id:3},{rule:"optional",type:"int32",name:"month_sign_days",id:4},{rule:"optional",type:"uint64",name:"last_flaunt_time",id:5},{rule:"optional",type:"NewUserAwardInfo",name:"new_user_award_info",id:6},{rule:"optional",type:"uint64",name:"oneyuan_buy_time",id:7},{rule:"optional",type:"uint64",name:"entrance_guide_time",id:8},{rule:"optional",type:"string",name:"openid",id:9}]},{name:"AttrNtf",fields:[{rule:"repeated",type:"Common.Attr",name:"attr",id:1},{rule:"optional",type:"uint64",name:"now_unix_timestamp",id:2}]},{name:"StaticsNtf",fields:[{rule:"optional",type:"Common.StageStatics",name:"stage_statics",id:1}]},{name:"PlayerInfoNtf",fields:[{rule:"optional",type:"int32",name:"recv_heart_state",id:1}]},{name:"RandomItemInfoNtf",fields:[{rule:"optional",type:"int32",name:"random_item_id",id:1}]},{name:"BuyGoodsReq",fields:[{rule:"optional",type:"PkgRes.ArticleType",name:"type",id:1,options:{default:"ARTICLE_TYPE_NULL"}},{rule:"optional",type:"uint32",name:"subtype",id:2},{rule:"optional",type:"uint32",name:"id",id:3},{rule:"optional",type:"int32",name:"count",id:4},{rule:"optional",type:"int32",name:"conf_id",id:5},{rule:"optional",type:"int32",name:"conf_pkg_id",id:6}]},{name:"BuyGoodsRes",fields:[{rule:"optional",type:"PkgRes.ArticleType",name:"type",id:1,options:{default:"ARTICLE_TYPE_NULL"}},{rule:"optional",type:"uint32",name:"subtype",id:2},{rule:"optional",type:"uint32",name:"id",id:3},{rule:"optional",type:"int32",name:"count",id:4}]},{name:"BuyDiamondReportReq",fields:[{rule:"optional",type:"int32",name:"buy_diamond_num",id:1},{rule:"optional",type:"int32",name:"cost_rmb_num",id:2}]},{name:"BuyDiamondReportRes",fields:[{rule:"optional",type:"int32",name:"total_diamond",id:1}]},{name:"RewardInfo",fields:[{rule:"optional",type:"int32",name:"article_type",id:1},{rule:"optional",type:"int32",name:"article_subtype",id:2},{rule:"optional",type:"int32",name:"article_id",id:3},{rule:"optional",type:"int32",name:"article_count",id:4},{rule:"optional",type:"int64",name:"article_ext1",id:5},{rule:"optional",type:"int64",name:"article_ext2",id:6}]},{name:"RewardPoolApd",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"optional",type:"int32",name:"src",id:2},{rule:"repeated",type:"RewardInfo",name:"reward_list",id:7}]},{name:"GetMailListReq",fields:[{rule:"optional",type:"Common.MailType",name:"type",id:1,options:{default:"MAIL_TYPE_NULL"}}]},{name:"MailListNtf",fields:[{rule:"optional",type:"Common.MailType",name:"type",id:1,options:{default:"MAIL_TYPE_NULL"}},{rule:"repeated",type:"Common.MailDetail",name:"mail_list",id:2}]},{name:"GetMailListRes",fields:[{rule:"optional",type:"Common.MailType",name:"type",id:1,options:{default:"MAIL_TYPE_NULL"}}]},{name:"UpdateMailReq",fields:[{rule:"optional",type:"Common.MailType",name:"type",id:1,options:{default:"MAIL_TYPE_NULL"}},{rule:"optional",type:"int32",name:"mail_index",id:2}]},{name:"UpdateMailRes",fields:[{rule:"optional",type:"Common.MailType",name:"type",id:1,options:{default:"MAIL_TYPE_NULL"}},{rule:"optional",type:"int32",name:"mail_index",id:2},{rule:"repeated",type:"Common.MailAttach",name:"attach_list",id:3}]},{name:"UpdateMailBatchReq",fields:[{rule:"optional",type:"Common.MailType",name:"type",id:1,options:{default:"MAIL_TYPE_NULL"}}]},{name:"UpdateMailBatchRes",fields:[{rule:"optional",type:"Common.MailType",name:"type",id:1,options:{default:"MAIL_TYPE_NULL"}},{rule:"repeated",type:"int32",name:"mail_index_list",id:2},{rule:"repeated",type:"Common.MailAttach",name:"attach_list",id:3}]},{name:"HeartbeatReq",fields:[{rule:"optional",type:"uint64",name:"client_timestamp",id:1}]},{name:"HeartbeatRes",fields:[{rule:"optional",type:"uint64",name:"client_timestamp",id:1},{rule:"optional",type:"uint64",name:"server_timestamp",id:2}]},{name:"RefreshAccessTokenReq",fields:[{rule:"optional",type:"AuthToken",name:"atk",id:1}]},{name:"RefreshAccessTokenRes",fields:[{rule:"optional",type:"AuthToken",name:"atk",id:1}]},{name:"ProfileSettingReq",fields:[{rule:"optional",type:"int32",name:"recv_heart_state",id:1}]},{name:"ProfileSettingRes",fields:[{rule:"optional",type:"int32",name:"recv_heart_state",id:1}]},{name:"SendHeartNtfReq",fields:[{rule:"optional",type:"string",name:"friend_openid",id:1}]},{name:"SendHeartNtfRes",fields:[{rule:"optional",type:"string",name:"friend_openid",id:1}]},{name:"GetNoticeReq",fields:[{rule:"optional",type:"int32",name:"notice_type",id:1}]},{name:"GetNoticeRes",fields:[{rule:"optional",type:"int32",name:"notice_type",id:1},{rule:"repeated",type:"Common.Notice",name:"notice_list",id:2}]},{name:"SignReq",fields:[{rule:"optional",type:"int32",name:"month_sign_days",id:1}]},{name:"SignRes",fields:[{rule:"optional",type:"uint64",name:"last_sign_time",id:1},{rule:"optional",type:"int32",name:"month_sign_days",id:2}]},{name:"TakeNewUserAwardReq",fields:[{rule:"optional",type:"int32",name:"already_take_days",id:1}]},{name:"TakeNewUserAwardRes",fields:[{rule:"optional",type:"uint64",name:"last_take_time",id:1},{rule:"optional",type:"int32",name:"already_take_days",id:2}]},{name:"ShareInfoNtf",fields:[{rule:"optional",type:"int32",name:"available_award_num",id:1},{rule:"optional",type:"int32",name:"today_take_award_num",id:2},{rule:"optional",type:"int32",name:"is_first_share",id:3}]},{name:"ShareReq",fields:[]},{name:"ShareRes",fields:[]},{name:"TakeShareAwardReq",fields:[{rule:"optional",type:"int32",name:"award_num",id:1}]},{name:"TakeShareAwardRes",fields:[{rule:"optional",type:"int32",name:"today_take_award_num",id:1}]},{name:"FlauntReq",fields:[{rule:"optional",type:"int32",name:"reward_pool_id",id:1}]},{name:"FlauntRes",fields:[{rule:"optional",type:"uint64",name:"last_flaunt_time",id:1}]},{name:"OneYuanBuyReportReq",fields:[]},{name:"OneYuanBuyReportRes",fields:[]},{name:"EntranceGuideReportReq",fields:[]},{name:"EntranceGuideReportRes",fields:[]},{name:"PlayerBaseInfo",fields:[{rule:"optional",type:"string",name:"openid",id:1},{rule:"optional",type:"string",name:"pic",id:2},{rule:"optional",type:"string",name:"nick",id:3}]},{name:"WxWaterMark",fields:[{rule:"optional",type:"uint32",name:"timestamp",id:1},{rule:"optional",type:"string",name:"appid",id:2}]},{name:"WxGroupData",fields:[{rule:"optional",type:"string",name:"openGId",id:1},{rule:"optional",type:"string",name:"roomTopic",id:2},{rule:"repeated",type:"string",name:"openidList",id:3},{rule:"optional",type:"WxWaterMark",name:"watermark",id:4}]},{name:"GetPlayerBaseInfoReq",fields:[{rule:"repeated",type:"string",name:"openid_list",id:1}]},{name:"GetPlayerBaseInfoNtf",fields:[{rule:"repeated",type:"PlayerBaseInfo",name:"baseinfo_list",id:1}]},{name:"GetPlayerBaseInfoRes",fields:[{rule:"repeated",type:"string",name:"openid_list",id:1}]},{name:"GetMapFriendReq",fields:[{rule:"optional",type:"int32",name:"map_id",id:1}]},{name:"MapFriendInfo",fields:[{rule:"optional",type:"string",name:"openid",id:1},{rule:"optional",type:"int32",name:"stage_id",id:2},{rule:"optional",type:"int32",name:"star_count",id:3},{rule:"optional",type:"int32",name:"recv_heart_state",id:4},{rule:"optional",type:"int32",name:"is_in_cd",id:5},{rule:"optional",type:"uint64",name:"last_send_heart_time",id:6}]},{name:"GetMapFriendNtf",fields:[{rule:"optional",type:"int32",name:"map_id",id:1},{rule:"repeated",type:"MapFriendInfo",name:"friend_list",id:2}]},{name:"GetMapFriendRes",fields:[{rule:"optional",type:"int32",name:"map_id",id:1}]},{name:"GetRankReq",fields:[{rule:"optional",type:"int32",name:"rank_type",id:1},{rule:"optional",type:"int32",name:"page_id",id:2},{rule:"optional",type:"int32",name:"page_size",id:3}]},{name:"WeekMatchFriendInfo",fields:[{rule:"optional",type:"string",name:"openid",id:1},{rule:"optional",type:"int32",name:"week_score",id:2}]},{name:"GetRankRes",fields:[{rule:"optional",type:"int32",name:"page_id",id:1},{rule:"repeated",type:"MapFriendInfo",name:"friend_list",id:2},{rule:"optional",type:"uint64",name:"update_timestamp",id:3},{rule:"optional",type:"int32",name:"total_page",id:4},{rule:"repeated",type:"WeekMatchFriendInfo",name:"week_match_friend_list",id:5}]},{name:"SendHeartReq",fields:[{rule:"optional",type:"string",name:"friend_openid",id:1}]},{name:"SendHeartRes",fields:[{rule:"optional",type:"string",name:"friend_openid",id:1}]},{name:"RankRewardNtf",fields:[{rule:"optional",type:"int32",name:"rank_type",id:1},{rule:"optional",type:"int32",name:"self_rank",id:2},{rule:"optional",type:"int32",name:"total_rank",id:3},{rule:"optional",type:"int32",name:"first_rank_cond",id:4}]},{name:"GetGroupRankReq",fields:[{rule:"optional",type:"string",name:"encrypted_data",id:1},{rule:"optional",type:"string",name:"iv",id:2}]},{name:"GetGroupRankRes",fields:[{rule:"repeated",type:"MapFriendInfo",name:"friend_list",id:1}]},{name:"CmdParam",fields:[{rule:"optional",type:"int32",name:"param",id:1},{rule:"optional",type:"string",name:"param_desc",id:2}]},{name:"CmdId",fields:[{rule:"optional",type:"int32",name:"id",id:1},{rule:"optional",type:"string",name:"name",id:2}]},{name:"GMCmdInfo",fields:[{rule:"optional",type:"CmdId",name:"cmd_id",id:1},{rule:"repeated",type:"CmdParam",name:"cmd_param",id:2}]},{name:"GMCmdInfoReq",fields:[{rule:"optional",type:"int32",name:"placeholder",id:1}]},{name:"GMCmdInfoRes",fields:[{rule:"repeated",type:"GMCmdInfo",name:"cmd_info_list",id:1}]},{name:"GMSetReq",fields:[{rule:"optional",type:"int32",name:"cmd_id",id:1},{rule:"repeated",type:"int32",name:"param",id:2}]},{name:"GMSetRes",fields:[{rule:"optional",type:"int32",name:"cmd_id",id:1}]},{name:"QuestInfo",fields:[{rule:"optional",type:"PkgRes.QuestSource",name:"quest_source",id:1,options:{default:"QUEST_SOURCE_NULL"}},{rule:"optional",type:"int32",name:"element_id",id:2},{rule:"optional",type:"int32",name:"process",id:3},{rule:"optional",type:"QuestState",name:"state",id:4},{rule:"optional",type:"uint64",name:"update_time",id:5}]},{name:"QuestInfoNtf",fields:[{rule:"repeated",type:"QuestInfo",name:"quest_info_list",id:1}]},{name:"QuestConfNtf",fields:[{rule:"optional",type:"PkgRes.QuestSource",name:"quest_source",id:1,options:{default:"QUEST_SOURCE_NULL"}},{rule:"repeated",type:"PkgRes.QuestConf",name:"quest_conf",id:2},{rule:"repeated",type:"PkgRes.QuestElementConf",name:"element_conf",id:3},{rule:"repeated",type:"PkgRes.RewardPool",name:"reward_conf",id:4}]},{name:"QuestRewardReq",fields:[{rule:"optional",type:"PkgRes.QuestSource",name:"quest_source",id:1,options:{default:"QUEST_SOURCE_NULL"}},{rule:"optional",type:"int32",name:"element_id",id:2}]},{name:"QuestRewardRes",fields:[{rule:"optional",type:"PkgRes.QuestSource",name:"quest_source",id:1,options:{default:"QUEST_SOURCE_NULL"}},{rule:"optional",type:"int32",name:"element_id",id:2}]},{name:"ActInfo",fields:[{rule:"optional",type:"int32",name:"act_id",id:1},{rule:"optional",type:"int32",name:"sort_index",id:2},{rule:"optional",type:"PkgRes.ActContentType",name:"content_type",id:3,options:{default:"ACTIVITY_CONTENT_TYPE_PICTURE"}},{rule:"optional",type:"string",name:"act_icon",id:4},{rule:"optional",type:"string",name:"act_name",id:5},{rule:"optional",type:"string",name:"act_content",id:6},{rule:"optional",type:"int64",name:"start_time",id:7},{rule:"optional",type:"int64",name:"end_time",id:8},{rule:"optional",type:"int32",name:"jump_type",id:9},{rule:"optional",type:"string",name:"jump_data",id:10},{rule:"optional",type:"int32",name:"quest_id",id:11},{rule:"optional",type:"int32",name:"redpoint_id",id:12}]},{name:"GetActivityInfoReq",fields:[{rule:"repeated",type:"int32",name:"act_id_list",id:1}]},{name:"ActivityInfoNtf",fields:[{rule:"repeated",type:"ActInfo",name:"act_info_list",id:1}]},{name:"GetActivityInfoRes",fields:[{rule:"repeated",type:"int32",name:"act_id_list",id:1}]},{name:"WeekMatchStartReq",fields:[{rule:"optional",type:"int32",name:"match_id",id:1}]},{name:"WeekMatchStartRes",fields:[{rule:"optional",type:"int32",name:"match_id",id:1}]},{name:"WeekMatchReportReq",fields:[{rule:"optional",type:"int32",name:"week_score",id:1},{rule:"optional",type:"int32",name:"match_id",id:2}]},{name:"WeekMatchReportRes",fields:[{rule:"optional",type:"int32",name:"week_score",id:1}]},{name:"WeekMatchShareReq",fields:[{rule:"optional",type:"int32",name:"match_id",id:1}]},{name:"WeekMatchShareRes",fields:[]},{name:"WeekMatchItem",fields:[{rule:"optional",type:"int32",name:"match_id",id:1},{rule:"optional",type:"uint64",name:"start_time",id:2},{rule:"optional",type:"uint64",name:"end_time",id:3},{rule:"optional",type:"int32",name:"last_play_time",id:4},{rule:"optional",type:"uint64",name:"last_share_time",id:5},{rule:"optional",type:"int32",name:"send_ticket_normstage_num",id:6},{rule:"optional",type:"int32",name:"ticket_id",id:7}]},{name:"WeekMatchInfoNtf",fields:[{rule:"repeated",type:"WeekMatchItem",name:"week_match_list",id:1},{rule:"optional",type:"uint64",name:"rank_end_time",id:2},{rule:"optional",type:"int32",name:"normstage_play_num",id:3}]},{name:"GetArenaMatchIdReq",fields:[]},{name:"GetArenaMatchIdRes",fields:[{rule:"optional",type:"uint64",name:"arena_match_id",id:1},{rule:"optional",type:"int32",name:"stage_id",id:2},{rule:"optional",type:"string",name:"stage_bin_path",id:3},{rule:"optional",type:"uint32",name:"created_time",id:4}]},{name:"ArenaMatchShareReq",fields:[{rule:"optional",type:"uint64",name:"arena_match_id",id:1},{rule:"optional",type:"string",name:"group_msg_ticket",id:2},{rule:"optional",type:"int32",name:"expire_time",id:3},{rule:"optional",type:"string",name:"encrypted_data",id:4},{rule:"optional",type:"string",name:"iv",id:5}]},{name:"ArenaMatchShareRes",fields:[]},{name:"ArenaMatchStartReq",fields:[{rule:"optional",type:"uint64",name:"arena_match_id",id:1},{rule:"optional",type:"int32",name:"stage_id",id:2}]},{name:"ArenaMatchStartRes",fields:[{rule:"optional",type:"int32",name:"random_seed",id:1}]},{name:"ArenaMatchReportReq",fields:[{rule:"optional",type:"Common.StartInfo",name:"start_info",id:1},{rule:"repeated",type:"Common.Input",name:"input",id:2},{rule:"optional",type:"int32",name:"game_result",id:3},{rule:"optional",type:"Common.GameInfo",name:"game_info",id:4},{rule:"optional",type:"int32",name:"fail_reason",id:5},{rule:"optional",type:"uint64",name:"arena_match_id",id:6}]},{name:"ArenaMatchReportRes",fields:[{rule:"optional",type:"int32",name:"game_result",id:1},{rule:"optional",type:"Common.StageInfo",name:"stage_info",id:2},{rule:"optional",type:"int32",name:"reward_money",id:3}]},{name:"GetArenaMatchRankReq",fields:[{rule:"optional",type:"uint64",name:"arena_match_id",id:1}]},{name:"RankItem",fields:[{rule:"optional",type:"string",name:"openid",id:1},{rule:"optional",type:"int32",name:"score",id:2}]},{name:"GetArenaMatchRankRes",fields:[{rule:"repeated",type:"RankItem",name:"rank_list",id:1},{rule:"optional",type:"string",name:"owner_openid",id:2},{rule:"optional",type:"uint32",name:"created_time",id:3}]},{name:"Head",fields:[{rule:"optional",type:"int32",name:"cmd",id:1},{rule:"optional",type:"int32",name:"ret",id:2},{rule:"optional",type:"string",name:"ret_desc",id:3},{rule:"optional",type:"uint64",name:"client_version",id:4},{rule:"optional",type:"uint64",name:"seq",id:5},{rule:"optional",type:"string",name:"openid",id:6},{rule:"optional",type:"uint32",name:"logic_seq",id:7},{rule:"repeated",type:"int32",name:"append_cmd",id:8}]},{name:"Body",fields:[{rule:"optional",type:"LoginReq",name:"login_req",id:1},{rule:"optional",type:"LoginRes",name:"login_res",id:2},{rule:"optional",type:"LogoutNtf",name:"logout_ntf",id:3},{rule:"optional",type:"AttrNtf",name:"attr_ntf",id:4},{rule:"optional",type:"StageNtf",name:"stage_ntf",id:5},{rule:"optional",type:"StaticsNtf",name:"statics_ntf",id:6},{rule:"optional",type:"PlayerInfoNtf",name:"player_info_ntf",id:7},{rule:"optional",type:"RandomItemInfoNtf",name:"random_item_info_ntf",id:8},{rule:"optional",type:"StageInfoReq",name:"stage_info_req",id:10},{rule:"optional",type:"StageInfoRes",name:"stage_info_res",id:11},{rule:"optional",type:"StageStartReq",name:"stage_start_req",id:12},{rule:"optional",type:"StageStartRes",name:"stage_start_res",id:13},{rule:"optional",type:"StageUseItemReq",name:"stage_use_item_req",id:14},{rule:"optional",type:"StageUseItemRes",name:"stage_use_item_res",id:15},{rule:"optional",type:"StageReportReq",name:"stage_report_req",id:16},{rule:"optional",type:"StageReportRes",name:"stage_report_res",id:17},{rule:"optional",type:"GetStarRewardReq",name:"get_star_reward_req",id:18},{rule:"optional",type:"GetStarRewardRes",name:"get_star_reward_res",id:19},{rule:"optional",type:"StageJumpReq",name:"stage_jump_req",id:20},{rule:"optional",type:"StageJumpRes",name:"stage_jump_res",id:21},{rule:"optional",type:"StageJumpInfoNtf",name:"stage_jump_info_ntf",id:22},{rule:"repeated",type:"RewardPoolApd",name:"reward_pool_apd",id:30},{rule:"optional",type:"BuyGoodsReq",name:"buy_goods_req",id:50},{rule:"optional",type:"BuyGoodsRes",name:"buy_goods_res",id:51},{rule:"optional",type:"BuyDiamondReportReq",name:"buy_diamond_report_req",id:52},{rule:"optional",type:"BuyDiamondReportRes",name:"buy_diamond_report_res",id:53},{rule:"optional",type:"OneYuanBuyReportReq",name:"oneyuan_buy_report_req",id:54},{rule:"optional",type:"OneYuanBuyReportRes",name:"oneyuan_buy_report_res",id:55},{rule:"optional",type:"GetMailListReq",name:"get_mail_list_req",id:60},{rule:"optional",type:"GetMailListRes",name:"get_mail_list_res",id:61},{rule:"optional",type:"MailListNtf",name:"mail_list_ntf",id:62},{rule:"optional",type:"UpdateMailReq",name:"update_mail_req",id:63},{rule:"optional",type:"UpdateMailRes",name:"update_mail_res",id:64},{rule:"optional",type:"UpdateMailBatchReq",name:"update_mail_batch_req",id:65},{rule:"optional",type:"UpdateMailBatchRes",name:"update_mail_batch_res",id:66},{rule:"optional",type:"GetPlayerBaseInfoReq",name:"get_player_baseinfo_req",id:70},{rule:"optional",type:"GetPlayerBaseInfoNtf",name:"get_player_baseinfo_ntf",id:71},{rule:"optional",type:"GetPlayerBaseInfoRes",name:"get_player_baseinfo_res",id:72},{rule:"optional",type:"GetRankReq",name:"get_rank_req",id:80},{rule:"optional",type:"GetRankRes",name:"get_rank_res",id:81},{rule:"optional",type:"GetMapFriendReq",name:"get_map_friend_req",id:82},{rule:"optional",type:"GetMapFriendNtf",name:"get_map_friend_ntf",id:83},{rule:"optional",type:"GetMapFriendRes",name:"get_map_friend_res",id:84},{rule:"optional",type:"SendHeartReq",name:"send_heart_req",id:85},{rule:"optional",type:"SendHeartRes",name:"send_heart_res",id:86},{rule:"optional",type:"RankRewardNtf",name:"rank_reward_ntf",id:87},{rule:"optional",type:"GetGroupRankReq",name:"get_group_rank_req",id:88},{rule:"optional",type:"GetGroupRankRes",name:"get_group_rank_res",id:89},{rule:"optional",type:"GMCmdInfoReq",name:"gm_cmd_info_req",id:90},{rule:"optional",type:"GMCmdInfoRes",name:"gm_cmd_info_res",id:91},{rule:"optional",type:"GMSetReq",name:"gm_set_req",id:92},{rule:"optional",type:"GMSetRes",name:"gm_set_res",id:93},{rule:"optional",type:"HeartbeatReq",name:"heartbeat_req",id:100},{rule:"optional",type:"HeartbeatRes",name:"heartbeat_res",id:101},{rule:"optional",type:"RefreshAccessTokenReq",name:"refresh_access_token_req",id:102},{rule:"optional",type:"RefreshAccessTokenRes",name:"refresh_access_token_res",id:103},{rule:"optional",type:"ProfileSettingReq",name:"profile_setting_req",id:120},{rule:"optional",type:"ProfileSettingRes",name:"profile_setting_res",id:121},{rule:"optional",type:"SendHeartNtfReq",name:"send_heart_ntf_req",id:140},{rule:"optional",type:"SendHeartNtfRes",name:"send_heart_ntf_res",id:141},{rule:"optional",type:"GetNoticeReq",name:"get_notice_req",id:142},{rule:"optional",type:"GetNoticeRes",name:"get_notice_res",id:143},{rule:"optional",type:"SignReq",name:"sign_req",id:150},{rule:"optional",type:"SignRes",name:"sign_res",id:151},{rule:"optional",type:"TakeNewUserAwardReq",name:"take_new_user_award_req",id:152},{rule:"optional",type:"TakeNewUserAwardRes",name:"take_new_user_award_res",id:153},{rule:"optional",type:"ShareInfoNtf",name:"share_info_ntf",id:160},{rule:"optional",type:"ShareReq",name:"share_req",id:161},{rule:"optional",type:"ShareRes",name:"share_res",id:162},{rule:"optional",type:"TakeShareAwardReq",name:"take_share_award_req",id:163},{rule:"optional",type:"TakeShareAwardRes",name:"take_share_award_res",id:164},{rule:"optional",type:"FlauntReq",name:"flaunt_req",id:165},{rule:"optional",type:"FlauntRes",name:"flaunt_res",id:166},{rule:"optional",type:"EntranceGuideReportReq",name:"entrance_guide_report_req",id:167},{rule:"optional",type:"EntranceGuideReportRes",name:"entrance_guide_report_res",id:168},{rule:"optional",type:"QuestInfoNtf",name:"quest_info_ntf",id:170},{rule:"optional",type:"QuestConfNtf",name:"quest_conf_ntf",id:171},{rule:"optional",type:"GetActivityInfoReq",name:"get_act_info_req",id:172},{rule:"optional",type:"GetActivityInfoRes",name:"get_act_info_res",id:173},{rule:"optional",type:"ActivityInfoNtf",name:"act_info_ntf",id:174},{rule:"optional",type:"QuestRewardReq",name:"quest_reward_req",id:175},{rule:"optional",type:"QuestRewardRes",name:"quest_reward_res",id:176},{rule:"optional",type:"WeekMatchStartReq",name:"week_match_start_req",id:180},{rule:"optional",type:"WeekMatchStartRes",name:"week_match_start_res",id:181},{rule:"optional",type:"WeekMatchReportReq",name:"week_match_report_req",id:182},{rule:"optional",type:"WeekMatchReportRes",name:"week_match_report_res",id:183},{rule:"optional",type:"WeekMatchShareReq",name:"week_match_share_req",id:184},{rule:"optional",type:"WeekMatchShareRes",name:"week_match_share_res",id:185},{rule:"optional",type:"WeekMatchInfoNtf",name:"week_match_info_ntf",id:186},{rule:"optional",type:"GetArenaMatchIdReq",name:"get_arena_match_id_req",id:190},{rule:"optional",type:"GetArenaMatchIdRes",name:"get_arena_match_id_res",id:191},{rule:"optional",type:"ArenaMatchShareReq",name:"arena_match_share_req",id:192},{rule:"optional",type:"ArenaMatchShareRes",name:"arena_match_share_res",id:193},{rule:"optional",type:"ArenaMatchStartReq",name:"arena_match_start_req",id:194},{rule:"optional",type:"ArenaMatchStartRes",name:"arena_match_start_res",id:195},{rule:"optional",type:"ArenaMatchReportReq",name:"arena_match_report_req",id:196},{rule:"optional",type:"ArenaMatchReportRes",name:"arena_match_report_res",id:197},{rule:"optional",type:"GetArenaMatchRankReq",name:"get_arena_match_rank_req",id:198},{rule:"optional",type:"GetArenaMatchRankRes",name:"get_arena_match_rank_res",id:199}]},{name:"Msg",fields:[{rule:"optional",type:"Head",name:"head",id:1},{rule:"optional",type:"Body",name:"body",id:2}]}],enums:[{name:"StageResType",values:[{name:"STAGE_RUNNING",id:0},{name:"STAGE_OK",id:1},{name:"STAGE_FAILED",id:2},{name:"STAGE_QUIT",id:3},{name:"STAGE_FIRST_PASS",id:4},{name:"STAGE_FIRST_THREE_STAR_PASS",id:5},{name:"STAGE_CHECK_FAILED",id:6}]},{name:"GMCmd",values:[{name:"GC_CHANGE_ATTR",id:1001},{name:"GC_SET_STAGE",id:1002},{name:"GC_CLEAR_PLAYER",id:1003},{name:"GC_SHOW_REGISTER_INFO",id:1004},{name:"GC_SET_SYSTEM_TIME",id:1005},{name:"GC_SET_RANK_DATA",id:1006},{name:"GC_SEND_MAIL",id:1007},{name:"GC_BATCH_SET_STAGE",id:1008},{name:"GC_SET_MONTH_SIGN_ATTR",id:1009}]},{name:"QuestState",values:[{name:"QUEST_STATE_RUNNING",id:0},{name:"QUEST_SOURCE_REWARD",id:1},{name:"QUEST_SOURCE_END",id:2}]},{name:"MessageCmd",values:[{name:"MC_ERROR",id:-1},{name:"MC_NULL",id:0},{name:"MC_LOGIN_REQ",id:1001},{name:"MC_LOGIN_RES",id:1002},{name:"MC_LOGOUT_NTF",id:1031},{name:"MC_PLAYER_INFO_NTF",id:1005},{name:"MC_ATTR_NTF",id:1006},{name:"MC_STAGE_NTF",id:1007},{name:"MC_STATICS_NTF",id:1008},{name:"MC_STAGE_INFO_REQ",id:1009},{name:"MC_STAGE_INFO_RES",id:1010},{name:"MC_STAGE_START_REQ",id:1014},{name:"MC_STAGE_START_RES",id:1015},{name:"MC_STAGE_REPORT_REQ",id:1016},{name:"MC_STAGE_REPORT_RES",id:1017},{name:"MC_STAGE_USE_ITEM_REQ",id:1020},{name:"MC_STAGE_USE_ITEM_RES",id:1021},{name:"MC_GET_STAR_REWARD_REQ",id:1022},{name:"MC_GET_STAR_REWARD_RES",id:1023},{name:"MC_STAGE_JUMP_REQ",id:1024},{name:"MC_STAGE_JUMP_RES",id:1025},{name:"MC_STAGE_JUMP_INFO_NTF",id:1026},{name:"MC_REWARD_POOL_APD",id:1050},{name:"MC_BUY_GOODS_REQ",id:1100},{name:"MC_BUY_GOODS_RES",id:1101},{name:"MC_BUY_DIAMOND_REPORT_REQ",id:1102},{name:"MC_BUY_DIAMOND_REPORT_RES",id:1103},{name:"MC_RANDOM_ITEM_INFO_NTF",id:1104},{name:"MC_ONEYUAN_BUY_REPORT_REQ",id:1105},{name:"MC_ONEYUAN_BUY_REPORT_RES",id:1106},{name:"MC_GET_MAIL_LIST_REQ",id:1130},{name:"MC_GET_MAIL_LIST_RES",id:1131},{name:"MC_MAIL_LIST_NTF",id:1132},{name:"MC_UPDATE_MAIL_REQ",id:1133},{name:"MC_UPDATE_MAIL_RES",id:1134},{name:"MC_UPDATE_MAIL_BATCH_REQ",id:1135},{name:"MC_UPDATE_MAIL_BATCH_RES",id:1136},{name:"MC_GET_PLAYER_BASEINFO_REQ",id:1150},{name:"MC_GET_PLAYER_BASEINFO_NTF",id:1151},{name:"MC_GET_PLAYER_BASEINFO_RES",id:1152},{name:"MC_GET_MAP_FRIEND_REQ",id:1160},{name:"MC_GET_MAP_FRIEND_NTF",id:1161},{name:"MC_GET_MAP_FRIEND_RES",id:1162},{name:"MC_SEND_HEART_REQ",id:1163},{name:"MC_SEND_HEART_RES",id:1164},{name:"MC_GET_RANK_REQ",id:1165},{name:"MC_GET_RANK_RES",id:1166},{name:"MC_RANK_REWARD_NTF",id:1167},{name:"MC_GET_GROUP_RANK_REQ",id:1168},{name:"MC_GET_GROUP_RANK_RES",id:1169},{name:"MC_GM_CMD_INFO_REQ",id:1180},{name:"MC_GM_CMD_INFO_RES",id:1181},{name:"MC_GM_CMD_SET_REQ",id:1182},{name:"MC_GM_CMD_SET_RES",id:1183},{name:"MC_HEARTBEAT_REQ",id:1190},{name:"MC_HEARTBEAT_RES",id:1191},{name:"MC_REFRESH_ACCESS_TOKEN_REQ",id:1192},{name:"MC_REFRESH_ACCESS_TOKEN_RES",id:1193},{name:"MC_PROFILE_SETTING_REQ",id:1200},{name:"MC_PROFILE_SETTING_RES",id:1201},{name:"MC_SEND_HEART_NOTIFY_REQ",id:1220},{name:"MC_SEND_HEART_NOTIFY_RES",id:1221},{name:"GET_NOTICE_REQ",id:1230},{name:"GET_NOTICE_RES",id:1231},{name:"SIGN_REQ",id:1340},{name:"SIGN_RES",id:1341},{name:"MC_Take_NEW_USER_AWARD_REQ",id:1342},{name:"MC_Take_NEW_USER_AWARD_RES",id:1343},{name:"MC_SHARE_INFO_NTF",id:1350},{name:"MC_SHARE_REQ",id:1351},{name:"MC_SHARE_RES",id:1352},{name:"MC_TAKE_SHARE_AWARD_REQ",id:1353},{name:"MC_TAKE_SHARE_AWARD_RES",id:1354},{name:"MC_FLAUNT_REQ",id:1355},{name:"MC_FLAUNT_RES",id:1356},{name:"MC_ENTRANCE_GUIDE_REPORT_REQ",id:1357},{name:"MC_ENTRANCE_GUIDE_REPORT_RES",id:1358},{name:"MC_QUEST_INFO_NTF",id:1360},{name:"MC_QUEST_CONF_NTF",id:1361},{name:"MC_GET_ACT_INFO_REQ",id:1362},{name:"MC_GET_ACT_INFO_RES",id:1363},{name:"MC_ACT_INFO_NTF",id:1364},{name:"MC_QUEST_REWARD_REQ",id:1365},{name:"MC_QUEST_REWARD_RES",id:1366},{name:"MC_WEEK_MATCH_START_REQ",id:1370},{name:"MC_WEEK_MATCH_START_RES",id:1371},{name:"MC_WEEK_MATCH_REPORT_REQ",id:1372},{name:"MC_WEEK_MATCH_REPORT_RES",id:1373},{name:"MC_WEEK_MATCH_SHARE_REQ",id:1374},{name:"MC_WEEK_MATCH_SHARE_RES",id:1375},{name:"MC_WEEK_MATCH_INFO_NTF",id:1376},{name:"MC_GET_ARENA_MATCH_ID_REQ",id:1380},{name:"MC_GET_ARENA_MATCH_ID_RES",id:1381},{name:"MC_ARENA_MATCH_SHARE_REQ",id:1382},{name:"MC_ARENA_MATCH_SHARE_RES",id:1383},{name:"MC_ARENA_MATCH_START_REQ",id:1384},{name:"MC_ARENA_MATCH_START_RES",id:1385},{name:"MC_ARENA_MATCH_REPORT_REQ",id:1386},{name:"MC_ARENA_MATCH_REPORT_RES",id:1387},{name:"MC_GET_ARENA_MATCH_RANK_REQ",id:1388},{name:"MC_GET_ARENA_MATCH_RANK_RES",id:1389}]}]},{name:"illusion",fields:[]},{name:"PkgRes",fields:[],messages:[{name:"PriceInfo",fields:[{rule:"optional",type:"int32",name:"amount",id:1,options:{"(illusion.fields_name)":"\u6570\u91CF"}},{rule:"optional",type:"int32",name:"price",id:2,options:{"(illusion.fields_name)":"\u4EF7\u683C"}}]},{name:"GoodsConf",fields:[{rule:"optional",type:"int32",name:"id",id:1,options:{"(illusion.fields_name)":"\u5546\u54C1ID"}},{rule:"optional",type:"ArticleType",name:"type",id:2,options:{"(illusion.fields_name)":"\u7269\u54C1\u7C7B\u578B","(illusion.default_value)":"ARTICLE_TYPE_NULL",default:"ARTICLE_TYPE_NULL"}},{rule:"optional",type:"uint32",name:"subtype",id:3,options:{"(illusion.fields_name)":"\u7269\u54C1\u5B50\u7C7B\u578B"}},{rule:"optional",type:"uint32",name:"article_id",id:4,options:{"(illusion.fields_name)":"\u7269\u54C1ID"}},{rule:"optional",type:"PriceType",name:"price_type",id:5,options:{"(illusion.fields_name)":"\u4EF7\u683C\u7C7B\u578B","(illusion.default_value)":"PRICE_TYPE_NULL",default:"PRICE_TYPE_NULL"}},{rule:"optional",type:"int32",name:"price_pkg_cnt",id:6,options:{"(illusion.fields_name)":"\u5957\u9910\u4E2A\u6570"}},{rule:"repeated",type:"PriceInfo",name:"price_pkg_list",id:7,options:{"(illusion.fields_name)":"\u5957\u9910","(illusion.repeat_size)":6}}]},{name:"GoodsConfList",options:{"(illusion.cfg_message)":!0,"(illusion.excel_file)":"\u5546\u54C1\u914D\u7F6E.xlsx","(illusion.excel_sheet)":"\u5546\u54C1\u8868","(illusion.outer_file)":"GoodsConf.bin","(illusion.fieldsname_line)":1,"(illusion.fullname_line)":2,"(illusion.read_line)":2},fields:[{rule:"repeated",type:"GoodsConf",name:"list_data",id:1}]},{name:"ShopConf",fields:[{rule:"optional",type:"int32",name:"id",id:1,options:{"(illusion.fields_name)":"\u5546\u54C1ID"}},{rule:"optional",type:"string",name:"version",id:2,options:{"(illusion.fields_name)":"\u7248\u672C\u53F7"}},{rule:"optional",type:"GoodsSaleType",name:"sale_type",id:3,options:{"(illusion.fields_name)":"\u72B6\u6001","(illusion.default_value)":"GOODS_SALE_TYPE_NULL",default:"GOODS_SALE_TYPE_NULL"}},{rule:"optional",type:"int32",name:"reward_pool_id",id:4,options:{"(illusion.fields_name)":"\u5546\u57CE\u5956\u52B1\u6C60ID"}},{rule:"optional",type:"PriceType",name:"price_type",id:5,options:{"(illusion.fields_name)":"\u4EF7\u683C\u7C7B\u578B","(illusion.default_value)":"PRICE_TYPE_NULL",default:"PRICE_TYPE_NULL"}},{rule:"optional",type:"int32",name:"price",id:6,options:{"(illusion.fields_name)":"\u4EF7\u683C"}},{rule:"optional",type:"int32",name:"discount_price",id:7,options:{"(illusion.fields_name)":"\u6298\u6263\u4EF7"}},{rule:"optional",type:"string",name:"sale_desc",id:8,options:{"(illusion.fields_name)":"\u63CF\u8FF0"}},{rule:"optional",type:"GoodsTabType",name:"tab_type",id:9,options:{"(illusion.fields_name)":"\u9875\u7B7E\u7C7B\u578B","(illusion.default_value)":"GOODS_TAB_TYPE_NULL",default:"GOODS_TAB_TYPE_NULL"}},{rule:"optional",type:"int32",name:"sort_index",id:10,options:{"(illusion.fields_name)":"\u987A\u5E8F"}},{rule:"optional",type:"string",name:"start_time",id:11,options:{"(illusion.fields_name)":"\u4E0A\u67B6\u65F6\u95F4"}},{rule:"optional",type:"string",name:"end_time",id:12,options:{"(illusion.fields_name)":"\u4E0B\u67B6\u65F6\u95F4"}},{rule:"optional",type:"GoodsLimitType",name:"limit_type",id:13,options:{"(illusion.fields_name)":"\u9650\u91CF\u7C7B\u578B","(illusion.default_value)":"GOODS_LIMIT_TYPE_NULL",default:"GOODS_LIMIT_TYPE_NULL"}},{rule:"optional",type:"int32",name:"limit_num",id:14,options:{"(illusion.fields_name)":"\u9650\u91CF\u6570\u91CF"}},{rule:"optional",type:"int32",name:"show_level",id:15,options:{"(illusion.fields_name)":"\u663E\u793A\u7EA7\u522B"}}]},{name:"ShopConfList",options:{"(illusion.cfg_message)":!0,"(illusion.excel_file)":"\u5546\u54C1\u914D\u7F6E.xlsx","(illusion.excel_sheet)":"\u5546\u57CE\u8868","(illusion.outer_file)":"shop_conf.bin","(illusion.fieldsname_line)":1,"(illusion.fullname_line)":2,"(illusion.read_line)":2},fields:[{rule:"repeated",type:"ShopConf",name:"list_data",id:1}]},{name:"RewardInfo",fields:[{rule:"optional",type:"ArticleType",name:"article_type",id:1,options:{"(illusion.fields_name)":"\u7269\u54C1\u7C7B\u578B","(illusion.default_value)":"ARTICLE_TYPE_NULL",default:"ARTICLE_TYPE_NULL"}},{rule:"optional",type:"int32",name:"article_subtype",id:2,options:{"(illusion.fields_name)":"\u7269\u54C1\u5B50\u7C7B\u578B"}},{rule:"optional",type:"int32",name:"article_id",id:3,options:{"(illusion.fields_name)":"\u7269\u54C1ID"}},{rule:"optional",type:"int32",name:"article_count",id:4,options:{"(illusion.fields_name)":"\u6570\u91CF"}},{rule:"optional",type:"int32",name:"probability",id:5,options:{"(illusion.fields_name)":"\u6982\u7387"}},{rule:"optional",type:"int64",name:"article_ext1",id:6,options:{"(illusion.fields_name)":"\u6269\u5C55\u4E00"}},{rule:"optional",type:"int64",name:"article_ext2",id:7,options:{"(illusion.fields_name)":"\u6269\u5C55\u4E8C"}}]},{name:"RewardPool",fields:[{rule:"optional",type:"int32",name:"id",id:1,options:{"(illusion.fields_name)":"\u5956\u52B1ID"}},{rule:"optional",type:"RewardSrc",name:"src",id:2,options:{"(illusion.fields_name)":"\u5956\u52B1\u6765\u6E90","(illusion.default_value)":"REWARD_SRC_NULL"}},{rule:"optional",type:"RewardGetType",name:"get_type",id:3,options:{"(illusion.fields_name)":"\u53D1\u653E\u65B9\u5F0F","(illusion.default_value)":"REWARD_GET_TYE_NULL"}},{rule:"optional",type:"string",name:"get_subject",id:4,options:{"(illusion.fields_name)":"\u53D1\u653E\u4E3B\u9898"}},{rule:"optional",type:"string",name:"get_content",id:5,options:{"(illusion.fields_name)":"\u53D1\u653E\u5185\u5BB9"}},{rule:"optional",type:"int32",name:"reward_cnt",id:6,options:{"(illusion.fields_name)":"\u5956\u52B1\u4E2A\u6570"}},{rule:"repeated",type:"RewardInfo",name:"reward_list",id:7,options:{"(illusion.fields_name)":"\u5956\u52B1","(illusion.repeat_size)":5}}]},{name:"FirstRewardPoolList",options:{"(illusion.cfg_message)":!0,"(illusion.excel_file)":"\u5956\u52B1\u6C60\u914D\u7F6E.xlsx","(illusion.excel_sheet)":"\u9996\u901A\u5956\u52B1\u6C60\u8868","(illusion.outer_file)":"FirstRewardPool.bin","(illusion.fieldsname_line)":1,"(illusion.fullname_line)":2,"(illusion.read_line)":2},fields:[{rule:"repeated",type:"RewardPool",name:"list_data",id:1}]},{name:"OneStarRewardPoolList",options:{"(illusion.cfg_message)":!0,"(illusion.excel_file)":"\u5956\u52B1\u6C60\u914D\u7F6E.xlsx","(illusion.excel_sheet)":"\u4E00\u661F\u5956\u52B1\u6C60\u8868","(illusion.outer_file)":"OneStarRewardPool.bin","(illusion.fieldsname_line)":1,"(illusion.fullname_line)":2,"(illusion.read_line)":2},fields:[{rule:"repeated",type:"RewardPool",name:"list_data",id:1}]},{name:"TwoStarRewardPoolList",options:{"(illusion.cfg_message)":!0,"(illusion.excel_file)":"\u5956\u52B1\u6C60\u914D\u7F6E.xlsx","(illusion.excel_sheet)":"\u4E8C\u661F\u5956\u52B1\u6C60\u8868","(illusion.outer_file)":"TwoStarRewardPool.bin","(illusion.fieldsname_line)":1,"(illusion.fullname_line)":2,"(illusion.read_line)":2},fields:[{rule:"repeated",type:"RewardPool",name:"list_data",id:1}]},{name:"ThreeStarRewardPoolList",options:{"(illusion.cfg_message)":!0,"(illusion.excel_file)":"\u5956\u52B1\u6C60\u914D\u7F6E.xlsx","(illusion.excel_sheet)":"\u4E09\u661F\u5956\u52B1\u6C60\u8868","(illusion.outer_file)":"ThreeStarRewardPool.bin","(illusion.fieldsname_line)":1,"(illusion.fullname_line)":2,"(illusion.read_line)":2},fields:[{rule:"repeated",type:"RewardPool",name:"list_data",id:1}]},{name:"CommRewardPoolList",options:{"(illusion.cfg_message)":!0,"(illusion.excel_file)":"\u5956\u52B1\u6C60\u914D\u7F6E.xlsx","(illusion.excel_sheet)":"\u901A\u7528\u5956\u52B1\u6C60\u8868","(illusion.outer_file)":"CommRewardPool.bin","(illusion.fieldsname_line)":1,"(illusion.fullname_line)":2,"(illusion.read_line)":2},fields:[{rule:"repeated",type:"RewardPool",name:"list_data",id:1}]},{name:"RegisterRewardPoolList",options:{"(illusion.cfg_message)":!0,"(illusion.excel_file)":"\u5956\u52B1\u6C60\u914D\u7F6E.xlsx","(illusion.excel_sheet)":"\u6CE8\u518C\u8D60\u9001\u8868","(illusion.outer_file)":"RegisterRewardPool.bin","(illusion.fieldsname_line)":1,"(illusion.fullname_line)":2,"(illusion.read_line)":2},fields:[{rule:"repeated",type:"RewardPool",name:"list_data",id:1}]},{name:"ShopRewardPoolList",options:{"(illusion.cfg_message)":!0,"(illusion.excel_file)":"\u5546\u54C1\u914D\u7F6E.xlsx","(illusion.excel_sheet)":"\u5546\u57CE\u5956\u52B1\u6C60","(illusion.outer_file)":"ShopRewardPool.bin","(illusion.fieldsname_line)":1,"(illusion.fullname_line)":2,"(illusion.read_line)":2},fields:[{rule:"repeated",type:"RewardPool",name:"list_data",id:1}]},{name:"MapStarRewardPoolList",options:{"(illusion.cfg_message)":!0,"(illusion.excel_file)":"\u5956\u52B1\u6C60\u914D\u7F6E.xlsx","(illusion.excel_sheet)":"\u96C6\u661F\u5956\u52B1\u6C60\u8868","(illusion.outer_file)":"MapStarRewardPool.bin","(illusion.fieldsname_line)":1,"(illusion.fullname_line)":2,"(illusion.read_line)":2},fields:[{rule:"repeated",type:"RewardPool",name:"list_data",id:1}]},{name:"NewUserPoolList",options:{"(illusion.cfg_message)":!0,"(illusion.excel_file)":"\u5956\u52B1\u6C60\u914D\u7F6E.xlsx","(illusion.excel_sheet)":"\u65B0\u624B\u793C\u5305\u5956\u52B1","(illusion.outer_file)":"NewUserPool.bin","(illusion.fieldsname_line)":1,"(illusion.fullname_line)":2,"(illusion.read_line)":2},fields:[{rule:"repeated",type:"RewardPool",name:"list_data",id:1}]},{name:"FlauntRewardPoolList",options:{"(illusion.cfg_message)":!0,"(illusion.excel_file)":"\u5956\u52B1\u6C60\u914D\u7F6E.xlsx","(illusion.excel_sheet)":"\u70AB\u8000\u6709\u793C\u5956\u52B1\u8868","(illusion.outer_file)":"FlauntRewardPool.bin","(illusion.fieldsname_line)":1,"(illusion.fullname_line)":2,"(illusion.read_line)":2},fields:[{rule:"repeated",type:"RewardPool",name:"list_data",id:1}]},{name:"OneYuanBuyRewardPoolList",options:{"(illusion.cfg_message)":!0,"(illusion.excel_file)":"\u5956\u52B1\u6C60\u914D\u7F6E.xlsx","(illusion.excel_sheet)":"\u4E00\u5143\u8D2D\u793C\u5305","(illusion.outer_file)":"OneYuanBuyRewardPool.bin","(illusion.fieldsname_line)":1,"(illusion.fullname_line)":2,"(illusion.read_line)":2},fields:[{rule:"repeated",type:"RewardPool",name:"list_data",id:1}]},{name:"EntranceGuideRewardPoolList",options:{"(illusion.cfg_message)":!0,"(illusion.excel_file)":"\u5956\u52B1\u6C60\u914D\u7F6E.xlsx","(illusion.excel_sheet)":"\u5165\u53E3\u5F15\u5BFC\u5956\u52B1","(illusion.outer_file)":"EntranceGuideRewardPool.bin","(illusion.fieldsname_line)":1,"(illusion.fullname_line)":2,"(illusion.read_line)":2},fields:[{rule:"repeated",type:"RewardPool",name:"list_data",id:1}]},{name:"QuestElementConf",fields:[{rule:"optional",type:"int32",name:"element_id",id:1,options:{"(illusion.fields_name)":"\u4EFB\u52A1\u5355\u5143ID"}},{rule:"optional",type:"QuestSource",name:"quest_source",id:2,options:{"(illusion.fields_name)":"\u4EFB\u52A1\u6765\u6E90",default:"QUEST_SOURCE_NULL"}},{rule:"optional",type:"Condition",name:"expr_conditon",id:3,options:{"(illusion.fields_name)":"\u5F00\u542F\u6761\u4EF6",default:"CONDITION_NULL"}},{rule:"optional",type:"QuestPeriod",name:"period_type",id:4,options:{"(illusion.fields_name)":"\u91CD\u7F6E\u5468\u671F",default:"QUEST_PERIOD_ONCE"}},{rule:"optional",type:"string",name:"start_time",id:5,options:{"(illusion.fields_name)":"\u5F00\u59CB\u65F6\u95F4"}},{rule:"optional",type:"string",name:"end_time",id:6,options:{"(illusion.fields_name)":"\u7ED3\u675F\u65F6\u95F4"}},{rule:"optional",type:"SendType",name:"send_type",id:7,options:{"(illusion.fields_name)":"\u5956\u52B1\u53D1\u653E\u65B9\u5F0F",default:"SEND_TYPE_GET"}},{rule:"optional",type:"int32",name:"reward_id",id:8,options:{"(illusion.fields_name)":"\u4EFB\u52A1\u5956\u52B1\u6C60ID"}},{rule:"optional",type:"ProcessType",name:"process_type",id:9,options:{"(illusion.fields_name)":"\u4E8B\u4EF6\u5904\u7406\u7C7B\u578B",default:"PROCESS_TYPE_END"}},{rule:"optional",type:"EventId",name:"event_id",id:10,options:{"(illusion.fields_name)":"\u54CD\u5E94\u4E8B\u4EF6\u7C7B\u578B",default:"EI_NULL"}},{rule:"repeated",type:"int32",name:"event_param",id:11,options:{"(illusion.fields_name)":"\u4E8B\u4EF6\u53C2\u6570","(illusion.repeat_size)":6}},{rule:"optional",type:"int32",name:"upper_limit",id:12,options:{"(illusion.fields_name)":"\u4E0A\u9650"}},{rule:"optional",type:"string",name:"quest_desc",id:13,options:{"(illusion.fields_name)":"\u4EFB\u52A1\u5355\u5143\u63CF\u8FF0"}},{rule:"optional",type:"int32",name:"element_icon",id:14,options:{"(illusion.fields_name)":"icon"}},{rule:"optional",type:"string",name:"icon_desc",id:15,options:{"(illusion.fields_name)":"icon\u63CF\u8FF0"}},{rule:"optional",type:"int32",name:"jump_type",id:16,options:{"(illusion.fields_name)":"\u8DF3\u8F6C\u7C7B\u578B"}},{rule:"optional",type:"string",name:"jump_data",id:17,options:{"(illusion.fields_name)":"\u8DF3\u8F6C\u53C2\u6570"}}]},{name:"QuestConf",fields:[{rule:"optional",type:"int32",name:"quest_id",id:1,options:{"(illusion.fields_name)":"\u4EFB\u52A1ID"}},{rule:"optional",type:"QuestSource",name:"quest_source",id:2,options:{"(illusion.fields_name)":"\u4EFB\u52A1\u6765\u6E90",default:"QUEST_SOURCE_NULL"}},{rule:"optional",type:"string",name:"quest_desc",id:3,options:{"(illusion.fields_name)":"\u4EFB\u52A1\u63CF\u8FF0"}},{rule:"repeated",type:"int32",name:"elements_id",id:4,options:{"(illusion.fields_name)":"\u4EFB\u52A1\u5355\u5143ID","(illusion.repeat_size)":15}}]},{name:"ActQuestElementConfList",options:{"(illusion.cfg_message)":!0,"(illusion.excel_file)":"\u6D3B\u52A8\u4E2D\u5FC3\u4EFB\u52A1\u914D\u7F6E.xlsx","(illusion.excel_sheet)":"\u6D3B\u52A8\u4E2D\u5FC3\u4EFB\u52A1\u5355\u5143\u914D\u7F6E","(illusion.outer_file)":"ActQuestElementConf.bin","(illusion.fieldsname_line)":1,"(illusion.fullname_line)":2,"(illusion.read_line)":2},fields:[{rule:"repeated",type:"QuestElementConf",name:"list_data",id:1}]},{name:"ActQuestConfList",options:{"(illusion.cfg_message)":!0,"(illusion.excel_file)":"\u6D3B\u52A8\u4E2D\u5FC3\u4EFB\u52A1\u914D\u7F6E.xlsx","(illusion.excel_sheet)":"\u6D3B\u52A8\u4E2D\u5FC3\u4EFB\u52A1\u914D\u7F6E","(illusion.outer_file)":"ActQuestConf.bin","(illusion.fieldsname_line)":1,"(illusion.fullname_line)":2,"(illusion.read_line)":2},fields:[{rule:"repeated",type:"QuestConf",name:"list_data",id:1}]},{name:"ActQuestRewardPoolList",options:{"(illusion.cfg_message)":!0,"(illusion.excel_file)":"\u6D3B\u52A8\u4E2D\u5FC3\u4EFB\u52A1\u914D\u7F6E.xlsx","(illusion.excel_sheet)":"\u6D3B\u52A8\u4E2D\u5FC3\u4EFB\u52A1\u5956\u52B1\u6C60\u914D\u7F6E","(illusion.outer_file)":"ActQuestRewardPool.bin","(illusion.fieldsname_line)":1,"(illusion.fullname_line)":2,"(illusion.read_line)":2},fields:[{rule:"repeated",type:"RewardPool",name:"list_data",id:1}]},{name:"EverydayActivityQuestElementConfList",options:{"(illusion.cfg_message)":!0,"(illusion.excel_file)":"\u6BCF\u65E5\u4EFB\u52A1\u914D\u7F6E.xlsx","(illusion.excel_sheet)":"\u6BCF\u65E5\u4EFB\u52A1\u5355\u5143\u914D\u7F6E","(illusion.outer_file)":"EverydayActivityQuestElementConf.bin","(illusion.fieldsname_line)":1,"(illusion.fullname_line)":2,"(illusion.read_line)":2},fields:[{rule:"repeated",type:"QuestElementConf",name:"list_data",id:1}]},{name:"EverydayActivityQuestConfList",options:{"(illusion.cfg_message)":!0,"(illusion.excel_file)":"\u6BCF\u65E5\u4EFB\u52A1\u914D\u7F6E.xlsx","(illusion.excel_sheet)":"\u6BCF\u65E5\u4EFB\u52A1\u914D\u7F6E","(illusion.outer_file)":"EverydayActivityQuestConf.bin","(illusion.fieldsname_line)":1,"(illusion.fullname_line)":2,"(illusion.read_line)":2},fields:[{rule:"repeated",type:"QuestConf",name:"list_data",id:1}]},{name:"EverydayActivityQuestRewardPoolList",options:{"(illusion.cfg_message)":!0,"(illusion.excel_file)":"\u6BCF\u65E5\u4EFB\u52A1\u914D\u7F6E.xlsx","(illusion.excel_sheet)":"\u6BCF\u65E5\u4EFB\u52A1\u5956\u52B1\u6C60\u914D\u7F6E","(illusion.outer_file)":"EverydayActivityQuestRewardPool.bin","(illusion.fieldsname_line)":1,"(illusion.fullname_line)":2,"(illusion.read_line)":2},fields:[{rule:"repeated",type:"RewardPool",name:"list_data",id:1}]},{name:"ActivityConf",fields:[{rule:"optional",type:"int32",name:"act_id",id:1,options:{"(illusion.fields_name)":"\u6D3B\u52A8ID"}},{rule:"optional",type:"int32",name:"sort_index",id:2,options:{"(illusion.fields_name)":"\u6392\u5E8F\u7D22\u5F15"}},{rule:"optional",type:"ActContentType",name:"content_type",id:3,options:{"(illusion.fields_name)":"\u5185\u5BB9\u7C7B\u578B",default:"ACTIVITY_CONTENT_TYPE_NULL"}},{rule:"optional",type:"string",name:"act_icon",id:4,options:{"(illusion.fields_name)":"\u56FE\u6807"}},{rule:"optional",type:"string",name:"act_name",id:5,options:{"(illusion.fields_name)":"\u540D\u5B57"}},{rule:"optional",type:"string",name:"act_content",id:6,options:{"(illusion.fields_name)":"\u6B63\u6587"}},{rule:"optional",type:"string",name:"start_time",id:7,options:{"(illusion.fields_name)":"\u5F00\u59CB\u65F6\u95F4"}},{rule:"optional",type:"string",name:"end_time",id:8,options:{"(illusion.fields_name)":"\u7ED3\u675F\u65F6\u95F4"}},{rule:"optional",type:"int32",name:"jump_type",id:9,options:{"(illusion.fields_name)":"\u8DF3\u8F6C\u7C7B\u578B"}},{rule:"optional",type:"string",name:"jump_data",id:10,options:{"(illusion.fields_name)":"\u8DF3\u8F6C\u53C2\u6570"}},{rule:"optional",type:"int32",name:"quest_id",id:11,options:{"(illusion.fields_name)":"\u4EFB\u52A1ID"}},{rule:"optional",type:"int32",name:"redpoint_id",id:12,options:{"(illusion.fields_name)":"\u7EA2\u70B9ID"}},{rule:"optional",type:"CompareType",name:"version_cmp",id:13,options:{"(illusion.fields_name)":"\u7248\u672C\u53F7\u6BD4\u8F83\u7B26",default:"COMPARE_TYPE_GREATER_NULL"}},{rule:"optional",type:"string",name:"version",id:14,options:{"(illusion.fields_name)":"\u7248\u672C\u53F7"}},{rule:"optional",type:"int32",name:"is_show",id:15,options:{"(illusion.fields_name)":"\u662F\u5426\u5F39\u51FA"}}]},{name:"ActivityConfList",options:{"(illusion.cfg_message)":!0,"(illusion.excel_file)":"\u6D3B\u52A8\u4E2D\u5FC3\u914D\u7F6E.xlsx","(illusion.excel_sheet)":"\u6D3B\u52A8\u4E2D\u5FC3\u914D\u8868","(illusion.outer_file)":"activity_conf.bin","(illusion.fieldsname_line)":1,"(illusion.fullname_line)":2,"(illusion.read_line)":2},fields:[{rule:"repeated",type:"ActivityConf",name:"list_data",id:1}]}],enums:[{name:"ArticleType",values:[{name:"ARTICLE_TYPE_NULL",id:0},{name:"ARTICLE_TYPE_ATTR",id:1},{name:"ARTICLE_TYPE_EVENT",id:2},{name:"ARTICLE_TYPE_COUNT",id:3}]},{name:"PriceType",values:[{name:"PRICE_TYPE_NULL",id:0},{name:"PRICE_TYPE_MONEY",id:1},{name:"PRICE_TYPE_DIAMOND",id:2},{name:"PRICE_TYPE_COUNT",id:3}]},{name:"GoodsSaleType",values:[{name:"GOODS_SALE_TYPE_NULL",id:0},{name:"GOODS_SALE_TYPE_NORMAL",id:1},{name:"GOODS_SALE_TYPE_HOT",id:2},{name:"GOODS_SALE_TYPE_LIMIT",id:3},{name:"GOODS_SALE_TYPE_NEW",id:4},{name:"GOODS_SALE_TYPE_DISCOUNT",id:5}]},{name:"GoodsTabType",values:[{name:"GOODS_TAB_TYPE_NULL",id:1},{name:"GOODS_TAB_TYPE_PKG",id:2},{name:"GOODS_TAB_TYPE_ITEM",id:3}]},{name:"GoodsLimitType",values:[{name:"GOODS_LIMIT_TYPE_NULL",id:0},{name:"GOODS_LIMIT_TYPE_NORMAL",id:1},{name:"GOODS_LIMIT_TYPE_DAILY",id:2}]},{name:"EventId",values:[{name:"EI_NULL",id:0},{name:"EI_CHANGE_ARTICLE",id:1},{name:"EI_BUY_ARTICLE",id:2},{name:"EI_USE_ARTICLE",id:3},{name:"EI_ADD_WEEK_MATCH_STAR",id:4},{name:"EI_FINISH_NOMAL_STAGE",id:5},{name:"EI_FINISH_WEEK_STAGE",id:6},{name:"EI_UPDATE_HEART",id:7},{name:"EI_LONGIN",id:8},{name:"EI_COLLECT",id:9},{name:"EI_SHOP_BUY",id:10},{name:"EI_QUEST_STATE_CHANGE",id:11},{name:"EI_FINISH_CHILD_WEEK_STAGE",id:12},{name:"EI_COLLECT_STAR",id:13},{name:"EI_OPEN",id:14},{name:"EI_WEEK_STAGE_REWARD",id:15},{name:"EI_PLAYER_REGIST",id:16},{name:"EI_NEWBIES_WEEK_STAGE",id:17},{name:"EI_ASK_FRIEND_GIFT",id:18},{name:"EI_ADD_FRIEND",id:19},{name:"EI_ANSWER_FRIEND",id:20},{name:"EI_GIFT_OP",id:21},{name:"EI_SEND_FRIEND_GIFT",id:22},{name:"EI_EVERYDAY_ACTIVITY",id:23},{name:"EI_SHARE",id:24},{name:"EI_MAX_COUNT",id:25}]},{name:"VariableId",values:[{name:"VID_NULL",id:0},{name:"VID_MAX_STAGE",id:1},{name:"VID_NEWBIES_QUEST_START_TIME",id:2},{name:"VID_NOW_TIME",id:3},{name:"VID_SIGN_START_TIME",id:4},{name:"VID_WEEKMATCH_START_TIME",id:5},{name:"VID_SLOT_START_TIME",id:6},{name:"VID_ONE_YUAN_BUY_START_TIME",id:7},{name:"VID_ACTIVITY_START_TIME",id:8},{name:"VID_NOTICE_START_TIME",id:9}]},{name:"ConstId",values:[{name:"CID_NULL",id:0},{name:"CID_NEWBIES_QUEST_TIME_1",id:1},{name:"CID_NEWBIES_QUEST_TIME_2",id:2},{name:"CID_WEEK_MATCH_START_STAGE",id:3},{name:"CID_NEWBIES_QUEST_START_STAGE",id:4},{name:"CID_SIGN_START_STAGE",id:5},{name:"CID_SHARE_ON",id:6},{name:"CID_ONE_YUAN_BUY_START_STAGE",id:7},{name:"CID_SLOT_START_STAGE",id:8},{name:"CID_ACTIVITY_START_STAGE",id:9},{name:"CID_CLICK_STATIS_INTERVAL",id:10},{name:"CID_NOTICE_START_STAGE",id:11},{name:"CID_GUIDE_START_STAGE",id:12}]},{name:"RewardSrc",values:[{name:"REWARD_SRC_NULL",id:0},{name:"REWARD_SRC_ONE_YUAN",id:1},{name:"REWARD_SRC_STAR",id:2},{name:"REWARD_STAGE_NORMAIL",id:3},{name:"REWARD_DAILY_LOGIN",id:4},{name:"REWARD_WEEKMATCH_RANK",id:5},{name:"REWARD_MONTH_SIGN",id:6},{name:"REWARD_REGISTER",id:7},{name:"REWARD_SHOP_BUY",id:8},{name:"REWARD_SRC_COUNT",id:9}]},{name:"RewardGetType",values:[{name:"REWARD_GET_TYE_NULL",id:0},{name:"REWARD_GET_TYE_DIRECT",id:1},{name:"REWARD_GET_TYE_MAIL",id:2},{name:"REWARD_GET_TYE_CLICK",id:3},{name:"REWARD_GET_TYE_DIRECT_OR_MAIL",id:4},{name:"REWARD_GET_TYE_COUNT",id:5}]},{name:"QuestSource",values:[{name:"QUEST_SOURCE_NULL",id:0},{name:"QUEST_SOURCE_EVERYDAY_ACTIVITY",id:1},{name:"QUEST_SOURCE_ACTIVITY_CENTER",id:2},{name:"QUEST_SOURCE_MAX_COUNT",id:3}]},{name:"QuestPeriod",values:[{name:"QUEST_PERIOD_ONCE",id:0},{name:"QUEST_PERIOD_DAY",id:1},{name:"QUEST_PERIOD_WEEK",id:2},{name:"QUEST_PERIOD_MONTH",id:3},{name:"QUEST_PERIOD_LOOP",id:4}]},{name:"SendType",values:[{name:"SEND_TYPE_GET",id:1},{name:"SEND_TYPE_AUTO",id:0}]},{name:"ProcessType",values:[{name:"PROCESS_TYPE_END",id:0},{name:"PROCESS_TYPE_CONTINUE",id:1}]},{name:"Condition",values:[{name:"CONDITION_NULL",id:0}]},{name:"RelationType",values:[{name:"RELATION_TYPE_NULL",id:0},{name:"RELATION_TYPE_INHERIT",id:1},{name:"RELATION_TYPE_NO_INHERIT",id:2}]},{name:"ActContentType",values:[{name:"ACTIVITY_CONTENT_TYPE_NULL",id:0},{name:"ACTIVITY_CONTENT_TYPE_PICTURE",id:1},{name:"ACTIVITY_CONTENT_TYPE_TEXT",id:2},{name:"ACTIVITY_CONTENT_TYPE_PROGRESS",id:3}]},{name:"CompareType",values:[{name:"COMPARE_TYPE_GREATER_NULL",id:0},{name:"COMPARE_TYPE_GREATER_THAN",id:1},{name:"COMPARE_TYPE_LESS_THAN",id:2},{name:"COMPARE_TYPE_EQUAL",id:3},{name:"COMPARE_TYPE_NOT_EQUAL",id:4}]}]}]}).build(["CSProto"])},function(E,e,t){"use strict";var O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y=t(63),T=t(64),g=t(70),R=t(75),b=t(65),l=t(76),C=t(77),s=t(72),a=t(78),_=t(79),d=[g.MC_STAGE_START_REQ.cmd,g.MC_STAGE_USE_ITEM_REQ.cmd,g.MC_BUY_GOODS_REQ.cmd,g.MC_WEEK_MATCH_START_REQ.cmd];E.exports={reConnectCb:[],netManager:null,initConnectTry:10,init:function(i,a){var t=this;this.kickOff=!1,this.initSuccess=i,this.initFail=a,this._registerConnectTimeout(a),this.initNetManager(function(){},function(){if(!t.alreadyInitLogin)if(0>=t.initConnectTry){t._clearConnectTimeout();var n={ret:R.CONNECT_ERROR.code,ret_desc:R.CONNECT_ERROR.desc};a&&a(n)}else t._initReconnect()},function(){!t.alreadyInitLogin&&0<t.initConnectTry&&(t.kickOff?t._clearConnectTimeout():t._initReconnect())}),this.getShareOpenId()},_initReconnect:function(){var t=this;this.isOnReconnectTimer||(this.isOnReconnectTimer=!0,setTimeout(function(){t.isOnReconnectTimer=!1,t.initConnectTry--,l.addInfo("\u91CD\u65B0\u521D\u59CB\u5316\u7F51\u7EDC"),t.init(t.initSuccess,t.initFail)},1e3))},_registerConnectTimeout:function(n){this._clearConnectTimeout(),this.connectTimeout=setTimeout(function(){var e={ret:R.CONNECT_TIMEOUT.code,ret_desc:R.CONNECT_TIMEOUT.desc};n(e)},y.timeout)},_clearConnectTimeout:function(){clearTimeout(this.connectTimeout),this.connectTimeout=null},getShareOpenId:function(){var t=T.queryStringToJSON();return t.shareOpenid},initNetManager:function(a,e,t){var n=this,i=(b.user_info,""),o="",l=8833,_="",d=y.appid,u=!0;b.pf==y.flag.wechat?(o=4098,l=8844,_="wx"):b.pf==y.flag.qq&&(o=4099,l=8833,_="qq",d=y.qqappid);var c=T.queryStringToJSON();if(c.host){var m="ws";c.wss&&(m="wss"),i=m+"://"+c.host}else i=T.isProductEnv()?y.host.deploy:T.isDailyEnv()?y.host.daily:T.isTestEnv()?y.host.test:y.host.daily,/^wss:/.test(i)&&(i=i.replace("t.","t"+_+"."),i=i.replace("s.","s"+_+".")),i=i.replace(":port",":"+l);c.use_json&&(u=!1),this.netManager=new s({host:i,pb:u,reconnectFun:function(t){n.reconnectFun(t)},onResponse:function(t){n.response(t)}}),this.openStime=new Date().getTime(),this.netManager.open(a,e,t)},getClientType:function(){var n=T.getClient(),e=101;return n.isIOS&&(e=102),e},getCmdConfig:function(i){for(var e in g){var t=g[e];if(t.cmd==i)return t}return null},_registerTimout:function(i){var a=this,t=i.seq,n=i.retry,o=i.cancel,l=i.initLoginCb,_=i.isConsumeCmd;this["timeout_seq"+t]=setTimeout(function(){if(a._clearTimeout(t),!a.kickOff||a.alreadyInitLogin){if(l){var i={ret:R.LOGIN_TIMEOUT.code,ret_desc:R.LOGIN_TIMEOUT.desc};return void l(i,null)}_?T.showNetworkNoRetryTip():T.showNetworkTip(n,o),a._clearReConnectCb()}},y.timeout)},_clearTimeout:function(n){var e="timeout_seq"+n;this[e]&&(clearTimeout(this[e]),this[e]=null,delete this[e])},_mergeStageInfo:function(l,e){for(var t,n=0;t=l[n];n++)if(t){for(var i,o=!1,a=0;i=e[a];a++)if(t.stage_id==i.stage_id){o=!0,e[a]=t;break}o||(e.push(t),console.log("old_stage_info_Array.push item= ",t))}return e},resolveTconndNotify:function(t){"pass"===t.tws_notify_type?(l.addInfo("\u8FDE\u63A5\u5EFA\u7ACB\u6210\u529F"),this._clearConnectTimeout(),this.resolveTconndConnectPass()):"queue"===t.tws_notify_type?l.addInfo("\u6392\u961F("+JSON.stringify(t)+")"):"close"===t.tws_notify_type&&l.addInfo("\u670D\u52A1\u5668\u4E3B\u52A8\u5173\u95ED("+JSON.stringify(t)+")")},resolveTconndConnectPass:function(){var n=this;this.alreadyInitLogin?this.connectCallback&&(this.connectCallback(),this.connectCallback=null):(l.addInfo("\u4E1A\u52A1\u767B\u5F55"),this.busiLogin(function(){n.initSuccess&&n.initSuccess()},function(e){n.initFail&&n.initFail(e)}))},resolvePush:function(i){var e=i.head.cmd,t=i.head.append_cmd,n=i.body,o=this.getCmdConfig(e),a=o.eventId,s=o.bodyKey,l=o.dataKey,_=o.incremental,d=n&&s?n[s]:{};if(!("object"==("undefined"==typeof a?"undefined":O(a)))){var u;l&&(u=d[l]||d,_?this.mergeIncrementalData(l,u):t&&t.length?(this._handleNetData(l,d,i),this._handleAppendCmd(i,b)):this._handleNetData(l,d,i)),window.eventDispatcher&&window.EventID&&eventDispatcher.dispatchEvent(EventID[a],u)}else if("attr_ntf"==s){var L=d.attr||[],c=d.now_unix_timestamp||parseInt(new Date().getTime()/1e3);b.now_unix_timestamp=c;for(var p,m=0;p=L[m];m++){var f=p.type,E=a[f],y=l[f],h=p.value&&p.value[y];if(y){var g=b.item_list.item;if("item_list"==y&&g&&0<g.length){for(var T,R=0;T=h.item[R];R++)for(var S,C=0;S=g[C];C++)if(T.id==S.id){g[C]=T;break}}else if("diamond"==y){var A=h.count||[],I=this.getClientType(),N=A[1];102==I&&(N=A[0]),b[y]={count:N}}else b[y]=h}E&&window.eventDispatcher&&window.EventID&&eventDispatcher.dispatchEvent(EventID[E],h)}}},_handleNetData:function(a,e,t){var n=t.head.cmd;g.MC_RANK_REWARD_INFO_NTF.cmd==n?this._handleRankRewardInfoNtf(a,e,t):b[a]=e},_handleRankRewardInfoNtf:function(l,e,t){var n=b[l];if(null!=n){for(var i=!1,o=0,a=n.length;o<a;o++)if(n[o].rank_type==e.rank_type){this._handleAppendCmd(t,e),b[l][o]=e,i=!0;break}i||(this._handleAppendCmd(t,e),b[l].push(e))}else b[l]=[],b[l].push(e)},_handleAppendCmd:function(_,e){for(var t,a=_.head.append_cmd||[],n=0,i=a.length;n<i;n++)if(t=this.getCmdConfig(a[n]),null!=t){var o=t.bodyKey,d=t.dataKey||o;e[d]=_.body[o]}else console.log("getCmdConfig fail, cmd : "+a[n])},mergeIncrementalData:function(s,e){var t=b.stage_ntf.info_list,n=b.quest_info_ntf.quest_info_list;if("stage_ntf"==s&&t&&t.length){var i=e.info_list||[],o=i.length;console.log("new_info_list.length= "+o);for(var a,r,l=0;l<o;++l){r=i[l];var _=!1;for(var d in t)if(a=t[d],a&&a.map_id==r.map_id){var u=r.stage_info_arry,c=a.stage_info_arry;this._mergeStageInfo(u,c),a.star_reward_num=r.star_reward_num,_=!0;break}0==_&&t.push(r)}}else if("quest_info_ntf"==s&&n&&n.length){var i=e.quest_info_list||[],o=i.length;console.log("new_info_list.length= "+o);for(var p,r,l=0;l<o;++l){r=i[l];var _=!1;for(var d in n)if(p=n[d],p&&p.quest_source==r.quest_source&&p.element_id==r.element_id){n[d]=r,_=!0;break}0==_&&n.push(r)}}else b[s]=e},response:function(i){if(i&&(console.log(JSON.stringify(i)),i.tws_notify_type))return this.resolveTconndNotify(i);var e=this;if(i&&i.head){var t=null,n=null,o=i.head.cmd,a=i.head.append_cmd,l=i.head.ret,d=i.head.ret_desc,r=i.head.seq,s=i.body,p=this.getCmdConfig(o);if(!p)return;var c=p.bodyKey;if(1031==o)e.kickOff=!0,e.showAlert(d),e.alreadyInitLogin&&e.logout();else if(0==l&&p.push)this.resolvePush(i);else{e._clearTimeout(r),0==l?n=a&&a.length?s:s&&c?s[c]:{}:t={ret:l,ret_desc:d};var T=C.getCallbackObj(r);if(l==R.TOKEN_ERROR.code&&e.busiLogin(null,null,!1,0),T){var E=T.callback;if(E&&"function"==typeof E&&E(t,n),o==g.MC_HEARTBEAT_RES.cmd)return;T.stime||new Date().getTime(),c&&"string"==("undefined"==typeof c?"undefined":O(c)).toLowerCase()}}}},reconnectFun:function(i){this.openStime=new Date().getTime();var a=this,e=function(t){var e=t.head.seq;C.setStime(e,new Date().getTime()),a.netManager.send(t)};i.head.cmd==g.MC_LOGIN_REQ.cmd?l.addInfo("Login\u8BF7\u6C42\u4E0D\u5165\u91CD\u53D1\u961F\u5217"):this.reConnectCb.push(function(){a.netManager.connected&&e(i)}),this.netManager.connecting||this.loggingIn||(l.addInfo("\u91CD\u65B0\u5EFA\u7ACB\u8FDE\u63A5"),this.connectCallback=function(){l.addInfo("\u91CD\u65B0\u767B\u5F55"),a.loggingIn=!0,a.busiLogin(function(){for(a.loggingIn=!1,l.addInfo("\u53D1\u8BF7\u6C42");a.reConnectCb.length;){var t=a.reConnectCb.shift();t&&t()}},function(){a._clearReConnectCb()},!0)},this.netManager.open(function(){},function(){a._clearReConnectCb()},function(){a._clearReConnectCb()}))},_clearReConnectCb:function(){this.reConnectCb=[],this.loggingIn=!1},showAlert:function(i){var e="AlertTip";if(!document.getElementById(e)){var t=document.createElement("div");t.id=e,t.innerHTML="<div style=\"position:absolute; left:50%; top:50%; margin: -100px 0 0 -40%; z-index:9999; background:#fff; text-align:center; border-radius:5px; width: 60%; padding:5% 10%; font-size:16px;\"><p>"+i+"</p><div style=\"padding:10px; border-top:1px solid #e1e1e1\" onclick=\"javascript:document.body.removeChild(document.getElementById('AlertTip'));\">\u786E\u5B9A</div></div>",document.body.appendChild(t)}},busiLogin:function(d,m,e,t){var n=this;a.wxLogin(function(i){var a={from_openid:n.getShareOpenId()||"",code:i.code,nick:"",pic:""};b.user_info=b.user_info||{},b.user_info.headimgurl=a.pic,b.user_info.code=a.code,b.user_info.nick=a.nick,b.user_info.headimgurl=a.pic,new Date().getTime(),n.login(a,function(i,a){a?(l.addInfo("\u767B\u5F55\u6210\u529F"),b.user_info.openid=a.openid,b.now_unix_timestamp=a.now_unix_timestamp,b.last_flaunt_time=a.last_flaunt_time,b.last_sign_time=a.last_sign_time,b.month_sign_days=a.month_sign_days,b.oneyuan_buy_time=a.oneyuan_buy_time,b.entrance_guide_time=a.entrance_guide_time,s.needOpenidWhenLogin=!0,a.new_user_award_info&&(b.new_user_award_info=a.new_user_award_info),_.initAfterLogin(),d&&d(),n._setHeartbeat()):(t=t||0,t++,i&&i.ret==R.TOKEN_ERROR.code&&3>=t?(l.addInfo("token\u5931\u6548\u91CD\u65B0\u767B\u5F55"),l.addInfo("\u767B\u5F55\u5931\u8D25"),m&&m(i),n.busiLogin(d,m,e,t)):(l.addInfo("\u767B\u5F55\u5931\u8D25"),m&&m(i))),n.alreadyInitLogin=!0},e)},function(t){m&&m(t)})},_setHeartbeat:function(){var t=this;this._clearHeartbeatInter(),this.heartbeatInter=setInterval(function(){window.cc&&cc.game&&cc.game.isPaused()||t.heartbeat()},y.heart)},_clearHeartbeatInter:function(){clearInterval(this.heartbeatInter)},heartbeat:function(i,e){if(!e||!this.kickOff){var a={client_timestamp:parseInt(new Date().getTime()/1e3)};this.request(g.MC_HEARTBEAT_REQ.cmd,a,function(e,t){t&&t.server_timestamp&&(b.now_unix_timestamp=t.server_timestamp),i&&i(e,t)},!0)}},login:function(i,e,t){this.request(g.MC_LOGIN_REQ.cmd,i,e,t)},logout:function(){this._clearHeartbeatInter(),this.alreadyInitLogin=!1,window.BackLogin&&window.BackLogin.back&&window.BackLogin.back()},request:function(m,p,t,n,E){console.log("start request,cmd :"+m);var y=this,r=b.user_info,l=0<=d.indexOf(m);if(!s.onLine&&!n)return void(l?T.showNetworkNoRetryTip():T.showNetworkTip(function(){y.request(m,p,t,n,E)}));var f=C.generateSeq(t);return function(){E=E||f;var i=y.alreadyInitLogin?null:t;n||y._registerTimout({seq:f,retry:function(){y.request(m,p,t,n,E)},initLoginCb:i,isConsumeCmd:l});var T={head:{cmd:m,seq:f,openid:r.openid,logic_seq:E}},s=y.getCmdConfig(m),d=s.bodyKey;d&&(T.body={},T.body[d]=p),y.netManager.send(T),console.log("do send command "+m,T)}(),E}}},function(t){"use strict";var e={MAX_CODE:-100,MIN_CODE:-200,CONNECT_ERROR:{code:-101,desc:"Socket Error"},CONNECT_TIMEOUT:{code:-102,desc:"\u8FDE\u63A5\u5EFA\u7ACB\u8D85\u65F6"},LOGIN_TIMEOUT:{code:-103,desc:"\u767B\u5F55\u8D85\u65F6"},TOKEN_ERROR:{code:-1001}};window.ErrCodeConfig=e,t.exports=e},function(a,e,t){"use strict";var n=(t(64),t(65),{init:function(){},addClickNum:function(){},resetClickNum:function(){},addInfo:function(){},endOneInfo:function(){},show:function(){}});n.init(),window.LogPanel=n,a.exports=n},function(t){"use strict";var e={seq:parseInt(1e3*(9*Math.random())),callbackPool:{},generateSeq:function(t){return this.seq++,t&&(this.callbackPool[this.seq]={callback:t,stime:new Date().getTime()}),this.seq},getCallbackObj:function(n){var e=this.callbackPool[n];if(e)return delete this.callbackPool[n],e},setStime:function(i,e){var t=this.callbackPool[i];t&&(t.stime=e)}};t.exports=e},function(t){"use strict";var e=function(){var l=null,e={title:"\u8D85\u597D\u73A9\u7684\u6D88\u9664\u7C7B\u5C0F\u6E38\u620F\uFF0C\u4E0D\u7528\u4E0B\u8F7D\u5373\u53EF\u7545\u73A9\uFF01\u4E00\u8D77\u6765\u73A9\u5427\uFF01",imageUrl:window.remoteResPath+"res/shareimg2/default.png",query:"",success:function(n){console.log("\u8F6C\u53D1\u6210\u529F",n);var e=n.shareTickets[0];wx.getShareInfo({shareTicket:e,success:function(t){console.log("getShareInfo\u6210\u529F",t)}})},fail:function(t){console.log("\u8F6C\u53D1\u5931\u8D25",t)}};wx.showShareMenu(),wx.updateShareMenu({withShareTicket:!0}),wx.onShareAppMessage(function(){return{title:l?l.title:e.title,imageUrl:l?l.imageUrl:e.imageUrl,query:l?l.query:e.query,success:function(t){l?l.success&&l.success(t):e.success&&e.success(t)},fail:function(t){l?l.fail&&l.fail(t):e.fail&&e.fail(t)}}});return{wxLogin:function(n,i){wx.login({success:function(e){window.DEBUG&&console.log("wx.login success",e),n(e)},fail:function(t){console.log("wx.login fail",t),i(t)}})},wxGetUserInfo:function(n,i){wx.getUserInfo({withCredentials:!1,lang:"zh_CN",success:function(e){window.DEBUG&&console.log("wx.getUserInfo success",e),n(e)},fail:function(t){console.log("wx.getUserInfo fail",t),i(t)}})},setCustomShareData:function(e,t,a){l={title:e.title,imageUrl:e.imageUrl,query:e.query,success:t,fail:a}},clearCustomShareData:function(){l=null},customShare:function(t,n,_){t=l||e,n=l?l.success:e.success,_=l?l.fail:e.fail;var d=1<t.query.length?"&":"",a=[t.query,"shareOpenid="+NetData.user_info.openid].join(d);wx.shareAppMessage({title:t.title,imageUrl:t.imageUrl,query:a,getGroupMsgTicket:!0,success:n,fail:_})}}}();t.exports=e,window.XCXSDK=e},function(a,e,t){"use strict";var n=t(65),i=function(){function e(){wx.gameLoginReport({data:{gameVersion:1,roleName:n.user_info.nick,roleId:n.user_info.openid,userLevel:1,serverId:0,zoneId:0},success:function(t){console.log(t),console.log("gameLoginReport\u6210\u529F")},fail:function(t){console.log(t),console.log("gameLoginReport\u5931\u8D25")},complete:function(t){console.log(t),console.log("gameLoginReport\u5B8C\u6210")}})}function t(){wx.gameLogoutReport({data:{gameVersion:3,roleName:n.user_info.nick,roleId:n.user_info.openid,userLevel:10},success:function(t){console.log(t),console.log("gameLogoutReport\u6210\u529F")},fail:function(t){console.log(t),console.log("gameLogoutReport\u5931\u8D25")},complete:function(t){console.log(t),console.log("gameLogoutReport\u5B8C\u6210")}})}var i=!1;return{initAfterLogin:function(){i||(wx.onShow&&wx.onShow(function(){e()}),wx.onHide&&wx.onHide(function(){t()}),e(),i=!0)}}}();a.exports=i},function(t){"use strict";var s={noticeStartTime:0,updateStartTime:0,updateEndTime:0,noticeContent:"",updateContent:"",align:"left",onClose:null};window.noticeConfig={noticeStartTime:new Date("2017/03/22 10:00:00").getTime(),updateStartTime:new Date("2017/04/11 10:00:00").getTime(),updateEndTime:new Date("2017/12/12 10:00:00").getTime(),noticeContent:"\u672C\u8F6E\u6D4B\u8BD5\u5C06\u4E8E2017/05/12 10:00\u7ED3\u675F\uFF0C\u8C22\u8C22\u60A8\u7684\u652F\u6301\u3002",updateContent:"\u672C\u8F6E\u6D4B\u8BD5\u5DF2\u7ECF\u7ED3\u675F\uFF0C\u8C22\u8C22\u652F\u6301\uFF0C\u671F\u5F85\u4E0B\u6B21\u518D\u89C1\u3002\n\u6211\u4EEC\u5C06\u5728\u7B2C\u4E00\u65F6\u95F4\uFF0C\u5728\u5B98\u65B9\u6E20\u9053\u4E2D\u516C\u5E03\u6700\u65B0\u7684\u6E38\u620F\u52A8\u6001\uFF0C\u656C\u8BF7\u671F\u5F85\u3002"},window.noticeConfig&&Object.assign(s,window.noticeConfig);var m,e,i,n="",p=null,o=function(n){var i=new Date().getTime()-p.getTime();console.log("delay",i),"function"==typeof n&&n(null,i)},l=function(){e=!1,i=!1,m>s.noticeStartTime&&m<s.updateEndTime&&(e=!0,n=s.noticeContent||"",m>=s.updateStartTime&&(i=!0,n=s.updateContent||""))},_=function(){return l(),e?{content:n,isBlock:i,align:"left",onClose:function(){return"function"==typeof s.onClose?s.onClose():!!i}}:null};t.exports={init:function(n,e){p=e;var t={};t.noticeStartTime=new Date(n.noticeStartTime).getTime(),t.updateStartTime=new Date(n.updateStartTime).getTime(),t.updateEndTime=new Date(n.updateEndTime).getTime(),t.noticeContent=n.noticeContent,t.updateContent=n.updateContent,window.noticeConfig=t,window.noticeConfig&&Object.assign(s,window.noticeConfig),m=new Date().getTime()},getNotice:_,getNoticeByServerTime:function(a){o(function(o){m-=o;var t=_();"function"==typeof a&&t&&i&&a(t)})}}},function(l,e,t){"use strict";var _=t(82),n=null,i=null,a={init:function(){var i=this;window.addEventListener("message",function(e){if(/(\.qq\.com)$/.test(e.origin)){var t=e.data;i.parseMessage(t)}})},parseMessage:function(a){if(a&&"string"==typeof a){var o=a.split("::"),t=o[0],n=o[1];this[t]&&this[t](n)}},communicateInner:function(t){if(window.postMessage)try{document.getElementById("gameAppIframe").contentWindow.postMessage(t,"*")}catch(t){}},loadGame:function(n,e){this.enterFlag=2,this.matchId=e,PageResLoadingWindow.Show(),this._listenerList=[],Util.registerListener(this._listenerList,EventID.ON_NETWORK_TIP_WINDOW_CANCEL,function(){this._updateIFrameVisible(!1),Util.unRegisterListeners(this._listenerList),this._hidePageResLoading(),this.closeGame()}.bind(this)),Util.registerListener(this._listenerList,EventID.ON_NETWORK_TIP_WINDOW_RETRY,function(){this._updateIFrameVisible(!0),this._destroyIFrame(),this._createIFrame(n)}.bind(this)),Util.registerListener(this._listenerList,EventID.ON_NETWORK_TIP_WINDOW_SHOW,function(){this._updateIFrameVisible(!1)}.bind(this)),this._createIFrame(n),this.startGame()},_createIFrame:function(i){if(window.DEBUG){var e="debug="+window.DEBUG;i=i+"?"+e}else{var t=GetResVersion("dist/HpangApi.js");i=i+"?"+("api_version="+t),window.QUERY&&QUERY.cur_app_version&&(i+="&cur_version="+QUERY.cur_app_version)}i=i.replace(/alert|iframe|document\.write|onclick|onload/g,"");var n="<div id=\"gameAppContainer\" style=\"width:100%; height:100%; position: fixed; left:0; top:0; opacity:0; z-index:999;\">\n\t\t\t<iframe id=\"gameAppIframe\" src=\""+i+"\" frameborder=\"0\" width=\"100%\" height=\"100%\"></iframe>\n\t\t\t</div>",o=document.createElement("div");o.innerHTML=n,this.AppContainer=o.children[0],this.AppIframe=this.AppContainer.children[0],document.body.appendChild(this.AppContainer)},_updateIFrameVisible:function(n){if(null!=this.AppContainer){var e=!0===n?"block":"none";this.AppContainer.style.display=e}},_destroyIFrame:function(){null!=this.AppContainer&&(document.body.removeChild(this.AppContainer),this.AppContainer=null)},_addShowEvent:function(){var t=this;i=cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){t.isInGame()||setTimeout(function(){t.communicateInner("cc.game.pause")},0)})},_checkEnterStatus:function(){this.enterFlag--,0>=this.enterFlag&&(Util.unRegisterListeners(this._listenerList),this._hidePageResLoading(),cc.game.pause(),this.gameStatus=1,null!=this.AppContainer&&(this.AppContainer.style.opacity=1),this._addShowEvent())},_hidePageResLoading:function(){PageResLoadingWindow.Hide(),PageResLoadingWindow.hideLoadingTxt()},_onServerError:function(t){this._hidePageResLoading(),this.closeGame(),TipWindow.Show(t.ret_desc)},isInGame:function(){return this.gameStatus},getSoundState:function(a){var e=MusicManager.isMusicEnable(),l=MusicManager.isEffectEnable(),_=MusicManager.getMusicVolume(),d=MusicManager.getEffectsVolume();this.communicateInner(a+"::"+JSON.stringify({bMusicEnable:e,bEffectEnable:l,musicVolume:_,effectVolume:d}))},getLocalStoragePrefix:function(n){var e=Util.getBaseStorageKey();e+="_",this.communicateInner(n+"::"+e)},loadingProgress:function(t){PageResLoadingWindow.setLoadingTxt&&PageResLoadingWindow.setLoadingTxt(t)},getClearLocalStorageFlag:function(n){var e=StorageManager.getClearWeekMatchLocalStorageFlag(this.matchId);this.communicateInner(n+"::"+JSON.stringify(~~e))},hideLoading:function(){this._checkEnterStatus()},closeGame:function(){if(this.AppContainer){this._hidePageResLoading(),this.gameStatus=0;var t=this.AppIframe;t.src="about:blank";try{t.contentWindow.document.write(""),t.contentWindow.document.clear()}catch(t){}document.body.removeChild(this.AppContainer),this.AppIframe=null,this.AppContainer=null,cc.eventManager.removeListener(i),cc.game.resume(),eventDispatcher.dispatchEvent(EventID.ON_GAME_IN_IFRAME_CLOSE)}},hideGame:function(){this.gameStatus=0,this.communicateInner("cc.game.pause"),this.AppContainer.style.display="none",this.AppContainer.className="",cc.game.resume(),eventDispatcher.dispatchEvent(EventID.ON_GAME_IN_IFRAME_HIDE)},showGame:function(){cc.game.pause(),this.AppContainer.style.display="block",this.AppContainer.className="scale-in",this.gameStatus=1,this.communicateInner("cc.game.resume"),this.communicateInner("eventDispatcher.dispatchEvent::resume"),eventDispatcher.dispatchEvent(EventID.ON_GAME_IN_IFRAME_SHOW)},startGame:function(){var n=this,e=StorageManager.getWeekMatchGameState(this.matchId);return"run"==e?(Reporter.Beacon.onEvent(271,"Week_Match_play"),void this._checkEnterStatus()):void GameService.weekMatchStart({match_id:this.matchId},function(e){e?n._onServerError(e):(Reporter.Beacon.onEvent(271,"Week_Match_play"),n._checkEnterStatus())})},setGameState:function(t){try{t=JSON.parse(t),StorageManager.setWeekMatchGameState(this.matchId,t.gameState)}catch(t){}},showResult:function(n){var i=this;cc.game.resume(),MusicManager.pauseMusic(),setTimeout(function(){i.closeGame(),_.showResult({score:n,matchId:i.matchId}),MusicManager.playEffect(MusicEffectFiles.Audio_UI_stagewinscore),GameService.weekMatchReport({week_score:parseInt(n),match_id:i.matchId},function(t,e){t?i._onServerError(t):(_.resultAfterReport(e.week_score),eventDispatcher.dispatchEvent(EventID.WEEK_MATCH_SETTLEMENT_SUCCESS))})},100)},getCoinNum:function(t){this.communicateInner(t+"::"+NetData.money.count)},showExchangeWindow:function(){var e=this;this.hideGame(),ExchangeWindow.show({exchangeType:ExchangeWindow.Type.GOLD,buySuccessCallBack:function(){Reporter.Beacon.onEvent(273,"Week_Match_buy")}}),n=eventDispatcher.addListener(EventID.SHOW_MERGE_NTF,function(){eventDispatcher.removeListener(EventID.SHOW_MERGE_NTF,n),e.showGame(),setTimeout(function(){ExchangeWindow.destroy()},0)})},expendCoin:function(_){var m=this;try{_=JSON.parse(_);var p=parseInt(_.num),t=_.callback,e=_.coinUnEnoughCallBack,n=NetData.money.count;if(0>n-p)this.communicateInner(e),this.showExchangeWindow();else{var i=ConfigData.GoodsConf.list_data,a={price_pkg_list:[]},o=17,l={type:1,subtype:4,id:20,conf_id:o},d={code:0,data:{}};if(i.forEach(function(t){t.id==o&&(a=t)}),a.price_pkg_list.forEach(function(n,e){n.price==p&&(l.count=n.amount,l.conf_pkg_id=e+1)}),!l.count)return d.code=-1,d.data.errMsg="\u91D1\u5E01\u6570\u91CF\u4E0D\u5339\u914D",this.communicateInner(t+"::"+JSON.stringify(d));GameService.buyGoods(l,function(i){i?(d.code=i.ret,d.data.errMsg=i.ret_desc,m.communicateInner(t+"::"+JSON.stringify(d))):(d.data.coinNum=n-p,m.communicateInner(t+"::"+JSON.stringify(d)))},!0)}}catch(t){}},getConfigData:function(a){try{a=JSON.parse(a);var e=a.key,t=a.callback,n=e?ConfigData[e]:ConfigData;this.communicateInner(t+"::"+JSON.stringify(n))}catch(t){}}};a.init(),l.exports=a},function(a,e,t){"use strict";var n,i;a.exports={showResult:function(a){n=n||t(83),i=new n,WindowManager.GetInstance().showWindow(i,null,!1,GameCommonDef.LAYER_Z_ORDER_TIP_UI,!1,null,null),i.showScore(a)},resultAfterReport:function(t){i&&(i.showBtn(),i.showWeekScore(t),i=null)}}},function(t){"use strict";function _(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function n(n,i){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i&&("object"==typeof i||"function"==typeof i)?i:n}function i(n,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);n.prototype=Object.create(i&&i.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(n,i):n.__proto__=i)}var d,o=function(){function a(a,o){for(var t,i=0;i<o.length;i++)t=o[i],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),l=210,e=function(a){function r(){_(this,r);var t=n(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return t.initView(),t._listenerList=[],Util.registerListener(t._listenerList,EventID.ON_WINDOW_RESIZE,function(){t._onWindowResize()}),Util.registerListener(t._listenerList,EventID.ON_NETWORK_TIP_WINDOW_CANCEL,function(){t.destroy()}),t}return i(r,a),o(r,[{key:"initView",value:function(){var E=cc.winSize.width,e=cc.winSize.height,t=this.bgImage=UIHelper.createImage({imageFileName:res.lr_bg_jpg,position:UIHelper.getCenterPosition(),anchorPoint:cc.p(.5,.5)});this.addChild(t),UIHelper.adjustBgImage(t);var n=this.container=UIHelper.createPanel({position:cc.p(E/2,e/2),anchorPoint:cc.p(.5,.5),size:cc.size(E,e)});this.addChild(n);var i=this.effectWrapper=UIHelper.createPanel({position:UIHelper.getCenterPosition(),anchorPoint:cc.p(.5,.5)});n.addChild(i);var o=new Effect(res.miaowanresultcircle_json),a=new Effect(res.miaowanresultcloud_json),r=this.miaowanresultEffect=new Effect(res.miaowanresult_json);i.addChild(o),o.play(!0),i.addChild(a),a.play(!0),i.addChild(r),r.play(!1);var l=UIHelper.createImage({imageFileName:"result_tt_bg.png",bPlistTexture:!0,bScale9Enabled:!0,size:cc.size(178,41),capInsets:cc.rect(20,0,20,41),position:cc.p(E/2,e-250),anchorPoint:cc.p(.5,1)});n.addChild(l);var s=UIHelper.createImage({imageFileName:"merged_logo.png",bPlistTexture:!0,position:cc.p(89,20),anchorPoint:cc.p(.5,.5)});s.setName("logoTxt"),l.addChild(s);var _=this.loadingTxt=UIHelper.createText({fontSize:22,content:"\u6B63\u5728\u63D0\u4EA4\u6210\u7EE9...",position:cc.p(E/2,220),anchorPoint:cc.p(.5,0),fontColor:cc.color(153,153,153)});n.addChild(_);var d=this.bottomPanel=UIHelper.createPanel({position:cc.p(0,280),anchorPoint:cc.p(0,0)});d.setVisible(!1),n.addChild(d);var u=UIHelper.createButton({normalFile:"btn_sure.png",bPressedActionEnabled:!0,bPlistTexture:!0,position:cc.p(E/2-5,0),anchorPoint:cc.p(1,1),bTouchEnable:!0});u.addTouchEventListener(this._onSureButtonTouched,this),d.addChild(u);var c=UIHelper.createButton({normalFile:"round_btn_red_sure.png",bPressedActionEnabled:!0,bPlistTexture:!0,position:cc.p(E/2+5,0),anchorPoint:cc.p(0,1),bTouchEnable:!0}),p=UIHelper.createImage({imageFileName:"btn_title_share.png",bPlistTexture:!0,position:cc.p(144,40),anchorPoint:cc.p(.5,0)});c.addChild(p),c.addTouchEventListener(this._onShareButtonTouched,this),d.addChild(c)}},{key:"showScore",value:function(_){var e=null!=_&&null!=_.score?_.score:0,t=null!=_&&null!=_.matchId?_.matchId:-1;d=UIHelper.seekWidgetByName(this.miaowanresultEffect,"numberfill");var n=new cc.LabelBMFont(this._getFormatNum(e),res.number_brown_big_fnt);n.setAnchorPoint(cc.p(.5,0)),n.setPosition(l/2,70),d.addChild(n);var i="merged_logo.png";t===WeekMatchId.MERGED?i="merged_logo.png":t===WeekMatchId.HEX_CRUSH?i="hex_crush_logo.png":void 0;var o=UIHelper.seekWidgetByName(this,"logoTxt");o.loadTexture(i,ccui.Widget.PLIST_TEXTURE)}},{key:"showWeekScore",value:function(i){i=i||0,d=UIHelper.seekWidgetByName(this.miaowanresultEffect,"numberfill");var e=UIHelper.createText({fontSize:22,content:"\u672C\u5468\u6700\u9AD8\u5206: ",position:cc.p(l/2,40),anchorPoint:cc.p(1,0),fontColor:cc.color(109,76,1)});d.addChild(e);var t=new cc.LabelBMFont(this._getFormatNum(i),res.number_brown_small_fnt);t.setAnchorPoint(cc.p(0,0)),t.setPosition(l/2,29),d.addChild(t)}},{key:"showBtn",value:function(){this.loadingTxt.setVisible(!1),this.bottomPanel.setVisible(!0)}},{key:"destroy",value:function(t){WindowManager.GetInstance().destroyWindow(this),t||MusicManager.resumeMusic(),eventDispatcher.dispatchEvent(EventID.ON_WEEK_MATCH_RESULT_WINDOW_DESTROY)}},{key:"_onSureButtonTouched",value:function(n,e){ccui.Widget.TOUCH_ENDED==e&&(MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch),this.destroy())}},{key:"_onShareButtonTouched",value:function(a,e){if(ccui.Widget.TOUCH_ENDED==e){MusicManager.playEffect(MusicEffectFiles.Audio_UI_touch);var t=function(){},l=function(){TipWindow.Show(Language.getString(LanguageKey.SHARE_FAIL))},_=function(t){null==t&&Reporter.Beacon.onEvent(272,"Week_Match_share")};eventDispatcher.dispatchEvent(EventID.ON_SHARE_WEEK_MATCH,{customShareSuccessCallBack:t,customShareFailCallBack:l,weekMatchShareCallBack:_}),X8SDK.isWX()&&this.destroy()}}},{key:"_getFormatNum",value:function(t){return t.toString().replace(/\B(?=(\d{3})+$)/g,",")}},{key:"_onWindowResize",value:function(){this.container.setPosition(UIHelper.getCenterPosition()),UIHelper.adjustBgImage(this.bgImage)}}]),r}(WindowBase);t.exports=e},function(a,e,t){"use strict";var _=t(85);a.exports={_waitRetryCmdMap:{},_executingCmdMap:{},createCallBackMap:function(l,_,d,r,s,m){return{successCallBack:l,failCallBack:_,timeoutCallBack:d,sureRetryCallBack:r,cancelRetryCallBack:s,cancelCallBack:m}},doCmd:function(i,d,t,n,r){var s=_.getCmd({cmdId:i,bNeedExplicitRetry:n,bShowSingleButton:r});return this._addToCmdMap(s,this._executingCmdMap),s.setData(d,t),s.setDelegate(this),s.do(),s.getTag()},cancelCmd:function(n){var e=this._getCmdByTag(n,this._executingCmdMap);if(this._cancelCmd(e),null==e){var e=this._getCmdByTag(n,this._waitRetryCmdMap);this._cancelCmd(e)}},isNetworkOnLine:function(){return Network.onLine},_cancelCmd:function(t){null!=t&&(t.cancel(),_.recoveryCmd(t))},_getCmdByTag:function(l,e){for(var t in e){var n=e[t];if(null!=n&&0!=n.length)for(var i=0,o=n.length;i<o;i++)if(l==n[i].getTag())return n.splice(i,1)[0]}},_addToCmdMap:function(i,e){var t=i.getCmdId();e[t]=e[t]||[],e[t].push(i)},_removeFromCmdMap:function(l,e){var t=l.getCmdId(),n=e[t];if(null!=n&&0!=n.length)for(var i=0,o=n.length;i<o;i++)if(l==n[i])return void n.splice(i,1)},onCmdSuccess:function(t){this._removeFromCmdMap(t,this._executingCmdMap),_.recoveryCmd(t)},onCmdFail:function(t){this._removeFromCmdMap(t,this._executingCmdMap),_.recoveryCmd(t)},onCmdTimeout:function(n){if(this._removeFromCmdMap(n,this._executingCmdMap),n.isNeedExplicitRetry()){this._addToCmdMap(n,this._waitRetryCmdMap),console.log("show retry window");var e=n.getExplicitRetryType();1===e?NetworkRetryWindow.Show(Language.getString(LanguageKey.NET_ERROR),this.onCmdSureRetry.bind(this),this.onCmdCancelRetry.bind(this),n,n):2===e?NetworkRetryWindow.ShowSureButton(Language.getString(LanguageKey.NET_ERROR_2),this.onCmdCancelRetry.bind(this),n):console.log("unKnown explicit retry type : "+e)}},onCmdSureRetry:function(t){this._removeFromCmdMap(t,this._waitRetryCmdMap),this._addToCmdMap(t,this._executingCmdMap),t.onSureRetry()},onCmdCancelRetry:function(t){t.onCancelRetry(),this._removeFromCmdMap(t,this._waitRetryCmdMap),_.recoveryCmd(t)}}},function(a,e,t){"use strict";var o=t(86);a.exports={_finishCmdMap:{},_unFinishCmdMap:{},_cmdTag:0,getCmd:function(i){var e=i.cmdId,t=this._getFromCmdMap(e,this._finishCmdMap);return null==t&&(t=this._getFromCmdMap(e,this._unFinishCmdMap),null!=t&&(t.isFinish()?t.reset():0==t.getRequestCount()&&0==t.getResponseCount()?t.reset():t=null)),null==t&&(t=this._createCmd(i)),t},recoveryCmd:function(t){null!=t&&(t.isFinish()?(t.reset(),this._addToCmdMap(t,this._finishCmdMap)):this._addToCmdMap(t,this._unFinishCmdMap))},_addToCmdMap:function(i,e){if(null!=i){var t=i.getCmdId();e[t]=e[t]||[],e[t].push(i)}},_getFromCmdMap:function(a,e){var t=e[a];if(null!=t&&0!=t.length)for(var n=0,i=t.length;n<i;n++)if(t[n].getCmdId()==a)return t.splice(n,1)[0];return null},_createCmd:function(i){var e=this._createCmdConfig(i),t=new o(e);return t},_createCmdConfig:function(n){var e=n.bShowSingleButton?2:1;return n.bSilenceRetry=!1,n.silenceRetryCount=0,{cmdId:n.cmdId,timeout:15e3,bNeedExplicitRetry:n.bNeedExplicitRetry,explicitRetryType:e}}}},function(l,e,t){"use strict";function _(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function(){function a(a,o){for(var t,i=0;i<o.length;i++)t=o[i],t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(a,t.key,t)}return function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}}(),i=t(74),a=function(){function a(e,t){_(this,a),this._tag=t,this._cmdConfig=e,this._extendCallBackData={tag:t,cmdId:this.getCmdId()},this.reset()}return n(a,[{key:"_checkDisEnableTimeout",value:function(){this._requestCount==this._responseCount?this._bFinish=!0:(this._clearDisEnableTimeout(),this._startDisEnableTimeout())}},{key:"_success",value:function(t){this._checkDisEnableTimeout(),"function"==typeof this._callbackMap.successCallBack&&this._callbackMap.successCallBack(t,this._extendCallBackData),this._delegate.onCmdSuccess(this)}},{key:"_fail",value:function(t){this._checkDisEnableTimeout(),"function"==typeof this._callbackMap.failCallBack&&this._callbackMap.failCallBack(t,this._extendCallBackData),this._delegate.onCmdFail(this)}},{key:"_timeout",value:function(){this._cmdConfig.bSilenceRetry&&this._silenceRetryCount<this._cmdConfig.silenceRetryCount?(this._silenceRetryCount++,console.log("silence("+this.getCmdId()+")redo("+this._silenceRetryCount+")"),this.do()):("function"==typeof this._callbackMap.timeoutCallBack&&this._callbackMap.timeoutCallBack(this._extendCallBackData),this._bHold=this.isNeedExplicitRetry(),this._delegate.onCmdTimeout(this))}},{key:"_startRequestTimeout",value:function(){var t=this._cmdConfig.timeout||3e4;this._timeoutHandle=setTimeout(function(){this._timeoutHandle=null,this._timeout()}.bind(this),t)}},{key:"_clearRequestTimeout",value:function(){clearTimeout(this._timeoutHandle),this._timeoutHandle=null}},{key:"_startDisEnableTimeout",value:function(){this._checkDisEnableTimeoutHandle=setTimeout(function(){this._checkDisEnableTimeoutHandle=null,this._bFinish=!0}.bind(this),6e4)}},{key:"_clearDisEnableTimeout",value:function(){clearTimeout(this._checkDisEnableTimeoutHandle),this._checkDisEnableTimeoutHandle=null}},{key:"_handleResponse",value:function(){return this._bHold?void console.log("\u8BF7\u6C42\u54CD\u5E94\uFF0C\u4F46\u662F\u91CD\u8BD5\u5F39\u7A97\u5DF2\u7ECF\u5F39\u51FA\uFF0C\u4E0D\u505A\u5904\u7406"):this._bCancelRetry?void console.log("\u8BF7\u6C42\u54CD\u5E94\uFF0C\u4F46\u662F\u5DF2\u7ECF\u70B9\u4E86\u91CD\u8BD5\u5F39\u7A97\u4E2D\u7684\u53D6\u6D88\uFF0C\u4E0D\u505A\u5904\u7406"):this._bHandleResponse?void console.log("\u8BF7\u6C42\u54CD\u5E94\uFF0C\u4F46\u662F\u5DF2\u7ECF\u5904\u7406\u8FC7\u54CD\u5E94\uFF0C\u4E0D\u505A\u5904\u7406"):this._bCancel?void console.log("\u8BF7\u6C42\u54CD\u5E94\uFF0C\u4F46\u662F\u5DF2\u7ECF\u53D6\u6D88\u6267\u884C\uFF0C\u4E0D\u505A\u5904\u7406"):(this._bHandleResponse=!0,void(null==this._response?this._fail(this._error):this._success(this._response)))}},{key:"getTag",value:function(){return this._tag}},{key:"setDelegate",value:function(t){this._delegate=t}},{key:"setData",value:function(n,e){this._data=n,this._callbackMap=e}},{key:"getCmdId",value:function(){return this._cmdConfig.cmdId}},{key:"isNeedExplicitRetry",value:function(){return this._cmdConfig.bNeedExplicitRetry}},{key:"getExplicitRetryType",value:function(){return this._cmdConfig.explicitRetryType}},{key:"do",value:function(){return console.log("cmd("+this.getCmdId()+")do"),this._delegate.isNetworkOnLine()?(this._requestCount++,this._clearRequestTimeout(),this._startRequestTimeout(),void(this._logicSeq=i.request(this._cmdConfig.cmdId,this._data,function(n,e){this.response(e,n)}.bind(this),!0,this._logicSeq))):void this._timeout()}},{key:"cancel",value:function(){this._clearRequestTimeout(),this._bCancel=!0,"function"==typeof this._callbackMap.cancelCallBack&&this._callbackMap.cancelCallBack(this._extendCallBackData)}},{key:"response",value:function(n,e){this._clearRequestTimeout(),this._responseCount++,this._bFinish=this._requestCount==this._responseCount,this._response=n,this._error=e,this._bResponsed=!0,this._handleResponse()}},{key:"getRequestCount",value:function(){return this._requestCount}},{key:"getResponseCount",value:function(){return this._responseCount}},{key:"reset",value:function(){this._clearRequestTimeout(),this._clearDisEnableTimeout(),this._data=null,this._callbackMap=null,this._response=null,this._error=null,this._delegate=null,this._bFinish=!1,this._bResponsed=!1,this._bHandleResponse=!1,this._bHold=!1,this._bCancelRetry=!1,this._bCancel=!1,this._silenceRetryCount=0,this._requestCount=0,this._responseCount=0,this._logicSeq=null}},{key:"isFinish",value:function(){return this._bFinish}},{key:"onSureRetry",value:function(){"function"==typeof this._callbackMap.sureRetryCallBack&&this._callbackMap.sureRetryCallBack(this._extendCallBackData),this._bHold=!1,this._bResponsed?this._handleResponse():this.do()}},{key:"onCancelRetry",value:function(){this._bHold=!1,this._bCancelRetry=!0,"function"==typeof this._callbackMap.cancelRetryCallBack&&this._callbackMap.cancelRetryCallBack(this._extendCallBackData)}}]),a}();l.exports=a},function(_,e,t){"use strict";var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p=t(65),n=t(64),a=(t(74),t(78)),r={log:"log",info:"info",debug:"debug",warn:"warn",error:"error"},i=function(){var l=(window.console,function(t){wx.showModal({title:"",content:t,showCancel:!1})}),i={log:[],info:[],debug:[],warn:[],error:[]},e=function(i){for(var e="",a=0;a<i.length;a++)e+="object"===d(i[a])?JSON.stringify(i[a]):i[a];return{time:Date.now(),log:e}},t=function(){i.log.push(e(arguments))},o=function(){i.info.push(e(arguments))},_=function(){i.warn.push(e(arguments))},s=function(){i.error.push(e(arguments))},u=function(t){return(10>t?"0":"")+t},c=function(n){var e=new Date(n);return e.getFullYear()+"-"+u(e.getMonth()+1)+"-"+u(e.getDate())+" "+u(e.getHours())+":"+u(e.getMinutes())+":"+u(e.getSeconds())},m=function(a,i,o){console.log("wx.env.USER_DATA_PATH = ",wx.env.USER_DATA_PATH),wx.getFileSystemManager().readdir({dirPath:a,success:function(t){i&&i(t)},fail:function(t){t.errMsg&&0<=t.errMsg.indexOf("no such file or directory")||t.errMsg.indexOf("not a directory")?(console.log("dirPath "+a+" not exists try to mkDir"),wx.getFileSystemManager().mkdir({dirPath:a,success:function(e){console.log("mkdir dirPath "+a+" success"),i&&i(e)},fail:function(e){console.log("mkdir dirPath "+a+" failed",e),o&&o(e)}})):(console.log("readdir failed ",t),o&&o(t))}})},f=function(t,e,n){for(var E=[],a=0;a<t.length;a++)E=E.concat(i[t[a]]);E.sort(function(n,e){return void 0===n||void 0===e?0:n.time-e.time});var _=p.user_info.openid+"_"+p.user_info.nick;p.user_info.openid||p.user_info.nick||(_="notLogined"),_.replace(/(-)|(\*)|(\/)|(\\)|(:)|(\?)|(<)|(>)|(→)|(")/g,"");var l=wx.env.USER_DATA_PATH+"/log/";m(l,function(){for(var t,n="",i=0,a=[],o=0;o<E.length;o++)if(t=E[o],n+=c(t.time)+" "+t.log+"\n",!(n.length<716800&&o!=E.length-1)){var d=l+_+(0==i?"":"_"+i);console.log("writing file : ",d),wx.getFileSystemManager().writeFileSync(d,n+"","utf8"),a.push(d),i+=1,n=""}e&&e({files:a})},function(t){console.log("createFolderWhenNotExists failed",t),n&&n(t)})},E=function(o,l){var t=o.split("/"),_=t[t.length-1];console.log("start uploadFile : ",o),a.wxLogin(function(t){wx.uploadFile({url:"https://social.qq.com/games_test/log/upload?name="+encodeURIComponent(_)+"&code="+encodeURIComponent(t.code),filePath:o,name:"data",formData:{name:_},success:function(e){console.log("upload file success : ",o,",",e),l(200===e.statusCode?{statusCode:e.statusCode,message:["\u53D1\u9001\u65E5\u5FD7\u6210\u529F","\u672C\u5730\u6587\u4EF6\u540D:"+_].join(" ")}:{statusCode:e.statusCode,message:["\u53D1\u9001\u65E5\u5FD7\u5931\u8D25","\u672C\u5730\u6587\u4EF6\u540D:",_,",",e.statusCode,",",e.errMsg].join(" ")}),wx.getFileSystemManager().unlinkSync(o)},fail:function(e){console.log("upload file failed : ",o,",",e),l({statusCode:e.statusCode,message:["\u53D1\u9001\u65E5\u5FD7\u5931\u8D25","\u672C\u5730\u6587\u4EF6\u540D:",_,",",e.statusCode,",",e.errMsg].join(" ")}),wx.getFileSystemManager().unlinkSync(o)}})},function(t){l({statusCode:-999,message:"\u83B7\u53D6\u5FAE\u4FE1code\u5931\u8D25 "+t.errMsg})})},y=function(a,e){function t(){return 0===n?(e&&e(i),console.log("upload log file complete"),console.log("need reconnect because upload log file has call wx.login"),void wx.closeSocket({code:-999,reason:"close by upload log file",success:function(t){console.log("close socket success",t)},fail:function(t){console.log("close socket fail",t)}})):void E(a[a.length-n],function(a){n-=1,i.push(a),t()})}var n=a.length,i=[];t()},T=function(e,t,_,i){f(t,function(t){if(t&&t.files){if(0==t.files.length)return void(e||(l("\u6CA1\u6709\u53EF\u5199\u7684\u65E5\u5FD7\uFF0C\u662F\u5426Log\u6A21\u5757\u88AB\u6CE8\u91CA\u4E86\uFF1F"),i&&i({errMsg:"log widget is disable"})));y(t.files,function(t){for(var n=1<t.length?"\u4E00\u5171\u4E0A\u4F20\u4E86"+t.length+"\u4E2A\u65E5\u5FD7\u6587\u4EF6;\n":"",i=0;i<t.length;i++)n+=t[i].message+"\n";e||l(n),_&&_(t)})}else e||l("\u4FDD\u5B58\u5931\u8D25 filePath \u4E3A\u7A7A"),i&&i(t)},function(t){e||l("\u4FDD\u5B58\u5931\u8D25 "+t.errMsg),i&&i(t)})};return{init:function(){n.isDevTool()?console.log("Log Widget init skipped because in DevTools"):(console.log=t,console.info=o,console.warn=_,console.error=s,console.log("Log Widget has bean inited"));var i=wx.getSystemInfoSync();console.log("wx.systemInfo:",i)},uploadLog:T,uploadAllLog:function(n,e){T(!1,[r.log,r.info,r.debug,r.warn,r.error],n,e)},silenceUploadAllLog:function(l,_,e){var t="silence_upload_file_timestamp_"+l,n=wx.getStorageSync(t),i=new Date().getTime();n&&864e5>i-n||T(!0,[r.log,r.info,r.debug,r.warn,r.error],function(n){wx.setStorageSync(t,i),_&&_(n)},e)}}}();_.exports=i}])})})(); 
 			});
 		define("bytebuffer.js", function(require, module, exports){ 			
(function(){(function(a,b){if("function"==typeof define&&define.amd)define(["long"],b);else if("function"==typeof require&&"object"==typeof module&&module&&module.exports){var c,d=module;try{c=require("long")}catch(a){}c=b(c),d.exports=c}else(a.dcodeIO=a.dcodeIO||{}).ByteBuffer=b(a.dcodeIO.Long)})(this,function(i){function j(c){var a=0;return function(){return a<c.length?c.charCodeAt(a++):null}}function l(){var c=[],a=[];return function(){return 0===arguments.length?a.join("")+d.apply(String,c):void(1024<c.length+arguments.length&&(a.push(d.apply(String,c)),c.length=0),Array.prototype.push.apply(c,arguments))}}function c(i,a,b,c,d){var f=8*d-c-1;var j=(1<<f)-1,g=j>>1,e=-7;d=b?d-1:0;var l=b?-1:1,k=i[a+d];for(d+=l,b=k&(1<<-e)-1,k>>=-e,e+=f;0<e;b=256*b+i[a+d],d+=l,e-=8);for(f=b&(1<<-e)-1,b>>=-e,e+=c;0<e;f=256*f+i[a+d],d+=l,e-=8);if(0===b)b=1-g;else{if(b===j)return f?NaN:Infinity*(k?-1:1);f+=o(2,c),b-=g}return(k?-1:1)*f*o(2,b-c)}function f(i,a,b,c,j,f){var l,g=8*f-j-1,e=(1<<g)-1,h=e>>1,k=23===j?5.960464477539063e-8-6.617444900424222e-24:0;f=c?0:f-1;var p=c?1:-1,m=0>a||0===a&&0>1/a?1:0;for(a=Math.abs(a),isNaN(a)||Infinity===a?(a=isNaN(a)?1:0,c=e):(c=Math.floor(Math.log(a)/Math.LN2),1>a*(l=o(2,-c))&&(c--,l*=2),a=1<=c+h?a+k/l:a+k*o(2,1-h),2<=a*l&&(c++,l/=2),c+h>=e?(a=0,c=e):1<=c+h?(a=(a*l-1)*o(2,j),c+=h):(a=a*o(2,h-1)*o(2,j),c=0));8<=j;i[b+f]=255&a,f+=p,a/=256,j-=8);for(c=c<<j|a,g+=j;0<g;i[b+f]=255&c,f+=p,c/=256,g-=8);i[b+f-p]|=128*m}var k=String.fromCharCode,o=Math.pow,r=function(d,f,g){if("undefined"==typeof d&&(d=r.DEFAULT_CAPACITY),"undefined"==typeof f&&(f=r.DEFAULT_ENDIAN),"undefined"==typeof g&&(g=r.DEFAULT_NOASSERT),!g){if(d|=0,0>d)throw RangeError("Illegal capacity");f=!!f,g=!!g}this.buffer=0===d?e:new ArrayBuffer(d),this.view=0===d?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=d,this.littleEndian=f,this.noAssert=g};r.VERSION="5.0.1",r.LITTLE_ENDIAN=!0,r.BIG_ENDIAN=!1,r.DEFAULT_CAPACITY=16,r.DEFAULT_ENDIAN=r.BIG_ENDIAN,r.DEFAULT_NOASSERT=!1,r.Long=i||null;var g=r.prototype;Object.defineProperty(g,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1});var e=new ArrayBuffer(0),d=k;r.accessor=function(){return Uint8Array},r.allocate=function(d,a,b){return new r(d,a,b)},r.concat=function(h,a,i,c){("boolean"==typeof a||"string"!=typeof a)&&(c=i,i=a,a=void 0);for(var d,e=0,f=0,j=h.length;f<j;++f)r.isByteBuffer(h[f])||(h[f]=r.wrap(h[f],a)),d=h[f].limit-h[f].offset,0<d&&(e+=d);if(0==e)return new r(0,i,c);for(a=new r(e,i,c),f=0;f<j;)i=h[f++],d=i.limit-i.offset,0>=d||(a.view.set(i.view.subarray(i.offset,i.limit),a.offset),a.offset+=d);return a.limit=a.offset,a.offset=0,a},r.isByteBuffer=function(b){return!0===(b&&b.__isByteBuffer__)},r.type=function(){return ArrayBuffer},r.wrap=function(e,f,h,c){if("string"!=typeof f&&(c=h,h=f,f=void 0),"string"==typeof e)switch("undefined"==typeof f&&(f="utf8"),f){case"base64":return r.fromBase64(e,h);case"hex":return r.fromHex(e,h);case"binary":return r.fromBinary(e,h);case"utf8":return r.fromUTF8(e,h);case"debug":return r.fromDebug(e,h);default:throw Error("Unsupported encoding: "+f);}if(null===e||"object"!=typeof e)throw TypeError("Illegal buffer");if(r.isByteBuffer(e))return f=g.clone.call(e),f.markedOffset=-1,f;if(e instanceof Uint8Array)f=new r(0,h,c),0<e.length&&(f.buffer=e.buffer,f.offset=e.byteOffset,f.limit=e.byteOffset+e.byteLength,f.view=new Uint8Array(e.buffer));else if(e instanceof ArrayBuffer)f=new r(0,h,c),0<e.byteLength&&(f.buffer=e,f.offset=0,f.limit=e.byteLength,f.view=0<e.byteLength?new Uint8Array(e):null);else if("[object Array]"===Object.prototype.toString.call(e))for(f=new r(e.length,h,c),f.limit=e.length,h=0;h<e.length;++h)f.view[h]=e[h];else throw TypeError("Illegal buffer");return f},g.writeBitSet=function(i,a){var j="undefined"==typeof a;if(j&&(a=this.offset),!this.noAssert){if(!(i instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof a||0!=a%1)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,0>a||a+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+0) <= "+this.buffer.byteLength)}var c,h=a,d=i.length,f=d>>3,e=0;for(a+=this.writeVarint32(d,a);f--;)c=1&!!i[e++]|(1&!!i[e++])<<1|(1&!!i[e++])<<2|(1&!!i[e++])<<3|(1&!!i[e++])<<4|(1&!!i[e++])<<5|(1&!!i[e++])<<6|(1&!!i[e++])<<7,this.writeByte(c,a++);if(e<d){for(c=f=0;e<d;)c|=(1&!!i[e++])<<f++;this.writeByte(c,a++)}return j?(this.offset=a,this):a-h},g.readBitSet=function(h){var i="undefined"==typeof h;i&&(h=this.offset);var b=this.readVarint32(h),c=b.value,d=c>>3,f=0,e=[];for(h+=b.length;d--;)b=this.readByte(h++),e[f++]=!!(1&b),e[f++]=!!(2&b),e[f++]=!!(4&b),e[f++]=!!(8&b),e[f++]=!!(16&b),e[f++]=!!(32&b),e[f++]=!!(64&b),e[f++]=!!(128&b);if(f<c)for(d=0,b=this.readByte(h++);f<c;)e[f++]=!!(1&b>>d++);return i&&(this.offset=h),e},g.readBytes=function(e,a){var f="undefined"==typeof a;if(f&&(a=this.offset),!this.noAssert){if("number"!=typeof a||0!=a%1)throw TypeError("Illegal offset: "+a+" (not an integer)");if(a>>>=0,0>a||a+e>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+"+e+") <= "+this.buffer.byteLength)}var c=this.slice(a,a+e);return f&&(this.offset+=e),c},g.writeBytes=g.append,g.writeInt8=function(e,f){var g="undefined"==typeof f;if(g&&(f=this.offset),!this.noAssert){if("number"!=typeof e||0!=e%1)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof f||0!=f%1)throw TypeError("Illegal offset: "+f+" (not an integer)");if(f>>>=0,0>f||f+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+f+" (+0) <= "+this.buffer.byteLength)}f+=1;var c=this.buffer.byteLength;return f>c&&this.resize((c*=2)>f?c:f),this.view[f-1]=e,g&&(this.offset+=1),this},g.writeByte=g.writeInt8,g.readInt8=function(c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"!=typeof c||0!=c%1)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,0>c||c+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+1) <= "+this.buffer.byteLength)}return c=this.view[c],128==(128&c)&&(c=-(255-c+1)),d&&(this.offset+=1),c},g.readByte=g.readInt8,g.writeUint8=function(e,f){var g="undefined"==typeof f;if(g&&(f=this.offset),!this.noAssert){if("number"!=typeof e||0!=e%1)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof f||0!=f%1)throw TypeError("Illegal offset: "+f+" (not an integer)");if(f>>>=0,0>f||f+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+f+" (+0) <= "+this.buffer.byteLength)}f+=1;var c=this.buffer.byteLength;return f>c&&this.resize((c*=2)>f?c:f),this.view[f-1]=e,g&&(this.offset+=1),this},g.writeUInt8=g.writeUint8,g.readUint8=function(c){var d="undefined"==typeof c;if(d&&(c=this.offset),!this.noAssert){if("number"!=typeof c||0!=c%1)throw TypeError("Illegal offset: "+c+" (not an integer)");if(c>>>=0,0>c||c+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+1) <= "+this.buffer.byteLength)}return c=this.view[c],d&&(this.offset+=1),c},g.readUInt8=g.readUint8,g.writeInt16=function(e,f){var g="undefined"==typeof f;if(g&&(f=this.offset),!this.noAssert){if("number"!=typeof e||0!=e%1)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof f||0!=f%1)throw TypeError("Illegal offset: "+f+" (not an integer)");if(f>>>=0,0>f||f+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+f+" (+0) <= "+this.buffer.byteLength)}f+=2;var c=this.buffer.byteLength;return f>c&&this.resize((c*=2)>f?c:f),f-=2,this.littleEndian?(this.view[f+1]=(65280&e)>>>8,this.view[f]=255&e):(this.view[f]=(65280&e)>>>8,this.view[f+1]=255&e),g&&(this.offset+=2),this},g.writeShort=g.writeInt16,g.readInt16=function(d){var e="undefined"==typeof d;if(e&&(d=this.offset),!this.noAssert){if("number"!=typeof d||0!=d%1)throw TypeError("Illegal offset: "+d+" (not an integer)");if(d>>>=0,0>d||d+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+d+" (+2) <= "+this.buffer.byteLength)}var b=0;return this.littleEndian?(b=this.view[d],b|=this.view[d+1]<<8):(b=this.view[d]<<8,b|=this.view[d+1]),32768==(32768&b)&&(b=-(65535-b+1)),e&&(this.offset+=2),b},g.readShort=g.readInt16,g.writeUint16=function(e,f){var g="undefined"==typeof f;if(g&&(f=this.offset),!this.noAssert){if("number"!=typeof e||0!=e%1)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof f||0!=f%1)throw TypeError("Illegal offset: "+f+" (not an integer)");if(f>>>=0,0>f||f+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+f+" (+0) <= "+this.buffer.byteLength)}f+=2;var c=this.buffer.byteLength;return f>c&&this.resize((c*=2)>f?c:f),f-=2,this.littleEndian?(this.view[f+1]=(65280&e)>>>8,this.view[f]=255&e):(this.view[f]=(65280&e)>>>8,this.view[f+1]=255&e),g&&(this.offset+=2),this},g.writeUInt16=g.writeUint16,g.readUint16=function(d){var e="undefined"==typeof d;if(e&&(d=this.offset),!this.noAssert){if("number"!=typeof d||0!=d%1)throw TypeError("Illegal offset: "+d+" (not an integer)");if(d>>>=0,0>d||d+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+d+" (+2) <= "+this.buffer.byteLength)}var b=0;return this.littleEndian?(b=this.view[d],b|=this.view[d+1]<<8):(b=this.view[d]<<8,b|=this.view[d+1]),e&&(this.offset+=2),b},g.readUInt16=g.readUint16,g.writeInt32=function(e,f){var g="undefined"==typeof f;if(g&&(f=this.offset),!this.noAssert){if("number"!=typeof e||0!=e%1)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof f||0!=f%1)throw TypeError("Illegal offset: "+f+" (not an integer)");if(f>>>=0,0>f||f+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+f+" (+0) <= "+this.buffer.byteLength)}f+=4;var c=this.buffer.byteLength;return f>c&&this.resize((c*=2)>f?c:f),f-=4,this.littleEndian?(this.view[f+3]=255&e>>>24,this.view[f+2]=255&e>>>16,this.view[f+1]=255&e>>>8,this.view[f]=255&e):(this.view[f]=255&e>>>24,this.view[f+1]=255&e>>>16,this.view[f+2]=255&e>>>8,this.view[f+3]=255&e),g&&(this.offset+=4),this},g.writeInt=g.writeInt32,g.readInt32=function(d){var e="undefined"==typeof d;if(e&&(d=this.offset),!this.noAssert){if("number"!=typeof d||0!=d%1)throw TypeError("Illegal offset: "+d+" (not an integer)");if(d>>>=0,0>d||d+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+d+" (+4) <= "+this.buffer.byteLength)}var b=0;return this.littleEndian?(b=this.view[d+2]<<16,b|=this.view[d+1]<<8,b|=this.view[d],b+=this.view[d+3]<<24>>>0):(b=this.view[d+1]<<16,b|=this.view[d+2]<<8,b|=this.view[d+3],b+=this.view[d]<<24>>>0),e&&(this.offset+=4),0|b},g.readInt=g.readInt32,g.writeUint32=function(e,f){var g="undefined"==typeof f;if(g&&(f=this.offset),!this.noAssert){if("number"!=typeof e||0!=e%1)throw TypeError("Illegal value: "+e+" (not an integer)");if(e>>>=0,"number"!=typeof f||0!=f%1)throw TypeError("Illegal offset: "+f+" (not an integer)");if(f>>>=0,0>f||f+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+f+" (+0) <= "+this.buffer.byteLength)}f+=4;var c=this.buffer.byteLength;return f>c&&this.resize((c*=2)>f?c:f),f-=4,this.littleEndian?(this.view[f+3]=255&e>>>24,this.view[f+2]=255&e>>>16,this.view[f+1]=255&e>>>8,this.view[f]=255&e):(this.view[f]=255&e>>>24,this.view[f+1]=255&e>>>16,this.view[f+2]=255&e>>>8,this.view[f+3]=255&e),g&&(this.offset+=4),this},g.writeUInt32=g.writeUint32,g.readUint32=function(d){var e="undefined"==typeof d;if(e&&(d=this.offset),!this.noAssert){if("number"!=typeof d||0!=d%1)throw TypeError("Illegal offset: "+d+" (not an integer)");if(d>>>=0,0>d||d+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+d+" (+4) <= "+this.buffer.byteLength)}var b=0;return this.littleEndian?(b=this.view[d+2]<<16,b|=this.view[d+1]<<8,b|=this.view[d],b+=this.view[d+3]<<24>>>0):(b=this.view[d+1]<<16,b|=this.view[d+2]<<8,b|=this.view[d+3],b+=this.view[d]<<24>>>0),e&&(this.offset+=4),b},g.readUInt32=g.readUint32,i&&(g.writeInt64=function(e,g){var h="undefined"==typeof g;if(h&&(g=this.offset),!this.noAssert){if("number"==typeof e)e=i.fromNumber(e);else if("string"==typeof e)e=i.fromString(e);else if(!(e&&e instanceof i))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof g||0!=g%1)throw TypeError("Illegal offset: "+g+" (not an integer)");if(g>>>=0,0>g||g+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+g+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=i.fromNumber(e):"string"==typeof e&&(e=i.fromString(e)),g+=8;var c=this.buffer.byteLength;g>c&&this.resize((c*=2)>g?c:g),g-=8;var c=e.low,d=e.high;return this.littleEndian?(this.view[g+3]=255&c>>>24,this.view[g+2]=255&c>>>16,this.view[g+1]=255&c>>>8,this.view[g]=255&c,g+=4,this.view[g+3]=255&d>>>24,this.view[g+2]=255&d>>>16,this.view[g+1]=255&d>>>8,this.view[g]=255&d):(this.view[g]=255&d>>>24,this.view[g+1]=255&d>>>16,this.view[g+2]=255&d>>>8,this.view[g+3]=255&d,g+=4,this.view[g]=255&c>>>24,this.view[g+1]=255&c>>>16,this.view[g+2]=255&c>>>8,this.view[g+3]=255&c),h&&(this.offset+=8),this},g.writeLong=g.writeInt64,g.readInt64=function(e){var f="undefined"==typeof e;if(f&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!=e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var b=0,c=0;return this.littleEndian?(b=this.view[e+2]<<16,b|=this.view[e+1]<<8,b|=this.view[e],b+=this.view[e+3]<<24>>>0,e+=4,c=this.view[e+2]<<16,c|=this.view[e+1]<<8,c|=this.view[e],c+=this.view[e+3]<<24>>>0):(c=this.view[e+1]<<16,c|=this.view[e+2]<<8,c|=this.view[e+3],c+=this.view[e]<<24>>>0,e+=4,b=this.view[e+1]<<16,b|=this.view[e+2]<<8,b|=this.view[e+3],b+=this.view[e]<<24>>>0),e=new i(b,c,!1),f&&(this.offset+=8),e},g.readLong=g.readInt64,g.writeUint64=function(e,g){var h="undefined"==typeof g;if(h&&(g=this.offset),!this.noAssert){if("number"==typeof e)e=i.fromNumber(e);else if("string"==typeof e)e=i.fromString(e);else if(!(e&&e instanceof i))throw TypeError("Illegal value: "+e+" (not an integer or Long)");if("number"!=typeof g||0!=g%1)throw TypeError("Illegal offset: "+g+" (not an integer)");if(g>>>=0,0>g||g+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+g+" (+0) <= "+this.buffer.byteLength)}"number"==typeof e?e=i.fromNumber(e):"string"==typeof e&&(e=i.fromString(e)),g+=8;var c=this.buffer.byteLength;g>c&&this.resize((c*=2)>g?c:g),g-=8;var c=e.low,d=e.high;return this.littleEndian?(this.view[g+3]=255&c>>>24,this.view[g+2]=255&c>>>16,this.view[g+1]=255&c>>>8,this.view[g]=255&c,g+=4,this.view[g+3]=255&d>>>24,this.view[g+2]=255&d>>>16,this.view[g+1]=255&d>>>8,this.view[g]=255&d):(this.view[g]=255&d>>>24,this.view[g+1]=255&d>>>16,this.view[g+2]=255&d>>>8,this.view[g+3]=255&d,g+=4,this.view[g]=255&c>>>24,this.view[g+1]=255&c>>>16,this.view[g+2]=255&c>>>8,this.view[g+3]=255&c),h&&(this.offset+=8),this},g.writeUInt64=g.writeUint64,g.readUint64=function(e){var f="undefined"==typeof e;if(f&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!=e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+8) <= "+this.buffer.byteLength)}var b=0,c=0;return this.littleEndian?(b=this.view[e+2]<<16,b|=this.view[e+1]<<8,b|=this.view[e],b+=this.view[e+3]<<24>>>0,e+=4,c=this.view[e+2]<<16,c|=this.view[e+1]<<8,c|=this.view[e],c+=this.view[e+3]<<24>>>0):(c=this.view[e+1]<<16,c|=this.view[e+2]<<8,c|=this.view[e+3],c+=this.view[e]<<24>>>0,e+=4,b=this.view[e+1]<<16,b|=this.view[e+2]<<8,b|=this.view[e+3],b+=this.view[e]<<24>>>0),e=new i(b,c,!0),f&&(this.offset+=8),e},g.readUInt64=g.readUint64),g.writeFloat32=function(e,g){var h="undefined"==typeof g;if(h&&(g=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof g||0!=g%1)throw TypeError("Illegal offset: "+g+" (not an integer)");if(g>>>=0,0>g||g+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+g+" (+0) <= "+this.buffer.byteLength)}g+=4;var c=this.buffer.byteLength;return g>c&&this.resize((c*=2)>g?c:g),f(this.view,e,g-4,this.littleEndian,23,4),h&&(this.offset+=4),this},g.writeFloat=g.writeFloat32,g.readFloat32=function(d){var e="undefined"==typeof d;if(e&&(d=this.offset),!this.noAssert){if("number"!=typeof d||0!=d%1)throw TypeError("Illegal offset: "+d+" (not an integer)");if(d>>>=0,0>d||d+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+d+" (+4) <= "+this.buffer.byteLength)}return d=c(this.view,d,this.littleEndian,23,4),e&&(this.offset+=4),d},g.readFloat=g.readFloat32,g.writeFloat64=function(e,g){var h="undefined"==typeof g;if(h&&(g=this.offset),!this.noAssert){if("number"!=typeof e)throw TypeError("Illegal value: "+e+" (not a number)");if("number"!=typeof g||0!=g%1)throw TypeError("Illegal offset: "+g+" (not an integer)");if(g>>>=0,0>g||g+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+g+" (+0) <= "+this.buffer.byteLength)}g+=8;var c=this.buffer.byteLength;return g>c&&this.resize((c*=2)>g?c:g),f(this.view,e,g-8,this.littleEndian,52,8),h&&(this.offset+=8),this},g.writeDouble=g.writeFloat64,g.readFloat64=function(d){var e="undefined"==typeof d;if(e&&(d=this.offset),!this.noAssert){if("number"!=typeof d||0!=d%1)throw TypeError("Illegal offset: "+d+" (not an integer)");if(d>>>=0,0>d||d+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+d+" (+8) <= "+this.buffer.byteLength)}return d=c(this.view,d,this.littleEndian,52,8),e&&(this.offset+=8),d},g.readDouble=g.readFloat64,r.MAX_VARINT32_BYTES=5,r.calculateVarint32=function(b){return b>>>=0,128>b?1:16384>b?2:2097152>b?3:268435456>b?4:5},r.zigZagEncode32=function(b){return((b|=0)<<1^b>>31)>>>0},r.zigZagDecode32=function(b){return 0|b>>>1^-(1&b)},g.writeVarint32=function(e,g){var h="undefined"==typeof g;if(h&&(g=this.offset),!this.noAssert){if("number"!=typeof e||0!=e%1)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof g||0!=g%1)throw TypeError("Illegal offset: "+g+" (not an integer)");if(g>>>=0,0>g||g+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+g+" (+0) <= "+this.buffer.byteLength)}var c,f=r.calculateVarint32(e);for(g+=f,c=this.buffer.byteLength,g>c&&this.resize((c*=2)>g?c:g),g-=f,e>>>=0;128<=e;)c=128|127&e,this.view[g++]=c,e>>>=7;return this.view[g++]=e,h?(this.offset=g,this):f},g.writeVarint32ZigZag=function(c,a){return this.writeVarint32(r.zigZagEncode32(c),a)},g.readVarint32=function(e){var g="undefined"==typeof e;if(g&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!=e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var b,f=0,h=0;do{if(!this.noAssert&&e>this.limit)throw e=Error("Truncated"),e.truncated=!0,e;b=this.view[e++],5>f&&(h|=(127&b)<<7*f),++f}while(0!=(128&b));return h|=0,g?(this.offset=e,h):{value:h,length:f}},g.readVarint32ZigZag=function(b){return b=this.readVarint32(b),"object"==typeof b?b.value=r.zigZagDecode32(b.value):b=r.zigZagDecode32(b),b},i&&(r.MAX_VARINT64_BYTES=10,r.calculateVarint64=function(d){"number"==typeof d?d=i.fromNumber(d):"string"==typeof d&&(d=i.fromString(d));var e=d.toInt()>>>0,b=d.shiftRightUnsigned(28).toInt()>>>0;return d=d.shiftRightUnsigned(56).toInt()>>>0,0==d?0==b?16384>e?128>e?1:2:2097152>e?3:4:16384>b?128>b?5:6:2097152>b?7:8:128>d?9:10},r.zigZagEncode64=function(b){return"number"==typeof b?b=i.fromNumber(b,!1):"string"==typeof b?b=i.fromString(b,!1):!1!==b.unsigned&&(b=b.toSigned()),b.shiftLeft(1).xor(b.shiftRight(63)).toUnsigned()},r.zigZagDecode64=function(b){return"number"==typeof b?b=i.fromNumber(b,!1):"string"==typeof b?b=i.fromString(b,!1):!1!==b.unsigned&&(b=b.toSigned()),b.shiftRightUnsigned(1).xor(b.and(i.ONE).toSigned().negate()).toSigned()},g.writeVarint64=function(h,j){var k="undefined"==typeof j;if(k&&(j=this.offset),!this.noAssert){if("number"==typeof h)h=i.fromNumber(h);else if("string"==typeof h)h=i.fromString(h);else if(!(h&&h instanceof i))throw TypeError("Illegal value: "+h+" (not an integer or Long)");if("number"!=typeof j||0!=j%1)throw TypeError("Illegal offset: "+j+" (not an integer)");if(j>>>=0,0>j||j+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+j+" (+0) <= "+this.buffer.byteLength)}"number"==typeof h?h=i.fromNumber(h,!1):"string"==typeof h?h=i.fromString(h,!1):!1!==h.unsigned&&(h=h.toSigned());var c=r.calculateVarint64(h),d=h.toInt()>>>0,f=h.shiftRightUnsigned(28).toInt()>>>0,e=h.shiftRightUnsigned(56).toInt()>>>0;j+=c;var g=this.buffer.byteLength;switch(j>g&&this.resize((g*=2)>j?g:j),j-=c,c){case 10:this.view[j+9]=1&e>>>7;case 9:this.view[j+8]=9===c?127&e:128|e;case 8:this.view[j+7]=8===c?127&f>>>21:128|f>>>21;case 7:this.view[j+6]=7===c?127&f>>>14:128|f>>>14;case 6:this.view[j+5]=6===c?127&f>>>7:128|f>>>7;case 5:this.view[j+4]=5===c?127&f:128|f;case 4:this.view[j+3]=4===c?127&d>>>21:128|d>>>21;case 3:this.view[j+2]=3===c?127&d>>>14:128|d>>>14;case 2:this.view[j+1]=2===c?127&d>>>7:128|d>>>7;case 1:this.view[j]=1===c?127&d:128|d;}return k?(this.offset+=c,this):c},g.writeVarint64ZigZag=function(c,a){return this.writeVarint64(r.zigZagEncode64(c),a)},g.readVarint64=function(h){var j="undefined"==typeof h;if(j&&(h=this.offset),!this.noAssert){if("number"!=typeof h||0!=h%1)throw TypeError("Illegal offset: "+h+" (not an integer)");if(h>>>=0,0>h||h+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+h+" (+1) <= "+this.buffer.byteLength)}var b=h,c=0,k=0,f=0,e=0,e=this.view[h++],c=127&e;if(128&e&&(e=this.view[h++],c|=(127&e)<<7,128&e||this.noAssert&&"undefined"==typeof e)&&(e=this.view[h++],c|=(127&e)<<14,128&e||this.noAssert&&"undefined"==typeof e)&&(e=this.view[h++],c|=(127&e)<<21,128&e||this.noAssert&&"undefined"==typeof e)&&(e=this.view[h++],k=127&e,128&e||this.noAssert&&"undefined"==typeof e)&&(e=this.view[h++],k|=(127&e)<<7,128&e||this.noAssert&&"undefined"==typeof e)&&(e=this.view[h++],k|=(127&e)<<14,128&e||this.noAssert&&"undefined"==typeof e)&&(e=this.view[h++],k|=(127&e)<<21,128&e||this.noAssert&&"undefined"==typeof e)&&(e=this.view[h++],f=127&e,128&e||this.noAssert&&"undefined"==typeof e)&&(e=this.view[h++],f|=(127&e)<<7,128&e||this.noAssert&&"undefined"==typeof e))throw Error("Buffer overrun");return c=i.fromBits(c|k<<28,k>>>4|f<<24,!1),j?(this.offset=h,c):{value:c,length:h-b}},g.readVarint64ZigZag=function(b){return(b=this.readVarint64(b))&&b.value instanceof i?b.value=r.zigZagDecode64(b.value):b=r.zigZagDecode64(b),b}),g.writeCString=function(e,g){var h="undefined"==typeof g;h&&(g=this.offset);var c,d=e.length;if(!this.noAssert){if("string"!=typeof e)throw TypeError("Illegal str: Not a string");for(c=0;c<d;++c)if(0===e.charCodeAt(c))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof g||0!=g%1)throw TypeError("Illegal offset: "+g+" (not an integer)");if(g>>>=0,0>g||g+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+g+" (+0) <= "+this.buffer.byteLength)}return d=m.calculateUTF16asUTF8(j(e))[1],g+=d+1,c=this.buffer.byteLength,g>c&&this.resize((c*=2)>g?c:g),g-=d+1,m.encodeUTF16toUTF8(j(e),function(b){this.view[g++]=b}.bind(this)),this.view[g++]=0,h?(this.offset=g,this):d},g.readCString=function(e){var g="undefined"==typeof e;if(g&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!=e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var b,d=e,c=-1;return m.decodeUTF8toUTF16(function(){if(0==c)return null;if(e>=this.limit)throw RangeError("Illegal range: Truncated data, "+e+" < "+this.limit);return c=this.view[e++],0===c?null:c}.bind(this),b=l(),!0),g?(this.offset=e,b()):{string:b(),length:e-d}},g.writeIString=function(g,h){var i="undefined"==typeof h;if(i&&(h=this.offset),!this.noAssert){if("string"!=typeof g)throw TypeError("Illegal str: Not a string");if("number"!=typeof h||0!=h%1)throw TypeError("Illegal offset: "+h+" (not an integer)");if(h>>>=0,0>h||h+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+h+" (+0) <= "+this.buffer.byteLength)}var c,f=h;c=m.calculateUTF16asUTF8(j(g),this.noAssert)[1],h+=4+c;var d=this.buffer.byteLength;if(h>d&&this.resize((d*=2)>h?d:h),h-=4+c,this.littleEndian?(this.view[h+3]=255&c>>>24,this.view[h+2]=255&c>>>16,this.view[h+1]=255&c>>>8,this.view[h]=255&c):(this.view[h]=255&c>>>24,this.view[h+1]=255&c>>>16,this.view[h+2]=255&c>>>8,this.view[h+3]=255&c),h+=4,m.encodeUTF16toUTF8(j(g),function(b){this.view[h++]=b}.bind(this)),h!==f+4+c)throw RangeError("Illegal range: Truncated data, "+h+" == "+(h+4+c));return i?(this.offset=h,this):h-f},g.readIString=function(e){var f="undefined"==typeof e;if(f&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!=e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+4) <= "+this.buffer.byteLength)}var b=e,c=this.readUint32(e),c=this.readUTF8String(c,r.METRICS_BYTES,e+=4);return e+=c.length,f?(this.offset=e,c.string):{string:c.string,length:e-b}},r.METRICS_CHARS="c",r.METRICS_BYTES="b",g.writeUTF8String=function(g,h){var a="undefined"==typeof h;if(a&&(h=this.offset),!this.noAssert){if("number"!=typeof h||0!=h%1)throw TypeError("Illegal offset: "+h+" (not an integer)");if(h>>>=0,0>h||h+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+h+" (+0) <= "+this.buffer.byteLength)}var c,d=h;c=m.calculateUTF16asUTF8(j(g))[1],h+=c;var f=this.buffer.byteLength;return h>f&&this.resize((f*=2)>h?f:h),h-=c,m.encodeUTF16toUTF8(j(g),function(b){this.view[h++]=b}.bind(this)),a?(this.offset=h,this):h-d},g.writeString=g.writeUTF8String,r.calculateUTF8Chars=function(b){return m.calculateUTF16asUTF8(j(b))[0]},r.calculateUTF8Bytes=function(b){return m.calculateUTF16asUTF8(j(b))[1]},r.calculateString=r.calculateUTF8Bytes,g.readUTF8String=function(h,i,j){"number"==typeof i&&(j=i,i=void 0);var n="undefined"==typeof j;if(n&&(j=this.offset),"undefined"==typeof i&&(i=r.METRICS_CHARS),!this.noAssert){if("number"!=typeof h||0!=h%1)throw TypeError("Illegal length: "+h+" (not an integer)");if(h|=0,"number"!=typeof j||0!=j%1)throw TypeError("Illegal offset: "+j+" (not an integer)");if(j>>>=0,0>j||j+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+j+" (+0) <= "+this.buffer.byteLength)}var d,g=0,f=j;if(i===r.METRICS_CHARS){if(d=l(),m.decodeUTF8(function(){return g<h&&j<this.limit?this.view[j++]:null}.bind(this),function(b){++g,m.UTF8toUTF16(b,d)}),g!==h)throw RangeError("Illegal range: Truncated data, "+g+" == "+h);return n?(this.offset=j,d()):{string:d(),length:j-f}}if(i===r.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof j||0!=j%1)throw TypeError("Illegal offset: "+j+" (not an integer)");if(j>>>=0,0>j||j+h>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+j+" (+"+h+") <= "+this.buffer.byteLength)}var e=j+h;if(m.decodeUTF8toUTF16(function(){return j<e?this.view[j++]:null}.bind(this),d=l(),this.noAssert),j!==e)throw RangeError("Illegal range: Truncated data, "+j+" == "+e);return n?(this.offset=j,d()):{string:d(),length:j-f}}throw TypeError("Unsupported metrics: "+i)},g.readString=g.readUTF8String,g.writeVString=function(h,i){var k="undefined"==typeof i;if(k&&(i=this.offset),!this.noAssert){if("string"!=typeof h)throw TypeError("Illegal str: Not a string");if("number"!=typeof i||0!=i%1)throw TypeError("Illegal offset: "+i+" (not an integer)");if(i>>>=0,0>i||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}var c,f,e=i;c=m.calculateUTF16asUTF8(j(h),this.noAssert)[1],f=r.calculateVarint32(c),i+=f+c;var d=this.buffer.byteLength;if(i>d&&this.resize((d*=2)>i?d:i),i-=f+c,i+=this.writeVarint32(c,i),m.encodeUTF16toUTF8(j(h),function(b){this.view[i++]=b}.bind(this)),i!==e+c+f)throw RangeError("Illegal range: Truncated data, "+i+" == "+(i+c+f));return k?(this.offset=i,this):i-e},g.readVString=function(e){var f="undefined"==typeof e;if(f&&(e=this.offset),!this.noAssert){if("number"!=typeof e||0!=e%1)throw TypeError("Illegal offset: "+e+" (not an integer)");if(e>>>=0,0>e||e+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+e+" (+1) <= "+this.buffer.byteLength)}var b=e,c=this.readVarint32(e),c=this.readUTF8String(c.value,r.METRICS_BYTES,e+=c.length);return e+=c.length,f?(this.offset=e,c.string):{string:c.string,length:e-b}},g.append=function(e,a,g){("number"==typeof a||"string"!=typeof a)&&(g=a,a=void 0);var h="undefined"==typeof g;if(h&&(g=this.offset),!this.noAssert){if("number"!=typeof g||0!=g%1)throw TypeError("Illegal offset: "+g+" (not an integer)");if(g>>>=0,0>g||g+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+g+" (+0) <= "+this.buffer.byteLength)}if(e instanceof r||(e=r.wrap(e,a)),a=e.limit-e.offset,0>=a)return this;g+=a;var d=this.buffer.byteLength;return g>d&&this.resize((d*=2)>g?d:g),g-=a,this.view.set(e.view.subarray(e.offset,e.limit),g),e.offset+=a,h&&(this.offset+=a),this},g.appendTo=function(c,a){return c.append(this,a),this},g.assert=function(b){return this.noAssert=!b,this},g.capacity=function(){return this.buffer.byteLength},g.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},g.clone=function(c){var a=new r(0,this.littleEndian,this.noAssert);return c?(a.buffer=new ArrayBuffer(this.buffer.byteLength),a.view=new Uint8Array(a.buffer)):(a.buffer=this.buffer,a.view=this.view),a.offset=this.offset,a.markedOffset=this.markedOffset,a.limit=this.limit,a},g.compact=function(g,h){if("undefined"==typeof g&&(g=this.offset),"undefined"==typeof h&&(h=this.limit),!this.noAssert){if("number"!=typeof g||0!=g%1)throw TypeError("Illegal begin: Not an integer");if(g>>>=0,"number"!=typeof h||0!=h%1)throw TypeError("Illegal end: Not an integer");if(h>>>=0,0>g||g>h||h>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+g+" <= "+h+" <= "+this.buffer.byteLength)}if(0===g&&h===this.buffer.byteLength)return this;var i=h-g;if(0==i)return this.buffer=e,this.view=null,0<=this.markedOffset&&(this.markedOffset-=g),this.limit=this.offset=0,this;var c=new ArrayBuffer(i),d=new Uint8Array(c);return d.set(this.view.subarray(g,h)),this.buffer=c,this.view=d,0<=this.markedOffset&&(this.markedOffset-=g),this.offset=0,this.limit=i,this},g.copy=function(e,f){if("undefined"==typeof e&&(e=this.offset),"undefined"==typeof f&&(f=this.limit),!this.noAssert){if("number"!=typeof e||0!=e%1)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof f||0!=f%1)throw TypeError("Illegal end: Not an integer");if(f>>>=0,0>e||e>f||f>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+f+" <= "+this.buffer.byteLength)}if(e===f)return new r(0,this.littleEndian,this.noAssert);var g=f-e,c=new r(g,this.littleEndian,this.noAssert);return c.offset=0,c.limit=g,0<=c.markedOffset&&(c.markedOffset-=e),this.copyTo(c,0,e,f),c},g.copyTo=function(h,a,i,j){var k,f;if(!this.noAssert&&!r.isByteBuffer(h))throw TypeError("Illegal target: Not a ByteBuffer");if(a=(f="undefined"==typeof a)?h.offset:0|a,i=(k="undefined"==typeof i)?this.offset:0|i,j="undefined"==typeof j?this.limit:0|j,0>a||a>h.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+a+" <= "+h.buffer.byteLength);if(0>i||j>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+i+" <= "+this.buffer.byteLength);var e=j-i;return 0==e?h:(h.ensureCapacity(a+e),h.view.set(this.view.subarray(i,j),a),k&&(this.offset+=e),f&&(h.offset+=e),this)},g.ensureCapacity=function(c){var a=this.buffer.byteLength;return a<c?this.resize((a*=2)>c?a:c):this},g.fill=function(e,f,g){var h="undefined"==typeof f;if(h&&(f=this.offset),"string"==typeof e&&0<e.length&&(e=e.charCodeAt(0)),"undefined"==typeof f&&(f=this.offset),"undefined"==typeof g&&(g=this.limit),!this.noAssert){if("number"!=typeof e||0!=e%1)throw TypeError("Illegal value: "+e+" (not an integer)");if(e|=0,"number"!=typeof f||0!=f%1)throw TypeError("Illegal begin: Not an integer");if(f>>>=0,"number"!=typeof g||0!=g%1)throw TypeError("Illegal end: Not an integer");if(g>>>=0,0>f||f>g||g>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+f+" <= "+g+" <= "+this.buffer.byteLength)}if(f>=g)return this;for(;f<g;)this.view[f++]=e;return h&&(this.offset=f),this},g.flip=function(){return this.limit=this.offset,this.offset=0,this},g.mark=function(b){if(b="undefined"==typeof b?this.offset:b,!this.noAssert){if("number"!=typeof b||0!=b%1)throw TypeError("Illegal offset: "+b+" (not an integer)");if(b>>>=0,0>b||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=b,this},g.order=function(b){if(!this.noAssert&&"boolean"!=typeof b)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!b,this},g.LE=function(b){return this.littleEndian="undefined"==typeof b||!!b,this},g.BE=function(b){return this.littleEndian="undefined"!=typeof b&&!b,this},g.prepend=function(h,a,i){("number"==typeof a||"string"!=typeof a)&&(i=a,a=void 0);var j="undefined"==typeof i;if(j&&(i=this.offset),!this.noAssert){if("number"!=typeof i||0!=i%1)throw TypeError("Illegal offset: "+i+" (not an integer)");if(i>>>=0,0>i||i+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+i+" (+0) <= "+this.buffer.byteLength)}if(h instanceof r||(h=r.wrap(h,a)),a=h.limit-h.offset,0>=a)return this;var d=a-i;if(0<d){var f=new ArrayBuffer(this.buffer.byteLength+d),e=new Uint8Array(f);e.set(this.view.subarray(i,this.buffer.byteLength),a),this.buffer=f,this.view=e,this.offset+=d,0<=this.markedOffset&&(this.markedOffset+=d),this.limit+=d,i+=d}else new Uint8Array(this.buffer);return this.view.set(h.view.subarray(h.offset,h.limit),i-a),h.offset=h.limit,j&&(this.offset-=a),this},g.prependTo=function(c,a){return c.prepend(this,a),this},g.printDebug=function(b){"function"!=typeof b&&(b=console.log.bind(console)),b(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},g.remaining=function(){return this.limit-this.offset},g.reset=function(){return 0<=this.markedOffset?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},g.resize=function(c){if(!this.noAssert){if("number"!=typeof c||0!=c%1)throw TypeError("Illegal capacity: "+c+" (not an integer)");if(c|=0,0>c)throw RangeError("Illegal capacity: 0 <= "+c)}if(this.buffer.byteLength<c){c=new ArrayBuffer(c);var d=new Uint8Array(c);d.set(this.view),this.buffer=c,this.view=d}return this},g.reverse=function(c,d){if("undefined"==typeof c&&(c=this.offset),"undefined"==typeof d&&(d=this.limit),!this.noAssert){if("number"!=typeof c||0!=c%1)throw TypeError("Illegal begin: Not an integer");if(c>>>=0,"number"!=typeof d||0!=d%1)throw TypeError("Illegal end: Not an integer");if(d>>>=0,0>c||c>d||d>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+c+" <= "+d+" <= "+this.buffer.byteLength)}return c===d?this:(Array.prototype.reverse.call(this.view.subarray(c,d)),this)},g.skip=function(c){if(!this.noAssert){if("number"!=typeof c||0!=c%1)throw TypeError("Illegal length: "+c+" (not an integer)");c|=0}var d=this.offset+c;if(!this.noAssert&&(0>d||d>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+c+" <= "+this.buffer.byteLength);return this.offset=d,this},g.slice=function(d,e){if("undefined"==typeof d&&(d=this.offset),"undefined"==typeof e&&(e=this.limit),!this.noAssert){if("number"!=typeof d||0!=d%1)throw TypeError("Illegal begin: Not an integer");if(d>>>=0,"number"!=typeof e||0!=e%1)throw TypeError("Illegal end: Not an integer");if(e>>>=0,0>d||d>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+d+" <= "+e+" <= "+this.buffer.byteLength)}var f=this.clone();return f.offset=d,f.limit=e,f},g.toBuffer=function(d){var a=this.offset,f=this.limit;if(!this.noAssert){if("number"!=typeof a||0!=a%1)throw TypeError("Illegal offset: Not an integer");if(a>>>=0,"number"!=typeof f||0!=f%1)throw TypeError("Illegal limit: Not an integer");if(f>>>=0,0>a||a>f||f>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+f+" <= "+this.buffer.byteLength)}return d||0!==a||f!==this.buffer.byteLength?a===f?e:(d=new ArrayBuffer(f-a),new Uint8Array(d).set(new Uint8Array(this.buffer).subarray(a,f),0),d):this.buffer},g.toArrayBuffer=g.toBuffer,g.toString=function(d,e,b){if("undefined"==typeof d)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof d&&(b=e=d="utf8"),d){case"utf8":return this.toUTF8(e,b);case"base64":return this.toBase64(e,b);case"hex":return this.toHex(e,b);case"binary":return this.toBinary(e,b);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+d);}};var h=function(){for(var e={},g=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],i=[],a=0,b=g.length;a<b;++a)i[g[a]]=a;return e.encode=function(b,a){for(var c,d;null!==(c=b());)a(g[63&c>>2]),d=(3&c)<<4,null===(c=b())?(a(g[63&d]),a(61),a(61)):(d|=15&c>>4,a(g[63&(d|15&c>>4)]),d=(15&c)<<2,null===(c=b())?(a(g[63&d]),a(61)):(a(g[63&(d|3&c>>6)]),a(g[63&c])))},e.decode=function(c,a){function b(b){throw Error("Illegal character code: "+b)}for(var d,f,g;null!==(d=c());)if(f=i[d],"undefined"==typeof f&&b(d),null!==(d=c())&&(g=i[d],"undefined"==typeof g&&b(d),a(f<<2>>>0|(48&g)>>4),null!==(d=c()))){if(f=i[d],"undefined"==typeof f)if(61===d)break;else b(d);if(a((15&g)<<4>>>0|(60&f)>>2),null!==(d=c())){if(g=i[d],"undefined"==typeof g)if(61===d)break;else b(d);a((3&f)<<6>>>0|g)}}},e.test=function(b){return /^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(b)},e}();g.toBase64=function(d,e){if("undefined"==typeof d&&(d=this.offset),"undefined"==typeof e&&(e=this.limit),d|=0,e|=0,0>d||e>this.capacity||d>e)throw RangeError("begin, end");var f;return h.encode(function(){return d<e?this.view[d++]:null}.bind(this),f=l()),f()},r.fromBase64=function(e,f){if("string"!=typeof e)throw TypeError("str");var b=new r(3*(e.length/4),f),c=0;return h.decode(j(e),function(d){b.view[c++]=d}),b.limit=c,b},r.btoa=function(b){return r.fromBinary(b).toBase64()},r.atob=function(b){return r.fromBase64(b).toBinary()},g.toBinary=function(e,f){if("undefined"==typeof e&&(e=this.offset),"undefined"==typeof f&&(f=this.limit),e|=0,f|=0,0>e||f>this.capacity()||e>f)throw RangeError("begin, end");if(e===f)return"";for(var g=[],c=[];e<f;)g.push(this.view[e++]),1024<=g.length&&(c.push(k.apply(String,g)),g=[]);return c.join("")+k.apply(String,g)},r.fromBinary=function(g,h){if("string"!=typeof g)throw TypeError("str");for(var b,f=0,c=g.length,d=new r(c,h);f<c;){if(b=g.charCodeAt(f),255<b)throw RangeError("illegal char code: "+b);d.view[f++]=b}return d.limit=c,d},g.toDebug=function(h){for(var a,d=-1,b=this.buffer.byteLength,c="",f="",e="";d<b;){if(-1!=d&&(a=this.view[d],c=16>a?c+("0"+a.toString(16).toUpperCase()):c+a.toString(16).toUpperCase(),h&&(f+=32<a&&127>a?k(a):".")),++d,h&&0<d&&0==d%16&&d!==b){for(;51>c.length;)c+=" ";e+=c+f+"\n",c=f=""}c=d===this.offset&&d===this.limit?c+(d===this.markedOffset?"!":"|"):d===this.offset?c+(d===this.markedOffset?"[":"<"):d===this.limit?c+(d===this.markedOffset?"]":">"):c+(d===this.markedOffset?"'":h||0!=d&&d!==b?" ":"")}if(h&&" "!=c){for(;51>c.length;)c+=" ";e+=c+f+"\n"}return h?e:c},r.fromDebug=function(h,a,b){var i=h.length;a=new r(0|(i+1)/3,a,b);for(var d,g=0,f=0,e=!1,j=!1,k=!1,l=!1,n=!1;g<i;){switch(d=h.charAt(g++)){case"!":if(!b){if(j||k||l){n=!0;break}j=k=l=!0}a.offset=a.markedOffset=a.limit=f,e=!1;break;case"|":if(!b){if(j||l){n=!0;break}j=l=!0}a.offset=a.limit=f,e=!1;break;case"[":if(!b){if(j||k){n=!0;break}j=k=!0}a.offset=a.markedOffset=f,e=!1;break;case"<":if(!b){if(j){n=!0;break}j=!0}a.offset=f,e=!1;break;case"]":if(!b){if(l||k){n=!0;break}l=k=!0}a.limit=a.markedOffset=f,e=!1;break;case">":if(!b){if(l){n=!0;break}l=!0}a.limit=f,e=!1;break;case"'":if(!b){if(k){n=!0;break}k=!0}a.markedOffset=f,e=!1;break;case" ":e=!1;break;default:if(!b&&e){n=!0;break}if(d=parseInt(d+h.charAt(g++),16),!b&&(isNaN(d)||0>d||255<d))throw TypeError("Illegal str: Not a debug encoded string");a.view[f++]=d,e=!0;}if(n)throw TypeError("Illegal str: Invalid symbol at "+g)}if(!b){if(!j||!l)throw TypeError("Illegal str: Missing offset or limit");if(f<a.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+f+" < "+i)}return a},g.toHex=function(e,f){if(e="undefined"==typeof e?this.offset:e,f="undefined"==typeof f?this.limit:f,!this.noAssert){if("number"!=typeof e||0!=e%1)throw TypeError("Illegal begin: Not an integer");if(e>>>=0,"number"!=typeof f||0!=f%1)throw TypeError("Illegal end: Not an integer");if(f>>>=0,0>e||e>f||f>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+e+" <= "+f+" <= "+this.buffer.byteLength)}for(var g,d=Array(f-e);e<f;)g=this.view[e++],16>g?d.push("0",g.toString(16)):d.push(g.toString(16));return d.join("")},r.fromHex=function(h,i,b){if(!b){if("string"!=typeof h)throw TypeError("Illegal str: Not a string");if(0!=h.length%2)throw TypeError("Illegal str: Length not a multiple of 2")}var j=h.length;i=new r(0|j/2,i);for(var d,f=0,e=0;f<j;f+=2){if(d=parseInt(h.substring(f,f+2),16),!b&&(!isFinite(d)||0>d||255<d))throw TypeError("Illegal str: Contains non-hex characters");i.view[e++]=d}return i.limit=e,i};var m=function(){var e={MAX_CODEPOINT:1114111,encodeUTF8:function(b,e){var c=null;for("number"==typeof b&&(c=b,b=function(){return null});null!==c||null!==(c=b());)128>c?e(127&c):(2048>c?e(192|31&c>>6):(65536>c?e(224|15&c>>12):(e(240|7&c>>18),e(128|63&c>>12)),e(128|63&c>>6)),e(128|63&c)),c=null},decodeUTF8:function(b,a){for(var c,d,f,e,g=function(c){c=c.slice(0,c.indexOf(null));var a=Error(c.toString());throw a.name="TruncatedError",a.bytes=c,a};null!==(c=b());)if(0==(128&c))a(c);else if(192==(224&c))null===(d=b())&&g([c,d]),a((31&c)<<6|63&d);else if(224==(240&c))null!==(d=b())&&null!==(f=b())||g([c,d,f]),a((15&c)<<12|(63&d)<<6|63&f);else if(240==(248&c))null!==(d=b())&&null!==(f=b())&&null!==(e=b())||g([c,d,f,e]),a((7&c)<<18|(63&d)<<12|(63&f)<<6|63&e);else throw RangeError("Illegal starting byte: "+c)},UTF16toUTF8:function(b,a){for(var c,d=null;null!==(c=null===d?b():d);)55296<=c&&57343>=c&&null!==(d=b())&&56320<=d&&57343>=d?(a(1024*(c-55296)+d-56320+65536),d=null):a(c);null!==d&&a(d)},UTF8toUTF16:function(b,e){var c=null;for("number"==typeof b&&(c=b,b=function(){return null});null!==c||null!==(c=b());)65535>=c?e(c):(c-=65536,e((c>>10)+55296),e(c%1024+56320)),c=null},encodeUTF16toUTF8:function(a,d){e.UTF16toUTF8(a,function(a){e.encodeUTF8(a,d)})},decodeUTF8toUTF16:function(a,d){e.decodeUTF8(a,function(a){e.UTF8toUTF16(a,d)})},calculateCodePoint:function(b){return 128>b?1:2048>b?2:65536>b?3:4},calculateUTF8:function(b){for(var a,c=0;null!==(a=b());)c+=128>a?1:2048>a?2:65536>a?3:4;return c},calculateUTF16asUTF8:function(a){var b=0,c=0;return e.UTF16toUTF8(a,function(d){++b,c+=128>d?1:2048>d?2:65536>d?3:4}),[b,c]}};return e}();return g.toUTF8=function(d,e){if("undefined"==typeof d&&(d=this.offset),"undefined"==typeof e&&(e=this.limit),!this.noAssert){if("number"!=typeof d||0!=d%1)throw TypeError("Illegal begin: Not an integer");if(d>>>=0,"number"!=typeof e||0!=e%1)throw TypeError("Illegal end: Not an integer");if(e>>>=0,0>d||d>e||e>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+d+" <= "+e+" <= "+this.buffer.byteLength)}var f;try{m.decodeUTF8toUTF16(function(){return d<e?this.view[d++]:null}.bind(this),f=l())}catch(a){if(d!==e)throw RangeError("Illegal range: Truncated data, "+d+" != "+e)}return f()},r.fromUTF8=function(f,g,b){if(!b&&"string"!=typeof f)throw TypeError("Illegal str: Not a string");var h=new r(m.calculateUTF16asUTF8(j(f),!0)[1],g,b),d=0;return m.encodeUTF16toUTF8(j(f),function(b){h.view[d++]=b}),h.limit=d,h},r})})(); 
 			});
 		define("engine.js", function(require, module, exports){ 			
(function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};a[d].call(e.exports,e,e.exports,b);e.loaded=!0;return e.exports}var c={};b.m=a;b.c=c;b.p="";return b(0)})([function(a,b,c){function d(){e.addEventListener=e.canvas.addEventListener=function(a,b){e.document.addEventListener(a,b)};e.removeEventListener=e.canvas.removeEventListener=function(a,b){e.document.removeEventListener(a,b)};var a=wx.getSystemInfoSync().platform;if("undefined"===typeof __devtoolssubcontext&&
"devtools"===a){for(var b in e)(a=Object.getOwnPropertyDescriptor(f,b))&&!0!==a.configurable||Object.defineProperty(window,b,{value:e[b]});for(var c in e.document)(b=Object.getOwnPropertyDescriptor(f.document,c))&&!0!==b.configurable||Object.defineProperty(f.document,c,{value:e.document[c]});window.parent=window}else{for(var d in e)f[d]=e[d];f.window=e;window=f;window.top=window.parent=window}}var e=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,
c)&&(b[c]=a[c]);b.default=a;return b}(c(1)),f=GameGlobal;GameGlobal.__isAdapterInjected||(GameGlobal.__isAdapterInjected=!0,d())},function(a,b,c){function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0});b.cancelAnimationFrame=b.requestAnimationFrame=b.clearInterval=b.clearTimeout=b.setInterval=b.setTimeout=b.canvas=b.location=b.localStorage=b.HTMLElement=b.FileReader=b.Audio=b.Image=b.WebSocket=b.XMLHttpRequest=b.navigator=b.document=void 0;var e=c(2);Object.keys(e).forEach(function(a){"default"!==
a&&"__esModule"!==a&&Object.defineProperty(b,a,{enumerable:!0,get:function(){return e[a]}})});var f=c(3);Object.keys(f).forEach(function(a){"default"!==a&&"__esModule"!==a&&Object.defineProperty(b,a,{enumerable:!0,get:function(){return f[a]}})});a=c(9);a=d(a);var g=c(10),g=d(g),h=c(17),h=d(h),k=c(18),k=d(k),m=c(19),m=d(m),n=c(11),n=d(n),p=c(12),p=d(p),r=c(20),r=d(r),s=c(4),s=d(s),u=c(21),u=d(u);c=c(22);c=d(c);b.document=g.default;b.navigator=h.default;b.XMLHttpRequest=k.default;b.WebSocket=m.default;
b.Image=n.default;b.Audio=p.default;b.FileReader=r.default;b.HTMLElement=s.default;b.localStorage=u.default;b.location=c.default;c=new a.default;b.canvas=c;b.setTimeout=setTimeout;b.setInterval=setInterval;b.clearTimeout=clearTimeout;b.clearInterval=clearInterval;b.requestAnimationFrame=requestAnimationFrame;b.cancelAnimationFrame=cancelAnimationFrame},function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c=wx.getSystemInfoSync(),d=c.screenHeight,e=c.devicePixelRatio,c=b.innerWidth=c.screenWidth,
d=b.innerHeight=d;b.devicePixelRatio=e;b.screen={availWidth:c,availHeight:d};b.performance={now:function(){return Date.now()/1E3}};b.ontouchstart=null;b.ontouchmove=null;b.ontouchend=null},function(a,b,c){function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function f(a,b){if("function"!==typeof b&&
null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});b.HTMLCanvasElement=b.HTMLImageElement=void 0;a=(a=c(4))&&a.__esModule?a:{default:a};b.HTMLImageElement=function(a){function b(){d(this,b);return e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,
"img"))}f(b,a);return b}(a.default);b.HTMLCanvasElement=function(a){function b(){d(this,b);return e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,"canvas"))}f(b,a);return b}(a.default)},function(a,b,c){function d(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,
b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var e=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();a=(a=c(5))&&a.__esModule?a:{default:a};var f=c(8),g=c(2);c=function(a){function b(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");
var c;c=(b.__proto__||Object.getPrototypeOf(b)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");c=!c||"object"!==typeof c&&"function"!==typeof c?this:c;c.className="";c.childern=[];c.style={width:g.innerWidth+"px",height:g.innerHeight+"px"};c.insertBefore=f.noop;c.innerHTML="";c.tagName=a.toUpperCase();return c}d(b,a);e(b,[{key:"setAttribute",value:function(a,b){this[a]=b}},{key:"getAttribute",value:function(a){return this[a]}},{key:"getBoundingClientRect",
value:function(){return{top:0,left:0,width:g.innerWidth,height:g.innerHeight}}},{key:"focus",value:function(){}},{key:"clientWidth",get:function(){var a=parseInt(this.style.fontSize,10)*this.innerHTML.length;return Number.isNaN(a)?0:a}},{key:"clientHeight",get:function(){var a=parseInt(this.style.fontSize,10);return Number.isNaN(a)?0:a}}]);return b}(a.default);b.default=c},function(a,b,c){function d(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});a=c(6);a=function(a){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");var a;a=(b.__proto__||Object.getPrototypeOf(b)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
a=!a||"object"!==typeof a&&"function"!==typeof a?this:a;a.className="";a.children=[];return a}d(b,a);return b}((a&&a.__esModule?a:{default:a}).default);b.default=a},function(a,b,c){function d(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,
"__esModule",{value:!0});var e=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();a=c(7);a=function(a){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");var a;a=(b.__proto__||Object.getPrototypeOf(b)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
a=!a||"object"!==typeof a&&"function"!==typeof a?this:a;a.childNodes=[];return a}d(b,a);e(b,[{key:"appendChild",value:function(a){if(a instanceof b)this.childNodes.push(a);else throw new TypeError("Failed to executed 'appendChild' on 'Node': parameter 1 is not of type 'Node'.");}},{key:"cloneNode",value:function(){var a=Object.create(this);Object.assign(a,this);return a}},{key:"removeChild",value:function(a){var b=this.childNodes.findIndex(function(b){return b===a});return-1<b?this.childNodes.splice(b,
1):null}}]);return b}((a&&a.__esModule?a:{default:a}).default);b.default=a},function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),d=new WeakMap,e=function(){function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");
d.set(this,{})}c(a,[{key:"addEventListener",value:function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},e=d.get(this);e||(e={},d.set(this,e));e[a]||(e[a]=[]);e[a].push(b);c.capture&&console.warn("EventTarget.addEventListener: options.capture is not implemented.");c.once&&console.warn("EventTarget.addEventListener: options.once is not implemented.");c.passive&&console.warn("EventTarget.addEventListener: options.passive is not implemented.")}},{key:"removeEventListener",value:function(a,
b){var c=d.get(this)[a];if(c&&0<c.length)for(var e=c.length;e--;0<e)if(c[e]===b){c.splice(e,1);break}}},{key:"dispatchEvent",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=d.get(this)[a.type];if(b)for(var c=0;c<b.length;c++)b[c](a)}}]);return a}();b.default=e},function(a,b){Object.defineProperty(b,"__esModule",{value:!0});b.noop=function(){}},function(a,b,c){Object.defineProperty(b,"__esModule",{value:!0});b.default=function(){var a=wx.createCanvas();a.type="canvas";
a.__proto__.__proto__=new d.default("canvas");a.getBoundingClientRect=function(){return{top:0,left:0,width:window.innerWidth,height:window.innerHeight}};return a};c(3);var d=(a=c(4))&&a.__esModule?a:{default:a};c(10)},function(a,b,c){function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0});var e=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);b.default=a;return b}(c(1));a=c(4);
var f=d(a);a=c(11);var g=d(a);a=c(12);var h=d(a);a=c(9);var k=d(a);c(15);var m={},n={readyState:"complete",visibilityState:"visible",documentElement:e,hidden:!1,style:{},location:e.location,ontouchstart:null,ontouchmove:null,ontouchend:null,head:new f.default("head"),body:new f.default("body"),createElement:function(a){return"canvas"===a?new k.default:"audio"===a?new h.default:"img"===a?new g.default:new f.default(a)},getElementById:function(a){return a===e.canvas.id?e.canvas:null},getElementsByTagName:function(a){return"head"===
a?[n.head]:"body"===a?[n.body]:"canvas"===a?[e.canvas]:[]},querySelector:function(a){return"head"===a?n.head:"body"===a?n.body:"canvas"===a||a==="#"+e.canvas.id?e.canvas:null},querySelectorAll:function(a){return"head"===a?[n.head]:"body"===a?[n.body]:"canvas"===a?[e.canvas]:[]},addEventListener:function(a,b){m[a]||(m[a]=[]);m[a].push(b)},removeEventListener:function(a,b){var c=m[a];if(c&&0<c.length)for(var d=c.length;d--;0<d)if(c[d]===b){c.splice(d,1);break}},dispatchEvent:function(a){var b=m[a.type];
if(b)for(var c=0;c<b.length;c++)b[c](a)}};b.default=n},function(a,b){Object.defineProperty(b,"__esModule",{value:!0});b.default=function(){return wx.createImage()}},function(a,b,c){function d(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function e(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&
b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var f=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();a=(a=c(13))&&a.__esModule?a:{default:a};var g=0,h=1,k=2,
m=3,n=4,p=new WeakMap,r=new WeakMap;new WeakMap;new WeakMap;a=function(a){function b(a){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");var c=d(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));c.HAVE_NOTHING=g;c.HAVE_METADATA=h;c.HAVE_CURRENT_DATA=k;c.HAVE_FUTURE_DATA=m;c.HAVE_ENOUGH_DATA=n;c.readyState=g;r.set(c,"");var e=wx.createInnerAudioContext();p.set(c,e);e.onCanplay(function(){c.dispatchEvent({type:"load"});c.dispatchEvent({type:"loadend"});c.dispatchEvent({type:"canplay"});
c.dispatchEvent({type:"canplaythrough"});c.dispatchEvent({type:"loadedmetadata"});c.readyState=k});e.onPlay(function(){c.dispatchEvent({type:"play"})});e.onPause(function(){c.dispatchEvent({type:"pause"})});e.onEnded(function(){c.dispatchEvent({type:"ended"});c.readyState=n});e.onError(function(){c.dispatchEvent({type:"error"})});a&&(p.get(c).src=a);return c}e(b,a);f(b,[{key:"load",value:function(){console.warn("HTMLAudioElement.load() is not implemented.")}},{key:"play",value:function(){p.get(this).play()}},
{key:"pause",value:function(){p.get(this).pause()}},{key:"canPlayType",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return"string"!==typeof a?"":-1<a.indexOf("audio/mpeg")||a.indexOf("audio/mp4")?"probably":""}},{key:"cloneNode",value:function(){var a=new b;a.loop=p.get(this).loop;a.autoplay=p.get(this).loop;a.src=this.src;return a}},{key:"currentTime",get:function(){return p.get(this).currentTime},set:function(a){p.get(this).seek(a)}},{key:"src",get:function(){return r.get(this)},
set:function(a){r.set(this,a);p.get(this).src=a}},{key:"loop",get:function(){return p.get(this).loop},set:function(a){p.get(this).loop=a}},{key:"autoplay",get:function(){return p.get(this).autoplay},set:function(a){p.get(this).autoplay=a}},{key:"paused",get:function(){return p.get(this).paused}}]);return b}(a.default);b.default=a},function(a,b,c){function d(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=
Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});a=c(14);a=function(a){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");var a=(b.__proto__||Object.getPrototypeOf(b)).call(this,"audio");if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!==
typeof a&&"function"!==typeof a?this:a}d(b,a);return b}((a&&a.__esModule?a:{default:a}).default);b.default=a},function(a,b,c){function d(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var e=function(){function a(b,
c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();a=c(4);a=function(a){function b(a){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");a=(b.__proto__||Object.getPrototypeOf(b)).call(this,a);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!==
typeof a&&"function"!==typeof a?this:a}d(b,a);e(b,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]);return b}((a&&a.__esModule?a:{default:a}).default);b.default=a},function(a,b,c){c(16)},function(a,b,c){function d(a){return function(b){var c=new h(a);c.touches=b.touches;c.targetTouches=Array.prototype.slice.call(b.touches);c.changedTouches=
b.changedTouches;c.timeStamp=b.timeStamp;f.default.dispatchEvent(c)}}var e=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);b.default=a;return b}(c(1)),f=(a=c(10))&&a.__esModule?a:{default:a},g=c(8),h=function m(a){if(!(this instanceof m))throw new TypeError("Cannot call a class as a function");this.currentTarget=this.target=e.canvas;this.touches=[];this.targetTouches=[];this.changedTouches=[];this.stopPropagation=this.preventDefault=
g.noop;this.type=a};wx.onTouchStart(d("touchstart"));wx.onTouchMove(d("touchmove"));wx.onTouchEnd(d("touchend"));wx.onTouchCancel(d("touchcancel"))},function(a,b,c){Object.defineProperty(b,"__esModule",{value:!0});a=c(8);a={platform:wx.getSystemInfoSync().platform,language:"zh-cn",appVersion:"5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1",userAgent:"Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/zh_CN",
onLine:!0,geolocation:{getCurrentPosition:a.noop,watchPosition:a.noop,clearWatch:a.noop}};b.default=a},function(a,b){function c(a){if("function"===typeof this["on"+a]){for(var b=arguments.length,c=Array(1<b?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];this["on"+a].apply(this,c)}}function d(a){this.readyState=a;c.call(this,"readystatechange")}Object.defineProperty(b,"__esModule",{value:!0});var e=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=
!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),f=new WeakMap,g=new WeakMap,h=new WeakMap,k=new WeakMap,m=new WeakMap,n=function(){function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.onreadystatechange=this.onloadend=this.ontimeout=this.onprogress=this.onloadstart=this.onload=this.onerror=this.onabort=null;this.readyState=0;this.responseText=this.response=null;this.responseType=
"";this.responseXML=null;this.status=0;this.statusText="";this.upload={};this.withCredentials=!1;h.set(this,{"content-type":"application/x-www-form-urlencoded"});k.set(this,{})}e(a,[{key:"abort",value:function(){var a=m.get(this);a&&a.abort()}},{key:"getAllResponseHeaders",value:function(){var a=k.get(this);return Object.keys(a).map(function(b){return b+": "+a[b]}).join("\n")}},{key:"getResponseHeader",value:function(a){return k.get(this)[a]}},{key:"open",value:function(b,c){g.set(this,b);f.set(this,
c);d.call(this,a.OPENED)}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var b=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";if(this.readyState!==a.OPENED)throw Error("Failed to execute 'send' on 'XMLHttpRequest': The object's state must be OPENED.");wx.request({data:e,url:f.get(this),method:g.get(this),header:h.get(this),responseType:this.responseType,success:function(e){var f=e.data,g=e.statusCode;e=e.header;if("string"!==typeof f&&!(f instanceof ArrayBuffer))try{f=
JSON.stringify(f)}catch(h){}b.status=g;k.set(b,e);c.call(b,"loadstart");d.call(b,a.HEADERS_RECEIVED);d.call(b,a.LOADING);b.response=f;if(f instanceof ArrayBuffer)for(b.responseText="",f=new Uint8Array(f),g=f.byteLength,e=0;e<g;e++)b.responseText+=String.fromCharCode(f[e]);else b.responseText=f;d.call(b,a.DONE);c.call(b,"load");c.call(b,"loadend")},fail:function(a){a=a.errMsg;-1!==a.indexOf("abort")?c.call(b,"abort"):c.call(b,"error",a);c.call(b,"loadend")}})}},{key:"setRequestHeader",value:function(a,
b){var c=h.get(this);c[a]=b;h.set(this,c)}}]);return a}();n.UNSEND=0;n.OPENED=1;n.HEADERS_RECEIVED=2;n.LOADING=3;n.DONE=4;b.default=n},function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(b,c){for(var d=0;d<c.length;d++){var e=c[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(b,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),d=new WeakMap,e=function(){function a(b){var c=this,e=
1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.binaryType="";this.bufferedAmount=0;this.extensions="";this.onopen=this.onmessage=this.onerror=this.onclose=null;this.protocol="";this.readyState=3;if("string"!==typeof b||!/(^ws:\/\/)|(^wss:\/\/)/.test(b))throw new TypeError("Failed to construct 'WebSocket': The URL '"+b+"' is invalid");this.url=b;this.readyState=a.CONNECTING;e=wx.connectSocket({url:b,protocols:Array.isArray(e)?
e:[e]});d.set(this,e);e.onClose(function(b){c.readyState=a.CLOSED;if("function"===typeof c.onclose)c.onclose(b)});e.onMessage(function(a){if("function"===typeof c.onmessage)c.onmessage(a)});e.onOpen(function(){c.readyState=a.OPEN;if("function"===typeof c.onopen)c.onopen()});e.onError(function(a){if("function"===typeof c.onerror)c.onerror(Error(a.errMsg))});return this}c(a,[{key:"close",value:function(b,c){this.readyState=a.CLOSING;d.get(this).close({code:b,reason:c})}},{key:"send",value:function(a){if("string"!==
typeof a&&!(a instanceof ArrayBuffer))throw new TypeError("Failed to send message: The data "+a+" is invalid");d.get(this).send({data:a})}}]);return a}();e.CONNECTING=0;e.OPEN=1;e.CLOSING=2;e.CLOSED=3;b.default=e},function(a,b){Object.defineProperty(b,"__esModule",{value:!0});b.default=function d(){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");}},function(a,b){Object.defineProperty(b,"__esModule",{value:!0});b.default={get length(){return wx.getStorageInfoSync().keys.length},
key:function(a){return wx.getStorageInfoSync().keys[a]},getItem:function(a){return wx.getStorageSync(a)},setItem:function(a,b){return wx.setStorageSync(a,b)},removeItem:function(a){wx.removeStorageSync(a)},clear:function(){wx.clearStorageSync()}}},function(a,b){Object.defineProperty(b,"__esModule",{value:!0});b.default={href:"game.js",reload:function(){}}}]);var cc=cc||{};cc._tmp=cc._tmp||{};cc._LogInfos={};var _p=window,_p=Object.prototype,_p=null;cc._drawingUtil=null;cc._renderContext=null;
cc._supportRender=!1;cc._canvas=null;cc.container=null;cc._gameDiv=null;window.ENABLE_IMAEG_POOL=!0;cc.each=function(a,b,c){if(a)if(a instanceof Array)for(var d=0,e=a.length;d<e&&!1!==b.call(c,a[d],d);d++);else for(d in a)if(!1===b.call(c,a[d],d))break};cc.extend=function(a){var b=2<=arguments.length?Array.prototype.slice.call(arguments,1):[];cc.each(b,function(b){for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d])});return a};
cc.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a};cc.isFunction=function(a){return"function"===typeof a};cc.isNumber=function(a){return"number"===typeof a||"[object Number]"===Object.prototype.toString.call(a)};cc.isString=function(a){return"string"===typeof a||"[object String]"===Object.prototype.toString.call(a)};cc.isArray=function(a){return Array.isArray(a)||"object"===typeof a&&"[object Array]"===Object.prototype.toString.call(a)};
cc.isUndefined=function(a){return"undefined"===typeof a};cc.isObject=function(a){return"object"===typeof a&&"[object Object]"===Object.prototype.toString.call(a)};cc.isCrossOrigin=function(a){if(!a)return cc.log("invalid URL"),!1;var b=a.indexOf("://");if(-1===b)return!1;b=a.indexOf("/",b+3);return(-1===b?a:a.substring(0,b))!==location.origin};
cc.AsyncPool=function(a,b,c,d,e){var f=this;f._finished=!1;f._srcObj=a;f._limit=b;f._pool=[];f._iterator=c;f._iteratorTarget=e;f._onEnd=d;f._onEndTarget=e;f._results=a instanceof Array?[]:{};f._errors=a instanceof Array?[]:{};cc.each(a,function(a,b){f._pool.push({index:b,value:a})});f.size=f._pool.length;f.finishedSize=0;f._workingSize=0;f._limit=f._limit||f.size;f.onIterator=function(a,b){f._iterator=a;f._iteratorTarget=b};f.onEnd=function(a,b){f._onEnd=a;f._onEndTarget=b};f._handleItem=function(){var a=
this;if(!(0===a._pool.length||a._workingSize>=a._limit)){var b=a._pool.shift(),c=b.value,d=b.index;a._workingSize++;a._iterator.call(a._iteratorTarget,c,d,function(b,c){if(!a._finished)if(b?a._errors[this.index]=b:a._results[this.index]=c,a.finishedSize++,a._workingSize--,a.finishedSize===a.size)a.onEnd(0===a._errors.length?null:a._errors,a._results);else a._handleItem()}.bind(b),a)}};f.flow=function(){if(0===this._pool.length)this._onEnd&&this._onEnd.call(this._onEndTarget,null,[]);else for(var a=
0;a<this._limit;a++)this._handleItem()};f.onEnd=function(a,b){f._finished=!0;if(f._onEnd){var c=f._onEnd,d=f._onEndTarget;f._onEnd=null;f._onEndTarget=null;c.call(d,a,b)}}};
cc.async={series:function(a,b,c){a=new cc.AsyncPool(a,1,function(a,b,f){a.call(c,f)},b,c);a.flow();return a},parallel:function(a,b,c){a=new cc.AsyncPool(a,0,function(a,b,f){a.call(c,f)},b,c);a.flow();return a},waterfall:function(a,b,c){var d=[],e=[null],f=new cc.AsyncPool(a,1,function(b,f,k){d.push(function(b){d=Array.prototype.slice.call(arguments,1);a.length-1===f&&(e=e.concat(d));k.apply(null,arguments)});b.apply(c,d)},function(a){if(b){if(a)return b.call(c,a);b.apply(c,e)}});f.flow();return f},
map:function(a,b,c,d){var e=b;"object"===typeof b&&(c=b.cb,d=b.iteratorTarget,e=b.iterator);a=new cc.AsyncPool(a,0,e,c,d);a.flow();return a},mapLimit:function(a,b,c,d,e){a=new cc.AsyncPool(a,b,c,d,e);a.flow();return a}};
cc.path={normalizeRE:/[^\.\/]+\/\.\.\//,join:function(){for(var a=arguments.length,b="",c=0;c<a;c++)b=(b+(""===b?"":"/")+arguments[c]).replace(/(\/|\\\\)$/,"");return b},extname:function(a){return(a=/(\.[^\.\/\?\\]*)(\?.*)?$/.exec(a))?a[1]:null},mainFileName:function(a){if(a){var b=a.lastIndexOf(".");if(-1!==b)return a.substring(0,b)}return a},basename:function(a,b){var c=a.indexOf("?");0<c&&(a=a.substring(0,c));c=/(\/|\\\\)([^(\/|\\\\)]+)$/g.exec(a.replace(/(\/|\\\\)$/,""));if(!c)return null;c=c[2];
return b&&a.substring(a.length-b.length).toLowerCase()===b.toLowerCase()?c.substring(0,c.length-b.length):c},dirname:function(a){return a.replace(/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,"$2")},changeExtname:function(a,b){b=b||"";var c=a.indexOf("?"),d="";0<c&&(d=a.substring(c),a=a.substring(0,c));c=a.lastIndexOf(".");return 0>c?a+b+d:a.substring(0,c)+b+d},changeBasename:function(a,b,c){if(0===b.indexOf("."))return this.changeExtname(a,b);var d=a.indexOf("?"),e="";c=c?this.extname(a):"";0<d&&(e=a.substring(d),
a=a.substring(0,d));d=a.lastIndexOf("/");return a.substring(0,0>=d?0:d+1)+b+c+e},_normalize:function(a){var b=a=String(a);do b=a,a=a.replace(this.normalizeRE,"");while(b.length!==a.length);return a}};
var imagePool={_pool:Array(10),_MAX:10,_smallImg:"data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA\x3d",count:0,get:function(){if(0<this.count){this.count--;var a=this._pool[this.count];this._pool[this.count]=null;return a}return new Image},put:function(a){if(!window.wx){var b=this._pool;a instanceof window.HTMLImageElement&&this.count<this._MAX&&(a.src=this._smallImg,b[this.count]=a,this.count++)}}};
cc.loader=function(){var a={},b={},c={},d={},e={},f=/^(?:https?|ftp):\/\/\S*$/i;return{resPath:"",audioPath:"",cache:{},getXMLHttpRequest:function(){var a=window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP");a.timeout=1E4;void 0===a.ontimeout&&(a._timeoutId=-1);return a},_getArgs4Js:function(a){var b=a[0],c=a[1],d=a[2],e=["",null,null];if(1===a.length)e[1]=b instanceof Array?b:[b];else if(2===a.length)"function"===typeof c?(e[1]=b instanceof Array?b:[b],e[2]=c):(e[0]=
b||"",e[1]=c instanceof Array?c:[c]);else if(3===a.length)e[0]=b||"",e[1]=c instanceof Array?c:[c],e[2]=d;else throw Error("arguments error to load js!");return e},isLoading:function(a){return void 0!==e[a]},loadJs:function(b,c,d){var e=this,f=e._getArgs4Js(arguments),p=f[0],r=f[1],f=f[2];-1<navigator.userAgent.indexOf("Trident/5")?e._loadJs4Dependency(p,r,0,f):cc.async.map(r,function(b,c,d){b=cc.path.join(p,b);if(a[b])return d(null);e._createScript(b,!1,d)},f)},loadJsWithImg:function(a,b,c){var d=
this._loadJsImg(),e=this._getArgs4Js(arguments);this.loadJs(e[0],e[1],function(a){if(a)throw Error(a);d.parentNode.removeChild(d);if(e[2])e[2]()})},_createScript:function(b,c,d){var e=document,f=document.createElement("script");f.async=c;a[b]=!0;cc.game.config.noCache&&"string"===typeof b?this._noCacheRex.test(b)?f.src=b+"\x26_t\x3d"+(new Date-0):f.src=b+"?_t\x3d"+(new Date-0):f.src=b;f.addEventListener("load",function(){f.parentNode.removeChild(f);this.removeEventListener("load",arguments.callee,
!1);d()},!1);f.addEventListener("error",function(){f.parentNode.removeChild(f);d("Load "+b+" failed!")},!1);e.body.appendChild(f)},_loadJs4Dependency:function(a,b,c,d){if(c>=b.length)d&&d();else{var e=this;e._createScript(cc.path.join(a,b[c]),!1,function(f){if(f)return d(f);e._loadJs4Dependency(a,b,c+1,d)})}},_loadJsImg:function(){var a=document,b=a.getElementById("cocos2d_loadJsImg");if(!b){b=document.createElement("img");cc._loadingImage&&(b.src=cc._loadingImage);a=a.getElementById(cc.game.config.id);
a.style.backgroundColor="transparent";a.parentNode.appendChild(b);var c=getComputedStyle?getComputedStyle(a):a.currentStyle;c||(c={width:a.width,height:a.height});b.style.left=a.offsetLeft+(parseFloat(c.width)-b.width)/2+"px";b.style.top=a.offsetTop+(parseFloat(c.height)-b.height)/2+"px";b.style.position="absolute"}return b},_Utf8ArrayToStr:function(a){var b,c,d,e,f,r;b="";d=a.length;for(c=0;c<d;)switch(e=a[c++],e>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=String.fromCharCode(e);
break;case 12:case 13:f=a[c++];b+=String.fromCharCode((e&31)<<6|f&63);break;case 14:f=a[c++],r=a[c++],b+=String.fromCharCode((e&15)<<12|(f&63)<<6|(r&63)<<0)}return b},loadTxt:function(a,b){var c=this;if(LocalResManager.enable&&!LocalResManager.isInitLocal(a))LocalResManager.loadTxt(a,function(a,c){b(a,c)});else{a=cc.loader.getUrl("",a);var d="https"!=a.slice(0,5)?!0:!1;if(window.wx&&d){if(d=wx.getFileSystemManager&&wx.getFileSystemManager().readFile||wx.readFile)return d({filePath:a,success:function(a){a=
new Uint8Array(a.data||a);a=c._Utf8ArrayToStr(a);b(null,a)},fail:function(a){a=a.errMsg||a;console.log(a);"string"!==typeof a&&(a=JSON.stringify(a));b({status:500,errorMessage:a},null)}});a=cc.loader.getUrl("",a)}if(cc._isNodeJs)require("fs").readFile(a,function(a,c){a?b(a):b(null,c.toString())});else{var e=this.getXMLHttpRequest(),f="load "+a+" failed!";e.open("GET",a,!0);/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)?(e.setRequestHeader("Accept-Charset","utf-8"),e.onreadystatechange=
function(){4===e.readyState&&(200===e.status?b(null,e.responseText):b({status:e.status,errorMessage:f},null))}):(e.overrideMimeType&&e.overrideMimeType("text/plain; charset\x3dutf-8"),e.onload=function(){0<=e._timeoutId&&clearTimeout(e._timeoutId);4===e.readyState&&(200===e.status?b(null,e.responseText):b({status:e.status,errorMessage:f},null))},e.onerror=function(){b({status:e.status,errorMessage:f},null)},void 0===e.ontimeout&&(e._timeoutId=setTimeout(function(){e.ontimeout()},e.timeout)),e.ontimeout=
function(){b({status:e.status,errorMessage:"Request timeout: "+f},null)});e.send(null)}}},loadCsb:function(a,b){var c=cc.loader.getXMLHttpRequest(),d="load "+a+" failed!";c.open("GET",a,!0);c.responseType="arraybuffer";c.onload=function(){0<=c._timeoutId&&clearTimeout(c._timeoutId);var a=c.response;a&&(window.msg=a);4===c.readyState&&(200===c.status?b(null,c.response):b({status:c.status,errorMessage:d},null))};c.onerror=function(){b({status:c.status,errorMessage:d},null)};void 0===c.ontimeout&&(c._timeoutId=
setTimeout(function(){c.ontimeout()},c.timeout));c.ontimeout=function(){b({status:c.status,errorMessage:"Request timeout: "+d},null)};c.send(null)},loadJson:function(a,b){a=cc.loader.getUrl("",a);this.loadTxt(a,function(c,d){if(c)b(c);else{try{var e=JSON.parse(d)}catch(f){throw Error("parse json ["+a+"] failed : "+f);}b(null,e)}})},_checkIsImageURL:function(a){return null!=/(\.png)|(\.jpg)|(\.bmp)|(\.jpeg)|(\.gif)/.exec(a)},loadImg:function(a,b,c,d){var f=a+"",p=a=cc.loader.getUrl("",a),r={isCrossOrigin:!0};
void 0!==c?r.isCrossOrigin=void 0===b.isCrossOrigin?r.isCrossOrigin:b.isCrossOrigin:void 0!==b&&(c=b);if(b=this.getRes(a))return c&&c(null,b),null;if(LocalResManager.enable&&!LocalResManager.isInitLocal(a))LocalResManager.loadImage(f,c);else{if(f=e[a])return f.callbacks.push(c),f.img.src=p,f.img;d=d||imagePool.get();d.crossOrigin=r.isCrossOrigin&&"file://"!==location.origin?"Anonymous":null;var s=function(){this.removeEventListener("load",s,!1);this.removeEventListener("error",t,!1);var b=e[a];if(b){for(var c=
b.callbacks,f=0;f<c.length;++f){var h=c[f];h&&h(null,d)}b.img=null;delete e[a]}ENABLE_IMAEG_POOL&&cc._renderType===cc.game.RENDER_TYPE_WEBGL&&imagePool.put(d)},u=this,t=function(){this.removeEventListener("load",s,!1);this.removeEventListener("error",t,!1);if("https:"!==window.location.protocol&&d.crossOrigin&&"anonymous"===d.crossOrigin.toLowerCase())r.isCrossOrigin=!1,u.release(a),cc.loader.loadImg(a,r,c,d);else{var b=e[a];if(b){for(var f=b.callbacks,h=0;h<f.length;++h){var n=f[h];n&&n("load image failed")}b.img=
null;delete e[a]}cc._renderType===cc.game.RENDER_TYPE_WEBGL&&imagePool.put(d)}};e[a]={img:d,callbacks:c?[c]:[]};d.addEventListener("load",s);d.addEventListener("error",t);d.src=p;return d}},_loadResIterator:function(a,c,d){var e=this,n=null,p=a.type;p?(p="."+p.toLowerCase(),n=a.src?a.src:a.name+p):(n=a,p=cc.path.extname(n));if(c=e.getRes(n))return d(null,c);c=null;p&&(c=b[p.toLowerCase()]);if(!c)return cc.error("loader for ["+p+"] not exists!"),d();p=n;f.test(n)||window.wx||(p=c.getBasePath?c.getBasePath():
e.resPath,p=e.getUrl(p,n));cc.game.config.noCache&&"string"===typeof p&&(p=e._noCacheRex.test(p)?p+("\x26_t\x3d"+(new Date-0)):p+("?_t\x3d"+(new Date-0)));c.load(p,n,a,function(a,b){a?(cc.log(a),e.cache[n]=null,delete e.cache[n],d({status:520,errorMessage:a},null)):(e.cache[n]=b,d(null,b))})},_noCacheRex:/\?/,getUrl:function(a,d){if(window.wx)return window.pre=window.pre||"",LocalResManager.getUrl(d);var e=cc.path;if(void 0!==a&&void 0===d){d=a;var f=e.extname(d),f=f?f.toLowerCase():"";a=(f=b[f])?
f.getBasePath?f.getBasePath():this.resPath:this.resPath}d=cc.path.join(a||"",d);if(d.match(/[\/(\\\\)]lang[\/(\\\\)]/i)){if(c[d])return c[d];e=e.extname(d)||"";d=c[d]=d.substring(0,d.length-e.length)+"_"+cc.sys.language+e}return d},load:function(a,b,c){var d=this,e=arguments.length;if(0===e)throw Error("arguments error!");3===e?"function"===typeof b&&(b="function"===typeof c?{trigger:b,cb:c}:{cb:b,cbTarget:c}):2===e?"function"===typeof b&&(b={cb:b}):1===e&&(b={});a instanceof Array||(a=[a]);e=new cc.AsyncPool(a,
cc.CONCURRENCY_HTTP_REQUEST_COUNT,function(a,c,e,f){d._loadResIterator(a,c,function(a){var c=Array.prototype.slice.call(arguments,1);b.trigger&&b.trigger.call(b.triggerTarget,c[0],f.size,f.finishedSize);e(a,c[0])})},b.cb,b.cbTarget);e.flow();return e},_handleAliases:function(a,b){var c=[],e;for(e in a){var f=a[e];d[e]=f;c.push(f)}this.load(c,b)},loadAliases:function(a,b){var c=this,d=c.getRes(a);d?c._handleAliases(d.filenames,b):c.load(a,function(a,d){c._handleAliases(d[0].filenames,b)})},register:function(a,
c){if(a&&c){if("string"===typeof a)return b[a.trim().toLowerCase()]=c;for(var d=0,e=a.length;d<e;d++)b["."+a[d].trim().toLowerCase()]=c}},getRes:function(a){return this.cache[a]||this.cache[d[a]]},_getAliase:function(a){return d[a]},release:function(a){var b=this.cache,c=e[a];c&&(c.img=null,delete e[a]);delete b[a];delete b[d[a]];delete d[a]},releaseAll:function(){var a=this.cache,b;for(b in a)delete a[b];for(b in d)delete d[b]}}}();
cc.formatStr=function(){var a=arguments,b=a.length;if(1>b)return"";var c=a[0],d=!0;"object"===typeof c&&(d=!1);for(var e=1;e<b;++e){var f=a[e];if(d)for(;;){var g=null;if("number"===typeof f&&(g=c.match(/(%d)|(%s)/))){c=c.replace(/(%d)|(%s)/,f);break}(g=c.match(/%s/))&&(c=c.replace(/%s/,f));break}}return c};
(function(){function a(a){var b=cc.game.CONFIG_KEY,c=parseInt(a[b.renderMode])||0;if(isNaN(c)||2<c||0>c)a[b.renderMode]=0;cc._renderType=cc.game.RENDER_TYPE_CANVAS;cc._supportRender=!1;0===c?cc.sys.capabilities.opengl?(cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0):cc.sys.capabilities.canvas&&(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0):1===c&&cc.sys.capabilities.canvas?(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0):2===c&&cc.sys.capabilities.opengl&&
(cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0)}function b(a,c,d){if(h[c])return null;d=d||"";var e=[],f=a[c];if(!f)throw Error("can not find module ["+c+"]");c=cc.path;for(var g=0,k=f.length;g<k;g++){var m=f[g];if(!h[m]){var x=c.extname(m);x?".js"===x.toLowerCase()&&e.push(c.join(d,m)):(x=b(a,m,d))&&(e=e.concat(x));h[m]=1}}return e}function c(a){cc._initDebugSetting&&cc._initDebugSetting(a[cc.game.CONFIG_KEY.debugMode]);cc._engineLoaded=!0;console.log(cc.ENGINE_VERSION);m&&m()}function d(a){var d=
a[cc.game.CONFIG_KEY.engineDir],e=cc.loader;if(cc.Class)c(a);else{var f=cc.path.join(d,"moduleConfig.json");e.loadJson(f,function(e,f){if(e)throw Error(e);var g=a.modules||[],h=f.module,k=[];cc.sys.capabilities.opengl&&0>g.indexOf("base4webgl")?g.splice(0,0,"base4webgl"):0>g.indexOf("core")&&g.splice(0,0,"core");for(var m=0,s=g.length;m<s;m++){var r=b(h,g[m],d);r&&(k=k.concat(r))}cc.loader.loadJsWithImg(k,function(b){if(b)throw b;c(a)})})}}function e(){this.removeEventListener("load",e,!1);d(cc.game.config)}
var f=document.createElement("canvas"),g=document.createElement("canvas");cc.create3DContext=function(a,b){var c=["webgl","experimental-webgl","webkit-3d","moz-webgl"],d=null;b&&(b.preserveDrawingBuffer=!0);for(var e=0;e<c.length;++e){try{d=a.getContext(c[e],b)}catch(f){}if(d)break}return d};(function(){cc.sys={};var a=cc.sys;a.LANGUAGE_ENGLISH="en";a.LANGUAGE_CHINESE="zh";a.LANGUAGE_FRENCH="fr";a.LANGUAGE_ITALIAN="it";a.LANGUAGE_GERMAN="de";a.LANGUAGE_SPANISH="es";a.LANGUAGE_DUTCH="du";a.LANGUAGE_RUSSIAN=
"ru";a.LANGUAGE_KOREAN="ko";a.LANGUAGE_JAPANESE="ja";a.LANGUAGE_HUNGARIAN="hu";a.LANGUAGE_PORTUGUESE="pt";a.LANGUAGE_ARABIC="ar";a.LANGUAGE_NORWEGIAN="no";a.LANGUAGE_POLISH="pl";a.LANGUAGE_UNKNOWN="unkonwn";a.OS_IOS="iOS";a.OS_ANDROID="Android";a.OS_WINDOWS="Windows";a.OS_MARMALADE="Marmalade";a.OS_LINUX="Linux";a.OS_BADA="Bada";a.OS_BLACKBERRY="Blackberry";a.OS_OSX="OS X";a.OS_WP8="WP8";a.OS_WINRT="WINRT";a.OS_UNKNOWN="Unknown";a.UNKNOWN=-1;a.WIN32=0;a.LINUX=1;a.MACOS=2;a.ANDROID=3;a.IPHONE=4;a.IPAD=
5;a.BLACKBERRY=6;a.NACL=7;a.EMSCRIPTEN=8;a.TIZEN=9;a.WINRT=10;a.WP8=11;a.MOBILE_BROWSER=100;a.DESKTOP_BROWSER=101;a.BROWSER_TYPE_WECHAT="wechat";a.BROWSER_TYPE_ANDROID="androidbrowser";a.BROWSER_TYPE_IE="ie";a.BROWSER_TYPE_QQ_APP="qq";a.BROWSER_TYPE_QQ="qqbrowser";a.BROWSER_TYPE_MOBILE_QQ="mqqbrowser";a.BROWSER_TYPE_UC="ucbrowser";a.BROWSER_TYPE_360="360browser";a.BROWSER_TYPE_BAIDU_APP="baiduboxapp";a.BROWSER_TYPE_BAIDU="baidubrowser";a.BROWSER_TYPE_MAXTHON="maxthon";a.BROWSER_TYPE_OPERA="opera";
a.BROWSER_TYPE_OUPENG="oupeng";a.BROWSER_TYPE_MIUI="miuibrowser";a.BROWSER_TYPE_FIREFOX="firefox";a.BROWSER_TYPE_SAFARI="safari";a.BROWSER_TYPE_CHROME="chrome";a.BROWSER_TYPE_LIEBAO="liebao";a.BROWSER_TYPE_QZONE="qzone";a.BROWSER_TYPE_SOUGOU="sogou";a.BROWSER_TYPE_UNKNOWN="unknown";a.isNative=!1;var b=window,c=b.navigator,d=document,e=d.documentElement,h=c.userAgent.toLowerCase();a.isMobile=window.wx?!0:/mobile|android|iphone|ipad/.test(h);a.platform=a.isMobile?a.MOBILE_BROWSER:a.DESKTOP_BROWSER;
var k=c.language,k=(k=k?k:c.browserLanguage)?k.split("-")[0]:a.LANGUAGE_ENGLISH;a.language=k;var m=!1,k=!1,x="",A=0,y=/android (\d+(?:\.\d+)+)/i.exec(h)||/android (\d+(?:\.\d+)+)/i.exec(c.platform);y&&(m=!0,x=y[1]||"",A=parseInt(x)||0);(y=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(h))?(k=!0,x=y[2]||"",A=parseInt(x)||0):/(iPhone|iPad|iPod)/.exec(c.platform)&&(k=!0,x="",A=0);y=a.OS_UNKNOWN;-1!==c.appVersion.indexOf("Win")?y=a.OS_WINDOWS:k?y=a.OS_IOS:-1!==c.appVersion.indexOf("Mac")?y=a.OS_OSX:-1!==
c.appVersion.indexOf("X11")&&-1===c.appVersion.indexOf("Linux")?y=a.OS_UNIX:m?y=a.OS_ANDROID:-1!==c.appVersion.indexOf("Linux")&&(y=a.OS_LINUX);a.os=y;a.osVersion=x;a.osMainVersion=A;a.browserType=a.BROWSER_TYPE_UNKNOWN;(function(){var b=/qqbrowser|qq|chrome|safari|firefox|opr|oupeng|opera/i,c=/micromessenger|mqqbrowser|sogou|qzone|liebao|ucbrowser|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|trident|miuibrowser/i.exec(h);c||(c=b.exec(h));b=c?c[0]:a.BROWSER_TYPE_UNKNOWN;"micromessenger"===
b?b=a.BROWSER_TYPE_WECHAT:"safari"===b&&m?b=a.BROWSER_TYPE_ANDROID:"trident"===b?b=a.BROWSER_TYPE_IE:"360 aphone"===b?b=a.BROWSER_TYPE_360:"mxbrowser"===b?b=a.BROWSER_TYPE_MAXTHON:"opr"===b&&(b=a.BROWSER_TYPE_OPERA);a.browserType=b})();a.browserVersion="";(function(){var b=/(msie |rv:|firefox|chrome|ucbrowser|qq|oupeng|opera|opr|safari|miui)(mobile)?(browser)?\/?([\d.]+)/i,c=h.match(/(mqqbrowser|micromessenger|sogou|qzone|liebao|maxthon|mxbrowser|baidu)(mobile)?(browser)?\/?([\d.]+)/i);c||(c=h.match(b));
a.browserVersion=c?c[4]:""})();k=window.devicePixelRatio||1;a.windowPixelResolution={width:k*(window.innerWidth||document.documentElement.clientWidth),height:k*(window.innerHeight||document.documentElement.clientHeight)};a._checkWebGLRenderMode=function(){if(cc._renderType!==cc.game.RENDER_TYPE_WEBGL)throw Error("This feature supports WebGL render mode only.");};a._supportCanvasNewBlendModes=function(){var a=f;a.width=1;a.height=1;a=a.getContext("2d");a.fillStyle="#000";a.fillRect(0,0,1,1);a.globalCompositeOperation=
"multiply";var b=g;b.width=1;b.height=1;var c=b.getContext("2d");c.fillStyle="#fff";c.fillRect(0,0,1,1);a.drawImage(b,0,0,1,1);return 0===a.getImageData(0,0,1,1).data[0]}();cc.sys.isMobile&&!window.wx&&(k=document.createElement("style"),k.type="text/css",document.body.appendChild(k),k.textContent="body,canvas,div{ -moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;-khtml-user-select: none;-webkit-tap-highlight-color:rgba(0,0,0,0);}");try{if(window.wx)a.localStorage={getItem:function(a){return wx.getStorageSync(a)},
setItem:function(a,b){try{wx.setStorageSync(a,b)}catch(c){}},removeItem:function(a){try{wx.removeStorageSync(a)}catch(b){}},clear:function(){try{wx.clearStorageSync()}catch(a){}}};else{var z=a.localStorage=b.localStorage;z.setItem("storage","");z.removeItem("storage");z=null}}catch(B){z=function(){cc.warn("Warning: localStorage isn't enabled. Please confirm browser cookie or privacy option")},a.localStorage={getItem:z,setItem:z,removeItem:z,clear:z}}z=!!f.getContext("2d");k=!1;if(window.wx)k=!0;else if(b.WebGLRenderingContext){x=
document.createElement("CANVAS");try{if(cc.create3DContext(x)&&(k=!0),k&&a.os===a.OS_IOS&&9===a.osMainVersion&&(window.indexedDB||(k=!1)),k&&a.os===a.OS_ANDROID){var D=parseFloat(a.browserVersion);switch(a.browserType){case a.BROWSER_TYPE_MOBILE_QQ:case a.BROWSER_TYPE_BAIDU:case a.BROWSER_TYPE_BAIDU_APP:k=6.2<=D?!0:!1;break;case a.BROWSER_TYPE_CHROME:k=30<=D?!0:!1;break;case a.BROWSER_TYPE_ANDROID:a.osMainVersion&&5<=a.osMainVersion&&(k=!0);break;case a.BROWSER_TYPE_UNKNOWN:case a.BROWSER_TYPE_360:case a.BROWSER_TYPE_MIUI:case a.BROWSER_TYPE_UC:k=
!1}}}catch(C){}x=null}D=a.capabilities={canvas:z,opengl:k};if(void 0!==e.ontouchstart||void 0!==d.ontouchstart||c.msPointerEnabled)D.touches=!0;void 0!==e.onmouseup&&(D.mouse=!0);void 0!==e.onkeyup&&(D.keyboard=!0);if(b.DeviceMotionEvent||b.DeviceOrientationEvent)D.accelerometer=!0;a.garbageCollect=function(){};a.dumpRoot=function(){};a.restartVM=function(){};a.cleanScript=function(a){};a.isObjectValid=function(a){return a?!0:!1};a.dump=function(){var a;a=""+("isMobile : "+this.isMobile+"\r\n");a+=
"language : "+this.language+"\r\n";a+="browserType : "+this.browserType+"\r\n";a+="browserVersion : "+this.browserVersion+"\r\n";a+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n";a+="os : "+this.os+"\r\n";a+="osVersion : "+this.osVersion+"\r\n";a+="platform : "+this.platform+"\r\n";a+="Using "+(cc._renderType===cc.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n";cc.log(a)};a.openURL=function(a){window.open(a)};a.now=function(){return Date.now?Date.now():+new Date}})();g=f=null;
cc.log=cc.warn=cc.error=cc.assert=function(){};var h={},k=!1,m=null;cc._engineLoaded=!1;cc.initEngine=function(b,c){if(k){var f=m;m=function(){f&&f();c&&c()}}else m=c,!cc.game.config&&b?cc.game.config=b:cc.game.config||cc.game._loadConfig(),b=cc.game.config,a(b),document.body?d(b):cc._addEventListener(window,"load",e,!1),k=!0}})();
cc.game={DEBUG_MODE_NONE:0,DEBUG_MODE_INFO:1,DEBUG_MODE_WARN:2,DEBUG_MODE_ERROR:3,DEBUG_MODE_INFO_FOR_WEB_PAGE:4,DEBUG_MODE_WARN_FOR_WEB_PAGE:5,DEBUG_MODE_ERROR_FOR_WEB_PAGE:6,EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_RESIZE:"game_on_resize",EVENT_RENDERER_INITED:"renderer_inited",RENDER_TYPE_CANVAS:0,RENDER_TYPE_WEBGL:1,RENDER_TYPE_OPENGL:2,_eventHide:null,_eventShow:null,CONFIG_KEY:{width:"width",height:"height",engineDir:"engineDir",modules:"modules",debugMode:"debugMode",exposeClassName:"exposeClassName",
showFPS:"showFPS",frameRate:"frameRate",id:"id",renderMode:"renderMode",jsList:"jsList"},_paused:!0,_configLoaded:!1,_prepareCalled:!1,_prepared:!1,_rendererInitialized:!1,_renderContext:null,_intervalId:null,_lastTime:null,_frameTime:null,frame:null,container:null,canvas:null,config:null,onStart:null,onStop:null,setFrameRate:function(a){this.config[this.CONFIG_KEY.frameRate]=a;this._intervalId&&window.cancelAnimationFrame(this._intervalId);this._intervalId=0;this._paused=!0;this._setAnimFrame();
this._runMainLoop()},step:function(){cc.director.mainLoop()},pause:function(){this._paused||(this._paused=!0,cc.audioEngine&&cc.audioEngine._pausePlaying(),this._intervalId&&window.cancelAnimationFrame(this._intervalId),this._intervalId=0)},resume:function(){this._paused&&(this._paused=!1,cc.audioEngine&&cc.audioEngine._resumePlaying(),this._runMainLoop())},isPaused:function(){return this._paused},restart:function(){cc.director.popToSceneStackLevel(0);cc.audioEngine&&cc.audioEngine.end();cc.game.onStart()},
end:function(){close()},prepare:function(a){var b=this,c=b.config,d=b.CONFIG_KEY;this._configLoaded?this._prepared?a&&a():this._prepareCalled||(cc._engineLoaded?(this._prepareCalled=!0,this._initRenderer(c[d.width],c[d.height]),cc.view=cc.EGLView._getInstance(),cc.director=cc.Director._getInstance(),cc.director.setOpenGLView&&cc.director.setOpenGLView(cc.view),cc.winSize=cc.director.getWinSize(),this._initEvents(),this._setAnimFrame(),this._runMainLoop(),(c=c[d.jsList])?cc.loader.loadJsWithImg(c,
function(c){if(c)throw Error(c);b._prepared=!0;a&&a()}):a&&a()):cc.initEngine(this.config,function(){b.prepare(a)})):this._loadConfig(function(){b.prepare(a)})},run:function(a,b){"function"===typeof a?cc.game.onStart=a:(a&&("string"===typeof a?(cc.game.config||this._loadConfig(),cc.game.config[cc.game.CONFIG_KEY.id]=a):cc.game.config=a),"function"===typeof b&&(cc.game.onStart=b));this.prepare(cc.game.onStart&&cc.game.onStart.bind(cc.game))},_setAnimFrame:function(){this._lastTime=new Date;var a=cc.game.config[cc.game.CONFIG_KEY.frameRate];
this._frameTime=1E3/a;60!==a&&30!==a?(window.requestAnimFrame=this._stTime,window.cancelAnimationFrame=this._ctTime):(window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||this._stTime,window.cancelAnimationFrame=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||
window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.oCancelAnimationFrame||this._ctTime)},_stTime:function(a){var b=(new Date).getTime(),c=Math.max(0,cc.game._frameTime-(b-cc.game._lastTime)),d=window.setTimeout(function(){a()},c);cc.game._lastTime=b+c;return d},_ctTime:function(a){window.clearTimeout(a)},_runMainLoop:function(){var a=this,b,c=a.config,d=a.CONFIG_KEY,e=cc.director,f=!0,g=c[d.frameRate];
e.setDisplayStats(c[d.showFPS]);b=function(){a._paused||(30===g&&(f=!f)||e.mainLoop(),a._intervalId=window.requestAnimFrame(b))};a._intervalId=window.requestAnimFrame(b);a._paused=!1},_loadConfig:function(a){var b=this.config||document.ccConfig;if(b)this._initConfig(b),a&&a();else if(window.wx){var c=this,b=function(b,d){if(b)console.log("project.json\u52a0\u8f7d\u9519\u8bef");else{var e=JSON.parse(d);c._initConfig(e);a&&a()}};cc.loader.loadTxt("res/project.json",b)}else{for(var d=document.getElementsByTagName("script"),
e=0;e<d.length&&(b=d[e].getAttribute("cocos"),""!==b&&!b);e++);c=this;b=function(b,d){var e=JSON.parse(d);c._initConfig(e);a&&a()};if(e<d.length){if(d=d[e].src)d=/(.*)\//.exec(d)[0],cc.loader.resPath=d,d=cc.path.join(d,"project.json");cc.loader.loadTxt(d,b)}cc.loader.loadTxt("project.json",b)}},_initConfig:function(a){var b=this.CONFIG_KEY,c=a[b.modules];a[b.showFPS]="undefined"===typeof a[b.showFPS]?!0:a[b.showFPS];a[b.engineDir]=a[b.engineDir]||"frameworks/cocos2d-html5";null==a[b.debugMode]&&(a[b.debugMode]=
0);a[b.exposeClassName]=!!a[b.exposeClassName];a[b.frameRate]=a[b.frameRate]||60;null==a[b.renderMode]&&(a[b.renderMode]=0);null==a[b.registerSystemEvent]&&(a[b.registerSystemEvent]=!0);c&&0>c.indexOf("core")&&c.splice(0,0,"core");c&&(a[b.modules]=c);this.config=a;this._configLoaded=!0},_initRenderer:function(a,b){if(!this._rendererInitialized){if(!cc._supportRender)throw Error("The renderer doesn't support the renderMode "+this.config[this.CONFIG_KEY.renderMode]);var c=this.config[cc.game.CONFIG_KEY.id],
d=window,c=window.wx?canvas:cc.$(c)||cc.$("#"+c),e,f;window.wx?(this.canvas=cc._canvas=e=c,this.container=cc.container=f=document.createElement("DIV")):("CANVAS"===c.tagName?(a=a||c.width,b=b||c.height,this.canvas=cc._canvas=e=c,this.container=cc.container=f=document.createElement("DIV"),e.parentNode&&e.parentNode.insertBefore(f,e)):("DIV"!==c.tagName&&cc.log("Warning: target element is not a DIV or CANVAS"),a=a||c.clientWidth,b=b||c.clientHeight,this.canvas=cc._canvas=e=cc.$(document.createElement("CANVAS")),
this.container=cc.container=f=document.createElement("DIV"),c.appendChild(f)),f.setAttribute("id","Cocos2dGameContainer"),f.appendChild(e),this.frame=f.parentNode===document.body?document.documentElement:f.parentNode,e.addClass("gameCanvas"),e.setAttribute("width",a||480),e.setAttribute("height",b||320),e.setAttribute("tabindex",99));cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(this._renderContext=cc._renderContext=cc.webglContext=cc.create3DContext(e,{stencil:!0,alpha:!1}));this._renderContext?(cc.renderer=
cc.rendererWebGL,d.gl=this._renderContext,cc.renderer.init(),cc._drawingUtil=new cc.DrawingPrimitiveWebGL(this._renderContext),cc.textureCache._initializingRenderer(),cc.glExt={},cc.glExt.instanced_arrays=d.gl.getExtension("ANGLE_instanced_arrays"),cc.glExt.element_uint=d.gl.getExtension("OES_element_index_uint")):(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc.renderer=cc.rendererCanvas,this._renderContext=cc._renderContext=new cc.CanvasContextWrapper(e.getContext("2d")),cc._drawingUtil=cc.DrawingPrimitiveCanvas?
new cc.DrawingPrimitiveCanvas(this._renderContext):null);cc._gameDiv=f;cc.game.canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable)return!1};this.dispatchEvent(this.EVENT_RENDERER_INITED,!0);this._rendererInitialized=!0}},_initEvents:function(){var a=window,b;this._eventHide=this._eventHide||new cc.EventCustom(this.EVENT_HIDE);this._eventHide.setUserData(this);this._eventShow=this._eventShow||new cc.EventCustom(this.EVENT_SHOW);this._eventShow.setUserData(this);this.config[this.CONFIG_KEY.registerSystemEvent]&&
cc.inputManager.registerSystemEvent(this.canvas);cc.isUndefined(document.hidden)?cc.isUndefined(document.mozHidden)?cc.isUndefined(document.msHidden)?cc.isUndefined(document.webkitHidden)||(b="webkitHidden"):b="msHidden":b="mozHidden":b="hidden";var c=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"],d=function(){cc.eventManager&&cc.game._eventHide&&cc.eventManager.dispatchEvent(cc.game._eventHide)},e=function(){cc.eventManager&&cc.game._eventShow&&
cc.eventManager.dispatchEvent(cc.game._eventShow)};if(b)for(var f=0;f<c.length;f++)document.addEventListener(c[f],function(a){var c=document[b];(c=c||a.hidden)?d():e()},!1);else a.addEventListener("blur",d,!1),a.addEventListener("focus",e,!1);-1<navigator.userAgent.indexOf("MicroMessenger")&&(a.onfocus=function(){e()});"onpageshow"in window&&"onpagehide"in window&&(a.addEventListener("pagehide",d,!1),a.addEventListener("pageshow",e,!1));cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,function(){cc.game.pause()});
cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){cc.game.resume()})}};Function.prototype.bind=Function.prototype.bind||function(a){if(!cc.isFunction(this))throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};d.prototype=this.prototype;e.prototype=new d;return e};
window.cc=cc;cc.EventHelper=function(){};
cc.EventHelper.prototype={constructor:cc.EventHelper,apply:function(a){a.addEventListener=cc.EventHelper.prototype.addEventListener;a.hasEventListener=cc.EventHelper.prototype.hasEventListener;a.removeEventListener=cc.EventHelper.prototype.removeEventListener;a.dispatchEvent=cc.EventHelper.prototype.dispatchEvent},addEventListener:function(a,b,c){if("load"===a&&this._textureLoaded)setTimeout(function(){b.call(c)},0);else{void 0===this._listeners&&(this._listeners={});var d=this._listeners;void 0===
d[a]&&(d[a]=[]);this.hasEventListener(a,b,c)||d[a].push({callback:b,eventTarget:c})}},hasEventListener:function(a,b,c){if(void 0===this._listeners)return!1;var d=this._listeners;if(void 0!==d[a]){a=0;for(var e=d.length;a<e;a++){var f=d[a];if(f.callback===b&&f.eventTarget===c)return!0}}return!1},removeEventListener:function(a,b,c){if(void 0!==this._listeners&&(a=this._listeners[a],void 0!==a))for(var d=0;d<a.length;){var e=a[d];e.eventTarget===c&&e.callback===b?a.splice(d,1):d++}},removeEventTarget:function(a,
b,c){if(void 0!==this._listeners&&(a=this._listeners[a],void 0!==a))for(b=0;b<a.length;)a[b].eventTarget===c?a.splice(b,1):b++},dispatchEvent:function(a,b){if(void 0!==this._listeners){null==b&&(b=!0);var c=this._listeners[a];if(void 0!==c){for(var d=[],e=c.length,f=0;f<e;f++)d[f]=c[f];for(f=0;f<e;f++)d[f].callback.call(d[f].eventTarget,this);b&&(c.length=0)}}}};cc.EventHelper.prototype.apply(cc.game);cc._LogInfos={ActionManager_addAction:"cc.ActionManager.addAction(): action must be non-null",ActionManager_removeAction:"cocos2d: removeAction: Target not found",ActionManager_removeActionByTag:"cc.ActionManager.removeActionByTag(): an invalid tag",ActionManager_removeActionByTag_2:"cc.ActionManager.removeActionByTag(): target must be non-null",ActionManager_getActionByTag:"cc.ActionManager.getActionByTag(): an invalid tag",ActionManager_getActionByTag_2:"cocos2d : getActionByTag(tag \x3d %s): Action not found",
configuration_dumpInfo:"cocos2d: **** WARNING **** CC_ENABLE_PROFILERS is defined. Disable it when you finish profiling (from ccConfig.js)",configuration_loadConfigFile:"Expected 'data' dict, but not found. Config file: %s",configuration_loadConfigFile_2:"Please load the resource first : %s",Director_resume:"cocos2d: Director: Error in gettimeofday",Director_setProjection:"cocos2d: Director: unrecognized projection",Director_popToSceneStackLevel:"cocos2d: Director: unrecognized projection",Director_popToSceneStackLevel_2:"cocos2d: Director: Error in gettimeofday",
Director_popScene:"running scene should not null",Director_pushScene:"the scene should not null",arrayVerifyType:"element type is wrong!",Scheduler_scheduleCallbackForTarget:"CCSheduler#scheduleCallback. Callback already scheduled. Updating interval from:%s to %s",Scheduler_scheduleCallbackForTarget_2:"cc.scheduler.scheduleCallbackForTarget(): callback_fn should be non-null.",Scheduler_scheduleCallbackForTarget_3:"cc.scheduler.scheduleCallbackForTarget(): target should be non-null.",Scheduler_pauseTarget:"cc.Scheduler.pauseTarget():target should be non-null",
Scheduler_resumeTarget:"cc.Scheduler.resumeTarget():target should be non-null",Scheduler_isTargetPaused:"cc.Scheduler.isTargetPaused():target should be non-null",Node_getZOrder:"getZOrder is deprecated. Please use getLocalZOrder instead.",Node_setZOrder:"setZOrder is deprecated. Please use setLocalZOrder instead.",Node_getRotation:"RotationX !\x3d RotationY. Don't know which one to return",Node_getScale:"ScaleX !\x3d ScaleY. Don't know which one to return",Node_addChild:"An Node can't be added as a child of itself.",
Node_addChild_2:"child already added. It can't be added again",Node_addChild_3:"child must be non-null",Node_removeFromParentAndCleanup:"removeFromParentAndCleanup is deprecated. Use removeFromParent instead",Node_boundingBox:"boundingBox is deprecated. Use getBoundingBox instead",Node_removeChildByTag:"argument tag is an invalid tag",Node_removeChildByTag_2:"cocos2d: removeChildByTag(tag \x3d %s): child not found!",Node_removeAllChildrenWithCleanup:"removeAllChildrenWithCleanup is deprecated. Use removeAllChildren instead",
Node_stopActionByTag:"cc.Node.stopActionBy(): argument tag an invalid tag",Node_getActionByTag:"cc.Node.getActionByTag(): argument tag is an invalid tag",Node_resumeSchedulerAndActions:"resumeSchedulerAndActions is deprecated, please use resume instead.",Node_pauseSchedulerAndActions:"pauseSchedulerAndActions is deprecated, please use pause instead.",Node__arrayMakeObjectsPerformSelector:"Unknown callback function",Node_reorderChild:"cc.Node.reorderChild(): child must be non-null",Node_reorderChild_2:"cc.Node.reorderChild(): this child is not in children list",
Node_runAction:"cc.Node.runAction(): action must be non-null",Node_schedule:"callback function must be non-null",Node_schedule_2:"interval must be positive",Node_initWithTexture:"cocos2d: Could not initialize cc.AtlasNode. Invalid Texture.",AtlasNode_updateAtlasValues:"cc.AtlasNode.updateAtlasValues(): Shall be overridden in subclasses",AtlasNode_initWithTileFile:"",AtlasNode__initWithTexture:"cocos2d: Could not initialize cc.AtlasNode. Invalid Texture.",_EventListenerKeyboard_checkAvailable:"cc._EventListenerKeyboard.checkAvailable(): Invalid EventListenerKeyboard!",
_EventListenerTouchOneByOne_checkAvailable:"cc._EventListenerTouchOneByOne.checkAvailable(): Invalid EventListenerTouchOneByOne!",_EventListenerTouchAllAtOnce_checkAvailable:"cc._EventListenerTouchAllAtOnce.checkAvailable(): Invalid EventListenerTouchAllAtOnce!",_EventListenerAcceleration_checkAvailable:"cc._EventListenerAcceleration.checkAvailable(): _onAccelerationEvent must be non-nil",EventListener_create:"Invalid parameter.",__getListenerID:"Don't call this method if the event is for touch.",
eventManager__forceAddEventListener:"Invalid scene graph priority!",eventManager_addListener:"0 priority is forbidden for fixed priority since it's used for scene graph based priority.",eventManager_removeListeners:"Invalid listener type!",eventManager_setPriority:"Can't set fixed priority with scene graph based listener.",eventManager_addListener_2:"Invalid parameters.",eventManager_addListener_3:"listener must be a cc.EventListener object when adding a fixed priority listener",eventManager_addListener_4:"The listener has been registered, please don't register it again.",
LayerMultiplex_initWithLayers:"parameters should not be ending with null in Javascript",LayerMultiplex_switchTo:"Invalid index in MultiplexLayer switchTo message",LayerMultiplex_switchToAndReleaseMe:"Invalid index in MultiplexLayer switchTo message",LayerMultiplex_addLayer:"cc.Layer.addLayer(): layer should be non-null",EGLView_setDesignResolutionSize:"Resolution not valid",EGLView_setDesignResolutionSize_2:"should set resolutionPolicy",inputManager_handleTouchesBegin:"The touches is more than MAX_TOUCHES, nUnusedIndex \x3d %s",
swap:"cc.swap is being modified from original macro, please check usage",checkGLErrorDebug:"WebGL error %s",animationCache__addAnimationsWithDictionary:"cocos2d: cc.AnimationCache: No animations were found in provided dictionary.",animationCache__addAnimationsWithDictionary_2:"cc.AnimationCache. Invalid animation format",animationCache_addAnimations:"cc.AnimationCache.addAnimations(): File could not be found",animationCache__parseVersion1:"cocos2d: cc.AnimationCache: Animation '%s' found in dictionary without any frames - cannot add to animation cache.",
animationCache__parseVersion1_2:"cocos2d: cc.AnimationCache: Animation '%s' refers to frame '%s' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.",animationCache__parseVersion1_3:"cocos2d: cc.AnimationCache: None of the frames for animation '%s' were found in the cc.SpriteFrameCache. Animation is not being added to the Animation Cache.",animationCache__parseVersion1_4:"cocos2d: cc.AnimationCache: An animation in your dictionary refers to a frame which is not in the cc.SpriteFrameCache. Some or all of the frames for the animation '%s' may be missing.",
animationCache__parseVersion2:"cocos2d: CCAnimationCache: Animation '%s' found in dictionary without any frames - cannot add to animation cache.",animationCache__parseVersion2_2:"cocos2d: cc.AnimationCache: Animation '%s' refers to frame '%s' which is not currently in the cc.SpriteFrameCache. This frame will not be added to the animation.",animationCache_addAnimations_2:"cc.AnimationCache.addAnimations(): Invalid texture file name",Sprite_ignoreAnchorPointForPosition:"cc.Sprite.ignoreAnchorPointForPosition(): it is invalid in cc.Sprite when using SpriteBatchNode",
Sprite_setDisplayFrameWithAnimationName:"cc.Sprite.setDisplayFrameWithAnimationName(): Frame not found",Sprite_setDisplayFrameWithAnimationName_2:"cc.Sprite.setDisplayFrameWithAnimationName(): Invalid frame index",Sprite_setDisplayFrame:"setDisplayFrame is deprecated, please use setSpriteFrame instead.",Sprite__updateBlendFunc:"cc.Sprite._updateBlendFunc(): _updateBlendFunc doesn't work when the sprite is rendered using a cc.CCSpriteBatchNode",Sprite_initWithSpriteFrame:"cc.Sprite.initWithSpriteFrame(): spriteFrame should be non-null",
Sprite_initWithSpriteFrameName:"cc.Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null",Sprite_initWithSpriteFrameName1:" is null, please check.",Sprite_initWithFile:"cc.Sprite.initWithFile(): filename should be non-null",Sprite_setDisplayFrameWithAnimationName_3:"cc.Sprite.setDisplayFrameWithAnimationName(): animationName must be non-null",Sprite_addChild:"cc.Sprite.addChild(): cc.Sprite only supports cc.Sprites as children when using cc.SpriteBatchNode",Sprite_addChild_2:"cc.Sprite.addChild(): cc.Sprite only supports a sprite using same texture as children when using cc.SpriteBatchNode",
Sprite_addChild_3:"cc.Sprite.addChild(): child should be non-null",Sprite_setTexture:"cc.Sprite.texture setter: Batched sprites should use the same texture as the batchnode",Sprite_updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",Sprite_insertQuadFromSprite:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",Sprite_addChild_4:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",
Sprite_addChild_5:"cc.SpriteBatchNode.addChild(): cc.Sprite is not using the same texture",Sprite_initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",Sprite_setSpriteFrame:"Invalid spriteFrameName",Sprite_setTexture_2:"Invalid argument: cc.Sprite.texture setter expects a CCTexture2D.",Sprite_updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",Sprite_insertQuadFromSprite_2:"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null",
SpriteBatchNode_addSpriteWithoutQuad:"cc.SpriteBatchNode.addQuadFromSprite(): SpriteBatchNode only supports cc.Sprites as children",SpriteBatchNode_increaseAtlasCapacity:"cocos2d: CCSpriteBatchNode: resizing TextureAtlas capacity from %s to %s.",SpriteBatchNode_increaseAtlasCapacity_2:"cocos2d: WARNING: Not enough memory to resize the atlas",SpriteBatchNode_reorderChild:"cc.SpriteBatchNode.addChild(): Child doesn't belong to Sprite",SpriteBatchNode_removeChild:"cc.SpriteBatchNode.addChild(): sprite batch node should contain the child",
SpriteBatchNode_addSpriteWithoutQuad_2:"cc.SpriteBatchNode.addQuadFromSprite(): child should be non-null",SpriteBatchNode_reorderChild_2:"cc.SpriteBatchNode.addChild(): child should be non-null",spriteFrameCache__getFrameConfig:"cocos2d: WARNING: originalWidth/Height not found on the cc.SpriteFrame. AnchorPoint won't work as expected. Regenrate the .plist",spriteFrameCache_addSpriteFrames:"cocos2d: WARNING: an alias with name %s already exists",spriteFrameCache__checkConflict:"cocos2d: WARNING: Sprite frame: %s has already been added by another source, please fix name conflit",
spriteFrameCache_getSpriteFrame:"cocos2d: cc.SpriteFrameCahce: Frame %s not found",spriteFrameCache__getFrameConfig_2:"Please load the resource first : %s",spriteFrameCache_addSpriteFrames_2:"cc.SpriteFrameCache.addSpriteFrames(): plist should be non-null",spriteFrameCache_addSpriteFrames_3:"Argument must be non-nil",CCSpriteBatchNode_updateQuadFromSprite:"cc.SpriteBatchNode.updateQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",CCSpriteBatchNode_insertQuadFromSprite:"cc.SpriteBatchNode.insertQuadFromSprite(): cc.SpriteBatchNode only supports cc.Sprites as children",
CCSpriteBatchNode_addChild:"cc.SpriteBatchNode.addChild(): cc.SpriteBatchNode only supports cc.Sprites as children",CCSpriteBatchNode_initWithTexture:"Sprite.initWithTexture(): Argument must be non-nil ",CCSpriteBatchNode_addChild_2:"cc.Sprite.addChild(): child should be non-null",CCSpriteBatchNode_setSpriteFrame:"Invalid spriteFrameName",CCSpriteBatchNode_setTexture:"Invalid argument: cc.Sprite texture setter expects a CCTexture2D.",CCSpriteBatchNode_updateQuadFromSprite_2:"cc.SpriteBatchNode.updateQuadFromSprite(): sprite should be non-null",
CCSpriteBatchNode_insertQuadFromSprite_2:"cc.SpriteBatchNode.insertQuadFromSprite(): sprite should be non-null",CCSpriteBatchNode_addChild_3:"cc.SpriteBatchNode.addChild(): child should be non-null",TextureAtlas_initWithFile:"cocos2d: Could not open file: %s",TextureAtlas_insertQuad:"cc.TextureAtlas.insertQuad(): invalid totalQuads",TextureAtlas_initWithTexture:"cc.TextureAtlas.initWithTexture():texture should be non-null",TextureAtlas_updateQuad:"cc.TextureAtlas.updateQuad(): quad should be non-null",
TextureAtlas_updateQuad_2:"cc.TextureAtlas.updateQuad(): Invalid index",TextureAtlas_insertQuad_2:"cc.TextureAtlas.insertQuad(): Invalid index",TextureAtlas_insertQuads:"cc.TextureAtlas.insertQuad(): Invalid index + amount",TextureAtlas_insertQuadFromIndex:"cc.TextureAtlas.insertQuadFromIndex(): Invalid newIndex",TextureAtlas_insertQuadFromIndex_2:"cc.TextureAtlas.insertQuadFromIndex(): Invalid fromIndex",TextureAtlas_removeQuadAtIndex:"cc.TextureAtlas.removeQuadAtIndex(): Invalid index",TextureAtlas_removeQuadsAtIndex:"cc.TextureAtlas.removeQuadsAtIndex(): index + amount out of bounds",
TextureAtlas_moveQuadsFromIndex:"cc.TextureAtlas.moveQuadsFromIndex(): move is out of bounds",TextureAtlas_moveQuadsFromIndex_2:"cc.TextureAtlas.moveQuadsFromIndex(): Invalid newIndex",TextureAtlas_moveQuadsFromIndex_3:"cc.TextureAtlas.moveQuadsFromIndex(): Invalid oldIndex",textureCache_addPVRTCImage:"TextureCache:addPVRTCImage does not support on HTML5",textureCache_addETCImage:"TextureCache:addPVRTCImage does not support on HTML5",textureCache_textureForKey:"textureForKey is deprecated. Please use getTextureForKey instead.",
textureCache_addPVRImage:"addPVRImage does not support on HTML5",textureCache_addUIImage:"cocos2d: Couldn't add UIImage in TextureCache",textureCache_dumpCachedTextureInfo:"cocos2d: '%s' id\x3d%s %s x %s",textureCache_dumpCachedTextureInfo_2:"cocos2d: '%s' id\x3d HTMLCanvasElement %s x %s",textureCache_dumpCachedTextureInfo_3:"cocos2d: TextureCache dumpDebugInfo: %s textures, HTMLCanvasElement for %s KB (%s MB)",textureCache_addUIImage_2:"cc.Texture.addUIImage(): image should be non-null",Texture2D_initWithETCFile:"initWithETCFile does not support on HTML5",
Texture2D_initWithPVRFile:"initWithPVRFile does not support on HTML5",Texture2D_initWithPVRTCData:"initWithPVRTCData does not support on HTML5",Texture2D_addImage:"cc.Texture.addImage(): path should be non-null",Texture2D_initWithImage:"cocos2d: cc.Texture2D. Can't create Texture. UIImage is nil",Texture2D_initWithImage_2:"cocos2d: WARNING: Image (%s x %s) is bigger than the supported %s x %s",Texture2D_initWithString:"initWithString isn't supported on cocos2d-html5",Texture2D_initWithETCFile_2:"initWithETCFile does not support on HTML5",
Texture2D_initWithPVRFile_2:"initWithPVRFile does not support on HTML5",Texture2D_initWithPVRTCData_2:"initWithPVRTCData does not support on HTML5",Texture2D_bitsPerPixelForFormat:"bitsPerPixelForFormat: %s, cannot give useful result, it's a illegal pixel format",Texture2D__initPremultipliedATextureWithImage:"cocos2d: cc.Texture2D: Using RGB565 texture since image has no alpha",Texture2D_addImage_2:"cc.Texture.addImage(): path should be non-null",Texture2D_initWithData:"NSInternalInconsistencyException",
MissingFile:"Missing file: %s",radiansToDegress:"cc.radiansToDegress() should be called cc.radiansToDegrees()",RectWidth:"Rect width exceeds maximum margin: %s",RectHeight:"Rect height exceeds maximum margin: %s",EventManager__updateListeners:"If program goes here, there should be event in dispatch.",EventManager__updateListeners_2:"_inDispatch should be 1 here."};
cc._logToWebPage=function(a){if(cc._canvas){var b=cc._logList,c=document;if(!b){var d=c.createElement("Div"),b=d.style;d.setAttribute("id","logInfoDiv");cc._canvas.parentNode.appendChild(d);d.setAttribute("width","200");d.setAttribute("height",cc._canvas.height);b.zIndex="99999";b.position="absolute";b.top="0";b.left="0";b=cc._logList=c.createElement("textarea");c=b.style;b.setAttribute("rows","20");b.setAttribute("cols","30");b.setAttribute("disabled",!0);d.appendChild(b);c.backgroundColor="transparent";
c.borderBottom="1px solid #cccccc";c.borderRightWidth="0px";c.borderLeftWidth="0px";c.borderTopWidth="0px";c.borderTopStyle="none";c.borderRightStyle="none";c.borderLeftStyle="none";c.padding="0px";c.margin=0}b.value=b.value+a+"\r\n";b.scrollTop=b.scrollHeight}};cc._formatString=function(a){if(cc.isObject(a))try{return JSON.stringify(a)}catch(b){return""}else return a};
cc._initDebugSetting=function(a){var b=cc.game;if(a!==b.DEBUG_MODE_NONE){var c;a>b.DEBUG_MODE_ERROR?(c=cc._logToWebPage.bind(cc),cc.error=function(){c("ERROR :  "+cc.formatStr.apply(cc,arguments))},cc.assert=function(a,b){if(!a&&b){for(var f=2;f<arguments.length;f++)b=b.replace(/(%s)|(%d)/,cc._formatString(arguments[f]));c("Assert: "+b)}},a!==b.DEBUG_MODE_ERROR_FOR_WEB_PAGE&&(cc.warn=function(){c("WARN :  "+cc.formatStr.apply(cc,arguments))}),a===b.DEBUG_MODE_INFO_FOR_WEB_PAGE&&(cc.log=function(){c(cc.formatStr.apply(cc,
arguments))})):console&&console.log.apply&&(cc.error=Function.prototype.bind.call(console.error,console),cc.assert=console.assert?Function.prototype.bind.call(console.assert,console):function(a,b){if(!a&&b){for(var c=2;c<arguments.length;c++)b=b.replace(/(%s)|(%d)/,cc._formatString(arguments[c]));throw Error(b);}},a!==b.DEBUG_MODE_ERROR&&(cc.warn=Function.prototype.bind.call(console.warn,console)),a===b.DEBUG_MODE_INFO&&(cc.log=Function.prototype.bind.call(console.log,console)))}};cc.loader.loadBinary=function(a,b){var c=this,d=this.getXMLHttpRequest(),e="load "+a+" failed!";d.open("GET",a,!0);cc.loader.loadBinary._IEFilter?(d.setRequestHeader("Accept-Charset","x-user-defined"),d.onreadystatechange=function(){if(4===d.readyState&&200===d.status){var a=cc._convertResponseBodyToText(d.responseBody);b(null,c._str2Uint8Array(a))}else b(e)}):(d.overrideMimeType&&d.overrideMimeType("text/plain; charset\x3dx-user-defined"),d.onload=function(){4===d.readyState&&200===d.status?b(null,
c._str2Uint8Array(d.responseText)):b(e)});d.send(null)};cc.loader.loadBinary._IEFilter=/msie/i.test(navigator.userAgent)&&!/opera/i.test(navigator.userAgent)&&window.IEBinaryToArray_ByteStr&&window.IEBinaryToArray_ByteStr_Last;cc.loader._str2Uint8Array=function(a){if(!a)return null;for(var b=new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=a.charCodeAt(c)&255;return b};
cc.loader.loadBinarySync=function(a){var b=this.getXMLHttpRequest();b.timeout=0;var c="load "+a+" failed!";b.open("GET",a,!1);a=null;if(cc.loader.loadBinary._IEFilter){b.setRequestHeader("Accept-Charset","x-user-defined");b.send(null);if(200!==b.status)return cc.log(c),null;(b=cc._convertResponseBodyToText(b.responseBody))&&(a=this._str2Uint8Array(b))}else{b.overrideMimeType&&b.overrideMimeType("text/plain; charset\x3dx-user-defined");b.send(null);if(200!==b.status)return cc.log(c),null;a=this._str2Uint8Array(b.responseText)}return a};
window.Uint8Array=window.Uint8Array||window.Array;
if(cc.loader.loadBinary._IEFilter){var IEBinaryToArray_ByteStr_Script='\x3c!-- IEBinaryToArray_ByteStr --\x3e\r\nFunction IEBinaryToArray_ByteStr(Binary)\r\n   IEBinaryToArray_ByteStr \x3d CStr(Binary)\r\nEnd Function\r\nFunction IEBinaryToArray_ByteStr_Last(Binary)\r\n   Dim lastIndex\r\n   lastIndex \x3d LenB(Binary)\r\n   if lastIndex mod 2 Then\r\n       IEBinaryToArray_ByteStr_Last \x3d Chr( AscB( MidB( Binary, lastIndex, 1 ) ) )\r\n   Else\r\n       IEBinaryToArray_ByteStr_Last \x3d ""\r\n   End If\r\nEnd Function\r\n',myVBScript=
document.createElement("script");myVBScript.type="text/vbscript";myVBScript.textContent=IEBinaryToArray_ByteStr_Script;document.body.appendChild(myVBScript);cc._convertResponseBodyToText=function(a){for(var b={},c=0;256>c;c++)for(var d=0;256>d;d++)b[String.fromCharCode(c+256*d)]=String.fromCharCode(c)+String.fromCharCode(d);c=IEBinaryToArray_ByteStr(a);a=IEBinaryToArray_ByteStr_Last(a);return c.replace(/[\s\S]/g,function(a){return b[a]})+a}};cc=cc||{};cc._loadingImage="data:image/gif;base64,R0lGODlhEAAQALMNAD8/P7+/vyoqKlVVVX9/fxUVFUBAQGBgYMDAwC8vL5CQkP///wAAAP///wAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQFAAANACwAAAAAEAAQAAAEO5DJSau9OOvNex0IMnDIsiCkiW6g6BmKYlBFkhSUEgQKlQCARG6nEBwOgl+QApMdCIRD7YZ5RjlGpCUCACH5BAUAAA0ALAAAAgAOAA4AAAQ6kLGB0JA4M7QW0hrngRllkYyhKAYqKUGguAws0ypLS8JxCLQDgXAIDg+FRKIA6v0SAECCBpXSkstMBAAh+QQFAAANACwAAAAACgAQAAAEOJDJORAac6K1kDSKYmydpASBUl0mqmRfaGTCcQgwcxDEke+9XO2WkxQSiUIuAQAkls0n7JgsWq8RACH5BAUAAA0ALAAAAAAOAA4AAAQ6kMlplDIzTxWC0oxwHALnDQgySAdBHNWFLAvCukc215JIZihVIZEogDIJACBxnCSXTcmwGK1ar1hrBAAh+QQFAAANACwAAAAAEAAKAAAEN5DJKc4RM+tDyNFTkSQF5xmKYmQJACTVpQSBwrpJNteZSGYoFWjIGCAQA2IGsVgglBOmEyoxIiMAIfkEBQAADQAsAgAAAA4ADgAABDmQSVZSKjPPBEDSGucJxyGA1XUQxAFma/tOpDlnhqIYN6MEAUXvF+zldrMBAjHoIRYLhBMqvSmZkggAIfkEBQAADQAsBgAAAAoAEAAABDeQyUmrnSWlYhMASfeFVbZdjHAcgnUQxOHCcqWylKEohqUEAYVkgEAMfkEJYrFA6HhKJsJCNFoiACH5BAUAAA0ALAIAAgAOAA4AAAQ3kMlJq704611SKloCAEk4lln3DQgyUMJxCBKyLAh1EMRR3wiDQmHY9SQslyIQUMRmlmVTIyRaIgA7";
cc._fpsImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAgCAYAAAD9qabkAAAKQ2lDQ1BJQ0MgcHJvZmlsZQAAeNqdU3dYk/cWPt/3ZQ9WQtjwsZdsgQAiI6wIyBBZohCSAGGEEBJAxYWIClYUFRGcSFXEgtUKSJ2I4qAouGdBiohai1VcOO4f3Ke1fXrv7e371/u855zn/M55zw+AERImkeaiagA5UoU8Otgfj09IxMm9gAIVSOAEIBDmy8JnBcUAAPADeXh+dLA//AGvbwACAHDVLiQSx+H/g7pQJlcAIJEA4CIS5wsBkFIAyC5UyBQAyBgAsFOzZAoAlAAAbHl8QiIAqg0A7PRJPgUA2KmT3BcA2KIcqQgAjQEAmShHJAJAuwBgVYFSLALAwgCgrEAiLgTArgGAWbYyRwKAvQUAdo5YkA9AYACAmUIszAAgOAIAQx4TzQMgTAOgMNK/4KlfcIW4SAEAwMuVzZdL0jMUuJXQGnfy8ODiIeLCbLFCYRcpEGYJ5CKcl5sjE0jnA0zODAAAGvnRwf44P5Dn5uTh5mbnbO/0xaL+a/BvIj4h8d/+vIwCBAAQTs/v2l/l5dYDcMcBsHW/a6lbANpWAGjf+V0z2wmgWgrQevmLeTj8QB6eoVDIPB0cCgsL7SViob0w44s+/zPhb+CLfvb8QB7+23rwAHGaQJmtwKOD/XFhbnauUo7nywRCMW735yP+x4V//Y4p0eI0sVwsFYrxWIm4UCJNx3m5UpFEIcmV4hLpfzLxH5b9CZN3DQCshk/ATrYHtctswH7uAQKLDljSdgBAfvMtjBoLkQAQZzQyefcAAJO/+Y9AKwEAzZek4wAAvOgYXKiUF0zGCAAARKCBKrBBBwzBFKzADpzBHbzAFwJhBkRADCTAPBBCBuSAHAqhGJZBGVTAOtgEtbADGqARmuEQtMExOA3n4BJcgetwFwZgGJ7CGLyGCQRByAgTYSE6iBFijtgizggXmY4EImFINJKApCDpiBRRIsXIcqQCqUJqkV1II/ItchQ5jVxA+pDbyCAyivyKvEcxlIGyUQPUAnVAuagfGorGoHPRdDQPXYCWomvRGrQePYC2oqfRS+h1dAB9io5jgNExDmaM2WFcjIdFYIlYGibHFmPlWDVWjzVjHVg3dhUbwJ5h7wgkAouAE+wIXoQQwmyCkJBHWExYQ6gl7CO0EroIVwmDhDHCJyKTqE+0JXoS+cR4YjqxkFhGrCbuIR4hniVeJw4TX5NIJA7JkuROCiElkDJJC0lrSNtILaRTpD7SEGmcTCbrkG3J3uQIsoCsIJeRt5APkE+S+8nD5LcUOsWI4kwJoiRSpJQSSjVlP+UEpZ8yQpmgqlHNqZ7UCKqIOp9aSW2gdlAvU4epEzR1miXNmxZDy6Qto9XQmmlnafdoL+l0ugndgx5Fl9CX0mvoB+nn6YP0dwwNhg2Dx0hiKBlrGXsZpxi3GS+ZTKYF05eZyFQw1zIbmWeYD5hvVVgq9ip8FZHKEpU6lVaVfpXnqlRVc1U/1XmqC1SrVQ+rXlZ9pkZVs1DjqQnUFqvVqR1Vu6k2rs5Sd1KPUM9RX6O+X/2C+mMNsoaFRqCGSKNUY7fGGY0hFsYyZfFYQtZyVgPrLGuYTWJbsvnsTHYF+xt2L3tMU0NzqmasZpFmneZxzQEOxrHg8DnZnErOIc4NznstAy0/LbHWaq1mrX6tN9p62r7aYu1y7Rbt69rvdXCdQJ0snfU6bTr3dQm6NrpRuoW623XP6j7TY+t56Qn1yvUO6d3RR/Vt9KP1F+rv1u/RHzcwNAg2kBlsMThj8MyQY+hrmGm40fCE4agRy2i6kcRoo9FJoye4Ju6HZ+M1eBc+ZqxvHGKsNN5l3Gs8YWJpMtukxKTF5L4pzZRrmma60bTTdMzMyCzcrNisyeyOOdWca55hvtm82/yNhaVFnMVKizaLx5balnzLBZZNlvesmFY+VnlW9VbXrEnWXOss623WV2xQG1ebDJs6m8u2qK2brcR2m23fFOIUjynSKfVTbtox7PzsCuya7AbtOfZh9iX2bfbPHcwcEh3WO3Q7fHJ0dcx2bHC866ThNMOpxKnD6VdnG2ehc53zNRemS5DLEpd2lxdTbaeKp26fesuV5RruutK10/Wjm7ub3K3ZbdTdzD3Ffav7TS6bG8ldwz3vQfTw91jicczjnaebp8LzkOcvXnZeWV77vR5Ps5wmntYwbcjbxFvgvct7YDo+PWX6zukDPsY+Ap96n4e+pr4i3z2+I37Wfpl+B/ye+zv6y/2P+L/hefIW8U4FYAHBAeUBvYEagbMDawMfBJkEpQc1BY0FuwYvDD4VQgwJDVkfcpNvwBfyG/ljM9xnLJrRFcoInRVaG/owzCZMHtYRjobPCN8Qfm+m+UzpzLYIiOBHbIi4H2kZmRf5fRQpKjKqLupRtFN0cXT3LNas5Fn7Z72O8Y+pjLk722q2cnZnrGpsUmxj7Ju4gLiquIF4h/hF8ZcSdBMkCe2J5MTYxD2J43MC52yaM5zkmlSWdGOu5dyiuRfm6c7Lnnc8WTVZkHw4hZgSl7I/5YMgQlAvGE/lp25NHRPyhJuFT0W+oo2iUbG3uEo8kuadVpX2ON07fUP6aIZPRnXGMwlPUit5kRmSuSPzTVZE1t6sz9lx2S05lJyUnKNSDWmWtCvXMLcot09mKyuTDeR55m3KG5OHyvfkI/lz89sVbIVM0aO0Uq5QDhZML6greFsYW3i4SL1IWtQz32b+6vkjC4IWfL2QsFC4sLPYuHhZ8eAiv0W7FiOLUxd3LjFdUrpkeGnw0n3LaMuylv1Q4lhSVfJqedzyjlKD0qWlQyuCVzSVqZTJy26u9Fq5YxVhlWRV72qX1VtWfyoXlV+scKyorviwRrjm4ldOX9V89Xlt2treSrfK7etI66Trbqz3Wb+vSr1qQdXQhvANrRvxjeUbX21K3nShemr1js20zcrNAzVhNe1bzLas2/KhNqP2ep1/XctW/a2rt77ZJtrWv913e/MOgx0VO97vlOy8tSt4V2u9RX31btLugt2PGmIbur/mft24R3dPxZ6Pe6V7B/ZF7+tqdG9s3K+/v7IJbVI2jR5IOnDlm4Bv2pvtmne1cFoqDsJB5cEn36Z8e+NQ6KHOw9zDzd+Zf7f1COtIeSvSOr91rC2jbaA9ob3v6IyjnR1eHUe+t/9+7zHjY3XHNY9XnqCdKD3x+eSCk+OnZKeenU4/PdSZ3Hn3TPyZa11RXb1nQ8+ePxd07ky3X/fJ897nj13wvHD0Ivdi2yW3S609rj1HfnD94UivW2/rZffL7Vc8rnT0Tes70e/Tf/pqwNVz1/jXLl2feb3vxuwbt24m3Ry4Jbr1+Hb27Rd3Cu5M3F16j3iv/L7a/eoH+g/qf7T+sWXAbeD4YMBgz8NZD+8OCYee/pT/04fh0kfMR9UjRiONj50fHxsNGr3yZM6T4aeypxPPyn5W/3nrc6vn3/3i+0vPWPzY8Av5i8+/rnmp83Lvq6mvOscjxx+8znk98ab8rc7bfe+477rfx70fmSj8QP5Q89H6Y8en0E/3Pud8/vwv94Tz+4A5JREAAAAGYktHRAD/AP8A/6C9p5MAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfcAgcQLxxUBNp/AAAQZ0lEQVR42u2be3QVVZbGv1N17829eRLyIKAEOiISEtPhJTJAYuyBDmhWjAEx4iAGBhxA4wABbVAMWUAeykMCM+HRTcBRWkNH2l5moS0LCCrQTkYeQWBQSCAIgYRXEpKbW/XNH5zS4noR7faPEeu31l0h4dSpvc+t/Z199jkFWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhY/H9D/MR9qfKnLj/00U71aqfJn9+HCkCR/Wk36ddsgyJ/1wF4fkDfqqm9/gPsUeTnVr6a2xlQfnxdI7zs0W7irzD17Ytb2WT7EeNv/r4ox1O3Quf2QP2pgt9utwfout4FQE8AVBSlnaRmfvAURQkg2RlAbwB9AThlW5L0GaiKojhJhgOIBqDa7XaPrusdPtr5kQwF0BVAAoBIABRCKDd5aFUhRDAAw57eAOwAhKIoupft3zoqhB1AqLwuHIBut9uFt02qqvqRDJR2dAEQJj/BAOjn56dqmma+xiaECAEQAWAggLsB6A6HQ2iaZggBhBAqgEAAnQB0kzaEmT4hAITT6VQ8Ho/HJAKKECJQtr8LwD1y/A1/vcdfEUIEyfZ9AcQbYvZ942Px88L2UwlJR0dH0EMPPbRj5syZPUeNGrXR7Xb/641xIwJ1XY9NSUlZm52dfW+XLl1w8uRJzJ8//+OGhoYJqqqe1TSt1Wsm9NN1PSIqKmr12rVrR5WUlHy1bdu2AQCumWc3IYRD1/UwVVXnFRQUTIuNjUVzczN2797dWFJSkq8oymZd15sAGAEnFEUJ1nX9nzIzM1dnZmZGh4SE4OTJk5g5c+Zf29vbp9pstrMej6fVOyhIhgAYU1hY+B+hoaGoqKg4XVlZea+XTULTNFdCQsLGiRMnPuR2u3UhBOV9eeDAAWXTpk095DUe6WsoyRE5OTlr0tLSAux2O/bs2cO5c+e+pijKUpIXSHaQVAGkvPLKK++6XK4OksJLCFlXV2cvKSlJBFAjhU+x2WwhHo9nUHp6+urMzMy7wsLCUF9fjxdffPHjxsbGiTab7WuPx9NiEutOuq4PyMjI+M+srKyYqKgoHD58GDNmzNjq8XhyVFU9b/q+LH7hBAEYu3PnTlZVVRFAGgCX6f/tAHoOHDjwa0p27txp/JO9e/f+QM7cipw9nfL3kQBKt2zZQpJ87rnn6mQmoHilw2EACs+cOUOSrK+vZ1NTE0nyo48+IoBpxswoBcMJ4Ndjx471kOTFixe5d+9ekqTH42H//v13A4jyzpAURfEH0H/OnDnthu1z5sw558MmFUCPWbNmnaMP3nrrLZoyDmP8Hl68eDFJ8siRI9/Yc+zYMQKYKdtAztrTrl27xptRXV1NAKMAOAyBBBA/Y8aMdpLs6Ojgxx9//E37+++//29yvFXppwvAwMcee8xjtDHsuXLlCqOjo//ia3wsfpkoALqFhoZuIckJEyackimm3dQmEMDUmpoakmRISMhhAHOHDx/eQJIbN24kgKEyMAHAFRMTs2XXrl1saWkhSZ0kp0+ffhrAr3wEW/S8efOukORLL72kA1gKYMPWrVtJkk899dRJAHeYrgsEsIQkjx8/TgDvAPjd448/3kaSb7zxBmUa7vC6z53BwcFbSHL9+vU6Sc6aNes8gF5ewWAH0PfVV18lSQL4DMBGIcQ6AKtcLleBFC2jXtFt8ODBe0iyoqKCAJYByC8qKmJDQwOzsrK+MAmqo1OnTveHhoa+GRkZ+XZkZOSWiIiIvzgcjk9mzpypkWRmZuZpmbYbGV4AgPnNzc1sa2sjgN0A5iQmJtaSZHl5OQHcb/K3s81mW0uSTU1NBFAFYFbfvn1Pk+Tbb79NAA8IIVzW42/hByA+Pz/fLR/2ZXIda05NI/z9/TeR5J49ewhgqlxTrtI0jY2NjQQw3zTLuWJiYjaUlJToS5Ys6fjkk080kwDEeAmADcA9GzZsIElGRUW9CyAWwLApU6Y0kOSKFSsog9QICGdERMTGsrIyZmVlEcC9AB4IDw/fTpLbtm0jgN94CUAnAJmVlZVcs2aNZ/LkyRdJcvbs2b4EwAkgZfPmzTxw4AABFAN4BkC6vFeUSewcAO5duXIlSTIhIaEawGMAxgKYAmAGgCS73e5vrKVk/yGythANYEhCQsIhkly+fDkBpKqqGmL6DgIALDKN/3yZpVWQZGVlJQE8aPI3KiMjo5okV61aRQAjAPQBMPfIkSN0u90EUCBtsPiFEwpgbn19PdetW2fM5N4zQ9ekpKQqkty0aRMBpMjiWM6JEydIkoqirJUFJ6iq6pAPVy8A6cZMehMBUACEuVyuFwG8HBwcPEIWx367ZMkSjSQXLVrUJouTRorrkAHdA8BdQogsAOsKCwtJkmPGjDkvMw2bDDo/ADEjRoz4XylyFbm5uY0mAbjLyyZ/AOOrq6tZVlbWsWDBgo69e/eyoqKCgwcPPg4gSQaoIRbp27dvN7KF+tLSUr28vJwFBQXtMpvpYRIM7+wrAkDeqVOnePbsWQIoNKfzpiXPg8uXLydJJicnNwF4f+nSpW6STEtLq5fjYwhk1wkTJtSQ5Ouvv04AqTKj+N2xY8dIkgEBAW/Ie1v8wncRegwZMmQvSfbr12+3Ua33WqPfOWbMmP0kWVpaSgCDZAqcfejQIWNZsEGKgvnh9gfQb9myZd8nAEJVVZtMkUNk8CcNHTq0liR1XWdYWNhmH1mJIme80OnTp18x1rp5eXkEsNJms92Fb7e/IgEsvHz5Mp999tkmAI/l5uZeMC0B7vEqqAYAyL106RJJsra2lpWVld+sucePH38ZQG+5NncBeOrgwYMkqbe3t/Po0aOsra011wAWyl0H7x0JJ4DE+fPnu0kyPT29DsDdUrBuyNKEEAkAdpw/f/6GeoEM8GUmfwEgPCIiopwkGxsbabPZPgOw6L777vvm4p49e26VGYjFLxUhhD+ApLKyMp44ccIoVnXybgbgzkcfffRzklyzZg0BDJYCMMmoCwQFBXkLgLGWvvcWAgBToSsKwNPTp09vMR7UuLi4rwH0lgU8c/Db5ezbeeTIkRWzZ8++aMxu+fn5BPCADBwHgP4LFy701NXVEUAJgAnPP/98kyxMNgHo53A4zH77BQQETMvPz7+Um5vbBuAlAFMSExPPmdbVL0qh8Acw8fDhw5SCchVAEYAVb775JknyhRdeaJYztHfxMwLAaqNwCGC2FArv8x0hAHKNLGPKlCme5OTk/Zs3bzb7O0wKiiG8KXl5ed8IxenTp0mSR48e1UmyW7duWywBuD2xyQcgFECgoih+8H1gyJgZV5Lkyy+/3CbTRIePtl2HDBmyw1QBHyGDdXZdXR1JUghRKkXBjOMHCoBdpr0L3nvvPZLkF198wejo6O0A4lVVDTb74HQ6AwD8Wq7Jh8rgGgDgQ13XjVR8qaxJuADMbmlpYXl5uV5UVNRWUFDgfv/993Vj/ZydnU1c37eHXML4S3viAcQqitJD2l104cIFY8lTKsXSBWBMVVWVcd9yed2A1NTUQ6Zl00CvLMMOoHdubm6zFIlWOf5+PsY/Kj09vdrU11QAwwGsv3jxIk21m2DZr10I0RXAuAcffPBgaWkpV69eTYfDcdiwUxY0w6xw+flX8L1xApjevXv3lREREaW6rofB93aPDUDQpEmTMgHgtddeqwBwEd/utZvpqK6uPgEAcXFxkA94NwB9unfvjrNnz4LklwDcf08iIqv66Zs2bXrl4YcfxooVKxAbG7uqrq5uAYA2TdOEqqpGYIi2tjbl6aeffu/YsWPv5uTk7JaC1wHg4Pnz542MwoVvTx+21dbWYvjw4WLixIl+2dnZ9lGjRgmSTE1NRUpKCkwFTGiaxtTU1OXTpk3707Bhw/6g67pDipnT4biuj7qut+Lbk3Vf1tTUXI9qu91Pjq1QFEUBgJaWFgBo8yGOQ8eNGxcAAOvXr/8QwBUfYygAKL169eoCABcuXACAWtn2hOGv0+kMNO1KiPDw8F4A4rZv3/7R1KlTR0+bNu1ht9u9r1+/fqitrQXJgwDarRC6/QjPzs4+QJIffPCB9/aQmSAA43ft2mW0e1QGoi8CAPyLsZccExNTC2BlRkbGRdOyYJCP2csBIN6UAZzCd7cBbQCijYp/dXU1ExMTz6SmptaMHj36f9LS0vYlJCRsl6mxIWSdu3fv/g5J7t+/nwC2AShMTk6+SJKff/45AWRLYbD7+fndAeDf5BJnLoCCyZMnt5JkdnZ2C4B/F0KEm1Pu+Pj4rST55ZdfEsBWAK+mpaVdMo3raDn7KwDuSEpK+m+S3LBhAwG8DuCtHTt2UBbpjgC408vvcFVV15HkuXPnjMp+p5uMf0RcXNyHJNnQ0EBVVfcCWBQXF3fG+Jv0yxABPwB5LS0tRmFxN4BlTzzxxGWSXLx4sS5F3GGFy+1Hp5SUlJq6ujoWFxdTpsZ2H+0iIyMj/0iSWVlZX5mr5jfJFroPGzasxlhTnjp1iiTZ3NxMl8tlrCd9pfa9SkpKSJI5OTmnZOageLUZZqxvfVFWVkZcPwdgNwnSCKPqb17jkmR8fPzfZMDZ5CRsFBmNI7h95s2b1yhT7/MAYmStwCx4vy0uLqa3v5qmEcCfvSr1QQAeXb16NY3Cm3HQ55133iGAp+SxZTNhKSkpfzUddkrFjYevzAQCeGjp0qXfsYckY2NjTwD4leGDLCL2HTdunNtoY+zWSHFcIHdsFCtcfuZ1vO9Eqs3m7/F47sb1k2qX/f3997W2tl7BjWfpBYDOzzzzzIVJkyZh0KBBCwEsB3AJvl9AETabLcDj8dwRFRW1ctasWb8JCgpSzp07d62wsPC/Wltb8xRFadR1/ZqPXYbgAQMGbI2Pjw/+6quv9ldVVT0r01ezuPRJSUn5Y9euXXVd11WzDaqq6kePHm3+7LPPRgO4KlNuxWazhXo8nuTk5OSXMjIyEl0uFxoaGtqKior+dPXq1VdUVT0jj7r68ieoT58+vx8yZMjdx48fP1JVVTVF9m20VW02WyfZf97YsWPjXS4X6urqWvPy8jYCWCyEuEDS8FdVFKWzruv//OSTTy5OTk7uqWkaPv3007qysrJ8RVH+LI8ym8/rB3Tu3HnRI488knLo0KG2ffv2ZQI4C98vP6mqqoZqmpaclpa2cOTIkX39/f3R0NDQUVxc/G5TU9PLqqrWa5rWLH1QVFUN0TStX1JSUvH48eP7BwYG4uDBg1cKCgpeBbBe2u+2Qug2EwD5N5sMPuNtMe8XP4TT6Qxoa2sbIGeXvUKIK7d4IISiKC5d1wPljOfA9bPwzYqiXNV13dd6Uqiq6qdpml2mpe02m63d4/G4vcTF5fF47LJf71nJA6BZVVW3pmntuPHlmAD5wk6Q9NnbHp9vHaqq6tA0zU/64PZhk1FfCZB9G/23ALiqKEqzD39tpvbGUqoFwFUhRLP3yzpCCDtJpxyXDulfG27+pqRR3DXsUWVd4Yq0x/taVQjhIhksC8L+ABpM9ljBf5sKwI8pIBr75L5E4vvu+UNeG/a+hv+AL7yFH8qPtOfHjtOP6V/Bja8D6z/B2Nys/1u9Xv33tLf4GfF/LC4GCJwByWIAAAAASUVORK5CYII\x3d";
cc._loaderImage="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAlAAD/4QMpaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjAtYzA2MCA2MS4xMzQ3NzcsIDIwMTAvMDIvMTItMTc6MzI6MDAgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjM4MDBEMDY2QTU1MjExRTFBQTAzQjEzMUNFNzMxRkQwIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjM4MDBEMDY1QTU1MjExRTFBQTAzQjEzMUNFNzMxRkQwIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDUzUgV2luZG93cyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkU2RTk0OEM4OERCNDExRTE5NEUyRkE3M0M3QkE1NTlEIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkU2RTk0OEM5OERCNDExRTE5NEUyRkE3M0M3QkE1NTlEIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+/+4ADkFkb2JlAGTAAAAAAf/bAIQADQkJCQoJDQoKDRMMCwwTFhENDREWGhUVFhUVGhkUFhUVFhQZGR0fIB8dGScnKionJzk4ODg5QEBAQEBAQEBAQAEODAwOEA4RDw8RFA4RDhQVERISERUfFRUXFRUfKB0ZGRkZHSgjJiAgICYjLCwoKCwsNzc1NzdAQEBAQEBAQEBA/8AAEQgAyACgAwEiAAIRAQMRAf/EALAAAAEFAQEAAAAAAAAAAAAAAAQAAgMFBgcBAQEAAwEBAAAAAAAAAAAAAAAAAQMEAgUQAAIBAgIEBwoLBgQGAwAAAAECAwAEEQUhMRIGQVFxsTITFGGBwdEiQlKSMzWRoeFicqKyI1NzFYJjJDQWB9KjVCbxwkNkJWXik3QRAAIBAgMFBQcDBQEAAAAAAAABAhEDIRIEMUFRcTJhwVIUBZGhsSJyEzOB0ULhYpIjUxX/2gAMAwEAAhEDEQA/AMJSpUqAVKlXuFAeUq9wpUB5XuFe4V6ooDzZHDox0CnGMinzwl7Z8NajaHeoO3vmTBZBtp9YUIqTEV5ROxHKnWRnaU8VRMhFBUjpV7hSoSeUq9pUB5Sr2lhQHlKvcK8oBV7hSFSRrtaKAZs07YNPM1pG2xJIAw1jSeandry/8X4m8VCKkWwaWwam7Xl/4v1W8VLtmX/i/VbxUoKkWwakSM407tmX/i/VbxUmzGwjQsjdY41IARie/U0IbZO0kNtCXnOCkEBeFu4KI3Bs7DNb27ya+jDx3kJeEnpJJEcQVbWDsk17u5urd591ucZkWhym2Vnd9RkCDEpFxDRpbw0bunu5mlp2De2FMLYXOD2wB2xbOeraUcYGJ72mlSUiqzzdzMd3Z3mixltA2yzcK/NlHM1DQyRXce1HocdNOEfJXZ88y9ZojOqhiBszIRiHQ8Y4cK5TvHuzLljHNMqxNoDjLFraHHnjPxcNCGVbxEUzYNTx5jZSxhpW6qTzlwJ+DCvO2Zf+L9VvFSgqyHYNLYNTdssPxfibxUu15f8Ai/VPiqCakOwa82DU/a8v/F+JvFTDdWPBL8R8VKCvYRYV5UzoMAy6QdIIqI0B4KJtxiRQwou16QoGUkntH5Tz0RbZbmF2hktraSVBo2lUkY8tDye0flPPXTslVUyiyVRsjqUOA4yMT8dW2ram2m6UVTNq9S7EIyUVJydMTn/6DnP+im9Wl+g5z/opvVrpteEhQWY4AaSTwAVf5WPiZh/9S5/zj7zltzlmYWkfWXNvJDGTgGcYDHirR7i7mSbwXParsFMrgb7w6jKw/wCmnc9I14kF3vpvCljbMyWMOJL4aEiB8qU/ObUK7HYWVrl1pFZWiCOCBQqKOLjPGTrNZZqKbUXVHq2nNwTuJRk1VpbgXN8s7Rk5ym0UQQzhIG2NAjhxHWbI+gCBVjBBFbwxwQqEiiUJGg1BVGAFe7dV28WYLYZFmF2Th1UD7JGjymGyn1iK5OyzIBGB1HgrLZhamzumQAGJwSqnSCh1q3GOCodxt4cxurdcpzuN4cyhiWaF5Bg09udUmnWw1H/jV9nFuJ7Quo+8h8peThFA+047vduyMtk7fYqTl07YFdfUufMPzT5p71UdtlmYXaGS2t3mQHAsgxANdadYJopLe4QS2867EsZ4QfCNYrCFbjdDPmgkYyWFxgVf04ifJf6ScNdRUW1XBb6FU5TjF5EpSSrGu/s5lN+g5z/opvVpfoOc/wCim9WtdHnatvObJXDW7xLGhB8nrPaY9/HCr+tEdPCVaSeDoYLnqF63lzW4/PFSW3ecxbI84VSzWUwUaSdg0DXXK5nvAipnd6qgKvWnQO7pri9ZUEmm3Vl2j1kr8pRlFRyquBNZjGxQ/S56Y1S2fu9OVueon11Szahoou06QoQUXadIVCD2FJJ7R+U89dMydv8Axdn+TH9muZye0flPPXQstlK5Tbka1gUjlC1q0vVLkeb6r+O3Tx9xcY1nt8c0NrZCyiOE1108NYjGv1joo7Js1jzKyScYLIvkzL6LDwHXVJksH9Sb49dKNq0tj1jA6uriOCL+02FWX7iVtZX1/AzaHTyeoauKn2MX9W79zebiZCuR5MjSrhfXuEtwTrUeZH+yNfdrRNcxI6IzhXlJEak6WIGJ2Rw4ChWnChndtlVBLMdQA0k1gbXNMzzDfDLs6mjaPKppJbWwJ1bOwwxw43OnHh71YT3DpfWUJmFlb5jHHDdeXBHIsrRea5TSqvxqG04cNN62vetoCS4tre5mgnkGE9q+3DKOkuI2WX6LDQRRHWDh1UCtwj7QRg2wdl8Djgw1qe7XvW0BQ3kfZ7mSLgU+T9E6RVbnuVrnWVSWqj+Lt8ZbRuHEdKPkYVcZ2MJY5fSGyeVar45+rkWQHAqccalPE5km1htWK5nK4Wnt5FuUBUwOMG4nGkA/BXUrW4S6torlOjMgcd/xVn7rLo7zKs0uEjCNeSvdwoBhgsZxX1l2j36k3Lu+uyprdj5Vs5A+i/lD48a0aaVJOPi7jB6lbzWozpjB48pf1NDXNN4vfl7+Z4BXS65pvF78vfzPAK71XTHmZ/S/yT+jvJ7L3fHytz1E+upbL+Qj5W56jfXWRnsIYKLtekKEFGWvSFQgyjk9o/Keet3YthlMP/5x9msJJ7R+U89biyb/AMXEv7gD6tadL1T+kwepRrC39ZkLDMbiwMvUHRPG0bjlGg8ore/23sxBldxfMPLupNhT8yL/AORNZbdzJ484scytxgLqJY5LZj6Q2sV5G1Vud1mjjyG0ij0NEGSZToKyhjtqw4waztuiXA3qKTbSxltfGhbZlE95ZtZqxVbgiOZhrER9ph3Svk9+pJILZ4Y4DGBFCUMKjRsGPobPFhUfW0NJmljE2xJcIrcI2vFUEln1lRXd6lrazXT9GCNpD+yNqoI7mOVduNw6nzlOIoPOUa6yye1XXcbMR5GdQ3xY0BSbj31/FcTQZirJ+q431q7anbHCTZ72Bw7lbPrKBMcBWNNgbMBBh+bsjBdni0VJ1lARZs6yWiupxCuMDy6KpS2IwOo6DTr3Mre3e5tZZVUM4ZBjqOOJoWO4jkXajcOOMHGgDISvWIrdAkKR80+TzVl908bPPL3LzxOuHdifxVfiTAg92qI/w+/8gGgSyN/mR7XPVlp0lF/3L3mbVKtu5Hjbk/8AHE2Fc03i9+Xv5ngFdKNc13i9+Xv5ngFaNV0x5nn+l/kn9HeEWXu+PlbnqJ9dS2Xu9OVueon11kZ7CGCjLXpCgxRlr0hUIPYUcntH5Tz1s8vb+Bt1/dqPirGSe0flPPWusG/g4Py15q06XqlyMWvVYQ+ruI9xJOqzO9hOto/sP8tbGOFIrmWeM7IuMDMnAXXQJOUjQeOsJk0nY96ip0CYunrjaHx1t+srPJUbXBm2LrFPikwTOb+T+VhbZxGMrDXp83x1QSy2tucJpUjPETp+Cn5/ftaRvKvtp3Kx48HG3erHMzOxZiWZtLMdJNQSbbL71Vk6yynViOkqnEEfOWtPbXi3EQkGg6mXiNckjeSJxJGxR10qw0GtxuxmvbImD4CZMFlA4fRfv0BqesqqzTMZNMEDbIHtHH2QeCiZJSqMQdOGiue53mz3czQwsRbIcNHnkec3c4qAMuriz68gTIToxwOOnlp0MjxMJYW741Gs3RVldtbygE/dMcHX/moDaxTiWNZB53B3arb8/wC+4SOF4sf/AKxU9kcBsfOGHfoUHtG/RbzY5Die5HHhXdvavqiZ9Q8Jdlq4/gbKua7xe/L38zwCuhpf2Uk/Zo50kmwJKIdogDjw1VzzeL35e/meAVp1LTgqY4nn+mRauzqmqwrjzCLL3fHytz1E+upLL+Qj5W56jfXWRnroYKLtekKEFF2vSFQg9hSSe0flPPWosm/hIfoLzVl5PaPynnrRWb/w0X0F5q06XqlyM2sVYx5gmbFre/t71NY2T+0h8VbSO5SWNJUOKSAMp7jDGspmMPaLRlXS6eWve1/FRO7WYdbZm1Y/eW/R7qHxHRXGojlm3ulid6aVbaW+OALvgCLq2Hm9WxHKWqjhj6xsK1e8dm15l4niG1LZkswGsxtrPeOmsvayBJA1VItlWjptLuTdPMo7LtjRDq9naK4+WF9IrUW7BaHOljGqVHB7w2hzVoZt87d8vaNYSLl02CcRsDEbJbj71Uu7UBkvJ7/D7q2QoDxySaAO8MTXdxRVMpRp5XZOWdF/ms7R5XdyKfKWJsO/5PhrG5XlNxmEywW6bTnTxAAcJNbGSMXkM1pjgbiNo1PziPJ+Os7u7m/6ReM00ZOgxSpqYYHT3wRXMKN4ll9zUG4bQfNshu8sZVuEA2hirA4qe/VOwwrVbzbww5mI44UKRRYkbWG0S3JWctbd7u5WFfOOLHiUdJqmaipfLsIsObhWe001lMkMVvJNjhghIALMcBxCs7fxXQmkupx1bXDswGPlaTidVaEyKNXkoo4eBV+Sq7L7Vs9zcBgeyQ4GQ/MB1crmoim2orezqcowTuSeEY48jQ7oZX2PLzdyLhNd6RjrEY6I7+uspvH78vfzPAK6UAAAFGAGgAcArmu8Xvy9/M8ArTfio24RW5nnaG67uou3H/KPuqT2X8hHytz1G+upLL3enK3PUb66ys9RDBRdr0hQgou06QqEGUkntH5Tz1e238vF9BeaqKT2j8p56vbb+Xi+gvNWjTdUuRn1XTHmTh8KrJTJlt8t1CPIY44cGnpJVjTJYkmjaN9Ib4u7V923njTethRauZJV3PaW1rfLIiXEDYg6R4VYc9CXW7thfOZbKdbGZtLW8uPVY/u3GrkNUkM9zlcxUjbhfWOA90cRq4gv4LhdqN+VToNYWmnRm9NNVWNTyHc6VWBv8wt4YeHqm6xyPmroq1Z7WGFLSxTq7WLSuPSdjrkfumq5yHXDUeA92oO2SKpVumNAaoJLMXH3myp0rpJ4uKhc3tbDM5BMri1zAj79j7KTiY8TcdBpcsith0286o+sPCagEX9Pzg4zXUCp6QYse8oouCG3tk6m1BYv05W6T+IdyolxbHDAAa2OgDlNCz3ryN2WxBd5PJMg1t81eId2ukqnLlTBbfcuY+9uJLiRcvtPvHdsHK+cfRHcHDWsyawjyy0WBcDI3lTP6TeIcFV+S5OmXx9bJg1048o8Cj0V8Jq2DVu09nL80up7OxHi+oal3P8AXB/IsZS8T/YOV65zvCcc7vfzPAK3ivWCz445zeH954BXOr6I8yfSfyz+jvCLP3fHytz1G+upLP3fHytz1E+usbPaQ0UXadIUIKLtekKhB7Ckk9o/Keer22/l4/oLzVRSe0flPPV7b/y8X0F5q0abqlyM+q6Y8yQsBTDMor1o8aiaE1pbluMqS3sbLLHIhSRQyngqukhaJ9uBjo+H5aOa3ao2t34qouRlLajTalGP8v0IY8ylXQ+PKPFU/bYXOLPge6CKia0LaxTOxHu1Q7cuBd9yPEJ7TbjXKO8CajbMIF6CNIeNvJHjqIWJ7tSpYkalqVblwIdyG+RGXur0hXYJFxal+Dhq5y3slkv3Y2pD0pTr+QUClpJRUdo9XW4OLrTHtM16cZLLWkeC7y4jvlNEpcRtw1Ux27Ci448NZrTFy3nn3IQWxlgGrDZ3pza7/M8ArZo+ArF5171uvp+CqdV0R5l/psUrs2vB3hdl7vTlbnqJ9dS2Xu+PlbnqJ9dY2eshooq16QoQUXa9IVCD2FLJ7RuU89WNtmUSQqkgYMgw0accKrpPaPynnrZWG4Vi+VWmY5tnMWXG+XrIYnA0rhj0mdcTgdNdwnKDqjmduM1SRR/qlr8/4KX6pa8T/BVzDuLZXudRZblmbxXcPUNPc3KqCIwrbOzgrHEnHjoyD+3eSXkht7DeKG4umDGOJVUklfouThXfmbnZ7Cvy1vt9pmv1W1+d8FL9VteJvgq5yrcOGfLmzHN80iyyETPbptAEFo2ZG8pmUa1OFNn3Ky6W/sbDKM5hv5bx2WTZA+7RF2y52WOPJTzE+z2Dy1vt9pT/AKpacTerS/U7Tib1a04/t7kDXPY03jhN0W6sQ7K7W3q2dnrMccaDy/8At80kuZfqWYxWNtlcvUPPhiGYhWDeUy7IwYU8xPs9g8tb7faUn6pacTerTxm9oOBvVq3v9z927aynuId44LiWKNnjhAXF2UYhRg516qpsryjLr21665zFLSTaK9U2GOA87SwqY37knRU+BzOzags0s1Oyr+BKM6sxwP6tSDPLMen6vy0rvdm3Sxlu7K/S7WDDrFUDUTxgnTU826eXW7KlxmqQuwDBXUKcD+1Xee/wXuKX5XDGWLapSVcOyhEM/seJ/V+WnjeGx4pPV+Wkm6kKZlFay3Jlt7iFpYZY8ASVK6DjtDDA0f8A0Tl340/1f8Ndx8xJVWXB0KbktFFpNzdVXAC/qOwA0CQni2flrO3Vwbm5lnI2TKxbDirX/wBE5d+NcfV/wVR7xZPa5U9utvI8nWhmbbw0YEAYYAVxfhfy5rlKR4Fulu6X7mW1mzT8S4Yis/5CPlbnqJ9dSWfu9OVueon11mZvQ2i7XpChKKtekKhBlNJ7R+U89bDfGTb3a3ZX0Lcj6kdY+T2j8p560288m1kWQr6MJ+ylSAr+2cnV5renjs3H1loX+3j9XvbbtxLN9lqW4UnV5jdnjtXHxihtyZNjeSBu5J9k1BJe7xy7W5CJ/wCzuD/mTVTf2+fq97LJuLrPsNRueS7W6aJ/38x+vLVXuY+xvHaNxbf2GoCezf8A36j/APsSf8w1sLnqczTefJluYoLm5uo5F61sBshItP1cNFYe1f8A3ir/APfE/wCZUe9bB94r5jwuPsrQFhmG4l/Z2M17HdW90tuu3IkTHaCjWdIw0VVZdks9/C06yJFEp2dp+E1bbqybGTZ8vpQD7L1XRv8A7blT96Oda7tpNuuNE37Cq9KSisjyuUoxrStKllHbLlWTXsMs8chuSuwEPDqwoLe5y+YRE/gLzmqRekvKKtd4327yM/ulHxmrHJStySWVRyrjxKI2XC/CTlnlPPKTpTdFbP0L1bgrf5Lp0G3dPhQHwV0S1lzBsns3sESR8Crh9WAJGjSOKuU3E+zdZQ3oJh8IArdZXFDmOTpHa3i2+YrI2KtKy4ricBsBuHHgFXSo440+Wa2qqxjvM9uMoy+WvzWpLCWWWE28HxL6e43ojgkeSCBY1Ri5BGIUDT51cl3vm276BBqSEH4WbxV0tlkyXJcxTMb+OW6uY9mGHrCzDQwwAbTp2uKuTZ9N1uYsfRRR8WPhrm419mSSjRyiqxVK7y23B/ftuTm2oSdJyzNVw3BFn7vTlbnqF9dS2fu9OVueon11lZuQ2iLdsGFD05H2dNQGV0ntG5Tz1dWm9N1b2kVq8EVwsI2UaQaQOKhmitZGLOmk68DhSFvY+gfWNSAg7z3Qvo7yKCKIohiaNR5LKxx8qpxvjcqS0VpbxvwOAcRQPZ7D0G9Y0uz2HoH1jUCpLY7zXlpbm3eKO5QuzjrBqZji3x17PvNcyT288VvDBJbMWUovS2hslW7mFQ9nsPQPrGl2ew9A+saCod/WNxtbYsrfb17WBxx5ddD2281xC88klvDcSXEnWuzrqOGGC9zRUPZ7D0G9Y0uzWHoH1jQVCLreq6ntZbaO3it1mGy7RjTs1X2mYy20ZiCq8ZOODcdEdmsPQb1jS7PYegfWNdJuLqnQiSUlRqpFLmryxtH1Ma7Qw2gNNPOdSt0oI27p007s9h6B9Y0uz2HoH1jXX3Z+I4+1b8IJdX89xLHKQFMXQUahpxoiPN5P+onfU+A0/s9h6DesaXZ7D0D6xpG7OLbUtu0StW5JJx2bBsmbtiSiEk+cxoCWWSaVpZOk2vDVo0VYdnsPQb1jSNvZcCH1jSd2c+p1XAmFqEOmOPEfaH+BQd1ueo211IzrgFUYKNAAqI1WztCpUqVCRUqVKgFSpUqAVKlSoBUqVKgFSpUqAVKlSoBUqVKgFSpUqAVKlSoD/9k\x3d";cc=cc||{};
cc.defineGetterSetter=function(a,b,c,d,e,f){if(a.__defineGetter__)c&&a.__defineGetter__(b,c),d&&a.__defineSetter__(b,d);else if(Object.defineProperty){var g={enumerable:!1,configurable:!0};c&&(g.get=c);d&&(g.set=d);Object.defineProperty(a,b,g)}else throw Error("browser does not support getters");if(!e&&!f)for(var g=null!=c,h=void 0!=d,k=Object.getOwnPropertyNames(a),m=0;m<k.length;m++){var n=k[m];if((a.__lookupGetter__?!a.__lookupGetter__(n):!Object.getOwnPropertyDescriptor(a,n))&&"function"===typeof a[n]){var p=
a[n];if(g&&p===c&&(e=n,!h||f))break;if(h&&p===d&&(f=n,!g||e))break}}a=a.constructor;e&&(a.__getters__||(a.__getters__={}),a.__getters__[e]=b);f&&(a.__setters__||(a.__setters__={}),a.__setters__[f]=b)};cc.clone=function(a){var b=a.constructor?new a.constructor:{},c;for(c in a){var d=a[c];b[c]="object"!==typeof d||!d||d instanceof cc.Node||d instanceof HTMLElement?d:cc.clone(d)}return b};cc.inject=function(a,b){for(var c in a)b[c]=a[c]};
var ClassManager={id:0|998*Math.random(),instanceId:0|998*Math.random(),getNewID:function(){return this.id++},getNewInstanceId:function(){return this.instanceId++}};
(function(){var a=/\b_super\b/;cc.Class=function(){};cc.Class.extend=function(b){var c=this.prototype,d=Object.create(c),e={writable:!0,enumerable:!1,configurable:!0},f;cc.game.config&&cc.game.config[cc.game.CONFIG_KEY.exposeClassName]?(f="(function "+(b._className||"Class")+" (arg0, arg1, arg2, arg3, arg4, arg5) {\n",f+="    this.__instanceId \x3d ClassManager.getNewInstanceId();\n    if (this.ctor) {\n",f+="        switch (arguments.length) {\n",f+="        case 0: this.ctor(); break;\n",f+="        case 1: this.ctor(arg0); break;\n",
f+="        case 3: this.ctor(arg0, arg1, arg2); break;\n",f+="        case 4: this.ctor(arg0, arg1, arg2, arg3); break;\n",f+="        case 5: this.ctor(arg0, arg1, arg2, arg3, arg4); break;\n",f+="        default: this.ctor.apply(this, arguments);\n",f+="        }\n",f+="    }\n",f+="})",f=eval(f)):f=function(a,b,c,d,e){this.__instanceId=ClassManager.getNewInstanceId();if(this.ctor)switch(arguments.length){case 0:this.ctor();break;case 1:this.ctor(a);break;case 2:this.ctor(a,b);break;case 3:this.ctor(a,
b,c);break;case 4:this.ctor(a,b,c,d);break;case 5:this.ctor(a,b,c,d,e);break;default:this.ctor.apply(this,arguments)}};e.value=ClassManager.getNewID();Object.defineProperty(d,"__pid",e);f.prototype=d;e.value=f;Object.defineProperty(d,"constructor",e);this.__getters__&&(f.__getters__=cc.clone(this.__getters__));this.__setters__&&(f.__setters__=cc.clone(this.__setters__));for(var g=0,h=arguments.length;g<h;++g){var k=arguments[g],m;for(m in k){var n="function"===typeof k[m],p="function"===typeof c[m],
r=a.test(k[m]);n&&p&&r?(e.value=function(a,b){return function(){var d=this._super;this._super=c[a];var e=b.apply(this,arguments);this._super=d;return e}}(m,k[m]),Object.defineProperty(d,m,e)):n?(e.value=k[m],Object.defineProperty(d,m,e)):d[m]=k[m];if(n){var s,u;if(this.__getters__&&this.__getters__[m]){var n=this.__getters__[m],t;for(t in this.__setters__)if(this.__setters__[t]===n){u=t;break}cc.defineGetterSetter(d,n,k[m],k[u]?k[u]:d[u],m,u)}if(this.__setters__&&this.__setters__[m]){n=this.__setters__[m];
for(t in this.__getters__)if(this.__getters__[t]===n){s=t;break}cc.defineGetterSetter(d,n,k[s]?k[s]:d[s],k[m],s,m)}}}}f.extend=cc.Class.extend;f.implement=function(a){for(var b in a)d[b]=a[b]};return f}})();cc=cc||{};cc._tmp=cc._tmp||{};cc.associateWithNative=function(a,b){};
cc.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,
"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"\x3d":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1E3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005};cc.FMT_JPG=0;cc.FMT_PNG=1;cc.FMT_TIFF=2;cc.FMT_RAWDATA=3;cc.FMT_WEBP=4;cc.FMT_UNKNOWN=5;
cc.getImageFormatByData=function(a){return 8<a.length&&137===a[0]&&80===a[1]&&78===a[2]&&71===a[3]&&13===a[4]&&10===a[5]&&26===a[6]&&10===a[7]?cc.FMT_PNG:2<a.length&&(73===a[0]&&73===a[1]||77===a[0]&&77===a[1]||255===a[0]&&216===a[1])?cc.FMT_TIFF:cc.FMT_UNKNOWN};cc.Point=function(a,b){this.x=a||0;this.y=b||0};cc.p=function(a,b){return void 0===a?{x:0,y:0}:void 0===b?{x:a.x,y:a.y}:{x:a,y:b}};cc.pointEqualToPoint=function(a,b){return a&&b&&a.x===b.x&&a.y===b.y};cc.Size=function(a,b){this.width=a||0;this.height=b||0};cc.size=function(a,b){return void 0===a?{width:0,height:0}:void 0===b?{width:a.width,height:a.height}:{width:a,height:b}};cc.sizeEqualToSize=function(a,b){return a&&b&&a.width===b.width&&a.height===b.height};
cc.Rect=function(a,b,c,d){this.x=a||0;this.y=b||0;this.width=c||0;this.height=d||0};cc.rect=function(a,b,c,d){return void 0===a?{x:0,y:0,width:0,height:0}:void 0===b?{x:a.x,y:a.y,width:a.width,height:a.height}:{x:a,y:b,width:c,height:d}};cc.rectEqualToRect=function(a,b){return a&&b&&a.x===b.x&&a.y===b.y&&a.width===b.width&&a.height===b.height};cc._rectEqualToZero=function(a){return a&&0===a.x&&0===a.y&&0===a.width&&0===a.height};
cc.rectContainsRect=function(a,b){return a&&b?!(a.x>=b.x||a.y>=b.y||a.x+a.width<=b.x+b.width||a.y+a.height<=b.y+b.height):!1};cc.rectGetMaxX=function(a){return a.x+a.width};cc.rectGetMidX=function(a){return a.x+a.width/2};cc.rectGetMinX=function(a){return a.x};cc.rectGetMaxY=function(a){return a.y+a.height};cc.rectGetMidY=function(a){return a.y+a.height/2};cc.rectGetMinY=function(a){return a.y};
cc.rectContainsPoint=function(a,b){return b.x>=cc.rectGetMinX(a)&&b.x<=cc.rectGetMaxX(a)&&b.y>=cc.rectGetMinY(a)&&b.y<=cc.rectGetMaxY(a)};cc.rectIntersectsRect=function(a,b){var c=a.y+a.height,d=b.x+b.width,e=b.y+b.height;return!(a.x+a.width<b.x||d<a.x||c<b.y||e<a.y)};cc.rectOverlapsRect=function(a,b){return!(a.x+a.width<b.x||b.x+b.width<a.x||a.y+a.height<b.y||b.y+b.height<a.y)};
cc.rectUnion=function(a,b){var c=cc.rect(0,0,0,0);c.x=Math.min(a.x,b.x);c.y=Math.min(a.y,b.y);c.width=Math.max(a.x+a.width,b.x+b.width)-c.x;c.height=Math.max(a.y+a.height,b.y+b.height)-c.y;return c};cc.rectIntersection=function(a,b){var c=cc.rect(Math.max(cc.rectGetMinX(a),cc.rectGetMinX(b)),Math.max(cc.rectGetMinY(a),cc.rectGetMinY(b)),0,0);c.width=Math.min(cc.rectGetMaxX(a),cc.rectGetMaxX(b))-cc.rectGetMinX(c);c.height=Math.min(cc.rectGetMaxY(a),cc.rectGetMaxY(b))-cc.rectGetMinY(c);return c};var FastDomParser=function(){};
(function(){function a(b){this.namespace=b.namespace||null;this.text=b.text;this._selfCloseTag=b.selfCloseTag;Object.defineProperties(this,{nodeType:{value:b.nodeType},nodeName:{value:1==b.nodeType?b.nodeName:"#text"},childNodes:{value:b.childNodes},firstChild:{get:function(){return this.childNodes[0]||null}},lastChild:{get:function(){return this.childNodes[this.childNodes.length-1]||null}},parentNode:{value:b.parentNode||null},attributes:{value:b.attributes||[]},innerHTML:{get:function(){for(var a="",
b,c=0,d=this.childNodes.length;c<d;c++)b=this.childNodes[c],a+=3===b.nodeType?b.text:b.outerHTML;return a}},outerHTML:{get:function(){if(3!=this.nodeType){var a;a=(this.attributes.map(function(a){return a.name+(a.value?'\x3d"'+a.value+'"':"")})||[]).join(" ");var b="";a="\x3c"+this.nodeName+(a?" "+a:"")+(this._selfCloseTag?"/":"")+"\x3e";this._selfCloseTag||(b=(this._selfCloseTag?"":this.childNodes.map(function(a){return a.outerHTML})||[]).join(""),a=a+b+("\x3c/"+this.nodeName+"\x3e"))}else a=this.textContent;
return a}},textContent:{get:function(){return this.nodeType==a.TEXT_NODE?this.text:this.childNodes.map(function(a){return a.textContent}).join("").replace(/\x20+/g," ")}}})}function b(a,c,d){var e=[];d=!!d;if(3!==a.nodeType)for(var f=0,g=a.childNodes.length;f<g&&(3===a.childNodes[f].nodeType||!c(a.childNodes[f])||(e.push(a.childNodes[f]),!d));f++)e=e.concat(b(a.childNodes[f],c));return d?e[0]:e}function c(b,c,d){var e=[],x=0;b=b.match(f);for(var A=!1,y=null,z,B,D,C,G,F,E,J=0,K=b.length;J<K;J++)if(E=
b[J],B=E.match(p),(z=c.test(E))&&!A&&(A=!0),A){if(k.test(E)){D=m.test(E)||s.test(B[1]);C=[];F=E.match(g)||[];for(var I=0,M=F.length;I<M;I++)h.lastIndex=0,G=h.exec(F[I]),C.push({name:G[1].trim(),value:(G[2]||"").trim().replace(r,"")});(y&&y.childNodes||e).push(B=new a({nodeType:1,nodeName:B[1],namespace:B[2],attributes:C,childNodes:[],parentNode:y,startTag:E,selfCloseTag:D}));x++;!d&&z&&y&&e.push(B);D?x--:y=B}else n.test(E)?y.nodeName==B[1]&&(y=y.parentNode,x--):y.childNodes.push(new a({nodeType:3,
text:E,parentNode:y}));if(0==x&&(A=!1,y=null,d))break}return d?e[0]||null:e}function d(a){this.rawHTML=a}function e(){}a.prototype.getAttribute=function(a){for(var b=0,c=this.attributes.length;b<c;b++)if(this.attributes[b].name==a)return this.attributes[b].value;return null};a.prototype.getElementsByTagName=function(a){return b(this,function(b){return b.nodeName==a})};a.prototype.getElementsByClassName=function(a){var c=RegExp("^(.*?\\s)?"+a+"(\\s.*?)?$");return b(this,function(a){return a.attributes.length&&
c.test(a.getAttribute("class"))})};a.prototype.getElementById=function(a){return b(this,function(b){return b.attributes.length&&b.getAttribute("id")==a},!0)};a.prototype.getElementsByName=function(a){return b(this,function(b){return b.attributes.length&&b.getAttribute("name")==a})};a.ELEMENT_NODE=1;a.TEXT_NODE=3;var f=/(<\/?[a-z][a-z0-9]*(?::[a-z][a-z0-9]*)?\s*(?:\s+[a-z0-9-_]+=(?:(?:'[\s\S]*?')|(?:"[\s\S]*?")))*\s*\/?>)|([^<]|<(?![a-z\/]))*/gi,g=/\s[a-z0-9-_]+\b(\s*=\s*('|")[\s\S]*?\2)?/gi,h=/(\s[a-z0-9-_]+\b\s*)(?:=(\s*('|")[\s\S]*?\3))?/gi,
k=/^<[a-z]/,m=/\/>$/,n=/^<\//,p=/<\/?([a-z][a-z0-9]*)(?::([a-z][a-z0-9]*))?/i,r=/^('|")|('|")$/g,s=/^(?:area|base|br|col|command|embed|hr|img|input|link|meta|param|source)/i;d.prototype.getElementsByClassName=function(a){return c(this.rawHTML,RegExp("class\x3d('|\")(.*?\\s)?"+a+"(\\s.*?)?\\1"))};d.prototype.getElementsByTagName=function(a){return c(this.rawHTML,RegExp("^\x3c"+a,"i"))};d.prototype.getElementById=function(a){return c(this.rawHTML,RegExp("id\x3d('|\")"+a+"\\1"),!0)};d.prototype.getElementsByName=
function(a){return c(this.rawHTML,RegExp("name\x3d('|\")"+a+"\\1"))};e.prototype.parseFromString=function(a){return new d(a)};FastDomParser=e})();cc.SAXParser=cc.Class.extend({_parser:null,_isSupportDOMParser:null,ctor:function(){this._isSupportDOMParser=!0;this._parser=new FastDomParser},parse:function(a){return this._parseXML(a)},_parseXML:function(a){var b;this._isSupportDOMParser?b=this._parser.parseFromString(a,"text/xml"):(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a));return b}});
cc.PlistParser=cc.SAXParser.extend({parse:function(a){a=this._parseXML(a).getElementsByTagName("plist")[0];if("plist"!==a.nodeName)return cc.warn("Not a plist file!"),{};for(var b=null,c=0,d=a.childNodes.length;c<d&&(b=a.childNodes[c],1!==b.nodeType||"#text"===b.nodeName);c++);return this._parseNode(b)},_parseNode:function(a){var b=null,c=a.nodeName;if("dict"===c)b=this._parseDict(a);else if("array"===c)b=this._parseArray(a);else if("string"===c)if(1===a.childNodes.length)b=a.firstChild.text;else for(b=
"",c=0;c<a.childNodes.length;c++)b+=a.childNodes[c].text;else"false"===c?b=!1:"true"===c?b=!0:"real"===c?b=parseFloat(a.firstChild.text):"integer"===c&&(b=parseInt(a.firstChild.text,10));return b},_parseArray:function(a){for(var b=[],c=0,d=a.childNodes.length;c<d;c++){var e=a.childNodes[c];1!==e.nodeType&&"#text"!==a.nodeName||b.push(this._parseNode(e))}return b},_parseDict:function(a){for(var b={},c=null,d=0,e=a.childNodes.length;d<e;d++){var f=a.childNodes[d];if(1===f.nodeType||"#text"===a.nodeName)"key"===
f.nodeName?c=f.firstChild.text:b[c]=this._parseNode(f)}return b}});cc.saxParser=new cc.SAXParser;cc.plistParser=new cc.PlistParser;cc._txtLoader={load:function(a,b,c,d){cc.loader.loadTxt(a,d)}};cc.loader.register(["txt","xml","vsh","fsh","atlas"],cc._txtLoader);cc._jsonLoader={load:function(a,b,c,d){cc.loader.loadJson(a,d)}};cc.loader.register(["json","ExportJson"],cc._jsonLoader);cc._jsLoader={load:function(a,b,c,d){cc.loader.loadJs(a,d)}};cc.loader.register(["js"],cc._jsLoader);
cc._imgLoader={load:function(a,b,c,d){c=cc.loader.isLoading(a)?function(a,c){if(a)return d(a);var g=cc.textureCache.getTextureForKey(b)||cc.textureCache.handleLoadedTexture(b,c);d(null,g)}:function(a,c){if(a)return d(a);var g=cc.textureCache.handleLoadedTexture(b,c);d(null,g)};cc.loader.loadImg(a,c)}};cc.loader.register("png jpg bmp jpeg gif ico tiff webp".split(" "),cc._imgLoader);cc._serverImgLoader={load:function(a,b,c,d){cc._imgLoader.load(c.src,b,c,d)}};cc.loader.register(["serverImg"],cc._serverImgLoader);
cc._plistLoader={load:function(a,b,c,d){cc.loader.loadTxt(a,function(a,b){if(a)return d(a);d(null,cc.plistParser.parse(b))})}};cc.loader.register(["plist"],cc._plistLoader);
cc._fontLoader={TYPE:{".eot":"embedded-opentype",".ttf":"truetype",".ttc":"truetype",".woff":"woff",".svg":"svg"},_loadFont:function(a,b,c){if(window.wx)if(b instanceof Array)for(var d=0,e=b.length;d<e;d++){a=c=b[d];var f=wx.loadFont(a);cc._renderContext.font="16px "+f;console.log("load font url : "+a)}else a=b,f=wx.loadFont(a),cc._renderContext.font="16px "+f,console.log("load font url : "+a);else{var f=document,g=cc.path,h=this.TYPE,k=document.createElement("style");k.type="text/css";f.body.appendChild(k);
var m="",m=isNaN(a-0)?m+("@font-face { font-family:"+a+"; src:"):m+("@font-face { font-family:'"+a+"'; src:");if(b instanceof Array)for(d=0,e=b.length;d<e;d++)c=b[d],c=g.extname(c).toLowerCase(),m+="url('"+b[d]+"') format('"+h[c]+"')",m+=d===e-1?";":",";else c=c.toLowerCase(),m+="url('"+b+"') format('"+h[c]+"');";k.textContent+=m+"}";b=document.createElement("div");d=b.style;d.fontFamily=a;b.innerHTML=".";d.position="absolute";d.left="-100px";d.top="-100px";f.body.appendChild(b)}},load:function(a,
b,c,d){b=c.type;a=c.name;b=c.srcs;cc.isString(c)?(b=cc.path.extname(c),a=cc.path.basename(c,b),this._loadFont(a,c,b)):this._loadFont(a,b);document.fonts?document.fonts.load("1em "+a).then(function(){d(null,!0)},function(a){d(a)}):d(null,!0)}};cc.loader.register("font eot ttf woff svg ttc".split(" "),cc._fontLoader);cc._binaryLoader={load:function(a,b,c,d){cc.loader.loadBinary(a,d)}};cc._csbLoader={load:function(a,b,c,d){cc.loader.loadCsb(a,d)}};cc.loader.register(["csb"],cc._csbLoader);window.CocosEngine=cc.ENGINE_VERSION="Cocos2d-JS v3.15";cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL=0;cc.DIRECTOR_STATS_POSITION=cc.p(0,0);cc.DIRECTOR_FPS_INTERVAL=0.5;cc.COCOSNODE_RENDER_SUBPIXEL=1;cc.SPRITEBATCHNODE_RENDER_SUBPIXEL=1;cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA=1;cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP=0;cc.TEXTURE_ATLAS_USE_VAO=0;cc.TEXTURE_NPOT_SUPPORT=0;cc.RETINA_DISPLAY_FILENAME_SUFFIX="-hd";cc.USE_LA88_LABELS=1;cc.SPRITE_DEBUG_DRAW=0;cc.SPRITEBATCHNODE_DEBUG_DRAW=0;
cc.LABELBMFONT_DEBUG_DRAW=0;cc.LABELATLAS_DEBUG_DRAW=0;cc.DRAWNODE_TOTAL_VERTICES=2E4;cc.DEFAULT_ENGINE=cc.ENGINE_VERSION+"-canvas";cc.ENABLE_STACKABLE_ACTIONS=1;cc.ENABLE_GL_STATE_CACHE=1;cc.$=function(a){var b=this===cc?document:this;if(a=a instanceof HTMLElement?a:b.querySelector(a))a.find=a.find||cc.$,a.hasClass=a.hasClass||function(a){return this.className.match(RegExp("(\\s|^)"+a+"(\\s|$)"))},a.addClass=a.addClass||function(a){this.hasClass(a)||(this.className&&(this.className+=" "),this.className+=a);return this},a.removeClass=a.removeClass||function(a){this.hasClass(a)&&(this.className=this.className.replace(a,""));return this},a.remove=a.remove||function(){this.parentNode&&
this.parentNode.removeChild(this);return this},a.appendTo=a.appendTo||function(a){a.appendChild(this);return this},a.prependTo=a.prependTo||function(a){a.childNodes[0]?a.insertBefore(this,a.childNodes[0]):a.appendChild(this);return this},a.transforms=a.transforms||function(){this.style[cc.$.trans]=cc.$.translate(this.position)+cc.$.rotate(this.rotation)+cc.$.scale(this.scale)+cc.$.skew(this.skew);return this},a.position=a.position||{x:0,y:0},a.rotation=a.rotation||0,a.scale=a.scale||{x:1,y:1},a.skew=
a.skew||{x:0,y:0},a.translates=function(a,b){this.position.x=a;this.position.y=b;this.transforms();return this},a.rotate=function(a){this.rotation=a;this.transforms();return this},a.resize=function(a,b){this.scale.x=a;this.scale.y=b;this.transforms();return this},a.setSkew=function(a,b){this.skew.x=a;this.skew.y=b;this.transforms();return this};return a};
switch(cc.sys.browserType){case cc.sys.BROWSER_TYPE_FIREFOX:cc.$.pfx="Moz";cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_CHROME:case cc.sys.BROWSER_TYPE_SAFARI:cc.$.pfx="webkit";cc.$.hd=!0;break;case cc.sys.BROWSER_TYPE_OPERA:cc.$.pfx="O";cc.$.hd=!1;break;case cc.sys.BROWSER_TYPE_IE:cc.$.pfx="ms";cc.$.hd=!1;break;default:cc.$.pfx="webkit",cc.$.hd=!0}cc.$.trans=cc.$.pfx+"Transform";
cc.$.translate=cc.$.hd?function(a){return"translate3d("+a.x+"px, "+a.y+"px, 0) "}:function(a){return"translate("+a.x+"px, "+a.y+"px) "};cc.$.rotate=cc.$.hd?function(a){return"rotateZ("+a+"deg) "}:function(a){return"rotate("+a+"deg) "};cc.$.scale=function(a){return"scale("+a.x+", "+a.y+") "};cc.$.skew=function(a){return"skewX("+-a.x+"deg) skewY("+a.y+"deg)"};cc.$new=function(a){return cc.$(document.createElement(a))};
cc.$.findpos=function(a){var b=0,c=0;do b+=a.offsetLeft,c+=a.offsetTop;while(a=a.offsetParent);return{x:b,y:c}};cc.INVALID_INDEX=-1;cc.PI=Math.PI;cc.FLT_MAX=parseFloat("3.402823466e+38F");cc.FLT_MIN=parseFloat("1.175494351e-38F");cc.RAD=cc.PI/180;cc.DEG=180/cc.PI;cc.UINT_MAX=4294967295;cc.swap=function(a,b,c){if(!cc.isObject(c)||cc.isUndefined(c.x)||cc.isUndefined(c.y))cc.log(cc._LogInfos.swap);else{var d=c[a];c[a]=c[b];c[b]=d}};cc.lerp=function(a,b,c){return a+(b-a)*c};cc.rand=function(){return 16777215*Math.random()};cc.randomMinus1To1=function(){return 2*(Math.random()-0.5)};cc.random0To1=Math.random;
cc.degreesToRadians=function(a){return a*cc.RAD};cc.radiansToDegrees=function(a){return a*cc.DEG};cc.radiansToDegress=function(a){cc.log(cc._LogInfos.radiansToDegress);return a*cc.DEG};cc.REPEAT_FOREVER=Number.MAX_VALUE-1;cc.nodeDrawSetup=function(a){a._shaderProgram&&(a._glProgramState.apply(),a._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4())};cc.enableDefaultGLStates=function(){};cc.disableDefaultGLStates=function(){};cc.incrementGLDraws=function(a){cc.g_NumberOfDraws+=a};
cc.FLT_EPSILON=1.192092896E-7;cc.contentScaleFactor=function(){return cc.director._contentScaleFactor};cc.pointPointsToPixels=function(a){var b=cc.contentScaleFactor();return cc.p(a.x*b,a.y*b)};cc.pointPixelsToPoints=function(a){var b=cc.contentScaleFactor();return cc.p(a.x/b,a.y/b)};cc._pointPixelsToPointsOut=function(a,b){var c=cc.contentScaleFactor();b.x=a.x/c;b.y=a.y/c};cc.sizePointsToPixels=function(a){var b=cc.contentScaleFactor();return cc.size(a.width*b,a.height*b)};
cc.sizePixelsToPoints=function(a){var b=cc.contentScaleFactor();return cc.size(a.width/b,a.height/b)};cc._sizePixelsToPointsOut=function(a,b){var c=cc.contentScaleFactor();b.width=a.width/c;b.height=a.height/c};cc.rectPixelsToPoints=function(a){var b=cc.contentScaleFactor();return cc.rect(a.x/b,a.y/b,a.width/b,a.height/b)};cc.rectPointsToPixels=function(a){var b=cc.contentScaleFactor();return cc.rect(a.x*b,a.y*b,a.width*b,a.height*b)};cc.ONE=1;cc.ZERO=0;cc.SRC_ALPHA=770;cc.SRC_ALPHA_SATURATE=776;
cc.SRC_COLOR=768;cc.DST_ALPHA=772;cc.DST_COLOR=774;cc.ONE_MINUS_SRC_ALPHA=771;cc.ONE_MINUS_SRC_COLOR=769;cc.ONE_MINUS_DST_ALPHA=773;cc.ONE_MINUS_DST_COLOR=775;cc.ONE_MINUS_CONSTANT_ALPHA=32772;cc.ONE_MINUS_CONSTANT_COLOR=32770;cc.LINEAR=9729;cc.REPEAT=10497;cc.CLAMP_TO_EDGE=33071;cc.MIRRORED_REPEAT=33648;cc.BLEND_SRC=cc.SRC_ALPHA;
cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA&&(cc.BLEND_SRC=cc.ONE)});cc.BLEND_DST=cc.ONE_MINUS_SRC_ALPHA;cc.checkGLErrorDebug=function(){if(cc.renderMode===cc.game.RENDER_TYPE_WEBGL){var a=cc._renderContext.getError();a&&cc.log(cc._LogInfos.checkGLErrorDebug,a)}};cc.ORIENTATION_PORTRAIT=1;cc.ORIENTATION_LANDSCAPE=2;cc.ORIENTATION_AUTO=3;
cc.CONCURRENCY_HTTP_REQUEST_COUNT=cc.sys.isMobile?20:0;cc.BATCH_VERTEX_COUNT=2E3;cc.VERTEX_ATTRIB_FLAG_NONE=0;cc.VERTEX_ATTRIB_FLAG_POSITION=1;cc.VERTEX_ATTRIB_FLAG_COLOR=2;cc.VERTEX_ATTRIB_FLAG_TEX_COORDS=4;cc.VERTEX_ATTRIB_FLAG_POS_COLOR_TEX=cc.VERTEX_ATTRIB_FLAG_POSITION|cc.VERTEX_ATTRIB_FLAG_COLOR|cc.VERTEX_ATTRIB_FLAG_TEX_COORDS;cc.GL_ALL=0;cc.VERTEX_ATTRIB_POSITION=0;cc.VERTEX_ATTRIB_COLOR=1;cc.VERTEX_ATTRIB_TEX_COORDS=2;cc.VERTEX_ATTRIB_MAX=7;cc.UNIFORM_PMATRIX=0;cc.UNIFORM_MVMATRIX=1;
cc.UNIFORM_MVPMATRIX=2;cc.UNIFORM_TIME=3;cc.UNIFORM_SINTIME=4;cc.UNIFORM_COSTIME=5;cc.UNIFORM_RANDOM01=6;cc.UNIFORM_SAMPLER=7;cc.UNIFORM_MAX=8;cc.SHADER_POSITION_TEXTURECOLOR="ShaderPositionTextureColor";cc.SHADER_SPRITE_POSITION_TEXTURECOLOR="ShaderSpritePositionTextureColor";cc.SHADER_SPRITE_POSITION_TEXTURECOLOR_GRAY="ShaderSpritePositionTextureColorGray";cc.SHADER_POSITION_TEXTURECOLORALPHATEST="ShaderPositionTextureColorAlphaTest";cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST="ShaderSpritePositionTextureColorAlphaTest";
cc.SHADER_POSITION_COLOR="ShaderPositionColor";cc.SHADER_SPRITE_POSITION_COLOR="ShaderSpritePositionColor";cc.SHADER_POSITION_TEXTURE="ShaderPositionTexture";cc.SHADER_POSITION_TEXTURE_UCOLOR="ShaderPositionTextureUColor";cc.SHADER_POSITION_TEXTUREA8COLOR="ShaderPositionTextureA8Color";cc.SHADER_POSITION_UCOLOR="ShaderPositionUColor";cc.SHADER_POSITION_LENGTHTEXTURECOLOR="ShaderPositionLengthTextureColor";cc.UNIFORM_PMATRIX_S="CC_PMatrix";cc.UNIFORM_MVMATRIX_S="CC_MVMatrix";
cc.UNIFORM_MVPMATRIX_S="CC_MVPMatrix";cc.UNIFORM_TIME_S="CC_Time";cc.UNIFORM_SINTIME_S="CC_SinTime";cc.UNIFORM_COSTIME_S="CC_CosTime";cc.UNIFORM_RANDOM01_S="CC_Random01";cc.UNIFORM_SAMPLER_S="CC_Texture0";cc.UNIFORM_ALPHA_TEST_VALUE_S="CC_alpha_value";cc.ATTRIBUTE_NAME_COLOR="a_color";cc.ATTRIBUTE_NAME_POSITION="a_position";cc.ATTRIBUTE_NAME_TEX_COORD="a_texCoord";cc.ATTRIBUTE_NAME_MVMAT="a_mvMatrix";cc.ITEM_SIZE=32;cc.CURRENT_ITEM=3233828865;cc.ZOOM_ACTION_TAG=3233828866;cc.NORMAL_TAG=8801;
cc.SELECTED_TAG=8802;cc.DISABLE_TAG=8803;cc.arrayVerifyType=function(a,b){if(a&&0<a.length)for(var c=0;c<a.length;c++)if(!(a[c]instanceof b))return cc.log("element type is wrong!"),!1;return!0};cc.arrayRemoveObject=function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b){a.splice(c,1);break}};cc.arrayRemoveArray=function(a,b){for(var c=0,d=b.length;c<d;c++)cc.arrayRemoveObject(a,b[c])};cc.arrayAppendObjectsToIndex=function(a,b,c){a.splice.apply(a,[c,0].concat(b));return a};
cc.copyArray=function(a){var b,c=a.length,d=Array(c);for(b=0;b<c;b+=1)d[b]=a[b];return d};cc.Color=function(a,b,c,d){this._val=((a||0)<<24>>>0)+((b||0)<<16)+((c||0)<<8)+("number"===typeof d?d:255)};_p=cc.Color.prototype;_p._getR=function(){return(this._val&4278190080)>>>24};_p._setR=function(a){this._val=this._val&16777215|a<<24>>>0};_p._getG=function(){return(this._val&16711680)>>16};_p._setG=function(a){this._val=this._val&4278255615|a<<16};_p._getB=function(){return(this._val&65280)>>8};_p._setB=function(a){this._val=this._val&4294902015|a<<8};_p._getA=function(){return this._val&255};
_p._setA=function(a){this._val=this._val&4294967040|a};cc.defineGetterSetter(_p,"r",_p._getR,_p._setR);cc.defineGetterSetter(_p,"g",_p._getG,_p._setG);cc.defineGetterSetter(_p,"b",_p._getB,_p._setB);cc.defineGetterSetter(_p,"a",_p._getA,_p._setA);cc.color=function(a,b,c,d){return void 0===a?new cc.Color(0,0,0,255):"object"===typeof a?new cc.Color(a.r,a.g,a.b,null==a.a?255:a.a):"string"===typeof a?cc.hexToColor(a):new cc.Color(a,b,c,null==d?255:d)};
cc.colorEqual=function(a,b){return a.r===b.r&&a.g===b.g&&a.b===b.b};cc.Acceleration=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.timestamp=d||0};cc.Vertex2F=function(a,b,c,d){this._arrayBuffer=c||new ArrayBuffer(cc.Vertex2F.BYTES_PER_ELEMENT);this._offset=d||0;this._view=new Float32Array(this._arrayBuffer,this._offset,2);this._view[0]=a||0;this._view[1]=b||0};cc.Vertex2F.BYTES_PER_ELEMENT=8;_p=cc.Vertex2F.prototype;_p._getX=function(){return this._view[0]};
_p._setX=function(a){this._view[0]=a};_p._getY=function(){return this._view[1]};_p._setY=function(a){this._view[1]=a};cc.defineGetterSetter(_p,"x",_p._getX,_p._setX);cc.defineGetterSetter(_p,"y",_p._getY,_p._setY);cc.Vertex3F=function(a,b,c,d,e){this._arrayBuffer=d||new ArrayBuffer(cc.Vertex3F.BYTES_PER_ELEMENT);this._offset=e||0;this._view=new Float32Array(this._arrayBuffer,this._offset,3);this._view[0]=a||0;this._view[1]=b||0;this._view[2]=c||0};cc.Vertex3F.BYTES_PER_ELEMENT=12;_p=cc.Vertex3F.prototype;
_p._getX=function(){return this._view[0]};_p._setX=function(a){this._view[0]=a};_p._getY=function(){return this._view[1]};_p._setY=function(a){this._view[1]=a};_p._getZ=function(){return this._view[2]};_p._setZ=function(a){this._view[2]=a};cc.defineGetterSetter(_p,"x",_p._getX,_p._setX);cc.defineGetterSetter(_p,"y",_p._getY,_p._setY);cc.defineGetterSetter(_p,"z",_p._getZ,_p._setZ);
cc.Tex2F=function(a,b,c,d){this._arrayBuffer=c||new ArrayBuffer(cc.Tex2F.BYTES_PER_ELEMENT);this._offset=d||0;this._view=new Float32Array(this._arrayBuffer,this._offset,2);this._view[0]=a||0;this._view[1]=b||0};cc.Tex2F.BYTES_PER_ELEMENT=8;_p=cc.Tex2F.prototype;_p._getU=function(){return this._view[0]};_p._setU=function(a){this._view[0]=a};_p._getV=function(){return this._view[1]};_p._setV=function(a){this._view[1]=a};cc.defineGetterSetter(_p,"u",_p._getU,_p._setU);
cc.defineGetterSetter(_p,"v",_p._getV,_p._setV);
cc.Quad2=function(a,b,c,d,e,f){this._arrayBuffer=e||new ArrayBuffer(cc.Quad2.BYTES_PER_ELEMENT);this._offset=f||0;e=this._arrayBuffer;f=this._offset;var g=cc.Vertex2F.BYTES_PER_ELEMENT;this._tl=a?new cc.Vertex2F(a.x,a.y,e,f):new cc.Vertex2F(0,0,e,f);f+=g;this._tr=b?new cc.Vertex2F(b.x,b.y,e,f):new cc.Vertex2F(0,0,e,f);f+=g;this._bl=c?new cc.Vertex2F(c.x,c.y,e,f):new cc.Vertex2F(0,0,e,f);f+=g;this._br=d?new cc.Vertex2F(d.x,d.y,e,f):new cc.Vertex2F(0,0,e,f)};cc.Quad2.BYTES_PER_ELEMENT=32;_p=cc.Quad2.prototype;
_p._getTL=function(){return this._tl};_p._setTL=function(a){this._tl._view[0]=a.x;this._tl._view[1]=a.y};_p._getTR=function(){return this._tr};_p._setTR=function(a){this._tr._view[0]=a.x;this._tr._view[1]=a.y};_p._getBL=function(){return this._bl};_p._setBL=function(a){this._bl._view[0]=a.x;this._bl._view[1]=a.y};_p._getBR=function(){return this._br};_p._setBR=function(a){this._br._view[0]=a.x;this._br._view[1]=a.y};cc.defineGetterSetter(_p,"tl",_p._getTL,_p._setTL);
cc.defineGetterSetter(_p,"tr",_p._getTR,_p._setTR);cc.defineGetterSetter(_p,"bl",_p._getBL,_p._setBL);cc.defineGetterSetter(_p,"br",_p._getBR,_p._setBR);
cc.Quad3=function(a,b,c,d,e,f){this._arrayBuffer=e||new ArrayBuffer(cc.Quad3.BYTES_PER_ELEMENT);this._offset=f||0;e=this._arrayBuffer;f=this._offset;var g=cc.Vertex3F.BYTES_PER_ELEMENT;this.bl=a?new cc.Vertex3F(a.x,a.y,a.z,e,f):new cc.Vertex3F(0,0,0,e,f);f+=g;this.br=b?new cc.Vertex3F(b.x,b.y,b.z,e,f):new cc.Vertex3F(0,0,0,e,f);f+=g;this.tl=c?new cc.Vertex3F(c.x,c.y,c.z,e,f):new cc.Vertex3F(0,0,0,e,f);f+=g;this.tr=d?new cc.Vertex3F(d.x,d.y,d.z,e,f):new cc.Vertex3F(0,0,0,e,f)};
cc.Quad3.BYTES_PER_ELEMENT=48;cc.V3F_C4B_T2F=function(a,b,c,d,e){this._arrayBuffer=d||new ArrayBuffer(cc.V3F_C4B_T2F.BYTES_PER_ELEMENT);this._offset=e||0;d=this._arrayBuffer;e=this._offset;this._vertices=a?new cc.Vertex3F(a.x,a.y,a.z,d,e):new cc.Vertex3F(0,0,0,d,e);e+=cc.Vertex3F.BYTES_PER_ELEMENT;this._colors=b?new cc._WebGLColor(b.r,b.g,b.b,b.a,d,e):new cc._WebGLColor(0,0,0,0,d,e);e+=cc._WebGLColor.BYTES_PER_ELEMENT;this._texCoords=c?new cc.Tex2F(c.u,c.v,d,e):new cc.Tex2F(0,0,d,e)};
cc.V3F_C4B_T2F.BYTES_PER_ELEMENT=24;_p=cc.V3F_C4B_T2F.prototype;_p._getVertices=function(){return this._vertices};_p._setVertices=function(a){var b=this._vertices;b._view[0]=a.x;b._view[1]=a.y;b._view[2]=a.z};_p._getColor=function(){return this._colors};_p._setColor=function(a){var b=this._colors;b._view[0]=a.r;b._view[1]=a.g;b._view[2]=a.b;b._view[3]=a.a};_p._getTexCoords=function(){return this._texCoords};_p._setTexCoords=function(a){this._texCoords._view[0]=a.u;this._texCoords._view[1]=a.v};
cc.defineGetterSetter(_p,"vertices",_p._getVertices,_p._setVertices);cc.defineGetterSetter(_p,"colors",_p._getColor,_p._setColor);cc.defineGetterSetter(_p,"texCoords",_p._getTexCoords,_p._setTexCoords);
cc.V3F_C4B_T2F_Quad=function(a,b,c,d,e,f){this._arrayBuffer=e||new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT);this._offset=f||0;e=this._arrayBuffer;f=this._offset;var g=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._tl=a?new cc.V3F_C4B_T2F(a.vertices,a.colors,a.texCoords,e,f):new cc.V3F_C4B_T2F(null,null,null,e,f);f+=g;this._bl=b?new cc.V3F_C4B_T2F(b.vertices,b.colors,b.texCoords,e,f):new cc.V3F_C4B_T2F(null,null,null,e,f);f+=g;this._tr=c?new cc.V3F_C4B_T2F(c.vertices,c.colors,c.texCoords,e,f):new cc.V3F_C4B_T2F(null,
null,null,e,f);f+=g;this._br=d?new cc.V3F_C4B_T2F(d.vertices,d.colors,d.texCoords,e,f):new cc.V3F_C4B_T2F(null,null,null,e,f)};cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT=96;_p=cc.V3F_C4B_T2F_Quad.prototype;_p._getTL=function(){return this._tl};_p._setTL=function(a){var b=this._tl;b.vertices=a.vertices;b.colors=a.colors;b.texCoords=a.texCoords};_p._getBL=function(){return this._bl};_p._setBL=function(a){var b=this._bl;b.vertices=a.vertices;b.colors=a.colors;b.texCoords=a.texCoords};_p._getTR=function(){return this._tr};
_p._setTR=function(a){var b=this._tr;b.vertices=a.vertices;b.colors=a.colors;b.texCoords=a.texCoords};_p._getBR=function(){return this._br};_p._setBR=function(a){var b=this._br;b.vertices=a.vertices;b.colors=a.colors;b.texCoords=a.texCoords};_p._getArrayBuffer=function(){return this._arrayBuffer};cc.defineGetterSetter(_p,"tl",_p._getTL,_p._setTL);cc.defineGetterSetter(_p,"tr",_p._getTR,_p._setTR);cc.defineGetterSetter(_p,"bl",_p._getBL,_p._setBL);cc.defineGetterSetter(_p,"br",_p._getBR,_p._setBR);
cc.defineGetterSetter(_p,"arrayBuffer",_p._getArrayBuffer,null);cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad};
cc.V3F_C4B_T2F_QuadCopy=function(a){if(!a)return cc.V3F_C4B_T2F_QuadZero();var b=a.tl,c=a.bl,d=a.tr;a=a.br;return{tl:{vertices:{x:b.vertices.x,y:b.vertices.y,z:b.vertices.z},colors:{r:b.colors.r,g:b.colors.g,b:b.colors.b,a:b.colors.a},texCoords:{u:b.texCoords.u,v:b.texCoords.v}},bl:{vertices:{x:c.vertices.x,y:c.vertices.y,z:c.vertices.z},colors:{r:c.colors.r,g:c.colors.g,b:c.colors.b,a:c.colors.a},texCoords:{u:c.texCoords.u,v:c.texCoords.v}},tr:{vertices:{x:d.vertices.x,y:d.vertices.y,z:d.vertices.z},
colors:{r:d.colors.r,g:d.colors.g,b:d.colors.b,a:d.colors.a},texCoords:{u:d.texCoords.u,v:d.texCoords.v}},br:{vertices:{x:a.vertices.x,y:a.vertices.y,z:a.vertices.z},colors:{r:a.colors.r,g:a.colors.g,b:a.colors.b,a:a.colors.a},texCoords:{u:a.texCoords.u,v:a.texCoords.v}}}};cc.V3F_C4B_T2F_QuadsCopy=function(a){if(!a)return[];for(var b=[],c=0;c<a.length;c++)b.push(cc.V3F_C4B_T2F_QuadCopy(a[c]));return b};
cc.V2F_C4B_T2F=function(a,b,c,d,e){this._arrayBuffer=d||new ArrayBuffer(cc.V2F_C4B_T2F.BYTES_PER_ELEMENT);this._offset=e||0;d=this._arrayBuffer;e=this._offset;this._vertices=a?new cc.Vertex2F(a.x,a.y,d,e):new cc.Vertex2F(0,0,d,e);e+=cc.Vertex2F.BYTES_PER_ELEMENT;this._colors=b?new cc._WebGLColor(b.r,b.g,b.b,b.a,d,e):new cc._WebGLColor(0,0,0,0,d,e);e+=cc._WebGLColor.BYTES_PER_ELEMENT;this._texCoords=c?new cc.Tex2F(c.u,c.v,d,e):new cc.Tex2F(0,0,d,e)};cc.V2F_C4B_T2F.BYTES_PER_ELEMENT=20;_p=cc.V2F_C4B_T2F.prototype;
_p._getVertices=function(){return this._vertices};_p._setVertices=function(a){this._vertices._view[0]=a.x;this._vertices._view[1]=a.y};_p._getColor=function(){return this._colors};_p._setColor=function(a){var b=this._colors;b._view[0]=a.r;b._view[1]=a.g;b._view[2]=a.b;b._view[3]=a.a};_p._getTexCoords=function(){return this._texCoords};_p._setTexCoords=function(a){this._texCoords._view[0]=a.u;this._texCoords._view[1]=a.v};cc.defineGetterSetter(_p,"vertices",_p._getVertices,_p._setVertices);
cc.defineGetterSetter(_p,"colors",_p._getColor,_p._setColor);cc.defineGetterSetter(_p,"texCoords",_p._getTexCoords,_p._setTexCoords);
cc.V2F_C4B_T2F_Triangle=function(a,b,c,d,e){this._arrayBuffer=d||new ArrayBuffer(cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT);this._offset=e||0;d=this._arrayBuffer;e=this._offset;var f=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._a=a?new cc.V2F_C4B_T2F(a.vertices,a.colors,a.texCoords,d,e):new cc.V2F_C4B_T2F(null,null,null,d,e);e+=f;this._b=b?new cc.V2F_C4B_T2F(b.vertices,b.colors,b.texCoords,d,e):new cc.V2F_C4B_T2F(null,null,null,d,e);e+=f;this._c=c?new cc.V2F_C4B_T2F(c.vertices,c.colors,c.texCoords,d,e):
new cc.V2F_C4B_T2F(null,null,null,d,e)};cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT=60;_p=cc.V2F_C4B_T2F_Triangle.prototype;_p._getA=function(){return this._a};_p._setA=function(a){var b=this._a;b.vertices=a.vertices;b.colors=a.colors;b.texCoords=a.texCoords};_p._getB=function(){return this._b};_p._setB=function(a){var b=this._b;b.vertices=a.vertices;b.colors=a.colors;b.texCoords=a.texCoords};_p._getC=function(){return this._c};
_p._setC=function(a){var b=this._c;b.vertices=a.vertices;b.colors=a.colors;b.texCoords=a.texCoords};cc.defineGetterSetter(_p,"a",_p._getA,_p._setA);cc.defineGetterSetter(_p,"b",_p._getB,_p._setB);cc.defineGetterSetter(_p,"c",_p._getC,_p._setC);cc.vertex2=function(a,b){return new cc.Vertex2F(a,b)};cc.vertex3=function(a,b,c){return new cc.Vertex3F(a,b,c)};cc.tex2=function(a,b){return new cc.Tex2F(a,b)};cc.BlendFunc=function(a,b){this.src=a;this.dst=b};
cc.blendFuncDisable=function(){return new cc.BlendFunc(cc.ONE,cc.ZERO)};cc.hexToColor=function(a){a=a.replace(/^#?/,"0x");a=parseInt(a);return new cc.Color(a>>16,(a>>8)%256,a%256)};cc.colorToHex=function(a){var b=a.r.toString(16),c=a.g.toString(16),d=a.b.toString(16);return"#"+(16>a.r?"0"+b:b)+(16>a.g?"0"+c:c)+(16>a.b?"0"+d:d)};cc.TEXT_ALIGNMENT_LEFT=0;cc.TEXT_ALIGNMENT_CENTER=1;cc.TEXT_ALIGNMENT_RIGHT=2;cc.VERTICAL_TEXT_ALIGNMENT_TOP=0;cc.VERTICAL_TEXT_ALIGNMENT_CENTER=1;
cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM=2;
cc._Dictionary=cc.Class.extend({_keyMapTb:null,_valueMapTb:null,__currId:0,ctor:function(){this._keyMapTb={};this._valueMapTb={};this.__currId=2<<(0|10*Math.random())},__getKey:function(){this.__currId++;return"key_"+this.__currId},setObject:function(a,b){if(null!=b){var c=this.__getKey();this._keyMapTb[c]=b;this._valueMapTb[c]=a}},objectForKey:function(a){if(null==a)return null;var b=this._keyMapTb,c;for(c in b)if(b[c]===a)return this._valueMapTb[c];return null},valueForKey:function(a){return this.objectForKey(a)},
removeObjectForKey:function(a){if(null!=a){var b=this._keyMapTb,c;for(c in b)if(b[c]===a){delete this._valueMapTb[c];delete b[c];break}}},removeObjectsForKeys:function(a){if(null!=a)for(var b=0;b<a.length;b++)this.removeObjectForKey(a[b])},allKeys:function(){var a=[],b=this._keyMapTb,c;for(c in b)a.push(b[c]);return a},removeAllObjects:function(){this._keyMapTb={};this._valueMapTb={}},count:function(){return this.allKeys().length}});
cc.FontDefinition=function(a){this.fontName="Arial";this.fontSize=12;this.textAlign=cc.TEXT_ALIGNMENT_CENTER;this.verticalAlign=cc.VERTICAL_TEXT_ALIGNMENT_TOP;this.fillStyle=cc.color(255,255,255,255);this.boundingHeight=this.boundingWidth=0;this.strokeEnabled=!1;this.strokeStyle=cc.color(255,255,255,255);this.lineWidth=1;this.fontWeight=this.fontStyle=this.lineHeight="normal";this.shadowEnabled=!1;this.shadowBlur=this.shadowOffsetY=this.shadowOffsetX=0;this.shadowOpacity=1;if(a&&a instanceof Object)for(var b in a)this[b]=
a[b]};cc.FontDefinition.prototype._getCanvasFontStr=function(){return this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px/"+(this.lineHeight.charAt?this.lineHeight:this.lineHeight+"px")+" '"+this.fontName+"'"};
cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc._WebGLColor=function(a,b,c,d,e,f){this._arrayBuffer=e||new ArrayBuffer(cc._WebGLColor.BYTES_PER_ELEMENT);this._offset=f||0;this._view=new Uint8Array(this._arrayBuffer,this._offset,4);this._view[0]=a||0;this._view[1]=b||0;this._view[2]=c||0;this._view[3]=null==d?255:d;void 0===d&&(this.a_undefined=!0)},cc._WebGLColor.BYTES_PER_ELEMENT=4,_p=cc._WebGLColor.prototype,_p._getR=function(){return this._view[0]},
_p._setR=function(a){this._view[0]=0>a?0:a},_p._getG=function(){return this._view[1]},_p._setG=function(a){this._view[1]=0>a?0:a},_p._getB=function(){return this._view[2]},_p._setB=function(a){this._view[2]=0>a?0:a},_p._getA=function(){return this._view[3]},_p._setA=function(a){this._view[3]=0>a?0:a},cc.defineGetterSetter(_p,"r",_p._getR,_p._setR),cc.defineGetterSetter(_p,"g",_p._getG,_p._setG),cc.defineGetterSetter(_p,"b",_p._getB,_p._setB),cc.defineGetterSetter(_p,"a",_p._getA,_p._setA))});_p=cc.color;
_p._getWhite=function(){return cc.color(255,255,255)};_p._getYellow=function(){return cc.color(255,255,0)};_p._getBlue=function(){return cc.color(0,0,255)};_p._getGreen=function(){return cc.color(0,255,0)};_p._getRed=function(){return cc.color(255,0,0)};_p._getMagenta=function(){return cc.color(255,0,255)};_p._getBlack=function(){return cc.color(0,0,0)};_p._getOrange=function(){return cc.color(255,127,0)};_p._getGray=function(){return cc.color(166,166,166)};cc.defineGetterSetter(_p,"WHITE",_p._getWhite);
cc.defineGetterSetter(_p,"YELLOW",_p._getYellow);cc.defineGetterSetter(_p,"BLUE",_p._getBlue);cc.defineGetterSetter(_p,"GREEN",_p._getGreen);cc.defineGetterSetter(_p,"RED",_p._getRed);cc.defineGetterSetter(_p,"MAGENTA",_p._getMagenta);cc.defineGetterSetter(_p,"BLACK",_p._getBlack);cc.defineGetterSetter(_p,"ORANGE",_p._getOrange);cc.defineGetterSetter(_p,"GRAY",_p._getGray);cc.BlendFunc._disable=function(){return new cc.BlendFunc(cc.ONE,cc.ZERO)};
cc.BlendFunc._alphaPremultiplied=function(){return new cc.BlendFunc(cc.ONE,cc.ONE_MINUS_SRC_ALPHA)};cc.BlendFunc._alphaNonPremultiplied=function(){return new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA)};cc.BlendFunc._additive=function(){return new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE)};cc.defineGetterSetter(cc.BlendFunc,"DISABLE",cc.BlendFunc._disable);cc.defineGetterSetter(cc.BlendFunc,"ALPHA_PREMULTIPLIED",cc.BlendFunc._alphaPremultiplied);
cc.defineGetterSetter(cc.BlendFunc,"ALPHA_NON_PREMULTIPLIED",cc.BlendFunc._alphaNonPremultiplied);cc.defineGetterSetter(cc.BlendFunc,"ADDITIVE",cc.BlendFunc._additive);cc.Touches=[];cc.TouchesIntergerDict={};cc.DENSITYDPI_DEVICE="device-dpi";cc.DENSITYDPI_HIGH="high-dpi";cc.DENSITYDPI_MEDIUM="medium-dpi";cc.DENSITYDPI_LOW="low-dpi";var __BrowserGetter={init:function(){this.html=document.documentElement},availWidth:function(a){return a&&a!==this.html?a.clientWidth:window.innerWidth},availHeight:function(a){return a&&a!==this.html?a.clientHeight:window.innerHeight},meta:{width:"device-width"},adaptationType:cc.sys.browserType};
-1<window.navigator.userAgent.indexOf("OS 8_1_")&&(__BrowserGetter.adaptationType=cc.sys.BROWSER_TYPE_MIUI);cc.sys.os===cc.sys.OS_IOS&&(__BrowserGetter.adaptationType=cc.sys.BROWSER_TYPE_SAFARI);
switch(__BrowserGetter.adaptationType){case cc.sys.BROWSER_TYPE_SAFARI:__BrowserGetter.meta["minimal-ui"]="true";break;case cc.sys.BROWSER_TYPE_CHROME:__BrowserGetter.__defineGetter__("target-densitydpi",function(){return cc.view._targetDensityDPI});break;case cc.sys.BROWSER_TYPE_MIUI:__BrowserGetter.init=function(a){if(!a.__resizeWithBrowserSize){var b=function(){a.setDesignResolutionSize(a._designResolutionSize.width,a._designResolutionSize.height,a._resolutionPolicy);window.removeEventListener("resize",
b,!1)};window.addEventListener("resize",b,!1)}}}var _scissorRect=null;
cc.EGLView=cc.Class.extend({_delegate:null,_frameSize:null,_designResolutionSize:null,_originalDesignResolutionSize:null,_viewPortRect:null,_visibleRect:null,_retinaEnabled:!1,_autoFullScreen:!1,_devicePixelRatio:1,_viewName:"",_resizeCallback:null,_orientationChanging:!0,_resizing:!1,_scaleX:1,_originalScaleX:1,_scaleY:1,_originalScaleY:1,_isRotated:!1,_orientation:3,_resolutionPolicy:null,_rpExactFit:null,_rpShowAll:null,_rpNoBorder:null,_rpFixedHeight:null,_rpFixedWidth:null,_initialized:!1,_contentTranslateLeftTop:null,
_frame:null,_frameZoomFactor:1,__resizeWithBrowserSize:!1,_isAdjustViewPort:!0,_targetDensityDPI:null,ctor:function(){var a=document,b=cc.ContainerStrategy,c=cc.ContentStrategy;__BrowserGetter.init(this);this._frame=cc.container.parentNode===a.body?a.documentElement:cc.container.parentNode;this._frameSize=cc.size(0,0);this._initFrameSize();var a=cc._canvas.width,d=cc._canvas.height;this._designResolutionSize=cc.size(a,d);this._originalDesignResolutionSize=cc.size(a,d);this._viewPortRect=cc.rect(0,
0,a,d);this._visibleRect=cc.rect(0,0,a,d);this._contentTranslateLeftTop={left:0,top:0};this._viewName="Cocos2dHTML5";a=cc.sys;cc.visibleRect&&cc.visibleRect.init(this._visibleRect);this._rpExactFit=new cc.ResolutionPolicy(b.EQUAL_TO_FRAME,c.EXACT_FIT);this._rpShowAll=new cc.ResolutionPolicy(b.PROPORTION_TO_FRAME,c.SHOW_ALL);this._rpNoBorder=new cc.ResolutionPolicy(b.EQUAL_TO_FRAME,c.NO_BORDER);this._rpFixedHeight=new cc.ResolutionPolicy(b.EQUAL_TO_FRAME,c.FIXED_HEIGHT);this._rpFixedWidth=new cc.ResolutionPolicy(b.EQUAL_TO_FRAME,
c.FIXED_WIDTH);this._targetDensityDPI=cc.DENSITYDPI_HIGH;a.isMobile&&window.addEventListener("orientationchange",this._orientationChange)},_resizeEvent:function(){var a;a=this.setDesignResolutionSize?this:cc.view;if(!a._orientationChanging){var b=a._frameSize.width,c=a._frameSize.height,d=a._isRotated;if(cc.sys.isMobile){var e=cc.game.container.style,f=e.margin;e.margin="0";e.display="none";a._initFrameSize();e.margin=f;e.display="block"}else a._initFrameSize();if(a._isRotated!==d||a._frameSize.width!==
b||a._frameSize.height!==c)b=a._originalDesignResolutionSize.width,c=a._originalDesignResolutionSize.height,a._resizing=!0,0<b&&a.setDesignResolutionSize(b,c,a._resolutionPolicy),a._resizing=!1,cc.eventManager.dispatchCustomEvent("canvas-resize"),a._resizeCallback&&a._resizeCallback.call()}},_orientationChange:function(){cc.view._orientationChanging=!0;cc.sys.isMobile&&(cc.game.container.style.display="none");setTimeout(function(){cc.view._orientationChanging=!1;cc.view._resizeEvent()},300)},setTargetDensityDPI:function(a){this._targetDensityDPI=
a;this._adjustViewportMeta()},getTargetDensityDPI:function(){return this._targetDensityDPI},resizeWithBrowserSize:function(a){a?this.__resizeWithBrowserSize||(this.__resizeWithBrowserSize=!0,wx.onWindowResize&&wx.onWindowResize(function(a){console.warn("wx.onWindowResize :"+a.windowWidth+", "+a.windowHeight);this._resizeEvent()})):this.__resizeWithBrowserSize&&(this.__resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent))},setResizeCallback:function(a){if("function"===typeof a||
null==a)this._resizeCallback=a},setOrientation:function(a){(a&=cc.ORIENTATION_AUTO)&&this._orientation!==a&&(this._orientation=a,this._resolutionPolicy&&this.setDesignResolutionSize(this._originalDesignResolutionSize.width,this._originalDesignResolutionSize.height,this._resolutionPolicy))},setDocumentPixelWidth:function(a){this._setViewportMeta({width:a},!0);document.documentElement.style.width=a+"px";document.body.style.width="100%";this.setDesignResolutionSize(this._designResolutionSize.width,this._designResolutionSize.height,
this._resolutionPolicy)},_initFrameSize:function(){var a=this._frameSize,b=__BrowserGetter.availWidth(this._frame),c=__BrowserGetter.availHeight(this._frame),d=b>=c;!cc.sys.isMobile||d&&this._orientation&cc.ORIENTATION_LANDSCAPE||!d&&this._orientation&cc.ORIENTATION_PORTRAIT?(a.width=b,a.height=c,cc.container.style["-webkit-transform"]="rotate(0deg)",cc.container.style.transform="rotate(0deg)",this._isRotated=!1):(a.width=c,a.height=b,cc.container.style["-webkit-transform"]="rotate(90deg)",cc.container.style.transform=
"rotate(90deg)",cc.container.style["-webkit-transform-origin"]="0px 0px 0px",cc.container.style.transformOrigin="0px 0px 0px",this._isRotated=!0)},_adjustSizeKeepCanvasSize:function(){var a=this._originalDesignResolutionSize.width,b=this._originalDesignResolutionSize.height;0<a&&this.setDesignResolutionSize(a,b,this._resolutionPolicy)},_setViewportMeta:function(a,b){if(!window.wx){var c=document.getElementById("cocosMetaElement");c&&b&&document.head.removeChild(c);var d=document.getElementsByName("viewport"),
d=d?d[0]:null,e,f,g;e=d?d.content:"";c=c||document.createElement("meta");c.id="cocosMetaElement";c.name="viewport";c.content="";for(f in a)-1==e.indexOf(f)?e+=","+f+"\x3d"+a[f]:b&&(g=RegExp(f+"s*\x3ds*[^,]+"),e.replace(g,f+"\x3d"+a[f]));/^,/.test(e)&&(e=e.substr(1));c.content=e;d&&(d.content=e);document.head.appendChild(c)}},_adjustViewportMeta:function(){this._isAdjustViewPort&&(this._setViewportMeta(__BrowserGetter.meta,!1),this._isAdjustViewPort=!1)},_setScaleXYForRenderTexture:function(){var a=
cc.contentScaleFactor();this._scaleY=this._scaleX=a},_resetScale:function(){this._scaleX=this._originalScaleX;this._scaleY=this._originalScaleY},_adjustSizeToBrowser:function(){},initialize:function(){this._initialized=!0},adjustViewPort:function(a){this._isAdjustViewPort=a},enableRetina:function(a){this._retinaEnabled=!!a},isRetinaEnabled:function(){return this._retinaEnabled},enableAutoFullScreen:function(a){a&&a!==this._autoFullScreen&&cc.sys.isMobile&&this._frame===document.documentElement?(this._autoFullScreen=
!0,cc.screen.autoFullScreen(this._frame)):this._autoFullScreen=!1},isAutoFullScreenEnabled:function(){return this._autoFullScreen},isOpenGLReady:function(){return cc.game.canvas&&cc._renderContext},setFrameZoomFactor:function(a){this._frameZoomFactor=a;this.centerWindow();cc.director.setProjection(cc.director.getProjection())},swapBuffers:function(){},setIMEKeyboardState:function(a){},setContentTranslateLeftTop:function(a,b){this._contentTranslateLeftTop={left:a,top:b}},getContentTranslateLeftTop:function(){return this._contentTranslateLeftTop},
getCanvasSize:function(){return cc.size(cc._canvas.width,cc._canvas.height)},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(a,b){this._frameSize.width=a;this._frameSize.height=b;this._frame.style.width=a+"px";this._frame.style.height=b+"px";this._resizeEvent();cc.director.setProjection(cc.director.getProjection())},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleSizeInPixel:function(){return cc.size(this._visibleRect.width*
this._scaleX,this._visibleRect.height*this._scaleY)},getVisibleOrigin:function(){return cc.p(this._visibleRect.x,this._visibleRect.y)},getVisibleOriginInPixel:function(){return cc.p(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},canSetContentScaleFactor:function(){return!0},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(a){if(a instanceof cc.ResolutionPolicy)this._resolutionPolicy=a;else{var b=cc.ResolutionPolicy;a===b.EXACT_FIT&&(this._resolutionPolicy=
this._rpExactFit);a===b.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll);a===b.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder);a===b.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight);a===b.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}},setDesignResolutionSize:function(a,b,c){if(0<a||0<b)if(this.setResolutionPolicy(c),(c=this._resolutionPolicy)&&c.preApply(this),cc.sys.isMobile&&this._adjustViewportMeta(),this._resizing||this._initFrameSize(),c){this._originalDesignResolutionSize.width=
this._designResolutionSize.width=a;this._originalDesignResolutionSize.height=this._designResolutionSize.height=b;var d=c.apply(this,this._designResolutionSize);d.scale&&2===d.scale.length&&(this._scaleX=d.scale[0],this._scaleY=d.scale[1]);d.viewport&&(a=this._viewPortRect,b=this._visibleRect,d=d.viewport,a.x=d.x,a.y=d.y,a.width=d.width,a.height=d.height,b.x=-a.x/this._scaleX,b.y=-a.y/this._scaleY,b.width=cc._canvas.width/this._scaleX,b.height=cc._canvas.height/this._scaleY,cc._renderContext.setOffset&&
cc._renderContext.setOffset(a.x,-a.y));a=cc.director;a._winSizeInPoints.width=this._designResolutionSize.width;a._winSizeInPoints.height=this._designResolutionSize.height;c.postApply(this);cc.winSize.width=a._winSizeInPoints.width;cc.winSize.height=a._winSizeInPoints.height;cc._renderType===cc.game.RENDER_TYPE_WEBGL?a.setGLDefaultValues():cc._renderType===cc.game.RENDER_TYPE_CANVAS&&(cc.renderer._allNeedDraw=!0);this._originalScaleX=this._scaleX;this._originalScaleY=this._scaleY;cc.visibleRect&&cc.visibleRect.init(this._visibleRect)}else cc.log(cc._LogInfos.EGLView_setDesignResolutionSize_2);
else cc.log(cc._LogInfos.EGLView_setDesignResolutionSize)},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setRealPixelResolution:function(a,b,c){this._setViewportMeta({width:a},!0);document.documentElement.style.width=a+"px";document.body.style.width=a+"px";document.body.style.left="0px";document.body.style.top="0px";this.setDesignResolutionSize(a,b,c)},setViewPortInPoints:function(a,b,c,d){var e=this._frameZoomFactor,f=this._scaleX,
g=this._scaleY;cc._renderContext.viewport(a*f*e+this._viewPortRect.x*e,b*g*e+this._viewPortRect.y*e,c*f*e,d*g*e)},setScissorInPoints:function(a,b,c,d){var e=this._frameZoomFactor,f=this._scaleX,g=this._scaleY;a=Math.ceil(a*f*e+this._viewPortRect.x*e);b=Math.ceil(b*g*e+this._viewPortRect.y*e);c=Math.ceil(c*f*e);d=Math.ceil(d*g*e);_scissorRect||(e=gl.getParameter(gl.SCISSOR_BOX),_scissorRect=cc.rect(e[0],e[1],e[2],e[3]));if(_scissorRect.x!=a||_scissorRect.y!=b||_scissorRect.width!=c||_scissorRect.height!=
d)_scissorRect.x=a,_scissorRect.y=b,_scissorRect.width=c,_scissorRect.height=d,cc._renderContext.scissor(a,b,c,d)},isScissorEnabled:function(){return cc._renderContext.isEnabled(gl.SCISSOR_TEST)},getScissorRect:function(){if(!_scissorRect){var a=gl.getParameter(gl.SCISSOR_BOX);_scissorRect=cc.rect(a[0],a[1],a[2],a[3])}var a=1/this._scaleX,b=1/this._scaleY;return cc.rect((_scissorRect.x-this._viewPortRect.x)*a,(_scissorRect.y-this._viewPortRect.y)*b,_scissorRect.width*a,_scissorRect.height*b)},setViewName:function(a){null!=
a&&0<a.length&&(this._viewName=a)},getViewName:function(){return this._viewName},getViewPortRect:function(){return this._viewPortRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(a,b,c){a=this._devicePixelRatio*(a-c.left);b=this._devicePixelRatio*(c.top+c.height-b);return this._isRotated?{x:this._viewPortRect.width-b,y:a}:{x:a,y:b}},_convertMouseToLocationInView:function(a,
b){var c=this._viewPortRect;a.x=(this._devicePixelRatio*(a.x-b.left)-c.x)/this._scaleX;a.y=(this._devicePixelRatio*(b.top+b.height-a.y)-c.y)/this._scaleY},_convertPointWithScale:function(a){var b=this._viewPortRect;a.x=(a.x-b.x)/this._scaleX;a.y=(a.y-b.y)/this._scaleY},_convertTouchesWithScale:function(a){for(var b=this._viewPortRect,c=this._scaleX,d=this._scaleY,e,f,g=0;g<a.length;g++)e=a[g],f=e._point,e=e._prevPoint,f.x=(f.x-b.x)/c,f.y=(f.y-b.y)/d,e.x=(e.x-b.x)/c,e.y=(e.y-b.y)/d}});
cc.EGLView._getInstance=function(){this._instance||(this._instance=this._instance||new cc.EGLView,this._instance.initialize());return this._instance};
cc.ContainerStrategy=cc.Class.extend({preApply:function(a){},apply:function(a,b){},postApply:function(a){},_setupContainer:function(a,b,c){var d=cc.game.canvas,e=cc.game.container;cc.sys.os===cc.sys.OS_ANDROID&&(document.body.style.width=(a._isRotated?c:b)+"px",document.body.style.height=(a._isRotated?b:c)+"px");e.style.width=d.style.width=b+"px";e.style.height=d.style.height=c+"px";e=a._devicePixelRatio=1;a.isRetinaEnabled()&&(e=a._devicePixelRatio=Math.min(2,window.devicePixelRatio||1));d.width=
b*e;d.height=c*e;cc._renderContext.resetCache&&cc._renderContext.resetCache()},_fixContainer:function(){document.body.insertBefore(cc.container,document.body.firstChild);var a=document.body.style;a.width=window.innerWidth+"px";a.height=window.innerHeight+"px";a.overflow="hidden";a=cc.container.style;a.position="fixed";a.left=a.top="0px";document.body.scrollTop=0}});
cc.ContentStrategy=cc.Class.extend({_result:{scale:[1,1],viewport:null},_buildResult:function(a,b,c,d,e,f){2>Math.abs(a-c)&&(c=a);2>Math.abs(b-d)&&(d=b);a=cc.rect(Math.round((a-c)/2),Math.round((b-d)/2),c,d);this._result.scale=[e,f];this._result.viewport=a;return this._result},preApply:function(a){},apply:function(a,b){return{scale:[1,1]}},postApply:function(a){}});
(function(){var a=cc.ContainerStrategy.extend({apply:function(a){var b=a._frameSize.height,c=cc.container.style;this._setupContainer(a,a._frameSize.width,a._frameSize.height);c.margin=a._isRotated?"0 0 0 "+b+"px":"0px"}}),b=cc.ContainerStrategy.extend({apply:function(a,b){var c=a._frameSize.width,d=a._frameSize.height,e=cc.container.style,n=b.width,p=b.height,r=c/n,s=d/p,u,t;r<s?(u=c,t=p*r):(u=n*s,t=d);n=Math.round((c-u)/2);t=Math.round((d-t)/2);this._setupContainer(a,c-2*n,d-2*t);e.margin=a._isRotated?
"0 0 0 "+d+"px":"0px";e.paddingLeft=n+"px";e.paddingRight=n+"px";e.paddingTop=t+"px";e.paddingBottom=t+"px"}});a.extend({preApply:function(a){this._super(a);a._frame=document.documentElement},apply:function(a){this._super(a);this._fixContainer()}});b.extend({preApply:function(a){this._super(a);a._frame=document.documentElement},apply:function(a,b){this._super(a,b);this._fixContainer()}});var c=cc.ContainerStrategy.extend({apply:function(a){this._setupContainer(a,cc._canvas.width,cc._canvas.height)}});
cc.ContainerStrategy.EQUAL_TO_FRAME=new a;cc.ContainerStrategy.PROPORTION_TO_FRAME=new b;cc.ContainerStrategy.ORIGINAL_CONTAINER=new c;var a=cc.ContentStrategy.extend({apply:function(a,b){var c=cc._canvas.width,d=cc._canvas.height;return this._buildResult(c,d,c,d,c/b.width,d/b.height)}}),b=cc.ContentStrategy.extend({apply:function(a,b){var c=cc._canvas.width,d=cc._canvas.height,e=b.width,n=b.height,p=c/e,r=d/n,s=0,u,t;p<r?(s=p,u=c,t=n*s):(s=r,u=e*s,t=d);return this._buildResult(c,d,u,t,s,s)}}),c=
cc.ContentStrategy.extend({apply:function(a,b){var c=cc._canvas.width,d=cc._canvas.height,e=b.width,n=b.height,p=c/e,r=d/n,s,u,t;p<r?(s=r,u=e*s,t=d):(s=p,u=c,t=n*s);return this._buildResult(c,d,u,t,s,s)}}),d=cc.ContentStrategy.extend({apply:function(a,b){var c=cc._canvas.width,d=cc._canvas.height,e=d/b.height;return this._buildResult(c,d,c,d,e,e)},postApply:function(a){cc.director._winSizeInPoints=a.getVisibleSize()}}),e=cc.ContentStrategy.extend({apply:function(a,b){var c=cc._canvas.width,d=cc._canvas.height,
e=c/b.width;return this._buildResult(c,d,c,d,e,e)},postApply:function(a){cc.director._winSizeInPoints=a.getVisibleSize()}});cc.ContentStrategy.EXACT_FIT=new a;cc.ContentStrategy.SHOW_ALL=new b;cc.ContentStrategy.NO_BORDER=new c;cc.ContentStrategy.FIXED_HEIGHT=new d;cc.ContentStrategy.FIXED_WIDTH=new e})();
cc.ResolutionPolicy=cc.Class.extend({_containerStrategy:null,_contentStrategy:null,ctor:function(a,b){this.setContainerStrategy(a);this.setContentStrategy(b)},preApply:function(a){this._containerStrategy.preApply(a);this._contentStrategy.preApply(a)},apply:function(a,b){this._containerStrategy.apply(a,b);return this._contentStrategy.apply(a,b)},postApply:function(a){this._containerStrategy.postApply(a);this._contentStrategy.postApply(a)},setContainerStrategy:function(a){a instanceof cc.ContainerStrategy&&
(this._containerStrategy=a)},setContentStrategy:function(a){a instanceof cc.ContentStrategy&&(this._contentStrategy=a)}});cc.ResolutionPolicy.EXACT_FIT=0;cc.ResolutionPolicy.NO_BORDER=1;cc.ResolutionPolicy.SHOW_ALL=2;cc.ResolutionPolicy.FIXED_HEIGHT=3;cc.ResolutionPolicy.FIXED_WIDTH=4;cc.ResolutionPolicy.UNKNOWN=5;cc.screen={_supportsFullScreen:!1,_preOnFullScreenChange:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen",
"mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){this._fn={};var a,b,c=this._fnMap,d;a=0;for(l=c.length;a<l;a++)if((b=c[a])&&b[1]in document){a=0;for(d=b.length;a<d;a++)this._fn[c[0][a]]=b[a];break}this._supportsFullScreen="undefined"!==typeof this._fn.requestFullscreen;this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},fullScreen:function(){return this._supportsFullScreen?void 0===
document[this._fn.fullscreenElement]||null===document[this._fn.fullscreenElement]?!1:!0:!1},requestFullScreen:function(a,b){if(this._supportsFullScreen){a=a||document.documentElement;if(b){var c=this._fn.fullscreenchange;this._preOnFullScreenChange&&document.removeEventListener(c,this._preOnFullScreenChange);this._preOnFullScreenChange=b;document.addEventListener(c,b,!1)}return a[this._fn.requestFullscreen]()}},exitFullScreen:function(){return this._supportsFullScreen?document[this._fn.exitFullscreen]():
!0},autoFullScreen:function(a,b){function c(){d.removeEventListener(e._touchEvent,c);e.requestFullScreen(a,b)}a=a||document.body;var d=cc.game.canvas||a,e=this;this.requestFullScreen(a,b);d.addEventListener(this._touchEvent,c)}};cc.screen.init();cc.visibleRect={topLeft:cc.p(0,0),topRight:cc.p(0,0),top:cc.p(0,0),bottomLeft:cc.p(0,0),bottomRight:cc.p(0,0),bottom:cc.p(0,0),center:cc.p(0,0),left:cc.p(0,0),right:cc.p(0,0),width:0,height:0,init:function(a){var b=this.width=a.width,c=this.height=a.height,d=a.x;a=a.y;var e=a+c,f=d+b;this.topLeft.x=d;this.topLeft.y=e;this.topRight.x=f;this.topRight.y=e;this.top.x=d+b/2;this.top.y=e;this.bottomLeft.x=d;this.bottomLeft.y=a;this.bottomRight.x=f;this.bottomRight.y=a;this.bottom.x=d+b/2;this.bottom.y=
a;this.center.x=d+b/2;this.center.y=a+c/2;this.left.x=d;this.left.y=a+c/2;this.right.x=f;this.right.y=a+c/2}};cc.UIInterfaceOrientationLandscapeLeft=-90;cc.UIInterfaceOrientationLandscapeRight=90;cc.UIInterfaceOrientationPortraitUpsideDown=180;cc.UIInterfaceOrientationPortrait=0;
cc.inputManager={TOUCH_TIMEOUT:5E3,_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.p(0,0),_prevMousePoint:cc.p(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:5,_accelEnabled:!1,_accelInterval:1/30,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_getUnUsedIndex:function(){for(var a=this._indexBitsUsed,b=cc.sys.now(),c=0;c<this._maxTouches;c++){if(a&1){var d=this._touches[c];if(b-d._lastModified>this.TOUCH_TIMEOUT)return this._removeUsedIndexBit(c),
delete this._touchesIntegerDict[d.getID()],c}else return this._indexBitsUsed|=1<<c,c;a>>=1}return-1},_removeUsedIndexBit:function(a){0>a||a>=this._maxTouches||(a=~(1<<a),this._indexBitsUsed&=a)},_glView:null,handleTouchesBegin:function(a){for(var b,c,d,e=[],f=this._touchesIntegerDict,g=cc.sys.now(),h=0,k=a.length;h<k;h++)if(b=a[h],d=b.getID(),c=f[d],null==c){var m=this._getUnUsedIndex();-1===m?cc.log(cc._LogInfos.inputManager_handleTouchesBegin,m):(c=this._touches[m]=new cc.Touch(b._point.x,b._point.y,
b.getID()),c._lastModified=g,c._setPrevPoint(b._prevPoint),f[d]=m,e.push(c))}0<e.length&&(this._glView._convertTouchesWithScale(e),a=new cc.EventTouch(e),a._eventCode=cc.EventTouch.EventCode.BEGAN,cc.eventManager.dispatchEvent(a))},handleTouchesMove:function(a){for(var b,c,d=[],e=this._touches,f=cc.sys.now(),g=0,h=a.length;g<h;g++)b=a[g],c=b.getID(),c=this._touchesIntegerDict[c],null!=c&&e[c]&&(e[c]._setPoint(b._point),e[c]._setPrevPoint(b._prevPoint),e[c]._lastModified=f,d.push(e[c]));0<d.length&&
(this._glView._convertTouchesWithScale(d),a=new cc.EventTouch(d),a._eventCode=cc.EventTouch.EventCode.MOVED,cc.eventManager.dispatchEvent(a))},handleTouchesEnd:function(a){a=this.getSetOfTouchesEndOrCancel(a);0<a.length&&(this._glView._convertTouchesWithScale(a),a=new cc.EventTouch(a),a._eventCode=cc.EventTouch.EventCode.ENDED,cc.eventManager.dispatchEvent(a))},handleTouchesCancel:function(a){a=this.getSetOfTouchesEndOrCancel(a);0<a.length&&(this._glView._convertTouchesWithScale(a),a=new cc.EventTouch(a),
a._eventCode=cc.EventTouch.EventCode.CANCELLED,cc.eventManager.dispatchEvent(a))},getSetOfTouchesEndOrCancel:function(a){for(var b,c,d,e=[],f=this._touches,g=this._touchesIntegerDict,h=0,k=a.length;h<k;h++)b=a[h],d=b.getID(),c=g[d],null!=c&&f[c]&&(f[c]._setPoint(b._point),f[c]._setPrevPoint(b._prevPoint),e.push(f[c]),this._removeUsedIndexBit(c),delete g[d]);return e},getHTMLElementPosition:function(a){if(window.wx)return{left:0,top:0,width:parseInt(canvas.style.width),height:parseInt(canvas.style.height)};
var b=document.documentElement,c=window,d=null,d=cc.isFunction(a.getBoundingClientRect)?a.getBoundingClientRect():{left:0,top:0,width:parseInt(a.style.width),height:parseInt(a.style.height)};return{left:d.left+c.pageXOffset-b.clientLeft,top:d.top+c.pageYOffset-b.clientTop,width:d.width,height:d.height}},getPreTouch:function(a){for(var b=null,c=this._preTouchPool,d=a.getID(),e=c.length-1;0<=e;e--)if(c[e].getID()===d){b=c[e];break}b||(b=a);return b},setPreTouch:function(a){for(var b=!1,c=this._preTouchPool,
d=a.getID(),e=c.length-1;0<=e;e--)if(c[e].getID()===d){c[e]=a;b=!0;break}b||(50>=c.length?c.push(a):(c[this._preTouchPoolPointer]=a,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(a,b,c){var d=this._preTouchPoint;a=this._glView.convertToLocationInView(a,b,c);b=new cc.Touch(a.x,a.y);b._setPrevPoint(d.x,d.y);d.x=a.x;d.y=a.y;return b},getMouseEvent:function(a,b,c){var d=this._prevMousePoint;this._glView._convertMouseToLocationInView(a,b);b=new cc.EventMouse(c);b.setLocation(a.x,
a.y);b._setPrevCursor(d.x,d.y);d.x=a.x;d.y=a.y;return b},getPointByEvent:function(a,b){if(null!=a.pageX)return{x:a.pageX,y:a.pageY};b.left-=document.body.scrollLeft;b.top-=document.body.scrollTop;return{x:a.clientX,y:a.clientY}},getTouchesByEvent:function(a,b){for(var c=[],d=this._glView,e,f,g=this._preTouchPoint,h=a.changedTouches.length,k=0;k<h;k++)if(e=a.changedTouches[k]){var m;m=cc.sys.BROWSER_TYPE_FIREFOX===cc.sys.browserType?d.convertToLocationInView(e.pageX,e.pageY,b):d.convertToLocationInView(e.clientX,
e.clientY,b);null!=e.identifier?(e=new cc.Touch(m.x,m.y,e.identifier),f=this.getPreTouch(e).getLocation(),e._setPrevPoint(f.x,f.y),this.setPreTouch(e)):(e=new cc.Touch(m.x,m.y),e._setPrevPoint(g.x,g.y));g.x=m.x;g.y=m.y;c.push(e)}return c},registerSystemEvent:function(a){if(!this._isRegisterEvent){this._glView=cc.view;var b=this,c="mouse"in cc.sys.capabilities,d="touches"in cc.sys.capabilities;window.wx&&(c=!1,d=!0);var e=!1;cc.sys.isMobile&&(e=!0);c&&(window.addEventListener("mousedown",function(){b._mousePressed=
!0},!1),window.addEventListener("mouseup",function(c){if(!e){var d=b._mousePressed;b._mousePressed=!1;if(d){var d=b.getHTMLElementPosition(a),f=b.getPointByEvent(c,d);cc.rectContainsPoint(new cc.Rect(d.left,d.top,d.width,d.height),f)||(b.handleTouchesEnd([b.getTouchByXY(f.x,f.y,d)]),d=b.getMouseEvent(f,d,cc.EventMouse.UP),d.setButton(c.button),cc.eventManager.dispatchEvent(d))}}},!1),a.addEventListener("mousedown",function(c){if(!e){b._mousePressed=!0;var d=b.getHTMLElementPosition(a),f=b.getPointByEvent(c,
d);b.handleTouchesBegin([b.getTouchByXY(f.x,f.y,d)]);d=b.getMouseEvent(f,d,cc.EventMouse.DOWN);d.setButton(c.button);cc.eventManager.dispatchEvent(d);c.stopPropagation();c.preventDefault();a.focus()}},!1),a.addEventListener("mouseup",function(c){if(!e){b._mousePressed=!1;var d=b.getHTMLElementPosition(a),f=b.getPointByEvent(c,d);b.handleTouchesEnd([b.getTouchByXY(f.x,f.y,d)]);d=b.getMouseEvent(f,d,cc.EventMouse.UP);d.setButton(c.button);cc.eventManager.dispatchEvent(d);c.stopPropagation();c.preventDefault()}},
!1),a.addEventListener("mousemove",function(c){if(!e){var d=b.getHTMLElementPosition(a),f=b.getPointByEvent(c,d);b.handleTouchesMove([b.getTouchByXY(f.x,f.y,d)]);d=b.getMouseEvent(f,d,cc.EventMouse.MOVE);b._mousePressed?d.setButton(c.button):d.setButton(null);cc.eventManager.dispatchEvent(d);c.stopPropagation();c.preventDefault()}},!1),a.addEventListener("mousewheel",function(c){var d=b.getHTMLElementPosition(a),e=b.getPointByEvent(c,d),d=b.getMouseEvent(e,d,cc.EventMouse.SCROLL);d.setButton(c.button);
d.setScrollData(0,c.wheelDelta);cc.eventManager.dispatchEvent(d);c.stopPropagation();c.preventDefault()},!1),a.addEventListener("DOMMouseScroll",function(c){var d=b.getHTMLElementPosition(a),e=b.getPointByEvent(c,d),d=b.getMouseEvent(e,d,cc.EventMouse.SCROLL);d.setButton(c.button);d.setScrollData(0,-120*c.detail);cc.eventManager.dispatchEvent(d);c.stopPropagation();c.preventDefault()},!1));if(window.navigator.msPointerEnabled){var c={MSPointerDown:b.handleTouchesBegin,MSPointerMove:b.handleTouchesMove,
MSPointerUp:b.handleTouchesEnd,MSPointerCancel:b.handleTouchesCancel},f;for(f in c)(function(c,d){a.addEventListener(c,function(c){var e=b.getHTMLElementPosition(a);e.left-=document.documentElement.scrollLeft;e.top-=document.documentElement.scrollTop;d.call(b,[b.getTouchByXY(c.clientX,c.clientY,e)]);c.stopPropagation()},!1)})(f,c[f])}d&&(a.addEventListener("touchstart",function(c){if(c.changedTouches){var d=b.getHTMLElementPosition(a);window.wx||(d.left-=document.body.scrollLeft,d.top-=document.body.scrollTop);
b.handleTouchesBegin(b.getTouchesByEvent(c,d));c.stopPropagation();c.preventDefault();!window.wx&&a.focus()}},!1),a.addEventListener("touchmove",function(c){if(c.changedTouches){var d=b.getHTMLElementPosition(a);window.wx||(d.left-=document.body.scrollLeft,d.top-=document.body.scrollTop);b.handleTouchesMove(b.getTouchesByEvent(c,d));c.stopPropagation();c.preventDefault()}},!1),a.addEventListener("touchend",function(c){if(c.changedTouches){var d=b.getHTMLElementPosition(a);window.wx||(d.left-=document.body.scrollLeft,
d.top-=document.body.scrollTop);b.handleTouchesEnd(b.getTouchesByEvent(c,d));c.stopPropagation();c.preventDefault()}},!1),a.addEventListener("touchcancel",function(c){if(c.changedTouches){var d=b.getHTMLElementPosition(a);window.wx||(d.left-=document.body.scrollLeft,d.top-=document.body.scrollTop);b.handleTouchesCancel(b.getTouchesByEvent(c,d));c.stopPropagation();c.preventDefault()}},!1));this._registerKeyboardEvent();this._registerAccelerometerEvent();this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},
_registerAccelerometerEvent:function(){},update:function(a){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,cc.eventManager.dispatchEvent(new cc.EventAcceleration(this._acceleration)));this._accelCurTime+=a}};(function(){var a=cc.inputManager;a.setAccelerometerEnabled=function(a){this._accelEnabled!==a&&(this._accelEnabled=a,a=cc.director.getScheduler(),this._accelCurTime=0,a.scheduleUpdate(this))};a.setAccelerometerInterval=function(a){this._accelInterval!==a&&(this._accelInterval=a)};a._registerKeyboardEvent=function(){cc._canvas.addEventListener("keydown",function(a){cc.eventManager.dispatchEvent(new cc.EventKeyboard(a.keyCode,!0));a.stopPropagation();a.preventDefault()},!1);cc._canvas.addEventListener("keyup",
function(a){cc.eventManager.dispatchEvent(new cc.EventKeyboard(a.keyCode,!1));a.stopPropagation();a.preventDefault()},!1)};a._registerAccelerometerEvent=function(){var a=window;this._acceleration=new cc.Acceleration;this._accelDeviceEvent=a.DeviceMotionEvent||a.DeviceOrientationEvent;cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ&&(this._accelDeviceEvent=window.DeviceOrientationEvent);var c=this._accelDeviceEvent===a.DeviceMotionEvent?"devicemotion":"deviceorientation",d=navigator.userAgent;if(/Android/.test(d)||
/Adr/.test(d)&&cc.sys.browserType===cc.BROWSER_TYPE_UC)this._minus=-1;a.addEventListener(c,this.didAccelerate.bind(this),!1)};a.didAccelerate=function(a){var c=window;if(this._accelEnabled){var d=this._acceleration,e,f,g;this._accelDeviceEvent===window.DeviceMotionEvent?(g=a.accelerationIncludingGravity,e=this._accelMinus*g.x*0.1,f=this._accelMinus*g.y*0.1,g=0.1*g.z):(e=a.gamma/90*0.981,f=0.981*-(a.beta/90),g=a.alpha/90*0.981);d.x=e;d.y=f;d.z=g;d.timestamp=a.timeStamp||Date.now();a=d.x;c.orientation===
cc.UIInterfaceOrientationLandscapeRight?(d.x=-d.y,d.y=a):c.orientation===cc.UIInterfaceOrientationLandscapeLeft?(d.x=d.y,d.y=-a):c.orientation===cc.UIInterfaceOrientationPortraitUpsideDown&&(d.x=-d.x,d.y=-d.y)}}})();cc.AffineTransform=function(a,b,c,d,e,f){this.a=a;this.b=b;this.c=c;this.d=d;this.tx=e;this.ty=f};cc.affineTransformMake=function(a,b,c,d,e,f){return{a:a,b:b,c:c,d:d,tx:e,ty:f}};cc.pointApplyAffineTransform=function(a,b,c){var d;void 0===c?(c=b,d=a.x,a=a.y):(d=a,a=b);return{x:c.a*d+c.c*a+c.tx,y:c.b*d+c.d*a+c.ty}};cc._pointApplyAffineTransform=function(a,b,c){return cc.pointApplyAffineTransform(a,b,c)};
cc.sizeApplyAffineTransform=function(a,b){return{width:b.a*a.width+b.c*a.height,height:b.b*a.width+b.d*a.height}};cc.affineTransformMakeIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}};cc.affineTransformIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}};
cc.rectApplyAffineTransform=function(a,b){var c=cc.rectGetMinY(a),d=cc.rectGetMinX(a),e=cc.rectGetMaxX(a),f=cc.rectGetMaxY(a),g=cc.pointApplyAffineTransform(d,c,b),c=cc.pointApplyAffineTransform(e,c,b),d=cc.pointApplyAffineTransform(d,f,b),h=cc.pointApplyAffineTransform(e,f,b),e=Math.min(g.x,c.x,d.x,h.x),f=Math.max(g.x,c.x,d.x,h.x),k=Math.min(g.y,c.y,d.y,h.y),g=Math.max(g.y,c.y,d.y,h.y);return cc.rect(e,k,f-e,g-k)};
cc._rectApplyAffineTransformIn=function(a,b){var c=cc.rectGetMinY(a),d=cc.rectGetMinX(a),e=cc.rectGetMaxX(a),f=cc.rectGetMaxY(a),g=cc.pointApplyAffineTransform(d,c,b),c=cc.pointApplyAffineTransform(e,c,b),d=cc.pointApplyAffineTransform(d,f,b),h=cc.pointApplyAffineTransform(e,f,b),e=Math.min(g.x,c.x,d.x,h.x),f=Math.max(g.x,c.x,d.x,h.x),k=Math.min(g.y,c.y,d.y,h.y),g=Math.max(g.y,c.y,d.y,h.y);a.x=e;a.y=k;a.width=f-e;a.height=g-k;return a};
cc.affineTransformTranslate=function(a,b,c){return{a:a.a,b:a.b,c:a.c,d:a.d,tx:a.tx+a.a*b+a.c*c,ty:a.ty+a.b*b+a.d*c}};cc.affineTransformScale=function(a,b,c){return{a:a.a*b,b:a.b*b,c:a.c*c,d:a.d*c,tx:a.tx,ty:a.ty}};cc.affineTransformRotate=function(a,b){var c=Math.sin(b),d=Math.cos(b);return{a:a.a*d+a.c*c,b:a.b*d+a.d*c,c:a.c*d-a.a*c,d:a.d*d-a.b*c,tx:a.tx,ty:a.ty}};
cc.affineTransformConcat=function(a,b){return{a:a.a*b.a+a.b*b.c,b:a.a*b.b+a.b*b.d,c:a.c*b.a+a.d*b.c,d:a.c*b.b+a.d*b.d,tx:a.tx*b.a+a.ty*b.c+b.tx,ty:a.tx*b.b+a.ty*b.d+b.ty}};cc.affineTransformConcatIn=function(a,b){var c=a.a,d=a.b,e=a.c,f=a.d,g=a.tx,h=a.ty;a.a=c*b.a+d*b.c;a.b=c*b.b+d*b.d;a.c=e*b.a+f*b.c;a.d=e*b.b+f*b.d;a.tx=g*b.a+h*b.c+b.tx;a.ty=g*b.b+h*b.d+b.ty;return a};cc.affineTransformEqualToTransform=function(a,b){return a.a===b.a&&a.b===b.b&&a.c===b.c&&a.d===b.d&&a.tx===b.tx&&a.ty===b.ty};
cc.affineTransformInvert=function(a){var b=1/(a.a*a.d-a.b*a.c);return{a:b*a.d,b:-b*a.b,c:-b*a.c,d:b*a.a,tx:b*(a.c*a.ty-a.d*a.tx),ty:b*(a.b*a.tx-a.a*a.ty)}};cc.affineTransformInvertOut=function(a,b){var c=a.a,d=a.b,e=a.c,f=a.d,g=1/(c*f-d*e);b.a=g*f;b.b=-g*d;b.c=-g*e;b.d=g*c;b.tx=g*(e*a.ty-f*a.tx);b.ty=g*(d*a.tx-c*a.ty)};cc.POINT_EPSILON=parseFloat("1.192092896e-07F");cc.pNeg=function(a){return cc.p(-a.x,-a.y)};cc.pAdd=function(a,b){return cc.p(a.x+b.x,a.y+b.y)};cc.pSub=function(a,b){return cc.p(a.x-b.x,a.y-b.y)};cc.pMult=function(a,b){return cc.p(a.x*b,a.y*b)};cc.pMidpoint=function(a,b){return cc.pMult(cc.pAdd(a,b),0.5)};cc.pDot=function(a,b){return a.x*b.x+a.y*b.y};cc.pCross=function(a,b){return a.x*b.y-a.y*b.x};cc.pPerp=function(a){return cc.p(-a.y,a.x)};cc.pRPerp=function(a){return cc.p(a.y,-a.x)};
cc.pProject=function(a,b){return cc.pMult(b,cc.pDot(a,b)/cc.pDot(b,b))};cc.pRotate=function(a,b){return cc.p(a.x*b.x-a.y*b.y,a.x*b.y+a.y*b.x)};cc.pUnrotate=function(a,b){return cc.p(a.x*b.x+a.y*b.y,a.y*b.x-a.x*b.y)};cc.pLengthSQ=function(a){return cc.pDot(a,a)};cc.pDistanceSQ=function(a,b){return cc.pLengthSQ(cc.pSub(a,b))};cc.pLength=function(a){return Math.sqrt(cc.pLengthSQ(a))};cc.pDistance=function(a,b){return cc.pLength(cc.pSub(a,b))};
cc.pNormalize=function(a){var b=cc.pLength(a);return 0===b?cc.p(a):cc.pMult(a,1/b)};cc.pForAngle=function(a){return cc.p(Math.cos(a),Math.sin(a))};cc.pToAngle=function(a){return Math.atan2(a.y,a.x)};cc.clampf=function(a,b,c){if(b>c){var d=b;b=c;c=d}return a<b?b:a<c?a:c};cc.pClamp=function(a,b,c){return cc.p(cc.clampf(a.x,b.x,c.x),cc.clampf(a.y,b.y,c.y))};cc.pFromSize=function(a){return cc.p(a.width,a.height)};cc.pCompOp=function(a,b){return cc.p(b(a.x),b(a.y))};
cc.pLerp=function(a,b,c){return cc.pAdd(cc.pMult(a,1-c),cc.pMult(b,c))};cc.pFuzzyEqual=function(a,b,c){return a.x-c<=b.x&&b.x<=a.x+c&&a.y-c<=b.y&&b.y<=a.y+c?!0:!1};cc.pCompMult=function(a,b){return cc.p(a.x*b.x,a.y*b.y)};cc.pAngleSigned=function(a,b){var c=cc.pNormalize(a),d=cc.pNormalize(b),c=Math.atan2(c.x*d.y-c.y*d.x,cc.pDot(c,d));return Math.abs(c)<cc.POINT_EPSILON?0:c};cc.pAngle=function(a,b){var c=Math.acos(cc.pDot(cc.pNormalize(a),cc.pNormalize(b)));return Math.abs(c)<cc.POINT_EPSILON?0:c};
cc.pRotateByAngle=function(a,b,c){a=cc.pSub(a,b);var d=Math.cos(c);c=Math.sin(c);var e=a.x;a.x=e*d-a.y*c+b.x;a.y=e*c+a.y*d+b.y;return a};cc.pLineIntersect=function(a,b,c,d,e){if(a.x===b.x&&a.y===b.y||c.x===d.x&&c.y===d.y)return!1;var f=b.x-a.x;b=b.y-a.y;var g=d.x-c.x;d=d.y-c.y;var h=a.x-c.x;a=a.y-c.y;c=d*f-g*b;e.x=g*a-d*h;e.y=f*a-b*h;if(0===c)return 0===e.x||0===e.y?!0:!1;e.x/=c;e.y/=c;return!0};
cc.pSegmentIntersect=function(a,b,c,d){var e=cc.p(0,0);return cc.pLineIntersect(a,b,c,d,e)&&0<=e.x&&1>=e.x&&0<=e.y&&1>=e.y?!0:!1};cc.pIntersectPoint=function(a,b,c,d){var e=cc.p(0,0);return cc.pLineIntersect(a,b,c,d,e)?(c=cc.p(0,0),c.x=a.x+e.x*(b.x-a.x),c.y=a.y+e.x*(b.y-a.y),c):cc.p(0,0)};cc.pSameAs=function(a,b){return null!=a&&null!=b?a.x===b.x&&a.y===b.y:!1};cc.pZeroIn=function(a){a.x=0;a.y=0};cc.pIn=function(a,b){a.x=b.x;a.y=b.y};cc.pMultIn=function(a,b){a.x*=b;a.y*=b};
cc.pSubIn=function(a,b){a.x-=b.x;a.y-=b.y};cc.pAddIn=function(a,b){a.x+=b.x;a.y+=b.y};cc.pNormalizeIn=function(a){var b=Math.sqrt(a.x*a.x+a.y*a.y);0!==b&&cc.pMultIn(a,1/b)};cc.vertexLineToPolygon=function(a,b,c,d,e){e+=d;if(!(1>=e)){b*=0.5;for(var f,g=e-1,h=d;h<e;h++){f=2*h;var k=cc.p(a[2*h],a[2*h+1]),m;if(0===h)m=cc.pPerp(cc.pNormalize(cc.pSub(k,cc.p(a[2*(h+1)],a[2*(h+1)+1]))));else if(h===g)m=cc.pPerp(cc.pNormalize(cc.pSub(cc.p(a[2*(h-1)],a[2*(h-1)+1]),k)));else{m=cc.p(a[2*(h-1)],a[2*(h-1)+1]);var n=cc.p(a[2*(h+1)],a[2*(h+1)+1]),p=cc.pNormalize(cc.pSub(n,k)),r=cc.pNormalize(cc.pSub(m,k)),s=Math.acos(cc.pDot(p,r));m=s<cc.degreesToRadians(70)?cc.pPerp(cc.pNormalize(cc.pMidpoint(p,
r))):s<cc.degreesToRadians(170)?cc.pNormalize(cc.pMidpoint(p,r)):cc.pPerp(cc.pNormalize(cc.pSub(n,m)))}m=cc.pMult(m,b);c[2*f]=k.x+m.x;c[2*f+1]=k.y+m.y;c[2*(f+1)]=k.x-m.x;c[2*(f+1)+1]=k.y-m.y}for(h=0===d?0:d-1;h<g;h++)f=2*h,a=f+2,b=cc.vertex2(c[2*f],c[2*f+1]),e=cc.vertex2(c[2*(f+1)],c[2*(f+1)+1]),f=cc.vertex2(c[2*a],c[2*a]),d=cc.vertex2(c[2*(a+1)],c[2*(a+1)+1]),b=!cc.vertexLineIntersect(b.x,b.y,d.x,d.y,e.x,e.y,f.x,f.y),!b.isSuccess&&(0>b.value||1<b.value)&&(b.isSuccess=!0),b.isSuccess&&(c[2*a]=d.x,
c[2*a+1]=d.y,c[2*(a+1)]=f.x,c[2*(a+1)+1]=f.y)}};cc.vertexLineIntersect=function(a,b,c,d,e,f,g,h){if(a===c&&b===d||e===g&&f===h)return{isSuccess:!1,value:0};c-=a;d-=b;e-=a;f-=b;g-=a;h-=b;a=Math.sqrt(c*c+d*d);c/=a;d/=a;b=e*c+f*d;f=f*c-e*d;e=b;b=g*c+h*d;h=h*c-g*d;g=b;return f===h?{isSuccess:!1,value:0}:{isSuccess:!0,value:(g+(e-g)*h/(h-f))/a}};cc.vertexListIsClockwise=function(a){for(var b=0,c=a.length;b<c;b++){var d=a[(b+1)%c],e=a[(b+2)%c];if(0<cc.pCross(cc.pSub(d,a[b]),cc.pSub(e,d)))return!1}return!0};cc.CGAffineToGL=function(a,b){b[2]=b[3]=b[6]=b[7]=b[8]=b[9]=b[11]=b[14]=0;b[10]=b[15]=1;b[0]=a.a;b[4]=a.c;b[12]=a.tx;b[1]=a.b;b[5]=a.d;b[13]=a.ty};cc.GLToCGAffine=function(a,b){b.a=a[0];b.c=a[4];b.tx=a[12];b.b=a[1];b.d=a[5];b.ty=a[13]};cc.Touch=cc.Class.extend({_lastModified:0,_point:null,_prevPoint:null,_id:0,_startPointCaptured:!1,_startPoint:null,ctor:function(a,b,c){this.setTouchInfo(c,a,b)},getLocation:function(){return{x:this._point.x,y:this._point.y}},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocation:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getDelta:function(){return cc.pSub(this._point,
this._prevPoint)},getLocationInView:function(){return{x:this._point.x,y:this._point.y}},getPreviousLocationInView:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocationInView:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getID:function(){return this._id},getId:function(){cc.log("getId is deprecated. Please use getID instead.");return this._id},setTouchInfo:function(a,b,c){this._prevPoint=this._point;this._point=cc.p(b||0,c||0);this._id=a;this._startPointCaptured||
(this._startPoint=cc.p(this._point),cc.view._convertPointWithScale(this._startPoint),this._startPointCaptured=!0)},_setPoint:function(a,b){void 0===b?(this._point.x=a.x,this._point.y=a.y):(this._point.x=a,this._point.y=b)},_setPrevPoint:function(a,b){this._prevPoint=void 0===b?cc.p(a.x,a.y):cc.p(a||0,b||0)}});cc.Event=cc.Class.extend({_type:0,_isStopped:!1,_currentTarget:null,_setCurrentTarget:function(a){this._currentTarget=a},ctor:function(a){this._type=a},getType:function(){return this._type},stopPropagation:function(){this._isStopped=!0},isStopped:function(){return this._isStopped},getCurrentTarget:function(){return this._currentTarget}});cc.Event.TOUCH=0;cc.Event.KEYBOARD=1;cc.Event.ACCELERATION=2;cc.Event.MOUSE=3;cc.Event.FOCUS=4;cc.Event.CUSTOM=6;
cc.EventCustom=cc.Event.extend({_eventName:null,_userData:null,ctor:function(a){cc.Event.prototype.ctor.call(this,cc.Event.CUSTOM);this._eventName=a},setUserData:function(a){this._userData=a},getUserData:function(){return this._userData},getEventName:function(){return this._eventName}});
cc.EventMouse=cc.Event.extend({_eventType:0,_button:0,_x:0,_y:0,_prevX:0,_prevY:0,_scrollX:0,_scrollY:0,ctor:function(a){cc.Event.prototype.ctor.call(this,cc.Event.MOUSE);this._eventType=a},setScrollData:function(a,b){this._scrollX=a;this._scrollY=b},getScrollX:function(){return this._scrollX},getScrollY:function(){return this._scrollY},setLocation:function(a,b){this._x=a;this._y=b},getLocation:function(){return{x:this._x,y:this._y}},getLocationInView:function(){return{x:this._x,y:cc.view._designResolutionSize.height-
this._y}},_setPrevCursor:function(a,b){this._prevX=a;this._prevY=b},getDelta:function(){return{x:this._x-this._prevX,y:this._y-this._prevY}},getDeltaX:function(){return this._x-this._prevX},getDeltaY:function(){return this._y-this._prevY},setButton:function(a){this._button=a},getButton:function(){return this._button},getLocationX:function(){return this._x},getLocationY:function(){return this._y}});cc.EventMouse.NONE=0;cc.EventMouse.DOWN=1;cc.EventMouse.UP=2;cc.EventMouse.MOVE=3;
cc.EventMouse.SCROLL=4;cc.EventMouse.BUTTON_LEFT=0;cc.EventMouse.BUTTON_RIGHT=2;cc.EventMouse.BUTTON_MIDDLE=1;cc.EventMouse.BUTTON_4=3;cc.EventMouse.BUTTON_5=4;cc.EventMouse.BUTTON_6=5;cc.EventMouse.BUTTON_7=6;cc.EventMouse.BUTTON_8=7;
cc.EventTouch=cc.Event.extend({_eventCode:0,_touches:null,ctor:function(a){cc.Event.prototype.ctor.call(this,cc.Event.TOUCH);this._touches=a||[]},getEventCode:function(){return this._eventCode},getTouches:function(){return this._touches},_setEventCode:function(a){this._eventCode=a},_setTouches:function(a){this._touches=a}});cc.EventTouch.MAX_TOUCHES=5;cc.EventTouch.EventCode={BEGAN:0,MOVED:1,ENDED:2,CANCELLED:3};
cc.EventFocus=cc.Event.extend({_widgetGetFocus:null,_widgetLoseFocus:null,ctor:function(a,b){cc.Event.prototype.ctor.call(this,cc.Event.FOCUS);this._widgetGetFocus=b;this._widgetLoseFocus=a}});cc.EventListener=cc.Class.extend({_onEvent:null,_type:0,_listenerID:null,_registered:!1,_fixedPriority:0,_node:null,_paused:!0,_isEnabled:!0,ctor:function(a,b,c){this._onEvent=c;this._type=a||0;this._listenerID=b||""},_setPaused:function(a){this._paused=a},_isPaused:function(){return this._paused},_setRegistered:function(a){this._registered=a},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(a){this._fixedPriority=
a},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(a){this._node=a},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!==this._onEvent},clone:function(){return null},setEnabled:function(a){this._isEnabled=a},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}});cc.EventListener.UNKNOWN=0;cc.EventListener.TOUCH_ONE_BY_ONE=1;cc.EventListener.TOUCH_ALL_AT_ONCE=2;
cc.EventListener.KEYBOARD=3;cc.EventListener.MOUSE=4;cc.EventListener.ACCELERATION=6;cc.EventListener.FOCUS=7;cc.EventListener.CUSTOM=8;
cc._EventListenerCustom=cc.EventListener.extend({_onCustomEvent:null,ctor:function(a,b,c){this._onCustomEvent=b;this._target=c;cc.EventListener.prototype.ctor.call(this,cc.EventListener.CUSTOM,a,this._callback)},_callback:function(a){null!==this._onCustomEvent&&this._onCustomEvent.call(this._target,a)},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!==this._onCustomEvent},clone:function(){return new cc._EventListenerCustom(this._listenerID,this._onCustomEvent)}});
cc._EventListenerCustom.create=function(a,b){return new cc._EventListenerCustom(a,b)};
cc._EventListenerMouse=cc.EventListener.extend({onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.MOUSE,cc._EventListenerMouse.LISTENER_ID,this._callback)},_callback:function(a){var b=cc.EventMouse;switch(a._eventType){case b.DOWN:if(this.onMouseDown)this.onMouseDown(a);break;case b.UP:if(this.onMouseUp)this.onMouseUp(a);break;case b.MOVE:if(this.onMouseMove)this.onMouseMove(a);break;case b.SCROLL:if(this.onMouseScroll)this.onMouseScroll(a)}},
clone:function(){var a=new cc._EventListenerMouse;a.onMouseDown=this.onMouseDown;a.onMouseUp=this.onMouseUp;a.onMouseMove=this.onMouseMove;a.onMouseScroll=this.onMouseScroll;return a},checkAvailable:function(){return!0}});cc._EventListenerMouse.LISTENER_ID="__cc_mouse";cc._EventListenerMouse.create=function(){return new cc._EventListenerMouse};
cc._EventListenerTouchOneByOne=cc.EventListener.extend({_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,cc._EventListenerTouchOneByOne.LISTENER_ID,null);this._claimedTouches=[]},setSwallowTouches:function(a){this.swallowTouches=a},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var a=new cc._EventListenerTouchOneByOne;
a.onTouchBegan=this.onTouchBegan;a.onTouchMoved=this.onTouchMoved;a.onTouchEnded=this.onTouchEnded;a.onTouchCancelled=this.onTouchCancelled;a.swallowTouches=this.swallowTouches;return a},checkAvailable:function(){return this.onTouchBegan?!0:(cc.log(cc._LogInfos._EventListenerTouchOneByOne_checkAvailable),!1)}});cc._EventListenerTouchOneByOne.LISTENER_ID="__cc_touch_one_by_one";cc._EventListenerTouchOneByOne.create=function(){return new cc._EventListenerTouchOneByOne};
cc._EventListenerTouchAllAtOnce=cc.EventListener.extend({onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,cc._EventListenerTouchAllAtOnce.LISTENER_ID,null)},clone:function(){var a=new cc._EventListenerTouchAllAtOnce;a.onTouchesBegan=this.onTouchesBegan;a.onTouchesMoved=this.onTouchesMoved;a.onTouchesEnded=this.onTouchesEnded;a.onTouchesCancelled=this.onTouchesCancelled;return a},
checkAvailable:function(){return null===this.onTouchesBegan&&null===this.onTouchesMoved&&null===this.onTouchesEnded&&null===this.onTouchesCancelled?(cc.log(cc._LogInfos._EventListenerTouchAllAtOnce_checkAvailable),!1):!0}});cc._EventListenerTouchAllAtOnce.LISTENER_ID="__cc_touch_all_at_once";cc._EventListenerTouchAllAtOnce.create=function(){return new cc._EventListenerTouchAllAtOnce};
cc.EventListener.create=function(a){cc.assert(a&&a.event,cc._LogInfos.EventListener_create);var b=a.event;delete a.event;var c=null;b===cc.EventListener.TOUCH_ONE_BY_ONE?c=new cc._EventListenerTouchOneByOne:b===cc.EventListener.TOUCH_ALL_AT_ONCE?c=new cc._EventListenerTouchAllAtOnce:b===cc.EventListener.MOUSE?c=new cc._EventListenerMouse:b===cc.EventListener.CUSTOM?(c=new cc._EventListenerCustom(a.eventName,a.callback),delete a.eventName,delete a.callback):b===cc.EventListener.KEYBOARD?c=new cc._EventListenerKeyboard:
b===cc.EventListener.ACCELERATION?(c=new cc._EventListenerAcceleration(a.callback),delete a.callback):b===cc.EventListener.FOCUS&&(c=new cc._EventListenerFocus);for(var d in a)c[d]=a[d];return c};
cc._EventListenerFocus=cc.EventListener.extend({clone:function(){var a=new cc._EventListenerFocus;a.onFocusChanged=this.onFocusChanged;return a},checkAvailable:function(){return this.onFocusChanged?!0:(cc.log("Invalid EventListenerFocus!"),!1)},onFocusChanged:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.FOCUS,cc._EventListenerFocus.LISTENER_ID,this._callback)},_callback:function(a){if(this.onFocusChanged)this.onFocusChanged(a._widgetLoseFocus,a._widgetGetFocus)}});
cc._EventListenerFocus.LISTENER_ID="__cc_focus_event";(function(){function a(a){var c=cc.Event,d=a._type;if(d===c.ACCELERATION)return cc._EventListenerAcceleration.LISTENER_ID;if(d===c.CUSTOM)return a._eventName;if(d===c.KEYBOARD)return cc._EventListenerKeyboard.LISTENER_ID;if(d===c.MOUSE)return cc._EventListenerMouse.LISTENER_ID;if(d===c.FOCUS)return cc._EventListenerFocus.LISTENER_ID;d===c.TOUCH&&cc.log(cc._LogInfos.__getListenerID);return""}cc._EventListenerVector=cc.Class.extend({_fixedListeners:null,_sceneGraphListeners:null,gt0Index:0,ctor:function(){this._fixedListeners=
[];this._sceneGraphListeners=[]},size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(a){0===a._getFixedPriority()?this._sceneGraphListeners.push(a):this._fixedListeners.push(a)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=
0;this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}});cc.eventManager={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_nodePriorityMap:{},_globalZOrderNodeMap:{},_toAddedListeners:[],_toRemovedListeners:[],_dirtyNodes:[],_inDispatch:0,_isEnabled:!1,_nodePriorityIndex:0,_internalCustomListenerIDs:[cc.game.EVENT_HIDE,
cc.game.EVENT_SHOW],_setDirtyForNode:function(a){null!=this._nodeListenersMap[a.__instanceId]&&this._dirtyNodes.push(a);a=a.getChildren();for(var c=0,d=a.length;c<d;c++)this._setDirtyForNode(a[c])},pauseTarget:function(a,c){var d=this._nodeListenersMap[a.__instanceId],e,f;if(d)for(e=0,f=d.length;e<f;e++)d[e]._setPaused(!0);if(!0===c)for(d=a.getChildren(),e=0,f=d.length;e<f;e++)this.pauseTarget(d[e],!0)},resumeTarget:function(a,c){var d=this._nodeListenersMap[a.__instanceId],e,f;if(d)for(e=0,f=d.length;e<
f;e++)d[e]._setPaused(!1);this._setDirtyForNode(a);if(!0===c)for(d=a.getChildren(),e=0,f=d.length;e<f;e++)this.resumeTarget(d[e],!0)},_addListener:function(a){0===this._inDispatch?this._forceAddEventListener(a):this._toAddedListeners.push(a)},_forceAddEventListener:function(a){var c=a._getListenerID(),d=this._listenersMap[c];d||(d=new cc._EventListenerVector,this._listenersMap[c]=d);d.push(a);0===a._getFixedPriority()?(this._setDirty(c,this.DIRTY_SCENE_GRAPH_PRIORITY),c=a._getSceneGraphPriority(),
null===c&&cc.log(cc._LogInfos.eventManager__forceAddEventListener),this._associateNodeAndEventListener(c,a),c.isRunning()&&this.resumeTarget(c)):this._setDirty(c,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(a){return this._listenersMap[a]},_updateDirtyFlagForSceneGraph:function(){if(0!==this._dirtyNodes.length){for(var a=this._dirtyNodes,c,d,e=this._nodeListenersMap,f=0,g=a.length;f<g;f++)if(c=e[a[f].__instanceId])for(var h=0,k=c.length;h<k;h++)(d=c[h])&&this._setDirty(d._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY);
this._dirtyNodes.length=0}},_removeAllListenersInVector:function(a){if(a)for(var c,d=0;d<a.length;)c=a[d],c._setRegistered(!1),null!=c._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(c._getSceneGraphPriority(),c),c._setSceneGraphPriority(null)),0===this._inDispatch?cc.arrayRemoveObject(a,c):++d},_removeListenersForListenerID:function(a){var c=this._listenersMap[a];if(c){var d=c.getFixedPriorityListeners(),e=c.getSceneGraphPriorityListeners();this._removeAllListenersInVector(e);this._removeAllListenersInVector(d);
delete this._priorityDirtyFlagMap[a];this._inDispatch||c.clear();delete this._listenersMap[a]}d=this._toAddedListeners;for(c=0;c<d.length;)(e=d[c])&&e._getListenerID()===a?cc.arrayRemoveObject(d,e):++c},_sortEventListeners:function(a){var c=this.DIRTY_NONE,d=this._priorityDirtyFlagMap;d[a]&&(c=d[a]);c!==this.DIRTY_NONE&&(d[a]=this.DIRTY_NONE,c&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(a),c&this.DIRTY_SCENE_GRAPH_PRIORITY&&((c=cc.director.getRunningScene())?this._sortListenersOfSceneGraphPriority(a,
c):d[a]=this.DIRTY_SCENE_GRAPH_PRIORITY))},_sortListenersOfSceneGraphPriority:function(a,c){var d=this._getListeners(a);if(d){var e=d.getSceneGraphPriorityListeners();e&&0!==e.length&&(this._nodePriorityIndex=0,this._nodePriorityMap={},this._visitTarget(c,!0),d.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes))}},_sortEventListenersOfSceneGraphPriorityDes:function(a,c){var d=cc.eventManager._nodePriorityMap,e=a._getSceneGraphPriority(),f=c._getSceneGraphPriority();
return c&&f&&d[f.__instanceId]?a&&e&&d[e.__instanceId]?d[c._getSceneGraphPriority().__instanceId]-d[a._getSceneGraphPriority().__instanceId]:1:-1},_sortListenersOfFixedPriority:function(a){if(a=this._listenersMap[a]){var c=a.getFixedPriorityListeners();if(c&&0!==c.length){c.sort(this._sortListenersOfFixedPriorityAsc);for(var d=0,e=c.length;d<e&&!(0<=c[d]._getFixedPriority());)++d;a.gt0Index=d}}},_sortListenersOfFixedPriorityAsc:function(a,c){return a._getFixedPriority()-c._getFixedPriority()},_onUpdateListeners:function(a){var c=
a.getFixedPriorityListeners(),d=a.getSceneGraphPriorityListeners(),e,f,g=this._toRemovedListeners;if(d)for(e=0;e<d.length;)f=d[e],f._isRegistered()?++e:(cc.arrayRemoveObject(d,f),f=g.indexOf(f),-1!==f&&g.splice(f,1));if(c)for(e=0;e<c.length;)f=c[e],f._isRegistered()?++e:(cc.arrayRemoveObject(c,f),f=g.indexOf(f),-1!==f&&g.splice(f,1));d&&0===d.length&&a.clearSceneGraphListeners();c&&0===c.length&&a.clearFixedListeners()},frameUpdateListeners:function(){var a=this._listenersMap,c=this._priorityDirtyFlagMap,
d;for(d in a)a[d].empty()&&(delete c[d],delete a[d]);a=this._toAddedListeners;if(0!==a.length){c=0;for(d=a.length;c<d;c++)this._forceAddEventListener(a[c]);a.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()},_updateTouchListeners:function(a){a=this._inDispatch;cc.assert(0<a,cc._LogInfos.EventManager__updateListeners);if(!(1<a)){var c;(c=this._listenersMap[cc._EventListenerTouchOneByOne.LISTENER_ID])&&this._onUpdateListeners(c);(c=this._listenersMap[cc._EventListenerTouchAllAtOnce.LISTENER_ID])&&
this._onUpdateListeners(c);cc.assert(1===a,cc._LogInfos.EventManager__updateListeners_2);a=this._toAddedListeners;if(0!==a.length){c=0;for(var d=a.length;c<d;c++)this._forceAddEventListener(a[c]);a.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},_cleanToRemovedListeners:function(){for(var a=this._toRemovedListeners,c=0;c<a.length;c++){var d=a[c],e=this._listenersMap[d._getListenerID()];if(e){var f=e.getFixedPriorityListeners(),g=e.getSceneGraphPriorityListeners();g&&
(e=g.indexOf(d),-1!==e&&g.splice(e,1));f&&(e=f.indexOf(d),-1!==e&&f.splice(e,1))}}a.length=0},_onTouchEventCallback:function(a,c){if(!a._isRegistered)return!1;var d=c.event,e=c.selTouch;d._setCurrentTarget(a._node);var f=!1,g,h=d.getEventCode(),k=cc.EventTouch.EventCode;if(h===k.BEGAN)a.onTouchBegan&&(f=a.onTouchBegan(e,d))&&a._registered&&a._claimedTouches.push(e);else if(0<a._claimedTouches.length&&-1!==(g=a._claimedTouches.indexOf(e)))if(f=!0,h===k.MOVED&&a.onTouchMoved)a.onTouchMoved(e,d);else if(h===
k.ENDED){if(a.onTouchEnded)a.onTouchEnded(e,d);a._registered&&a._claimedTouches.splice(g,1)}else if(h===k.CANCELLED){if(a.onTouchCancelled)a.onTouchCancelled(e,d);a._registered&&a._claimedTouches.splice(g,1)}return d.isStopped()?(cc.eventManager._updateTouchListeners(d),!0):f&&a._registered&&a.swallowTouches?(c.needsMutableSet&&c.touches.splice(e,1),!0):!1},_dispatchTouchEvent:function(a){this._sortEventListeners(cc._EventListenerTouchOneByOne.LISTENER_ID);this._sortEventListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);
var c=this._getListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),d=this._getListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);if(null!==c||null!==d){var e=a.getTouches(),f=cc.copyArray(e),g={event:a,needsMutableSet:c&&d,touches:f,selTouch:null};if(c)for(var h=0;h<e.length;h++)if(g.selTouch=e[h],this._dispatchEventToListeners(c,this._onTouchEventCallback,g),a.isStopped())return;if(d&&0<f.length&&(this._dispatchEventToListeners(d,this._onTouchesEventCallback,{event:a,touches:f}),a.isStopped()))return;
this._updateTouchListeners(a)}},_onTouchesEventCallback:function(a,c){if(!a._registered)return!1;var d=cc.EventTouch.EventCode,e=c.event,f=c.touches,g=e.getEventCode();e._setCurrentTarget(a._node);if(g===d.BEGAN&&a.onTouchesBegan)a.onTouchesBegan(f,e);else if(g===d.MOVED&&a.onTouchesMoved)a.onTouchesMoved(f,e);else if(g===d.ENDED&&a.onTouchesEnded)a.onTouchesEnded(f,e);else if(g===d.CANCELLED&&a.onTouchesCancelled)a.onTouchesCancelled(f,e);return e.isStopped()?(cc.eventManager._updateTouchListeners(e),
!0):!1},_associateNodeAndEventListener:function(a,c){var d=this._nodeListenersMap[a.__instanceId];d||(d=[],this._nodeListenersMap[a.__instanceId]=d);d.push(c)},_dissociateNodeAndEventListener:function(a,c){var d=this._nodeListenersMap[a.__instanceId];d&&(cc.arrayRemoveObject(d,c),0===d.length&&delete this._nodeListenersMap[a.__instanceId])},_dispatchEventToListeners:function(a,c,d){var e=!1,f=a.getFixedPriorityListeners(),g=a.getSceneGraphPriorityListeners(),h=0,k;if(f&&0!==f.length)for(;h<a.gt0Index;++h)if(k=
f[h],k.isEnabled()&&!k._isPaused()&&k._isRegistered()&&c(k,d)){e=!0;break}if(g&&!e)for(a=0;a<g.length;a++)if(k=g[a],k.isEnabled()&&!k._isPaused()&&k._isRegistered()&&c(k,d)){e=!0;break}if(f&&!e)for(;h<f.length&&(k=f[h],!k.isEnabled()||k._isPaused()||!k._isRegistered()||!c(k,d));++h);},_setDirty:function(a,c){var d=this._priorityDirtyFlagMap;d[a]=null==d[a]?c:c|d[a]},_visitTarget:function(a,c){var d=a.getChildren(),e=0,f=d.length,g=this._globalZOrderNodeMap,h=this._nodeListenersMap;if(0<f){for(var k;e<
f;e++)if((k=d[e])&&0>k.getLocalZOrder())this._visitTarget(k,!1);else break;null!=h[a.__instanceId]&&(g[a.getGlobalZOrder()]||(g[a.getGlobalZOrder()]=[]),g[a.getGlobalZOrder()].push(a.__instanceId));for(;e<f;e++)(k=d[e])&&this._visitTarget(k,!1)}else null!=h[a.__instanceId]&&(g[a.getGlobalZOrder()]||(g[a.getGlobalZOrder()]=[]),g[a.getGlobalZOrder()].push(a.__instanceId));if(c){var d=[],m;for(m in g)d.push(m);d.sort(this._sortNumberAsc);m=d.length;k=this._nodePriorityMap;for(e=0;e<m;e++)for(f=g[d[e]],
h=0;h<f.length;h++)k[f[h]]=++this._nodePriorityIndex;this._globalZOrderNodeMap={}}},_sortNumberAsc:function(a,c){return a-c},addListener:function(a,c){cc.assert(a&&c,cc._LogInfos.eventManager_addListener_2);if(!(a instanceof cc.EventListener))cc.assert(!cc.isNumber(c),cc._LogInfos.eventManager_addListener_3),a=cc.EventListener.create(a);else if(a._isRegistered()){cc.log(cc._LogInfos.eventManager_addListener_4);return}if(a.checkAvailable()){if(cc.isNumber(c)){if(0===c){cc.log(cc._LogInfos.eventManager_addListener);
return}a._setSceneGraphPriority(null);a._setFixedPriority(c);a._setRegistered(!0);a._setPaused(!1)}else a._setSceneGraphPriority(c),a._setFixedPriority(0),a._setRegistered(!0);this._addListener(a);return a}},addCustomListener:function(a,c,d){a=new cc._EventListenerCustom(a,c,d);this.addListener(a,1);return a},removeListener:function(a){if(null!=a){var c,d=this._listenersMap,e;for(e in d){var f=d[e],g=f.getFixedPriorityListeners();c=f.getSceneGraphPriorityListeners();(c=this._removeListenerInVector(c,
a))?this._setDirty(a._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(c=this._removeListenerInVector(g,a))&&this._setDirty(a._getListenerID(),this.DIRTY_FIXED_PRIORITY);f.empty()&&(delete this._priorityDirtyFlagMap[a._getListenerID()],delete d[e]);if(c)break}if(!c)for(d=this._toAddedListeners,e=0,f=d.length;e<f;e++)if(g=d[e],g===a){cc.arrayRemoveObject(d,g);g._setRegistered(!1);break}}},_removeListenerInCallback:function(a,c){if(null==a)return!1;for(var d=0,e=a.length;d<e;d++){var f=a[d];if(f._onCustomEvent===
c||f._onEvent===c)return f._setRegistered(!1),null!=f._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(f._getSceneGraphPriority(),f),f._setSceneGraphPriority(null)),0===this._inDispatch&&cc.arrayRemoveObject(a,f),!0}return!1},_removeListenerInVector:function(a,c){if(null==a)return!1;for(var d=0,e=a.length;d<e;d++){var f=a[d];if(f===c)return f._setRegistered(!1),null!=f._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(f._getSceneGraphPriority(),f),f._setSceneGraphPriority(null)),
0===this._inDispatch?cc.arrayRemoveObject(a,f):this._toRemovedListeners.push(f),!0}return!1},removeListeners:function(a,c){if(a instanceof cc.Node){delete this._nodePriorityMap[a.__instanceId];cc.arrayRemoveObject(this._dirtyNodes,a);var d=this._nodeListenersMap[a.__instanceId];if(d){for(var e=cc.copyArray(d),d=0;d<e.length;d++)this.removeListener(e[d]);e.length=0}e=this._toAddedListeners;for(d=0;d<e.length;){var f=e[d];f._getSceneGraphPriority()===a?(f._setSceneGraphPriority(null),f._setRegistered(!1),
e.splice(d,1)):++d}if(!0===c)for(e=a.getChildren(),d=0,f=e.length;d<f;d++)this.removeListeners(e[d],!0)}else a===cc.EventListener.TOUCH_ONE_BY_ONE?this._removeListenersForListenerID(cc._EventListenerTouchOneByOne.LISTENER_ID):a===cc.EventListener.TOUCH_ALL_AT_ONCE?this._removeListenersForListenerID(cc._EventListenerTouchAllAtOnce.LISTENER_ID):a===cc.EventListener.MOUSE?this._removeListenersForListenerID(cc._EventListenerMouse.LISTENER_ID):a===cc.EventListener.ACCELERATION?this._removeListenersForListenerID(cc._EventListenerAcceleration.LISTENER_ID):
a===cc.EventListener.KEYBOARD?this._removeListenersForListenerID(cc._EventListenerKeyboard.LISTENER_ID):cc.log(cc._LogInfos.eventManager_removeListeners)},removeCustomListeners:function(a){this._removeListenersForListenerID(a)},removeAllListeners:function(){var a=this._listenersMap,c=this._internalCustomListenerIDs,d;for(d in a)-1===c.indexOf(d)&&this._removeListenersForListenerID(d)},setPriority:function(a,c){if(null!=a){var d=this._listenersMap,e;for(e in d){var f=d[e].getFixedPriorityListeners();
if(f&&-1!==f.indexOf(a)){null!=a._getSceneGraphPriority()&&cc.log(cc._LogInfos.eventManager_setPriority);a._getFixedPriority()!==c&&(a._setFixedPriority(c),this._setDirty(a._getListenerID(),this.DIRTY_FIXED_PRIORITY));break}}}},setEnabled:function(a){this._isEnabled=a},isEnabled:function(){return this._isEnabled},dispatchEvent:function(b){if(this._isEnabled){this._updateDirtyFlagForSceneGraph();this._inDispatch++;if(!b||!b.getType)throw Error("event is undefined");if(b._type===cc.Event.TOUCH)this._dispatchTouchEvent(b);
else{var c=a(b);this._sortEventListeners(c);if(c=this._listenersMap[c])this._dispatchEventToListeners(c,this._onListenerCallback,b),this._onUpdateListeners(c)}this._inDispatch--}},_onListenerCallback:function(a,c){c._setCurrentTarget(a._getSceneGraphPriority());a._onEvent(c);return c.isStopped()},dispatchCustomEvent:function(a,c){var d=new cc.EventCustom(a);d.setUserData(c);this.dispatchEvent(d)}}})();cc.EventAcceleration=cc.Event.extend({_acc:null,ctor:function(a){cc.Event.prototype.ctor.call(this,cc.Event.ACCELERATION);this._acc=a}});cc.EventKeyboard=cc.Event.extend({_keyCode:0,_isPressed:!1,ctor:function(a,b){cc.Event.prototype.ctor.call(this,cc.Event.KEYBOARD);this._keyCode=a;this._isPressed=b}});
cc._EventListenerAcceleration=cc.EventListener.extend({_onAccelerationEvent:null,ctor:function(a){this._onAccelerationEvent=a;var b=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.ACCELERATION,cc._EventListenerAcceleration.LISTENER_ID,function(a){b._onAccelerationEvent(a._acc,a)})},checkAvailable:function(){cc.assert(this._onAccelerationEvent,cc._LogInfos._EventListenerAcceleration_checkAvailable);return!0},clone:function(){return new cc._EventListenerAcceleration(this._onAccelerationEvent)}});
cc._EventListenerAcceleration.LISTENER_ID="__cc_acceleration";cc._EventListenerAcceleration.create=function(a){return new cc._EventListenerAcceleration(a)};
cc._EventListenerKeyboard=cc.EventListener.extend({onKeyPressed:null,onKeyReleased:null,ctor:function(){var a=this;cc.EventListener.prototype.ctor.call(this,cc.EventListener.KEYBOARD,cc._EventListenerKeyboard.LISTENER_ID,function(b){if(b._isPressed){if(a.onKeyPressed)a.onKeyPressed(b._keyCode,b)}else if(a.onKeyReleased)a.onKeyReleased(b._keyCode,b)})},clone:function(){var a=new cc._EventListenerKeyboard;a.onKeyPressed=this.onKeyPressed;a.onKeyReleased=this.onKeyReleased;return a},checkAvailable:function(){return null===
this.onKeyPressed&&null===this.onKeyReleased?(cc.log(cc._LogInfos._EventListenerKeyboard_checkAvailable),!1):!0}});cc._EventListenerKeyboard.LISTENER_ID="__cc_keyboard";cc._EventListenerKeyboard.create=function(){return new cc._EventListenerKeyboard};var GlobalVertexBuffer=function(){var a=function(a,c){this.gl=a;this.vertexBuffer=a.createBuffer();this.size=888;this.byteLength=c||3552*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this.data=new ArrayBuffer(this.byteLength);this.dataArray=new Float32Array(this.data);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.dataArray,a.DYNAMIC_DRAW);this._dirty=!1;this._spaces={0:this.byteLength}};a.prototype={constructor:a,allocBuffer:function(a,c){var d=this._spaces[a];return d&&
d>=c?(delete this._spaces[a],d>c&&(this._spaces[a+c]=d-c),!0):!1},requestBuffer:function(a){var c,d,e;for(c in this._spaces)if(d=parseInt(c),e=this._spaces[c],e>=a&&this.allocBuffer(d,a))return d;return-1},freeBuffer:function(a,c){var d=this._spaces,e,f;for(f in d){e=parseInt(f);if(e>a)break;if(e+d[f]>=a){c=c+a-e;a=e;break}}d=a+c;this._spaces[d]&&(c+=this._spaces[d],delete this._spaces[d]);this._spaces[a]=c},setDirty:function(){this._dirty=!0},update:function(){this._dirty&&(this.gl.bindBuffer(gl.ARRAY_BUFFER,
this.vertexBuffer),this.gl.bufferSubData(gl.ARRAY_BUFFER,0,this.dataArray),this._dirty=!1)},updateSubData:function(a,c){this.gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer);this.gl.bufferSubData(gl.ARRAY_BUFFER,a,c)},destroy:function(){this.gl.deleteBuffer(this.vertexBuffer);this.vertexBuffer=this.texCoords=this.colors=this.positions=this.data=null}};return a}();cc.rendererCanvas={childrenOrderDirty:!0,assignedZ:0,assignedZStep:1E-4,_transformNodePool:[],_renderCmds:[],_isCacheToCanvasOn:!1,_cacheToCanvasCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(),_clearFillStyle:"rgb(0, 0, 0)",_dirtyRegion:null,_allNeedDraw:!0,_enableDirtyRegion:!1,_debugDirtyRegion:!1,_canUseDirtyRegion:!1,_dirtyRegionCountThreshold:10,getRenderCmd:function(a){return a._createRenderCmd()},enableDirtyRegion:function(a){this._enableDirtyRegion=a},isDirtyRegionEnabled:function(){return this._enableDirtyRegion},
setDirtyRegionCountThreshold:function(a){this._dirtyRegionCountThreshold=a},_collectDirtyRegion:function(){var a=this._renderCmds,b,c,d=this._dirtyRegion,e=0,f=!0,g=cc.Node.CanvasRenderCmd.RegionStatus;b=0;for(c=a.length;b<c;b++){var h=a[b],k=h._oldRegion,m=h._currentRegion;h._regionFlag>g.NotDirty&&(++e,e>this._dirtyRegionCountThreshold&&(f=!1),f&&(!m.isEmpty()&&d.addRegion(m),h._regionFlag>g.Dirty&&!k.isEmpty()&&d.addRegion(k)),h._regionFlag=g.NotDirty)}return f},_beginDrawDirtyRegion:function(a){var b=
a.getContext(),c=this._dirtyRegion.getDirtyRegions();b.save();a.setTransform({a:1,b:0,c:0,d:1,tx:0,ty:0},a._scaleX,a._scaleY);b.beginPath();a=0;for(var d=c.length;a<d;++a){var e=c[a];b.rect(e._minX,-e._maxY,e._width,e._height)}b.clip()},_endDrawDirtyRegion:function(a){a.restore()},_debugDrawDirtyRegion:function(a){if(this._debugDirtyRegion){var b=a.getContext(),c=this._dirtyRegion.getDirtyRegions();a.setTransform({a:1,b:0,c:0,d:1,tx:0,ty:0},a._scaleX,a._scaleY);b.beginPath();a=0;for(var d=c.length;a<
d;++a){var e=c[a];b.rect(e._minX,-e._maxY,e._width,e._height)}c=b.fillStyle;b.fillStyle="green";b.fill();b.fillStyle=c}},rendering:function(a){var b=this._dirtyRegion=this._dirtyRegion||new cc.DirtyRegion,c=cc._canvas;a=a||cc._renderContext;var d=a.getContext(),e=cc.view.getScaleX(),f=cc.view.getScaleY();a.setViewScale(e,f);a.computeRealOffsetY();var g=this._dirtyRegion.getDirtyRegions(),h=this._renderCmds,k,m=this._allNeedDraw||!this._enableDirtyRegion||!this._canUseDirtyRegion;k=!0;m||(k=this._collectDirtyRegion());
(m=m||!k)||this._beginDrawDirtyRegion(a);d.setTransform(1,0,0,1,0,0);d.clearRect(0,0,c.width,c.height);if(255!==this._clearColor.r||255!==this._clearColor.g||255!==this._clearColor.b)a.setFillStyle(this._clearFillStyle),a.setGlobalAlpha(this._clearColor.a),d.fillRect(0,0,c.width,c.height);c=0;for(k=h.length;c<k;c++){var n=h[c],p=!1,r=n._currentRegion;if(!r||m)p=!0;else for(var s=0,u=g.length;s<u;++s)if(g[s].intersects(r)){p=!0;break}p&&n.rendering(a,e,f)}m||(this._debugDrawDirtyRegion(a),this._endDrawDirtyRegion(d));
b.clear();this._allNeedDraw=!1},_renderingToCacheCanvas:function(a,b,c,d){a||cc.log("The context of RenderTexture is invalid.");c=cc.isUndefined(c)?1:c;d=cc.isUndefined(d)?1:d;b=b||this._currentID;var e,f=this._cacheToCanvasCmds[b],g;a.computeRealOffsetY();e=0;for(g=f.length;e<g;e++)f[e].rendering(a,c,d);this._removeCache(b);a=this._cacheInstanceIds;0===a.length?this._isCacheToCanvasOn=!1:this._currentID=a[a.length-1]},_turnToCacheMode:function(a){this._isCacheToCanvasOn=!0;a=a||0;this._cacheToCanvasCmds[a]=
[];-1===this._cacheInstanceIds.indexOf(a)&&this._cacheInstanceIds.push(a);this._currentID=a},_turnToNormalMode:function(){this._isCacheToCanvasOn=!1},_removeCache:function(a){a=a||this._currentID;var b=this._cacheToCanvasCmds[a];b&&(b.length=0,delete this._cacheToCanvasCmds[a]);cc.arrayRemoveObject(this._cacheInstanceIds,a)},resetFlag:function(){this.childrenOrderDirty=!1;this._transformNodePool.length=0},transform:function(){var a=this._transformNodePool;a.sort(this._sortNodeByLevelAsc);for(var b=
0,c=a.length;b<c;b++)0!==a[b]._dirtyFlag&&a[b].updateStatus();a.length=0},transformDirty:function(){return 0<this._transformNodePool.length},_sortNodeByLevelAsc:function(a,b){return a._curLevel-b._curLevel},pushDirtyNode:function(a){this._transformNodePool.push(a)},clear:function(){},clearRenderCommands:function(){this._renderCmds.length=0;this._cacheInstanceIds.length=0;this._isCacheToCanvasOn=!1;this._canUseDirtyRegion=this._allNeedDraw=!0},pushRenderCommand:function(a){if(a.needDraw())if(a._canUseDirtyRegion||
(this._canUseDirtyRegion=!1),this._isCacheToCanvasOn){var b=this._cacheToCanvasCmds[this._currentID];-1===b.indexOf(a)&&b.push(a)}else-1===this._renderCmds.indexOf(a)&&this._renderCmds.push(a)}};
(function(){cc.CanvasContextWrapper=function(a){this._context=a;this._saveCount=0;this._currentAlpha=a.globalAlpha;this._currentCompositeOperation=a.globalCompositeOperation;this._currentFillStyle=a.fillStyle;this._currentStrokeStyle=a.strokeStyle;this._offsetY=this._offsetX=0;this._realOffsetY=this.height;this._armatureMode=0};var a=cc.CanvasContextWrapper.prototype;a.resetCache=function(){var a=this._context;this._currentAlpha=a.globalAlpha;this._currentCompositeOperation=a.globalCompositeOperation;
this._currentFillStyle=a.fillStyle;this._currentStrokeStyle=a.strokeStyle;this._realOffsetY=this._context.canvas.height+this._offsetY};a.setOffset=function(a,c){this._offsetX=a;this._offsetY=c;this._realOffsetY=this._context.canvas.height+this._offsetY};a.computeRealOffsetY=function(){this._realOffsetY=this._context.canvas.height+this._offsetY};a.setViewScale=function(a,c){this._scaleX=a;this._scaleY=c};a.getContext=function(){return this._context};a.save=function(){this._context.save();this._saveCount++};
a.restore=function(){this._context.restore();this._saveCount--};a.setGlobalAlpha=function(a){0<this._saveCount?this._context.globalAlpha=a:this._currentAlpha!==a&&(this._currentAlpha=a,this._context.globalAlpha=a)};a.setCompositeOperation=function(a){0<this._saveCount?this._context.globalCompositeOperation=a:this._currentCompositeOperation!==a&&(this._currentCompositeOperation=a,this._context.globalCompositeOperation=a)};a.setFillStyle=function(a){0<this._saveCount?this._context.fillStyle=a:this._currentFillStyle!==
a&&(this._currentFillStyle=a,this._context.fillStyle=a)};a.setStrokeStyle=function(a){0<this._saveCount?this._context.strokeStyle=a:this._currentStrokeStyle!==a&&(this._currentStrokeStyle=a,this._context.strokeStyle=a)};a.setTransform=function(a,c,d){0<this._armatureMode?(this.restore(),this.save(),this._context.transform(a.a*c,-a.b*d,-a.c*c,a.d*d,a.tx*c,-(a.ty*d))):this._context.setTransform(a.a*c,-a.b*d,-a.c*c,a.d*d,this._offsetX+a.tx*c,this._realOffsetY-a.ty*d)};a._switchToArmatureMode=function(a,
c,d,e){a?(this._armatureMode++,this._context.setTransform(c.a,c.c,c.b,c.d,this._offsetX+c.tx*d,this._realOffsetY-c.ty*e),this.save()):(this._armatureMode--,this.restore())}})();cc.rendererWebGL=function(){var a={texture:null,blendSrc:null,blendDst:null,glProgramState:null},b=!1,c=null,d=null,e=0,f=0,g=0,h=null,k=0,m=null,n=null,p=null,r=0,s=!0,u={QUAD:0,TRIANGLE:1,CUSTOM:2};return{mat4Identity:null,childrenOrderDirty:!0,assignedZ:0,assignedZStep:0.01,VertexType:u,_transformNodePool:[],_renderCmds:[],_isCacheToBufferOn:!1,_cacheToBufferCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(0,0,0,255),init:function(){var a=cc._renderContext;a.disable(a.CULL_FACE);
a.disable(a.DEPTH_TEST);this.mat4Identity=new cc.math.Matrix4;this.mat4Identity.identity();var a=cc.BATCH_VERTEX_COUNT,b=cc._renderContext;null===c&&(d=b.createBuffer(),c=b.createBuffer());b=cc._renderContext;if(c){var f=6*Math.ceil(a/4);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,c);p=new Uint16Array(f);for(var g=0,s=0;s<f;s+=6)p[s]=g+0,p[s+1]=g+1,p[s+2]=g+2,p[s+3]=g+1,p[s+4]=g+2,p[s+5]=g+3,g+=4;b.bufferData(b.ELEMENT_ARRAY_BUFFER,p,b.DYNAMIC_DRAW)}d&&(k=6*a,h=new ArrayBuffer(4*k),m=new Float32Array(h),
n=new Uint32Array(h),b.bindBuffer(b.ARRAY_BUFFER,d),b.bufferData(b.ARRAY_BUFFER,m,b.DYNAMIC_DRAW));e=a-200},getVertexSize:function(){return e},getRenderCmd:function(a){return a._createRenderCmd()},_turnToCacheMode:function(a){this._isCacheToBufferOn=!0;a=a||0;this._cacheToBufferCmds[a]?this._cacheToBufferCmds[a].length=0:this._cacheToBufferCmds[a]=[];-1===this._cacheInstanceIds.indexOf(a)&&this._cacheInstanceIds.push(a);this._currentID=a},_turnToNormalMode:function(){this._isCacheToBufferOn=!1},_removeCache:function(a){a=
a||this._currentID;var b=this._cacheToBufferCmds[a];b&&(b.length=0,delete this._cacheToBufferCmds[a]);cc.arrayRemoveObject(this._cacheInstanceIds,a)},_renderingToBuffer:function(a){a=a||this._currentID;this.rendering(cc._renderContext,this._cacheToBufferCmds[a]);this._removeCache(a);a=this._cacheInstanceIds;0===a.length?this._isCacheToBufferOn=!1:this._currentID=a[a.length-1]},resetFlag:function(){this.childrenOrderDirty&&(this.childrenOrderDirty=!1);this._transformNodePool.length=0},transform:function(){var a=
this._transformNodePool;a.sort(this._sortNodeByLevelAsc);var b,c,d;b=0;for(c=a.length;b<c;b++)d=a[b],d.updateStatus();a.length=0},transformDirty:function(){return 0<this._transformNodePool.length},_sortNodeByLevelAsc:function(a,b){return a._curLevel-b._curLevel},pushDirtyNode:function(a){this._transformNodePool.push(a)},clearRenderCommands:function(){this._renderCmds.length=0},clear:function(){var a=cc._renderContext;a.clearColor(this._clearColor.r/255,this._clearColor.g/255,this._clearColor.b/255,
this._clearColor.a/255);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)},setDepthTest:function(a){var b=cc._renderContext;a?(b.clearDepth(1),b.enable(b.DEPTH_TEST),b.depthFunc(b.LEQUAL)):b.disable(b.DEPTH_TEST)},pushRenderCommand:function(a){if(a.rendering||a.uploadData)if(this._isCacheToBufferOn){var b=this._cacheToBufferCmds[this._currentID];-1===b.indexOf(a)&&b.push(a)}else-1===this._renderCmds.indexOf(a)&&this._renderCmds.push(a)},_increaseBatchingSize:function(a,b,c){b=b||u.QUAD;switch(b){case u.QUAD:for(b=
0;b<a;b+=4)c=f+b,p[g++]=c+0,p[g++]=c+1,p[g++]=c+2,p[g++]=c+1,p[g++]=c+2,p[g++]=c+3;break;case u.TRIANGLE:s=!1;for(b=0;b<a;b+=3)c=f+b,p[g++]=c+0,p[g++]=c+1,p[g++]=c+2;break;case u.CUSTOM:s=!1;var d=c.length;for(b=0;b<d;b++)p[g++]=f+c[b];break;default:return}f+=a},_updateBatchedInfo:function(b,c,d){return b!==a.texture||c.src!==a.blendSrc||c.dst!==a.blendDst||d!==a.glProgramState?(this._batchRendering(),a.texture=b,a.blendSrc=c.src,a.blendDst=c.dst,a.glProgramState=d,!0):!1},_breakBatch:function(){b=
!0},_uploadBufferData:function(c){f>=e&&this._batchRendering();var d=c._node,g=d._texture||d._spriteFrame&&d._spriteFrame._texture,h=d._blendFunc.src,d=d._blendFunc.dst,k=c._glProgramState;if(b||a.texture!==g||a.blendSrc!==h||a.blendDst!==d||a.glProgramState!==k)this._batchRendering(),a.texture=g,a.blendSrc=h,a.blendDst=d,a.glProgramState=k,b=!1;g=c.uploadData(m,n,6*f);0<g&&this._increaseBatchingSize(g,c.vertexType)},_batchRendering:function(){if(0!==f&&a.texture){var b=cc._renderContext,h=a.texture,
k=a.glProgramState,n=f>0.5*e;k&&(k.apply(),k.getGLProgram()._updateProjectionUniform());cc.glBlendFunc(a.blendSrc,a.blendDst);cc.glBindTexture2DN(0,h);b.bindBuffer(b.ARRAY_BUFFER,d);n?b.bufferData(b.ARRAY_BUFFER,m,b.DYNAMIC_DRAW):(h=m.subarray(0,6*f),b.bufferData(b.ARRAY_BUFFER,h,b.DYNAMIC_DRAW));b.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);b.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR);b.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS);b.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,
3,b.FLOAT,!1,24,0);b.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,b.UNSIGNED_BYTE,!0,24,12);b.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,b.FLOAT,!1,24,16);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,c);if(!r||!s||g>r)n?b.bufferData(b.ELEMENT_ARRAY_BUFFER,p,b.DYNAMIC_DRAW):b.bufferData(b.ELEMENT_ARRAY_BUFFER,p.subarray(0,g),b.DYNAMIC_DRAW);b.drawElements(b.TRIANGLES,g,b.UNSIGNED_SHORT,0);cc.g_NumberOfDraws++;s?r=g:(r=0,s=!0);g=f=0}},rendering:function(b,c){var d=c||this._renderCmds,e,g,h,k=b||cc._renderContext;
k.bindBuffer(gl.ARRAY_BUFFER,null);e=0;for(g=d.length;e<g;++e)h=d[e],h.needDraw()&&(h.uploadData?this._uploadBufferData(h):(0<f&&this._batchRendering(),h.rendering(k)));this._batchRendering();a.texture=null}}}();var Region=function(){this._area=this._height=this._width=this._maxY=this._maxX=this._minY=this._minX=0},regionProto=Region.prototype,regionPool=[];function regionCreate(){var a=regionPool.pop();a||(a=new Region);return a}function regionRelease(a){regionPool.push(a)}regionProto.setTo=function(a,b,c,d){this._minX=a;this._minY=b;this._maxX=c;this._maxY=d;this.updateArea();return this};
regionProto.intValues=function(){this._minX=Math.floor(this._minX);this._minY=Math.floor(this._minY);this._maxX=Math.ceil(this._maxX);this._maxY=Math.ceil(this._maxY);this.updateArea()};regionProto.updateArea=function(){this._width=this._maxX-this._minX;this._height=this._maxY-this._minY;this._area=this._width*this._height};
regionProto.union=function(a){0>=this._width||0>=this._height?this.setTo(a._minX,a._minY,a._maxX,a._maxY):(this._minX>a._minX&&(this._minX=a._minX),this._minY>a._minY&&(this._minY=a._minY),this._maxX<a._maxX&&(this._maxX=a._maxX),this._maxY<a._maxY&&(this._maxY=a._maxY),this.updateArea())};regionProto.setEmpty=function(){this._area=this._height=this._width=this._maxY=this._maxX=this._minY=this._minX=0};regionProto.isEmpty=function(){return 0>=this._width||0>=this._height};
regionProto.intersects=function(a){if(0>=this._width||0>=this._height||0>=a._width||0>=a._height)return!1;var b=this._minX>a._minX?this._minX:a._minX,c=this._maxX<a._maxX?this._maxX:a._maxX;if(b>c)return!1;b=this._minY>a._minY?this._minY:a._minY;c=this._maxY<a._maxY?this._maxY:a._maxY;return b<=c};
regionProto.updateRegion=function(a,b){if(0==a.width||0==a.height)this.setEmpty();else{var c=b.a,d=b.b,e=b.c,f=b.d,g=b.tx,h=b.ty,k=a.x,m=a.y,n=k+a.width,p=m+a.height,r,s,u;if(1==c&&0==d&&0==e&&1==f)r=k+g-1,s=m+h-1,u=n+g+1,m=p+h+1;else{r=c*k+e*m+g;s=d*k+f*m+h;u=c*n+e*m+g;var m=d*n+f*m+h,t=c*n+e*p+g,n=d*n+f*p+h,g=c*k+e*p+g,h=d*k+f*p+h,p=0;r>u&&(p=r,r=u,u=p);t>g&&(p=t,t=g,g=p);r=(r<t?r:t)-1;u=(u>g?u:g)+1;s>m&&(p=s,s=m,m=p);n>h&&(p=n,n=h,h=p);s=(s<n?s:n)-1;m=(m>h?m:h)+1}this._minX=r;this._minY=s;this._maxX=
u;this._maxY=m;this._width=u-r;this._height=m-s;this._area=this._width*this._height}};function unionArea(a,b){return((a._maxX>b._maxX?a._maxX:b._maxX)-(a._minX<b._minX?a._minX:b._minX))*((a._maxY>b._maxY?a._maxY:b._maxY)-(a._minY<b._minY?a._minY:b._minY))}var DirtyRegion=function(){this.dirtyList=[];this.hasClipRect=!1;this.clipArea=this.clipHeight=this.clipWidth=0;this.clipRectChanged=!1},dirtyRegionProto=DirtyRegion.prototype;
dirtyRegionProto.setClipRect=function(a,b){this.clipRectChanged=this.hasClipRect=!0;this.clipWidth=Math.ceil(a);this.clipHeight=Math.ceil(b);this.clipArea=this.clipWidth*this.clipHeight};
dirtyRegionProto.addRegion=function(a){var b=a._minX,c=a._minY,d=a._maxX;a=a._maxY;this.hasClipRect&&(0>b&&(b=0),0>c&&(c=0),d>this.clipWidth&&(d=this.clipWidth),a>this.clipHeight&&(a=this.clipHeight));if(b>=d||c>=a)return!1;if(this.clipRectChanged)return!0;var e=this.dirtyList,f=regionCreate();e.push(f.setTo(b,c,d,a));this.mergeDirtyList(e);return!0};dirtyRegionProto.clear=function(){for(var a=this.dirtyList,b=a.length,c=0;c<b;c++)regionRelease(a[c]);a.length=0};
dirtyRegionProto.getDirtyRegions=function(){var a=this.dirtyList;if(this.clipRectChanged){this.clipRectChanged=!1;this.clear();var b=regionCreate();a.push(b.setTo(0,0,this.clipWidth,this.clipHeight))}else for(;this.mergeDirtyList(a););a=this.dirtyList.length;if(0<a)for(b=0;b<a;b++)this.dirtyList[b].intValues();return this.dirtyList};
dirtyRegionProto.mergeDirtyList=function(a){var b=a.length;if(2>b)return!1;for(var c=this.hasClipRect,d=3<b?Number.POSITIVE_INFINITY:0,e=0,f=0,g=0,h=0;h<b-1;h++){var k=a[h];c&&(g+=k.area);for(var m=h+1;m<b;m++){var n=a[m],n=unionArea(k,n)-k.area-n.area;d>n&&(e=h,f=m,d=n)}}c&&0.95<g/this.clipArea&&(this.clipRectChanged=!0);return e!=f?(b=a[f],a[e].union(b),regionRelease(b),a.splice(f,1),!0):!1};cc.Region=Region;cc.DirtyRegion=DirtyRegion;cc._tmp.PrototypeCCNode=function(){var a=cc.Node.prototype;cc.defineGetterSetter(a,"x",a.getPositionX,a.setPositionX);cc.defineGetterSetter(a,"y",a.getPositionY,a.setPositionY);cc.defineGetterSetter(a,"width",a._getWidth,a._setWidth);cc.defineGetterSetter(a,"height",a._getHeight,a._setHeight);cc.defineGetterSetter(a,"anchorX",a._getAnchorX,a._setAnchorX);cc.defineGetterSetter(a,"anchorY",a._getAnchorY,a._setAnchorY);cc.defineGetterSetter(a,"skewX",a.getSkewX,a.setSkewX);cc.defineGetterSetter(a,"skewY",
a.getSkewY,a.setSkewY);cc.defineGetterSetter(a,"zIndex",a.getLocalZOrder,a.setLocalZOrder);cc.defineGetterSetter(a,"vertexZ",a.getVertexZ,a.setVertexZ);cc.defineGetterSetter(a,"rotation",a.getRotation,a.setRotation);cc.defineGetterSetter(a,"rotationX",a.getRotationX,a.setRotationX);cc.defineGetterSetter(a,"rotationY",a.getRotationY,a.setRotationY);cc.defineGetterSetter(a,"scale",a.getScale,a.setScale);cc.defineGetterSetter(a,"scaleX",a.getScaleX,a.setScaleX);cc.defineGetterSetter(a,"scaleY",a.getScaleY,
a.setScaleY);cc.defineGetterSetter(a,"children",a.getChildren);cc.defineGetterSetter(a,"childrenCount",a.getChildrenCount);cc.defineGetterSetter(a,"parent",a.getParent,a.setParent);cc.defineGetterSetter(a,"visible",a.isVisible,a.setVisible);cc.defineGetterSetter(a,"running",a.isRunning);cc.defineGetterSetter(a,"ignoreAnchor",a.isIgnoreAnchorPointForPosition,a.ignoreAnchorPointForPosition);cc.defineGetterSetter(a,"actionManager",a.getActionManager,a.setActionManager);cc.defineGetterSetter(a,"scheduler",
a.getScheduler,a.setScheduler);cc.defineGetterSetter(a,"shaderProgram",a.getShaderProgram,a.setShaderProgram);cc.defineGetterSetter(a,"opacity",a.getOpacity,a.setOpacity);cc.defineGetterSetter(a,"opacityModifyRGB",a.isOpacityModifyRGB);cc.defineGetterSetter(a,"cascadeOpacity",a.isCascadeOpacityEnabled,a.setCascadeOpacityEnabled);cc.defineGetterSetter(a,"color",a.getColor,a.setColor);cc.defineGetterSetter(a,"cascadeColor",a.isCascadeColorEnabled,a.setCascadeColorEnabled)};cc.NODE_TAG_INVALID=-1;cc.s_globalOrderOfArrival=1;
cc.Node=cc.Class.extend({_localZOrder:0,_globalZOrder:0,_vertexZ:0,_customZ:NaN,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:null,_normalizedPosition:null,_usingNormalizedPosition:!1,_normalizedPositionDirty:!1,_skewX:0,_skewY:0,_children:null,_visible:!0,_anchorPoint:null,_contentSize:null,_running:!1,_parent:null,_ignoreAnchorPointForPosition:!1,tag:cc.NODE_TAG_INVALID,userData:null,userObject:null,_reorderChildDirty:!1,arrivalOrder:0,_actionManager:null,_scheduler:null,_additionalTransformDirty:!1,
_additionalTransform:null,_componentContainer:null,_isTransitionFinished:!1,_className:"Node",_showNode:!1,_name:"",_realOpacity:255,_realColor:null,_cascadeColorEnabled:!1,_cascadeOpacityEnabled:!1,_renderCmd:null,ctor:function(){this._anchorPoint=cc.p(0,0);this._contentSize=cc.size(0,0);this._position=cc.p(0,0);this._normalizedPosition=cc.p(0,0);this._children=[];this._additionalTransform=cc.affineTransformMakeIdentity();cc.ComponentContainer&&(this._componentContainer=new cc.ComponentContainer(this));
this._realColor=cc.color(255,255,255,255);this._renderCmd=this._createRenderCmd()},init:function(){return!0},attr:function(a){for(var b in a)this[b]=a[b]},getSkewX:function(){return this._skewX},setSkewX:function(a){this._skewX=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getSkewY:function(){return this._skewY},setSkewY:function(a){this._skewY=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setLocalZOrder:function(a){this._parent?this._parent.reorderChild(this,
a):this._localZOrder=a;cc.eventManager._setDirtyForNode(this)},_setLocalZOrder:function(a){this._localZOrder=a},getLocalZOrder:function(){return this._localZOrder},getZOrder:function(){cc.log(cc._LogInfos.Node_getZOrder);return this.getLocalZOrder()},setZOrder:function(a){cc.log(cc._LogInfos.Node_setZOrder);this.setLocalZOrder(a)},setGlobalZOrder:function(a){this._globalZOrder!==a&&(this._globalZOrder=a,cc.eventManager._setDirtyForNode(this))},getGlobalZOrder:function(){return this._globalZOrder},
getVertexZ:function(){return this._vertexZ},setVertexZ:function(a){this._customZ=this._vertexZ=a},getRotation:function(){this._rotationX!==this._rotationY&&cc.log(cc._LogInfos.Node_getRotation);return this._rotationX},setRotation:function(a){this._rotationX=this._rotationY=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getRotationX:function(){return this._rotationX},setRotationX:function(a){this._rotationX=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getRotationY:function(){return this._rotationY},
setRotationY:function(a){this._rotationY=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScale:function(){this._scaleX!==this._scaleY&&cc.log(cc._LogInfos.Node_getScale);return this._scaleX},setScale:function(a,b){this._scaleX=a;this._scaleY=b||0===b?b:a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX},setScaleX:function(a){this._scaleX=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY},
setScaleY:function(a){this._scaleY=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setPosition:function(a,b){var c=this._position;if(void 0===b){if(c.x===a.x&&c.y===a.y)return;c.x=a.x;c.y=a.y}else{if(c.x===a&&c.y===b)return;c.x=a;c.y=b}this._usingNormalizedPosition=!1;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setNormalizedPosition:function(a,b){var c=this._normalizedPosition;void 0===b?(c.x=a.x,c.y=a.y):(c.x=a,c.y=b);this._normalizedPositionDirty=this._usingNormalizedPosition=
!0;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPosition:function(){return cc.p(this._position)},getNormalizedPosition:function(){return cc.p(this._normalizedPosition)},getPositionX:function(){return this._position.x},setPositionX:function(a){this._position.x=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPositionY:function(){return this._position.y},setPositionY:function(a){this._position.y=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},
getChildrenCount:function(){return this._children.length},getChildren:function(){return this._children},isVisible:function(){return this._visible},setVisible:function(a){this._visible!==a&&(this._visible=a,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),cc.renderer.childrenOrderDirty=!0)},getAnchorPoint:function(){return cc.p(this._anchorPoint)},setAnchorPoint:function(a,b){var c=this._anchorPoint;if(void 0===b){if(a.x===c.x&&a.y===c.y)return;c.x=a.x;c.y=a.y}else{if(a===c.x&&b===
c.y)return;c.x=a;c.y=b}this._renderCmd._updateAnchorPointInPoint()},_getAnchorX:function(){return this._anchorPoint.x},_setAnchorX:function(a){this._anchorPoint.x!==a&&(this._anchorPoint.x=a,this._renderCmd._updateAnchorPointInPoint())},_getAnchorY:function(){return this._anchorPoint.y},_setAnchorY:function(a){this._anchorPoint.y!==a&&(this._anchorPoint.y=a,this._renderCmd._updateAnchorPointInPoint())},getAnchorPointInPoints:function(){return this._renderCmd.getAnchorPointInPoints()},_getWidth:function(){return this._contentSize.width},
_setWidth:function(a){this._contentSize.width=a;this._renderCmd._updateAnchorPointInPoint()},_getHeight:function(){return this._contentSize.height},_setHeight:function(a){this._contentSize.height=a;this._renderCmd._updateAnchorPointInPoint()},getContentSize:function(){return cc.size(this._contentSize)},setContentSize:function(a,b){var c=this._contentSize;if(void 0===b){if(a.width===c.width&&a.height===c.height)return;c.width=a.width;c.height=a.height}else{if(a===c.width&&b===c.height)return;c.width=
a;c.height=b}this._renderCmd._updateAnchorPointInPoint()},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(a){this._parent=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},ignoreAnchorPointForPosition:function(a){a!==this._ignoreAnchorPointForPosition&&(this._ignoreAnchorPointForPosition=a,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},
getTag:function(){return this.tag},setTag:function(a){this.tag=a},setName:function(a){this._name=a},getName:function(){return this._name},getUserData:function(){return this.userData},setUserData:function(a){this.userData=a},getUserObject:function(){return this.userObject},setUserObject:function(a){this.userObject!==a&&(this.userObject=a)},getOrderOfArrival:function(){return this.arrivalOrder},setOrderOfArrival:function(a){this.arrivalOrder=a},getActionManager:function(){return this._actionManager||
cc.director.getActionManager()},setActionManager:function(a){this._actionManager!==a&&(this.stopAllActions(),this._actionManager=a)},getScheduler:function(){return this._scheduler||cc.director.getScheduler()},setScheduler:function(a){this._scheduler!==a&&(this.unscheduleAllCallbacks(),this._scheduler=a)},boundingBox:function(){cc.log(cc._LogInfos.Node_boundingBox);return this.getBoundingBox()},getBoundingBox:function(){var a=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc._rectApplyAffineTransformIn(a,
this.getNodeToParentTransform())},cleanup:function(){this.stopAllActions();this.unscheduleAllCallbacks();cc.eventManager.removeListeners(this)},getChildByTag:function(a){var b=this._children;if(null!==b)for(var c=0;c<b.length;c++){var d=b[c];if(d&&d.tag===a)return d}return null},getChildByName:function(a){if(!a)return cc.log("Invalid name"),null;for(var b=this._children,c=0,d=b.length;c<d;c++)if(b[c]._name===a)return b[c];return null},addChild:function(a,b,c){b=void 0===b?a._localZOrder:b;var d,e=
!1;void 0===c?d=a._name:"string"===typeof c?(d=c,c=void 0):"number"===typeof c&&(e=!0,d="");cc.assert(a,cc._LogInfos.Node_addChild_3);cc.assert(null===a._parent,"child already added. It can't be added again");this._addChildHelper(a,b,c,d,e)},_addChildHelper:function(a,b,c,d,e){this._children||(this._children=[]);this._insertChild(a,b);e?a.setTag(c):a.setName(d);a.setParent(this);a.setOrderOfArrival(cc.s_globalOrderOfArrival++);this._running&&(a._performRecursive(cc.Node._stateCallbackType.onEnter),
this._isTransitionFinished&&a._performRecursive(cc.Node._stateCallbackType.onEnterTransitionDidFinish));a._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);this._cascadeColorEnabled&&a._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty);this._cascadeOpacityEnabled&&a._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},removeFromParent:function(a){this._parent&&(void 0===a&&(a=!0),this._parent.removeChild(this,a))},removeFromParentAndCleanup:function(a){cc.log(cc._LogInfos.Node_removeFromParentAndCleanup);
this.removeFromParent(a)},removeChild:function(a,b){0!==this._children.length&&(void 0===b&&(b=!0),-1<this._children.indexOf(a)&&this._detachChild(a,b),cc.renderer.childrenOrderDirty=!0)},removeChildByTag:function(a,b){a===cc.NODE_TAG_INVALID&&cc.log(cc._LogInfos.Node_removeChildByTag);var c=this.getChildByTag(a);c?this.removeChild(c,b):cc.log(cc._LogInfos.Node_removeChildByTag_2,a)},removeAllChildrenWithCleanup:function(a){this.removeAllChildren(a)},removeAllChildren:function(a){var b=this._children;
if(null!==b){void 0===a&&(a=!0);for(var c=0;c<b.length;c++){var d=b[c];d&&(this._running&&(d._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),d._performRecursive(cc.Node._stateCallbackType.onExit)),a&&d._performRecursive(cc.Node._stateCallbackType.cleanup),d.parent=null,d._renderCmd.detachFromParent())}this._children.length=0;cc.renderer.childrenOrderDirty=!0}},_detachChild:function(a,b){this._running&&(a._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),
a._performRecursive(cc.Node._stateCallbackType.onExit));b&&a._performRecursive(cc.Node._stateCallbackType.cleanup);a.parent=null;a._renderCmd.detachFromParent();cc.arrayRemoveObject(this._children,a)},_insertChild:function(a,b){cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0;this._children.push(a);a._setLocalZOrder(b)},setNodeDirty:function(){this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},reorderChild:function(a,b){cc.assert(a,cc._LogInfos.Node_reorderChild);-1===this._children.indexOf(a)?
cc.log(cc._LogInfos.Node_reorderChild_2):b!==a.zIndex&&(cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0,a.arrivalOrder=cc.s_globalOrderOfArrival,cc.s_globalOrderOfArrival++,a._setLocalZOrder(b),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.orderDirty))},sortAllChildren:function(){if(this._reorderChildDirty){var a=this._children,b=a.length,c,d,e;for(c=1;c<b;c++){e=a[c];for(d=c-1;0<=d;){if(e._localZOrder<a[d]._localZOrder)a[d+1]=a[d];else if(e._localZOrder===a[d]._localZOrder&&e.arrivalOrder<
a[d].arrivalOrder)a[d+1]=a[d];else break;d--}a[d+1]=e}this._reorderChildDirty=!1}},draw:function(a){},transformAncestors:function(){null!==this._parent&&(this._parent.transformAncestors(),this._parent.transform())},onEnter:function(){this._isTransitionFinished=!1;this._running=!0;this.resume()},_performRecursive:function(a){var b=cc.Node._stateCallbackType;if(!(a>=b.max)){var c=0,d,e,f,g,h,k=cc.Node._performStacks[cc.Node._performing];k||(k=[],cc.Node._performStacks.push(k));k.length=0;cc.Node._performing++;
for(f=k[0]=this;f;){if((d=f._children)&&0<d.length)for(g=0,h=d.length;g<h;++g)e=d[g],k.push(e);if((d=f._protectedChildren)&&0<d.length)for(g=0,h=d.length;g<h;++g)e=d[g],k.push(e);c++;f=k[c]}for(g=k.length-1;0<=g;--g)if(f=k[g],k[g]=null,f)switch(a){case b.onEnter:f.onEnter();break;case b.onExit:f.onExit();break;case b.onEnterTransitionDidFinish:f.onEnterTransitionDidFinish();break;case b.cleanup:f.cleanup();break;case b.onExitTransitionDidStart:f.onExitTransitionDidStart()}cc.Node._performing--}},
onEnterTransitionDidFinish:function(){this._isTransitionFinished=!0},onExitTransitionDidStart:function(){},onExit:function(){this._running=!1;this.pause();this.removeAllComponents()},runAction:function(a){cc.assert(a,cc._LogInfos.Node_runAction);this.actionManager.addAction(a,this,!this._running);return a},stopAllActions:function(){this.actionManager&&this.actionManager.removeAllActionsFromTarget(this)},stopAction:function(a){this.actionManager.removeAction(a)},stopActionByTag:function(a){a===cc.ACTION_TAG_INVALID?
cc.log(cc._LogInfos.Node_stopActionByTag):this.actionManager.removeActionByTag(a,this)},getActionByTag:function(a){return a===cc.ACTION_TAG_INVALID?(cc.log(cc._LogInfos.Node_getActionByTag),null):this.actionManager.getActionByTag(a,this)},getNumberOfRunningActions:function(){return this.actionManager.numberOfRunningActionsInTarget(this)},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(a){this.scheduler.scheduleUpdate(this,a,!this._running)},unscheduleUpdate:function(){this.scheduler.unscheduleUpdate(this)},
schedule:function(a,b,c,d,e){var f=arguments.length;"function"===typeof a?1===f?(b=0,c=cc.REPEAT_FOREVER,d=0,e=this.__instanceId):2===f?"number"===typeof b?(c=cc.REPEAT_FOREVER,d=0,e=this.__instanceId):(e=b,b=0,c=cc.REPEAT_FOREVER,d=0):3===f?("string"===typeof c?(e=c,c=cc.REPEAT_FOREVER):e=this.__instanceId,d=0):4===f&&(e=this.__instanceId):1===f?(b=0,c=cc.REPEAT_FOREVER,d=0):2===f&&(c=cc.REPEAT_FOREVER,d=0);cc.assert(a,cc._LogInfos.Node_schedule);cc.assert(0<=b,cc._LogInfos.Node_schedule_2);b=b||
0;c=isNaN(c)?cc.REPEAT_FOREVER:c;this.scheduler.schedule(a,this,b,c,d||0,!this._running,e)},scheduleOnce:function(a,b,c){void 0===c&&(c=this.__instanceId);this.schedule(a,0,0,b,c)},unschedule:function(a){a&&this.scheduler.unschedule(a,this)},unscheduleAllCallbacks:function(){this.scheduler.unscheduleAllForTarget(this)},resumeSchedulerAndActions:function(){cc.log(cc._LogInfos.Node_resumeSchedulerAndActions);this.resume()},resume:function(){this.scheduler.resumeTarget(this);this.actionManager&&this.actionManager.resumeTarget(this);
cc.eventManager.resumeTarget(this)},pauseSchedulerAndActions:function(){cc.log(cc._LogInfos.Node_pauseSchedulerAndActions);this.pause()},pause:function(){this.scheduler.pauseTarget(this);this.actionManager&&this.actionManager.pauseTarget(this);cc.eventManager.pauseTarget(this)},setAdditionalTransform:function(a){if(void 0===a)return this._additionalTransformDirty=!1;this._additionalTransform=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);this._additionalTransformDirty=!0},getParentToNodeTransform:function(){return this._renderCmd.getParentToNodeTransform()},
parentToNodeTransform:function(){return this.getParentToNodeTransform()},getNodeToWorldTransform:function(){for(var a=this.getNodeToParentTransform(),b=this._parent;null!==b;b=b.parent)a=cc.affineTransformConcat(a,b.getNodeToParentTransform());return a},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getWorldToNodeTransform:function(){return cc.affineTransformInvert(this.getNodeToWorldTransform())},worldToNodeTransform:function(){return this.getWorldToNodeTransform()},convertToNodeSpace:function(a){return cc.pointApplyAffineTransform(a,
this.getWorldToNodeTransform())},convertToWorldSpace:function(a){a=a||cc.p(0,0);return cc.pointApplyAffineTransform(a,this.getNodeToWorldTransform())},convertToNodeSpaceAR:function(a){return cc.pSub(this.convertToNodeSpace(a),this._renderCmd.getAnchorPointInPoints())},convertToWorldSpaceAR:function(a){a=a||cc.p(0,0);a=cc.pAdd(a,this._renderCmd.getAnchorPointInPoints());return this.convertToWorldSpace(a)},_convertToWindowSpace:function(a){a=this.convertToWorldSpace(a);return cc.director.convertToUI(a)},
convertTouchToNodeSpace:function(a){a=a.getLocation();return this.convertToNodeSpace(a)},convertTouchToNodeSpaceAR:function(a){a=cc.director.convertToGL(a.getLocation());return this.convertToNodeSpaceAR(a)},update:function(a){this._componentContainer&&!this._componentContainer.isEmpty()&&this._componentContainer.visit(a)},updateTransform:function(){for(var a=this._children,b,c=0;c<a.length;c++)(b=a[c])&&b.updateTransform()},retain:function(){},release:function(){},getComponent:function(a){return this._componentContainer?
this._componentContainer.getComponent(a):null},addComponent:function(a){this._componentContainer&&this._componentContainer.add(a)},removeComponent:function(a){return this._componentContainer?this._componentContainer.remove(a):!1},removeAllComponents:function(){this._componentContainer&&this._componentContainer.removeAll()},grid:null,visit:function(a){var b=this._renderCmd,c=a?a._renderCmd:null;if(this._visible){a=cc.renderer;b.visit(c);var d=this._children,e=d.length,f;if(0<e){this._reorderChildDirty&&
this.sortAllChildren();for(c=0;c<e;c++)if(f=d[c],0>f._localZOrder)f.visit(this);else break;for(a.pushRenderCommand(b);c<e;c++)d[c].visit(this)}else a.pushRenderCommand(b);b._dirtyFlag=0}else b._propagateFlagsDown(c)},transform:function(a,b){this._renderCmd.transform(a,b)},nodeToParentTransform:function(){return this.getNodeToParentTransform()},getNodeToParentTransform:function(a){var b=this._renderCmd.getNodeToParentTransform();if(a)for(var b={a:b.a,b:b.b,c:b.c,d:b.d,tx:b.tx,ty:b.ty},c=this._parent;null!=
c&&c!=a;c=c.getParent())cc.affineTransformConcatIn(b,c.getNodeToParentTransform());return b},getNodeToParentAffineTransform:function(a){return this.getNodeToParentTransform(a)},getCamera:function(){return null},getGrid:function(){return this.grid},setGrid:function(a){this.grid=a},getShaderProgram:function(){return this._renderCmd.getShaderProgram()},setShaderProgram:function(a){this._renderCmd.setShaderProgram(a)},setGLProgramState:function(a){this._renderCmd.setGLProgramState(a)},getGLProgramState:function(){return this._renderCmd.getGLProgramState()},
getGLServerState:function(){return 0},setGLServerState:function(a){},getBoundingBoxToWorld:function(){var a=cc.rect(0,0,this._contentSize.width,this._contentSize.height),b=this.getNodeToWorldTransform(),a=cc.rectApplyAffineTransform(a,b);if(!this._children)return a;for(var c=this._children,d=0;d<c.length;d++){var e=c[d];e&&e._visible&&(e=e._getBoundingBoxToCurrentNode(b))&&(a=cc.rectUnion(a,e))}return a},_getBoundingBoxToCurrentNode:function(a){var b=cc.rect(0,0,this._contentSize.width,this._contentSize.height);
a=void 0===a?this.getNodeToParentTransform():cc.affineTransformConcat(this.getNodeToParentTransform(),a);b=cc.rectApplyAffineTransform(b,a);if(!this._children)return b;for(var c=this._children,d=0;d<c.length;d++){var e=c[d];e&&e._visible&&(e=e._getBoundingBoxToCurrentNode(a))&&(b=cc.rectUnion(b,e))}return b},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._renderCmd.getDisplayedOpacity()},setOpacity:function(a){this._realOpacity=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},
updateDisplayedOpacity:function(a){this._renderCmd._updateDisplayOpacity(a)},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(a){this._cascadeOpacityEnabled!==a&&(this._cascadeOpacityEnabled=a,this._renderCmd.setCascadeOpacityEnabledDirty())},getColor:function(){var a=this._realColor;return cc.color(a.r,a.g,a.b,a.a)},getDisplayedColor:function(){return this._renderCmd.getDisplayedColor()},setColor:function(a){var b=this._realColor;b.r=a.r;b.g=
a.g;b.b=a.b;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},updateDisplayedColor:function(a){this._renderCmd._updateDisplayColor(a)},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(a){this._cascadeColorEnabled!==a&&(this._cascadeColorEnabled=a,this._renderCmd.setCascadeColorEnabledDirty())},setOpacityModifyRGB:function(a){},isOpacityModifyRGB:function(){return!1},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?
new cc.Node.CanvasRenderCmd(this):new cc.Node.WebGLRenderCmd(this)},enumerateChildren:function(a,b){cc.assert(a&&0!=a.length,"Invalid name");cc.assert(null!=b,"Invalid callback function");var c=a.length,d=0,e=c,f=!1;2<c&&"/"===a[0]&&"/"===a[1]&&(f=!0,d=2,e-=2);var g=!1;3<c&&"/"===a[c-3]&&"."===a[c-2]&&"."===a[c-1]&&(g=!0,e-=3);c=a.substr(d,e);g&&(c="[[:alnum:]]+/"+c);f?this.doEnumerateRecursive(this,c,b):this.doEnumerate(c,b)},doEnumerateRecursive:function(a,b,c){var d=!1;if(a.doEnumerate(b,c))d=
!0;else for(var e=a.getChildren(),f=e.length,g=0;g<f;g++)if(a=e[g],this.doEnumerateRecursive(a,b,c)){d=!0;break}return d},doEnumerate:function(a,b){var c=a.indexOf("/"),d=a,e=!1;-1!==c&&(d=a.substr(0,c),e=!0);for(var c=!1,f,g=this._children,h=g.length,k=0;k<h;k++)if(f=g[k],-1!==f._name.indexOf(d))if(e){if(c=f.doEnumerate(a,b))break}else if(b(f)){c=!0;break}return c}});cc.Node.create=function(){return new cc.Node};
cc.Node._stateCallbackType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,onExitTransitionDidStart:5,max:6};cc.Node._performStacks=[[]];cc.Node._performing=0;cc.assert(cc.isFunction(cc._tmp.PrototypeCCNode),cc._LogInfos.MissingFile,"BaseNodesPropertyDefine.js");cc._tmp.PrototypeCCNode();delete cc._tmp.PrototypeCCNode;cc.CustomRenderCmd=function(a,b){this._needDraw=!0;this._target=a;this._callback=b};cc.CustomRenderCmd.prototype.rendering=function(a,b,c){this._callback&&this._callback.call(this._target,a,b,c)};cc.CustomRenderCmd.prototype.needDraw=function(){return this._needDraw};var dirtyFlags=cc.Node._dirtyFlags={transformDirty:1,visibleDirty:2,colorDirty:4,opacityDirty:8,cacheDirty:16,orderDirty:32,textDirty:64,gradientDirty:128,textureDirty:256,contentDirty:512,COUNT:10,all:1023},ONE_DEGREE=Math.PI/180;
function transformChildTree(a){var b=1,c,d,e,f,g,h=cc.Node._performStacks[cc.Node._performing];h||(h=[],cc.Node._performStacks.push(h));h.length=0;cc.Node._performing++;for(h[0]=a;b;)if(b--,d=h[b],h[b]=null,d){if((c=d._children)&&0<c.length)for(e=d._renderCmd,f=0,g=c.length;f<g;++f)a=c[f],h[b]=a,b++,a._renderCmd.transform(e);if((c=d._protectedChildren)&&0<c.length)for(e=d._renderCmd,f=0,g=c.length;f<g;++f)a=c[f],h[b]=a,b++,a._renderCmd.transform(e)}cc.Node._performing--}
cc.Node.RenderCmd=function(a){this._node=a;this._anchorPointInPoints={x:0,y:0};this._displayedColor=cc.color(255,255,255,255)};
cc.Node.RenderCmd.prototype={constructor:cc.Node.RenderCmd,_needDraw:!1,_dirtyFlag:1,_curLevel:-1,_displayedOpacity:255,_cascadeColorEnabledDirty:!1,_cascadeOpacityEnabledDirty:!1,_transform:null,_worldTransform:null,_inverse:null,needDraw:function(){return this._needDraw},getAnchorPointInPoints:function(){return cc.p(this._anchorPointInPoints)},getDisplayedColor:function(){var a=this._displayedColor;return cc.color(a.r,a.g,a.b,a.a)},getDisplayedOpacity:function(){return this._displayedOpacity},setCascadeColorEnabledDirty:function(){this._cascadeColorEnabledDirty=
!0;this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},setCascadeOpacityEnabledDirty:function(){this._cascadeOpacityEnabledDirty=!0;this.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getParentToNodeTransform:function(){this._inverse||(this._inverse={a:1,b:0,c:0,d:1,tx:0,ty:0});this._dirtyFlag&cc.Node._dirtyFlags.transformDirty&&cc.affineTransformInvertOut(this.getNodeToParentTransform(),this._inverse);return this._inverse},detachFromParent:function(){},_updateAnchorPointInPoint:function(){var a=
this._anchorPointInPoints,b=this._node._contentSize,c=this._node._anchorPoint;a.x=b.width*c.x;a.y=b.height*c.y;this.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setDirtyFlag:function(a){0===this._dirtyFlag&&0!==a&&cc.renderer.pushDirtyNode(this);this._dirtyFlag|=a},getParentRenderCmd:function(){return this._node&&this._node._parent&&this._node._parent._renderCmd?this._node._parent._renderCmd:null},transform:function(a,b){this._transform||(this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform=
{a:1,b:0,c:0,d:1,tx:0,ty:0});var c=this._node,d=a?a._worldTransform:null,e=this._transform,f=this._worldTransform;if(c._usingNormalizedPosition&&c._parent){var g=c._parent._contentSize;c._position.x=c._normalizedPosition.x*g.width;c._position.y=c._normalizedPosition.y*g.height;c._normalizedPositionDirty=!1}var h=c._rotationX||c._rotationY,k=c._skewX||c._skewY,m=c._scaleX,n=c._scaleY,g=this._anchorPointInPoints.x,p=this._anchorPointInPoints.y,r=1,s=0,u=0,t=1;if(h||k){e.tx=c._position.x;e.ty=c._position.y;
h&&(r=c._rotationX*ONE_DEGREE,u=Math.sin(r),t=Math.cos(r),c._rotationY===c._rotationX?(r=t,s=-u):(s=c._rotationY*ONE_DEGREE,r=Math.cos(s),s=-Math.sin(s)));e.a=r*=m;e.b=s*=m;e.c=u*=n;e.d=t*=n;k&&(k=Math.tan(c._skewX*ONE_DEGREE),m=Math.tan(c._skewY*ONE_DEGREE),Infinity===k&&(k=99999999),Infinity===m&&(m=99999999),e.a=r+u*m,e.b=s+t*m,e.c=u+r*k,e.d=t+s*k);if(g||p)e.tx-=e.a*g+e.c*p,e.ty-=e.b*g+e.d*p,c._ignoreAnchorPointForPosition&&(e.tx+=g,e.ty+=p);c._additionalTransformDirty&&cc.affineTransformConcatIn(e,
c._additionalTransform);d?(f.a=e.a*d.a+e.b*d.c,f.b=e.a*d.b+e.b*d.d,f.c=e.c*d.a+e.d*d.c,f.d=e.c*d.b+e.d*d.d,f.tx=d.a*e.tx+d.c*e.ty+d.tx,f.ty=d.d*e.ty+d.ty+d.b*e.tx):(f.a=e.a,f.b=e.b,f.c=e.c,f.d=e.d,f.tx=e.tx,f.ty=e.ty)}else{e.a=m;e.b=0;e.c=0;e.d=n;e.tx=c._position.x;e.ty=c._position.y;if(g||p)e.tx-=e.a*g,e.ty-=e.d*p,c._ignoreAnchorPointForPosition&&(e.tx+=g,e.ty+=p);c._additionalTransformDirty&&cc.affineTransformConcatIn(e,c._additionalTransform);d?(f.a=e.a*d.a+e.b*d.c,f.b=e.a*d.b+e.b*d.d,f.c=e.c*
d.a+e.d*d.c,f.d=e.c*d.b+e.d*d.d,f.tx=e.tx*d.a+e.ty*d.c+d.tx,f.ty=e.tx*d.b+e.ty*d.d+d.ty):(f.a=e.a,f.b=e.b,f.c=e.c,f.d=e.d,f.tx=e.tx,f.ty=e.ty)}this._updateCurrentRegions&&(this._updateCurrentRegions(),this._notifyRegionStatus&&this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.DirtyDouble));b&&transformChildTree(c);this._cacheDirty=!0},getNodeToParentTransform:function(){(!this._transform||this._dirtyFlag&cc.Node._dirtyFlags.transformDirty)&&this.transform();return this._transform},visit:function(a){var b=
this._node,c=cc.renderer;if(a=a||this.getParentRenderCmd())this._curLevel=a._curLevel+1;isNaN(b._customZ)&&(b._vertexZ=c.assignedZ,c.assignedZ+=c.assignedZStep);this._syncStatus(a)},_updateDisplayColor:function(a){var b=this._node,c=this._displayedColor,d=b._realColor,e;this._notifyRegionStatus&&this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty);if(this._cascadeColorEnabledDirty&&!b._cascadeColorEnabled){c.r=d.r;c.g=d.g;c.b=d.b;c=new cc.Color(255,255,255,255);a=b._children;b=0;for(d=
a.length;b<d;b++)(e=a[b])&&e._renderCmd&&e._renderCmd._updateDisplayColor(c);this._cascadeColorEnabledDirty=!1}else if(void 0===a&&(a=(a=b._parent)&&a._cascadeColorEnabled?a.getDisplayedColor():cc.color.WHITE),c.r=0|d.r*a.r/255,c.g=0|d.g*a.g/255,c.b=0|d.b*a.b/255,b._cascadeColorEnabled)for(a=b._children,b=0,d=a.length;b<d;b++)(e=a[b])&&e._renderCmd&&(e._renderCmd._updateDisplayColor(c),e._renderCmd._updateColor());this._dirtyFlag&=~dirtyFlags.colorDirty},_updateDisplayOpacity:function(a){var b=this._node,
c,d;this._notifyRegionStatus&&this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty);if(this._cascadeOpacityEnabledDirty&&!b._cascadeOpacityEnabled){this._displayedOpacity=b._realOpacity;c=b._children;a=0;for(b=c.length;a<b;a++)(d=c[a])&&d._renderCmd&&d._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else if(void 0===a&&(c=b._parent,a=255,c&&c._cascadeOpacityEnabled&&(a=c.getDisplayedOpacity())),this._displayedOpacity=b._realOpacity*a/255,b._cascadeOpacityEnabled)for(c=
b._children,a=0,b=c.length;a<b;a++)(d=c[a])&&d._renderCmd&&(d._renderCmd._updateDisplayOpacity(this._displayedOpacity),d._renderCmd._updateColor());this._dirtyFlag&=~dirtyFlags.opacityDirty},_syncDisplayColor:function(a){var b=this._node,c=this._displayedColor,d=b._realColor;void 0===a&&(a=(a=b._parent)&&a._cascadeColorEnabled?a.getDisplayedColor():cc.color.WHITE);c.r=0|d.r*a.r/255;c.g=0|d.g*a.g/255;c.b=0|d.b*a.b/255},_syncDisplayOpacity:function(a){var b=this._node;if(void 0===a){var c=b._parent;
a=255;c&&c._cascadeOpacityEnabled&&(a=c.getDisplayedOpacity())}this._displayedOpacity=b._realOpacity*a/255},_updateColor:function(){},_propagateFlagsDown:function(a){var b=this._dirtyFlag,c=a?a._node:null;c&&c._cascadeColorEnabled&&a._dirtyFlag&dirtyFlags.colorDirty&&(b|=dirtyFlags.colorDirty);c&&c._cascadeOpacityEnabled&&a._dirtyFlag&dirtyFlags.opacityDirty&&(b|=dirtyFlags.opacityDirty);a&&a._dirtyFlag&dirtyFlags.transformDirty&&(b|=dirtyFlags.transformDirty);this._dirtyFlag=b},updateStatus:function(){var a=
this._dirtyFlag,b=a&dirtyFlags.colorDirty,c=a&dirtyFlags.opacityDirty;a&dirtyFlags.contentDirty&&(this._notifyRegionStatus&&this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty),this._dirtyFlag&=~dirtyFlags.contentDirty);b&&this._updateDisplayColor();c&&this._updateDisplayOpacity();(b||c)&&this._updateColor();a&dirtyFlags.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag&=~dirtyFlags.transformDirty);a&dirtyFlags.orderDirty&&(this._dirtyFlag&=~dirtyFlags.orderDirty)},
_syncStatus:function(a){var b=this._dirtyFlag,c=a?a._node:null;c&&c._cascadeColorEnabled&&a._dirtyFlag&dirtyFlags.colorDirty&&(b|=dirtyFlags.colorDirty);c&&c._cascadeOpacityEnabled&&a._dirtyFlag&dirtyFlags.opacityDirty&&(b|=dirtyFlags.opacityDirty);a&&a._dirtyFlag&dirtyFlags.transformDirty&&(b|=dirtyFlags.transformDirty);this._dirtyFlag=b;var c=b&dirtyFlags.colorDirty,d=b&dirtyFlags.opacityDirty;c&&this._syncDisplayColor();d&&this._syncDisplayOpacity();(c||d)&&this._updateColor();b&dirtyFlags.transformDirty&&
this.transform(a);b&dirtyFlags.orderDirty&&(this._dirtyFlag&=~dirtyFlags.orderDirty)},setShaderProgram:function(a){},getShaderProgram:function(){return null},getGLProgramState:function(){return null},setGLProgramState:function(a){}};cc.Node.RenderCmd.prototype.originTransform=cc.Node.RenderCmd.prototype.transform;cc.Node.RenderCmd.prototype.originUpdateStatus=cc.Node.RenderCmd.prototype.updateStatus;cc.Node.RenderCmd.prototype._originSyncStatus=cc.Node.RenderCmd.prototype._syncStatus;
(function(){cc.Node.CanvasRenderCmd=function(a){this._node=a;this._anchorPointInPoints={x:0,y:0};this._displayedColor=cc.color(255,255,255,255);this._cachedParent=null;this._cacheDirty=!1;this._currentRegion=new cc.Region;this._oldRegion=new cc.Region;this._regionFlag=0;this._canUseDirtyRegion=!1};cc.Node.CanvasRenderCmd.RegionStatus={NotDirty:0,Dirty:1,DirtyDouble:2};var a=cc.Node.CanvasRenderCmd.prototype=Object.create(cc.Node.RenderCmd.prototype);a.constructor=cc.Node.CanvasRenderCmd;a._rootCtor=
cc.Node.CanvasRenderCmd;a._notifyRegionStatus=function(a){this._needDraw&&this._regionFlag<a&&(this._regionFlag=a)};var b=new cc.Rect;a.getLocalBB=function(){var a=this._node;b.x=b.y=0;b.width=a._contentSize.width;b.height=a._contentSize.height;return b};a._updateCurrentRegions=function(){var a=this._currentRegion;this._currentRegion=this._oldRegion;this._oldRegion=a;cc.Node.CanvasRenderCmd.RegionStatus.DirtyDouble!==this._regionFlag||this._currentRegion.isEmpty()||this._oldRegion.union(this._currentRegion);
this._currentRegion.updateRegion(this.getLocalBB(),this._worldTransform)};a.setDirtyFlag=function(a,b){cc.Node.RenderCmd.prototype.setDirtyFlag.call(this,a,b);this._setCacheDirty(b);this._cachedParent&&this._cachedParent.setDirtyFlag(a,!0)};a._setCacheDirty=function(){if(!1===this._cacheDirty){this._cacheDirty=!0;var a=this._cachedParent;a&&a!==this&&a._setNodeDirtyForCache&&a._setNodeDirtyForCache()}};a._setCachedParent=function(a){if(this._cachedParent!==a){this._cachedParent=a;for(var b=this._node._children,
e=0,f=b.length;e<f;e++)b[e]._renderCmd._setCachedParent(a)}};a.detachFromParent=function(){this._cachedParent=null;for(var a=this._node._children,b,e=0,f=a.length;e<f;e++)(b=a[e])&&b._renderCmd&&b._renderCmd.detachFromParent()};cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc=function(a){return a?a.src===cc.SRC_ALPHA&&a.dst===cc.ONE||a.src===cc.ONE&&a.dst===cc.ONE?"lighter":a.src===cc.ZERO&&a.dst===cc.SRC_ALPHA?"destination-in":a.src===cc.ZERO&&a.dst===cc.ONE_MINUS_SRC_ALPHA?"destination-out":
"source-over":"source-over"}})();(function(){cc.Node.WebGLRenderCmd=function(a){this._node=a;this._anchorPointInPoints={x:0,y:0};this._displayedColor=cc.color(255,255,255,255);this._glProgramState=null};var a=cc.Node.WebGLRenderCmd.prototype=Object.create(cc.Node.RenderCmd.prototype);a.constructor=cc.Node.WebGLRenderCmd;a._rootCtor=cc.Node.WebGLRenderCmd;a._updateColor=function(){};a.setShaderProgram=function(a){this._glProgramState=cc.GLProgramState.getOrCreateWithGLProgram(a)};a.getShaderProgram=function(){return this._glProgramState?
this._glProgramState.getGLProgram():null};a.getGLProgramState=function(){return this._glProgramState};a.setGLProgramState=function(a){this._glProgramState=a};Object.defineProperty(a,"_shaderProgram",{set:function(a){this.setShaderProgram(a)},get:function(){return this.getShaderProgram()}})})();cc.AtlasNode=cc.Node.extend({textureAtlas:null,quadsToDraw:0,_itemsPerRow:0,_itemsPerColumn:0,_itemWidth:0,_itemHeight:0,_opacityModifyRGB:!1,_blendFunc:null,_ignoreContentScaleFactor:!1,_className:"AtlasNode",_texture:null,_textureForCanvas:null,ctor:function(a,b,c,d){cc.Node.prototype.ctor.call(this);this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST};this._ignoreContentScaleFactor=!1;void 0!==d&&this.initWithTileFile(a,b,c,d)},_createRenderCmd:function(){this._renderCmd=cc._renderType===cc.game.RENDER_TYPE_CANVAS?
new cc.AtlasNode.CanvasRenderCmd(this):new cc.AtlasNode.WebGLRenderCmd(this)},updateAtlasValues:function(){cc.log(cc._LogInfos.AtlasNode_updateAtlasValues)},getColor:function(){return this._opacityModifyRGB?this._renderCmd._colorUnmodified:cc.Node.prototype.getColor.call(this)},setOpacityModifyRGB:function(a){var b=this.color;this._opacityModifyRGB=a;this.setColor(b)},isOpacityModifyRGB:function(){return this._opacityModifyRGB},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(a,
b){this._blendFunc=void 0===b?a:{src:a,dst:b}},setTextureAtlas:function(a){this.textureAtlas=a},getTextureAtlas:function(){return this.textureAtlas},getQuadsToDraw:function(){return this.quadsToDraw},setQuadsToDraw:function(a){this.quadsToDraw=a},initWithTileFile:function(a,b,c,d){if(!a)throw Error("cc.AtlasNode.initWithTileFile(): title should not be null");a=cc.textureCache.addImage(a);return this.initWithTexture(a,b,c,d)},initWithTexture:function(a,b,c,d){return this._renderCmd.initWithTexture(a,
b,c,d)},setColor:function(a){this._renderCmd.setColor(a)},setOpacity:function(a){this._renderCmd.setOpacity(a)},getTexture:function(){return this._texture},setTexture:function(a){this._texture=a},_setIgnoreContentScaleFactor:function(a){this._ignoreContentScaleFactor=a}});_p=cc.AtlasNode.prototype;cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity);cc.defineGetterSetter(_p,"color",_p.getColor,_p.setColor);cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture);cc.EventHelper.prototype.apply(_p);
cc.AtlasNode.create=function(a,b,c,d){return new cc.AtlasNode(a,b,c,d)};(function(){cc.AtlasNode.CanvasRenderCmd=function(a){this._rootCtor(a);this._needDraw=!1;this._colorUnmodified=cc.color.WHITE;this._textureToRender=null};var a=cc.AtlasNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);a.constructor=cc.AtlasNode.CanvasRenderCmd;a.initWithTexture=function(a,c,d,e){var f=this._node;f._itemWidth=c;f._itemHeight=d;f._opacityModifyRGB=!0;f._texture=a;if(!f._texture)return cc.log(cc._LogInfos.AtlasNode__initWithTexture),!1;this._textureToRender=
a;this._calculateMaxItems();f.quadsToDraw=e;return!0};a.setColor=function(a){var c=this._node._realColor;if(c.r!==a.r||c.g!==a.g||c.b!==a.b)this._colorUnmodified=a,this._changeTextureColor()};a._changeTextureColor=function(){var a=this._node._texture,c=this._colorUnmodified,d=a.getHtmlElementObj(),d=cc.rect(0,0,d.width,d.height);a===this._textureToRender?this._textureToRender=a._generateColorTexture(c.r,c.g,c.b,d):a._generateColorTexture(c.r,c.g,c.b,d,this._textureToRender.getHtmlElementObj())};a.setOpacity=
function(a){cc.Node.prototype.setOpacity.call(this._node,a)};a._calculateMaxItems=function(){var a=this._node,c=a._texture.getContentSize();a._itemsPerColumn=0|c.height/a._itemHeight;a._itemsPerRow=0|c.width/a._itemWidth}})();(function(){cc.AtlasNode.WebGLRenderCmd=function(a){this._rootCtor(a);this._needDraw=!0;this._textureAtlas=null;this._colorUnmodified=cc.color.WHITE;this._uniformColor=this._colorF32Array=null;this._matrix=new cc.math.Matrix4;this._matrix.identity();this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE_UCOLOR);this._uniformColor=cc._renderContext.getUniformLocation(this._shaderProgram.getProgram(),"u_color")};var a=cc.AtlasNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);
a.constructor=cc.AtlasNode.WebGLRenderCmd;a._updateBlendFunc=function(){var a=this._node;this._textureAtlas.texture.hasPremultipliedAlpha()||(a._blendFunc.src=cc.SRC_ALPHA,a._blendFunc.dst=cc.ONE_MINUS_SRC_ALPHA)};a._updateOpacityModifyRGB=function(){this._node._opacityModifyRGB=this._textureAtlas.texture.hasPremultipliedAlpha()};a.rendering=function(a){a=a||cc._renderContext;var c=this._node,d=this._worldTransform;this._matrix.mat[0]=d.a;this._matrix.mat[4]=d.c;this._matrix.mat[12]=d.tx;this._matrix.mat[1]=
d.b;this._matrix.mat[5]=d.d;this._matrix.mat[13]=d.ty;this._glProgramState.apply(this._matrix);cc.glBlendFunc(c._blendFunc.src,c._blendFunc.dst);this._uniformColor&&this._colorF32Array&&(a.uniform4fv(this._uniformColor,this._colorF32Array),this._textureAtlas.drawNumberOfQuads(c.quadsToDraw,0))};a.initWithTexture=function(a,c,d,e){var f=this._node;f._itemWidth=c;f._itemHeight=d;this._colorUnmodified=cc.color.WHITE;f._opacityModifyRGB=!0;f._blendFunc.src=cc.BLEND_SRC;f._blendFunc.dst=cc.BLEND_DST;c=
f._realColor;this._colorF32Array=new Float32Array([c.r/255,c.g/255,c.b/255,f._realOpacity/255]);this._textureAtlas=new cc.TextureAtlas;this._textureAtlas.initWithTexture(a,e);if(!this._textureAtlas)return cc.log(cc._LogInfos.AtlasNode__initWithTexture),!1;this._updateBlendFunc();this._updateOpacityModifyRGB();this._calculateMaxItems();f.quadsToDraw=e;return!0};a.setColor=function(a){var c=cc.color(a.r,a.g,a.b),d=this._node;this._colorUnmodified=a;a=this._displayedOpacity;d._opacityModifyRGB&&(c.r=
c.r*a/255,c.g=c.g*a/255,c.b=c.b*a/255);cc.Node.prototype.setColor.call(d,c)};a.setOpacity=function(a){var c=this._node;cc.Node.prototype.setOpacity.call(c,a);c._opacityModifyRGB&&(c.color=this._colorUnmodified)};a._updateColor=function(){if(this._colorF32Array){var a=this._displayedColor;this._colorF32Array[0]=a.r/255;this._colorF32Array[1]=a.g/255;this._colorF32Array[2]=a.b/255;this._colorF32Array[3]=this._displayedOpacity/255}};a.getTexture=function(){return this._textureAtlas.texture};a.setTexture=
function(a){this._textureAtlas.texture=a;this._updateBlendFunc();this._updateOpacityModifyRGB()};a._calculateMaxItems=function(){var a=this._node,c=this._textureAtlas.texture,d=c.getContentSize();a._ignoreContentScaleFactor&&(d=c.getContentSizeInPixels());a._itemsPerColumn=0|d.height/a._itemHeight;a._itemsPerRow=0|d.width/a._itemWidth}})();cc._tmp.WebGLTexture2D=function(){cc.Texture2D=cc.Class.extend({_pVRHaveAlphaPremultiplied:!0,_pixelFormat:null,_pixelsWide:0,_pixelsHigh:0,_name:"",_contentSize:null,maxS:0,maxT:0,_hasPremultipliedAlpha:!1,_hasMipmaps:!1,shaderProgram:null,_textureLoaded:!1,_htmlElementObj:null,_webTextureObj:null,url:null,ctor:function(){this._contentSize=cc.size(0,0);this._pixelFormat=cc.Texture2D.defaultPixelFormat},releaseTexture:function(){this._webTextureObj&&cc._renderContext.deleteTexture(this._webTextureObj);
this._htmlElementObj=null;cc.loader.release(this.url)},getPixelFormat:function(){return this._pixelFormat},getPixelsWide:function(){return this._pixelsWide},getPixelsHigh:function(){return this._pixelsHigh},getName:function(){return this._webTextureObj},getContentSize:function(){return cc.size(this._contentSize.width/cc.contentScaleFactor(),this._contentSize.height/cc.contentScaleFactor())},_getWidth:function(){return this._contentSize.width/cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/
cc.contentScaleFactor()},getContentSizeInPixels:function(){return this._contentSize},getMaxS:function(){return this.maxS},setMaxS:function(a){this.maxS=a},getMaxT:function(){return this.maxT},setMaxT:function(a){this.maxT=a},getShaderProgram:function(){return this.shaderProgram},setShaderProgram:function(a){this.shaderProgram=a},hasPremultipliedAlpha:function(){return this._hasPremultipliedAlpha},hasMipmaps:function(){return this._hasMipmaps},description:function(){return"\x3ccc.Texture2D | Name \x3d "+
this._name+" | Dimensions \x3d "+this._pixelsWide+" x "+this._pixelsHigh+" | Coordinates \x3d ("+this.maxS+", "+this.maxT+")\x3e"},releaseData:function(a){},keepData:function(a,b){return a},initWithData:function(a,b,c,d,e){var f=cc.Texture2D,g=cc._renderContext,h=g.RGBA,k=g.UNSIGNED_BYTE,m=c*cc.Texture2D._B[b]/8;0===m%8?g.pixelStorei(g.UNPACK_ALIGNMENT,8):0===m%4?g.pixelStorei(g.UNPACK_ALIGNMENT,4):0===m%2?g.pixelStorei(g.UNPACK_ALIGNMENT,2):g.pixelStorei(g.UNPACK_ALIGNMENT,1);this._webTextureObj=
g.createTexture();cc.glBindTexture2D(this);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE);switch(b){case f.PIXEL_FORMAT_RGBA8888:h=g.RGBA;break;case f.PIXEL_FORMAT_RGB888:h=g.RGB;break;case f.PIXEL_FORMAT_RGBA4444:k=g.UNSIGNED_SHORT_4_4_4_4;break;case f.PIXEL_FORMAT_RGB5A1:k=g.UNSIGNED_SHORT_5_5_5_1;break;
case f.PIXEL_FORMAT_RGB565:k=g.UNSIGNED_SHORT_5_6_5;break;case f.PIXEL_FORMAT_AI88:h=g.LUMINANCE_ALPHA;break;case f.PIXEL_FORMAT_A8:h=g.ALPHA;break;case f.PIXEL_FORMAT_I8:h=g.LUMINANCE;break;default:cc.assert(0,cc._LogInfos.Texture2D_initWithData)}g.texImage2D(g.TEXTURE_2D,0,h,c,d,0,h,k,a);this._contentSize.width=e.width;this._contentSize.height=e.height;this._pixelsWide=c;this._pixelsHigh=d;this._pixelFormat=b;this.maxS=e.width/c;this.maxT=e.height/d;this._hasMipmaps=this._hasPremultipliedAlpha=
!1;this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE);return this._textureLoaded=!0},drawAtPoint:function(a){var b=[0,this.maxT,this.maxS,this.maxT,0,0,this.maxS,0],c=cc._renderContext,d=this._pixelsWide*this.maxS,e=this._pixelsHigh*this.maxT;a=[a.x,a.y,0,d+a.x,a.y,0,a.x,e+a.y,0,d+a.x,e+a.y,0];this._glProgramState.apply();this._glProgramState._glprogram.setUniformsForBuiltins();cc.glBindTexture2D(this);c.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);c.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS);
c.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,c.FLOAT,!1,0,a);c.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,c.FLOAT,!1,0,b);c.drawArrays(c.TRIANGLE_STRIP,0,4)},drawInRect:function(a){var b=[0,this.maxT,this.maxS,this.maxT,0,0,this.maxS,0];a=[a.x,a.y,a.x+a.width,a.y,a.x,a.y+a.height,a.x+a.width,a.y+a.height];this._glProgramState.apply();this._glProgramState._glprogram.setUniformsForBuiltins();cc.glBindTexture2D(this);var c=cc._renderContext;c.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);
c.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS);c.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,c.FLOAT,!1,0,a);c.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,c.FLOAT,!1,0,b);c.drawArrays(c.TRIANGLE_STRIP,0,4)},initWithImage:function(a){if(null==a)return cc.log(cc._LogInfos.Texture2D_initWithImage),!1;var b=a.getWidth(),c=a.getHeight(),d=cc.configuration.getMaxTextureSize();if(b>d||c>d)return cc.log(cc._LogInfos.Texture2D_initWithImage_2,b,c,d,d),!1;this._textureLoaded=!0;return this._initPremultipliedATextureWithImage(a,
b,c)},initWithElement:function(a){a&&(this._webTextureObj||(this._webTextureObj=cc._renderContext.createTexture()),this._htmlElementObj=a,this._hasPremultipliedAlpha=this._textureLoaded=!0)},getHtmlElementObj:function(){return this._htmlElementObj},isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(a){a=void 0!==a?a:this._hasPremultipliedAlpha;if(cc.game._rendererInitialized&&this._htmlElementObj&&this._htmlElementObj.width&&this._htmlElementObj.height){var b=cc._renderContext;
cc.glBindTexture2D(this);b.pixelStorei(b.UNPACK_ALIGNMENT,4);a&&b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,this._htmlElementObj);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE);
cc.glBindTexture2D(null);a&&b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0);b=this._htmlElementObj.height;this._pixelsWide=this._contentSize.width=this._htmlElementObj.width;this._pixelsHigh=this._contentSize.height=b;this._pixelFormat=cc.Texture2D.PIXEL_FORMAT_RGBA8888;this.maxT=this.maxS=1;this._hasPremultipliedAlpha=a;this._hasMipmaps=!1;ENABLE_IMAEG_POOL&&(this._htmlElementObj=null);this.dispatchEvent("load")}},initWithString:function(a,b,c,d,e,f){cc.log(cc._LogInfos.Texture2D_initWithString);
return null},initWithETCFile:function(a){cc.log(cc._LogInfos.Texture2D_initWithETCFile_2);return!1},initWithPVRFile:function(a){cc.log(cc._LogInfos.Texture2D_initWithPVRFile_2);return!1},initWithPVRTCData:function(a,b,c,d,e,f){cc.log(cc._LogInfos.Texture2D_initWithPVRTCData_2);return!1},setTexParameters:function(a,b,c,d){var e=cc._renderContext;void 0!==b&&(a={minFilter:a,magFilter:b,wrapS:c,wrapT:d});cc.assert(this._pixelsWide===cc.NextPOT(this._pixelsWide)&&this._pixelsHigh===cc.NextPOT(this._pixelsHigh)||
a.wrapS===e.CLAMP_TO_EDGE&&a.wrapT===e.CLAMP_TO_EDGE,"WebGLRenderingContext.CLAMP_TO_EDGE should be used in NPOT textures");cc.glBindTexture2D(this);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,a.minFilter);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,a.magFilter);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,a.wrapS);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,a.wrapT)},setAntiAliasTexParameters:function(){var a=cc._renderContext;cc.glBindTexture2D(this);this._hasMipmaps?a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_NEAREST):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR)},setAliasTexParameters:function(){var a=cc._renderContext;cc.glBindTexture2D(this);this._hasMipmaps?a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST_MIPMAP_NEAREST):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST)},generateMipmap:function(){cc.assert(this._pixelsWide===
cc.NextPOT(this._pixelsWide)&&this._pixelsHigh===cc.NextPOT(this._pixelsHigh),"Mimpap texture only works in POT textures");cc.glBindTexture2D(this);cc._renderContext.generateMipmap(cc._renderContext.TEXTURE_2D);this._hasMipmaps=!0},stringForFormat:function(){return cc.Texture2D._M[this._pixelFormat]},bitsPerPixelForFormat:function(a){a=a||this._pixelFormat;var b=cc.Texture2D._B[a];if(null!=b)return b;cc.log(cc._LogInfos.Texture2D_bitsPerPixelForFormat,a);return-1},_initPremultipliedATextureWithImage:function(a,
b,c){var d=cc.Texture2D,e=a.getData(),f=null,f=null,g=a.hasAlpha(),h=cc.size(a.getWidth(),a.getHeight()),k=d.defaultPixelFormat,m=a.getBitsPerComponent();g||(8<=m?k=d.PIXEL_FORMAT_RGB888:(cc.log(cc._LogInfos.Texture2D__initPremultipliedATextureWithImage),k=d.PIXEL_FORMAT_RGB565));var n=b*c;if(k===d.PIXEL_FORMAT_RGB565)if(g)for(e=new Uint16Array(b*c),f=a.getData(),m=0;m<n;++m)e[m]=(f[m]>>0&255)>>3<<11|(f[m]>>8&255)>>2<<5|(f[m]>>16&255)>>3<<0;else for(e=new Uint16Array(b*c),f=a.getData(),m=0;m<n;++m)e[m]=
(f[m]&255)>>3<<11|(f[m]&255)>>2<<5|(f[m]&255)>>3<<0;else if(k===d.PIXEL_FORMAT_RGBA4444)for(e=new Uint16Array(b*c),f=a.getData(),m=0;m<n;++m)e[m]=(f[m]>>0&255)>>4<<12|(f[m]>>8&255)>>4<<8|(f[m]>>16&255)>>4<<4|(f[m]>>24&255)>>4<<0;else if(k===d.PIXEL_FORMAT_RGB5A1)for(e=new Uint16Array(b*c),f=a.getData(),m=0;m<n;++m)e[m]=(f[m]>>0&255)>>3<<11|(f[m]>>8&255)>>3<<6|(f[m]>>16&255)>>3<<1|(f[m]>>24&255)>>7<<0;else if(k===d.PIXEL_FORMAT_A8)for(e=new Uint8Array(b*c),f=a.getData(),m=0;m<n;++m)e[m]=f>>24&255;
if(g&&k===d.PIXEL_FORMAT_RGB888)for(f=a.getData(),e=new Uint8Array(b*c*3),m=0;m<n;++m)e[3*m]=f>>0&255,e[3*m+1]=f>>8&255,e[3*m+2]=f>>16&255;this.initWithData(e,k,b,c,h);a.getData();this._hasPremultipliedAlpha=a.isPremultipliedAlpha();return!0},addLoadedEventListener:function(a,b){this.addEventListener("load",a,b)},removeLoadedEventListener:function(a){this.removeEventTarget("load",a)}})};
cc._tmp.WebGLTextureAtlas=function(){var a=cc.TextureAtlas.prototype;a._setupVBO=function(){var a=cc._renderContext;this._buffersVBO[0]=a.createBuffer();this._buffersVBO[1]=a.createBuffer();this._quadsWebBuffer=a.createBuffer();this._mapBuffers()};a._mapBuffers=function(){var a=cc._renderContext;a.bindBuffer(a.ARRAY_BUFFER,this._quadsWebBuffer);a.bufferData(a.ARRAY_BUFFER,this._quadsArrayBuffer,a.DYNAMIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]);a.bufferData(a.ELEMENT_ARRAY_BUFFER,
this._indices,a.STATIC_DRAW)};a.drawNumberOfQuads=function(a,c){c=c||0;if(0!==a&&this.texture&&this.texture.isLoaded()){var d=cc._renderContext;cc.glBindTexture2D(this.texture);d.bindBuffer(d.ARRAY_BUFFER,this._quadsWebBuffer);this.dirty&&(d.bufferData(d.ARRAY_BUFFER,this._quadsArrayBuffer,d.DYNAMIC_DRAW),this.dirty=!1);d.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);d.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR);d.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS);d.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,
3,d.FLOAT,!1,24,0);d.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,d.UNSIGNED_BYTE,!0,24,12);d.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,d.FLOAT,!1,24,16);d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]);cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?d.drawElements(d.TRIANGLE_STRIP,6*a,d.UNSIGNED_SHORT,6*c*this._indices.BYTES_PER_ELEMENT):d.drawElements(d.TRIANGLES,6*a,d.UNSIGNED_SHORT,6*c*this._indices.BYTES_PER_ELEMENT);cc.g_NumberOfDraws++}}};
cc._tmp.WebGLTextureCache=function(){var a=cc.textureCache;a.handleLoadedTexture=function(a,c){var d=this._textures,e;cc.game._rendererInitialized||(d=this._loadedTexturesBefore);e=d[a];e||(e=d[a]=new cc.Texture2D,e.url=a);e.initWithElement(c);".png"===cc.path.extname(a)?e.handleLoadedTexture(!0):e.handleLoadedTexture();return e};a.addImage=function(a,c,d){cc.assert(a,cc._LogInfos.Texture2D_addImage_2);var e=this._textures;cc.game._rendererInitialized||(e=this._loadedTexturesBefore);var f=e[a]||e[cc.loader._getAliase(a)];
if(f)return f.isLoaded()?c&&c.call(d,f):f.addEventListener("load",function(){c&&c.call(d,f)},d),f;f=e[a]=new cc.Texture2D;f.url=a;e=cc.loader.getBasePath?cc.loader.getBasePath():cc.loader.resPath;cc.loader.loadImg(cc.path.join(e||"",a),function(e,f){if(e)return c&&c.call(d,e);var k=cc.textureCache.handleLoadedTexture(a,f);c&&c.call(d,k)});return f};a.addImageAsync=a.addImage;a=null};cc._tmp.PrototypeTexture2D=function(){var a=cc.Texture2D;a.PVRImagesHavePremultipliedAlpha=function(a){cc.PVRHaveAlphaPremultiplied_=a};a.PIXEL_FORMAT_RGBA8888=2;a.PIXEL_FORMAT_RGB888=3;a.PIXEL_FORMAT_RGB565=4;a.PIXEL_FORMAT_A8=5;a.PIXEL_FORMAT_I8=6;a.PIXEL_FORMAT_AI88=7;a.PIXEL_FORMAT_RGBA4444=8;a.PIXEL_FORMAT_RGB5A1=7;a.PIXEL_FORMAT_PVRTC4=9;a.PIXEL_FORMAT_PVRTC2=10;a.PIXEL_FORMAT_DEFAULT=a.PIXEL_FORMAT_RGBA8888;a.defaultPixelFormat=a.PIXEL_FORMAT_DEFAULT;var b=cc.Texture2D._M={};b[a.PIXEL_FORMAT_RGBA8888]=
"RGBA8888";b[a.PIXEL_FORMAT_RGB888]="RGB888";b[a.PIXEL_FORMAT_RGB565]="RGB565";b[a.PIXEL_FORMAT_A8]="A8";b[a.PIXEL_FORMAT_I8]="I8";b[a.PIXEL_FORMAT_AI88]="AI88";b[a.PIXEL_FORMAT_RGBA4444]="RGBA4444";b[a.PIXEL_FORMAT_RGB5A1]="RGB5A1";b[a.PIXEL_FORMAT_PVRTC4]="PVRTC4";b[a.PIXEL_FORMAT_PVRTC2]="PVRTC2";b=cc.Texture2D._B={};b[a.PIXEL_FORMAT_RGBA8888]=32;b[a.PIXEL_FORMAT_RGB888]=24;b[a.PIXEL_FORMAT_RGB565]=16;b[a.PIXEL_FORMAT_A8]=8;b[a.PIXEL_FORMAT_I8]=8;b[a.PIXEL_FORMAT_AI88]=16;b[a.PIXEL_FORMAT_RGBA4444]=
16;b[a.PIXEL_FORMAT_RGB5A1]=16;b[a.PIXEL_FORMAT_PVRTC4]=4;b[a.PIXEL_FORMAT_PVRTC2]=3;a=cc.Texture2D.prototype;cc.defineGetterSetter(a,"name",a.getName);cc.defineGetterSetter(a,"pixelFormat",a.getPixelFormat);cc.defineGetterSetter(a,"pixelsWidth",a.getPixelsWide);cc.defineGetterSetter(a,"pixelsHeight",a.getPixelsHigh);cc.defineGetterSetter(a,"width",a._getWidth);cc.defineGetterSetter(a,"height",a._getHeight)};
cc._tmp.PrototypeTextureAtlas=function(){var a=cc.TextureAtlas.prototype;cc.defineGetterSetter(a,"totalQuads",a.getTotalQuads);cc.defineGetterSetter(a,"capacity",a.getCapacity);cc.defineGetterSetter(a,"quads",a.getQuads,a.setQuads)};cc.ALIGN_CENTER=51;cc.ALIGN_TOP=19;cc.ALIGN_TOP_RIGHT=18;cc.ALIGN_RIGHT=50;cc.ALIGN_BOTTOM_RIGHT=34;cc.ALIGN_BOTTOM=35;cc.ALIGN_BOTTOM_LEFT=33;cc.ALIGN_LEFT=49;cc.ALIGN_TOP_LEFT=17;cc.PVRHaveAlphaPremultiplied_=!1;
cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var a={_contentSize:null,_textureLoaded:!1,_htmlElementObj:null,url:null,_pattern:null,ctor:function(){this._contentSize=cc.size(0,0);this._textureLoaded=!1;this._htmlElementObj=null;this._pattern="";this._pixelsHigh=this._pixelsWide=0},getPixelsWide:function(){return this._pixelsWide},getPixelsHigh:function(){return this._pixelsHigh},getContentSize:function(){var a=cc.contentScaleFactor();
return cc.size(this._contentSize.width/a,this._contentSize.height/a)},_getWidth:function(){return this._contentSize.width/cc.contentScaleFactor()},_getHeight:function(){return this._contentSize.height/cc.contentScaleFactor()},getContentSizeInPixels:function(){return this._contentSize},initWithElement:function(a){a&&(this._htmlElementObj=a,this._pixelsWide=this._contentSize.width=a.width,this._pixelsHigh=this._contentSize.height=a.height,this._textureLoaded=!0)},getHtmlElementObj:function(){return this._htmlElementObj},
isLoaded:function(){return this._textureLoaded},handleLoadedTexture:function(){if(this._htmlElementObj){var a=this._htmlElementObj;this._pixelsWide=this._contentSize.width=a.width;this._pixelsHigh=this._contentSize.height=a.height;this.dispatchEvent("load")}},description:function(){return"\x3ccc.Texture2D | width \x3d "+this._contentSize.width+" height "+this._contentSize.height+"\x3e"},initWithData:function(a,c,d,e,f){return!1},initWithImage:function(a){return!1},initWithString:function(a,c,d,e,
f,g){return!1},releaseTexture:function(){this._htmlElementObj=null;cc.loader.release(this.url)},getName:function(){return null},getMaxS:function(){return 1},setMaxS:function(a){},getMaxT:function(){return 1},setMaxT:function(a){},getPixelFormat:function(){return null},getShaderProgram:function(){return null},setShaderProgram:function(a){},hasPremultipliedAlpha:function(){return!1},hasMipmaps:function(){return!1},releaseData:function(a){},keepData:function(a,c){return a},drawAtPoint:function(a){},
drawInRect:function(a){},initWithETCFile:function(a){cc.log(cc._LogInfos.Texture2D_initWithETCFile);return!1},initWithPVRFile:function(a){cc.log(cc._LogInfos.Texture2D_initWithPVRFile);return!1},initWithPVRTCData:function(a,c,d,e,f,g){cc.log(cc._LogInfos.Texture2D_initWithPVRTCData);return!1},setTexParameters:function(a,c,d,e){void 0!==c&&(a={minFilter:a,magFilter:c,wrapS:d,wrapT:e});this._pattern=a.wrapS===cc.REPEAT&&a.wrapT===cc.REPEAT?"repeat":a.wrapS===cc.REPEAT?"repeat-x":a.wrapT===cc.REPEAT?
"repeat-y":""},setAntiAliasTexParameters:function(){},setAliasTexParameters:function(){},generateMipmap:function(){},stringForFormat:function(){return""},bitsPerPixelForFormat:function(a){return-1},addLoadedEventListener:function(a,c){this.addEventListener("load",a,c)},removeLoadedEventListener:function(a){this.removeEventTarget("load",a)},_generateColorTexture:function(){},_generateTextureCacheForColor:function(){if(this.channelCache)return this.channelCache;var a=[document.createElement("canvas"),
document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas")],c=this._htmlElementObj,d=c.width,e=c.height;a[0].width=d;a[0].height=e;a[1].width=d;a[1].height=e;a[2].width=d;a[2].height=e;a[3].width=d;a[3].height=e;var f=a[3].getContext("2d");f.drawImage(c,0,0);for(var f=f.getImageData(0,0,d,e).data,g,h=0;4>h;h++){g=a[h].getContext("2d");for(var k=g.getImageData(0,0,d,e),m=k.data,n=0;n<f.length;n+=4)m[n]=0===h?f[n]:0,m[n+1]=1===h?f[n+1]:0,m[n+2]=2===h?f[n+2]:0,
m[n+3]=f[n+3];g.putImageData(k,0,0)}c.onload=null;return this.channelCache=a},_grayElementObj:null,_backupElement:null,_isGray:!1,_switchToGray:function(a){this._textureLoaded&&this._isGray!==a&&((this._isGray=a)?(this._backupElement=this._htmlElementObj,this._grayElementObj||(this._grayElementObj=cc.Texture2D._generateGrayTexture(this._htmlElementObj)),this._htmlElementObj=this._grayElementObj):null!==this._backupElement&&(this._htmlElementObj=this._backupElement))},_generateGrayTexture:function(){if(!this._textureLoaded)return null;
var a=cc.Texture2D._generateGrayTexture(this._htmlElementObj),c=new cc.Texture2D;c.initWithElement(a);c.handleLoadedTexture();return c}};a._generateColorTexture=cc.sys._supportCanvasNewBlendModes?function(a,c,d,e,f){var g=!1;f?g=!0:f=document.createElement("canvas");var h=this._htmlElementObj;e||(e=cc.rect(0,0,h.width,h.height));f.width=e.width;f.height=e.height;var k=f.getContext("2d");k.globalCompositeOperation="source-over";k.fillStyle="rgb("+(a|0)+","+(c|0)+","+(d|0)+")";k.fillRect(0,0,e.width,
e.height);k.globalCompositeOperation="multiply";k.drawImage(h,e.x,e.y,e.width,e.height,0,0,e.width,e.height);k.globalCompositeOperation="destination-atop";k.drawImage(h,e.x,e.y,e.width,e.height,0,0,e.width,e.height);if(g)return f;a=new cc.Texture2D;a.initWithElement(f);a.handleLoadedTexture();return a}:function(a,c,d,e,f){var g=!1;f?g=!0:f=document.createElement("canvas");var h=this._htmlElementObj;e||(e=cc.rect(0,0,h.width,h.height));var k,m,h=e.x;k=e.y;m=e.width;e=e.height;if(m&&e){f.width=m;f.height=
e;var n=f.getContext("2d"),p=cc.textureCache.getTextureColors(this);n.globalCompositeOperation="lighter";n.drawImage(p[3],h,k,m,e,0,0,m,e);0<a&&(n.globalAlpha=a/255,n.drawImage(p[0],h,k,m,e,0,0,m,e));0<c&&(n.globalAlpha=c/255,n.drawImage(p[1],h,k,m,e,0,0,m,e));0<d&&(n.globalAlpha=d/255,n.drawImage(p[2],h,k,m,e,0,0,m,e));if(g)return f;a=new cc.Texture2D;a.initWithElement(f);a.handleLoadedTexture();return a}};cc.Texture2D=cc.Class.extend(a);cc.Texture2D._generateGrayTexture=function(a,c,d){if(null===
a)return null;d=d||document.createElement("canvas");c=c||cc.rect(0,0,a.width,a.height);d.width=c.width;d.height=c.height;var e=d.getContext("2d");e.drawImage(a,c.x,c.y,c.width,c.height,0,0,c.width,c.height);a=e.getImageData(0,0,c.width,c.height);c=a.data;for(var f=0,g=c.length;f<g;f+=4)c[f]=c[f+1]=c[f+2]=0.34*c[f]+0.5*c[f+1]+0.16*c[f+2];e.putImageData(a,0,0);return d}}else cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc.assert(cc.isFunction(cc._tmp.WebGLTexture2D),cc._LogInfos.MissingFile,"TexturesWebGL.js"),
cc._tmp.WebGLTexture2D(),delete cc._tmp.WebGLTexture2D);cc.EventHelper.prototype.apply(cc.Texture2D.prototype);cc.assert(cc.isFunction(cc._tmp.PrototypeTexture2D),cc._LogInfos.MissingFile,"TexturesPropertyDefine.js");cc._tmp.PrototypeTexture2D();delete cc._tmp.PrototypeTexture2D});cc.textureCache={_textures:{},_textureColorsCache:{},_textureKeySeq:0|1E3*Math.random(),_loadedTexturesBefore:{},_initializingRenderer:function(){var a,b=this._loadedTexturesBefore,c=this._textures;for(a in b){var d=b[a];d.handleLoadedTexture();c[a]=d}this._loadedTexturesBefore={}},addPVRTCImage:function(a){cc.log(cc._LogInfos.textureCache_addPVRTCImage)},addETCImage:function(a){cc.log(cc._LogInfos.textureCache_addETCImage)},description:function(){return"\x3cTextureCache | Number of textures \x3d "+
this._textures.length+"\x3e"},textureForKey:function(a){cc.log(cc._LogInfos.textureCache_textureForKey);return this.getTextureForKey(a)},getTextureForKey:function(a){return this._textures[a]||this._textures[cc.loader._getAliase(a)]},getKeyByTexture:function(a){for(var b in this._textures)if(this._textures[b]===a)return b;return null},_generalTextureKey:function(a){return"_textureKey_"+a},getTextureColors:function(a){var b=a._htmlElementObj,c=this.getKeyByTexture(b);c||(c=b instanceof HTMLImageElement?
b.src:this._generalTextureKey(a.__instanceId));this._textureColorsCache[c]||(this._textureColorsCache[c]=a._generateTextureCacheForColor());return this._textureColorsCache[c]},addPVRImage:function(a){cc.log(cc._LogInfos.textureCache_addPVRImage)},removeAllTextures:function(){var a=this._textures,b;for(b in a)a[b]&&a[b].releaseTexture();this._textures={}},removeTexture:function(a){if(a){var b=this._textures,c;for(c in b)b[c]===a&&(b[c].releaseTexture(),delete b[c])}},removeTextureForKey:function(a){if(null!=
a){var b=this._textures[a];b&&(b.releaseTexture(),delete this._textures[a])}},cacheImage:function(a,b){if(b instanceof cc.Texture2D)this._textures[a]=b;else{var c=new cc.Texture2D;c.initWithElement(b);c.handleLoadedTexture();this._textures[a]=c}},addUIImage:function(a,b){cc.assert(a,cc._LogInfos.textureCache_addUIImage_2);if(b&&this._textures[b])return this._textures[b];var c=new cc.Texture2D;c.initWithImage(a);null!=b?this._textures[b]=c:cc.log(cc._LogInfos.textureCache_addUIImage);return c},dumpCachedTextureInfo:function(){var a=
0,b=0,c=this._textures,d;for(d in c){var e=c[d];a++;e.getHtmlElementObj()instanceof HTMLImageElement?cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo,d,e.getHtmlElementObj().src,e.getPixelsWide(),e.getPixelsHigh()):cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_2,d,e.getPixelsWide(),e.getPixelsHigh());b+=e.getPixelsWide()*e.getPixelsHigh()*4}c=this._textureColorsCache;for(d in c){var e=c[d],f;for(f in e){var g=e[f];a++;cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_2,d,g.width,
g.height);b+=g.width*g.height*4}}cc.log(cc._LogInfos.textureCache_dumpCachedTextureInfo_3,a,b/1024,(b/1048576).toFixed(2))},_clear:function(){this._textures={};this._textureColorsCache={};this._textureKeySeq=0|1E3*Math.random();this._loadedTexturesBefore={}}};
cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var a=cc.textureCache;a.handleLoadedTexture=function(a,c){var d=this._textures,e=d[a];e||(e=d[a]=new cc.Texture2D,e.url=a);e.initWithElement(c);e.handleLoadedTexture();return e};a.addImage=function(a,c,d){cc.assert(a,cc._LogInfos.Texture2D_addImage);var e=this._textures,f=e[a]||e[cc.loader._getAliase(a)];if(f)return f.isLoaded()?c&&c.call(d,f):f.addEventListener("load",function(){c&&c.call(d,
f)},d),f;f=e[a]=new cc.Texture2D;f.url=a;e=cc.loader.getBasePath?cc.loader.getBasePath():cc.loader.resPath;cc.loader.loadImg(cc.path.join(e||"",a),function(e,f){if(e)return c&&c.call(d,e);var k=cc.textureCache.handleLoadedTexture(a,f);c&&c.call(d,k)});return f};a.addImageAsync=a.addImage;a=null}else cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc.assert(cc.isFunction(cc._tmp.WebGLTextureCache),cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTextureCache(),delete cc._tmp.WebGLTextureCache)});cc.TextureAtlas=cc.Class.extend({dirty:!1,texture:null,_indices:null,_buffersVBO:null,_capacity:0,_quads:null,_quadsArrayBuffer:null,_quadsWebBuffer:null,_quadsReader:null,ctor:function(a,b){this._buffersVBO=[];cc.isString(a)?this.initWithFile(a,b):a instanceof cc.Texture2D&&this.initWithTexture(a,b)},getTotalQuads:function(){return this._totalQuads},getCapacity:function(){return this._capacity},getTexture:function(){return this.texture},setTexture:function(a){this.texture=a},setDirty:function(a){this.dirty=
a},isDirty:function(){return this.dirty},getQuads:function(){return this._quads},setQuads:function(a){this._quads=a},_copyQuadsToTextureAtlas:function(a,b){if(a)for(var c=0;c<a.length;c++)this._setQuadToArray(a[c],b+c)},_setQuadToArray:function(a,b){var c=this._quads;c[b]?(c[b].bl=a.bl,c[b].br=a.br,c[b].tl=a.tl,c[b].tr=a.tr):c[b]=new cc.V3F_C4B_T2F_Quad(a.tl,a.bl,a.tr,a.br,this._quadsArrayBuffer,b*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT)},description:function(){return"\x3ccc.TextureAtlas | totalQuads \x3d"+
this._totalQuads+"\x3e"},_setupIndices:function(){if(0!==this._capacity)for(var a=this._indices,b=this._capacity,c=0;c<b;c++)cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP?(a[6*c+0]=4*c+0,a[6*c+1]=4*c+0,a[6*c+2]=4*c+2,a[6*c+3]=4*c+1,a[6*c+4]=4*c+3,a[6*c+5]=4*c+3):(a[6*c+0]=4*c+0,a[6*c+1]=4*c+1,a[6*c+2]=4*c+2,a[6*c+3]=4*c+3,a[6*c+4]=4*c+2,a[6*c+5]=4*c+1)},_setupVBO:function(){var a=cc._renderContext;this._buffersVBO[0]=a.createBuffer();this._buffersVBO[1]=a.createBuffer();this._quadsWebBuffer=a.createBuffer();
this._mapBuffers()},_mapBuffers:function(){var a=cc._renderContext;a.bindBuffer(a.ARRAY_BUFFER,this._quadsWebBuffer);a.bufferData(a.ARRAY_BUFFER,this._quadsArrayBuffer,a.DYNAMIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this._indices,a.STATIC_DRAW)},initWithFile:function(a,b){var c=cc.textureCache.addImage(a);if(c)return this.initWithTexture(c,b);cc.log(cc._LogInfos.TextureAtlas_initWithFile,a);return!1},initWithTexture:function(a,b){cc.assert(a,
cc._LogInfos.TextureAtlas_initWithTexture);this._capacity=b|=0;this._totalQuads=0;this.texture=a;this._quads=[];this._indices=new Uint16Array(6*b);var c=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._quadsArrayBuffer=new ArrayBuffer(c*b);this._quadsReader=new Uint8Array(this._quadsArrayBuffer);if((!this._quads||!this._indices)&&0<b)return!1;for(var d=this._quads,e=0;e<b;e++)d[e]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,e*c);this._setupIndices();this._setupVBO();return this.dirty=
!0},updateQuad:function(a,b){cc.assert(a,cc._LogInfos.TextureAtlas_updateQuad);cc.assert(0<=b&&b<this._capacity,cc._LogInfos.TextureAtlas_updateQuad_2);this._totalQuads=Math.max(b+1,this._totalQuads);this._setQuadToArray(a,b);this.dirty=!0},insertQuad:function(a,b){cc.assert(b<this._capacity,cc._LogInfos.TextureAtlas_insertQuad_2);this._totalQuads++;if(this._totalQuads>this._capacity)cc.log(cc._LogInfos.TextureAtlas_insertQuad);else{var c=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,d=b*c,e=(this._totalQuads-
1-b)*c;this._quads[this._totalQuads-1]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*c);this._quadsReader.set(this._quadsReader.subarray(d,d+e),d+c);this._setQuadToArray(a,b);this.dirty=!0}},insertQuads:function(a,b,c){c=c||a.length;cc.assert(b+c<=this._capacity,cc._LogInfos.TextureAtlas_insertQuads);var d=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._totalQuads+=c;if(this._totalQuads>this._capacity)cc.log(cc._LogInfos.TextureAtlas_insertQuad);else{var e=b*
d,f=(this._totalQuads-1-b-c)*d,g=this._totalQuads-1-c,h;for(h=0;h<c;h++)this._quads[g+h]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,(this._totalQuads-1)*d);this._quadsReader.set(this._quadsReader.subarray(e,e+f),e+d*c);for(h=0;h<c;h++)this._setQuadToArray(a[h],b+h);this.dirty=!0}},insertQuadFromIndex:function(a,b){if(a!==b){cc.assert(0<=b||b<this._totalQuads,cc._LogInfos.TextureAtlas_insertQuadFromIndex);cc.assert(0<=a||a<this._totalQuads,cc._LogInfos.TextureAtlas_insertQuadFromIndex_2);
var c=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,d=this._quadsReader,e=d.subarray(a*c,c),f;a>b?(f=b*c,d.set(d.subarray(f,f+(a-b)*c),f+c),d.set(e,f)):(f=(a+1)*c,d.set(d.subarray(f,f+(b-a)*c),f-c),d.set(e,b*c));this.dirty=!0}},removeQuadAtIndex:function(a){cc.assert(a<this._totalQuads,cc._LogInfos.TextureAtlas_removeQuadAtIndex);var b=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._totalQuads--;this._quads.length=this._totalQuads;if(a!==this._totalQuads){var c=(a+1)*b;this._quadsReader.set(this._quadsReader.subarray(c,
c+(this._totalQuads-a)*b),c-b)}this.dirty=!0},removeQuadsAtIndex:function(a,b){cc.assert(a+b<=this._totalQuads,cc._LogInfos.TextureAtlas_removeQuadsAtIndex);this._totalQuads-=b;if(a!==this._totalQuads){var c=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,d=(a+b)*c,e=a*c;this._quadsReader.set(this._quadsReader.subarray(d,d+(this._totalQuads-a)*c),e)}this.dirty=!0},removeAllQuads:function(){this._totalQuads=this._quads.length=0},_setDirty:function(a){this.dirty=a},resizeCapacity:function(a){if(a===this._capacity)return!0;
var b=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,c=this._capacity;this._totalQuads=Math.min(this._totalQuads,a);var d=this._capacity=0|a,e=this._totalQuads;if(null===this._quads)for(this._quads=[],this._quadsArrayBuffer=new ArrayBuffer(b*d),this._quadsReader=new Uint8Array(this._quadsArrayBuffer),a=0;a<d;a++)this._quads=new cc.V3F_C4B_T2F_Quad(null,null,null,null,this._quadsArrayBuffer,a*b);else{var f,g,h=this._quads;if(d>c){f=[];g=new ArrayBuffer(b*d);for(a=0;a<e;a++)f[a]=new cc.V3F_C4B_T2F_Quad(h[a].tl,
h[a].bl,h[a].tr,h[a].br,g,a*b);for(;a<d;a++)f[a]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,g,a*b)}else for(e=Math.max(e,d),f=[],g=new ArrayBuffer(b*d),a=0;a<e;a++)f[a]=new cc.V3F_C4B_T2F_Quad(h[a].tl,h[a].bl,h[a].tr,h[a].br,g,a*b);this._quadsReader=new Uint8Array(g);this._quads=f;this._quadsArrayBuffer=g}null===this._indices?this._indices=new Uint16Array(6*d):d>c?(b=new Uint16Array(6*d),b.set(this._indices,0),this._indices=b):this._indices=this._indices.subarray(0,6*d);this._setupIndices();this._mapBuffers();
return this.dirty=!0},increaseTotalQuadsWith:function(a){this._totalQuads+=a},moveQuadsFromIndex:function(a,b,c){if(void 0===c){if(c=b,b=this._totalQuads-a,cc.assert(c+(this._totalQuads-a)<=this._capacity,cc._LogInfos.TextureAtlas_moveQuadsFromIndex),0===b)return}else if(cc.assert(c+b<=this._totalQuads,cc._LogInfos.TextureAtlas_moveQuadsFromIndex_2),cc.assert(a<this._totalQuads,cc._LogInfos.TextureAtlas_moveQuadsFromIndex_3),a===c)return;var d=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,e=a*d,f=b*d,g=this._quadsReader,
h=g.subarray(e,e+f),k=c*d;c<a?(b=c*d,g.set(g.subarray(b,b+(a-c)*d),b+f)):(b=(a+b)*d,g.set(g.subarray(b,b+(c-a)*d),e));g.set(h,k);this.dirty=!0},fillWithEmptyQuadsFromIndex:function(a,b){for(var c=b*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,d=new Uint8Array(this._quadsArrayBuffer,a*cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,c),e=0;e<c;e++)d[e]=0},drawQuads:function(){this.drawNumberOfQuads(this._totalQuads,0)},_releaseBuffer:function(){var a=cc._renderContext;this._buffersVBO&&(this._buffersVBO[0]&&a.deleteBuffer(this._buffersVBO[0]),
this._buffersVBO[1]&&a.deleteBuffer(this._buffersVBO[1]));this._quadsWebBuffer&&a.deleteBuffer(this._quadsWebBuffer)}});_p=cc.TextureAtlas.prototype;cc.defineGetterSetter(_p,"totalQuads",_p.getTotalQuads);cc.defineGetterSetter(_p,"capacity",_p.getCapacity);cc.defineGetterSetter(_p,"quads",_p.getQuads,_p.setQuads);cc.TextureAtlas.create=function(a,b){return new cc.TextureAtlas(a,b)};cc.TextureAtlas.createWithTexture=cc.TextureAtlas.create;
cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(cc.assert(cc.isFunction(cc._tmp.WebGLTextureAtlas),cc._LogInfos.MissingFile,"TexturesWebGL.js"),cc._tmp.WebGLTextureAtlas(),delete cc._tmp.WebGLTextureAtlas)});cc.assert(cc.isFunction(cc._tmp.PrototypeTextureAtlas),cc._LogInfos.MissingFile,"TexturesPropertyDefine.js");cc._tmp.PrototypeTextureAtlas();delete cc._tmp.PrototypeTextureAtlas;cc.Scene=cc.Node.extend({_className:"Scene",ctor:function(){cc.Node.prototype.ctor.call(this);this._ignoreAnchorPointForPosition=!0;this.setAnchorPoint(0.5,0.5);this.setContentSize(cc.director.getWinSize())}});cc.Scene.create=function(){return new cc.Scene};cc.LoaderScene=cc.Scene.extend({_interval:null,_label:null,_logo:null,_className:"LoaderScene",cb:null,target:null,init:function(){var a=this._label=new cc.LabelTTF("Loading... 0%","Microsoft YaHei",30);a.setPosition(cc.winSize.width/2,0.1*cc.winSize.height);a.setColor(cc.color(180,180,180));this.addChild(this._label,15);this._logo=new cc.LayerColor(cc.color._getWhite());this.addChild(this._logo,20);return!0},onEnter:function(){cc.Node.prototype.onEnter.call(this);this.schedule(this._startLoading,
0.3)},onExit:function(){cc.Node.prototype.onExit.call(this);this._label.setString("Loading... 0%")},initWithResources:function(a,b,c){cc.isString(a)&&(a=[a]);this.resources=a||[];this.cb=b;this.target=c},_startLoading:function(){var a=this;a.unschedule(a._startLoading);cc.loader.load(a.resources,function(b,c,d){b=Math.min(d/c*100|0,100);a._label.setString("Loading... "+b+"%")},function(){a.cb&&a.cb.call(a.target)})},_updateTransform:function(){this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);
this._label._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)}});cc.LoaderScene.preload=function(a,b,c){var d=cc;d.loaderScene||(d.loaderScene=new cc.LoaderScene,d.loaderScene.init(),cc.eventManager.addCustomListener(cc.Director.EVENT_PROJECTION_CHANGED,function(){d.loaderScene._updateTransform()}));d.loaderScene.initWithResources(a,b,c);cc.director.runScene(d.loaderScene);return d.loaderScene};cc.Layer=cc.Node.extend({_className:"Layer",ctor:function(){cc.Node.prototype.ctor.call(this);this._ignoreAnchorPointForPosition=!0;this.setAnchorPoint(0.5,0.5);this.setContentSize(cc.winSize);this._cascadeOpacityEnabled=this._cascadeColorEnabled=!1},bake:function(){this._renderCmd.bake()},unbake:function(){this._renderCmd.unbake()},isBaked:function(){return this._renderCmd._isBaked},visit:function(a){var b=this._renderCmd,c=a?a._renderCmd:null;if(this._visible){a=cc.renderer;b.visit(c);if(b._isBaked)a.pushRenderCommand(b),
b._bakeSprite.visit(this);else{var d=this._children,e=d.length,f;if(0<e){this._reorderChildDirty&&this.sortAllChildren();for(c=0;c<e;c++)if(f=d[c],0>f._localZOrder)f.visit(this);else break;for(a.pushRenderCommand(b);c<e;c++)d[c].visit(this)}else a.pushRenderCommand(b)}b._dirtyFlag=0}else b._propagateFlagsDown(c)},addChild:function(a,b,c){cc.Node.prototype.addChild.call(this,a,b,c);this._renderCmd._bakeForAddChild(a)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Layer.CanvasRenderCmd(this):
new cc.Layer.WebGLRenderCmd(this)}});cc.Layer.create=function(){return new cc.Layer};
cc.LayerColor=cc.Layer.extend({_blendFunc:null,_className:"LayerColor",getBlendFunc:function(){return this._blendFunc},changeWidthAndHeight:function(a,b){this.width=a;this.height=b},changeWidth:function(a){this.width=a},changeHeight:function(a){this.height=a},setOpacityModifyRGB:function(a){},isOpacityModifyRGB:function(){return!1},ctor:function(a,b,c){cc.Layer.prototype.ctor.call(this);this._blendFunc=cc.BlendFunc._alphaNonPremultiplied();cc.LayerColor.prototype.init.call(this,a,b,c)},init:function(a,
b,c){var d=cc.director.getWinSize();a=a||cc.color(0,0,0,255);b=void 0===b?d.width:b;c=void 0===c?d.height:c;d=this._realColor;d.r=a.r;d.g=a.g;d.b=a.b;this._realOpacity=a.a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty);cc.LayerColor.prototype.setContentSize.call(this,b,c);return!0},visit:function(a){var b=this._renderCmd,c=a?a._renderCmd:null;if(this._visible){a=cc.renderer;b.visit(c);if(b._isBaked)a.pushRenderCommand(b._bakeRenderCmd),b._bakeSprite._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),
b._bakeSprite.visit(this);else{var d=this._children,e=d.length;if(0<e){this._reorderChildDirty&&this.sortAllChildren();for(c=0;c<e;c++)if(child=d[c],0>child._localZOrder)child.visit(this);else break;for(a.pushRenderCommand(b);c<e;c++)d[c].visit(this)}else a.pushRenderCommand(b)}b._dirtyFlag=0}else b._propagateFlagsDown(c)},setBlendFunc:function(a,b){var c=this._blendFunc;void 0===b?(c.src=a.src,c.dst=a.dst):(c.src=a,c.dst=b);this._renderCmd.updateBlendFunc(c)},_createRenderCmd:function(){return cc._renderType===
cc.game.RENDER_TYPE_CANVAS?new cc.LayerColor.CanvasRenderCmd(this):new cc.LayerColor.WebGLRenderCmd(this)}});cc.LayerColor.create=function(a,b,c){return new cc.LayerColor(a,b,c)};(function(){var a=cc.LayerColor.prototype;cc.defineGetterSetter(a,"width",a._getWidth,a._setWidth);cc.defineGetterSetter(a,"height",a._getHeight,a._setHeight)})();
cc.LayerGradient=cc.LayerColor.extend({_endColor:null,_startOpacity:255,_endOpacity:255,_alongVector:null,_compressedInterpolation:!1,_className:"LayerGradient",_colorStops:[],ctor:function(a,b,c,d){cc.LayerColor.prototype.ctor.call(this);this._endColor=cc.color(0,0,0,255);this._alongVector=cc.p(0,-1);this._endOpacity=this._startOpacity=255;d&&d instanceof Array?(this._colorStops=d,d.splice(0,0,{p:0,color:a||cc.color.BLACK}),d.push({p:1,color:b||cc.color.BLACK})):this._colorStops=[{p:0,color:a||cc.color.BLACK},
{p:1,color:b||cc.color.BLACK}];cc.LayerGradient.prototype.init.call(this,a,b,c,d)},init:function(a,b,c,d){a=a||cc.color(0,0,0,255);b=b||cc.color(0,0,0,255);c=c||cc.p(0,-1);d=this._endColor;this._startOpacity=a.a;d.r=b.r;d.g=b.g;d.b=b.b;this._endOpacity=b.a;this._alongVector=c;this._compressedInterpolation=!0;cc.LayerColor.prototype.init.call(this,cc.color(a.r,a.g,a.b,255));this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty|cc.Node._dirtyFlags.gradientDirty);
return!0},setContentSize:function(a,b){cc.LayerColor.prototype.setContentSize.call(this,a,b);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},_setWidth:function(a){cc.LayerColor.prototype._setWidth.call(this,a);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},_setHeight:function(a){cc.LayerColor.prototype._setHeight.call(this,a);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getStartColor:function(){return cc.color(this._realColor)},setStartColor:function(a){this.color=
a;var b=this._colorStops;b&&0<b.length&&(b=b[0].color,b.r=a.r,b.g=a.g,b.b=a.b)},setEndColor:function(a){var b=this._endColor;b.r=a.r;b.g=a.g;b.b=a.b;(b=this._colorStops)&&0<b.length&&(b=b[b.length-1].color,b.r=a.r,b.g=a.g,b.b=a.b);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},getEndColor:function(){return cc.color(this._endColor)},setStartOpacity:function(a){this._startOpacity=a;var b=this._colorStops;b&&0<b.length&&(b[0].color.a=a);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},
getStartOpacity:function(){return this._startOpacity},setEndOpacity:function(a){this._endOpacity=a;var b=this._colorStops;b&&0<b.length&&(b[b.length-1].color.a=a);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},getEndOpacity:function(){return this._endOpacity},setVector:function(a){this._alongVector.x=a.x;this._alongVector.y=a.y;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getVector:function(){return cc.p(this._alongVector.x,this._alongVector.y)},isCompressedInterpolation:function(){return this._compressedInterpolation},
setCompressedInterpolation:function(a){this._compressedInterpolation=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.gradientDirty)},getColorStops:function(){return this._colorStops},setColorStops:function(a){this._colorStops=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty|cc.Node._dirtyFlags.gradientDirty)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.LayerGradient.CanvasRenderCmd(this):new cc.LayerGradient.WebGLRenderCmd(this)}});
cc.LayerGradient.create=function(a,b,c,d){return new cc.LayerGradient(a,b,c,d)};
(function(){var a=cc.LayerGradient.prototype;cc.defineGetterSetter(a,"startColor",a.getStartColor,a.setStartColor);cc.defineGetterSetter(a,"endColor",a.getEndColor,a.setEndColor);cc.defineGetterSetter(a,"startOpacity",a.getStartOpacity,a.setStartOpacity);cc.defineGetterSetter(a,"endOpacity",a.getEndOpacity,a.setEndOpacity);cc.defineGetterSetter(a,"vector",a.getVector,a.setVector);cc.defineGetterSetter(a,"colorStops",a.getColorStops,a.setColorStops)})();
cc.LayerMultiplex=cc.Layer.extend({_enabledLayer:0,_layers:null,_className:"LayerMultiplex",ctor:function(a){cc.Layer.prototype.ctor.call(this);a instanceof Array?cc.LayerMultiplex.prototype.initWithLayers.call(this,a):cc.LayerMultiplex.prototype.initWithLayers.call(this,Array.prototype.slice.call(arguments))},initWithLayers:function(a){0<a.length&&null==a[a.length-1]&&cc.log(cc._LogInfos.LayerMultiplex_initWithLayers);this._layers=a;this._enabledLayer=0;this.addChild(this._layers[this._enabledLayer]);
return!0},switchTo:function(a){a>=this._layers.length?cc.log(cc._LogInfos.LayerMultiplex_switchTo):(this.removeChild(this._layers[this._enabledLayer],!0),this._enabledLayer=a,this.addChild(this._layers[a]))},switchToAndReleaseMe:function(a){a>=this._layers.length?cc.log(cc._LogInfos.LayerMultiplex_switchToAndReleaseMe):(this.removeChild(this._layers[this._enabledLayer],!0),this._layers[this._enabledLayer]=null,this._enabledLayer=a,this.addChild(this._layers[a]))},addLayer:function(a){a?this._layers.push(a):
cc.log(cc._LogInfos.LayerMultiplex_addLayer)}});cc.LayerMultiplex.create=function(){return new cc.LayerMultiplex(Array.prototype.slice.call(arguments))};(function(){cc.Layer.CanvasRenderCmd=function(a){this._rootCtor(a);this._isBaked=!1;this._bakeSprite=null;this._canUseDirtyRegion=!0;this._updateCache=2};var a=cc.Layer.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);a.constructor=cc.Layer.CanvasRenderCmd;a._layerCmdCtor=cc.Layer.CanvasRenderCmd;a._setCacheDirty=function(a){a&&0===this._updateCache&&(this._updateCache=2);!1===this._cacheDirty&&(this._cacheDirty=!0,(a=this._cachedParent)&&a!==this&&a._setNodeDirtyForCache&&
a._setNodeDirtyForCache())};a.updateStatus=function(){var a=cc.Node._dirtyFlags;this._dirtyFlag&a.orderDirty&&(this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2),this._dirtyFlag&=~a.orderDirty);this.originUpdateStatus()};a._syncStatus=function(a){var c=cc.Node._dirtyFlags,d=this._dirtyFlag;if(this._isBaked||d&c.orderDirty)this._cacheDirty=!0,0===this._updateCache&&(this._updateCache=2),this._dirtyFlag&=~c.orderDirty;this._originSyncStatus(a)};a.transform=function(a,c){this._worldTransform||
(this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0});var d=this._worldTransform,e=d.a,f=d.b,g=d.c,h=d.d;this.originTransform(a,c);d.a===e&&d.b===f&&d.c===g&&d.d===h||0!==this._updateCache||(this._updateCache=2)};a.bake=function(){if(!this._isBaked){this._needDraw=!0;this._isBaked=this._cacheDirty=cc.renderer.childrenOrderDirty=!0;0===this._updateCache&&(this._updateCache=2);for(var a=this._node._children,c=0,d=a.length;c<d;c++)a[c]._renderCmd._setCachedParent(this);this._bakeSprite||(this._bakeSprite=
new cc.BakeSprite,this._bakeSprite.setAnchorPoint(0,0))}};a.unbake=function(){if(this._isBaked){cc.renderer.childrenOrderDirty=!0;this._isBaked=this._needDraw=!1;this._cacheDirty=!0;0===this._updateCache&&(this._updateCache=2);for(var a=this._node._children,c=0,d=a.length;c<d;c++)a[c]._renderCmd._setCachedParent(null)}};a.isBaked=function(){return this._isBaked};a.rendering=function(){if(this._cacheDirty){var a=this._node,c=a._children,d=this._bakeSprite;this.transform(this.getParentRenderCmd(),!0);
var e=this._getBoundingBoxForBake();e.width=0|e.width+0.5;e.height=0|e.height+0.5;var f=d.getCacheContext(),g=f.getContext();d.setPosition(e.x,e.y);if(0<this._updateCache){d.resetCanvasSize(e.width,e.height);f.setOffset(0-e.x,g.canvas.height-e.height+e.y);a.sortAllChildren();cc.renderer._turnToCacheMode(this.__instanceId);a=0;for(e=c.length;a<e;a++)c[a].visit(this);cc.renderer._renderingToCacheCanvas(f,this.__instanceId);d.transform();this._updateCache--}this._cacheDirty=!1}};a._bakeForAddChild=function(a){a._parent===
this._node&&this._isBaked&&a._renderCmd._setCachedParent(this)};a._getBoundingBoxForBake=function(){var a=null,c=this._node;if(!c._children||0===c._children.length)return cc.rect(0,0,10,10);for(var d=c.getNodeToWorldTransform(),c=c._children,e=0,f=c.length;e<f;e++){var g=c[e];g&&g._visible&&(a?(g=g._getBoundingBoxToCurrentNode(d))&&(a=cc.rectUnion(a,g)):a=g._getBoundingBoxToCurrentNode(d))}return a}})();
(function(){cc.LayerColor.CanvasRenderCmd=function(a){this._layerCmdCtor(a);this._needDraw=!0;this._blendFuncStr="source-over";this._bakeRenderCmd=new cc.CustomRenderCmd(this,this._bakeRendering)};var a=cc.LayerColor.CanvasRenderCmd.prototype=Object.create(cc.Layer.CanvasRenderCmd.prototype);a.constructor=cc.LayerColor.CanvasRenderCmd;a.unbake=function(){cc.Layer.CanvasRenderCmd.prototype.unbake.call(this);this._needDraw=!0};a.rendering=function(a,c,d){a=a||cc._renderContext;var e=a.getContext(),
f=this._node,g=this._displayedColor,h=this._displayedOpacity/255,k=f._contentSize.width,f=f._contentSize.height;0!==h&&(a.setCompositeOperation(this._blendFuncStr),a.setGlobalAlpha(h),a.setFillStyle("rgba("+(0|g.r)+","+(0|g.g)+","+(0|g.b)+", 1)"),a.setTransform(this._worldTransform,c,d),e.fillRect(0,0,k,-f),cc.g_NumberOfDraws++)};a.updateBlendFunc=function(a){this._blendFuncStr=cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(a)};a._updateSquareVertices=a._updateSquareVerticesWidth=a._updateSquareVerticesHeight=
function(){};a._bakeRendering=function(){if(this._cacheDirty){var a=this._node,c=this._bakeSprite,d=a._children,e,f=d.length;this.transform(this.getParentRenderCmd(),!0);e=this._getBoundingBoxForBake();e.width=0|e.width+0.5;e.height=0|e.height+0.5;var g=c.getCacheContext(),h=g.getContext();c.setPosition(e.x,e.y);if(0<this._updateCache){h.fillStyle=g._currentFillStyle;c.resetCanvasSize(e.width,e.height);g.setOffset(0-e.x,h.canvas.height-e.height+e.y);cc.renderer._turnToCacheMode(this.__instanceId);
if(0<f){a.sortAllChildren();for(e=0;e<f;e++)if(h=d[e],0>h._localZOrder)h.visit(a);else break;for(cc.renderer.pushRenderCommand(this);e<f;e++)d[e].visit(a)}else cc.renderer.pushRenderCommand(this);cc.renderer._renderingToCacheCanvas(g,this.__instanceId);c.transform();this._updateCache--}this._cacheDirty=!1}};a._getBoundingBoxForBake=function(){var a=this._node,c=cc.rect(0,0,a._contentSize.width,a._contentSize.height),d=a.getNodeToWorldTransform(),c=cc.rectApplyAffineTransform(c,a.getNodeToWorldTransform());
if(!a._children||0===a._children.length)return c;for(var a=a._children,e=0;e<a.length;e++){var f=a[e];f&&f._visible&&(f=f._getBoundingBoxToCurrentNode(d),c=cc.rectUnion(c,f))}return c}})();
(function(){cc.LayerGradient.CanvasRenderCmd=function(a){cc.LayerColor.CanvasRenderCmd.call(this,a);this._needDraw=!0;this._startPoint=cc.p(0,0);this._endPoint=cc.p(0,0);this._endStopStr=this._startStopStr=null};var a=cc.LayerGradient.CanvasRenderCmd.prototype=Object.create(cc.LayerColor.CanvasRenderCmd.prototype);a.constructor=cc.LayerGradient.CanvasRenderCmd;a.rendering=function(a,c,d){a=a||cc._renderContext;var e=a.getContext(),f=this._node,g=this._displayedOpacity/255;if(0!==g){var h=f._contentSize.width,
k=f._contentSize.height;a.setCompositeOperation(this._blendFuncStr);a.setGlobalAlpha(g);g=e.createLinearGradient(this._startPoint.x,this._startPoint.y,this._endPoint.x,this._endPoint.y);if(f._colorStops)for(var m=0;m<f._colorStops.length;m++)g.addColorStop(f._colorStops[m].p,this._colorStopsStr[m]);else g.addColorStop(0,this._startStopStr),g.addColorStop(1,this._endStopStr);a.setFillStyle(g);a.setTransform(this._worldTransform,c,d);e.fillRect(0,0,h,-k);cc.g_NumberOfDraws++}};a.updateStatus=function(){var a=
cc.Node._dirtyFlags;this._dirtyFlag&a.gradientDirty&&(this._dirtyFlag|=a.colorDirty,this._dirtyFlag&=~a.gradientDirty);this.originUpdateStatus()};a._syncStatus=function(a){var c=cc.Node._dirtyFlags;this._dirtyFlag&c.gradientDirty&&(this._dirtyFlag|=c.colorDirty,this._dirtyFlag&=~c.gradientDirty);this._originSyncStatus(a)};a._updateColor=function(){var a=this._node,c=a._contentSize,d=0.5*c.width,c=0.5*c.height,e=cc.pAngleSigned(cc.p(0,-1),a._alongVector),e=cc.pRotateByAngle(cc.p(0,-1),cc.p(0,0),e),
f=Math.min(Math.abs(1/e.x),Math.abs(1/e.y));this._startPoint.x=d*-e.x*f+d;this._startPoint.y=c*e.y*f-c;this._endPoint.x=d*e.x*f+d;this._endPoint.y=c*-e.y*f-c;d=this._displayedColor;c=a._endColor;e=a._startOpacity/255;f=a._endOpacity/255;this._startStopStr="rgba("+Math.round(d.r)+","+Math.round(d.g)+","+Math.round(d.b)+","+e.toFixed(4)+")";this._endStopStr="rgba("+Math.round(c.r)+","+Math.round(c.g)+","+Math.round(c.b)+","+f.toFixed(4)+")";if(a._colorStops)for(this._endOpacity=this._startOpacity=0,
this._colorStopsStr=[],d=0;d<a._colorStops.length;d++)c=a._colorStops[d].color,e=null==c.a?1:c.a/255,this._colorStopsStr.push("rgba("+Math.round(c.r)+","+Math.round(c.g)+","+Math.round(c.b)+","+e.toFixed(4)+")")}})();(function(){cc.Layer.WebGLRenderCmd=function(a){this._rootCtor(a);this._isBaked=!1};var a=cc.Layer.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);a.constructor=cc.Layer.WebGLRenderCmd;a._layerCmdCtor=cc.Layer.WebGLRenderCmd;a.bake=function(){};a.unbake=function(){};a._bakeForAddChild=function(){}})();
(function(){cc.LayerColor.WebGLRenderCmd=function(a){this._layerCmdCtor(a);this._needDraw=!0;this._matrix=null;this.initData(4);this._color=new Uint32Array(1);this._vertexBuffer=null;this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_COLOR)};var a=cc.LayerColor.WebGLRenderCmd.prototype=Object.create(cc.Layer.WebGLRenderCmd.prototype);a.constructor=cc.LayerColor.WebGLRenderCmd;a.initData=function(a){this._data=new ArrayBuffer(16*a);this._positionView=new Float32Array(this._data);this._colorView=
new Uint32Array(this._data);this._dataDirty=!0};a.transform=function(a,c){this.originTransform(a,c);var d=this._node,e=d._contentSize.width,f=d._contentSize.height,g=this._positionView;g[4]=e;g[9]=f;g[12]=e;g[13]=f;g[2].z=g[6]=g[10]=g[14]=d._vertexZ;this._dataDirty=!0};a._updateColor=function(){var a=this._displayedColor;this._color[0]=this._displayedOpacity<<24|a.b<<16|a.g<<8|a.r;for(var a=this._colorView,c=0;4>c;c++)a[4*c+3]=this._color[0];this._dataDirty=!0};a.rendering=function(a){a=a||cc._renderContext;
var c=this._node;this._matrix||(this._matrix=new cc.math.Matrix4,this._matrix.identity());var d=this._worldTransform;this._matrix.mat[0]=d.a;this._matrix.mat[4]=d.c;this._matrix.mat[12]=d.tx;this._matrix.mat[1]=d.b;this._matrix.mat[5]=d.d;this._matrix.mat[13]=d.ty;this._dataDirty&&(this._vertexBuffer||(this._vertexBuffer=a.createBuffer()),a.bindBuffer(a.ARRAY_BUFFER,this._vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this._data,a.DYNAMIC_DRAW),this._dataDirty=!1);this._glProgramState.apply(this._matrix);
cc.glBlendFunc(c._blendFunc.src,c._blendFunc.dst);a.bindBuffer(a.ARRAY_BUFFER,this._vertexBuffer);a.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);a.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR);a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,a.FLOAT,!1,16,0);a.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,a.UNSIGNED_BYTE,!0,16,12);a.drawArrays(a.TRIANGLE_STRIP,0,4)};a.updateBlendFunc=function(a){}})();
(function(){cc.LayerGradient.WebGLRenderCmd=function(a){cc.LayerColor.WebGLRenderCmd.call(this,a);this._needDraw=!0;this._clipRect=new cc.Rect;this._clippingRectDirty=!1};var a=cc.LayerGradient.WebGLRenderCmd.prototype=Object.create(cc.LayerColor.WebGLRenderCmd.prototype);a.constructor=cc.LayerGradient.WebGLRenderCmd;a.updateStatus=function(){var a=cc.Node._dirtyFlags;this._dirtyFlag&a.gradientDirty&&(this._dirtyFlag|=a.colorDirty,this._updateVertex(),this._dirtyFlag&=~a.gradientDirty);this.originUpdateStatus()};
a._syncStatus=function(a){var c=cc.Node._dirtyFlags;this._dirtyFlag&c.gradientDirty&&(this._dirtyFlag|=c.colorDirty,this._updateVertex(),this._dirtyFlag&=~c.gradientDirty);this._originSyncStatus(a)};a.transform=function(a,c){this.originTransform(a,c);this._updateVertex()};a._updateVertex=function(){var a=this._node,c=a._colorStops;if(c&&!(2>c.length)){this._clippingRectDirty=!0;var d,e=c.length,f=2*e,g=a._contentSize;this._positionView.length/4<f&&this.initData(f);var h=Math.PI+cc.pAngleSigned(cc.p(0,
-1),a._alongVector),f=cc.p(g.width/2,g.height/2);d=Math.round(cc.radiansToDegrees(h));var k=cc.affineTransformMake(1,0,0,1,f.x,f.y),k=cc.affineTransformRotate(k,h),m;90>d?(m=cc.p(-f.x,f.y),d=cc.p(f.x,f.y)):180>d?(m=cc.p(f.x,f.y),d=cc.p(f.x,-f.y)):270>d?(m=cc.p(f.x,-f.y),d=cc.p(-f.x,-f.y)):(m=cc.p(-f.x,-f.y),d=cc.p(-f.x,f.y));var n=Math.sin(h),h=Math.cos(h);m=Math.abs((m.x*h-m.y*n)/f.x);d=Math.abs((d.x*n+d.y*h)/f.y);k=cc.affineTransformScale(k,m,d);n=this._positionView;for(d=0;d<e;d++){m=c[d].p*g.height;
var p=cc.pointApplyAffineTransform(-f.x,m-f.y,k),h=8*d;n[h]=p.x;n[h+1]=p.y;n[h+2]=a._vertexZ;m=cc.pointApplyAffineTransform(g.width-f.x,m-f.y,k);h+=4;n[h]=m.x;n[h+1]=m.y;n[h+2]=a._vertexZ}this._dataDirty=!0}};a._updateColor=function(){var a=this._node._colorStops;if(a&&!(2>a.length)){var c=a.length,d,e=this._colorView,f=this._displayedOpacity/255;for(i=0;i<c;i++)d=a[i].color,this._color[0]=d.a*f<<24|d.b<<16|d.g<<8|d.r,d=8*i,e[d+3]=this._color[0],d+=4,e[d+3]=this._color[0];this._dataDirty=!0}};a.rendering=
function(a){a=a||cc._renderContext;var c=this._node;this._matrix||(this._matrix=new cc.math.Matrix4,this._matrix.identity());var d=this._getClippingRect();a.enable(a.SCISSOR_TEST);cc.view.setScissorInPoints(d.x,d.y,d.width,d.height);d=this._worldTransform;this._matrix.mat[0]=d.a;this._matrix.mat[4]=d.c;this._matrix.mat[12]=d.tx;this._matrix.mat[1]=d.b;this._matrix.mat[5]=d.d;this._matrix.mat[13]=d.ty;this._dataDirty&&(this._vertexBuffer||(this._vertexBuffer=gl.createBuffer()),gl.bindBuffer(gl.ARRAY_BUFFER,
this._vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,this._data,gl.DYNAMIC_DRAW),this._dataDirty=!1);this._glProgramState.apply(this._matrix);cc.glBlendFunc(c._blendFunc.src,c._blendFunc.dst);gl.bindBuffer(gl.ARRAY_BUFFER,this._vertexBuffer);gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);gl.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR);gl.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,gl.FLOAT,!1,16,0);gl.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,gl.UNSIGNED_BYTE,!0,16,12);gl.drawArrays(gl.TRIANGLE_STRIP,
0,4);a.disable(a.SCISSOR_TEST)};a._getClippingRect=function(){if(this._clippingRectDirty){var a=this._node,c=cc.rect(0,0,a._contentSize.width,a._contentSize.height),a=a.getNodeToWorldTransform();this._clipRect=cc._rectApplyAffineTransformIn(c,a)}return this._clipRect}})();cc._tmp.PrototypeSprite=function(){var a=cc.Sprite.prototype;cc.defineGetterSetter(a,"opacityModifyRGB",a.isOpacityModifyRGB,a.setOpacityModifyRGB);cc.defineGetterSetter(a,"opacity",a.getOpacity,a.setOpacity);cc.defineGetterSetter(a,"color",a.getColor,a.setColor);cc.defineGetterSetter(a,"flippedX",a.isFlippedX,a.setFlippedX);cc.defineGetterSetter(a,"flippedY",a.isFlippedY,a.setFlippedY);cc.defineGetterSetter(a,"offsetX",a._getOffsetX);cc.defineGetterSetter(a,"offsetY",a._getOffsetY);cc.defineGetterSetter(a,
"texture",a.getTexture,a.setTexture);cc.defineGetterSetter(a,"textureRectRotated",a.isTextureRectRotated);cc.defineGetterSetter(a,"batchNode",a.getBatchNode,a.setBatchNode);cc.defineGetterSetter(a,"quad",a.getQuad)};cc.Sprite=cc.Node.extend({dirty:!1,atlasIndex:0,textureAtlas:null,_batchNode:null,_recursiveDirty:null,_hasChildren:null,_shouldBeHidden:!1,_transformToBatch:null,_blendFunc:null,_texture:null,_rect:null,_rectRotated:!1,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,_opacityModifyRGB:!1,_flippedX:!1,_flippedY:!1,_textureLoaded:!1,_className:"Sprite",ctor:function(a,b,c){cc.Node.prototype.ctor.call(this);this.setAnchorPoint(0.5,0.5);this._loader=new cc.Sprite.LoadManager;this._shouldBeHidden=
!1;this._offsetPosition=cc.p(0,0);this._unflippedOffsetPositionFromCenter=cc.p(0,0);this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST};this._rect=cc.rect(0,0,0,0);this._softInit(a,b,c)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(a,b){this.addEventListener("load",a,b)},isDirty:function(){return this.dirty},setDirty:function(a){this.dirty=a},isTextureRectRotated:function(){return this._rectRotated},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(a){this.atlasIndex=
a},getTextureRect:function(){return cc.rect(this._rect)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(a){this.textureAtlas=a},getOffsetPosition:function(){return cc.p(this._offsetPosition)},_getOffsetX:function(){return this._offsetPosition.x},_getOffsetY:function(){return this._offsetPosition.y},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(a){cc.assert(a,cc._LogInfos.Sprite_initWithSpriteFrame);return this.setSpriteFrame(a)},initWithSpriteFrameName:function(a){cc.assert(a,
cc._LogInfos.Sprite_initWithSpriteFrameName);var b=cc.spriteFrameCache.getSpriteFrame(a);cc.assert(b,a+cc._LogInfos.Sprite_initWithSpriteFrameName1);return this.initWithSpriteFrame(b)},useBatchNode:function(a){},setVertexRect:function(a){var b=this._rect;b.x=a.x;b.y=a.y;b.width=a.width;b.height=a.height;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setFlippedX:function(a){this._flippedX!==a&&(this._flippedX=a,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),
this.setNodeDirty(!0))},setFlippedY:function(a){this._flippedY!==a&&(this._flippedY=a,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},isFlippedX:function(){return this._flippedX},isFlippedY:function(){return this._flippedY},setOpacityModifyRGB:function(a){this._opacityModifyRGB!==a&&(this._opacityModifyRGB=a,this._renderCmd._setColorDirty())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setDisplayFrameWithAnimationName:function(a,b){cc.assert(a,
cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_3);var c=cc.animationCache.getAnimation(a);c?(c=c.getFrames()[b])?this.setSpriteFrame(c.getSpriteFrame()):cc.log(cc._LogInfos.Sprite_setDisplayFrameWithAnimationName_2):cc.log(cc._LogInfos.Sprite_setDisplayFrameWithAnimationName)},getBatchNode:function(){return this._batchNode},getTexture:function(){return this._texture},_softInit:function(a,b,c){if(void 0===a)cc.Sprite.prototype.init.call(this);else if("string"===typeof a)"#"===a[0]?(b=a.substr(1,
a.length-1),(b=cc.spriteFrameCache.getSpriteFrame(b))?this.initWithSpriteFrame(b):cc.log("%s does not exist",a)):cc.Sprite.prototype.init.call(this,a,b);else if("object"===typeof a)if(a instanceof cc.Texture2D)this.initWithTexture(a,b,c);else if(a instanceof cc.SpriteFrame)this.initWithSpriteFrame(a);else if(a instanceof(new Image).constructor||a instanceof document.createElement("canvas").constructor||"canvas"===a.type)b=new cc.Texture2D,b.initWithElement(a),b.handleLoadedTexture(),this.initWithTexture(b)},
getQuad:function(){return null},setBlendFunc:function(a,b){var c=this._blendFunc;void 0===b?(c.src=a.src,c.dst=a.dst):(c.src=a,c.dst=b);this._renderCmd.updateBlendFunc(c)},init:function(){if(0<arguments.length)return this.initWithFile(arguments[0],arguments[1]);cc.Node.prototype.init.call(this);this.dirty=this._recursiveDirty=!1;this._blendFunc.src=cc.BLEND_SRC;this._blendFunc.dst=cc.BLEND_DST;this.texture=null;this._flippedX=this._flippedY=!1;this.anchorY=this.anchorX=0.5;this._offsetPosition.x=
0;this._offsetPosition.y=0;this._hasChildren=!1;this.setTextureRect(cc.rect(0,0,0,0),!1,cc.size(0,0));return!0},initWithFile:function(a,b){cc.assert(a,cc._LogInfos.Sprite_initWithFile);var c=cc.textureCache.getTextureForKey(a);c||(c=cc.textureCache.addImage(a));if(!c.isLoaded())return this._loader.clear(),this._loader.once(c,function(){this.initWithFile(a,b);this.dispatchEvent("load")},this),!1;if(!b){var d=c.getContentSize();b=cc.rect(0,0,d.width,d.height)}return this.initWithTexture(c,b)},initWithTexture:function(a,
b,c,d){cc.assert(0!==arguments.length,cc._LogInfos.CCSpriteBatchNode_initWithTexture);this._loader.clear();this._textureLoaded=a.isLoaded();if(!this._textureLoaded)return this._loader.once(a,function(){this.initWithTexture(a,b,c,d);this.dispatchEvent("load")},this),!1;c=c||!1;a=this._renderCmd._handleTextureForRotatedTexture(a,b,c,d);if(!cc.Node.prototype.init.call(this))return!1;this._batchNode=null;this.dirty=this._recursiveDirty=!1;this._opacityModifyRGB=!0;this._blendFunc.src=cc.BLEND_SRC;this._blendFunc.dst=
cc.BLEND_DST;this._flippedX=this._flippedY=!1;this._offsetPosition.x=0;this._offsetPosition.y=0;this._hasChildren=!1;this._rectRotated=c;b&&(this._rect.x=b.x,this._rect.y=b.y,this._rect.width=b.width,this._rect.height=b.height);b||(b=cc.rect(0,0,a.width,a.height));this._renderCmd._checkTextureBoundary(a,b,c);this.setTexture(a);this.setTextureRect(b,c);this.setBatchNode(null);return!0},setTextureRect:function(a,b,c,d){this._rectRotated=b||!1;this.setContentSize(c||a);this.setVertexRect(a);this._renderCmd._setTextureCoords(a,
d);a=this._unflippedOffsetPositionFromCenter.x;b=this._unflippedOffsetPositionFromCenter.y;this._flippedX&&(a=-a);this._flippedY&&(b=-b);c=this._rect;this._offsetPosition.x=a+(this._contentSize.width-c.width)/2;this._offsetPosition.y=b+(this._contentSize.height-c.height)/2},addChild:function(a,b,c){cc.assert(a,cc._LogInfos.CCSpriteBatchNode_addChild_2);null==b&&(b=a._localZOrder);null==c&&(c=a.tag);this._renderCmd._setBatchNodeForAddChild(a)&&(cc.Node.prototype.addChild.call(this,a,b,c),this._hasChildren=
!0)},setSpriteFrame:function(a){"string"===typeof a&&(a=cc.spriteFrameCache.getSpriteFrame(a),cc.assert(a,cc._LogInfos.Sprite_setSpriteFrame));this._loader.clear();this.setNodeDirty(!0);var b=a.getTexture();this._textureLoaded=a.textureLoaded();this._loader.clear();if(!this._textureLoaded)return this._loader.once(b,function(){this.setSpriteFrame(a);this.dispatchEvent("load")},this),!1;var c=a.getOffset();this._unflippedOffsetPositionFromCenter.x=c.x;this._unflippedOffsetPositionFromCenter.y=c.y;b!==
this._texture&&(this._renderCmd._setTexture(b),this.setColor(this._realColor));this.setTextureRect(a.getRect(),a.isRotated(),a.getOriginalSize())},setDisplayFrame:function(a){cc.log(cc._LogInfos.Sprite_setDisplayFrame);this.setSpriteFrame(a)},isFrameDisplayed:function(a){return this._renderCmd.isFrameDisplayed(a)},displayFrame:function(){return this.getSpriteFrame()},getSpriteFrame:function(){return new cc.SpriteFrame(this._texture,cc.rectPointsToPixels(this._rect),this._rectRotated,cc.pointPointsToPixels(this._unflippedOffsetPositionFromCenter),
cc.sizePointsToPixels(this._contentSize))},setBatchNode:function(a){},setTexture:function(a){if(!a)return this._renderCmd._setTexture(null);var b="string"===typeof a;b&&(a=cc.textureCache.addImage(a));this._loader.clear();if(!a._textureLoaded)return this._loader.once(a,function(){this.setTexture(a);this.dispatchEvent("load")},this),!1;this._renderCmd._setTexture(a);b&&this._changeRectWithTexture(a);this.setColor(this._realColor);this._textureLoaded=!0},_changeRectWithTexture:function(a){a=a._contentSize;
a=cc.rect(0,0,a.width,a.height);this.setTextureRect(a)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Sprite.CanvasRenderCmd(this):new cc.Sprite.WebGLRenderCmd(this)}});cc.Sprite.create=function(a,b,c){return new cc.Sprite(a,b,c)};cc.Sprite.createWithTexture=cc.Sprite.create;cc.Sprite.createWithSpriteFrameName=cc.Sprite.create;cc.Sprite.createWithSpriteFrame=cc.Sprite.create;cc.Sprite.INDEX_NOT_INITIALIZED=-1;cc.EventHelper.prototype.apply(cc.Sprite.prototype);
cc.assert(cc.isFunction(cc._tmp.PrototypeSprite),cc._LogInfos.MissingFile,"SpritesPropertyDefine.js");cc._tmp.PrototypeSprite();delete cc._tmp.PrototypeSprite;
(function(){var a=cc.Sprite.LoadManager=function(){this.list=[]};a.prototype.add=function(a,c,d){a&&a.addEventListener&&(a.addEventListener("load",c,d),this.list.push({source:a,listener:c,target:d}))};a.prototype.once=function(a,c,d){if(a&&a.addEventListener){var e=function(f){a.removeEventListener("load",e,d);c.call(d,f)};a.addEventListener("load",e,d);this.list.push({source:a,listener:e,target:d})}};a.prototype.clear=function(){for(;0<this.list.length;){var a=this.list.pop();a.source.removeEventListener("load",
a.listener,a.target)}}})();(function(){cc.Sprite.CanvasRenderCmd=function(a){this._rootCtor(a);this._needDraw=!0;this._textureCoord={renderX:0,renderY:0,x:0,y:0,width:0,height:0,validRect:!1};this._blendFuncStr="source-over";this._colorized=!1;this._canUseDirtyRegion=!0;this._textureToRender=null};var a=cc.Sprite.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);a.constructor=cc.Sprite.CanvasRenderCmd;a._spriteCmdCtor=cc.Sprite.CanvasRenderCmd;a.setDirtyRecursively=function(a){};a._setTexture=function(a){var c=
this._node;c._texture!==a&&(c._textureLoaded=a?a._textureLoaded:!1,c._texture=a,a=a._contentSize,a=cc.rect(0,0,a.width,a.height),c.setTextureRect(a),this._updateColor())};a._setColorDirty=function(){this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty)};a.isFrameDisplayed=function(a){var c=this._node;return a.getTexture()!==c._texture?!1:cc.rectEqualToRect(a.getRect(),c._rect)};a.updateBlendFunc=function(a){this._blendFuncStr=cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(a)};
a._setBatchNodeForAddChild=function(a){return!0};a._handleTextureForRotatedTexture=function(a,c,d,e){d&&a.isLoaded()&&(a=a.getHtmlElementObj(),a=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(a,c,e),e=new cc.Texture2D,e.initWithElement(a),e.handleLoadedTexture(),a=e,c.x=c.y=0,this._node._rect=cc.rect(0,0,c.width,c.height));return a};a._checkTextureBoundary=function(a,c,d){a&&a.url&&(d=c.y+c.height,c.x+c.width>a.width&&cc.error(cc._LogInfos.RectWidth,a.url),d>a.height&&cc.error(cc._LogInfos.RectHeight,
a.url))};a.rendering=function(a,c,d){var e=this._node,f=this._textureCoord,g=this._displayedOpacity/255,h=this._textureToRender||e._texture;if((!h||0!==f.width&&0!==f.height&&h._textureLoaded)&&0!==g){a=a||cc._renderContext;var k=a.getContext(),m=e._offsetPosition.x,n=e._rect.height,p=e._rect.width,r=-e._offsetPosition.y-n;a.setTransform(this._worldTransform,c,d);a.setCompositeOperation(this._blendFuncStr);a.setGlobalAlpha(g);(e._flippedX||e._flippedY)&&a.save();e._flippedX&&(m=-m-p,k.scale(-1,1));
e._flippedY&&(r=e._offsetPosition.y,k.scale(1,-1));var s,u,t;this._colorized?s=g=0:(g=f.renderX,s=f.renderY);u=f.width;t=f.height;h&&h._htmlElementObj?(c=h._htmlElementObj,""!==h._pattern?(a.setFillStyle(k.createPattern(c,h._pattern)),k.fillRect(m,r,p,n)):k.drawImage(c,g,s,u,t,m,r,p,n)):(h=e._contentSize,f.validRect&&(f=this._displayedColor,a.setFillStyle("rgba("+f.r+","+f.g+","+f.b+",1)"),k.fillRect(m,r,h.width*c,h.height*d)));(e._flippedX||e._flippedY)&&a.restore();cc.g_NumberOfDraws++}};a._updateColor=
function(){var a=this._node._texture,c=this._textureCoord,d=this._displayedColor;a&&(255!==d.r||255!==d.g||255!==d.b?(this._textureToRender=a._generateColorTexture(d.r,d.g,d.b,c),this._colorized=!0):a&&(this._textureToRender=a,this._colorized=!1))};a._textureLoadedCallback=function(a){if(!this._textureLoaded){this._textureLoaded=!0;var c=this._rect,d=this._renderCmd;c?cc._rectEqualToZero(c)&&(c.width=a.width,c.height=a.height):c=cc.rect(0,0,a.width,a.height);this.texture=a;this.setTextureRect(c,this._rectRotated);
a=d._displayedColor;255===a.r&&255===a.g&&255===a.b||d._updateColor();this.setBatchNode(this._batchNode);this.dispatchEvent("load")}};a._setTextureCoords=function(a,c){void 0===c&&(c=!0);var d=this._textureCoord,e=c?cc.contentScaleFactor():1;d.renderX=d.x=0|a.x*e;d.renderY=d.y=0|a.y*e;d.width=0|a.width*e;d.height=0|a.height*e;d.validRect=!(0===d.width||0===d.height||0>d.x||0>d.y)};cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas=function(a,c,d){if(!a)return null;if(!c)return a;d=null==d?!0:d;var e=
document.createElement("canvas");e.width=c.width;e.height=c.height;var f=e.getContext("2d");f.translate(e.width/2,e.height/2);d?f.rotate(-1.5707963267948966):f.rotate(1.5707963267948966);f.drawImage(a,c.x,c.y,c.height,c.width,-c.height/2,-c.width/2,c.height,c.width);return e}})();(function(){cc.Sprite.WebGLRenderCmd=function(a){this._rootCtor(a);this._needDraw=!0;this._vertices=[{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0}];this._color=new Uint32Array(1);this._recursiveDirty=this._dirty=!1;this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)};var a=cc.Sprite.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);a.constructor=cc.Sprite.WebGLRenderCmd;a._spriteCmdCtor=cc.Sprite.WebGLRenderCmd;
a.updateBlendFunc=function(a){};a.setDirtyFlag=function(a){cc.Node.WebGLRenderCmd.prototype.setDirtyFlag.call(this,a);this._dirty=!0};a.setDirtyRecursively=function(a){this._dirty=this._recursiveDirty=a;for(var c=this._node._children,d,e=c?c.length:0,f=0;f<e;f++)d=c[f],d instanceof cc.Sprite&&d._renderCmd.setDirtyRecursively(a)};a._setBatchNodeForAddChild=function(a){var c=this._node;if(c._batchNode){if(!(a instanceof cc.Sprite))return cc.log(cc._LogInfos.Sprite_addChild),!1;a.texture._webTextureObj!==
c.textureAtlas.texture._webTextureObj&&cc.log(cc._LogInfos.Sprite_addChild_2);c._batchNode.appendChild(a);c._reorderChildDirty||c._setReorderChildDirtyRecursively()}return!0};a._handleTextureForRotatedTexture=function(a){return a};a.isFrameDisplayed=function(a){var c=this._node;return cc.rectEqualToRect(a.getRect(),c._rect)&&a.getTexture().getName()===c._texture.getName()&&cc.pointEqualToPoint(a.getOffset(),c._unflippedOffsetPositionFromCenter)};a._textureLoadedCallback=function(a){if(!this._textureLoaded){this._textureLoaded=
!0;var c=this._rect;c?cc._rectEqualToZero(c)&&(c.width=a.width,c.height=a.height):c=cc.rect(0,0,a.width,a.height);this.texture=a;this.setTextureRect(c,this._rectRotated);this.setBatchNode(this._batchNode);this.dispatchEvent("load");cc.renderer.childrenOrderDirty=!0}};a._setTextureCoords=function(a,c){void 0===c&&(c=!0);c&&(a=cc.rectPointsToPixels(a));var d=this._node,e=d._batchNode?d.textureAtlas.texture:d._texture,f=this._vertices;if(e){var g=e.pixelsWidth,h=e.pixelsHeight,k,m;d._rectRotated?(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?
(e=(2*a.x+1)/(2*g),g=e+(2*a.height-2)/(2*g),k=(2*a.y+1)/(2*h),h=k+(2*a.width-2)/(2*h)):(e=a.x/g,g=(a.x+a.height)/g,k=a.y/h,h=(a.y+a.width)/h),d._flippedX&&(m=k,k=h,h=m),d._flippedY&&(m=e,e=g,g=m),f[0].u=g,f[0].v=k,f[1].u=e,f[1].v=k,f[2].u=g,f[2].v=h,f[3].u=e):(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(e=(2*a.x+1)/(2*g),g=e+(2*a.width-2)/(2*g),k=(2*a.y+1)/(2*h),h=k+(2*a.height-2)/(2*h)):(e=a.x/g,g=(a.x+a.width)/g,k=a.y/h,h=(a.y+a.height)/h),d._flippedX&&(m=e,e=g,g=m),d._flippedY&&(m=k,k=h,h=m),f[0].u=e,
f[0].v=k,f[1].u=e,f[1].v=h,f[2].u=g,f[2].v=k,f[3].u=g);f[3].v=h}};a._setColorDirty=function(){};a._updateBlendFunc=function(){if(this._batchNode)cc.log(cc._LogInfos.Sprite__updateBlendFunc);else{var a=this._node,c=a._blendFunc;a._texture&&a._texture.hasPremultipliedAlpha()?(c.src===cc.SRC_ALPHA&&c.dst===cc.BLEND_DST&&(c.src=cc.ONE),a.opacityModifyRGB=!0):(c.src===cc.ONE&&c.dst===cc.BLEND_DST&&(c.src=cc.SRC_ALPHA),a.opacityModifyRGB=!1)}};a._setTexture=function(a){var c=this._node;if(c._texture!==
a){c._textureLoaded=a?a._textureLoaded:!1;if(c._texture=a)a=a._contentSize,a=cc.rect(0,0,a.width,a.height),c.setTextureRect(a),this._updateBlendFunc();c._textureLoaded&&(cc.renderer.childrenOrderDirty=!0)}};a._checkTextureBoundary=function(a,c,d){a&&a.url&&(d?(d=c.x+c.height,c=c.y+c.width):(d=c.x+c.width,c=c.y+c.height),d>a.width&&cc.error(cc._LogInfos.RectWidth,a.url),c>a.height&&cc.error(cc._LogInfos.RectHeight,a.url))};a.transform=function(a,c){this.originTransform(a,c);var d=this._node,e=d._offsetPosition.x,
f=e+d._rect.width,g=d._offsetPosition.y,h=g+d._rect.height,k=this._worldTransform,d=k.tx,m=k.ty,n=e*k.a,e=e*k.b,p=f*k.a,f=f*k.b,r=h*k.c,h=h*k.d,s=g*k.c,g=g*k.d,k=this._vertices;k[0].x=n+r+d;k[0].y=e+h+m;k[1].x=n+s+d;k[1].y=e+g+m;k[2].x=p+r+d;k[2].y=f+h+m;k[3].x=p+s+d;k[3].y=f+g+m};a.needDraw=function(){var a=this._node._texture;return this._needDraw&&a};a.uploadData=function(a,c,d){var e=this._node,f=e._texture;if(!(f&&f._textureLoaded&&e._rect.width&&e._rect.height&&this._displayedOpacity))return!1;
var f=this._displayedOpacity,g=this._displayedColor.r,h=this._displayedColor.g,k=this._displayedColor.b;if(e._opacityModifyRGB)var m=f/255,g=g*m,h=h*m,k=k*m;this._color[0]=f<<24|k<<16|h<<8|g;e=e._vertexZ;f=this._vertices;g=f.length;k=d;for(d=0;d<g;++d)h=f[d],a[k]=h.x,a[k+1]=h.y,a[k+2]=e,c[k+3]=this._color[0],a[k+4]=h.u,a[k+5]=h.v,k+=6;return g}})();cc.SpriteBatchNode=cc.Node.extend({_blendFunc:null,_texture:null,_className:"SpriteBatchNode",ctor:function(a){cc.Node.prototype.ctor.call(this);this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST);var b;cc.isString(a)?(b=cc.textureCache.getTextureForKey(a))||(b=cc.textureCache.addImage(a)):a instanceof cc.Texture2D&&(b=a);b&&this.initWithTexture(b)},addSpriteWithoutQuad:function(a,b,c){this.addChild(a,b,c);return this},getTextureAtlas:function(){return null},setTextureAtlas:function(a){},
getDescendants:function(){return this._children},initWithFile:function(a,b){var c=cc.textureCache.getTextureForKey(a);c||(c=cc.textureCache.addImage(a));return this.initWithTexture(c,b)},init:function(a,b){var c=cc.textureCache.getTextureForKey(a);c||(c=cc.textureCache.addImage(a));return this.initWithTexture(c,b)},increaseAtlasCapacity:function(){},removeChildAtIndex:function(a,b){this.removeChild(this._children[a],b)},rebuildIndexInOrder:function(a,b){return b},highestAtlasIndexInChild:function(a){var b=
a.children;return b&&0!==b.length?this.highestAtlasIndexInChild(b[b.length-1]):a.zIndex},lowestAtlasIndexInChild:function(a){var b=a.children;return b&&0!==b.length?this.lowestAtlasIndexInChild(b[b.length-1]):a.zIndex},atlasIndexForChild:function(a){return a.zIndex},reorderBatch:function(a){this._reorderChildDirty=a},setBlendFunc:function(a,b){this._blendFunc=void 0===b?a:{src:a,dst:b}},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},updateQuadFromSprite:function(a,
b){cc.assert(a,cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite_2);a instanceof cc.Sprite?(a.dirty=!0,a._renderCmd.transform(this._renderCmd,!0)):cc.log(cc._LogInfos.CCSpriteBatchNode_updateQuadFromSprite)},insertQuadFromSprite:function(a,b){this.addChild(a,b)},insertChild:function(a,b){this.addChild(a,b)},appendChild:function(a){this.sortAllChildren();this.addChild(a.lastLocalZOrder+1)},removeSpriteFromAtlas:function(a,b){this.removeChild(a,b)},initWithTexture:function(a){this.setTexture(a);return!0},
getTexture:function(){return this._texture},setTexture:function(a){this._texture=a;if(a._textureLoaded){var b,c=this._children,d=c.length;for(b=0;b<d;++b)c[b].setTexture(a)}else a.addEventListener("load",function(){var b,c=this._children,d=c.length;for(b=0;b<d;++b)c[b].setTexture(a)},this)},setShaderProgram:function(a){this._renderCmd.setShaderProgram(a);var b,c=this._children,d=c.length;for(b=0;b<d;++b)c[b].setShaderProgram(a)},addChild:function(a,b,c){cc.assert(void 0!==a,cc._LogInfos.CCSpriteBatchNode_addChild_3);
this._isValidChild(a)&&(b=void 0===b?a.zIndex:b,c=void 0===c?a.tag:c,cc.Node.prototype.addChild.call(this,a,b,c),this._renderCmd._shaderProgram&&(a.shaderProgram=this._renderCmd._shaderProgram))},_isValidChild:function(a){return a instanceof cc.Sprite?a.texture!==this._texture?(cc.log(cc._LogInfos.Sprite_addChild_5),!1):!0:(cc.log(cc._LogInfos.Sprite_addChild_4),!1)}});_p=cc.SpriteBatchNode.prototype;cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture);
cc.defineGetterSetter(_p,"shaderProgram",_p.getShaderProgram,_p.setShaderProgram);cc.SpriteBatchNode.create=function(a){return new cc.SpriteBatchNode(a)};cc.SpriteBatchNode.createWithTexture=cc.SpriteBatchNode.create;cc.BakeSprite=cc.Sprite.extend({_cacheCanvas:null,_cacheContext:null,ctor:function(){cc.Sprite.prototype.ctor.call(this);var a=document.createElement("canvas");a.width=a.height=10;this._cacheCanvas=a;this._cacheContext=new cc.CanvasContextWrapper(a.getContext("2d"));var b=new cc.Texture2D;b.initWithElement(a);b.handleLoadedTexture();this.setTexture(b)},getCacheContext:function(){return this._cacheContext},getCacheCanvas:function(){return this._cacheCanvas},resetCanvasSize:function(a,b){var c=this._cacheCanvas,
d=this._cacheContext,e=d._context.strokeStyle,f=d._context.fillStyle;void 0===b&&(b=a.height,a=a.width);c.width=a;c.height=b;e!==d._context.strokeStyle&&(d._context.strokeStyle=e);f!==d._context.fillStyle&&(d._context.fillStyle=f);this.getTexture().handleLoadedTexture();this.setTextureRect(cc.rect(0,0,a,b),!1,null,!1)}});cc.AnimationFrame=cc.Class.extend({_spriteFrame:null,_delayPerUnit:0,_userInfo:null,ctor:function(a,b,c){this._spriteFrame=a||null;this._delayPerUnit=b||0;this._userInfo=c||null},clone:function(){var a=new cc.AnimationFrame;a.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo);return a},copyWithZone:function(a){return cc.clone(this)},copy:function(a){a=new cc.AnimationFrame;a.initWithSpriteFrame(this._spriteFrame.clone(),this._delayPerUnit,this._userInfo);return a},initWithSpriteFrame:function(a,
b,c){this._spriteFrame=a;this._delayPerUnit=b;this._userInfo=c;return!0},getSpriteFrame:function(){return this._spriteFrame},setSpriteFrame:function(a){this._spriteFrame=a},getDelayUnits:function(){return this._delayPerUnit},setDelayUnits:function(a){this._delayPerUnit=a},getUserInfo:function(){return this._userInfo},setUserInfo:function(a){this._userInfo=a}});cc.AnimationFrame.create=function(a,b,c){return new cc.AnimationFrame(a,b,c)};
cc.Animation=cc.Class.extend({_frames:null,_loops:0,_restoreOriginalFrame:!1,_duration:0,_delayPerUnit:0,_totalDelayUnits:0,ctor:function(a,b,c){this._frames=[];if(void 0===a)this.initWithSpriteFrames(null,0);else{var d=a[0];d&&(d instanceof cc.SpriteFrame?this.initWithSpriteFrames(a,b,c):d instanceof cc.AnimationFrame&&this.initWithAnimationFrames(a,b,c))}},getFrames:function(){return this._frames},setFrames:function(a){this._frames=a},addSpriteFrame:function(a){var b=new cc.AnimationFrame;b.initWithSpriteFrame(a,
1,null);this._frames.push(b);this._totalDelayUnits++},addSpriteFrameWithFile:function(a){a=cc.textureCache.addImage(a);var b=cc.rect(0,0,0,0);b.width=a.width;b.height=a.height;a=new cc.SpriteFrame(a,b);this.addSpriteFrame(a)},addSpriteFrameWithTexture:function(a,b){var c=new cc.SpriteFrame(a,b);this.addSpriteFrame(c)},initWithAnimationFrames:function(a,b,c){cc.arrayVerifyType(a,cc.AnimationFrame);this._delayPerUnit=b;this._loops=void 0===c?1:c;this._totalDelayUnits=0;b=this._frames;for(c=b.length=
0;c<a.length;c++){var d=a[c];b.push(d);this._totalDelayUnits+=d.getDelayUnits()}return!0},clone:function(){var a=new cc.Animation;a.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops);a.setRestoreOriginalFrame(this._restoreOriginalFrame);return a},copyWithZone:function(a){a=new cc.Animation;a.initWithAnimationFrames(this._copyFrames(),this._delayPerUnit,this._loops);a.setRestoreOriginalFrame(this._restoreOriginalFrame);return a},_copyFrames:function(){for(var a=[],b=0;b<this._frames.length;b++)a.push(this._frames[b].clone());
return a},copy:function(a){return this.copyWithZone(null)},getLoops:function(){return this._loops},setLoops:function(a){this._loops=a},setRestoreOriginalFrame:function(a){this._restoreOriginalFrame=a},getRestoreOriginalFrame:function(){return this._restoreOriginalFrame},getDuration:function(){return this._totalDelayUnits*this._delayPerUnit},getDelayPerUnit:function(){return this._delayPerUnit},setDelayPerUnit:function(a){this._delayPerUnit=a},getTotalDelayUnits:function(){return this._totalDelayUnits},
initWithSpriteFrames:function(a,b,c){cc.arrayVerifyType(a,cc.SpriteFrame);this._loops=void 0===c?1:c;this._delayPerUnit=b||0;this._totalDelayUnits=0;b=this._frames;b.length=0;if(a){for(c=0;c<a.length;c++){var d=a[c],e=new cc.AnimationFrame;e.initWithSpriteFrame(d,1,null);b.push(e)}this._totalDelayUnits+=a.length}return!0},retain:function(){},release:function(){}});cc.Animation.create=function(a,b,c){return new cc.Animation(a,b,c)};cc.Animation.createWithAnimationFrames=cc.Animation.create;cc.animationCache={_animations:{},addAnimation:function(a,b){this._animations[b]=a},removeAnimation:function(a){a&&this._animations[a]&&delete this._animations[a]},getAnimation:function(a){return this._animations[a]?this._animations[a]:null},_addAnimationsWithDictionary:function(a,b){var c=a.animations;if(c){var d=1,e=a.properties;if(e)for(var d=null!=e.format?parseInt(e.format):d,e=e.spritesheets,f=cc.spriteFrameCache,g=cc.path,h=0;h<e.length;h++)f.addSpriteFrames(g.changeBasename(b,e[h]));switch(d){case 1:this._parseVersion1(c);
break;case 2:this._parseVersion2(c);break;default:cc.log(cc._LogInfos.animationCache__addAnimationsWithDictionary_2)}}else cc.log(cc._LogInfos.animationCache__addAnimationsWithDictionary)},addAnimations:function(a){cc.assert(a,cc._LogInfos.animationCache_addAnimations_2);var b=cc.loader.getRes(a);b?this._addAnimationsWithDictionary(b,a):cc.log(cc._LogInfos.animationCache_addAnimations)},_parseVersion1:function(a){var b=cc.spriteFrameCache,c;for(c in a){var d=a[c],e=d.frames,d=parseFloat(d.delay)||
0,f=null;if(e){for(var f=[],g=0;g<e.length;g++){var h=b.getSpriteFrame(e[g]);if(h){var k=new cc.AnimationFrame;k.initWithSpriteFrame(h,1,null);f.push(k)}else cc.log(cc._LogInfos.animationCache__parseVersion1_2,c,e[g])}0===f.length?cc.log(cc._LogInfos.animationCache__parseVersion1_3,c):(f.length!==e.length&&cc.log(cc._LogInfos.animationCache__parseVersion1_4,c),f=new cc.Animation(f,d,1),cc.animationCache.addAnimation(f,c))}else cc.log(cc._LogInfos.animationCache__parseVersion1,c)}},_parseVersion2:function(a){var b=
cc.spriteFrameCache,c;for(c in a){var d=a[c],e=d.loop,f=parseInt(d.loops),e=e?cc.REPEAT_FOREVER:isNaN(f)?1:f,f=d.restoreOriginalFrame&&!0==d.restoreOriginalFrame?!0:!1,g=d.frames;if(g){for(var h=[],k=0;k<g.length;k++){var m=g[k],n=m.spriteframe,p=b.getSpriteFrame(n);if(p){var n=parseFloat(m.delayUnits)||0,m=m.notification,r=new cc.AnimationFrame;r.initWithSpriteFrame(p,n,m);h.push(r)}else cc.log(cc._LogInfos.animationCache__parseVersion2_2,c,n)}d=parseFloat(d.delayPerUnit)||0;g=new cc.Animation;g.initWithAnimationFrames(h,
d,e);g.setRestoreOriginalFrame(f);cc.animationCache.addAnimation(g,c)}else cc.log(cc._LogInfos.animationCache__parseVersion2,c)}},_clear:function(){this._animations={}}};cc.SpriteFrame=cc.Class.extend({_offset:null,_originalSize:null,_rectInPixels:null,_rotated:!1,_rect:null,_offsetInPixels:null,_originalSizeInPixels:null,_texture:null,_textureFilename:"",_textureLoaded:!1,ctor:function(a,b,c,d,e){this._offset=cc.p(0,0);this._offsetInPixels=cc.p(0,0);this._originalSize=cc.size(0,0);this._rotated=!1;this._originalSizeInPixels=cc.size(0,0);this._textureFilename="";this._texture=null;this._textureLoaded=!1;void 0!==a&&void 0!==b&&(void 0===c||void 0===d||void 0===e?
this.initWithTexture(a,b):this.initWithTexture(a,b,c,d,e))},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(a,b){this.addEventListener("load",a,b)},getRectInPixels:function(){var a=this._rectInPixels;return cc.rect(a.x,a.y,a.width,a.height)},setRectInPixels:function(a){this._rectInPixels||(this._rectInPixels=cc.rect(0,0,0,0));this._rectInPixels.x=a.x;this._rectInPixels.y=a.y;this._rectInPixels.width=a.width;this._rectInPixels.height=a.height;this._rect=cc.rectPixelsToPoints(a)},
isRotated:function(){return this._rotated},setRotated:function(a){this._rotated=a},getRect:function(){var a=this._rect;return cc.rect(a.x,a.y,a.width,a.height)},setRect:function(a){this._rect||(this._rect=cc.rect(0,0,0,0));this._rect.x=a.x;this._rect.y=a.y;this._rect.width=a.width;this._rect.height=a.height;this._rectInPixels=cc.rectPointsToPixels(this._rect)},getOffsetInPixels:function(){return cc.p(this._offsetInPixels)},setOffsetInPixels:function(a){this._offsetInPixels.x=a.x;this._offsetInPixels.y=
a.y;cc._pointPixelsToPointsOut(this._offsetInPixels,this._offset)},getOriginalSizeInPixels:function(){return cc.size(this._originalSizeInPixels)},setOriginalSizeInPixels:function(a){this._originalSizeInPixels.width=a.width;this._originalSizeInPixels.height=a.height},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(a){this._originalSize.width=a.width;this._originalSize.height=a.height},getTexture:function(){if(this._texture)return this._texture;if(""!==this._textureFilename){var a=
cc.textureCache.addImage(this._textureFilename);a&&(this._textureLoaded=a.isLoaded());return a}return null},setTexture:function(a){if(this._texture!==a){var b=a.isLoaded();this._textureLoaded=b;this._texture=a;b||a.addEventListener("load",function(a){this._textureLoaded=!0;if(this._rotated&&cc._renderType===cc.game.RENDER_TYPE_CANVAS){var b=a.getHtmlElementObj(),b=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(b,this.getRect()),e=new cc.Texture2D;e.initWithElement(b);e.handleLoadedTexture();this.setTexture(e);
b=this.getRect();this.setRect(cc.rect(0,0,b.width,b.height))}b=this._rect;0===b.width&&0===b.height&&(b=a.width,a=a.height,this._rect.width=b,this._rect.height=a,this._rectInPixels=cc.rectPointsToPixels(this._rect),this._originalSizeInPixels.width=this._rectInPixels.width,this._originalSizeInPixels.height=this._rectInPixels.height,this._originalSize.width=b,this._originalSize.height=a);this.dispatchEvent("load")},this)}},getOffset:function(){return cc.p(this._offset)},setOffset:function(a){this._offset.x=
a.x;this._offset.y=a.y},clone:function(){var a=new cc.SpriteFrame;a.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels);a.setTexture(this._texture);return a},copyWithZone:function(){var a=new cc.SpriteFrame;a.initWithTexture(this._textureFilename,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels);a.setTexture(this._texture);return a},copy:function(){return this.copyWithZone()},initWithTexture:function(a,
b,c,d,e){2===arguments.length&&(b=cc.rectPointsToPixels(b));d=d||cc.p(0,0);e=e||b;c=c||!1;"string"===typeof a?(this._texture=null,this._textureFilename=a):a instanceof cc.Texture2D&&this.setTexture(a);a=this.getTexture();this._rectInPixels=b;this._rect=cc.rectPixelsToPoints(b);if(a&&a.url&&a.isLoaded()){var f,g;c?(f=b.x+b.height,g=b.y+b.width):(f=b.x+b.width,g=b.y+b.height);f>a.getPixelsWide()&&cc.error(cc._LogInfos.RectWidth,a.url);g>a.getPixelsHigh()&&cc.error(cc._LogInfos.RectHeight,a.url)}this._offsetInPixels.x=
d.x;this._offsetInPixels.y=d.y;cc._pointPixelsToPointsOut(d,this._offset);this._originalSizeInPixels.width=e.width;this._originalSizeInPixels.height=e.height;cc._sizePixelsToPointsOut(e,this._originalSize);this._rotated=c;return!0}});cc.EventHelper.prototype.apply(cc.SpriteFrame.prototype);cc.SpriteFrame.create=function(a,b,c,d,e){return new cc.SpriteFrame(a,b,c,d,e)};cc.SpriteFrame.createWithTexture=cc.SpriteFrame.create;
cc.SpriteFrame._frameWithTextureForCanvas=function(a,b,c,d,e){var f=new cc.SpriteFrame;f._texture=a;f._rectInPixels=b;f._rect=cc.rectPixelsToPoints(b);f._offsetInPixels.x=d.x;f._offsetInPixels.y=d.y;cc._pointPixelsToPointsOut(f._offsetInPixels,f._offset);f._originalSizeInPixels.width=e.width;f._originalSizeInPixels.height=e.height;cc._sizePixelsToPointsOut(f._originalSizeInPixels,f._originalSize);f._rotated=c;return f};cc.spriteFrameCache={_CCNS_REG1:/^\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*$/,_CCNS_REG2:/^\s*\{\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*,\s*\{\s*([\-]?\d+[.]?\d*)\s*,\s*([\-]?\d+[.]?\d*)\s*\}\s*\}\s*$/,_spriteFrames:{},_spriteFramesAliases:{},_frameConfigCache:{},_rectFromString:function(a){return(a=this._CCNS_REG2.exec(a))?cc.rect(parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]),parseFloat(a[4])):cc.rect(0,0,0,0)},_pointFromString:function(a){return(a=this._CCNS_REG1.exec(a))?
cc.p(parseFloat(a[1]),parseFloat(a[2])):cc.p(0,0)},_sizeFromString:function(a){return(a=this._CCNS_REG1.exec(a))?cc.size(parseFloat(a[1]),parseFloat(a[2])):cc.size(0,0)},_getFrameConfig:function(a){var b=cc.loader.getRes(a);cc.assert(b,cc._LogInfos.spriteFrameCache__getFrameConfig_2,a);cc.loader.release(a);if(b._inited)return this._frameConfigCache[a]=b;this._frameConfigCache[a]=this._parseFrameConfig(b);return this._frameConfigCache[a]},_getFrameConfigByJsonObject:function(a,b){cc.assert(b,cc._LogInfos.spriteFrameCache__getFrameConfig_2,
a);this._frameConfigCache[a]=this._parseFrameConfig(b);return this._frameConfigCache[a]},_parseFrameConfig:function(a){var b=a.frames,c=a.metadata||a.meta;a={};var d={},e=0;c&&(e=c.format,e=1>=e.length?parseInt(e):e,d.image=c.textureFileName||c.textureFileName||c.image);for(var f in b){var g=b[f];if(g){c={};if(0==e){c.rect=cc.rect(g.x,g.y,g.width,g.height);c.rotated=!1;c.offset=cc.p(g.offsetX,g.offsetY);var h=g.originalWidth,g=g.originalHeight;h&&g||cc.log(cc._LogInfos.spriteFrameCache__getFrameConfig);
h=Math.abs(h);g=Math.abs(g);c.size=cc.size(h,g)}else if(1==e||2==e)c.rect=this._rectFromString(g.frame),c.rotated=g.rotated||!1,c.offset=this._pointFromString(g.offset),c.size=this._sizeFromString(g.sourceSize);else if(3==e){var h=this._sizeFromString(g.spriteSize),k=this._rectFromString(g.textureRect);h&&(k=cc.rect(k.x,k.y,h.width,h.height));c.rect=k;c.rotated=g.textureRotated||!1;c.offset=this._pointFromString(g.spriteOffset);c.size=this._sizeFromString(g.spriteSourceSize);c.aliases=g.aliases}else h=
g.frame,k=g.sourceSize,f=g.filename||f,c.rect=cc.rect(h.x,h.y,h.w,h.h),c.rotated=g.rotated||!1,c.offset=cc.p(0,0),c.size=cc.size(k.w,k.h);a[f]=c}}return{_inited:!0,frames:a,meta:d}},_addSpriteFramesByObject:function(a,b,c){cc.assert(a,cc._LogInfos.spriteFrameCache_addSpriteFrames_2);b&&b.frames&&(b=this._frameConfigCache[a]||this._getFrameConfigByJsonObject(a,b),this._createSpriteFrames(a,b,c))},_createSpriteFrames:function(a,b,c){var d=b.frames;b=b.meta;c?c instanceof cc.Texture2D||(cc.isString(c)?
c=cc.textureCache.addImage(c):cc.assert(0,cc._LogInfos.spriteFrameCache_addSpriteFrames_3)):(c=cc.path.changeBasename(a,b.image||".png"),c=cc.textureCache.addImage(c));a=this._spriteFramesAliases;b=this._spriteFrames;for(var e in d){var f=d[e],g=b[e];if(!g){g=new cc.SpriteFrame(c,cc.rect(f.rect),f.rotated,f.offset,f.size);if(f=f.aliases)for(var h=0,k=f.length;h<k;h++){var m=f[h];a[m]&&cc.log(cc._LogInfos.spriteFrameCache_addSpriteFrames,m);a[m]=e}cc._renderType===cc.game.RENDER_TYPE_CANVAS&&g.isRotated()&&
g.getTexture().isLoaded()&&(f=g.getTexture().getHtmlElementObj(),f=cc.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(f,g.getRectInPixels()),h=new cc.Texture2D,h.initWithElement(f),h.handleLoadedTexture(),g.setTexture(h),g.setRotated(!1),f=g._rect,g.setRect(cc.rect(0,0,f.width,f.height)));b[e]=g}}},addSpriteFrames:function(a,b){cc.assert(a,cc._LogInfos.spriteFrameCache_addSpriteFrames_2);var c=this._frameConfigCache[a]||cc.loader.getRes(a);c&&c.frames&&(c=this._frameConfigCache[a]||this._getFrameConfig(a),
this._createSpriteFrames(a,c,b))},_checkConflict:function(a){a=a.frames;for(var b in a)this._spriteFrames[b]&&cc.log(cc._LogInfos.spriteFrameCache__checkConflict,b)},addSpriteFrame:function(a,b){this._spriteFrames[b]=a},removeSpriteFrames:function(){this._spriteFrames={};this._spriteFramesAliases={}},removeSpriteFrameByName:function(a){a&&(this._spriteFramesAliases[a]&&delete this._spriteFramesAliases[a],this._spriteFrames[a]&&delete this._spriteFrames[a])},removeSpriteFramesFromFile:function(a){var b=
this._spriteFrames,c=this._spriteFramesAliases;if(a=this._frameConfigCache[a]){a=a.frames;for(var d in a)if(b[d]){delete b[d];for(var e in c)c[e]===d&&delete c[e]}}},removeSpriteFramesFromTexture:function(a){var b=this._spriteFrames,c=this._spriteFramesAliases,d;for(d in b){var e=b[d];if(e&&e.getTexture()===a){delete b[d];for(var f in c)c[f]===d&&delete c[f]}}},getSpriteFrame:function(a){var b=this._spriteFrames[a];if(!b){var c=this._spriteFramesAliases[a];c&&((b=this._spriteFrames[c.toString()])||
delete this._spriteFramesAliases[a])}b||console.warn("sprite frame not found: "+a);return b},_clear:function(){this._spriteFrames={};this._spriteFramesAliases={};this._frameConfigCache={}}};cc.configuration={ERROR:0,STRING:1,INT:2,DOUBLE:3,BOOLEAN:4,_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:{},_inited:!1,_init:function(){var a=this._valueDict;a["cocos2d.x.version"]=cc.ENGINE_VERSION;a["cocos2d.x.compiled_with_profiler"]=!1;a["cocos2d.x.compiled_with_gl_state_cache"]=cc.ENABLE_GL_STATE_CACHE;this._inited=
!0},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsETC:function(){return!1},supportsS3TC:function(){return!1},supportsATITC:function(){return!1},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},
supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(a){return-1<this._GlExtensions.indexOf(a)},getValue:function(a,b){this._inited||this._init();var c=this._valueDict;return c[a]?c[a]:b},setValue:function(a,b){this._valueDict[a]=b},dumpInfo:function(){0===cc.ENABLE_GL_STATE_CACHE&&(cc.log(""),cc.log(cc._LogInfos.configuration_dumpInfo),cc.log(""))},gatherGPUInfo:function(){if(cc._renderType!==cc.game.RENDER_TYPE_CANVAS){this._inited||this._init();var a=
cc._renderContext,b=this._valueDict;b["gl.vendor"]=a.getParameter(a.VENDOR);b["gl.renderer"]=a.getParameter(a.RENDERER);b["gl.version"]=a.getParameter(a.VERSION);this._GlExtensions="";for(var c=a.getSupportedExtensions(),d=0;d<c.length;d++)this._GlExtensions+=c[d]+" ";this._maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE);b["gl.max_texture_size"]=this._maxTextureSize;this._maxTextureUnits=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS);b["gl.max_texture_units"]=this._maxTextureUnits;this._supportsPVRTC=
this.checkForGLExtension("GL_IMG_texture_compression_pvrtc");b["gl.supports_PVRTC"]=this._supportsPVRTC;this._supportsNPOT=!1;b["gl.supports_NPOT"]=this._supportsNPOT;this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888");b["gl.supports_BGRA8888"]=this._supportsBGRA8888;this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer");b["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer;this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object");
b["gl.supports_vertex_array_object"]=this._supportsShareableVAO;cc.checkGLErrorDebug()}},loadConfigFile:function(a){this._inited||this._init();var b=cc.loader.getRes(a);if(!b)throw Error("Please load the resource first : "+a);cc.assert(b,cc._LogInfos.configuration_loadConfigFile_2,a);if(b=b.data)for(var c in b)this._valueDict[c]=b[c];else cc.log(cc._LogInfos.configuration_loadConfigFile,a)}};cc.g_NumberOfDraws=0;
cc.Director=cc.Class.extend({_landscape:!1,_nextDeltaTimeZero:!1,_paused:!1,_purgeDirectorInNextLoop:!1,_sendCleanupToScene:!1,_animationInterval:0,_oldAnimationInterval:0,_projection:0,_contentScaleFactor:1,_deltaTime:0,_winSizeInPoints:null,_lastUpdate:null,_nextScene:null,_notificationNode:null,_openGLView:null,_scenesStack:null,_projectionDelegate:null,_runningScene:null,_totalFrames:0,_secondsPerFrame:0,_dirtyRegion:null,_scheduler:null,_actionManager:null,_eventProjectionChanged:null,_eventAfterUpdate:null,
_eventAfterVisit:null,_eventAfterDraw:null,ctor:function(){var a=this;a._lastUpdate=Date.now();cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){a._lastUpdate=Date.now()})},init:function(){this._oldAnimationInterval=this._animationInterval=1/cc.defaultFPS;this._scenesStack=[];this._projection=cc.Director.PROJECTION_DEFAULT;this._projectionDelegate=null;this._totalFrames=0;this._lastUpdate=Date.now();this._purgeDirectorInNextLoop=this._paused=!1;this._winSizeInPoints=cc.size(0,0);this._openGLView=
null;this._contentScaleFactor=1;this._scheduler=new cc.Scheduler;this._actionManager=cc.ActionManager?new cc.ActionManager:null;this._eventAfterUpdate=new cc.EventCustom(cc.Director.EVENT_AFTER_UPDATE);this._eventAfterUpdate.setUserData(this);this._eventAfterVisit=new cc.EventCustom(cc.Director.EVENT_AFTER_VISIT);this._eventAfterVisit.setUserData(this);this._eventAfterDraw=new cc.EventCustom(cc.Director.EVENT_AFTER_DRAW);this._eventAfterDraw.setUserData(this);this._eventProjectionChanged=new cc.EventCustom(cc.Director.EVENT_PROJECTION_CHANGED);
this._eventProjectionChanged.setUserData(this);return!0},calculateDeltaTime:function(){var a=Date.now();this._nextDeltaTimeZero?(this._deltaTime=0,this._nextDeltaTimeZero=!1):this._deltaTime=(a-this._lastUpdate)/1E3;0<cc.game.config[cc.game.CONFIG_KEY.debugMode]&&0.2<this._deltaTime&&(this._deltaTime=1/60);this._lastUpdate=a},convertToGL:function(a){var b=document.documentElement,c=cc.view,d=b.getBoundingClientRect();d.left+=window.pageXOffset-b.clientLeft;d.top+=window.pageYOffset-b.clientTop;b=
c._devicePixelRatio*(a.x-d.left);a=c._devicePixelRatio*(d.top+d.height-a.y);return c._isRotated?{x:c._viewPortRect.width-a,y:b}:{x:b,y:a}},convertToUI:function(a){var b=document.documentElement,c=cc.view,d=b.getBoundingClientRect();d.left+=window.pageXOffset-b.clientLeft;d.top+=window.pageYOffset-b.clientTop;b={x:0,y:0};c._isRotated?(b.x=d.left+a.y/c._devicePixelRatio,b.y=d.top+d.height-(c._viewPortRect.width-a.x)/c._devicePixelRatio):(b.x=d.left+a.x/c._devicePixelRatio,b.y=d.top+d.height-a.y/c._devicePixelRatio);
return b},drawScene:function(){var a=cc.renderer;this.calculateDeltaTime();this._paused||(this._actionManager.update(this._deltaTime),this._scheduler.update(this._deltaTime),cc.eventManager.dispatchEvent(this._eventAfterUpdate));this._nextScene&&this.setNextScene();this._runningScene&&(a.childrenOrderDirty?(cc.renderer.clearRenderCommands(),cc.renderer.assignedZ=0,this._runningScene._renderCmd._curLevel=0,this._runningScene.visit(),a.resetFlag()):a.transformDirty()&&a.transform());a.clear();this._notificationNode&&
this._notificationNode.visit();cc.eventManager.dispatchEvent(this._eventAfterVisit);cc.g_NumberOfDraws=0;a.rendering(cc._renderContext);this._totalFrames++;cc.eventManager.dispatchEvent(this._eventAfterDraw);cc.eventManager.frameUpdateListeners();this._calculateMPF()},end:function(){this._purgeDirectorInNextLoop=!0},getContentScaleFactor:function(){return this._contentScaleFactor},getNotificationNode:function(){return this._notificationNode},getWinSize:function(){return cc.size(this._winSizeInPoints)},
getWinSizeInPixels:function(){return cc.size(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor)},getVisibleSize:null,getVisibleOrigin:null,getZEye:null,pause:function(){this._paused||(this._oldAnimationInterval=this._animationInterval,this.setAnimationInterval(0.25),this._paused=!0)},popScene:function(){cc.assert(this._runningScene,cc._LogInfos.Director_popScene);this._scenesStack.pop();var a=this._scenesStack.length;0===a?this.end():(this._sendCleanupToScene=
!0,this._nextScene=this._scenesStack[a-1])},purgeCachedData:function(){cc.animationCache._clear();cc.spriteFrameCache._clear();cc.textureCache._clear()},purgeDirector:function(){this.getScheduler().unscheduleAll();cc.eventManager&&cc.eventManager.setEnabled(!1);this._runningScene&&(this._runningScene._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),this._runningScene._performRecursive(cc.Node._stateCallbackType.onExit),this._runningScene._performRecursive(cc.Node._stateCallbackType.cleanup));
this._nextScene=this._runningScene=null;this._scenesStack.length=0;this.stopAnimation();this.purgeCachedData();cc.checkGLErrorDebug()},pushScene:function(a){cc.assert(a,cc._LogInfos.Director_pushScene);this._sendCleanupToScene=!1;this._scenesStack.push(a);this._nextScene=a},runScene:function(a){cc.assert(a,cc._LogInfos.Director_pushScene);if(this._runningScene){var b=this._scenesStack.length;0===b?(this._sendCleanupToScene=!0,this._scenesStack[b]=a):(this._sendCleanupToScene=!0,this._scenesStack[b-
1]=a);this._nextScene=a}else this.pushScene(a),this.startAnimation()},resume:function(){this._paused&&(this.setAnimationInterval(this._oldAnimationInterval),(this._lastUpdate=Date.now())||cc.log(cc._LogInfos.Director_resume),this._paused=!1,this._deltaTime=0)},setContentScaleFactor:function(a){a!==this._contentScaleFactor&&(this._contentScaleFactor=a)},setDepthTest:null,setClearColor:null,setDefaultValues:function(){},setNextDeltaTimeZero:function(a){this._nextDeltaTimeZero=a},setNextScene:function(){var a=
!1,b=!1;cc.TransitionScene&&(a=this._runningScene?this._runningScene instanceof cc.TransitionScene:!1,b=this._nextScene?this._nextScene instanceof cc.TransitionScene:!1);if(!b){if(b=this._runningScene)b._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),b._performRecursive(cc.Node._stateCallbackType.onExit);this._sendCleanupToScene&&b&&b._performRecursive(cc.Node._stateCallbackType.cleanup)}this._runningScene=this._nextScene;cc.renderer.childrenOrderDirty=!0;this._nextScene=null;
a||null===this._runningScene||(this._runningScene._performRecursive(cc.Node._stateCallbackType.onEnter),this._runningScene._performRecursive(cc.Node._stateCallbackType.onEnterTransitionDidFinish))},setNotificationNode:function(a){cc.renderer.childrenOrderDirty=!0;this._notificationNode&&(this._notificationNode._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),this._notificationNode._performRecursive(cc.Node._stateCallbackType.onExit),this._notificationNode._performRecursive(cc.Node._stateCallbackType.cleanup));
if(this._notificationNode=a)this._notificationNode._performRecursive(cc.Node._stateCallbackType.onEnter),this._notificationNode._performRecursive(cc.Node._stateCallbackType.onEnterTransitionDidFinish)},getDelegate:function(){return this._projectionDelegate},setDelegate:function(a){this._projectionDelegate=a},setOpenGLView:null,setProjection:null,setViewport:null,getOpenGLView:null,getProjection:null,setAlphaBlending:null,isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},
getAnimationInterval:function(){return this._animationInterval},isDisplayStats:function(){return cc.profiler?cc.profiler.isShowingStats():!1},setDisplayStats:function(a){cc.profiler&&(a?cc.profiler.showStats():cc.profiler.hideStats())},getSecondsPerFrame:function(){return this._secondsPerFrame},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getTotalFrames:function(){return this._totalFrames},popToRootScene:function(){this.popToSceneStackLevel(1)},
popToSceneStackLevel:function(a){cc.assert(this._runningScene,cc._LogInfos.Director_popToSceneStackLevel_2);var b=this._scenesStack,c=b.length;if(0===a)this.end();else if(!(a>=c)){for(;c>a;){var d=b.pop();d.running&&(d._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),d._performRecursive(cc.Node._stateCallbackType.onExit));d._performRecursive(cc.Node._stateCallbackType.cleanup);c--}this._nextScene=b[b.length-1];this._sendCleanupToScene=!0}},getScheduler:function(){return this._scheduler},
setScheduler:function(a){this._scheduler!==a&&(this._scheduler=a)},getActionManager:function(){return this._actionManager},setActionManager:function(a){this._actionManager!==a&&(this._actionManager=a)},getDeltaTime:function(){return this._deltaTime},_calculateMPF:function(){this._secondsPerFrame=(Date.now()-this._lastUpdate)/1E3}});cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed";cc.Director.EVENT_AFTER_UPDATE="director_after_update";cc.Director.EVENT_AFTER_VISIT="director_after_visit";
cc.Director.EVENT_AFTER_DRAW="director_after_draw";cc.DisplayLinkDirector=cc.Director.extend({invalid:!1,startAnimation:function(){this._nextDeltaTimeZero=!0;this.invalid=!1},mainLoop:function(){this._purgeDirectorInNextLoop?(this._purgeDirectorInNextLoop=!1,this.purgeDirector()):this.invalid||this.drawScene()},stopAnimation:function(){this.invalid=!0},setAnimationInterval:function(a){this._animationInterval=a;this.invalid||(this.stopAnimation(),this.startAnimation())}});
cc.Director.sharedDirector=null;cc.Director.firstUseDirector=!0;cc.Director._getInstance=function(){cc.Director.firstUseDirector&&(cc.Director.firstUseDirector=!1,cc.Director.sharedDirector=new cc.DisplayLinkDirector,cc.Director.sharedDirector.init());return cc.Director.sharedDirector};cc.defaultFPS=60;cc.Director.PROJECTION_2D=0;cc.Director.PROJECTION_3D=1;cc.Director.PROJECTION_CUSTOM=3;cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_2D;cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var a=cc.Director.prototype;a.getProjection=function(a){return this._projection};a.setProjection=function(a){this._projection=a;cc.eventManager.dispatchEvent(this._eventProjectionChanged)};a.setDepthTest=function(){};a.setClearColor=function(a){cc.renderer._clearColor=a;cc.renderer._clearFillStyle="rgb("+a.r+","+a.g+","+a.b+")"};a.setOpenGLView=function(a){this._winSizeInPoints.width=
cc._canvas.width;this._winSizeInPoints.height=cc._canvas.height;this._openGLView=a||cc.view;cc.eventManager&&cc.eventManager.setEnabled(!0)};a.getVisibleSize=function(){return this.getWinSize()};a.getVisibleOrigin=function(){return cc.p(0,0)}}else cc.Director._fpsImage=new Image,cc.Director._fpsImage.addEventListener("load",function(){cc.Director._fpsImageLoaded=!0}),cc._fpsImage&&(cc.Director._fpsImage.src=cc._fpsImage)});cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){cc.DirectorDelegate=cc.Class.extend({updateProjection:function(){}});var a=cc.Director.prototype,b=function(a){if(a&&a._renderCmd){a._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty);var d=a._children;for(a=0;a<d.length;a++)b(d[a])}};cc.eventManager.addCustomListener(cc.Director.EVENT_PROJECTION_CHANGED,function(){for(var a=cc.director._scenesStack,d=0;d<a.length;d++)b(a[d])});
a.setProjection=function(a){var b=this._winSizeInPoints;this.setViewport();var e=this._openGLView,f=e._viewPortRect.x/e._scaleX,g=e._viewPortRect.y/e._scaleY;switch(a){case cc.Director.PROJECTION_2D:cc.kmGLMatrixMode(cc.KM_GL_PROJECTION);cc.kmGLLoadIdentity();e=cc.math.Matrix4.createOrthographicProjection(0,b.width,0,b.height,-1024,1024);cc.kmGLMultMatrix(e);cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW);cc.kmGLLoadIdentity();break;case cc.Director.PROJECTION_3D:var h=this.getZEye(),k=new cc.math.Matrix4,
e=new cc.math.Matrix4;cc.kmGLMatrixMode(cc.KM_GL_PROJECTION);cc.kmGLLoadIdentity();k=cc.math.Matrix4.createPerspectiveProjection(60,b.width/b.height,0.1,2*h);cc.kmGLMultMatrix(k);h=new cc.math.Vec3(-f+b.width/2,-g+b.height/2,h);b=new cc.math.Vec3(-f+b.width/2,-g+b.height/2,0);f=new cc.math.Vec3(0,1,0);e.lookAt(h,b,f);cc.kmGLMultMatrix(e);cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW);cc.kmGLLoadIdentity();break;case cc.Director.PROJECTION_CUSTOM:this._projectionDelegate&&this._projectionDelegate.updateProjection();
break;default:cc.log(cc._LogInfos.Director_setProjection)}this._projection=a;cc.eventManager.dispatchEvent(this._eventProjectionChanged);cc.setProjectionMatrixDirty();cc.renderer.childrenOrderDirty=!0};a.setDepthTest=function(a){cc.renderer.setDepthTest(a)};a.setClearColor=function(a){cc.renderer._clearColor=a};a.setOpenGLView=function(a){this._winSizeInPoints.width=cc._canvas.width;this._winSizeInPoints.height=cc._canvas.height;this._openGLView=a||cc.view;a=cc.configuration;a.gatherGPUInfo();a.dumpInfo();
this.setGLDefaultValues();cc.eventManager&&cc.eventManager.setEnabled(!0)};a.getVisibleSize=function(){return this._openGLView.getVisibleSize()};a.getVisibleOrigin=function(){return this._openGLView.getVisibleOrigin()};a.getZEye=function(){return this._winSizeInPoints.height/1.1546999375};a.setViewport=function(){var a=this._openGLView;if(a){var b=this._winSizeInPoints;a.setViewPortInPoints(-a._viewPortRect.x/a._scaleX,-a._viewPortRect.y/a._scaleY,b.width,b.height)}};a.getOpenGLView=function(){return this._openGLView};
a.getProjection=function(){return this._projection};a.setAlphaBlending=function(a){a?cc.glBlendFunc(cc.BLEND_SRC,cc.BLEND_DST):cc.glBlendFunc(cc._renderContext.ONE,cc._renderContext.ZERO)};a.setGLDefaultValues=function(){this.setAlphaBlending(!0);this.setProjection(this._projection);cc._renderContext.clearColor(0,0,0,0)}}});(function(){var a=function(a,b,c,d,e,f,g){this.prev=a;this.next=b;this.callback=c;this.target=d;this.priority=e;this.paused=f;this.markedForDeletion=g},b=[];a.get=function(c,d,e,f,g,h,u){var t=b.pop();t?(t.prev=c,t.next=d,t.callback=e,t.target=f,t.priority=g,t.paused=h,t.markedForDeletion=u):t=new a(c,d,e,f,g,h,u);return t};a.put=function(a){a.prev=null;a.next=null;a.callback=null;a.target=null;a.priority=0;a.paused=!1;a.markedForDeletion=!1;20>b.length&&b.push(a)};var c=function(a,b,c,d){this.list=
a;this.entry=b;this.target=c;this.callback=d},d=[];c.get=function(a,b,e,f){var g=d.pop();g?(g.list=a,g.entry=b,g.target=e,g.callback=f):g=new c(a,b,e,f);return g};c.put=function(a){a.list=null;a.entry=null;a.target=null;a.callback=null;20>d.length&&d.push(a)};var e=function(a,b,c,d,e,f){this.timers=a;this.target=b;this.timerIndex=c;this.currentTimer=d;this.currentTimerSalvaged=e;this.paused=f},f=[];e.get=function(a,b,c,d,g,h){var u=f.pop();u?(u.timers=a,u.target=b,u.timerIndex=c,u.currentTimer=d,
u.currentTimerSalvaged=g,u.paused=h):u=new e(a,b,c,d,g,h);return u};e.put=function(a){a.timers=null;a.target=null;a.timerIndex=0;a.currentTimer=null;a.currentTimerSalvaged=!1;a.paused=!1;20>f.length&&f.push(a)};var g=function(){this._scheduler=null;this._elapsed=-1;this._useDelay=this._runForever=!1;this._interval=this._delay=this._repeat=this._timesExecuted=0;this._key=this._callback=this._target=null};cc.inject({initWithCallback:function(a,b,c,d,e,f,g){this._scheduler=a;this._target=c;this._callback=
b;g&&(this._key=g);this._elapsed=-1;this._interval=d;this._delay=f;this._useDelay=0<this._delay;this._repeat=e;this._runForever=this._repeat===cc.REPEAT_FOREVER;return!0},getInterval:function(){return this._interval},setInterval:function(a){this._interval=a},update:function(a){-1===this._elapsed?this._timesExecuted=this._elapsed=0:(this._elapsed+=a,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),
this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},getCallback:function(){return this._callback},getKey:function(){return this._key},trigger:function(){this._target&&this._callback&&this._callback.call(this._target,this._elapsed)},cancel:function(){this._scheduler.unschedule(this._callback,this._target)}},g.prototype);
var h=[];g.get=function(){return h.pop()||new g};g.put=function(a){a._scheduler=null;a._elapsed=-1;a._runForever=!1;a._useDelay=!1;a._timesExecuted=0;a._repeat=0;a._delay=0;a._interval=0;a._target=null;a._callback=null;a._key=null;20>h.length&&h.push(a)};cc.Scheduler=cc.Class.extend({_timeScale:1,_updatesNegList:null,_updates0List:null,_updatesPosList:null,_hashForTimers:null,_arrayForTimers:null,_hashForUpdates:null,_currentTarget:null,_currentTargetSalvaged:!1,_updateHashLocked:!1,ctor:function(){this._timeScale=
1;this._updatesNegList=[];this._updates0List=[];this._updatesPosList=[];this._hashForUpdates={};this._hashForTimers={};this._currentTarget=null;this._updateHashLocked=this._currentTargetSalvaged=!1;this._arrayForTimers=[]},_schedulePerFrame:function(a,b,c,d){var e=this._hashForUpdates[b.__instanceId];if(e&&e.entry)if(e.entry.priority!==c){if(this._updateHashLocked){cc.log("warning: you CANNOT change update priority in scheduled function");e.entry.markedForDeletion=!1;e.entry.paused=d;return}this.unscheduleUpdate(b)}else{e.entry.markedForDeletion=
!1;e.entry.paused=d;return}0===c?this._appendIn(this._updates0List,a,b,d):0>c?this._priorityIn(this._updatesNegList,a,b,c,d):this._priorityIn(this._updatesPosList,a,b,c,d)},_removeHashElement:function(a){delete this._hashForTimers[a.target.__instanceId];for(var b=this._arrayForTimers,c=0,d=b.length;c<d;c++)if(b[c]===a){b.splice(c,1);break}e.put(a)},_removeUpdateFromHash:function(b){if(element=this._hashForUpdates[b.target.__instanceId]){b=element.list;for(var d=element.entry,e=0,f=b.length;e<f;e++)if(b[e]===
d){b.splice(e,1);break}delete this._hashForUpdates[element.target.__instanceId];a.put(d);c.put(element)}},_priorityIn:function(b,d,e,f,g){d=a.get(null,null,d,e,f,g,!1);if(b){g=b.length-1;for(var h=0;h<=g&&!(f<b[h].priority);h++);b.splice(h,0,d)}else b=[],b.push(d);this._hashForUpdates[e.__instanceId]=c.get(b,d,e,null);return b},_appendIn:function(b,d,e,f){d=a.get(null,null,d,e,0,f,!1);b.push(d);this._hashForUpdates[e.__instanceId]=c.get(b,d,e,null,null)},setTimeScale:function(a){this._timeScale=a},
getTimeScale:function(){return this._timeScale},update:function(a){this._updateHashLocked=!0;1!==this._timeScale&&(a*=this._timeScale);var b,c,d,e;b=0;c=this._updatesNegList;for(d=c.length;b<d;b++)e=c[b],e.paused||e.markedForDeletion||e.callback(a);b=0;c=this._updates0List;for(d=c.length;b<d;b++)e=c[b],e.paused||e.markedForDeletion||e.callback(a);b=0;c=this._updatesPosList;for(d=c.length;b<d;b++)e=c[b],e.paused||e.markedForDeletion||e.callback(a);d=this._arrayForTimers;for(b=0;b<d.length;b++){this._currentTarget=
c=d[b];this._currentTargetSalvaged=!1;if(!c.paused)for(c.timerIndex=0;c.timerIndex<c.timers.length;++c.timerIndex)c.currentTimer=c.timers[c.timerIndex],c.currentTimerSalvaged=!1,c.currentTimer.update(a),c.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&this._removeHashElement(this._currentTarget)}b=0;for(c=this._updatesNegList;b<c.length;)e=c[b],e.markedForDeletion?this._removeUpdateFromHash(e):b++;b=0;for(c=this._updates0List;b<c.length;)e=c[b],e.markedForDeletion?
this._removeUpdateFromHash(e):b++;b=0;for(c=this._updatesPosList;b<c.length;)e=c[b],e.markedForDeletion?this._removeUpdateFromHash(e):b++;this._updateHashLocked=!1;this._currentTarget=null},scheduleCallbackForTarget:function(a,b,c,d,e,f){this.schedule(b,a,c,d,e,f,a.__instanceId+"")},schedule:function(a,b,c,d,f,h,u){if("function"!==typeof a){var t=a;a=b;b=t}if(4===arguments.length||5===arguments.length)u=f,h=d,d=cc.REPEAT_FOREVER,f=0;void 0===u&&(u=b.__instanceId+"");cc.assert(b,cc._LogInfos.Scheduler_scheduleCallbackForTarget_3);
(t=this._hashForTimers[b.__instanceId])?cc.assert(t.paused===h,""):(t=e.get(null,b,0,null,null,h),this._arrayForTimers.push(t),this._hashForTimers[b.__instanceId]=t);var w,v;if(null==t.timers)t.timers=[];else for(v=0;v<t.timers.length;v++)if(w=t.timers[v],a===w._callback){cc.log(cc._LogInfos.Scheduler_scheduleCallbackForTarget,w.getInterval().toFixed(4),c.toFixed(4));w._interval=c;return}w=g.get();w.initWithCallback(this,a,b,c,d,f,u);t.timers.push(w)},scheduleUpdate:function(a,b,c){this._schedulePerFrame(function(b){a.update(b)},
a,b,c)},_getUnscheduleMark:function(a,b){switch(typeof a){case "number":case "string":return a===b._key;case "function":return a===b._callback}},unschedule:function(a,b){if(b&&a){var c=this._hashForTimers[b.__instanceId];if(c)for(var d=c.timers,e=0,f=d.length;e<f;e++){var h=d[e];if(this._getUnscheduleMark(a,h)){h!==c.currentTimer||c.currentTimerSalvaged||(c.currentTimerSalvaged=!0);d.splice(e,1);g.put(h);c.timerIndex>=e&&c.timerIndex--;0===d.length&&(this._currentTarget===c?this._currentTargetSalvaged=
!0:this._removeHashElement(c));break}}}},unscheduleUpdate:function(a){a&&(a=this._hashForUpdates[a.__instanceId])&&(this._updateHashLocked?a.entry.markedForDeletion=!0:this._removeUpdateFromHash(a.entry))},unscheduleAllForTarget:function(a){if(a){var b=this._hashForTimers[a.__instanceId];if(b){var c=b.timers;-1<c.indexOf(b.currentTimer)&&!b.currentTimerSalvaged&&(b.currentTimerSalvaged=!0);for(var d=0,e=c.length;d<e;d++)g.put(c[d]);c.length=0;this._currentTarget===b?this._currentTargetSalvaged=!0:
this._removeHashElement(b)}this.unscheduleUpdate(a)}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(a){var b,c,d=this._arrayForTimers;for(b=d.length-1;0<=b;b--)c=d[b],this.unscheduleAllForTarget(c.target);d=0;if(0>a)for(b=0;b<this._updatesNegList.length;)d=this._updatesNegList.length,(c=this._updatesNegList[b])&&c.priority>=a&&this.unscheduleUpdate(c.target),d==this._updatesNegList.length&&b++;if(0>=a)for(b=0;b<this._updates0List.length;)d=
this._updates0List.length,(c=this._updates0List[b])&&this.unscheduleUpdate(c.target),d==this._updates0List.length&&b++;for(b=0;b<this._updatesPosList.length;)d=this._updatesPosList.length,(c=this._updatesPosList[b])&&c.priority>=a&&this.unscheduleUpdate(c.target),d==this._updatesPosList.length&&b++},isScheduled:function(a,b){cc.assert(a,"Argument callback must not be empty");cc.assert(b,"Argument target must be non-nullptr");var c=this._hashForTimers[b.__instanceId];if(!c)return!1;if(null!=c.timers)for(var c=
c.timers,d=0;d<c.length;++d)if(a===c[d]._callback)return!0;return!1},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(a){var b=[],c,d=this._arrayForTimers,e,f;e=0;for(f=d.length;e<f;e++)if(c=d[e])c.paused=!0,b.push(c.target);if(0>a)for(e=0;e<this._updatesNegList.length;e++)(c=this._updatesNegList[e])&&c.priority>=a&&(c.paused=!0,b.push(c.target));if(0>=a)for(e=0;e<this._updates0List.length;e++)if(c=this._updates0List[e])c.paused=
!0,b.push(c.target);for(e=0;e<this._updatesPosList.length;e++)(c=this._updatesPosList[e])&&c.priority>=a&&(c.paused=!0,b.push(c.target));return b},resumeTargets:function(a){if(a)for(var b=0;b<a.length;b++)this.resumeTarget(a[b])},pauseTarget:function(a){cc.assert(a,cc._LogInfos.Scheduler_pauseTarget);var b=this._hashForTimers[a.__instanceId];b&&(b.paused=!0);(a=this._hashForUpdates[a.__instanceId])&&(a.entry.paused=!0)},resumeTarget:function(a){cc.assert(a,cc._LogInfos.Scheduler_resumeTarget);var b=
this._hashForTimers[a.__instanceId];b&&(b.paused=!1);(a=this._hashForUpdates[a.__instanceId])&&(a.entry.paused=!1)},isTargetPaused:function(a){cc.assert(a,cc._LogInfos.Scheduler_isTargetPaused);var b=this._hashForTimers[a.__instanceId];return b?b.paused:(a=this._hashForUpdates[a.__instanceId])?a.entry.paused:!1},scheduleUpdateForTarget:function(a,b,c){this.scheduleUpdate(a,b,c)},unscheduleCallbackForTarget:function(a,b){this.unschedule(b,a)},unscheduleUpdateForTarget:function(a){this.unscheduleUpdate(a)},
unscheduleAllCallbacksForTarget:function(a){this.unschedule(a.__instanceId+"",a)},unscheduleAllCallbacks:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllCallbacksWithMinPriority:function(a){this.unscheduleAllWithMinPriority(a)}});cc.Scheduler.PRIORITY_SYSTEM=-2147483648;cc.Scheduler.PRIORITY_NON_SYSTEM=cc.Scheduler.PRIORITY_SYSTEM+1})();cc.PI2=2*Math.PI;
cc.DrawingPrimitiveCanvas=cc.Class.extend({_cacheArray:[],_renderContext:null,ctor:function(a){this._renderContext=a},drawPoint:function(a,b){b||(b=1);var c=cc.view.getScaleX(),d=cc.view.getScaleY(),d=cc.p(a.x*c,a.y*d),e=this._renderContext.getContext();e.beginPath();e.arc(d.x,-d.y,b*c,0,2*Math.PI,!1);e.closePath();e.fill()},drawPoints:function(a,b,c){if(null!=a){c||(c=1);b=this._renderContext.getContext();var d=cc.view.getScaleX(),e=cc.view.getScaleY();b.beginPath();for(var f=0,g=a.length;f<g;f++)b.arc(a[f].x*
d,-a[f].y*e,c*d,0,2*Math.PI,!1);b.closePath();b.fill()}},drawLine:function(a,b){var c=this._renderContext.getContext();cc.view.getScaleX();cc.view.getScaleY();c.beginPath();c.moveTo(a.x,-a.y);c.lineTo(b.x,-b.y);c.closePath();c.stroke()},drawRect:function(a,b){this.drawLine(cc.p(a.x,a.y),cc.p(b.x,a.y));this.drawLine(cc.p(b.x,a.y),cc.p(b.x,b.y));this.drawLine(cc.p(b.x,b.y),cc.p(a.x,b.y));this.drawLine(cc.p(a.x,b.y),cc.p(a.x,a.y))},drawSolidRect:function(a,b,c){a=[a,cc.p(b.x,a.y),b,cc.p(a.x,b.y)];this.drawSolidPoly(a,
4,c)},drawPoly:function(a,b,c,d){d=d||!1;if(null!=a){if(3>a.length)throw Error("Polygon's point must greater than 2");var e=a[0];b=this._renderContext.getContext();cc.view.getScaleX();cc.view.getScaleY();b.beginPath();b.moveTo(e.x,-e.y);for(var e=1,f=a.length;e<f;e++)b.lineTo(a[e].x,-a[e].y);c&&b.closePath();d?b.fill():b.stroke()}},drawSolidPoly:function(a,b,c){this.setDrawColor(c.r,c.g,c.b,c.a);this.drawPoly(a,b,!0,!0)},drawCircle:function(a,b,c,d,e){e=e||!1;d=this._renderContext.getContext();cc.view.getScaleX();
cc.view.getScaleY();d.beginPath();d.arc(0|a.x,0|-a.y,b,-c,-(c-2*Math.PI),!1);e&&d.lineTo(0|a.x,0|-a.y);d.stroke()},drawQuadBezier:function(a,b,c,d){for(var e=this._cacheArray,f=e.length=0,g=0;g<d;g++){var h=Math.pow(1-f,2)*a.x+2*(1-f)*f*b.x+f*f*c.x,k=Math.pow(1-f,2)*a.y+2*(1-f)*f*b.y+f*f*c.y;e.push(cc.p(h,k));f+=1/d}e.push(cc.p(c.x,c.y));this.drawPoly(e,d+1,!1,!1)},drawCubicBezier:function(a,b,c,d,e){for(var f=this._cacheArray,g=f.length=0,h=0;h<e;h++){var k=Math.pow(1-g,3)*a.x+3*Math.pow(1-g,2)*
g*b.x+3*(1-g)*g*g*c.x+g*g*g*d.x,m=Math.pow(1-g,3)*a.y+3*Math.pow(1-g,2)*g*b.y+3*(1-g)*g*g*c.y+g*g*g*d.y;f.push(cc.p(k,m));g+=1/e}f.push(cc.p(d.x,d.y));this.drawPoly(f,e+1,!1,!1)},drawCatmullRom:function(a,b){this.drawCardinalSpline(a,0.5,b)},drawCardinalSpline:function(a,b,c){cc._renderContext.setStrokeStyle("rgba(255,255,255,1)");var d=this._cacheArray;d.length=0;for(var e,f,g=1/a.length,h=0;h<c+1;h++)f=h/c,1===f?(e=a.length-1,f=1):(e=0|f/g,f=(f-g*e)/g),e=cc.CardinalSplineAt(cc.getControlPointAt(a,
e-1),cc.getControlPointAt(a,e-0),cc.getControlPointAt(a,e+1),cc.getControlPointAt(a,e+2),b,f),d.push(e);this.drawPoly(d,c+1,!1,!1)},drawImage:function(a,b,c,d,e){var f=arguments.length,g=this._renderContext.getContext();switch(f){case 2:g.drawImage(a,b.x,-(b.y+a.height));break;case 3:g.drawImage(a,b.x,-(b.y+c.height),c.width,c.height);break;case 5:g.drawImage(a,b.x,b.y,c.width,c.height,d.x,-(d.y+e.height),e.width,e.height);break;default:throw Error("Argument must be non-nil");}},drawStar:function(a,
b,c){a=a||this._renderContext;var d=a.getContext();c="rgba("+(0|c.r)+","+(0|c.g)+","+(0|c.b);a.setFillStyle(c+",1)");var e=b/10;d.beginPath();d.moveTo(-b,b);d.lineTo(0,e);d.lineTo(b,b);d.lineTo(e,0);d.lineTo(b,-b);d.lineTo(0,-e);d.lineTo(-b,-b);d.lineTo(-e,0);d.lineTo(-b,b);d.closePath();d.fill();var f=d.createRadialGradient(0,0,e,0,0,b);f.addColorStop(0,c+", 1)");f.addColorStop(0.3,c+", 0.8)");f.addColorStop(1,c+", 0.0)");a.setFillStyle(f);d.beginPath();d.arc(0,0,b-e,0,cc.PI2,!1);d.closePath();d.fill()},
drawColorBall:function(a,b,c){a=a||this._renderContext;var d=a.getContext();b*=cc.view.getScaleX();c="rgba("+(0|c.r)+","+(0|c.g)+","+(0|c.b);var e=d.createRadialGradient(0,0,b/10,0,0,b);e.addColorStop(0,c+", 1)");e.addColorStop(0.3,c+", 0.8)");e.addColorStop(0.6,c+", 0.4)");e.addColorStop(1,c+", 0.0)");a.setFillStyle(e);d.beginPath();d.arc(0,0,b,0,cc.PI2,!1);d.closePath();d.fill()},fillText:function(a,b,c){this._renderContext.getContext().fillText(a,b,-c)},setDrawColor:function(a,b,c,d){this._renderContext.setFillStyle("rgba("+
a+","+b+","+c+","+d/255+")");this._renderContext.setStrokeStyle("rgba("+a+","+b+","+c+","+d/255+")")},setPointSize:function(a){},setLineWidth:function(a){this._renderContext.getContext().lineWidth=a*cc.view.getScaleX()}});cc.DrawingPrimitiveWebGL=cc.Class.extend({_renderContext:null,_initialized:!1,_shader:null,_colorLocation:"u_color",_colorArray:null,_pointSizeLocation:"u_pointSize",_pointSize:-1,ctor:function(a){null==a&&(a=cc._renderContext);if(!window.wx&&!a instanceof window.WebGLRenderingContext)throw Error("Can't initialise DrawingPrimitiveWebGL. context need is WebGLRenderingContext");this._renderContext=a;this._colorArray=new Float32Array([1,1,1,1])},lazy_init:function(){this._initialized||(this._shader=
cc.shaderCache.programForKey(cc.SHADER_POSITION_UCOLOR),this._shader._addUniformLocation(this._colorLocation),this._shader._addUniformLocation(this._pointSizeLocation),this._initialized=!0)},drawInit:function(){this._initialized=!1},drawPoint:function(a){this.lazy_init();var b=this._renderContext;this._glProgramState.apply();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();b.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);this._shader.setUniformLocationWith4fv(this._colorLocation,
this._colorArray);this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var c=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,c);b.bufferData(b.ARRAY_BUFFER,new Float32Array([a.x,a.y]),b.STATIC_DRAW);b.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,b.FLOAT,!1,0,0);b.drawArrays(b.POINTS,0,1);b.deleteBuffer(c);cc.incrementGLDraws(1)},drawPoints:function(a,b){if(a&&0!==a.length){this.lazy_init();var c=this._renderContext;this._glProgramState.apply();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();
c.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var d=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,d);c.bufferData(c.ARRAY_BUFFER,this._pointsToTypeArray(a),c.STATIC_DRAW);c.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,c.FLOAT,!1,0,0);c.drawArrays(c.POINTS,0,a.length);c.deleteBuffer(d);cc.incrementGLDraws(1)}},_pointsToTypeArray:function(a){for(var b=
new Float32Array(2*a.length),c=0;c<a.length;c++)b[2*c]=a[c].x,b[2*c+1]=a[c].y;return b},drawLine:function(a,b){this.lazy_init();var c=this._renderContext;this._glProgramState.apply();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();c.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var d=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,d);c.bufferData(c.ARRAY_BUFFER,this._pointsToTypeArray([a,b]),c.STATIC_DRAW);
c.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,c.FLOAT,!1,0,0);c.drawArrays(c.LINES,0,2);c.deleteBuffer(d);cc.incrementGLDraws(1)},drawRect:function(a,b){this.drawLine(cc.p(a.x,a.y),cc.p(b.x,a.y));this.drawLine(cc.p(b.x,a.y),cc.p(b.x,b.y));this.drawLine(cc.p(b.x,b.y),cc.p(a.x,b.y));this.drawLine(cc.p(a.x,b.y),cc.p(a.x,a.y))},drawSolidRect:function(a,b,c){a=[a,cc.p(b.x,a.y),b,cc.p(a.x,b.y)];this.drawSolidPoly(a,4,c)},drawPoly:function(a,b,c){this.lazy_init();b=this._renderContext;this._glProgramState.apply();
this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();b.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var d=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,d);b.bufferData(b.ARRAY_BUFFER,this._pointsToTypeArray(a),b.STATIC_DRAW);b.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,b.FLOAT,!1,0,0);c?b.drawArrays(b.LINE_LOOP,0,a.length):b.drawArrays(b.LINE_STRIP,0,a.length);b.deleteBuffer(d);cc.incrementGLDraws(1)},
drawSolidPoly:function(a,b,c){this.lazy_init();c&&this.setDrawColor(c.r,c.g,c.b,c.a);b=this._renderContext;this._glProgramState.apply();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();b.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);c=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,c);b.bufferData(b.ARRAY_BUFFER,this._pointsToTypeArray(a),b.STATIC_DRAW);b.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,
b.FLOAT,!1,0,0);b.drawArrays(b.TRIANGLE_FAN,0,a.length);b.deleteBuffer(c);cc.incrementGLDraws(1)},drawCircle:function(a,b,c,d,e){this.lazy_init();var f=1;e&&f++;var g=2*Math.PI/d;if(e=new Float32Array(2*(d+2))){for(var h=0;h<=d;h++){var k=h*g,m=b*Math.cos(k+c)+a.x,k=b*Math.sin(k+c)+a.y;e[2*h]=m;e[2*h+1]=k}e[2*(d+1)]=a.x;e[2*(d+1)+1]=a.y;a=this._renderContext;this._glProgramState.apply();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();a.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);
this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);b=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b);a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW);a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,a.FLOAT,!1,0,0);a.drawArrays(a.LINE_STRIP,0,d+f);a.deleteBuffer(b);cc.incrementGLDraws(1)}},drawQuadBezier:function(a,b,c,d){this.lazy_init();for(var e=new Float32Array(2*(d+1)),f=0,g=0;g<d;g++)e[2*g]=Math.pow(1-f,2)*a.x+2*(1-f)*f*b.x+f*f*c.x,e[2*g+1]=Math.pow(1-f,2)*a.y+2*(1-f)*
f*b.y+f*f*c.y,f+=1/d;e[2*d]=c.x;e[2*d+1]=c.y;a=this._renderContext;this._glProgramState.apply();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();a.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);b=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b);a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW);a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,a.FLOAT,!1,0,0);a.drawArrays(a.LINE_STRIP,0,d+1);a.deleteBuffer(b);
cc.incrementGLDraws(1)},drawCubicBezier:function(a,b,c,d,e){this.lazy_init();for(var f=new Float32Array(2*(e+1)),g=0,h=0;h<e;h++)f[2*h]=Math.pow(1-g,3)*a.x+3*Math.pow(1-g,2)*g*b.x+3*(1-g)*g*g*c.x+g*g*g*d.x,f[2*h+1]=Math.pow(1-g,3)*a.y+3*Math.pow(1-g,2)*g*b.y+3*(1-g)*g*g*c.y+g*g*g*d.y,g+=1/e;f[2*e]=d.x;f[2*e+1]=d.y;a=this._renderContext;this._glProgramState.apply();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();a.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);this._shader.setUniformLocationWith4fv(this._colorLocation,
this._colorArray);b=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b);a.bufferData(a.ARRAY_BUFFER,f,a.STATIC_DRAW);a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,a.FLOAT,!1,0,0);a.drawArrays(a.LINE_STRIP,0,e+1);a.deleteBuffer(b);cc.incrementGLDraws(1)},drawCatmullRom:function(a,b){this.drawCardinalSpline(a,0.5,b)},drawCardinalSpline:function(a,b,c){this.lazy_init();for(var d=new Float32Array(2*(c+1)),e,f,g=1/a.length,h=0;h<c+1;h++)f=h/c,1===f?(e=a.length-1,f=1):(e=0|f/g,f=(f-g*e)/g),e=cc.cardinalSplineAt(cc.getControlPointAt(a,
e-1),cc.getControlPointAt(a,e),cc.getControlPointAt(a,e+1),cc.getControlPointAt(a,e+2),b,f),d[2*h]=e.x,d[2*h+1]=e.y;a=this._renderContext;this._glProgramState.apply();this._shader.setUniformForModelViewAndProjectionMatrixWithMat4();a.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);b=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b);a.bufferData(a.ARRAY_BUFFER,d,a.STATIC_DRAW);a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,
2,a.FLOAT,!1,0,0);a.drawArrays(a.LINE_STRIP,0,c+1);a.deleteBuffer(b);cc.incrementGLDraws(1)},setDrawColor:function(a,b,c,d){this._colorArray[0]=a/255;this._colorArray[1]=b/255;this._colorArray[2]=c/255;this._colorArray[3]=d/255},setPointSize:function(a){this._pointSize=a*cc.contentScaleFactor()},setLineWidth:function(a){this._renderContext.lineWidth&&this._renderContext.lineWidth(a)}});cc.LabelCoefficientConfig={"Microsoft YaHei":1.334,Arial:1.134};cc._tmp.PrototypeLabelTTF=function(){var a=cc.LabelTTF.prototype;cc.defineGetterSetter(a,"color",a.getColor,a.setColor);cc.defineGetterSetter(a,"opacity",a.getOpacity,a.setOpacity);cc.defineGetterSetter(a,"string",a.getString,a.setString);cc.defineGetterSetter(a,"textAlign",a.getHorizontalAlignment,a.setHorizontalAlignment);cc.defineGetterSetter(a,"verticalAlign",a.getVerticalAlignment,a.setVerticalAlignment);cc.defineGetterSetter(a,"fontSize",a.getFontSize,a.setFontSize);cc.defineGetterSetter(a,
"fontName",a.getFontName,a.setFontName);cc.defineGetterSetter(a,"font",a._getFont,a._setFont);cc.defineGetterSetter(a,"boundingWidth",a._getBoundingWidth,a._setBoundingWidth);cc.defineGetterSetter(a,"boundingHeight",a._getBoundingHeight,a._setBoundingHeight);cc.defineGetterSetter(a,"fillStyle",a._getFillStyle,a.setFontFillColor);cc.defineGetterSetter(a,"strokeStyle",a._getStrokeStyle,a._setStrokeStyle);cc.defineGetterSetter(a,"lineWidth",a._getLineWidth,a._setLineWidth);cc.defineGetterSetter(a,"shadowOffsetX",
a._getShadowOffsetX,a._setShadowOffsetX);cc.defineGetterSetter(a,"shadowOffsetY",a._getShadowOffsetY,a._setShadowOffsetY);cc.defineGetterSetter(a,"shadowOpacity",a._getShadowOpacity,a._setShadowOpacity);cc.defineGetterSetter(a,"shadowBlur",a._getShadowBlur,a._setShadowBlur)};cc.LabelTTF=cc.Sprite.extend({_dimensions:null,_hAlignment:cc.TEXT_ALIGNMENT_CENTER,_vAlignment:cc.VERTICAL_TEXT_ALIGNMENT_TOP,_fontName:null,_fontSize:0,_string:"",_originalText:null,_onCacheCanvasMode:!0,_shadowEnabled:!1,_shadowOffset:null,_shadowOpacity:0,_shadowBlur:0,_shadowColor:null,_strokeEnabled:!1,_strokeColor:null,_strokeSize:0,_textFillColor:null,_strokeShadowOffsetX:0,_strokeShadowOffsetY:0,_needUpdateTexture:!1,_lineWidths:null,_className:"LabelTTF",_fontStyle:"normal",_fontWeight:"normal",
_lineHeight:"normal",initWithString:function(a,b,c,d,e,f){a=a?a+"":"";c=c||16;d=d||cc.size(0,0);e=e||cc.TEXT_ALIGNMENT_LEFT;f=f||cc.VERTICAL_TEXT_ALIGNMENT_TOP;this._opacityModifyRGB=!1;this._dimensions=cc.size(d.width,d.height);this._fontName=b||"Arial";this._hAlignment=e;this._vAlignment=f;this._fontSize=c;this._renderCmd._setFontStyle(this._fontName,c,this._fontStyle,this._fontWeight);this.string=a;this._renderCmd._setColorsString();this._renderCmd._updateTexture();this._setUpdateTextureDirty();
this._scaleX=this._scaleY=1/cc.view.getDevicePixelRatio();return!0},_setUpdateTextureDirty:function(){this._needUpdateTexture=!0;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.textDirty)},ctor:function(a,b,c,d,e,f){cc.Sprite.prototype.ctor.call(this);this._dimensions=cc.size(0,0);this._hAlignment=cc.TEXT_ALIGNMENT_LEFT;this._vAlignment=cc.VERTICAL_TEXT_ALIGNMENT_TOP;this._opacityModifyRGB=!1;this._fontName="Arial";this._shadowEnabled=!1;this._shadowOffset=cc.p(0,0);this._shadowBlur=this._shadowOpacity=
0;this._strokeEnabled=!1;this._strokeColor=cc.color(255,255,255,255);this._strokeSize=0;this._textFillColor=cc.color(255,255,255,255);this._strokeShadowOffsetY=this._strokeShadowOffsetX=0;this._needUpdateTexture=!1;this._lineWidths=[];this._renderCmd._setColorsString();this._textureLoaded=!0;b&&b instanceof cc.FontDefinition?this.initWithStringAndTextDefinition(a,b):cc.LabelTTF.prototype.initWithString.call(this,a,b,c,d,e,f)},init:function(){return this.initWithString(" ",this._fontName,this._fontSize)},
description:function(){return"\x3ccc.LabelTTF | FontName \x3d"+this._fontName+" FontSize \x3d "+this._fontSize.toFixed(1)+"\x3e"},getLineHeight:function(){return!this._lineHeight||this._lineHeight.charAt?this._renderCmd._getFontClientHeight():this._lineHeight||this._renderCmd._getFontClientHeight()},setLineHeight:function(a){this._lineHeight=a},getString:function(){return this._string},getHorizontalAlignment:function(){return this._hAlignment},getVerticalAlignment:function(){return this._vAlignment},
getDimensions:function(){return cc.size(this._dimensions)},getFontSize:function(){return this._fontSize},getFontName:function(){return this._fontName},initWithStringAndTextDefinition:function(a,b){this._updateWithTextDefinition(b,!1);this.string=a;return!0},setTextDefinition:function(a){a&&this._updateWithTextDefinition(a,!0)},getTextDefinition:function(){return this._prepareTextDefinition(!1)},enableShadow:function(a,b,c,d){null!=a.r&&null!=a.g&&null!=a.b&&null!=a.a?this._enableShadow(a,b,c):this._enableShadowNoneColor(a,
b,c,d)},_enableShadowNoneColor:function(a,b,c,d){c=c||0.5;!1===this._shadowEnabled&&(this._shadowEnabled=!0);var e=this._shadowOffset;if(e&&e.x!==a||e._y!==b)e.x=a,e.y=b;this._shadowOpacity!==c&&(this._shadowOpacity=c);this._renderCmd._setColorsString();this._shadowBlur!==d&&(this._shadowBlur=d);this._setUpdateTextureDirty()},_enableShadow:function(a,b,c){this._shadowColor||(this._shadowColor=cc.color(255,255,255,128));this._shadowColor.r=a.r;this._shadowColor.g=a.g;this._shadowColor.b=a.b;this._enableShadowNoneColor(b.width||
b.x||0,b.height||b.y||0,null!=a.a?a.a/255:0.5,c)},_getShadowOffsetX:function(){return this._shadowOffset.x},_setShadowOffsetX:function(a){!1===this._shadowEnabled&&(this._shadowEnabled=!0);this._shadowOffset.x!==a&&(this._shadowOffset.x=a,this._setUpdateTextureDirty())},_getShadowOffsetY:function(){return this._shadowOffset._y},_setShadowOffsetY:function(a){!1===this._shadowEnabled&&(this._shadowEnabled=!0);this._shadowOffset._y!==a&&(this._shadowOffset._y=a,this._setUpdateTextureDirty())},_getShadowOffset:function(){return cc.p(this._shadowOffset.x,
this._shadowOffset.y)},_setShadowOffset:function(a){!1===this._shadowEnabled&&(this._shadowEnabled=!0);if(this._shadowOffset.x!==a.x||this._shadowOffset.y!==a.y)this._shadowOffset.x=a.x,this._shadowOffset.y=a.y,this._setUpdateTextureDirty()},_getShadowOpacity:function(){return this._shadowOpacity},_setShadowOpacity:function(a){!1===this._shadowEnabled&&(this._shadowEnabled=!0);this._shadowOpacity!==a&&(this._shadowOpacity=a,this._renderCmd._setColorsString(),this._setUpdateTextureDirty())},_getShadowBlur:function(){return this._shadowBlur},
_setShadowBlur:function(a){!1===this._shadowEnabled&&(this._shadowEnabled=!0);this._shadowBlur!==a&&(this._shadowBlur=a,this._setUpdateTextureDirty())},disableShadow:function(){this._shadowEnabled&&(this._shadowEnabled=!1,this._setUpdateTextureDirty())},enableStroke:function(a,b){!1===this._strokeEnabled&&(this._strokeEnabled=!0);var c=this._strokeColor;if(c.r!==a.r||c.g!==a.g||c.b!==a.b)c.r=a.r,c.g=a.g,c.b=a.b,this._renderCmd._setColorsString();this._strokeSize!==b&&(this._strokeSize=b||0);this._setUpdateTextureDirty()},
_getStrokeStyle:function(){return this._strokeColor},_setStrokeStyle:function(a){!1===this._strokeEnabled&&(this._strokeEnabled=!0);var b=this._strokeColor;if(b.r!==a.r||b.g!==a.g||b.b!==a.b)b.r=a.r,b.g=a.g,b.b=a.b,this._renderCmd._setColorsString(),this._setUpdateTextureDirty()},_getLineWidth:function(){return this._strokeSize},_setLineWidth:function(a){!1===this._strokeEnabled&&(this._strokeEnabled=!0);this._strokeSize!==a&&(this._strokeSize=a||0,this._setUpdateTextureDirty())},disableStroke:function(){this._strokeEnabled&&
(this._strokeEnabled=!1,this._setUpdateTextureDirty())},setFontFillColor:function(a){var b=this._textFillColor;if(b.r!==a.r||b.g!==a.g||b.b!==a.b)b.r=a.r,b.g=a.g,b.b=a.b,this._renderCmd._setColorsString(),this._needUpdateTexture=!0},_getFillStyle:function(){return this._textFillColor},_updateWithTextDefinition:function(a,b){a.fontDimensions?(this._dimensions.width=a.boundingWidth,this._dimensions.height=a.boundingHeight):(this._dimensions.width=0,this._dimensions.height=0);this._hAlignment=a.textAlign;
this._vAlignment=a.verticalAlign;this._fontName=a.fontName;this._fontSize=a.fontSize||12;this._lineHeight=a.lineHeight?a.lineHeight:this._fontSize;this._renderCmd._setFontStyle(a);a.shadowEnabled&&this.enableShadow(a.shadowOffsetX,a.shadowOffsetY,a.shadowOpacity,a.shadowBlur);a.strokeEnabled&&this.enableStroke(a.strokeStyle,a.lineWidth);this.setFontFillColor(a.fillStyle);b&&this._renderCmd._updateTexture();var c=cc.Node._dirtyFlags;this._renderCmd.setDirtyFlag(c.colorDirty|c.opacityDirty|c.textDirty)},
_prepareTextDefinition:function(a){var b=new cc.FontDefinition;a?(b.fontSize=this._fontSize,b.boundingWidth=cc.contentScaleFactor()*this._dimensions.width,b.boundingHeight=cc.contentScaleFactor()*this._dimensions.height):(b.fontSize=this._fontSize,b.boundingWidth=this._dimensions.width,b.boundingHeight=this._dimensions.height);b.fontName=this._fontName;b.textAlign=this._hAlignment;b.verticalAlign=this._vAlignment;if(this._strokeEnabled){b.strokeEnabled=!0;var c=this._strokeColor;b.strokeStyle=cc.color(c.r,
c.g,c.b);b.lineWidth=this._strokeSize}else b.strokeEnabled=!1;this._shadowEnabled?(b.shadowEnabled=!0,b.shadowBlur=this._shadowBlur,b.shadowOpacity=this._shadowOpacity,b.shadowOffsetX=(a?cc.contentScaleFactor():1)*this._shadowOffset.x,b.shadowOffsetY=(a?cc.contentScaleFactor():1)*this._shadowOffset.y):b._shadowEnabled=!1;a=this._textFillColor;b.fillStyle=cc.color(a.r,a.g,a.b);return b},getScale:function(){this._scaleX!==this._scaleY&&cc.log(cc._LogInfos.Node_getScale);return this._scaleX*cc.view.getDevicePixelRatio()},
setScale:function(a,b){var c=cc.view.getDevicePixelRatio();this._scaleX=a/c;this._scaleY=(b||0===b?b:a)/c;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX*cc.view.getDevicePixelRatio()},setScaleX:function(a){this._scaleX=a/cc.view.getDevicePixelRatio();this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY*cc.view.getDevicePixelRatio()},setScaleY:function(a){this._scaleY=a/cc.view.getDevicePixelRatio();
this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},setString:function(a){a=String(a);this._originalText!==a&&(this._originalText=a+"",this._updateString(),this._setUpdateTextureDirty(),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty))},_updateString:function(){this._string&&""!==this._string||this._string===this._originalText||(cc.renderer.childrenOrderDirty=!0);this._string=this._originalText},setHorizontalAlignment:function(a){a!==this._hAlignment&&(this._hAlignment=
a,this._setUpdateTextureDirty())},setVerticalAlignment:function(a){a!==this._vAlignment&&(this._vAlignment=a,this._setUpdateTextureDirty())},setDimensions:function(a,b){var c;void 0===b?(c=a.width,b=a.height):c=a;if(c!==this._dimensions.width||b!==this._dimensions.height)this._dimensions.width=c,this._dimensions.height=b,this._updateString(),this._setUpdateTextureDirty()},_getBoundingWidth:function(){return this._dimensions.width},_setBoundingWidth:function(a){a!==this._dimensions.width&&(this._dimensions.width=
a,this._updateString(),this._setUpdateTextureDirty())},_getBoundingHeight:function(){return this._dimensions.height},_setBoundingHeight:function(a){a!==this._dimensions.height&&(this._dimensions.height=a,this._updateString(),this._setUpdateTextureDirty())},setFontSize:function(a){this._fontSize!==a&&(this._fontSize=a,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},setFontName:function(a){this._fontName&&this._fontName!==
a&&(this._fontName=a,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFont:function(){return this._renderCmd._getFontStyle()},_setFont:function(a){if(a=cc.LabelTTF._fontStyleRE.exec(a))this._fontSize=parseInt(a[1]),this._fontName=a[2],this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty()},getContentSize:function(){this._needUpdateTexture&&this._renderCmd._updateTTF();
var a=cc.view.getDevicePixelRatio();return cc.size(this._contentSize.width/a,this._contentSize.height/a)},_getWidth:function(){this._needUpdateTexture&&this._renderCmd._updateTTF();return this._contentSize.width/cc.view.getDevicePixelRatio()},_getHeight:function(){this._needUpdateTexture&&this._renderCmd._updateTTF();return this._contentSize.height/cc.view.getDevicePixelRatio()},setTextureRect:function(a,b,c){this._rectRotated=b||!1;this.setContentSize(c||a);b=this._rect;b.x=a.x;b.y=a.y;b.width=a.width;
b.height=a.height;this._renderCmd._setTextureCoords(a,!1);c=this._unflippedOffsetPositionFromCenter.x;var d=this._unflippedOffsetPositionFromCenter.y;this._flippedX&&(c=-c);this._flippedY&&(d=-d);this._offsetPosition.x=c+(a.width-b.width)/2;this._offsetPosition.y=d+(a.height-b.height)/2},setDrawMode:function(a){this._onCacheCanvasMode=a},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new cc.LabelTTF.WebGLRenderCmd(this):this._onCacheCanvasMode?new cc.LabelTTF.CacheCanvasRenderCmd(this):
new cc.LabelTTF.CanvasRenderCmd(this)},_setFontStyle:function(a){this._fontStyle!==a&&(this._fontStyle=a,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFontStyle:function(){return this._fontStyle},_setFontWeight:function(a){this._fontWeight!==a&&(this._fontWeight=a,this._renderCmd._setFontStyle(this._fontName,this._fontSize,this._fontStyle,this._fontWeight),this._setUpdateTextureDirty())},_getFontWeight:function(){return this._fontWeight}});
cc.assert(cc.isFunction(cc._tmp.PrototypeLabelTTF),cc._LogInfos.MissingFile,"LabelTTFPropertyDefine.js");cc._tmp.PrototypeLabelTTF();delete cc._tmp.PrototypeLabelTTF;cc.LabelTTF._fontStyleRE=/^(\d+)px\s+['"]?([\w\s\d]+)['"]?$/;cc.LabelTTF.create=function(a,b,c,d,e,f){return new cc.LabelTTF(a,b,c,d,e,f)};cc.LabelTTF.createWithFontDefinition=cc.LabelTTF.create;
window.wx||(cc.LabelTTF.__labelHeightDiv=document.createElement("div"),cc.LabelTTF.__labelHeightDiv.style.fontFamily="Arial",cc.LabelTTF.__labelHeightDiv.style.position="absolute",cc.LabelTTF.__labelHeightDiv.style.left="-100px",cc.LabelTTF.__labelHeightDiv.style.top="-100px",cc.LabelTTF.__labelHeightDiv.style.lineHeight="normal",document.body?document.body.appendChild(cc.LabelTTF.__labelHeightDiv):window.addEventListener("load",function(){this.removeEventListener("load",arguments.callee,!1);document.body.appendChild(cc.LabelTTF.__labelHeightDiv)},
!1));
cc.LabelTTF.__getFontHeightByDiv=function(a,b){if(window.wx){var c=18,c=cc.LabelCoefficientConfig[a]||1.34;if(a instanceof cc.FontDefinition)var d,c=a.fontSize*c;else c*=b;c=Math.ceil(c)}else{var e=cc.LabelTTF.__labelHeightDiv;if(a instanceof cc.FontDefinition){d=a;c=cc.LabelTTF.__fontHeightCache[d._getCanvasFontStr()];if(0<c)return c;e.innerHTML="ajghl~!";e.style.fontFamily=d.fontName;e.style.fontSize=d.fontSize+"px";e.style.fontStyle=d.fontStyle;e.style.fontWeight=d.fontWeight;c=e.clientHeight;cc.LabelTTF.__fontHeightCache[d._getCanvasFontStr()]=
c}else{c=cc.LabelTTF.__fontHeightCache[a+"."+b];if(0<c)return c;e.innerHTML="ajghl~!";e.style.fontFamily=a;e.style.fontSize=b+"px";c=e.clientHeight;cc.LabelTTF.__fontHeightCache[a+"."+b]=c}e.innerHTML=""}return c};cc.LabelTTF.__fontHeightCache={};cc.LabelTTF._textAlign=["left","center","right"];cc.LabelTTF._textBaseline=["top","middle","bottom"];cc.LabelTTF.wrapInspection=!0;cc.LabelTTF._wordRex=/([a-zA-Z0-9\-\u00bf\u00a1\u00ab\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02af\u0300-\u034e\u0350-\u036F\u0370-\u052f\u2011\u2035-\u2037\u2039\u2045]+|\S)/;cc.LabelTTF._symbolRex=/^[!,.:;}\]%\?>\u3001\u2018\u201c\u300b\u00bb\uff1f\u3002\uff0c\uff01\u2010\u2032-\u2034\u203a\u203c\u2046\u2047-\u2049]/;cc.LabelTTF._lastWordRex=/([a-zA-Z0-9\-\u00bf\u00a1\u00ab\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02af\u0300-\u034e\u0350-\u036F\u0370-\u052f\u2011\u2035-\u2037\u2039\u2045]+|\S)$/;
cc.LabelTTF._lastEnglish=/[a-zA-Z0-9\-\u00bf\u00a1\u00ab\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02af\u0300-\u034e\u0350-\u036F\u0370-\u052f\u2011\u2035-\u2037\u2039\u2045]+$/;cc.LabelTTF._firsrEnglish=/^[a-zA-Z0-9\-\u00bf\u00a1\u00ab\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02af\u0300-\u034e\u0350-\u036F\u0370-\u052f\u2011\u2035-\u2037\u2039\u2045]/;
(function(){cc.LabelTTF.RenderCmd=function(){this._fontClientHeight=18;this._fontStyleStr="";this._shadowColorStr="rgba(128, 128, 128, 0.5)";this._strokeColorStr="";this._fillColorStr="rgba(255,255,255,1)";this._labelContext=this._labelCanvas=null;this._lineWidths=[];this._strings=[];this._isMultiLine=!1;this._status=[];this._renderingIndex=0;this._canUseDirtyRegion=!0};var a=cc.LabelTTF.RenderCmd.prototype;a.constructor=cc.LabelTTF.RenderCmd;a._labelCmdCtor=cc.LabelTTF.RenderCmd;a._setFontStyle=
function(a,b,e,f){if(a instanceof cc.FontDefinition)this._fontStyleStr=a._getCanvasFontStr(),this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(a);else{var g=b*cc.view.getDevicePixelRatio();this._fontStyleStr=e+" "+f+" "+g+"px '"+a+"'";this._fontClientHeight=cc.LabelTTF.__getFontHeightByDiv(a,b)}};a._getFontStyle=function(){return this._fontStyleStr};a._getFontClientHeight=function(){return this._fontClientHeight};a._updateColor=function(){this._setColorsString();this._updateTexture()};a._setColorsString=
function(){var a=this._displayedColor,b=this._node,e=b._shadowColor||this._displayedColor,f=b._strokeColor,g=b._textFillColor,h=a.r/255,k=a.g/255,a=a.b/255;this._shadowColorStr="rgba("+(0|h*e.r)+","+(0|k*e.g)+","+(0|a*e.b)+","+b._shadowOpacity+")";this._fillColorStr="rgba("+(0|h*g.r)+","+(0|k*g.g)+","+(0|a*g.b)+", 1)";this._strokeColorStr="rgba("+(0|h*f.r)+","+(0|k*f.g)+","+(0|a*f.b)+", 1)"};var b=new cc.Rect;a.getLocalBB=function(){var a=this._node;b.x=b.y=0;var d=cc.view.getDevicePixelRatio();b.width=
a._getWidth()*d;b.height=a._getHeight()*d;return b};a._updateTTF=function(){var a=this._node,b=cc.view.getDevicePixelRatio(),e=a._dimensions.width*b,f,g,h=this._lineWidths;h.length=0;this._isMultiLine=!1;this._measureConfig();var k={};if(0!==e)for(this._strings=a._string.split("\n"),f=0;f<this._strings.length;f++)this._checkWarp(this._strings,f,e);else for(this._strings=a._string.split("\n"),f=0,g=this._strings.length;f<g;f++)if(this._strings[f]){var m=this._measure(this._strings[f]);h.push(m);k[this._strings[f]]=
m}else h.push(0);1<this._strings.length&&(this._isMultiLine=!0);g=f=0;a._strokeEnabled&&(f=g=2*a._strokeSize);a._shadowEnabled&&(m=a._shadowOffset,f+=2*Math.abs(m.x),g+=2*Math.abs(m.y));0===e?this._isMultiLine?b=cc.size(Math.ceil(Math.max.apply(Math,h)+f),Math.ceil(this._fontClientHeight*b*this._strings.length+g)):(m=k[a._string],!m&&a._string&&(m=this._measure(a._string)),b=cc.size(Math.ceil((m?m:0)+f),Math.ceil(this._fontClientHeight*b+g))):b=0===a._dimensions.height?this._isMultiLine?cc.size(Math.ceil(e+
f),Math.ceil(a.getLineHeight()*b*this._strings.length+g)):cc.size(Math.ceil(e+f),Math.ceil(a.getLineHeight()*b+g)):cc.size(Math.ceil(e+f),Math.ceil(a._dimensions.height*b+g));"normal"!==a._getFontStyle()&&(b.width=Math.ceil(b.width+0.3*a._fontSize));a.setContentSize(b);a._strokeShadowOffsetX=f;a._strokeShadowOffsetY=g;a=a._anchorPoint;this._anchorPointInPoints.x=0.5*f+(b.width-f)*a.x;this._anchorPointInPoints.y=0.5*g+(b.height-g)*a.y};a._saveStatus=function(){var a=this._node,b=cc.view.getDevicePixelRatio(),
e=a._strokeShadowOffsetX,f=a._strokeShadowOffsetY,g=a._contentSize.height-f,h=a._vAlignment,k=a._hAlignment,m=0.5*e,f=g+0.5*f,n=0,p=0,r=[],e=a._contentSize.width-e,a=a.getLineHeight()*b,b=(a-this._fontClientHeight*b)/2,n=k===cc.TEXT_ALIGNMENT_RIGHT?n+e:k===cc.TEXT_ALIGNMENT_CENTER?n+e/2:n+0;if(this._isMultiLine)for(k=this._strings.length,h===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM?p=a-2*b+g-a*k:h===cc.VERTICAL_TEXT_ALIGNMENT_CENTER&&(p=(a-2*b)/2+(g-a*k)/2),h=0;h<k;h++)r.push(-g+(a*h+b)+p);else h!==cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM&&
(p=h===cc.VERTICAL_TEXT_ALIGNMENT_TOP?p-g:p-0.5*g),r.push(p);g={contextTransform:cc.p(m,f),xOffset:n,OffsetYArray:r};this._status.push(g)};a._drawTTFInCanvas=function(a){if(a){var b=this._status.pop();a.setTransform(1,0,0,1,b.contextTransform.x,b.contextTransform.y);this.drawLabels(a,b.xOffset,b.OffsetYArray)}};a._checkWarp=function(a,b,e){var f=a[b],g=this._measure(f);if(g>e&&1<f.length){for(var h=e/g*f.length|0,k=f.substr(h),m=g-this._measure(k),n,p=0,r=0;m>e&&100>r++;)h*=e/m,h|=0,k=f.substr(h),
m=g-this._measure(k);for(r=0;m<e&&100>r++;)k&&(p=(n=cc.LabelTTF._wordRex.exec(k))?n[0].length:1,n=k),h+=p,k=f.substr(h),m=g-this._measure(k);h-=p;0===h&&(h=1,n=n.substr(1));e=f.substr(0,h);cc.LabelTTF.wrapInspection&&cc.LabelTTF._symbolRex.test(n||k)&&(g=cc.LabelTTF._lastWordRex.exec(e),h-=g?g[0].length:0,0===h&&(h=1),n=f.substr(h),e=f.substr(0,h));cc.LabelTTF._firsrEnglish.test(n)&&(g=cc.LabelTTF._lastEnglish.exec(e))&&e!==g[0]&&(h-=g[0].length,n=f.substr(h),e=f.substr(0,h));a[b]=n||k;a.splice(b,
0,e)}};a.updateStatus=function(){this._dirtyFlag&cc.Node._dirtyFlags.textDirty&&this._updateTexture();this.originUpdateStatus()};a._syncStatus=function(a){var b=cc.Node._dirtyFlags,e=this._dirtyFlag;e&b.textDirty&&this._updateTexture();this._originSyncStatus(a);(cc._renderType===cc.game.RENDER_TYPE_WEBGL||e&b.transformDirty)&&this.transform(a)};a.drawLabels=function(a,b,e){var f=this._node;if(f._shadowEnabled){var g=f._shadowOffset;a.shadowColor=this._shadowColorStr;a.shadowOffsetX=g.x;a.shadowOffsetY=
-g.y;a.shadowBlur=f._shadowBlur}var g=f._hAlignment,h=f._vAlignment,k=f._strokeSize;a.font!==this._fontStyleStr&&(a.font=this._fontStyleStr);a.fillStyle=this._fillColorStr;if(f=f._strokeEnabled)a.lineWidth=2*k,a.strokeStyle=this._strokeColorStr;a.textBaseline=cc.LabelTTF._textBaseline[h];a.textAlign=cc.LabelTTF._textAlign[g];g=this._strings.length;for(h=0;h<g;h++)k=this._strings[h],f&&a.strokeText(k,b,e[h]),a.fillText(k,b,e[h]);cc.g_NumberOfDraws++}})();
(function(){cc.LabelTTF.CacheRenderCmd=function(){this._labelCmdCtor();var a=this._labelCanvas=document.createElement("canvas");a.width=1;a.height=1;this._labelContext=a.getContext("2d")};cc.LabelTTF.CacheRenderCmd.prototype=Object.create(cc.LabelTTF.RenderCmd.prototype);cc.inject(cc.LabelTTF.RenderCmd.prototype,cc.LabelTTF.CacheRenderCmd.prototype);var a=cc.LabelTTF.CacheRenderCmd.prototype;a.constructor=cc.LabelTTF.CacheRenderCmd;a._cacheCmdCtor=cc.LabelTTF.CacheRenderCmd;a._updateTexture=function(){this._dirtyFlag^=
this._dirtyFlag&cc.Node._dirtyFlags.textDirty;var a=this._node;a._needUpdateTexture=!1;var c=a._contentSize;this._updateTTF();var d=c.width,e=c.height,f=this._labelContext,g=this._labelCanvas;if(!a._texture){var h=new cc.Texture2D;h.initWithElement(this._labelCanvas);a.setTexture(h)}if(0===a._string.length)return g.width=1,g.height=c.height||1,a._texture&&(a._texture._htmlElementObj=this._labelCanvas,a._texture.handleLoadedTexture()),a.setTextureRect(cc.rect(0,0,1,c.height)),!0;f.font=this._fontStyleStr;
c=g.width===d&&g.height===e;g.width=d;g.height=e;c&&f.clearRect(0,0,d,e);this._saveStatus();this._drawTTFInCanvas(f);a._texture&&(a._texture._htmlElementObj=this._labelCanvas,a._texture.handleLoadedTexture());a.setTextureRect(cc.rect(0,0,d,e));return!0};a._measureConfig=function(){this._labelContext.font=this._fontStyleStr};a._measure=function(a){return a?this._labelContext.measureText(a).width:0}})();
(function(){cc.LabelTTF.CacheCanvasRenderCmd=function(a){this._spriteCmdCtor(a);this._cacheCmdCtor()};var a=cc.LabelTTF.CacheCanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype);cc.inject(cc.LabelTTF.CacheRenderCmd.prototype,a);a.constructor=cc.LabelTTF.CacheCanvasRenderCmd})();
(function(){cc.LabelTTF.CanvasRenderCmd=function(a){this._spriteCmdCtor(a);this._labelCmdCtor()};cc.LabelTTF.CanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype);cc.inject(cc.LabelTTF.RenderCmd.prototype,cc.LabelTTF.CanvasRenderCmd.prototype);var a=cc.LabelTTF.CanvasRenderCmd.prototype;a.constructor=cc.LabelTTF.CanvasRenderCmd;a._measureConfig=function(){};a._measure=function(a){if(a){var c=cc._renderContext.getContext();c.font=this._fontStyleStr;return c.measureText(a).width}return 0};
a._updateTexture=function(){this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.textDirty;var a=this._node,c=a._contentSize;this._updateTTF();var d=c.width,e=c.height;if(0===a._string.length)return a.setTextureRect(cc.rect(0,0,1,c.height)),!0;this._saveStatus();a.setTextureRect(cc.rect(0,0,d,e));return!0};a.rendering=function(a){var c=cc.view.getScaleX(),d=cc.view.getScaleY();a=a||cc._renderContext;var e=a.getContext();if(e){var f=this._node;a.computeRealOffsetY();if(!(0>=this._status.length)){var g=
this._renderingIndex>=this._status.length?this._renderingIndex-this._status.length:this._renderingIndex,h=this._status[g];this._renderingIndex=g+1;var k=f._offsetPosition.x,g=-f._offsetPosition.y-f._rect.height,m=this._displayedOpacity/255;a.setTransform(this._worldTransform,c,d);a.setCompositeOperation(this._blendFuncStr);a.setGlobalAlpha(m);a.save();f._flippedX&&(k=-k-f._rect.width,e.scale(-1,1));f._flippedY&&(g=f._offsetPosition.y,e.scale(1,-1));c=h.xOffset+h.contextTransform.x+k*c;f=[];k=this._strings.length;
for(m=0;m<k;m++)f.push(h.OffsetYArray[m]+h.contextTransform.y+g*d);this.drawLabels(e,c,f);a.restore()}}}})();(function(){cc.LabelTTF.WebGLRenderCmd=function(a){this._spriteCmdCtor(a);this._cacheCmdCtor()};var a=cc.LabelTTF.WebGLRenderCmd.prototype=Object.create(cc.Sprite.WebGLRenderCmd.prototype);cc.inject(cc.LabelTTF.CacheRenderCmd.prototype,a);a.constructor=cc.LabelTTF.WebGLRenderCmd;a._updateColor=function(){}})();cc.HashElement=function(){this.actions=[];this.target=null;this.actionIndex=0;this.currentAction=null;this.lock=this.paused=!1};
cc.ActionManager=cc.Class.extend({_elementPool:[],_searchElementByTarget:function(a,b){for(var c=0;c<a.length;c++)if(b===a[c].target)return a[c];return null},ctor:function(){this._hashTargets={};this._arrayTargets=[];this._currentTarget=null},_getElement:function(a,b){var c=this._elementPool.pop();c||(c=new cc.HashElement);c.target=a;c.paused=!!b;return c},_putElement:function(a){a.actions.length=0;a.actionIndex=0;a.currentAction=null;a.paused=!1;a.target=null;a.lock=!1;this._elementPool.push(a)},
addAction:function(a,b,c){if(!a)throw Error("cc.ActionManager.addAction(): action must be non-null");if(!b)throw Error("cc.ActionManager.addAction(): action must be non-null");var d=this._hashTargets[b.__instanceId];d?d.actions||(d.actions=[]):(d=this._getElement(b,c),this._hashTargets[b.__instanceId]=d,this._arrayTargets.push(d));d.actions.push(a);a.startWithTarget(b)},removeAllActions:function(){for(var a=this._arrayTargets,b=0;b<a.length;b++){var c=a[b];c&&this.removeAllActionsFromTarget(c.target,
!0)}},removeAllActionsFromTarget:function(a,b){if(null!=a){var c=this._hashTargets[a.__instanceId];c&&(c.actions.length=0,this._deleteHashElement(c))}},removeAction:function(a){if(null!=a){var b=a.getOriginalTarget();if(b=this._hashTargets[b.__instanceId])for(var c=0;c<b.actions.length;c++){if(b.actions[c]===a){b.actions.splice(c,1);b.actionIndex>=c&&b.actionIndex--;break}}else cc.log(cc._LogInfos.ActionManager_removeAction)}},removeActionByTag:function(a,b){a===cc.ACTION_TAG_INVALID&&cc.log(cc._LogInfos.ActionManager_addAction);
cc.assert(b,cc._LogInfos.ActionManager_addAction);var c=this._hashTargets[b.__instanceId];if(c)for(var d=c.actions.length,e=0;e<d;++e){var f=c.actions[e];if(f&&f.getTag()===a&&f.getOriginalTarget()===b){this._removeActionAtIndex(e,c);break}}},getActionByTag:function(a,b){a===cc.ACTION_TAG_INVALID&&cc.log(cc._LogInfos.ActionManager_getActionByTag);var c=this._hashTargets[b.__instanceId];if(c){if(null!=c.actions)for(var d=0;d<c.actions.length;++d){var e=c.actions[d];if(e&&e.getTag()===a)return e}cc.log(cc._LogInfos.ActionManager_getActionByTag_2,
a)}return null},numberOfRunningActionsInTarget:function(a){return(a=this._hashTargets[a.__instanceId])?a.actions?a.actions.length:0:0},pauseTarget:function(a){(a=this._hashTargets[a.__instanceId])&&(a.paused=!0)},resumeTarget:function(a){(a=this._hashTargets[a.__instanceId])&&(a.paused=!1)},pauseAllRunningActions:function(){for(var a=[],b=this._arrayTargets,c=0;c<b.length;c++){var d=b[c];d&&!d.paused&&(d.paused=!0,a.push(d.target))}return a},resumeTargets:function(a){if(a)for(var b=0;b<a.length;b++)a[b]&&
this.resumeTarget(a[b])},purgeSharedManager:function(){cc.director.getScheduler().unscheduleUpdate(this)},_removeActionAtIndex:function(a,b){b.actions.splice(a,1);b.actionIndex>=a&&b.actionIndex--;0===b.actions.length&&this._deleteHashElement(b)},_deleteHashElement:function(a){var b=!1;if(a&&!a.lock&&this._hashTargets[a.target.__instanceId]){delete this._hashTargets[a.target.__instanceId];for(var b=this._arrayTargets,c=0,d=b.length;c<d;c++)if(b[c]===a){b.splice(c,1);break}this._putElement(a);b=!0}return b},
update:function(a){for(var b=this._arrayTargets,c,d=0;d<b.length;d++){c=this._currentTarget=b[d];if(!c.paused&&c.actions){c.lock=!0;for(c.actionIndex=0;c.actionIndex<c.actions.length;c.actionIndex++)if(c.currentAction=c.actions[c.actionIndex],c.currentAction){c.currentAction.step(a*(c.currentAction._speedMethod?c.currentAction._speed:1));if(c.currentAction&&c.currentAction.isDone()){c.currentAction.stop();var e=c.currentAction;c.currentAction=null;this.removeAction(e)}c.currentAction=null}c.lock=
!1}0===c.actions.length&&this._deleteHashElement(c)&&d--}}});cc.profiler=function(){var a=!1,b=!1,c=0,d=0,e=0,f=0,g=null,h=document.createElement("div"),k=document.createElement("div"),m=document.createElement("div"),n=document.createElement("div"),p=10,r=[0,10,20,30],s=[0,0,0,0],u=3,t=0,w=0;n.id="fps";n.style.position="absolute";n.style.padding="3px";n.style.textAlign="left";n.style.backgroundColor="rgb(0, 0, 34)";n.style.bottom=cc.DIRECTOR_STATS_POSITION.y+"0px";n.style.left=cc.DIRECTOR_STATS_POSITION.x+"px";n.style.width="45px";n.style.height="80px";for(var v=
[m,k,h],x=0;3>x;++x){var A=v[x].style;A.color="rgb(0, 255, 255)";A.font="bold 12px Helvetica, Arial";A.lineHeight="20px";A.width="100%";n.appendChild(v[x])}var y=function(){e=cc.director.getSecondsPerFrame();c++;f+=cc.director.getDeltaTime();if(f>cc.DIRECTOR_FPS_INTERVAL){d=c/f;f=c=0;if(z.onFrameRateChange){var b=d,g=r.length-1,n=g,v=0;t++;for(w+=b;0<=n;n--)if(b>=r[n]){s[n]++;break}if(t>=p){v=w/p;for(n=g;0<n;n--)if(b=s[n]/p,0.6<=b&&v>=r[n]){n!=u&&(u=n,z.onFrameRateChange&&z.onFrameRateChange(v.toFixed(2)));
break}w=t=_changeCount=0;for(n=g;0<n;n--)s[n]=0}}a&&(n=cc._renderType===cc.game.RENDER_TYPE_CANVAS?"\n canvas":"\n webgl",g=k.innerHTML=e.toFixed(3),n=h.innerHTML=d.toFixed(1).toString()+n,v=m.innerHTML=(0|cc.g_NumberOfDraws).toString(),z.updateCustomLabel(g,n,v))}},z={onFrameRateChange:null,_customFPSLabel:null,_customSPFLabel:null,_customDrawsLabel:null,updateCustomLabel:function(a,b,c){this._customFPSLabel&&this._customFPSLabel.setString("FPS: "+b);this._customSPFLabel&&this._customSPFLabel.setString("SPF: "+
a);this._customDrawsLabel&&this._customDrawsLabel.setString("Draws: "+c)},getSecondsPerFrame:function(){return e},getFrameRate:function(){return d},setProfileDuration:function(a){!isNaN(a)&&0<a&&(p=a/cc.DIRECTOR_FPS_INTERVAL)},resumeProfiling:function(){cc.eventManager.addListener(g,1)},stopProfiling:function(){cc.eventManager.removeListener(g)},isShowingStats:function(){return a},showStats:function(){b||this.init();null===n.parentElement&&cc.container.appendChild(n);a=!0},hideStats:function(){a=
!1;n.parentElement===cc.container&&cc.container.removeChild(n)},init:function(){b||(g=cc.eventManager.addCustomListener(cc.Director.EVENT_AFTER_VISIT,y),b=!0)}};return z}();cc.math=cc.math||{};cc.math.EPSILON=0.015625;cc.math.square=function(a){return a*a};cc.math.almostEqual=function(a,b){return a+cc.math.EPSILON>b&&a-cc.math.EPSILON<b};(function(a){a.math.Vec2=function(a,b){void 0===b?(this.x=a.x,this.y=a.y):(this.x=a||0,this.y=b||0)};var b=a.math.Vec2.prototype;b.fill=function(a,b){this.x=a;this.y=b};b.length=function(){return Math.sqrt(a.math.square(this.x)+a.math.square(this.y))};b.lengthSq=function(){return a.math.square(this.x)+a.math.square(this.y)};b.normalize=function(){var a=1/this.length();this.x*=a;this.y*=a;return this};a.math.Vec2.add=function(a,b,e){a.x=b.x+e.x;a.y=b.y+e.y;return a};b.add=function(a){this.x+=a.x;this.y+=
a.y;return this};b.dot=function(a){return this.x*a.x+this.y*a.y};a.math.Vec2.subtract=function(a,b,e){a.x=b.x-e.x;a.y=b.y-e.y;return a};b.subtract=function(a){this.x-=a.x;this.y-=a.y;return this};b.transform=function(a){var b=this.x,e=this.y;this.x=b*a.mat[0]+e*a.mat[3]+a.mat[6];this.y=b*a.mat[1]+e*a.mat[4]+a.mat[7];return this};a.math.Vec2.scale=function(a,b,e){a.x=b.x*e;a.y=b.y*e;return a};b.scale=function(a){this.x*=a;this.y*=a;return this};b.equals=function(b){return this.x<b.x+a.math.EPSILON&&
this.x>b.x-a.math.EPSILON&&this.y<b.y+a.math.EPSILON&&this.y>b.y-a.math.EPSILON}})(cc);(function(a){a.math.Vec3=a.kmVec3=function(a,b,e){a&&void 0===b?(this.x=a.x,this.y=a.y,this.z=a.z):(this.x=a||0,this.y=b||0,this.z=e||0)};a.math.vec3=function(b,d,e){return new a.math.Vec3(b,d,e)};var b=a.math.Vec3.prototype;b.fill=function(a,b,e){a&&void 0===b?(this.x=a.x,this.y=a.y,this.z=a.z):(this.x=a,this.y=b,this.z=e);return this};b.length=function(){return Math.sqrt(a.math.square(this.x)+a.math.square(this.y)+a.math.square(this.z))};b.lengthSq=function(){return a.math.square(this.x)+a.math.square(this.y)+
a.math.square(this.z)};b.normalize=function(){var a=1/this.length();this.x*=a;this.y*=a;this.z*=a;return this};b.cross=function(a){var b=this.x,e=this.y,f=this.z;this.x=e*a.z-f*a.y;this.y=f*a.x-b*a.z;this.z=b*a.y-e*a.x;return this};b.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z};b.add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this};b.subtract=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this};b.transform=function(a){var b=this.x,e=this.y,f=this.z;a=a.mat;this.x=b*
a[0]+e*a[4]+f*a[8]+a[12];this.y=b*a[1]+e*a[5]+f*a[9]+a[13];this.z=b*a[2]+e*a[6]+f*a[10]+a[14];return this};b.transformNormal=function(a){var b=this.x,e=this.y,f=this.z;a=a.mat;this.x=b*a[0]+e*a[4]+f*a[8];this.y=b*a[1]+e*a[5]+f*a[9];this.z=b*a[2]+e*a[6]+f*a[10];return this};b.transformCoord=function(b){var d=new a.math.Vec4(this.x,this.y,this.z,1);d.transform(b);this.x=d.x/d.w;this.y=d.y/d.w;this.z=d.z/d.w;return this};b.scale=function(a){this.x*=a;this.y*=a;this.z*=a;return this};b.equals=function(b){var d=
a.math.EPSILON;return this.x<b.x+d&&this.x>b.x-d&&this.y<b.y+d&&this.y>b.y-d&&this.z<b.z+d&&this.z>b.z-d};b.inverseTransform=function(b){b=b.mat;var d=new a.math.Vec3(this.x-b[12],this.y-b[13],this.z-b[14]);this.x=d.x*b[0]+d.y*b[1]+d.z*b[2];this.y=d.x*b[4]+d.y*b[5]+d.z*b[6];this.z=d.x*b[8]+d.y*b[9]+d.z*b[10];return this};b.inverseTransformNormal=function(a){var b=this.x,e=this.y,f=this.z;a=a.mat;this.x=b*a[0]+e*a[1]+f*a[2];this.y=b*a[4]+e*a[5]+f*a[6];this.z=b*a[8]+e*a[9]+f*a[10];return this};b.assignFrom=
function(a){if(!a)return this;this.x=a.x;this.y=a.y;this.z=a.z;return this};a.math.Vec3.zero=function(a){a.x=a.y=a.z=0;return a};b.toTypeArray=function(){var a=new Float32Array(3);a[0]=this.x;a[1]=this.y;a[2]=this.z;return a}})(cc);(function(a){a.math.Vec4=function(a,b,e,f){a&&void 0===b?(this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w):(this.x=a||0,this.y=b||0,this.z=e||0,this.w=f||0)};a.kmVec4=a.math.Vec4;var b=a.math.Vec4.prototype;b.fill=function(a,b,e,f){a&&void 0===b?(this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w):(this.x=a,this.y=b,this.z=e,this.w=f)};b.add=function(a){if(!a)return this;this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this};b.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w};b.length=
function(){return Math.sqrt(a.math.square(this.x)+a.math.square(this.y)+a.math.square(this.z)+a.math.square(this.w))};b.lengthSq=function(){return a.math.square(this.x)+a.math.square(this.y)+a.math.square(this.z)+a.math.square(this.w)};b.lerp=function(a,b){return this};b.normalize=function(){var a=1/this.length();this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this};b.scale=function(a){this.normalize();this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this};b.subtract=function(a){this.x-=a.x;this.y-=
a.y;this.z-=a.z;this.w-=a.w};b.transform=function(a){var b=this.x,e=this.y,f=this.z,g=this.w;a=a.mat;this.x=b*a[0]+e*a[4]+f*a[8]+g*a[12];this.y=b*a[1]+e*a[5]+f*a[9]+g*a[13];this.z=b*a[2]+e*a[6]+f*a[10]+g*a[14];this.w=b*a[3]+e*a[7]+f*a[11]+g*a[15];return this};a.math.Vec4.transformArray=function(b,d){for(var e=[],f=0;f<b.length;f++){var g=new a.math.Vec4(b[f]);g.transform(d);e.push(g)}return e};b.equals=function(b){var d=a.math.EPSILON;return this.x<b.x+d&&this.x>b.x-d&&this.y<b.y+d&&this.y>b.y-d&&
this.z<b.z+d&&this.z>b.z-d&&this.w<b.w+d&&this.w>b.w-d};b.assignFrom=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this};b.toTypeArray=function(){var a=new Float32Array(4);a[0]=this.x;a[1]=this.y;a[2]=this.z;a[3]=this.w;return a}})(cc);(function(a){function b(b,d,e){d=new a.math.Vec2(d);d.subtract(b);e.x=-d.y;e.y=d.x;e.normalize()}a.math.Ray2=function(b,d){this.start=b||new a.math.Vec2;this.dir=d||new a.math.Vec2};a.math.Ray2.prototype.fill=function(a,b,e,f){this.start.x=a;this.start.y=b;this.dir.x=e;this.dir.y=f};a.math.Ray2.prototype.intersectLineSegment=function(b,d,e){var f=this.start.x,g=this.start.y,h=this.start.x+this.dir.x,k=this.start.y+this.dir.y,m=b.x,n=b.y,p=d.x,r=d.y,s=(r-n)*(h-f)-(p-m)*(k-g);if(s>-a.math.EPSILON&&
s<a.math.EPSILON)return!1;n=((p-m)*(g-n)-(r-n)*(f-m))/s;m=f+n*(h-f);n=g+n*(k-g);if(m<Math.min(b.x,d.x)-a.math.EPSILON||m>Math.max(b.x,d.x)+a.math.EPSILON||n<Math.min(b.y,d.y)-a.math.EPSILON||n>Math.max(b.y,d.y)+a.math.EPSILON||m<Math.min(f,h)-a.math.EPSILON||m>Math.max(f,h)+a.math.EPSILON||n<Math.min(g,k)-a.math.EPSILON||n>Math.max(g,k)+a.math.EPSILON)return!1;e.x=m;e.y=n;return!0};a.math.Ray2.prototype.intersectTriangle=function(c,d,e,f,g){var h=new a.math.Vec2,k=new a.math.Vec2,m=new a.math.Vec2,
n=1E4,p=!1,r;this.intersectLineSegment(c,d,h)&&(p=!0,r=h.subtract(this.start).length(),r<n&&(k.x=h.x,k.y=h.y,n=r,b(c,d,m)));this.intersectLineSegment(d,e,h)&&(p=!0,r=h.subtract(this.start).length(),r<n&&(k.x=h.x,k.y=h.y,n=r,b(d,e,m)));this.intersectLineSegment(e,c,h)&&(p=!0,r=h.subtract(this.start).length(),r<n&&(k.x=h.x,k.y=h.y,b(e,c,m)));p&&(f.x=k.x,f.y=k.y,g&&(g.x=m.x,g.y=m.y));return p}})(cc);window.Uint16Array=window.Uint16Array||window.Array;window.Float32Array=window.Float32Array||window.Array;
(function(a){a.math.Matrix3=function(a){this.mat=a&&a.mat?new Float32Array(a.mat):new Float32Array(9)};a.kmMat3=a.math.Matrix3;var b=a.math.Matrix3.prototype;b.fill=function(a){var b=this.mat;a=a.mat;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return this};b.adjugate=function(){var a=this.mat,b=a[0],c=a[1],g=a[2],h=a[3],k=a[4],m=a[5],n=a[6],p=a[7],r=a[8];a[0]=k*r-m*p;a[1]=g*p-c*r;a[2]=c*m-g*k;a[3]=m*n-h*r;a[4]=b*r-g*n;a[5]=g*h-b*m;a[6]=h*p-k*n;a[8]=b*
k-c*h;return this};b.identity=function(){var a=this.mat;a[1]=a[2]=a[3]=a[5]=a[6]=a[7]=0;a[0]=a[4]=a[8]=1;return this};var c=new a.math.Matrix3;b.inverse=function(a){if(0===a)return this;c.assignFrom(this);a=1/a;this.adjugate();this.multiplyScalar(a);return this};b.isIdentity=function(){var a=this.mat;return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&1===a[4]&&0===a[5]&&0===a[6]&&0===a[7]&&1===a[8]};b.transpose=function(){var a=this.mat,b=a[1],c=a[2],g=a[5],h=a[6],k=a[7];a[1]=a[3];a[2]=h;a[3]=b;a[5]=
k;a[6]=c;a[7]=g;return this};b.determinant=function(){var a=this.mat,b=a[0]*a[4]*a[8]+a[1]*a[5]*a[6]+a[2]*a[3]*a[7];return b-=a[2]*a[4]*a[6]+a[0]*a[5]*a[7]+a[1]*a[3]*a[8]};b.multiply=function(a){var b=this.mat,c=a.mat;a=b[0];var g=b[1],h=b[2],k=b[3],m=b[4],n=b[5],p=b[6],r=b[7],s=b[8],u=c[0],t=c[1],w=c[2],v=c[3],x=c[4],A=c[5],y=c[6],z=c[7],c=c[8];b[0]=a*u+k*t+p*w;b[1]=g*u+m*t+r*w;b[2]=h*u+n*t+s*w;b[3]=h*u+n*t+s*w;b[4]=g*v+m*x+r*A;b[5]=h*v+n*x+s*A;b[6]=a*y+k*z+p*c;b[7]=g*y+m*z+r*c;b[8]=h*y+n*z+s*c;
return this};b.multiplyScalar=function(a){var b=this.mat;b[0]*=a;b[1]*=a;b[2]*=a;b[3]*=a;b[4]*=a;b[5]*=a;b[6]*=a;b[7]*=a;b[8]*=a;return this};a.math.Matrix3.rotationAxisAngle=function(b,c){var f=Math.cos(c),g=Math.sin(c),h=new a.math.Matrix3,k=h.mat;k[0]=f+b.x*b.x*(1-f);k[1]=b.z*g+b.y*b.x*(1-f);k[2]=-b.y*g+b.z*b.x*(1-f);k[3]=-b.z*g+b.x*b.y*(1-f);k[4]=f+b.y*b.y*(1-f);k[5]=b.x*g+b.z*b.y*(1-f);k[6]=b.y*g+b.x*b.z*(1-f);k[7]=-b.x*g+b.y*b.z*(1-f);k[8]=f+b.z*b.z*(1-f);return h};b.assignFrom=function(b){if(this===
b)return a.log("cc.math.Matrix3.assign(): current matrix equals matIn"),this;var c=this.mat;b=b.mat;c[0]=b[0];c[1]=b[1];c[2]=b[2];c[3]=b[3];c[4]=b[4];c[5]=b[5];c[6]=b[6];c[7]=b[7];c[8]=b[8];return this};b.equals=function(b){if(this===b)return!0;var c=a.math.EPSILON,f=this.mat;b=b.mat;for(var g=0;9>g;++g)if(!(f[g]+c>b[g]&&f[g]-c<b[g]))return!1;return!0};a.math.Matrix3.createByRotationX=function(b){var c=new a.math.Matrix3,f=c.mat;f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=Math.cos(b);f[5]=Math.sin(b);f[6]=0;
f[7]=-Math.sin(b);f[8]=Math.cos(b);return c};a.math.Matrix3.createByRotationY=function(b){var c=new a.math.Matrix3,f=c.mat;f[0]=Math.cos(b);f[1]=0;f[2]=-Math.sin(b);f[3]=0;f[4]=1;f[5]=0;f[6]=Math.sin(b);f[7]=0;f[8]=Math.cos(b);return c};a.math.Matrix3.createByRotationZ=function(b){var c=new a.math.Matrix3,f=c.mat;f[0]=Math.cos(b);f[1]=-Math.sin(b);f[2]=0;f[3]=Math.sin(b);f[4]=Math.cos(b);f[5]=0;f[6]=0;f[7]=0;f[8]=1;return c};a.math.Matrix3.createByRotation=function(b){var c=new a.math.Matrix3,f=c.mat;
f[0]=Math.cos(b);f[1]=Math.sin(b);f[2]=0;f[3]=-Math.sin(b);f[4]=Math.cos(b);f[5]=0;f[6]=0;f[7]=0;f[8]=1;return c};a.math.Matrix3.createByScale=function(b,c){var f=new a.math.Matrix3;f.identity();f.mat[0]=b;f.mat[4]=c;return f};a.math.Matrix3.createByTranslation=function(b,c){var f=new a.math.Matrix3;f.identity();f.mat[6]=b;f.mat[7]=c;return f};a.math.Matrix3.createByQuaternion=function(b){if(!b)return null;var c=new a.math.Matrix3,f=c.mat;f[0]=1-2*(b.y*b.y+b.z*b.z);f[1]=2*(b.x*b.y-b.w*b.z);f[2]=2*
(b.x*b.z+b.w*b.y);f[3]=2*(b.x*b.y+b.w*b.z);f[4]=1-2*(b.x*b.x+b.z*b.z);f[5]=2*(b.y*b.z-b.w*b.x);f[6]=2*(b.x*b.z-b.w*b.y);f[7]=2*(b.y*b.z+b.w*b.x);f[8]=1-2*(b.x*b.x+b.y*b.y);return c};b.rotationToAxisAngle=function(){return a.math.Quaternion.rotationMatrix(this).toAxisAndAngle()}})(cc);(function(a){a.math.Matrix4=function(a){this.mat=a&&a.mat?new Float32Array(a.mat):new Float32Array(16)};a.kmMat4=a.math.Matrix4;var b=a.math.Matrix4.prototype;b.fill=function(a){for(var b=this.mat,c=0;16>c;c++)b[c]=a[c];return this};a.kmMat4Identity=function(a){var b=a.mat;b[1]=b[2]=b[3]=b[4]=b[6]=b[7]=b[8]=b[9]=b[11]=b[12]=b[13]=b[14]=0;b[0]=b[5]=b[10]=b[15]=1;return a};b.identity=function(){var a=this.mat;a[1]=a[2]=a[3]=a[4]=a[6]=a[7]=a[8]=a[9]=a[11]=a[12]=a[13]=a[14]=0;a[0]=a[5]=a[10]=a[15]=1;
return this};b.get=function(a,b){return this.mat[a+4*b]};b.set=function(a,b,c){this.mat[a+4*b]=c};b.swap=function(a,b,c,d){var k=this.mat,m=k[a+4*b];k[a+4*b]=k[c+4*d];k[c+4*d]=m};a.math.Matrix4._gaussj=function(a,b){var c,d=0,k=0,m,n,p,r,s=[0,0,0,0],u=[0,0,0,0],t=[0,0,0,0];for(c=0;4>c;c++){for(m=r=0;4>m;m++)if(1!==t[m])for(n=0;4>n;n++)0===t[n]&&(p=Math.abs(a.get(m,n)),p>=r&&(r=p,k=m,d=n));++t[d];if(k!==d){for(m=0;4>m;m++)a.swap(k,m,d,m);for(m=0;4>m;m++)b.swap(k,m,d,m)}u[c]=k;s[c]=d;if(0===a.get(d,
d))return!1;n=1/a.get(d,d);a.set(d,d,1);for(m=0;4>m;m++)a.set(d,m,a.get(d,m)*n);for(m=0;4>m;m++)b.set(d,m,b.get(d,m)*n);for(n=0;4>n;n++)if(n!==d){p=a.get(n,d);a.set(n,d,0);for(m=0;4>m;m++)a.set(n,m,a.get(n,m)-a.get(d,m)*p);for(m=0;4>m;m++)b.set(n,m,a.get(n,m)-b.get(d,m)*p)}}for(m=3;0<=m;m--)if(u[m]!==s[m])for(n=0;4>n;n++)a.swap(n,u[m],n,s[m]);return!0};var c=(new a.math.Matrix4).identity();a.kmMat4Inverse=function(b,d){var g=new a.math.Matrix4(d),h=new a.math.Matrix4(c);if(!1===a.math.Matrix4._gaussj(g,
h))return null;b.assignFrom(g);return b};b.inverse=function(){var b=new a.math.Matrix4(this),d=new a.math.Matrix4(c);return!1===a.math.Matrix4._gaussj(b,d)?null:b};b.isIdentity=function(){var a=this.mat;return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&0===a[12]&&0===a[13]&&0===a[14]&&1===a[15]};b.transpose=function(){var a=this.mat,b=a[1],c=a[2],d=a[3],k=a[6],m=a[7],n=a[8],p=a[9],r=a[11],s=a[12],u=a[13],t=a[14];a[1]=a[4];
a[2]=n;a[3]=s;a[4]=b;a[6]=p;a[7]=u;a[8]=c;a[9]=k;a[11]=t;a[12]=d;a[13]=m;a[14]=r;return this};a.kmMat4Multiply=function(a,b,c){var d=a.mat,k=b.mat,m=c.mat;c=k[0];b=k[1];var n=k[2],p=k[3],r=k[4],s=k[5],u=k[6],t=k[7],w=k[8],v=k[9],x=k[10],A=k[11],y=k[12],z=k[13],B=k[14],k=k[15],D=m[0],C=m[1],G=m[2],F=m[3],E=m[4],J=m[5],K=m[6],I=m[7],M=m[8],H=m[9],L=m[10],N=m[11],Q=m[12],P=m[13],O=m[14],m=m[15];d[0]=D*c+C*r+G*w+F*y;d[1]=D*b+C*s+G*v+F*z;d[2]=D*n+C*u+G*x+F*B;d[3]=D*p+C*t+G*A+F*k;d[4]=E*c+J*r+K*w+I*y;d[5]=
E*b+J*s+K*v+I*z;d[6]=E*n+J*u+K*x+I*B;d[7]=E*p+J*t+K*A+I*k;d[8]=M*c+H*r+L*w+N*y;d[9]=M*b+H*s+L*v+N*z;d[10]=M*n+H*u+L*x+N*B;d[11]=M*p+H*t+L*A+N*k;d[12]=Q*c+P*r+O*w+m*y;d[13]=Q*b+P*s+O*v+m*z;d[14]=Q*n+P*u+O*x+m*B;d[15]=Q*p+P*t+O*A+m*k;return a};b.multiply=function(a){var b=this.mat,c=a.mat;a=b[0];var d=b[1],k=b[2],m=b[3],n=b[4],p=b[5],r=b[6],s=b[7],u=b[8],t=b[9],w=b[10],v=b[11],x=b[12],A=b[13],y=b[14],z=b[15],B=c[0],D=c[1],C=c[2],G=c[3],F=c[4],E=c[5],J=c[6],K=c[7],I=c[8],M=c[9],H=c[10],L=c[11],N=c[12],
Q=c[13],P=c[14],c=c[15];b[0]=B*a+D*n+C*u+G*x;b[1]=B*d+D*p+C*t+G*A;b[2]=B*k+D*r+C*w+G*y;b[3]=B*m+D*s+C*v+G*z;b[4]=F*a+E*n+J*u+K*x;b[5]=F*d+E*p+J*t+K*A;b[6]=F*k+E*r+J*w+K*y;b[7]=F*m+E*s+J*v+K*z;b[8]=I*a+M*n+H*u+L*x;b[9]=I*d+M*p+H*t+L*A;b[10]=I*k+M*r+H*w+L*y;b[11]=I*m+M*s+H*v+L*z;b[12]=N*a+Q*n+P*u+c*x;b[13]=N*d+Q*p+P*t+c*A;b[14]=N*k+Q*r+P*w+c*y;b[15]=N*m+Q*s+P*v+c*z;return this};a.getMat4MultiplyValue=function(a,b){var c=a.mat,d=b.mat,k=new Float32Array(16);k[0]=c[0]*d[0]+c[4]*d[1]+c[8]*d[2]+c[12]*d[3];
k[1]=c[1]*d[0]+c[5]*d[1]+c[9]*d[2]+c[13]*d[3];k[2]=c[2]*d[0]+c[6]*d[1]+c[10]*d[2]+c[14]*d[3];k[3]=c[3]*d[0]+c[7]*d[1]+c[11]*d[2]+c[15]*d[3];k[4]=c[0]*d[4]+c[4]*d[5]+c[8]*d[6]+c[12]*d[7];k[5]=c[1]*d[4]+c[5]*d[5]+c[9]*d[6]+c[13]*d[7];k[6]=c[2]*d[4]+c[6]*d[5]+c[10]*d[6]+c[14]*d[7];k[7]=c[3]*d[4]+c[7]*d[5]+c[11]*d[6]+c[15]*d[7];k[8]=c[0]*d[8]+c[4]*d[9]+c[8]*d[10]+c[12]*d[11];k[9]=c[1]*d[8]+c[5]*d[9]+c[9]*d[10]+c[13]*d[11];k[10]=c[2]*d[8]+c[6]*d[9]+c[10]*d[10]+c[14]*d[11];k[11]=c[3]*d[8]+c[7]*d[9]+c[11]*
d[10]+c[15]*d[11];k[12]=c[0]*d[12]+c[4]*d[13]+c[8]*d[14]+c[12]*d[15];k[13]=c[1]*d[12]+c[5]*d[13]+c[9]*d[14]+c[13]*d[15];k[14]=c[2]*d[12]+c[6]*d[13]+c[10]*d[14]+c[14]*d[15];k[15]=c[3]*d[12]+c[7]*d[13]+c[11]*d[14]+c[15]*d[15];return k};a.kmMat4Assign=function(b,c){if(b===c)return a.log("cc.kmMat4Assign(): pOut equals pIn"),b;var d=b.mat,h=c.mat;d[0]=h[0];d[1]=h[1];d[2]=h[2];d[3]=h[3];d[4]=h[4];d[5]=h[5];d[6]=h[6];d[7]=h[7];d[8]=h[8];d[9]=h[9];d[10]=h[10];d[11]=h[11];d[12]=h[12];d[13]=h[13];d[14]=h[14];
d[15]=h[15];return b};b.assignFrom=function(b){if(this===b)return a.log("cc.mat.Matrix4.assignFrom(): mat4 equals current matrix"),this;var c=this.mat;b=b.mat;c[0]=b[0];c[1]=b[1];c[2]=b[2];c[3]=b[3];c[4]=b[4];c[5]=b[5];c[6]=b[6];c[7]=b[7];c[8]=b[8];c[9]=b[9];c[10]=b[10];c[11]=b[11];c[12]=b[12];c[13]=b[13];c[14]=b[14];c[15]=b[15];return this};b.equals=function(b){if(this===b)return a.log("cc.kmMat4AreEqual(): pMat1 and pMat2 are same object."),!0;var c=this.mat;b=b.mat;for(var d=a.math.EPSILON,h=0;16>
h;h++)if(!(c[h]+d>b[h]&&c[h]-d<b[h]))return!1;return!0};a.math.Matrix4.createByRotationX=function(b,c){c=c||new a.math.Matrix4;var d=c.mat;d[0]=1;d[3]=d[2]=d[1]=0;d[4]=0;d[5]=Math.cos(b);d[6]=Math.sin(b);d[7]=0;d[8]=0;d[9]=-Math.sin(b);d[10]=Math.cos(b);d[11]=0;d[14]=d[13]=d[12]=0;d[15]=1;return c};a.math.Matrix4.createByRotationY=function(b,c){c=c||new a.math.Matrix4;var d=c.mat;d[0]=Math.cos(b);d[1]=0;d[2]=-Math.sin(b);d[3]=0;d[7]=d[6]=d[4]=0;d[5]=1;d[8]=Math.sin(b);d[9]=0;d[10]=Math.cos(b);d[11]=
0;d[14]=d[13]=d[12]=0;d[15]=1;return c};a.math.Matrix4.createByRotationZ=function(b,c){c=c||new a.math.Matrix4;var d=c.mat;d[0]=Math.cos(b);d[1]=Math.sin(b);d[3]=d[2]=0;d[4]=-Math.sin(b);d[5]=Math.cos(b);d[7]=d[6]=0;d[11]=d[9]=d[8]=0;d[10]=1;d[14]=d[13]=d[12]=0;d[15]=1;return c};a.math.Matrix4.createByPitchYawRoll=function(b,c,d,h){h=h||new a.math.Matrix4;var k=Math.cos(b);b=Math.sin(b);var m=Math.cos(c);c=Math.sin(c);var n=Math.cos(d);d=Math.sin(d);var p=b*c,r=k*c,s=h.mat;s[0]=m*n;s[4]=m*d;s[8]=
-c;s[1]=p*n-k*d;s[5]=p*d+k*n;s[9]=b*m;s[2]=r*n+b*d;s[6]=r*d-b*n;s[10]=k*m;s[3]=s[7]=s[11]=0;s[15]=1;return h};a.math.Matrix4.createByQuaternion=function(b,c){c=c||new a.math.Matrix4;var d=c.mat;d[0]=1-2*(b.y*b.y+b.z*b.z);d[1]=2*(b.x*b.y+b.z*b.w);d[2]=2*(b.x*b.z-b.y*b.w);d[3]=0;d[4]=2*(b.x*b.y-b.z*b.w);d[5]=1-2*(b.x*b.x+b.z*b.z);d[6]=2*(b.z*b.y+b.x*b.w);d[7]=0;d[8]=2*(b.x*b.z+b.y*b.w);d[9]=2*(b.y*b.z-b.x*b.w);d[10]=1-2*(b.x*b.x+b.y*b.y);d[11]=0;d[14]=d[13]=d[12]=0;d[15]=1;return c};a.math.Matrix4.createByRotationTranslation=
function(b,c,d){d=d||new a.math.Matrix4;var h=d.mat;b=b.mat;h[0]=b[0];h[1]=b[1];h[2]=b[2];h[3]=0;h[4]=b[3];h[5]=b[4];h[6]=b[5];h[7]=0;h[8]=b[6];h[9]=b[7];h[10]=b[8];h[11]=0;h[12]=c.x;h[13]=c.y;h[14]=c.z;h[15]=1;return d};a.math.Matrix4.createByScale=function(b,c,d,h){h=h||new a.math.Matrix4;var k=h.mat;k[0]=b;k[5]=c;k[10]=d;k[15]=1;k[1]=k[2]=k[3]=k[4]=k[6]=k[7]=k[8]=k[9]=k[11]=k[12]=k[13]=k[14]=0;return h};a.kmMat4Translation=function(a,b,c,d){a.mat[0]=a.mat[5]=a.mat[10]=a.mat[15]=1;a.mat[1]=a.mat[2]=
a.mat[3]=a.mat[4]=a.mat[6]=a.mat[7]=a.mat[8]=a.mat[9]=a.mat[11]=0;a.mat[12]=b;a.mat[13]=c;a.mat[14]=d;return a};a.math.Matrix4.createByTranslation=function(b,c,d,h){h=h||new a.math.Matrix4;h.identity();h.mat[12]=b;h.mat[13]=c;h.mat[14]=d;return h};b.getUpVec3=function(){var b=this.mat;return(new a.math.Vec3(b[4],b[5],b[6])).normalize()};b.getRightVec3=function(){var b=this.mat;return(new a.math.Vec3(b[0],b[1],b[2])).normalize()};b.getForwardVec3=function(){var b=this.mat;return(new a.math.Vec3(b[8],
b[9],b[10])).normalize()};a.kmMat4PerspectiveProjection=function(b,c,d,h,k){var m=a.degreesToRadians(c/2);c=k-h;var n=Math.sin(m);if(0===c||0===n||0===d)return null;m=Math.cos(m)/n;b.identity();b.mat[0]=m/d;b.mat[5]=m;b.mat[10]=-(k+h)/c;b.mat[11]=-1;b.mat[14]=-2*h*k/c;b.mat[15]=0;return b};a.math.Matrix4.createPerspectiveProjection=function(b,c,d,h){var k=a.degreesToRadians(b/2);b=h-d;var m=Math.sin(k);if(0===b||0===m||0===c)return null;var k=Math.cos(k)/m,m=new a.math.Matrix4,n=m.mat;m.identity();
n[0]=k/c;n[5]=k;n[10]=-(h+d)/b;n[11]=-1;n[14]=-2*d*h/b;n[15]=0;return m};a.kmMat4OrthographicProjection=function(a,b,c,d,k,m,n){a.identity();a.mat[0]=2/(c-b);a.mat[5]=2/(k-d);a.mat[10]=-2/(n-m);a.mat[12]=-((c+b)/(c-b));a.mat[13]=-((k+d)/(k-d));a.mat[14]=-((n+m)/(n-m));return a};a.math.Matrix4.createOrthographicProjection=function(b,c,d,h,k,m){var n=new a.math.Matrix4,p=n.mat;n.identity();p[0]=2/(c-b);p[5]=2/(h-d);p[10]=-2/(m-k);p[12]=-((c+b)/(c-b));p[13]=-((h+d)/(h-d));p[14]=-((m+k)/(m-k));return n};
a.kmMat4LookAt=function(b,c,d,h){d=new a.math.Vec3(d);var k=new a.math.Vec3(h);d.subtract(c);d.normalize();k.normalize();h=new a.math.Vec3(d);h.cross(k);h.normalize();k=new a.math.Vec3(h);k.cross(d);h.normalize();b.identity();b.mat[0]=h.x;b.mat[4]=h.y;b.mat[8]=h.z;b.mat[1]=k.x;b.mat[5]=k.y;b.mat[9]=k.z;b.mat[2]=-d.x;b.mat[6]=-d.y;b.mat[10]=-d.z;c=a.math.Matrix4.createByTranslation(-c.x,-c.y,-c.z);b.multiply(c);return b};var d=new a.math.Matrix4;b.lookAt=function(b,c,g){c=new a.math.Vec3(c);var h=
new a.math.Vec3(g);g=this.mat;c.subtract(b);c.normalize();h.normalize();var k=new a.math.Vec3(c);k.cross(h);k.normalize();h=new a.math.Vec3(k);h.cross(c);k.normalize();this.identity();g[0]=k.x;g[4]=k.y;g[8]=k.z;g[1]=h.x;g[5]=h.y;g[9]=h.z;g[2]=-c.x;g[6]=-c.y;g[10]=-c.z;d=a.math.Matrix4.createByTranslation(-b.x,-b.y,-b.z,d);this.multiply(d);return this};a.kmMat4RotationAxisAngle=function(b,c,d){var h=Math.cos(d);d=Math.sin(d);c=new a.math.Vec3(c);c.normalize();b.mat[0]=h+c.x*c.x*(1-h);b.mat[1]=c.z*
d+c.y*c.x*(1-h);b.mat[2]=-c.y*d+c.z*c.x*(1-h);b.mat[3]=0;b.mat[4]=-c.z*d+c.x*c.y*(1-h);b.mat[5]=h+c.y*c.y*(1-h);b.mat[6]=c.x*d+c.z*c.y*(1-h);b.mat[7]=0;b.mat[8]=c.y*d+c.x*c.z*(1-h);b.mat[9]=-c.x*d+c.y*c.z*(1-h);b.mat[10]=h+c.z*c.z*(1-h);b.mat[11]=0;b.mat[12]=0;b.mat[13]=0;b.mat[14]=0;b.mat[15]=1;return b};a.math.Matrix4.createByAxisAndAngle=function(b,c,d){d=d||new a.math.Matrix4;var h=this.mat,k=Math.cos(c);c=Math.sin(c);b=new a.math.Vec3(b);b.normalize();h[0]=k+b.x*b.x*(1-k);h[1]=b.z*c+b.y*b.x*
(1-k);h[2]=-b.y*c+b.z*b.x*(1-k);h[3]=0;h[4]=-b.z*c+b.x*b.y*(1-k);h[5]=k+b.y*b.y*(1-k);h[6]=b.x*c+b.z*b.y*(1-k);h[7]=0;h[8]=b.y*c+b.x*b.z*(1-k);h[9]=-b.x*c+b.y*b.z*(1-k);h[10]=k+b.z*b.z*(1-k);h[11]=0;h[12]=h[13]=h[14]=0;h[15]=1;return d};b.extractRotation=function(){var b=new a.math.Matrix3,c=this.mat,d=b.mat;d[0]=c[0];d[1]=c[1];d[2]=c[2];d[3]=c[4];d[4]=c[5];d[5]=c[6];d[6]=c[8];d[7]=c[9];d[8]=c[10];return b};b.extractPlane=function(b){var c=new a.math.Plane,d=this.mat;switch(b){case a.math.Plane.RIGHT:c.a=
d[3]-d[0];c.b=d[7]-d[4];c.c=d[11]-d[8];c.d=d[15]-d[12];break;case a.math.Plane.LEFT:c.a=d[3]+d[0];c.b=d[7]+d[4];c.c=d[11]+d[8];c.d=d[15]+d[12];break;case a.math.Plane.BOTTOM:c.a=d[3]+d[1];c.b=d[7]+d[5];c.c=d[11]+d[9];c.d=d[15]+d[13];break;case a.math.Plane.TOP:c.a=d[3]-d[1];c.b=d[7]-d[5];c.c=d[11]-d[9];c.d=d[15]-d[13];break;case a.math.Plane.FAR:c.a=d[3]-d[2];c.b=d[7]-d[6];c.c=d[11]-d[10];c.d=d[15]-d[14];break;case a.math.Plane.NEAR:c.a=d[3]+d[2];c.b=d[7]+d[6];c.c=d[11]+d[10];c.d=d[15]+d[14];break;
default:a.log("cc.math.Matrix4.extractPlane: Invalid plane index")}b=Math.sqrt(c.a*c.a+c.b*c.b+c.c*c.c);c.a/=b;c.b/=b;c.c/=b;c.d/=b;return c};b.toAxisAndAngle=function(){var b=this.extractRotation();return a.math.Quaternion.rotationMatrix(b).toAxisAndAngle()}})(cc);(function(a){a.math.Plane=function(a,b,e,f){a&&void 0===b?(this.a=a.a,this.b=a.b,this.c=a.c,this.d=a.d):(this.a=a||0,this.b=b||0,this.c=e||0,this.d=f||0)};a.kmPlane=a.math.Plane;var b=a.math.Plane.prototype;a.math.Plane.LEFT=0;a.math.Plane.RIGHT=1;a.math.Plane.BOTTOM=2;a.math.Plane.TOP=3;a.math.Plane.NEAR=4;a.math.Plane.FAR=5;a.math.Plane.POINT_INFRONT_OF_PLANE=0;a.math.Plane.POINT_BEHIND_PLANE=1;a.math.Plane.POINT_ON_PLANE=2;b.dot=function(a){return this.a*a.x+this.b*a.y+this.c*a.z+this.d*a.w};b.dotCoord=
function(a){return this.a*a.x+this.b*a.y+this.c*a.z+this.d};b.dotNormal=function(a){return this.a*a.x+this.b*a.y+this.c*a.z};a.math.Plane.fromPointNormal=function(b,d){return new a.math.Plane(d.x,d.y,d.z,-d.dot(b))};a.math.Plane.fromPoints=function(b,d,e){d=new a.math.Vec3(d);e=new a.math.Vec3(e);var f=new a.math.Plane;d.subtract(b);e.subtract(b);d.cross(e);d.normalize();f.a=d.x;f.b=d.y;f.c=d.z;f.d=d.scale(-1).dot(b);return f};b.normalize=function(){var b=new a.math.Vec3(this.a,this.b,this.c),d=1/
b.length();b.normalize();this.a=b.x;this.b=b.y;this.c=b.z;this.d*=d;return this};b.classifyPoint=function(b){b=this.a*b.x+this.b*b.y+this.c*b.z+this.d;return 0.001<b?a.math.Plane.POINT_INFRONT_OF_PLANE:-0.001>b?a.math.Plane.POINT_BEHIND_PLANE:a.math.Plane.POINT_ON_PLANE}})(cc);(function(a){a.math.Quaternion=function(a,b,e,f){a&&void 0===b?(this.x=a.x,this.y=a.y,this.z=a.z,this.w=a.w):(this.x=a||0,this.y=b||0,this.z=e||0,this.w=f||0)};a.kmQuaternion=a.math.Quaternion;var b=a.math.Quaternion.prototype;b.conjugate=function(a){this.x=-a.x;this.y=-a.y;this.z=-a.z;this.w=a.w;return this};b.dot=function(a){return this.w*a.w+this.x*a.x+this.y*a.y+this.z*a.z};b.exponential=function(){return this};b.identity=function(){this.z=this.y=this.x=0;this.w=1;return this};b.inverse=function(){var b=
this.length();if(Math.abs(b)>a.math.EPSILON)return this.w=this.z=this.y=this.x=0,this;this.conjugate(this).scale(1/b);return this};b.isIdentity=function(){return 0===this.x&&0===this.y&&0===this.z&&1===this.w};b.length=function(){return Math.sqrt(this.lengthSq())};b.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w};b.multiply=function(a){var b=this.x,e=this.y,f=this.z,g=this.w;this.w=g*a.w-b*a.x-e*a.y-f*a.z;this.x=g*a.x+b*a.w+e*a.z-f*a.y;this.y=g*a.y+e*a.w+f*a.x-
b*a.z;this.z=g*a.z+f*a.w+b*a.y-e*a.x;return this};b.normalize=function(){var b=this.length();if(Math.abs(b)<=a.math.EPSILON)throw Error("current quaternion is an invalid value");this.scale(1/b);return this};b.rotationAxis=function(a,b){var e=0.5*b,f=Math.sin(e);this.w=Math.cos(e);this.x=a.x*f;this.y=a.y*f;this.z=a.z*f;return this};a.math.Quaternion.rotationMatrix=function(b){if(!b)return null;var d,e,f;d=[];e=b.mat;b=0;d[0]=e[0];d[1]=e[3];d[2]=e[6];d[4]=e[1];d[5]=e[4];d[6]=e[7];d[8]=e[2];d[9]=e[5];
d[10]=e[8];d[15]=1;var g=d[0];b=g[0]+g[5]+g[10]+1;b>a.math.EPSILON?(b=2*Math.sqrt(b),d=(g[9]-g[6])/b,e=(g[2]-g[8])/b,f=(g[4]-g[1])/b,b*=0.25):g[0]>g[5]&&g[0]>g[10]?(b=2*Math.sqrt(1+g[0]-g[5]-g[10]),d=0.25*b,e=(g[4]+g[1])/b,f=(g[2]+g[8])/b,b=(g[9]-g[6])/b):g[5]>g[10]?(b=2*Math.sqrt(1+g[5]-g[0]-g[10]),d=(g[4]+g[1])/b,e=0.25*b,f=(g[9]+g[6])/b,b=(g[2]-g[8])/b):(b=2*Math.sqrt(1+g[10]-g[0]-g[5]),d=(g[2]+g[8])/b,e=(g[9]+g[6])/b,f=0.25*b,b=(g[4]-g[1])/b);return new a.math.Quaternion(d,e,f,b)};a.math.Quaternion.rotationYawPitchRoll=
function(b,d,e){var f,g,h,k,m;f=a.degreesToRadians(d)/2;g=a.degreesToRadians(b)/2;h=a.degreesToRadians(e)/2;e=Math.cos(f);b=Math.cos(g);d=Math.cos(h);f=Math.sin(f);g=Math.sin(g);h=Math.sin(h);k=b*d;m=g*h;var n=new a.math.Quaternion;n.w=e*k+f*m;n.x=f*k-e*m;n.y=e*g*d+f*b*h;n.z=e*b*h-f*g*d;n.normalize();return n};b.slerp=function(b,d){if(this.x===b.x&&this.y===b.y&&this.z===b.z&&this.w===b.w)return this;var e=this.dot(b),f=Math.acos(e),g=Math.sqrt(1-a.math.square(e)),e=Math.sin(d*f)/g,f=Math.sin((1-
d)*f)/g,g=new a.math.Quaternion(b);this.scale(f);g.scale(e);this.add(g);return this};b.toAxisAndAngle=function(){var b,d,e=new a.math.Vec3;b=Math.acos(this.w);d=Math.sqrt(a.math.square(this.x)+a.math.square(this.y)+a.math.square(this.z));d>-a.math.EPSILON&&d<a.math.EPSILON||d<2*Math.PI+a.math.EPSILON&&d>2*Math.PI-a.math.EPSILON?(b=0,e.x=0,e.y=0,e.z=1):(b*=2,e.x=this.x/d,e.y=this.y/d,e.z=this.z/d,e.normalize());return{axis:e,angle:b}};b.scale=function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this};
b.assignFrom=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this};b.add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this};a.math.Quaternion.rotationBetweenVec3=function(b,d,e){var f=new a.math.Vec3(b),g=new a.math.Vec3(d);f.normalize();g.normalize();var h=f.dot(g);d=new a.math.Quaternion;if(1<=h)return d.identity(),d;-0.999999>h?Math.abs(e.lengthSq())<a.math.EPSILON?d.rotationAxis(e,Math.PI):(f=new a.math.Vec3(1,0,0),f.cross(b),Math.abs(f.lengthSq())<a.math.EPSILON&&
(f.fill(0,1,0),f.cross(b)),f.normalize(),d.rotationAxis(f,Math.PI)):(b=Math.sqrt(2*(1+h)),e=1/b,f.cross(g),d.x=f.x*e,d.y=f.y*e,d.z=f.z*e,d.w=0.5*b,d.normalize());return d};b.multiplyVec3=function(b){var d=this.x,e=this.y,f=this.z,g=new a.math.Vec3(b),h=new a.math.Vec3(d,e,f),d=new a.math.Vec3(d,e,f);h.cross(b);d.cross(h);h.scale(2*q.w);d.scale(2);g.add(h);g.add(d);return g}})(cc);cc.math.AABB=function(a,b){this.min=a||new cc.math.Vec3;this.max=b||new cc.math.Vec3};cc.math.AABB.prototype.containsPoint=function(a){return a.x>=this.min.x&&a.x<=this.max.x&&a.y>=this.min.y&&a.y<=this.max.y&&a.z>=this.min.z&&a.z<=this.max.z};cc.math.AABB.containsPoint=function(a,b){return a.x>=b.min.x&&a.x<=b.max.x&&a.y>=b.min.y&&a.y<=b.max.y&&a.z>=b.min.z&&a.z<=b.max.z};cc.math.AABB.prototype.assignFrom=function(a){this.min.assignFrom(a.min);this.max.assignFrom(a.max)};
cc.math.AABB.assign=function(a,b){a.min.assignFrom(b.min);a.max.assignFrom(b.max);return a};(function(a){a.math.Matrix4Stack=function(a,b){this.top=a;this.stack=b||[];this.lastUpdated=0};a.km_mat4_stack=a.math.Matrix4Stack;var b=a.math.Matrix4Stack.prototype;b.initialize=function(){this.stack.length=0;this.top=null};a.km_mat4_stack_push=function(b,d){b.stack.push(b.top);b.top=new a.math.Matrix4(d)};a.km_mat4_stack_pop=function(a,b){a.top=a.stack.pop()};a.km_mat4_stack_release=function(a){a.stack=null;a.top=null};b.push=function(b){b=b||this.top;this.stack.push(this.top);this.top=new a.math.Matrix4(b)};
b.pop=function(){this.top=this.stack.pop()};b.release=function(){this._matrixPool=this.top=this.stack=null};b._getFromPool=function(b){var d=this._matrixPool;if(0===d.length)return new a.math.Matrix4(b);d=d.pop();d.assignFrom(b);return d};b._putInPool=function(a){this._matrixPool.push(a)}})(cc);(function(a){a.KM_GL_MODELVIEW=5888;a.KM_GL_PROJECTION=5889;a.KM_GL_TEXTURE=5890;a.modelview_matrix_stack=new a.math.Matrix4Stack;a.projection_matrix_stack=new a.math.Matrix4Stack;a.texture_matrix_stack=new a.math.Matrix4Stack;a.current_stack=null;a.lazyInitialize=function(){var b=new a.math.Matrix4;a.modelview_matrix_stack.initialize();a.projection_matrix_stack.initialize();a.texture_matrix_stack.initialize();a.current_stack=a.modelview_matrix_stack;a.initialized=!0;b.identity();a.modelview_matrix_stack.push(b);
a.projection_matrix_stack.push(b);a.texture_matrix_stack.push(b)};a.lazyInitialize();a.kmGLFreeAll=function(){a.modelview_matrix_stack.release();a.modelview_matrix_stack=null;a.projection_matrix_stack.release();a.projection_matrix_stack=null;a.texture_matrix_stack.release();a.texture_matrix_stack=null;a.initialized=!1;a.current_stack=null};a.kmGLPushMatrix=function(){a.current_stack.push(a.current_stack.top)};a.kmGLPushMatrixWitMat4=function(b){a.current_stack.stack.push(a.current_stack.top);b.assignFrom(a.current_stack.top);
a.current_stack.top=b};a.kmGLPopMatrix=function(){a.current_stack.top=a.current_stack.stack.pop()};a.kmGLMatrixMode=function(b){switch(b){case a.KM_GL_MODELVIEW:a.current_stack=a.modelview_matrix_stack;break;case a.KM_GL_PROJECTION:a.current_stack=a.projection_matrix_stack;break;case a.KM_GL_TEXTURE:a.current_stack=a.texture_matrix_stack;break;default:throw Error("Invalid matrix mode specified");}a.current_stack.lastUpdated=a.director.getTotalFrames()};a.kmGLLoadIdentity=function(){a.current_stack.top.identity()};
a.kmGLLoadMatrix=function(b){a.current_stack.top.assignFrom(b)};a.kmGLMultMatrix=function(b){a.current_stack.top.multiply(b)};var b=new a.math.Matrix4;a.kmGLTranslatef=function(c,e,f){c=a.math.Matrix4.createByTranslation(c,e,f,b);a.current_stack.top.multiply(c)};var c=new a.math.Vec3;a.kmGLRotatef=function(d,e,f,g){c.fill(e,f,g);d=a.math.Matrix4.createByAxisAndAngle(c,a.degreesToRadians(d),b);a.current_stack.top.multiply(d)};a.kmGLScalef=function(c,e,f){c=a.math.Matrix4.createByScale(c,e,f,b);a.current_stack.top.multiply(c)};
a.kmGLGetMatrix=function(b,c){switch(b){case a.KM_GL_MODELVIEW:c.assignFrom(a.modelview_matrix_stack.top);break;case a.KM_GL_PROJECTION:c.assignFrom(a.projection_matrix_stack.top);break;case a.KM_GL_TEXTURE:c.assignFrom(a.texture_matrix_stack.top);break;default:throw Error("Invalid matrix mode specified");}}})(cc);cc.SHADER_POSITION_UCOLOR_FRAG="precision lowp float;\nvarying vec4 v_fragmentColor;\nvoid main()                              \n{ \n    gl_FragColor \x3d v_fragmentColor;      \n}\n";cc.SHADER_POSITION_UCOLOR_VERT="attribute vec4 a_position;\nuniform    vec4 u_color;\nuniform float u_pointSize;\nvarying lowp vec4 v_fragmentColor; \nvoid main(void)   \n{\n    gl_Position \x3d (CC_PMatrix * CC_MVMatrix) * a_position;  \n    gl_PointSize \x3d u_pointSize;          \n    v_fragmentColor \x3d u_color;           \n}";
cc.SHADER_POSITION_COLOR_FRAG="precision lowp float; \nvarying vec4 v_fragmentColor; \nvoid main() \n{ \n     gl_FragColor \x3d v_fragmentColor; \n} ";cc.SHADER_POSITION_COLOR_VERT="attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\n    gl_Position \x3d (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor \x3d a_color;             \n}";cc.SHADER_SPRITE_POSITION_COLOR_VERT="attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\n    gl_Position \x3d CC_PMatrix * a_position;  \n    v_fragmentColor \x3d a_color;             \n}";
cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_FRAG="// #extension GL_OES_standard_derivatives : enable\nvarying mediump vec4 v_color;\nvarying mediump vec2 v_texcoord;\nvoid main()\t\n{ \n// #if defined GL_OES_standard_derivatives\t\n// gl_FragColor \x3d v_color*smoothstep(0.0, length(fwidth(v_texcoord)), 1.0 - length(v_texcoord)); \n// #else\t\ngl_FragColor \x3d v_color * step(0.0, 1.0 - length(v_texcoord)); \n// #endif \n}";cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_VERT="attribute mediump vec4 a_position; \nattribute mediump vec2 a_texcoord; \nattribute mediump vec4 a_color;\t\nvarying mediump vec4 v_color; \nvarying mediump vec2 v_texcoord;\t\nvoid main() \n{ \n     v_color \x3d a_color;//vec4(a_color.rgb * a_color.a, a_color.a); \n     v_texcoord \x3d a_texcoord; \n    gl_Position \x3d (CC_PMatrix * CC_MVMatrix) * a_position;  \n}";
cc.SHADER_POSITION_TEXTURE_FRAG="precision lowp float;   \nvarying vec2 v_texCoord;  \nvoid main() \n{  \n    gl_FragColor \x3d  texture2D(CC_Texture0, v_texCoord);   \n}";cc.SHADER_POSITION_TEXTURE_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position \x3d (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_texCoord \x3d a_texCoord;               \n}";cc.SHADER_POSITION_TEXTURE_UCOLOR_FRAG="precision lowp float;  \nuniform vec4 u_color; \nvarying vec2 v_texCoord; \nvoid main() \n{  \n    gl_FragColor \x3d  texture2D(CC_Texture0, v_texCoord) * u_color;    \n}";
cc.SHADER_POSITION_TEXTURE_UCOLOR_VERT="attribute vec4 a_position;\nattribute vec2 a_texCoord; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position \x3d (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_texCoord \x3d a_texCoord;                 \n}";cc.SHADER_POSITION_TEXTURE_A8COLOR_FRAG="precision lowp float;  \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    gl_FragColor \x3d vec4( v_fragmentColor.rgb,         \n        v_fragmentColor.a * texture2D(CC_Texture0, v_texCoord).a   \n    ); \n}";
cc.SHADER_POSITION_TEXTURE_A8COLOR_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position \x3d (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor \x3d a_color; \n    v_texCoord \x3d a_texCoord; \n}";cc.SHADER_POSITION_TEXTURE_COLOR_FRAG="precision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    gl_FragColor \x3d v_fragmentColor * texture2D(CC_Texture0, v_texCoord); \n}";
cc.SHADER_POSITION_TEXTURE_COLOR_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position \x3d (CC_PMatrix * CC_MVMatrix) * a_position;  \n    v_fragmentColor \x3d a_color; \n    v_texCoord \x3d a_texCoord; \n}";cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_VERT="attribute vec4 a_position; \nattribute vec2 a_texCoord; \nattribute vec4 a_color;  \nvarying lowp vec4 v_fragmentColor; \nvarying mediump vec2 v_texCoord; \nvoid main() \n{ \n    gl_Position \x3d CC_PMatrix * a_position;  \n    v_fragmentColor \x3d a_color; \n    v_texCoord \x3d a_texCoord; \n}";
cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_GRAY_FRAG="precision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nvoid main() \n{ \n    vec4 c \x3d texture2D(CC_Texture0, v_texCoord); \n    gl_FragColor.xyz \x3d vec3(0.2126*c.r + 0.7152*c.g + 0.0722*c.b); \n     gl_FragColor.w \x3d c.w ; \n}";cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG="precision lowp float;   \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord;   \nuniform float CC_alpha_value; \nvoid main() \n{  \n    vec4 texColor \x3d texture2D(CC_Texture0, v_texCoord);  \n    if ( texColor.a \x3c\x3d CC_alpha_value )          \n        discard; \n    gl_FragColor \x3d texColor * v_fragmentColor;  \n}";
cc.SHADEREX_SWITCHMASK_FRAG="precision lowp float; \nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nuniform sampler2D u_texture;  \nuniform sampler2D   u_mask;   \nvoid main()  \n{  \n    vec4 texColor   \x3d texture2D(u_texture, v_texCoord);  \n    vec4 maskColor  \x3d texture2D(u_mask, v_texCoord); \n    vec4 finalColor \x3d vec4(texColor.r, texColor.g, texColor.b, maskColor.a * texColor.a);        \n    gl_FragColor    \x3d v_fragmentColor * finalColor; \n}";cc.shaderCache={TYPE_POSITION_TEXTURECOLOR:0,TYPE_POSITION_TEXTURECOLOR_ALPHATEST:1,TYPE_POSITION_COLOR:2,TYPE_POSITION_TEXTURE:3,TYPE_POSITION_TEXTURE_UCOLOR:4,TYPE_POSITION_TEXTURE_A8COLOR:5,TYPE_POSITION_UCOLOR:6,TYPE_POSITION_LENGTH_TEXTURECOLOR:7,TYPE_SPRITE_POSITION_TEXTURECOLOR:8,TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST:9,TYPE_SPRITE_POSITION_COLOR:10,TYPE_SPRITE_POSITION_TEXTURECOLOR_GRAY:11,TYPE_MAX:11,_keyMap:[cc.SHADER_POSITION_TEXTURECOLOR,cc.SHADER_POSITION_TEXTURECOLORALPHATEST,cc.SHADER_POSITION_COLOR,
cc.SHADER_POSITION_TEXTURE,cc.SHADER_POSITION_TEXTURE_UCOLOR,cc.SHADER_POSITION_TEXTUREA8COLOR,cc.SHADER_POSITION_UCOLOR,cc.SHADER_POSITION_LENGTHTEXTURECOLOR,cc.SHADER_SPRITE_POSITION_TEXTURECOLOR,cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST,cc.SHADER_SPRITE_POSITION_COLOR,cc.SHADER_SPRITE_POSITION_TEXTURECOLOR_GRAY],_programs:{},_init:function(){this.loadDefaultShaders();return!0},_loadDefaultShader:function(a,b){switch(b){case cc.SHADER_POSITION_TEXTURECOLOR:a.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_COLOR_VERT,
cc.SHADER_POSITION_TEXTURE_COLOR_FRAG);a.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);a.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);a.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_SPRITE_POSITION_TEXTURECOLOR:a.initWithVertexShaderByteArray(cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_FRAG);a.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);a.addAttribute(cc.ATTRIBUTE_NAME_COLOR,
cc.VERTEX_ATTRIB_COLOR);a.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_SPRITE_POSITION_TEXTURECOLOR_GRAY:a.initWithVertexShaderByteArray(cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_GRAY_FRAG);a.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);a.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);a.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_POSITION_TEXTURECOLORALPHATEST:a.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_COLOR_VERT,
cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG);a.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);a.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);a.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST:a.initWithVertexShaderByteArray(cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_VERT,cc.SHADER_POSITION_TEXTURE_COLOR_ALPHATEST_FRAG);a.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);
a.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);a.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_POSITION_COLOR:a.initWithVertexShaderByteArray(cc.SHADER_POSITION_COLOR_VERT,cc.SHADER_POSITION_COLOR_FRAG);a.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);a.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;case cc.SHADER_SPRITE_POSITION_COLOR:a.initWithVertexShaderByteArray(cc.SHADER_SPRITE_POSITION_COLOR_VERT,
cc.SHADER_POSITION_COLOR_FRAG);a.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);a.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;case cc.SHADER_POSITION_TEXTURE:a.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_VERT,cc.SHADER_POSITION_TEXTURE_FRAG);a.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);a.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_POSITION_TEXTURE_UCOLOR:a.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_UCOLOR_VERT,
cc.SHADER_POSITION_TEXTURE_UCOLOR_FRAG);a.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);a.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_POSITION_TEXTUREA8COLOR:a.initWithVertexShaderByteArray(cc.SHADER_POSITION_TEXTURE_A8COLOR_VERT,cc.SHADER_POSITION_TEXTURE_A8COLOR_FRAG);a.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);a.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);a.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,
cc.VERTEX_ATTRIB_TEX_COORDS);break;case cc.SHADER_POSITION_UCOLOR:a.initWithVertexShaderByteArray(cc.SHADER_POSITION_UCOLOR_VERT,cc.SHADER_POSITION_UCOLOR_FRAG);a.addAttribute("aVertex",cc.VERTEX_ATTRIB_POSITION);break;case cc.SHADER_POSITION_LENGTHTEXTURECOLOR:a.initWithVertexShaderByteArray(cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_VERT,cc.SHADER_POSITION_COLOR_LENGTH_TEXTURE_FRAG);a.addAttribute(cc.ATTRIBUTE_NAME_POSITION,cc.VERTEX_ATTRIB_POSITION);a.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD,cc.VERTEX_ATTRIB_TEX_COORDS);
a.addAttribute(cc.ATTRIBUTE_NAME_COLOR,cc.VERTEX_ATTRIB_COLOR);break;default:cc.log("cocos2d: cc.shaderCache._loadDefaultShader, error shader type");return}a.link();a.updateUniforms()},loadDefaultShaders:function(){for(var a=0;a<this.TYPE_MAX;++a)this.programForKey(this._keyMap[a])},reloadDefaultShaders:function(){var a=this.programForKey(cc.SHADER_POSITION_TEXTURECOLOR);a.reset();this._loadDefaultShader(a,cc.SHADER_POSITION_TEXTURECOLOR);a=this.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR);
a.reset();this._loadDefaultShader(a,cc.SHADER_SPRITE_POSITION_TEXTURECOLOR);a=this.programForKey(cc.SHADER_POSITION_TEXTURECOLORALPHATEST);a.reset();this._loadDefaultShader(a,cc.SHADER_POSITION_TEXTURECOLORALPHATEST);a=this.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST);a.reset();this._loadDefaultShader(a,cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST);a=this.programForKey(cc.SHADER_POSITION_COLOR);a.reset();this._loadDefaultShader(a,cc.SHADER_POSITION_COLOR);a=this.programForKey(cc.SHADER_POSITION_TEXTURE);
a.reset();this._loadDefaultShader(a,cc.SHADER_POSITION_TEXTURE);a=this.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_GRAY_FRAG);a.reset();this._loadDefaultShader(a,cc.SHADER_SPRITE_POSITION_TEXTURE_COLOR_GRAY_FRAG);a=this.programForKey(cc.SHADER_POSITION_TEXTURE_UCOLOR);a.reset();this._loadDefaultShader(a,cc.SHADER_POSITION_TEXTURE_UCOLOR);a=this.programForKey(cc.SHADER_POSITION_TEXTUREA8COLOR);a.reset();this._loadDefaultShader(a,cc.SHADER_POSITION_TEXTUREA8COLOR);a=this.programForKey(cc.SHADER_POSITION_UCOLOR);
a.reset();this._loadDefaultShader(a,cc.SHADER_POSITION_UCOLOR)},programForKey:function(a){if(!this._programs[a]){var b=new cc.GLProgram;this._loadDefaultShader(b,a);this._programs[a]=b}return this._programs[a]},getProgram:function(a){return this.programForKey(a)},addProgram:function(a,b){this._programs[b]=a}};cc.GLProgram=cc.Class.extend({_glContext:null,_programObj:null,_vertShader:null,_fragShader:null,_uniforms:null,_hashForUniforms:null,_usesTime:!1,_projectionUpdated:-1,_updateUniformLocation:function(a){if(!a)return!1;var b,c=this._hashForUniforms[a];if(c){b=!1;for(var d=arguments.length-1,e=0;e<d;++e)arguments[e+1]!==c[e]&&(c[e]=arguments[e+1],b=!0)}else c=[arguments[1],arguments[2],arguments[3],arguments[4]],this._hashForUniforms[a]=c,b=!0;return b},_description:function(){return"\x3cCCGLProgram \x3d "+
this.toString()+" | Program \x3d "+this._programObj.toString()+", VertexShader \x3d "+this._vertShader.toString()+", FragmentShader \x3d "+this._fragShader.toString()+"\x3e"},_compileShader:function(a,b,c){if(!c||!a)return!1;c=(cc.GLProgram._isHighpSupported()?"precision highp float;\n":"precision mediump float;\n")+"uniform mat4 CC_PMatrix;         \nuniform mat4 CC_MVMatrix;        \nuniform mat4 CC_MVPMatrix;       \nuniform vec4 CC_Time;            \nuniform vec4 CC_SinTime;         \nuniform vec4 CC_CosTime;         \nuniform vec4 CC_Random01;        \nuniform sampler2D CC_Texture0;   \n//CC INCLUDES END                \n"+
c;this._glContext.shaderSource(a,c);this._glContext.compileShader(a);c=this._glContext.getShaderParameter(a,this._glContext.COMPILE_STATUS);c||(cc.log("cocos2d: ERROR: Failed to compile shader:\n"+this._glContext.getShaderSource(a)),b===this._glContext.VERTEX_SHADER?cc.log("cocos2d: \n"+this.vertexShaderLog()):cc.log("cocos2d: \n"+this.fragmentShaderLog()));return!0===c},ctor:function(a,b,c){this._uniforms={};this._hashForUniforms={};this._glContext=c||cc._renderContext;a&&b&&this.init(a,b)},destroyProgram:function(){this._hashForUniforms=
this._uniforms=this._fragShader=this._vertShader=null;this._glContext.deleteProgram(this._programObj)},initWithVertexShaderByteArray:function(a,b){var c=this._glContext;this._programObj=c.createProgram();this._fragShader=this._vertShader=null;a&&(this._vertShader=c.createShader(c.VERTEX_SHADER),this._compileShader(this._vertShader,c.VERTEX_SHADER,a)||cc.log("cocos2d: ERROR: Failed to compile vertex shader"));b&&(this._fragShader=c.createShader(c.FRAGMENT_SHADER),this._compileShader(this._fragShader,
c.FRAGMENT_SHADER,b)||cc.log("cocos2d: ERROR: Failed to compile fragment shader"));this._vertShader&&c.attachShader(this._programObj,this._vertShader);cc.checkGLErrorDebug();this._fragShader&&c.attachShader(this._programObj,this._fragShader);for(var d in this._hashForUniforms)delete this._hashForUniforms[d];cc.checkGLErrorDebug();return!0},initWithString:function(a,b){return this.initWithVertexShaderByteArray(a,b)},initWithVertexShaderFilename:function(a,b){var c=cc.loader.getRes(a);if(!c)throw Error("Please load the resource firset : "+
a);var d=cc.loader.getRes(b);if(!d)throw Error("Please load the resource firset : "+b);return this.initWithVertexShaderByteArray(c,d)},init:function(a,b){return this.initWithVertexShaderFilename(a,b)},addAttribute:function(a,b){this._glContext.bindAttribLocation(this._programObj,b,a)},link:function(){if(!this._programObj)return cc.log("cc.GLProgram.link(): Cannot link invalid program"),!1;this._glContext.linkProgram(this._programObj);this._vertShader&&this._glContext.deleteShader(this._vertShader);
this._fragShader&&this._glContext.deleteShader(this._fragShader);this._fragShader=this._vertShader=null;return cc.game.config[cc.game.CONFIG_KEY.debugMode]&&!this._glContext.getProgramParameter(this._programObj,this._glContext.LINK_STATUS)?(cc.log("cocos2d: ERROR: Failed to link program: "+this._glContext.getProgramInfoLog(this._programObj)),cc.glDeleteProgram(this._programObj),this._programObj=null,!1):!0},use:function(){cc.glUseProgram(this._programObj)},updateUniforms:function(){this._uniforms[cc.UNIFORM_PMATRIX_S]=
this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_PMATRIX_S);this._uniforms[cc.UNIFORM_MVMATRIX_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_MVMATRIX_S);this._uniforms[cc.UNIFORM_MVPMATRIX_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_MVPMATRIX_S);this._uniforms[cc.UNIFORM_TIME_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_TIME_S);this._uniforms[cc.UNIFORM_SINTIME_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_SINTIME_S);
this._uniforms[cc.UNIFORM_COSTIME_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_COSTIME_S);this._usesTime=null!=this._uniforms[cc.UNIFORM_TIME_S]||null!=this._uniforms[cc.UNIFORM_SINTIME_S]||null!=this._uniforms[cc.UNIFORM_COSTIME_S];this._uniforms[cc.UNIFORM_RANDOM01_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_RANDOM01_S);this._uniforms[cc.UNIFORM_SAMPLER_S]=this._glContext.getUniformLocation(this._programObj,cc.UNIFORM_SAMPLER_S);this.use();this.setUniformLocationWith1i(this._uniforms[cc.UNIFORM_SAMPLER_S],
0)},_addUniformLocation:function(a){var b=this._glContext.getUniformLocation(this._programObj,a);this._uniforms[a]=b},getUniformLocationForName:function(a){if(!a)throw Error("cc.GLProgram.getUniformLocationForName(): uniform name should be non-null");if(!this._programObj)throw Error("cc.GLProgram.getUniformLocationForName(): Invalid operation. Cannot get uniform location when program is not initialized");return this._uniforms[a]||this._glContext.getUniformLocation(this._programObj,a)},getUniformMVPMatrix:function(){return this._uniforms[cc.UNIFORM_MVPMATRIX_S]},
getUniformSampler:function(){return this._uniforms[cc.UNIFORM_SAMPLER_S]},setUniformLocationWith1i:function(a,b){var c=this._glContext;if("string"===typeof a){if(this._updateUniformLocation(a,b)){var d=this.getUniformLocationForName(a);c.uniform1i(d,b)}}else c.uniform1i(a,b)},setUniformLocationWith2i:function(a,b,c){var d=this._glContext;"string"===typeof a?this._updateUniformLocation(a,b,c)&&(a=this.getUniformLocationForName(a),d.uniform2i(a,b,c)):d.uniform2i(a,b,c)},setUniformLocationWith3i:function(a,
b,c,d){var e=this._glContext;"string"===typeof a?this._updateUniformLocation(a,b,c,d)&&(a=this.getUniformLocationForName(a),e.uniform3i(a,b,c,d)):e.uniform3i(a,b,c,d)},setUniformLocationWith4i:function(a,b,c,d,e){var f=this._glContext;"string"===typeof a?this._updateUniformLocation(a,b,c,d,e)&&(a=this.getUniformLocationForName(a),f.uniform4i(a,b,c,d,e)):f.uniform4i(a,b,c,d,e)},setUniformLocationWith2iv:function(a,b){var c="string"===typeof a?this.getUniformLocationForName(a):a;this._glContext.uniform2iv(c,
b)},setUniformLocationWith3iv:function(a,b){var c="string"===typeof a?this.getUniformLocationForName(a):a;this._glContext.uniform3iv(c,b)},setUniformLocationWith4iv:function(a,b){var c="string"===typeof a?this.getUniformLocationForName(a):a;this._glContext.uniform4iv(c,b)},setUniformLocationI32:function(a,b){this.setUniformLocationWith1i(a,b)},setUniformLocationWith1f:function(a,b){var c=this._glContext;if("string"===typeof a){if(this._updateUniformLocation(a,b)){var d=this.getUniformLocationForName(a);
c.uniform1f(d,b)}}else c.uniform1f(a,b)},setUniformLocationWith2f:function(a,b,c){var d=this._glContext;"string"===typeof a?this._updateUniformLocation(a,b,c)&&(a=this.getUniformLocationForName(a),d.uniform2f(a,b,c)):d.uniform2f(a,b,c)},setUniformLocationWith3f:function(a,b,c,d){var e=this._glContext;"string"===typeof a?this._updateUniformLocation(a,b,c,d)&&(a=this.getUniformLocationForName(a),e.uniform3f(a,b,c,d)):e.uniform3f(a,b,c,d)},setUniformLocationWith4f:function(a,b,c,d,e){var f=this._glContext;
"string"===typeof a?this._updateUniformLocation(a,b,c,d,e)&&(a=this.getUniformLocationForName(a),f.uniform4f(a,b,c,d,e)):f.uniform4f(a,b,c,d,e)},setUniformLocationWith2fv:function(a,b){var c="string"===typeof a?this.getUniformLocationForName(a):a;this._glContext.uniform2fv(c,b)},setUniformLocationWith3fv:function(a,b){var c="string"===typeof a?this.getUniformLocationForName(a):a;this._glContext.uniform3fv(c,b)},setUniformLocationWith4fv:function(a,b){var c="string"===typeof a?this.getUniformLocationForName(a):
a;this._glContext.uniform4fv(c,b)},setUniformLocationWithMatrix3fv:function(a,b){var c="string"===typeof a?this.getUniformLocationForName(a):a;this._glContext.uniformMatrix3fv(c,!1,b)},setUniformLocationWithMatrix4fv:function(a,b){var c="string"===typeof a?this.getUniformLocationForName(a):a;this._glContext.uniformMatrix4fv(c,!1,b)},setUniformLocationF32:function(){if(!(2>arguments.length))switch(arguments.length){case 2:this.setUniformLocationWith1f(arguments[0],arguments[1]);break;case 3:this.setUniformLocationWith2f(arguments[0],
arguments[1],arguments[2]);break;case 4:this.setUniformLocationWith3f(arguments[0],arguments[1],arguments[2],arguments[3]);break;case 5:this.setUniformLocationWith4f(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4])}},setUniformsForBuiltins:function(){var a=new cc.math.Matrix4,b=new cc.math.Matrix4,c=new cc.math.Matrix4;cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,a);cc.kmGLGetMatrix(cc.KM_GL_MODELVIEW,b);cc.kmMat4Multiply(c,a,b);this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],
a.mat,1);this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX_S],b.mat,1);this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX_S],c.mat,1);this._usesTime&&(a=cc.director,a=a.getTotalFrames()*a.getAnimationInterval(),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_TIME_S],a/10,a,2*a,4*a),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_SINTIME_S],a/8,a/4,a/2,Math.sin(a)),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_COSTIME_S],a/8,a/4,
a/2,Math.cos(a)));-1!==this._uniforms[cc.UNIFORM_RANDOM01_S]&&this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_RANDOM01_S],Math.random(),Math.random(),Math.random(),Math.random())},_setUniformsForBuiltinsForRenderer:function(a){if(a&&a._renderCmd){var b=new cc.math.Matrix4,c=new cc.math.Matrix4;cc.kmGLGetMatrix(cc.KM_GL_PROJECTION,b);cc.kmMat4Multiply(c,b,a._renderCmd._stackMatrix);this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],b.mat,1);this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX_S],
a._renderCmd._stackMatrix.mat,1);this.setUniformLocationWithMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX_S],c.mat,1);this._usesTime&&(a=cc.director,a=a.getTotalFrames()*a.getAnimationInterval(),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_TIME_S],a/10,a,2*a,4*a),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_SINTIME_S],a/8,a/4,a/2,Math.sin(a)),this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_COSTIME_S],a/8,a/4,a/2,Math.cos(a)));-1!==this._uniforms[cc.UNIFORM_RANDOM01_S]&&
this.setUniformLocationWith4f(this._uniforms[cc.UNIFORM_RANDOM01_S],Math.random(),Math.random(),Math.random(),Math.random())}},setUniformForModelViewProjectionMatrix:function(){this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX_S],!1,cc.getMat4MultiplyValue(cc.projection_matrix_stack.top,cc.modelview_matrix_stack.top))},setUniformForModelViewProjectionMatrixWithMat4:function(a){cc.kmMat4Multiply(a,cc.projection_matrix_stack.top,cc.modelview_matrix_stack.top);this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVPMATRIX_S],
!1,a.mat)},setUniformForModelViewAndProjectionMatrixWithMat4:function(){this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX_S],!1,cc.modelview_matrix_stack.top.mat);this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],!1,cc.projection_matrix_stack.top.mat)},_setUniformForMVPMatrixWithMat4:function(a){if(!a)throw Error("modelView matrix is undefined.");this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_MVMATRIX_S],!1,a.mat);this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],
!1,cc.projection_matrix_stack.top.mat)},_updateProjectionUniform:function(){var a=cc.projection_matrix_stack;a.lastUpdated!==this._projectionUpdated&&(this._glContext.uniformMatrix4fv(this._uniforms[cc.UNIFORM_PMATRIX_S],!1,a.top.mat),this._projectionUpdated=a.lastUpdated)},vertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getVertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getFragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},
fragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._fragShader)},programLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},getProgramLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},reset:function(){this._fragShader=this._vertShader=null;this._uniforms.length=0;this._glContext.deleteProgram(this._programObj);this._programObj=null;for(var a in this._hashForUniforms)this._hashForUniforms[a].length=0,delete this._hashForUniforms[a]},
getProgram:function(){return this._programObj},retain:function(){},release:function(){}});cc.GLProgram.create=function(a,b){return new cc.GLProgram(a,b)};cc.GLProgram._highpSupported=null;cc.GLProgram._isHighpSupported=function(){var a=cc._renderContext;a.getShaderPrecisionFormat&&null==cc.GLProgram._highpSupported&&(a=a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT),cc.GLProgram._highpSupported=0!==a.precision);return cc.GLProgram._highpSupported};
cc.setProgram=function(a,b){a.shaderProgram=b;var c=a.children;if(c)for(var d=0;d<c.length;d++)cc.setProgram(c[d],b)};var types={GL_FLOAT:0,GL_INT:1,GL_FLOAT_VEC2:2,GL_FLOAT_VEC3:3,GL_FLOAT_VEC4:4,GL_FLOAT_MAT4:5,GL_CALLBACK:6,GL_TEXTURE:7};cc.UniformValue=function(a,b){this._uniform=a;this._glprogram=b;this._currentBoundValue=this._value=null;this._type=-1};
cc.UniformValue.prototype={setFloat:function(a){this._value=a;this._type=types.GL_FLOAT},setInt:function(a){this._value=a;this._type=types.GL_INT},setVec2:function(a,b){this._value=[a,b];this._type=types.GL_FLOAT_VEC2},setVec2v:function(a){this._value=a.slice(0);this._type=types.GL_FLOAT_VEC2},setVec3:function(a,b,c){this._value=[a,b,c];this._type=types.GL_FLOAT_VEC3},setVec3v:function(a){this._value=a.slice(0);this._type=types.GL_FLOAT_VEC3},setVec4:function(a,b,c,d){this._value=[a,b,c,d];this._type=
types.GL_FLOAT_VEC4},setVec4v:function(a){this._value=a.slice(0);this._type=types.GL_FLOAT_VEC4},setMat4:function(a){this._value=a.slice(0);this._type=types.GL_FLOAT_MAT4},setCallback:function(a){this._value=a;this._type=types.GL_CALLBACK},setTexture:function(a,b){this._value=b;this._textureId=a;this._type=types.GL_TEXTURE},apply:function(){if(this._currentBoundValue!==this._value||this._type===types.GL_CALLBACK)switch(this._currentBoundValue=this._value,this._type){case types.GL_INT:this._glprogram.setUniformLocationWith1i(this._uniform.location,
this._value);break;case types.GL_FLOAT:this._glprogram.setUniformLocationWith1f(this._uniform.location,this._value);break;case types.GL_FLOAT_VEC2:this._glprogram.setUniformLocationWith2f(this._uniform.location,this._value[0],this._value[1]);break;case types.GL_FLOAT_VEC3:this._glprogram.setUniformLocationWith3f(this._uniform.location,this._value[0],this._value[1],this._value[2]);break;case types.GL_FLOAT_VEC4:this._glprogram.setUniformLocationWith4f(this._uniform.location,this._value[0],this._value[1],
this._value[2],this._value[3]);break;case types.GL_FLOAT_MAT4:this._glprogram.setUniformLocationWithMatrix4fv(this._uniform.location,this._value);break;case types.GL_CALLBACK:this._value(this._glprogram,this._uniform);break;case types.GL_TEXTURE:this._glprogram.setUniformLocationWith1i(this._uniform.location,this._value),cc.glBindTexture2DN(this._value,this._textureId)}}};
cc.GLProgramState=function(a){this._glprogram=a;this._uniforms=[];this._uniformsByName={};this._uniformsByLocation={};this._boundTextureUnits={};this._textureUnitIndex=1;for(var b=a._glContext.getProgramParameter(a._programObj,a._glContext.ACTIVE_UNIFORMS),c=0,d=0;d<b;++d){var e=a._glContext.getActiveUniform(a._programObj,d);if(0!==e.name.indexOf("CC_")){e.location=a._glContext.getUniformLocation(a._programObj,e.name);e.name=e.name.replace("[]","");var f=new cc.UniformValue(e,a);this._uniforms.push(f);
this._uniformsByName[e.name]=c;this._uniformsByLocation[e.location]=c;c++}}};
cc.GLProgramState.prototype={apply:function(a){this._glprogram.use();a&&this._glprogram._setUniformForMVPMatrixWithMat4(a);for(a=0;a<this._uniforms.length;++a){var b=this._uniforms[a];b._currentBoundValue!==b._value&&b.apply()}},setGLProgram:function(a){this._glprogram=a},getGLProgram:function(){return this._glprogram},getUniformCount:function(){return this._uniforms.length},getUniformValue:function(a){return"string"===typeof a?this._uniforms[this._uniformsByName[a]]:this._uniforms[this._uniformsByLocation[a]]},
setUniformInt:function(a,b){var c=this.getUniformValue(a);c?c.setInt(b):cc.log("cocos2d: warning: Uniform not found: "+a)},setUniformFloat:function(a,b){var c=this.getUniformValue(a);c?c.setFloat(b):cc.log("cocos2d: warning: Uniform not found: "+a)},setUniformVec2:function(a,b,c){var d=this.getUniformValue(a);d?d.setVec2(b,c):cc.log("cocos2d: warning: Uniform not found: "+a)},setUniformVec2v:function(a,b){var c=this.getUniformValue(a);c?c.setVec2v(b):cc.log("cocos2d: warning: Uniform not found: "+
a)},setUniformVec3:function(a,b,c,d){var e=this.getUniformValue(a);e?e.setVec3(b,c,d):cc.log("cocos2d: warning: Uniform not found: "+a)},setUniformVec3v:function(a,b){var c=this.getUniformValue(a);c?c.setVec3v(b):cc.log("cocos2d: warning: Uniform not found: "+a)},setUniformVec4:function(a,b,c,d,e){var f=this.getUniformValue(a);f?f.setVec4(b,c,d,e):cc.log("cocos2d: warning: Uniform not found: "+a)},setUniformVec4v:function(a,b){var c=this.getUniformValue(a);c?c.setVec4v(b):cc.log("cocos2d: warning: Uniform not found: "+
a)},setUniformMat4:function(a,b){var c=this.getUniformValue(a);c?c.setMat4(b):cc.log("cocos2d: warning: Uniform not found: "+a)},setUniformCallback:function(a,b){var c=this.getUniformValue(a);c?c.setCallback(b):cc.log("cocos2d: warning: Uniform not found: "+a)},setUniformTexture:function(a,b){var c=this.getUniformValue(a);if(c){var d=this._boundTextureUnits[a];d?c.setTexture(b,d):(c.setTexture(b,this._textureUnitIndex),this._boundTextureUnits[a]=this._textureUnitIndex++)}}};
cc.GLProgramState._cache={};cc.GLProgramState.getOrCreateWithGLProgram=function(a){var b=cc.GLProgramState._cache[a.__instanceId];b||(b=new cc.GLProgramState(a),cc.GLProgramState._cache[a.__instanceId]=b);return b};cc._currentProjectionMatrix=-1;cc.ENABLE_GL_STATE_CACHE&&(cc.MAX_ACTIVETEXTURE=16,cc._currentShaderProgram=-1,cc._currentBoundTexture=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],cc._blendingSource=-1,cc._blendingDest=-1,cc._GLServerState=0,cc.TEXTURE_ATLAS_USE_VAO&&(cc._uVAO=0));
cc.glInvalidateStateCache=function(){cc.kmGLFreeAll();cc._currentProjectionMatrix=-1;if(cc.ENABLE_GL_STATE_CACHE){cc._currentShaderProgram=-1;for(var a=0;a<cc.MAX_ACTIVETEXTURE;a++)cc._currentBoundTexture[a]=-1;cc._blendingSource=-1;cc._blendingDest=-1;cc._GLServerState=0}};cc.glUseProgram=cc.ENABLE_GL_STATE_CACHE?function(a){a!==cc._currentShaderProgram&&(cc._currentShaderProgram=a,cc._renderContext.useProgram(a))}:function(a){cc._renderContext.useProgram(a)};
cc.glDeleteProgram=function(a){cc.ENABLE_GL_STATE_CACHE&&a===cc._currentShaderProgram&&(cc._currentShaderProgram=-1);gl.deleteProgram(a)};cc.setBlending=function(a,b){var c=cc._renderContext;a===c.ONE&&b===c.ZERO?c.disable(c.BLEND):(c.enable(c.BLEND),cc._renderContext.blendFunc(a,b))};cc.glBlendFunc=cc.ENABLE_GL_STATE_CACHE?function(a,b){if(a!==cc._blendingSource||b!==cc._blendingDest)cc._blendingSource=a,cc._blendingDest=b,cc.setBlending(a,b)}:cc.setBlending;
cc.glBlendFuncForParticle=function(a,b){if(a!==cc._blendingSource||b!==cc._blendingDest){cc._blendingSource=a;cc._blendingDest=b;var c=cc._renderContext;a===c.ONE&&b===c.ZERO?c.disable(c.BLEND):(c.enable(c.BLEND),c.blendFuncSeparate(c.SRC_ALPHA,b,a,b))}};cc.glBlendResetToCache=function(){var a=cc._renderContext;a.blendEquation(a.FUNC_ADD);cc.ENABLE_GL_STATE_CACHE?cc.setBlending(cc._blendingSource,cc._blendingDest):cc.setBlending(a.BLEND_SRC,a.BLEND_DST)};
cc.setProjectionMatrixDirty=function(){cc._currentProjectionMatrix=-1};cc.glBindTexture2D=function(a){cc.glBindTexture2DN(0,a)};
cc.glBindTexture2DN=cc.ENABLE_GL_STATE_CACHE?function(a,b){if(cc._currentBoundTexture[a]!==b){cc._currentBoundTexture[a]=b;var c=cc._renderContext;c.activeTexture(c.TEXTURE0+a);b?c.bindTexture(c.TEXTURE_2D,b._webTextureObj):c.bindTexture(c.TEXTURE_2D,null)}}:function(a,b){var c=cc._renderContext;c.activeTexture(c.TEXTURE0+a);b?c.bindTexture(c.TEXTURE_2D,b._webTextureObj):c.bindTexture(c.TEXTURE_2D,null)};cc.glDeleteTexture=function(a){cc.glDeleteTextureN(0,a)};
cc.glDeleteTextureN=function(a,b){cc.ENABLE_GL_STATE_CACHE&&b===cc._currentBoundTexture[a]&&(cc._currentBoundTexture[a]=-1);cc._renderContext.deleteTexture(b._webTextureObj)};cc.glBindVAO=function(a){cc.TEXTURE_ATLAS_USE_VAO&&cc.ENABLE_GL_STATE_CACHE&&cc._uVAO!==a&&(cc._uVAO=a)};cc.glEnable=function(a){};cc.IMAGE_FORMAT_JPEG=0;cc.IMAGE_FORMAT_PNG=1;cc.IMAGE_FORMAT_RAWDATA=9;cc.NextPOT=function(a){a-=1;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;return(a|a>>16)+1};
cc.RenderTexture=cc.Node.extend({sprite:null,clearFlags:0,clearDepthVal:0,autoDraw:!1,_texture:null,_pixelFormat:0,clearStencilVal:0,_clearColor:null,_className:"RenderTexture",ctor:function(a,b,c,d){cc.Node.prototype.ctor.call(this);this._cascadeOpacityEnabled=this._cascadeColorEnabled=!0;this._pixelFormat=cc.Texture2D.PIXEL_FORMAT_RGBA8888;this._clearColor=new cc.Color(0,0,0,255);void 0!==a&&void 0!==b&&(c=c||cc.Texture2D.PIXEL_FORMAT_RGBA8888,this.initWithWidthAndHeight(a,b,c,d||0));this.setAnchorPoint(0,
0)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.RenderTexture.CanvasRenderCmd(this):new cc.RenderTexture.WebGLRenderCmd(this)},visit:function(a){var b=this._renderCmd;a=a?a._renderCmd:null;if(this._visible){var c=cc.renderer;b.visit(a);c.pushRenderCommand(b);this.sprite.visit(this);b._dirtyFlag=0}else b._propagateFlagsDown(a)},cleanup:function(){cc.Node.prototype.onExit.call(this);this._renderCmd.cleanup()},getSprite:function(){return this.sprite},setSprite:function(a){this.sprite=
a},setVirtualViewport:function(a,b,c){this._renderCmd.setVirtualViewport(a,b,c)},initWithWidthAndHeight:function(a,b,c,d){return this._renderCmd.initWithWidthAndHeight(a,b,c,d)},begin:function(){cc.renderer._turnToCacheMode(this.__instanceId);this._renderCmd.begin()},beginWithClear:function(a,b,c,d,e,f){var g=cc._renderContext;e=e||g.COLOR_BUFFER_BIT;f=f||g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT;this._beginWithClear(a,b,c,d,e,f,g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT|g.STENCIL_BUFFER_BIT)},_beginWithClear:function(a,
b,c,d,e,f,g){this.begin();this._renderCmd._beginWithClear(a,b,c,d,e,f,g)},end:function(){this._renderCmd.end()},clear:function(a,b,c,d){this.beginWithClear(a,b,c,d);this.end()},clearRect:function(a,b,c,d){this._renderCmd.clearRect(a,b,c,d)},clearDepth:function(a){this._renderCmd.clearDepth(a)},clearStencil:function(a){this._renderCmd.clearStencil(a)},getClearFlags:function(){return this.clearFlags},setClearFlags:function(a){this.clearFlags=a},getClearColor:function(){return this._clearColor},setClearColor:function(a){var b=
this._clearColor;b.r=a.r;b.g=a.g;b.b=a.b;b.a=a.a;this._renderCmd.updateClearColor(a)},getClearDepth:function(){return this.clearDepthVal},setClearDepth:function(a){this.clearDepthVal=a},getClearStencil:function(){return this.clearStencilVal},setClearStencil:function(a){this.clearStencilVal=a},isAutoDraw:function(){return this.autoDraw},setAutoDraw:function(a){this.autoDraw=a},saveToFile:function(a,b){cc.log("saveToFile isn't supported on Cocos2d-Html5")},newCCImage:function(a){cc.log("saveToFile isn't supported on cocos2d-html5");
return null},listenToBackground:function(a){},listenToForeground:function(a){}});_p=cc.RenderTexture.prototype;cc.defineGetterSetter(_p,"clearColorVal",_p.getClearColor,_p.setClearColor);cc.RenderTexture.create=function(a,b,c,d){return new cc.RenderTexture(a,b,c,d)};(function(){cc.RenderTexture.CanvasRenderCmd=function(a){this._rootCtor(a);this._needDraw=!1;this._clearColorStr="rgba(255,255,255,1)";this._cacheCanvas=document.createElement("canvas");this._cacheContext=new cc.CanvasContextWrapper(this._cacheCanvas.getContext("2d"))};var a=cc.RenderTexture.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);a.constructor=cc.RenderTexture.CanvasRenderCmd;a.cleanup=function(){this._cacheCanvas=this._cacheContext=null};a.clearStencil=function(a){};
a.setVirtualViewport=function(a,c,d){};a.updateClearColor=function(a){this._clearColorStr="rgba("+(0|a.r)+","+(0|a.g)+","+(0|a.b)+","+a.a/255+")"};a.initWithWidthAndHeight=function(a,c,d,e){d=this._node;e=this._cacheCanvas;var f=cc.contentScaleFactor();e.width=0|a*f;e.height=0|c*f;a=new cc.Texture2D;a.initWithElement(e);a.handleLoadedTexture();a=d.sprite=new cc.Sprite(a);a.setBlendFunc(cc.ONE,cc.ONE_MINUS_SRC_ALPHA);d.autoDraw=!1;d.addChild(a);return!0};a.begin=function(){};a._beginWithClear=function(a,
c,d,e,f,g,h){a=a||0;c=c||0;d=d||0;e=isNaN(e)?255:e;f=this._cacheContext.getContext();g=this._cacheCanvas;f.setTransform(1,0,0,1,0,0);this._cacheContext.setFillStyle("rgba("+(0|a)+","+(0|c)+","+(0|d)+","+e/255+")");f.clearRect(0,0,g.width,g.height);f.fillRect(0,0,g.width,g.height)};a.end=function(){var a=this._node,c=cc.contentScaleFactor();cc.renderer._renderingToCacheCanvas(this._cacheContext,a.__instanceId,c,c);a=a.sprite._renderCmd;a._notifyRegionStatus&&a._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty)};
a.clearRect=function(a,c,d,e){this._cacheContext.clearRect(a,c,d,-e)};a.clearDepth=function(a){cc.log("clearDepth isn't supported on Cocos2d-Html5")}})();(function(){cc.RenderTexture.WebGLRenderCmd=function(a){this._rootCtor(a);this._needDraw=!0;this._depthRenderBuffer=this._textureCopy=this._oldFBO=this._fBO=null;this._rtTextureRect=new cc.Rect;this._fullRect=new cc.Rect;this._fullViewport=new cc.Rect};var a=cc.RenderTexture.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);a.constructor=cc.RenderTexture.WebGLRenderCmd;a.setVirtualViewport=function(a,c,d){this._rtTextureRect.x=a.x;this._rtTextureRect.y=a.y;this._fullRect=c;
this._fullViewport=d};a.needDraw=function(){return this._needDraw&&this._node.autoDraw};a.rendering=function(a){var c=a||cc._renderContext;a=this._node;if(a.autoDraw){a.begin();var d=a.clearFlags;if(d){var e=[0,0,0,0],f=0,g=0;d&c.COLOR_BUFFER_BIT&&(e=c.getParameter(c.COLOR_CLEAR_VALUE),c.clearColor(a._clearColor.r/255,a._clearColor.g/255,a._clearColor.b/255,a._clearColor.a/255));d&c.DEPTH_BUFFER_BIT&&(f=c.getParameter(c.DEPTH_CLEAR_VALUE),c.clearDepth(a.clearDepthVal));d&c.STENCIL_BUFFER_BIT&&(g=
c.getParameter(c.STENCIL_CLEAR_VALUE),c.clearStencil(a.clearStencilVal));c.clear(d);d&c.COLOR_BUFFER_BIT&&c.clearColor(e[0],e[1],e[2],e[3]);d&c.DEPTH_BUFFER_BIT&&c.clearDepth(f);d&c.STENCIL_BUFFER_BIT&&c.clearStencil(g)}a.sortAllChildren();c=a._children;for(d=0;d<c.length;d++)e=c[d],e!==a.sprite&&e.visit(a.sprite);a.end()}};a.clearStencil=function(a){var c=cc._renderContext,d=c.getParameter(c.STENCIL_CLEAR_VALUE);c.clearStencil(a);c.clear(c.STENCIL_BUFFER_BIT);c.clearStencil(d)};a.cleanup=function(){this._textureCopy=
null;var a=cc._renderContext;a.deleteFramebuffer(this._fBO);this._depthRenderBuffer&&a.deleteRenderbuffer(this._depthRenderBuffer)};a.updateClearColor=function(a){};a.initWithWidthAndHeight=function(a,c,d,e){var f=this._node;d===cc.Texture2D.PIXEL_FORMAT_A8&&cc.log("cc.RenderTexture._initWithWidthAndHeightForWebGL() : only RGB and RGBA formats are valid for a render texture;");var g=cc._renderContext,h=cc.contentScaleFactor();this._fullRect=new cc.Rect(0,0,a,c);this._fullViewport=new cc.Rect(0,0,
a,c);a=0|a*h;c=0|c*h;this._oldFBO=g.getParameter(g.FRAMEBUFFER_BINDING);var k;cc.configuration.supportsNPOT()?(h=a,k=c):(h=cc.NextPOT(a),k=cc.NextPOT(c));for(var m=new Uint8Array(h*k*4),n=0;n<h*k*4;n++)m[n]=0;this._pixelFormat=d;n=f._texture=new cc.Texture2D;if(!f._texture)return!1;n.initWithData(m,f._pixelFormat,h,k,cc.size(a,c));d=g.getParameter(g.RENDERBUFFER_BINDING);if(cc.configuration.checkForGLExtension("GL_QCOM")){this._textureCopy=new cc.Texture2D;if(!this._textureCopy)return!1;this._textureCopy.initWithData(m,
f._pixelFormat,h,k,cc.size(a,c))}this._fBO=g.createFramebuffer();g.bindFramebuffer(g.FRAMEBUFFER,this._fBO);g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,n._webTextureObj,0);0!==e&&(this._depthRenderBuffer=g.createRenderbuffer(),g.bindRenderbuffer(g.RENDERBUFFER,this._depthRenderBuffer),g.renderbufferStorage(g.RENDERBUFFER,e,h,k),e===g.DEPTH_STENCIL?g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_STENCIL_ATTACHMENT,g.RENDERBUFFER,this._depthRenderBuffer):e===g.STENCIL_INDEX||
e===g.STENCIL_INDEX8?g.framebufferRenderbuffer(g.FRAMEBUFFER,g.STENCIL_ATTACHMENT,g.RENDERBUFFER,this._depthRenderBuffer):e===g.DEPTH_COMPONENT16&&g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,this._depthRenderBuffer));g.checkFramebufferStatus(g.FRAMEBUFFER)!==g.FRAMEBUFFER_COMPLETE&&cc.log("Could not attach texture to the framebuffer");n.setAliasTexParameters();a=f.sprite=new cc.Sprite(n);a.scaleY=-1;a.setBlendFunc(g.ONE,g.ONE_MINUS_SRC_ALPHA);g.bindRenderbuffer(g.RENDERBUFFER,
d);g.bindFramebuffer(g.FRAMEBUFFER,this._oldFBO);f.autoDraw=!1;f.addChild(a);return!0};a.begin=function(){var a=this._node;cc.kmGLMatrixMode(cc.KM_GL_PROJECTION);cc.kmGLPushMatrix();cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW);cc.kmGLPushMatrix();var c=cc._renderContext,d=cc.director;d.setProjection(d.getProjection());var e=a._texture.getContentSizeInPixels(),f=cc.director.getWinSizeInPixels(),d=f.width/e.width,e=f.height/e.height,d=cc.math.Matrix4.createOrthographicProjection(-1/d,1/d,-1/e,1/e,-1,1);cc.kmGLMultMatrix(d);
d=new cc.Rect(0,0,0,0);d.width=this._fullViewport.width;d.height=this._fullViewport.height;e=d.height/this._fullRect.height;d.x=d.width/this._fullRect.width*(this._fullRect.x-this._rtTextureRect.x);d.y=(this._fullRect.y-this._rtTextureRect.y)*e;c.viewport(d.x,d.y,d.width,d.height);this._oldFBO=c.getParameter(c.FRAMEBUFFER_BINDING);c.bindFramebuffer(c.FRAMEBUFFER,this._fBO);cc.configuration.checkForGLExtension("GL_QCOM")&&(c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,this._textureCopy._webTextureObj,
0),c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,a._texture._webTextureObj,0))};a._beginWithClear=function(a,c,d,e,f,g,h){a/=255;c/=255;d/=255;e/=255;var k=cc._renderContext,m=[0,0,0,0],n=0,p=0;h&k.COLOR_BUFFER_BIT&&(m=k.getParameter(k.COLOR_CLEAR_VALUE),k.clearColor(a,c,d,e));h&k.DEPTH_BUFFER_BIT&&(n=k.getParameter(k.DEPTH_CLEAR_VALUE),k.clearDepth(f));h&k.STENCIL_BUFFER_BIT&&(p=k.getParameter(k.STENCIL_CLEAR_VALUE),k.clearStencil(g));
k.clear(h);h&k.COLOR_BUFFER_BIT&&k.clearColor(m[0],m[1],m[2],m[3]);h&k.DEPTH_BUFFER_BIT&&k.clearDepth(n);h&k.STENCIL_BUFFER_BIT&&k.clearStencil(p)};a.end=function(){cc.renderer._renderingToBuffer(this._node.__instanceId);var a=cc._renderContext,c=cc.director;a.bindFramebuffer(a.FRAMEBUFFER,this._oldFBO);c.setViewport();cc.kmGLMatrixMode(cc.KM_GL_PROJECTION);cc.kmGLPopMatrix();cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW);cc.kmGLPopMatrix()};a.clearRect=function(a,c,d,e){};a.clearDepth=function(a){var c=this._node;
c.begin();var d=cc._renderContext,e=d.getParameter(d.DEPTH_CLEAR_VALUE);d.clearDepth(a);d.clear(d.DEPTH_BUFFER_BIT);d.clearDepth(e);c.end()}})();cc.LabelBMFont=cc.SpriteBatchNode.extend({_opacityModifyRGB:!1,_string:"",_config:null,_fntFile:"",_initialString:"",_alignment:cc.TEXT_ALIGNMENT_CENTER,_width:-1,_lineBreakWithoutSpaces:!1,_imageOffset:null,_textureLoaded:!1,_className:"LabelBMFont",_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new cc.LabelBMFont.WebGLRenderCmd(this):new cc.LabelBMFont.CanvasRenderCmd(this)},_setString:function(a,b){b?this._initialString=a:this._string=a;var c=this._children;if(c)for(var d=
0;d<c.length;d++){var e=c[d];e&&e.setVisible(!1)}this._textureLoaded&&(this._string&&0<this._string.length&&this.createFontChars(),b&&this.updateLabel())},ctor:function(a,b,c,d,e){cc.SpriteBatchNode.prototype.ctor.call(this);this._imageOffset=cc.p(0,0);this._cascadeOpacityEnabled=this._cascadeColorEnabled=!0;this.initWithString(a,b,c,d,e)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(a,b){this.addEventListener("load",a,b)},isOpacityModifyRGB:function(){return this._opacityModifyRGB},
setOpacityModifyRGB:function(a){this._opacityModifyRGB=a;if(a=this._children)for(var b=0;b<a.length;b++){var c=a[b];c&&(c.opacityModifyRGB=this._opacityModifyRGB)}},_changeTextureColor:function(){this._renderCmd._changeTextureColor()},init:function(){return this.initWithString(null,null,null,null,null)},initWithString:function(a,b,c,d,e){a=a||"";this._config&&cc.log("cc.LabelBMFont.initWithString(): re-init is no longer supported");var f;if(b){f=cc.loader.getRes(b);if(!f&&(f=cc.FntFrameCache[b]||
cc.FntFrameCache[cc.path.basename(b)],!f))return cc.log("cc.LabelBMFont.initWithString(): Impossible to create font. Please check file"),!1;this._config=f;this._fntFile=b;b=f.atlasName;(b=cc.spriteFrameCache.getSpriteFrame(b)||cc.spriteFrameCache.getSpriteFrame(cc.path.basename(b)))?(f=b.getTexture(),this._spriteFrame=b):f=cc.textureCache.addImage(f.atlasName);(this._textureLoaded=b=f.isLoaded())||f.addEventListener("load",function(a){this._textureLoaded=!0;this.initWithTexture(a,this._initialString.length);
this.setString(this._initialString,!0);this.dispatchEvent("load")},this)}else f=new cc.Texture2D,b=new Image,f.initWithElement(b),this._textureLoaded=!1;return this.initWithTexture(f,a.length)?(this._alignment=d||cc.TEXT_ALIGNMENT_LEFT,this._imageOffset=e||cc.p(0,0),this._width=void 0===c?-1:c,this._realOpacity=255,this._realColor=cc.color(255,255,255,255),this._contentSize.width=0,this._contentSize.height=0,this.setAnchorPoint(0.5,0.5),this.setString(a,!0),!0):!1},createFontChars:function(){var a=
this._string,b=a?a.length:0,c=this._renderCmd,d=c._texture||this._texture,e=0,f=cc.size(0,0),g=0,h=1,k,m=this._config,n=m.kerningDict,p=m.commonHeight,r=m.fontDefDictionary;for(k=0;k<b-1;k++)10===a.charCodeAt(k)&&h++;var s=p*h,h=-(p-p*h),u=-1,t;for(k=0;k<b;k++)if(p=a.charCodeAt(k),0!==p)if(10===p)e=0,h-=m.commonHeight;else{u=n[u<<16|p&65535]||0;t=r[p];t||(cc.log("cocos2d: LabelBMFont: character not found "+a[k]),t={rect:{x:0,y:0,width:0,height:0},xOffset:0,yOffset:0,xAdvance:0});var w=cc.rect(t.rect.x,
t.rect.y,t.rect.width,t.rect.height),w=cc.rectPixelsToPoints(w);w.x+=this._imageOffset.x;w.y+=this._imageOffset.y;var v=!1;if(this._spriteFrame){var x=this._spriteFrame._rect;if(this._spriteFrame._rotated){var v=!0,A=w.x;w.x=w.y+x.x;w.y=A+x.y}else w.x+=x.x,w.y+=x.y}(x=this.getChildByTag(k))?c._updateCharTexture(x,w,p,v):(x=new cc.Sprite,x.initWithTexture(d,w,v),x._newTextureWhenChangeColor=!0,this.addChild(x,0,k));x.opacityModifyRGB=this._opacityModifyRGB;c._updateCharColorAndOpacity(x);w=cc.p(e+
t.xOffset+0.5*t.rect.width+u,h+(m.commonHeight-t.yOffset)-0.5*w.height*cc.contentScaleFactor());x.setPosition(cc.pointPixelsToPoints(w));e+=t.xAdvance+u;u=p;g<e&&(g=e)}f.width=t&&t.xAdvance<t.rect.width?g-t.xAdvance+t.rect.width:g;f.height=s;this.setContentSize(cc.sizePixelsToPoints(f))},updateString:function(a){var b=this._children;if(b)for(var c=0,d=b.length;c<d;c++){var e=b[c];e&&(e.visible=!1)}this._config&&this._string&&0<this._string.length&&this.createFontChars();a||this.updateLabel()},getString:function(){return this._initialString},
setString:function(a,b){a=String(a);void 0===b&&(b=!0);if(void 0===a||"string"!==typeof a)a+="";this._initialString=a;this._setString(a,b)},_setStringForSetter:function(a){this.setString(a,!1)},setCString:function(a){this.setString(a,!0)},_getCharsWidth:function(a,b){if(0>=b)return 0;var c=this.getChildByTag(a),d=this.getChildByTag(a+b);return this._getLetterPosXLeft(d)-this._getLetterPosXLeft(c)},_checkWarp:function(a,b,c,d){for(var e=a[b],f=0,g=0;g<b;g++)f+=a[g].length;var f=f+b-d,h=this._getCharsWidth(f,
a[b].length-1);if(h>c&&1<e.length){d=c/h*e.length|0;for(var g=e.substr(d),k=h-this._getCharsWidth(f+d,g.length-1),m,n=0,p=0;k>c&&100>p++;)d*=c/k,d|=0,g=e.substr(d),k=h-this._getCharsWidth(f+d,g.length-1);for(p=0;k<c&&100>p++;)g&&(n=(m=cc.LabelTTF._wordRex.exec(g))?m[0].length:1,m=g),this._lineBreakWithoutSpaces&&(n=0),d+=n,g=e.substr(d),k=h-this._getCharsWidth(f+d,g.length-1);d-=n;0===d&&(d=1,m=m.substr(1));c=e.substr(0,d);cc.LabelTTF.wrapInspection&&cc.LabelTTF._symbolRex.test(m||g)&&(n=(f=cc.LabelTTF._lastWordRex.exec(c))?
f[0].length:0,this._lineBreakWithoutSpaces&&(n=0),d-=n,m=e.substr(d),c=e.substr(0,d));cc.LabelTTF._firsrEnglish.test(m)&&(f=cc.LabelTTF._lastEnglish.exec(c))&&c!==f[0]&&(n=f[0].length,this._lineBreakWithoutSpaces&&(n=0),d-=n,m=e.substr(d),c=e.substr(0,d));a[b]=m||g;a.splice(b,0,c)}},updateLabel:function(){this.string=this._initialString;var a,b,c;if(0<this._width){var d=this.string.split("\n"),e="",f=0,g=0;for(a=0;a<d.length;a++)g=d.length,this._checkWarp(d,a,this._width*this._scaleX,f),g<d.length&&
f++,0<a&&(e+="\n"),e+=d[a];e+=String.fromCharCode(0);this._setString(e,!1)}if(this._alignment!==cc.TEXT_ALIGNMENT_LEFT)for(d=a=0,e=this._string.length,f=[],g=0;g<e;g++)if(10===this._string[g].charCodeAt(0)||0===this._string[g].charCodeAt(0)){b=0;var h=f.length;if(0===h)d++;else if(c=a+h-1+d,!(0>c)){var k=this.getChildByTag(c);if(null!=k){b=k.getPositionX()+k._getWidth()/2;k=0;switch(this._alignment){case cc.TEXT_ALIGNMENT_CENTER:k=this.width/2-b/2;break;case cc.TEXT_ALIGNMENT_RIGHT:k=this.width-b}if(0!==
k)for(b=0;b<h;b++)c=a+b+d,0>c||(c=this.getChildByTag(c))&&(c.x+=k);a+=h;d++;f.length=0}}}else f.push(this._string[a])},setAlignment:function(a){this._alignment=a;this.updateLabel()},_getAlignment:function(){return this._alignment},setBoundingWidth:function(a){this._width=a;this.updateLabel()},_getBoundingWidth:function(){return this._width},setLineBreakWithoutSpace:function(a){this._lineBreakWithoutSpaces=a;this.updateLabel()},setScale:function(a,b){cc.Node.prototype.setScale.call(this,a,b);this.updateLabel()},
setScaleX:function(a){cc.Node.prototype.setScaleX.call(this,a);this.updateLabel()},setScaleY:function(a){cc.Node.prototype.setScaleY.call(this,a);this.updateLabel()},setFntFile:function(a){if(null!=a&&a!==this._fntFile){var b=cc.loader.getRes(a);b?(this._fntFile=a,this._config=b,a=cc.textureCache.addImage(b.atlasName),(this._textureLoaded=b=a.isLoaded())?(this.setTexture(a),this._string&&0<this._string.length&&this.createFontChars()):a.addEventListener("load",function(a){this._textureLoaded=!0;this.setTexture(a);
this._string&&0<this._string.length&&this.createFontChars();this._changeTextureColor();this.updateLabel();this.dispatchEvent("load")},this)):cc.log("cc.LabelBMFont.setFntFile() : Impossible to create font. Please check file")}},getFntFile:function(){return this._fntFile},setTexture:function(a){this._texture=a;this._renderCmd.setTexture(a)},setAnchorPoint:function(a,b){cc.Node.prototype.setAnchorPoint.call(this,a,b);this.updateLabel()},_setAnchorX:function(a){cc.Node.prototype._setAnchorX.call(this,
a);this.updateLabel()},_setAnchorY:function(a){cc.Node.prototype._setAnchorY.call(this,a);this.updateLabel()},_atlasNameFromFntFile:function(a){},_kerningAmountForFirst:function(a,b){var c=0;if(this._configuration.kerningDictionary){var d=this._configuration.kerningDictionary[(a<<16|b&65535).toString()];d&&(c=d.amount)}return c},_getLetterPosXLeft:function(a){return a.getPositionX()*this._scaleX-a._getWidth()*this._scaleX*a._getAnchorX()},_getLetterPosXRight:function(a){return a.getPositionX()*this._scaleX+
a._getWidth()*this._scaleX*a._getAnchorX()},_isspace_unicode:function(a){a=a.charCodeAt(0);return 9<=a&&13>=a||32===a||133===a||160===a||5760===a||8192<=a&&8202>=a||8232===a||8233===a||8239===a||8287===a||12288===a},_utf8_trim_ws:function(a){var b=a.length;if(!(0>=b)&&(b-=1,this._isspace_unicode(a[b]))){for(var c=b-1;0<=c;--c)if(this._isspace_unicode(a[c]))b=c;else break;this._utf8_trim_from(a,b)}},_utf8_trim_from:function(a,b){var c=a.length;b>=c||0>b||a.splice(b,c)}});
(function(){var a=cc.LabelBMFont.prototype;cc.EventHelper.prototype.apply(a);cc.defineGetterSetter(a,"string",a.getString,a._setStringForSetter);cc.defineGetterSetter(a,"boundingWidth",a._getBoundingWidth,a.setBoundingWidth);cc.defineGetterSetter(a,"textAlign",a._getAlignment,a.setAlignment);cc.defineGetterSetter(a,"texture",a.getTexture,a.setTexture)})();cc.LabelBMFont.create=function(a,b,c,d,e){return new cc.LabelBMFont(a,b,c,d,e)};cc.FntFrameCache={};
var _fntLoader={FNT_HEAD:/fntframes [^\n]*(\n|$)/gi,FNT_FRAME_NAME:/fntframe [^\n]*(\n|$)/gi,INFO_EXP:/info [^\n]*(\n|$)/gi,COMMON_EXP:/common [^\n]*(\n|$)/gi,PAGE_EXP:/page [^\n]*(\n|$)/gi,CHAR_EXP:/char [^\n]*(\n|$)/gi,KERNING_EXP:/kerning [^\n]*(\n|$)/gi,ITEM_EXP:/\w+=[^ \r\n]+/gi,INT_EXP:/^[\-]?\d+$/,_parseStrToObj:function(a){a=a.match(this.ITEM_EXP);var b={};if(a)for(var c=0,d=a.length;c<d;c++){var e=a[c],f=e.indexOf("\x3d"),g=e.substring(0,f),e=e.substring(f+1);e.match(this.INT_EXP)?e=parseInt(e):
'"'===e[0]&&(e=e.substring(1,e.length-1));b[g]=e}return b},_parseFntContent:function(a,b,c,d){var e=this._parseStrToObj(b.match(this.COMMON_EXP)[0]);a.commonHeight=e.lineHeight;if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){var f=cc.configuration.getMaxTextureSize();(e.scaleW>f.width||e.scaleH>f.height)&&cc.log("cc.LabelBMFont._parseCommonArguments(): page can't be larger than supported")}1!==e.pages&&cc.log("cc.LabelBMFont._parseCommonArguments(): only supports 1 page");e=this._parseStrToObj(b.match(this.PAGE_EXP)[0]);
0!==e.id&&cc.log("cc.LabelBMFont._parseImageFileName() : file could not be found");a.atlasName=d?cc.path.join(cc.path.dirname(d.path)+e.file):cc.path.changeBasename(c,e.file);e=b.match(this.CHAR_EXP);f=a.fontDefDictionary={};c=0;for(d=e.length;c<d;c++){var g=this._parseStrToObj(e[c]);f[g.id]={rect:{x:g.x,y:g.y,width:g.width,height:g.height},xOffset:g.xoffset,yOffset:g.yoffset,xAdvance:g.xadvance}}e=a.kerningDict={};if(b=b.match(this.KERNING_EXP))for(c=0,d=b.length;c<d;c++)f=this._parseStrToObj(b[c]),
e[f.first<<16|f.second&65535]=f.amount;return a},parseFnt:function(a,b){var c={},d=a.match(this.FNT_HEAD);if(d){var e=this._parseStrToObj(d[0]);if(e&&e.count){a=a.substr(d[0].length);for(var d=a.split("----"),f=0;f<e.count;++f){var g=d[f],h=g.match(this.FNT_FRAME_NAME);if(h){var k=this._parseStrToObj(h[0]);if(k&&k.name){var c={},m=cc.path.join(cc.path.dirname(b),k.name);cc.FntFrameCache[m]=this._parseFntContent(c,g.substr(h[0].length),b,{path:k.name})}}}}}else c=this._parseFntContent(c,a,b);return c},
load:function(a,b,c,d){var e=this;cc.loader.loadTxt(a,function(a,c){if(a)return d(a);d(null,e.parseFnt(c,b))})}};cc.loader.register(["fnt"],_fntLoader);(function(){cc.LabelBMFont.CanvasRenderCmd=function(a){this._rootCtor(a)};var a=cc.LabelBMFont.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);a.constructor=cc.LabelBMFont.CanvasRenderCmd;a._updateCharTexture=function(a,c,d){32===d?a.setTextureRect(c,!1,cc.size(0,0)):(a.setTextureRect(c,!1),a.visible=!0)};a._updateCharColorAndOpacity=function(a){a._displayedColor=this._displayedColor;a._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty);a._displayedOpacity=this._displayedOpacity;
a._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)};a.setTexture=function(a){for(var c=this._node,d=c._children,e=this._displayedColor,f=0;f<d.length;f++){var g=d[f],h=g._renderCmd,k=h._displayedColor;if(c._texture===h._texture||k.r===e.r&&k.g===e.g&&k.b===e.b)g.texture=a}c._texture=a};a._changeTextureColor=function(){var a=this._node,c=a._texture,d=c.getContentSize(),e=a._texture,f=e.getHtmlElementObj(),g=this._displayedColor,h=cc.rect(0,0,f.width,f.height);c&&0<d.width&&f&&(c=e._generateColorTexture(g.r,
g.g,g.b,h),a.setTexture(c))};a._updateChildrenDisplayedOpacity=function(a){cc.Node.prototype.updateDisplayedOpacity.call(a,this._displayedOpacity)};a._updateChildrenDisplayedColor=function(a){cc.Node.prototype.updateDisplayedColor.call(a,this._displayedColor)}})();(function(){cc.LabelBMFont.WebGLRenderCmd=function(a){this._rootCtor(a)};var a=cc.LabelBMFont.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);a.constructor=cc.LabelBMFont.WebGLRenderCmd;a.setTexture=function(a){this._node.setOpacityModifyRGB(this._node._texture.hasPremultipliedAlpha())};a._updateCharTexture=function(a,c,d,e){a.setTextureRect(c,e);a.visible=!0};a._changeTextureColor=function(){};a._updateCharColorAndOpacity=function(){}})();cc.LabelAtlas=cc.LabelBMFont.extend({_className:"LabelAtlas",ctor:function(a,b,c,d,e){cc.SpriteBatchNode.prototype.ctor.call(this);this._imageOffset=cc.p(0,0);this._cascadeOpacityEnabled=this._cascadeColorEnabled=!0;b&&cc.LabelAtlas.prototype.initWithString.call(this,a,b,c,d,e)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new cc.LabelBMFont.WebGLRenderCmd(this):new cc.LabelBMFont.CanvasRenderCmd(this)},_createFntConfig:function(a,b,c,d){var e={};e.commonHeight=c;
var f=e.fontDefDictionary={},g=a.pixelsWidth;a=a.pixelsHeight;d=d.charCodeAt(0);for(var h=0,k=c;k<=a;k+=c)for(var m=0;m<g;m+=b)f[d+h]={rect:{x:m,y:k-c,width:b,height:c},xOffset:0,yOffset:0,xAdvance:b},++h;e.kerningDict={};return e},initWithString:function(a,b,c,d,e){var f;this._string=this._initialString=a=a+""||"";if(void 0===c){e=cc.loader.getRes(b);if(1!==parseInt(e.version,10))return cc.log("cc.LabelAtlas.initWithString(): Unsupported version. Upgrade cocos2d version"),!1;f=cc.path.changeBasename(b,
e.textureFilename);d=cc.contentScaleFactor();c=parseInt(e.itemWidth,10)/d;d=parseInt(e.itemHeight,10)/d;e=String.fromCharCode(parseInt(e.firstChar,10))}else f=b,c=c||0,d=d||0,e=e||" ";if(b){this._fntFile="dummy_fnt_file:"+f;b=f;var g=cc.spriteFrameCache.getSpriteFrame(b)||cc.spriteFrameCache.getSpriteFrame(cc.path.basename(b));g?(b=g.getTexture(),this._spriteFrame=g):b=cc.textureCache.addImage(f);c=this._createFntConfig(b,c,d,e);c.atlasName=f;this._config=c;(this._textureLoaded=f=b.isLoaded())||b.addEventListener("load",
function(a){this._textureLoaded=!0;this.initWithTexture(a,this._initialString.length);this.setString(this._initialString,!0);this.dispatchEvent("load")},this)}else b=new cc.Texture2D,f=new Image,b.initWithElement(f),this._textureLoaded=!1;return this.initWithTexture(b,a.length)?(this._alignment=cc.TEXT_ALIGNMENT_LEFT,this._imageOffset=cc.p(0,0),this._width=-1,this._realOpacity=255,this._realColor=cc.color(255,255,255,255),this._contentSize.width=0,this._contentSize.height=0,this.setString(a,!0),!0):
!1},setFntFile:function(){cc.warn("setFntFile doesn't support with LabelAtlas.")}});cc.LabelAtlas.create=function(a,b,c,d,e){return new cc.LabelAtlas(a,b,c,d,e)};(function(){cc.LabelAtlas.CanvasRenderCmd=function(a){cc.AtlasNode.CanvasRenderCmd.call(this,a);this._needDraw=!1};var a=cc.LabelAtlas.CanvasRenderCmd.prototype=Object.create(cc.AtlasNode.CanvasRenderCmd.prototype);a.constructor=cc.LabelAtlas.CanvasRenderCmd;a.setCascade=function(){var a=this._node;a._cascadeOpacityEnabled=!0;a._cascadeColorEnabled=!1};a.updateAtlasValues=function(){for(var a=this._node,c=a._string||"",d=c.length,e=this._textureToRender,f=a._itemWidth,g=a._itemHeight,h=0,k=-1;h<d;h++){var m=
c.charCodeAt(h)-a._mapStartChar.charCodeAt(0),n=parseInt(m%a._itemsPerRow,10),m=parseInt(m/a._itemsPerRow,10);if(!(0>n||0>m||(n=cc.rect(n*f,m*g,f,g),m=e._contentSize,0>n.x||0>n.y||n.x+n.width>m.width||n.y+n.height>m.height))){k++;var m=c.charCodeAt(h),p=a.getChildByTag(h);p?32===m?(p.init(),p.setTextureRect(cc.rect(0,0,10,10),!1,cc.size(0,0))):(p.initWithTexture(e,n),p.visible=!0):(p=new cc.Sprite,32===m?(p.init(),p.setTextureRect(cc.rect(0,0,10,10),!1,cc.size(0,0))):p.initWithTexture(e,n),cc.Node.prototype.addChild.call(a,
p,0,h));p.setPosition(k*f+f/2,g/2)}}this.updateContentSize(h,k+1)};a.updateContentSize=function(a,c){var d=this._node,e=d._contentSize;a!==c&&a*d._itemWidth===e.width&&d._itemHeight===e.height&&d.setContentSize(c*d._itemWidth,d._itemHeight)};a.setString=function(a){a=this._node;if(a._children){a=a._children;for(var c=a.length,d=0;d<c;d++){var e=a[d];e&&!e._lateChild&&(e.visible=!1)}}};a._addChild=function(){child._lateChild=!0}})();(function(){cc.LabelAtlas.WebGLRenderCmd=function(a){cc.AtlasNode.WebGLRenderCmd.call(this,a);this._needDraw=!0};var a=cc.LabelAtlas.WebGLRenderCmd.prototype=Object.create(cc.AtlasNode.WebGLRenderCmd.prototype);a.constructor=cc.LabelAtlas.WebGLRenderCmd;a._updateColor=function(){if(this._colorF32Array){var a=this._displayedColor,c=this._displayedOpacity/255;this._node._opacityModifyRGB?(this._colorF32Array[0]=a.r*c/255,this._colorF32Array[1]=a.g*c/255,this._colorF32Array[2]=a.b*c/255):(this._colorF32Array[0]=
a.r/255,this._colorF32Array[1]=a.g/255,this._colorF32Array[2]=a.b/255);this._colorF32Array[3]=c}};a.setCascade=function(){var a=this._node;a._cascadeOpacityEnabled=!0;a._cascadeColorEnabled=!0};a.rendering=function(a){cc.AtlasNode.WebGLRenderCmd.prototype.rendering.call(this,a);if(cc.LABELATLAS_DEBUG_DRAW){var c=this._node;a=c.getContentSize();var c=c.getBoundingBoxToWorld(),d=c.x,e=c.y;a.width=c.width;a.height=c.height;a=[cc.p(d,e),cc.p(d+a.width,e),cc.p(a.width+d,a.height+e),cc.p(d,e+a.height)];
cc._drawingUtil.drawPoly(a,4,!0)}};a.updateAtlasValues=function(){var a=this._node,c=a._string,d=c.length,e=this._textureAtlas,f=e.texture,g=f.pixelsWidth,f=f.pixelsHeight,h=a._itemWidth,k=a._itemHeight;a._ignoreContentScaleFactor||(h=a._itemWidth*cc.contentScaleFactor(),k=a._itemHeight*cc.contentScaleFactor());d>e.getCapacity()&&cc.log("cc.LabelAtlas._updateAtlasValues(): Invalid String length");for(var m=e.quads,n=a._itemWidth,p=a._itemHeight,r=0,s=-1;r<d;r++){var u=c.charCodeAt(r)-a._mapStartChar.charCodeAt(0),
t=u%a._itemsPerRow,w=0|u/a._itemsPerRow;if(!(0>t||0>w||t*n+n>g||w*p+p>f)){s++;var v;cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(t=(2*t*h+1)/(2*g),u=t+(2*h-2)/(2*g),w=(2*w*k+1)/(2*f),v=w+(2*k-2)/(2*f)):(t=t*h/g,u=t+h/g,w=w*k/f,v=w+k/f);var x=m[r],A=x.tl,y=x.tr,z=x.bl,x=x.br;A.texCoords.u=t;A.texCoords.v=w;y.texCoords.u=u;y.texCoords.v=w;z.texCoords.u=t;z.texCoords.v=v;x.texCoords.u=u;x.texCoords.v=v;z.vertices.x=s*n;z.vertices.y=0;z.vertices.z=0;x.vertices.x=s*n+n;x.vertices.y=0;x.vertices.z=0;A.vertices.x=
s*n;A.vertices.y=a._itemHeight;A.vertices.z=0;y.vertices.x=s*n+n;y.vertices.y=a._itemHeight;y.vertices.z=0}}this._updateColor();this.updateContentSize(r,s+1);0<d&&(e.dirty=!0,a=e.totalQuads,d>a&&e.increaseTotalQuadsWith(d-a))};a.updateContentSize=function(a,c){var d=this._node,e=d._contentSize;a!==c&&a*d._itemWidth===e.width&&d._itemHeight===e.height&&d.setContentSize(c*d._itemWidth,d._itemHeight)};a.setString=function(a){a=a.length;a>this._textureAtlas.totalQuads&&this._textureAtlas.resizeCapacity(a)};
a._addChild=function(){}})();cc.MotionStreak=cc.Node.extend({texture:null,fastMode:!1,startingPositionInitialized:!1,_blendFunc:null,_stroke:0,_fadeDelta:0,_minSeg:0,_maxPoints:0,_nuPoints:0,_previousNuPoints:0,_pointVertexes:null,_pointState:null,_vertices:null,_colorPointer:null,_texCoords:null,_verticesBuffer:null,_colorPointerBuffer:null,_texCoordsBuffer:null,_className:"MotionStreak",ctor:function(a,b,c,d,e){cc.Node.prototype.ctor.call(this);this._positionR=cc.p(0,0);this._blendFunc=new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA);
this.startingPositionInitialized=this.fastMode=!1;this.texture=null;this._previousNuPoints=this._nuPoints=this._maxPoints=this._minSeg=this._fadeDelta=this._stroke=0;this._texCoordsBuffer=this._colorPointerBuffer=this._verticesBuffer=this._texCoords=this._colorPointer=this._vertices=this._pointState=this._pointVertexes=null;void 0!==e&&this.initWithFade(a,b,c,d,e)},getTexture:function(){return this.texture},setTexture:function(a){this.texture!==a&&(this.texture=a)},getBlendFunc:function(){return this._blendFunc},
setBlendFunc:function(a,b){void 0===b?this._blendFunc=a:(this._blendFunc.src=a,this._blendFunc.dst=b)},getOpacity:function(){cc.log("cc.MotionStreak.getOpacity has not been supported.");return 0},setOpacity:function(a){cc.log("cc.MotionStreak.setOpacity has not been supported.")},setOpacityModifyRGB:function(a){},isOpacityModifyRGB:function(){return!1},isFastMode:function(){return this.fastMode},setFastMode:function(a){this.fastMode=a},isStartingPositionInitialized:function(){return this.startingPositionInitialized},
setStartingPositionInitialized:function(a){this.startingPositionInitialized=a},getStroke:function(){return this._stroke},setStroke:function(a){this._stroke=a},initWithFade:function(a,b,c,d,e){if(!e)throw Error("cc.MotionStreak.initWithFade(): Invalid filename or texture");cc.isString(e)&&(e=cc.textureCache.addImage(e));cc.Node.prototype.setPosition.call(this,cc.p(0,0));this.anchorY=this.anchorX=0;this.ignoreAnchor=!0;this.startingPositionInitialized=!1;this.fastMode=!0;this._minSeg=-1===b?c/5:b;this._minSeg*=
this._minSeg;this._stroke=c;this._fadeDelta=1/a;this._maxPoints=a=(0|60*a)+2;this._nuPoints=0;this._pointState=new Float32Array(a);this._pointVertexes=new Float32Array(2*a);this._vertices=new Float32Array(4*a);this._texCoords=new Float32Array(4*a);this._colorPointer=new Uint8Array(8*a);this._verticesBuffer=gl.createBuffer();this._texCoordsBuffer=gl.createBuffer();this._colorPointerBuffer=gl.createBuffer();this._blendFunc.src=gl.SRC_ALPHA;this._blendFunc.dst=gl.ONE_MINUS_SRC_ALPHA;this.texture=e;this.color=
d;this.scheduleUpdate();gl.bindBuffer(gl.ARRAY_BUFFER,this._verticesBuffer);gl.bufferData(gl.ARRAY_BUFFER,this._vertices,gl.DYNAMIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,this._texCoordsBuffer);gl.bufferData(gl.ARRAY_BUFFER,this._texCoords,gl.DYNAMIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,this._colorPointerBuffer);gl.bufferData(gl.ARRAY_BUFFER,this._colorPointer,gl.DYNAMIC_DRAW);return!0},tintWithColor:function(a){this.color=a;for(var b=this._colorPointer,c=0,d=2*this._nuPoints;c<d;c++)b[4*c]=a.r,b[4*c+
1]=a.g,b[4*c+2]=a.b},reset:function(){this._nuPoints=0},setPosition:function(a,b){this.startingPositionInitialized=!0;void 0===b?(this._positionR.x=a.x,this._positionR.y=a.y):(this._positionR.x=a,this._positionR.y=b)},getPositionX:function(){return this._positionR.x},setPositionX:function(a){this._positionR.x=a;this.startingPositionInitialized||(this.startingPositionInitialized=!0)},getPositionY:function(){return this._positionR.y},setPositionY:function(a){this._positionR.y=a;this.startingPositionInitialized||
(this.startingPositionInitialized=!0)},update:function(a){if(this.startingPositionInitialized){this._renderCmd._updateDisplayColor();a*=this._fadeDelta;var b,c,d,e,f=0,g=this._nuPoints,h=this._pointState,k=this._pointVertexes,m=this._vertices,n=this._colorPointer;for(b=0;b<g;b++)h[b]-=a,0>=h[b]?f++:(c=b-f,0<f?(h[c]=h[b],k[2*c]=k[2*b],k[2*c+1]=k[2*b+1],e=2*b,d=2*c,m[2*d]=m[2*e],m[2*d+1]=m[2*e+1],m[2*(d+1)]=m[2*(e+1)],m[2*(d+1)+1]=m[2*(e+1)+1],e*=4,d*=4,n[d+0]=n[e+0],n[d+1]=n[e+1],n[d+2]=n[e+2],n[d+
4]=n[e+4],n[d+5]=n[e+5],n[d+6]=n[e+6]):d=8*c,c=255*h[c],n[d+3]=c,n[d+7]=c);g-=f;b=!0;g>=this._maxPoints?b=!1:0<g&&(a=cc.pDistanceSQ(cc.p(k[2*(g-1)],k[2*(g-1)+1]),this._positionR)<this._minSeg,d=1===g?!1:cc.pDistanceSQ(cc.p(k[2*(g-2)],k[2*(g-2)+1]),this._positionR)<2*this._minSeg,a||d)&&(b=!1);b&&(k[2*g]=this._positionR.x,k[2*g+1]=this._positionR.y,h[g]=1,h=8*g,b=this.getDisplayedColor(),n[h]=b.r,n[h+1]=b.g,n[h+2]=b.b,n[h+4]=b.r,n[h+5]=b.g,n[h+6]=b.b,n[h+3]=255,n[h+7]=255,0<g&&this.fastMode&&(1<g?
cc.vertexLineToPolygon(k,this._stroke,this._vertices,g,1):cc.vertexLineToPolygon(k,this._stroke,this._vertices,0,2)),g++);this.fastMode||cc.vertexLineToPolygon(k,this._stroke,this._vertices,0,g);if(g&&this._previousNuPoints!==g){k=1/g;n=this._texCoords;for(b=0;b<g;b++)n[4*b]=0,n[4*b+1]=k*b,n[2*(2*b+1)]=1,n[2*(2*b+1)+1]=k*b;this._previousNuPoints=g}this._nuPoints=g}},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new cc.MotionStreak.WebGLRenderCmd(this):null}});
cc.MotionStreak.create=function(a,b,c,d,e){return new cc.MotionStreak(a,b,c,d,e)};cc.MotionStreak.WebGLRenderCmd=function(a){this._rootCtor(a);this._needDraw=!0;this._matrix=new cc.math.Matrix4;this._matrix.identity();this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR)};cc.MotionStreak.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.MotionStreak.WebGLRenderCmd.prototype.constructor=cc.Sprite.WebGLRenderCmd;
cc.MotionStreak.WebGLRenderCmd.prototype.rendering=function(a){var b=this._node;if(!(1>=b._nuPoints)&&b.texture&&b.texture.isLoaded()){a=a||cc._renderContext;var c=this._worldTransform;this._matrix.mat[0]=c.a;this._matrix.mat[4]=c.c;this._matrix.mat[12]=c.tx;this._matrix.mat[1]=c.b;this._matrix.mat[5]=c.d;this._matrix.mat[13]=c.ty;this._glProgramState.apply(this._matrix);cc.glBlendFunc(b._blendFunc.src,b._blendFunc.dst);cc.glBindTexture2D(b.texture);a.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);
a.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR);a.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS);a.bindBuffer(a.ARRAY_BUFFER,b._verticesBuffer);a.bufferData(a.ARRAY_BUFFER,b._vertices,a.DYNAMIC_DRAW);a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,a.FLOAT,!1,0,0);a.bindBuffer(a.ARRAY_BUFFER,b._texCoordsBuffer);a.bufferData(a.ARRAY_BUFFER,b._texCoords,a.DYNAMIC_DRAW);a.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,a.FLOAT,!1,0,0);a.bindBuffer(a.ARRAY_BUFFER,b._colorPointerBuffer);a.bufferData(a.ARRAY_BUFFER,
b._colorPointer,a.DYNAMIC_DRAW);a.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,a.UNSIGNED_BYTE,!0,0,0);a.drawArrays(a.TRIANGLE_STRIP,0,2*b._nuPoints);cc.g_NumberOfDraws++}};cc.NodeGrid=cc.Node.extend({grid:null,_target:null,_gridRect:null,ctor:function(a){cc.Node.prototype.ctor.call(this);void 0===a&&(a=cc.rect());this._gridRect=a},getGrid:function(){return this.grid},setGrid:function(a){this.grid=a},setGridRect:function(a){this._gridRect=a},getGridRect:function(){return this._gridRect},setTarget:function(a){this._target=a},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new cc.NodeGrid.WebGLRenderCmd(this):new cc.Node.CanvasRenderCmd(this)}});
_p=cc.NodeGrid.prototype;cc.defineGetterSetter(_p,"target",null,_p.setTarget);cc.NodeGrid.create=function(){return new cc.NodeGrid};(function(){cc.NodeGrid.WebGLRenderCmd=function(a){this._rootCtor(a);this._needDraw=!1;this._gridBeginCommand=new cc.CustomRenderCmd(this,this.onGridBeginDraw);this._gridEndCommand=new cc.CustomRenderCmd(this,this.onGridEndDraw)};var a=cc.NodeGrid.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);a.constructor=cc.NodeGrid.WebGLRenderCmd;a.visit=function(a){var c=this._node;if(c._visible){if(a=a||this.getParentRenderCmd())this._curLevel=a._curLevel+1;var d=cc.current_stack;d.stack.push(d.top);
this._syncStatus(a);d.top=this._stackMatrix;cc.renderer.pushRenderCommand(this._gridBeginCommand);c._target&&c._target.visit();if((a=c._children)&&0<a.length){var e=a.length;c.sortAllChildren();for(c=0;c<e;c++){var f=a[c];f&&f.visit()}}cc.renderer.pushRenderCommand(this._gridEndCommand);this._dirtyFlag=0;d.top=d.stack.pop()}};a.onGridBeginDraw=function(){var a=this._node.grid;a&&a._active&&a.beforeDraw()};a.onGridEndDraw=function(){var a=this._node.grid;a&&a._active&&a.afterDraw(this._node)}})();cc.DrawNode=cc.Node.extend({_buffer:null,_blendFunc:null,_lineWidth:1,_drawColor:null,getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(a,b){void 0===b?(this._blendFunc.src=a.src,this._blendFunc.dst=a.dst):(this._blendFunc.src=a,this._blendFunc.dst=b)},setLineWidth:function(a){this._lineWidth=a},getLineWidth:function(){return this._lineWidth},setDrawColor:function(a){var b=this._drawColor;b.r=a.r;b.g=a.g;b.b=a.b;b.a=null==a.a?255:a.a},getDrawColor:function(){return cc.color(this._drawColor.r,
this._drawColor.g,this._drawColor.b,this._drawColor.a)}});cc.DrawNode.create=function(){return new cc.DrawNode};cc.DrawNode.TYPE_DOT=0;cc.DrawNode.TYPE_SEGMENT=1;cc.DrawNode.TYPE_POLY=2;
cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS)cc._DrawNodeElement=function(a,b,c,d,e,f,g,h,k){this.type=a;this.verts=b||null;this.fillColor=c||null;this.lineWidth=d||0;this.lineColor=e||null;this.lineCap=f||"butt";this.isClosePolygon=g||!1;this.isFill=h||!1;this.isStroke=k||!1},cc.extend(cc.DrawNode.prototype,{_className:"DrawNodeCanvas",ctor:function(){cc.Node.prototype.ctor.call(this);var a=this._renderCmd;a._buffer=this._buffer=
[];a._drawColor=this._drawColor=cc.color(255,255,255,255);a._blendFunc=this._blendFunc=new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA);this.init();this._localBB=new cc.Rect},setLocalBB:function(a,b,c,d){var e=this._localBB;void 0===b?(e.x=a.x,e.y=a.y,e.width=a.width,e.height=a.height):(e.x=a,e.y=b,e.width=c,e.height=d)},drawRect:function(a,b,c,d,e){d=null==d?this._lineWidth:d;e=e||this.getDrawColor();null==e.a&&(e.a=255);a=[a,cc.p(b.x,a.y),b,cc.p(a.x,b.y)];b=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);
b.verts=a;b.lineWidth=d;b.lineColor=e;b.isClosePolygon=!0;b.isStroke=!0;b.lineCap="butt";if(b.fillColor=c)null==c.a&&(c.a=255),b.isFill=!0;this._buffer.push(b)},drawCircle:function(a,b,c,d,e,f,g){f=f||this._lineWidth;g=g||this.getDrawColor();null==g.a&&(g.a=255);for(var h=2*Math.PI/d,k=[],m=0;m<=d;m++){var y=m*h,z=b*Math.cos(y+c)+a.x,y=b*Math.sin(y+c)+a.y;k.push(cc.p(z,y))}e&&k.push(cc.p(a.x,a.y));a=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);a.verts=k;a.lineWidth=f;a.lineColor=g;a.isClosePolygon=
!0;a.isStroke=!0;this._buffer.push(a)},drawQuadBezier:function(a,b,c,d,e,f){e=e||this._lineWidth;f=f||this.getDrawColor();null==f.a&&(f.a=255);for(var g=[],h=0,k=0;k<d;k++){var m=Math.pow(1-h,2)*a.x+2*(1-h)*h*b.x+h*h*c.x,y=Math.pow(1-h,2)*a.y+2*(1-h)*h*b.y+h*h*c.y;g.push(cc.p(m,y));h+=1/d}g.push(cc.p(c.x,c.y));a=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);a.verts=g;a.lineWidth=e;a.lineColor=f;a.isStroke=!0;a.lineCap="round";this._buffer.push(a)},drawCubicBezier:function(a,b,c,d,e,f,g){f=f||this._lineWidth;
g=g||this.getDrawColor();null==g.a&&(g.a=255);for(var h=[],k=0,m=0;m<e;m++){var y=Math.pow(1-k,3)*a.x+3*Math.pow(1-k,2)*k*b.x+3*(1-k)*k*k*c.x+k*k*k*d.x,z=Math.pow(1-k,3)*a.y+3*Math.pow(1-k,2)*k*b.y+3*(1-k)*k*k*c.y+k*k*k*d.y;h.push(cc.p(y,z));k+=1/e}h.push(cc.p(d.x,d.y));a=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);a.verts=h;a.lineWidth=f;a.lineColor=g;a.isStroke=!0;a.lineCap="round";this._buffer.push(a)},drawCatmullRom:function(a,b,c,d){this.drawCardinalSpline(a,0.5,b,c,d)},drawCardinalSpline:function(a,
b,c,d,e){d=d||this._lineWidth;e=e||this.getDrawColor();null==e.a&&(e.a=255);for(var f=[],g,h,k=1/a.length,m=0;m<c+1;m++)h=m/c,1===h?(g=a.length-1,h=1):(g=0|h/k,h=(h-k*g)/k),g=cc.cardinalSplineAt(cc.getControlPointAt(a,g-1),cc.getControlPointAt(a,g-0),cc.getControlPointAt(a,g+1),cc.getControlPointAt(a,g+2),b,h),f.push(g);a=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);a.verts=f;a.lineWidth=d;a.lineColor=e;a.isStroke=!0;a.lineCap="round";this._buffer.push(a)},drawDot:function(a,b,c){c=c||this.getDrawColor();
null==c.a&&(c.a=255);var d=new cc._DrawNodeElement(cc.DrawNode.TYPE_DOT);d.verts=[a];d.lineWidth=b;d.fillColor=c;this._buffer.push(d)},drawDots:function(a,b,c){if(a&&0!=a.length){c=c||this.getDrawColor();null==c.a&&(c.a=255);for(var d=0,e=a.length;d<e;d++)this.drawDot(a[d],b,c)}},drawSegment:function(a,b,c,d){c=c||this._lineWidth;d=d||this.getDrawColor();null==d.a&&(d.a=255);var e=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);e.verts=[a,b];e.lineWidth=2*c;e.lineColor=d;e.isStroke=!0;e.lineCap="round";
this._buffer.push(e)},drawPoly_:function(a,b,c,d){c=null==c?this._lineWidth:c;d=d||this.getDrawColor();null==d.a&&(d.a=255);var e=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);e.verts=a;e.fillColor=b;e.lineWidth=c;e.lineColor=d;e.isClosePolygon=!0;e.isStroke=!0;e.lineCap="round";b&&(e.isFill=!0);this._buffer.push(e)},drawPoly:function(a,b,c,d){for(var e=[],f=0;f<a.length;f++)e.push(cc.p(a[f].x,a[f].y));return this.drawPoly_(e,b,c,d)},clear:function(){this._buffer.length=0},_createRenderCmd:function(){return new cc.DrawNode.CanvasRenderCmd(this)}});
else if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){var a=null,b=[],c=cc.p(),d=cc.p(),e=new Uint32Array(1),f=cc.p(),g=cc.p(),h=cc.p(),k=cc.p(),m=[];cc.extend(cc.DrawNode.prototype,{_bufferCapacity:0,_vertexCount:0,_offset:0,_occupiedSize:0,_f32Buffer:null,_ui32Buffer:null,_dirty:!1,_className:"DrawNodeWebGL",manualRelease:!1,ctor:function(b,c){cc.Node.prototype.ctor.call(this);a||(a=new GlobalVertexBuffer(cc._renderContext,20*cc.DRAWNODE_TOTAL_VERTICES));this._renderCmd._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_LENGTHTEXTURECOLOR);
this._blendFunc=new cc.BlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA);this._drawColor=cc.color(255,255,255,255);this._bufferCapacity=b||64;this.manualRelease=c;this._dirty=!0},onEnter:function(){cc.Node.prototype.onEnter.call(this);this._occupiedSize<this._bufferCapacity&&this._ensureCapacity(this._bufferCapacity)},onExit:function(){this.manualRelease||this.release();cc.Node.prototype.onExit.call(this)},release:function(){0<this._occupiedSize&&(this._vertexCount=0,a.freeBuffer(this._offset,20*this._occupiedSize),
this._occupiedSize=0)},_ensureCapacity:function(b){var c=this._occupiedSize,d=this._offset;if(b>c||this._bufferCapacity>c){var e=Math.max(Math.min(c+c,200),b,this._bufferCapacity);0!==c&&(a.freeBuffer(d,20*c),this._occupiedSize=0);b=this._offset=a.requestBuffer(20*e);if(0<=b){this._occupiedSize=this._bufferCapacity=e;this._f32Buffer=new Float32Array(a.data,b,5*this._occupiedSize);this._ui32Buffer=new Uint32Array(a.data,b,5*this._occupiedSize);if(0!==c&&d!==b)for(c=d/4+5*c,b/=4,d/=4;d<c;b++,d++)a.dataArray[b]=
a.dataArray[d];return!0}cc.warn("Failed to allocate buffer for DrawNode: buffer for "+e+" vertices requested");return!1}return!0},drawRect:function(a,c,d,e,f){e=null==e?this._lineWidth:e;f=f||this._drawColor;b.length=0;b.push(a.x,a.y,c.x,a.y,c.x,c.y,a.x,c.y);null==d?this._drawSegments(b,e,f,!0):this.drawPoly(b,d,e,f);b.length=0},drawCircle:function(a,e,f,g,h,k,m){k=k||this._lineWidth;m=m||this._drawColor;var v=2*Math.PI/g,x;for(x=b.length=0;x<=g;x++){var A=x*v,y=e*Math.cos(A+f)+a.x,A=e*Math.sin(A+
f)+a.y;b.push(y,A)}h&&b.push(a.x,a.y);k*=0.5;x=0;for(a=b.length-2;x<a;x+=2)c.x=b[x],c.y=b[x+1],d.x=b[x+2],d.y=b[x+3],this.drawSegment(c,d,k,m);b.length=0},drawQuadBezier:function(a,c,d,e,f,g){f=f||this._lineWidth;g=g||this._drawColor;for(var h=0,k=b.length=0;k<e;k++){var m=Math.pow(1-h,2)*a.x+2*(1-h)*h*c.x+h*h*d.x,A=Math.pow(1-h,2)*a.y+2*(1-h)*h*c.y+h*h*d.y;b.push(m,A);h+=1/e}b.push(d.x,d.y);this._drawSegments(b,f,g,!1);b.length=0},drawCubicBezier:function(a,c,d,e,f,g,h){g=g||this._lineWidth;h=h||
this._drawColor;for(var k=0,m=b.length=0;m<f;m++){var A=Math.pow(1-k,3)*a.x+3*Math.pow(1-k,2)*k*c.x+3*(1-k)*k*k*d.x+k*k*k*e.x,y=Math.pow(1-k,3)*a.y+3*Math.pow(1-k,2)*k*c.y+3*(1-k)*k*k*d.y+k*k*k*e.y;b.push(A,y);k+=1/f}b.push(e.x,e.y);this._drawSegments(b,g,h,!1);b.length=0},drawCatmullRom:function(a,b,c,d){this.drawCardinalSpline(a,0.5,b,c,d)},drawCardinalSpline:function(a,e,f,g,h){g=g||this._lineWidth;h=h||this._drawColor;for(var k,m,v=1/a.length,x=b.length=0;x<f+1;x++)m=x/f,1===m?(k=a.length-1,m=
1):(k=0|m/v,m=(m-v*k)/v),cc.cardinalSplineAt(cc.getControlPointAt(a,k-1),cc.getControlPointAt(a,k-0),cc.getControlPointAt(a,k+1),cc.getControlPointAt(a,k+2),e,m,c),b.push(c.x,c.y);g*=0.5;a=0;for(e=b.length-2;a<e;a+=2)c.x=b[a],c.y=b[a+1],d.x=b[a+2],d.y=b[a+3],this.drawSegment(c,d,g,h);b.length=0},drawDots:function(a,b,c){if(a&&0!==a.length){c=c||this._drawColor;for(var d=0,e=a.length;d<e;d++)this.drawDot(a[d],b,c)}},_render:function(){var b=cc._renderContext;0>this._offset||0>=this._vertexCount||(this._dirty?
(a.updateSubData(this._offset,this._f32Buffer),this._dirty=!1):b.bindBuffer(b.ARRAY_BUFFER,a.vertexBuffer),b.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION),b.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR),b.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS),b.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,2,b.FLOAT,!1,20,0),b.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,b.UNSIGNED_BYTE,!0,20,8),b.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,b.FLOAT,!1,20,12),b.drawArrays(b.TRIANGLES,this._offset/
20,this._vertexCount),cc.incrementGLDraws(1))},appendVertexData:function(a,b,c,d,f){var g=this._f32Buffer,h=5*this._vertexCount;g[h]=a;g[h+1]=b;e[0]=c.a<<24|c.b<<16|c.g<<8|c.r;this._ui32Buffer[h+2]=e[0];g[h+3]=d;g[h+4]=f;this._vertexCount++},drawDot:function(a,b,c){c=c||this._drawColor;null==c.a&&(c.a=255);var d=a.x-b,e=a.y-b,f=a.x+b;a=a.y+b;this._ensureCapacity(this._vertexCount+6)&&(this.appendVertexData(d,e,c,-1,-1),this.appendVertexData(d,a,c,-1,1),this.appendVertexData(f,a,c,1,1),this.appendVertexData(d,
e,c,-1,-1),this.appendVertexData(f,a,c,1,1),this.appendVertexData(f,e,c,1,-1),this._dirty=!0)},drawSegment:function(a,b,c,d){d=d||this.getDrawColor();null==d.a&&(d.a=255);c=c||0.5*this._lineWidth;if(this._ensureCapacity(this._vertexCount+18)){f.x=a.y-b.y;f.y=b.x-a.x;cc.pNormalizeIn(f);g.x=-f.y;g.y=f.x;var e=c;h.x=f.x*e;h.y=f.y*e;k.x=g.x*c;k.y=g.y*c;c=b.x+h.x-k.x;var e=b.y+h.y-k.y,m=f.x-g.x,w=f.y-g.y,v=b.x-h.x,x=b.y-h.y,A=-f.x,y=-f.y,z=b.x+h.x,B=b.y+h.y,D=f.x,C=f.y,G=a.x-h.x,F=a.y-h.y,E=a.x+h.x,J=
a.y+h.y,K=f.x,I=f.y,M=a.x-h.x+k.x,H=a.y-h.y+k.y,L=g.x-f.x,N=g.y-f.y,Q=a.x+h.x+k.x;a=a.y+h.y+k.y;var P=f.x+g.x,O=f.y+g.y;this.appendVertexData(b.x-h.x-k.x,b.y-h.y-k.y,d,-(f.x+g.x),-(f.y+g.y));this.appendVertexData(c,e,d,m,w);this.appendVertexData(v,x,d,A,y);this.appendVertexData(z,B,d,D,C);this.appendVertexData(c,e,d,m,w);this.appendVertexData(v,x,d,A,y);this.appendVertexData(z,B,d,D,C);this.appendVertexData(G,F,d,A,y);this.appendVertexData(v,x,d,A,y);this.appendVertexData(z,B,d,D,C);this.appendVertexData(G,
F,d,A,y);this.appendVertexData(E,J,d,K,I);this.appendVertexData(M,H,d,L,N);this.appendVertexData(G,F,d,A,y);this.appendVertexData(E,J,d,K,I);this.appendVertexData(M,H,d,L,N);this.appendVertexData(Q,a,d,P,O);this.appendVertexData(E,J,d,K,I);this._dirty=!0}},drawPoly:function(a,c,d,e){if("object"===typeof a[0]){for(var g=b.length=0;g<a.length;g++)b.push(a[g].x,a[g].y);a=b}if(null==c)this._drawSegments(a,d,e,!0);else{null==c.a&&(c.a=255);null==e.a&&(e.a=255);d=null==d?this._lineWidth:d;d*=0.5;for(var k,
w,v,x,A,y,z,B=a.length,g=m.length=0;g<B;g+=2)k=a[(g-2+B)%B],w=a[(g-1+B)%B],v=a[g],x=a[g+1],A=a[(g+2)%B],y=a[(g+3)%B],f.x=w-x,f.y=v-k,h.x=x-y,h.y=A-v,cc.pNormalizeIn(f),cc.pNormalizeIn(h),x=f.x*h.x+f.y*h.y+1,z=(f.x+h.x)/x,x=(f.y+h.y)/x,m.push(z,x,h.x,h.y);B/=2;z=0<d;if(this._ensureCapacity(this._vertexCount+3*(3*B-2))){for(var D=!1==z?0.5:0,g=0;g<B-2;g++)k=a[0]-m[0]*D,w=a[1]-m[1]*D,v=a[2*g+2]-m[4*(g+1)]*D,x=a[2*g+3]-m[4*(g+1)+1]*D,A=a[2*g+4]-m[4*(g+2)]*D,y=a[2*g+5]-m[4*(g+2)+1]*D,this.appendVertexData(k,
w,c,0,0),this.appendVertexData(v,x,c,0,0),this.appendVertexData(A,y,c,0,0);var C,G,F,E;d=z?d:0.5;c=z?e:c;for(g=0;g<B;g++)e=(g+1)%B,k=a[2*g],w=a[2*g+1],v=a[2*e],x=a[2*e+1],f.x=m[4*g+2],f.y=m[4*g+3],h.x=z?-f.x:0,h.y=z?-f.y:0,C=m[4*g],G=m[4*g+1],F=m[4*e],E=m[4*e+1],e=k-C*d,A=w-G*d,y=v-F*d,D=x-E*d,k+=C*d,w+=G*d,v+=F*d,x+=E*d,this.appendVertexData(e,A,c,h.x,h.y),this.appendVertexData(y,D,c,h.x,h.y),this.appendVertexData(v,x,c,f.x,f.y),this.appendVertexData(e,A,c,h.x,h.y),this.appendVertexData(k,w,c,f.x,
f.y),this.appendVertexData(v,x,c,f.x,f.y);m.length=0;b.length=0;this._dirty=!0}}},_drawSegments:function(a,b,c,d){b=null==b?this._lineWidth:b;if(!(0>=b)){c=c||this._drawColor;null==c.a&&(c.a=255);b*=0.5;var e,g,k,v,x,A,y,z=a.length;for(y=m.length=0;y<z;y+=2)e=a[(y-2+z)%z],g=a[(y-1+z)%z],k=a[y],v=a[y+1],x=a[(y+2)%z],A=a[(y+3)%z],f.x=g-v,f.y=k-e,h.x=v-A,h.y=x-k,cc.pNormalizeIn(f),cc.pNormalizeIn(h),k=f.x*h.x+f.y*h.y+1,v=(f.x+h.x)/k,k=(f.y+h.y)/k,m.push(v,k,h.x,h.y);z/=2;if(this._ensureCapacity(this._vertexCount+
3*(3*z-2))){d=d?z:z-1;var B,D,C,G,F,E;for(y=0;y<d;y++)x=(y+1)%z,e=a[2*y],g=a[2*y+1],k=a[2*x],v=a[2*x+1],f.x=m[4*y+2],f.y=m[4*y+3],B=m[4*y],D=m[4*y+1],C=m[4*x],G=m[4*x+1],x=e-B*b,A=g-D*b,F=k-C*b,E=v-G*b,e+=B*b,g+=D*b,k+=C*b,v+=G*b,this.appendVertexData(x,A,c,-f.x,-f.y),this.appendVertexData(F,E,c,-f.x,-f.y),this.appendVertexData(k,v,c,f.x,f.y),this.appendVertexData(x,A,c,-f.x,-f.y),this.appendVertexData(e,g,c,f.x,f.y),this.appendVertexData(k,v,c,f.x,f.y);m.length=0;this._dirty=!0}}},clear:function(){this.release();
this._dirty=!0},_createRenderCmd:function(){return new cc.DrawNode.WebGLRenderCmd(this)}})}});(function(){cc.DrawNode.CanvasRenderCmd=function(a){this._rootCtor(a);this._needDraw=!0;this._blendFunc=this._drawColor=this._buffer=null};cc.DrawNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);cc.DrawNode.CanvasRenderCmd.prototype.constructor=cc.DrawNode.CanvasRenderCmd;cc.DrawNode.CanvasRenderCmd.prototype.getLocalBB=function(){return this._node._localBB};cc.extend(cc.DrawNode.CanvasRenderCmd.prototype,{rendering:function(a,b,c){a=a||cc._renderContext;a.getContext();
var d=this._displayedOpacity/255;if(0!==d){a.setTransform(this._worldTransform,b,c);a.setGlobalAlpha(d);this._blendFunc&&this._blendFunc.src===cc.SRC_ALPHA&&this._blendFunc.dst===cc.ONE&&a.setCompositeOperation("lighter");for(var d=this._buffer,e=0,f=d.length;e<f;e++){var g=d[e];switch(g.type){case cc.DrawNode.TYPE_DOT:this._drawDot(a,g,b,c);break;case cc.DrawNode.TYPE_SEGMENT:this._drawSegment(a,g,b,c);break;case cc.DrawNode.TYPE_POLY:this._drawPoly(a,g,b,c)}}}},_drawDot:function(a,b){var c=b.fillColor,
d=b.verts[0],e=b.lineWidth,f=a.getContext();a.setFillStyle("rgba("+(0|c.r)+","+(0|c.g)+","+(0|c.b)+","+c.a/255+")");f.beginPath();f.arc(d.x,-d.y,e,0,2*Math.PI,!1);f.closePath();f.fill()},_drawSegment:function(a,b,c){var d=b.lineColor,e=b.verts[0],f=b.verts[1],g=b.lineWidth;b=b.lineCap;var h=a.getContext();a.setStrokeStyle("rgba("+(0|d.r)+","+(0|d.g)+","+(0|d.b)+","+d.a/255+")");h.lineWidth=g*c;h.beginPath();h.lineCap=b;h.moveTo(e.x,-e.y);h.lineTo(f.x,-f.y);h.stroke()},_drawPoly:function(a,b,c){var d=
b.verts,e=b.lineCap;if(null!=d){var f=b.fillColor,g=b.lineWidth,h=b.lineColor,k=b.isClosePolygon,m=b.isFill;b=b.isStroke;var n=a.getContext(),p=d[0];n.lineCap=e;f&&a.setFillStyle("rgba("+(0|f.r)+","+(0|f.g)+","+(0|f.b)+","+f.a/255+")");g&&(n.lineWidth=g*c);h&&a.setStrokeStyle("rgba("+(0|h.r)+","+(0|h.g)+","+(0|h.b)+","+h.a/255+")");n.beginPath();n.moveTo(p.x,-p.y);a=1;for(c=d.length;a<c;a++)n.lineTo(d[a].x,-d[a].y);k&&n.closePath();m&&n.fill();b&&n.stroke()}}})})();(function(){cc.DrawNode.WebGLRenderCmd=function(a){this._rootCtor(a);this._needDraw=!0;this._matrix=new cc.math.Matrix4;this._matrix.identity()};cc.DrawNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.DrawNode.WebGLRenderCmd.prototype.constructor=cc.DrawNode.WebGLRenderCmd;cc.DrawNode.WebGLRenderCmd.prototype.rendering=function(a){a=this._node;if(0<a._vertexCount){var b=this._worldTransform;this._matrix.mat[0]=b.a;this._matrix.mat[4]=b.c;this._matrix.mat[12]=b.tx;this._matrix.mat[1]=
b.b;this._matrix.mat[5]=b.d;this._matrix.mat[13]=b.ty;cc.glBlendFunc(a._blendFunc.src,a._blendFunc.dst);this._glProgramState.apply(this._matrix);a._render()}}})();cc.stencilBits=-1;
cc.ClippingNode=cc.Node.extend({inverted:!1,_alphaThreshold:0,_stencil:null,_className:"ClippingNode",_originStencilProgram:null,ctor:function(a){a=a||null;cc.Node.prototype.ctor.call(this);if(this._stencil=a)this._originStencilProgram=a.getShaderProgram();this.alphaThreshold=1;this.inverted=!1;this._renderCmd.initStencilBits()},onEnter:function(){cc.Node.prototype.onEnter.call(this);this._stencil&&this._stencil._performRecursive(cc.Node._stateCallbackType.onEnter)},onEnterTransitionDidFinish:function(){cc.Node.prototype.onEnterTransitionDidFinish.call(this);this._stencil&&
this._stencil._performRecursive(cc.Node._stateCallbackType.onEnterTransitionDidFinish)},onExitTransitionDidStart:function(){this._stencil._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart);cc.Node.prototype.onExitTransitionDidStart.call(this)},onExit:function(){this._stencil._performRecursive(cc.Node._stateCallbackType.onExit);cc.Node.prototype.onExit.call(this)},visit:function(a){this._renderCmd.clippingVisit(a&&a._renderCmd)},_visitChildren:function(){this._reorderChildDirty&&
this.sortAllChildren();for(var a=this._children,b,c=0,d=a.length;c<d;c++)(b=a[c])&&b._visible&&b.visit(this);this._renderCmd._dirtyFlag=0},getAlphaThreshold:function(){return this._alphaThreshold},setAlphaThreshold:function(a){1===a&&a!==this._alphaThreshold&&this._renderCmd.resetProgramByStencil();this._alphaThreshold=a},isInverted:function(){return this.inverted},setInverted:function(a){this.inverted=a},getStencil:function(){return this._stencil},setStencil:function(a){this._stencil!==a&&(a&&(this._originStencilProgram=
a.getShaderProgram()),this._renderCmd.setStencil(a))},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ClippingNode.CanvasRenderCmd(this):new cc.ClippingNode.WebGLRenderCmd(this)}});_p=cc.ClippingNode.prototype;cc.defineGetterSetter(_p,"stencil",_p.getStencil,_p.setStencil);cc.defineGetterSetter(_p,"alphaThreshold",_p.getAlphaThreshold,_p.setAlphaThreshold);cc.ClippingNode.create=function(a){return new cc.ClippingNode(a)};(function(){cc.ClippingNode.CanvasRenderCmd=function(a){this._rootCtor(a);this._clipElemType=this._godhelpme=this._needDraw=!1;this._rendererSaveCmd=new cc.CustomRenderCmd(this,this._saveCmdCallback);this._rendererClipCmd=new cc.CustomRenderCmd(this,this._clipCmdCallback);this._rendererRestoreCmd=new cc.CustomRenderCmd(this,this._restoreCmdCallback)};var a=cc.ClippingNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);a.constructor=cc.ClippingNode.CanvasRenderCmd;a.resetProgramByStencil=
function(){};a.initStencilBits=function(){};a.setStencil=function(a){if(null!=a)if(this._node._stencil=a,a instanceof cc.DrawNode){if(a._buffer)for(var c=0;c<a._buffer.length;c++)a._buffer[c].isFill=!1,a._buffer[c].isStroke=!1;a._renderCmd.rendering=function(a,b,c){};a._renderCmd._canUseDirtyRegion=!0;this._rendererSaveCmd._canUseDirtyRegion=!0;this._rendererClipCmd._canUseDirtyRegion=!0;this._rendererRestoreCmd._canUseDirtyRegion=!0}else a._parent=this._node};a._saveCmdCallback=function(a,c,d){var e=
a||cc._renderContext;a=e.getContext();this._clipElemType?(c=cc.ClippingNode.CanvasRenderCmd._getSharedCache(),d=a.canvas,c.width=d.width,c.height=d.height,c.getContext("2d").drawImage(d,0,0)):(e.save(),e.setTransform(this._worldTransform,c,d),this._node.inverted&&(a.beginPath(),a.rect(0,0,a.canvas.width,-a.canvas.height),a.clip()))};a._setStencilCompositionOperation=function(a){if(a){var c=this._node;a._renderCmd&&a._renderCmd._blendFuncStr&&(a._renderCmd._blendFuncStr=c.inverted?"destination-out":
"destination-in");if(a._children){a=a._children;for(var c=0,d=a.length;c<d;c++)this._setStencilCompositionOperation(a[c])}}};a._clipCmdCallback=function(a){var c=this._node;a=(a||cc._renderContext).getContext();if(this._clipElemType)this._setStencilCompositionOperation(c._stencil);else{c=this._node._stencil;if(c instanceof cc.DrawNode){a.beginPath();var d=c._renderCmd._transform;a.transform(d.a,d.b,d.c,d.d,d.tx,-d.ty);for(d=0;d<c._buffer.length;d++){var e=c._buffer[d].verts,f=e[0];a.moveTo(f.x,-f.y);
for(f=e.length-1;0<f;f--)a.lineTo(e[f].x,-e[f].y)}}a.clip()}};a._restoreCmdCallback=function(a){var c=cc.ClippingNode.CanvasRenderCmd._getSharedCache();a=a||cc._renderContext;var d=a.getContext();this._clipElemType?(d.save(),d.setTransform(1,0,0,1,0,0),d.globalCompositeOperation="destination-over",d.drawImage(c,0,0),d.restore(),this._dirtyFlag=0):a.restore()};a.transform=function(a,c){this.originTransform(a,c);var d=this._node;d._stencil&&d._stencil._renderCmd&&(d._stencil._renderCmd.transform(this,
!0),d._stencil._dirtyFlag&=~cc.Node._dirtyFlags.transformDirty)};a._cangodhelpme=function(a){if(!0===a||!1===a)cc.ClippingNode.CanvasRenderCmd.prototype._godhelpme=a;return cc.ClippingNode.CanvasRenderCmd.prototype._godhelpme};a.clippingVisit=function(a){var c=this._node;a=a||this.getParentRenderCmd();this.visit(a);this._clipElemType=!(!this._cangodhelpme()&&c._stencil instanceof cc.DrawNode);if(c._stencil&&c._stencil.visible){cc.renderer.pushRenderCommand(this._rendererSaveCmd);this._clipElemType?
c._visitChildren():c._stencil.visit(c);cc.renderer.pushRenderCommand(this._rendererClipCmd);if(this._clipElemType)c._stencil.visit(c);else{this._cangodhelpme(!0);a=c._children;var d,e=a.length;if(0<e)for(c.sortAllChildren(),d=0;d<e;d++)a[d].visit(c);this._cangodhelpme(!1)}cc.renderer.pushRenderCommand(this._rendererRestoreCmd);this._dirtyFlag=0}else this.inverted&&c._visitChildren()};cc.ClippingNode.CanvasRenderCmd._sharedCache=null;cc.ClippingNode.CanvasRenderCmd._getSharedCache=function(){return cc.ClippingNode.CanvasRenderCmd._sharedCache||
(cc.ClippingNode.CanvasRenderCmd._sharedCache=document.createElement("canvas"))}})();function setProgram(a,b){a.shaderProgram=b;var c=a.children;if(c)for(var d=0;d<c.length;d++)setProgram(c[d],b)}
(function(){cc.ClippingNode.WebGLRenderCmd=function(a){this._rootCtor(a);this._needDraw=!1;this._beforeVisitCmd=new cc.CustomRenderCmd(this,this._onBeforeVisit);this._afterDrawStencilCmd=new cc.CustomRenderCmd(this,this._onAfterDrawStencil);this._afterVisitCmd=new cc.CustomRenderCmd(this,this._onAfterVisit);this._mask_layer_le=this._currentStencilEnabled=null};var a=cc.ClippingNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);a.constructor=cc.ClippingNode.WebGLRenderCmd;
cc.ClippingNode.WebGLRenderCmd._init_once=null;cc.ClippingNode.WebGLRenderCmd._visit_once=null;cc.ClippingNode.WebGLRenderCmd._layer=-1;a.initStencilBits=function(){cc.ClippingNode.WebGLRenderCmd._init_once=!0;cc.ClippingNode.WebGLRenderCmd._init_once&&(cc.stencilBits=cc._renderContext.getParameter(cc._renderContext.STENCIL_BITS),0>=cc.stencilBits&&cc.log("Stencil buffer is not enabled."),cc.ClippingNode.WebGLRenderCmd._init_once=!1)};a.transform=function(a,c){var d=this._node;this.originTransform(a,
c);d._stencil&&(d._stencil._renderCmd.transform(this,!0),d._stencil._dirtyFlag&=~cc.Node._dirtyFlags.transformDirty)};a.clippingVisit=function(a){var c=this._node;a=a||this.getParentRenderCmd();this.visit(a);if(1>cc.stencilBits)c._visitChildren();else if(c._stencil&&c._stencil.visible)if(cc.ClippingNode.WebGLRenderCmd._layer+1===cc.stencilBits)cc.ClippingNode.WebGLRenderCmd._visit_once=!0,cc.ClippingNode.WebGLRenderCmd._visit_once&&(cc.log("Nesting more than "+cc.stencilBits+"stencils is not supported. Everything will be drawn without stencil for this node and its children."),
cc.ClippingNode.WebGLRenderCmd._visit_once=!1),c._visitChildren();else{cc.renderer.pushRenderCommand(this._beforeVisitCmd);c._stencil.visit(c);cc.renderer.pushRenderCommand(this._afterDrawStencilCmd);if((a=c._children)&&0<a.length){var d=a.length;c.sortAllChildren();for(var e=0;e<d;e++)a[e].visit(c)}cc.renderer.pushRenderCommand(this._afterVisitCmd);this._dirtyFlag=0}else c.inverted&&c._visitChildren()};a.setStencil=function(a){var c=this._node;c._stencil&&(c._stencil._parent=null);c._stencil=a;c._stencil&&
(c._stencil._parent=c)};a.resetProgramByStencil=function(){var a=this._node;a._stencil&&setProgram(a._stencil,a._originStencilProgram)};a._onBeforeVisit=function(a){var c=a||cc._renderContext;a=this._node;cc.ClippingNode.WebGLRenderCmd._layer++;var d=1<<cc.ClippingNode.WebGLRenderCmd._layer;this._mask_layer_le=d|d-1;this._currentStencilEnabled=c.isEnabled(c.STENCIL_TEST);c.clear(c.DEPTH_BUFFER_BIT);c.enable(c.STENCIL_TEST);c.depthMask(!1);c.stencilFunc(c.NEVER,d,d);c.stencilOp(c.REPLACE,c.KEEP,c.KEEP);
c.stencilMask(d);c.clear(c.STENCIL_BUFFER_BIT);1>a.alphaThreshold&&(c=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLORALPHATEST),cc.glUseProgram(c.getProgram()),c.setUniformLocationWith1f(cc.UNIFORM_ALPHA_TEST_VALUE_S,a.alphaThreshold),c.setUniformLocationWithMatrix4fv(cc.UNIFORM_MVMATRIX_S,cc.renderer.mat4Identity.mat),cc.setProgram(a._stencil,c))};a._onAfterDrawStencil=function(a){a=a||cc._renderContext;a.depthMask(!0);a.stencilFunc(this._node.inverted?a.NOTEQUAL:a.EQUAL,this._mask_layer_le,
this._mask_layer_le);a.stencilOp(a.KEEP,a.KEEP,a.KEEP)};a._onAfterVisit=function(a){a=a||cc._renderContext;cc.ClippingNode.WebGLRenderCmd._layer--;if(this._currentStencilEnabled){var c=1<<cc.ClippingNode.WebGLRenderCmd._layer,d=c|c-1;a.stencilMask(c);a.stencilFunc(a.EQUAL,d,d)}else a.disable(a.STENCIL_TEST)}})();cc.GridBase=cc.Class.extend({_active:!1,_reuseGrid:0,_gridSize:null,_gridRect:null,_texture:null,_step:null,_grabber:null,_isTextureFlipped:!1,_glProgramState:null,_directorProjection:0,_dirty:!1,ctor:function(a,b,c,d){cc.sys._checkWebGLRenderMode();this._active=!1;this._reuseGrid=0;this._gridSize=null;this._gridRect=new cc.rect;this._texture=null;this._step=cc.p(0,0);this._grabber=null;this._isTextureFlipped=!1;this._glProgramState=null;this._directorProjection=0;this._dirty=!1;void 0!==a&&this.initWithSize(a,
b,c,d)},isActive:function(){return this._active},setActive:function(a){this._active=a;if(!a){a=cc.director;var b=a.getProjection();a.setProjection(b)}},getReuseGrid:function(){return this._reuseGrid},setReuseGrid:function(a){this._reuseGrid=a},getGridSize:function(){return cc.size(this._gridSize.width,this._gridSize.height)},setGridSize:function(a){this._gridSize.width=parseInt(a.width);this._gridSize.height=parseInt(a.height)},setGridRect:function(a){this._gridRect=a},getGridRect:function(){return this._gridRect},
getStep:function(){return cc.p(this._step.x,this._step.y)},setStep:function(a){this._step.x=a.x;this._step.y=a.y},isTextureFlipped:function(){return this._isTextureFlipped},setTextureFlipped:function(a){this._isTextureFlipped!==a&&(this._isTextureFlipped=a,this.calculateVertexPoints())},initWithSize:function(a,b,c,d){if(!b){var e=cc.director.getWinSizeInPixels(),f=cc.NextPOT(e.width),g=cc.NextPOT(e.height),h=new Uint8Array(f*g*4);if(!h)return cc.log("cocos2d: CCGrid: not enough memory."),!1;b=new cc.Texture2D;
b.initWithData(h,cc.Texture2D.PIXEL_FORMAT_RGBA8888,f,g,e);if(!b)return cc.log("cocos2d: CCGrid: error creating texture"),!1}this._active=!1;this._reuseGrid=0;this._gridSize=a;this._texture=b;this._isTextureFlipped=c||!1;if(void 0===d||cc._rectEqualToZero(d))b=this._texture.getContentSize(),d=new cc.rect(0,0,b.width,b.height);this._gridRect=d;this._step.x=this._gridRect.width/a.width;this._step.y=this._gridRect.height/a.height;this._grabber=new cc.Grabber;if(!this._grabber)return!1;this._grabber.grab(this._texture);
this._glProgramState=cc.GLProgramState.getOrCreateWithGLProgram(cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURE));this.calculateVertexPoints();return!0},beforeDraw:function(){this._directorProjection=cc.director.getProjection();var a=cc.director.getWinSizeInPixels();gl.viewport(0,0,a.width,a.height);this._grabber.beforeRender(this._texture)},afterDraw:function(a){this._grabber.afterRender(this._texture);cc.director.setViewport();cc.glBindTexture2D(this._texture);this.beforeBlit();this.blit(a);
this.afterBlit()},beforeBlit:function(){},afterBlit:function(){},blit:function(){cc.log("cc.GridBase.blit(): Shall be overridden in subclass.")},reuse:function(){cc.log("cc.GridBase.reuse(): Shall be overridden in subclass.")},calculateVertexPoints:function(){cc.log("cc.GridBase.calculateVertexPoints(): Shall be overridden in subclass.")},set2DProjection:function(){var a=cc.director.getWinSizeInPixels();cc._renderContext.viewport(0,0,a.width,a.height);cc.kmGLMatrixMode(cc.KM_GL_PROJECTION);cc.kmGLLoadIdentity();
a=cc.math.Matrix4.createOrthographicProjection(0,a.width,0,a.height,-1,1);cc.kmGLMultMatrix(a);cc.kmGLMatrixMode(cc.KM_GL_MODELVIEW);cc.kmGLLoadIdentity();cc.setProjectionMatrixDirty()}});cc.GridBase.create=function(a,b,c,d){return new cc.GridBase(a,b,c,d)};
cc.Grid3D=cc.GridBase.extend({_texCoordinates:null,_vertices:null,_originalVertices:null,_indices:null,_texCoordinateBuffer:null,_verticesBuffer:null,_indicesBuffer:null,_needDepthTestForBlit:!1,_oldDepthTestValue:!1,_oldDepthWriteValue:!1,ctor:function(a,b,c,d){cc.GridBase.prototype.ctor.call(this);this._indicesBuffer=this._verticesBuffer=this._texCoordinateBuffer=this._indices=this._originalVertices=this._vertices=this._texCoordinates=null;this._matrix=new cc.math.Matrix4;this._matrix.identity();
void 0!==a&&this.initWithSize(a,b,c,d)},vertex:function(a){return this.getVertex(a)},getVertex:function(a){a.x===(0|a.x)&&a.y===(0|a.y)||cc.log("cc.Grid3D.vertex() : Numbers must be integers");a=0|3*(a.x*(this._gridSize.height+1)+a.y);var b=this._vertices;return new cc.Vertex3F(b[a],b[a+1],b[a+2])},originalVertex:function(a){return this.getOriginalVertex(a)},getOriginalVertex:function(a){a.x===(0|a.x)&&a.y===(0|a.y)||cc.log("cc.Grid3D.originalVertex() : Numbers must be integers");a=0|3*(a.x*(this._gridSize.height+
1)+a.y);var b=this._originalVertices;return new cc.Vertex3F(b[a],b[a+1],b[a+2])},setVertex:function(a,b){a.x===(0|a.x)&&a.y===(0|a.y)||cc.log("cc.Grid3D.setVertex() : Numbers must be integers");var c=0|3*(a.x*(this._gridSize.height+1)+a.y),d=this._vertices;d[c]=b.x;d[c+1]=b.y;d[c+2]=b.z;this._dirty=!0},beforeBlit:function(){if(this._needDepthTestForBlit){var a=cc._renderContext;this._oldDepthTestValue=a.isEnabled(a.DEPTH_TEST);this._oldDepthWriteValue=a.getParameter(a.DEPTH_WRITEMASK);a.enable(a.DEPTH_TEST);
a.depthMask(!0)}},afterBlit:function(){if(this._needDepthTestForBlit){var a=cc._renderContext;this._oldDepthTestValue?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST);a.depthMask(this._oldDepthWriteValue)}},blit:function(a){var b=this._gridSize.width*this._gridSize.height;a=a._renderCmd._worldTransform;this._matrix.mat[0]=a.a;this._matrix.mat[4]=a.c;this._matrix.mat[12]=a.tx;this._matrix.mat[1]=a.b;this._matrix.mat[5]=a.d;this._matrix.mat[13]=a.ty;this._glProgramState.apply(this._matrix);a=cc._renderContext;
var c=this._dirty;a.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);a.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS);a.bindBuffer(a.ARRAY_BUFFER,this._verticesBuffer);c&&a.bufferData(a.ARRAY_BUFFER,this._vertices,a.DYNAMIC_DRAW);a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,a.FLOAT,!1,0,0);a.bindBuffer(a.ARRAY_BUFFER,this._texCoordinateBuffer);c&&a.bufferData(a.ARRAY_BUFFER,this._texCoordinates,a.DYNAMIC_DRAW);a.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,a.FLOAT,!1,0,0);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,
this._indicesBuffer);c&&a.bufferData(a.ELEMENT_ARRAY_BUFFER,this._indices,a.STATIC_DRAW);a.drawElements(a.TRIANGLES,6*b,a.UNSIGNED_SHORT,0);c&&(this._dirty=!1);cc.incrementGLDraws(1)},reuse:function(){if(0<this._reuseGrid){for(var a=this._originalVertices,b=this._vertices,c=0,d=this._vertices.length;c<d;c++)a[c]=b[c];--this._reuseGrid}},calculateVertexPoints:function(){var a=cc._renderContext,b=this._texture.pixelsWidth,c=this._texture.pixelsHeight,d=this._texture.getContentSizeInPixels().height,
e=this._gridSize,f=(e.width+1)*(e.height+1);this._vertices=new Float32Array(3*f);this._texCoordinates=new Float32Array(2*f);this._indices=new Uint16Array(e.width*e.height*6);this._verticesBuffer&&a.deleteBuffer(this._verticesBuffer);this._verticesBuffer=a.createBuffer();this._texCoordinateBuffer&&a.deleteBuffer(this._texCoordinateBuffer);this._texCoordinateBuffer=a.createBuffer();this._indicesBuffer&&a.deleteBuffer(this._indicesBuffer);this._indicesBuffer=a.createBuffer();for(var g,h,k=this._indices,
m=this._texCoordinates,n=this._isTextureFlipped,p=this._vertices,f=0;f<e.width;++f)for(g=0;g<e.height;++g){var r=g*e.width+f;h=f*this._step.x+this._gridRect.x;var s=h+this._step.x,u=g*this._step.y+this._gridRect.y,t=u+this._step.y,w=f*(e.height+1)+g,v=(f+1)*(e.height+1)+g,x=(f+1)*(e.height+1)+(g+1),A=f*(e.height+1)+(g+1);k[6*r]=w;k[6*r+1]=v;k[6*r+2]=A;k[6*r+3]=v;k[6*r+4]=x;k[6*r+5]=A;var r=[3*w,3*v,3*x,3*A],y=[{x:h,y:u,z:0},{x:s,y:u,z:0},{x:s,y:t,z:0},{x:h,y:t,z:0}],w=[2*w,2*v,2*x,2*A],s=[cc.p(h,
u),cc.p(s,u),cc.p(s,t),cc.p(h,t)];for(h=0;4>h;++h)p[r[h]]=y[h].x,p[r[h]+1]=y[h].y,p[r[h]+2]=y[h].z,m[w[h]]=s[h].x/b,m[w[h]+1]=n?(d-s[h].y)/c:s[h].y/c}this._originalVertices=new Float32Array(this._vertices);a.bindBuffer(a.ARRAY_BUFFER,this._verticesBuffer);a.bufferData(a.ARRAY_BUFFER,this._vertices,a.DYNAMIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this._texCoordinateBuffer);a.bufferData(a.ARRAY_BUFFER,this._texCoordinates,a.DYNAMIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._indicesBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,
this._indices,a.STATIC_DRAW);this._dirty=!0},setNeedDepthTestForBlit:function(a){this._needDepthTestForBlit=a},getNeedDepthTestForBlit:function(){return this._needDepthTestForBlit}});cc.Grid3D.create=function(a,b,c){return new cc.Grid3D(a,b,c)};
cc.TiledGrid3D=cc.GridBase.extend({_texCoordinates:null,_vertices:null,_originalVertices:null,_indices:null,_texCoordinateBuffer:null,_verticesBuffer:null,_indicesBuffer:null,ctor:function(a,b,c,d){cc.GridBase.prototype.ctor.call(this);this._indicesBuffer=this._verticesBuffer=this._texCoordinateBuffer=this._indices=this._originalVertices=this._vertices=this._texCoordinates=null;this._matrix=new cc.math.Matrix4;this._matrix.identity();void 0!==a&&this.initWithSize(a,b,c,d)},tile:function(a){return this.getTile(a)},
getTile:function(a){a.x===(0|a.x)&&a.y===(0|a.y)||cc.log("cc.TiledGrid3D.tile() : Numbers must be integers");a=12*(this._gridSize.height*a.x+a.y);var b=this._vertices;return new cc.Quad3(new cc.Vertex3F(b[a],b[a+1],b[a+2]),new cc.Vertex3F(b[a+3],b[a+4],b[a+5]),new cc.Vertex3F(b[a+6],b[a+7],b[a+8]),new cc.Vertex3F(b[a+9],b[a+10],b[a+11]))},getOriginalTile:function(a){a.x===(0|a.x)&&a.y===(0|a.y)||cc.log("cc.TiledGrid3D.originalTile() : Numbers must be integers");a=12*(this._gridSize.height*a.x+a.y);
var b=this._originalVertices;return new cc.Quad3(new cc.Vertex3F(b[a],b[a+1],b[a+2]),new cc.Vertex3F(b[a+3],b[a+4],b[a+5]),new cc.Vertex3F(b[a+6],b[a+7],b[a+8]),new cc.Vertex3F(b[a+9],b[a+10],b[a+11]))},originalTile:function(a){return this.getOriginalTile(a)},setTile:function(a,b){a.x===(0|a.x)&&a.y===(0|a.y)||cc.log("cc.TiledGrid3D.setTile() : Numbers must be integers");var c=12*(this._gridSize.height*a.x+a.y),d=this._vertices;d[c]=b.bl.x;d[c+1]=b.bl.y;d[c+2]=b.bl.z;d[c+3]=b.br.x;d[c+4]=b.br.y;d[c+
5]=b.br.z;d[c+6]=b.tl.x;d[c+7]=b.tl.y;d[c+8]=b.tl.z;d[c+9]=b.tr.x;d[c+10]=b.tr.y;d[c+11]=b.tr.z;this._dirty=!0},blit:function(a){var b=this._gridSize.width*this._gridSize.height;a=a._renderCmd._worldTransform;this._matrix.mat[0]=a.a;this._matrix.mat[4]=a.c;this._matrix.mat[12]=a.tx;this._matrix.mat[1]=a.b;this._matrix.mat[5]=a.d;this._matrix.mat[13]=a.ty;this._glProgramState.apply(this._matrix);a=cc._renderContext;var c=this._dirty;a.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);a.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS);
a.bindBuffer(a.ARRAY_BUFFER,this._verticesBuffer);c&&a.bufferData(a.ARRAY_BUFFER,this._vertices,a.DYNAMIC_DRAW);a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,a.FLOAT,!1,0,this._vertices);a.bindBuffer(a.ARRAY_BUFFER,this._texCoordinateBuffer);c&&a.bufferData(a.ARRAY_BUFFER,this._texCoordinates,a.DYNAMIC_DRAW);a.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,a.FLOAT,!1,0,this._texCoordinates);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._indicesBuffer);c&&a.bufferData(a.ELEMENT_ARRAY_BUFFER,this._indices,
a.STATIC_DRAW);a.drawElements(a.TRIANGLES,6*b,a.UNSIGNED_SHORT,0);c&&(this._dirty=!1);cc.incrementGLDraws(1)},reuse:function(){if(0<this._reuseGrid){for(var a=this._vertices,b=this._originalVertices,c=0;c<a.length;c++)b[c]=a[c];--this._reuseGrid}},calculateVertexPoints:function(){var a=this._texture.pixelsWidth,b=this._texture.pixelsHeight,c=this._texture.getContentSizeInPixels().height,d=this._gridSize,e=d.width*d.height;this._vertices=new Float32Array(12*e);this._texCoordinates=new Float32Array(8*
e);this._indices=new Uint16Array(6*e);var f=cc._renderContext;this._verticesBuffer&&f.deleteBuffer(this._verticesBuffer);this._verticesBuffer=f.createBuffer();this._texCoordinateBuffer&&f.deleteBuffer(this._texCoordinateBuffer);this._texCoordinateBuffer=f.createBuffer();this._indicesBuffer&&f.deleteBuffer(this._indicesBuffer);this._indicesBuffer=f.createBuffer();var g,h,k=0,m=this._step,n=this._vertices,p=this._texCoordinates,r=this._isTextureFlipped;for(g=0;g<d.width;g++)for(h=0;h<d.height;h++){var s=
g*m.x,u=s+m.x,t=h*m.y,w=t+m.y;n[12*k]=s;n[12*k+1]=t;n[12*k+2]=0;n[12*k+3]=u;n[12*k+4]=t;n[12*k+5]=0;n[12*k+6]=s;n[12*k+7]=w;n[12*k+8]=0;n[12*k+9]=u;n[12*k+10]=w;n[12*k+11]=0;var v=t,x=w;r&&(v=c-t,x=c-w);p[8*k]=s/a;p[8*k+1]=v/b;p[8*k+2]=u/a;p[8*k+3]=v/b;p[8*k+4]=s/a;p[8*k+5]=x/b;p[8*k+6]=u/a;p[8*k+7]=x/b;k++}a=this._indices;for(g=0;g<e;g++)a[6*g+0]=4*g+0,a[6*g+1]=4*g+1,a[6*g+2]=4*g+2,a[6*g+3]=4*g+1,a[6*g+4]=4*g+2,a[6*g+5]=4*g+3;this._originalVertices=new Float32Array(this._vertices);f.bindBuffer(f.ARRAY_BUFFER,
this._verticesBuffer);f.bufferData(f.ARRAY_BUFFER,this._vertices,f.DYNAMIC_DRAW);f.bindBuffer(f.ARRAY_BUFFER,this._texCoordinateBuffer);f.bufferData(f.ARRAY_BUFFER,this._texCoordinates,f.DYNAMIC_DRAW);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this._indicesBuffer);f.bufferData(f.ELEMENT_ARRAY_BUFFER,this._indices,f.DYNAMIC_DRAW);this._dirty=!0}});cc.TiledGrid3D.create=function(a,b,c){return new cc.TiledGrid3D(a,b,c)};cc.Grabber=cc.Class.extend({_FBO:null,_oldFBO:null,_oldClearColor:null,_gl:null,ctor:function(){cc.sys._checkWebGLRenderMode();this._gl=cc._renderContext;this._oldClearColor=[0,0,0,0];this._oldFBO=null;this._FBO=this._gl.createFramebuffer()},grab:function(a){var b=this._gl;this._oldFBO=b.getParameter(b.FRAMEBUFFER_BINDING);b.bindFramebuffer(b.FRAMEBUFFER,this._FBO);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,a._webTextureObj,0);b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE&&
cc.log("Frame Grabber: could not attach texture to frmaebuffer");b.bindFramebuffer(b.FRAMEBUFFER,this._oldFBO)},beforeRender:function(a){a=this._gl;this._oldFBO=a.getParameter(a.FRAMEBUFFER_BINDING);a.bindFramebuffer(a.FRAMEBUFFER,this._FBO);this._oldClearColor=a.getParameter(a.COLOR_CLEAR_VALUE);a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)},afterRender:function(a){a=this._gl;a.bindFramebuffer(a.FRAMEBUFFER,this._oldFBO);a.colorMask(!0,!0,!0,!0)},destroy:function(){this._gl.deleteFramebuffer(this._FBO)}});cc.ACTION_TAG_INVALID=-1;
cc.Action=cc.Class.extend({originalTarget:null,target:null,tag:cc.ACTION_TAG_INVALID,ctor:function(){this.target=this.originalTarget=null;this.tag=cc.ACTION_TAG_INVALID},copy:function(){cc.log("copy is deprecated. Please use clone instead.");return this.clone()},clone:function(){var a=new cc.Action;a.originalTarget=null;a.target=null;a.tag=this.tag;return a},isDone:function(){return!0},startWithTarget:function(a){this.target=this.originalTarget=a},stop:function(){this.target=null},step:function(a){cc.log("[Action step]. override me")},
update:function(a){cc.log("[Action update]. override me")},getTarget:function(){return this.target},setTarget:function(a){this.target=a},getOriginalTarget:function(){return this.originalTarget},setOriginalTarget:function(a){this.originalTarget=a},getTag:function(){return this.tag},setTag:function(a){this.tag=a},retain:function(){},release:function(){}});cc.action=function(){return new cc.Action};cc.Action.create=cc.action;
cc.FiniteTimeAction=cc.Action.extend({_duration:0,ctor:function(){cc.Action.prototype.ctor.call(this);this._duration=0},getDuration:function(){return this._duration*(this._timesForRepeat||1)},setDuration:function(a){this._duration=a},reverse:function(){cc.log("cocos2d: FiniteTimeAction#reverse: Implement me");return null},clone:function(){return new cc.FiniteTimeAction}});
cc.Speed=cc.Action.extend({_speed:0,_innerAction:null,ctor:function(a,b){cc.Action.prototype.ctor.call(this);this._speed=0;this._innerAction=null;a&&this.initWithAction(a,b)},getSpeed:function(){return this._speed},setSpeed:function(a){this._speed=a},initWithAction:function(a,b){if(!a)throw Error("cc.Speed.initWithAction(): action must be non nil");this._innerAction=a;this._speed=b;return!0},clone:function(){var a=new cc.Speed;a.initWithAction(this._innerAction.clone(),this._speed);return a},startWithTarget:function(a){cc.Action.prototype.startWithTarget.call(this,
a);this._innerAction.startWithTarget(a)},stop:function(){this._innerAction.stop();cc.Action.prototype.stop.call(this)},step:function(a){this._innerAction.step(a*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return new cc.Speed(this._innerAction.reverse(),this._speed)},setInnerAction:function(a){this._innerAction!==a&&(this._innerAction=a)},getInnerAction:function(){return this._innerAction}});cc.speed=function(a,b){return new cc.Speed(a,b)};
cc.Speed.create=cc.speed;
cc.Follow=cc.Action.extend({_followedNode:null,_boundarySet:!1,_boundaryFullyCovered:!1,_halfScreenSize:null,_fullScreenSize:null,_worldRect:null,leftBoundary:0,rightBoundary:0,topBoundary:0,bottomBoundary:0,ctor:function(a,b){cc.Action.prototype.ctor.call(this);this._followedNode=null;this._boundaryFullyCovered=this._boundarySet=!1;this._fullScreenSize=this._halfScreenSize=null;this.bottomBoundary=this.topBoundary=this.rightBoundary=this.leftBoundary=0;this._worldRect=cc.rect(0,0,0,0);a&&(b?this.initWithTarget(a,
b):this.initWithTarget(a))},clone:function(){var a=new cc.Follow,b=this._worldRect,b=new cc.Rect(b.x,b.y,b.width,b.height);a.initWithTarget(this._followedNode,b);return a},isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(a){this._boundarySet=a},initWithTarget:function(a,b){if(!a)throw Error("cc.Follow.initWithAction(): followedNode must be non nil");b=b||cc.rect(0,0,0,0);this._followedNode=a;this._worldRect=b;this._boundarySet=!cc._rectEqualToZero(b);this._boundaryFullyCovered=
!1;var c=cc.director.getWinSize();this._fullScreenSize=cc.p(c.width,c.height);this._halfScreenSize=cc.pMult(this._fullScreenSize,0.5);this._boundarySet&&(this.leftBoundary=-(b.x+b.width-this._fullScreenSize.x),this.rightBoundary=-b.x,this.topBoundary=-b.y,this.bottomBoundary=-(b.y+b.height-this._fullScreenSize.y),this.rightBoundary<this.leftBoundary&&(this.rightBoundary=this.leftBoundary=(this.leftBoundary+this.rightBoundary)/2),this.topBoundary<this.bottomBoundary&&(this.topBoundary=this.bottomBoundary=
(this.topBoundary+this.bottomBoundary)/2),this.topBoundary===this.bottomBoundary&&this.leftBoundary===this.rightBoundary&&(this._boundaryFullyCovered=!0));return!0},step:function(a){a=this._followedNode.x;var b=this._followedNode.y;a=this._halfScreenSize.x-a;b=this._halfScreenSize.y-b;this.target._renderCmd._dirtyFlag=0;this._boundarySet?this._boundaryFullyCovered||this.target.setPosition(cc.clampf(a,this.leftBoundary,this.rightBoundary),cc.clampf(b,this.bottomBoundary,this.topBoundary)):this.target.setPosition(a,
b)},isDone:function(){return!this._followedNode.running},stop:function(){this.target=null;cc.Action.prototype.stop.call(this)}});cc.follow=function(a,b){return new cc.Follow(a,b)};cc.Follow.create=cc.follow;cc.ActionInterval=cc.FiniteTimeAction.extend({_elapsed:0,_firstTick:!1,_easeList:null,_timesForRepeat:1,_repeatForever:!1,_repeatMethod:!1,_speed:1,_speedMethod:!1,ctor:function(a){this._timesForRepeat=this._speed=1;this._repeatForever=!1;this.MAX_VALUE=2;this._speedMethod=this._repeatMethod=!1;cc.FiniteTimeAction.prototype.ctor.call(this);void 0!==a&&this.initWithDuration(a)},getElapsed:function(){return this._elapsed},initWithDuration:function(a){this._duration=0===a?cc.FLT_EPSILON:a;this._elapsed=
0;return this._firstTick=!0},isDone:function(){return this._elapsed>=this._duration},_cloneDecoration:function(a){a._repeatForever=this._repeatForever;a._speed=this._speed;a._timesForRepeat=this._timesForRepeat;a._easeList=this._easeList;a._speedMethod=this._speedMethod;a._repeatMethod=this._repeatMethod},_reverseEaseList:function(a){if(this._easeList){a._easeList=[];for(var b=0;b<this._easeList.length;b++)a._easeList.push(this._easeList[b].reverse())}},clone:function(){var a=new cc.ActionInterval(this._duration);
this._cloneDecoration(a);return a},easing:function(a){this._easeList?this._easeList.length=0:this._easeList=[];for(var b=0;b<arguments.length;b++)this._easeList.push(arguments[b]);return this},_computeEaseTime:function(a){var b=this._easeList;if(!b||0===b.length)return a;for(var c=0,d=b.length;c<d;c++)a=b[c].easing(a);return a},step:function(a){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=a;a=this._elapsed/(1.192092896E-7<this._duration?this._duration:1.192092896E-7);a=1>a?
a:1;this.update(0<a?a:0);this._repeatMethod&&1<this._timesForRepeat&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},startWithTarget:function(a){cc.Action.prototype.startWithTarget.call(this,a);this._elapsed=0;this._firstTick=!0},reverse:function(){cc.log("cc.IntervalAction: reverse not implemented.");return null},setAmplitudeRate:function(a){cc.log("cc.ActionInterval.setAmplitudeRate(): it should be overridden in subclass.")},
getAmplitudeRate:function(){cc.log("cc.ActionInterval.getAmplitudeRate(): it should be overridden in subclass.");return 0},speed:function(a){if(0>=a)return cc.log("The speed parameter error"),this;this._speedMethod=!0;this._speed*=a;return this},getSpeed:function(){return this._speed},setSpeed:function(a){this._speed=a;return this},repeat:function(a){a=Math.round(a);if(isNaN(a)||1>a)return cc.log("The repeat parameter error"),this;this._repeatMethod=!0;this._timesForRepeat*=a;return this},repeatForever:function(){this._repeatMethod=
!0;this._timesForRepeat=this.MAX_VALUE;this._repeatForever=!0;return this}});cc.actionInterval=function(a){return new cc.ActionInterval(a)};cc.ActionInterval.create=cc.actionInterval;
cc.Sequence=cc.ActionInterval.extend({_actions:null,_split:null,_last:0,ctor:function(a){cc.ActionInterval.prototype.ctor.call(this);this._actions=[];var b=a instanceof Array?a:arguments,c=b.length-1;0<=c&&null==b[c]&&cc.log("parameters should not be ending with null in Javascript");if(0<=c){for(var d=b[0],e=1;e<c;e++)b[e]&&(d=cc.Sequence._actionOneTwo(d,b[e]));this.initWithTwoActions(d,b[c])}},initWithTwoActions:function(a,b){if(!a||!b)throw Error("cc.Sequence.initWithTwoActions(): arguments must all be non nil");
this.initWithDuration(a._duration+b._duration);this._actions[0]=a;this._actions[1]=b;return!0},clone:function(){var a=new cc.Sequence;this._cloneDecoration(a);a.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone());return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._split=this._actions[0]._duration/this._duration;this._last=-1},stop:function(){-1!==this._last&&this._actions[this._last].stop();cc.Action.prototype.stop.call(this)},update:function(a){var b=
0,c=this._split,d=this._actions,e=this._last;a=this._computeEaseTime(a);a<c?(a=0!==c?a/c:1,0===b&&1===e&&(d[1].update(0),d[1].stop())):(b=1,a=1===c?1:(a-c)/(1-c),-1===e&&(d[0].startWithTarget(this.target),d[0].update(1),d[0].stop()),e||(d[0].update(1),d[0].stop()));d=d[b];e===b&&d.isDone()||(e!==b&&d.startWithTarget(this.target),a*=d._timesForRepeat,d.update(1<a?a%1:a),this._last=b)},reverse:function(){var a=cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());this._cloneDecoration(a);
this._reverseEaseList(a);return a}});cc.sequence=function(a){var b=a instanceof Array?a:arguments;0<b.length&&null==b[b.length-1]&&cc.log("parameters should not be ending with null in Javascript");for(var c,d,e,f;b&&0<b.length;)for(d=Array.prototype.shift.call(b),f=d._timesForRepeat||1,d._repeatMethod=!1,d._timesForRepeat=1,e=0,c||(c=d,e=1),e;e<f;e++)c=cc.Sequence._actionOneTwo(c,d);return c};cc.Sequence.create=cc.sequence;
cc.Sequence._actionOneTwo=function(a,b){var c=new cc.Sequence;c.initWithTwoActions(a,b);return c};
cc.Repeat=cc.ActionInterval.extend({_times:0,_total:0,_nextDt:0,_actionInstant:!1,_innerAction:null,ctor:function(a,b){cc.ActionInterval.prototype.ctor.call(this);void 0!==b&&this.initWithAction(a,b)},initWithAction:function(a,b){return this.initWithDuration(a._duration*b)?(this._times=b,this._innerAction=a,a instanceof cc.ActionInstant&&(this._actionInstant=!0,this._times-=1),this._total=0,!0):!1},clone:function(){var a=new cc.Repeat;this._cloneDecoration(a);a.initWithAction(this._innerAction.clone(),
this._times);return a},startWithTarget:function(a){this._total=0;this._nextDt=this._innerAction._duration/this._duration;cc.ActionInterval.prototype.startWithTarget.call(this,a);this._innerAction.startWithTarget(a)},stop:function(){this._innerAction.stop();cc.Action.prototype.stop.call(this)},update:function(a){a=this._computeEaseTime(a);var b=this._innerAction,c=this._duration,d=this._times,e=this._nextDt;if(a>=e){for(;a>e&&this._total<d;)b.update(1),this._total++,b.stop(),b.startWithTarget(this.target),
this._nextDt=e+=b._duration/c;1<=a&&this._total<d&&this._total++;this._actionInstant||(this._total===d?(b.update(1),b.stop()):b.update(a-(e-b._duration/c)))}else b.update(a*d%1)},isDone:function(){return this._total===this._times},reverse:function(){var a=new cc.Repeat(this._innerAction.reverse(),this._times);this._cloneDecoration(a);this._reverseEaseList(a);return a},setInnerAction:function(a){this._innerAction!==a&&(this._innerAction=a)},getInnerAction:function(){return this._innerAction}});
cc.repeat=function(a,b){return new cc.Repeat(a,b)};cc.Repeat.create=cc.repeat;
cc.RepeatForever=cc.ActionInterval.extend({_innerAction:null,ctor:function(a){cc.ActionInterval.prototype.ctor.call(this);this._innerAction=null;a&&this.initWithAction(a)},initWithAction:function(a){if(!a)throw Error("cc.RepeatForever.initWithAction(): action must be non null");this._innerAction=a;return!0},clone:function(){var a=new cc.RepeatForever;this._cloneDecoration(a);a.initWithAction(this._innerAction.clone());return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,
a);this._innerAction.startWithTarget(a)},step:function(a){var b=this._innerAction;b.step(a);b.isDone()&&(b.startWithTarget(this.target),b.step(b.getElapsed()-b._duration))},isDone:function(){return!1},reverse:function(){var a=new cc.RepeatForever(this._innerAction.reverse());this._cloneDecoration(a);this._reverseEaseList(a);return a},setInnerAction:function(a){this._innerAction!==a&&(this._innerAction=a)},getInnerAction:function(){return this._innerAction}});cc.repeatForever=function(a){return new cc.RepeatForever(a)};
cc.RepeatForever.create=cc.repeatForever;
cc.Spawn=cc.ActionInterval.extend({_one:null,_two:null,ctor:function(a){cc.ActionInterval.prototype.ctor.call(this);this._two=this._one=null;var b,c,d;if(a instanceof Array)c=a;else for(c=Array(arguments.length),b=0;b<arguments.length;++b)c[b]=arguments[b];d=c.length-1;0<=d&&null==c[d]&&cc.log("parameters should not be ending with null in Javascript");if(0<=d){var e=c[0];for(b=1;b<d;b++)c[b]&&(e=cc.Spawn._actionOneTwo(e,c[b]));this.initWithTwoActions(e,c[d])}},initWithTwoActions:function(a,b){if(!a||
!b)throw Error("cc.Spawn.initWithTwoActions(): arguments must all be non null");var c=!1,d=a._duration,e=b._duration;this.initWithDuration(Math.max(d,e))&&(this._one=a,this._two=b,d>e?this._two=cc.Sequence._actionOneTwo(b,cc.delayTime(d-e)):d<e&&(this._one=cc.Sequence._actionOneTwo(a,cc.delayTime(e-d))),c=!0);return c},clone:function(){var a=new cc.Spawn;this._cloneDecoration(a);a.initWithTwoActions(this._one.clone(),this._two.clone());return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,
a);this._one.startWithTarget(a);this._two.startWithTarget(a)},stop:function(){this._one.stop();this._two.stop();cc.Action.prototype.stop.call(this)},update:function(a){a=this._computeEaseTime(a);this._one&&this._one.update(a);this._two&&this._two.update(a)},reverse:function(){var a=cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse());this._cloneDecoration(a);this._reverseEaseList(a);return a}});
cc.spawn=function(a){var b=a instanceof Array?a:arguments;0<b.length&&null==b[b.length-1]&&cc.log("parameters should not be ending with null in Javascript");for(var c=b[0],d=1;d<b.length;d++)null!=b[d]&&(c=cc.Spawn._actionOneTwo(c,b[d]));return c};cc.Spawn.create=cc.spawn;cc.Spawn._actionOneTwo=function(a,b){var c=new cc.Spawn;c.initWithTwoActions(a,b);return c};
cc.RotateTo=cc.ActionInterval.extend({_dstAngleX:0,_startAngleX:0,_diffAngleX:0,_dstAngleY:0,_startAngleY:0,_diffAngleY:0,ctor:function(a,b,c){cc.ActionInterval.prototype.ctor.call(this);void 0!==b&&this.initWithDuration(a,b,c)},initWithDuration:function(a,b,c){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._dstAngleX=b||0,this._dstAngleY=void 0!==c?c:this._dstAngleX,!0):!1},clone:function(){var a=new cc.RotateTo;this._cloneDecoration(a);a.initWithDuration(this._duration,this._dstAngleX,
this._dstAngleY);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);var b=a.rotationX%360,c=this._dstAngleX-b;180<c&&(c-=360);-180>c&&(c+=360);this._startAngleX=b;this._diffAngleX=c;this._startAngleY=a.rotationY%360;a=this._dstAngleY-this._startAngleY;180<a&&(a-=360);-180>a&&(a+=360);this._diffAngleY=a},reverse:function(){cc.log("cc.RotateTo.reverse(): it should be overridden in subclass.")},update:function(a){a=this._computeEaseTime(a);this.target&&(this.target.rotationX=
this._startAngleX+this._diffAngleX*a,this.target.rotationY=this._startAngleY+this._diffAngleY*a)}});cc.rotateTo=function(a,b,c){return new cc.RotateTo(a,b,c)};cc.RotateTo.create=cc.rotateTo;
cc.RotateBy=cc.ActionInterval.extend({_angleX:0,_startAngleX:0,_angleY:0,_startAngleY:0,ctor:function(a,b,c){cc.ActionInterval.prototype.ctor.call(this);void 0!==b&&this.initWithDuration(a,b,c)},initWithDuration:function(a,b,c){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._angleX=b||0,this._angleY=c||this._angleX,!0):!1},clone:function(){var a=new cc.RotateBy;this._cloneDecoration(a);a.initWithDuration(this._duration,this._angleX,this._angleY);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,
a);this._startAngleX=a.rotationX;this._startAngleY=a.rotationY},update:function(a){a=this._computeEaseTime(a);this.target&&(this.target.rotationX=this._startAngleX+this._angleX*a,this.target.rotationY=this._startAngleY+this._angleY*a)},reverse:function(){var a=new cc.RotateBy(this._duration,-this._angleX,-this._angleY);this._cloneDecoration(a);this._reverseEaseList(a);return a}});cc.rotateBy=function(a,b,c){return new cc.RotateBy(a,b,c)};cc.RotateBy.create=cc.rotateBy;
cc.MoveBy=cc.ActionInterval.extend({_positionDelta:null,_startPosition:null,_previousPosition:null,ctor:function(a,b,c){cc.ActionInterval.prototype.ctor.call(this);this._positionDelta=cc.p(0,0);this._startPosition=cc.p(0,0);this._previousPosition=cc.p(0,0);void 0!==b&&this.initWithDuration(a,b,c)},initWithDuration:function(a,b,c){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(void 0!==b.x&&(c=b.y,b=b.x),this._positionDelta.x=b,this._positionDelta.y=c,!0):!1},clone:function(){var a=
new cc.MoveBy;this._cloneDecoration(a);a.initWithDuration(this._duration,this._positionDelta);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);var b=a.getPositionX();a=a.getPositionY();this._previousPosition.x=b;this._previousPosition.y=a;this._startPosition.x=b;this._startPosition.y=a},update:function(a){a=this._computeEaseTime(a);if(this.target){var b=this._positionDelta.x*a;a*=this._positionDelta.y;var c=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var d=
this.target.getPositionX(),e=this.target.getPositionY(),f=this._previousPosition;c.x=c.x+d-f.x;c.y=c.y+e-f.y;b+=c.x;a+=c.y;f.x=b;f.y=a;this.target.setPosition(b,a)}else this.target.setPosition(c.x+b,c.y+a)}},reverse:function(){var a=new cc.MoveBy(this._duration,cc.p(-this._positionDelta.x,-this._positionDelta.y));this._cloneDecoration(a);this._reverseEaseList(a);return a}});cc.moveBy=function(a,b,c){return new cc.MoveBy(a,b,c)};cc.MoveBy.create=cc.moveBy;
cc.MoveTo=cc.MoveBy.extend({_endPosition:null,ctor:function(a,b,c){cc.MoveBy.prototype.ctor.call(this);this._endPosition=cc.p(0,0);void 0!==b&&this.initWithDuration(a,b,c)},initWithDuration:function(a,b,c){return cc.MoveBy.prototype.initWithDuration.call(this,a,b,c)?(void 0!==b.x&&(c=b.y,b=b.x),this._endPosition.x=b,this._endPosition.y=c,!0):!1},clone:function(){var a=new cc.MoveTo;this._cloneDecoration(a);a.initWithDuration(this._duration,this._endPosition);return a},startWithTarget:function(a){cc.MoveBy.prototype.startWithTarget.call(this,
a);this._positionDelta.x=this._endPosition.x-a.getPositionX();this._positionDelta.y=this._endPosition.y-a.getPositionY()}});cc.moveTo=function(a,b,c){return new cc.MoveTo(a,b,c)};cc.MoveTo.create=cc.moveTo;
cc.SkewTo=cc.ActionInterval.extend({_skewX:0,_skewY:0,_startSkewX:0,_startSkewY:0,_endSkewX:0,_endSkewY:0,_deltaX:0,_deltaY:0,ctor:function(a,b,c){cc.ActionInterval.prototype.ctor.call(this);void 0!==c&&this.initWithDuration(a,b,c)},initWithDuration:function(a,b,c){var d=!1;cc.ActionInterval.prototype.initWithDuration.call(this,a)&&(this._endSkewX=b,this._endSkewY=c,d=!0);return d},clone:function(){var a=new cc.SkewTo;this._cloneDecoration(a);a.initWithDuration(this._duration,this._endSkewX,this._endSkewY);
return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._startSkewX=a.skewX%180;this._deltaX=this._endSkewX-this._startSkewX;180<this._deltaX&&(this._deltaX-=360);-180>this._deltaX&&(this._deltaX+=360);this._startSkewY=a.skewY%360;this._deltaY=this._endSkewY-this._startSkewY;180<this._deltaY&&(this._deltaY-=360);-180>this._deltaY&&(this._deltaY+=360)},update:function(a){a=this._computeEaseTime(a);this.target.skewX=this._startSkewX+this._deltaX*a;this.target.skewY=
this._startSkewY+this._deltaY*a}});cc.skewTo=function(a,b,c){return new cc.SkewTo(a,b,c)};cc.SkewTo.create=cc.skewTo;
cc.SkewBy=cc.SkewTo.extend({ctor:function(a,b,c){cc.SkewTo.prototype.ctor.call(this);void 0!==c&&this.initWithDuration(a,b,c)},initWithDuration:function(a,b,c){var d=!1;cc.SkewTo.prototype.initWithDuration.call(this,a,b,c)&&(this._skewX=b,this._skewY=c,d=!0);return d},clone:function(){var a=new cc.SkewBy;this._cloneDecoration(a);a.initWithDuration(this._duration,this._skewX,this._skewY);return a},startWithTarget:function(a){cc.SkewTo.prototype.startWithTarget.call(this,a);this._deltaX=this._skewX;
this._deltaY=this._skewY;this._endSkewX=this._startSkewX+this._deltaX;this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){var a=new cc.SkewBy(this._duration,-this._skewX,-this._skewY);this._cloneDecoration(a);this._reverseEaseList(a);return a}});cc.skewBy=function(a,b,c){return new cc.SkewBy(a,b,c)};cc.SkewBy.create=cc.skewBy;
cc.JumpBy=cc.ActionInterval.extend({_startPosition:null,_delta:null,_height:0,_jumps:0,_previousPosition:null,ctor:function(a,b,c,d,e){cc.ActionInterval.prototype.ctor.call(this);this._startPosition=cc.p(0,0);this._previousPosition=cc.p(0,0);this._delta=cc.p(0,0);void 0!==d&&this.initWithDuration(a,b,c,d,e)},initWithDuration:function(a,b,c,d,e){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(void 0===e&&(e=d,d=c,c=b.y,b=b.x),this._delta.x=b,this._delta.y=c,this._height=d,this._jumps=
e,!0):!1},clone:function(){var a=new cc.JumpBy;this._cloneDecoration(a);a.initWithDuration(this._duration,this._delta,this._height,this._jumps);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);var b=a.getPositionX();a=a.getPositionY();this._previousPosition.x=b;this._previousPosition.y=a;this._startPosition.x=b;this._startPosition.y=a},update:function(a){a=this._computeEaseTime(a);if(this.target){var b=a*this._jumps%1,b=4*this._height*b*(1-b),b=b+this._delta.y*
a;a*=this._delta.x;var c=this._startPosition;if(cc.ENABLE_STACKABLE_ACTIONS){var d=this.target.getPositionX(),e=this.target.getPositionY(),f=this._previousPosition;c.x=c.x+d-f.x;c.y=c.y+e-f.y;a+=c.x;b+=c.y;f.x=a;f.y=b;this.target.setPosition(a,b)}else this.target.setPosition(c.x+a,c.y+b)}},reverse:function(){var a=new cc.JumpBy(this._duration,cc.p(-this._delta.x,-this._delta.y),this._height,this._jumps);this._cloneDecoration(a);this._reverseEaseList(a);return a}});
cc.jumpBy=function(a,b,c,d,e){return new cc.JumpBy(a,b,c,d,e)};cc.JumpBy.create=cc.jumpBy;
cc.JumpTo=cc.JumpBy.extend({_endPosition:null,ctor:function(a,b,c,d,e){cc.JumpBy.prototype.ctor.call(this);this._endPosition=cc.p(0,0);void 0!==d&&this.initWithDuration(a,b,c,d,e)},initWithDuration:function(a,b,c,d,e){return cc.JumpBy.prototype.initWithDuration.call(this,a,b,c,d,e)?(void 0===e&&(c=b.y,b=b.x),this._endPosition.x=b,this._endPosition.y=c,!0):!1},startWithTarget:function(a){cc.JumpBy.prototype.startWithTarget.call(this,a);this._delta.x=this._endPosition.x-this._startPosition.x;this._delta.y=
this._endPosition.y-this._startPosition.y},clone:function(){var a=new cc.JumpTo;this._cloneDecoration(a);a.initWithDuration(this._duration,this._endPosition,this._height,this._jumps);return a}});cc.jumpTo=function(a,b,c,d,e){return new cc.JumpTo(a,b,c,d,e)};cc.JumpTo.create=cc.jumpTo;cc.bezierAt=function(a,b,c,d,e){return Math.pow(1-e,3)*a+3*e*Math.pow(1-e,2)*b+3*Math.pow(e,2)*(1-e)*c+Math.pow(e,3)*d};
cc.BezierBy=cc.ActionInterval.extend({_config:null,_startPosition:null,_previousPosition:null,ctor:function(a,b){cc.ActionInterval.prototype.ctor.call(this);this._config=[];this._startPosition=cc.p(0,0);this._previousPosition=cc.p(0,0);b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._config=b,!0):!1},clone:function(){var a=new cc.BezierBy;this._cloneDecoration(a);for(var b=[],c=0;c<this._config.length;c++){var d=
this._config[c];b.push(cc.p(d.x,d.y))}a.initWithDuration(this._duration,b);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);var b=a.getPositionX();a=a.getPositionY();this._previousPosition.x=b;this._previousPosition.y=a;this._startPosition.x=b;this._startPosition.y=a},update:function(a){a=this._computeEaseTime(a);if(this.target){var b=this._config,c=b[0].y,d=b[1].y,e=b[2].y,b=cc.bezierAt(0,b[0].x,b[1].x,b[2].x,a);a=cc.bezierAt(0,c,d,e,a);c=this._startPosition;
if(cc.ENABLE_STACKABLE_ACTIONS){var d=this.target.getPositionX(),e=this.target.getPositionY(),f=this._previousPosition;c.x=c.x+d-f.x;c.y=c.y+e-f.y;b+=c.x;a+=c.y;f.x=b;f.y=a;this.target.setPosition(b,a)}else this.target.setPosition(c.x+b,c.y+a)}},reverse:function(){var a=this._config,a=[cc.pAdd(a[1],cc.pNeg(a[2])),cc.pAdd(a[0],cc.pNeg(a[2])),cc.pNeg(a[2])],a=new cc.BezierBy(this._duration,a);this._cloneDecoration(a);this._reverseEaseList(a);return a}});
cc.bezierBy=function(a,b){return new cc.BezierBy(a,b)};cc.BezierBy.create=cc.bezierBy;
cc.BezierTo=cc.BezierBy.extend({_toConfig:null,ctor:function(a,b){cc.BezierBy.prototype.ctor.call(this);this._toConfig=[];b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._toConfig=b,!0):!1},clone:function(){var a=new cc.BezierTo;this._cloneDecoration(a);a.initWithDuration(this._duration,this._toConfig);return a},startWithTarget:function(a){cc.BezierBy.prototype.startWithTarget.call(this,a);a=this._startPosition;var b=
this._toConfig,c=this._config;c[0]=cc.pSub(b[0],a);c[1]=cc.pSub(b[1],a);c[2]=cc.pSub(b[2],a)}});cc.bezierTo=function(a,b){return new cc.BezierTo(a,b)};cc.BezierTo.create=cc.bezierTo;
cc.ScaleTo=cc.ActionInterval.extend({_scaleX:1,_scaleY:1,_startScaleX:1,_startScaleY:1,_endScaleX:0,_endScaleY:0,_deltaX:0,_deltaY:0,ctor:function(a,b,c){cc.ActionInterval.prototype.ctor.call(this);void 0!==b&&this.initWithDuration(a,b,c)},initWithDuration:function(a,b,c){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._endScaleX=b,this._endScaleY=null!=c?c:b,!0):!1},clone:function(){var a=new cc.ScaleTo;this._cloneDecoration(a);a.initWithDuration(this._duration,this._endScaleX,
this._endScaleY);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._startScaleX=a.scaleX;this._startScaleY=a.scaleY;this._deltaX=this._endScaleX-this._startScaleX;this._deltaY=this._endScaleY-this._startScaleY},update:function(a){a=this._computeEaseTime(a);this.target&&(this.target.scaleX=this._startScaleX+this._deltaX*a,this.target.scaleY=this._startScaleY+this._deltaY*a)}});cc.scaleTo=function(a,b,c){return new cc.ScaleTo(a,b,c)};
cc.ScaleTo.create=cc.scaleTo;
cc.ScaleBy=cc.ScaleTo.extend({startWithTarget:function(a){cc.ScaleTo.prototype.startWithTarget.call(this,a);this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX;this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){var a=new cc.ScaleBy(this._duration,1/this._endScaleX,1/this._endScaleY);this._cloneDecoration(a);this._reverseEaseList(a);return a},clone:function(){var a=new cc.ScaleBy;this._cloneDecoration(a);a.initWithDuration(this._duration,this._endScaleX,
this._endScaleY);return a}});cc.scaleBy=function(a,b,c){return new cc.ScaleBy(a,b,c)};cc.ScaleBy.create=cc.scaleBy;
cc.Blink=cc.ActionInterval.extend({_times:0,_originalState:!1,ctor:function(a,b){cc.ActionInterval.prototype.ctor.call(this);void 0!==b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._times=b,!0):!1},clone:function(){var a=new cc.Blink;this._cloneDecoration(a);a.initWithDuration(this._duration,this._times);return a},update:function(a){a=this._computeEaseTime(a);if(this.target&&!this.isDone()){var b=1/this._times;this.target.visible=
a%b>b/2}},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._originalState=a.visible},stop:function(){this.target.visible=this._originalState;cc.ActionInterval.prototype.stop.call(this)},reverse:function(){var a=new cc.Blink(this._duration,this._times);this._cloneDecoration(a);this._reverseEaseList(a);return a}});cc.blink=function(a,b){return new cc.Blink(a,b)};cc.Blink.create=cc.blink;
cc.FadeTo=cc.ActionInterval.extend({_toOpacity:0,_fromOpacity:0,ctor:function(a,b){cc.ActionInterval.prototype.ctor.call(this);void 0!==b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._toOpacity=b,!0):!1},clone:function(){var a=new cc.FadeTo;this._cloneDecoration(a);a.initWithDuration(this._duration,this._toOpacity);return a},update:function(a){a=this._computeEaseTime(a);var b=void 0!==this._fromOpacity?this._fromOpacity:
255;this.target.opacity=b+(this._toOpacity-b)*a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._fromOpacity=a.opacity}});cc.fadeTo=function(a,b){return new cc.FadeTo(a,b)};cc.FadeTo.create=cc.fadeTo;
cc.FadeIn=cc.FadeTo.extend({_reverseAction:null,ctor:function(a){cc.FadeTo.prototype.ctor.call(this);null==a&&(a=0);this.initWithDuration(a,255)},reverse:function(){var a=new cc.FadeOut;a.initWithDuration(this._duration,0);this._cloneDecoration(a);this._reverseEaseList(a);return a},clone:function(){var a=new cc.FadeIn;this._cloneDecoration(a);a.initWithDuration(this._duration,this._toOpacity);return a},startWithTarget:function(a){this._reverseAction&&(this._toOpacity=this._reverseAction._fromOpacity);
cc.FadeTo.prototype.startWithTarget.call(this,a)}});cc.fadeIn=function(a){return new cc.FadeIn(a)};cc.FadeIn.create=cc.fadeIn;
cc.FadeOut=cc.FadeTo.extend({ctor:function(a){cc.FadeTo.prototype.ctor.call(this);null==a&&(a=0);this.initWithDuration(a,0)},reverse:function(){var a=new cc.FadeIn;a._reverseAction=this;a.initWithDuration(this._duration,255);this._cloneDecoration(a);this._reverseEaseList(a);return a},clone:function(){var a=new cc.FadeOut;this._cloneDecoration(a);a.initWithDuration(this._duration,this._toOpacity);return a}});cc.fadeOut=function(a){return new cc.FadeOut(a)};cc.FadeOut.create=cc.fadeOut;
cc.TintTo=cc.ActionInterval.extend({_to:null,_from:null,ctor:function(a,b,c,d){cc.ActionInterval.prototype.ctor.call(this);this._to=cc.color(0,0,0);this._from=cc.color(0,0,0);void 0!==d&&this.initWithDuration(a,b,c,d)},initWithDuration:function(a,b,c,d){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._to=cc.color(b,c,d),!0):!1},clone:function(){var a=new cc.TintTo;this._cloneDecoration(a);var b=this._to;a.initWithDuration(this._duration,b.r,b.g,b.b);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,
a);this._from=this.target.color},update:function(a){a=this._computeEaseTime(a);var b=this._from,c=this._to;b&&this.target.setColor(cc.color(b.r+(c.r-b.r)*a,b.g+(c.g-b.g)*a,b.b+(c.b-b.b)*a))}});cc.tintTo=function(a,b,c,d){return new cc.TintTo(a,b,c,d)};cc.TintTo.create=cc.tintTo;
cc.TintBy=cc.ActionInterval.extend({_deltaR:0,_deltaG:0,_deltaB:0,_fromR:0,_fromG:0,_fromB:0,ctor:function(a,b,c,d){cc.ActionInterval.prototype.ctor.call(this);void 0!==d&&this.initWithDuration(a,b,c,d)},initWithDuration:function(a,b,c,d){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._deltaR=b,this._deltaG=c,this._deltaB=d,!0):!1},clone:function(){var a=new cc.TintBy;this._cloneDecoration(a);a.initWithDuration(this._duration,this._deltaR,this._deltaG,this._deltaB);return a},
startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);a=a.color;this._fromR=a.r;this._fromG=a.g;this._fromB=a.b},update:function(a){a=this._computeEaseTime(a);this.target.color=cc.color(this._fromR+this._deltaR*a,this._fromG+this._deltaG*a,this._fromB+this._deltaB*a)},reverse:function(){var a=new cc.TintBy(this._duration,-this._deltaR,-this._deltaG,-this._deltaB);this._cloneDecoration(a);this._reverseEaseList(a);return a}});
cc.tintBy=function(a,b,c,d){return new cc.TintBy(a,b,c,d)};cc.TintBy.create=cc.tintBy;cc.DelayTime=cc.ActionInterval.extend({update:function(a){},reverse:function(){var a=new cc.DelayTime(this._duration);this._cloneDecoration(a);this._reverseEaseList(a);return a},clone:function(){var a=new cc.DelayTime;this._cloneDecoration(a);a.initWithDuration(this._duration);return a}});cc.delayTime=function(a){return new cc.DelayTime(a)};cc.DelayTime.create=cc.delayTime;
cc.ReverseTime=cc.ActionInterval.extend({_other:null,ctor:function(a){cc.ActionInterval.prototype.ctor.call(this);this._other=null;a&&this.initWithAction(a)},initWithAction:function(a){if(!a)throw Error("cc.ReverseTime.initWithAction(): action must be non null");if(a===this._other)throw Error("cc.ReverseTime.initWithAction(): the action was already passed in.");return cc.ActionInterval.prototype.initWithDuration.call(this,a._duration)?(this._other=a,!0):!1},clone:function(){var a=new cc.ReverseTime;
this._cloneDecoration(a);a.initWithAction(this._other.clone());return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._other.startWithTarget(a)},update:function(a){a=this._computeEaseTime(a);this._other&&this._other.update(1-a)},reverse:function(){return this._other.clone()},stop:function(){this._other.stop();cc.Action.prototype.stop.call(this)}});cc.reverseTime=function(a){return new cc.ReverseTime(a)};cc.ReverseTime.create=cc.reverseTime;
cc.Animate=cc.ActionInterval.extend({_animation:null,_nextFrame:0,_origFrame:null,_executedLoops:0,_splitTimes:null,_currFrameIndex:0,ctor:function(a){cc.ActionInterval.prototype.ctor.call(this);this._splitTimes=[];a&&this.initWithAnimation(a)},getAnimation:function(){return this._animation},setAnimation:function(a){this._animation=a},getCurrentFrameIndex:function(){return this._currFrameIndex},initWithAnimation:function(a){if(!a)throw Error("cc.Animate.initWithAnimation(): animation must be non-NULL");
var b=a.getDuration();if(this.initWithDuration(b*a.getLoops())){this._nextFrame=0;this.setAnimation(a);this._origFrame=null;this._executedLoops=0;var c=this._splitTimes,d=c.length=0,e=b/a.getTotalDelayUnits();a=a.getFrames();cc.arrayVerifyType(a,cc.AnimationFrame);for(var f=0;f<a.length;f++){var g=d*e/b,d=d+a[f].getDelayUnits();c.push(g)}return!0}return!1},clone:function(){var a=new cc.Animate;this._cloneDecoration(a);a.initWithAnimation(this._animation.clone());return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,
a);this._animation.getRestoreOriginalFrame()&&(this._origFrame=a.getSpriteFrame());this._executedLoops=this._nextFrame=0},update:function(a){a=this._computeEaseTime(a);1>a&&(a*=this._animation.getLoops(),(0|a)>this._executedLoops&&(this._nextFrame=0,this._executedLoops++),a%=1);for(var b=this._animation.getFrames(),c=b.length,d=this._splitTimes,e=this._nextFrame;e<c;e++)if(d[e]<=a)_currFrameIndex=e,this.target.setSpriteFrame(b[_currFrameIndex].getSpriteFrame()),this._nextFrame=e+1;else break},reverse:function(){var a=
this._animation,b=a.getFrames(),c=[];cc.arrayVerifyType(b,cc.AnimationFrame);if(0<b.length)for(var d=b.length-1;0<=d;d--){var e=b[d];if(!e)break;c.push(e.clone())}b=new cc.Animation(c,a.getDelayPerUnit(),a.getLoops());b.setRestoreOriginalFrame(a.getRestoreOriginalFrame());a=new cc.Animate(b);this._cloneDecoration(a);this._reverseEaseList(a);return a},stop:function(){this._animation.getRestoreOriginalFrame()&&this.target&&this.target.setSpriteFrame(this._origFrame);cc.Action.prototype.stop.call(this)}});
cc.animate=function(a){return new cc.Animate(a)};cc.Animate.create=cc.animate;
cc.TargetedAction=cc.ActionInterval.extend({_action:null,_forcedTarget:null,ctor:function(a,b){cc.ActionInterval.prototype.ctor.call(this);b&&this.initWithTarget(a,b)},initWithTarget:function(a,b){return this.initWithDuration(b._duration)?(this._forcedTarget=a,this._action=b,!0):!1},clone:function(){var a=new cc.TargetedAction;this._cloneDecoration(a);a.initWithTarget(this._forcedTarget,this._action.clone());return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);
this._action.startWithTarget(this._forcedTarget)},stop:function(){this._action.stop()},update:function(a){a=this._computeEaseTime(a);this._action.update(a)},getForcedTarget:function(){return this._forcedTarget},setForcedTarget:function(a){this._forcedTarget!==a&&(this._forcedTarget=a)}});cc.targetedAction=function(a,b){return new cc.TargetedAction(a,b)};cc.TargetedAction.create=cc.targetedAction;cc.ActionInstant=cc.FiniteTimeAction.extend({isDone:function(){return!0},step:function(a){this.update(1)},update:function(a){},reverse:function(){return this.clone()},clone:function(){return new cc.ActionInstant}});cc.Show=cc.ActionInstant.extend({update:function(a){this.target.visible=!0},reverse:function(){return new cc.Hide},clone:function(){return new cc.Show}});cc.show=function(){return new cc.Show};cc.Show.create=cc.show;
cc.Hide=cc.ActionInstant.extend({update:function(a){this.target.visible=!1},reverse:function(){return new cc.Show},clone:function(){return new cc.Hide}});cc.hide=function(){return new cc.Hide};cc.Hide.create=cc.hide;cc.ToggleVisibility=cc.ActionInstant.extend({update:function(a){this.target.visible=!this.target.visible},reverse:function(){return new cc.ToggleVisibility},clone:function(){return new cc.ToggleVisibility}});cc.toggleVisibility=function(){return new cc.ToggleVisibility};
cc.ToggleVisibility.create=cc.toggleVisibility;cc.RemoveSelf=cc.ActionInstant.extend({_isNeedCleanUp:!0,ctor:function(a){cc.FiniteTimeAction.prototype.ctor.call(this);void 0!==a&&this.init(a)},update:function(a){this.target.removeFromParent(this._isNeedCleanUp)},init:function(a){this._isNeedCleanUp=a;return!0},reverse:function(){return new cc.RemoveSelf(this._isNeedCleanUp)},clone:function(){return new cc.RemoveSelf(this._isNeedCleanUp)}});cc.removeSelf=function(a){return new cc.RemoveSelf(a)};
cc.RemoveSelf.create=cc.removeSelf;cc.FlipX=cc.ActionInstant.extend({_flippedX:!1,ctor:function(a){cc.FiniteTimeAction.prototype.ctor.call(this);this._flippedX=!1;void 0!==a&&this.initWithFlipX(a)},initWithFlipX:function(a){this._flippedX=a;return!0},update:function(a){this.target.flippedX=this._flippedX},reverse:function(){return new cc.FlipX(!this._flippedX)},clone:function(){var a=new cc.FlipX;a.initWithFlipX(this._flippedX);return a}});cc.flipX=function(a){return new cc.FlipX(a)};
cc.FlipX.create=cc.flipX;cc.FlipY=cc.ActionInstant.extend({_flippedY:!1,ctor:function(a){cc.FiniteTimeAction.prototype.ctor.call(this);this._flippedY=!1;void 0!==a&&this.initWithFlipY(a)},initWithFlipY:function(a){this._flippedY=a;return!0},update:function(a){this.target.flippedY=this._flippedY},reverse:function(){return new cc.FlipY(!this._flippedY)},clone:function(){var a=new cc.FlipY;a.initWithFlipY(this._flippedY);return a}});cc.flipY=function(a){return new cc.FlipY(a)};cc.FlipY.create=cc.flipY;
cc.Place=cc.ActionInstant.extend({_x:0,_y:0,ctor:function(a,b){cc.FiniteTimeAction.prototype.ctor.call(this);this._y=this._x=0;void 0!==a&&(void 0!==a.x&&(b=a.y,a=a.x),this.initWithPosition(a,b))},initWithPosition:function(a,b){this._x=a;this._y=b;return!0},update:function(a){this.target.setPosition(this._x,this._y)},clone:function(){var a=new cc.Place;a.initWithPosition(this._x,this._y);return a}});cc.place=function(a,b){return new cc.Place(a,b)};cc.Place.create=cc.place;
cc.CallFunc=cc.ActionInstant.extend({_selectorTarget:null,_function:null,_data:null,ctor:function(a,b,c){cc.FiniteTimeAction.prototype.ctor.call(this);this.initWithFunction(a,b,c)},initWithFunction:function(a,b,c){a&&(this._function=a);b&&(this._selectorTarget=b);void 0!==c&&(this._data=c);return!0},execute:function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},update:function(a){this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(a){a!==
this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=a)},clone:function(){var a=new cc.CallFunc;a.initWithFunction(this._function,this._selectorTarget,this._data);return a}});cc.callFunc=function(a,b,c){return new cc.CallFunc(a,b,c)};cc.CallFunc.create=cc.callFunc;cc.ActionEase=cc.ActionInterval.extend({_inner:null,ctor:function(a){cc.ActionInterval.prototype.ctor.call(this);a&&this.initWithAction(a)},initWithAction:function(a){if(!a)throw Error("cc.ActionEase.initWithAction(): action must be non nil");return this.initWithDuration(a.getDuration())?(this._inner=a,!0):!1},clone:function(){var a=new cc.ActionEase;a.initWithAction(this._inner.clone());return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._inner.startWithTarget(this.target)},
stop:function(){this._inner.stop();cc.ActionInterval.prototype.stop.call(this)},update:function(a){this._inner.update(a)},reverse:function(){return new cc.ActionEase(this._inner.reverse())},getInnerAction:function(){return this._inner}});cc.actionEase=function(a){return new cc.ActionEase(a)};cc.ActionEase.create=cc.actionEase;
cc.EaseRateAction=cc.ActionEase.extend({_rate:0,ctor:function(a,b){cc.ActionEase.prototype.ctor.call(this);void 0!==b&&this.initWithAction(a,b)},setRate:function(a){this._rate=a},getRate:function(){return this._rate},initWithAction:function(a,b){return cc.ActionEase.prototype.initWithAction.call(this,a)?(this._rate=b,!0):!1},clone:function(){var a=new cc.EaseRateAction;a.initWithAction(this._inner.clone(),this._rate);return a},reverse:function(){return new cc.EaseRateAction(this._inner.reverse(),
1/this._rate)}});cc.easeRateAction=function(a,b){return new cc.EaseRateAction(a,b)};cc.EaseRateAction.create=cc.easeRateAction;cc.EaseIn=cc.EaseRateAction.extend({update:function(a){this._inner.update(Math.pow(a,this._rate))},reverse:function(){return new cc.EaseIn(this._inner.reverse(),1/this._rate)},clone:function(){var a=new cc.EaseIn;a.initWithAction(this._inner.clone(),this._rate);return a}});cc.EaseIn.create=function(a,b){return new cc.EaseIn(a,b)};
cc.easeIn=function(a){return{_rate:a,easing:function(a){return Math.pow(a,this._rate)},reverse:function(){return cc.easeIn(1/this._rate)}}};cc.EaseOut=cc.EaseRateAction.extend({update:function(a){this._inner.update(Math.pow(a,1/this._rate))},reverse:function(){return new cc.EaseOut(this._inner.reverse(),1/this._rate)},clone:function(){var a=new cc.EaseOut;a.initWithAction(this._inner.clone(),this._rate);return a}});cc.EaseOut.create=function(a,b){return new cc.EaseOut(a,b)};
cc.easeOut=function(a){return{_rate:a,easing:function(a){return Math.pow(a,1/this._rate)},reverse:function(){return cc.easeOut(1/this._rate)}}};cc.EaseInOut=cc.EaseRateAction.extend({update:function(a){a*=2;1>a?this._inner.update(0.5*Math.pow(a,this._rate)):this._inner.update(1-0.5*Math.pow(2-a,this._rate))},clone:function(){var a=new cc.EaseInOut;a.initWithAction(this._inner.clone(),this._rate);return a},reverse:function(){return new cc.EaseInOut(this._inner.reverse(),this._rate)}});
cc.EaseInOut.create=function(a,b){return new cc.EaseInOut(a,b)};cc.easeInOut=function(a){return{_rate:a,easing:function(a){a*=2;return 1>a?0.5*Math.pow(a,this._rate):1-0.5*Math.pow(2-a,this._rate)},reverse:function(){return cc.easeInOut(this._rate)}}};
cc.EaseExponentialIn=cc.ActionEase.extend({update:function(a){this._inner.update(0===a?0:Math.pow(2,10*(a-1)))},reverse:function(){return new cc.EaseExponentialOut(this._inner.reverse())},clone:function(){var a=new cc.EaseExponentialIn;a.initWithAction(this._inner.clone());return a}});cc.EaseExponentialIn.create=function(a){return new cc.EaseExponentialIn(a)};cc._easeExponentialInObj={easing:function(a){return 0===a?0:Math.pow(2,10*(a-1))},reverse:function(){return cc._easeExponentialOutObj}};
cc.easeExponentialIn=function(){return cc._easeExponentialInObj};cc.EaseExponentialOut=cc.ActionEase.extend({update:function(a){this._inner.update(1===a?1:-Math.pow(2,-10*a)+1)},reverse:function(){return new cc.EaseExponentialIn(this._inner.reverse())},clone:function(){var a=new cc.EaseExponentialOut;a.initWithAction(this._inner.clone());return a}});cc.EaseExponentialOut.create=function(a){return new cc.EaseExponentialOut(a)};
cc._easeExponentialOutObj={easing:function(a){return 1===a?1:-Math.pow(2,-10*a)+1},reverse:function(){return cc._easeExponentialInObj}};cc.easeExponentialOut=function(){return cc._easeExponentialOutObj};
cc.EaseExponentialInOut=cc.ActionEase.extend({update:function(a){1!==a&&0!==a&&(a*=2,a=1>a?0.5*Math.pow(2,10*(a-1)):0.5*(-Math.pow(2,-10*(a-1))+2));this._inner.update(a)},reverse:function(){return new cc.EaseExponentialInOut(this._inner.reverse())},clone:function(){var a=new cc.EaseExponentialInOut;a.initWithAction(this._inner.clone());return a}});cc.EaseExponentialInOut.create=function(a){return new cc.EaseExponentialInOut(a)};
cc._easeExponentialInOutObj={easing:function(a){return 1!==a&&0!==a?(a*=2,1>a?0.5*Math.pow(2,10*(a-1)):0.5*(-Math.pow(2,-10*(a-1))+2)):a},reverse:function(){return cc._easeExponentialInOutObj}};cc.easeExponentialInOut=function(){return cc._easeExponentialInOutObj};
cc.EaseSineIn=cc.ActionEase.extend({update:function(a){a=0===a||1===a?a:-1*Math.cos(a*Math.PI/2)+1;this._inner.update(a)},reverse:function(){return new cc.EaseSineOut(this._inner.reverse())},clone:function(){var a=new cc.EaseSineIn;a.initWithAction(this._inner.clone());return a}});cc.EaseSineIn.create=function(a){return new cc.EaseSineIn(a)};cc._easeSineInObj={easing:function(a){return 0===a||1===a?a:-1*Math.cos(a*Math.PI/2)+1},reverse:function(){return cc._easeSineOutObj}};cc.easeSineIn=function(){return cc._easeSineInObj};
cc.EaseSineOut=cc.ActionEase.extend({update:function(a){a=0===a||1===a?a:Math.sin(a*Math.PI/2);this._inner.update(a)},reverse:function(){return new cc.EaseSineIn(this._inner.reverse())},clone:function(){var a=new cc.EaseSineOut;a.initWithAction(this._inner.clone());return a}});cc.EaseSineOut.create=function(a){return new cc.EaseSineOut(a)};cc._easeSineOutObj={easing:function(a){return 0===a||1===a?a:Math.sin(a*Math.PI/2)},reverse:function(){return cc._easeSineInObj}};cc.easeSineOut=function(){return cc._easeSineOutObj};
cc.EaseSineInOut=cc.ActionEase.extend({update:function(a){a=0===a||1===a?a:-0.5*(Math.cos(Math.PI*a)-1);this._inner.update(a)},clone:function(){var a=new cc.EaseSineInOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return new cc.EaseSineInOut(this._inner.reverse())}});cc.EaseSineInOut.create=function(a){return new cc.EaseSineInOut(a)};cc._easeSineInOutObj={easing:function(a){return 0===a||1===a?a:-0.5*(Math.cos(Math.PI*a)-1)},reverse:function(){return cc._easeSineInOutObj}};
cc.easeSineInOut=function(){return cc._easeSineInOutObj};
cc.EaseElastic=cc.ActionEase.extend({_period:0.3,ctor:function(a,b){cc.ActionEase.prototype.ctor.call(this);a&&this.initWithAction(a,b)},getPeriod:function(){return this._period},setPeriod:function(a){this._period=a},initWithAction:function(a,b){cc.ActionEase.prototype.initWithAction.call(this,a);this._period=null==b?0.3:b;return!0},reverse:function(){cc.log("cc.EaseElastic.reverse(): it should be overridden in subclass.");return null},clone:function(){var a=new cc.EaseElastic;a.initWithAction(this._inner.clone(),
this._period);return a}});cc.EaseElastic.create=function(a,b){return new cc.EaseElastic(a,b)};cc.EaseElasticIn=cc.EaseElastic.extend({update:function(a){var b=0;0===a||1===a?b=a:(b=this._period/4,a-=1,b=-Math.pow(2,10*a)*Math.sin((a-b)*Math.PI*2/this._period));this._inner.update(b)},reverse:function(){return new cc.EaseElasticOut(this._inner.reverse(),this._period)},clone:function(){var a=new cc.EaseElasticIn;a.initWithAction(this._inner.clone(),this._period);return a}});
cc.EaseElasticIn.create=function(a,b){return new cc.EaseElasticIn(a,b)};cc._easeElasticInObj={easing:function(a){if(0===a||1===a)return a;a-=1;return-Math.pow(2,10*a)*Math.sin((a-0.075)*Math.PI*2/0.3)},reverse:function(){return cc._easeElasticOutObj}};cc.easeElasticIn=function(a){return a&&0.3!==a?{_period:a,easing:function(a){if(0===a||1===a)return a;a-=1;return-Math.pow(2,10*a)*Math.sin((a-this._period/4)*Math.PI*2/this._period)},reverse:function(){return cc.easeElasticOut(this._period)}}:cc._easeElasticInObj};
cc.EaseElasticOut=cc.EaseElastic.extend({update:function(a){var b=0;0===a||1===a?b=a:(b=this._period/4,b=Math.pow(2,-10*a)*Math.sin((a-b)*Math.PI*2/this._period)+1);this._inner.update(b)},reverse:function(){return new cc.EaseElasticIn(this._inner.reverse(),this._period)},clone:function(){var a=new cc.EaseElasticOut;a.initWithAction(this._inner.clone(),this._period);return a}});cc.EaseElasticOut.create=function(a,b){return new cc.EaseElasticOut(a,b)};
cc._easeElasticOutObj={easing:function(a){return 0===a||1===a?a:Math.pow(2,-10*a)*Math.sin((a-0.075)*Math.PI*2/0.3)+1},reverse:function(){return cc._easeElasticInObj}};cc.easeElasticOut=function(a){return a&&0.3!==a?{_period:a,easing:function(a){return 0===a||1===a?a:Math.pow(2,-10*a)*Math.sin((a-this._period/4)*Math.PI*2/this._period)+1},reverse:function(){return cc.easeElasticIn(this._period)}}:cc._easeElasticOutObj};
cc.EaseElasticInOut=cc.EaseElastic.extend({update:function(a){var b=0,b=this._period;if(0===a||1===a)b=a;else{b||(b=this._period=0.3*1.5);var c=b/4;a=2*a-1;b=0>a?-0.5*Math.pow(2,10*a)*Math.sin((a-c)*Math.PI*2/b):Math.pow(2,-10*a)*Math.sin((a-c)*Math.PI*2/b)*0.5+1}this._inner.update(b)},reverse:function(){return new cc.EaseElasticInOut(this._inner.reverse(),this._period)},clone:function(){var a=new cc.EaseElasticInOut;a.initWithAction(this._inner.clone(),this._period);return a}});
cc.EaseElasticInOut.create=function(a,b){return new cc.EaseElasticInOut(a,b)};cc.easeElasticInOut=function(a){return{_period:a||0.3,easing:function(a){var c=0,c=this._period;if(0===a||1===a)c=a;else{c||(c=this._period=0.3*1.5);var d=c/4;a=2*a-1;c=0>a?-0.5*Math.pow(2,10*a)*Math.sin((a-d)*Math.PI*2/c):Math.pow(2,-10*a)*Math.sin((a-d)*Math.PI*2/c)*0.5+1}return c},reverse:function(){return cc.easeElasticInOut(this._period)}}};
cc.EaseBounce=cc.ActionEase.extend({bounceTime:function(a){if(a<1/2.75)return 7.5625*a*a;if(a<2/2.75)return a-=1.5/2.75,7.5625*a*a+0.75;if(a<2.5/2.75)return a-=2.25/2.75,7.5625*a*a+0.9375;a-=2.625/2.75;return 7.5625*a*a+0.984375},clone:function(){var a=new cc.EaseBounce;a.initWithAction(this._inner.clone());return a},reverse:function(){return new cc.EaseBounce(this._inner.reverse())}});cc.EaseBounce.create=function(a){return new cc.EaseBounce(a)};
cc.EaseBounceIn=cc.EaseBounce.extend({update:function(a){a=1-this.bounceTime(1-a);this._inner.update(a)},reverse:function(){return new cc.EaseBounceOut(this._inner.reverse())},clone:function(){var a=new cc.EaseBounceIn;a.initWithAction(this._inner.clone());return a}});cc.EaseBounceIn.create=function(a){return new cc.EaseBounceIn(a)};
cc._bounceTime=function(a){if(a<1/2.75)return 7.5625*a*a;if(a<2/2.75)return a-=1.5/2.75,7.5625*a*a+0.75;if(a<2.5/2.75)return a-=2.25/2.75,7.5625*a*a+0.9375;a-=2.625/2.75;return 7.5625*a*a+0.984375};cc._easeBounceInObj={easing:function(a){return 1-cc._bounceTime(1-a)},reverse:function(){return cc._easeBounceOutObj}};cc.easeBounceIn=function(){return cc._easeBounceInObj};
cc.EaseBounceOut=cc.EaseBounce.extend({update:function(a){a=this.bounceTime(a);this._inner.update(a)},reverse:function(){return new cc.EaseBounceIn(this._inner.reverse())},clone:function(){var a=new cc.EaseBounceOut;a.initWithAction(this._inner.clone());return a}});cc.EaseBounceOut.create=function(a){return new cc.EaseBounceOut(a)};cc._easeBounceOutObj={easing:function(a){return cc._bounceTime(a)},reverse:function(){return cc._easeBounceInObj}};cc.easeBounceOut=function(){return cc._easeBounceOutObj};
cc.EaseBounceInOut=cc.EaseBounce.extend({update:function(a){var b=0,b=0.5>a?0.5*(1-this.bounceTime(1-2*a)):0.5*this.bounceTime(2*a-1)+0.5;this._inner.update(b)},clone:function(){var a=new cc.EaseBounceInOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return new cc.EaseBounceInOut(this._inner.reverse())}});cc.EaseBounceInOut.create=function(a){return new cc.EaseBounceInOut(a)};
cc._easeBounceInOutObj={easing:function(a){return a=0.5>a?0.5*(1-cc._bounceTime(1-2*a)):0.5*cc._bounceTime(2*a-1)+0.5},reverse:function(){return cc._easeBounceInOutObj}};cc.easeBounceInOut=function(){return cc._easeBounceInOutObj};cc.EaseBackIn=cc.ActionEase.extend({update:function(a){this._inner.update(0===a||1===a?a:a*a*(2.70158*a-1.70158))},reverse:function(){return new cc.EaseBackOut(this._inner.reverse())},clone:function(){var a=new cc.EaseBackIn;a.initWithAction(this._inner.clone());return a}});
cc.EaseBackIn.create=function(a){return new cc.EaseBackIn(a)};cc._easeBackInObj={easing:function(a){return 0===a||1===a?a:a*a*(2.70158*a-1.70158)},reverse:function(){return cc._easeBackOutObj}};cc.easeBackIn=function(){return cc._easeBackInObj};
cc.EaseBackOut=cc.ActionEase.extend({update:function(a){a-=1;this._inner.update(a*a*(2.70158*a+1.70158)+1)},reverse:function(){return new cc.EaseBackIn(this._inner.reverse())},clone:function(){var a=new cc.EaseBackOut;a.initWithAction(this._inner.clone());return a}});cc.EaseBackOut.create=function(a){return new cc.EaseBackOut(a)};cc._easeBackOutObj={easing:function(a){a-=1;return a*a*(2.70158*a+1.70158)+1},reverse:function(){return cc._easeBackInObj}};cc.easeBackOut=function(){return cc._easeBackOutObj};
cc.EaseBackInOut=cc.ActionEase.extend({update:function(a){a*=2;1>a?this._inner.update(a*a*(3.5949095*a-2.5949095)/2):(a-=2,this._inner.update(a*a*(3.5949095*a+2.5949095)/2+1))},clone:function(){var a=new cc.EaseBackInOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return new cc.EaseBackInOut(this._inner.reverse())}});cc.EaseBackInOut.create=function(a){return new cc.EaseBackInOut(a)};
cc._easeBackInOutObj={easing:function(a){a*=2;if(1>a)return a*a*(3.5949095*a-2.5949095)/2;a-=2;return a*a*(3.5949095*a+2.5949095)/2+1},reverse:function(){return cc._easeBackInOutObj}};cc.easeBackInOut=function(){return cc._easeBackInOutObj};
cc.EaseBezierAction=cc.ActionEase.extend({_p0:null,_p1:null,_p2:null,_p3:null,ctor:function(a){cc.ActionEase.prototype.ctor.call(this,a)},_updateTime:function(a,b,c,d,e){return Math.pow(1-e,3)*a+3*e*Math.pow(1-e,2)*b+3*Math.pow(e,2)*(1-e)*c+Math.pow(e,3)*d},update:function(a){a=this._updateTime(this._p0,this._p1,this._p2,this._p3,a);this._inner.update(a)},clone:function(){var a=new cc.EaseBezierAction;a.initWithAction(this._inner.clone());a.setBezierParamer(this._p0,this._p1,this._p2,this._p3);return a},
reverse:function(){var a=new cc.EaseBezierAction(this._inner.reverse());a.setBezierParamer(this._p3,this._p2,this._p1,this._p0);return a},setBezierParamer:function(a,b,c,d){this._p0=a||0;this._p1=b||0;this._p2=c||0;this._p3=d||0}});cc.EaseBezierAction.create=function(a){return new cc.EaseBezierAction(a)};cc.easeBezierAction=function(a,b,c,d){return{easing:function(e){return cc.EaseBezierAction.prototype._updateTime(a,b,c,d,e)},reverse:function(){return cc.easeBezierAction(d,c,b,a)}}};
cc.EaseQuadraticActionIn=cc.ActionEase.extend({_updateTime:function(a){return Math.pow(a,2)},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseQuadraticActionIn;a.initWithAction(this._inner.clone());return a},reverse:function(){return new cc.EaseQuadraticActionIn(this._inner.reverse())}});cc.EaseQuadraticActionIn.create=function(a){return new cc.EaseQuadraticActionIn(a)};cc._easeQuadraticActionIn={easing:cc.EaseQuadraticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionIn}};
cc.easeQuadraticActionIn=function(){return cc._easeQuadraticActionIn};cc.EaseQuadraticActionOut=cc.ActionEase.extend({_updateTime:function(a){return-a*(a-2)},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseQuadraticActionOut;a.initWithAction();return a},reverse:function(){return new cc.EaseQuadraticActionOut(this._inner.reverse())}});cc.EaseQuadraticActionOut.create=function(a){return new cc.EaseQuadraticActionOut(a)};
cc._easeQuadraticActionOut={easing:cc.EaseQuadraticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionOut}};cc.easeQuadraticActionOut=function(){return cc._easeQuadraticActionOut};
cc.EaseQuadraticActionInOut=cc.ActionEase.extend({_updateTime:function(a){var b=a;a*=2;1>a?b=a*a*0.5:(--a,b=-0.5*(a*(a-2)-1));return b},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseQuadraticActionInOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return new cc.EaseQuadraticActionInOut(this._inner.reverse())}});cc.EaseQuadraticActionInOut.create=function(a){return new cc.EaseQuadraticActionInOut(a)};
cc._easeQuadraticActionInOut={easing:cc.EaseQuadraticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuadraticActionInOut}};cc.easeQuadraticActionInOut=function(){return cc._easeQuadraticActionInOut};cc.EaseQuarticActionIn=cc.ActionEase.extend({_updateTime:function(a){return a*a*a*a},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseQuarticActionIn;a.initWithAction(this._inner.clone());return a},reverse:function(){return new cc.EaseQuarticActionIn(this._inner.reverse())}});
cc.EaseQuarticActionIn.create=function(a){return new cc.EaseQuarticActionIn(a)};cc._easeQuarticActionIn={easing:cc.EaseQuarticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuarticActionIn}};cc.easeQuarticActionIn=function(){return cc._easeQuarticActionIn};
cc.EaseQuarticActionOut=cc.ActionEase.extend({_updateTime:function(a){a-=1;return-(a*a*a*a-1)},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseQuarticActionOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return new cc.EaseQuarticActionOut(this._inner.reverse())}});cc.EaseQuarticActionOut.create=function(a){return new cc.EaseQuarticActionOut(a)};cc._easeQuarticActionOut={easing:cc.EaseQuarticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionOut}};
cc.easeQuarticActionOut=function(){return cc._easeQuarticActionOut};cc.EaseQuarticActionInOut=cc.ActionEase.extend({_updateTime:function(a){a*=2;if(1>a)return 0.5*a*a*a*a;a-=2;return-0.5*(a*a*a*a-2)},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseQuarticActionInOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return new cc.EaseQuarticActionInOut(this._inner.reverse())}});cc.EaseQuarticActionInOut.create=function(a){return new cc.EaseQuarticActionInOut(a)};
cc._easeQuarticActionInOut={easing:cc.EaseQuarticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuarticActionInOut}};cc.easeQuarticActionInOut=function(){return cc._easeQuarticActionInOut};cc.EaseQuinticActionIn=cc.ActionEase.extend({_updateTime:function(a){return a*a*a*a*a},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseQuinticActionIn;a.initWithAction(this._inner.clone());return a},reverse:function(){return new cc.EaseQuinticActionIn(this._inner.reverse())}});
cc.EaseQuinticActionIn.create=function(a){return new cc.EaseQuinticActionIn(a)};cc._easeQuinticActionIn={easing:cc.EaseQuinticActionIn.prototype._updateTime,reverse:function(){return cc._easeQuinticActionIn}};cc.easeQuinticActionIn=function(){return cc._easeQuinticActionIn};
cc.EaseQuinticActionOut=cc.ActionEase.extend({_updateTime:function(a){a-=1;return a*a*a*a*a+1},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseQuinticActionOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return new cc.EaseQuinticActionOut(this._inner.reverse())}});cc.EaseQuinticActionOut.create=function(a){return new cc.EaseQuinticActionOut(a)};cc._easeQuinticActionOut={easing:cc.EaseQuinticActionOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionOut}};
cc.easeQuinticActionOut=function(){return cc._easeQuinticActionOut};cc.EaseQuinticActionInOut=cc.ActionEase.extend({_updateTime:function(a){a*=2;if(1>a)return 0.5*a*a*a*a*a;a-=2;return 0.5*(a*a*a*a*a+2)},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseQuinticActionInOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return new cc.EaseQuinticActionInOut(this._inner.reverse())}});cc.EaseQuinticActionInOut.create=function(a){return new cc.EaseQuinticActionInOut(a)};
cc._easeQuinticActionInOut={easing:cc.EaseQuinticActionInOut.prototype._updateTime,reverse:function(){return cc._easeQuinticActionInOut}};cc.easeQuinticActionInOut=function(){return cc._easeQuinticActionInOut};cc.EaseCircleActionIn=cc.ActionEase.extend({_updateTime:function(a){return-1*(Math.sqrt(1-a*a)-1)},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseCircleActionIn;a.initWithAction(this._inner.clone());return a},reverse:function(){return new cc.EaseCircleActionIn(this._inner.reverse())}});
cc.EaseCircleActionIn.create=function(a){return new cc.EaseCircleActionIn(a)};cc._easeCircleActionIn={easing:cc.EaseCircleActionIn.prototype._updateTime,reverse:function(){return cc._easeCircleActionIn}};cc.easeCircleActionIn=function(){return cc._easeCircleActionIn};
cc.EaseCircleActionOut=cc.ActionEase.extend({_updateTime:function(a){a-=1;return Math.sqrt(1-a*a)},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseCircleActionOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return new cc.EaseCircleActionOut(this._inner.reverse())}});cc.EaseCircleActionOut.create=function(a){return new cc.EaseCircleActionOut(a)};cc._easeCircleActionOut={easing:cc.EaseCircleActionOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionOut}};
cc.easeCircleActionOut=function(){return cc._easeCircleActionOut};cc.EaseCircleActionInOut=cc.ActionEase.extend({_updateTime:function(a){a*=2;if(1>a)return-0.5*(Math.sqrt(1-a*a)-1);a-=2;return 0.5*(Math.sqrt(1-a*a)+1)},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseCircleActionInOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return new cc.EaseCircleActionInOut(this._inner.reverse())}});cc.EaseCircleActionInOut.create=function(a){return new cc.EaseCircleActionInOut(a)};
cc._easeCircleActionInOut={easing:cc.EaseCircleActionInOut.prototype._updateTime,reverse:function(){return cc._easeCircleActionInOut}};cc.easeCircleActionInOut=function(){return cc._easeCircleActionInOut};cc.EaseCubicActionIn=cc.ActionEase.extend({_updateTime:function(a){return a*a*a},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseCubicActionIn;a.initWithAction(this._inner.clone());return a},reverse:function(){return new cc.EaseCubicActionIn(this._inner.reverse())}});
cc.EaseCubicActionIn.create=function(a){return new cc.EaseCubicActionIn(a)};cc._easeCubicActionIn={easing:cc.EaseCubicActionIn.prototype._updateTime,reverse:function(){return cc._easeCubicActionIn}};cc.easeCubicActionIn=function(){return cc._easeCubicActionIn};
cc.EaseCubicActionOut=cc.ActionEase.extend({_updateTime:function(a){a-=1;return a*a*a+1},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseCubicActionOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return new cc.EaseCubicActionOut(this._inner.reverse())}});cc.EaseCubicActionOut.create=function(a){return new cc.EaseCubicActionOut(a)};cc._easeCubicActionOut={easing:cc.EaseCubicActionOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionOut}};
cc.easeCubicActionOut=function(){return cc._easeCubicActionOut};cc.EaseCubicActionInOut=cc.ActionEase.extend({_updateTime:function(a){a*=2;if(1>a)return 0.5*a*a*a;a-=2;return 0.5*(a*a*a+2)},update:function(a){this._inner.update(this._updateTime(a))},clone:function(){var a=new cc.EaseCubicActionInOut;a.initWithAction(this._inner.clone());return a},reverse:function(){return new cc.EaseCubicActionInOut(this._inner.reverse())}});cc.EaseCubicActionInOut.create=function(a){return new cc.EaseCubicActionInOut(a)};
cc._easeCubicActionInOut={easing:cc.EaseCubicActionInOut.prototype._updateTime,reverse:function(){return cc._easeCubicActionInOut}};cc.easeCubicActionInOut=function(){return cc._easeCubicActionInOut};cc.cardinalSplineAt=function(a,b,c,d,e,f,g){var h=f*f,k=h*f,m=(1-e)/2;e=m*(-k+2*h-f);var n=m*(-k+h)+(2*k-3*h+1);f=m*(k-2*h+f)+(-2*k+3*h);k=m*(k-h);h=a.x*e+b.x*n+c.x*f+d.x*k;a=a.y*e+b.y*n+c.y*f+d.y*k;if(void 0!==g)g.x=h,g.y=a;else return cc.p(h,a)};cc.reverseControlPoints=function(a){for(var b=[],c=a.length-1;0<=c;c--)b.push(cc.p(a[c].x,a[c].y));return b};cc.cloneControlPoints=function(a){for(var b=[],c=0;c<a.length;c++)b.push(cc.p(a[c].x,a[c].y));return b};cc.copyControlPoints=cc.cloneControlPoints;
cc.getControlPointAt=function(a,b){var c=Math.min(a.length-1,Math.max(b,0));return a[c]};cc.reverseControlPointsInline=function(a){for(var b=a.length,c=0|b/2,d=0;d<c;++d){var e=a[d];a[d]=a[b-d-1];a[b-d-1]=e}};
cc.CardinalSplineTo=cc.ActionInterval.extend({_points:null,_deltaT:0,_tension:0,_previousPosition:null,_accumulatedDiff:null,ctor:function(a,b,c){cc.ActionInterval.prototype.ctor.call(this);this._points=[];void 0!==c&&this.initWithDuration(a,b,c)},initWithDuration:function(a,b,c){if(!b||0===b.length)throw Error("Invalid configuration. It must at least have one control point");return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this.setPoints(b),this._tension=c,!0):!1},clone:function(){var a=
new cc.CardinalSplineTo;a.initWithDuration(this._duration,cc.copyControlPoints(this._points),this._tension);return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);this._deltaT=1/(this._points.length-1);this._previousPosition=cc.p(this.target.getPositionX(),this.target.getPositionY());this._accumulatedDiff=cc.p(0,0)},update:function(a){a=this._computeEaseTime(a);var b,c=this._points;if(1===a)b=c.length-1,a=1;else{var d=this._deltaT;b=0|a/d;a=(a-d*b)/d}b=cc.cardinalSplineAt(cc.getControlPointAt(c,
b-1),cc.getControlPointAt(c,b-0),cc.getControlPointAt(c,b+1),cc.getControlPointAt(c,b+2),this._tension,a);cc.ENABLE_STACKABLE_ACTIONS&&(c=this.target.getPositionX()-this._previousPosition.x,a=this.target.getPositionY()-this._previousPosition.y,0!==c||0!==a)&&(d=this._accumulatedDiff,c=d.x+c,a=d.y+a,d.x=c,d.y=a,b.x+=c,b.y+=a);this.updatePosition(b)},reverse:function(){var a=cc.reverseControlPoints(this._points);return cc.cardinalSplineTo(this._duration,a,this._tension)},updatePosition:function(a){this.target.setPosition(a);
this._previousPosition=a},getPoints:function(){return this._points},setPoints:function(a){this._points=a}});cc.cardinalSplineTo=function(a,b,c){return new cc.CardinalSplineTo(a,b,c)};cc.CardinalSplineTo.create=cc.cardinalSplineTo;
cc.CardinalSplineBy=cc.CardinalSplineTo.extend({_startPosition:null,ctor:function(a,b,c){cc.CardinalSplineTo.prototype.ctor.call(this);this._startPosition=cc.p(0,0);void 0!==c&&this.initWithDuration(a,b,c)},startWithTarget:function(a){cc.CardinalSplineTo.prototype.startWithTarget.call(this,a);this._startPosition.x=a.getPositionX();this._startPosition.y=a.getPositionY()},reverse:function(){for(var a=this._points.slice(),b,c=a[0],d=1;d<a.length;++d)b=a[d],a[d]=cc.pSub(b,c),c=b;a=cc.reverseControlPoints(a);
c=a[a.length-1];a.pop();c.x=-c.x;c.y=-c.y;a.unshift(c);for(d=1;d<a.length;++d)b=a[d],b.x=-b.x,b.y=-b.y,b.x+=c.x,b.y+=c.y,c=a[d]=b;return cc.cardinalSplineBy(this._duration,a,this._tension)},updatePosition:function(a){var b=this._startPosition,c=a.x+b.x;a=a.y+b.y;this._previousPosition.x=c;this._previousPosition.y=a;this.target.setPosition(c,a)},clone:function(){var a=new cc.CardinalSplineBy;a.initWithDuration(this._duration,cc.copyControlPoints(this._points),this._tension);return a}});
cc.cardinalSplineBy=function(a,b,c){return new cc.CardinalSplineBy(a,b,c)};cc.CardinalSplineBy.create=cc.cardinalSplineBy;cc.CatmullRomTo=cc.CardinalSplineTo.extend({ctor:function(a,b){b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,a,b,0.5)},clone:function(){var a=new cc.CatmullRomTo;a.initWithDuration(this._duration,cc.copyControlPoints(this._points));return a}});
cc.catmullRomTo=function(a,b){return new cc.CatmullRomTo(a,b)};cc.CatmullRomTo.create=cc.catmullRomTo;cc.CatmullRomBy=cc.CardinalSplineBy.extend({ctor:function(a,b){cc.CardinalSplineBy.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){return cc.CardinalSplineTo.prototype.initWithDuration.call(this,a,b,0.5)},clone:function(){var a=new cc.CatmullRomBy;a.initWithDuration(this._duration,cc.copyControlPoints(this._points));return a}});
cc.catmullRomBy=function(a,b){return new cc.CatmullRomBy(a,b)};cc.CatmullRomBy.create=cc.catmullRomBy;cc.ActionTweenDelegate=cc.Class.extend({updateTweenAction:function(a,b){}});
cc.ActionTween=cc.ActionInterval.extend({key:"",from:0,to:0,delta:0,ctor:function(a,b,c,d){cc.ActionInterval.prototype.ctor.call(this);this.key="";void 0!==d&&this.initWithDuration(a,b,c,d)},initWithDuration:function(a,b,c,d){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this.key=b,this.to=d,this.from=c,!0):!1},startWithTarget:function(a){if(!a||!a.updateTweenAction)throw Error("cc.ActionTween.startWithTarget(): target must be non-null, and target must implement updateTweenAction function");cc.ActionInterval.prototype.startWithTarget.call(this,
a);this.delta=this.to-this.from},update:function(a){this.target.updateTweenAction(this.to-this.delta*(1-a),this.key)},reverse:function(){return new cc.ActionTween(this.duration,this.key,this.to,this.from)},clone:function(){var a=new cc.ActionTween;a.initWithDuration(this._duration,this.key,this.from,this.to);return a}});cc.actionTween=function(a,b,c,d){return new cc.ActionTween(a,b,c,d)};cc.ActionTween.create=cc.actionTween;cc.GridAction=cc.ActionInterval.extend({_gridSize:null,_gridNodeTarget:null,ctor:function(a,b){cc.sys._checkWebGLRenderMode();cc.ActionInterval.prototype.ctor.call(this);this._gridSize=cc.size(0,0);b&&this.initWithDuration(a,b)},_cacheTargetAsGridNode:function(a){this._gridNodeTarget=a},clone:function(){var a=new cc.GridAction,b=this._gridSize;a.initWithDuration(this._duration,cc.size(b.width,b.height));return a},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a);
cc.renderer.childrenOrderDirty=!0;this._cacheTargetAsGridNode(a);var b=this.getGrid();(a=this._gridNodeTarget.getGrid())&&0<a.getReuseGrid()?(b=a.getGridSize(),a.isActive()&&b.width===this._gridSize.width&&b.height===this._gridSize.height&&a.reuse()):(a&&a.isActive()&&a.setActive(!1),this._gridNodeTarget.setGrid(b),this._gridNodeTarget.getGrid().setActive(!0))},reverse:function(){return new cc.ReverseTime(this)},initWithDuration:function(a,b){return cc.ActionInterval.prototype.initWithDuration.call(this,
a)?(this._gridSize.width=b.width,this._gridSize.height=b.height,!0):!1},getGrid:function(){cc.log("cc.GridAction.getGrid(): it should be overridden in subclass.")}});cc.gridAction=function(a,b){return new cc.GridAction(a,b)};cc.GridAction.create=cc.gridAction;
cc.Grid3DAction=cc.GridAction.extend({getGrid:function(){return new cc.Grid3D(this._gridSize,void 0,void 0,this._gridNodeTarget.getGridRect())},getGridRect:function(){return this._gridNodeTarget.getGridRect()},vertex:function(a){return this.getVertex(a)},getVertex:function(a){return this.target.grid.getVertex(a)},originalVertex:function(a){return this.getOriginalVertex(a)},getOriginalVertex:function(a){return this.target.grid.originalVertex(a)},setVertex:function(a,b){this.target.grid.setVertex(a,
b)}});cc.grid3DAction=function(a,b){return new cc.Grid3DAction(a,b)};cc.Grid3DAction.create=cc.grid3DAction;cc.TiledGrid3DAction=cc.GridAction.extend({tile:function(a){return this.getTile(a)},getTile:function(a){return this.target.grid.tile(a)},originalTile:function(a){return this.getOriginalTile(a)},getOriginalTile:function(a){return this.target.grid.originalTile(a)},setTile:function(a,b){this.target.grid.setTile(a,b)},getGrid:function(){return new cc.TiledGrid3D(this._gridSize,void 0,void 0,this._gridNodeTarget.getGridRect())}});
cc.tiledGrid3DAction=function(a,b){return new cc.TiledGrid3DAction(a,b)};cc.TiledGrid3DAction.create=cc.tiledGrid3DAction;cc.StopGrid=cc.ActionInstant.extend({startWithTarget:function(a){cc.ActionInstant.prototype.startWithTarget.call(this,a);cc.renderer.childrenOrderDirty=!0;(a=this.target.grid)&&a.isActive()&&a.setActive(!1)}});cc.stopGrid=function(){return new cc.StopGrid};cc.StopGrid.create=cc.stopGrid;
cc.ReuseGrid=cc.ActionInstant.extend({_times:null,ctor:function(a){cc.ActionInstant.prototype.ctor.call(this);void 0!==a&&this.initWithTimes(a)},initWithTimes:function(a){this._times=a;return!0},startWithTarget:function(a){cc.ActionInstant.prototype.startWithTarget.call(this,a);cc.renderer.childrenOrderDirty=!0;this.target.grid&&this.target.grid.isActive()&&this.target.grid.setReuseGrid(this.target.grid.getReuseGrid()+this._times)}});cc.reuseGrid=function(a){return new cc.ReuseGrid(a)};
cc.ReuseGrid.create=cc.reuseGrid;cc.Waves3D=cc.Grid3DAction.extend({_waves:0,_amplitude:0,_amplitudeRate:0,ctor:function(a,b,c,d){cc.GridAction.prototype.ctor.call(this);void 0!==d&&this.initWithDuration(a,b,c,d)},getAmplitude:function(){return this._amplitude},setAmplitude:function(a){this._amplitude=a},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(a){this._amplitudeRate=a},initWithDuration:function(a,b,c,d){return cc.Grid3DAction.prototype.initWithDuration.call(this,a,b)?(this._waves=c,this._amplitude=
d,this._amplitudeRate=1,!0):!1},update:function(a){for(var b=this._gridSize,c=this._amplitude,d=cc.p(0,0),e=this._amplitudeRate,f=this._waves,g=0;g<b.width+1;++g)for(var h=0;h<b.height+1;++h){d.x=g;d.y=h;var k=this.originalVertex(d);k.z+=Math.sin(Math.PI*a*f*2+0.01*(k.y+k.x))*c*e;this.setVertex(d,k)}}});cc.waves3D=function(a,b,c,d){return new cc.Waves3D(a,b,c,d)};cc.Waves3D.create=cc.waves3D;
cc.FlipX3D=cc.Grid3DAction.extend({ctor:function(a){void 0!==a?cc.GridAction.prototype.ctor.call(this,a,cc.size(1,1)):cc.GridAction.prototype.ctor.call(this)},initWithDuration:function(a){return cc.Grid3DAction.prototype.initWithDuration.call(this,a,cc.size(1,1))},initWithSize:function(a,b){return 1!==a.width||1!==a.height?(cc.log("Grid size must be (1,1)"),!1):cc.Grid3DAction.prototype.initWithDuration.call(this,b,a)},update:function(a){var b=Math.PI*a;a=Math.sin(b);var c=Math.cos(b/2),b=new cc.Vertex3F,
d=cc.p(0,0);d.x=d.y=1;var e=this.originalVertex(d);d.x=d.y=0;var d=this.originalVertex(d),f=e.x,g=d.x,h,k;f>g?(e=cc.p(0,0),d=cc.p(0,1),h=cc.p(1,0),k=cc.p(1,1)):(h=cc.p(0,0),k=cc.p(0,1),e=cc.p(1,0),d=cc.p(1,1),f=g);b.x=f-f*c;b.z=Math.abs(parseFloat(f*a/4));a=this.originalVertex(e);a.x=b.x;a.z+=b.z;this.setVertex(e,a);a=this.originalVertex(d);a.x=b.x;a.z+=b.z;this.setVertex(d,a);a=this.originalVertex(h);a.x-=b.x;a.z-=b.z;this.setVertex(h,a);a=this.originalVertex(k);a.x-=b.x;a.z-=b.z;this.setVertex(k,
a)}});cc.flipX3D=function(a){return new cc.FlipX3D(a)};cc.FlipX3D.create=cc.flipX3D;
cc.FlipY3D=cc.FlipX3D.extend({ctor:function(a){void 0!==a?cc.GridAction.prototype.ctor.call(this,a,cc.size(1,1)):cc.GridAction.prototype.ctor.call(this)},update:function(a){var b=Math.PI*a;a=Math.sin(b);var c=Math.cos(b/2),b=new cc.Vertex3F,d=cc.p(0,0);d.x=d.y=1;var e=this.originalVertex(d);d.x=d.y=0;var d=this.originalVertex(d),f=e.y,g=d.y,h,k;f>g?(e=cc.p(0,0),d=cc.p(0,1),h=cc.p(1,0),k=cc.p(1,1)):(d=cc.p(0,0),e=cc.p(0,1),k=cc.p(1,0),h=cc.p(1,1),f=g);b.y=f-f*c;b.z=Math.abs(parseFloat(f*a)/4);a=this.originalVertex(e);
a.y=b.y;a.z+=b.z;this.setVertex(e,a);a=this.originalVertex(d);a.y-=b.y;a.z-=b.z;this.setVertex(d,a);a=this.originalVertex(h);a.y=b.y;a.z+=b.z;this.setVertex(h,a);a=this.originalVertex(k);a.y-=b.y;a.z-=b.z;this.setVertex(k,a)}});cc.flipY3D=function(a){return new cc.FlipY3D(a)};cc.FlipY3D.create=cc.flipY3D;
cc.Lens3D=cc.Grid3DAction.extend({_position:null,_radius:0,_lensEffect:0,_concave:!1,_dirty:!1,ctor:function(a,b,c,d){cc.GridAction.prototype.ctor.call(this);this._position=cc.p(0,0);void 0!==d&&this.initWithDuration(a,b,c,d)},getLensEffect:function(){return this._lensEffect},setLensEffect:function(a){this._lensEffect=a},setConcave:function(a){this._concave=a},getPosition:function(){return this._position},setPosition:function(a){cc.pointEqualToPoint(a,this._position)||(this._position.x=a.x,this._position.y=
a.y,this._dirty=!0)},initWithDuration:function(a,b,c,d){return cc.Grid3DAction.prototype.initWithDuration.call(this,a,b)?(this.setPosition(c),this._radius=d,this._lensEffect=0.7,this._dirty=!0):!1},update:function(a){if(this._dirty){a=this._gridSize.width;for(var b=this._gridSize.height,c=this._radius,d=this._lensEffect,e=cc.p(0,0),f=cc.p(0,0),g,h,k,m=0;m<a+1;++m)for(var n=0;n<b+1;++n)e.x=m,e.y=n,g=this.originalVertex(e),f.x=this._position.x-g.x,f.y=this._position.y-g.y,h=cc.pLength(f),h<c&&(h=c-
h,h/=c,0===h&&(h=0.001),h=Math.log(h)*d,k=Math.exp(h)*c,h=cc.pLength(f),0<h&&(f.x/=h,f.y/=h,f.x*=k,f.y*=k,g.z+=cc.pLength(f)*d)),this.setVertex(e,g);this._dirty=!1}}});cc.lens3D=function(a,b,c,d){return new cc.Lens3D(a,b,c,d)};cc.Lens3D.create=cc.lens3D;
cc.Ripple3D=cc.Grid3DAction.extend({_position:null,_radius:0,_waves:0,_amplitude:0,_amplitudeRate:0,ctor:function(a,b,c,d,e,f){cc.GridAction.prototype.ctor.call(this);this._position=cc.p(0,0);void 0!==f&&this.initWithDuration(a,b,c,d,e,f)},getPosition:function(){return this._position},setPosition:function(a){this._position.x=a.x;this._position.y=a.y},getAmplitude:function(){return this._amplitude},setAmplitude:function(a){this._amplitude=a},getAmplitudeRate:function(){return this._amplitudeRate},
setAmplitudeRate:function(a){this._amplitudeRate=a},initWithDuration:function(a,b,c,d,e,f){return cc.Grid3DAction.prototype.initWithDuration.call(this,a,b)?(this.setPosition(c),this._radius=d,this._waves=e,this._amplitude=f,this._amplitudeRate=1,!0):!1},update:function(a){for(var b=this._gridSize.width,c=this._gridSize.height,d=cc.p(0,0),e=this._radius,f=this._waves,g=this._amplitude,h=this._amplitudeRate,k,m,n=cc.p(0,0),p=0;p<b+1;++p)for(var r=0;r<c+1;++r){d.x=p;d.y=r;k=this.originalVertex(d);n.x=
this._position.x-k.x;n.y=this._position.y-k.y;m=cc.pLength(n);if(m<e){m=e-m;var s=Math.pow(m/e,2);k.z+=Math.sin(a*Math.PI*f*2+0.1*m)*g*h*s}this.setVertex(d,k)}}});cc.ripple3D=function(a,b,c,d,e,f){return new cc.Ripple3D(a,b,c,d,e,f)};cc.Ripple3D.create=cc.ripple3D;
cc.Shaky3D=cc.Grid3DAction.extend({_randRange:0,_shakeZ:!1,ctor:function(a,b,c,d){cc.GridAction.prototype.ctor.call(this);void 0!==d&&this.initWithDuration(a,b,c,d)},initWithDuration:function(a,b,c,d){return cc.Grid3DAction.prototype.initWithDuration.call(this,a,b)?(this._randRange=c,this._shakeZ=d,!0):!1},update:function(a){a=this._gridSize.width;for(var b=this._gridSize.height,c=this._randRange,d=this._shakeZ,e=cc.p(0,0),f,g=0;g<a+1;++g)for(var h=0;h<b+1;++h)e.x=g,e.y=h,f=this.originalVertex(e),
f.x+=cc.rand()%(2*c)-c,f.y+=cc.rand()%(2*c)-c,d&&(f.z+=cc.rand()%(2*c)-c),this.setVertex(e,f)}});cc.shaky3D=function(a,b,c,d){return new cc.Shaky3D(a,b,c,d)};cc.Shaky3D.create=cc.shaky3D;
cc.Liquid=cc.Grid3DAction.extend({_waves:0,_amplitude:0,_amplitudeRate:0,ctor:function(a,b,c,d){cc.GridAction.prototype.ctor.call(this);void 0!==d&&this.initWithDuration(a,b,c,d)},getAmplitude:function(){return this._amplitude},setAmplitude:function(a){this._amplitude=a},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(a){this._amplitudeRate=a},initWithDuration:function(a,b,c,d){return cc.Grid3DAction.prototype.initWithDuration.call(this,a,b)?(this._waves=c,this._amplitude=
d,this._amplitudeRate=1,!0):!1},update:function(a){for(var b=this._gridSize.width,c=this._gridSize.height,d=cc.p(0,0),e=this._waves,f=this._amplitude,g=this._amplitudeRate,h,k=1;k<b;++k)for(var m=1;m<c;++m)d.x=k,d.y=m,h=this.originalVertex(d),h.x+=Math.sin(a*Math.PI*e*2+0.01*h.x)*f*g,h.y+=Math.sin(a*Math.PI*e*2+0.01*h.y)*f*g,this.setVertex(d,h)}});cc.liquid=function(a,b,c,d){return new cc.Liquid(a,b,c,d)};cc.Liquid.create=cc.liquid;
cc.Waves=cc.Grid3DAction.extend({_waves:0,_amplitude:0,_amplitudeRate:0,_vertical:!1,_horizontal:!1,ctor:function(a,b,c,d,e,f){cc.GridAction.prototype.ctor.call(this);void 0!==f&&this.initWithDuration(a,b,c,d,e,f)},getAmplitude:function(){return this._amplitude},setAmplitude:function(a){this._amplitude=a},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(a){this._amplitudeRate=a},initWithDuration:function(a,b,c,d,e,f){return cc.Grid3DAction.prototype.initWithDuration.call(this,
a,b)?(this._waves=c,this._amplitude=d,this._amplitudeRate=1,this._horizontal=e,this._vertical=f,!0):!1},update:function(a){for(var b=this._gridSize.width,c=this._gridSize.height,d=cc.p(0,0),e=this._vertical,f=this._horizontal,g=this._waves,h=this._amplitude,k=this._amplitudeRate,m,n=0;n<b+1;++n)for(var p=0;p<c+1;++p)d.x=n,d.y=p,m=this.originalVertex(d),e&&(m.x+=Math.sin(a*Math.PI*g*2+0.01*m.y)*h*k),f&&(m.y+=Math.sin(a*Math.PI*g*2+0.01*m.x)*h*k),this.setVertex(d,m)}});
cc.waves=function(a,b,c,d,e,f){return new cc.Waves(a,b,c,d,e,f)};cc.Waves.create=cc.waves;
cc.Twirl=cc.Grid3DAction.extend({_position:null,_twirls:0,_amplitude:0,_amplitudeRate:0,ctor:function(a,b,c,d,e){cc.GridAction.prototype.ctor.call(this);this._position=cc.p(0,0);void 0!==e&&this.initWithDuration(a,b,c,d,e)},getPosition:function(){return this._position},setPosition:function(a){this._position.x=a.x;this._position.y=a.y},getAmplitude:function(){return this._amplitude},setAmplitude:function(a){this._amplitude=a},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(a){this._amplitudeRate=
a},initWithDuration:function(a,b,c,d,e){return cc.Grid3DAction.prototype.initWithDuration.call(this,a,b)?(this.setPosition(c),this._twirls=d,this._amplitude=e,this._amplitudeRate=1,!0):!1},update:function(a){for(var b=this._position,c=this._gridSize.width,d=this._gridSize.height,e=cc.p(0,0),f=0.1*this._amplitude*this._amplitudeRate,g=this._twirls,h,k,m,n=cc.p(0,0),p=0;p<c+1;++p)for(var r=0;r<d+1;++r)e.x=p,e.y=r,h=this.originalVertex(e),n.x=p-c/2,n.y=r-d/2,k=cc.pLength(n)*Math.cos(Math.PI/2+a*Math.PI*
g*2)*f,m=Math.sin(k)*(h.y-b.y)+Math.cos(k)*(h.x-b.x),k=Math.cos(k)*(h.y-b.y)-Math.sin(k)*(h.x-b.x),h.x=b.x+m,h.y=b.y+k,this.setVertex(e,h)}});cc.twirl=function(a,b,c,d,e){return new cc.Twirl(a,b,c,d,e)};cc.Twirl.create=cc.twirl;cc.ShakyTiles3D=cc.TiledGrid3DAction.extend({_randRange:0,_shakeZ:!1,ctor:function(a,b,c,d){cc.GridAction.prototype.ctor.call(this);void 0!==d&&this.initWithDuration(a,b,c,d)},initWithDuration:function(a,b,c,d){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,a,b)?(this._randRange=c,this._shakeZ=d,!0):!1},update:function(a){a=this._gridSize;for(var b=this._randRange,c=cc.p(0,0),d=0;d<a.width;++d)for(var e=0;e<a.height;++e){c.x=d;c.y=e;var f=this.originalTile(c);f.bl.x+=cc.rand()%(2*
b)-b;f.br.x+=cc.rand()%(2*b)-b;f.tl.x+=cc.rand()%(2*b)-b;f.tr.x+=cc.rand()%(2*b)-b;f.bl.y+=cc.rand()%(2*b)-b;f.br.y+=cc.rand()%(2*b)-b;f.tl.y+=cc.rand()%(2*b)-b;f.tr.y+=cc.rand()%(2*b)-b;this._shakeZ&&(f.bl.z+=cc.rand()%(2*b)-b,f.br.z+=cc.rand()%(2*b)-b,f.tl.z+=cc.rand()%(2*b)-b,f.tr.z+=cc.rand()%(2*b)-b);this.setTile(c,f)}}});cc.shakyTiles3D=function(a,b,c,d){return new cc.ShakyTiles3D(a,b,c,d)};cc.ShakyTiles3D.create=cc.shakyTiles3D;
cc.ShatteredTiles3D=cc.TiledGrid3DAction.extend({_randRange:0,_once:!1,_shatterZ:!1,ctor:function(a,b,c,d){cc.GridAction.prototype.ctor.call(this);void 0!==d&&this.initWithDuration(a,b,c,d)},initWithDuration:function(a,b,c,d){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,a,b)?(this._once=!1,this._randRange=c,this._shatterZ=d,!0):!1},update:function(a){if(!1===this._once){a=this._gridSize;for(var b=this._randRange,c,d=cc.p(0,0),e=0;e<a.width;++e)for(var f=0;f<a.height;++f)d.x=e,
d.y=f,c=this.originalTile(d),c.bl.x+=cc.rand()%(2*b)-b,c.br.x+=cc.rand()%(2*b)-b,c.tl.x+=cc.rand()%(2*b)-b,c.tr.x+=cc.rand()%(2*b)-b,c.bl.y+=cc.rand()%(2*b)-b,c.br.y+=cc.rand()%(2*b)-b,c.tl.y+=cc.rand()%(2*b)-b,c.tr.y+=cc.rand()%(2*b)-b,this._shatterZ&&(c.bl.z+=cc.rand()%(2*b)-b,c.br.z+=cc.rand()%(2*b)-b,c.tl.z+=cc.rand()%(2*b)-b,c.tr.z+=cc.rand()%(2*b)-b),this.setTile(d,c);this._once=!0}}});cc.shatteredTiles3D=function(a,b,c,d){return new cc.ShatteredTiles3D(a,b,c,d)};
cc.ShatteredTiles3D.create=cc.shatteredTiles3D;cc.Tile=function(a,b,c){this.position=a||cc.p(0,0);this.startPosition=b||cc.p(0,0);this.delta=c||cc.p(0,0)};
cc.ShuffleTiles=cc.TiledGrid3DAction.extend({_seed:0,_tilesCount:0,_tilesOrder:null,_tiles:null,ctor:function(a,b,c){cc.GridAction.prototype.ctor.call(this);this._tilesOrder=[];this._tiles=[];void 0!==c&&this.initWithDuration(a,b,c)},initWithDuration:function(a,b,c){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,a,b)?(this._seed=c,this._tilesOrder.length=0,this._tiles.length=0,!0):!1},shuffle:function(a,b){for(var c=b-1;0<=c;c--){var d=0|cc.rand()%(c+1),e=a[c];a[c]=a[d];a[d]=e}},
getDelta:function(a){var b=this._gridSize,c=a.width*b.height+a.height;return cc.size(this._tilesOrder[c]/b.height-a.width,this._tilesOrder[c]%b.height-a.height)},placeTile:function(a,b){var c=this.originalTile(a),d=this.target.grid.getStep(),e=b.position;c.bl.x+=e.x*d.x;c.bl.y+=e.y*d.y;c.br.x+=e.x*d.x;c.br.y+=e.y*d.y;c.tl.x+=e.x*d.x;c.tl.y+=e.y*d.y;c.tr.x+=e.x*d.x;c.tr.y+=e.y*d.y;this.setTile(a,c)},startWithTarget:function(a){cc.TiledGrid3DAction.prototype.startWithTarget.call(this,a);a=this._gridSize;
this._tilesCount=a.width*a.height;for(var b=this._tilesOrder,c=b.length=0;c<this._tilesCount;++c)b[c]=c;this.shuffle(b,this._tilesCount);for(var b=this._tiles,c=b.length=0,d=cc.size(0,0),e=0;e<a.width;++e)for(var f=0;f<a.height;++f)b[c]=new cc.Tile,b[c].position=cc.p(e,f),b[c].startPosition=cc.p(e,f),d.width=e,d.height=f,b[c].delta=this.getDelta(d),++c},update:function(a){for(var b=0,c=this._gridSize,d=this._tiles,e,f=cc.p(0,0),g=0;g<c.width;++g)for(var h=0;h<c.height;++h)f.x=g,f.y=h,e=d[b],e.position.x=
e.delta.width*a,e.position.y=e.delta.height*a,this.placeTile(f,e),++b}});cc.shuffleTiles=function(a,b,c){return new cc.ShuffleTiles(a,b,c)};cc.ShuffleTiles.create=cc.shuffleTiles;
cc.FadeOutTRTiles=cc.TiledGrid3DAction.extend({testFunc:function(a,b){var c=this._gridSize.width*b,d=this._gridSize.height*b;return c===this._gridSize.width&&d===this._gridSize.height?0:0===c+d?1:Math.pow((a.x+a.y)/(c+d),6)},turnOnTile:function(a){this.setTile(a,this.originalTile(a))},turnOffTile:function(a){this.setTile(a,new cc.Quad3)},transformTile:function(a,b){var c=this.originalTile(a),d=this.target.grid.getStep();c.bl.x+=d.x/2*(1-b);c.bl.y+=d.y/2*(1-b);c.br.x-=d.x/2*(1-b);c.br.y+=d.y/2*(1-
b);c.tl.x+=d.x/2*(1-b);c.tl.y-=d.y/2*(1-b);c.tr.x-=d.x/2*(1-b);c.tr.y-=d.y/2*(1-b);this.setTile(a,c)},update:function(a){for(var b=this._gridSize,c=cc.p(0,0),d,e=0;e<b.width;++e)for(var f=0;f<b.height;++f)c.x=e,c.y=f,d=this.testFunc(c,a),0===d?this.turnOffTile(c):1>d?this.transformTile(c,d):this.turnOnTile(c)}});cc.fadeOutTRTiles=function(a,b){return new cc.FadeOutTRTiles(a,b)};cc.FadeOutTRTiles.create=cc.fadeOutTRTiles;
cc.FadeOutBLTiles=cc.FadeOutTRTiles.extend({testFunc:function(a,b){var c=this._gridSize.width*(1-b),d=this._gridSize.height*(1-b);return 0===c+d?0:0===a.x+a.y?1:Math.pow((c+d)/(a.x+a.y),6)}});cc.fadeOutBLTiles=function(a,b){return new cc.FadeOutBLTiles(a,b)};cc.FadeOutBLTiles.create=cc.fadeOutBLTiles;
cc.FadeOutUpTiles=cc.FadeOutTRTiles.extend({testFunc:function(a,b){var c=this._gridSize.height*b;return c===this._gridSize.height?0:0===c?1:Math.pow(a.y/c,6)},transformTile:function(a,b){var c=this.originalTile(a),d=this.target.grid.getStep();c.bl.y+=d.y/2*(1-b);c.br.y+=d.y/2*(1-b);c.tl.y-=d.y/2*(1-b);c.tr.y-=d.y/2*(1-b);this.setTile(a,c)}});cc.fadeOutUpTiles=function(a,b){return new cc.FadeOutUpTiles(a,b)};cc.FadeOutUpTiles.create=cc.fadeOutUpTiles;
cc.FadeOutDownTiles=cc.FadeOutUpTiles.extend({testFunc:function(a,b){var c=this._gridSize.height*(1-b);return 0===c?0:0===a.y?1:Math.pow(c/a.y,6)}});cc.fadeOutDownTiles=function(a,b){return new cc.FadeOutDownTiles(a,b)};cc.FadeOutDownTiles.create=cc.fadeOutDownTiles;
cc.TurnOffTiles=cc.TiledGrid3DAction.extend({_seed:null,_tilesCount:0,_tilesOrder:null,ctor:function(a,b,c){cc.GridAction.prototype.ctor.call(this);this._tilesOrder=[];void 0!==b&&this.initWithDuration(a,b,c)},initWithDuration:function(a,b,c){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,a,b)?(this._seed=c||0,this._tilesOrder.length=0,!0):!1},shuffle:function(a,b){for(var c=b-1;0<=c;c--){var d=0|cc.rand()%(c+1),e=a[c];a[c]=a[d];a[d]=e}},turnOnTile:function(a){this.setTile(a,this.originalTile(a))},
turnOffTile:function(a){this.setTile(a,new cc.Quad3)},startWithTarget:function(a){cc.TiledGrid3DAction.prototype.startWithTarget.call(this,a);this._tilesCount=this._gridSize.width*this._gridSize.height;a=this._tilesOrder;for(var b=a.length=0;b<this._tilesCount;++b)a[b]=b;this.shuffle(a,this._tilesCount)},update:function(a){a=0|a*this._tilesCount;for(var b=this._gridSize,c,d=cc.p(0,0),e=this._tilesOrder,f=0;f<this._tilesCount;f++)c=e[f],d.x=0|c/b.height,d.y=c%(0|b.height),f<a?this.turnOffTile(d):this.turnOnTile(d)}});
cc.turnOffTiles=function(a,b,c){return new cc.TurnOffTiles(a,b,c)};cc.TurnOffTiles.create=cc.turnOffTiles;
cc.WavesTiles3D=cc.TiledGrid3DAction.extend({_waves:0,_amplitude:0,_amplitudeRate:0,ctor:function(a,b,c,d){cc.GridAction.prototype.ctor.call(this);void 0!==d&&this.initWithDuration(a,b,c,d)},getAmplitude:function(){return this._amplitude},setAmplitude:function(a){this._amplitude=a},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(a){this._amplitudeRate=a},initWithDuration:function(a,b,c,d){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,a,b)?(this._waves=
c,this._amplitude=d,this._amplitudeRate=1,!0):!1},update:function(a){for(var b=this._gridSize,c=this._waves,d=this._amplitude,e=this._amplitudeRate,f=cc.p(0,0),g,h=0;h<b.width;h++)for(var k=0;k<b.height;k++)f.x=h,f.y=k,g=this.originalTile(f),g.bl.z=Math.sin(a*Math.PI*c*2+0.01*(g.bl.y+g.bl.x))*d*e,g.br.z=g.bl.z,g.tl.z=g.bl.z,g.tr.z=g.bl.z,this.setTile(f,g)}});cc.wavesTiles3D=function(a,b,c,d){return new cc.WavesTiles3D(a,b,c,d)};cc.WavesTiles3D.create=cc.wavesTiles3D;
cc.JumpTiles3D=cc.TiledGrid3DAction.extend({_jumps:0,_amplitude:0,_amplitudeRate:0,ctor:function(a,b,c,d){cc.GridAction.prototype.ctor.call(this);void 0!==d&&this.initWithDuration(a,b,c,d)},getAmplitude:function(){return this._amplitude},setAmplitude:function(a){this._amplitude=a},getAmplitudeRate:function(){return this._amplitudeRate},setAmplitudeRate:function(a){this._amplitudeRate=a},initWithDuration:function(a,b,c,d){return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,a,b)?(this._jumps=
c,this._amplitude=d,this._amplitudeRate=1,!0):!1},update:function(a){var b=Math.sin(Math.PI*a*this._jumps*2)*this._amplitude*this._amplitudeRate;a=Math.sin(Math.PI*(a*this._jumps*2+1))*this._amplitude*this._amplitudeRate;for(var c=this._gridSize,d=this.target.grid,e,f=cc.p(0,0),g=0;g<c.width;g++)for(var h=0;h<c.height;h++)f.x=g,f.y=h,e=d.originalTile(f),0===(g+h)%2?(e.bl.z+=b,e.br.z+=b,e.tl.z+=b,e.tr.z+=b):(e.bl.z+=a,e.br.z+=a,e.tl.z+=a,e.tr.z+=a),d.setTile(f,e)}});
cc.jumpTiles3D=function(a,b,c,d){return new cc.JumpTiles3D(a,b,c,d)};cc.JumpTiles3D.create=cc.jumpTiles3D;
cc.SplitRows=cc.TiledGrid3DAction.extend({_rows:0,_winSize:null,ctor:function(a,b){cc.GridAction.prototype.ctor.call(this);void 0!==b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){this._rows=b;return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,a,cc.size(1,b))},update:function(a){for(var b=this._gridSize,c=this._winSize.width,d,e,f=cc.p(0,0),g=0;g<b.height;++g)f.y=g,d=this.originalTile(f),e=1,0===g%2&&(e=-1),d.bl.x+=e*c*a,d.br.x+=e*c*a,d.tl.x+=e*c*a,d.tr.x+=e*c*a,this.setTile(f,
d)},startWithTarget:function(a){cc.TiledGrid3DAction.prototype.startWithTarget.call(this,a);this._winSize=cc.director.getWinSizeInPixels()}});cc.splitRows=function(a,b){return new cc.SplitRows(a,b)};cc.SplitRows.create=cc.splitRows;
cc.SplitCols=cc.TiledGrid3DAction.extend({_cols:0,_winSize:null,ctor:function(a,b){cc.GridAction.prototype.ctor.call(this);void 0!==b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){this._cols=b;return cc.TiledGrid3DAction.prototype.initWithDuration.call(this,a,cc.size(b,1))},update:function(a){for(var b=this._gridSize.width,c=this._winSize.height,d,e,f=cc.p(0,0),g=0;g<b;++g)f.x=g,d=this.originalTile(f),e=1,0===g%2&&(e=-1),d.bl.y+=e*c*a,d.br.y+=e*c*a,d.tl.y+=e*c*a,d.tr.y+=e*c*a,this.setTile(f,
d);cc.renderer.childrenOrderDirty=!0},startWithTarget:function(a){cc.TiledGrid3DAction.prototype.startWithTarget.call(this,a);this._winSize=cc.director.getWinSizeInPixels()}});cc.splitCols=function(a,b){return new cc.SplitCols(a,b)};cc.SplitCols.create=cc.splitCols;cc.PageTurn3D=cc.Grid3DAction.extend({getGrid:function(){var a=new cc.Grid3D(this._gridSize,void 0,void 0,this._gridNodeTarget.getGridRect());a.setNeedDepthTestForBlit(!0);return a},clone:function(){var a=new cc.PageTurn3D;a.initWithDuration(this._duration,this._gridSize);return a},update:function(a){var b=Math.max(0,a-0.25),b=-100-b*b*500,c=Math.sqrt(a),d=0.5<c?Math.PI/2*c:Math.PI/2*(1-c);a=(2-a)*Math.PI;for(var c=Math.sin(d),d=Math.cos(d),e=this._gridSize,f=cc.p(0,0),g=0;g<=e.width;++g)for(var h=
0;h<=e.height;++h){f.x=g;f.y=h;var k=this.getOriginalVertex(f);k.x-=this.getGridRect().x;var m=Math.sqrt(k.x*k.x+(k.y-b)*(k.y-b)),n=m*c,p=Math.asin(k.x/m)/c,r=Math.cos(p);k.x=p<=Math.PI?n*Math.sin(p):0;k.y=m+b-n*(1-r)*c;k.z=n*(1-r)*d;k.x=k.z*Math.sin(a)+k.x*Math.cos(a);k.z=k.z*Math.cos(a)-k.x*Math.cos(a);k.z/=7;0.5>k.z&&(k.z=0.5);k.x+=this.getGridRect().x;this.setVertex(f,k)}}});cc.pageTurn3D=function(a,b){return new cc.PageTurn3D(a,b)};cc.PageTurn3D.create=cc.pageTurn3D;cc.ProgressTimer=cc.Node.extend({_type:null,_percentage:0,_sprite:null,_midPoint:null,_barChangeRate:null,_reverseDirection:!1,_className:"ProgressTimer",ctor:function(a){cc.Node.prototype.ctor.call(this);this._type=cc.ProgressTimer.TYPE_RADIAL;this._percentage=0;this._midPoint=cc.p(0,0);this._barChangeRate=cc.p(0,0);this._reverseDirection=!1;this._sprite=null;a&&this.initWithSprite(a)},onEnter:function(){this._super();cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(this._renderCmd.initCmd(),this._renderCmd._updateProgress())},
cleanup:function(){cc._renderType===cc.game.RENDER_TYPE_WEBGL&&this._renderCmd.releaseData();this._super()},getMidpoint:function(){return cc.p(this._midPoint.x,this._midPoint.y)},setMidpoint:function(a){this._midPoint=cc.pClamp(a,cc.p(0,0),cc.p(1,1))},getBarChangeRate:function(){return cc.p(this._barChangeRate.x,this._barChangeRate.y)},setBarChangeRate:function(a){this._barChangeRate=cc.pClamp(a,cc.p(0,0),cc.p(1,1))},getType:function(){return this._type},getPercentage:function(){return this._percentage},
getSprite:function(){return this._sprite},setPercentage:function(a){this._percentage!==a&&(this._percentage=cc.clampf(a,0,100),this._renderCmd._updateProgress())},setOpacityModifyRGB:function(a){},isOpacityModifyRGB:function(){return!1},isReverseDirection:function(){return this._reverseDirection},setColor:function(a){this._sprite.color=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.colorDirty)},setOpacity:function(a){this._sprite.opacity=a;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.opacityDirty)},
getColor:function(){return this._sprite.color},getOpacity:function(){return this._sprite.opacity},setReverseProgress:function(a){this._reverseDirection!==a&&(this._reverseDirection=a,this._renderCmd.resetVertexData())},setSprite:function(a){this._sprite!==a&&((this._sprite=a)?(this.setContentSize(a.width,a.height),a.ignoreAnchorPointForPosition(!0)):this.setContentSize(0,0),this._renderCmd.resetVertexData())},setType:function(a){a!==this._type&&(this._type=a,this._renderCmd.resetVertexData())},setReverseDirection:function(a){this._reverseDirection!==
a&&(this._reverseDirection=a,this._renderCmd.resetVertexData())},initWithSprite:function(a){this.percentage=0;this.setAnchorPoint(0.5,0.5);this._type=cc.ProgressTimer.TYPE_RADIAL;this._reverseDirection=!1;this.midPoint=cc.p(0.5,0.5);this.barChangeRate=cc.p(1,1);this.setSprite(a);this._renderCmd.resetVertexData();return!0},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ProgressTimer.CanvasRenderCmd(this):new cc.ProgressTimer.WebGLRenderCmd(this)}});_p=cc.ProgressTimer.prototype;
cc.defineGetterSetter(_p,"midPoint",_p.getMidpoint,_p.setMidpoint);cc.defineGetterSetter(_p,"barChangeRate",_p.getBarChangeRate,_p.setBarChangeRate);cc.defineGetterSetter(_p,"type",_p.getType,_p.setType);cc.defineGetterSetter(_p,"percentage",_p.getPercentage,_p.setPercentage);cc.defineGetterSetter(_p,"sprite",_p.getSprite,_p.setSprite);cc.defineGetterSetter(_p,"reverseDir",_p.isReverseDirection,_p.setReverseDirection);cc.ProgressTimer.create=function(a){return new cc.ProgressTimer(a)};
cc.ProgressTimer.TEXTURE_COORDS_COUNT=4;cc.ProgressTimer.TEXTURE_COORDS=75;cc.ProgressTimer.TYPE_RADIAL=0;cc.ProgressTimer.TYPE_BAR=1;cc.ProgressTo=cc.ActionInterval.extend({_to:0,_from:0,ctor:function(a,b){cc.ActionInterval.prototype.ctor.call(this);this._from=this._to=0;void 0!==b&&this.initWithDuration(a,b)},initWithDuration:function(a,b){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._to=b,!0):!1},clone:function(){var a=new cc.ProgressTo;a.initWithDuration(this._duration,this._to);return a},reverse:function(){cc.log("cc.ProgressTo.reverse(): reverse hasn't been supported.");return null},startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,
a);this._from=a.percentage},update:function(a){this.target instanceof cc.ProgressTimer&&(this.target.percentage=this._from+(this._to-this._from)*a)}});cc.progressTo=function(a,b){return new cc.ProgressTo(a,b)};cc.ProgressTo.create=cc.progressTo;
cc.ProgressFromTo=cc.ActionInterval.extend({_to:0,_from:0,ctor:function(a,b,c){cc.ActionInterval.prototype.ctor.call(this);this._from=this._to=0;void 0!==c&&this.initWithDuration(a,b,c)},initWithDuration:function(a,b,c){return cc.ActionInterval.prototype.initWithDuration.call(this,a)?(this._to=c,this._from=b,!0):!1},clone:function(){var a=new cc.ProgressFromTo;a.initWithDuration(this._duration,this._from,this._to);return a},reverse:function(){return cc.progressFromTo(this._duration,this._to,this._from)},
startWithTarget:function(a){cc.ActionInterval.prototype.startWithTarget.call(this,a)},update:function(a){this.target instanceof cc.ProgressTimer&&(this.target.percentage=this._from+(this._to-this._from)*a)}});cc.progressFromTo=function(a,b,c){return new cc.ProgressFromTo(a,b,c)};cc.ProgressFromTo.create=cc.progressFromTo;(function(){cc.ProgressTimer.CanvasRenderCmd=function(a){this._rootCtor(a);this._needDraw=!0;this._PI180=Math.PI/180;this._barRect=cc.rect(0,0,0,0);this._origin=cc.p(0,0);this._radius=0;this._endAngle=this._startAngle=270;this._counterClockWise=!1;this._canUseDirtyRegion=!0};var a=cc.ProgressTimer.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);a.constructor=cc.ProgressTimer.CanvasRenderCmd;a.rendering=function(a,c,d){a=a||cc._renderContext;var e=a.getContext(),f=this._node,
g=f._sprite,h=g._renderCmd._textureCoord,k=g._renderCmd._displayedOpacity/255;if(0!==h.width&&0!==h.height&&g._texture&&h.validRect&&0!==k){a.setTransform(this._worldTransform,c,d);a.setCompositeOperation(g._blendFuncStr);a.setGlobalAlpha(k);var m=g._rect,n=g._offsetPosition;c=n.x;d=-n.y-m.height;k=m.width;m=m.height;a.save();g._flippedX&&(c=-c-k,e.scale(-1,1));g._flippedY&&(d=n.y,e.scale(1,-1));f._type===cc.ProgressTimer.TYPE_BAR?(f=this._barRect,e.beginPath(),e.rect(f.x,f.y,f.width,f.height),e.clip(),
e.closePath()):f._type===cc.ProgressTimer.TYPE_RADIAL&&(f=this._origin.x,n=this._origin.y,e.beginPath(),e.arc(f,n,this._radius,this._PI180*this._startAngle,this._PI180*this._endAngle,this._counterClockWise),e.lineTo(f,n),e.clip(),e.closePath());f=(g._renderCmd._textureToRender||g._texture).getHtmlElementObj();g._renderCmd._colorized?e.drawImage(f,0,0,h.width,h.height,c,d,k,m):e.drawImage(f,h.renderX,h.renderY,h.width,h.height,c,d,k,m);a.restore();cc.g_NumberOfDraws++}};a.releaseData=function(){};
a.resetVertexData=function(){};a._updateProgress=function(){this.setDirtyFlag(cc.Node._dirtyFlags.contentDirty);var a=this._node,c=a._sprite,d=c.width,e=c.height,f=a._midPoint;if(a._type===cc.ProgressTimer.TYPE_RADIAL){this._radius=Math.round(Math.sqrt(d*d+e*e));var g,h=!1,k=this._origin;k.x=d*f.x;k.y=-e*f.y;a._reverseDirection?(g=270,f=270-3.6*a._percentage):(f=-90,g=-90+3.6*a._percentage);c._flippedX&&(k.x-=2*d*a._midPoint.x,f=-f-180,g=-g-180,h=!h);c._flippedY&&(k.y+=2*e*a._midPoint.y,h=!h,f=-f,
g=-g);this._startAngle=f;this._endAngle=g;this._counterClockWise=h}else h=a._barChangeRate,k=a._percentage/100,a=this._barRect,h=cc.size(d*(1-h.x),e*(1-h.y)),k=cc.size((d-h.width)*k,(e-h.height)*k),h=cc.size(h.width+k.width,h.height+k.height),g=cc.p(d*f.x,e*f.y),k=g.x-h.width/2,0.5<f.x&&h.width/2>=d-g.x&&(k=d-h.width),d=g.y-h.height/2,0.5<f.y&&h.height/2>=e-g.y&&(d=e-h.height),a.x=0,e=1,c._flippedX&&(a.x-=h.width,e=-1),0<k&&(a.x+=k*e),a.y=0,e=1,c._flippedY&&(a.y+=h.height,e=-1),0<d&&(a.y-=d*e),a.width=
h.width,a.height=-h.height};a._syncStatus=function(a){var c=this._node;if(c._sprite){var d=cc.Node._dirtyFlags,e=this._dirtyFlag,f=a?a._node:null;f&&f._cascadeColorEnabled&&a._dirtyFlag&d.colorDirty&&(e|=d.colorDirty);f&&f._cascadeOpacityEnabled&&a._dirtyFlag&d.opacityDirty&&(e|=d.opacityDirty);a&&a._dirtyFlag&d.transformDirty&&(e|=d.transformDirty);this._dirtyFlag=e;var c=c._sprite._renderCmd,g=c._dirtyFlag,f=g&d.colorDirty,g=g&d.opacityDirty;f&&(c._syncDisplayColor(),c._dirtyFlag&=~d.colorDirty,
this._dirtyFlag&=~d.colorDirty);g&&(c._syncDisplayOpacity(),c._dirtyFlag&=~d.opacityDirty,this._dirtyFlag&=~d.opacityDirty);(f||g)&&c._updateColor();e&d.transformDirty&&this.transform(a);e&d.orderDirty&&(this._dirtyFlag&=~d.orderDirty)}};a.updateStatus=function(){var a=this._node;if(a._sprite){var c=cc.Node._dirtyFlags,d=this._dirtyFlag,a=a._sprite._renderCmd,e=a._dirtyFlag,f=e&c.colorDirty,e=e&c.opacityDirty;f&&(a._updateDisplayColor(),a._dirtyFlag^=a._dirtyFlag&c.colorDirty,this._dirtyFlag^=this._dirtyFlag&
c.colorDirty);e&&(a._updateDisplayOpacity(),a._dirtyFlag^=a._dirtyFlag&c.opacityDirty,this._dirtyFlag^=this._dirtyFlag&c.opacityDirty);(f||e)&&a._updateColor();d&c.transformDirty&&this.transform(this.getParentRenderCmd(),!0);d&c.contentDirty&&this._notifyRegionStatus&&this._notifyRegionStatus(cc.Node.CanvasRenderCmd.RegionStatus.Dirty);this._dirtyFlag=0}}})();(function(){cc.ProgressTimer.WebGLRenderCmd=function(a){this._rootCtor(a);this._progressDirty=this._needDraw=!0;this._bl=cc.p();this._tr=cc.p();this.initCmd()};var a=cc.ProgressTimer.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);a.constructor=cc.ProgressTimer.WebGLRenderCmd;a.transform=function(a,c){this.originTransform(a,c);var d=this._node._sprite;d._renderCmd.transform(this,c);var e=d._offsetPosition.x,f=e+d._rect.width,g=d._offsetPosition.y,d=g+d._rect.height,h=this._worldTransform;
this._bl.x=e*h.a+g*h.c+h.tx;this._bl.y=e*h.b+g*h.d+h.ty;this._tr.x=f*h.a+d*h.c+h.tx;this._tr.y=f*h.b+d*h.d+h.ty;this._updateProgressData()};a.rendering=function(a){var c=this._node;a=a||cc._renderContext;if(0!==this._vertexDataCount&&c._sprite){this._glProgramState.apply();this._shaderProgram._updateProjectionUniform();var d=c._sprite._blendFunc;cc.glBlendFunc(d.src,d.dst);cc.glBindTexture2D(c._sprite.texture);a.bindBuffer(a.ARRAY_BUFFER,this._vertexWebGLBuffer);a.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);
a.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR);a.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS);this._vertexDataDirty&&(a.bufferSubData(a.ARRAY_BUFFER,0,this._float32View),this._vertexDataDirty=!1);d=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,a.FLOAT,!1,d,0);a.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,a.UNSIGNED_BYTE,!0,d,12);a.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,a.FLOAT,!1,d,16);c._type===cc.ProgressTimer.TYPE_RADIAL?a.drawArrays(a.TRIANGLE_FAN,
0,this._vertexDataCount):c._type===cc.ProgressTimer.TYPE_BAR&&(c._reverseDirection?(a.drawArrays(a.TRIANGLE_STRIP,0,this._vertexDataCount/2),a.drawArrays(a.TRIANGLE_STRIP,4,this._vertexDataCount/2),cc.g_NumberOfDraws++):a.drawArrays(a.TRIANGLE_STRIP,0,this._vertexDataCount));cc.g_NumberOfDraws++}};a._syncStatus=function(a){var c=this._node;if(c._sprite){var d=cc.Node._dirtyFlags,e=this._dirtyFlag,f=a?a._node:null;f&&f._cascadeColorEnabled&&a._dirtyFlag&d.colorDirty&&(e|=d.colorDirty);f&&f._cascadeOpacityEnabled&&
a._dirtyFlag&d.opacityDirty&&(e|=d.opacityDirty);a&&a._dirtyFlag&d.transformDirty&&(e|=d.transformDirty);this._dirtyFlag=e;var c=c._sprite._renderCmd,g=c._dirtyFlag,f=(e|g)&d.colorDirty,g=(e|g)&d.opacityDirty;f&&(c._syncDisplayColor(),c._dirtyFlag&=~d.colorDirty,this._dirtyFlag&=~d.colorDirty);g&&(c._syncDisplayOpacity(),c._dirtyFlag&=~d.opacityDirty,this._dirtyFlag&=~d.opacityDirty);(f||g)&&this._updateColor();e&d.transformDirty&&this.transform(a);e&d.textureDirty&&(this._updateProgressData(),this._dirtyFlag&=
~d.textureDirty);c._dirtyFlag=0}};a.updateStatus=function(){var a=this._node;if(a._sprite){var c=cc.Node._dirtyFlags,d=this._dirtyFlag,a=a._sprite._renderCmd,e=a._dirtyFlag,f=(d|e)&c.colorDirty,e=(d|e)&c.opacityDirty;f&&(a._updateDisplayColor(),a._dirtyFlag^=a._dirtyFlag&c.colorDirty,this._dirtyFlag^=this._dirtyFlag&c.colorDirty);e&&(a._updateDisplayOpacity(),a._dirtyFlag^=a._dirtyFlag&c.opacityDirty,this._dirtyFlag^=this._dirtyFlag&c.opacityDirty);(f||e)&&this._updateColor();d&c.transformDirty&&
this.transform(this.getParentRenderCmd(),!0);d&c.orderDirty&&(this._dirtyFlag^=this._dirtyFlag&c.orderDirty);d&c.textureDirty&&(this._updateProgressData(),this._dirtyFlag^=this._dirtyFlag&c.textureDirty)}};a.releaseData=function(){if(this._vertexData){var a=this._vertexWebGLBuffer;setTimeout(function(){cc._renderContext.deleteBuffer(a)},0.1);this._vertexArrayBuffer=this._float32View=this._vertexData=this._vertexWebGLBuffer=null;this._vertexDataCount=0}};a.initCmd=function(){if(!this._vertexData){this._vertexWebGLBuffer=
cc._renderContext.createBuffer();var a=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._vertexArrayBuffer=new ArrayBuffer(8*a);this._float32View=new Float32Array(this._vertexArrayBuffer);this._vertexData=[];for(var c=0;8>c;c++)this._vertexData[c]=new cc.V3F_C4B_T2F(null,null,null,this._vertexArrayBuffer,c*a);gl.bindBuffer(gl.ARRAY_BUFFER,this._vertexWebGLBuffer);gl.bufferData(gl.ARRAY_BUFFER,this._float32View,gl.DYNAMIC_DRAW);this._vertexDataCount=0;this._vertexDataDirty=!0;this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)}};
a.resetVertexData=function(){this._vertexDataCount=0};a._updateProgressData=function(){var a=this._node._type;a===cc.ProgressTimer.TYPE_RADIAL?this._updateRadial():a===cc.ProgressTimer.TYPE_BAR&&this._updateBar();this._vertexDataDirty=!0};a._updateProgress=function(){this.setDirtyFlag(cc.Node._dirtyFlags.textureDirty)};a._updateBar=function(){var a=this._node;if(a._sprite){var c=a._percentage/100,d=a._barChangeRate,d=cc.pMult(cc.p(1-d.x+c*d.x,1-d.y+c*d.y),0.5),c=cc.pSub(a._midPoint,d),a=cc.pAdd(a._midPoint,
d);0>c.x&&(a.x+=-c.x,c.x=0);1<a.x&&(c.x-=a.x-1,a.x=1);0>c.y&&(a.y+=-c.y,c.y=0);1<a.y&&(c.y-=a.y-1,a.y=1);this._reverseDirection?(d=this._vertexData,this._vertexDataCount||(this._vertexDataCount=8,this._textureCoordFromAlphaPoint(d[0].texCoords,0,1),this._vertexFromAlphaPoint(d[0].vertices,0,1),this._textureCoordFromAlphaPoint(d[1].texCoords,0,0),this._vertexFromAlphaPoint(d[1].vertices,0,0),this._textureCoordFromAlphaPoint(d[6].texCoords,1,1),this._vertexFromAlphaPoint(d[6].vertices,1,1),this._textureCoordFromAlphaPoint(d[7].texCoords,
1,0),this._vertexFromAlphaPoint(d[7].vertices,1,0)),this._textureCoordFromAlphaPoint(d[2].texCoords,c.x,a.y),this._vertexFromAlphaPoint(d[2].vertices,c.x,a.y),this._textureCoordFromAlphaPoint(d[3].texCoords,c.x,c.y),this._vertexFromAlphaPoint(d[3].vertices,c.x,c.y),this._textureCoordFromAlphaPoint(d[4].texCoords,a.x,a.y),this._vertexFromAlphaPoint(d[4].vertices,a.x,a.y),this._textureCoordFromAlphaPoint(d[5].texCoords,a.x,c.y),this._vertexFromAlphaPoint(d[5].vertices,a.x,c.y)):(this._vertexDataCount||
(this._vertexDataCount=4),d=this._vertexData,this._textureCoordFromAlphaPoint(d[0].texCoords,c.x,a.y),this._vertexFromAlphaPoint(d[0].vertices,c.x,a.y),this._textureCoordFromAlphaPoint(d[1].texCoords,c.x,c.y),this._vertexFromAlphaPoint(d[1].vertices,c.x,c.y),this._textureCoordFromAlphaPoint(d[2].texCoords,a.x,a.y),this._vertexFromAlphaPoint(d[2].vertices,a.x,a.y),this._textureCoordFromAlphaPoint(d[3].texCoords,a.x,c.y),this._vertexFromAlphaPoint(d[3].vertices,a.x,c.y));this._updateColor()}};a._updateRadial=
function(){var a=this._node;if(a._sprite){var c,d=a._midPoint;c=a._percentage/100;var e=2*cc.PI*(a._reverseDirection?c:1-c),a=cc.p(d.x,1),f=cc.pRotateByAngle(a,d,e),e=0;if(0===c)f=a,e=0;else if(1===c)f=a,e=4;else{var g=cc.FLT_MAX,h=cc.ProgressTimer.TEXTURE_COORDS_COUNT;for(c=0;c<=h;++c){var k=(c+(h-1))%h,m=this._boundaryTexCoord(c%h),k=this._boundaryTexCoord(k);0===c?k=cc.pLerp(m,k,1-d.x):4===c&&(m=cc.pLerp(m,k,1-d.x));var n=cc.p(0,0);cc.pLineIntersect(m,k,d,f,n)&&(0!==c&&4!==c||0<=n.x&&1>=n.x)&&
0<=n.y&&n.y<g&&(g=n.y,e=c)}f=cc.pAdd(d,cc.pMult(cc.pSub(f,d),g))}c=!0;this._vertexDataCount!==e+3&&(c=!1,this._vertexDataCount=e+3);this._updateColor();g=this._vertexData;if(!c)for(this._textureCoordFromAlphaPoint(g[0].texCoords,d.x,d.y),this._vertexFromAlphaPoint(g[0].vertices,d.x,d.y),this._textureCoordFromAlphaPoint(g[1].texCoords,a.x,a.y),this._vertexFromAlphaPoint(g[1].vertices,a.x,a.y),c=0;c<e;c++)d=this._boundaryTexCoord(c),this._textureCoordFromAlphaPoint(g[c+2].texCoords,d.x,d.y),this._vertexFromAlphaPoint(g[c+
2].vertices,d.x,d.y);this._textureCoordFromAlphaPoint(g[this._vertexDataCount-1].texCoords,f.x,f.y);this._vertexFromAlphaPoint(g[this._vertexDataCount-1].vertices,f.x,f.y)}};a._boundaryTexCoord=function(a){if(a<cc.ProgressTimer.TEXTURE_COORDS_COUNT){var c=cc.ProgressTimer.TEXTURE_COORDS;return this._node._reverseDirection?cc.p(c>>7-(a<<1)&1,c>>7-((a<<1)+1)&1):cc.p(c>>(a<<1)+1&1,c>>(a<<1)&1)}return cc.p(0,0)};a._textureCoordFromAlphaPoint=function(a,c,d){var e=this._node._sprite;if(e){var f=e._renderCmd._vertices,
g=f[1],f=f[2],g=cc.p(g.u,g.v),f=cc.p(f.u,f.v);e.textureRectRotated&&(e=c,c=d,d=e);a.u=g.x*(1-c)+f.x*c;a.v=g.y*(1-d)+f.y*d}else a.u=0,a.v=0};a._vertexFromAlphaPoint=function(a,c,d){a.x=this._bl.x*(1-c)+this._tr.x*c;a.y=this._bl.y*(1-d)+this._tr.y*d;a.z=this._node._vertexZ};a._updateColor=function(){var a=this._node._sprite;if(this._vertexDataCount&&a){var c=this._displayedColor,d=a._renderCmd._displayedColor,e=d.r,f=d.g,d=d.b,g=a._renderCmd._displayedOpacity/255;a._opacityModifyRGB&&(e*=g,f*=g,d*=
g);c.r=e;c.g=f;c.b=d;c.a=a._renderCmd._displayedOpacity;a=this._vertexData;e=0;for(f=this._vertexDataCount;e<f;++e)a[e].colors=c;this._vertexDataDirty=!0}}})();cc.SCENE_FADE=4208917214;cc.TRANSITION_ORIENTATION_LEFT_OVER=0;cc.TRANSITION_ORIENTATION_RIGHT_OVER=1;cc.TRANSITION_ORIENTATION_UP_OVER=0;cc.TRANSITION_ORIENTATION_DOWN_OVER=1;
cc.TransitionScene=cc.Scene.extend({_inScene:null,_outScene:null,_duration:null,_isInSceneOnTop:!1,_isSendCleanupToScene:!1,_className:"TransitionScene",ctor:function(a,b){cc.Scene.prototype.ctor.call(this);void 0!==a&&void 0!==b&&this.initWithDuration(a,b)},_setNewScene:function(a){this.unschedule(this._setNewScene);a=cc.director;this._isSendCleanupToScene=a.isSendCleanupToScene();a.runScene(this._inScene);cc.eventManager.setEnabled(!0);this._outScene.visible=!0},_sceneOrder:function(){this._isInSceneOnTop=
!0},visit:function(){this._isInSceneOnTop?(this._outScene.visit(),this._inScene.visit()):(this._inScene.visit(),this._outScene.visit());cc.Node.prototype.visit.call(this)},onEnter:function(){cc.Node.prototype.onEnter.call(this);cc.eventManager.setEnabled(!1);this._outScene._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart);this._inScene._performRecursive(cc.Node._stateCallbackType.onEnter)},onExit:function(){cc.Node.prototype.onExit.call(this);cc.eventManager.setEnabled(!0);this._outScene._performRecursive(cc.Node._stateCallbackType.onExit);
this._inScene._performRecursive(cc.Node._stateCallbackType.onEnterTransitionDidFinish)},cleanup:function(){cc.Node.prototype.cleanup.call(this);this._isSendCleanupToScene&&this._outScene._performRecursive(cc.Node._stateCallbackType.cleanup)},initWithDuration:function(a,b){if(!b)throw Error("cc.TransitionScene.initWithDuration(): Argument scene must be non-nil");if(this.init()){this._duration=a;this.attr({x:0,y:0,anchorX:0,anchorY:0});this._inScene=b;this._outScene=cc.director.getRunningScene();this._outScene||
(this._outScene=new cc.Scene,this._outScene.init());if(this._inScene===this._outScene)throw Error("cc.TransitionScene.initWithDuration(): Incoming scene must be different from the outgoing scene");this._sceneOrder();return!0}return!1},finish:function(){this._inScene.attr({visible:!0,x:0,y:0,scale:1,rotation:0});this._outScene.attr({visible:!1,x:0,y:0,scale:1,rotation:0});this.schedule(this._setNewScene,0)},hideOutShowIn:function(){this._inScene.visible=!0;this._outScene.visible=!1}});
cc.TransitionScene.create=function(a,b){return new cc.TransitionScene(a,b)};cc.TransitionSceneOriented=cc.TransitionScene.extend({_orientation:0,ctor:function(a,b,c){cc.TransitionScene.prototype.ctor.call(this);void 0!=c&&this.initWithDuration(a,b,c)},initWithDuration:function(a,b,c){cc.TransitionScene.prototype.initWithDuration.call(this,a,b)&&(this._orientation=c);return!0}});cc.TransitionSceneOriented.create=function(a,b,c){return new cc.TransitionSceneOriented(a,b,c)};
cc.TransitionRotoZoom=cc.TransitionScene.extend({ctor:function(a,b){cc.TransitionScene.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);this._inScene.attr({scale:0.001,anchorX:0.5,anchorY:0.5});this._outScene.attr({scale:1,anchorX:0.5,anchorY:0.5});var a=cc.sequence(cc.spawn(cc.scaleBy(this._duration/2,0.001),cc.rotateBy(this._duration/2,720)),cc.delayTime(this._duration/2));this._outScene.runAction(a);this._inScene.runAction(cc.sequence(a.reverse(),
cc.callFunc(this.finish,this)))}});cc.TransitionRotoZoom.create=function(a,b){return new cc.TransitionRotoZoom(a,b)};
cc.TransitionJumpZoom=cc.TransitionScene.extend({ctor:function(a,b){cc.TransitionScene.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var a=cc.director.getWinSize();this._inScene.attr({scale:0.5,x:a.width,y:0,anchorX:0.5,anchorY:0.5});this._outScene.anchorX=0.5;this._outScene.anchorY=0.5;var b=cc.jumpBy(this._duration/4,cc.p(-a.width,0),a.width/4,2),c=cc.scaleTo(this._duration/4,1),a=cc.scaleTo(this._duration/4,0.5),a=cc.sequence(a,
b),b=cc.sequence(b,c),c=cc.delayTime(this._duration/2);this._outScene.runAction(a);this._inScene.runAction(cc.sequence(c,b,cc.callFunc(this.finish,this)))}});cc.TransitionJumpZoom.create=function(a,b){return new cc.TransitionJumpZoom(a,b)};
cc.TransitionMoveInL=cc.TransitionScene.extend({ctor:function(a,b){cc.TransitionScene.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);this.initScenes();var a=this.action();this._inScene.runAction(cc.sequence(this.easeActionWithAction(a),cc.callFunc(this.finish,this)))},initScenes:function(){this._inScene.setPosition(-cc.director.getWinSize().width,0)},action:function(){return cc.moveTo(this._duration,cc.p(0,0))},easeActionWithAction:function(a){return new cc.EaseOut(a,
2)}});cc.TransitionMoveInL.create=function(a,b){return new cc.TransitionMoveInL(a,b)};cc.TransitionMoveInR=cc.TransitionMoveInL.extend({ctor:function(a,b){cc.TransitionMoveInL.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},initScenes:function(){this._inScene.setPosition(cc.director.getWinSize().width,0)}});cc.TransitionMoveInR.create=function(a,b){return new cc.TransitionMoveInR(a,b)};
cc.TransitionMoveInT=cc.TransitionMoveInL.extend({ctor:function(a,b){cc.TransitionMoveInL.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},initScenes:function(){this._inScene.setPosition(0,cc.director.getWinSize().height)}});cc.TransitionMoveInT.create=function(a,b){return new cc.TransitionMoveInT(a,b)};
cc.TransitionMoveInB=cc.TransitionMoveInL.extend({ctor:function(a,b){cc.TransitionMoveInL.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},initScenes:function(){this._inScene.setPosition(0,-cc.director.getWinSize().height)}});cc.TransitionMoveInB.create=function(a,b){return new cc.TransitionMoveInB(a,b)};cc.ADJUST_FACTOR=0.5;
cc.TransitionSlideInL=cc.TransitionScene.extend({ctor:function(a,b){cc.TransitionScene.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},_sceneOrder:function(){this._isInSceneOnTop=!1},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);this.initScenes();var a=this.action(),b=this.action(),a=cc.sequence(this.easeActionWithAction(a),cc.callFunc(this.finish,this)),b=this.easeActionWithAction(b);this._inScene.runAction(a);this._outScene.runAction(b)},initScenes:function(){this._inScene.setPosition(-cc.director.getWinSize().width+
cc.ADJUST_FACTOR,0)},action:function(){return cc.moveBy(this._duration,cc.p(cc.director.getWinSize().width-cc.ADJUST_FACTOR,0))},easeActionWithAction:function(a){return new cc.EaseInOut(a,2)}});cc.TransitionSlideInL.create=function(a,b){return new cc.TransitionSlideInL(a,b)};
cc.TransitionSlideInR=cc.TransitionSlideInL.extend({ctor:function(a,b){cc.TransitionSlideInL.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},_sceneOrder:function(){this._isInSceneOnTop=!0},initScenes:function(){this._inScene.setPosition(cc.director.getWinSize().width-cc.ADJUST_FACTOR,0)},action:function(){return cc.moveBy(this._duration,cc.p(-(cc.director.getWinSize().width-cc.ADJUST_FACTOR),0))}});cc.TransitionSlideInR.create=function(a,b){return new cc.TransitionSlideInR(a,b)};
cc.TransitionSlideInB=cc.TransitionSlideInL.extend({ctor:function(a,b){cc.TransitionSlideInL.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},_sceneOrder:function(){this._isInSceneOnTop=!1},initScenes:function(){this._inScene.setPosition(0,-(cc.director.getWinSize().height-cc.ADJUST_FACTOR))},action:function(){return cc.moveBy(this._duration,cc.p(0,cc.director.getWinSize().height-cc.ADJUST_FACTOR))}});cc.TransitionSlideInB.create=function(a,b){return new cc.TransitionSlideInB(a,b)};
cc.TransitionSlideInT=cc.TransitionSlideInL.extend({ctor:function(a,b){cc.TransitionSlideInL.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},_sceneOrder:function(){this._isInSceneOnTop=!0},initScenes:function(){this._inScene.setPosition(0,cc.director.getWinSize().height-cc.ADJUST_FACTOR)},action:function(){return cc.moveBy(this._duration,cc.p(0,-(cc.director.getWinSize().height-cc.ADJUST_FACTOR)))}});cc.TransitionSlideInT.create=function(a,b){return new cc.TransitionSlideInT(a,b)};
cc.TransitionShrinkGrow=cc.TransitionScene.extend({ctor:function(a,b){cc.TransitionScene.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);this._inScene.attr({scale:0.001,anchorX:2/3,anchorY:0.5});this._outScene.attr({scale:1,anchorX:1/3,anchorY:0.5});var a=cc.scaleTo(this._duration,0.01),b=cc.scaleTo(this._duration,1);this._inScene.runAction(cc.sequence(this.easeActionWithAction(b),cc.callFunc(this.finish,this)));this._outScene.runAction(this.easeActionWithAction(a))},
easeActionWithAction:function(a){return new cc.EaseOut(a,2)}});cc.TransitionShrinkGrow.create=function(a,b){return new cc.TransitionShrinkGrow(a,b)};
cc.TransitionFade=cc.TransitionScene.extend({_color:null,ctor:function(a,b,c){cc.TransitionScene.prototype.ctor.call(this);this._color=cc.color();b&&this.initWithDuration(a,b,c)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var a=new cc.LayerColor(this._color);this._inScene.visible=!1;this.addChild(a,2,cc.SCENE_FADE);var a=this.getChildByTag(cc.SCENE_FADE),b=cc.sequence(cc.fadeIn(this._duration/2),cc.callFunc(this.hideOutShowIn,this),cc.fadeOut(this._duration/2),cc.callFunc(this.finish,
this));a.runAction(b)},onExit:function(){cc.TransitionScene.prototype.onExit.call(this);this.removeChildByTag(cc.SCENE_FADE,!1)},initWithDuration:function(a,b,c){c=c||cc.color.BLACK;cc.TransitionScene.prototype.initWithDuration.call(this,a,b)&&(this._color.r=c.r,this._color.g=c.g,this._color.b=c.b,this._color.a=0);return!0}});cc.TransitionFade.create=function(a,b,c){return new cc.TransitionFade(a,b,c)};
cc.TransitionCrossFade=cc.TransitionScene.extend({ctor:function(a,b){cc.TransitionScene.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);var a=cc.color(0,0,0,0),b=cc.director.getWinSize(),a=new cc.LayerColor(a),c=new cc.RenderTexture(b.width,b.height);c.sprite.anchorX=0.5;c.sprite.anchorY=0.5;c.attr({x:b.width/2,y:b.height/2,anchorX:0.5,anchorY:0.5});c.begin();this._inScene.visit();c.end();var d=new cc.RenderTexture(b.width,
b.height);d.setPosition(b.width/2,b.height/2);d.sprite.anchorX=d.anchorX=0.5;d.sprite.anchorY=d.anchorY=0.5;d.begin();this._outScene.visit();d.end();c.sprite.setBlendFunc(cc.ONE,cc.ONE);d.sprite.setBlendFunc(cc.SRC_ALPHA,cc.ONE_MINUS_SRC_ALPHA);a.addChild(c);a.addChild(d);c.sprite.opacity=255;d.sprite.opacity=255;b=cc.sequence(cc.fadeTo(this._duration,0),cc.callFunc(this.hideOutShowIn,this),cc.callFunc(this.finish,this));d.sprite.runAction(b);this.addChild(a,2,cc.SCENE_FADE)},onExit:function(){this.removeChildByTag(cc.SCENE_FADE,
!1);cc.TransitionScene.prototype.onExit.call(this)}});cc.TransitionCrossFade.create=function(a,b){return new cc.TransitionCrossFade(a,b)};
cc.TransitionTurnOffTiles=cc.TransitionScene.extend({_gridProxy:null,ctor:function(a,b){cc.TransitionScene.prototype.ctor.call(this);this._gridProxy=new cc.NodeGrid;b&&this.initWithDuration(a,b)},_sceneOrder:function(){this._isInSceneOnTop=!1},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);this._gridProxy.setTarget(this._outScene);this._gridProxy._performRecursive(cc.Node._stateCallbackType.onEnter);var a=cc.director.getWinSize(),a=cc.turnOffTiles(this._duration,cc.size(0|a.width/
a.height*12,12)),a=this.easeActionWithAction(a);this._gridProxy.runAction(cc.sequence(a,cc.callFunc(this.finish,this),cc.stopGrid()))},visit:function(){this._inScene.visit();this._gridProxy.visit()},easeActionWithAction:function(a){return a}});cc.TransitionTurnOffTiles.create=function(a,b){return new cc.TransitionTurnOffTiles(a,b)};
cc.TransitionSplitCols=cc.TransitionScene.extend({_gridProxy:null,_switchTargetToInscene:function(){this._gridProxy.setTarget(this._inScene)},ctor:function(a,b){cc.TransitionScene.prototype.ctor.call(this);this._gridProxy=new cc.NodeGrid;b&&this.initWithDuration(a,b)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);this._gridProxy.setTarget(this._outScene);this._gridProxy._performRecursive(cc.Node._stateCallbackType.onEnter);var a=this.action(),a=cc.sequence(a,cc.callFunc(this._switchTargetToInscene,
this),a.reverse());this._gridProxy.runAction(cc.sequence(this.easeActionWithAction(a),cc.callFunc(this.finish,this),cc.stopGrid()))},onExit:function(){this._gridProxy.setTarget(null);this._gridProxy._performRecursive(cc.Node._stateCallbackType.onExit);cc.TransitionScene.prototype.onExit.call(this)},visit:function(){this._gridProxy.visit()},easeActionWithAction:function(a){return new cc.EaseInOut(a,3)},action:function(){return cc.splitCols(this._duration/2,3)}});
cc.TransitionSplitCols.create=function(a,b){return new cc.TransitionSplitCols(a,b)};cc.TransitionSplitRows=cc.TransitionSplitCols.extend({ctor:function(a,b){cc.TransitionSplitCols.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},action:function(){return cc.splitRows(this._duration/2,3)}});cc.TransitionSplitRows.create=function(a,b){return new cc.TransitionSplitRows(a,b)};
cc.TransitionFadeTR=cc.TransitionScene.extend({_gridProxy:null,ctor:function(a,b){cc.TransitionScene.prototype.ctor.call(this);this._gridProxy=new cc.NodeGrid;b&&this.initWithDuration(a,b)},_sceneOrder:function(){this._isInSceneOnTop=!1},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);this._gridProxy.setTarget(this._outScene);this._gridProxy._performRecursive(cc.Node._stateCallbackType.onEnter);var a=cc.director.getWinSize(),a=this.actionWithSize(cc.size(0|a.width/a.height*12,12));
this._gridProxy.runAction(cc.sequence(this.easeActionWithAction(a),cc.callFunc(this.finish,this),cc.stopGrid()))},visit:function(){this._inScene.visit();this._gridProxy.visit()},easeActionWithAction:function(a){return a},actionWithSize:function(a){return cc.fadeOutTRTiles(this._duration,a)}});cc.TransitionFadeTR.create=function(a,b){return new cc.TransitionFadeTR(a,b)};
cc.TransitionFadeBL=cc.TransitionFadeTR.extend({ctor:function(a,b){cc.TransitionFadeTR.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},actionWithSize:function(a){return cc.fadeOutBLTiles(this._duration,a)}});cc.TransitionFadeBL.create=function(a,b){return new cc.TransitionFadeBL(a,b)};
cc.TransitionFadeUp=cc.TransitionFadeTR.extend({ctor:function(a,b){cc.TransitionFadeTR.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},actionWithSize:function(a){return new cc.FadeOutUpTiles(this._duration,a)}});cc.TransitionFadeUp.create=function(a,b){return new cc.TransitionFadeUp(a,b)};
cc.TransitionFadeDown=cc.TransitionFadeTR.extend({ctor:function(a,b){cc.TransitionFadeTR.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},actionWithSize:function(a){return cc.fadeOutDownTiles(this._duration,a)}});cc.TransitionFadeDown.create=function(a,b){return new cc.TransitionFadeDown(a,b)};cc.SCENE_RADIAL=49153;
cc.TransitionProgress=cc.TransitionScene.extend({_to:0,_from:0,_sceneToBeModified:null,_className:"TransitionProgress",ctor:function(a,b){cc.TransitionScene.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},_setAttrs:function(a,b,c){a.attr({x:b,y:c,anchorX:0.5,anchorY:0.5})},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);this._setupTransition();var a=cc.director.getWinSize(),b=new cc.RenderTexture(a.width,a.height);b.sprite.anchorX=0.5;b.sprite.anchorY=0.5;this._setAttrs(b,
a.width/2,a.height/2);b.clear(0,0,0,1);b.begin();this._sceneToBeModified.visit();b.end();this._sceneToBeModified===this._outScene&&this.hideOutShowIn();a=this._progressTimerNodeWithRenderTexture(b);b=cc.sequence(cc.progressFromTo(this._duration,this._from,this._to),cc.callFunc(this.finish,this));a.runAction(b);this.addChild(a,2,cc.SCENE_RADIAL)},onExit:function(){this.removeChildByTag(cc.SCENE_RADIAL,!0);cc.TransitionScene.prototype.onExit.call(this)},_setupTransition:function(){this._sceneToBeModified=
this._outScene;this._from=100;this._to=0},_progressTimerNodeWithRenderTexture:function(a){cc.log("cc.TransitionProgress._progressTimerNodeWithRenderTexture(): should be overridden in subclass");return null},_sceneOrder:function(){this._isInSceneOnTop=!1}});cc.TransitionProgress.create=function(a,b){return new cc.TransitionProgress(a,b)};
cc.TransitionProgressRadialCCW=cc.TransitionProgress.extend({ctor:function(a,b){cc.TransitionProgress.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},_progressTimerNodeWithRenderTexture:function(a){var b=cc.director.getWinSize();a=new cc.ProgressTimer(a.sprite);cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(a.sprite.flippedY=!0);a.type=cc.ProgressTimer.TYPE_RADIAL;a.reverseDir=!1;a.percentage=100;this._setAttrs(a,b.width/2,b.height/2);return a}});
cc.TransitionProgressRadialCCW.create=function(a,b){return new cc.TransitionProgressRadialCCW(a,b)};
cc.TransitionProgressRadialCW=cc.TransitionProgress.extend({ctor:function(a,b){cc.TransitionProgress.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},_progressTimerNodeWithRenderTexture:function(a){var b=cc.director.getWinSize();a=new cc.ProgressTimer(a.sprite);cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(a.sprite.flippedY=!0);a.type=cc.ProgressTimer.TYPE_RADIAL;a.reverseDir=!0;a.percentage=100;this._setAttrs(a,b.width/2,b.height/2);return a}});
cc.TransitionProgressRadialCW.create=function(a,b){var c=new cc.TransitionProgressRadialCW;return null!==c&&c.initWithDuration(a,b)?c:new cc.TransitionProgressRadialCW(a,b)};
cc.TransitionProgressHorizontal=cc.TransitionProgress.extend({ctor:function(a,b){cc.TransitionProgress.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},_progressTimerNodeWithRenderTexture:function(a){var b=cc.director.getWinSize();a=new cc.ProgressTimer(a.sprite);cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(a.sprite.flippedY=!0);a.type=cc.ProgressTimer.TYPE_BAR;a.midPoint=cc.p(1,0);a.barChangeRate=cc.p(1,0);a.percentage=100;this._setAttrs(a,b.width/2,b.height/2);return a}});
cc.TransitionProgressHorizontal.create=function(a,b){return new cc.TransitionProgressHorizontal(a,b)};
cc.TransitionProgressVertical=cc.TransitionProgress.extend({ctor:function(a,b){cc.TransitionProgress.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},_progressTimerNodeWithRenderTexture:function(a){var b=cc.director.getWinSize();a=new cc.ProgressTimer(a.sprite);cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(a.sprite.flippedY=!0);a.type=cc.ProgressTimer.TYPE_BAR;a.midPoint=cc.p(0,0);a.barChangeRate=cc.p(0,1);a.percentage=100;this._setAttrs(a,b.width/2,b.height/2);return a}});
cc.TransitionProgressVertical.create=function(a,b){return new cc.TransitionProgressVertical(a,b)};
cc.TransitionProgressInOut=cc.TransitionProgress.extend({ctor:function(a,b){cc.TransitionProgress.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},_progressTimerNodeWithRenderTexture:function(a){var b=cc.director.getWinSize();a=new cc.ProgressTimer(a.sprite);cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(a.sprite.flippedY=!0);a.type=cc.ProgressTimer.TYPE_BAR;a.midPoint=cc.p(0.5,0.5);a.barChangeRate=cc.p(1,1);a.percentage=0;this._setAttrs(a,b.width/2,b.height/2);return a},_sceneOrder:function(){this._isInSceneOnTop=
!1},_setupTransition:function(){this._sceneToBeModified=this._inScene;this._from=0;this._to=100}});cc.TransitionProgressInOut.create=function(a,b){return new cc.TransitionProgressInOut(a,b)};
cc.TransitionProgressOutIn=cc.TransitionProgress.extend({ctor:function(a,b){cc.TransitionProgress.prototype.ctor.call(this);b&&this.initWithDuration(a,b)},_progressTimerNodeWithRenderTexture:function(a){var b=cc.director.getWinSize();a=new cc.ProgressTimer(a.sprite);cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(a.sprite.flippedY=!0);a.type=cc.ProgressTimer.TYPE_BAR;a.midPoint=cc.p(0.5,0.5);a.barChangeRate=cc.p(1,1);a.percentage=100;this._setAttrs(a,b.width/2,b.height/2);return a}});
cc.TransitionProgressOutIn.create=function(a,b){return new cc.TransitionProgressOutIn(a,b)};cc.TransitionPageTurn=cc.TransitionScene.extend({ctor:function(a,b,c){cc.TransitionScene.prototype.ctor.call(this);this._gridProxy=new cc.NodeGrid;this.initWithDuration(a,b,c)},_back:!0,_gridProxy:null,_className:"TransitionPageTurn",initWithDuration:function(a,b,c){this._back=c;cc.TransitionScene.prototype.initWithDuration.call(this,a,b);return!0},actionWithSize:function(a){return this._back?cc.reverseTime(cc.pageTurn3D(this._duration,a)):cc.pageTurn3D(this._duration,a)},onEnter:function(){cc.TransitionScene.prototype.onEnter.call(this);
var a=cc.director.getWinSize(),b;a.width>a.height?(a=16,b=12):(a=12,b=16);a=this.actionWithSize(cc.size(a,b));b=this._gridProxy;this._back?(b.setTarget(this._inScene),b._performRecursive(cc.Node._stateCallbackType.onEnter),this._inScene.visible=!1,b.runAction(cc.sequence(a,cc.callFunc(this.finish,this),cc.stopGrid())),this._inScene.runAction(cc.show())):(b.setTarget(this._outScene),b._performRecursive(cc.Node._stateCallbackType.onEnter),b.runAction(cc.sequence(a,cc.callFunc(this.finish,this),cc.stopGrid())))},
visit:function(){this._back?this._outScene.visit():this._inScene.visit();this._gridProxy.visit()},_sceneOrder:function(){this._isInSceneOnTop=this._back}});cc.TransitionPageTurn.create=function(a,b,c){return new cc.TransitionPageTurn(a,b,c)};cc.Codec={name:"Jacob__Codec"};cc.unzip=function(){return cc.Codec.GZip.gunzip.apply(cc.Codec.GZip,arguments)};cc.unzipBase64=function(){var a=cc.Codec.Base64.decode.apply(cc.Codec.Base64,arguments);return cc.Codec.GZip.gunzip.apply(cc.Codec.GZip,[a])};cc.unzipBase64AsArray=function(a,b){b=b||1;var c=this.unzipBase64(a),d=[],e,f,g;e=0;for(g=c.length/b;e<g;e++)for(d[e]=0,f=b-1;0<=f;--f)d[e]+=c.charCodeAt(e*b+f)<<8*f;return d};
cc.unzipAsArray=function(a,b){b=b||1;var c=this.unzip(a),d=[],e,f,g;e=0;for(g=c.length/b;e<g;e++)for(d[e]=0,f=b-1;0<=f;--f)d[e]+=c.charCodeAt(e*b+f)<<8*f;return d};cc.StringToArray=function(a){a=a.split(",");var b=[],c;for(c=0;c<a.length;c++)b.push(parseInt(a[c]));return b};cc.Codec.Base64={name:"Jacob__Codec__Base64"};cc.Codec.Base64._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d";
cc.Codec.Base64.decode=function(a){var b=[],c,d,e,f,g,h=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");h<a.length;)c=this._keyStr.indexOf(a.charAt(h++)),d=this._keyStr.indexOf(a.charAt(h++)),f=this._keyStr.indexOf(a.charAt(h++)),g=this._keyStr.indexOf(a.charAt(h++)),c=c<<2|d>>4,d=(d&15)<<4|f>>2,e=(f&3)<<6|g,b.push(String.fromCharCode(c)),64!==f&&b.push(String.fromCharCode(d)),64!==g&&b.push(String.fromCharCode(e));return b=b.join("")};
cc.Codec.Base64.decodeAsArray=function(a,b){var c=this.decode(a),d=[],e,f,g;e=0;for(g=c.length/b;e<g;e++)for(d[e]=0,f=b-1;0<=f;--f)d[e]+=c.charCodeAt(e*b+f)<<8*f;return d};cc.uint8ArrayToUint32Array=function(a){if(0!==a.length%4)return null;for(var b=a.length/4,c=window.Uint32Array?new Uint32Array(b):[],d=0;d<b;d++){var e=4*d;c[d]=a[e]+256*a[e+1]+65536*a[e+2]+16777216*a[e+3]}return c};cc.PNGReader=cc.Class.extend({ctor:function(a){var b,c,d,e;this.data=a;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(d=null;;){b=this.readUInt32();e=a=void 0;e=[];for(a=0;4>a;++a)e.push(String.fromCharCode(this.data[this.pos++]));a=e.join("");switch(a){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=
this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};break;case "PLTE":this.palette=this.read(b);break;case "fcTL":d&&this.animation.frames.push(d);this.pos+=4;d={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};a=this.readUInt16();b=this.readUInt16()||100;d.delay=1E3*a/b;d.disposeOp=this.data[this.pos++];d.blendOp=this.data[this.pos++];
d.data=[];break;case "IDAT":case "fdAT":"fdAT"===a&&(this.pos+=4,b-=4);a=(null!=d?d.data:void 0)||this.imgData;for(e=0;0<=b?e<b:e>b;0<=b?++e:--e)a.push(this.data[this.pos++]);break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=this.read(b);b=255-this.transparency.indexed.length;if(0<b)for(a=0;0<=b?a<b:a>b;0<=b?++a:--a)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(b)[0];break;case 2:this.transparency.rgb=this.read(b)}break;
case "tEXt":e=this.read(b);b=e.indexOf(0);a=String.fromCharCode.apply(String,e.slice(0,b));this.text[a]=String.fromCharCode.apply(String,e.slice(b+1));break;case "IEND":d&&this.animation.frames.push(d);a:{switch(this.colorType){case 0:case 3:case 4:d=1;break a;case 2:case 6:d=3;break a}d=void 0}this.colors=d;this.hasAlphaChannel=4===(c=this.colorType)||6===c;c=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*c;a:{switch(this.colors){case 1:c="DeviceGray";break a;case 3:c="DeviceRGB";
break a}c=void 0}this.colorSpace=c;Uint8Array!=Array&&(this.imgData=new Uint8Array(this.imgData));return;default:this.pos+=b}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");}},read:function(a){var b,c;c=[];for(b=0;0<=a?b<a:b>a;0<=a?++b:--b)c.push(this.data[this.pos++]);return c},readUInt32:function(){var a,b,c,d;a=this.data[this.pos++]<<24;b=this.data[this.pos++]<<16;c=this.data[this.pos++]<<8;d=this.data[this.pos++];return a|b|c|d},readUInt16:function(){var a,
b;a=this.data[this.pos++]<<8;b=this.data[this.pos++];return a|b},decodePixels:function(a){var b,c,d,e,f,g,h,k,m,n,p,r,s,u,t;null==a&&(a=this.imgData);if(0===a.length)return new Uint8Array(0);a=(new Zlib.Inflate(a,{index:0,verify:!1})).decompress();k=this.pixelBitlength/8;r=k*this.width;m=new Uint8Array(r*this.height);g=a.length;for(c=n=p=0;n<g;){switch(a[n++]){case 0:for(b=0;b<r;b+=1)m[c++]=a[n++];break;case 1:for(e=s=0;s<r;e=s+=1)b=a[n++],f=e<k?0:m[c-k],m[c++]=(b+f)%256;break;case 2:for(e=f=0;f<
r;e=f+=1)b=a[n++],d=(e-e%k)/k,s=p&&m[(p-1)*r+d*k+e%k],m[c++]=(s+b)%256;break;case 3:for(e=t=0;t<r;e=t+=1)b=a[n++],d=(e-e%k)/k,f=e<k?0:m[c-k],s=p&&m[(p-1)*r+d*k+e%k],m[c++]=(b+Math.floor((f+s)/2))%256;break;case 4:for(e=t=0;t<r;e=t+=1)b=a[n++],d=(e-e%k)/k,f=e<k?0:m[c-k],0===p?s=u=0:(s=m[(p-1)*r+d*k+e%k],u=d&&m[(p-1)*r+(d-1)*k+e%k]),h=f+s-u,e=Math.abs(h-f),d=Math.abs(h-s),h=Math.abs(h-u),f=e<=d&&e<=h?f:d<=h?s:u,m[c++]=(b+f)%256;break;default:throw Error("Invalid filter algorithm: "+a[n-1]);}p++}return m},
copyToImageData:function(a,b){var c,d,e,f,g,h,k,m;d=this.colors;m=null;c=this.hasAlphaChannel;this.palette.length&&(m=null!=(e=this._decodedPalette)?e:this._decodedPalette=this.decodePalette(),d=4,c=!0);e=a.data||a;k=e.length;g=m||b;f=h=0;if(1===d)for(;f<k;)d=m?4*b[f/4]:h,h=g[d++],e[f++]=h,e[f++]=h,e[f++]=h,e[f++]=c?g[d++]:255,h=d;else for(;f<k;)d=m?4*b[f/4]:h,e[f++]=g[d++],e[f++]=g[d++],e[f++]=g[d++],e[f++]=c?g[d++]:255,h=d},decodePalette:function(){var a,b,c,d,e,f,g,h,k;c=this.palette;f=this.transparency.indexed||
[];e=new Uint8Array((f.length||0)+c.length);b=g=a=d=0;for(h=c.length;g<h;b=g+=3)e[d++]=c[b],e[d++]=c[b+1],e[d++]=c[b+2],e[d++]=null!=(k=f[a++])?k:255;return e},render:function(a){var b;a.width=this.width;a.height=this.height;a=a.getContext("2d");b=a.createImageData(this.width,this.height);this.copyToImageData(b,this.decodePixels());return a.putImageData(b,0,0)}});cc.tiffReader={_littleEndian:!1,_tiffData:null,_fileDirectories:[],getUint8:function(a){return this._tiffData[a]},getUint16:function(a){return this._littleEndian?this._tiffData[a+1]<<8|this._tiffData[a]:this._tiffData[a]<<8|this._tiffData[a+1]},getUint32:function(a){var b=this._tiffData;return this._littleEndian?b[a+3]<<24|b[a+2]<<16|b[a+1]<<8|b[a]:b[a]<<24|b[a+1]<<16|b[a+2]<<8|b[a+3]},checkLittleEndian:function(){var a=this.getUint16(0);if(18761===a)this.littleEndian=!0;else if(19789===a)this.littleEndian=
!1;else throw console.log(a),TypeError("Invalid byte order value.");return this.littleEndian},hasTowel:function(){if(42!==this.getUint16(2))throw RangeError("You forgot your towel!");return!0},getFieldTypeName:function(a){var b=this.fieldTypeNames;return a in b?b[a]:null},getFieldTagName:function(a){var b=this.fieldTagNames;if(a in b)return b[a];console.log("Unknown Field Tag:",a);return"Tag"+a},getFieldTypeLength:function(a){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(a)?1:-1!==["SHORT",
"SSHORT"].indexOf(a)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(a)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(a)?8:null},getFieldValues:function(a,b,c,d){a=[];var e=this.getFieldTypeLength(b);if(4>=e*c)!1===this.littleEndian?a.push(d>>>8*(4-e)):a.push(d);else for(var f=0;f<c;f++){var g=e*f;8<=e?-1!==["RATIONAL","SRATIONAL"].indexOf(b)?(a.push(this.getUint32(d+g)),a.push(this.getUint32(d+g+4))):cc.log("Can't handle this field type or size"):a.push(this.getBytes(e,d+g))}"ASCII"===b&&a.forEach(function(a,
b,c){c[b]=String.fromCharCode(a)});return a},getBytes:function(a,b){if(0>=a)cc.log("No bytes requested");else{if(1>=a)return this.getUint8(b);if(2>=a)return this.getUint16(b);if(3>=a)return this.getUint32(b)>>>8;if(4>=a)return this.getUint32(b);cc.log("Too many bytes requested")}},getBits:function(a,b,c){c=c||0;b+=Math.floor(c/8);var d=c+a;a=32-a;var e,f;0>=d?console.log("No bits requested"):8>=d?(e=24+c,f=this.getUint8(b)):16>=d?(e=16+c,f=this.getUint16(b)):32>=d?(e=c,f=this.getUint32(b)):console.log("Too many bits requested");
return{bits:f<<e>>>a,byteOffset:b+Math.floor(d/8),bitOffset:d%8}},parseFileDirectory:function(a){var b=this.getUint16(a),c=[];a+=2;for(var d=0;d<b;a+=12,d++){var e=this.getUint16(a),f=this.getUint16(a+2),g=this.getUint32(a+4),h=this.getUint32(a+8),e=this.getFieldTagName(e),f=this.getFieldTypeName(f),g=this.getFieldValues(e,f,g,h);c[e]={type:f,values:g}}this._fileDirectories.push(c);b=this.getUint32(a);0!==b&&this.parseFileDirectory(b)},clampColorSample:function(a,b){var c=Math.pow(2,8-b);return Math.floor(a*
c+(c-1))},parseTIFF:function(a,b){b=b||document.createElement("canvas");this._tiffData=a;this.canvas=b;this.checkLittleEndian();if(this.hasTowel()){var c=this.getUint32(4);this._fileDirectories.length=0;this.parseFileDirectory(c);var d=this._fileDirectories[0],c=d.ImageWidth.values[0],e=d.ImageLength.values[0];this.canvas.width=c;this.canvas.height=e;var f=[],g=d.Compression?d.Compression.values[0]:1,h=d.SamplesPerPixel.values[0],k=[],m=0,n=!1;d.BitsPerSample.values.forEach(function(a,b,c){k[b]={bitsPerSample:a,
hasBytesPerSample:!1,bytesPerSample:void 0};0===a%8&&(k[b].hasBytesPerSample=!0,k[b].bytesPerSample=a/8);m+=a},this);if(0===m%8)var n=!0,p=m/8;var r=d.StripOffsets.values,s=r.length;if(d.StripByteCounts)var u=d.StripByteCounts.values;else if(cc.log("Missing StripByteCounts!"),1===s)u=[Math.ceil(c*e*m/8)];else throw Error("Cannot recover from missing StripByteCounts");for(var t=0;t<s;t++){var w=r[t];f[t]=[];for(var v=u[t],x=0,A=0,y=1,z=!0,B=[],D=0,C=0,G=0;x<v;x+=y)switch(g){case 1:y=0;for(B=[];y<h;y++)if(k[y].hasBytesPerSample)B.push(this.getBytes(k[y].bytesPerSample,
w+x+k[y].bytesPerSample*y));else{var F=this.getBits(k[y].bitsPerSample,w+x,A);B.push(F.bits);x=F.byteOffset-w;A=F.bitOffset;throw RangeError("Cannot handle sub-byte bits per sample");}f[t].push(B);if(n)y=p;else throw y=0,RangeError("Cannot handle sub-byte bits per pixel");break;case 32773:if(z){var z=!1,E=1,J=1,y=this.getInt8(w+x);0<=y&&127>=y?E=y+1:-127<=y&&-1>=y?J=-y+1:z=!0}else{for(var K=this.getUint8(w+x),y=0;y<J;y++){if(k[C].hasBytesPerSample)G=G<<8*D|K,D++,D===k[C].bytesPerSample&&(B.push(G),
G=D=0,C++);else throw RangeError("Cannot handle sub-byte bits per sample");C===h&&(f[t].push(B),B=[],C=0)}E--;0===E&&(z=!0)}y=1}}if(b.getContext){p=this.canvas.getContext("2d");p.fillStyle="rgba(255, 255, 255, 0)";t=d.RowsPerStrip?d.RowsPerStrip.values[0]:e;w=f.length;e%=t;e=0===e?t:e;x=t;g=0;B=d.PhotometricInterpretation.values[0];E=[];J=0;d.ExtraSamples&&(E=d.ExtraSamples.values,J=E.length);if(d.ColorMap)var F=d.ColorMap.values,I=Math.pow(2,k[0].bitsPerSample);for(t=0;t<w;t++){t+1===w&&(x=e);d=
f[t].length;g*=t;for(n=h=0;h<x,n<d;h++)for(r=0;r<c;r++,n++){u=f[t][n];z=A=v=0;s=1;if(0<J)for(v=0;v<J;v++)if(1===E[v]||2===E[v]){s=u[3+v]/256;break}switch(B){case 0:if(k[0].hasBytesPerSample)var M=Math.pow(16,2*k[0].bytesPerSample);u.forEach(function(a,b,c){c[b]=M-a});case 1:v=A=z=this.clampColorSample(u[0],k[0].bitsPerSample);break;case 2:v=this.clampColorSample(u[0],k[0].bitsPerSample);A=this.clampColorSample(u[1],k[1].bitsPerSample);z=this.clampColorSample(u[2],k[2].bitsPerSample);break;case 3:if(void 0===
F)throw Error("Palette image missing color map");u=u[0];v=this.clampColorSample(F[u],16);A=this.clampColorSample(F[I+u],16);z=this.clampColorSample(F[2*I+u],16);break;default:throw RangeError("Unknown Photometric Interpretation:",B);}p.fillStyle="rgba("+v+", "+A+", "+z+", "+s+")";p.fillRect(r,g+h,1,1)}g=x}}return this.canvas}},fieldTagNames:{315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",
289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",
326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",
344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",
700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},fieldTypeNames:{1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"}};cc.Particle=function(a,b,c,d,e,f,g,h,k,m,n,p){this.pos=a?a:cc.p(0,0);this.startPos=b?b:cc.p(0,0);this.color=c?c:{r:0,g:0,b:0,a:255};this.deltaColor=d?d:{r:0,g:0,b:0,a:255};this.size=e||0;this.deltaSize=f||0;this.rotation=g||0;this.deltaRotation=h||0;this.timeToLive=k||0;this.atlasIndex=m||0;this.modeA=n?n:new cc.Particle.ModeA;this.modeB=p?p:new cc.Particle.ModeB;this.isChangeColor=!1;this.drawPos=cc.p(0,0)};
cc.Particle.ModeA=function(a,b,c){this.dir=a?a:cc.p(0,0);this.radialAccel=b||0;this.tangentialAccel=c||0};cc.Particle.ModeB=function(a,b,c,d){this.angle=a||0;this.degreesPerSecond=b||0;this.radius=c||0;this.deltaRadius=d||0};cc.Particle.TemporaryPoints=[cc.p(),cc.p(),cc.p(),cc.p()];
cc.ParticleSystem=cc.Node.extend({_className:"ParticleSystem",_plistFile:"",_elapsed:0,_dontTint:!1,modeA:null,modeB:null,_pointZeroForParticle:cc.p(0,0),_particles:null,_emitCounter:0,_particleIdx:0,_batchNode:null,atlasIndex:0,_transformSystemDirty:!1,_allocatedParticles:0,_isActive:!1,particleCount:0,duration:0,_sourcePosition:null,_posVar:null,life:0,lifeVar:0,angle:0,angleVar:0,startSize:0,startSizeVar:0,endSize:0,endSizeVar:0,_startColor:null,_startColorVar:null,_endColor:null,_endColorVar:null,
startSpin:0,startSpinVar:0,endSpin:0,endSpinVar:0,emissionRate:0,_totalParticles:0,_texture:null,_blendFunc:null,_opacityModifyRGB:!1,positionType:null,autoRemoveOnFinish:!1,emitterMode:0,_textureLoaded:null,ctor:function(a){cc.Node.prototype.ctor.call(this);this.emitterMode=cc.ParticleSystem.MODE_GRAVITY;this.modeA=new cc.ParticleSystem.ModeA;this.modeB=new cc.ParticleSystem.ModeB;this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST};this._particles=[];this._sourcePosition=cc.p(0,0);this._posVar=cc.p(0,
0);this._startColor=cc.color(255,255,255,255);this._startColorVar=cc.color(255,255,255,255);this._endColor=cc.color(255,255,255,255);this._endColorVar=cc.color(255,255,255,255);this._plistFile="";this._elapsed=0;this._dontTint=!1;this._pointZeroForParticle=cc.p(0,0);this._particleIdx=this._emitCounter=0;this._batchNode=null;this.atlasIndex=0;this._transformSystemDirty=!1;this._allocatedParticles=0;this._isActive=!1;this._totalParticles=this.emissionRate=this.endSpinVar=this.endSpin=this.startSpinVar=
this.startSpin=this.endSizeVar=this.endSize=this.startSizeVar=this.startSize=this.angleVar=this.angle=this.lifeVar=this.life=this.duration=this.particleCount=0;this._texture=null;this._opacityModifyRGB=!1;this.positionType=cc.ParticleSystem.TYPE_FREE;this.autoRemoveOnFinish=!1;this._textureLoaded=!0;!a||cc.isNumber(a)?(a=a||100,this.setDrawMode(cc.ParticleSystem.TEXTURE_MODE),this.initWithTotalParticles(a)):cc.isString(a)?this.initWithFile(a):cc.isObject(a)&&this.initWithDictionary(a,"")},_createRenderCmd:function(){return cc._renderType===
cc.game.RENDER_TYPE_CANVAS?new cc.ParticleSystem.CanvasRenderCmd(this):new cc.ParticleSystem.WebGLRenderCmd(this)},ignoreColor:function(a){this._dontTint=a},initTexCoordsWithRect:function(a){this._renderCmd.initTexCoordsWithRect(a)},getBatchNode:function(){return this._batchNode},setBatchNode:function(a){this._renderCmd.setBatchNode(a)},getAtlasIndex:function(){return this.atlasIndex},setAtlasIndex:function(a){this.atlasIndex=a},getDrawMode:function(){return this._renderCmd.getDrawMode()},setDrawMode:function(a){this._renderCmd.setDrawMode(a)},
getShapeType:function(){return this._renderCmd.getShapeType()},setShapeType:function(a){this._renderCmd.setShapeType(a)},isActive:function(){return this._isActive},getParticleCount:function(){return this.particleCount},setParticleCount:function(a){this.particleCount=a},getDuration:function(){return this.duration},setDuration:function(a){this.duration=a},getSourcePosition:function(){return{x:this._sourcePosition.x,y:this._sourcePosition.y}},setSourcePosition:function(a){this._sourcePosition.x=a.x;
this._sourcePosition.y=a.y},getPosVar:function(){return{x:this._posVar.x,y:this._posVar.y}},setPosVar:function(a){this._posVar.x=a.x;this._posVar.y=a.y},getLife:function(){return this.life},setLife:function(a){this.life=a},getLifeVar:function(){return this.lifeVar},setLifeVar:function(a){this.lifeVar=a},getAngle:function(){return this.angle},setAngle:function(a){this.angle=a},getAngleVar:function(){return this.angleVar},setAngleVar:function(a){this.angleVar=a},getGravity:function(){this.emitterMode!==
cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getGravity() : Particle Mode should be Gravity");var a=this.modeA.gravity;return cc.p(a.x,a.y)},setGravity:function(a){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setGravity() : Particle Mode should be Gravity");this.modeA.gravity=a},getSpeed:function(){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getSpeed() : Particle Mode should be Gravity");return this.modeA.speed},
setSpeed:function(a){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setSpeed() : Particle Mode should be Gravity");this.modeA.speed=a},getSpeedVar:function(){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getSpeedVar() : Particle Mode should be Gravity");return this.modeA.speedVar},setSpeedVar:function(a){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setSpeedVar() : Particle Mode should be Gravity");
this.modeA.speedVar=a},getTangentialAccel:function(){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getTangentialAccel() : Particle Mode should be Gravity");return this.modeA.tangentialAccel},setTangentialAccel:function(a){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setTangentialAccel() : Particle Mode should be Gravity");this.modeA.tangentialAccel=a},getTangentialAccelVar:function(){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&
cc.log("cc.ParticleBatchNode.getTangentialAccelVar() : Particle Mode should be Gravity");return this.modeA.tangentialAccelVar},setTangentialAccelVar:function(a){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setTangentialAccelVar() : Particle Mode should be Gravity");this.modeA.tangentialAccelVar=a},getRadialAccel:function(){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getRadialAccel() : Particle Mode should be Gravity");return this.modeA.radialAccel},
setRadialAccel:function(a){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setRadialAccel() : Particle Mode should be Gravity");this.modeA.radialAccel=a},getRadialAccelVar:function(){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getRadialAccelVar() : Particle Mode should be Gravity");return this.modeA.radialAccelVar},setRadialAccelVar:function(a){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setRadialAccelVar() : Particle Mode should be Gravity");
this.modeA.radialAccelVar=a},getRotationIsDir:function(){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.getRotationIsDir() : Particle Mode should be Gravity");return this.modeA.rotationIsDir},setRotationIsDir:function(a){this.emitterMode!==cc.ParticleSystem.MODE_GRAVITY&&cc.log("cc.ParticleBatchNode.setRotationIsDir() : Particle Mode should be Gravity");this.modeA.rotationIsDir=a},getStartRadius:function(){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getStartRadius() : Particle Mode should be Radius");
return this.modeB.startRadius},setStartRadius:function(a){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setStartRadius() : Particle Mode should be Radius");this.modeB.startRadius=a},getStartRadiusVar:function(){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getStartRadiusVar() : Particle Mode should be Radius");return this.modeB.startRadiusVar},setStartRadiusVar:function(a){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setStartRadiusVar() : Particle Mode should be Radius");
this.modeB.startRadiusVar=a},getEndRadius:function(){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getEndRadius() : Particle Mode should be Radius");return this.modeB.endRadius},setEndRadius:function(a){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setEndRadius() : Particle Mode should be Radius");this.modeB.endRadius=a},getEndRadiusVar:function(){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getEndRadiusVar() : Particle Mode should be Radius");
return this.modeB.endRadiusVar},setEndRadiusVar:function(a){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setEndRadiusVar() : Particle Mode should be Radius");this.modeB.endRadiusVar=a},getRotatePerSecond:function(){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getRotatePerSecond() : Particle Mode should be Radius");return this.modeB.rotatePerSecond},setRotatePerSecond:function(a){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setRotatePerSecond() : Particle Mode should be Radius");
this.modeB.rotatePerSecond=a},getRotatePerSecondVar:function(){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.getRotatePerSecondVar() : Particle Mode should be Radius");return this.modeB.rotatePerSecondVar},setRotatePerSecondVar:function(a){this.emitterMode!==cc.ParticleSystem.MODE_RADIUS&&cc.log("cc.ParticleBatchNode.setRotatePerSecondVar() : Particle Mode should be Radius");this.modeB.rotatePerSecondVar=a},setScale:function(a,b){this._transformSystemDirty=!0;cc.Node.prototype.setScale.call(this,
a,b)},setRotation:function(a){this._transformSystemDirty=!0;cc.Node.prototype.setRotation.call(this,a)},setScaleX:function(a){this._transformSystemDirty=!0;cc.Node.prototype.setScaleX.call(this,a)},setScaleY:function(a){this._transformSystemDirty=!0;cc.Node.prototype.setScaleY.call(this,a)},getStartSize:function(){return this.startSize},setStartSize:function(a){this.startSize=a},getStartSizeVar:function(){return this.startSizeVar},setStartSizeVar:function(a){this.startSizeVar=a},getEndSize:function(){return this.endSize},
setEndSize:function(a){this.endSize=a},getEndSizeVar:function(){return this.endSizeVar},setEndSizeVar:function(a){this.endSizeVar=a},getStartColor:function(){return cc.color(this._startColor.r,this._startColor.g,this._startColor.b,this._startColor.a)},setStartColor:function(a){this._startColor.r=a.r;this._startColor.g=a.g;this._startColor.b=a.b;this._startColor.a=a.a},getStartColorVar:function(){return cc.color(this._startColorVar.r,this._startColorVar.g,this._startColorVar.b,this._startColorVar.a)},
setStartColorVar:function(a){this._startColorVar.r=a.r;this._startColorVar.g=a.g;this._startColorVar.b=a.b;this._startColorVar.a=a.a},getEndColor:function(){return cc.color(this._endColor.r,this._endColor.g,this._endColor.b,this._endColor.a)},setEndColor:function(a){this._endColor.r=a.r;this._endColor.g=a.g;this._endColor.b=a.b;this._endColor.a=a.a},getEndColorVar:function(){return cc.color(this._endColorVar.r,this._endColorVar.g,this._endColorVar.b,this._endColorVar.a)},setEndColorVar:function(a){this._endColorVar.r=
a.r;this._endColorVar.g=a.g;this._endColorVar.b=a.b;this._endColorVar.a=a.a},getStartSpin:function(){return this.startSpin},setStartSpin:function(a){this.startSpin=a},getStartSpinVar:function(){return this.startSpinVar},setStartSpinVar:function(a){this.startSpinVar=a},getEndSpin:function(){return this.endSpin},setEndSpin:function(a){this.endSpin=a},getEndSpinVar:function(){return this.endSpinVar},setEndSpinVar:function(a){this.endSpinVar=a},getEmissionRate:function(){return this.emissionRate},setEmissionRate:function(a){this.emissionRate=
a},getTotalParticles:function(){return this._totalParticles},setTotalParticles:function(a){this._renderCmd.setTotalParticles(a)},getTexture:function(){return this._texture},setTexture:function(a){a&&(a.isLoaded()?this.setTextureWithRect(a,cc.rect(0,0,a.width,a.height)):(this._textureLoaded=!1,a.addEventListener("load",function(a){this._textureLoaded=!0;this.setTextureWithRect(a,cc.rect(0,0,a.width,a.height))},this)))},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(a,b){if(void 0===
b)this._blendFunc!==a&&(this._blendFunc=a,this._updateBlendFunc());else if(this._blendFunc.src!==a||this._blendFunc.dst!==b)this._blendFunc={src:a,dst:b},this._updateBlendFunc()},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setOpacityModifyRGB:function(a){this._opacityModifyRGB=a},isBlendAdditive:function(){return this._blendFunc.src===cc.SRC_ALPHA&&this._blendFunc.dst===cc.ONE||this._blendFunc.src===cc.ONE&&this._blendFunc.dst===cc.ONE},setBlendAdditive:function(a){var b=this._blendFunc;
a?(b.src=cc.SRC_ALPHA,b.dst=cc.ONE):this._renderCmd._setBlendAdditive()},getPositionType:function(){return this.positionType},setPositionType:function(a){this.positionType=a},isAutoRemoveOnFinish:function(){return this.autoRemoveOnFinish},setAutoRemoveOnFinish:function(a){this.autoRemoveOnFinish=a},getEmitterMode:function(){return this.emitterMode},setEmitterMode:function(a){this.emitterMode=a},init:function(){return this.initWithTotalParticles(150)},initWithFile:function(a){this._plistFile=a;a=cc.loader.getRes(a);
return a?this.initWithDictionary(a,""):(cc.log("cc.ParticleSystem.initWithFile(): Particles: file not found"),!1)},getBoundingBoxToWorld:function(){return cc.rect(0,0,cc._canvas.width,cc._canvas.height)},initWithDictionary:function(a,b){var c=!1,d=null,d=this._valueForKey,e=parseInt(d("maxParticles",a));if(this.initWithTotalParticles(e)){this.angle=parseFloat(d("angle",a));this.angleVar=parseFloat(d("angleVariance",a));this.duration=parseFloat(d("duration",a));this._blendFunc.src=parseInt(d("blendFuncSource",
a));this._blendFunc.dst=parseInt(d("blendFuncDestination",a));c=this._startColor;c.r=255*parseFloat(d("startColorRed",a));c.g=255*parseFloat(d("startColorGreen",a));c.b=255*parseFloat(d("startColorBlue",a));c.a=255*parseFloat(d("startColorAlpha",a));c=this._startColorVar;c.r=255*parseFloat(d("startColorVarianceRed",a));c.g=255*parseFloat(d("startColorVarianceGreen",a));c.b=255*parseFloat(d("startColorVarianceBlue",a));c.a=255*parseFloat(d("startColorVarianceAlpha",a));c=this._endColor;c.r=255*parseFloat(d("finishColorRed",
a));c.g=255*parseFloat(d("finishColorGreen",a));c.b=255*parseFloat(d("finishColorBlue",a));c.a=255*parseFloat(d("finishColorAlpha",a));c=this._endColorVar;c.r=255*parseFloat(d("finishColorVarianceRed",a));c.g=255*parseFloat(d("finishColorVarianceGreen",a));c.b=255*parseFloat(d("finishColorVarianceBlue",a));c.a=255*parseFloat(d("finishColorVarianceAlpha",a));this.startSize=parseFloat(d("startParticleSize",a));this.startSizeVar=parseFloat(d("startParticleSizeVariance",a));this.endSize=parseFloat(d("finishParticleSize",
a));this.endSizeVar=parseFloat(d("finishParticleSizeVariance",a));this.setPosition(parseFloat(d("sourcePositionx",a)),parseFloat(d("sourcePositiony",a)));this._posVar.x=parseFloat(d("sourcePositionVariancex",a));this._posVar.y=parseFloat(d("sourcePositionVariancey",a));this.startSpin=parseFloat(d("rotationStart",a));this.startSpinVar=parseFloat(d("rotationStartVariance",a));this.endSpin=parseFloat(d("rotationEnd",a));this.endSpinVar=parseFloat(d("rotationEndVariance",a));this.emitterMode=parseInt(d("emitterType",
a));if(this.emitterMode===cc.ParticleSystem.MODE_GRAVITY)c=this.modeA,c.gravity.x=parseFloat(d("gravityx",a)),c.gravity.y=parseFloat(d("gravityy",a)),c.speed=parseFloat(d("speed",a)),c.speedVar=parseFloat(d("speedVariance",a)),e=d("radialAcceleration",a),c.radialAccel=e?parseFloat(e):0,e=d("radialAccelVariance",a),c.radialAccelVar=e?parseFloat(e):0,e=d("tangentialAcceleration",a),c.tangentialAccel=e?parseFloat(e):0,e=d("tangentialAccelVariance",a),c.tangentialAccelVar=e?parseFloat(e):0,e=d("rotationIsDir",
a),null!==e?(e=e.toString().toLowerCase(),c.rotationIsDir="true"===e||"1"===e):c.rotationIsDir=!1;else if(this.emitterMode===cc.ParticleSystem.MODE_RADIUS)c=this.modeB,c.startRadius=parseFloat(d("maxRadius",a)),c.startRadiusVar=parseFloat(d("maxRadiusVariance",a)),c.endRadius=parseFloat(d("minRadius",a)),c.endRadiusVar=0,c.rotatePerSecond=parseFloat(d("rotatePerSecond",a)),c.rotatePerSecondVar=parseFloat(d("rotatePerSecondVariance",a));else return cc.log("cc.ParticleSystem.initWithDictionary(): Invalid emitterType in config file"),
!1;this.life=parseFloat(d("particleLifespan",a));this.lifeVar=parseFloat(d("particleLifespanVariance",a));this.emissionRate=this._totalParticles/this.life;if(!this._batchNode)if(this._opacityModifyRGB=!1,c=d("textureFileName",a),c=cc.path.changeBasename(this._plistFile,c),e=cc.textureCache.getTextureForKey(c))this.setTexture(e);else if((d=d("textureImageData",a))&&0!==d.length){d=cc.unzipBase64AsArray(d,1);if(!d)return cc.log("cc.ParticleSystem: error decoding or ungzipping textureImageData"),!1;
e=cc.getImageFormatByData(d);if(e!==cc.FMT_TIFF&&e!==cc.FMT_PNG)return cc.log("cc.ParticleSystem: unknown image format with Data"),!1;var f=document.createElement("canvas");e===cc.FMT_PNG?(new cc.PNGReader(d)).render(f):cc.tiffReader.parseTIFF(d,f);cc.textureCache.cacheImage(c,f);(d=cc.textureCache.getTextureForKey(c))||cc.log("cc.ParticleSystem.initWithDictionary() : error loading the texture");this.setTexture(d)}else{e=cc.textureCache.addImage(c);if(!e)return!1;this.setTexture(e)}c=!0}return c},
initWithTotalParticles:function(a){this._totalParticles=a;var b,c=this._particles;for(b=c.length=0;b<a;b++)c[b]=new cc.Particle;if(!c)return cc.log("Particle system: not enough memory"),!1;this._allocatedParticles=a;if(this._batchNode)for(b=0;b<this._totalParticles;b++)c[b].atlasIndex=b;this._isActive=!0;this._blendFunc.src=cc.BLEND_SRC;this._blendFunc.dst=cc.BLEND_DST;this.positionType=cc.ParticleSystem.TYPE_FREE;this.emitterMode=cc.ParticleSystem.MODE_GRAVITY;this._transformSystemDirty=this.autoRemoveOnFinish=
!1;this.scheduleUpdateWithPriority(1);this._renderCmd._initWithTotalParticles(a);return!0},destroyParticleSystem:function(){this.unscheduleUpdate()},addParticle:function(){if(this.isFull())return!1;var a=this._renderCmd.addParticle();this.initParticle(a);++this.particleCount;return!0},initParticle:function(a){var b=cc.randomMinus1To1;a.timeToLive=this.life+this.lifeVar*b();a.timeToLive=Math.max(0,a.timeToLive);a.pos.x=this._sourcePosition.x+this._posVar.x*b();a.pos.y=this._sourcePosition.y+this._posVar.y*
b();var c,d;c=this._startColor;var e=this._startColorVar,f=this._endColor;d=this._endColorVar;c={r:cc.clampf(c.r+e.r*b(),0,255),g:cc.clampf(c.g+e.g*b(),0,255),b:cc.clampf(c.b+e.b*b(),0,255),a:cc.clampf(c.a+e.a*b(),0,255)};d={r:cc.clampf(f.r+d.r*b(),0,255),g:cc.clampf(f.g+d.g*b(),0,255),b:cc.clampf(f.b+d.b*b(),0,255),a:cc.clampf(f.a+d.a*b(),0,255)};a.color=c;e=a.deltaColor;f=a.timeToLive;e.r=(d.r-c.r)/f;e.g=(d.g-c.g)/f;e.b=(d.b-c.b)/f;e.a=(d.a-c.a)/f;c=this.startSize+this.startSizeVar*b();c=Math.max(0,
c);a.size=c;this.endSize===cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE?a.deltaSize=0:(d=this.endSize+this.endSizeVar*b(),d=Math.max(0,d),a.deltaSize=(d-c)/f);c=this.startSpin+this.startSpinVar*b();d=this.endSpin+this.endSpinVar*b();a.rotation=c;a.deltaRotation=(d-c)/f;this.positionType===cc.ParticleSystem.TYPE_FREE?a.startPos=this.convertToWorldSpace(this._pointZeroForParticle):this.positionType===cc.ParticleSystem.TYPE_RELATIVE&&(a.startPos.x=this._position.x,a.startPos.y=this._position.y);c=
cc.degreesToRadians(this.angle+this.angleVar*b());if(this.emitterMode===cc.ParticleSystem.MODE_GRAVITY)f=this.modeA,d=a.modeA,e=f.speed+f.speedVar*b(),d.dir.x=Math.cos(c),d.dir.y=Math.sin(c),cc.pMultIn(d.dir,e),d.radialAccel=f.radialAccel+f.radialAccelVar*b(),d.tangentialAccel=f.tangentialAccel+f.tangentialAccelVar*b(),f.rotationIsDir&&(a.rotation=-cc.radiansToDegrees(cc.pToAngle(d.dir)));else{d=this.modeB;a=a.modeB;var e=d.startRadius+d.startRadiusVar*b(),g=d.endRadius+d.endRadiusVar*b();a.radius=
e;a.deltaRadius=d.endRadius===cc.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS?0:(g-e)/f;a.angle=c;a.degreesPerSecond=cc.degreesToRadians(d.rotatePerSecond+d.rotatePerSecondVar*b())}},stopSystem:function(){this._isActive=!1;this._elapsed=this.duration;this._emitCounter=0},resetSystem:function(){this._isActive=!0;this._elapsed=0;var a=this._particles;for(this._particleIdx=0;this._particleIdx<this.particleCount;++this._particleIdx)a[this._particleIdx].timeToLive=0},isFull:function(){return this.particleCount>=
this._totalParticles},updateQuadWithParticle:function(a,b){this._renderCmd.updateQuadWithParticle(a,b)},postStep:function(){this._renderCmd.postStep()},update:function(a){if(this._isActive&&this.emissionRate){var b=1/this.emissionRate;this.particleCount<this._totalParticles&&(this._emitCounter+=a);for(;this.particleCount<this._totalParticles&&this._emitCounter>b;)this.addParticle(),this._emitCounter-=b;this._elapsed+=a;-1!==this.duration&&this.duration<this._elapsed&&this.stopSystem()}this._particleIdx=
0;b=cc.Particle.TemporaryPoints[0];this.positionType===cc.ParticleSystem.TYPE_FREE?cc.pIn(b,this.convertToWorldSpace(this._pointZeroForParticle)):this.positionType===cc.ParticleSystem.TYPE_RELATIVE&&(b.x=this._position.x,b.y=this._position.y);if(this._visible){for(var c=cc.Particle.TemporaryPoints[1],d=cc.Particle.TemporaryPoints[2],e=cc.Particle.TemporaryPoints[3],f=this._particles;this._particleIdx<this.particleCount;){cc.pZeroIn(c);cc.pZeroIn(d);cc.pZeroIn(e);var g=f[this._particleIdx];g.timeToLive-=
a;if(0<g.timeToLive){if(this.emitterMode===cc.ParticleSystem.MODE_GRAVITY){var h=e,k=c,m=d;g.pos.x||g.pos.y?(cc.pIn(k,g.pos),cc.pNormalizeIn(k)):cc.pZeroIn(k);cc.pIn(m,k);cc.pMultIn(k,g.modeA.radialAccel);var n=m.x;m.x=-m.y;m.y=n;cc.pMultIn(m,g.modeA.tangentialAccel);cc.pIn(h,k);cc.pAddIn(h,m);cc.pAddIn(h,this.modeA.gravity);cc.pMultIn(h,a);cc.pAddIn(g.modeA.dir,h);cc.pIn(h,g.modeA.dir);cc.pMultIn(h,a);cc.pAddIn(g.pos,h)}else h=g.modeB,h.angle+=h.degreesPerSecond*a,h.radius+=h.deltaRadius*a,g.pos.x=
-Math.cos(h.angle)*h.radius,g.pos.y=-Math.sin(h.angle)*h.radius;this._renderCmd._updateDeltaColor(g,a);g.size+=g.deltaSize*a;g.size=Math.max(0,g.size);g.rotation+=g.deltaRotation*a;h=c;this.positionType===cc.ParticleSystem.TYPE_FREE||this.positionType===cc.ParticleSystem.TYPE_RELATIVE?(k=d,cc.pIn(k,b),cc.pSubIn(k,g.startPos),cc.pIn(h,g.pos),cc.pSubIn(h,k)):cc.pIn(h,g.pos);this._batchNode&&(h.x+=this._position.x,h.y+=this._position.y);this._renderCmd.updateParticlePosition(g,h);++this._particleIdx}else if(g=
g.atlasIndex,this._particleIdx!==this.particleCount-1&&(h=f[this._particleIdx],f[this._particleIdx]=f[this.particleCount-1],f[this.particleCount-1]=h),this._batchNode&&(this._batchNode.disableParticle(this.atlasIndex+g),f[this.particleCount-1].atlasIndex=g),--this.particleCount,0===this.particleCount&&this.autoRemoveOnFinish){this.unscheduleUpdate();this._parent.removeChild(this,!0);return}}this._transformSystemDirty=!1}this._batchNode||this.postStep()},updateWithNoTime:function(){this.update(0)},
_valueForKey:function(a,b){if(b){var c=b[a];return null!=c?c:""}return""},_updateBlendFunc:function(){if(this._batchNode)cc.log("Can't change blending functions when the particle is being batched");else{var a=this._texture;if(a&&a instanceof cc.Texture2D){this._opacityModifyRGB=!1;var b=this._blendFunc;b.src===cc.BLEND_SRC&&b.dst===cc.BLEND_DST&&(a.hasPremultipliedAlpha()?this._opacityModifyRGB=!0:(b.src=cc.SRC_ALPHA,b.dst=cc.ONE_MINUS_SRC_ALPHA))}}},clone:function(){var a=new cc.ParticleSystem;if(a.initWithTotalParticles(this.getTotalParticles())){a.setAngle(this.getAngle());
a.setAngleVar(this.getAngleVar());a.setDuration(this.getDuration());var b=this.getBlendFunc();a.setBlendFunc(b.src,b.dst);a.setStartColor(this.getStartColor());a.setStartColorVar(this.getStartColorVar());a.setEndColor(this.getEndColor());a.setEndColorVar(this.getEndColorVar());a.setStartSize(this.getStartSize());a.setStartSizeVar(this.getStartSizeVar());a.setEndSize(this.getEndSize());a.setEndSizeVar(this.getEndSizeVar());a.setPosition(cc.p(this.x,this.y));a.setPosVar(cc.p(this.getPosVar().x,this.getPosVar().y));
a.setPositionType(this.getPositionType());a.setStartSpin(this.getStartSpin()||0);a.setStartSpinVar(this.getStartSpinVar()||0);a.setEndSpin(this.getEndSpin()||0);a.setEndSpinVar(this.getEndSpinVar()||0);a.setEmitterMode(this.getEmitterMode());this.getEmitterMode()===cc.ParticleSystem.MODE_GRAVITY?(b=this.getGravity(),a.setGravity(cc.p(b.x,b.y)),a.setSpeed(this.getSpeed()),a.setSpeedVar(this.getSpeedVar()),a.setRadialAccel(this.getRadialAccel()),a.setRadialAccelVar(this.getRadialAccelVar()),a.setTangentialAccel(this.getTangentialAccel()),
a.setTangentialAccelVar(this.getTangentialAccelVar())):this.getEmitterMode()===cc.ParticleSystem.MODE_RADIUS&&(a.setStartRadius(this.getStartRadius()),a.setStartRadiusVar(this.getStartRadiusVar()),a.setEndRadius(this.getEndRadius()),a.setEndRadiusVar(this.getEndRadiusVar()),a.setRotatePerSecond(this.getRotatePerSecond()),a.setRotatePerSecondVar(this.getRotatePerSecondVar()));a.setLife(this.getLife());a.setLifeVar(this.getLifeVar());a.setEmissionRate(this.getEmissionRate());if(!this.getBatchNode()&&
(a.setOpacityModifyRGB(this.isOpacityModifyRGB()),b=this.getTexture())){var c=b.getContentSize();a.setTextureWithRect(b,cc.rect(0,0,c.width,c.height))}}return a},setDisplayFrame:function(a){if(a){var b=a.getOffsetInPixels();0===b.x&&0===b.y||cc.log("cc.ParticleSystem.setDisplayFrame(): QuadParticle only supports SpriteFrames with no offsets");a=a.getTexture();this._texture!==a&&this.setTexture(a)}},setTextureWithRect:function(a,b){this._texture!==a&&(this._texture=a,this._updateBlendFunc());this.initTexCoordsWithRect(b)},
listenBackToForeground:function(a){}});_p=cc.ParticleSystem.prototype;cc.defineGetterSetter(_p,"opacityModifyRGB",_p.isOpacityModifyRGB,_p.setOpacityModifyRGB);cc.defineGetterSetter(_p,"batchNode",_p.getBatchNode,_p.setBatchNode);cc.defineGetterSetter(_p,"drawMode",_p.getDrawMode,_p.setDrawMode);cc.defineGetterSetter(_p,"shapeType",_p.getShapeType,_p.setShapeType);cc.defineGetterSetter(_p,"active",_p.isActive);cc.defineGetterSetter(_p,"sourcePos",_p.getSourcePosition,_p.setSourcePosition);
cc.defineGetterSetter(_p,"posVar",_p.getPosVar,_p.setPosVar);cc.defineGetterSetter(_p,"gravity",_p.getGravity,_p.setGravity);cc.defineGetterSetter(_p,"speed",_p.getSpeed,_p.setSpeed);cc.defineGetterSetter(_p,"speedVar",_p.getSpeedVar,_p.setSpeedVar);cc.defineGetterSetter(_p,"tangentialAccel",_p.getTangentialAccel,_p.setTangentialAccel);cc.defineGetterSetter(_p,"tangentialAccelVar",_p.getTangentialAccelVar,_p.setTangentialAccelVar);cc.defineGetterSetter(_p,"radialAccel",_p.getRadialAccel,_p.setRadialAccel);
cc.defineGetterSetter(_p,"radialAccelVar",_p.getRadialAccelVar,_p.setRadialAccelVar);cc.defineGetterSetter(_p,"rotationIsDir",_p.getRotationIsDir,_p.setRotationIsDir);cc.defineGetterSetter(_p,"startRadius",_p.getStartRadius,_p.setStartRadius);cc.defineGetterSetter(_p,"startRadiusVar",_p.getStartRadiusVar,_p.setStartRadiusVar);cc.defineGetterSetter(_p,"endRadius",_p.getEndRadius,_p.setEndRadius);cc.defineGetterSetter(_p,"endRadiusVar",_p.getEndRadiusVar,_p.setEndRadiusVar);
cc.defineGetterSetter(_p,"rotatePerS",_p.getRotatePerSecond,_p.setRotatePerSecond);cc.defineGetterSetter(_p,"rotatePerSVar",_p.getRotatePerSecondVar,_p.setRotatePerSecondVar);cc.defineGetterSetter(_p,"startColor",_p.getStartColor,_p.setStartColor);cc.defineGetterSetter(_p,"startColorVar",_p.getStartColorVar,_p.setStartColorVar);cc.defineGetterSetter(_p,"endColor",_p.getEndColor,_p.setEndColor);cc.defineGetterSetter(_p,"endColorVar",_p.getEndColorVar,_p.setEndColorVar);
cc.defineGetterSetter(_p,"totalParticles",_p.getTotalParticles,_p.setTotalParticles);cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture);cc.ParticleSystem.create=function(a){return new cc.ParticleSystem(a)};cc.ParticleSystem.createWithTotalParticles=cc.ParticleSystem.create;
cc.ParticleSystem.ModeA=function(a,b,c,d,e,f,g,h){this.gravity=a?a:cc.p(0,0);this.speed=b||0;this.speedVar=c||0;this.tangentialAccel=d||0;this.tangentialAccelVar=e||0;this.radialAccel=f||0;this.radialAccelVar=g||0;this.rotationIsDir=h||!1};cc.ParticleSystem.ModeB=function(a,b,c,d,e,f){this.startRadius=a||0;this.startRadiusVar=b||0;this.endRadius=c||0;this.endRadiusVar=d||0;this.rotatePerSecond=e||0;this.rotatePerSecondVar=f||0};cc.ParticleSystem.SHAPE_MODE=0;cc.ParticleSystem.TEXTURE_MODE=1;
cc.ParticleSystem.STAR_SHAPE=0;cc.ParticleSystem.BALL_SHAPE=1;cc.ParticleSystem.DURATION_INFINITY=-1;cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE=-1;cc.ParticleSystem.START_RADIUS_EQUAL_TO_END_RADIUS=-1;cc.ParticleSystem.MODE_GRAVITY=0;cc.ParticleSystem.MODE_RADIUS=1;cc.ParticleSystem.TYPE_FREE=0;cc.ParticleSystem.TYPE_RELATIVE=1;cc.ParticleSystem.TYPE_GROUPED=2;(function(){cc.ParticleSystem.CanvasRenderCmd=function(a){this._rootCtor(a);this._needDraw=!0;this._drawMode=cc.ParticleSystem.TEXTURE_MODE;this._shapeType=cc.ParticleSystem.BALL_SHAPE;this._pointRect=cc.rect(0,0,0,0);this._tintCache=null};var a=cc.ParticleSystem.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);a.constructor=cc.ParticleSystem.CanvasRenderCmd;a.getDrawMode=function(){return this._drawMode};a.setDrawMode=function(a){this._drawMode=a};a.getShapeType=function(){return this._shapeType};
a.setShapeType=function(a){this._shapeType=a};a.setBatchNode=function(a){this._batchNode!==a&&(this._node._batchNode=a)};a.updateQuadWithParticle=function(a,c){};a.updateParticlePosition=function(a,c){cc.pIn(a.drawPos,c)};a.rendering=function(a,c,d){a=a||cc._renderContext;var e=a.getContext(),f=this._node,g=this._pointRect;a.setTransform(this._worldTransform,c,d);a.save();f.isBlendAdditive()?e.globalCompositeOperation="lighter":e.globalCompositeOperation="source-over";var h,k;d=this._node.particleCount;
var m=this._node._particles;if(f.drawMode!==cc.ParticleSystem.SHAPE_MODE&&f._texture){if(!f._texture._textureLoaded){a.restore();return}var n=f._texture.getHtmlElementObj();if(!n.width||!n.height){a.restore();return}h=n;for(c=0;c<d;c++)if(h=m[c],k=h.color.a/255,0!==k){e.globalAlpha=k;e.save();e.translate(0|h.drawPos.x,-(0|h.drawPos.y));var p=4*Math.floor(h.size/4);k=g.width;var r=g.height;e.scale(Math.max(1/k*p,1E-6),Math.max(1/r*p,1E-6));h.rotation&&e.rotate(cc.degreesToRadians(h.rotation));h=h.isChangeColor?
this._changeTextureColor(f._texture,h.color,this._pointRect):n;e.drawImage(h,-(0|k/2),-(0|r/2));e.restore()}}else for(n=cc._drawingUtil,c=0;c<d;c++)h=m[c],g=0|0.5*h.size,k=h.color.a/255,0!==k&&(e.globalAlpha=k,e.save(),e.translate(0|h.drawPos.x,-(0|h.drawPos.y)),f.shapeType===cc.ParticleSystem.STAR_SHAPE?(h.rotation&&e.rotate(cc.degreesToRadians(h.rotation)),n.drawStar(a,g,h.color)):n.drawColorBall(a,g,h.color),e.restore());a.restore();cc.g_NumberOfDraws++};a._changeTextureColor=function(a,c,d){this._tintCache||
(this._tintCache=document.createElement("canvas"));var e=this._tintCache,f=a.getContentSize();e.width=f.width;e.height=f.height;return a._generateColorTexture(c.r,c.g,c.b,d,e)};a.initTexCoordsWithRect=function(a){this._pointRect=a};a.setTotalParticles=function(a){this._node._totalParticles=200>a?a:200};a.addParticle=function(){var a=this._node,c=a._particles;a.particleCount<c.length?a=c[a.particleCount]:(a=new cc.Particle,c.push(a));return a};a._setupVBO=function(){};a._allocMemory=function(){return!0};
a.postStep=function(){};a._setBlendAdditive=function(){var a=this._node._blendFunc;a.src=cc.BLEND_SRC;a.dst=cc.BLEND_DST};a._initWithTotalParticles=function(a){};a._updateDeltaColor=function(a,c){this._node._dontTint||(a.color.r+=a.deltaColor.r*c,a.color.g+=a.deltaColor.g*c,a.color.b+=a.deltaColor.b*c,a.color.a+=a.deltaColor.a*c,a.isChangeColor=!0)}})();(function(){cc.ParticleSystem.WebGLRenderCmd=function(a){this._rootCtor(a);this._needDraw=!0;this._matrix=null;this._buffersVBO=[0,0];this._quads=[];this._indices=[];this._quadsArrayBuffer=null};var a=cc.ParticleSystem.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);a.constructor=cc.ParticleSystem.WebGLRenderCmd;a.getDrawMode=function(){};a.setDrawMode=function(a){};a.getShapeType=function(){};a.setShapeType=function(a){};a.setBatchNode=function(a){var c=this._node;if(c._batchNode!==
a){var d=c._batchNode;if(c._batchNode=a)for(var e=c._particles,f=0;f<c._totalParticles;f++)e[f].atlasIndex=f;a?d||(c._batchNode.textureAtlas._copyQuadsToTextureAtlas(this._quads,c.atlasIndex),cc._renderContext.deleteBuffer(this._buffersVBO[1])):(this._allocMemory(),this.initIndices(c._totalParticles),c.setTexture(d.getTexture()),this._setupVBO())}};a.initIndices=function(a){for(var c=this._indices,d=0;d<a;++d){var e=6*d,f=4*d;c[e+0]=f+0;c[e+1]=f+1;c[e+2]=f+2;c[e+5]=f+1;c[e+4]=f+2;c[e+3]=f+3}};a.isDifferentTexture=
function(a,c){return a===c};a.updateParticlePosition=function(a,c){this.updateQuadWithParticle(a,c)};a.updateQuadWithParticle=function(a,c){var d=null,e=this._node;e._batchNode?(d=e._batchNode.textureAtlas.quads[e.atlasIndex+a.atlasIndex],e._batchNode.textureAtlas.dirty=!0):d=this._quads[e._particleIdx];var f,g,h;e._opacityModifyRGB?(e=0|a.color.r*a.color.a/255,f=0|a.color.g*a.color.a/255,g=0|a.color.b*a.color.a/255):(e=0|a.color.r,f=0|a.color.g,g=0|a.color.b);h=0|a.color.a;var k=d.bl.colors,m=d.br.colors,
n=d.tl.colors,p=d.tr.colors;k.r=m.r=n.r=p.r=e;k.g=m.g=n.g=p.g=f;k.b=m.b=n.b=p.b=g;k.a=m.a=n.a=p.a=h;e=a.size/2;a.rotation?(f=-e,g=-e,h=c.x,k=c.y,n=-cc.degreesToRadians(a.rotation),m=Math.cos(n),n=Math.sin(n),d.bl.vertices.x=f*m-g*n+h,d.bl.vertices.y=f*n+g*m+k,d.br.vertices.x=e*m-g*n+h,d.br.vertices.y=e*n+g*m+k,d.tl.vertices.x=f*m-e*n+h,d.tl.vertices.y=f*n+e*m+k,d.tr.vertices.x=e*m-e*n+h,d.tr.vertices.y=e*n+e*m+k):(d.bl.vertices.x=c.x-e,d.bl.vertices.y=c.y-e,d.br.vertices.x=c.x+e,d.br.vertices.y=c.y-
e,d.tl.vertices.x=c.x-e,d.tl.vertices.y=c.y+e,d.tr.vertices.x=c.x+e,d.tr.vertices.y=c.y+e)};a.rendering=function(a){var c=this._node;if(c._texture){a=a||cc._renderContext;this._matrix||(this._matrix=new cc.math.Matrix4,this._matrix.identity());var d=this._worldTransform;this._matrix.mat[0]=d.a;this._matrix.mat[4]=d.c;this._matrix.mat[12]=d.tx;this._matrix.mat[1]=d.b;this._matrix.mat[5]=d.d;this._matrix.mat[13]=d.ty;this._glProgramState.apply(this._matrix);cc.glBindTexture2D(c._texture);cc.glBlendFuncForParticle(c._blendFunc.src,
c._blendFunc.dst);a.enableVertexAttribArray(cc.VERTEX_ATTRIB_POSITION);a.enableVertexAttribArray(cc.VERTEX_ATTRIB_COLOR);a.enableVertexAttribArray(cc.VERTEX_ATTRIB_TEX_COORDS);a.bindBuffer(a.ARRAY_BUFFER,this._buffersVBO[0]);a.vertexAttribPointer(cc.VERTEX_ATTRIB_POSITION,3,a.FLOAT,!1,24,0);a.vertexAttribPointer(cc.VERTEX_ATTRIB_COLOR,4,a.UNSIGNED_BYTE,!0,24,12);a.vertexAttribPointer(cc.VERTEX_ATTRIB_TEX_COORDS,2,a.FLOAT,!1,24,16);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]);a.drawElements(a.TRIANGLES,
6*c._particleIdx,a.UNSIGNED_SHORT,0)}};a.initTexCoordsWithRect=function(a){var c=this._node,d=c.texture,e=cc.contentScaleFactor(),f=cc.rect(a.x*e,a.y*e,a.width*e,a.height*e),e=a.width,g=a.height;d&&(e=d.pixelsWidth,g=d.pixelsHeight);cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(d=(2*f.x+1)/(2*e),a=(2*f.y+1)/(2*g),e=d+(2*f.width-2)/(2*e),f=a+(2*f.height-2)/(2*g)):(d=f.x/e,a=f.y/g,e=d+f.width/e,f=a+f.height/g);g=f;f=a;a=g;var h=0,k=0;c._batchNode?(g=c._batchNode.textureAtlas.quads,h=c.atlasIndex,k=c.atlasIndex+
c._totalParticles):(g=this._quads,h=0,k=c._totalParticles);for(c=h;c<k;c++)g[c]||(g[c]=cc.V3F_C4B_T2F_QuadZero()),h=g[c],h.bl.texCoords.u=d,h.bl.texCoords.v=a,h.br.texCoords.u=e,h.br.texCoords.v=a,h.tl.texCoords.u=d,h.tl.texCoords.v=f,h.tr.texCoords.u=e,h.tr.texCoords.v=f};a.setTotalParticles=function(a){var c=this._node;if(a>c._allocatedParticles){var d=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT;this._indices=new Uint16Array(6*a);var e=new ArrayBuffer(a*d),f=c._particles;f.length=0;for(var g=this._quads,
h=g.length=0;h<a;h++)f[h]=new cc.Particle,g[h]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,e,h*d);c._allocatedParticles=a;c._totalParticles=a;if(c._batchNode)for(d=0;d<a;d++)f[d].atlasIndex=d;this._quadsArrayBuffer=e;this.initIndices(a);this._setupVBO();c._texture&&this.initTexCoordsWithRect(cc.rect(0,0,c._texture.width,c._texture.height))}else c._totalParticles=a;c.resetSystem()};a.addParticle=function(){var a=this._node;return a._particles[a.particleCount]};a._setupVBO=function(){var a=cc._renderContext;
this._buffersVBO[0]=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this._buffersVBO[0]);a.bufferData(a.ARRAY_BUFFER,this._quadsArrayBuffer,a.DYNAMIC_DRAW);this._buffersVBO[1]=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._buffersVBO[1]);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this._indices,a.STATIC_DRAW)};a._allocMemory=function(){var a=this._node;if(a._batchNode)return cc.log("cc.ParticleSystem._allocMemory(): Memory should not be allocated when not using batchNode"),!1;var c=cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT,
a=a._totalParticles,d=this._quads;d.length=0;this._indices=new Uint16Array(6*a);for(var e=new ArrayBuffer(c*a),f=0;f<a;f++)d[f]=new cc.V3F_C4B_T2F_Quad(null,null,null,null,e,f*c);if(!d||!this._indices)return cc.log("cocos2d: Particle system: not enough memory"),!1;this._quadsArrayBuffer=e;return!0};a.postStep=function(){var a=cc._renderContext;a.bindBuffer(a.ARRAY_BUFFER,this._buffersVBO[0]);a.bufferSubData(a.ARRAY_BUFFER,0,this._quadsArrayBuffer)};a._setBlendAdditive=function(){var a=this._node._blendFunc;
this._texture&&!this._texture.hasPremultipliedAlpha()?(a.src=cc.SRC_ALPHA,a.dst=cc.ONE_MINUS_SRC_ALPHA):(a.src=cc.BLEND_SRC,a.dst=cc.BLEND_DST)};a._initWithTotalParticles=function(a){if(!this._allocMemory())return!1;this.initIndices(a);this._setupVBO();this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR)};a._updateDeltaColor=function(a,c){a.color.r+=a.deltaColor.r*c;a.color.g+=a.deltaColor.g*c;a.color.b+=a.deltaColor.b*c;a.color.a+=a.deltaColor.a*c;a.isChangeColor=!0}})();cc.ParticleFire=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?300:150)},initWithTotalParticles:function(a){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,a)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(60),this.setSpeedVar(20),this.setAngle(90),this.setAngleVar(10),
a=cc.director.getWinSize(),this.setPosition(a.width/2,60),this.setPosVar(cc.p(40,20)),this.setLife(3),this.setLifeVar(0.25),this.setStartSize(54),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(194,64,31,255)),this.setStartColorVar(cc.color(0,0,0,0)),this.setEndColor(cc.color(0,0,0,255)),this.setEndColorVar(cc.color(0,0,0,0)),this.setBlendAdditive(!0),!0):!1}});
cc.ParticleFire.create=function(){return new cc.ParticleFire};
cc.ParticleFireworks=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?1500:150)},initWithTotalParticles:function(a){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,a)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,-90)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(180),this.setSpeedVar(50),a=cc.director.getWinSize(),
this.setPosition(a.width/2,a.height/2),this.setAngle(90),this.setAngleVar(20),this.setLife(3.5),this.setLifeVar(1),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(128,128,128,255)),this.setStartColorVar(cc.color(128,128,128,255)),this.setEndColor(cc.color(26,26,26,51)),this.setEndColorVar(cc.color(26,26,26,51)),this.setStartSize(8),this.setStartSizeVar(2),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setBlendAdditive(!1),!0):!1}});
cc.ParticleFireworks.create=function(){return new cc.ParticleFireworks};
cc.ParticleSun=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?350:150)},initWithTotalParticles:function(a){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,a)?(this.setBlendAdditive(!0),this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(20),this.setSpeedVar(5),
this.setAngle(90),this.setAngleVar(360),a=cc.director.getWinSize(),this.setPosition(a.width/2,a.height/2),this.setPosVar(cc.p(0,0)),this.setLife(1),this.setLifeVar(0.5),this.setStartSize(30),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(194,64,31,255)),this.setStartColorVar(cc.color(0,0,0,0)),this.setEndColor(cc.color(0,0,0,255)),this.setEndColorVar(cc.color(0,0,0,0)),
!0):!1}});cc.ParticleSun.create=function(){return new cc.ParticleSun};
cc.ParticleGalaxy=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?200:100)},initWithTotalParticles:function(a){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,a)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setSpeed(60),this.setSpeedVar(10),this.setRadialAccel(-80),this.setRadialAccelVar(0),this.setTangentialAccel(80),
this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360),a=cc.director.getWinSize(),this.setPosition(a.width/2,a.height/2),this.setPosVar(cc.p(0,0)),this.setLife(4),this.setLifeVar(1),this.setStartSize(37),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(31,64,194,255)),this.setStartColorVar(cc.color(0,0,0,0)),this.setEndColor(cc.color(0,0,0,255)),this.setEndColorVar(cc.color(0,
0,0,0)),this.setBlendAdditive(!0),!0):!1}});cc.ParticleGalaxy.create=function(){return new cc.ParticleGalaxy};
cc.ParticleFlower=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?250:100)},initWithTotalParticles:function(a){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,a)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setSpeed(80),this.setSpeedVar(10),this.setRadialAccel(-60),this.setRadialAccelVar(0),this.setTangentialAccel(15),
this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360),a=cc.director.getWinSize(),this.setPosition(a.width/2,a.height/2),this.setPosVar(cc.p(0,0)),this.setLife(4),this.setLifeVar(1),this.setStartSize(30),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(128,128,128,255)),this.setStartColorVar(cc.color(128,128,128,128)),this.setEndColor(cc.color(0,0,0,255)),
this.setEndColorVar(cc.color(0,0,0,0)),this.setBlendAdditive(!0),!0):!1}});cc.ParticleFlower.create=function(){return new cc.ParticleFlower};
cc.ParticleMeteor=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?150:100)},initWithTotalParticles:function(a){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,a)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(-200,200)),this.setSpeed(15),this.setSpeedVar(5),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setTangentialAccel(0),
this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(360),a=cc.director.getWinSize(),this.setPosition(a.width/2,a.height/2),this.setPosVar(cc.p(0,0)),this.setLife(2),this.setLifeVar(1),this.setStartSize(60),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(51,102,179)),this.setStartColorVar(cc.color(0,0,51,26)),this.setEndColor(cc.color(0,0,0,255)),this.setEndColorVar(cc.color(0,
0,0,0)),this.setBlendAdditive(!0),!0):!1}});cc.ParticleMeteor.create=function(){return new cc.ParticleMeteor};
cc.ParticleSpiral=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?500:100)},initWithTotalParticles:function(a){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,a)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setSpeed(150),this.setSpeedVar(0),this.setRadialAccel(-380),this.setRadialAccelVar(0),this.setTangentialAccel(45),
this.setTangentialAccelVar(0),this.setAngle(90),this.setAngleVar(0),a=cc.director.getWinSize(),this.setPosition(a.width/2,a.height/2),this.setPosVar(cc.p(0,0)),this.setLife(12),this.setLifeVar(0),this.setStartSize(20),this.setStartSizeVar(0),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(128,128,128,255)),this.setStartColorVar(cc.color(128,128,128,0)),this.setEndColor(cc.color(128,128,128,255)),
this.setEndColorVar(cc.color(128,128,128,0)),this.setBlendAdditive(!1),!0):!1}});cc.ParticleSpiral.create=function(){return new cc.ParticleSpiral};
cc.ParticleExplosion=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?700:300)},initWithTotalParticles:function(a){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,a)?(this.setDuration(0.1),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setSpeed(70),this.setSpeedVar(40),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setTangentialAccel(0),this.setTangentialAccelVar(0),
this.setAngle(90),this.setAngleVar(360),a=cc.director.getWinSize(),this.setPosition(a.width/2,a.height/2),this.setPosVar(cc.p(0,0)),this.setLife(5),this.setLifeVar(2),this.setStartSize(15),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getDuration()),this.setStartColor(cc.color(179,26,51,255)),this.setStartColorVar(cc.color(128,128,128,0)),this.setEndColor(cc.color(128,128,128,0)),this.setEndColorVar(cc.color(128,
128,128,0)),this.setBlendAdditive(!1),!0):!1}});cc.ParticleExplosion.create=function(){return new cc.ParticleExplosion};
cc.ParticleSmoke=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?200:100)},initWithTotalParticles:function(a){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,a)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,0)),this.setRadialAccel(0),this.setRadialAccelVar(0),this.setSpeed(25),this.setSpeedVar(10),this.setAngle(90),
this.setAngleVar(5),a=cc.director.getWinSize(),this.setPosition(a.width/2,0),this.setPosVar(cc.p(20,0)),this.setLife(4),this.setLifeVar(1),this.setStartSize(60),this.setStartSizeVar(10),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(this.getTotalParticles()/this.getLife()),this.setStartColor(cc.color(204,204,204,255)),this.setStartColorVar(cc.color(5,5,5,0)),this.setEndColor(cc.color(0,0,0,255)),this.setEndColorVar(cc.color(0,0,0,0)),this.setBlendAdditive(!1),
!0):!1}});cc.ParticleSmoke.create=function(){return new cc.ParticleSmoke};
cc.ParticleSnow=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?700:250)},initWithTotalParticles:function(a){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,a)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(0,-1)),this.setSpeed(5),this.setSpeedVar(1),this.setRadialAccel(0),this.setRadialAccelVar(1),this.setTangentialAccel(0),
this.setTangentialAccelVar(1),a=cc.director.getWinSize(),this.setPosition(a.width/2,a.height+10),this.setPosVar(cc.p(a.width/2,0)),this.setAngle(-90),this.setAngleVar(5),this.setLife(45),this.setLifeVar(15),this.setStartSize(10),this.setStartSizeVar(5),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(10),this.setStartColor(cc.color(255,255,255,255)),this.setStartColorVar(cc.color(0,0,0,0)),this.setEndColor(cc.color(255,255,255,0)),this.setEndColorVar(cc.color(0,
0,0,0)),this.setBlendAdditive(!1),!0):!1}});cc.ParticleSnow.create=function(){return new cc.ParticleSnow};
cc.ParticleRain=cc.ParticleSystem.extend({ctor:function(){cc.ParticleSystem.prototype.ctor.call(this,cc._renderType===cc.game.RENDER_TYPE_WEBGL?1E3:300)},initWithTotalParticles:function(a){return cc.ParticleSystem.prototype.initWithTotalParticles.call(this,a)?(this.setDuration(cc.ParticleSystem.DURATION_INFINITY),this.setEmitterMode(cc.ParticleSystem.MODE_GRAVITY),this.setGravity(cc.p(10,-10)),this.setRadialAccel(0),this.setRadialAccelVar(1),this.setTangentialAccel(0),this.setTangentialAccelVar(1),
this.setSpeed(130),this.setSpeedVar(30),this.setAngle(-90),this.setAngleVar(5),a=cc.director.getWinSize(),this.setPosition(a.width/2,a.height),this.setPosVar(cc.p(a.width/2,0)),this.setLife(4.5),this.setLifeVar(0),this.setStartSize(4),this.setStartSizeVar(2),this.setEndSize(cc.ParticleSystem.START_SIZE_EQUAL_TO_END_SIZE),this.setEmissionRate(20),this.setStartColor(cc.color(179,204,255,255)),this.setStartColorVar(cc.color(0,0,0,0)),this.setEndColor(cc.color(179,204,255,128)),this.setEndColorVar(cc.color(0,
0,0,0)),this.setBlendAdditive(!1),!0):!1}});cc.ParticleRain.create=function(){return new cc.ParticleRain};cc.PARTICLE_DEFAULT_CAPACITY=500;
cc.ParticleBatchNode=cc.Node.extend({textureAtlas:null,_blendFunc:null,_className:"ParticleBatchNode",ctor:function(a,b){cc.Node.prototype.ctor.call(this);this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST};cc.isString(a)?this.init(a,b):a instanceof cc.Texture2D&&this.initWithTexture(a,b)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ParticleBatchNode.CanvasRenderCmd(this):new cc.ParticleBatchNode.WebGLRenderCmd(this)},initWithTexture:function(a,b){this.textureAtlas=
new cc.TextureAtlas;this.textureAtlas.initWithTexture(a,b);this._children.length=0;this._renderCmd._initWithTexture();return!0},initWithFile:function(a,b){var c=cc.textureCache.addImage(a);return this.initWithTexture(c,b)},init:function(a,b){var c=cc.textureCache.addImage(a);return this.initWithTexture(c,b)},visit:function(a){var b=this._renderCmd;a=a?a._renderCmd:null;this._visible?(b.visit(a),cc.renderer.pushRenderCommand(b),b._dirtyFlag=0):b._propagateFlagsDown(a)},addChild:function(a,b,c){if(!a)throw Error("cc.ParticleBatchNode.addChild() : child should be non-null");
if(!(a instanceof cc.ParticleSystem))throw Error("cc.ParticleBatchNode.addChild() : only supports cc.ParticleSystem as children");b=null==b?a.zIndex:b;c=null==c?a.tag:c;if(a.getTexture()!==this.textureAtlas.texture)throw Error("cc.ParticleSystem.addChild() : the child is not using the same texture id");var d=a.getBlendFunc();if(0===this._children.length)this.setBlendFunc(d);else if(d.src!==this._blendFunc.src||d.dst!==this._blendFunc.dst){cc.log("cc.ParticleSystem.addChild() : Can't add a ParticleSystem that uses a different blending function");
return}b=this._addChildHelper(a,b,c);c=0;0!==b?(b=this._children[b-1],c=b.getAtlasIndex()+b.getTotalParticles()):c=0;this.insertChild(a,c);a.setBatchNode(this)},insertChild:function(a,b){var c=a.getTotalParticles(),d=this.textureAtlas,e=d.totalQuads;a.setAtlasIndex(b);e+c>d.getCapacity()&&(this._increaseAtlasCapacityTo(e+c),d.fillWithEmptyQuadsFromIndex(d.getCapacity()-c,c));a.getAtlasIndex()+c!==e&&d.moveQuadsFromIndex(b,b+c);d.increaseTotalQuadsWith(c);this._updateAllAtlasIndexes()},removeChild:function(a,
b){if(null!=a){if(!(a instanceof cc.ParticleSystem))throw Error("cc.ParticleBatchNode.removeChild(): only supports cc.ParticleSystem as children");if(-1===this._children.indexOf(a))cc.log("cc.ParticleBatchNode.removeChild(): doesn't contain the sprite. Can't remove it");else{cc.Node.prototype.removeChild.call(this,a,b);var c=this.textureAtlas;c.removeQuadsAtIndex(a.getAtlasIndex(),a.getTotalParticles());c.fillWithEmptyQuadsFromIndex(c.totalQuads,a.getTotalParticles());a.setBatchNode(null);this._updateAllAtlasIndexes()}}},
reorderChild:function(a,b){if(!a)throw Error("cc.ParticleBatchNode.reorderChild(): child should be non-null");if(!(a instanceof cc.ParticleSystem))throw Error("cc.ParticleBatchNode.reorderChild(): only supports cc.QuadParticleSystems as children");if(-1===this._children.indexOf(a))cc.log("cc.ParticleBatchNode.reorderChild(): Child doesn't belong to batch");else if(b!==a.zIndex){if(1<this._children.length){var c=this._getCurrentIndex(a,b);if(c.oldIndex!==c.newIndex){this._children.splice(c.oldIndex,
1);this._children.splice(c.newIndex,0,a);c=a.getAtlasIndex();this._updateAllAtlasIndexes();for(var d=0,e=this._children,f=0;f<e.length;f++)if(e[f]===a){d=a.getAtlasIndex();break}this.textureAtlas.moveQuadsFromIndex(c,a.getTotalParticles(),d);a.updateWithNoTime()}}a._setLocalZOrder(b)}},removeChildAtIndex:function(a,b){this.removeChild(this._children[i],b)},removeAllChildren:function(a){for(var b=this._children,c=0;c<b.length;c++)b[c].setBatchNode(null);cc.Node.prototype.removeAllChildren.call(this,
a);this.textureAtlas.removeAllQuads()},disableParticle:function(a){a=this.textureAtlas.quads[a];a.br.vertices.x=a.br.vertices.y=a.tr.vertices.x=a.tr.vertices.y=a.tl.vertices.x=a.tl.vertices.y=a.bl.vertices.x=a.bl.vertices.y=0;this.textureAtlas._setDirty(!0)},getTexture:function(){return this.textureAtlas.texture},setTexture:function(a){this.textureAtlas.texture=a;var b=this._blendFunc;a&&!a.hasPremultipliedAlpha()&&b.src===cc.BLEND_SRC&&b.dst===cc.BLEND_DST&&(b.src=cc.SRC_ALPHA,b.dst=cc.ONE_MINUS_SRC_ALPHA)},
setBlendFunc:function(a,b){void 0===b?(this._blendFunc.src=a.src,this._blendFunc.dst=a.dst):(this._blendFunc.src=a,this._blendFunc.src=b)},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},_updateAllAtlasIndexes:function(){for(var a=0,b=this._children,c=0;c<b.length;c++){var d=b[c];d.setAtlasIndex(a);a+=d.getTotalParticles()}},_increaseAtlasCapacityTo:function(a){cc.log("cocos2d: cc.ParticleBatchNode: resizing TextureAtlas capacity from ["+this.textureAtlas.getCapacity()+
"] to ["+a+"].");this.textureAtlas.resizeCapacity(a)||cc.log("cc.ParticleBatchNode._increaseAtlasCapacityTo() : WARNING: Not enough memory to resize the atlas")},_searchNewPositionInChildrenForZ:function(a){for(var b=this._children,c=b.length,d=0;d<c;d++)if(b[d].zIndex>a)return d;return c},_getCurrentIndex:function(a,b){for(var c=!1,d=!1,e=0,f=0,g=0,h=this._children,k=h.length,m=0;m<k;m++){var n=h[m];if(n.zIndex>b&&!d&&(e=m,d=!0,c&&d))break;if(a===n&&(f=m,c=!0,d||(g=-1),c&&d))break}d||(e=k);return{newIndex:e+
g,oldIndex:f}},_addChildHelper:function(a,b,c){if(!a)throw Error("cc.ParticleBatchNode._addChildHelper(): child should be non-null");if(a.parent)return cc.log("cc.ParticleBatchNode._addChildHelper(): child already added. It can't be added again"),null;this._children||(this._children=[]);var d=this._searchNewPositionInChildrenForZ(b);this._children.splice(d,0,a);a.tag=c;a._setLocalZOrder(b);a.parent=this;this._running&&(a._performRecursive(cc.Node._stateCallbackType.onEnter),a._performRecursive(cc.Node._stateCallbackType.onEnterTransitionDidFinish));
return d},_updateBlendFunc:function(){this.textureAtlas.texture.hasPremultipliedAlpha()||(this._blendFunc.src=cc.SRC_ALPHA,this._blendFunc.dst=cc.ONE_MINUS_SRC_ALPHA)},getTextureAtlas:function(){return this.textureAtlas},setTextureAtlas:function(a){this.textureAtlas=a}});_p=cc.ParticleBatchNode.prototype;cc.defineGetterSetter(_p,"texture",_p.getTexture,_p.setTexture);cc.ParticleBatchNode.create=function(a,b){return new cc.ParticleBatchNode(a,b)};(function(){cc.ParticleBatchNode.CanvasRenderCmd=function(a){this._rootCtor(a);this._needDraw=!1};var a=cc.ParticleBatchNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);a.constructor=cc.ParticleBatchNode.CanvasRenderCmd;a._initWithTexture=function(){}})();(function(){cc.ParticleBatchNode.WebGLRenderCmd=function(a){this._rootCtor(a);this._needDraw=!0;this._matrix=new cc.math.Matrix4;this._matrix.identity()};var a=cc.ParticleBatchNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);a.constructor=cc.ParticleBatchNode.WebGLRenderCmd;a.rendering=function(a){a=this._node;if(0!==a.textureAtlas.totalQuads){var c=this._worldTransform;this._matrix.mat[0]=c.a;this._matrix.mat[4]=c.c;this._matrix.mat[12]=c.tx;this._matrix.mat[1]=c.b;this._matrix.mat[5]=
c.d;this._matrix.mat[13]=c.ty;this._glProgramState.apply(this._matrix);cc.glBlendFuncForParticle(a._blendFunc.src,a._blendFunc.dst);a.textureAtlas.drawQuads()}};a._initWithTexture=function(){this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_POSITION_TEXTURECOLOR)}})();cc.IMEKeyboardNotificationInfo=function(a,b,c){this.begin=a||cc.rect(0,0,0,0);this.end=b||cc.rect(0,0,0,0);this.duration=c||0};
cc.IMEDelegate=cc.Class.extend({ctor:function(){cc.imeDispatcher.addDelegate(this)},removeDelegate:function(){cc.imeDispatcher.removeDelegate(this)},attachWithIME:function(){return cc.imeDispatcher.attachDelegateWithIME(this)},detachWithIME:function(){return cc.imeDispatcher.detachDelegateWithIME(this)},canAttachWithIME:function(){return!1},didAttachWithIME:function(){},canDetachWithIME:function(){return!1},didDetachWithIME:function(){},insertText:function(a,b){},deleteBackward:function(){},getContentText:function(){return""},
keyboardWillShow:function(a){},keyboardDidShow:function(a){},keyboardWillHide:function(a){},keyboardDidHide:function(a){}});
cc.IMEDispatcher=cc.Class.extend({_domInputControl:null,impl:null,_currentInputString:"",_lastClickPosition:null,ctor:function(){this.impl=new cc.IMEDispatcher.Impl;this._lastClickPosition=cc.p(0,0)},init:function(){if(!cc.sys.isMobile){this._domInputControl=cc.$("#imeDispatcherInput");this._domInputControl||(this._domInputControl=cc.$new("input"),this._domInputControl.setAttribute("type","text"),this._domInputControl.setAttribute("id","imeDispatcherInput"),this._domInputControl.resize(0,0),this._domInputControl.translates(0,
0),this._domInputControl.style.opacity="0",this._domInputControl.style.fontSize="1px",this._domInputControl.setAttribute("tabindex",2),this._domInputControl.style.position="absolute",this._domInputControl.style.top=0,this._domInputControl.style.left=0,document.body.appendChild(this._domInputControl));var a=this;this._domInputControl.addEventListener("input",function(){a._processDomInputString(a._domInputControl.value)},!1);this._domInputControl.addEventListener("keydown",function(b){b.keyCode===cc.KEY.tab?
(b.stopPropagation(),b.preventDefault()):b.keyCode===cc.KEY.enter&&(a.dispatchInsertText("\n",1),b.stopPropagation(),b.preventDefault())},!1);/msie/i.test(navigator.userAgent)&&this._domInputControl.addEventListener("keyup",function(b){b.keyCode===cc.KEY.backspace&&a._processDomInputString(a._domInputControl.value)},!1);window.addEventListener("mousedown",function(b){var c=b.pageY||0;a._lastClickPosition.x=b.pageX||0;a._lastClickPosition.y=c},!1)}},_processDomInputString:function(a){var b,c;b=this._currentInputString.length<
a.length?this._currentInputString.length:a.length;for(c=0;c<b&&a[c]===this._currentInputString[c];c++);var d=this._currentInputString.length-c,e=a.length-c;for(b=0;b<d;b++)this.dispatchDeleteBackward();for(b=0;b<e;b++)this.dispatchInsertText(a[c+b],1);this._currentInputString=a},dispatchInsertText:function(a,b){!this.impl||!a||0>=b||this.impl._delegateWithIme&&this.impl._delegateWithIme.insertText(a,b)},dispatchDeleteBackward:function(){this.impl&&this.impl._delegateWithIme&&this.impl._delegateWithIme.deleteBackward()},
getContentText:function(){if(this.impl&&this.impl._delegateWithIme){var a=this.impl._delegateWithIme.getContentText();return a?a:""}return""},dispatchKeyboardWillShow:function(a){if(this.impl)for(var b=0;b<this.impl._delegateList.length;b++){var c=this.impl._delegateList[b];c&&c.keyboardWillShow(a)}},dispatchKeyboardDidShow:function(a){if(this.impl)for(var b=0;b<this.impl._delegateList.length;b++){var c=this.impl._delegateList[b];c&&c.keyboardDidShow(a)}},dispatchKeyboardWillHide:function(a){if(this.impl)for(var b=
0;b<this.impl._delegateList.length;b++){var c=this.impl._delegateList[b];c&&c.keyboardWillHide(a)}},dispatchKeyboardDidHide:function(a){if(this.impl)for(var b=0;b<this.impl._delegateList.length;b++){var c=this.impl._delegateList[b];c&&c.keyboardDidHide(a)}},addDelegate:function(a){a&&this.impl&&(-1<this.impl._delegateList.indexOf(a)||this.impl._delegateList.splice(0,0,a))},attachDelegateWithIME:function(a){if(!this.impl||!a||-1===this.impl._delegateList.indexOf(a))return!1;if(this.impl._delegateWithIme){if(!this.impl._delegateWithIme.canDetachWithIME()||
!a.canAttachWithIME())return!1;var b=this.impl._delegateWithIme;this.impl._delegateWithIme=null;b.didDetachWithIME();this._focusDomInput(a);return!0}if(!a.canAttachWithIME())return!1;this._focusDomInput(a);return!0},_focusDomInput:function(a){if(cc.sys.isMobile){this.impl._delegateWithIme=a;a.didAttachWithIME();this._currentInputString=a.string||"";a=a.getTipMessage?a.getTipMessage():"please enter your word:";var b=window.Window;a=b&&b.prototype.prompt&&b.prototype.prompt!=prompt?b.prototype.prompt.call(window,
a,this._currentInputString):prompt(a,this._currentInputString);null!=a&&this._processDomInputString(a);this.dispatchInsertText("\n",1)}else this.impl._delegateWithIme=a,this._currentInputString=a.string||"",a.didAttachWithIME(),this._domInputControl.focus(),this._domInputControl.value=this._currentInputString,this._domInputControlTranslate()},_domInputControlTranslate:function(){/msie/i.test(navigator.userAgent)?(this._domInputControl.style.left=this._lastClickPosition.x+"px",this._domInputControl.style.top=
this._lastClickPosition.y+"px"):this._domInputControl.translates(this._lastClickPosition.x,this._lastClickPosition.y)},detachDelegateWithIME:function(a){if(!this.impl||!a||this.impl._delegateWithIme!==a||!a.canDetachWithIME())return!1;this.impl._delegateWithIme=null;a.didDetachWithIME();cc._canvas.focus();return!0},removeDelegate:function(a){this.impl&&a&&-1!==this.impl._delegateList.indexOf(a)&&(this.impl._delegateWithIme&&a===this.impl._delegateWithIme&&(this.impl._delegateWithIme=null),cc.arrayRemoveObject(this.impl._delegateList,
a))},processKeycode:function(a){32>a?a===cc.KEY.backspace?this.dispatchDeleteBackward():a===cc.KEY.enter&&this.dispatchInsertText("\n",1):255>a&&this.dispatchInsertText(String.fromCharCode(a),1)}});cc.IMEDispatcher.Impl=cc.Class.extend({_delegateWithIme:null,_delegateList:null,ctor:function(){this._delegateList=[]},findDelegate:function(a){for(var b=0;b<this._delegateList.length;b++)if(this._delegateList[b]===a)return b;return null}});cc.imeDispatcher=new cc.IMEDispatcher;
document.body?cc.imeDispatcher.init():window.addEventListener("load",function(){cc.imeDispatcher.init()},!1);cc.TextFieldDelegate=cc.Class.extend({onTextFieldAttachWithIME:function(a){return!1},onTextFieldDetachWithIME:function(a){return!1},onTextFieldInsertText:function(a,b,c){return!1},onTextFieldDeleteBackward:function(a,b,c){return!1},onDraw:function(a){return!1}});
cc.TextFieldTTF=cc.LabelTTF.extend({delegate:null,colorSpaceHolder:null,_colorText:null,_lens:null,_inputText:"",_placeHolder:"",_charCount:0,_className:"TextFieldTTF",ctor:function(a,b,c,d,e){this.colorSpaceHolder=cc.color(127,127,127);this._colorText=cc.color(255,255,255,255);cc.LabelTTF.prototype.ctor.call(this);void 0!==e?(this.initWithPlaceHolder("",b,c,d,e),a&&this.setPlaceHolder(a)):void 0===d&&void 0!==c&&(this.initWithString("",b,c),a&&this.setPlaceHolder(a))},onEnter:function(){cc.LabelTTF.prototype.onEnter.call(this);
cc.imeDispatcher.addDelegate(this)},onExit:function(){cc.LabelTTF.prototype.onExit.call(this);cc.imeDispatcher.removeDelegate(this)},getDelegate:function(){return this.delegate},setDelegate:function(a){this.delegate=a},getCharCount:function(){return this._charCount},getColorSpaceHolder:function(){return cc.color(this.colorSpaceHolder)},setColorSpaceHolder:function(a){this.colorSpaceHolder.r=a.r;this.colorSpaceHolder.g=a.g;this.colorSpaceHolder.b=a.b;this.colorSpaceHolder.a=cc.isUndefined(a.a)?255:
a.a;this._inputText.length||this.setColor(this.colorSpaceHolder)},setTextColor:function(a){this._colorText.r=a.r;this._colorText.g=a.g;this._colorText.b=a.b;this._colorText.a=cc.isUndefined(a.a)?255:a.a;this._inputText.length&&this.setColor(this._colorText)},initWithPlaceHolder:function(a,b,c,d,e){switch(arguments.length){case 5:return a&&this.setPlaceHolder(a),this.initWithString(this._placeHolder,d,e,b,c);case 3:return a&&this.setPlaceHolder(a),this.initWithString(this._placeHolder,arguments[1],
arguments[2]);default:throw Error("Argument must be non-nil ");}},setString:function(a){this._inputText=(a=String(a))||"";this._inputText.length?(cc.LabelTTF.prototype.setString.call(this,this._inputText),this.setColor(this._colorText)):(cc.LabelTTF.prototype.setString.call(this,this._placeHolder),this.setColor(this.colorSpaceHolder));cc._renderType===cc.game.RENDER_TYPE_CANVAS&&this._renderCmd._updateTexture();this._charCount=this._inputText.length},getString:function(){return this._inputText},setPlaceHolder:function(a){this._placeHolder=
a||"";this._inputText.length||(cc.LabelTTF.prototype.setString.call(this,this._placeHolder),this.setColor(this.colorSpaceHolder))},getPlaceHolder:function(){return this._placeHolder},draw:function(a){a=a||cc._renderContext;this.delegate&&this.delegate.onDraw(this)||cc.LabelTTF.prototype.draw.call(this,a)},attachWithIME:function(){return cc.imeDispatcher.attachDelegateWithIME(this)},detachWithIME:function(){return cc.imeDispatcher.detachDelegateWithIME(this)},canAttachWithIME:function(){return this.delegate?
!this.delegate.onTextFieldAttachWithIME(this):!0},didAttachWithIME:function(){},canDetachWithIME:function(){return this.delegate?!this.delegate.onTextFieldDetachWithIME(this):!0},didDetachWithIME:function(){},deleteBackward:function(){var a=this._inputText.length;0===a||this.delegate&&this.delegate.onTextFieldDeleteBackward(this,this._inputText[a-1],1)||(1>=a?(this._inputText="",this._charCount=0,cc.LabelTTF.prototype.setString.call(this,this._placeHolder),this.setColor(this.colorSpaceHolder)):this.string=
this._inputText.substring(0,a-1))},removeDelegate:function(){cc.imeDispatcher.removeDelegate(this)},_tipMessage:"please enter your word:",setTipMessage:function(a){null!=a&&(this._tipMessage=a)},getTipMessage:function(){return this._tipMessage},insertText:function(a,b){var c=a,d=c.indexOf("\n");-1<d&&(c=c.substring(0,d));if(0<c.length){if(this.delegate&&this.delegate.onTextFieldInsertText(this,c,c.length))return;c=this._inputText+c;this._charCount=c.length;this.string=c}-1!==d&&(this.delegate&&this.delegate.onTextFieldInsertText(this,
"\n",1)||this.detachWithIME())},getContentText:function(){return this._inputText},keyboardWillShow:function(a){},keyboardDidShow:function(a){},keyboardWillHide:function(a){},keyboardDidHide:function(a){}});_p=cc.TextFieldTTF.prototype;cc.defineGetterSetter(_p,"charCount",_p.getCharCount);cc.defineGetterSetter(_p,"placeHolder",_p.getPlaceHolder,_p.setPlaceHolder);cc.TextFieldTTF.create=function(a,b,c,d,e){return new cc.TextFieldTTF(a,b,c,d,e)};cc._globalFontSize=cc.ITEM_SIZE;cc._globalFontName="Arial";cc._globalFontNameRelease=!1;
cc.MenuItem=cc.Node.extend({_enabled:!1,_target:null,_callback:null,_isSelected:!1,_className:"MenuItem",ctor:function(a,b){var c=cc.Node.prototype;c.ctor.call(this);this._callback=this._target=null;this._enabled=this._isSelected=!1;c.setAnchorPoint.call(this,0.5,0.5);this._target=b||null;if(this._callback=a||null)this._enabled=!0},isSelected:function(){return this._isSelected},setOpacityModifyRGB:function(a){},isOpacityModifyRGB:function(){return!1},setTarget:function(a,b){this._target=b;this._callback=
a},isEnabled:function(){return this._enabled},setEnabled:function(a){this._enabled=a},initWithCallback:function(a,b){this.anchorY=this.anchorX=0.5;this._target=b;this._callback=a;this._enabled=!0;this._isSelected=!1;return!0},rect:function(){var a=this._position,b=this._contentSize,c=this._anchorPoint;return cc.rect(a.x-b.width*c.x,a.y-b.height*c.y,b.width,b.height)},selected:function(){this._isSelected=!0},unselected:function(){this._isSelected=!1},setCallback:function(a,b){this._target=b;this._callback=
a},activate:function(){if(this._enabled){var a=this._target,b=this._callback;if(b)if(a&&cc.isString(b))a[b](this);else a&&cc.isFunction(b)?b.call(a,this):b(this)}}});_p=cc.MenuItem.prototype;cc.defineGetterSetter(_p,"enabled",_p.isEnabled,_p.setEnabled);cc.MenuItem.create=function(a,b){return new cc.MenuItem(a,b)};
cc.MenuItemLabel=cc.MenuItem.extend({_disabledColor:null,_label:null,_originalScale:0,_colorBackup:null,ctor:function(a,b,c){cc.MenuItem.prototype.ctor.call(this,b,c);this._colorBackup=this._label=this._disabledColor=null;a&&(this._originalScale=1,this._colorBackup=cc.color.WHITE,this._disabledColor=cc.color(126,126,126),this.setLabel(a),a.textureLoaded&&!a.textureLoaded()&&a.addEventListener("load",function(a){this.width=a.width;this.height=a.height;this.parent instanceof cc.Menu&&this.parent.updateAlign()},
this),this.setCascadeColorEnabled(!0),this.setCascadeOpacityEnabled(!0))},getDisabledColor:function(){return this._disabledColor},setDisabledColor:function(a){this._disabledColor=a},getLabel:function(){return this._label},setLabel:function(a){a&&(this.addChild(a),a.anchorX=0,a.anchorY=0,this.width=a.width,this.height=a.height,a.setCascadeColorEnabled(!0));this._label&&this.removeChild(this._label,!0);this._label=a},setEnabled:function(a){this._enabled!==a&&(a?this.setColor(this._colorBackup):(this._colorBackup=
this.color,this.setColor(this._disabledColor)));cc.MenuItem.prototype.setEnabled.call(this,a)},initWithLabel:function(a,b,c){this.initWithCallback(b,c);this._originalScale=1;this._colorBackup=cc.color.WHITE;this._disabledColor=cc.color(126,126,126);this.setLabel(a);this.setCascadeColorEnabled(!0);this.setCascadeOpacityEnabled(!0);return!0},setString:function(a){this._label.string=a;this.width=this._label.width;this.height=this._label.height},getString:function(){return this._label.string},activate:function(){this._enabled&&
(this.stopAllActions(),this.scale=this._originalScale,cc.MenuItem.prototype.activate.call(this))},selected:function(){if(this._enabled){cc.MenuItem.prototype.selected.call(this);var a=this.getActionByTag(cc.ZOOM_ACTION_TAG);a?this.stopAction(a):this._originalScale=this.scale;a=cc.scaleTo(0.1,1.2*this._originalScale);a.setTag(cc.ZOOM_ACTION_TAG);this.runAction(a)}},unselected:function(){if(this._enabled){cc.MenuItem.prototype.unselected.call(this);this.stopActionByTag(cc.ZOOM_ACTION_TAG);var a=cc.scaleTo(0.1,
this._originalScale);a.setTag(cc.ZOOM_ACTION_TAG);this.runAction(a)}}});_p=cc.MenuItemLabel.prototype;cc.defineGetterSetter(_p,"string",_p.getString,_p.setString);cc.defineGetterSetter(_p,"disabledColor",_p.getDisabledColor,_p.setDisabledColor);cc.defineGetterSetter(_p,"label",_p.getLabel,_p.setLabel);cc.MenuItemLabel.create=function(a,b,c){return new cc.MenuItemLabel(a,b,c)};
cc.MenuItemAtlasFont=cc.MenuItemLabel.extend({ctor:function(a,b,c,d,e,f,g){var h;a&&0<a.length&&(h=new cc.LabelAtlas(a,b,c,d,e));cc.MenuItemLabel.prototype.ctor.call(this,h,f,g)},initWithString:function(a,b,c,d,e,f,g){if(!a||0===a.length)throw Error("cc.MenuItemAtlasFont.initWithString(): value should be non-null and its length should be greater than 0");var h=new cc.LabelAtlas;h.initWithString(a,b,c,d,e);this.initWithLabel(h,f,g);return!0}});
cc.MenuItemAtlasFont.create=function(a,b,c,d,e,f,g){return new cc.MenuItemAtlasFont(a,b,c,d,e,f,g)};
cc.MenuItemFont=cc.MenuItemLabel.extend({_fontSize:null,_fontName:null,ctor:function(a,b,c){var d;a&&0<a.length?(this._fontName=cc._globalFontName,this._fontSize=cc._globalFontSize,d=new cc.LabelTTF(a,this._fontName,this._fontSize)):(this._fontSize=0,this._fontName="");cc.MenuItemLabel.prototype.ctor.call(this,d,b,c)},initWithString:function(a,b,c){if(!a||0===a.length)throw Error("Value should be non-null and its length should be greater than 0");this._fontName=cc._globalFontName;this._fontSize=cc._globalFontSize;
a=new cc.LabelTTF(a,this._fontName,this._fontSize);this.initWithLabel(a,b,c);return!0},setFontSize:function(a){this._fontSize=a;this._recreateLabel()},getFontSize:function(){return this._fontSize},setFontName:function(a){this._fontName=a;this._recreateLabel()},getFontName:function(){return this._fontName},_recreateLabel:function(){var a=new cc.LabelTTF(this._label.string,this._fontName,this._fontSize);this.setLabel(a)}});cc.MenuItemFont.setFontSize=function(a){cc._globalFontSize=a};
cc.MenuItemFont.fontSize=function(){return cc._globalFontSize};cc.MenuItemFont.setFontName=function(a){cc._globalFontNameRelease&&(cc._globalFontName="");cc._globalFontName=a;cc._globalFontNameRelease=!0};_p=cc.MenuItemFont.prototype;cc.defineGetterSetter(_p,"fontSize",_p.getFontSize,_p.setFontSize);cc.defineGetterSetter(_p,"fontName",_p.getFontName,_p.setFontName);cc.MenuItemFont.fontName=function(){return cc._globalFontName};
cc.MenuItemFont.create=function(a,b,c){return new cc.MenuItemFont(a,b,c)};
cc.MenuItemSprite=cc.MenuItem.extend({_normalImage:null,_selectedImage:null,_disabledImage:null,ctor:function(a,b,c,d,e){cc.MenuItem.prototype.ctor.call(this);this._disabledImage=this._selectedImage=this._normalImage=null;this._loader=new cc.Sprite.LoadManager;if(void 0!==a){b=b||null;var f,g,h;void 0!==e?(f=c,h=d,g=e):void 0!==d&&cc.isFunction(d)?(f=c,h=d):void 0!==d&&cc.isFunction(c)?(g=d,h=c,f=null):void 0===c&&(f=null);this._loader.clear();if(a.textureLoaded&&!a.textureLoaded())return this._loader.once(a,
function(){this.initWithNormalSprite(a,b,f,h,g)},this),!1;this.initWithNormalSprite(a,b,f,h,g);return!0}},getNormalImage:function(){return this._normalImage},setNormalImage:function(a){this._normalImage!==a&&(a&&(this.addChild(a,0,cc.NORMAL_TAG),a.anchorX=0,a.anchorY=0),this._normalImage&&this.removeChild(this._normalImage,!0),this._normalImage=a)&&(this.width=this._normalImage.width,this.height=this._normalImage.height,this._updateImagesVisibility(),a.textureLoaded&&!a.textureLoaded()&&a.addEventListener("load",
function(a){this.width=a.width;this.height=a.height;this.parent instanceof cc.Menu&&this.parent.updateAlign()},this))},getSelectedImage:function(){return this._selectedImage},setSelectedImage:function(a){this._selectedImage!==a&&(a&&(this.addChild(a,0,cc.SELECTED_TAG),a.anchorX=0,a.anchorY=0),this._selectedImage&&this.removeChild(this._selectedImage,!0),this._selectedImage=a,this._updateImagesVisibility())},getDisabledImage:function(){return this._disabledImage},setDisabledImage:function(a){this._disabledImage!==
a&&(a&&(this.addChild(a,0,cc.DISABLE_TAG),a.anchorX=0,a.anchorY=0),this._disabledImage&&this.removeChild(this._disabledImage,!0),this._disabledImage=a,this._updateImagesVisibility())},initWithNormalSprite:function(a,b,c,d,e){this._loader.clear();if(a.textureLoaded&&!a.textureLoaded())return this._loader.once(a,function(){this.initWithNormalSprite(a,b,c,d,e)},this),!1;this.initWithCallback(d,e);this.setNormalImage(a);this.setSelectedImage(b);this.setDisabledImage(c);var f=this._normalImage;f&&(this.width=
f.width,this.height=f.height);this.setCascadeColorEnabled(!0);this.setCascadeOpacityEnabled(!0);return!0},selected:function(){cc.MenuItem.prototype.selected.call(this);this._normalImage&&(this._disabledImage&&(this._disabledImage.visible=!1),this._selectedImage?(this._normalImage.visible=!1,this._selectedImage.visible=!0):this._normalImage.visible=!0)},unselected:function(){cc.MenuItem.prototype.unselected.call(this);this._normalImage&&(this._normalImage.visible=!0,this._selectedImage&&(this._selectedImage.visible=
!1),this._disabledImage&&(this._disabledImage.visible=!1))},setEnabled:function(a){this._enabled!==a&&(cc.MenuItem.prototype.setEnabled.call(this,a),this._updateImagesVisibility())},_updateImagesVisibility:function(){var a=this._normalImage,b=this._selectedImage,c=this._disabledImage;this._enabled?(a&&(a.visible=!0),b&&(b.visible=!1),c&&(c.visible=!1)):c?(a&&(a.visible=!1),b&&(b.visible=!1),c&&(c.visible=!0)):(a&&(a.visible=!0),b&&(b.visible=!1))}});_p=cc.MenuItemSprite.prototype;
cc.defineGetterSetter(_p,"normalImage",_p.getNormalImage,_p.setNormalImage);cc.defineGetterSetter(_p,"selectedImage",_p.getSelectedImage,_p.setSelectedImage);cc.defineGetterSetter(_p,"disabledImage",_p.getDisabledImage,_p.setDisabledImage);cc.MenuItemSprite.create=function(a,b,c,d,e){return new cc.MenuItemSprite(a,b,c,d,e||void 0)};
cc.MenuItemImage=cc.MenuItemSprite.extend({ctor:function(a,b,c,d,e){var f=null,g=null,h=null,k=null,m=null;void 0===a||null===a?cc.MenuItemSprite.prototype.ctor.call(this):(f=new cc.Sprite(a),b&&(g=new cc.Sprite(b)),void 0===d?k=c:void 0===e?(k=c,m=d):e&&(h=new cc.Sprite(c),k=d,m=e),cc.MenuItemSprite.prototype.ctor.call(this,f,g,h,k,m))},setNormalSpriteFrame:function(a){this.setNormalImage(new cc.Sprite(a))},setSelectedSpriteFrame:function(a){this.setSelectedImage(new cc.Sprite(a))},setDisabledSpriteFrame:function(a){this.setDisabledImage(new cc.Sprite(a))},
initWithNormalImage:function(a,b,c,d,e){var f=null,g=null,h=null;a&&(f=new cc.Sprite(a));b&&(g=new cc.Sprite(b));c&&(h=new cc.Sprite(c));return this.initWithNormalSprite(f,g,h,d,e)}});cc.MenuItemImage.create=function(a,b,c,d,e){return new cc.MenuItemImage(a,b,c,d,e)};
cc.MenuItemToggle=cc.MenuItem.extend({subItems:null,_selectedIndex:0,_opacity:null,_color:null,ctor:function(){cc.MenuItem.prototype.ctor.call(this);this._selectedIndex=0;this.subItems=[];this._opacity=0;this._color=cc.color.WHITE;0<arguments.length&&this.initWithItems(Array.prototype.slice.apply(arguments))},getOpacity:function(){return this._opacity},setOpacity:function(a){this._opacity=a;if(this.subItems&&0<this.subItems.length)for(var b=0;b<this.subItems.length;b++)this.subItems[b].opacity=a;
this._color.a=a},getColor:function(){var a=this._color;return cc.color(a.r,a.g,a.b,a.a)},setColor:function(a){var b=this._color;b.r=a.r;b.g=a.g;b.b=a.b;if(this.subItems&&0<this.subItems.length)for(b=0;b<this.subItems.length;b++)this.subItems[b].setColor(a);void 0===a.a||a.a_undefined||this.setOpacity(a.a)},getSelectedIndex:function(){return this._selectedIndex},setSelectedIndex:function(a){if(a!==this._selectedIndex){this._selectedIndex=a;(a=this.getChildByTag(cc.CURRENT_ITEM))&&a.removeFromParent(!1);
a=this.subItems[this._selectedIndex];this.addChild(a,0,cc.CURRENT_ITEM);var b=a.width,c=a.height;this.width=b;this.height=c;a.setPosition(b/2,c/2)}},getSubItems:function(){return this.subItems},setSubItems:function(a){this.subItems=a},initWithItems:function(a){var b=a.length;cc.isFunction(a[a.length-2])?(this.initWithCallback(a[a.length-2],a[a.length-1]),b-=2):cc.isFunction(a[a.length-1])?(this.initWithCallback(a[a.length-1],null),b-=1):this.initWithCallback(null,null);for(var c=this.subItems,d=c.length=
0;d<b;d++)a[d]&&c.push(a[d]);this._selectedIndex=cc.UINT_MAX;this.setSelectedIndex(0);this.setCascadeColorEnabled(!0);this.setCascadeOpacityEnabled(!0);return!0},addSubItem:function(a){this.subItems.push(a)},activate:function(){this._enabled&&this.setSelectedIndex((this._selectedIndex+1)%this.subItems.length);cc.MenuItem.prototype.activate.call(this)},selected:function(){cc.MenuItem.prototype.selected.call(this);this.subItems[this._selectedIndex].selected()},unselected:function(){cc.MenuItem.prototype.unselected.call(this);
this.subItems[this._selectedIndex].unselected()},setEnabled:function(a){if(this._enabled!==a){cc.MenuItem.prototype.setEnabled.call(this,a);var b=this.subItems;if(b&&0<b.length)for(var c=0;c<b.length;c++)b[c].enabled=a}},selectedItem:function(){return this.subItems[this._selectedIndex]},getSelectedItem:function(){return this.subItems[this._selectedIndex]},onEnter:function(){cc.Node.prototype.onEnter.call(this);this.setSelectedIndex(this._selectedIndex)}});_p=cc.MenuItemToggle.prototype;
cc.defineGetterSetter(_p,"selectedIndex",_p.getSelectedIndex,_p.setSelectedIndex);cc.MenuItemToggle.create=function(){0<arguments.length&&null==arguments[arguments.length-1]&&cc.log("parameters should not be ending with null in Javascript");var a=new cc.MenuItemToggle;a.initWithItems(Array.prototype.slice.apply(arguments));return a};cc.MENU_STATE_WAITING=0;cc.MENU_STATE_TRACKING_TOUCH=1;cc.MENU_HANDLER_PRIORITY=-128;cc.DEFAULT_PADDING=5;
cc.Menu=cc.Layer.extend({enabled:!1,_selectedItem:null,_state:-1,_touchListener:null,_className:"Menu",ctor:function(a){cc.Layer.prototype.ctor.call(this);this._color=cc.color.WHITE;this.enabled=!1;this._opacity=255;this._selectedItem=null;this._state=-1;this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:this._onTouchBegan,onTouchMoved:this._onTouchMoved,onTouchEnded:this._onTouchEnded,onTouchCancelled:this._onTouchCancelled});var b=
arguments.length,c;if(a instanceof Array)c=a;else if(0===b)c=[];else if(0<b){c=[];for(var d=0;d<b;d++)arguments[d]&&c.push(arguments[d])}this.initWithArray(c)},onEnter:function(){var a=this._touchListener;a._isRegistered()||cc.eventManager.addListener(a,this);cc.Node.prototype.onEnter.call(this)},isEnabled:function(){return this.enabled},setEnabled:function(a){this.enabled=a},initWithItems:function(a){var b=[];if(a)for(var c=0;c<a.length;c++)a[c]&&b.push(a[c]);return this.initWithArray(b)},initWithArray:function(a){if(cc.Layer.prototype.init.call(this)){this.enabled=
!0;var b=cc.winSize;this.setPosition(b.width/2,b.height/2);this.setContentSize(b);this.setAnchorPoint(0.5,0.5);this.ignoreAnchorPointForPosition(!0);if(a)for(b=0;b<a.length;b++)this.addChild(a[b],b);this._selectedItem=null;this._state=cc.MENU_STATE_WAITING;return this.cascadeOpacity=this.cascadeColor=!0}return!1},addChild:function(a,b,c){if(!(a instanceof cc.MenuItem))throw Error("cc.Menu.addChild() : Menu only supports MenuItem objects as children");cc.Layer.prototype.addChild.call(this,a,b,c)},
updateAlign:function(){switch(this._align){case "vertically":this.alignItemsVertically();break;case "horizontally":this.alignItemsHorizontally()}},alignItemsVertically:function(){this.alignItemsVerticallyWithPadding(cc.DEFAULT_PADDING)},alignItemsVerticallyWithPadding:function(a){this._align="vertically";var b=-a,c=this._children,d,e,f,g;if(c&&0<c.length){e=0;for(d=c.length;e<d;e++)b+=c[e].height*c[e].scaleY+a;var h=b/2;e=0;for(d=c.length;e<d;e++)g=c[e],f=g.height,b=g.scaleY,g.setPosition(0,h-f*b/
2),h-=f*b+a}},alignItemsHorizontally:function(){this.alignItemsHorizontallyWithPadding(cc.DEFAULT_PADDING)},alignItemsHorizontallyWithPadding:function(a){this._align="horizontally";var b=-a,c=this._children,d,e,f,g;if(c&&0<c.length){d=0;for(e=c.length;d<e;d++)b+=c[d].width*c[d].scaleX+a;var h=-b/2;d=0;for(e=c.length;d<e;d++)g=c[d],b=g.scaleX,f=c[d].width,g.setPosition(h+f*b/2,0),h+=f*b+a}},alignItemsInColumns:function(){0<arguments.length&&null==arguments[arguments.length-1]&&cc.log("parameters should not be ending with null in Javascript");
var a,b=[];for(a=0;a<arguments.length;a++)b.push(arguments[a]);var c=-5,d=0,e=0,f=0,g,h,k,m=this._children;if(m&&0<m.length)for(a=0,k=m.length;a<k;a++)d>=b.length||!(g=b[d])||(h=m[a].height,e=e>=h||isNaN(h)?e:h,++f,f>=g&&(c+=e+5,e=f=0,++d));var n=cc.director.getWinSize(),p=g=e=d=0,r=0,c=c/2;if(m&&0<m.length)for(a=0,k=m.length;a<k;a++){var s=m[a];0===g&&(g=b[d],r=p=n.width/(1+g));h=s._getHeight();e=e>=h||isNaN(h)?e:h;s.setPosition(r-n.width/2,c-h/2);r+=p;++f;f>=g&&(c-=e+5,e=g=f=0,++d)}},alignItemsInRows:function(){0<
arguments.length&&null==arguments[arguments.length-1]&&cc.log("parameters should not be ending with null in Javascript");var a,b=[];for(a=0;a<arguments.length;a++)b.push(arguments[a]);var c=[],d=[],e=-10,f=-5,g=0,h=0,k=0,m,n,p,r,s=this._children;if(s&&0<s.length)for(a=0,p=s.length;a<p;a++)(n=s[a],g>=b.length||!(m=b[g]))||(r=n.width,h=h>=r||isNaN(r)?h:r,f+=n.height+5,++k,k>=m&&(c.push(h),d.push(f),e+=h+10,h=k=0,f=-5,++g));f=cc.director.getWinSize();m=h=g=0;var e=-e/2,u=0;if(s&&0<s.length)for(a=0,p=
s.length;a<p;a++)n=s[a],0===m&&(m=b[g],u=d[g]),r=n._getWidth(),h=h>=r||isNaN(r)?h:r,n.setPosition(e+c[g]/2,u-f.height/2),u-=n.height+10,++k,k>=m&&(e+=h+5,h=m=k=0,++g)},removeChild:function(a,b){null!=a&&(a instanceof cc.MenuItem?(this._selectedItem===a&&(this._selectedItem=null),cc.Node.prototype.removeChild.call(this,a,b)):cc.log("cc.Menu.removeChild():Menu only supports MenuItem objects as children"))},_onTouchBegan:function(a,b){var c=b.getCurrentTarget();if(c._state!==cc.MENU_STATE_WAITING||!c._visible||
!c.enabled)return!1;for(var d=c.parent;null!=d;d=d.parent)if(!d.isVisible())return!1;c._selectedItem=c._itemForTouch(a);return c._selectedItem?(c._state=cc.MENU_STATE_TRACKING_TOUCH,c._selectedItem.selected(),c._selectedItem.setNodeDirty(),!0):!1},_onTouchEnded:function(a,b){var c=b.getCurrentTarget();c._state!==cc.MENU_STATE_TRACKING_TOUCH?cc.log("cc.Menu.onTouchEnded(): invalid state"):(c._selectedItem&&(c._selectedItem.unselected(),c._selectedItem.setNodeDirty(),c._selectedItem.activate()),c._state=
cc.MENU_STATE_WAITING)},_onTouchCancelled:function(a,b){var c=b.getCurrentTarget();c._state!==cc.MENU_STATE_TRACKING_TOUCH?cc.log("cc.Menu.onTouchCancelled(): invalid state"):(c._selectedItem&&(c._selectedItem.unselected(),c._selectedItem.setNodeDirty()),c._state=cc.MENU_STATE_WAITING)},_onTouchMoved:function(a,b){var c=b.getCurrentTarget();if(c._state!==cc.MENU_STATE_TRACKING_TOUCH)cc.log("cc.Menu.onTouchMoved(): invalid state");else{var d=c._itemForTouch(a);d!==c._selectedItem&&(c._selectedItem&&
(c._selectedItem.unselected(),c._selectedItem.setNodeDirty()),c._selectedItem=d,c._selectedItem&&(c._selectedItem.selected(),c._selectedItem.setNodeDirty()))}},onExit:function(){this._state===cc.MENU_STATE_TRACKING_TOUCH&&(this._selectedItem&&(this._selectedItem.unselected(),this._selectedItem=null),this._state=cc.MENU_STATE_WAITING);cc.Node.prototype.onExit.call(this)},setOpacityModifyRGB:function(a){},isOpacityModifyRGB:function(){return!1},_itemForTouch:function(a){a=a.getLocation();var b=this._children,
c;if(b&&0<b.length)for(var d=b.length-1;0<=d;d--)if(c=b[d],c.isVisible()&&c.isEnabled()){var e=c.convertToNodeSpace(a),f=c.rect();f.x=0;f.y=0;if(cc.rectContainsPoint(f,e))return c}return null}});_p=cc.Menu.prototype;cc.Menu.create=function(a){var b=arguments.length;0<b&&null==arguments[b-1]&&cc.log("parameters should not be ending with null in Javascript");return 0===b?new cc.Menu:1===b?new cc.Menu(a):new cc.Menu(Array.prototype.slice.call(arguments,0))};cc.Codec.GZip=function(a){this.data=a;this.debug=!1;this.gpflags=void 0;this.files=0;this.unzipped=[];this.buf32k=Array(32768);this.bIdx=0;this.modeZIP=!1;this.bytepos=0;this.bb=1;this.bits=0;this.nameBuf=[];this.fileout=void 0;this.literalTree=Array(cc.Codec.GZip.LITERALS);this.distanceTree=Array(32);this.treepos=0;this.Places=null;this.len=0;this.fpos=Array(17);this.fpos[0]=0;this.fmax=this.flens=void 0};cc.Codec.GZip.gunzip=function(a){return(new cc.Codec.GZip(a)).gunzip()[0][0]};
cc.Codec.GZip.HufNode=function(){this.b1=this.b0=0;this.jump=null;this.jumppos=-1};cc.Codec.GZip.LITERALS=288;cc.Codec.GZip.NAMEMAX=256;
cc.Codec.GZip.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,
97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255];
cc.Codec.GZip.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];cc.Codec.GZip.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99];cc.Codec.GZip.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];cc.Codec.GZip.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];cc.Codec.GZip.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];
cc.Codec.GZip.prototype.gunzip=function(){this.outputArr=[];this.nextFile();return this.unzipped};cc.Codec.GZip.prototype.readByte=function(){this.bits+=8;return this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1};cc.Codec.GZip.prototype.byteAlign=function(){this.bb=1};cc.Codec.GZip.prototype.readBit=function(){var a;this.bits++;a=this.bb&1;this.bb>>=1;0===this.bb&&(this.bb=this.readByte(),a=this.bb&1,this.bb=this.bb>>1|128);return a};
cc.Codec.GZip.prototype.readBits=function(a){for(var b=0,c=a;c--;)b=b<<1|this.readBit();a&&(b=cc.Codec.GZip.bitReverse[b]>>8-a);return b};cc.Codec.GZip.prototype.flushBuffer=function(){this.bIdx=0};cc.Codec.GZip.prototype.addBuffer=function(a){this.buf32k[this.bIdx++]=a;this.outputArr.push(String.fromCharCode(a));32768===this.bIdx&&(this.bIdx=0)};
cc.Codec.GZip.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}};
cc.Codec.GZip.prototype.Rec=function(){var a=this.Places[this.treepos],b;if(17===this.len)return-1;this.treepos++;this.len++;b=this.IsPat();if(0<=b)a.b0=b;else if(a.b0=32768,this.Rec())return-1;b=this.IsPat();if(0<=b)a.b1=b,a.jump=null;else if(a.b1=32768,a.jump=this.Places[this.treepos],a.jumppos=this.treepos,this.Rec())return-1;this.len--;return 0};
cc.Codec.GZip.prototype.CreateTree=function(a,b,c,d){this.Places=a;this.treepos=0;this.flens=c;this.fmax=b;for(a=0;17>a;a++)this.fpos[a]=0;this.len=0;return this.Rec()?-1:0};cc.Codec.GZip.prototype.DecodeValue=function(a){for(var b,c,d=0,e=a[d];;)if(b=this.readBit()){if(!(e.b1&32768))return e.b1;e=e.jump;b=a.length;for(c=0;c<b;c++)if(a[c]===e){d=c;break}}else{if(!(e.b0&32768))return e.b0;d++;e=a[d]}return-1};
cc.Codec.GZip.prototype.DeflateLoop=function(){var a,b,c,d,e;do if(a=this.readBit(),c=this.readBits(2),0===c)for(this.byteAlign(),c=this.readByte(),c|=this.readByte()<<8,b=this.readByte(),b|=this.readByte()<<8,(c^~b)&65535&&document.write("BlockLen checksum mismatch\n");c--;)b=this.readByte(),this.addBuffer(b);else if(1===c)for(;;)if(c=cc.Codec.GZip.bitReverse[this.readBits(7)]>>1,23<c?(c=c<<1|this.readBit(),199<c?(c-=128,c=c<<1|this.readBit()):(c-=48,143<c&&(c+=136))):c+=256,256>c)this.addBuffer(c);
else if(256===c)break;else{var f;c-=257;e=this.readBits(cc.Codec.GZip.cplext[c])+cc.Codec.GZip.cplens[c];c=cc.Codec.GZip.bitReverse[this.readBits(5)]>>3;8<cc.Codec.GZip.cpdext[c]?(f=this.readBits(8),f|=this.readBits(cc.Codec.GZip.cpdext[c]-8)<<8):f=this.readBits(cc.Codec.GZip.cpdext[c]);f+=cc.Codec.GZip.cpdist[c];for(c=0;c<e;c++)b=this.buf32k[this.bIdx-f&32767],this.addBuffer(b)}else if(2===c){var g=Array(320);b=257+this.readBits(5);f=1+this.readBits(5);d=4+this.readBits(4);for(c=0;19>c;c++)g[c]=
0;for(c=0;c<d;c++)g[cc.Codec.GZip.border[c]]=this.readBits(3);e=this.distanceTree.length;for(d=0;d<e;d++)this.distanceTree[d]=new cc.Codec.GZip.HufNode;if(this.CreateTree(this.distanceTree,19,g,0))return this.flushBuffer(),1;e=b+f;d=0;for(var h=-1;d<e;)if(h++,c=this.DecodeValue(this.distanceTree),16>c)g[d++]=c;else if(16===c){var k;c=3+this.readBits(2);if(d+c>e)return this.flushBuffer(),1;for(k=d?g[d-1]:0;c--;)g[d++]=k}else{c=17===c?3+this.readBits(3):11+this.readBits(7);if(d+c>e)return this.flushBuffer(),
1;for(;c--;)g[d++]=0}e=this.literalTree.length;for(d=0;d<e;d++)this.literalTree[d]=new cc.Codec.GZip.HufNode;if(this.CreateTree(this.literalTree,b,g,0))return this.flushBuffer(),1;e=this.literalTree.length;for(d=0;d<e;d++)this.distanceTree[d]=new cc.Codec.GZip.HufNode;c=[];for(d=b;d<g.length;d++)c[d-b]=g[d];if(this.CreateTree(this.distanceTree,f,c,0))return this.flushBuffer(),1;for(;;)if(c=this.DecodeValue(this.literalTree),256<=c){c-=256;if(0===c)break;c--;e=this.readBits(cc.Codec.GZip.cplext[c])+
cc.Codec.GZip.cplens[c];c=this.DecodeValue(this.distanceTree);8<cc.Codec.GZip.cpdext[c]?(f=this.readBits(8),f|=this.readBits(cc.Codec.GZip.cpdext[c]-8)<<8):f=this.readBits(cc.Codec.GZip.cpdext[c]);for(f+=cc.Codec.GZip.cpdist[c];e--;)b=this.buf32k[this.bIdx-f&32767],this.addBuffer(b)}else this.addBuffer(c)}while(!a);this.flushBuffer();this.byteAlign();return 0};cc.Codec.GZip.prototype.unzipFile=function(a){var b;this.gunzip();for(b=0;b<this.unzipped.length;b++)if(this.unzipped[b][1]===a)return this.unzipped[b][0]};
cc.Codec.GZip.prototype.nextFile=function(){this.outputArr=[];this.modeZIP=!1;var a=[];a[0]=this.readByte();a[1]=this.readByte();120===a[0]&&218===a[1]&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++);31===a[0]&&139===a[1]&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++);if(80===a[0]&&75===a[1]&&(this.modeZIP=!0,a[2]=this.readByte(),a[3]=this.readByte(),3===a[2]&&4===a[3])){a[0]=this.readByte();a[1]=this.readByte();
this.gpflags=this.readByte();this.gpflags|=this.readByte()<<8;a=this.readByte();a|=this.readByte()<<8;this.readByte();this.readByte();this.readByte();this.readByte();this.readByte();this.readByte();this.readByte();this.readByte();this.readByte();this.readByte();this.readByte();this.readByte();var b=this.readByte(),b=b|this.readByte()<<8,c=this.readByte(),c=c|this.readByte()<<8,d=0;for(this.nameBuf=[];b--;){var e=this.readByte();"/"===e|":"===e?d=0:d<cc.Codec.GZip.NAMEMAX-1&&(this.nameBuf[d++]=String.fromCharCode(e))}this.fileout||
(this.fileout=this.nameBuf);for(var d=0;d<c;)this.readByte(),d++;8===a&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++);this.skipdir()}};
cc.Codec.GZip.prototype.skipdir=function(){var a=[],b;this.gpflags&8&&(a[0]=this.readByte(),a[1]=this.readByte(),a[2]=this.readByte(),a[3]=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte());this.modeZIP&&this.nextFile();a[0]=this.readByte();if(8!==a[0])return 0;this.gpflags=this.readByte();this.readByte();this.readByte();this.readByte();this.readByte();this.readByte();this.readByte();if(this.gpflags&4)for(a[0]=
this.readByte(),a[2]=this.readByte(),this.len=a[0]+256*a[1],a=0;a<this.len;a++)this.readByte();if(this.gpflags&8)for(a=0,this.nameBuf=[];b=this.readByte();){if("7"===b||":"===b)a=0;a<cc.Codec.GZip.NAMEMAX-1&&(this.nameBuf[a++]=b)}if(this.gpflags&16)for(;this.readByte(););this.gpflags&2&&(this.readByte(),this.readByte());this.DeflateLoop();this.readByte();this.readByte();this.readByte();this.readByte();this.modeZIP&&this.nextFile()};/*
 zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */
(function(){function a(a){throw a;}function b(a,b){var c=a.split("."),d=y;c[0]in d||!d.execScript||d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)c.length||b===x?d=d[e]?d[e]:d[e]={}:d[e]=b}function c(a){if("string"===typeof a){a=a.split("");var b,c;b=0;for(c=a.length;b<c;b++)a[b]=(a[b].charCodeAt(0)&255)>>>0}b=1;c=0;for(var d=a.length,e,f=0;0<d;){e=1024<d?1024:d;d-=e;do b+=a[f++],c+=b;while(--e);b%=65521;c%=65521}return(c<<16|b)>>>0}function d(b,c){this.index="number"===typeof c?c:0;
this.i=0;this.buffer=b instanceof(z?Uint8Array:Array)?b:new (z?Uint8Array:Array)(32768);2*this.buffer.length<=this.index&&a(Error("invalid index"));this.buffer.length<=this.index&&this.f()}function e(a){this.buffer=new (z?Uint16Array:Array)(2*a);this.length=0}function f(a){var b=a.length,c=0,d=Number.POSITIVE_INFINITY,e,f,g,h,k,m,n,p,s;for(p=0;p<b;++p)a[p]>c&&(c=a[p]),a[p]<d&&(d=a[p]);e=1<<c;f=new (z?Uint32Array:Array)(e);g=1;h=0;for(k=2;g<=c;){for(p=0;p<b;++p)if(a[p]===g){m=0;n=h;for(s=0;s<g;++s)m=
m<<1|n&1,n>>=1;for(s=m;s<e;s+=k)f[s]=g<<16|p;++h}++g;h<<=1;k<<=1}return[f,c,d]}function g(a,b){this.h=J;this.w=0;this.input=a;this.b=0;b&&(b.lazy&&(this.w=b.lazy),"number"===typeof b.compressionType&&(this.h=b.compressionType),b.outputBuffer&&(this.a=z&&b.outputBuffer instanceof Array?new Uint8Array(b.outputBuffer):b.outputBuffer),"number"===typeof b.outputIndex&&(this.b=b.outputIndex));this.a||(this.a=new (z?Uint8Array:Array)(32768))}function h(a,b){this.length=a;this.G=b}function k(){var b=I;switch(A){case 3===
b:return[257,b-3,0];case 4===b:return[258,b-4,0];case 5===b:return[259,b-5,0];case 6===b:return[260,b-6,0];case 7===b:return[261,b-7,0];case 8===b:return[262,b-8,0];case 9===b:return[263,b-9,0];case 10===b:return[264,b-10,0];case 12>=b:return[265,b-11,1];case 14>=b:return[266,b-13,1];case 16>=b:return[267,b-15,1];case 18>=b:return[268,b-17,1];case 22>=b:return[269,b-19,2];case 26>=b:return[270,b-23,2];case 30>=b:return[271,b-27,2];case 34>=b:return[272,b-31,2];case 42>=b:return[273,b-35,3];case 50>=
b:return[274,b-43,3];case 58>=b:return[275,b-51,3];case 66>=b:return[276,b-59,3];case 82>=b:return[277,b-67,4];case 98>=b:return[278,b-83,4];case 114>=b:return[279,b-99,4];case 130>=b:return[280,b-115,4];case 162>=b:return[281,b-131,5];case 194>=b:return[282,b-163,5];case 226>=b:return[283,b-195,5];case 257>=b:return[284,b-227,5];case 258===b:return[285,b-258,0];default:a("invalid length: "+b)}}function m(b,c){function d(b,c){var e=b.G,f=[],g=0,h;h=M[b.length];f[g++]=h&65535;f[g++]=h>>16&255;f[g++]=
h>>24;var k;switch(A){case 1===e:k=[0,e-1,0];break;case 2===e:k=[1,e-2,0];break;case 3===e:k=[2,e-3,0];break;case 4===e:k=[3,e-4,0];break;case 6>=e:k=[4,e-5,1];break;case 8>=e:k=[5,e-7,1];break;case 12>=e:k=[6,e-9,2];break;case 16>=e:k=[7,e-13,2];break;case 24>=e:k=[8,e-17,3];break;case 32>=e:k=[9,e-25,3];break;case 48>=e:k=[10,e-33,4];break;case 64>=e:k=[11,e-49,4];break;case 96>=e:k=[12,e-65,5];break;case 128>=e:k=[13,e-97,5];break;case 192>=e:k=[14,e-129,6];break;case 256>=e:k=[15,e-193,6];break;
case 384>=e:k=[16,e-257,7];break;case 512>=e:k=[17,e-385,7];break;case 768>=e:k=[18,e-513,8];break;case 1024>=e:k=[19,e-769,8];break;case 1536>=e:k=[20,e-1025,9];break;case 2048>=e:k=[21,e-1537,9];break;case 3072>=e:k=[22,e-2049,10];break;case 4096>=e:k=[23,e-3073,10];break;case 6144>=e:k=[24,e-4097,11];break;case 8192>=e:k=[25,e-6145,11];break;case 12288>=e:k=[26,e-8193,12];break;case 16384>=e:k=[27,e-12289,12];break;case 24576>=e:k=[28,e-16385,13];break;case 32768>=e:k=[29,e-24577,13];break;default:a("invalid distance")}h=
k;f[g++]=h[0];f[g++]=h[1];f[g++]=h[2];e=0;for(g=f.length;e<g;++e)s[t++]=f[e];u[f[0]]++;w[f[3]]++;r=b.length+c-1;p=null}var e,f,g,k,m,n={},p,s=z?new Uint16Array(2*c.length):[],t=0,r=0,u=new (z?Uint32Array:Array)(286),w=new (z?Uint32Array:Array)(30),v=b.w,y;if(!z){for(g=0;285>=g;)u[g++]=0;for(g=0;29>=g;)w[g++]=0}u[256]=1;e=0;for(f=c.length;e<f;++e){g=m=0;for(k=3;g<k&&e+g!==f;++g)m=m<<8|c[e+g];n[m]===x&&(n[m]=[]);g=n[m];if(!(0<r--)){for(;0<g.length&&32768<e-g[0];)g.shift();if(e+3>=f){p&&d(p,-1);g=0;
for(k=f-e;g<k;++g)y=c[e+g],s[t++]=y,++u[y];break}if(0<g.length){m=k=x;var D=0,B=x,C=x,E=B=x,G=c.length,C=0,E=g.length;a:for(;C<E;C++){k=g[E-C-1];B=3;if(3<D){for(B=D;3<B;B--)if(c[k+B-1]!==c[e+B-1])continue a;B=D}for(;258>B&&e+B<G&&c[k+B]===c[e+B];)++B;B>D&&(m=k,D=B);if(258===B)break}k=new h(D,e-m);p?p.length<k.length?(y=c[e-1],s[t++]=y,++u[y],d(k,0)):d(p,-1):k.length<v?p=k:d(k,0)}else p?d(p,-1):(y=c[e],s[t++]=y,++u[y])}g.push(e)}s[t++]=256;u[256]++;b.L=u;b.K=w;return z?s.subarray(0,t):s}function n(a,
b){function c(a){var b=s[a][t[a]];b===n?(c(a+1),c(a+1)):--p[b];++t[a]}var d=a.length,f=new e(572),g=new (z?Uint8Array:Array)(d),h,k,m;if(!z)for(k=0;k<d;k++)g[k]=0;for(k=0;k<d;++k)0<a[k]&&f.push(k,a[k]);d=Array(f.length/2);h=new (z?Uint32Array:Array)(f.length/2);if(1===d.length)return g[f.pop().index]=1,g;k=0;for(m=f.length/2;k<m;++k)d[k]=f.pop(),h[k]=d[k].value;var n=h.length;k=new (z?Uint16Array:Array)(b);var f=new (z?Uint8Array:Array)(b),p=new (z?Uint8Array:Array)(n);m=Array(b);var s=Array(b),t=
Array(b),r=(1<<b)-n,u=1<<b-1,w,v,x;k[b-1]=n;for(w=0;w<b;++w)r<u?f[w]=0:(f[w]=1,r-=u),r<<=1,k[b-2-w]=(k[b-1-w]/2|0)+n;k[0]=f[0];m[0]=Array(k[0]);s[0]=Array(k[0]);for(w=1;w<b;++w)k[w]>2*k[w-1]+f[w]&&(k[w]=2*k[w-1]+f[w]),m[w]=Array(k[w]),s[w]=Array(k[w]);for(r=0;r<n;++r)p[r]=b;for(u=0;u<k[b-1];++u)m[b-1][u]=h[u],s[b-1][u]=u;for(r=0;r<b;++r)t[r]=0;1===f[b-1]&&(--p[0],++t[b-1]);for(w=b-2;0<=w;--w){v=r=0;x=t[w+1];for(u=0;u<k[w];u++)v=m[w+1][x]+m[w+1][x+1],v>h[r]?(m[w][u]=v,s[w][u]=n,x+=2):(m[w][u]=h[r],
s[w][u]=r,++r);t[w]=0;1===f[w]&&c(w)}h=p;k=0;for(m=d.length;k<m;++k)g[d[k].index]=h[k];return g}function p(b){var c=new (z?Uint16Array:Array)(b.length),d=[],e=[],f=0,g,h,k;g=0;for(h=b.length;g<h;g++)d[b[g]]=(d[b[g]]|0)+1;g=1;for(h=16;g<=h;g++)e[g]=f,f+=d[g]|0,f>1<<g&&a("overcommitted"),f<<=1;65536>f&&a("undercommitted");g=0;for(h=b.length;g<h;g++)for(f=e[b[g]],e[b[g]]+=1,d=c[g]=0,k=b[g];d<k;d++)c[g]=c[g]<<1|f&1,f>>>=1;return c}function r(a,b){this.input=a;this.a=new (z?Uint8Array:Array)(32768);this.h=
H.j;var c={},d;!b&&(b={})||"number"!==typeof b.compressionType||(this.h=b.compressionType);for(d in b)c[d]=b[d];c.outputBuffer=this.a;this.z=new g(this.input,c)}function s(b,c){this.k=[];this.l=32768;this.e=this.g=this.c=this.q=0;this.input=z?new Uint8Array(b):b;this.s=!1;this.m=N;this.B=!1;if(c||!(c={}))c.index&&(this.c=c.index),c.bufferSize&&(this.l=c.bufferSize),c.bufferType&&(this.m=c.bufferType),c.resize&&(this.B=c.resize);switch(this.m){case L:this.b=32768;this.a=new (z?Uint8Array:Array)(32768+
this.l+258);break;case N:this.b=0;this.a=new (z?Uint8Array:Array)(this.l);this.f=this.J;this.t=this.H;this.o=this.I;break;default:a(Error("invalid inflate mode"))}}function u(b,c){for(var d=b.g,e=b.e,f=b.input,g=b.c,h;e<c;)h=f[g++],h===x&&a(Error("input buffer is broken")),d|=h<<e,e+=8;b.g=d>>>c;b.e=e-c;b.c=g;return d&(1<<c)-1}function t(b,c){for(var d=b.g,e=b.e,f=b.input,g=b.c,h=c[0],k=c[1],m;e<k;)m=f[g++],m===x&&a(Error("input buffer is broken")),d|=m<<e,e+=8;f=h[d&(1<<k)-1];h=f>>>16;b.g=d>>h;b.e=
e-h;b.c=g;return f&65535}function w(a){function b(a,c,d){var e,f,g,h;for(h=0;h<a;)switch(e=t(this,c),e){case 16:for(g=3+u(this,2);g--;)d[h++]=f;break;case 17:for(g=3+u(this,3);g--;)d[h++]=0;f=0;break;case 18:for(g=11+u(this,7);g--;)d[h++]=0;f=0;break;default:f=d[h++]=e}return d}var c=u(a,5)+257,d=u(a,5)+1,e=u(a,4)+4,g=new (z?Uint8Array:Array)(Q.length),h;for(h=0;h<e;++h)g[Q[h]]=u(a,3);e=f(g);g=new (z?Uint8Array:Array)(c);h=new (z?Uint8Array:Array)(d);a.o(f(b.call(a,c,e,g)),f(b.call(a,d,e,h)))}function v(b,
c){var d,e;this.input=b;this.c=0;if(c||!(c={}))c.index&&(this.c=c.index),c.verify&&(this.M=c.verify);d=b[this.c++];e=b[this.c++];switch(d&15){case V:this.method=V;break;default:a(Error("unsupported compression method"))}0!==((d<<8)+e)%31&&a(Error("invalid fcheck flag:"+((d<<8)+e)%31));e&32&&a(Error("fdict flag is not supported"));this.A=new s(b,{index:this.c,bufferSize:c.bufferSize,bufferType:c.bufferType,resize:c.resize})}var x=void 0,A=!0,y=this,z="undefined"!==typeof Uint8Array&&"undefined"!==
typeof Uint16Array&&"undefined"!==typeof Uint32Array;d.prototype.f=function(){var a=this.buffer,b,c=a.length,d=new (z?Uint8Array:Array)(c<<1);if(z)d.set(a);else for(b=0;b<c;++b)d[b]=a[b];return this.buffer=d};d.prototype.d=function(a,b,c){var d=this.buffer,e=this.index,f=this.i,g=d[e];c&&1<b&&(a=8<b?(E[a&255]<<24|E[a>>>8&255]<<16|E[a>>>16&255]<<8|E[a>>>24&255])>>32-b:E[a]>>8-b);if(8>b+f)g=g<<b|a,f+=b;else for(c=0;c<b;++c)g=g<<1|a>>b-c-1&1,8===++f&&(f=0,d[e++]=E[g],g=0,e===d.length&&(d=this.f()));
d[e]=g;this.buffer=d;this.i=f;this.index=e};d.prototype.finish=function(){var a=this.buffer,b=this.index,c;0<this.i&&(a[b]<<=8-this.i,a[b]=E[a[b]],b++);z?c=a.subarray(0,b):(a.length=b,c=a);return c};var B=new (z?Uint8Array:Array)(256),D;for(D=0;256>D;++D){for(var C=D,G=C,F=7,C=C>>>1;C;C>>>=1)G<<=1,G|=C&1,--F;B[D]=(G<<F&255)>>>0}var E=B,B=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,
498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,
3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,
2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,
2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,
2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,
711928724,3020668471,3272380065,1510334235,755167117];z&&new Uint32Array(B);e.prototype.getParent=function(a){return 2*((a-2)/4|0)};e.prototype.push=function(a,b){var c,d,e=this.buffer,f;c=this.length;e[this.length++]=b;for(e[this.length++]=a;0<c;)if(d=this.getParent(c),e[c]>e[d])f=e[c],e[c]=e[d],e[d]=f,f=e[c+1],e[c+1]=e[d+1],e[d+1]=f,c=d;else break;return this.length};e.prototype.pop=function(){var a,b,c=this.buffer,d,e,f;b=c[0];a=c[1];this.length-=2;c[0]=c[this.length];c[1]=c[this.length+1];for(f=
0;;){e=2*f+2;if(e>=this.length)break;e+2<this.length&&c[e+2]>c[e]&&(e+=2);if(c[e]>c[f])d=c[f],c[f]=c[e],c[e]=d,d=c[f+1],c[f+1]=c[e+1],c[e+1]=d;else break;f=e}return{index:a,value:b,length:this.length}};var J=2,B={NONE:0,r:1,j:J,N:3},K=[];for(D=0;288>D;D++)switch(A){case 143>=D:K.push([D+48,8]);break;case 255>=D:K.push([D-144+400,9]);break;case 279>=D:K.push([D-256+0,7]);break;case 287>=D:K.push([D-280+192,8]);break;default:a("invalid literal: "+D)}g.prototype.n=function(){var b,c,e,f,g=this.input;
switch(this.h){case 0:e=0;for(f=g.length;e<f;){c=z?g.subarray(e,e+65535):g.slice(e,e+65535);e+=c.length;var h=e===f,k=x,s=k=x,s=k=x,t=this.a,r=this.b;if(z){for(t=new Uint8Array(this.a.buffer);t.length<=r+c.length+5;)t=new Uint8Array(t.length<<1);t.set(this.a)}k=h?1:0;t[r++]=k|0;k=c.length;s=~k+65536&65535;t[r++]=k&255;t[r++]=k>>>8&255;t[r++]=s&255;t[r++]=s>>>8&255;if(z)t.set(c,r),r+=c.length,t=t.subarray(0,r);else{k=0;for(s=c.length;k<s;++k)t[r++]=c[k];t.length=r}this.b=r;this.a=t}break;case 1:e=
new d(new Uint8Array(this.a.buffer),this.b);e.d(1,1,A);e.d(1,2,A);g=m(this,g);c=0;for(h=g.length;c<h;c++)if(f=g[c],d.prototype.d.apply(e,K[f]),256<f)e.d(g[++c],g[++c],A),e.d(g[++c],5),e.d(g[++c],g[++c],A);else if(256===f)break;this.a=e.finish();this.b=this.a.length;break;case J:f=new d(new Uint8Array(this.a),this.b);var w,u,v,y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],D,B,k=Array(19),C,t=J;f.d(1,1,A);f.d(t,2,A);g=m(this,g);s=n(this.L,15);D=p(s);t=n(this.K,7);r=p(t);for(w=286;257<w&&0===s[w-
1];w--);for(u=30;1<u&&0===t[u-1];u--);var E=w,G=u;b=new (z?Uint32Array:Array)(E+G);var F=new (z?Uint32Array:Array)(316),I,H;B=new (z?Uint8Array:Array)(19);for(C=v=0;C<E;C++)b[v++]=s[C];for(C=0;C<G;C++)b[v++]=t[C];if(!z)for(C=0,G=B.length;C<G;++C)B[C]=0;C=I=0;for(G=b.length;C<G;C+=v){for(v=1;C+v<G&&b[C+v]===b[C];++v);E=v;if(0===b[C])if(3>E)for(;0<E--;)F[I++]=0,B[0]++;else for(;0<E;)H=138>E?E:138,H>E-3&&H<E&&(H=E-3),10>=H?(F[I++]=17,F[I++]=H-3,B[17]++):(F[I++]=18,F[I++]=H-11,B[18]++),E-=H;else if(F[I++]=
b[C],B[b[C]]++,E--,3>E)for(;0<E--;)F[I++]=b[C],B[b[C]]++;else for(;0<E;)H=6>E?E:6,H>E-3&&H<E&&(H=E-3),F[I++]=16,F[I++]=H-3,B[16]++,E-=H}b=z?F.subarray(0,I):F.slice(0,I);B=n(B,7);for(C=0;19>C;C++)k[C]=B[y[C]];for(v=19;4<v&&0===k[v-1];v--);y=p(B);f.d(w-257,5,A);f.d(u-1,5,A);f.d(v-4,4,A);for(C=0;C<v;C++)f.d(k[C],3,A);C=0;for(k=b.length;C<k;C++)if(c=b[C],f.d(y[c],B[c],A),16<=c){C++;switch(c){case 16:h=2;break;case 17:h=3;break;case 18:h=7;break;default:a("invalid code: "+c)}f.d(b[C],h,A)}h=[D,s];r=[r,
t];c=h[0];h=h[1];t=r[0];D=r[1];r=0;for(k=g.length;r<k;++r)if(e=g[r],f.d(c[e],h[e],A),256<e)f.d(g[++r],g[++r],A),s=g[++r],f.d(t[s],D[s],A),f.d(g[++r],g[++r],A);else if(256===e)break;this.a=f.finish();this.b=this.a.length;break;default:a("invalid compression type")}return this.a};D=[];var I;for(I=3;258>=I;I++)C=k(),D[I]=C[2]<<24|C[1]<<16|C[0];var M=z?new Uint32Array(D):D,H=B;r.prototype.n=function(){var b,d,e,f,g=0;f=this.a;b=V;switch(b){case V:d=Math.LOG2E*Math.log(32768)-8;break;default:a(Error("invalid compression method"))}d=
d<<4|b;f[g++]=d;switch(b){case V:switch(this.h){case H.NONE:e=0;break;case H.r:e=1;break;case H.j:e=2;break;default:a(Error("unsupported compression type"))}break;default:a(Error("invalid compression method"))}b=e<<6|0;f[g++]=b|31-(256*d+b)%31;b=c(this.input);this.z.b=g;f=this.z.n();g=f.length;z&&(f=new Uint8Array(f.buffer),f.length<=g+4&&(this.a=new Uint8Array(f.length+4),this.a.set(f),f=this.a),f=f.subarray(0,g+4));f[g++]=b>>24&255;f[g++]=b>>16&255;f[g++]=b>>8&255;f[g++]=b&255;return f};b("Zlib.Deflate",
r);b("Zlib.Deflate.compress",function(a,b){return(new r(a,b)).n()});b("Zlib.Deflate.CompressionType",H);b("Zlib.Deflate.CompressionType.NONE",H.NONE);b("Zlib.Deflate.CompressionType.FIXED",H.r);b("Zlib.Deflate.CompressionType.DYNAMIC",H.j);var L=0,N=1,B={D:L,C:N};s.prototype.p=function(){for(;!this.s;){var b=u(this,3);b&1&&(this.s=A);b>>>=1;switch(b){case 0:var b=this.input,c=this.c,d=this.a,e=this.b,f=x,g=x,h=x,k=d.length,f=x;this.e=this.g=0;f=b[c++];f===x&&a(Error("invalid uncompressed block header: LEN (first byte)"));
g=f;f=b[c++];f===x&&a(Error("invalid uncompressed block header: LEN (second byte)"));g|=f<<8;f=b[c++];f===x&&a(Error("invalid uncompressed block header: NLEN (first byte)"));h=f;f=b[c++];f===x&&a(Error("invalid uncompressed block header: NLEN (second byte)"));h|=f<<8;g===~h&&a(Error("invalid uncompressed block header: length verify"));c+g>b.length&&a(Error("input buffer is broken"));switch(this.m){case L:for(;e+g>d.length;){f=k-e;g-=f;if(z)d.set(b.subarray(c,c+f),e),e+=f,c+=f;else for(;f--;)d[e++]=
b[c++];this.b=e;d=this.f();e=this.b}break;case N:for(;e+g>d.length;)d=this.f({v:2});break;default:a(Error("invalid inflate mode"))}if(z)d.set(b.subarray(c,c+g),e),e+=g,c+=g;else for(;g--;)d[e++]=b[c++];this.c=c;this.b=e;this.a=d;break;case 1:this.o(T,W);break;case 2:w(this);break;default:a(Error("unknown BTYPE: "+b))}}return this.t()};D=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];var Q=z?new Uint16Array(D):D;D=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,
258,258,258];var P=z?new Uint16Array(D):D;D=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0];var O=z?new Uint8Array(D):D;D=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];var U=z?new Uint16Array(D):D;D=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];var R=z?new Uint8Array(D):D;D=new (z?Uint8Array:Array)(288);C=0;for(G=D.length;C<G;++C)D[C]=143>=C?8:255>=C?9:279>=C?7:8;var T=f(D);D=new (z?Uint8Array:
Array)(30);C=0;for(G=D.length;C<G;++C)D[C]=5;var W=f(D);s.prototype.o=function(a,b){var c=this.a,d=this.b;this.u=a;for(var e=c.length-258,f,g,h;256!==(f=t(this,a));)if(256>f)d>=e&&(this.b=d,c=this.f(),d=this.b),c[d++]=f;else for(f-=257,h=P[f],0<O[f]&&(h+=u(this,O[f])),f=t(this,b),g=U[f],0<R[f]&&(g+=u(this,R[f])),d>=e&&(this.b=d,c=this.f(),d=this.b);h--;)c[d]=c[d++-g];for(;8<=this.e;)this.e-=8,this.c--;this.b=d};s.prototype.I=function(a,b){var c=this.a,d=this.b;this.u=a;for(var e=c.length,f,g,h;256!==
(f=t(this,a));)if(256>f)d>=e&&(c=this.f(),e=c.length),c[d++]=f;else for(f-=257,h=P[f],0<O[f]&&(h+=u(this,O[f])),f=t(this,b),g=U[f],0<R[f]&&(g+=u(this,R[f])),d+h>e&&(c=this.f(),e=c.length);h--;)c[d]=c[d++-g];for(;8<=this.e;)this.e-=8,this.c--;this.b=d};s.prototype.f=function(){var a=new (z?Uint8Array:Array)(this.b-32768),b=this.b-32768,c,d,e=this.a;if(z)a.set(e.subarray(32768,a.length));else for(c=0,d=a.length;c<d;++c)a[c]=e[c+32768];this.k.push(a);this.q+=a.length;if(z)e.set(e.subarray(b,b+32768));
else for(c=0;32768>c;++c)e[c]=e[b+c];this.b=32768;return e};s.prototype.J=function(a){var b,c=this.input.length/this.c+1|0,d,e,f,g=this.input,h=this.a;a&&("number"===typeof a.v&&(c=a.v),"number"===typeof a.F&&(c+=a.F));2>c?(d=(g.length-this.c)/this.u[2],f=d/2*258|0,e=f<h.length?h.length+f:h.length<<1):e=h.length*c;z?(b=new Uint8Array(e),b.set(h)):b=h;return this.a=b};s.prototype.t=function(){var a=0,b=this.a,c=this.k,d,e=new (z?Uint8Array:Array)(this.q+(this.b-32768)),f,g,h,k;if(0===c.length)return z?
this.a.subarray(32768,this.b):this.a.slice(32768,this.b);f=0;for(g=c.length;f<g;++f)for(d=c[f],h=0,k=d.length;h<k;++h)e[a++]=d[h];f=32768;for(g=this.b;f<g;++f)e[a++]=b[f];this.k=[];return this.buffer=e};s.prototype.H=function(){var a,b=this.b;z?this.B?(a=new Uint8Array(b),a.set(this.a.subarray(0,b))):a=this.a.subarray(0,b):(this.a.length>b&&(this.a.length=b),a=this.a);return this.buffer=a};v.prototype.p=function(){var b=this.input,d,e;d=this.A.p();this.c=this.A.c;this.M&&(e=(b[this.c++]<<24|b[this.c++]<<
16|b[this.c++]<<8|b[this.c++])>>>0,e!==c(d)&&a(Error("invalid adler-32 checksum")));return d};b("Zlib.Inflate",v);b("Zlib.Inflate.BufferType",B);B.ADAPTIVE=B.C;B.BLOCK=B.D;b("Zlib.Inflate.prototype.decompress",v.prototype.p);B=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];z&&new Uint16Array(B);B=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258];z&&new Uint16Array(B);B=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0];z&&new Uint8Array(B);
B=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];z&&new Uint16Array(B);B=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];z&&new Uint8Array(B);B=new (z?Uint8Array:Array)(288);D=0;for(C=B.length;D<C;++D)B[D]=143>=D?8:255>=D?9:279>=D?7:8;f(B);B=new (z?Uint8Array:Array)(30);D=0;for(C=B.length;D<C;++D)B[D]=5;f(B);var V=8}).call(this);_p=window;_p=_p.Zlib=_p.Zlib;_p.Deflate=_p.Deflate;_p.Deflate.compress=_p.Deflate.compress;
_p.Inflate=_p.Inflate;_p.Inflate.BufferType=_p.Inflate.BufferType;_p.Inflate.prototype.decompress=_p.Inflate.prototype.decompress;cc.TGA_OK=0;cc.TGA_ERROR_FILE_OPEN=1;cc.TGA_ERROR_READING_FILE=2;cc.TGA_ERROR_INDEXED_COLOR=3;cc.TGA_ERROR_MEMORY=4;cc.TGA_ERROR_COMPRESSED_FILE=5;cc.ImageTGA=function(a,b,c,d,e,f,g){this.status=a||0;this.type=b||0;this.pixelDepth=c||0;this.width=d||0;this.height=e||0;this.imageData=f||[];this.flipped=g||0};
cc.tgaLoadHeader=function(a,b,c){var d=2;if(d+1>b)return!1;a=new cc.BinaryStreamReader(a);a.setOffset(d);c.type=a.readByte();d+=10;if(d+4+1>b)return!1;a.setOffset(d);c.width=a.readUnsignedShort();c.height=a.readUnsignedInteger();c.pixelDepth=a.readByte();if(d+5+1>b)return!1;b=a.readByte();c.flipped=0;b&32&&(c.flipped=1);return!0};
cc.tgaLoadImageData=function(a,b,c){var d,e;d=0|c.pixelDepth/2;e=c.height*c.width*d;if(18+e>b)return!1;c.imageData=cc.__getSubArray(a,18,18+e);if(3<=d)for(a=0;a<e;a+=d)b=c.imageData[a],c.imageData[a]=c.imageData[a+2],c.imageData[a+2]=b;return!0};
cc.tgaRGBtogreyscale=function(a){var b,c;if(8!==a.pixelDepth){var d=a.pixelDepth/8,e=new Uint8Array(a.height*a.width);if(null!==e){for(c=b=0;c<a.width*a.height;b+=d,c++)e[c]=0.3*a.imageData[b]+0.59*a.imageData[b+1]+0.11*a.imageData[b+2];a.pixelDepth=8;a.type=3;a.imageData=e}}};cc.tgaDestroy=function(a){a&&(a.imageData=null)};
cc.tgaLoadRLEImageData=function(a,b,c){var d,e,f,g=0,h=0,k=0,m=[],n=0,p=18;d=c.pixelDepth/8;e=c.height*c.width;for(f=0;f<e;f++){if(0!==n)n--,h=0!==k;else{if(p+1>b)break;n=a[p];p+=1;(k=n&128)&&(n-=128);h=0}if(!h){if(p+d>b)break;m=cc.__getSubArray(a,p,p+d);p+=d;3<=d&&(h=m[0],m[0]=m[2],m[2]=h)}for(h=0;h<d;h++)c.imageData[g+h]=m[h];g+=d}return!0};
cc.tgaFlipImage=function(a){for(var b=a.pixelDepth/8*a.width,c=0;c<a.height/2;c++){var d=cc.__getSubArray(a.imageData,c*b,c*b+b);cc.__setDataToArray(cc.__getSubArray(a.imageData,(a.height-(c+1))*b,b),a.imageData,c*b);cc.__setDataToArray(d,a.imageData,(a.height-(c+1))*b)}a.flipped=0};cc.__getSubArray=function(a,b,c){return a instanceof Array?a.slice(b,c):a.subarray(b,c)};cc.__setDataToArray=function(a,b,c){for(var d=0;d<a.length;d++)b[c+d]=a[d]};
cc.BinaryStreamReader=cc.Class.extend({_binaryData:null,_offset:0,ctor:function(a){this._binaryData=a},setBinaryData:function(a){this._binaryData=a;this._offset=0},getBinaryData:function(){return this._binaryData},_checkSize:function(a){if(!(this._offset+Math.ceil(a/8)<this._data.length))throw Error("Index out of bound");},_decodeFloat:function(a,b){var c=a+b+1,d=c>>3;this._checkSize(c);var c=Math.pow(2,b-1)-1,e=this._readBits(a+b,1,d),f=this._readBits(a,b,d),g=0,h=2,k=0;do for(var m=this._readByte(++k,
d),n=a%8||8,p=1<<n;p>>=1;)m&p&&(g+=1/h),h*=2;while(a-=n);this._offset+=d;return f===(c<<1)+1?g?NaN:e?-Infinity:Infinity:(1+-2*e)*(f||g?f?Math.pow(2,f-c)*(1+g):Math.pow(2,-c+1)*g:0)},_readByte:function(a,b){return this._data[this._offset+b-a-1]},_decodeInt:function(a,b){var c=this._readBits(0,a,a/8),d=Math.pow(2,a);this._offset+=a/8;return b&&c>=d/2?c-d:c},_shl:function(a,b){for(++b;--b;a=1073741824===((a%=2147483648)&1073741824)?2*a:2*(a-1073741824)+2147483648);return a},_readBits:function(a,b,c){var d=
(a+b)%8,e=a%8,f=c-(a>>3)-1;a=c+(-(a+b)>>3);var g=f-a;b=this._readByte(f,c)>>e&(1<<(g?8-e:b))-1;for(g&&d&&(b+=(this._readByte(a++,c)&(1<<d)-1)<<(g--<<3)-e);g;)b+=this._shl(this._readByte(a++,c),(g--<<3)-e);return b},readInteger:function(){return this._decodeInt(32,!0)},readUnsignedInteger:function(){return this._decodeInt(32,!1)},readSingle:function(){return this._decodeFloat(23,8)},readShort:function(){return this._decodeInt(16,!0)},readUnsignedShort:function(){return this._decodeInt(16,!1)},readByte:function(){var a=
this._data[this._offset];this._offset+=1;return a},readData:function(a,b){return this._binaryData instanceof Array?this._binaryData.slice(a,b):this._binaryData.subarray(a,b)},setOffset:function(a){this._offset=a},getOffset:function(){return this._offset}});cc.TMX_ORIENTATION_ORTHO=0;cc.TMX_ORIENTATION_HEX=1;cc.TMX_ORIENTATION_ISO=2;
cc.TMXTiledMap=cc.Node.extend({properties:null,mapOrientation:null,objectGroups:null,_mapSize:null,_tileSize:null,_tileProperties:null,_className:"TMXTiledMap",ctor:function(a,b){cc.Node.prototype.ctor.call(this);this._mapSize=cc.size(0,0);this._tileSize=cc.size(0,0);void 0!==b?this.initWithXML(a,b):void 0!==a&&this.initWithTMXFile(a)},getMapSize:function(){return cc.size(this._mapSize.width,this._mapSize.height)},setMapSize:function(a){this._mapSize.width=a.width;this._mapSize.height=a.height},_getMapWidth:function(){return this._mapSize.width},
_setMapWidth:function(a){this._mapSize.width=a},_getMapHeight:function(){return this._mapSize.height},_setMapHeight:function(a){this._mapSize.height=a},getTileSize:function(){return cc.size(this._tileSize.width,this._tileSize.height)},setTileSize:function(a){this._tileSize.width=a.width;this._tileSize.height=a.height},_getTileWidth:function(){return this._tileSize.width},_setTileWidth:function(a){this._tileSize.width=a},_getTileHeight:function(){return this._tileSize.height},_setTileHeight:function(a){this._tileSize.height=
a},getMapOrientation:function(){return this.mapOrientation},setMapOrientation:function(a){this.mapOrientation=a},getObjectGroups:function(){return this.objectGroups},setObjectGroups:function(a){this.objectGroups=a},getProperties:function(){return this.properties},setProperties:function(a){this.properties=a},initWithTMXFile:function(a){if(!a||0===a.length)throw Error("cc.TMXTiledMap.initWithTMXFile(): tmxFile should be non-null or non-empty string.");this.height=this.width=0;a=new cc.TMXMapInfo(a);
if(!a)return!1;var b=a.getTilesets();b&&0!==b.length||cc.log("cc.TMXTiledMap.initWithTMXFile(): Map not found. Please check the filename.");this._buildWithMapInfo(a);return!0},initWithXML:function(a,b){this.height=this.width=0;var c=new cc.TMXMapInfo(a,b),d=c.getTilesets();d&&0!==d.length||cc.log("cc.TMXTiledMap.initWithXML(): Map not found. Please check the filename.");this._buildWithMapInfo(c);return!0},_buildWithMapInfo:function(a){this._mapSize=a.getMapSize();this._tileSize=a.getTileSize();this.mapOrientation=
a.orientation;this.objectGroups=a.getObjectGroups();this.properties=a.properties;this._tileProperties=a.getTileProperties();var b=0,c=a.getLayers();if(c)for(var d=null,e=0,f=c.length;e<f;e++)(d=c[e])&&d.visible&&(d=this._parseLayer(d,a),this.addChild(d,b,b),this.width=Math.max(this.width,d.width),this.height=Math.max(this.height,d.height),b++)},allLayers:function(){for(var a=[],b=this._children,c=0,d=b.length;c<d;c++){var e=b[c];e&&e instanceof cc.TMXLayer&&a.push(e)}return a},getLayer:function(a){if(!a||
0===a.length)throw Error("cc.TMXTiledMap.getLayer(): layerName should be non-null or non-empty string.");for(var b=this._children,c=0;c<b.length;c++){var d=b[c];if(d&&d.layerName===a)return d}return null},getObjectGroup:function(a){if(!a||0===a.length)throw Error("cc.TMXTiledMap.getObjectGroup(): groupName should be non-null or non-empty string.");if(this.objectGroups)for(var b=0;b<this.objectGroups.length;b++){var c=this.objectGroups[b];if(c&&c.groupName===a)return c}return null},getProperty:function(a){return this.properties[a.toString()]},
propertiesForGID:function(a){cc.log("propertiesForGID is deprecated. Please use getPropertiesForGID instead.");return this.getPropertiesForGID[a]},getPropertiesForGID:function(a){return this._tileProperties[a]},_parseLayer:function(a,b){var c=this._tilesetForLayer(a,b),c=new cc.TMXLayer(c,a,b);a.ownTiles=!1;return c},_tilesetForLayer:function(a,b){var c=a._layerSize,d=b.getTilesets();if(d)for(var e=d.length-1;0<=e;e--){var f=d[e];if(f)for(var g=0;g<c.height;g++)for(var h=0;h<c.width;h++){var k=a._tiles[h+
c.width*g];if(0!==k&&(k&cc.TMX_TILE_FLIPPED_MASK)>>>0>=f.firstGid)return f}}cc.log("cocos2d: Warning: TMX Layer "+a.name+" has no tiles");return null}});_p=cc.TMXTiledMap.prototype;cc.defineGetterSetter(_p,"mapWidth",_p._getMapWidth,_p._setMapWidth);cc.defineGetterSetter(_p,"mapHeight",_p._getMapHeight,_p._setMapHeight);cc.defineGetterSetter(_p,"tileWidth",_p._getTileWidth,_p._setTileWidth);cc.defineGetterSetter(_p,"tileHeight",_p._getTileHeight,_p._setTileHeight);
cc.TMXTiledMap.create=function(a,b){return new cc.TMXTiledMap(a,b)};cc.TMX_PROPERTY_NONE=0;cc.TMX_PROPERTY_MAP=1;cc.TMX_PROPERTY_LAYER=2;cc.TMX_PROPERTY_OBJECTGROUP=3;cc.TMX_PROPERTY_OBJECT=4;cc.TMX_PROPERTY_TILE=5;cc.TMX_TILE_HORIZONTAL_FLAG=2147483648;cc.TMX_TILE_VERTICAL_FLAG=1073741824;cc.TMX_TILE_DIAGONAL_FLAG=536870912;cc.TMX_TILE_FLIPPED_ALL=(cc.TMX_TILE_HORIZONTAL_FLAG|cc.TMX_TILE_VERTICAL_FLAG|cc.TMX_TILE_DIAGONAL_FLAG)>>>0;cc.TMX_TILE_FLIPPED_MASK=~cc.TMX_TILE_FLIPPED_ALL>>>0;
cc.TMXLayerInfo=cc.Class.extend({properties:null,name:"",_layerSize:null,_tiles:null,visible:null,_opacity:null,ownTiles:!0,_minGID:1E5,_maxGID:0,offset:null,ctor:function(){this.properties=[];this.name="";this._tiles=this._layerSize=null;this.visible=!0;this._opacity=0;this.ownTiles=!0;this._minGID=1E5;this._maxGID=0;this.offset=cc.p(0,0)},getProperties:function(){return this.properties},setProperties:function(a){this.properties=a}});
cc.TMXTilesetInfo=cc.Class.extend({name:"",firstGid:0,_tileSize:null,spacing:0,margin:0,sourceImage:"",imageSize:null,ctor:function(){this._tileSize=cc.size(0,0);this.imageSize=cc.size(0,0)},rectForGID:function(a,b){var c=b||cc.rect(0,0,0,0);c.width=this._tileSize.width;c.height=this._tileSize.height;a&=cc.TMX_TILE_FLIPPED_MASK;a-=parseInt(this.firstGid,10);var d=parseInt((this.imageSize.width-2*this.margin+this.spacing)/(this._tileSize.width+this.spacing),10);c.x=parseInt(a%d*(this._tileSize.width+
this.spacing)+this.margin,10);c.y=parseInt(parseInt(a/d,10)*(this._tileSize.height+this.spacing)+this.margin,10);return c}});
cc.TMXMapInfo=cc.SAXParser.extend({properties:null,orientation:null,parentElement:null,parentGID:null,layerAttrs:0,storingCharacters:!1,tmxFileName:null,currentString:null,_objectGroups:null,_mapSize:null,_tileSize:null,_layers:null,_tilesets:null,_tileProperties:null,_resources:"",_currentFirstGID:0,ctor:function(a,b){cc.SAXParser.prototype.ctor.apply(this);this._mapSize=cc.size(0,0);this._tileSize=cc.size(0,0);this._layers=[];this._tilesets=[];this._objectGroups=[];this.properties=[];this._tileProperties=
{};this._currentFirstGID=0;void 0!==b?this.initWithXML(a,b):void 0!==a&&this.initWithTMXFile(a)},getOrientation:function(){return this.orientation},setOrientation:function(a){this.orientation=a},getMapSize:function(){return cc.size(this._mapSize.width,this._mapSize.height)},setMapSize:function(a){this._mapSize.width=a.width;this._mapSize.height=a.height},_getMapWidth:function(){return this._mapSize.width},_setMapWidth:function(a){this._mapSize.width=a},_getMapHeight:function(){return this._mapSize.height},
_setMapHeight:function(a){this._mapSize.height=a},getTileSize:function(){return cc.size(this._tileSize.width,this._tileSize.height)},setTileSize:function(a){this._tileSize.width=a.width;this._tileSize.height=a.height},_getTileWidth:function(){return this._tileSize.width},_setTileWidth:function(a){this._tileSize.width=a},_getTileHeight:function(){return this._tileSize.height},_setTileHeight:function(a){this._tileSize.height=a},getLayers:function(){return this._layers},setLayers:function(a){this._layers.push(a)},
getTilesets:function(){return this._tilesets},setTilesets:function(a){this._tilesets.push(a)},getObjectGroups:function(){return this._objectGroups},setObjectGroups:function(a){this._objectGroups.push(a)},getParentElement:function(){return this.parentElement},setParentElement:function(a){this.parentElement=a},getParentGID:function(){return this.parentGID},setParentGID:function(a){this.parentGID=a},getLayerAttribs:function(){return this.layerAttrs},setLayerAttribs:function(a){this.layerAttrs=a},getStoringCharacters:function(){return this.storingCharacters},
setStoringCharacters:function(a){this.storingCharacters=a},getProperties:function(){return this.properties},setProperties:function(a){this.properties=a},initWithTMXFile:function(a){this._internalInit(a,null);return this.parseXMLFile(a)},initWithXML:function(a,b){this._internalInit(null,b);return this.parseXMLString(a)},parseXMLFile:function(a,b){var c=(b=b||!1)?a:cc.loader.getRes(a);if(!c)throw Error("Please load the resource first : "+a);var d,e,c=this._parseXML(c).documentElement;d=c.getAttribute("version");
e=c.getAttribute("orientation");if("map"===c.nodeName&&("1.0"!==d&&null!==d&&cc.log("cocos2d: TMXFormat: Unsupported TMX version:"+d),"orthogonal"===e?this.orientation=cc.TMX_ORIENTATION_ORTHO:"isometric"===e?this.orientation=cc.TMX_ORIENTATION_ISO:"hexagonal"===e?this.orientation=cc.TMX_ORIENTATION_HEX:null!==e&&cc.log("cocos2d: TMXFomat: Unsupported orientation:"+e),d=cc.size(0,0),d.width=parseFloat(c.getAttribute("width")),d.height=parseFloat(c.getAttribute("height")),this.setMapSize(d),d=cc.size(0,
0),d.width=parseFloat(c.getAttribute("tilewidth")),d.height=parseFloat(c.getAttribute("tileheight")),this.setTileSize(d),e=c.querySelectorAll("map \x3e properties \x3e  property"))){var f={};for(d=0;d<e.length;d++)f[e[d].getAttribute("name")]=e[d].getAttribute("value");this.properties=f}f=c.getElementsByTagName("tileset");"map"!==c.nodeName&&(f=[],f.push(c));for(d=0;d<f.length;d++){e=f[d];var g=e.getAttribute("source");if(g)e=b?cc.path.join(this._resources,g):cc.path.changeBasename(a,g),this.parseXMLFile(e);
else{g=new cc.TMXTilesetInfo;g.name=e.getAttribute("name")||"";g.firstGid=parseInt(e.getAttribute("firstgid"))||0;g.spacing=parseInt(e.getAttribute("spacing"))||0;g.margin=parseInt(e.getAttribute("margin"))||0;var h=cc.size(0,0);h.width=parseFloat(e.getAttribute("tilewidth"));h.height=parseFloat(e.getAttribute("tileheight"));g._tileSize=h;var h=e.getElementsByTagName("image")[0].getAttribute("source"),k=-1;this.tmxFileName&&(k=this.tmxFileName.lastIndexOf("/"));-1!==k?(k=this.tmxFileName.substr(0,
k+1),g.sourceImage=k+h):g.sourceImage=this._resources+(this._resources?"/":"")+h;this.setTilesets(g);if(h=e.getElementsByTagName("tile"))for(k=0;k<h.length;k++){e=h[k];this.parentGID=parseInt(g.firstGid)+parseInt(e.getAttribute("id")||0);var m=e.querySelectorAll("properties \x3e property");if(m){var n={};for(e=0;e<m.length;e++){var p=m[e].getAttribute("name");n[p]=m[e].getAttribute("value")}this._tileProperties[this.parentGID]=n}}}}if(f=c.getElementsByTagName("layer"))for(d=0;d<f.length;d++){k=f[d];
m=k.getElementsByTagName("data")[0];g=new cc.TMXLayerInfo;g.name=k.getAttribute("name");e=cc.size(0,0);e.width=parseFloat(k.getAttribute("width"));e.height=parseFloat(k.getAttribute("height"));g._layerSize=e;e=k.getAttribute("visible");g.visible="0"!=e;e=k.getAttribute("opacity")||1;g._opacity=e?parseInt(255*parseFloat(e)):255;g.offset=cc.p(parseFloat(k.getAttribute("x"))||0,parseFloat(k.getAttribute("y"))||0);n="";for(e=0;e<m.childNodes.length;e++)n+=m.childNodes[e].nodeValue;n=n.trim();e=m.getAttribute("compression");
p=m.getAttribute("encoding");if(e&&"gzip"!==e&&"zlib"!==e)return cc.log("cc.TMXMapInfo.parseXMLFile(): unsupported compression method"),null;switch(e){case "gzip":h=cc.unzipBase64AsArray(n,4);break;case "zlib":h=new Zlib.Inflate(cc.Codec.Base64.decodeAsArray(n,1));h=cc.uint8ArrayToUint32Array(h.decompress());break;case null:case "":if("base64"===p)h=cc.Codec.Base64.decodeAsArray(n,4);else if("csv"===p)for(h=[],e=n.split(","),m=0;m<e.length;m++)h.push(parseInt(e[m]));else for(e=m.getElementsByTagName("tile"),
h=[],m=0;m<e.length;m++)h.push(parseInt(e[m].getAttribute("gid")));break;default:this.layerAttrs===cc.TMXLayerInfo.ATTRIB_NONE&&cc.log("cc.TMXMapInfo.parseXMLFile(): Only base64 and/or gzip/zlib maps are supported")}h&&(g._tiles=new Uint32Array(h));if(k=k.querySelectorAll("properties \x3e property")){m={};for(e=0;e<k.length;e++)m[k[e].getAttribute("name")]=k[e].getAttribute("value");g.properties=m}this.setLayers(g)}if(h=c.getElementsByTagName("objectgroup"))for(d=0;d<h.length;d++){g=h[d];f=new cc.TMXObjectGroup;
f.groupName=g.getAttribute("name");f.setPositionOffset(cc.p(parseFloat(g.getAttribute("x"))*this.getTileSize().width||0,parseFloat(g.getAttribute("y"))*this.getTileSize().height||0));if(k=g.querySelectorAll("objectgroup \x3e properties \x3e property"))for(e=0;e<k.length;e++)m={},m[k[e].getAttribute("name")]=k[e].getAttribute("value"),f.properties=m;g=g.querySelectorAll("object");k=cc.director.getContentScaleFactor();if(g)for(e=0;e<g.length;e++){n=g[e];m={};m.name=n.getAttribute("name")||"";m.type=
n.getAttribute("type")||"";m.width=parseInt(n.getAttribute("width"))||0;m.height=parseInt(n.getAttribute("height"))||0;m.x=(((n.getAttribute("x")||0)|0)+f.getPositionOffset().x)/k;p=((n.getAttribute("y")||0)|0)+f.getPositionOffset().y/k;m.y=(parseInt(this.getMapSize().height*this.getTileSize().height)-p-m.height)/cc.director.getContentScaleFactor();m.rotation=parseInt(n.getAttribute("rotation"))||0;if(p=n.querySelectorAll("properties \x3e property"))for(var r=0;r<p.length;r++)m[p[r].getAttribute("name")]=
p[r].getAttribute("value");(p=n.querySelectorAll("polygon"))&&0<p.length&&(p=p[0].getAttribute("points"))&&(m.points=this._parsePointsString(p));(n=n.querySelectorAll("polyline"))&&0<n.length&&(n=n[0].getAttribute("points"))&&(m.polylinePoints=this._parsePointsString(n));f.setObjects(m)}this.setObjectGroups(f)}return c},_parsePointsString:function(a){if(!a)return null;var b=[];a=a.split(" ");for(var c=0;c<a.length;c++){var d=a[c].split(",");b.push({x:d[0],y:d[1]})}return b},parseXMLString:function(a){return this.parseXMLFile(a,
!0)},getTileProperties:function(){return this._tileProperties},setTileProperties:function(a){this._tileProperties.push(a)},getCurrentString:function(){return this.currentString},setCurrentString:function(a){this.currentString=a},getTMXFileName:function(){return this.tmxFileName},setTMXFileName:function(a){this.tmxFileName=a},_internalInit:function(a,b){this._tilesets.length=0;this._layers.length=0;this.tmxFileName=a;b&&(this._resources=b);this._objectGroups.length=0;this.properties.length=0;this._tileProperties.length=
0;this.currentString="";this.storingCharacters=!1;this.layerAttrs=cc.TMXLayerInfo.ATTRIB_NONE;this.parentElement=cc.TMX_PROPERTY_NONE;this._currentFirstGID=0}});_p=cc.TMXMapInfo.prototype;cc.defineGetterSetter(_p,"mapWidth",_p._getMapWidth,_p._setMapWidth);cc.defineGetterSetter(_p,"mapHeight",_p._getMapHeight,_p._setMapHeight);cc.defineGetterSetter(_p,"tileWidth",_p._getTileWidth,_p._setTileWidth);cc.defineGetterSetter(_p,"tileHeight",_p._getTileHeight,_p._setTileHeight);
cc.TMXMapInfo.create=function(a,b){return new cc.TMXMapInfo(a,b)};cc.loader.register(["tmx","tsx"],cc._txtLoader);cc.TMXLayerInfo.ATTRIB_NONE=1;cc.TMXLayerInfo.ATTRIB_BASE64=2;cc.TMXLayerInfo.ATTRIB_GZIP=4;cc.TMXLayerInfo.ATTRIB_ZLIB=8;cc.TMXObjectGroup=cc.Class.extend({properties:null,groupName:"",_positionOffset:null,_objects:null,ctor:function(){this.groupName="";this._positionOffset=cc.p(0,0);this.properties=[];this._objects=[]},getPositionOffset:function(){return cc.p(this._positionOffset)},setPositionOffset:function(a){this._positionOffset.x=a.x;this._positionOffset.y=a.y},getProperties:function(){return this.properties},setProperties:function(a){this.properties.push(a)},getGroupName:function(){return this.groupName.toString()},
setGroupName:function(a){this.groupName=a},propertyNamed:function(a){return this.properties[a]},objectNamed:function(a){return this.getObject(a)},getObject:function(a){if(this._objects&&0<this._objects.length)for(var b=this._objects,c=0,d=b.length;c<d;c++){var e=b[c].name;if(e&&e===a)return b[c]}return null},getObjects:function(){return this._objects},setObjects:function(a){this._objects.push(a)}});cc.TMXLayer=cc.SpriteBatchNode.extend({tiles:null,tileset:null,layerOrientation:null,properties:null,layerName:"",_textures:null,_texGrids:null,_spriteTiles:null,_layerSize:null,_mapTileSize:null,_opacity:255,_minGID:null,_maxGID:null,_vertexZvalue:null,_useAutomaticVertexZ:null,_reusedTile:null,_atlasIndexArray:null,_contentScaleFactor:null,_className:"TMXLayer",ctor:function(a,b,c){cc.SpriteBatchNode.prototype.ctor.call(this);this._descendants=[];this._layerSize=cc.size(0,0);this._mapTileSize=cc.size(0,
0);this._spriteTiles={};void 0!==c&&this.initWithTilesetInfo(a,b,c)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.TMXLayer.CanvasRenderCmd(this):new cc.TMXLayer.WebGLRenderCmd(this)},_fillTextureGrids:function(a,b){var c=this._textures[b];if(c.isLoaded()){a.imageSize.width&&a.imageSize.height||(a.imageSize.width=c.width,a.imageSize.height=c.height);for(var d=a._tileSize.width,e=a._tileSize.height,f=c._contentSize.width,c=c._contentSize.height,g=a.spacing,h=
a.margin,k=a.firstGid,g=a.firstGid+Math.floor((c-2*h+g)/(e+g))*Math.floor((f-2*h+g)/(d+g)),h=this._texGrids,m=null,n=h[k]?!0:!1;k<g;++k){n&&!h[k]&&(n=!1);if(!n&&h[k])break;m={texId:b,x:0,y:0,width:d,height:e,t:0,l:0,r:0,b:0};a.rectForGID(k,m);m.t=m.y/c;m.l=m.x/f;m.r=(m.x+m.width)/f;m.b=(m.y+m.height)/c;h[k]=m}}else c.addEventListener("load",function(){this._fillTextureGrids(a,b)},this)},initWithTilesetInfo:function(a,b,c){var d=b._layerSize;parseInt(d.width*d.height);this.layerName=b.name;this.tiles=
b._tiles;this.properties=b.properties;this._layerSize=d;this._minGID=b._minGID;this._maxGID=b._maxGID;this._opacity=b._opacity;this.tileset=a;this.layerOrientation=c.orientation;this._mapTileSize=c.getTileSize();if(c=c._tilesets){this._textures=[];this._texGrids=[];for(var e=c.length,f,g,d=0;d<e;++d)f=c[d],g=cc.textureCache.addImage(f.sourceImage),this._textures.push(g),this._fillTextureGrids(f,d),f===a&&(this._texture=g)}a=this._calculateLayerOffset(b.offset);this.setPosition(cc.pointPixelsToPoints(a));
this._parseInternalProperties();this.setContentSize(cc.sizePixelsToPoints(cc.size(this._layerSize.width*this._mapTileSize.width,this._layerSize.height*this._mapTileSize.height)));this._useAutomaticVertexZ=!1;this._vertexZvalue=0;return!0},getLayerSize:function(){return cc.size(this._layerSize.width,this._layerSize.height)},setLayerSize:function(a){this._layerSize.width=a.width;this._layerSize.height=a.height},_getLayerWidth:function(){return this._layerSize.width},_setLayerWidth:function(a){this._layerSize.width=
a},_getLayerHeight:function(){return this._layerSize.height},_setLayerHeight:function(a){this._layerSize.height=a},getMapTileSize:function(){return cc.size(this._mapTileSize.width,this._mapTileSize.height)},setMapTileSize:function(a){this._mapTileSize.width=a.width;this._mapTileSize.height=a.height},_getTileWidth:function(){return this._mapTileSize.width},_setTileWidth:function(a){this._mapTileSize.width=a},_getTileHeight:function(){return this._mapTileSize.height},_setTileHeight:function(a){this._mapTileSize.height=
a},getTiles:function(){return this.tiles},setTiles:function(a){this.tiles=a},getTileset:function(){return this.tileset},setTileset:function(a){this.tileset=a},getLayerOrientation:function(){return this.layerOrientation},setLayerOrientation:function(a){this.layerOrientation=a},getProperties:function(){return this.properties},setProperties:function(a){this.properties=a},getProperty:function(a){return this.properties[a]},getLayerName:function(){return this.layerName},setLayerName:function(a){this.layerName=
a},releaseMap:function(){this._spriteTiles={}},getTileAt:function(a,b){if(void 0===a)throw Error("cc.TMXLayer.getTileAt(): pos should be non-null");var c=a;void 0===b&&(c=a.x,b=a.y);if(c>=this._layerSize.width||b>=this._layerSize.height||0>c||0>b)throw Error("cc.TMXLayer.getTileAt(): invalid position");if(!this.tiles)return cc.log("cc.TMXLayer.getTileAt(): TMXLayer: the tiles map has been released"),null;var d=null,e=this.getTileGIDAt(c,b);if(0===e)return d;var f=0|c+b*this._layerSize.width,d=this._spriteTiles[f];
d||(d=this._texGrids[e],e=this._textures[d.texId],d=cc.rectPixelsToPoints(d),d=new cc.Sprite(e,d),d.setPosition(this.getPositionAt(c,b)),c=this._vertexZForPos(c,b),d.setVertexZ(c),d.setAnchorPoint(0,0),d.setOpacity(this._opacity),this.addChild(d,c,f));return d},getTileGIDAt:function(a,b){if(void 0===a)throw Error("cc.TMXLayer.getTileGIDAt(): pos should be non-null");var c=a;void 0===b&&(c=a.x,b=a.y);if(c>=this._layerSize.width||b>=this._layerSize.height||0>c||0>b)throw Error("cc.TMXLayer.getTileGIDAt(): invalid position");
return this.tiles?(this.tiles[0|c+b*this._layerSize.width]&cc.TMX_TILE_FLIPPED_MASK)>>>0:(cc.log("cc.TMXLayer.getTileGIDAt(): TMXLayer: the tiles map has been released"),null)},setTileGID:function(a,b,c,d){if(void 0===b)throw Error("cc.TMXLayer.setTileGID(): pos should be non-null");void 0!==d?b=cc.p(b,c):d=c;if(b.x>=this._layerSize.width||b.y>=this._layerSize.height||0>b.x||0>b.y)throw Error("cc.TMXLayer.setTileGID(): invalid position");if(this.tiles)if(0!==a&&a<this.tileset.firstGid)cc.log("cc.TMXLayer.setTileGID(): invalid gid:"+
a);else{d=d||0;c=this.getTileFlagsAt(b);var e=this.getTileGIDAt(b);if(e!==a||c!==d)if(c=(a|d)>>>0,0===a)this.removeTileAt(b);else if(0===e)this._updateTileForGID(c,b);else{var e=b.x+b.y*this._layerSize.width,f=this.getChildByTag(e);if(f){a=this._texGrids[a];var g=this._textures[a.texId];a=cc.rectPixelsToPoints(a);f.setTexture(g);f.setTextureRect(a,!1);null!=d&&this._setupTileSprite(f,b,c);this.tiles[e]=c}else this._updateTileForGID(c,b)}}else cc.log("cc.TMXLayer.setTileGID(): TMXLayer: the tiles map has been released")},
addChild:function(a,b,c){cc.Node.prototype.addChild.call(this,a,b,c);void 0!==c&&(this._spriteTiles[c]=a,a._vertexZ=this._vertexZ+cc.renderer.assignedZStep*c/this.tiles.length)},removeChild:function(a,b){this._spriteTiles[a.tag]&&(this._spriteTiles[a.tag]=null);cc.Node.prototype.removeChild.call(this,a,b)},getTileFlagsAt:function(a,b){if(!a)throw Error("cc.TMXLayer.getTileFlagsAt(): pos should be non-null");void 0!==b&&(a=cc.p(a,b));if(a.x>=this._layerSize.width||a.y>=this._layerSize.height||0>a.x||
0>a.y)throw Error("cc.TMXLayer.getTileFlagsAt(): invalid position");return this.tiles?(this.tiles[0|a.x+a.y*this._layerSize.width]&cc.TMX_TILE_FLIPPED_ALL)>>>0:(cc.log("cc.TMXLayer.getTileFlagsAt(): TMXLayer: the tiles map has been released"),null)},removeTileAt:function(a,b){if(!a)throw Error("cc.TMXLayer.removeTileAt(): pos should be non-null");void 0!==b&&(a=cc.p(a,b));if(a.x>=this._layerSize.width||a.y>=this._layerSize.height||0>a.x||0>a.y)throw Error("cc.TMXLayer.removeTileAt(): invalid position");
if(!this.tiles)cc.log("cc.TMXLayer.removeTileAt(): TMXLayer: the tiles map has been released");else if(0!==this.getTileGIDAt(a)){var c=0|a.x+a.y*this._layerSize.width;this.tiles[c]=0;(c=this._spriteTiles[c])&&this.removeChild(c,!0)}},getPositionAt:function(a,b){void 0!==b&&(a=cc.p(a,b));var c=cc.p(0,0);switch(this.layerOrientation){case cc.TMX_ORIENTATION_ORTHO:c=this._positionForOrthoAt(a);break;case cc.TMX_ORIENTATION_ISO:c=this._positionForIsoAt(a);break;case cc.TMX_ORIENTATION_HEX:c=this._positionForHexAt(a)}return cc.pointPixelsToPoints(c)},
_positionForIsoAt:function(a){return cc.p(this._mapTileSize.width/2*(this._layerSize.width+a.x-a.y-1),this._mapTileSize.height/2*(2*this._layerSize.height-a.x-a.y-2))},_positionForOrthoAt:function(a){return cc.p(a.x*this._mapTileSize.width,(this._layerSize.height-a.y-1)*this._mapTileSize.height)},_positionForHexAt:function(a){return cc.p(a.x*this._mapTileSize.width*3/4,(this._layerSize.height-a.y-1)*this._mapTileSize.height+(1===a.x%2?-this._mapTileSize.height/2:0))},_calculateLayerOffset:function(a){var b=
cc.p(0,0);switch(this.layerOrientation){case cc.TMX_ORIENTATION_ORTHO:b=cc.p(a.x*this._mapTileSize.width,-a.y*this._mapTileSize.height);break;case cc.TMX_ORIENTATION_ISO:b=cc.p(this._mapTileSize.width/2*(a.x-a.y),this._mapTileSize.height/2*(-a.x-a.y));break;case cc.TMX_ORIENTATION_HEX:0===a.x&&0===a.y||cc.log("offset for hexagonal map not implemented yet")}return b},_updateTileForGID:function(a,b){if(this._texGrids[a]){var c=0|b.x+b.y*this._layerSize.width;c<this.tiles.length&&(this.tiles[c]=a)}},
_parseInternalProperties:function(){var a=this.getProperty("cc_vertexz");if(a)if("automatic"===a){this._useAutomaticVertexZ=!0;var a=this.getProperty("cc_alpha_func"),b=0;a&&(b=parseFloat(a));cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(this.shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST),this.shaderProgram.use(),this.shaderProgram.setUniformLocationWith1f(cc.UNIFORM_ALPHA_TEST_VALUE_S,b))}else this._vertexZvalue=parseInt(a,10)},_setupTileSprite:function(a,
b,c){var d=this.getPositionAt(b);a.setPosition(d);a.setVertexZ(this._vertexZForPos(b));a.setAnchorPoint(0,0);a.setOpacity(this._opacity);a.setFlippedX(!1);a.setFlippedY(!1);a.setRotation(0);(c&cc.TMX_TILE_DIAGONAL_FLAG)>>>0?(a.setAnchorPoint(0.5,0.5),a.setPosition(d.x+a.width/2,d.y+a.height/2),b=(c&(cc.TMX_TILE_HORIZONTAL_FLAG|cc.TMX_TILE_VERTICAL_FLAG)>>>0)>>>0,b===cc.TMX_TILE_HORIZONTAL_FLAG?a.setRotation(90):b===cc.TMX_TILE_VERTICAL_FLAG?a.setRotation(270):(b===(cc.TMX_TILE_VERTICAL_FLAG|cc.TMX_TILE_HORIZONTAL_FLAG)>>>
0?a.setRotation(90):a.setRotation(270),a.setFlippedX(!0))):((c&cc.TMX_TILE_HORIZONTAL_FLAG)>>>0&&a.setFlippedX(!0),(c&cc.TMX_TILE_VERTICAL_FLAG)>>>0&&a.setFlippedY(!0))},_vertexZForPos:function(a,b){void 0===b&&(b=a.y,a=a.x);var c=0,d=0;if(this._useAutomaticVertexZ)switch(this.layerOrientation){case cc.TMX_ORIENTATION_ISO:d=this._layerSize.width+this._layerSize.height;c=-(d-(a+b));break;case cc.TMX_ORIENTATION_ORTHO:c=-(this._layerSize.height-b);break;case cc.TMX_ORIENTATION_HEX:cc.log("TMX Hexa zOrder not supported");
break;default:cc.log("TMX invalid value")}else c=this._vertexZvalue;return c}});_p=cc.TMXLayer.prototype;cc.defineGetterSetter(_p,"layerWidth",_p._getLayerWidth,_p._setLayerWidth);cc.defineGetterSetter(_p,"layerHeight",_p._getLayerHeight,_p._setLayerHeight);cc.defineGetterSetter(_p,"tileWidth",_p._getTileWidth,_p._setTileWidth);cc.defineGetterSetter(_p,"tileHeight",_p._getTileHeight,_p._setTileHeight);cc.TMXLayer.create=function(a,b,c){return new cc.TMXLayer(a,b,c)};(function(){cc.TMXLayer.CanvasRenderCmd=function(a){this._rootCtor(a);this._needDraw=!0};var a=cc.TMXLayer.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);a.constructor=cc.TMXLayer.CanvasRenderCmd;a.visit=function(a){var c=this._node,d=cc.renderer;if(a=a||this.getParentRenderCmd())this._curLevel=a._curLevel+1;if(c._visible){isNaN(c._customZ)&&(c._vertexZ=d.assignedZ,d.assignedZ+=d.assignedZStep);this._syncStatus(a);a=c._children;var e=c._spriteTiles,f,g=a.length;if(0<g){c.sortAllChildren();
for(f=0;f<g;f++)if(c=a[f],0>c._localZOrder)c._renderCmd.visit(this);else break;for(d.pushRenderCommand(this);f<g;f++)c=a[f],0===c._localZOrder&&e[c.tag]?(isNaN(c._customZ)&&(c._vertexZ=d.assignedZ,d.assignedZ+=d.assignedZStep),c._renderCmd.updateStatus()):c._renderCmd.visit(this)}else d.pushRenderCommand(this);this._dirtyFlag=0}};a.rendering=function(a,c,d){var e=this._node,f=e._rotationX||e._rotationY,g=e.layerOrientation,h=e._opacity/255;if(e.tiles&&!(0>=h)){var k=e._mapTileSize.width,m=e._mapTileSize.height,
n=e.tileset._tileSize.width/cc.director._contentScaleFactor,p=e.tileset._tileSize.height/cc.director._contentScaleFactor,r=n-k,s=p-m,u=cc.winSize.width,t=cc.winSize.height,w=e._layerSize.height,v=e._layerSize.width,x=e._texGrids,A=e._spriteTiles,y=this._worldTransform,z=-e._contentSize.width*e._anchorPoint.x,B=-e._contentSize.height*e._anchorPoint.y,D=y.a,C=y.d,G=z*D+B*y.c+y.tx,z=z*y.b+B*C+y.ty,B=a||cc._renderContext,F=B.getContext(),E=0,J=0,K=v,I=w;f||g!==cc.TMX_ORIENTATION_ORTHO||(E=Math.floor(-(G-
r*D)/(k*D)),J=Math.floor((z-s*C+m*w*C-t)/(m*C)),K=Math.ceil((u-G+r*D)/(k*D)),I=w-Math.floor(-(z+s*C)/(m*C)),0>E&&(E=0),0>J&&(J=0),K>v&&(K=v),I>w&&(I=w));var M,H,r=J*v,L,N,Q,P=cc.TMX_TILE_FLIPPED_MASK,O,U,R,T,W=n*D,V=p*C,S,ba,Y=!1,Z=!1,s=r+E;for(M in A)if(M<s&&A[M])L=A[M]._renderCmd,0===A[M]._localZOrder&&L.rendering&&L.rendering(a,c,d);else if(M>=s)break;B.setTransform(y,c,d);for(B.setGlobalAlpha(h);J<I;++J){for(H=E;H<K;++H)if(s=r+H,A[s])L=A[s]._renderCmd,0===A[s]._localZOrder&&L.rendering&&(L.rendering(a,
c,d),B.setTransform(y,c,d),B.setGlobalAlpha(h));else if(L=e.tiles[s],(N=x[(L&P)>>>0])&&(Q=e._textures[N.texId])&&Q._htmlElementObj){switch(g){case cc.TMX_ORIENTATION_ORTHO:U=H*k;R=-(w-J-1)*m;break;case cc.TMX_ORIENTATION_ISO:U=k/2*(v+H-J-1);R=-m/2*(2*w-H-J-2);break;case cc.TMX_ORIENTATION_HEX:U=H*k*3/4,R=-(w-J-1)*m+(1===H%2?-m/2:0)}T=U+n;O=R-p;if(!f&&g===cc.TMX_ORIENTATION_ISO){S=-z+R*C;if(S<-t-V){H+=Math.floor(2*(-t-S)/V)-1;continue}S=G+T*D;if(S<-W){H+=Math.floor(2*-S/W)-1;continue}ba=G+U*D;S=-z+
O*C;if(ba>u||0<S){H=K;continue}}L>cc.TMX_TILE_DIAGONAL_FLAG&&(Y=(L&cc.TMX_TILE_HORIZONTAL_FLAG)>>>0,Z=(L&cc.TMX_TILE_VERTICAL_FLAG)>>>0);Y&&(U=-T,F.scale(-1,1));Z&&(O=-R,F.scale(1,-1));F.drawImage(Q._htmlElementObj,N.x,N.y,N.width,N.height,U,O,n,p);Y&&F.scale(-1,1);Z&&F.scale(1,-1);cc.g_NumberOfDraws++}r+=v}for(M in A)M>s&&A[M]&&(L=A[M]._renderCmd,0===A[M]._localZOrder&&L.rendering&&L.rendering(a,c,d))}}})();(function(){cc.TMXLayer.WebGLRenderCmd=function(a){this._rootCtor(a);this._needDraw=!0;this._vertices=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];this._color=new Uint32Array(1);this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST);a=90*Math.PI/180;this._sin90=Math.sin(a);this._cos90=Math.cos(a);a*=3;this._sin270=Math.sin(a);this._cos270=Math.cos(a)};var a=cc.TMXLayer.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);a.constructor=cc.TMXLayer.WebGLRenderCmd;
a.uploadData=function(a,c,d){var e=this._node,f=e._rotationX||e._rotationY,g=e.layerOrientation,h=e.tiles;if(!h)return 0;var k=e._mapTileSize.width,m=e._mapTileSize.height,n=e.tileset._tileSize.width/cc.director._contentScaleFactor,p=e.tileset._tileSize.height/cc.director._contentScaleFactor,r=n-k,s=p-m,u=cc.winSize.width,t=cc.winSize.height,w=e._layerSize.height,v=e._layerSize.width,x=e._texGrids,A=e._spriteTiles,y=this._worldTransform,z=y.a,B=y.b,D=y.c,C=y.d,G=y.tx,y=y.ty,F=-e._contentSize.width*
e._anchorPoint.x,E=-e._contentSize.height*e._anchorPoint.y,J=F*z+E*D+G,F=F*B+E*C+y,E=e._opacity,K=this._displayedColor.r,I=this._displayedColor.g,M=this._displayedColor.b;if(e._opacityModifyRGB)var H=E/255,K=K*H,I=I*H,M=M*H;this._color[0]=E<<24|M<<16|I<<8|K;var L=E=0,K=v,I=w;f||g!==cc.TMX_ORIENTATION_ORTHO||(E=Math.floor(-(J-r*z)/(k*z)),L=Math.floor((F-s*C+m*w*C-t)/(m*C)),K=Math.ceil((u-J+r*z)/(k*z)),I=w-Math.floor(-(F+s*C)/(m*C)),0>E&&(E=0),0>L&&(L=0),K>v&&(K=v),I>w&&(I=w));for(var N,r=d,s=L*v,Q,
P,O,M=cc.TMX_TILE_FLIPPED_MASK,U,R,T,W,H=n*z,V=p*C,S,ba,Y=z,Z=B,ca=D,da=C,ea=G,fa=y,ga=!1,$=!1,aa=!1,X=this._vertices;L<I;++L){for(N=E;N<K;++N)if(r+24>a.length&&(cc.renderer._increaseBatchingSize((r-d)/6),cc.renderer._batchRendering(),r=d=0),Q=s+N,!A[Q]&&(P=e.tiles[Q],O=x[(P&M)>>>0])){switch(g){case cc.TMX_ORIENTATION_ORTHO:R=N*k;T=(w-L-1)*m;Q=e._vertexZ+cc.renderer.assignedZStep*Q/h.length;break;case cc.TMX_ORIENTATION_ISO:R=k/2*(v+N-L-1);T=m/2*(2*w-N-L-2);Q=e._vertexZ+cc.renderer.assignedZStep*
(e.height-T)/e.height;break;case cc.TMX_ORIENTATION_HEX:R=N*k*3/4,T=(w-L-1)*m+(1===N%2?-m/2:0),Q=e._vertexZ+cc.renderer.assignedZStep*(e.height-T)/e.height}W=R+n;U=T+p;if(!f&&g===cc.TMX_ORIENTATION_ISO){S=F+T*C;if(S>t+V){N+=Math.floor(2*(S-t)/V)-1;continue}S=J+W*z;if(S<-H){N+=Math.floor(2*-S/H)-1;continue}ba=J+R*z;S=F+U*C;if(ba>u||0>S){N=K;continue}}P>cc.TMX_TILE_DIAGONAL_FLAG&&(ga=!0,$=(P&cc.TMX_TILE_HORIZONTAL_FLAG)>>>0,aa=(P&cc.TMX_TILE_VERTICAL_FLAG)>>>0);X[0].x=R*Y+U*ca+ea;X[0].y=R*Z+U*da+fa;
X[1].x=R*Y+T*ca+ea;X[1].y=R*Z+T*da+fa;X[2].x=W*Y+U*ca+ea;X[2].y=W*Z+U*da+fa;X[3].x=W*Y+T*ca+ea;X[3].y=W*Z+T*da+fa;for(P=0;4>P;++P){a[r]=X[P].x;a[r+1]=X[P].y;a[r+2]=Q;c[r+3]=this._color[0];switch(P){case 0:a[r+4]=$?O.r:O.l;a[r+5]=aa?O.b:O.t;break;case 1:a[r+4]=$?O.r:O.l;a[r+5]=aa?O.t:O.b;break;case 2:a[r+4]=$?O.l:O.r;a[r+5]=aa?O.b:O.t;break;case 3:a[r+4]=$?O.l:O.r,a[r+5]=aa?O.t:O.b}r+=6}ga&&(Y=z,Z=B,ca=D,da=C,ea=G,fa=y,ga=aa=$=!1)}s+=v}return(r-d)/6}})();cc.PointObject=cc.Class.extend({_ratio:null,_offset:null,_child:null,ctor:function(a,b){this.initWithCCPoint(a,b)},getRatio:function(){return this._ratio},setRatio:function(a){this._ratio=a},getOffset:function(){return this._offset},setOffset:function(a){this._offset=a},getChild:function(){return this._child},setChild:function(a){this._child=a},initWithCCPoint:function(a,b){this._ratio=a;this._offset=b;this._child=null;return!0}});cc.PointObject.create=function(a,b){return new cc.PointObject(a,b)};
cc.ParallaxNode=cc.Node.extend({parallaxArray:null,_lastPosition:null,_className:"ParallaxNode",getParallaxArray:function(){return this.parallaxArray},setParallaxArray:function(a){this.parallaxArray=a},ctor:function(){cc.Node.prototype.ctor.call(this);this.parallaxArray=[];this._lastPosition=cc.p(-100,-100)},addChild:function(a,b,c,d){if(3===arguments.length)cc.log("ParallaxNode: use addChild(child, z, ratio, offset) instead");else{if(!a)throw Error("cc.ParallaxNode.addChild(): child should be non-null");
var e=new cc.PointObject(c,d);e.setChild(a);this.parallaxArray.push(e);a.setPosition(this._position.x*c.x+d.x,this._position.y*c.y+d.y);cc.Node.prototype.addChild.call(this,a,b,a.tag)}},removeChild:function(a,b){for(var c=this.parallaxArray,d=0;d<c.length;d++)if(c[d].getChild()===a){c.splice(d,1);break}cc.Node.prototype.removeChild.call(this,a,b)},removeAllChildren:function(a){this.parallaxArray.length=0;cc.Node.prototype.removeAllChildren.call(this,a)},_updateParallaxPosition:function(){var a=this._absolutePosition();
if(!cc.pointEqualToPoint(a,this._lastPosition)){for(var b=this.parallaxArray,c=0,d=b.length;c<d;c++){var e=b[c];e.getChild().setPosition(-a.x+a.x*e.getRatio().x+e.getOffset().x,-a.y+a.y*e.getRatio().y+e.getOffset().y)}this._lastPosition=a}},_absolutePosition:function(){for(var a=this._position,b=this;null!==b.parent;)b=b.parent,a=cc.pAdd(a,b.getPosition());return a},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ParallaxNode.CanvasRenderCmd(this):new cc.ParallaxNode.WebGLRenderCmd(this)}});
cc.ParallaxNode.create=function(){return new cc.ParallaxNode};(function(){cc.ParallaxNode.CanvasRenderCmd=function(a){this._rootCtor(a);this._needDraw=!1};var a=cc.ParallaxNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);a.constructor=cc.ParallaxNode.CanvasRenderCmd;a.updateStatus=function(){this._node._updateParallaxPosition();this.originUpdateStatus()};a._syncStatus=function(a){this._node._updateParallaxPosition();this._originSyncStatus(a)}})();
cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){cc.ParallaxNode.WebGLRenderCmd=function(a){this._rootCtor(a);this._needDraw=!1};var a=cc.ParallaxNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);a.constructor=cc.ParallaxNode.WebGLRenderCmd;a.updateStatus=function(){this._node._updateParallaxPosition();this.originUpdateStatus()};a._syncStatus=function(a){this._node._updateParallaxPosition();this._originSyncStatus(a)}}});(function(){var a=cc.sys,b={ONLY_ONE:!1,WEB_AUDIO:!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),DELAY_CREATE_CTX:!1,ONE_SOURCE:!1};a.browserType===a.BROWSER_TYPE_FIREFOX&&(b.DELAY_CREATE_CTX=!0,b.USE_LOADER_EVENT="canplay");a.os===a.OS_IOS&&(b.USE_LOADER_EVENT="loadedmetadata");a.os===a.OS_ANDROID&&a.browserType===a.BROWSER_TYPE_UC&&(b.ONE_SOURCE=!0);window.__audioSupport=b})();
cc.Audio=cc.Class.extend({interruptPlay:!1,src:null,_element:null,_AUDIO_TYPE:"AUDIO",ctor:function(a){this.src=a},setBuffer:function(a){this._AUDIO_TYPE="WEBAUDIO";this._element=new cc.Audio.WebAudio(a)},setElement:function(a){this._AUDIO_TYPE="AUDIO";this._element=a;a.addEventListener("ended",function(){a.loop||(a.paused=!0)})},play:function(a,b){this._element?(this._element.loop=b,this._element.play(),"AUDIO"===this._AUDIO_TYPE&&this._element.paused&&!window.wx&&(this.stop(),cc.Audio.touchPlayList.push({loop:b,
offset:a,audio:this._element})),!1===cc.Audio.bindTouch&&(cc.Audio.bindTouch=!0,cc.game.canvas.addEventListener("touchstart",cc.Audio.touchStart))):this.interruptPlay=!1},getPlaying:function(){return this._element?!this._element.paused:!0},stop:function(){if(this._element){this._element.pause();try{this._element.currentTime=0}catch(a){}}else this.interruptPlay=!0},pause:function(){this._element?this._element.pause():this.interruptPlay=!0},resume:function(){this._element?this._element.play():this.interruptPlay=
!1},setVolume:function(a){this._element&&(this._element.volume=a)},getVolume:function(){if(this._element)return this._element.volume},cloneNode:function(){var a=new cc.Audio(this.src);if("AUDIO"===this._AUDIO_TYPE){var b=document.createElement("audio");if(window.wx)b.src=this.src;else for(var c=b.getElementsByTagName("source"),d=0;d<c.length;d++)b.appendChild(c[d]);a.setElement(b)}else a.setBuffer(this._element.buffer);return a}});cc.Audio.touchPlayList=[];cc.Audio.bindTouch=!1;
cc.Audio.touchStart=function(){for(var a=cc.Audio.touchPlayList,b=null;b=a.pop();)b.audio.loop=!!b.loop,b.audio.play(b.offset)};cc.Audio.WebAudio=function(a){this.buffer=a;this.context=cc.Audio._context;a=this.context.createGain();a.gain.value=1;a.connect(this.context.destination);this._volume=a;this._loop=!1;this._startTime=-1;this._currentSource=null;this.playedLength=0;this._currextTimer=null};
cc.Audio.WebAudio.prototype={constructor:cc.Audio.WebAudio,get paused(){return this._currentSource&&this._currentSource.loop?!1:-1===this._startTime?!0:this.context.currentTime-this._startTime>this.buffer.duration},set paused(a){},get loop(){return this._loop},set loop(a){return this._loop=a},get volume(){return this._volume.gain.value},set volume(a){return this._volume.gain.value=a},get currentTime(){return this.playedLength},set currentTime(a){return this.playedLength=a},play:function(a){this._currentSource&&
!this.paused&&(this._currentSource.stop(0),this.playedLength=0);var b=this.context.createBufferSource();b.buffer=this.buffer;b.connect(this._volume);b.loop=this._loop;this._startTime=this.context.currentTime;a=a||this.playedLength;var c=this.buffer.duration;this._loop?b.start?b.start(0):b.notoGrainOn?b.noteGrainOn(0):b.noteOn(0):b.start?b.start(0,a,c-a):b.notoGrainOn?b.noteGrainOn(0,a,c-a):b.noteOn(0,a,c-a);this._currentSource=b;if(0===this.context.currentTime){var d=this;clearTimeout(this._currextTimer);
this._currextTimer=setTimeout(function(){0===d.context.currentTime&&cc.Audio.touchPlayList.push({offset:a,audio:d})},10)}},pause:function(){this.playedLength=this.context.currentTime-this._startTime;this.playedLength%=this.buffer.duration;var a=this._currentSource;this._currentSource=null;this._startTime=-1;a&&a.stop(0)}};
(function(a){var b=a.WEB_AUDIO,c=a.ONLY_ONE,d=[];(function(){var a=document.createElement("audio");if(a.canPlayType){var b=a.canPlayType('audio/ogg; codecs\x3d"vorbis"');b&&""!==b&&d.push(".ogg");(b=a.canPlayType("audio/mpeg"))&&""!==b&&d.push(".mp3");(b=a.canPlayType('audio/wav; codecs\x3d"1"'))&&""!==b&&d.push(".wav");(b=a.canPlayType("audio/mp4"))&&""!==b&&d.push(".mp4");(a=a.canPlayType("audio/x-m4a"))&&""!==a&&d.push(".m4a")}})();try{if(b){var e=new (window.AudioContext||window.webkitAudioContext||
window.mozAudioContext);cc.Audio._context=e;if(!(e.createBufferSource&&e.createGain&&e.destination&&e.decodeAudioData))throw"context is incomplete";a.DELAY_CREATE_CTX&&setTimeout(function(){e=new (window.AudioContext||window.webkitAudioContext||window.mozAudioContext);cc.Audio._context=e},0)}}catch(f){b=!1,cc.log("browser don't support web audio")}var g={cache:{},useWebAudio:!0,loadBuffer:function(a,c){if(b){var d=cc.loader.getXMLHttpRequest();d.open("GET",a,!0);d.responseType="arraybuffer";d.onload=
function(){0<=d._timeoutId&&clearTimeout(d._timeoutId);e.decodeAudioData(d.response,function(a){c(null,a)},function(){c("decode error - "+a)})};d.onerror=function(){c("request error - "+a)};void 0===d.ontimeout&&(d._timeoutId=setTimeout(function(){d.ontimeout()},d.timeout));d.ontimeout=function(){c("request timeout - "+a)};d.send()}},load:function(a,b,c,e){if(0===d.length)return e("can not support audio!");var f=cc.loader.getRes(b);if(f)return e(null,f);cc.loader.audioPath&&(a=cc.path.join(cc.loader.audioPath,
a));f=cc.path.extname(a);c=[f];for(var g=0;g<d.length;g++)f!==d[g]&&c.push(d[g]);f=new cc.Audio(a);cc.loader.cache[b]=f;this.loadAudioFromExtList(a,c,f,e);return f},loadAudioFromExtList:function(c,e,f,g){c=window.remoteResPath+c;if(0===e.length){var p="can not found the resource of audio! Last match url is : ",p=p+c.replace(/\.(.*)?$/,"(");d.forEach(function(a){p+=a+"|"});p=p.replace(/\|$/,")");return g({status:520,errorMessage:p},null)}if(b&&this.useWebAudio)this.loadBuffer(c,function(a,b){a&&cc.log(a);
b&&f.setBuffer(b);g(null,f)});else{var r=a.ONE_SOURCE?1:e.length,s=document.createElement("audio");if(window.wx)s.src=cc.path.changeExtname(c,e[0]);else for(var u=0;u<r;u++){var t=document.createElement("source");t.src=cc.path.changeExtname(c,e[u]);s.appendChild(t)}f.setElement(s);var w=setTimeout(function(){0===s.readyState?(console.log("loadAudioFromExtList timeout 8000"),x()):v()},8E3),v=function(){s.removeEventListener("canplaythrough",v,!1);s.removeEventListener("error",x,!1);s.removeEventListener("emptied",
v,!1);a.USE_LOADER_EVENT&&s.removeEventListener(a.USE_LOADER_EVENT,v,!1);clearTimeout(w);g(null,f)},x=function(){cc.log("load audio failure - "+c);v()};s.addEventListener("canplaythrough",v,!1);s.addEventListener("error",x,!1);a.USE_LOADER_EVENT&&s.addEventListener(a.USE_LOADER_EVENT,v,!1)}}};cc.loader.register(["mp3","ogg","wav","mp4","m4a"],g);cc.audioEngine={_currMusic:null,_musicVolume:1,features:a,willPlayMusic:function(){return!1},playMusic:function(a,b){var c=this._currMusic;c&&c.getPlaying()&&
c.stop();var d=this._musicVolume,e=cc.loader.getRes(a);e||(cc.loader.load(a,function(){e.getPlaying()||e.interruptPlay||(e.setVolume(d),e.play(0,b||!1))}),e=cc.loader.getRes(a));e.setVolume(d);e.play(0,b||!1);this._currMusic=e},stopMusic:function(a){var b=this._currMusic;if(b){for(var c=cc.Audio.touchPlayList,d=c.length-1;0<=d;--d)this[d]&&this[d].audio===b._element&&c.splice(d,1);b.stop();this._currMusic=null;a&&cc.loader.release(b.src)}},pauseMusic:function(){var a=this._currMusic;a&&a.pause()},
resumeMusic:function(){var a=this._currMusic;a&&a.resume()},preLoadEffect:function(a){var c=cc.loader.getRes(a);c&&b&&"AUDIO"===c._AUDIO_TYPE&&(cc.loader.release(a),c=null);var d=this._audioPool[a];d||(d=this._audioPool[a]=[]);if(c)if(b&&"AUDIO"===c._AUDIO_TYPE)g.loadBuffer(a,function(a,b){c.setBuffer(b);c.setVolume(cc.audioEngine._effectVolume)});else{c=c.cloneNode();c.setVolume(this._effectVolume);d.push(c);return}cc.loader.load(a,function(b){b=cc.loader.getRes(a);b=b.cloneNode();b.setVolume(cc.audioEngine._effectVolume);
d.push(b)})},rewindMusic:function(){var a=this._currMusic;a&&(a.stop(),a.play())},getMusicVolume:function(){return this._musicVolume},setMusicVolume:function(a){a-=0;isNaN(a)&&(a=1);1<a&&(a=1);0>a&&(a=0);this._musicVolume=a;var b=this._currMusic;b&&b.setVolume(a)},isMusicPlaying:function(){var a=this._currMusic;return a?a.getPlaying():!1},_audioPool:{},_maxAudioInstance:10,_effectVolume:1,playEffect:function(a,d){if(window.wx){var e=cc.loader.getRes(a);e||(cc.loader.load(a,function(){e.setVolume(cc.audioEngine._effectVolume);
e.play(0,d||!1)}),e=cc.loader.getRes(a));e.setVolume(cc.audioEngine._effectVolume);e.play(0,d||!1)}else{if(c&&this._currMusic&&this._currMusic.getPlaying())return cc.log("Browser is only allowed to play one audio"),null;var f=this._audioPool[a];f||(f=this._audioPool[a]=[]);for(var p=0;p<f.length&&f[p].getPlaying();p++);!b&&p>this._maxAudioInstance&&(p=f.shift(),p.stop(),f.push(p),p=f.length-1);if(f[p])return e=f[p],e.setVolume(this._effectVolume),e.play(0,d||!1),e;(e=cc.loader.getRes(a))&&b&&"AUDIO"===
e._AUDIO_TYPE&&(cc.loader.release(a),e=null);if(e)if(b&&"AUDIO"===e._AUDIO_TYPE)g.loadBuffer(a,function(a,b){e.setBuffer(b);e.setVolume(cc.audioEngine._effectVolume);e.getPlaying()||e.play(0,d||!1)});else return e=e.cloneNode(),e.setVolume(this._effectVolume),e.play(0,d||!1),f.push(e),e;p=g.useWebAudio;g.useWebAudio=!0;cc.loader.load(a,function(b){b=cc.loader.getRes(a);b=b.cloneNode();b.setVolume(cc.audioEngine._effectVolume);b.play(0,d||!1);f.push(b)});g.useWebAudio=p;return e}},setEffectsVolume:function(a){a-=
0;isNaN(a)&&(a=1);1<a&&(a=1);0>a&&(a=0);this._effectVolume=a;var b=this._audioPool,c;for(c in b){var d=b[c];if(Array.isArray(d))for(var e=0;e<d.length;e++)d[e].setVolume(a)}},getEffectsVolume:function(){return this._effectVolume},pauseEffect:function(a){a&&a.pause()},pauseAllEffects:function(){var a=this._audioPool,b;for(b in a)for(var c=a[b],d=0;d<a[b].length;d++)c[d].getPlaying()&&c[d].pause()},resumeEffect:function(a){a&&a.resume()},resumeAllEffects:function(){var a=this._audioPool,b;for(b in a)for(var c=
a[b],d=0;d<a[b].length;d++)c[d].resume()},stopEffect:function(a){a&&a.stop()},stopAllEffects:function(){var a=this._audioPool,b;for(b in a){for(var c=a[b],d=0;d<c.length;d++)c[d].stop();c.length=0}a.length=0},unloadEffect:function(a){if(a){cc.loader.release(a);var b=this._audioPool[a];if(b){for(var c=0;c<b.length;c++)b[c].stop();b.length=0}delete this._audioPool[a]}},end:function(){this.stopMusic();this.stopAllEffects()},_pauseCache:[],_pausePlaying:function(){var a=this._currMusic;a&&a.getPlaying()&&
(a.pause(),this._pauseCache.push(a));var a=this._audioPool,b;for(b in a)for(var c=a[b],d=0;d<a[b].length;d++)c[d].getPlaying()&&(c[d].pause(),this._pauseCache.push(c[d]))},_resumePlaying:function(){for(var a=this._pauseCache,b=0;b<a.length;b++)a[b].resume();a.length=0}}})(window.__audioSupport);cc.ProtectedNode=cc.Node.extend({_protectedChildren:null,_reorderProtectedChildDirty:!1,_insertProtectedChild:function(a,b){this._reorderProtectedChildDirty=!0;this._protectedChildren.push(a);a._setLocalZOrder(b)},ctor:function(){cc.Node.prototype.ctor.call(this);this._protectedChildren=[]},visit:function(a){var b=this._renderCmd,c=a?a._renderCmd:null;if(this._visible){a=cc.renderer;var d=this._children,e=d.length,f,g=this._protectedChildren,h=g.length,k;b.visit(c);var m=this.grid;m&&m._active&&m.beforeDraw();
this._reorderChildDirty&&this.sortAllChildren();this._reorderProtectedChildDirty&&this.sortAllProtectedChildren();for(c=0;c<e;c++)if(f=d[c],0>f._localZOrder)f.visit(this);else break;for(f=0;f<h;f++)if((k=g[f])&&0>k._localZOrder)b._changeProtectedChild(k),k.visit(this);else break;for(a.pushRenderCommand(b);c<e;c++)d[c].visit(this);for(;f<h;f++)if(k=g[f])b._changeProtectedChild(k),k.visit(this);m&&m._active&&m.afterDraw(this);b._dirtyFlag=0}else b._propagateFlagsDown(c)},addProtectedChild:function(a,
b,c){cc.assert(null!=a,"child must be non-nil");cc.assert(!a.parent,"child already added. It can't be added again");b=b||a.getLocalZOrder();c&&a.setTag(c);this._insertProtectedChild(a,b);a.setParent(this);a.setOrderOfArrival(cc.s_globalOrderOfArrival);this._running&&(a._performRecursive(cc.Node._stateCallbackType.onEnter),this._isTransitionFinished&&a._performRecursive(cc.Node._stateCallbackType.onEnterTransitionDidFinish));this._cascadeColorEnabled&&this._renderCmd.setCascadeColorEnabledDirty();
this._cascadeOpacityEnabled&&this._renderCmd.setCascadeOpacityEnabledDirty()},getProtectedChildByTag:function(a){cc.assert(a!==cc.NODE_TAG_INVALID,"Invalid tag");for(var b=this._protectedChildren,c=0,d=b.length;c<d;c++)if(b.getTag()===a)return b[c];return null},removeProtectedChild:function(a,b){null==b&&(b=!0);var c=this._protectedChildren;if(0!==c.length){var d=c.indexOf(a);-1<d&&(this._running&&(a._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),a._performRecursive(cc.Node._stateCallbackType.onExit)),
b&&a._performRecursive(cc.Node._stateCallbackType.cleanup),a.setParent(null),c.splice(d,1))}},removeProtectedChildByTag:function(a,b){cc.assert(a!==cc.NODE_TAG_INVALID,"Invalid tag");null==b&&(b=!0);var c=this.getProtectedChildByTag(a);null==c?cc.log("cocos2d: removeChildByTag(tag \x3d %d): child not found!",a):this.removeProtectedChild(c,b)},removeAllProtectedChildren:function(){this.removeAllProtectedChildrenWithCleanup(!0)},removeAllProtectedChildrenWithCleanup:function(a){null==a&&(a=!0);for(var b=
this._protectedChildren,c=0,d=b.length;c<d;c++){var e=b[c];this._running&&(e._performRecursive(cc.Node._stateCallbackType.onExitTransitionDidStart),e._performRecursive(cc.Node._stateCallbackType.onExit));a&&e._performRecursive(cc.Node._stateCallbackType.cleanup);e.setParent(null)}b.length=0},reorderProtectedChild:function(a,b){cc.assert(null!=a,"Child must be non-nil");this._reorderProtectedChildDirty=!0;a.setOrderOfArrival(cc.s_globalOrderOfArrival++);a._setLocalZOrder(b)},sortAllProtectedChildren:function(){if(this._reorderProtectedChildDirty){var a=
this._protectedChildren,b,c,d=a.length,e;for(b=1;b<d;b++){e=a[b];for(c=b-1;0<=c;){if(e._localZOrder<a[c]._localZOrder)a[c+1]=a[c];else if(e._localZOrder===a[c]._localZOrder&&e.arrivalOrder<a[c].arrivalOrder)a[c+1]=a[c];else break;c--}a[c+1]=e}this._reorderProtectedChildDirty=!1}},_changePosition:function(){},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ProtectedNode.CanvasRenderCmd(this):new cc.ProtectedNode.WebGLRenderCmd(this)}});
cc.ProtectedNode.create=function(){return new cc.ProtectedNode};(function(){cc.ProtectedNode.RenderCmd={_updateDisplayColor:function(a){var c=this._node,d=this._displayedColor,e=c._realColor,f,g;if(this._cascadeColorEnabledDirty&&!c._cascadeColorEnabled){d.r=e.r;d.g=e.g;d.b=e.b;d=new cc.Color(255,255,255,255);f=c._children;e=0;for(a=f.length;e<a;e++)(g=f[e])&&g._renderCmd&&g._renderCmd._updateDisplayColor(d);this._cascadeColorEnabledDirty=!1}else{void 0===a&&(a=(a=c._parent)&&a._cascadeColorEnabled?a.getDisplayedColor():cc.color.WHITE);d.r=0|e.r*a.r/255;d.g=0|
e.g*a.g/255;d.b=0|e.b*a.b/255;if(c._cascadeColorEnabled)for(f=c._children,e=0,a=f.length;e<a;e++)(g=f[e])&&g._renderCmd&&(g._renderCmd._updateDisplayColor(d),g._renderCmd._updateColor());f=c._protectedChildren;e=0;for(a=f.length;e<a;e++)(g=f[e])&&g._renderCmd&&(g._renderCmd._updateDisplayColor(d),g._renderCmd._updateColor())}this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.colorDirty},_updateDisplayOpacity:function(a){var c=this._node,d,e,f;if(this._cascadeOpacityEnabledDirty&&!c._cascadeOpacityEnabled){this._displayedOpacity=
c._realOpacity;e=c._children;a=0;for(d=e.length;a<d;a++)(f=e[a])&&f._renderCmd&&f._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else{void 0===a&&(d=c._parent,a=255,d&&d._cascadeOpacityEnabled&&(a=d.getDisplayedOpacity()));this._displayedOpacity=c._realOpacity*a/255;if(c._cascadeOpacityEnabled)for(e=c._children,a=0,d=e.length;a<d;a++)(f=e[a])&&f._renderCmd&&(f._renderCmd._updateDisplayOpacity(this._displayedOpacity),f._renderCmd._updateColor());e=c._protectedChildren;a=
0;for(d=e.length;a<d;a++)(f=e[a])&&f._renderCmd&&(f._renderCmd._updateDisplayOpacity(this._displayedOpacity),f._renderCmd._updateColor())}this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.opacityDirty},_changeProtectedChild:function(a){a=a._renderCmd;var c=a._dirtyFlag,d=cc.Node._dirtyFlags;this._dirtyFlag&d.colorDirty&&(c|=d.colorDirty);this._dirtyFlag&d.opacityDirty&&(c|=d.opacityDirty);var e=c&d.colorDirty,c=c&d.opacityDirty;e&&a._updateDisplayColor(this._displayedColor);c&&a._updateDisplayOpacity(this._displayedOpacity);
(e||c)&&a._updateColor()}};cc.ProtectedNode.CanvasRenderCmd=function(a){this._rootCtor(a);this._cachedParent=null;this._cacheDirty=!1};var a=cc.ProtectedNode.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);cc.inject(cc.ProtectedNode.RenderCmd,a);a.constructor=cc.ProtectedNode.CanvasRenderCmd;a._pNodeCmdCtor=cc.ProtectedNode.CanvasRenderCmd;a.transform=function(a,c){var d=this._node;d._changePosition&&d._changePosition();this.originTransform(a,c);var e,f=d._protectedChildren;
if(c&&f&&0!==f.length)for(d=0,e=f.length;d<e;d++)f[d]._renderCmd.transform(this,c)};a.pNodeTransform=a.transform})();(function(){if(cc.Node.WebGLRenderCmd){cc.ProtectedNode.WebGLRenderCmd=function(a){this._rootCtor(a)};var a=cc.ProtectedNode.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.inject(cc.ProtectedNode.RenderCmd,a);a.constructor=cc.ProtectedNode.WebGLRenderCmd;a._pNodeCmdCtor=cc.ProtectedNode.WebGLRenderCmd;a.transform=function(a,c){this.originTransform(a,c);var d,e,f=this._node._protectedChildren;if(c&&f&&0!==f.length)for(d=0,e=f.length;d<e;d++)f[d]._renderCmd.transform(this,
c)};a.pNodeTransform=a.transform}})();var ccui=ccui||{};window.ccui=ccui;ccui.Class=ccui.Class||cc.Class;ccui.Class.extend=ccui.Class.extend||cc.Class.extend;ccui.Node=ccui.Node||cc.Node;ccui.Node.extend=ccui.Node.extend||cc.Node.extend;ccui.ProtectedNode=ccui.ProtectedNode||cc.ProtectedNode;ccui.ProtectedNode.extend=ccui.ProtectedNode.extend||cc.ProtectedNode.extend;ccui.cocosGUIVersion="CocosGUI v1.0.0.0";ccui._FocusNavigationController=cc.Class.extend({_keyboardListener:null,_firstFocusedWidget:null,_enableFocusNavigation:!1,_keyboardEventPriority:1,enableFocusNavigation:function(a){this._enableFocusNavigation!==a&&((this._enableFocusNavigation=a)?this._addKeyboardEventListener():this._removeKeyboardEventListener())},_setFirstFocsuedWidget:function(a){this._firstFocusedWidget=a},_onKeyPressed:function(a,b){this._enableFocusNavigation&&this._firstFocusedWidget&&(a===cc.KEY.dpadDown&&(this._firstFocusedWidget=
this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.DOWN,this._firstFocusedWidget)),a===cc.KEY.dpadUp&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.UP,this._firstFocusedWidget)),a===cc.KEY.dpadLeft&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.LEFT,this._firstFocusedWidget)),a===cc.KEY.dpadRight&&(this._firstFocusedWidget=this._firstFocusedWidget.findNextFocusedWidget(ccui.Widget.RIGHT,this._firstFocusedWidget)))},
_addKeyboardEventListener:function(){this._keyboardListener||(this._keyboardListener=cc.EventListener.create({event:cc.EventListener.KEYBOARD,onKeyReleased:this._onKeyPressed.bind(this)}),cc.eventManager.addListener(this._keyboardListener,this._keyboardEventPriority))},_removeKeyboardEventListener:function(){this._keyboardListener&&(cc.eventManager.removeEventListener(this._keyboardListener),this._keyboardListener=null)}});ccui.__LAYOUT_COMPONENT_NAME="__ui_layout";
ccui.Widget=ccui.ProtectedNode.extend({_enabled:!0,_bright:!0,_touchEnabled:!1,_brightStyle:null,_touchBeganPosition:null,_touchMovePosition:null,_touchEndPosition:null,_touchEventListener:null,_touchEventSelector:null,_name:"default",_widgetType:null,_actionTag:0,_customSize:null,_layoutParameterDictionary:null,_layoutParameterType:0,_focused:!1,_focusEnabled:!0,_ignoreSize:!1,_affectByClipping:!1,_sizeType:null,_sizePercent:null,_positionType:null,_positionPercent:null,_hit:!1,_nodes:null,_touchListener:null,
_className:"Widget",_flippedX:!1,_flippedY:!1,_opacity:255,_highlight:!1,_touchEventCallback:null,_clickEventListener:null,_propagateTouchEvents:!0,_unifySize:!1,_callbackName:null,_callbackType:null,_usingLayoutComponent:!1,_inViewRect:!0,ctor:function(){cc.ProtectedNode.prototype.ctor.call(this);this._brightStyle=ccui.Widget.BRIGHT_STYLE_NONE;this._touchBeganPosition=cc.p(0,0);this._touchMovePosition=cc.p(0,0);this._touchEndPosition=cc.p(0,0);this._widgetType=ccui.Widget.TYPE_WIDGET;this._customSize=
cc.size(0,0);this._layoutParameterDictionary={};this._sizeType=ccui.Widget.SIZE_ABSOLUTE;this._sizePercent=cc.p(0,0);this._positionType=ccui.Widget.POSITION_ABSOLUTE;this._positionPercent=cc.p(0,0);this._nodes=[];this._layoutParameterType=ccui.LayoutParameter.NONE;ccui.Widget.prototype.init.call(this)},init:function(){this._layoutParameterDictionary={};this._initRenderer();this.setBright(!0);this.onFocusChanged=this.onFocusChange;this.onNextFocusedWidget=null;this.setAnchorPoint(cc.p(0.5,0.5));this.ignoreContentAdaptWithSize(!0);
return!0},onEnter:function(){var a=this._touchListener;a&&!a._isRegistered()&&this._touchEnabled&&cc.eventManager.addListener(a,this);this._usingLayoutComponent||this.updateSizeAndPosition();this._sizeDirty&&this._onSizeChanged();cc.ProtectedNode.prototype.onEnter.call(this)},onExit:function(){this.unscheduleUpdate();cc.ProtectedNode.prototype.onExit.call(this)},_getOrCreateLayoutComponent:function(){var a=this.getComponent(ccui.__LAYOUT_COMPONENT_NAME);null==a&&(a=new ccui.LayoutComponent,this.addComponent(a));
return a},getWidgetParent:function(){var a=this.getParent();return a instanceof ccui.Widget?a:null},_updateContentSizeWithTextureSize:function(a){this._unifySize?this.setContentSize(a):this.setContentSize(this._ignoreSize?a:this._customSize)},_isAncestorsEnabled:function(){var a=this._getAncensterWidget(this);return null==a?!0:a&&!a.isEnabled()?!1:a._isAncestorsEnabled()},setPropagateTouchEvents:function(a){this._propagateTouchEvents=a},isPropagateTouchEvents:function(){return this._propagateTouchEvents},
setSwallowTouches:function(a){this._touchListener&&this._touchListener.setSwallowTouches(a)},isSwallowTouches:function(){return this._touchListener?this._touchListener.isSwallowTouches():!1},_getAncensterWidget:function(a){if(null==a)return null;a=a.getParent();return null==a?null:a instanceof ccui.Widget?a:this._getAncensterWidget(a.getParent())},_isAncestorsVisible:function(a){return null==a?!0:(a=a.getParent())&&!a.isVisible()?!1:this._isAncestorsVisible(a)},setEnabled:function(a){this._enabled=
a;this.setBright(a)},_initRenderer:function(){},setContentSize:function(a,b){cc.Node.prototype.setContentSize.call(this,a,b);var c=this._contentSize.width,d=this._contentSize.height;this._customSize.width=c;this._customSize.height=d;!this._unifySize&&this._ignoreSize&&(this._contentSize=this.getVirtualRendererSize());if(!this._usingLayoutComponent&&this._running){var e=this.getWidgetParent(),e=e?e.getContentSize():this._parent.getContentSize();this._sizePercent.x=0<e.width?c/e.width:0;this._sizePercent.y=
0<e.height?d/e.height:0}this._running?this._onSizeChanged():this._sizeDirty=!0},_setWidth:function(a){a!==this._contentSize.width&&(cc.Node.prototype._setWidth.call(this,a),this._customSize.width=a,!this._unifySize&&this._ignoreSize&&(this._contentSize=this.getVirtualRendererSize()),!this._usingLayoutComponent&&this._running&&(a=(a=this.getWidgetParent())?a.width:this._parent.width,this._sizePercent.x=0<a?this._customSize.width/a:0),this._running?this._onSizeChanged():this._sizeDirty=!0)},_setHeight:function(a){a!==
this._contentSize.height&&(cc.Node.prototype._setHeight.call(this,a),this._customSize.height=a,!this._unifySize&&this._ignoreSize&&(this._contentSize=this.getVirtualRendererSize()),!this._usingLayoutComponent&&this._running&&(a=(a=this.getWidgetParent())?a.height:this._parent.height,this._sizePercent.y=0<a?this._customSize.height/a:0),this._running?this._onSizeChanged():this._sizeDirty=!0)},setSizePercent:function(a){if(this._usingLayoutComponent){var b=this._getOrCreateLayoutComponent();b.setUsingPercentContentSize(!0);
b.setPercentContentSize(a);b.refreshLayout()}else{this._sizePercent.x=a.x;this._sizePercent.y=a.y;var b=this._customSize.width,c=this._customSize.height;this._running&&((c=this.getWidgetParent())?(b=c.width*a.x,c=c.height*a.y):(b=this._parent.width*a.x,c=this._parent.height*a.y));this._ignoreSize?this.setContentSize(this.getVirtualRendererSize()):this.setContentSize(b,c);this._customSize.width=b;this._customSize.height=c}},_setWidthPercent:function(a){this._sizePercent.x=a;var b=this._customSize.width;
this._running&&(b=this.getWidgetParent(),b=(b?b.width:this._parent.width)*a);this._ignoreSize?this._setWidth(this.getVirtualRendererSize().width):this._setWidth(b);this._customSize.width=b},_setHeightPercent:function(a){this._sizePercent.y=a;var b=this._customSize.height;this._running&&(b=this.getWidgetParent(),b=(b?b.height:this._parent.height)*a);this._ignoreSize?this._setHeight(this.getVirtualRendererSize().height):this._setHeight(b);this._customSize.height=b},updateSizeAndPosition:function(a){a||
(a=(a=this.getWidgetParent())?a.getLayoutSize():this._parent.getContentSize());switch(this._sizeType){case ccui.Widget.SIZE_ABSOLUTE:this._ignoreSize?this.setContentSize(this.getVirtualRendererSize()):this.setContentSize(this._customSize);this._sizePercent.x=0<a.width?this._customSize.width/a.width:0;this._sizePercent.y=0<a.height?this._customSize.height/a.height:0;break;case ccui.Widget.SIZE_PERCENT:var b=cc.size(a.width*this._sizePercent.x,a.height*this._sizePercent.y);this._ignoreSize?this.setContentSize(this.getVirtualRendererSize()):
this.setContentSize(b);this._customSize.width=b.width;this._customSize.height=b.height}this._onSizeChanged();b=this.getPosition();switch(this._positionType){case ccui.Widget.POSITION_ABSOLUTE:0>=a.width||0>=a.height?this._positionPercent.x=this._positionPercent.y=0:(this._positionPercent.x=b.x/a.width,this._positionPercent.y=b.y/a.height);break;case ccui.Widget.POSITION_PERCENT:b=cc.p(a.width*this._positionPercent.x,a.height*this._positionPercent.y)}if(this._parent instanceof ccui.ImageView&&(a=this._parent._imageRenderer)&&
!a._textureLoaded)return;this.setPosition(b)},setSizeType:function(a){this._sizeType=a;this._usingLayoutComponent&&this._getOrCreateLayoutComponent().setUsingPercentContentSize(this._sizeType===ccui.SIZE_PERCENT)},getSizeType:function(){return this._sizeType},ignoreContentAdaptWithSize:function(a){this._unifySize?this.setContentSize(this._customSize):this._ignoreSize!==a&&(this._ignoreSize=a,this.setContentSize(a?this.getVirtualRendererSize():this._customSize))},isIgnoreContentAdaptWithSize:function(){return this._ignoreSize},
getCustomSize:function(){return cc.size(this._customSize)},getLayoutSize:function(){return cc.size(this._contentSize)},getSizePercent:function(){this._usingLayoutComponent&&(this._sizePercent=this._getOrCreateLayoutComponent().getPercentContentSize());return this._sizePercent},_getWidthPercent:function(){return this._sizePercent.x},_getHeightPercent:function(){return this._sizePercent.y},getWorldPosition:function(){return this.convertToWorldSpace(cc.p(this._anchorPoint.x*this._contentSize.width,this._anchorPoint.y*
this._contentSize.height))},getVirtualRenderer:function(){return this},getVirtualRendererSize:function(){return cc.size(this._contentSize)},_onSizeChanged:function(){if(!this._usingLayoutComponent){for(var a=this.getChildren(),b=0,c=a.length;b<c;b++){var d=a[b];d instanceof ccui.Widget&&d.updateSizeAndPosition()}this._sizeDirty=!1}},setTouchEnabled:function(a){this._touchEnabled!==a&&((this._touchEnabled=a)?(this._touchListener||(this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,
swallowTouches:!0,onTouchBegan:this.onTouchBegan.bind(this),onTouchMoved:this.onTouchMoved.bind(this),onTouchEnded:this.onTouchEnded.bind(this)})),cc.eventManager.addListener(this._touchListener,this)):cc.eventManager.removeListener(this._touchListener))},isTouchEnabled:function(){return this._touchEnabled},isHighlighted:function(){return this._highlight},setHighlighted:function(a){a!==this._highlight&&(this._highlight=a,this._bright?this._highlight?this.setBrightStyle(ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT):
this.setBrightStyle(ccui.Widget.BRIGHT_STYLE_NORMAL):this._onPressStateChangedToDisabled())},isFocused:function(){return this._focused},setFocused:function(a){if(this._focused=a)ccui.Widget._focusedWidget=this,ccui.Widget._focusNavigationController&&ccui.Widget._focusNavigationController._setFirstFocsuedWidget(this)},isFocusEnabled:function(){return this._focusEnabled},setFocusEnabled:function(a){this._focusEnabled=a},findNextFocusedWidget:function(a,b){if(null===this.onNextFocusedWidget||null==this.onNextFocusedWidget(a)){var c=
b instanceof ccui.Layout;if(this.isFocused()||c){var d=this.getParent();return null!==d&&d instanceof ccui.Layout?d.findNextFocusedWidget(a,b):c?b.findNextFocusedWidget(a,b):b}return b}c=this.onNextFocusedWidget(a);this.dispatchFocusEvent(this,c);return c},requestFocus:function(){this!==ccui.Widget._focusedWidget&&this.dispatchFocusEvent(ccui.Widget._focusedWidget,this)},getCurrentFocusedWidget:function(){return ccui.Widget._focusedWidget},onFocusChanged:null,onNextFocusedWidget:null,interceptTouchEvent:function(a,
b,c){var d=this.getWidgetParent();d&&d.interceptTouchEvent(a,b,c)},onFocusChange:function(a,b){a&&a.setFocused(!1);b&&b.setFocused(!0)},dispatchFocusEvent:function(a,b){a&&!a.isFocused()&&(a=ccui.Widget._focusedWidget);if(b!==a){if(b&&b.onFocusChanged)b.onFocusChanged(a,b);if(a&&b.onFocusChanged)a.onFocusChanged(a,b);cc.eventManager.dispatchEvent(new cc.EventFocus(a,b))}},setBright:function(a){(this._bright=a)?(this._brightStyle=ccui.Widget.BRIGHT_STYLE_NONE,this.setBrightStyle(ccui.Widget.BRIGHT_STYLE_NORMAL)):
this._onPressStateChangedToDisabled()},setBrightStyle:function(a){if(this._brightStyle!==a)switch(this._brightStyle=a=a||ccui.Widget.BRIGHT_STYLE_NORMAL,this._brightStyle){case ccui.Widget.BRIGHT_STYLE_NORMAL:this._onPressStateChangedToNormal();break;case ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT:this._onPressStateChangedToPressed()}},_onPressStateChangedToNormal:function(){},_onPressStateChangedToPressed:function(){},_onPressStateChangedToDisabled:function(){},_updateChildrenDisplayedRGBA:function(){this.setColor(this.getColor());
this.setOpacity(this.getOpacity())},didNotSelectSelf:function(){},onTouchBegan:function(a,b){this._hit=!1;if(this.isVisible()&&this.isEnabled()&&this._isAncestorsEnabled()&&this._isAncestorsVisible(this)){var c=a.getLocation();this._touchBeganPosition.x=c.x;this._touchBeganPosition.y=c.y;this.hitTest(this._touchBeganPosition)&&this.isClippingParentContainsPoint(this._touchBeganPosition)&&(this._hit=!0)}if(!this._hit)return!1;this.setHighlighted(!0);this._propagateTouchEvents&&this.propagateTouchEvent(ccui.Widget.TOUCH_BEGAN,
this,a);this._pushDownEvent();return!0},propagateTouchEvent:function(a,b,c){var d=this.getWidgetParent();d&&d.interceptTouchEvent(a,b,c)},onTouchMoved:function(a,b){var c=a.getLocation();this._touchMovePosition.x=c.x;this._touchMovePosition.y=c.y;this.setHighlighted(this.hitTest(c));this._propagateTouchEvents&&this.propagateTouchEvent(ccui.Widget.TOUCH_MOVED,this,a);this._moveEvent()},onTouchEnded:function(a,b){var c=a.getLocation();this._touchEndPosition.x=c.x;this._touchEndPosition.y=c.y;this._propagateTouchEvents&&
this.propagateTouchEvent(ccui.Widget.TOUCH_ENDED,this,a);c=this._highlight;this.setHighlighted(!1);c?this._releaseUpEvent():this._cancelUpEvent()},onTouchCancelled:function(a){this.setHighlighted(!1);this._cancelUpEvent()},onTouchLongClicked:function(a){this.longClickEvent()},_pushDownEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_BEGAN);this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_BEGAN)},
_moveEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_MOVED);this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_MOVED)},_releaseUpEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_ENDED);this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_ENDED);this._clickEventListener&&
this._clickEventListener(this)},_cancelUpEvent:function(){this._touchEventCallback&&this._touchEventCallback(this,ccui.Widget.TOUCH_CANCELED);this._touchEventListener&&this._touchEventSelector&&this._touchEventSelector.call(this._touchEventListener,this,ccui.Widget.TOUCH_CANCELED)},longClickEvent:function(){},addTouchEventListener:function(a,b){void 0===b?this._touchEventCallback=a:(this._touchEventSelector=a,this._touchEventListener=b)},addClickEventListener:function(a){this._clickEventListener=
a},hitTest:function(a){var b=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc.rectContainsPoint(b,this.convertToNodeSpace(a))},isClippingParentContainsPoint:function(a){this._affectByClipping=!1;for(var b=this.getParent(),c=null;b;){if(b instanceof ccui.Layout&&b.isClippingEnabled()){this._affectByClipping=!0;c=b;break}b=b.getParent()}return this._affectByClipping?c?c.hitTest(a)?c.isClippingParentContainsPoint(a):!1:!0:!0},checkChildInfo:function(a,b,c){var d=this.getWidgetParent();
d&&d.checkChildInfo(a,b,c)},setPosition:function(a,b){if(!this._usingLayoutComponent&&this._running){var c=this.getWidgetParent();c&&(c=c.getContentSize(),0>=c.width||0>=c.height?(this._positionPercent.x=0,this._positionPercent.y=0):void 0===b?(this._positionPercent.x=a.x/c.width,this._positionPercent.y=a.y/c.height):(this._positionPercent.x=a/c.width,this._positionPercent.y=b/c.height))}cc.Node.prototype.setPosition.call(this,a,b)},setPositionX:function(a){if(this._running){var b=this.getWidgetParent();
b&&(b=b.width,this._positionPercent.x=0>=b?0:a/b)}cc.Node.prototype.setPositionX.call(this,a)},setPositionY:function(a){if(this._running){var b=this.getWidgetParent();b&&(b=b.height,this._positionPercent.y=0>=b?0:a/b)}cc.Node.prototype.setPositionY.call(this,a)},setPositionPercent:function(a){if(this._usingLayoutComponent){var b=this._getOrCreateLayoutComponent();b.setPositionPercentX(a.x);b.setPositionPercentY(a.y);b.refreshLayout()}else this._setXPercent(a.x),this._setYPercent(a.y),this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},
_setXPercent:function(a){if(this._usingLayoutComponent){var b=this._getOrCreateLayoutComponent();b.setPositionPercentX(a.x);b.refreshLayout()}else this._positionPercent.x=a,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},_setYPercent:function(a){if(this._usingLayoutComponent){var b=this._getOrCreateLayoutComponent();b.setPositionPercentY(a.x);b.refreshLayout()}else this._positionPercent.y=a,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPositionPercent:function(){if(this._usingLayoutComponent){var a=
this._getOrCreateLayoutComponent();this._positionPercent.x=a.getPositionPercentX();this._positionPercent.y=a.getPositionPercentY()}return cc.p(this._positionPercent)},_getXPercent:function(){if(this._usingLayoutComponent){var a=this._getOrCreateLayoutComponent();this._positionPercent.x=a.getPositionPercentX();this._positionPercent.y=a.getPositionPercentY()}return this._positionPercent.x},_getYPercent:function(){if(this._usingLayoutComponent){var a=this._getOrCreateLayoutComponent();this._positionPercent.x=
a.getPositionPercentX();this._positionPercent.y=a.getPositionPercentY()}return this._positionPercent.y},setPositionType:function(a){this._positionType=a;if(this._usingLayoutComponent){var b=this._getOrCreateLayoutComponent();a===ccui.POSITION_ABSOLUTE?(b.setPositionPercentXEnabled(!1),b.setPositionPercentYEnabled(!1)):(b.setPositionPercentXEnabled(!0),b.setPositionPercentYEnabled(!0))}this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getPositionType:function(){return this._positionType},
setFlippedX:function(a){var b=this.getScaleX();this._flippedX=a;this.setScaleX(b)},isFlippedX:function(){return this._flippedX},setFlippedY:function(a){var b=this.getScaleY();this._flippedY=a;this.setScaleY(b)},isFlippedY:function(){return this._flippedY},_adaptRenderers:function(){},isBright:function(){return this._bright},isEnabled:function(){return this._enabled},getLeftBoundary:function(){return this.getPositionX()-this._getAnchorX()*this._contentSize.width},getBottomBoundary:function(){return this.getPositionY()-
this._getAnchorY()*this._contentSize.height},getRightBoundary:function(){return this.getLeftBoundary()+this._contentSize.width},getTopBoundary:function(){return this.getBottomBoundary()+this._contentSize.height},getTouchBeganPosition:function(){return cc.p(this._touchBeganPosition)},getTouchMovePosition:function(){return cc.p(this._touchMovePosition)},getTouchEndPosition:function(){return cc.p(this._touchEndPosition)},getWidgetType:function(){return this._widgetType},setLayoutParameter:function(a){a&&
(this._layoutParameterDictionary[a.getLayoutType()]=a,this._layoutParameterType=a.getLayoutType())},getLayoutParameter:function(a){a=a||this._layoutParameterType;return this._layoutParameterDictionary[a]},getDescription:function(){return"Widget"},clone:function(){var a=this._createCloneInstance();a._copyProperties(this);a._copyClonedWidgetChildren(this);return a},_createCloneInstance:function(){return new ccui.Widget},_copyClonedWidgetChildren:function(a){a=a.getChildren();for(var b=0;b<a.length;b++){var c=
a[b];c instanceof ccui.Widget&&this.addChild(c.clone())}},_copySpecialProperties:function(a){},_copyProperties:function(a){this.setEnabled(a.isEnabled());this.setVisible(a.isVisible());this.setBright(a.isBright());this.setTouchEnabled(a.isTouchEnabled());this.setLocalZOrder(a.getLocalZOrder());this.setTag(a.getTag());this.setName(a.getName());this.setActionTag(a.getActionTag());this._ignoreSize=a._ignoreSize;this.setContentSize(a._contentSize);this._customSize.width=a._customSize.width;this._customSize.height=
a._customSize.height;this._copySpecialProperties(a);this._sizeType=a.getSizeType();this._sizePercent.x=a._sizePercent.x;this._sizePercent.y=a._sizePercent.y;this._positionType=a._positionType;this._positionPercent.x=a._positionPercent.x;this._positionPercent.y=a._positionPercent.y;this.setPosition(a.getPosition());this.setAnchorPoint(a.getAnchorPoint());this.setScaleX(a.getScaleX());this.setScaleY(a.getScaleY());this.setRotation(a.getRotation());this.setRotationX(a.getRotationX());this.setRotationY(a.getRotationY());
this.setFlippedX(a.isFlippedX());this.setFlippedY(a.isFlippedY());this.setColor(a.getColor());this.setOpacity(a.getOpacity());this._touchEventCallback=a._touchEventCallback;this._touchEventListener=a._touchEventListener;this._touchEventSelector=a._touchEventSelector;this._clickEventListener=a._clickEventListener;this._focused=a._focused;this._focusEnabled=a._focusEnabled;this._propagateTouchEvents=a._propagateTouchEvents;for(var b in a._layoutParameterDictionary){var c=a._layoutParameterDictionary[b];
c&&this.setLayoutParameter(c.clone())}},setActionTag:function(a){this._actionTag=a},getActionTag:function(){return this._actionTag},getLeftInParent:function(){cc.log("getLeftInParent is deprecated. Please use getLeftBoundary instead.");return this.getLeftBoundary()},getBottomInParent:function(){cc.log("getBottomInParent is deprecated. Please use getBottomBoundary instead.");return this.getBottomBoundary()},getRightInParent:function(){cc.log("getRightInParent is deprecated. Please use getRightBoundary instead.");
return this.getRightBoundary()},getTopInParent:function(){cc.log("getTopInParent is deprecated. Please use getTopBoundary instead.");return this.getTopBoundary()},getTouchEndPos:function(){cc.log("getTouchEndPos is deprecated. Please use getTouchEndPosition instead.");return this.getTouchEndPosition()},getTouchMovePos:function(){cc.log("getTouchMovePos is deprecated. Please use getTouchMovePosition instead.");return this.getTouchMovePosition()},clippingParentAreaContainPoint:function(a){cc.log("clippingParentAreaContainPoint is deprecated. Please use isClippingParentContainsPoint instead.");
this.isClippingParentContainsPoint(a)},getTouchStartPos:function(){cc.log("getTouchStartPos is deprecated. Please use getTouchBeganPosition instead.");return this.getTouchBeganPosition()},setSize:function(a){this.setContentSize(a)},getSize:function(){return this.getContentSize()},addNode:function(a,b,c){a instanceof ccui.Widget?cc.log("Please use addChild to add a Widget."):(cc.Node.prototype.addChild.call(this,a,b,c),this._nodes.push(a))},getNodeByTag:function(a){for(var b=this._nodes,c=0;c<b.length;c++){var d=
b[c];if(d&&d.getTag()===a)return d}return null},getNodes:function(){return this._nodes},removeNode:function(a,b){cc.Node.prototype.removeChild.call(this,a,b);cc.arrayRemoveObject(this._nodes,a)},_getNormalGLProgram:function(){return cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)},_getGrayGLProgram:function(){return cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR_GRAY)},removeNodeByTag:function(a,b){var c=this.getChildByTag(a);c?this.removeChild(c,b):cc.log("cocos2d: removeNodeByTag(tag \x3d %d): child not found!",
a)},removeAllNodes:function(){for(var a=0;a<this._nodes.length;a++)cc.Node.prototype.removeChild.call(this,this._nodes[a]);this._nodes.length=0},_findLayout:function(){cc.renderer.childrenOrderDirty=!0;for(var a=this._parent;a;)if(a._doLayout){a._doLayoutDirty=!0;break}else a=a._parent},isUnifySizeEnabled:function(){return this._unifySize},setUnifySizeEnabled:function(a){this._unifySize=a},_ccEventCallback:null,addCCSEventListener:function(a){this._ccEventCallback=a},setScaleX:function(a){this._flippedX&&
(a*=-1);cc.Node.prototype.setScaleX.call(this,a)},setScaleY:function(a){this._flippedY&&(a*=-1);cc.Node.prototype.setScaleY.call(this,a)},setScale:function(a,b){void 0===b&&(b=a);this.setScaleX(a);this.setScaleY(b)},getScaleX:function(){var a=cc.Node.prototype.getScaleX.call(this);this._flippedX&&(a*=-1);return a},getScaleY:function(){var a=cc.Node.prototype.getScaleY.call(this);this._flippedY&&(a*=-1);return a},getScale:function(){this.getScaleX()!==this.getScaleY()&&cc.log("Widget#scale. ScaleX !\x3d ScaleY. Don't know which one to return");
return this.getScaleX()},setCallbackName:function(a){this._callbackName=a},getCallbackName:function(){return this._callbackName},setCallbackType:function(a){this._callbackType=a},getCallbackType:function(){return this._callbackType},setLayoutComponentEnabled:function(a){this._usingLayoutComponent=a},isLayoutComponentEnabled:function(){return this._usingLayoutComponent},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new ccui.Widget.WebGLRenderCmd(this):new ccui.Widget.CanvasRenderCmd(this)}});
_p=ccui.Widget.prototype;cc.defineGetterSetter(_p,"xPercent",_p._getXPercent,_p._setXPercent);cc.defineGetterSetter(_p,"yPercent",_p._getYPercent,_p._setYPercent);cc.defineGetterSetter(_p,"widthPercent",_p._getWidthPercent,_p._setWidthPercent);cc.defineGetterSetter(_p,"heightPercent",_p._getHeightPercent,_p._setHeightPercent);cc.defineGetterSetter(_p,"widgetParent",_p.getWidgetParent);cc.defineGetterSetter(_p,"enabled",_p.isEnabled,_p.setEnabled);cc.defineGetterSetter(_p,"focused",_p.isFocused,_p.setFocused);
cc.defineGetterSetter(_p,"sizeType",_p.getSizeType,_p.setSizeType);cc.defineGetterSetter(_p,"widgetType",_p.getWidgetType);cc.defineGetterSetter(_p,"touchEnabled",_p.isTouchEnabled,_p.setTouchEnabled);cc.defineGetterSetter(_p,"updateEnabled",_p.isUpdateEnabled,_p.setUpdateEnabled);cc.defineGetterSetter(_p,"bright",_p.isBright,_p.setBright);cc.defineGetterSetter(_p,"name",_p.getName,_p.setName);cc.defineGetterSetter(_p,"actionTag",_p.getActionTag,_p.setActionTag);
cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity);_p=null;ccui.Widget.create=function(){return new ccui.Widget};ccui.Widget._focusedWidget=null;ccui.Widget._focusNavigationController=null;
ccui.Widget.enableDpadNavigation=function(a){a?(null==ccui.Widget._focusNavigationController&&(ccui.Widget._focusNavigationController=new ccui._FocusNavigationController,ccui.Widget._focusedWidget&&ccui.Widget._focusNavigationController._setFirstFocsuedWidget(ccui.Widget._focusedWidget)),ccui.Widget._focusNavigationController.enableFocusNavigation(!0)):ccui.Widget._focusNavigationController&&(ccui.Widget._focusNavigationController.enableFocusNavigation(!1),ccui.Widget._focusNavigationController=null)};
ccui.Widget.getCurrentFocusedWidget=function(){return ccui.Widget._focusedWidget};ccui.Widget.BRIGHT_STYLE_NONE=-1;ccui.Widget.BRIGHT_STYLE_NORMAL=0;ccui.Widget.BRIGHT_STYLE_HIGH_LIGHT=1;ccui.Widget.TYPE_WIDGET=0;ccui.Widget.TYPE_CONTAINER=1;ccui.Widget.LEFT=0;ccui.Widget.RIGHT=1;ccui.Widget.UP=2;ccui.Widget.DOWN=3;ccui.Widget.LOCAL_TEXTURE=0;ccui.Widget.PLIST_TEXTURE=1;ccui.Widget.TOUCH_BEGAN=0;ccui.Widget.TOUCH_MOVED=1;ccui.Widget.TOUCH_ENDED=2;ccui.Widget.TOUCH_CANCELED=3;
ccui.Widget.SIZE_ABSOLUTE=0;ccui.Widget.SIZE_PERCENT=1;ccui.Widget.POSITION_ABSOLUTE=0;ccui.Widget.POSITION_PERCENT=1;cc.game.addEventListener(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){ccui.Widget.CanvasRenderCmd=function(a){this._pNodeCmdCtor(a);this._needDraw=!1};var a=ccui.Widget.CanvasRenderCmd.prototype=Object.create(cc.ProtectedNode.CanvasRenderCmd.prototype);a.constructor=ccui.Widget.CanvasRenderCmd;a.visit=function(a){var c=this._node,d=cc.renderer;if(a=a||this.getParentRenderCmd())this._curLevel=a._curLevel+1;isNaN(c._customZ)&&(c._vertexZ=d.assignedZ,d.assignedZ+=
d.assignedZStep);c._adaptRenderers();this._syncStatus(a)};a.transform=function(a,c){this._transform||(this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0});var d=this._node;if(d._visible&&d._running){d._adaptRenderers();if(!this._usingLayoutComponent){var e=d.getWidgetParent();e&&(e=e.getContentSize(),0!==e.width&&0!==e.height&&(d._position.x=e.width*d._positionPercent.x,d._position.y=e.height*d._positionPercent.y))}this.pNodeTransform(a,c)}}}else ccui.Widget.WebGLRenderCmd=
function(a){this._pNodeCmdCtor(a);this._needDraw=!1},a=ccui.Widget.WebGLRenderCmd.prototype=Object.create(cc.ProtectedNode.WebGLRenderCmd.prototype),a.constructor=ccui.Widget.WebGLRenderCmd,a.visit=function(a){var c=this._node,d=cc.renderer;if(a=a||this.getParentRenderCmd())this._curLevel=a._curLevel+1;isNaN(c._customZ)&&(c._vertexZ=d.assignedZ,d.assignedZ+=d.assignedZStep);c._adaptRenderers();this._syncStatus(a)},a.transform=function(a,c){this._transform||(this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},
this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0});var d=this._node;if(d._visible&&d._running){d._adaptRenderers();if(!this._usingLayoutComponent){var e=d.getWidgetParent();e&&(e=e.getContentSize(),0!==e.width&&0!==e.height&&(d._position.x=e.width*d._positionPercent.x,d._position.y=e.height*d._positionPercent.y))}this.pNodeTransform(a,c)}};a.widgetTransform=a.transform});(function(){var a={_pool:{},_lengths:[],put:function(a){var b=a.length;this._pool[b]?this._pool[b].push(a):(this._pool[b]=[a],this._lengths.push(b),this._lengths.sort())},get:function(a){for(var b,c=0;c<this._lengths.length;c++)if(this._lengths[c]>=a){b=this._lengths[c];break}if(b)return this._pool[b].pop()}},b=cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL,c,d={_rebuildQuads_base:function(b,d,e,f){var g=b._vertices,r=b._renderCmd._worldTransform,s,u,t;if(f)u=s=0,t=e.width,e=e.height;else{s=d._originalSize;
var w=d._rect,v=d._offset;t=e.width/s.width;f=e.height/s.height;var x=v.x-(s.width-w.width)/2;u=v.y+(s.height-w.height)/2;var A=v.y-(s.height-w.height)/2;s=(v.x+(s.width-w.width)/2)*t;u*=f;t=e.width+x*t;e=e.height+A*f}8>g.length&&(a.put(g),g=a.get(8)||new Float32Array(8),b._vertices=g);c?(g[0]=s*r.a+u*r.c+r.tx,g[1]=s*r.b+u*r.d+r.ty,g[2]=t*r.a+u*r.c+r.tx,g[3]=t*r.b+u*r.d+r.ty,g[4]=s*r.a+e*r.c+r.tx,g[5]=s*r.b+e*r.d+r.ty,g[6]=t*r.a+e*r.c+r.tx,g[7]=t*r.b+e*r.d+r.ty):(g[0]=s,g[1]=u,g[2]=t,g[3]=u,g[4]=
s,g[5]=e,g[6]=t,g[7]=e);b._uvsDirty&&this._calculateUVs(b,d);b._vertCount=4},_calculateUVs:function(c,d){var e=c._uvs,f=d._texture._pixelsWide,g=d._texture._pixelsHigh,r=d._rect,r=cc.rectPointsToPixels(r);8>e.length&&(a.put(e),e=a.get(8)||new Float32Array(8),c._uvs=e);var s,u,t=b?0.5:0;d._rotated?(s=(r.x+t)/f,u=(r.y+r.width-t)/g,f=(r.x+r.height-t)/f,g=(r.y+t)/g,e[0]=s,e[1]=g,e[2]=s,e[3]=u,e[4]=f,e[5]=g,e[6]=f,e[7]=u):(s=(r.x+t)/f,u=(r.y+r.height-t)/g,f=(r.x+r.width-t)/f,g=(r.y+t)/g,e[0]=s,e[1]=u,
e[2]=f,e[3]=u,e[4]=s,e[5]=g,e[6]=f,e[7]=g)}},e={x:Array(4),y:Array(4),_rebuildQuads_base:function(b,d,e,f,g,r,s){var u=b._vertices,t=b._renderCmd._worldTransform,w=e.width-f-g,v=e.height-r-s,x=e.width/(f+g),A=e.height/(r+s),y=this.x,z=this.y;y[0]=0;y[1]=f*(1<x?1:x);y[2]=y[1]+(0>w?0:w);y[3]=e.width;z[0]=0;z[1]=s*(1<A?1:A);z[2]=z[1]+(0>v?0:v);z[3]=e.height;32>u.length&&(a.put(u),u=a.get(32)||new Float32Array(32),b._vertices=u);e=0;if(c)for(w=0;4>w;w++)for(v=0;4>v;v++)u[e]=y[v]*t.a+z[w]*t.c+t.tx,u[e+
1]=y[v]*t.b+z[w]*t.d+t.ty,e+=2;else for(w=0;4>w;w++)for(v=0;4>v;v++)u[e]=y[v],u[e+1]=z[w],e+=2;b._uvsDirty&&this._calculateUVs(b,d,f,g,r,s)},_calculateUVs:function(c,d,e,f,g,r){var s=c._uvs,u=d._rect,t=d._texture._pixelsWide,w=d._texture._pixelsHigh,v,x=d._rect,x=cc.rectPointsToPixels(x),u=cc.rectPointsToPixels(u),A=cc.contentScaleFactor();e*=A;f=u.width-e-f*A;g*=A;r*=A;v=u.height-g-r;32>s.length&&(a.put(s),s=a.get(32)||new Float32Array(32),c._uvs=s);c=this.x;var u=this.y,y=b?0.5:0,A=0;if(d._rotated)for(c[0]=
(x.x+y)/t,c[1]=(r+x.x)/t,c[2]=(r+v+x.x)/t,c[3]=(x.x+x.height-y)/t,u[3]=(x.y+y)/w,u[2]=(e+x.y)/w,u[1]=(e+f+x.y)/w,u[0]=(x.y+x.width-y)/w,d=0;4>d;d++)for(t=0;4>t;t++)s[A]=c[d],s[A+1]=u[3-t],A+=2;else for(c[0]=(x.x+y)/t,c[1]=(e+x.x)/t,c[2]=(e+f+x.x)/t,c[3]=(x.x+x.width-y)/t,u[3]=(x.y+y)/w,u[2]=(g+x.y)/w,u[1]=(g+v+x.y)/w,u[0]=(x.y+x.height-y)/w,d=0;4>d;d++)for(t=0;4>t;t++)s[A]=c[t],s[A+1]=u[d],A+=2}};ccui.Scale9Sprite=cc.Scale9Sprite=cc.Node.extend({_spriteFrame:null,_scale9Image:null,_insetLeft:0,_insetRight:0,
_insetTop:0,_insetBottom:0,_blendFunc:null,_renderingType:1,_brightState:0,_opacityModifyRGB:!1,_rawVerts:null,_rawUvs:null,_vertices:null,_uvs:null,_vertCount:0,_quadsDirty:!0,_uvsDirty:!0,_isTriangle:!1,_isTrimmedContentSize:!1,_textureLoaded:!1,_flippedX:!1,_flippedY:!1,_className:"Scale9Sprite",ctor:function(b,d,e){cc.Node.prototype.ctor.call(this);this._loader=new cc.Sprite.LoadManager;this._renderCmd.setState(this._brightState);this._blendFunc=cc.BlendFunc._alphaPremultiplied();this.setAnchorPoint(cc.p(0.5,
0.5));this._rawUvs=this._rawVerts=null;this._vertices=a.get(8)||new Float32Array(8);this._uvs=a.get(8)||new Float32Array(8);if(void 0!==b)if(b instanceof cc.SpriteFrame)this.initWithSpriteFrame(b,d);else{var f=cc.spriteFrameCache.getSpriteFrame(b);f?this.initWithSpriteFrame(f,d):this.initWithFile(b,d,e)}void 0===c&&(c=cc._renderType===cc.game.RENDER_TYPE_WEBGL)},textureLoaded:function(){return this._textureLoaded},getCapInsets:function(){return cc.rect(this._capInsetsInternal)},_asyncSetCapInsets:function(){this.removeEventListener("load",
this._asyncSetCapInsets,this);this.setCapInsets(this._cacheCapInsets);this._cacheCapInsets=null},setCapInsets:function(a){if(!this.loaded())return this._cacheCapInsets=a,this.removeEventListener("load",this._asyncSetCapInsets,this),this.addEventListener("load",this._asyncSetCapInsets,this),!1;this._capInsetsInternal=a;this._updateCapInsets(this._spriteFrame._rect,this._capInsetsInternal)},_updateCapInsets:function(a,b){b&&a&&!cc._rectEqualToZero(b)?this._capInsetsInternal=b:(a=a||{x:0,y:0,width:this._contentSize.width,
height:this._contentSize.height},this._capInsetsInternal=cc.rect(a.width/3,a.height/3,a.width/3,a.height/3));cc._rectEqualToZero(a)||(this._insetLeft=this._capInsetsInternal.x,this._insetTop=this._capInsetsInternal.y,this._insetRight=a.width-this._insetLeft-this._capInsetsInternal.width,this._insetBottom=a.height-this._insetTop-this._capInsetsInternal.height)},initWithFile:function(a,b,c){a instanceof cc.Rect?(c=a=b,b=cc.rect(0,0,0,0)):(b=b||cc.rect(0,0,0,0),c=c||cc.rect(0,0,0,0));if(!a)throw Error("ccui.Scale9Sprite.initWithFile(): file should be non-null");
var d=cc.textureCache.getTextureForKey(a);d||(d=cc.textureCache.addImage(a));var e=d.isLoaded();this._textureLoaded=e;this._loader.clear();if(!e)return this._loader.once(d,function(){this.initWithFile(a,b,c);this.dispatchEvent("load")},this),!1;cc._rectEqualToZero(b)&&(e=d.getContentSize(),b=cc.rect(0,0,e.width,e.height));this.setTexture(d,b);this._updateCapInsets(b,c);return!0},updateWithBatchNode:function(a,b,c,d){if(!a)return!1;var e=a.getTexture();this._loader.clear();if(!e.isLoaded())return this._loader.once(e,
function(){this.updateWithBatchNode(a,b,c,d);this.dispatchEvent("load")},this),!1;this.setTexture(e,b);this._updateCapInsets(b,d);return!0},initWithSpriteFrame:function(a,b){this.setSpriteFrame(a);b=b||cc.rect(0,0,0,0);this._updateCapInsets(a._rect,b)},initWithSpriteFrameName:function(a,b){if(!a)throw Error("ccui.Scale9Sprite.initWithSpriteFrameName(): spriteFrameName should be non-null");b=b||cc.rect(0,0,0,0);var c=cc.spriteFrameCache.getSpriteFrame(a);if(null==c)return cc.log("ccui.Scale9Sprite.initWithSpriteFrameName(): can't find the sprite frame by spriteFrameName"),
!1;this.setSpriteFrame(c);b=b||cc.rect(0,0,0,0);this._updateCapInsets(c._rect,b)},loaded:function(){return null===this._spriteFrame?!1:this._spriteFrame.textureLoaded()},setTexture:function(a,b){var c=new cc.SpriteFrame(a,b);this.setSpriteFrame(c)},_updateBlendFunc:function(){var a=this._blendFunc;this._spriteFrame&&this._spriteFrame._texture.hasPremultipliedAlpha()?(a.src===cc.SRC_ALPHA&&a.dst===cc.BLEND_DST&&(a.src=cc.ONE),this._opacityModifyRGB=!0):(a.src===cc.ONE&&a.dst===cc.BLEND_DST&&(a.src=
cc.SRC_ALPHA),this._opacityModifyRGB=!1)},setOpacityModifyRGB:function(a){this._opacityModifyRGB!==a&&(this._opacityModifyRGB=a,this._renderCmd._setColorDirty())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setSpriteFrame:function(a){if(a){this._spriteFrame=a;this._uvsDirty=this._quadsDirty=!0;var b=this,c=function(){cc.sizeEqualToSize(b._contentSize,cc.size(0,0))&&b.setContentSize(b._spriteFrame._rect);b._textureLoaded=!0;b._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty);
cc.renderer.childrenOrderDirty=!0};b._textureLoaded=a.textureLoaded();b._textureLoaded?c():(this._loader.clear(),this._loader.once(a,function(){c();this.dispatchEvent("load")},this))}},setBlendFunc:function(a,b){void 0===b?(this._blendFunc.src=a.src||cc.BLEND_SRC,this._blendFunc.dst=a.dst||cc.BLEND_DST):(this._blendFunc.src=a||cc.BLEND_SRC,this._blendFunc.dst=b||cc.BLEND_DST);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,
this._blendFunc.dst)},setPreferredSize:function(a){a&&!cc.sizeEqualToSize(this._contentSize,a)&&this.setContentSize(a)},getPreferredSize:function(){return this.getContentSize()},setContentSize:function(a,b){void 0===b&&(b=a.height,a=a.width);if(a!==this._contentSize.width||b!==this._contentSize.height)cc.Node.prototype.setContentSize.call(this,a,b),this._quadsDirty=!0},getContentSize:function(){return this._renderingType===ccui.Scale9Sprite.RenderingType.SIMPLE?this._spriteFrame?this._spriteFrame._originalSize:
cc.size(this._contentSize):cc.size(this._contentSize)},_setWidth:function(a){cc.Node.prototype._setWidth.call(this,a);this._quadsDirty=!0},_setHeight:function(a){cc.Node.prototype._setHeight.call(this,a);this._quadsDirty=!0},setState:function(a){this._brightState=a;this._renderCmd.setState(a);this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getState:function(){return this._brightState},setRenderingType:function(a){this._renderingType!==a&&(this._renderingType=a,this._uvsDirty=this._quadsDirty=
!0,this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty))},getRenderingType:function(){return this._renderingType},setInsetLeft:function(a){this._insetLeft=a;this._uvsDirty=this._quadsDirty=!0;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getInsetLeft:function(){return this._insetLeft},setInsetTop:function(a){this._insetTop=a;this._uvsDirty=this._quadsDirty=!0;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getInsetTop:function(){return this._insetTop},setInsetRight:function(a){this._insetRight=
a;this._uvsDirty=this._quadsDirty=!0;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getInsetRight:function(){return this._insetRight},setInsetBottom:function(a){this._insetBottom=a;this._uvsDirty=this._quadsDirty=!0;this._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.contentDirty)},getInsetBottom:function(){return this._insetBottom},_rebuildQuads:function(){if(this._spriteFrame&&this._spriteFrame._textureLoaded){this._updateBlendFunc();this._isTriangle=!1;switch(this._renderingType){case g.SIMPLE:d._rebuildQuads_base(this,
this._spriteFrame,this._contentSize,this._isTrimmedContentSize);break;case g.SLICED:e._rebuildQuads_base(this,this._spriteFrame,this._contentSize,this._insetLeft,this._insetRight,this._insetTop,this._insetBottom);break;default:this._uvsDirty=this._quadsDirty=!1;cc.error("Can not generate quad");return}this._uvsDirty=this._quadsDirty=!1}},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new ccui.Scale9Sprite.CanvasRenderCmd(this):new ccui.Scale9Sprite.WebGLRenderCmd(this)}});
var f=ccui.Scale9Sprite.prototype;cc.EventHelper.prototype.apply(f);cc.defineGetterSetter(f,"preferredSize",f.getPreferredSize,f.setPreferredSize);cc.defineGetterSetter(f,"capInsets",f.getCapInsets,f.setCapInsets);cc.defineGetterSetter(f,"insetLeft",f.getInsetLeft,f.setInsetLeft);cc.defineGetterSetter(f,"insetTop",f.getInsetTop,f.setInsetTop);cc.defineGetterSetter(f,"insetRight",f.getInsetRight,f.setInsetRight);cc.defineGetterSetter(f,"insetBottom",f.getInsetBottom,f.setInsetBottom);f=null;ccui.Scale9Sprite.create=
function(a,b,c){return new ccui.Scale9Sprite(a,b,c)};ccui.Scale9Sprite.createWithSpriteFrame=function(a,b){return new ccui.Scale9Sprite(a,b)};ccui.Scale9Sprite.createWithSpriteFrameName=function(a,b){return new ccui.Scale9Sprite(a,b)};ccui.Scale9Sprite.POSITIONS_CENTRE=0;ccui.Scale9Sprite.POSITIONS_TOP=1;ccui.Scale9Sprite.POSITIONS_LEFT=2;ccui.Scale9Sprite.POSITIONS_RIGHT=3;ccui.Scale9Sprite.POSITIONS_BOTTOM=4;ccui.Scale9Sprite.POSITIONS_TOPRIGHT=5;ccui.Scale9Sprite.POSITIONS_TOPLEFT=6;ccui.Scale9Sprite.POSITIONS_BOTTOMRIGHT=
7;ccui.Scale9Sprite.state={NORMAL:0,GRAY:1};var g=ccui.Scale9Sprite.RenderingType={SIMPLE:0,SLICED:1}})();(function(){ccui.Scale9Sprite.CanvasRenderCmd=function(a){cc.Node.CanvasRenderCmd.call(this,a);this._needDraw=!0;this._state=ccui.Scale9Sprite.state.NORMAL;this._originalTexture=this._textureToRender=null};var a=ccui.Scale9Sprite.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);a.constructor=ccui.Scale9Sprite.CanvasRenderCmd;a.transform=function(a,c){this.originTransform(a,c);this._node._rebuildQuads()};a.needDraw=function(){return this._needDraw&&this._node.loaded()};a._updateDisplayColor=
function(a){cc.Node.RenderCmd.prototype._updateDisplayColor.call(this,a);this._originalTexture=this._textureToRender=null};a.setState=function(a){this._state!==a&&(this._state=a,this._originalTexture=this._textureToRender=null)};a._setColorDirty=function(){this.setDirtyFlag(cc.Node._dirtyFlags.colorDirty|cc.Node._dirtyFlags.opacityDirty)};a.rendering=function(a,c,d){var e=this._node,f=this._displayedOpacity,g=f/255,h=null;e._spriteFrame&&(h=e._spriteFrame._texture);if(e.loaded()&&0!==f){if(null===
this._textureToRender||this._originalTexture!==h)this._textureToRender=this._originalTexture=h,cc.Scale9Sprite.state.GRAY===this._state&&(this._textureToRender=this._textureToRender._generateGrayTexture()),f=e.getDisplayedColor(),!h||255===f.r&&255===f.g&&255===f.b||(this._textureToRender=this._textureToRender._generateColorTexture(f.r,f.g,f.b));h=a||cc._renderContext;a=h.getContext();h.setTransform(this._worldTransform,c,d);h.setCompositeOperation(cc.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(e._blendFunc));
h.setGlobalAlpha(g);if(this._textureToRender){e._quadsDirty&&e._rebuildQuads();var k,m,n,p,r,s,u;c=this._textureToRender._pixelsWide;d=this._textureToRender._pixelsHigh;var g=this._textureToRender._htmlElementObj,f=e._vertices,t=e._uvs,w=0,v=0;if(e._renderingType===cc.Scale9Sprite.RenderingType.SLICED){for(h=0;3>h;++h)for(w=0;3>w;++w)v=8*h+2*w,p=f[v],r=f[v+1],s=f[v+10]-p,u=f[v+11]-r,r=-r-u,e=t[v]*c,k=t[v+11]*d,m=(t[v+10]-t[v])*c,n=(t[v+1]-t[v+11])*d,0<m&&0<n&&0<s&&0<u&&a.drawImage(g,e,k,m,n,p,r,s,
u);cc.g_NumberOfDraws+=9}else{for(var x=Math.floor(e._vertCount/4),v=w=0;w<x;w++)p=f[v],r=f[v+1],s=f[v+6]-p,u=f[v+7]-r,r=-r-u,e=t[v]*c,k=t[v+7]*d,m=(t[v+6]-t[v])*c,n=(t[v+1]-t[v+7])*d,""!==this._textureToRender._pattern?(h.setFillStyle(a.createPattern(g,this._textureToRender._pattern)),a.fillRect(p,r,s,u)):0<m&&0<n&&0<s&&0<u&&a.drawImage(g,e,k,m,n,p,r,s,u),v+=8;cc.g_NumberOfDraws+=x}}}}})();(function(){if(cc.Node.WebGLRenderCmd){ccui.Scale9Sprite.WebGLRenderCmd=function(a){cc.Node.WebGLRenderCmd.call(this,a);this._needDraw=!0;this._color=new Uint32Array(1);this._dirty=!1;this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)};var a=ccui.Scale9Sprite,b=ccui.Scale9Sprite.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);b.constructor=ccui.Scale9Sprite.WebGLRenderCmd;b.needDraw=function(){return this._needDraw&&this._node.loaded()};
b._uploadSliced=function(a,b,e,f,g,h,k){for(var m,n=0;3>n;++n)for(var p=0;3>p;++p)m=8*n+2*p,g[k]=a[m],g[k+1]=a[m+1],g[k+2]=f,h[k+3]=e[0],g[k+4]=b[m],g[k+5]=b[m+1],k+=6,g[k]=a[m+2],g[k+1]=a[m+3],g[k+2]=f,h[k+3]=e[0],g[k+4]=b[m+2],g[k+5]=b[m+3],k+=6,g[k]=a[m+8],g[k+1]=a[m+9],g[k+2]=f,h[k+3]=e[0],g[k+4]=b[m+8],g[k+5]=b[m+9],k+=6,g[k]=a[m+10],g[k+1]=a[m+11],g[k+2]=f,h[k+3]=e[0],g[k+4]=b[m+10],g[k+5]=b[m+11],k+=6;return 36};b.transform=function(a,b){this.originTransform(a,b);this._node._rebuildQuads()};
b._setColorDirty=function(){};b.uploadData=function(b,d,e){var f=this._node;if(0===this._displayedOpacity)return 0;f._quadsDirty&&f._rebuildQuads();var g=this._displayedOpacity,h=this._displayedColor.r,k=this._displayedColor.g,m=this._displayedColor.b;if(f._opacityModifyRGB)var n=g/255,h=h*n,k=k*n,m=m*n;this._color[0]=g<<24|m<<16|k<<8|h;g=f._vertexZ;h=f._vertices;k=f._uvs;n=a.RenderingType;m=0;switch(f._renderingType){case n.SIMPLE:m=this._node._vertCount;for(n=f=0;f<m;f++,n+=2)b[e]=h[n],b[e+1]=h[n+
1],b[e+2]=g,d[e+3]=this._color[0],b[e+4]=k[n],b[e+5]=k[n+1],e+=6;break;case n.SLICED:m=this._uploadSliced(h,k,this._color,g,b,d,e)}return m};b.setState=function(b){b===a.state.NORMAL?this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR):b===a.state.GRAY&&(this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR_GRAY))}}})();ccui.Layout=ccui.Widget.extend({_clippingEnabled:!1,_backGroundScale9Enabled:null,_backGroundImage:null,_backGroundImageFileName:null,_backGroundImageCapInsets:null,_colorType:null,_bgImageTexType:ccui.Widget.LOCAL_TEXTURE,_colorRender:null,_gradientRender:null,_color:null,_startColor:null,_endColor:null,_alongVector:null,_opacity:255,_backGroundImageTextureSize:null,_layoutType:null,_doLayoutDirty:!0,_clippingRectDirty:!0,_clippingType:null,_clippingStencil:null,_scissorRectDirty:!1,_clippingRect:null,
_clippingParent:null,_className:"Layout",_backGroundImageColor:null,_finalPositionX:0,_finalPositionY:0,_backGroundImageOpacity:0,_loopFocus:!1,__passFocusToChild:!0,_isFocusPassing:!1,_isInterceptTouch:!1,ctor:function(){this._layoutType=ccui.Layout.ABSOLUTE;this._widgetType=ccui.Widget.TYPE_CONTAINER;this._clippingType=ccui.Layout.CLIPPING_SCISSOR;this._colorType=ccui.Layout.BG_COLOR_NONE;ccui.Widget.prototype.ctor.call(this);this.ignoreContentAdaptWithSize(!1);this.setContentSize(cc.size(0,0));
this.setAnchorPoint(0,0);this.onPassFocusToChild=this._findNearestChildWidgetIndex.bind(this);this._backGroundImageCapInsets=cc.rect(0,0,0,0);this._color=cc.color(255,255,255,255);this._startColor=cc.color(255,255,255,255);this._endColor=cc.color(255,255,255,255);this._alongVector=cc.p(0,-1);this._backGroundImageTextureSize=cc.size(0,0);this._clippingRect=cc.rect(0,0,0,0);this._backGroundImageColor=cc.color(255,255,255,255)},onEnter:function(){ccui.Widget.prototype.onEnter.call(this);this._clippingStencil&&
this._clippingStencil._performRecursive(cc.Node._stateCallbackType.onEnter);this._clippingRectDirty=this._doLayoutDirty=!0},onExit:function(){ccui.Widget.prototype.onExit.call(this);this._clippingStencil&&this._clippingStencil._performRecursive(cc.Node._stateCallbackType.onExit)},visit:function(a){var b=this._renderCmd,c=a?a._renderCmd:null;if(this._visible){this._adaptRenderers();this._doLayout();b.visit(c);a=this._clippingEnabled&&this._clippingType===ccui.Layout.CLIPPING_STENCIL;var d=this._clippingEnabled&&
this._clippingType===ccui.Layout.CLIPPING_SCISSOR;a?b.stencilClippingVisit(c):d&&b.scissorClippingVisit(c);var e=this._children,f=e.length,g,h=this._protectedChildren,k=h.length,m;this._reorderChildDirty&&this.sortAllChildren();this._reorderProtectedChildDirty&&this.sortAllProtectedChildren();for(c=0;c<f;c++)if(g=e[c],0>g._localZOrder)g.visit(this);else break;for(g=0;g<k;g++)if(m=h[g],0>m._localZOrder)b._changeProtectedChild(m),m.visit(this);else break;for(;c<f;c++)e[c].visit(this);for(;g<k;g++)m=
h[g],b._changeProtectedChild(m),m.visit(this);a?b.postStencilVisit():d&&b.postScissorVisit();b._dirtyFlag=0}else b._propagateFlagsDown(c)},setLoopFocus:function(a){this._loopFocus=a},isLoopFocus:function(){return this._loopFocus},setPassFocusToChild:function(a){this.__passFocusToChild=a},isPassFocusToChild:function(){return this.__passFocusToChild},findNextFocusedWidget:function(a,b){if(this._isFocusPassing||this.isFocused()){var c=this.getParent();this._isFocusPassing=!1;if(this.__passFocusToChild){var d=
this._passFocusToChild(a,b);return d instanceof ccui.Layout&&c?(c._isFocusPassing=!0,c.findNextFocusedWidget(a,this)):d}if(null==c||!(c instanceof ccui.Layout))return this;c._isFocusPassing=!0;return c.findNextFocusedWidget(a,this)}if(b.isFocused()||b instanceof ccui.Layout)if(this._layoutType===ccui.Layout.LINEAR_HORIZONTAL)switch(a){case ccui.Widget.LEFT:return this._getPreviousFocusedWidget(a,b);case ccui.Widget.RIGHT:return this._getNextFocusedWidget(a,b);case ccui.Widget.DOWN:case ccui.Widget.UP:return this._isLastWidgetInContainer(this,
a)?this._isWidgetAncestorSupportLoopFocus(b,a)?ccui.Widget.prototype.findNextFocusedWidget.call(this,a,this):b:ccui.Widget.prototype.findNextFocusedWidget.call(this,a,this);default:return cc.assert(0,"Invalid Focus Direction"),b}else if(this._layoutType===ccui.Layout.LINEAR_VERTICAL)switch(a){case ccui.Widget.LEFT:case ccui.Widget.RIGHT:return this._isLastWidgetInContainer(this,a)?this._isWidgetAncestorSupportLoopFocus(b,a)?ccui.Widget.prototype.findNextFocusedWidget.call(this,a,this):b:ccui.Widget.prototype.findNextFocusedWidget.call(this,
a,this);case ccui.Widget.DOWN:return this._getNextFocusedWidget(a,b);case ccui.Widget.UP:return this._getPreviousFocusedWidget(a,b);default:return cc.assert(0,"Invalid Focus Direction"),b}else return cc.assert(0,"Un Supported Layout type, please use VBox and HBox instead!!!"),b;else return b},onPassFocusToChild:null,addChild:function(a,b,c){a instanceof ccui.Widget&&this._supplyTheLayoutParameterLackToChild(a);ccui.Widget.prototype.addChild.call(this,a,b,c);this._doLayoutDirty=!0},removeChild:function(a,
b){ccui.Widget.prototype.removeChild.call(this,a,b);this._doLayoutDirty=!0},removeAllChildren:function(a){ccui.Widget.prototype.removeAllChildren.call(this,a);this._doLayoutDirty=!0},removeAllChildrenWithCleanup:function(a){ccui.Widget.prototype.removeAllChildrenWithCleanup.call(this,a);this._doLayoutDirty=!0},isClippingEnabled:function(){return this._clippingEnabled},setClippingEnabled:function(a){if(a!==this._clippingEnabled)switch(this._clippingEnabled=a,this._clippingType){case ccui.Layout.CLIPPING_SCISSOR:case ccui.Layout.CLIPPING_STENCIL:a?
(this._clippingStencil=new cc.DrawNode,this._renderCmd.rebindStencilRendering(this._clippingStencil),this._running&&this._clippingStencil._performRecursive(cc.Node._stateCallbackType.onEnter),this._setStencilClippingSize(this._contentSize)):(this._running&&this._clippingStencil&&this._clippingStencil._performRecursive(cc.Node._stateCallbackType.onExit),this._clippingStencil=null)}},setClippingType:function(a){if(a!==this._clippingType){var b=this.isClippingEnabled();this.setClippingEnabled(!1);this._clippingType=
a;this.setClippingEnabled(b)}},getClippingType:function(){return this._clippingType},_setStencilClippingSize:function(a){if(this._clippingEnabled){var b=[];b[0]=cc.p(0,0);b[1]=cc.p(a.width,0);b[2]=cc.p(a.width,a.height);b[3]=cc.p(0,a.height);var c=cc.color.GREEN;this._clippingStencil.clear();this._clippingStencil.setLocalBB&&this._clippingStencil.setLocalBB(0,0,a.width,a.height);this._clippingStencil.drawPoly(b,4,c,0,c)}},_getClippingRect:function(){if(this._clippingRectDirty){var a=this.convertToWorldSpace(cc.p(0,
0)),b=this.getNodeToWorldTransform(),c=this._contentSize.width*b.a,b=this._contentSize.height*b.d,d;for(d=this;d;)if((d=d.getParent())&&d instanceof ccui.Layout&&d.isClippingEnabled()){this._clippingParent=d;break}this._clippingParent?(d=this._clippingParent._getClippingRect(),this._clippingRect.x=Math.max(a.x,d.x),this._clippingRect.y=Math.max(a.y,d.y),c=Math.min(a.x+c,d.x+d.width),a=Math.min(a.y+b,d.y+d.height),this._clippingRect.width=Math.max(0,c-this._clippingRect.x),this._clippingRect.height=
Math.max(0,a-this._clippingRect.y)):(this._clippingRect.x=a.x,this._clippingRect.y=a.y,this._clippingRect.width=c,this._clippingRect.height=b);this._clippingRectDirty=!1}return this._clippingRect},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);var a=this._contentSize;this._setStencilClippingSize(a);this._clippingRectDirty=this._doLayoutDirty=!0;this._backGroundImage&&(this._backGroundImage.setPosition(0.5*a.width,0.5*a.height),this._backGroundScale9Enabled&&this._backGroundImage instanceof
ccui.Scale9Sprite&&this._backGroundImage.setPreferredSize(a));this._colorRender&&this._colorRender.setContentSize(a);this._gradientRender&&this._gradientRender.setContentSize(a)},setBackGroundImageScale9Enabled:function(a){this._backGroundScale9Enabled!==a&&(this.removeProtectedChild(this._backGroundImage),this._backGroundImage=null,this._backGroundScale9Enabled=a,this._addBackGroundImage(),this.setBackGroundImage(this._backGroundImageFileName,this._bgImageTexType),this.setBackGroundImageCapInsets(this._backGroundImageCapInsets))},
isBackGroundImageScale9Enabled:function(){return this._backGroundScale9Enabled},setBackGroundImage:function(a,b){if(a){b=b||ccui.Widget.LOCAL_TEXTURE;null===this._backGroundImage&&(this._addBackGroundImage(),this.setBackGroundImageScale9Enabled(this._backGroundScale9Enabled));this._backGroundImageFileName=a;this._bgImageTexType=b;var c=this._backGroundImage;switch(this._bgImageTexType){case ccui.Widget.LOCAL_TEXTURE:c.initWithFile(a);break;case ccui.Widget.PLIST_TEXTURE:c.initWithSpriteFrameName(a)}this._backGroundScale9Enabled&&
c.setPreferredSize(this._contentSize);this._backGroundImageTextureSize=c.getContentSize();c.setPosition(0.5*this._contentSize.width,0.5*this._contentSize.height);this._updateBackGroundImageColor()}},setBackGroundImageCapInsets:function(a){if(a){var b=this._backGroundImageCapInsets;b.x=a.x;b.y=a.y;b.width=a.width;b.height=a.height;this._backGroundScale9Enabled&&this._backGroundImage.setCapInsets(a)}},getBackGroundImageCapInsets:function(){return cc.rect(this._backGroundImageCapInsets)},_supplyTheLayoutParameterLackToChild:function(a){if(a)switch(this._layoutType){case ccui.Layout.LINEAR_HORIZONTAL:case ccui.Layout.LINEAR_VERTICAL:var b=
a.getLayoutParameter(ccui.LayoutParameter.LINEAR);b||a.setLayoutParameter(new ccui.LinearLayoutParameter);break;case ccui.Layout.RELATIVE:(b=a.getLayoutParameter(ccui.LayoutParameter.RELATIVE))||a.setLayoutParameter(new ccui.RelativeLayoutParameter)}},_addBackGroundImage:function(){var a=this._contentSize;this._backGroundScale9Enabled?(this._backGroundImage=new ccui.Scale9Sprite,this._backGroundImage.setPreferredSize(a)):this._backGroundImage=new cc.Sprite;this.addProtectedChild(this._backGroundImage,
ccui.Layout.BACKGROUND_IMAGE_ZORDER,-1);this._backGroundImage.setPosition(0.5*a.width,0.5*a.height)},removeBackGroundImage:function(){this._backGroundImage&&(this.removeProtectedChild(this._backGroundImage),this._backGroundImage=null,this._backGroundImageFileName="",this._backGroundImageTextureSize.width=0,this._backGroundImageTextureSize.height=0)},setBackGroundColorType:function(a){if(this._colorType!==a){switch(this._colorType){case ccui.Layout.BG_COLOR_NONE:this._colorRender&&(this.removeProtectedChild(this._colorRender),
this._colorRender=null);this._gradientRender&&(this.removeProtectedChild(this._gradientRender),this._gradientRender=null);break;case ccui.Layout.BG_COLOR_SOLID:this._colorRender&&(this.removeProtectedChild(this._colorRender),this._colorRender=null);break;case ccui.Layout.BG_COLOR_GRADIENT:this._gradientRender&&(this.removeProtectedChild(this._gradientRender),this._gradientRender=null)}this._colorType=a;switch(this._colorType){case ccui.Layout.BG_COLOR_SOLID:this._colorRender=new cc.LayerColor;this._colorRender.setContentSize(this._contentSize);
this._colorRender.setOpacity(this._opacity);this._colorRender.setColor(this._color);this.addProtectedChild(this._colorRender,ccui.Layout.BACKGROUND_RENDERER_ZORDER,-1);break;case ccui.Layout.BG_COLOR_GRADIENT:this._gradientRender=new cc.LayerGradient(cc.color(255,0,0,255),cc.color(0,255,0,255)),this._gradientRender.setContentSize(this._contentSize),this._gradientRender.setOpacity(this._opacity),this._gradientRender.setStartColor(this._startColor),this._gradientRender.setEndColor(this._endColor),this._gradientRender.setVector(this._alongVector),
this.addProtectedChild(this._gradientRender,ccui.Layout.BACKGROUND_RENDERER_ZORDER,-1)}}},getBackGroundColorType:function(){return this._colorType},setBackGroundColor:function(a,b){b?(this._startColor.r=a.r,this._startColor.g=a.g,this._startColor.b=a.b,this._gradientRender&&this._gradientRender.setStartColor(a),this._endColor.r=b.r,this._endColor.g=b.g,this._endColor.b=b.b,this._gradientRender&&this._gradientRender.setEndColor(b)):(this._color.r=a.r,this._color.g=a.g,this._color.b=a.b,this._colorRender&&
this._colorRender.setColor(a))},getBackGroundColor:function(){var a=this._color;return cc.color(a.r,a.g,a.b,a.a)},getBackGroundStartColor:function(){var a=this._startColor;return cc.color(a.r,a.g,a.b,a.a)},getBackGroundEndColor:function(){var a=this._endColor;return cc.color(a.r,a.g,a.b,a.a)},setBackGroundColorOpacity:function(a){this._opacity=a;switch(this._colorType){case ccui.Layout.BG_COLOR_SOLID:this._colorRender.setOpacity(a);break;case ccui.Layout.BG_COLOR_GRADIENT:this._gradientRender.setOpacity(a)}},
getBackGroundColorOpacity:function(){return this._opacity},setBackGroundColorVector:function(a){this._alongVector.x=a.x;this._alongVector.y=a.y;this._gradientRender&&this._gradientRender.setVector(a)},getBackGroundColorVector:function(){return this._alongVector},setBackGroundImageColor:function(a){this._backGroundImageColor.r=a.r;this._backGroundImageColor.g=a.g;this._backGroundImageColor.b=a.b;this._updateBackGroundImageColor()},setBackGroundImageOpacity:function(a){this._backGroundImageColor.a=
a;this.getBackGroundImageColor()},getBackGroundImageColor:function(){var a=this._backGroundImageColor;return cc.color(a.r,a.g,a.b,a.a)},getBackGroundImageOpacity:function(){return this._backGroundImageColor.a},_updateBackGroundImageColor:function(){this._backGroundImage&&this._backGroundImage.setColor(this._backGroundImageColor)},getBackGroundImageTextureSize:function(){return this._backGroundImageTextureSize},setLayoutType:function(a){this._layoutType=a;a=this._children;for(var b=null,c=0;c<a.length;c++)b=
a[c],b instanceof ccui.Widget&&this._supplyTheLayoutParameterLackToChild(b);this._doLayoutDirty=!0},getLayoutType:function(){return this._layoutType},requestDoLayout:function(){this._doLayoutDirty=!0},_doLayout:function(){if(this._doLayoutDirty){this.sortAllChildren();var a=ccui.getLayoutManager(this._layoutType);a&&a._doLayout(this);this._doLayoutDirty=!1}},_getLayoutContentSize:function(){return this.getContentSize()},_getLayoutElements:function(){return this.getChildren()},_updateBackGroundImageOpacity:function(){this._backGroundImage&&
this._backGroundImage.setOpacity(this._backGroundImageOpacity)},_updateBackGroundImageRGBA:function(){this._backGroundImage&&(this._backGroundImage.setColor(this._backGroundImageColor),this._backGroundImage.setOpacity(this._backGroundImageOpacity))},_getLayoutAccumulatedSize:function(){for(var a=this.getChildren(),b=cc.size(0,0),c=0,d,e=0,f=a.length;e<f;e++)if(d=a[e],null!==d&&d instanceof ccui.Layout)d=d._getLayoutAccumulatedSize(),b.width+=d.width,b.height+=d.height;else if(d instanceof ccui.Widget){c++;
var g=d.getLayoutParameter().getMargin();d=d.getContentSize();b.width+=d.width+0.5*(g.right+g.left);b.height+=d.height+0.5*(g.top+g.bottom)}a=this.getLayoutType();a===ccui.Layout.LINEAR_HORIZONTAL&&(b.height-=b.height/c*(c-1));a===ccui.Layout.LINEAR_VERTICAL&&(b.width-=b.width/c*(c-1));return b},_findNearestChildWidgetIndex:function(a,b){if(null==b||b===this)return this._findFirstFocusEnabledWidgetIndex();var c=0,d=this.getChildren(),e=d.length,f,g=cc.FLT_MAX,h=0;if(a===ccui.Widget.LEFT||a===ccui.Widget.RIGHT||
a===ccui.Widget.DOWN||a===ccui.Widget.UP){for(f=this._getWorldCenterPoint(b);c<e;){var k=d[c];k&&k instanceof ccui.Widget&&k.isFocusEnabled()&&(k=k instanceof ccui.Layout?k._calculateNearestDistance(b):cc.pLength(cc.pSub(this._getWorldCenterPoint(k),f)),k<g&&(h=c,g=k));c++}return h}cc.log("invalid focus direction!");return 0},_findFarthestChildWidgetIndex:function(a,b){if(null==b||b===this)return this._findFirstFocusEnabledWidgetIndex();var c=0,d=this.getChildren(),e=d.length,f=-cc.FLT_MAX,g=0;if(a===
ccui.Widget.LEFT||a===ccui.Widget.RIGHT||a===ccui.Widget.DOWN||a===ccui.Widget.UP){for(var h=this._getWorldCenterPoint(b);c<e;){var k=d[c];k&&k instanceof ccui.Widget&&k.isFocusEnabled()&&(k=k instanceof ccui.Layout?k._calculateFarthestDistance(b):cc.pLength(cc.pSub(this._getWorldCenterPoint(k),h)),k>f&&(g=c,f=k));c++}return g}cc.log("invalid focus direction!!!");return 0},_calculateNearestDistance:function(a){for(var b=cc.FLT_MAX,c=this._getWorldCenterPoint(a),d=this._children,e=0,f=d.length;e<f;e++){var g=
d[e];if(g instanceof ccui.Layout)g=g._calculateNearestDistance(a);else if(g instanceof ccui.Widget&&g.isFocusEnabled())g=cc.pLength(cc.pSub(this._getWorldCenterPoint(g),c));else continue;g<b&&(b=g)}return b},_calculateFarthestDistance:function(a){for(var b=-cc.FLT_MAX,c=this._getWorldCenterPoint(a),d=this._children,e=0,f=d.length;e<f;e++){var g=d[e];if(g instanceof ccui.Layout)g=g._calculateFarthestDistance(a);else if(g instanceof ccui.Widget&&g.isFocusEnabled())g=this._getWorldCenterPoint(g),g=cc.pLength(cc.pSub(g,
c));else continue;g>b&&(b=g)}return b},_findProperSearchingFunctor:function(a,b){if(void 0!==b){var c=this._getWorldCenterPoint(b),d=this._getWorldCenterPoint(this._findFirstNonLayoutWidget());a===ccui.Widget.LEFT?this.onPassFocusToChild=c.x>d.x?this._findNearestChildWidgetIndex:this._findFarthestChildWidgetIndex:a===ccui.Widget.RIGHT?this.onPassFocusToChild=c.x>d.x?this._findFarthestChildWidgetIndex:this._findNearestChildWidgetIndex:a===ccui.Widget.DOWN?this.onPassFocusToChild=c.y>d.y?this._findNearestChildWidgetIndex:
this._findFarthestChildWidgetIndex:a===ccui.Widget.UP?this.onPassFocusToChild=c.y<d.y?this._findNearestChildWidgetIndex:this._findFarthestChildWidgetIndex:cc.log("invalid direction!")}},_findFirstNonLayoutWidget:function(){for(var a=this._children,b=0,c=a.length;b<c;b++){var d=a[b];if(d instanceof ccui.Layout){if(d=d._findFirstNonLayoutWidget())return d}else if(d instanceof ccui.Widget)return d}return null},_findFirstFocusEnabledWidgetIndex:function(){for(var a=0,b=this.getChildren(),c=b.length;a<
c;){var d=b[a];if(d&&d instanceof ccui.Widget&&d.isFocusEnabled())return a;a++}return 0},_findFocusEnabledChildWidgetByIndex:function(a){var b=this._getChildWidgetByIndex(a);return b?b.isFocusEnabled()?b:this._findFocusEnabledChildWidgetByIndex(a+1):null},_getWorldCenterPoint:function(a){var b=a instanceof ccui.Layout?a._getLayoutAccumulatedSize():a.getContentSize();return a.convertToWorldSpace(cc.p(b.width/2,b.height/2))},_getNextFocusedWidget:function(a,b){var c=null,c=this._children,d=c.indexOf(b),
d=d+1;if(d<c.length){if(c=this._getChildWidgetByIndex(d)){if(c.isFocusEnabled()){if(c instanceof ccui.Layout)return c._isFocusPassing=!0,c.findNextFocusedWidget(a,c);this.dispatchFocusEvent(b,c);return c}return this._getNextFocusedWidget(a,c)}return b}if(this._loopFocus){if(this._checkFocusEnabledChild()){c=this._getChildWidgetByIndex(0);if(c.isFocusEnabled()){if(c instanceof ccui.Layout)return c._isFocusPassing=!0,c.findNextFocusedWidget(a,c);this.dispatchFocusEvent(b,c);return c}return this._getNextFocusedWidget(a,
c)}return b instanceof ccui.Layout?b:ccui.Widget._focusedWidget}return this._isLastWidgetInContainer(b,a)?this._isWidgetAncestorSupportLoopFocus(this,a)?ccui.Widget.prototype.findNextFocusedWidget.call(this,a,this):b instanceof ccui.Layout?b:ccui.Widget._focusedWidget:ccui.Widget.prototype.findNextFocusedWidget.call(this,a,this)},_getPreviousFocusedWidget:function(a,b){var c=null,c=this._children,d=c.indexOf(b),d=d-1;if(0<=d){c=this._getChildWidgetByIndex(d);if(c.isFocusEnabled()){if(c instanceof
ccui.Layout)return c._isFocusPassing=!0,c.findNextFocusedWidget(a,c);this.dispatchFocusEvent(b,c);return c}return this._getPreviousFocusedWidget(a,c)}if(this._loopFocus){if(this._checkFocusEnabledChild()){d=c.length-1;c=this._getChildWidgetByIndex(d);if(c.isFocusEnabled()){if(c instanceof ccui.Layout)return c._isFocusPassing=!0,c.findNextFocusedWidget(a,c);this.dispatchFocusEvent(b,c);return c}return this._getPreviousFocusedWidget(a,c)}return b instanceof ccui.Layout?b:ccui.Widget._focusedWidget}return this._isLastWidgetInContainer(b,
a)?this._isWidgetAncestorSupportLoopFocus(this,a)?ccui.Widget.prototype.findNextFocusedWidget.call(this,a,this):b instanceof ccui.Layout?b:ccui.Widget._focusedWidget:ccui.Widget.prototype.findNextFocusedWidget.call(this,a,this)},_getChildWidgetByIndex:function(a){for(var b=this._children,c=b.length,d=0,e=a;a<c;){var f=b[a];if(f&&f instanceof ccui.Widget)return f;d++;a++}for(a=0;a<e;){if((c=b[a])&&c instanceof ccui.Widget)return c;d++;a++}return null},_isLastWidgetInContainer:function(a,b){var c=a.getParent();
if(null==c||!(c instanceof ccui.Layout))return!0;var d=c.getChildren(),e=d.indexOf(a);if(c.getLayoutType()===ccui.Layout.LINEAR_HORIZONTAL){if(b===ccui.Widget.LEFT)return 0===e?this._isLastWidgetInContainer(c,b):!1;if(b===ccui.Widget.RIGHT)return e===d.length-1?this._isLastWidgetInContainer(c,b):!1;if(b===ccui.Widget.DOWN||b===ccui.Widget.UP)return this._isLastWidgetInContainer(c,b)}else if(c.getLayoutType()===ccui.Layout.LINEAR_VERTICAL){if(b===ccui.Widget.UP)return 0===e?this._isLastWidgetInContainer(c,
b):!1;if(b===ccui.Widget.DOWN)return e===d.length-1?this._isLastWidgetInContainer(c,b):!1;if(b===ccui.Widget.LEFT||b===ccui.Widget.RIGHT)return this._isLastWidgetInContainer(c,b)}else return cc.log("invalid layout Type"),!1},_isWidgetAncestorSupportLoopFocus:function(a,b){var c=a.getParent();if(null==c||!(c instanceof ccui.Layout))return!1;if(c.isLoopFocus()){var d=c.getLayoutType();if(d===ccui.Layout.LINEAR_HORIZONTAL)return b===ccui.Widget.LEFT||b===ccui.Widget.RIGHT?!0:this._isWidgetAncestorSupportLoopFocus(c,
b);if(d===ccui.Layout.LINEAR_VERTICAL)return b===ccui.Widget.DOWN||b===ccui.Widget.UP?!0:this._isWidgetAncestorSupportLoopFocus(c,b);cc.assert(0,"invalid layout type");return!1}return this._isWidgetAncestorSupportLoopFocus(c,b)},_passFocusToChild:function(a,b){if(this._checkFocusEnabledChild()){var c=ccui.Widget.getCurrentFocusedWidget();this._findProperSearchingFunctor(a,c);c=this.onPassFocusToChild(a,c);c=this._getChildWidgetByIndex(c);if(c instanceof ccui.Layout)return c._isFocusPassing=!0,c.findNextFocusedWidget(a,
c);this.dispatchFocusEvent(b,c);return c}return this},_checkFocusEnabledChild:function(){for(var a=this._children,b=0,c=a.length;b<c;b++){var d=a[b];if(d&&d instanceof ccui.Widget&&d.isFocusEnabled())return!0}return!1},getDescription:function(){return"Layout"},_createCloneInstance:function(){return new ccui.Layout},_copyClonedWidgetChildren:function(a){ccui.Widget.prototype._copyClonedWidgetChildren.call(this,a)},_copySpecialProperties:function(a){a instanceof ccui.Layout&&(this.setBackGroundImageScale9Enabled(a._backGroundScale9Enabled),
this.setBackGroundImage(a._backGroundImageFileName,a._bgImageTexType),this.setBackGroundImageCapInsets(a._backGroundImageCapInsets),this.setBackGroundColorType(a._colorType),this.setBackGroundColor(a._color),this.setBackGroundColor(a._startColor,a._endColor),this.setBackGroundColorOpacity(a._opacity),this.setBackGroundColorVector(a._alongVector),this.setLayoutType(a._layoutType),this.setClippingEnabled(a._clippingEnabled),this.setClippingType(a._clippingType),this._loopFocus=a._loopFocus,this.__passFocusToChild=
a.__passFocusToChild,this._isInterceptTouch=a._isInterceptTouch)},forceDoLayout:function(){this.requestDoLayout();this._doLayout()},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new ccui.Layout.WebGLRenderCmd(this):new ccui.Layout.CanvasRenderCmd(this)}});_p=ccui.Layout.prototype;cc.defineGetterSetter(_p,"clippingEnabled",_p.isClippingEnabled,_p.setClippingEnabled);cc.defineGetterSetter(_p,"clippingType",null,_p.setClippingType);
cc.defineGetterSetter(_p,"layoutType",_p.getLayoutType,_p.setLayoutType);_p=null;ccui.Layout.create=function(){return new ccui.Layout};ccui.Layout.BG_COLOR_NONE=0;ccui.Layout.BG_COLOR_SOLID=1;ccui.Layout.BG_COLOR_GRADIENT=2;ccui.Layout.ABSOLUTE=0;ccui.Layout.LINEAR_VERTICAL=1;ccui.Layout.LINEAR_HORIZONTAL=2;ccui.Layout.RELATIVE=3;ccui.Layout.CLIPPING_STENCIL=0;ccui.Layout.CLIPPING_SCISSOR=1;ccui.Layout.BACKGROUND_IMAGE_ZORDER=-1;ccui.Layout.BACKGROUND_RENDERER_ZORDER=-2;(function(){ccui.Layout.CanvasRenderCmd=function(a){this._pNodeCmdCtor(a);this._needDraw=!1;this._rendererRestoreCmd=this._rendererClipCmd=this._rendererSaveCmd=null};var a=ccui.Layout.CanvasRenderCmd.prototype=Object.create(ccui.ProtectedNode.CanvasRenderCmd.prototype);a.constructor=ccui.Layout.CanvasRenderCmd;a._layoutCmdCtor=ccui.Layout.CanvasRenderCmd;a._onRenderSaveCmd=function(a,c,d){var e=a||cc._renderContext;a=e.getContext();e.save();e.save();e.setTransform(this._worldTransform,c,d);c=this._node._clippingStencil._renderCmd._buffer;
d=0;for(e=c.length;d<e;d++){var f=c[d].verts,g=f[0];a.beginPath();a.moveTo(g.x,-g.y);for(var g=1,h=f.length;g<h;g++)a.lineTo(f[g].x,-f[g].y);a.closePath()}};a._onRenderClipCmd=function(a){a=a||cc._renderContext;var c=a.getContext();a.restore();c.clip()};a._onRenderRestoreCmd=function(a){a=a||cc._renderContext;a.getContext();a.restore()};a.rebindStencilRendering=function(a){a._renderCmd.rendering=this.__stencilDraw;a._renderCmd._canUseDirtyRegion=!0};a.__stencilDraw=function(a,c,d){};a.stencilClippingVisit=
a.scissorClippingVisit=function(a){a=this._node;a._clippingStencil&&a._clippingStencil.isVisible()&&(this._rendererSaveCmd||(this._rendererSaveCmd=new cc.CustomRenderCmd(this,this._onRenderSaveCmd),this._rendererClipCmd=new cc.CustomRenderCmd(this,this._onRenderClipCmd),this._rendererRestoreCmd=new cc.CustomRenderCmd(this,this._onRenderRestoreCmd)),cc.renderer.pushRenderCommand(this._rendererSaveCmd),a._clippingStencil.visit(this),cc.renderer.pushRenderCommand(this._rendererClipCmd))};a.postStencilVisit=
a.postScissorVisit=function(){cc.renderer.pushRenderCommand(this._rendererRestoreCmd)};ccui.Layout.CanvasRenderCmd._getSharedCache=function(){return cc.ClippingNode._sharedCache||(cc.ClippingNode._sharedCache=document.createElement("canvas"))}})();(function(){if(ccui.ProtectedNode.WebGLRenderCmd){ccui.Layout.WebGLRenderCmd=function(a){this._pNodeCmdCtor(a);this._needDraw=!1;this._currentStencilEnabled=0;this._scissorOldState=!1;this._clippingOldRect=null;this._mask_layer_le=0;this._afterVisitCmdScissor=this._beforeVisitCmdScissor=this._afterVisitCmdStencil=this._afterDrawStencilCmd=this._beforeVisitCmdStencil=null};var a=ccui.Layout.WebGLRenderCmd.prototype=Object.create(ccui.ProtectedNode.WebGLRenderCmd.prototype);a.constructor=ccui.Layout.WebGLRenderCmd;
a._layoutCmdCtor=ccui.Layout.CanvasRenderCmd;a._syncStatus=function(a){this._originSyncStatus(a);a&&a._dirtyFlag&cc.Node._dirtyFlags.transformDirty&&(this._node._clippingRectDirty=!0)};a._onBeforeVisitStencil=function(a){a=a||cc._renderContext;ccui.Layout.WebGLRenderCmd._layer++;var c=1<<ccui.Layout.WebGLRenderCmd._layer;this._mask_layer_le=c|c-1;this._currentStencilEnabled=a.isEnabled(a.STENCIL_TEST);a.clear(a.DEPTH_BUFFER_BIT);a.enable(a.STENCIL_TEST);a.depthMask(!1);a.stencilFunc(a.NEVER,c,c);
a.stencilOp(a.REPLACE,a.KEEP,a.KEEP);a.stencilMask(c);a.clear(a.STENCIL_BUFFER_BIT)};a._onAfterDrawStencil=function(a){a=a||cc._renderContext;a.depthMask(!0);a.stencilFunc(a.EQUAL,this._mask_layer_le,this._mask_layer_le);a.stencilOp(a.KEEP,a.KEEP,a.KEEP)};a._onAfterVisitStencil=function(a){a=a||cc._renderContext;ccui.Layout.WebGLRenderCmd._layer--;if(this._currentStencilEnabled){var c=1<<ccui.Layout.WebGLRenderCmd._layer,d=c|c-1;a.stencilMask(c);a.stencilFunc(a.EQUAL,d,d)}else a.disable(a.STENCIL_TEST)};
a._onBeforeVisitScissor=function(a){this._node._clippingRectDirty=!0;var c=this._node._getClippingRect();a=a||cc._renderContext;(this._scissorOldState=a.isEnabled(a.SCISSOR_TEST))?(this._clippingOldRect=cc.view.getScissorRect(),cc.rectEqualToRect(this._clippingOldRect,c)||cc.view.setScissorInPoints(c.x,c.y,c.width,c.height)):(a.enable(a.SCISSOR_TEST),cc.view.setScissorInPoints(c.x,c.y,c.width,c.height))};a._onAfterVisitScissor=function(a){a=a||cc._renderContext;this._scissorOldState?cc.rectEqualToRect(this._clippingOldRect,
this._node._clippingRect)||cc.view.setScissorInPoints(this._clippingOldRect.x,this._clippingOldRect.y,this._clippingOldRect.width,this._clippingOldRect.height):a.disable(a.SCISSOR_TEST)};a.rebindStencilRendering=function(a){};a.transform=function(a,c){var d=this._node;this.pNodeTransform(a,c);d._clippingStencil&&d._clippingStencil._renderCmd.transform(this,c)};a.stencilClippingVisit=function(a){a=this._node;if(a._clippingStencil&&a._clippingStencil.isVisible())if(ccui.Layout.WebGLRenderCmd._layer+
1===cc.stencilBits)ccui.Layout.WebGLRenderCmd._visit_once=!0,ccui.Layout.WebGLRenderCmd._visit_once&&(cc.log("Nesting more than "+cc.stencilBits+"stencils is not supported. Everything will be drawn without stencil for this node and its childs."),ccui.Layout.WebGLRenderCmd._visit_once=!1);else{this._beforeVisitCmdStencil||(this._beforeVisitCmdStencil=new cc.CustomRenderCmd(this,this._onBeforeVisitStencil),this._afterDrawStencilCmd=new cc.CustomRenderCmd(this,this._onAfterDrawStencil),this._afterVisitCmdStencil=
new cc.CustomRenderCmd(this,this._onAfterVisitStencil));cc.renderer.pushRenderCommand(this._beforeVisitCmdStencil);var c=cc.current_stack;c.stack.push(c.top);c.top=this._stackMatrix;a._clippingStencil.visit(this);cc.renderer.pushRenderCommand(this._afterDrawStencilCmd)}};a.postStencilVisit=function(){renderer.pushRenderCommand(cmd._afterVisitCmdStencil);cc.current_stack.top=cc.current_stack.stack.pop()};a.scissorClippingVisit=function(a){this._beforeVisitCmdScissor||(this._beforeVisitCmdScissor=new cc.CustomRenderCmd(this,
this._onBeforeVisitScissor),this._afterVisitCmdScissor=new cc.CustomRenderCmd(this,this._onAfterVisitScissor));cc.renderer.pushRenderCommand(this._beforeVisitCmdScissor)};a.postScissorVisit=function(){cc.renderer.pushRenderCommand(this._afterVisitCmdScissor)};ccui.Layout.WebGLRenderCmd._layer=-1;ccui.Layout.WebGLRenderCmd._visit_once=null}})();ccui.Margin=ccui.Class.extend({left:0,top:0,right:0,bottom:0,ctor:function(a,b,c,d){void 0!==a&&void 0===b&&(this.left=a.left,this.top=a.top,this.right=a.right,this.bottom=a.bottom);void 0!==d&&(this.left=a,this.top=b,this.right=c,this.bottom=d)},setMargin:function(a,b,c,d){this.left=a;this.top=b;this.right=c;this.bottom=d},equals:function(a){return this.left===a.left&&this.top===a.top&&this.right===a.right&&this.bottom===a.bottom}});ccui.MarginZero=function(){return new ccui.Margin(0,0,0,0)};
ccui.LayoutParameter=ccui.Class.extend({_margin:null,_layoutParameterType:null,ctor:function(){this._margin=new ccui.Margin;this._layoutParameterType=ccui.LayoutParameter.NONE},setMargin:function(a,b,c,d){cc.isObject(a)?(this._margin.left=a.left,this._margin.top=a.top,this._margin.right=a.right,this._margin.bottom=a.bottom):(this._margin.left=a,this._margin.top=b,this._margin.right=c,this._margin.bottom=d)},getMargin:function(){return this._margin},getLayoutType:function(){return this._layoutParameterType},
clone:function(){var a=this._createCloneInstance();a._copyProperties(this);return a},_createCloneInstance:function(){return new ccui.LayoutParameter},_copyProperties:function(a){this._margin.bottom=a._margin.bottom;this._margin.left=a._margin.left;this._margin.right=a._margin.right;this._margin.top=a._margin.top}});ccui.LayoutParameter.create=function(){return new ccui.LayoutParameter};ccui.LayoutParameter.NONE=0;ccui.LayoutParameter.LINEAR=1;ccui.LayoutParameter.RELATIVE=2;
ccui.LinearLayoutParameter=ccui.LayoutParameter.extend({_linearGravity:null,ctor:function(){ccui.LayoutParameter.prototype.ctor.call(this);this._linearGravity=ccui.LinearLayoutParameter.NONE;this._layoutParameterType=ccui.LayoutParameter.LINEAR},setGravity:function(a){this._linearGravity=a},getGravity:function(){return this._linearGravity},_createCloneInstance:function(){return new ccui.LinearLayoutParameter},_copyProperties:function(a){ccui.LayoutParameter.prototype._copyProperties.call(this,a);
a instanceof ccui.LinearLayoutParameter&&this.setGravity(a._linearGravity)}});ccui.LinearLayoutParameter.create=function(){return new ccui.LinearLayoutParameter};ccui.LinearLayoutParameter.NONE=0;ccui.LinearLayoutParameter.LEFT=1;ccui.LinearLayoutParameter.TOP=2;ccui.LinearLayoutParameter.RIGHT=3;ccui.LinearLayoutParameter.BOTTOM=4;ccui.LinearLayoutParameter.CENTER_VERTICAL=5;ccui.LinearLayoutParameter.CENTER_HORIZONTAL=6;
ccui.RelativeLayoutParameter=ccui.LayoutParameter.extend({_relativeAlign:null,_relativeWidgetName:"",_relativeLayoutName:"",_put:!1,ctor:function(){ccui.LayoutParameter.prototype.ctor.call(this);this._relativeAlign=ccui.RelativeLayoutParameter.NONE;this._relativeLayoutName=this._relativeWidgetName="";this._put=!1;this._layoutParameterType=ccui.LayoutParameter.RELATIVE},setAlign:function(a){this._relativeAlign=a},getAlign:function(){return this._relativeAlign},setRelativeToWidgetName:function(a){this._relativeWidgetName=
a},getRelativeToWidgetName:function(){return this._relativeWidgetName},setRelativeName:function(a){this._relativeLayoutName=a},getRelativeName:function(){return this._relativeLayoutName},_createCloneInstance:function(){return new ccui.RelativeLayoutParameter},_copyProperties:function(a){ccui.LayoutParameter.prototype._copyProperties.call(this,a);a instanceof ccui.RelativeLayoutParameter&&(this.setAlign(a._relativeAlign),this.setRelativeToWidgetName(a._relativeWidgetName),this.setRelativeName(a._relativeLayoutName))}});
ccui.RelativeLayoutParameter.create=function(){return new ccui.RelativeLayoutParameter};ccui.RelativeLayoutParameter.NONE=0;ccui.RelativeLayoutParameter.PARENT_TOP_LEFT=1;ccui.RelativeLayoutParameter.PARENT_TOP_CENTER_HORIZONTAL=2;ccui.RelativeLayoutParameter.PARENT_TOP_RIGHT=3;ccui.RelativeLayoutParameter.PARENT_LEFT_CENTER_VERTICAL=4;ccui.RelativeLayoutParameter.CENTER_IN_PARENT=5;ccui.RelativeLayoutParameter.PARENT_RIGHT_CENTER_VERTICAL=6;ccui.RelativeLayoutParameter.PARENT_LEFT_BOTTOM=7;
ccui.RelativeLayoutParameter.PARENT_BOTTOM_CENTER_HORIZONTAL=8;ccui.RelativeLayoutParameter.PARENT_RIGHT_BOTTOM=9;ccui.RelativeLayoutParameter.LOCATION_ABOVE_LEFTALIGN=10;ccui.RelativeLayoutParameter.LOCATION_ABOVE_CENTER=11;ccui.RelativeLayoutParameter.LOCATION_ABOVE_RIGHTALIGN=12;ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_TOPALIGN=13;ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_CENTER=14;ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_BOTTOMALIGN=15;
ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_TOPALIGN=16;ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_CENTER=17;ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_BOTTOMALIGN=18;ccui.RelativeLayoutParameter.LOCATION_BELOW_LEFTALIGN=19;ccui.RelativeLayoutParameter.LOCATION_BELOW_CENTER=20;ccui.RelativeLayoutParameter.LOCATION_BELOW_RIGHTALIGN=21;ccui.LINEAR_GRAVITY_NONE=0;ccui.LINEAR_GRAVITY_LEFT=1;ccui.LINEAR_GRAVITY_TOP=2;ccui.LINEAR_GRAVITY_RIGHT=3;ccui.LINEAR_GRAVITY_BOTTOM=4;
ccui.LINEAR_GRAVITY_CENTER_VERTICAL=5;ccui.LINEAR_GRAVITY_CENTER_HORIZONTAL=6;ccui.RELATIVE_ALIGN_NONE=0;ccui.RELATIVE_ALIGN_PARENT_TOP_LEFT=1;ccui.RELATIVE_ALIGN_PARENT_TOP_CENTER_HORIZONTAL=2;ccui.RELATIVE_ALIGN_PARENT_TOP_RIGHT=3;ccui.RELATIVE_ALIGN_PARENT_LEFT_CENTER_VERTICAL=4;ccui.RELATIVE_ALIGN_PARENT_CENTER=5;ccui.RELATIVE_ALIGN_PARENT_RIGHT_CENTER_VERTICAL=6;ccui.RELATIVE_ALIGN_PARENT_LEFT_BOTTOM=7;ccui.RELATIVE_ALIGN_PARENT_BOTTOM_CENTER_HORIZONTAL=8;
ccui.RELATIVE_ALIGN_PARENT_RIGHT_BOTTOM=9;ccui.RELATIVE_ALIGN_LOCATION_ABOVE_LEFT=10;ccui.RELATIVE_ALIGN_LOCATION_ABOVE_CENTER=11;ccui.RELATIVE_ALIGN_LOCATION_ABOVE_RIGHT=12;ccui.RELATIVE_ALIGN_LOCATION_LEFT_TOP=13;ccui.RELATIVE_ALIGN_LOCATION_LEFT_CENTER=14;ccui.RELATIVE_ALIGN_LOCATION_LEFT_BOTTOM=15;ccui.RELATIVE_ALIGN_LOCATION_RIGHT_TOP=16;ccui.RELATIVE_ALIGN_LOCATION_RIGHT_CENTER=17;ccui.RELATIVE_ALIGN_LOCATION_RIGHT_BOTTOM=18;ccui.RELATIVE_ALIGN_LOCATION_BELOW_TOP=19;
ccui.RELATIVE_ALIGN_LOCATION_BELOW_CENTER=20;ccui.RELATIVE_ALIGN_LOCATION_BELOW_BOTTOM=21;ccui.getLayoutManager=function(a){switch(a){case ccui.Layout.LINEAR_VERTICAL:return ccui.linearVerticalLayoutManager;case ccui.Layout.LINEAR_HORIZONTAL:return ccui.linearHorizontalLayoutManager;case ccui.Layout.RELATIVE:return ccui.relativeLayoutManager}return null};
ccui.linearVerticalLayoutManager={_doLayout:function(a){var b=a._getLayoutContentSize();a=a._getLayoutElements();for(var c=b.height,d=0,e=a.length;d<e;d++){var f=a[d];if(f){var g=f.getLayoutParameter();if(g){var h=g.getGravity(),k=f.getAnchorPoint(),m=f.getContentSize(),n=k.x*m.width,c=c-(1-k.y)*m.height;switch(h){case ccui.LinearLayoutParameter.RIGHT:n=b.width-(1-k.x)*m.width;break;case ccui.LinearLayoutParameter.CENTER_HORIZONTAL:n=b.width/2-m.width*(0.5-k.x)}g=g.getMargin();n+=g.left;c-=g.top;
f.setPosition(n,c);c=f.getPositionY()-k.y*m.height-g.bottom}}}}};
ccui.linearHorizontalLayoutManager={_doLayout:function(a){var b=a._getLayoutContentSize();a=a._getLayoutElements();for(var c=0,d=0,e=a.length;d<e;d++){var f=a[d];if(f){var g=f.getLayoutParameter();if(g){var h=g.getGravity(),k=f.getAnchorPoint(),m=f.getContentSize(),c=c+k.x*m.width,n=b.height-(1-k.y)*m.height;switch(h){case ccui.LinearLayoutParameter.BOTTOM:n=k.y*m.height;break;case ccui.LinearLayoutParameter.CENTER_VERTICAL:n=b.height/2-m.height*(0.5-k.y)}g=g.getMargin();c+=g.left;n-=g.top;f.setPosition(c,
n);c=f.getRightBoundary()+g.right}}}}};
ccui.relativeLayoutManager={_unlayoutChildCount:0,_widgetChildren:[],_widget:null,_finalPositionX:0,_finalPositionY:0,_relativeWidgetLP:null,_doLayout:function(a){for(var b=this._widgetChildren=this._getAllWidgets(a);0<this._unlayoutChildCount;){for(var c=0,d=b.length;c<d;c++){this._widget=b[c];var e=this._widget.getLayoutParameter();e&&!e._put&&this._calculateFinalPositionWithRelativeWidget(a)&&(this._calculateFinalPositionWithRelativeAlign(),this._widget.setPosition(this._finalPositionX,this._finalPositionY),
e._put=!0)}this._unlayoutChildCount--}this._widgetChildren.length=0},_getAllWidgets:function(a){a=a._getLayoutElements();for(var b=this._widgetChildren,c=b.length=0,d=a.length;c<d;c++){var e=a[c];e&&e instanceof ccui.Widget&&(e.getLayoutParameter()._put=!1,this._unlayoutChildCount++,b.push(e))}return b},_getRelativeWidget:function(a){var b=null;if((a=a.getLayoutParameter().getRelativeToWidgetName())&&0!==a.length)for(var c=this._widgetChildren,d=0,e=c.length;d<e;d++){var f=c[d];if(f){var g=f.getLayoutParameter();
if(g&&g.getRelativeName()===a){b=f;this._relativeWidgetLP=g;break}}}return b},_calculateFinalPositionWithRelativeWidget:function(a){var b=this._widget,c=b.getAnchorPoint(),d=b.getContentSize();this._finalPositionY=this._finalPositionX=0;var e=this._getRelativeWidget(b),b=b.getLayoutParameter().getAlign();a=a._getLayoutContentSize();switch(b){case ccui.RelativeLayoutParameter.NONE:case ccui.RelativeLayoutParameter.PARENT_TOP_LEFT:this._finalPositionX=c.x*d.width;this._finalPositionY=a.height-(1-c.y)*
d.height;break;case ccui.RelativeLayoutParameter.PARENT_TOP_CENTER_HORIZONTAL:this._finalPositionX=0.5*a.width-d.width*(0.5-c.x);this._finalPositionY=a.height-(1-c.y)*d.height;break;case ccui.RelativeLayoutParameter.PARENT_TOP_RIGHT:this._finalPositionX=a.width-(1-c.x)*d.width;this._finalPositionY=a.height-(1-c.y)*d.height;break;case ccui.RelativeLayoutParameter.PARENT_LEFT_CENTER_VERTICAL:this._finalPositionX=c.x*d.width;this._finalPositionY=0.5*a.height-d.height*(0.5-c.y);break;case ccui.RelativeLayoutParameter.CENTER_IN_PARENT:this._finalPositionX=
0.5*a.width-d.width*(0.5-c.x);this._finalPositionY=0.5*a.height-d.height*(0.5-c.y);break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_CENTER_VERTICAL:this._finalPositionX=a.width-(1-c.x)*d.width;this._finalPositionY=0.5*a.height-d.height*(0.5-c.y);break;case ccui.RelativeLayoutParameter.PARENT_LEFT_BOTTOM:this._finalPositionX=c.x*d.width;this._finalPositionY=c.y*d.height;break;case ccui.RelativeLayoutParameter.PARENT_BOTTOM_CENTER_HORIZONTAL:this._finalPositionX=0.5*a.width-d.width*(0.5-c.x);this._finalPositionY=
c.y*d.height;break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_BOTTOM:this._finalPositionX=a.width-(1-c.x)*d.width;this._finalPositionY=c.y*d.height;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_LEFTALIGN:if(e){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=e.getTopBoundary()+c.y*d.height;this._finalPositionX=e.getLeftBoundary()+c.x*d.width}break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_CENTER:if(e){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;
a=e.getContentSize();this._finalPositionY=e.getTopBoundary()+c.y*d.height;this._finalPositionX=e.getLeftBoundary()+0.5*a.width+c.x*d.width-0.5*d.width}break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_RIGHTALIGN:if(e){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=e.getTopBoundary()+c.y*d.height;this._finalPositionX=e.getRightBoundary()-(1-c.x)*d.width}break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_TOPALIGN:if(e){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;
this._finalPositionY=e.getTopBoundary()-(1-c.y)*d.height;this._finalPositionX=e.getLeftBoundary()-(1-c.x)*d.width}break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_CENTER:if(e){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;a=e.getContentSize();this._finalPositionX=e.getLeftBoundary()-(1-c.x)*d.width;this._finalPositionY=e.getBottomBoundary()+0.5*a.height+c.y*d.height-0.5*d.height}break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_BOTTOMALIGN:if(e){if(this._relativeWidgetLP&&
!this._relativeWidgetLP._put)return!1;this._finalPositionY=e.getBottomBoundary()+c.y*d.height;this._finalPositionX=e.getLeftBoundary()-(1-c.x)*d.width}break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_TOPALIGN:if(e){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=e.getTopBoundary()-(1-c.y)*d.height;this._finalPositionX=e.getRightBoundary()+c.x*d.width}break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_CENTER:if(e){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;
a=e.getContentSize();this._finalPositionX=e.getRightBoundary()+c.x*d.width;this._finalPositionY=e.getBottomBoundary()+0.5*a.height+c.y*d.height-0.5*d.height}break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_BOTTOMALIGN:if(e){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;this._finalPositionY=e.getBottomBoundary()+c.y*d.height;this._finalPositionX=e.getRightBoundary()+c.x*d.width}break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_LEFTALIGN:if(e){if(this._relativeWidgetLP&&
!this._relativeWidgetLP._put)return!1;this._finalPositionY=e.getBottomBoundary()-(1-c.y)*d.height;this._finalPositionX=e.getLeftBoundary()+c.x*d.width}break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_CENTER:if(e){if(this._relativeWidgetLP&&!this._relativeWidgetLP._put)return!1;a=e.getContentSize();this._finalPositionY=e.getBottomBoundary()-(1-c.y)*d.height;this._finalPositionX=e.getLeftBoundary()+0.5*a.width+c.x*d.width-0.5*d.width}break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_RIGHTALIGN:if(e){if(this._relativeWidgetLP&&
!this._relativeWidgetLP._put)return!1;this._finalPositionY=e.getBottomBoundary()-(1-c.y)*d.height;this._finalPositionX=e.getRightBoundary()-(1-c.x)*d.width}}return!0},_calculateFinalPositionWithRelativeAlign:function(){var a=this._widget.getLayoutParameter(),b=a.getMargin();switch(a.getAlign()){case ccui.RelativeLayoutParameter.NONE:case ccui.RelativeLayoutParameter.PARENT_TOP_LEFT:this._finalPositionX+=b.left;this._finalPositionY-=b.top;break;case ccui.RelativeLayoutParameter.PARENT_TOP_CENTER_HORIZONTAL:this._finalPositionY-=
b.top;break;case ccui.RelativeLayoutParameter.PARENT_TOP_RIGHT:this._finalPositionX-=b.right;this._finalPositionY-=b.top;break;case ccui.RelativeLayoutParameter.PARENT_LEFT_CENTER_VERTICAL:this._finalPositionX+=b.left;break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_CENTER_VERTICAL:this._finalPositionX-=b.right;break;case ccui.RelativeLayoutParameter.PARENT_LEFT_BOTTOM:this._finalPositionX+=b.left;this._finalPositionY+=b.bottom;break;case ccui.RelativeLayoutParameter.PARENT_BOTTOM_CENTER_HORIZONTAL:this._finalPositionY+=
b.bottom;break;case ccui.RelativeLayoutParameter.PARENT_RIGHT_BOTTOM:this._finalPositionX-=b.right;this._finalPositionY+=b.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_LEFTALIGN:this._finalPositionY+=b.bottom;this._finalPositionX+=b.left;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_RIGHTALIGN:this._finalPositionY+=b.bottom;this._finalPositionX-=b.right;break;case ccui.RelativeLayoutParameter.LOCATION_ABOVE_CENTER:this._finalPositionY+=b.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_TOPALIGN:this._finalPositionX-=
b.right;this._finalPositionY-=b.top;break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_BOTTOMALIGN:this._finalPositionX-=b.right;this._finalPositionY+=b.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_LEFT_OF_CENTER:this._finalPositionX-=b.right;break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_TOPALIGN:this._finalPositionX+=b.left;this._finalPositionY-=b.top;break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_BOTTOMALIGN:this._finalPositionX+=b.left;this._finalPositionY+=
b.bottom;break;case ccui.RelativeLayoutParameter.LOCATION_RIGHT_OF_CENTER:this._finalPositionX+=b.left;break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_LEFTALIGN:this._finalPositionY-=b.top;this._finalPositionX+=b.left;break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_RIGHTALIGN:this._finalPositionY-=b.top;this._finalPositionX-=b.right;break;case ccui.RelativeLayoutParameter.LOCATION_BELOW_CENTER:this._finalPositionY-=b.top}}};ccui.HBox=ccui.Layout.extend({ctor:function(a){ccui.Layout.prototype.ctor.call(this);this.setLayoutType(ccui.Layout.LINEAR_HORIZONTAL);a&&this.setContentSize(a)}});ccui.HBox.create=function(a){return new ccui.HBox(a)};ccui.RelativeBox=ccui.Layout.extend({ctor:function(a){ccui.Layout.prototype.ctor.call(this);this.setLayoutType(ccui.Layout.RELATIVE);a&&this.setContentSize(a)}});ccui.RelativeBox.create=function(a){return new ccui.RelativeBox(a)};ccui.VBox=ccui.Layout.extend({ctor:function(a){ccui.Layout.prototype.ctor.call(this);this.setLayoutType(ccui.Layout.LINEAR_VERTICAL);a&&this.setContentSize(a)},initWithSize:function(a){return this.init()?!0:!1}});ccui.VBox.create=function(a){return new ccui.VBox(a)};ccui.helper={seekWidgetByTag:function(a,b){if(!a)return null;if(a.getTag()===b)return a;for(var c=a.getChildren(),d=c.length,e=0;e<d;e++){var f=ccui.helper.seekWidgetByTag(c[e],b);if(null!==f)return f}return null},seekWidgetByName:function(a,b){if(!a)return null;if(a.getName()===b)return a;for(var c=a.getChildren(),d=c.length,e=0;e<d;e++){var f=ccui.helper.seekWidgetByName(c[e],b);if(null!==f)return f}return null},seekWidgetByRelativeName:function(a,b){if(!a)return null;for(var c=a.getChildren(),
d=c.length,e=0;e<d;e++){var f=c[e],g=f.getLayoutParameter(ccui.LayoutParameter.RELATIVE);if(g&&g.getRelativeName()===b)return f}return null},seekActionWidgetByActionTag:function(a,b){if(!a)return null;if(a.getActionTag()===b)return a;for(var c=a.getChildren(),d=0;d<c.length;d++){var e=ccui.helper.seekActionWidgetByActionTag(c[d],b);if(null!==e)return e}return null},_activeLayout:!0,doLayout:function(a){if(this._activeLayout){a=a.getChildren();for(var b,c=0,d=a.length;c<d;c++){b=a[c];var e=b.getComponent(ccui.LayoutComponent.NAME);
b=b.getParent();null!=e&&null!==b&&e.refreshLayout&&e.refreshLayout()}}},changeLayoutSystemActiveState:function(a){this._activeLayout=a},restrictCapInsetRect:function(a,b){var c=a.x,d=a.y,e=a.width,f=a.height;b.width<e&&(e=c=0);b.height<f&&(f=d=0);return cc.rect(c,d,e,f)},_createSpriteFromBase64:function(a,b){var c=cc.textureCache.getTextureForKey(b);c||(c=new Image,c.src=a,cc.textureCache.cacheImage(b,c),c=cc.textureCache.getTextureForKey(b));return new cc.Sprite(c)}};ccui.Button=ccui.Widget.extend({_buttonScale9Renderer:null,_buttonNormalSpriteFrame:null,_buttonClickedSpriteFrame:null,_buttonDisableSpriteFrame:null,_titleRenderer:null,_normalFileName:"",_clickedFileName:"",_disabledFileName:"",_prevIgnoreSize:!0,_scale9Enabled:!1,_capInsetsNormal:null,_normalTexType:ccui.Widget.LOCAL_TEXTURE,_pressedTexType:ccui.Widget.LOCAL_TEXTURE,_disabledTexType:ccui.Widget.LOCAL_TEXTURE,_normalTextureSize:null,pressedActionEnabled:!1,_titleColor:null,_zoomScale:0.1,_normalTextureLoaded:!1,
_pressedTextureLoaded:!1,_disabledTextureLoaded:!1,_className:"Button",_normalTextureAdaptDirty:!0,_fontName:"Thonburi",_fontSize:12,_type:0,ctor:function(a,b,c,d){this._capInsetsNormal=cc.rect(0,0,0,0);this._normalTextureSize=cc.size(0,0);ccui.Widget.prototype.ctor.call(this);this.setTouchEnabled(!0);this._normalLoader=new cc.Sprite.LoadManager;this._clickedLoader=new cc.Sprite.LoadManager;this._disabledLoader=new cc.Sprite.LoadManager;a&&this.loadTextures(a,b,c,d)},_createTitleRendererIfNeeded:function(){this._titleRenderer||
(this._titleRenderer=new cc.LabelTTF(""),this._titleRenderer.setAnchorPoint(0.5,0.5),this._titleColor=cc.color.WHITE,this._titleRenderer.setVerticalAlignment(cc.VERTICAL_TEXT_ALIGNMENT_CENTER),this.addProtectedChild(this._titleRenderer,ccui.Button.TITLE_RENDERER_ZORDER,-1))},_initRenderer:function(){this._buttonScale9Renderer=new ccui.Scale9Sprite;this._buttonScale9Renderer.setRenderingType(ccui.Scale9Sprite.RenderingType.SIMPLE);this.addProtectedChild(this._buttonScale9Renderer,ccui.Button.DISABLED_RENDERER_ZORDER,
-1)},setScale9Enabled:function(a){this._scale9Enabled!==a&&(this._brightStyle=ccui.Widget.BRIGHT_STYLE_NONE,(this._scale9Enabled=a)?this._buttonScale9Renderer.setRenderingType(ccui.Scale9Sprite.RenderingType.SLICED):this._buttonScale9Renderer.setRenderingType(ccui.Scale9Sprite.RenderingType.SIMPLE),this._scale9Enabled?(a=this._ignoreSize,this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=a):this.ignoreContentAdaptWithSize(this._prevIgnoreSize),this.setCapInsets(this._capInsetsNormal),this.setBright(this._bright),
this._normalTextureAdaptDirty=!0)},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(a){if(this._unifySize)this._updateContentSize();else if(!this._scale9Enabled||this._scale9Enabled&&!a)ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,a),this._prevIgnoreSize=a},getVirtualRendererSize:function(){return this._unifySize?this._getNormalSize():!this._normalTextureLoaded&&this._titleRenderer&&0<this._titleRenderer.getString().length?this._titleRenderer.getContentSize():
cc.size(this._normalTextureSize)},loadTextures:function(a,b,c,d){this.loadTextureNormal(a,d);this.loadTexturePressed(b,d);this.loadTextureDisabled(c,d)},_createSpriteFrameWithFile:function(a){var b=cc.textureCache.getTextureForKey(a);b||(b=cc.textureCache.addImage(a));if(!b._textureLoaded)return b;a=b.getContentSize();a=cc.rect(0,0,a.width,a.height);return new cc.SpriteFrame(b,a)},_createSpriteFrameWithName:function(a){a=cc.spriteFrameCache.getSpriteFrame(a);return null==a?(cc.log("ccui.Scale9Sprite.initWithSpriteFrameName(): can't find the sprite frame by spriteFrameName"),
null):a},loadTextureNormal:function(a,b){if(a){b=b||ccui.Widget.LOCAL_TEXTURE;this._normalFileName=a;this._normalTexType=b;var c;switch(this._normalTexType){case ccui.Widget.LOCAL_TEXTURE:c=this._createSpriteFrameWithFile(a);break;case ccui.Widget.PLIST_TEXTURE:"#"===a[0]&&(a=a.substr(1,a.length-1)),c=this._createSpriteFrameWithName(a)}c&&(c._textureLoaded?(this._normalTextureLoaded=c._textureLoaded,this._buttonNormalSpriteFrame=c,this._buttonScale9Renderer.setSpriteFrame(c),this._scale9Enabled&&
this._buttonScale9Renderer.setCapInsets(this._capInsetsNormal),!this._ignoreSize&&cc.sizeEqualToSize(this._customSize,cc.size(0,0))&&(this._customSize=this._buttonScale9Renderer.getContentSize()),this._normalTextureSize=this._buttonScale9Renderer.getContentSize(),this._updateChildrenDisplayedRGBA(),this._unifySize?this._scale9Enabled&&(this._buttonScale9Renderer.setCapInsets(this._capInsetsNormal),this._updateContentSizeWithTextureSize(this._getNormalSize())):this._updateContentSizeWithTextureSize(this._normalTextureSize),
this._normalTextureAdaptDirty=!0,this._findLayout()):(this._normalLoader.clear(),this._normalLoader.once(c,function(){this.loadTextureNormal(this._normalFileName,this._normalTexType)},this)))}},loadTexturePressed:function(a,b){if(a){b=b||ccui.Widget.LOCAL_TEXTURE;this._clickedFileName=a;this._pressedTexType=b;var c;switch(this._pressedTexType){case ccui.Widget.LOCAL_TEXTURE:c=this._createSpriteFrameWithFile(a);break;case ccui.Widget.PLIST_TEXTURE:"#"===a[0]&&(a=a.substr(1,a.length-1)),c=this._createSpriteFrameWithName(a)}c&&
(c._textureLoaded?(this._buttonClickedSpriteFrame=c,this._updateChildrenDisplayedRGBA(),this._pressedTextureLoaded=!0):(this._clickedLoader.clear(),this._clickedLoader.once(c,function(){this.loadTexturePressed(this._clickedFileName,this._pressedTexType)},this)))}},loadTextureDisabled:function(a,b){if(a){b=b||ccui.Widget.LOCAL_TEXTURE;this._disabledFileName=a;this._disabledTexType=b;var c;switch(this._disabledTexType){case ccui.Widget.LOCAL_TEXTURE:c=this._createSpriteFrameWithFile(a);break;case ccui.Widget.PLIST_TEXTURE:"#"===
a[0]&&(a=a.substr(1,a.length-1)),c=this._createSpriteFrameWithName(a)}c&&(c._textureLoaded?(this._buttonDisableSpriteFrame=c,this._updateChildrenDisplayedRGBA(),this._disabledTextureLoaded=!0,this._findLayout()):(this._disabledLoader.clear(),this._disabledLoader.once(c,function(){this.loadTextureDisabled(this._disabledFileName,this._disabledTexType)},this)))}},setCapInsets:function(a){this.setCapInsetsNormalRenderer(a)},setCapInsetsNormalRenderer:function(a){if(a&&this._scale9Enabled){var b=a.x,c=
a.y,d=a.width;a=a.height;this._normalTextureSize.width<d&&(d=b=0);this._normalTextureSize.height<a&&(a=c=0);var e=this._capInsetsNormal;e.x=b;e.y=c;e.width=d;e.height=a;this._capInsetsNormal=e;this._buttonScale9Renderer.setCapInsets(e)}},getCapInsetsNormalRenderer:function(){return cc.rect(this._capInsetsNormal)},setCapInsetsPressedRenderer:function(a){this.setCapInsetsNormalRenderer(a)},getCapInsetsPressedRenderer:function(){return cc.rect(this._capInsetsNormal)},setCapInsetsDisabledRenderer:function(a){this.setCapInsetsNormalRenderer(a)},
getCapInsetsDisabledRenderer:function(){return cc.rect(this._capInsetsNormal)},_onPressStateChangedToNormal:function(){this._buttonScale9Renderer.setSpriteFrame(this._buttonNormalSpriteFrame);this._buttonScale9Renderer.setState(ccui.Scale9Sprite.state.NORMAL);if(this._pressedTextureLoaded){if(this.pressedActionEnabled&&(this._buttonScale9Renderer.stopAllActions(),this._buttonScale9Renderer.setScale(1),this._titleRenderer))if(this._titleRenderer.stopAllActions(),this._unifySize){var a=cc.scaleTo(ccui.Button.ZOOM_ACTION_TIME_STEP,
1,1);this._titleRenderer.runAction(a)}else this._titleRenderer.setScaleX(1),this._titleRenderer.setScaleY(1)}else this._buttonScale9Renderer.stopAllActions(),this._buttonScale9Renderer.setScale(1),this._scale9Enabled&&this._buttonScale9Renderer.setColor(cc.color.WHITE),this._titleRenderer&&(this._titleRenderer.stopAllActions(),this._titleRenderer.setScaleX(1),this._titleRenderer.setScaleY(1))},_onPressStateChangedToPressed:function(){this._buttonScale9Renderer.setState(ccui.Scale9Sprite.state.NORMAL);
if(this._pressedTextureLoaded){if(this._buttonScale9Renderer.setSpriteFrame(this._buttonClickedSpriteFrame),this.pressedActionEnabled){this._buttonScale9Renderer.stopAllActions();var a=cc.scaleTo(ccui.Button.ZOOM_ACTION_TIME_STEP,1+this._zoomScale,1+this._zoomScale);this._buttonScale9Renderer.runAction(a);this._titleRenderer&&(this._titleRenderer.stopAllActions(),this._titleRenderer.runAction(cc.scaleTo(ccui.Button.ZOOM_ACTION_TIME_STEP,1+this._zoomScale,1+this._zoomScale)))}}else this._buttonScale9Renderer.setSpriteFrame(this._buttonClickedSpriteFrame),
this._buttonScale9Renderer.stopAllActions(),this._buttonScale9Renderer.setScale(1+this._zoomScale,1+this._zoomScale),this._titleRenderer&&(this._titleRenderer.stopAllActions(),this._titleRenderer.setScaleX(1+this._zoomScale),this._titleRenderer.setScaleY(1+this._zoomScale))},_onPressStateChangedToDisabled:function(){this._disabledTextureLoaded?this._buttonScale9Renderer.setSpriteFrame(this._buttonDisableSpriteFrame):this._normalTextureLoaded&&this._buttonScale9Renderer.setState(ccui.Scale9Sprite.state.GRAY);
this._buttonScale9Renderer.setScale(1)},_updateContentSize:function(){if(this._unifySize){if(this._scale9Enabled)ccui.ProtectedNode.setContentSize(this._customSize);else{var a=this._getNormalSize();ccui.ProtectedNode.setContentSize(a)}this._onSizeChanged()}else this._ignoreSize&&this.setContentSize(this.getVirtualRendererSize())},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);this._titleRenderer&&this._updateTitleLocation();this._normalTextureAdaptDirty=!0},getVirtualRenderer:function(){return this._buttonScale9Renderer},
_normalTextureScaleChangedWithSize:function(){this._buttonScale9Renderer.setContentSize(this._contentSize);this._buttonScale9Renderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},_adaptRenderers:function(){this._normalTextureAdaptDirty&&(this._normalTextureScaleChangedWithSize(),this._normalTextureAdaptDirty=!1)},_updateTitleLocation:function(){this._titleRenderer.setPosition(0.5*this._contentSize.width,0.5*this._contentSize.height)},setPressedActionEnabled:function(a){this.pressedActionEnabled=
a},setTitleText:function(a){a!==this.getTitleText()&&(this._createTitleRendererIfNeeded(),this._titleRenderer.setString(a),this._ignoreSize?(a=this.getVirtualRendererSize(),this.setContentSize(a)):this._titleRenderer._renderCmd._updateTTF())},getTitleText:function(){return this._titleRenderer?this._titleRenderer.getString():""},setTitleColor:function(a){this._createTitleRendererIfNeeded();this._titleRenderer.setFontFillColor(a)},getTitleColor:function(){return this._titleRenderer?this._titleRenderer._getFillStyle():
cc.color.WHITE},setTitleFontSize:function(a){this._createTitleRendererIfNeeded();this._titleRenderer.setFontSize(a);this._fontSize=a},getTitleFontSize:function(){return this._titleRenderer?this._titleRenderer.getFontSize():this._fontSize},setZoomScale:function(a){this._zoomScale=a},getZoomScale:function(){return this._zoomScale},getNormalTextureSize:function(){return this._normalTextureSize},setTitleFontName:function(a){this._createTitleRendererIfNeeded();this._titleRenderer.setFontName(a);this._fontName=
a},getTitleRenderer:function(){return this._titleRenderer},getTitleFontName:function(){return this._titleRenderer?this._titleRenderer.getFontName():this._fontName},_setTitleFont:function(a){this._titleRenderer.font=a},_getTitleFont:function(){return this._titleRenderer.font},getDescription:function(){return"Button"},_createCloneInstance:function(){return new ccui.Button},_copySpecialProperties:function(a){this._prevIgnoreSize=a._prevIgnoreSize;this._capInsetsNormal=a._capInsetsNormal;this.setScale9Enabled(a._scale9Enabled);
this.loadTextureNormal(a._normalFileName,a._normalTexType);this.loadTexturePressed(a._clickedFileName,a._pressedTexType);this.loadTextureDisabled(a._disabledFileName,a._disabledTexType);a._titleRenderer&&a._titleRenderer._string&&(this.setTitleText(a.getTitleText()),this.setTitleFontName(a.getTitleFontName()),this.setTitleFontSize(a.getTitleFontSize()),this.setTitleColor(a.getTitleColor()));this.setPressedActionEnabled(a.pressedActionEnabled);this.setZoomScale(a._zoomScale)},_getNormalSize:function(){var a;
null!==this._titleRenderer&&(a=this._titleRenderer.getContentSize());var b=this._buttonScale9Renderer.getContentSize();return cc.size(a.width>b.width?a.width:b.width,a.height>b.height?a.height:b.height)}});_p=ccui.Button.prototype;cc.defineGetterSetter(_p,"titleText",_p.getTitleText,_p.setTitleText);cc.defineGetterSetter(_p,"titleFont",_p._getTitleFont,_p._setTitleFont);cc.defineGetterSetter(_p,"titleFontSize",_p.getTitleFontSize,_p.setTitleFontSize);
cc.defineGetterSetter(_p,"titleFontName",_p.getTitleFontName,_p.setTitleFontName);cc.defineGetterSetter(_p,"titleColor",_p.getTitleColor,_p.setTitleColor);_p=null;ccui.Button.create=function(a,b,c,d){return new ccui.Button(a,b,c,d)};ccui.Button.NORMAL_RENDERER_ZORDER=-2;ccui.Button.PRESSED_RENDERER_ZORDER=-2;ccui.Button.DISABLED_RENDERER_ZORDER=-2;ccui.Button.TITLE_RENDERER_ZORDER=-1;ccui.Button.ZOOM_ACTION_TIME_STEP=0.05;ccui.Button.SYSTEM=0;ccui.Button.TTF=1;ccui.CheckBox=ccui.Widget.extend({_backGroundBoxRenderer:null,_backGroundSelectedBoxRenderer:null,_frontCrossRenderer:null,_backGroundBoxDisabledRenderer:null,_frontCrossDisabledRenderer:null,_isSelected:!0,_checkBoxEventListener:null,_checkBoxEventSelector:null,_backGroundTexType:ccui.Widget.LOCAL_TEXTURE,_backGroundSelectedTexType:ccui.Widget.LOCAL_TEXTURE,_frontCrossTexType:ccui.Widget.LOCAL_TEXTURE,_backGroundDisabledTexType:ccui.Widget.LOCAL_TEXTURE,_frontCrossDisabledTexType:ccui.Widget.LOCAL_TEXTURE,
_backGroundFileName:"",_backGroundSelectedFileName:"",_frontCrossFileName:"",_backGroundDisabledFileName:"",_frontCrossDisabledFileName:"",_className:"CheckBox",_zoomScale:0.1,_backgroundTextureScaleX:0.1,_backgroundTextureScaleY:0.1,_backGroundBoxRendererAdaptDirty:!0,_backGroundSelectedBoxRendererAdaptDirty:!0,_frontCrossRendererAdaptDirty:!0,_backGroundBoxDisabledRendererAdaptDirty:!0,_frontCrossDisabledRendererAdaptDirty:!0,ctor:function(a,b,c,d,e,f){ccui.Widget.prototype.ctor.call(this);this.setTouchEnabled(!0);
for(var g=0,h=0;h<arguments.length;h++){var k=typeof arguments[h];"string"===k?isNaN(arguments[h]-0)?g++:(f=arguments[h],arguments[h]=void 0):"number"===k&&g++}switch(g){case 2:f=c,c=b,b=void 0}f=void 0===f?0:f;this._isSelected=!0;this.setSelected(!1);this.loadTextures(a,b,c,d,e,f)},_initRenderer:function(){this._backGroundBoxRenderer=new cc.Sprite;this._backGroundSelectedBoxRenderer=new cc.Sprite;this._frontCrossRenderer=new cc.Sprite;this._backGroundBoxDisabledRenderer=new cc.Sprite;this._frontCrossDisabledRenderer=
new cc.Sprite;this.addProtectedChild(this._backGroundBoxRenderer,ccui.CheckBox.BOX_RENDERER_ZORDER,-1);this.addProtectedChild(this._backGroundSelectedBoxRenderer,ccui.CheckBox.BOX_SELECTED_RENDERER_ZORDER,-1);this.addProtectedChild(this._frontCrossRenderer,ccui.CheckBox.FRONT_CROSS_RENDERER_ZORDER,-1);this.addProtectedChild(this._backGroundBoxDisabledRenderer,ccui.CheckBox.BOX_DISABLED_RENDERER_ZORDER,-1);this.addProtectedChild(this._frontCrossDisabledRenderer,ccui.CheckBox.FRONT_CROSS_DISABLED_RENDERER_ZORDER,
-1)},loadTextures:function(a,b,c,d,e,f){a&&this.loadTextureBackGround(a,f);b&&this.loadTextureBackGroundSelected(b,f);c&&this.loadTextureFrontCross(c,f);d&&this.loadTextureBackGroundDisabled(d,f);e&&this.loadTextureFrontCrossDisabled(e,f)},loadTextureBackGround:function(a,b){if(a){b=b||ccui.Widget.LOCAL_TEXTURE;this._backGroundFileName=a;this._backGroundTexType=b;var c=this._backGroundBoxRenderer;c._textureLoaded?this._backGroundBoxRenderer.setContentSize(this._customSize):c.addEventListener("load",
function(){this._updateContentSizeWithTextureSize(this._backGroundBoxRenderer.getContentSize());this.loadTextureBackGround(this._backGroundFileName,this._backGroundTexType)},this);switch(this._backGroundTexType){case ccui.Widget.LOCAL_TEXTURE:c.initWithFile(a);break;case ccui.Widget.PLIST_TEXTURE:c.initWithSpriteFrameName(a)}this._updateChildrenDisplayedRGBA();this._updateContentSizeWithTextureSize(this._backGroundBoxRenderer.getContentSize());this._backGroundBoxRendererAdaptDirty=!0;this._findLayout()}},
loadTextureBackGroundSelected:function(a,b){if(a){b=b||ccui.Widget.LOCAL_TEXTURE;this._backGroundSelectedFileName=a;this._backGroundSelectedTexType=b;var c=this._backGroundSelectedBoxRenderer;c._textureLoaded||c.addEventListener("load",function(){this.loadTextureBackGroundSelected(this._backGroundSelectedFileName,this._backGroundSelectedTexType)},this);switch(this._backGroundSelectedTexType){case ccui.Widget.LOCAL_TEXTURE:c.initWithFile(a);break;case ccui.Widget.PLIST_TEXTURE:c.initWithSpriteFrameName(a)}this._updateChildrenDisplayedRGBA();
this._backGroundSelectedBoxRendererAdaptDirty=!0;this._findLayout()}},loadTextureFrontCross:function(a,b){if(a){b=b||ccui.Widget.LOCAL_TEXTURE;this._frontCrossFileName=a;this._frontCrossTexType=b;var c=this._frontCrossRenderer;c._textureLoaded||c.addEventListener("load",function(){this.loadTextureFrontCross(this._frontCrossFileName,this._frontCrossTexType)},this);switch(this._frontCrossTexType){case ccui.Widget.LOCAL_TEXTURE:c.initWithFile(a);break;case ccui.Widget.PLIST_TEXTURE:c.initWithSpriteFrameName(a)}this._updateChildrenDisplayedRGBA();
this._frontCrossRendererAdaptDirty=!0;this._findLayout()}},loadTextureBackGroundDisabled:function(a,b){if(a){b=b||ccui.Widget.LOCAL_TEXTURE;this._backGroundDisabledFileName=a;this._backGroundDisabledTexType=b;var c=this._backGroundBoxDisabledRenderer;c._textureLoaded||c.addEventListener("load",function(){this.loadTextureBackGroundDisabled(this._backGroundDisabledFileName,this._backGroundDisabledTexType)},this);switch(this._backGroundDisabledTexType){case ccui.Widget.LOCAL_TEXTURE:c.initWithFile(a);
break;case ccui.Widget.PLIST_TEXTURE:c.initWithSpriteFrameName(a)}this._updateChildrenDisplayedRGBA();this._backGroundBoxDisabledRendererAdaptDirty=!0;this._findLayout()}},loadTextureFrontCrossDisabled:function(a,b){if(a){b=b||ccui.Widget.LOCAL_TEXTURE;this._frontCrossDisabledFileName=a;this._frontCrossDisabledTexType=b;var c=this._frontCrossDisabledRenderer;c._textureLoaded||c.addEventListener("load",function(){this.loadTextureFrontCrossDisabled(this._frontCrossDisabledFileName,this._frontCrossDisabledTexType)},
this);switch(this._frontCrossDisabledTexType){case ccui.Widget.LOCAL_TEXTURE:c.initWithFile(a);break;case ccui.Widget.PLIST_TEXTURE:c.initWithSpriteFrameName(a)}this._updateChildrenDisplayedRGBA();this._frontCrossDisabledRendererAdaptDirty=!0;this._findLayout()}},_onPressStateChangedToNormal:function(){this._backGroundBoxRenderer.setVisible(!0);this._backGroundSelectedBoxRenderer.setVisible(!1);this._backGroundBoxDisabledRenderer.setVisible(!1);this._frontCrossDisabledRenderer.setVisible(!1);this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX,
this._backgroundTextureScaleY);this._frontCrossRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY);this._isSelected&&(this._frontCrossRenderer.setVisible(!0),this._frontCrossRendererAdaptDirty=!0)},_onPressStateChangedToPressed:function(){this._backGroundSelectedFileName?(this._backGroundBoxRenderer.setVisible(!1),this._backGroundSelectedBoxRenderer.setVisible(!0),this._backGroundBoxDisabledRenderer.setVisible(!1),this._frontCrossDisabledRenderer.setVisible(!1)):(this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX+
this._zoomScale,this._backgroundTextureScaleY+this._zoomScale),this._frontCrossRenderer.setScale(this._backgroundTextureScaleX+this._zoomScale,this._backgroundTextureScaleY+this._zoomScale))},_onPressStateChangedToDisabled:function(){this._backGroundDisabledFileName&&this._frontCrossDisabledFileName&&(this._backGroundBoxRenderer.setVisible(!1),this._backGroundBoxDisabledRenderer.setVisible(!0));this._backGroundSelectedBoxRenderer.setVisible(!1);this._frontCrossRenderer.setVisible(!1);this._backGroundBoxRenderer.setScale(this._backgroundTextureScaleX,
this._backgroundTextureScaleY);this._frontCrossRenderer.setScale(this._backgroundTextureScaleX,this._backgroundTextureScaleY);this._isSelected&&(this._frontCrossDisabledRenderer.setVisible(!0),this._frontCrossDisabledRendererAdaptDirty=!0)},setZoomScale:function(a){this._zoomScale=a},getZoomScale:function(){return this._zoomScale},setSelectedState:function(a){this.setSelected(a)},setSelected:function(a){a!==this._isSelected&&(this._isSelected=a,this._frontCrossRenderer.setVisible(this._isSelected))},
getSelectedState:function(){return this.isSelected()},isSelected:function(){return this._isSelected},_selectedEvent:function(){this._checkBoxEventSelector&&(this._checkBoxEventListener?this._checkBoxEventSelector.call(this._checkBoxEventListener,this,ccui.CheckBox.EVENT_SELECTED):this._checkBoxEventSelector(this,ccui.CheckBox.EVENT_SELECTED))},_unSelectedEvent:function(){this._checkBoxEventSelector&&(this._checkBoxEventListener?this._checkBoxEventSelector.call(this._checkBoxEventListener,this,ccui.CheckBox.EVENT_UNSELECTED):
this._checkBoxEventSelector(this,ccui.CheckBox.EVENT_UNSELECTED))},_releaseUpEvent:function(){ccui.Widget.prototype._releaseUpEvent.call(this);this._isSelected?(this.setSelected(!1),this._unSelectedEvent()):(this.setSelected(!0),this._selectedEvent())},addEventListenerCheckBox:function(a,b){this.addEventListener(a,b)},addEventListener:function(a,b){this._checkBoxEventSelector=a;this._checkBoxEventListener=b},getVirtualRendererSize:function(){return this._backGroundBoxRenderer.getContentSize()},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);
this._frontCrossDisabledRendererAdaptDirty=this._backGroundBoxDisabledRendererAdaptDirty=this._frontCrossRendererAdaptDirty=this._backGroundSelectedBoxRendererAdaptDirty=this._backGroundBoxRendererAdaptDirty=!0},getVirtualRenderer:function(){return this._backGroundBoxRenderer},_backGroundTextureScaleChangedWithSize:function(){var a=this._backGroundBoxRenderer,b=this._contentSize;if(this._ignoreSize)a.setScale(1),this._backgroundTextureScaleX=this._backgroundTextureScaleY=1;else{var c=a.getContentSize();
if(0>=c.width||0>=c.height){a.setScale(1);this._backgroundTextureScaleX=this._backgroundTextureScaleY=1;return}var d=b.width/c.width,c=b.height/c.height;this._backgroundTextureScaleX=d;this._backgroundTextureScaleY=c;a.setScaleX(d);a.setScaleY(c)}a.setPosition(0.5*b.width,0.5*b.height)},_backGroundSelectedTextureScaleChangedWithSize:function(){var a=this._backGroundSelectedBoxRenderer,b=this._contentSize;if(this._ignoreSize)a.setScale(1);else{var c=a.getContentSize();if(0>=c.width||0>=c.height){a.setScale(1);
return}var d=b.height/c.height;a.setScaleX(b.width/c.width);a.setScaleY(d)}a.setPosition(0.5*b.width,0.5*b.height)},_frontCrossTextureScaleChangedWithSize:function(){var a=this._frontCrossRenderer,b=this._contentSize;if(this._ignoreSize)a.setScale(1);else{var c=a.getContentSize();if(0>=c.width||0>=c.height){a.setScale(1);return}var d=b.height/c.height;a.setScaleX(b.width/c.width);a.setScaleY(d)}a.setPosition(0.5*b.width,0.5*b.height)},_backGroundDisabledTextureScaleChangedWithSize:function(){var a=
this._backGroundBoxDisabledRenderer,b=this._contentSize;if(this._ignoreSize)a.setScale(1);else{var c=a.getContentSize();if(0>=c.width||0>=c.height){a.setScale(1);return}var d=b.height/c.height;a.setScaleX(b.width/c.width);a.setScaleY(d)}a.setPosition(0.5*b.width,0.5*b.height)},_frontCrossDisabledTextureScaleChangedWithSize:function(){var a=this._frontCrossDisabledRenderer,b=this._contentSize;if(this._ignoreSize)a.setScale(1);else{var c=a.getContentSize();if(0>=c.width||0>=c.height){a.setScale(1);
return}var d=b.height/c.height;a.setScaleX(b.width/c.width);a.setScaleY(d)}a.setPosition(0.5*b.width,0.5*b.height)},getDescription:function(){return"CheckBox"},_createCloneInstance:function(){return new ccui.CheckBox},_copySpecialProperties:function(a){a instanceof ccui.CheckBox&&(this.loadTextureBackGround(a._backGroundFileName,a._backGroundTexType),this.loadTextureBackGroundSelected(a._backGroundSelectedFileName,a._backGroundSelectedTexType),this.loadTextureFrontCross(a._frontCrossFileName,a._frontCrossTexType),
this.loadTextureBackGroundDisabled(a._backGroundDisabledFileName,a._backGroundDisabledTexType),this.loadTextureFrontCrossDisabled(a._frontCrossDisabledFileName,a._frontCrossDisabledTexType),this.setSelected(a._isSelected),this._checkBoxEventListener=a._checkBoxEventListener,this._checkBoxEventSelector=a._checkBoxEventSelector,this._ccEventCallback=a._ccEventCallback,this._zoomScale=a._zoomScale,this._backgroundTextureScaleX=a._backgroundTextureScaleX,this._backgroundTextureScaleY=a._backgroundTextureScaleY)},
_adaptRenderers:function(){this._backGroundBoxRendererAdaptDirty&&(this._backGroundTextureScaleChangedWithSize(),this._backGroundBoxRendererAdaptDirty=!1);this._backGroundSelectedBoxRendererAdaptDirty&&(this._backGroundSelectedTextureScaleChangedWithSize(),this._backGroundSelectedBoxRendererAdaptDirty=!1);this._frontCrossRendererAdaptDirty&&(this._frontCrossTextureScaleChangedWithSize(),this._frontCrossRendererAdaptDirty=!1);this._backGroundBoxDisabledRendererAdaptDirty&&(this._backGroundDisabledTextureScaleChangedWithSize(),
this._backGroundBoxDisabledRendererAdaptDirty=!1);this._frontCrossDisabledRendererAdaptDirty&&(this._frontCrossDisabledTextureScaleChangedWithSize(),this._frontCrossDisabledRendererAdaptDirty=!1)}});_p=ccui.CheckBox.prototype;cc.defineGetterSetter(_p,"selected",_p.isSelected,_p.setSelected);_p=null;ccui.CheckBox.create=function(a,b,c,d,e,f){return new ccui.CheckBox(a,b,c,d,e,f)};ccui.CheckBox.EVENT_SELECTED=0;ccui.CheckBox.EVENT_UNSELECTED=1;ccui.CheckBox.BOX_RENDERER_ZORDER=-1;
ccui.CheckBox.BOX_SELECTED_RENDERER_ZORDER=-1;ccui.CheckBox.BOX_DISABLED_RENDERER_ZORDER=-1;ccui.CheckBox.FRONT_CROSS_RENDERER_ZORDER=-1;ccui.CheckBox.FRONT_CROSS_DISABLED_RENDERER_ZORDER=-1;ccui.ImageView=ccui.Widget.extend({_scale9Enabled:!1,_prevIgnoreSize:!0,_capInsets:null,_imageRenderer:null,_textureFile:"",_imageTexType:ccui.Widget.LOCAL_TEXTURE,_imageTextureSize:null,_className:"ImageView",_imageRendererAdaptDirty:!0,ctor:function(a,b){this._capInsets=cc.rect(0,0,0,0);this._imageTextureSize=cc.size(this._capInsets.width,this._capInsets.height);ccui.Widget.prototype.ctor.call(this);a?this.loadTexture(a,void 0===b?0:b):this._imageTexType=ccui.Widget.LOCAL_TEXTURE},_initRenderer:function(){this._imageRenderer=
new ccui.Scale9Sprite;this._imageRenderer.setRenderingType(ccui.Scale9Sprite.RenderingType.SIMPLE);this.addProtectedChild(this._imageRenderer,ccui.ImageView.RENDERER_ZORDER,-1)},loadTexture:function(a,b){if(a&&(this._textureFile!=a||this._imageTexType!=b)){var c=this;b=b||ccui.Widget.LOCAL_TEXTURE;this._textureFile=a;this._imageTexType=b;var d=c._imageRenderer;switch(c._imageTexType){case ccui.Widget.LOCAL_TEXTURE:c._scale9Enabled?(d.initWithFile(a),d.setCapInsets(c._capInsets)):d.initWithFile(a);
break;case ccui.Widget.PLIST_TEXTURE:c._scale9Enabled?(d.initWithSpriteFrameName(a),d.setCapInsets(c._capInsets)):d.initWithSpriteFrameName(a)}if(!d._textureLoaded){var e=function(){d.removeEventListener("load",e);!c._ignoreSize&&cc.sizeEqualToSize(c._customSize,cc.size(0,0))&&(c._customSize=c._imageRenderer.getContentSize());c._imageTextureSize=d.getContentSize();c._updateChildrenDisplayedRGBA();c._updateContentSizeWithTextureSize(c._imageTextureSize)};d.addEventListener("load",e)}!this._ignoreSize&&
cc.sizeEqualToSize(this._customSize,cc.size(0,0))&&(this._customSize=this._imageRenderer.getContentSize());c._imageTextureSize=d.getContentSize();this._updateChildrenDisplayedRGBA();c._updateContentSizeWithTextureSize(c._imageTextureSize);c._imageRendererAdaptDirty=!0;c._findLayout()}},setTextureRect:function(){cc.warn("ImageView.setTextureRect  is deprecated!")},setScale9Enabled:function(a){this._scale9Enabled!==a&&((this._scale9Enabled=a)?this._imageRenderer.setRenderingType(ccui.Scale9Sprite.RenderingType.SLICED):
this._imageRenderer.setRenderingType(ccui.Scale9Sprite.RenderingType.SIMPLE),this._scale9Enabled?(a=this._ignoreSize,this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=a):this.ignoreContentAdaptWithSize(this._prevIgnoreSize),this.setCapInsets(this._capInsets),this._imageRendererAdaptDirty=!0)},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(a){if(!this._scale9Enabled||this._scale9Enabled&&!a)ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,
a),this._prevIgnoreSize=a},setCapInsets:function(a){if(a){var b=this._capInsets;b.x=a.x;b.y=a.y;b.width=a.width;b.height=a.height;this._scale9Enabled&&this._imageRenderer.setCapInsets(a)}},getCapInsets:function(){return cc.rect(this._capInsets)},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);this._imageRendererAdaptDirty=!0},_adaptRenderers:function(){this._imageRendererAdaptDirty&&(this._imageTextureScaleChangedWithSize(),this._imageRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return cc.size(this._imageTextureSize)},
getVirtualRenderer:function(){return this._imageRenderer},_imageTextureScaleChangedWithSize:function(){this._imageRenderer.setContentSize(this._contentSize);this._imageRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"ImageView"},_createCloneInstance:function(){return new ccui.ImageView},_copySpecialProperties:function(a){a instanceof ccui.ImageView&&(this._prevIgnoreSize=a._prevIgnoreSize,this._capInsets=a._capInsets,this.loadTexture(a._textureFile,
a._imageTexType),this.setScale9Enabled(a._scale9Enabled))},setContentSize:function(a,b){b&&(a=cc.size(a,b));ccui.Widget.prototype.setContentSize.call(this,a);this._imageRenderer.setContentSize(a)}});ccui.ImageView.create=function(a,b){return new ccui.ImageView(a,b)};ccui.ImageView.RENDERER_ZORDER=-1;ccui.LoadingBar=ccui.Widget.extend({_direction:null,_percent:100,_totalLength:0,_barRenderer:null,_renderBarTexType:ccui.Widget.LOCAL_TEXTURE,_barRendererTextureSize:null,_scale9Enabled:!1,_prevIgnoreSize:!0,_capInsets:null,_textureFile:"",_isTextureLoaded:!1,_className:"LoadingBar",_barRendererAdaptDirty:!0,ctor:function(a,b){this._direction=ccui.LoadingBar.TYPE_LEFT;this._barRendererTextureSize=cc.size(0,0);this._capInsets=cc.rect(0,0,0,0);ccui.Widget.prototype.ctor.call(this);void 0!==a&&this.loadTexture(a);
void 0!==b&&this.setPercent(b)},_initRenderer:function(){this._barRenderer=new cc.Sprite;this.addProtectedChild(this._barRenderer,ccui.LoadingBar.RENDERER_ZORDER,-1);this._barRenderer.setAnchorPoint(0,0.5)},setDirection:function(a){if(this._direction!==a)switch(this._direction=a,this._direction){case ccui.LoadingBar.TYPE_LEFT:this._barRenderer.setAnchorPoint(0,0.5);this._barRenderer.setPosition(0,0.5*this._contentSize.height);this._scale9Enabled||this._barRenderer.setFlippedX(!1);break;case ccui.LoadingBar.TYPE_RIGHT:this._barRenderer.setAnchorPoint(1,
0.5),this._barRenderer.setPosition(this._totalLength,0.5*this._contentSize.height),this._scale9Enabled||this._barRenderer.setFlippedX(!0)}},getDirection:function(){return this._direction},loadTexture:function(a,b){if(a){this._renderBarTexType=b=b||ccui.Widget.LOCAL_TEXTURE;this._textureFile=a;var c=this._barRenderer,d=this;c._textureLoaded||c.addEventListener("load",function(){d.loadTexture(d._textureFile,d._renderBarTexType);d._setPercent(d._percent)});switch(this._renderBarTexType){case ccui.Widget.LOCAL_TEXTURE:c.initWithFile(a);
break;case ccui.Widget.PLIST_TEXTURE:c.initWithSpriteFrameName(a)}var e=c.getContentSize();this._barRendererTextureSize.width=e.width;this._barRendererTextureSize.height=e.height;switch(this._direction){case ccui.LoadingBar.TYPE_LEFT:c.setAnchorPoint(0,0.5);this._scale9Enabled||c.setFlippedX(!1);break;case ccui.LoadingBar.TYPE_RIGHT:c.setAnchorPoint(1,0.5),this._scale9Enabled||c.setFlippedX(!0)}this._scale9Enabled&&c.setCapInsets(this._capInsets);this._updateChildrenDisplayedRGBA();this._barRendererScaleChangedWithSize();
this._updateContentSizeWithTextureSize(this._barRendererTextureSize);this._barRendererAdaptDirty=!0;this._findLayout()}},setScale9Enabled:function(a){this._scale9Enabled!==a&&(this._scale9Enabled=a,this.removeProtectedChild(this._barRenderer),this._barRenderer=this._scale9Enabled?new ccui.Scale9Sprite:new cc.Sprite,this.loadTexture(this._textureFile,this._renderBarTexType),this.addProtectedChild(this._barRenderer,ccui.LoadingBar.RENDERER_ZORDER,-1),this._scale9Enabled?(a=this._ignoreSize,this.ignoreContentAdaptWithSize(!1),
this._prevIgnoreSize=a):this.ignoreContentAdaptWithSize(this._prevIgnoreSize),this.setCapInsets(this._capInsets),this.setPercent(this._percent),this._barRendererAdaptDirty=!0)},isScale9Enabled:function(){return this._scale9Enabled},setCapInsets:function(a){if(a){var b=this._capInsets;b.x=a.x;b.y=a.y;b.width=a.width;b.height=a.height;this._scale9Enabled&&this._barRenderer.setCapInsets(a)}},getCapInsets:function(){return cc.rect(this._capInsets)},setPercent:function(a){100<a&&(a=100);0>a&&(a=0);a!==
this._percent&&(this._percent=a,this._setPercent(a))},_setPercent:function(){var a,b,c,d;0>=this._totalLength||(a=this._percent/100,this._scale9Enabled?this._setScale9Scale():(c=this._barRenderer,d=this._barRendererTextureSize,b=c.getTextureRect(),b.width=d.width*a,c.setTextureRect(cc.rect(b.x,b.y,d.width*a,d.height),c._rectRotated)))},setContentSize:function(a,b){ccui.Widget.prototype.setContentSize.call(this,a,b);this._totalLength=void 0===b?a.width:a},getPercent:function(){return this._percent},
_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);this._barRendererAdaptDirty=!0},_adaptRenderers:function(){this._barRendererAdaptDirty&&(this._barRendererScaleChangedWithSize(),this._barRendererAdaptDirty=!1)},ignoreContentAdaptWithSize:function(a){if(!this._scale9Enabled||this._scale9Enabled&&!a)ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,a),this._prevIgnoreSize=a},getVirtualRendererSize:function(){return cc.size(this._barRendererTextureSize)},getVirtualRenderer:function(){return this._barRenderer},
_barRendererScaleChangedWithSize:function(){var a=this._barRenderer,b=this._contentSize;if(this._unifySize)this._totalLength=this._contentSize.width,this.setPercent(this._percent);else if(this._ignoreSize)this._scale9Enabled||(this._totalLength=this._barRendererTextureSize.width,a.setScale(1));else if(this._totalLength=b.width,this._scale9Enabled)this._setScale9Scale(),a.setScale(1);else{var c=this._barRendererTextureSize;if(0>=c.width||0>=c.height){a.setScale(1);return}var d=b.height/c.height;a.setScaleX(b.width/
c.width);a.setScaleY(d)}switch(this._direction){case ccui.LoadingBar.TYPE_LEFT:a.setPosition(0,0.5*b.height);break;case ccui.LoadingBar.TYPE_RIGHT:a.setPosition(this._totalLength,0.5*b.height)}},_setScale9Scale:function(){this._barRenderer.setPreferredSize(cc.size(this._percent/100*this._totalLength,this._contentSize.height))},getDescription:function(){return"LoadingBar"},_createCloneInstance:function(){return new ccui.LoadingBar},_copySpecialProperties:function(a){a instanceof ccui.LoadingBar&&(this._prevIgnoreSize=
a._prevIgnoreSize,this.setScale9Enabled(a._scale9Enabled),this.loadTexture(a._textureFile,a._renderBarTexType),this.setCapInsets(a._capInsets),this.setPercent(a._percent),this.setDirection(a._direction))}});_p=ccui.LoadingBar.prototype;cc.defineGetterSetter(_p,"direction",_p.getDirection,_p.setDirection);cc.defineGetterSetter(_p,"percent",_p.getPercent,_p.setPercent);_p=null;ccui.LoadingBar.create=function(a,b){return new ccui.LoadingBar(a,b)};ccui.LoadingBar.TYPE_LEFT=0;
ccui.LoadingBar.TYPE_RIGHT=1;ccui.LoadingBar.RENDERER_ZORDER=-1;ccui.Slider=ccui.Widget.extend({_barRenderer:null,_progressBarRenderer:null,_barTextureSize:null,_progressBarTextureSize:null,_slidBallNormalRenderer:null,_slidBallPressedRenderer:null,_slidBallDisabledRenderer:null,_slidBallRenderer:null,_barLength:0,_percent:0,_scale9Enabled:!1,_prevIgnoreSize:!0,_textureFile:"",_progressBarTextureFile:"",_slidBallNormalTextureFile:"",_slidBallPressedTextureFile:"",_slidBallDisabledTextureFile:"",_capInsetsBarRenderer:null,_capInsetsProgressBarRenderer:null,_sliderEventListener:null,
_sliderEventSelector:null,_barTexType:ccui.Widget.LOCAL_TEXTURE,_progressBarTexType:ccui.Widget.LOCAL_TEXTURE,_ballNTexType:ccui.Widget.LOCAL_TEXTURE,_ballPTexType:ccui.Widget.LOCAL_TEXTURE,_ballDTexType:ccui.Widget.LOCAL_TEXTURE,_isTextureLoaded:!1,_className:"Slider",_barRendererAdaptDirty:!0,_progressBarRendererDirty:!0,_unifySize:!1,_zoomScale:0.1,_sliderBallNormalTextureScaleX:1,_sliderBallNormalTextureScaleY:1,ctor:function(a,b,c){this._barTextureSize=cc.size(0,0);this._progressBarTextureSize=
cc.size(0,0);this._capInsetsBarRenderer=cc.rect(0,0,0,0);this._capInsetsProgressBarRenderer=cc.rect(0,0,0,0);ccui.Widget.prototype.ctor.call(this);c=c||0;this.setTouchEnabled(!0);a&&this.loadBarTexture(a,c);b&&this.loadSlidBallTextures(b,c)},_initRenderer:function(){this._barRenderer=new cc.Sprite;this._progressBarRenderer=new cc.Sprite;this._progressBarRenderer.setAnchorPoint(0,0.5);this.addProtectedChild(this._barRenderer,ccui.Slider.BASEBAR_RENDERER_ZORDER,-1);this.addProtectedChild(this._progressBarRenderer,
ccui.Slider.PROGRESSBAR_RENDERER_ZORDER,-1);this._slidBallNormalRenderer=new cc.Sprite;this._slidBallPressedRenderer=new cc.Sprite;this._slidBallPressedRenderer.setVisible(!1);this._slidBallDisabledRenderer=new cc.Sprite;this._slidBallDisabledRenderer.setVisible(!1);this._slidBallRenderer=new cc.Node;this._slidBallRenderer.addChild(this._slidBallNormalRenderer);this._slidBallRenderer.addChild(this._slidBallPressedRenderer);this._slidBallRenderer.addChild(this._slidBallDisabledRenderer);this._slidBallRenderer.setCascadeColorEnabled(!0);
this._slidBallRenderer.setCascadeOpacityEnabled(!0);this.addProtectedChild(this._slidBallRenderer,ccui.Slider.BALL_RENDERER_ZORDER,-1)},loadBarTexture:function(a,b){if(a){b=b||ccui.Widget.LOCAL_TEXTURE;this._textureFile=a;this._barTexType=b;var c=this._barRenderer,d=this;c._textureLoaded||c.addEventListener("load",function(){d.loadBarTexture(d._textureFile,d._barTexType)});switch(this._barTexType){case ccui.Widget.LOCAL_TEXTURE:c.initWithFile(a);break;case ccui.Widget.PLIST_TEXTURE:c.initWithSpriteFrameName(a)}this._updateChildrenDisplayedRGBA();
this._progressBarRendererDirty=this._barRendererAdaptDirty=!0;this._updateContentSizeWithTextureSize(this._barRenderer.getContentSize());this._findLayout();this._barTextureSize=this._barRenderer.getContentSize()}},loadProgressBarTexture:function(a,b){if(a){b=b||ccui.Widget.LOCAL_TEXTURE;this._progressBarTextureFile=a;this._progressBarTexType=b;var c=this._progressBarRenderer,d=this;c._textureLoaded||c.addEventListener("load",function(){d.loadProgressBarTexture(d._progressBarTextureFile,d._progressBarTexType)});
switch(this._progressBarTexType){case ccui.Widget.LOCAL_TEXTURE:c.initWithFile(a);break;case ccui.Widget.PLIST_TEXTURE:c.initWithSpriteFrameName(a)}this._updateChildrenDisplayedRGBA();this._progressBarRenderer.setAnchorPoint(cc.p(0,0.5));c=this._progressBarRenderer.getContentSize();this._progressBarTextureSize={width:c.width,height:c.height};this._progressBarRendererDirty=!0;this._findLayout()}},setScale9Enabled:function(a){this._scale9Enabled!==a&&(this._scale9Enabled=a,this.removeProtectedChild(this._barRenderer,
!0),this.removeProtectedChild(this._progressBarRenderer,!0),this._progressBarRenderer=this._barRenderer=null,this._scale9Enabled?(this._barRenderer=new ccui.Scale9Sprite,this._progressBarRenderer=new ccui.Scale9Sprite):(this._barRenderer=new cc.Sprite,this._progressBarRenderer=new cc.Sprite),this.loadBarTexture(this._textureFile,this._barTexType),this.loadProgressBarTexture(this._progressBarTextureFile,this._progressBarTexType),this.addProtectedChild(this._barRenderer,ccui.Slider.BASEBAR_RENDERER_ZORDER,
-1),this.addProtectedChild(this._progressBarRenderer,ccui.Slider.PROGRESSBAR_RENDERER_ZORDER,-1),this._scale9Enabled?(a=this._ignoreSize,this.ignoreContentAdaptWithSize(!1),this._prevIgnoreSize=a):this.ignoreContentAdaptWithSize(this._prevIgnoreSize),this.setCapInsetsBarRenderer(this._capInsetsBarRenderer),this.setCapInsetProgressBarRenderer(this._capInsetsProgressBarRenderer),this._progressBarRendererDirty=this._barRendererAdaptDirty=!0)},isScale9Enabled:function(){return this._scale9Enabled},ignoreContentAdaptWithSize:function(a){if(!this._scale9Enabled||
this._scale9Enabled&&!a)ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,a),this._prevIgnoreSize=a},setCapInsets:function(a){this.setCapInsetsBarRenderer(a);this.setCapInsetProgressBarRenderer(a)},setCapInsetsBarRenderer:function(a){if(a){var b=this._capInsetsBarRenderer;b.x=a.x;b.y=a.y;b.width=a.width;b.height=a.height;this._scale9Enabled&&this._barRenderer.setCapInsets(a)}},getCapInsetsBarRenderer:function(){return cc.rect(this._capInsetsBarRenderer)},setCapInsetProgressBarRenderer:function(a){if(a){var b=
this._capInsetsProgressBarRenderer;b.x=a.x;b.y=a.y;b.width=a.width;b.height=a.height;this._scale9Enabled&&this._progressBarRenderer.setCapInsets(a)}},getCapInsetsProgressBarRenderer:function(){return cc.rect(this._capInsetsProgressBarRenderer)},loadSlidBallTextures:function(a,b,c,d){this.loadSlidBallTextureNormal(a,d);this.loadSlidBallTexturePressed(b,d);this.loadSlidBallTextureDisabled(c,d)},loadSlidBallTextureNormal:function(a,b){if(a){b=b||ccui.Widget.LOCAL_TEXTURE;this._slidBallNormalTextureFile=
a;this._ballNTexType=b;var c=this;this._slidBallNormalRenderer._textureLoaded||this._slidBallNormalRenderer.addEventListener("load",function(){c.loadSlidBallTextureNormal(c._slidBallNormalTextureFile,c._ballNTexType)});switch(this._ballNTexType){case ccui.Widget.LOCAL_TEXTURE:this._slidBallNormalRenderer.initWithFile(a);break;case ccui.Widget.PLIST_TEXTURE:this._slidBallNormalRenderer.initWithSpriteFrameName(a)}this._updateChildrenDisplayedRGBA();this._findLayout()}},loadSlidBallTexturePressed:function(a,
b){if(a){b=b||ccui.Widget.LOCAL_TEXTURE;this._slidBallPressedTextureFile=a;this._ballPTexType=b;var c=this;this._slidBallPressedRenderer._textureLoaded||this._slidBallPressedRenderer.addEventListener("load",function(){c.loadSlidBallTexturePressed(c._slidBallPressedTextureFile,c._ballPTexType)});switch(this._ballPTexType){case ccui.Widget.LOCAL_TEXTURE:this._slidBallPressedRenderer.initWithFile(a);break;case ccui.Widget.PLIST_TEXTURE:this._slidBallPressedRenderer.initWithSpriteFrameName(a)}this._updateChildrenDisplayedRGBA();
this._findLayout()}},loadSlidBallTextureDisabled:function(a,b){if(a){b=b||ccui.Widget.LOCAL_TEXTURE;this._slidBallDisabledTextureFile=a;this._ballDTexType=b;var c=this;this._slidBallDisabledRenderer._textureLoaded||this._slidBallDisabledRenderer.addEventListener("load",function(){c.loadSlidBallTextureDisabled(c._slidBallDisabledTextureFile,c._ballDTexType)});switch(this._ballDTexType){case ccui.Widget.LOCAL_TEXTURE:this._slidBallDisabledRenderer.initWithFile(a);break;case ccui.Widget.PLIST_TEXTURE:this._slidBallDisabledRenderer.initWithSpriteFrameName(a)}this._updateChildrenDisplayedRGBA();
this._findLayout()}},setPercent:function(a){100<a&&(a=100);0>a&&(a=0);this._percent=a;a=a/100*this._barLength;this._slidBallRenderer.setPosition(a,this._contentSize.height/2);if(this._scale9Enabled)this._progressBarRenderer.setPreferredSize(cc.size(a,this._contentSize.height));else{var b=this._progressBarRenderer,c=b.getTextureRect();b.setTextureRect(cc.rect(c.x,c.y,a/b._scaleX,c.height),b.isTextureRectRotated())}},hitTest:function(a){a=this._slidBallNormalRenderer.convertToNodeSpace(a);var b=this._slidBallNormalRenderer.getContentSize(),
b=cc.rect(0,0,b.width,b.height);return a.x>=b.x&&a.x<=b.x+b.width&&a.y>=b.y&&a.y<=b.y+b.height},onTouchBegan:function(a,b){var c=ccui.Widget.prototype.onTouchBegan.call(this,a,b);if(this._hit){var d=this.convertToNodeSpace(this._touchBeganPosition);this.setPercent(this._getPercentWithBallPos(d.x));this._percentChangedEvent()}return c},onTouchMoved:function(a,b){var c=a.getLocation(),c=this.convertToNodeSpace(c);this.setPercent(this._getPercentWithBallPos(c.x));this._percentChangedEvent()},onTouchEnded:function(a,
b){ccui.Widget.prototype.onTouchEnded.call(this,a,b)},onTouchCancelled:function(a,b){ccui.Widget.prototype.onTouchCancelled.call(this,a,b)},_getPercentWithBallPos:function(a){return a/this._barLength*100},addEventListenerSlider:function(a,b){this.addEventListener(a,b)},addEventListener:function(a,b){this._sliderEventSelector=a;this._sliderEventListener=b},_percentChangedEvent:function(){this._sliderEventSelector&&(this._sliderEventListener?this._sliderEventSelector.call(this._sliderEventListener,
this,ccui.Slider.EVENT_PERCENT_CHANGED):this._sliderEventSelector(this,ccui.Slider.EVENT_PERCENT_CHANGED));this._ccEventCallback&&this._ccEventCallback(this,ccui.Slider.EVENT_PERCENT_CHANGED)},getPercent:function(){return this._percent},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);this._progressBarRendererDirty=this._barRendererAdaptDirty=!0},_adaptRenderers:function(){this._barRendererAdaptDirty&&(this._barRendererScaleChangedWithSize(),this._barRendererAdaptDirty=!1);
this._progressBarRendererDirty&&(this._progressBarRendererScaleChangedWithSize(),this._progressBarRendererDirty=!1)},getVirtualRendererSize:function(){return this._barRenderer.getContentSize()},getVirtualRenderer:function(){return this._barRenderer},_barRendererScaleChangedWithSize:function(){if(this._unifySize)this._barLength=this._contentSize.width,this._barRenderer.setPreferredSize(this._contentSize);else if(this._ignoreSize)this._barRenderer.setScale(1),this._barLength=this._contentSize.width;
else if(this._barLength=this._contentSize.width,this._scale9Enabled)this._barRenderer.setPreferredSize(this._contentSize),this._barRenderer.setScale(1);else{var a=this._barTextureSize;if(0>=a.width||0>=a.height)this._barRenderer.setScale(1);else{var b=this._contentSize.height/a.height;this._barRenderer.setScaleX(this._contentSize.width/a.width);this._barRenderer.setScaleY(b)}}this._barRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2);this.setPercent(this._percent)},_progressBarRendererScaleChangedWithSize:function(){if(this._unifySize)this._progressBarRenderer.setPreferredSize(this._contentSize);
else if(this._ignoreSize){if(!this._scale9Enabled){var a=this._progressBarTextureSize,b=this._contentSize.width/a.width,a=this._contentSize.height/a.height;this._progressBarRenderer.setScaleX(b);this._progressBarRenderer.setScaleY(a)}}else if(this._scale9Enabled)this._progressBarRenderer.setPreferredSize(this._contentSize),this._progressBarRenderer.setScale(1);else{a=this._progressBarTextureSize;if(0>=a.width||0>=a.height){this._progressBarRenderer.setScale(1);return}b=this._contentSize.width/a.width;
a=this._contentSize.height/a.height;this._progressBarRenderer.setScaleX(b);this._progressBarRenderer.setScaleY(a)}this._progressBarRenderer.setPosition(0,this._contentSize.height/2);this.setPercent(this._percent)},_onPressStateChangedToNormal:function(){this._slidBallNormalRenderer.setVisible(!0);this._slidBallPressedRenderer.setVisible(!1);this._slidBallDisabledRenderer.setVisible(!1);this._slidBallNormalRenderer.setScale(this._sliderBallNormalTextureScaleX,this._sliderBallNormalTextureScaleY);cc._renderType===
cc.game.RENDER_TYPE_WEBGL&&(this._slidBallNormalRenderer._renderCmd._shaderProgram=this._getNormalGLProgram())},_onPressStateChangedToPressed:function(){this._slidBallPressedTextureFile?(this._slidBallNormalRenderer.setVisible(!1),this._slidBallPressedRenderer.setVisible(!0),this._slidBallDisabledRenderer.setVisible(!1)):this._slidBallNormalRenderer.setScale(this._sliderBallNormalTextureScaleX+this._zoomScale,this._sliderBallNormalTextureScaleY+this._zoomScale);cc._renderType===cc.game.RENDER_TYPE_WEBGL&&
(this._slidBallNormalRenderer._renderCmd._shaderProgram=this._getNormalGLProgram())},_onPressStateChangedToDisabled:function(){this._slidBallDisabledTextureFile?(this._slidBallNormalRenderer.setVisible(!1),this._slidBallDisabledRenderer.setVisible(!0)):(this._slidBallNormalRenderer.setVisible(!0),cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(this._slidBallNormalRenderer._renderCmd._shaderProgram=this._getGrayGLProgram()));this._slidBallNormalRenderer.setScale(this._sliderBallNormalTextureScaleX,this._sliderBallNormalTextureScaleY);
this._slidBallPressedRenderer.setVisible(!1)},setZoomScale:function(a){this._zoomScale=a},getZoomScale:function(){return this._zoomScale},getSlidBallNormalRenderer:function(){return this._slidBallNormalRenderer},getSlidBallPressedRenderer:function(){return this._slidBallPressedRenderer},getSlidBallDisabledRenderer:function(){return this._slidBallDisabledRenderer},getSlidBallRenderer:function(){return this._slidBallRenderer},getDescription:function(){return"Slider"},_createCloneInstance:function(){return new ccui.Slider},
_copySpecialProperties:function(a){this._prevIgnoreSize=a._prevIgnoreSize;this.setScale9Enabled(a._scale9Enabled);this.loadBarTexture(a._textureFile,a._barTexType);this.loadProgressBarTexture(a._progressBarTextureFile,a._progressBarTexType);this.loadSlidBallTextureNormal(a._slidBallNormalTextureFile,a._ballNTexType);this.loadSlidBallTexturePressed(a._slidBallPressedTextureFile,a._ballPTexType);this.loadSlidBallTextureDisabled(a._slidBallDisabledTextureFile,a._ballDTexType);this.setPercent(a.getPercent());
this._sliderEventListener=a._sliderEventListener;this._sliderEventSelector=a._sliderEventSelector;this._zoomScale=a._zoomScale;this._ccEventCallback=a._ccEventCallback}});_p=ccui.Slider.prototype;cc.defineGetterSetter(_p,"percent",_p.getPercent,_p.setPercent);_p=null;ccui.Slider.create=function(a,b,c){return new ccui.Slider(a,b,c)};ccui.Slider.EVENT_PERCENT_CHANGED=0;ccui.Slider.BASEBAR_RENDERER_ZORDER=-3;ccui.Slider.PROGRESSBAR_RENDERER_ZORDER=-2;ccui.Slider.BALL_RENDERER_ZORDER=-1;ccui.Text=ccui.Widget.extend({_touchScaleChangeEnabled:!1,_normalScaleValueX:1,_normalScaleValueY:1,_fontName:"Arial",_fontSize:16,_onSelectedScaleOffset:0.5,_labelRenderer:null,_textAreaSize:null,_textVerticalAlignment:0,_textHorizontalAlignment:0,_className:"Text",_type:null,_labelRendererAdaptDirty:!0,ctor:function(a,b,c){this._type=ccui.Text.Type.SYSTEM;this._textAreaSize=cc.size(0,0);ccui.Widget.prototype.ctor.call(this);void 0!==c?(this.setFontName(b),this.setFontSize(c),this.setString(a)):
this.setFontName(this._fontName)},_initRenderer:function(){this._labelRenderer=new cc.LabelTTF;this.addProtectedChild(this._labelRenderer,ccui.Text.RENDERER_ZORDER,-1)},setText:function(a){cc.log("Please use the setString");this.setString(a)},setString:function(a){a!==this._labelRenderer.getString()&&(this._setString(a),this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize()))},_setString:function(a){this._labelRenderer.setString(a);this._labelRendererAdaptDirty=!0},getStringValue:function(){cc.log("Please use the getString");
return this._labelRenderer.getString()},getString:function(){return this._labelRenderer.getString()},getStringLength:function(){return this._labelRenderer.getStringLength()},setFontSize:function(a){this._setFontSize(a);this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize())},_setFontSize:function(a){this._labelRenderer.setFontSize(a);this._fontSize=a;this._labelRendererAdaptDirty=!0},getFontSize:function(){return this._fontSize},setFontName:function(a){this._setFontName(a);this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize())},
_setFontName:function(a){this._fontName=a;this._labelRenderer.setFontName(a);this._labelRendererAdaptDirty=!0},_updateUITextContentSize:function(){this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize())},getFontName:function(){return this._fontName},_setFont:function(a){var b=cc.LabelTTF._fontStyleRE.exec(a);b&&(this._fontSize=parseInt(b[1]),this._fontName=b[2],this._labelRenderer._setFont(a),this._labelScaleChangedWithSize())},_getFont:function(){return this._labelRenderer._getFont()},
getType:function(){return this._type},setTextAreaSize:function(a){this._setTextAreaSize(a);this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize())},_setTextAreaSize:function(a){this._labelRenderer.setDimensions(a);this._ignoreSize||(this._customSize=a);this._labelRendererAdaptDirty=!0},getTextAreaSize:function(){return this._labelRenderer.getDimensions()},setTextHorizontalAlignment:function(a){this._setTextHorizontalAlignment(a);this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize())},
_setTextHorizontalAlignment:function(a){this._labelRenderer.setHorizontalAlignment(a);this._labelRendererAdaptDirty=!0},getTextHorizontalAlignment:function(){return this._labelRenderer.getHorizontalAlignment()},setTextVerticalAlignment:function(a){this._setTextVerticalAlignment(a);this._updateContentSizeWithTextureSize(this._labelRenderer.getContentSize())},_setTextVerticalAlignment:function(a){this._labelRenderer.setVerticalAlignment(a);this._labelRendererAdaptDirty=!0},getTextVerticalAlignment:function(){return this._labelRenderer.getVerticalAlignment()},
setTouchScaleChangeEnabled:function(a){this._touchScaleChangeEnabled=a},isTouchScaleChangeEnabled:function(){return this._touchScaleChangeEnabled},_onPressStateChangedToNormal:function(){this._touchScaleChangeEnabled&&(this._labelRenderer.setScaleX(this._normalScaleValueX),this._labelRenderer.setScaleY(this._normalScaleValueY))},_onPressStateChangedToPressed:function(){this._touchScaleChangeEnabled&&(this._labelRenderer.setScaleX(this._normalScaleValueX+this._onSelectedScaleOffset),this._labelRenderer.setScaleY(this._normalScaleValueY+
this._onSelectedScaleOffset))},_onPressStateChangedToDisabled:function(){},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);this._labelRendererAdaptDirty=!0},_adaptRenderers:function(){this._labelRendererAdaptDirty&&(this._labelScaleChangedWithSize(),this._labelRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return this._labelRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelRenderer},getAutoRenderSize:function(){var a=this._labelRenderer.getContentSize();
this._ignoreSize||(this._labelRenderer.setDimensions(0,0),a=this._labelRenderer.getContentSize(),this._labelRenderer.setDimensions(this._contentSize.width,this._contentSize.height));return a},_labelScaleChangedWithSize:function(){var a=this._contentSize;if(this._ignoreSize)this._labelRenderer.setScale(1),this._normalScaleValueX=this._normalScaleValueY=1;else{this._labelRenderer.setDimensions(cc.size(a.width,a.height));var b=this._labelRenderer.getContentSize();if(0>=b.width||0>=b.height){this._labelRenderer.setScale(1);
return}var c=a.width/b.width,b=a.height/b.height;this._labelRenderer.setScaleX(c);this._labelRenderer.setScaleY(b);this._normalScaleValueX=c;this._normalScaleValueY=b}this._labelRenderer.setPosition(a.width/2,a.height/2)},getDescription:function(){return"Label"},enableShadow:function(a,b,c){this._labelRenderer.enableShadow(a,b,c)},enableOutline:function(a,b){this._labelRenderer.enableStroke(a,b)},enableGlow:function(a){this._type===ccui.Text.Type.TTF&&this._labelRenderer.enableGlow(a)},disableEffect:function(){this._labelRenderer.disableEffect&&
this._labelRenderer.disableEffect()},_createCloneInstance:function(){return new ccui.Text},_copySpecialProperties:function(a){a instanceof ccui.Text&&(this.setFontName(a._fontName),this.setFontSize(a.getFontSize()),this.setString(a.getString()),this.setTouchScaleChangeEnabled(a.touchScaleEnabled),this.setTextAreaSize(a._textAreaSize),this.setTextHorizontalAlignment(a._labelRenderer.getHorizontalAlignment()),this.setTextVerticalAlignment(a._labelRenderer.getVerticalAlignment()),this.setContentSize(a.getContentSize()),
this.setTextColor(a.getTextColor()))},_setBoundingWidth:function(a){this._textAreaSize.width=a;this._labelRenderer._setBoundingWidth(a);this._labelScaleChangedWithSize()},_setBoundingHeight:function(a){this._textAreaSize.height=a;this._labelRenderer._setBoundingHeight(a);this._labelScaleChangedWithSize()},_getBoundingWidth:function(){return this._textAreaSize.width},_getBoundingHeight:function(){return this._textAreaSize.height},_changePosition:function(){this._adaptRenderers()},setColor:function(a){cc.ProtectedNode.prototype.setColor.call(this,
a);this._labelRenderer.setColor(a)},setTextColor:function(a){this._labelRenderer.setFontFillColor(a)},getTextColor:function(){return this._labelRenderer._getFillStyle()}});_p=ccui.Text.prototype;cc.defineGetterSetter(_p,"boundingWidth",_p._getBoundingWidth,_p._setBoundingWidth);cc.defineGetterSetter(_p,"boundingHeight",_p._getBoundingHeight,_p._setBoundingHeight);cc.defineGetterSetter(_p,"string",_p.getString,_p.setString);cc.defineGetterSetter(_p,"stringLength",_p.getStringLength);
cc.defineGetterSetter(_p,"font",_p._getFont,_p._setFont);cc.defineGetterSetter(_p,"fontSize",_p.getFontSize,_p.setFontSize);cc.defineGetterSetter(_p,"fontName",_p.getFontName,_p.setFontName);cc.defineGetterSetter(_p,"textAlign",_p.getTextHorizontalAlignment,_p.setTextHorizontalAlignment);cc.defineGetterSetter(_p,"verticalAlign",_p.getTextVerticalAlignment,_p.setTextVerticalAlignment);_p=null;ccui.Label=ccui.Text.create=function(a,b,c){return new ccui.Text(a,b,c)};ccui.Text.RENDERER_ZORDER=-1;
ccui.Text.Type={SYSTEM:0,TTF:1};ccui.TextAtlas=ccui.Widget.extend({_labelAtlasRenderer:null,_stringValue:"",_charMapFileName:"",_itemWidth:0,_itemHeight:0,_startCharMap:"",_className:"TextAtlas",_labelAtlasRendererAdaptDirty:null,ctor:function(a,b,c,d,e){ccui.Widget.prototype.ctor.call(this);void 0!==e&&this.setProperty(a,b,c,d,e)},_initRenderer:function(){this._labelAtlasRenderer=new cc.LabelAtlas;this._labelAtlasRenderer.setAnchorPoint(cc.p(0.5,0.5));this.addProtectedChild(this._labelAtlasRenderer,ccui.TextAtlas.RENDERER_ZORDER,
-1);this._labelAtlasRenderer.addEventListener("load",function(){this._updateContentSizeWithTextureSize(this._labelAtlasRenderer.getContentSize());this._findLayout()},this)},setProperty:function(a,b,c,d,e){this._stringValue=a;this._charMapFileName=b;this._itemWidth=c;this._itemHeight=d;this._startCharMap=e;this._labelAtlasRenderer.initWithString(a,this._charMapFileName,this._itemWidth,this._itemHeight,this._startCharMap[0]);this._updateContentSizeWithTextureSize(this._labelAtlasRenderer.getContentSize());
this._labelAtlasRendererAdaptDirty=!0},setString:function(a){a!==this._labelAtlasRenderer.getString()&&(this._stringValue=a,this._labelAtlasRenderer.setString(a),this._updateContentSizeWithTextureSize(this._labelAtlasRenderer.getContentSize()),this._labelAtlasRendererAdaptDirty=!0)},setStringValue:function(a){cc.log("Please use the setString");this.setString(a)},getStringValue:function(){cc.log("Please use the getString");return this.getString()},getString:function(){return this._labelAtlasRenderer.getString()},
getStringLength:function(){return this._labelAtlasRenderer.getStringLength()},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);this._labelAtlasRendererAdaptDirty=!0},_adaptRenderers:function(){this._labelAtlasRendererAdaptDirty&&(this._labelAtlasScaleChangedWithSize(),this._labelAtlasRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return this._labelAtlasRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelAtlasRenderer},_labelAtlasScaleChangedWithSize:function(){var a=
this._labelAtlasRenderer;if(this._ignoreSize)a.setScale(1);else{var b=a.getContentSize();if(0>=b.width||0>=b.height){a.setScale(1);return}a.setScaleX(this._contentSize.width/b.width);a.setScaleY(this._contentSize.height/b.height)}a.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"LabelAtlas"},_copySpecialProperties:function(a){a&&this.setProperty(a._stringValue,a._charMapFileName,a._itemWidth,a._itemHeight,a._startCharMap)},_createCloneInstance:function(){return new ccui.TextAtlas}});
_p=ccui.TextAtlas.prototype;cc.defineGetterSetter(_p,"string",_p.getString,_p.setString);_p=null;ccui.TextAtlas.create=function(a,b,c,d,e){return new ccui.TextAtlas(a,b,c,d,e)};ccui.TextAtlas.RENDERER_ZORDER=-1;ccui.LabelBMFont=ccui.TextBMFont=ccui.Widget.extend({_labelBMFontRenderer:null,_fntFileHasInit:!1,_fntFileName:"",_stringValue:"",_className:"TextBMFont",_labelBMFontRendererAdaptDirty:!0,ctor:function(a,b){ccui.Widget.prototype.ctor.call(this);this._loader=new cc.Sprite.LoadManager;void 0!==b&&(this.setFntFile(b),this.setString(a))},_initRenderer:function(){this._labelBMFontRenderer=new cc.LabelBMFont;this.addProtectedChild(this._labelBMFontRenderer,ccui.TextBMFont.RENDERER_ZORDER,-1)},setFntFile:function(a){if(a){this._fntFileName=
a;this._fntFileHasInit=!0;this._labelBMFontRenderer.initWithString(this._stringValue,a);this._updateContentSizeWithTextureSize(this._labelBMFontRenderer.getContentSize());this._labelBMFontRendererAdaptDirty=!0;var b=this;a=b._labelBMFontRenderer;a._textureLoaded||a.addEventListener("load",function(){b.setFntFile(b._fntFileName)})}},setText:function(a){cc.log("Please use the setString");this.setString(a)},setString:function(a){this._loader.clear();this._labelBMFontRenderer._textureLoaded?a!==this._labelBMFontRenderer.getString()&&
(this._stringValue=a,this._labelBMFontRenderer.setString(a),this._fntFileHasInit&&(this._updateContentSizeWithTextureSize(this._labelBMFontRenderer.getContentSize()),this._labelBMFontRendererAdaptDirty=!0)):this._loader.add(this._labelBMFontRenderer,function(){this.setString(a)},this)},getString:function(){return this._stringValue},getStringLength:function(){return this._labelBMFontRenderer.getStringLength()},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);this._labelBMFontRendererAdaptDirty=
!0},_adaptRenderers:function(){this._labelBMFontRendererAdaptDirty&&(this._labelBMFontScaleChangedWithSize(),this._labelBMFontRendererAdaptDirty=!1)},getVirtualRendererSize:function(){return this._labelBMFontRenderer.getContentSize()},getVirtualRenderer:function(){return this._labelBMFontRenderer},_labelBMFontScaleChangedWithSize:function(){var a=this._labelBMFontRenderer;if(this._ignoreSize)a.setScale(1);else{var b=a.getContentSize();if(0>=b.width||0>=b.height){a.setScale(1);return}a.setScaleX(this._contentSize.width/
b.width);a.setScaleY(this._contentSize.height/b.height)}a.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getDescription:function(){return"TextBMFont"},_createCloneInstance:function(){return new ccui.TextBMFont},_copySpecialProperties:function(a){this.setFntFile(a._fntFileName);this.setString(a._stringValue)}});_p=ccui.TextBMFont.prototype;cc.defineGetterSetter(_p,"string",_p.getString,_p.setString);_p=null;ccui.TextBMFont.create=function(a,b){return new ccui.TextBMFont(a,b)};
ccui.TextBMFont.RENDERER_ZORDER=-1;ccui._TextFieldRenderer=cc.TextFieldTTF.extend({_maxLengthEnabled:!1,_maxLength:0,_passwordEnabled:!1,_passwordStyleText:"",_attachWithIME:!1,_detachWithIME:!1,_insertText:!1,_deleteBackward:!1,_className:"_TextFieldRenderer",ctor:function(){cc.TextFieldTTF.prototype.ctor.call(this);this._maxLengthEnabled=!1;this._maxLength=0;this._passwordEnabled=!1;this._passwordStyleText="*";this._deleteBackward=this._insertText=this._detachWithIME=this._attachWithIME=!1},onEnter:function(){cc.TextFieldTTF.prototype.onEnter.call(this);
cc.TextFieldTTF.prototype.setDelegate.call(this,this)},onTextFieldAttachWithIME:function(a){this.setAttachWithIME(!0);return!1},onTextFieldInsertText:function(a,b,c){if(1===c&&"\n"===b)return!1;this.setInsertText(!0);return this._maxLengthEnabled&&cc.TextFieldTTF.prototype.getCharCount.call(this)>=this._maxLength},onTextFieldDeleteBackward:function(a,b,c){this.setDeleteBackward(!0);return!1},onTextFieldDetachWithIME:function(a){this.setDetachWithIME(!0);return!1},insertText:function(a,b){"\n"!==a&&
this._maxLengthEnabled&&this.getString().length>=this._maxLength?this._passwordEnabled&&this.setPasswordText(this.getString()):(cc.TextFieldTTF.prototype.insertText.call(this,a,b),this._passwordEnabled&&0<cc.TextFieldTTF.prototype.getCharCount.call(this)&&this.setPasswordText(this.getString()))},deleteBackward:function(){cc.TextFieldTTF.prototype.deleteBackward.call(this);0<cc.TextFieldTTF.prototype.getCharCount.call(this)&&this._passwordEnabled&&this.setPasswordText(this._inputText)},openIME:function(){cc.TextFieldTTF.prototype.attachWithIME.call(this)},
closeIME:function(){cc.TextFieldTTF.prototype.detachWithIME.call(this)},setMaxLengthEnabled:function(a){this._maxLengthEnabled=a},isMaxLengthEnabled:function(){return this._maxLengthEnabled},setMaxLength:function(a){this._maxLength=a},getMaxLength:function(){return this._maxLength},getCharCount:function(){return cc.TextFieldTTF.prototype.getCharCount.call(this)},setPasswordEnabled:function(a){this._passwordEnabled=a},isPasswordEnabled:function(){return this._passwordEnabled},setPasswordStyleText:function(a){if(!(1<
a.length)){var b=a.charCodeAt(0);33>b||126<b||(this._passwordStyleText=a)}},setPasswordText:function(a){var b="",c=a.length;a=c;this._maxLengthEnabled&&c>this._maxLength&&(a=this._maxLength);for(c=0;c<a;++c)b+=this._passwordStyleText;cc.LabelTTF.prototype.setString.call(this,b)},setAttachWithIME:function(a){this._attachWithIME=a},getAttachWithIME:function(){return this._attachWithIME},setDetachWithIME:function(a){this._detachWithIME=a},getDetachWithIME:function(){return this._detachWithIME},setInsertText:function(a){this._insertText=
a},getInsertText:function(){return this._insertText},setDeleteBackward:function(a){this._deleteBackward=a},getDeleteBackward:function(){return this._deleteBackward},onDraw:function(a){return!1}});ccui._TextFieldRenderer.create=function(a,b,c){var d=new ccui._TextFieldRenderer;return d&&d.initWithString("",b,c)?(a&&d.setPlaceHolder(a),d):null};
ccui.TextField=ccui.Widget.extend({_textFieldRenderer:null,_touchWidth:0,_touchHeight:0,_useTouchArea:!1,_textFieldEventListener:null,_textFieldEventSelector:null,_passwordStyleText:"",_textFieldRendererAdaptDirty:!0,_fontName:"",_fontSize:12,_ccEventCallback:null,ctor:function(a,b,c){ccui.Widget.prototype.ctor.call(this);this.setTouchEnabled(!0);b&&this.setFontName(b);c&&this.setFontSize(c);a&&this.setPlaceHolder(a)},onEnter:function(){ccui.Widget.prototype.onEnter.call(this);this.scheduleUpdate()},
_initRenderer:function(){this._textFieldRenderer=ccui._TextFieldRenderer.create("input words here","Thonburi",20);this.addProtectedChild(this._textFieldRenderer,ccui.TextField.RENDERER_ZORDER,-1)},setTouchSize:function(a){this._touchWidth=a.width;this._touchHeight=a.height},setTouchAreaEnabled:function(a){this._useTouchArea=a},hitTest:function(a){if(this._useTouchArea){a=this.convertToNodeSpace(a);var b=cc.rect(-this._touchWidth*this._anchorPoint.x,-this._touchHeight*this._anchorPoint.y,this._touchWidth,
this._touchHeight);return a.x>=b.x&&a.x<=b.x+b.width&&a.y>=b.y&&a.y<=b.y+b.height}return ccui.Widget.prototype.hitTest.call(this,a)},getTouchSize:function(){return cc.size(this._touchWidth,this._touchHeight)},setText:function(a){cc.log("Please use the setString");this.setString(a)},setString:function(a){null!=a&&(a=String(a),this.isMaxLengthEnabled()&&(a=a.substr(0,this.getMaxLength())),this.isPasswordEnabled()?(this._textFieldRenderer.setPasswordText(a),this._textFieldRenderer.setString(""),this._textFieldRenderer.insertText(a,
a.length)):this._textFieldRenderer.setString(a),this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize()))},setPlaceHolder:function(a){this._textFieldRenderer.setPlaceHolder(a);this._textFieldRendererAdaptDirty=!0;this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize())},getPlaceHolder:function(){return this._textFieldRenderer.getPlaceHolder()},getPlaceHolderColor:function(){return this._textFieldRenderer.getPlaceHolderColor()},
setPlaceHolderColor:function(a){this._textFieldRenderer.setColorSpaceHolder(a)},setTextColor:function(a){this._textFieldRenderer.setTextColor(a)},setFontSize:function(a){this._textFieldRenderer.setFontSize(a);this._fontSize=a;this._textFieldRendererAdaptDirty=!0;this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize())},getFontSize:function(){return this._fontSize},setFontName:function(a){this._textFieldRenderer.setFontName(a);this._fontName=a;this._textFieldRendererAdaptDirty=
!0;this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize())},getFontName:function(){return this._fontName},didNotSelectSelf:function(){this._textFieldRenderer.detachWithIME()},getStringValue:function(){cc.log("Please use the getString");return this.getString()},getString:function(){return this._textFieldRenderer.getString()},getStringLength:function(){return this._textFieldRenderer.getStringLength()},onTouchBegan:function(a,b){var c=this,d=ccui.Widget.prototype.onTouchBegan.call(c,
a,b);c._hit?setTimeout(function(){wx.showKeyboard({defaultValue:c.getString(),maxLength:140,multiple:!1,confirmHold:!0,confirmType:"done",success:function(a){},fail:function(a){cc.warn(a.errMsg)}});wx.onKeyboardConfirm(function(a){c.setString(a.value);wx.hideKeyboard({success:function(a){},fail:function(a){cc.warn(a.errMsg)}})});wx.onKeyboardInput(function(a){c.setString(a.value)});wx.onKeyboardComplete(function(){wx.offKeyboardConfirm();wx.offKeyboardInput();wx.offKeyboardComplete()})},0):setTimeout(function(){wx.hideKeyboard({success:function(a){},
fail:function(a){cc.warn(a.errMsg)}})},0);return d},setMaxLengthEnabled:function(a){this._textFieldRenderer.setMaxLengthEnabled(a)},isMaxLengthEnabled:function(){return this._textFieldRenderer.isMaxLengthEnabled()},setMaxLength:function(a){this._textFieldRenderer.setMaxLength(a);this.setString(this.getString())},getMaxLength:function(){return this._textFieldRenderer.getMaxLength()},setPasswordEnabled:function(a){this._textFieldRenderer.setPasswordEnabled(a)},isPasswordEnabled:function(){return this._textFieldRenderer.isPasswordEnabled()},
setPasswordStyleText:function(a){this._textFieldRenderer.setPasswordStyleText(a);this._passwordStyleText=a;this.setString(this.getString())},getPasswordStyleText:function(){return this._passwordStyleText},update:function(a){this.getDetachWithIME()&&(this._detachWithIMEEvent(),this.setDetachWithIME(!1));this.getAttachWithIME()&&(this._attachWithIMEEvent(),this.setAttachWithIME(!1));this.getInsertText()&&(this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize()),
this._insertTextEvent(),this.setInsertText(!1));this.getDeleteBackward()&&(this._textFieldRendererAdaptDirty=!0,this._updateContentSizeWithTextureSize(this._textFieldRenderer.getContentSize()),this._deleteBackwardEvent(),this.setDeleteBackward(!1))},getAttachWithIME:function(){return this._textFieldRenderer.getAttachWithIME()},setAttachWithIME:function(a){this._textFieldRenderer.setAttachWithIME(a)},getDetachWithIME:function(){return this._textFieldRenderer.getDetachWithIME()},setDetachWithIME:function(a){this._textFieldRenderer.setDetachWithIME(a)},
getInsertText:function(){return this._textFieldRenderer.getInsertText()},setInsertText:function(a){this._textFieldRenderer.setInsertText(a)},getDeleteBackward:function(){return this._textFieldRenderer.getDeleteBackward()},setDeleteBackward:function(a){this._textFieldRenderer.setDeleteBackward(a)},_attachWithIMEEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_ATTACH_WITH_IME):this._textFieldEventSelector(this,
ccui.TextField.EVENT_ATTACH_WITH_IME));this._ccEventCallback&&this._ccEventCallback(this,ccui.TextField.EVENT_ATTACH_WITH_IME)},_detachWithIMEEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_DETACH_WITH_IME):this._textFieldEventSelector(this,ccui.TextField.EVENT_DETACH_WITH_IME));this._ccEventCallback&&this._ccEventCallback(this,ccui.TextField.EVENT_DETACH_WITH_IME)},_insertTextEvent:function(){this._textFieldEventSelector&&
(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_INSERT_TEXT):this._textFieldEventSelector(this,ccui.TextField.EVENT_INSERT_TEXT));this._ccEventCallback&&this._ccEventCallback(this,ccui.TextField.EVENT_INSERT_TEXT)},_deleteBackwardEvent:function(){this._textFieldEventSelector&&(this._textFieldEventListener?this._textFieldEventSelector.call(this._textFieldEventListener,this,ccui.TextField.EVENT_DELETE_BACKWARD):this._textFieldEventSelector(this,
ccui.TextField.EVENT_DELETE_BACKWARD));this._ccEventCallback&&this._ccEventCallback(this,ccui.TextField.EVENT_DELETE_BACKWARD)},addEventListenerTextField:function(a,b){this.addEventListener(a,b)},addEventListener:function(a,b){this._textFieldEventSelector=a;this._textFieldEventListener=b},_onSizeChanged:function(){ccui.Widget.prototype._onSizeChanged.call(this);this._textFieldRendererAdaptDirty=!0},_adaptRenderers:function(){this._textFieldRendererAdaptDirty&&(this._textfieldRendererScaleChangedWithSize(),
this._textFieldRendererAdaptDirty=!1)},_textfieldRendererScaleChangedWithSize:function(){this._ignoreSize||this._textFieldRenderer.setDimensions(this._contentSize);this._textFieldRenderer.setPosition(this._contentSize.width/2,this._contentSize.height/2)},getAutoRenderSize:function(){var a=this._textFieldRenderer.getContentSize();this._ignoreSize||(this._textFieldRenderer.setDimensions(0,0),a=this._textFieldRenderer.getContentSize(),this._textFieldRenderer.setDimensions(this._contentSize.width,this._contentSize.height));
return a},getVirtualRendererSize:function(){return this._textFieldRenderer.getContentSize()},getVirtualRenderer:function(){return this._textFieldRenderer},getDescription:function(){return"TextField"},attachWithIME:function(){this._textFieldRenderer.attachWithIME()},_createCloneInstance:function(){return new ccui.TextField},_copySpecialProperties:function(a){this.setString(a._textFieldRenderer.getString());this.setPlaceHolder(a.getString());this.setFontSize(a._textFieldRenderer.getFontSize());this.setFontName(a._textFieldRenderer.getFontName());
this.setMaxLengthEnabled(a.isMaxLengthEnabled());this.setMaxLength(a.getMaxLength());this.setPasswordEnabled(a.isPasswordEnabled());this.setPasswordStyleText(a._passwordStyleText);this.setAttachWithIME(a.getAttachWithIME());this.setDetachWithIME(a.getDetachWithIME());this.setInsertText(a.getInsertText());this.setDeleteBackward(a.getDeleteBackward());this._ccEventCallback=a._ccEventCallback;this._textFieldEventListener=a._textFieldEventListener;this._textFieldEventSelector=a._textFieldEventSelector},
setTextAreaSize:function(a){this.setContentSize(a)},setTextHorizontalAlignment:function(a){this._textFieldRenderer.setHorizontalAlignment(a)},setTextVerticalAlignment:function(a){this._textFieldRenderer.setVerticalAlignment(a)},_setFont:function(a){this._textFieldRenderer._setFont(a);this._textFieldRendererAdaptDirty=!0},_getFont:function(){return this._textFieldRenderer._getFont()},_changePosition:function(){this._adaptRenderers()}});
ccui.TextField.create=function(a,b,c){return new ccui.TextField(a,b,c)};_p=ccui.TextField.prototype;cc.defineGetterSetter(_p,"string",_p.getString,_p.setString);cc.defineGetterSetter(_p,"placeHolder",_p.getPlaceHolder,_p.setPlaceHolder);cc.defineGetterSetter(_p,"font",_p._getFont,_p._setFont);cc.defineGetterSetter(_p,"fontSize",_p.getFontSize,_p.setFontSize);cc.defineGetterSetter(_p,"fontName",_p.getFontName,_p.setFontName);cc.defineGetterSetter(_p,"maxLengthEnabled",_p.isMaxLengthEnabled,_p.setMaxLengthEnabled);
cc.defineGetterSetter(_p,"maxLength",_p.getMaxLength,_p.setMaxLength);cc.defineGetterSetter(_p,"passwordEnabled",_p.isPasswordEnabled,_p.setPasswordEnabled);_p=null;ccui.TextField.EVENT_ATTACH_WITH_IME=0;ccui.TextField.EVENT_DETACH_WITH_IME=1;ccui.TextField.EVENT_INSERT_TEXT=2;ccui.TextField.EVENT_DELETE_BACKWARD=3;ccui.TextField.RENDERER_ZORDER=-1;ccui.VideoPlayer=ccui.Widget.extend({_played:!1,_playing:!1,_stopped:!0,ctor:function(a){ccui.Widget.prototype.ctor.call(this);this._EventList={};a&&this.setURL(a)},_createRenderCmd:function(){return new ccui.VideoPlayer.RenderCmd(this)},visit:function(){var a=this._renderCmd,b=cc.container,c=cc.eventManager;if(this._visible)b.appendChild(a._video),null===this._listener&&(this._listener=cc.eventManager.addCustomListener(cc.game.EVENT_RESIZE,function(){a.resize()}));else{var d=!1;(d="contains"in b?
b.contains(a._video):b.compareDocumentPosition(a._video)%16)&&b.removeChild(a._video);c.removeListener(a._listener);a._listener=null}a.updateStatus();a.resize()},setURL:function(a){this._renderCmd.updateURL(a)},getURL:function(){return this._renderCmd._url},play:function(){var a=this,b=this._renderCmd._video;if(b){this._played=!0;b.pause();if(!1!==this._stopped||!1!==this._playing||!0!==this._played)b.currentTime=0;ccui.VideoPlayer._polyfill.autoplayAfterOperation?setTimeout(function(){b.play();a._playing=
!0;a._stopped=!1},20):(b.play(),this._playing=!0,this._stopped=!1)}},pause:function(){var a=this._renderCmd._video;a&&!0===this._playing&&!1===this._stopped&&(a.pause(),this._playing=!1)},resume:function(){!1===this._stopped&&!1===this._playing&&!0===this._played&&this.play()},stop:function(){var a=this,b=this._renderCmd._video;b&&(b.pause(),b.currentTime=0,this._playing=!1,this._stopped=!0);setTimeout(function(){a._dispatchEvent(ccui.VideoPlayer.EventType.STOPPED)},0)},seekTo:function(a){var b=this._renderCmd._video;
b&&(b.currentTime=a,ccui.VideoPlayer._polyfill.autoplayAfterOperation&&this.isPlaying()&&setTimeout(function(){b.play()},20))},isPlaying:function(){ccui.VideoPlayer._polyfill.autoplayAfterOperation&&this._playing&&setTimeout(function(){video.play()},20);return this._playing},setKeepAspectRatioEnabled:function(a){cc.log("On the web is always keep the aspect ratio")},isKeepAspectRatioEnabled:function(){return!1},setFullScreenEnabled:function(a){var b=this._renderCmd._video;b&&(a?cc.screen.requestFullScreen(b):
cc.screen.exitFullScreen(b))},isFullScreenEnabled:function(){cc.log("Can't know status")},setEventListener:function(a,b){this._EventList[a]=b},removeEventListener:function(a){this._EventList[a]=null},_dispatchEvent:function(a){(a=this._EventList[a])&&a.call(this,this,this._renderCmd._video.src)},onPlayEvent:function(){var a=this._EventList[ccui.VideoPlayer.EventType.PLAYING];if(a)for(var b=0;b<a.length;b++)a[b].call(this,this,this._renderCmd._video.src)},setContentSize:function(a,b){ccui.Widget.prototype.setContentSize.call(this,
a,b);void 0===b&&(b=a.height,a=a.width);this._renderCmd.changeSize(a,b)},cleanup:function(){this._renderCmd.removeDom();this.stopAllActions();this.unscheduleAllCallbacks()},onEnter:function(){ccui.Widget.prototype.onEnter.call(this);var a=ccui.VideoPlayer.elements;-1===a.indexOf(this)&&a.push(this)},onExit:function(){ccui.Widget.prototype.onExit.call(this);var a=ccui.VideoPlayer.elements,b=a.indexOf(this);-1!==b&&a.splice(b,1)}});ccui.VideoPlayer.elements=[];ccui.VideoPlayer.pauseElements=[];
cc.eventManager.addCustomListener(cc.game.EVENT_HIDE,function(){for(var a=ccui.VideoPlayer.elements,b,c=0;c<a.length;c++)b=a[c],a[c]._playing&&(b.pause(),ccui.VideoPlayer.pauseElements.push(b))});cc.eventManager.addCustomListener(cc.game.EVENT_SHOW,function(){for(var a=ccui.VideoPlayer.pauseElements,b=a.pop();b;)b.play(),b=a.pop()});ccui.VideoPlayer.EventType={PLAYING:"play",PAUSED:"pause",STOPPED:"stop",COMPLETED:"complete"};
(function(a){if(!window.wx){a._polyfill={devicePixelRatio:!1,event:"canplay",canPlayType:[]};var b=document.createElement("video");b.canPlayType("video/ogg")&&(a._polyfill.canPlayType.push(".ogg"),a._polyfill.canPlayType.push(".ogv"));b.canPlayType("video/mp4")&&a._polyfill.canPlayType.push(".mp4");b.canPlayType("video/webm")&&a._polyfill.canPlayType.push(".webm");cc.sys.OS_IOS===cc.sys.os&&(a._polyfill.devicePixelRatio=!0,a._polyfill.event="progress");cc.sys.browserType===cc.sys.BROWSER_TYPE_FIREFOX&&
(a._polyfill.autoplayAfterOperation=!0);a=document.createElement("style");a.innerHTML=".cocosVideo:-moz-full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:full-screen{transform:matrix(1,0,0,1,0,0) !important;}.cocosVideo:-webkit-full-screen{transform:matrix(1,0,0,1,0,0) !important;}";document.head.appendChild(a)}})(ccui.VideoPlayer);
(function(a){if(!window.wx){var b=null,b=cc._renderType===cc.game.RENDER_TYPE_WEBGL?cc.Node.WebGLRenderCmd:cc.Node.CanvasRenderCmd;ccui.VideoPlayer.RenderCmd=function(a){this._rootCtor(a);this._listener=null;this._url="";this.initStyle()};b=ccui.VideoPlayer.RenderCmd.prototype=Object.create(b.prototype);b.constructor=ccui.VideoPlayer.RenderCmd;b.transform=function(a,b){this.originTransform(a,b);this.updateMatrix(this._worldTransform,cc.view._scaleX,cc.view._scaleY)};b.updateStatus=function(){a.devicePixelRatio=
cc.view.isRetinaEnabled();var b=cc.Node._dirtyFlags,d=this._dirtyFlag;d&b.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this.updateMatrix(this._worldTransform,cc.view._scaleX,cc.view._scaleY),this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty);d&b.orderDirty&&(this._dirtyFlag^=this._dirtyFlag&b.orderDirty)};b.resize=function(a){a=a||cc.view;var b=this._node,e=cc.eventManager;b._parent&&b._visible?this.updateMatrix(this._worldTransform,a._scaleX,a._scaleY):(e.removeListener(this._listener),
this._listener=null)};b.updateMatrix=function(b,d,e){var f=this._node;if(a.devicePixelRatio){var g=cc.view.getDevicePixelRatio();d/=g;e/=g}if(!1!==this._loaded){var h=cc.game.container.style,g=parseInt(h.paddingLeft),h=parseInt(h.paddingBottom),k=f._contentSize.width,m=f._contentSize.height;b="matrix("+b.a*d+","+b.b+","+b.c+","+b.d*e+","+(g+b.tx*d-k/2+k*f._scaleX/2*d)+","+-(h+b.ty*e-m/2+m*f._scaleY/2*e)+")";this._video.style.transform=b;this._video.style["-webkit-transform"]=b}};b.updateURL=function(b){var d,
e,f,g=this._node;if(this._url!=b){this._url=b;cc.loader.resPath&&!/^http/.test(b)&&(b=cc.path.join(cc.loader.resPath,b));d=!1;f=cc.container;(d="contains"in f?f.contains(this._video):f.compareDocumentPosition(this._video)%16)&&f.removeChild(this._video);e=this._video=document.createElement("video");this.bindEvent();var h=this,k=function(){!0!=h._loaded&&(h._loaded=!0,h.changeSize(),h.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),e.removeEventListener(a.event,k),e.currentTime=0,e.style.visibility=
"visible",e.play(),g._played||(e.pause(),e.currentTime=0))};e.addEventListener(a.event,k);e.preload="metadata";e.style.visibility="hidden";this._loaded=!1;g._played=!1;g._playing=!1;g._stopped=!0;this.initStyle();this._node.visit();d=document.createElement("source");d.src=b;e.appendChild(d);f=cc.path.extname(b);for(var m=0;m<a.canPlayType.length;m++)f!==a.canPlayType[m]&&(d=document.createElement("source"),d.src=b.replace(f,a.canPlayType[m]),e.appendChild(d))}};b.bindEvent=function(){var a=this,b=
this._node,e=this._video;e.addEventListener("ended",function(){b._renderCmd.updateMatrix(a._worldTransform,cc.view._scaleX,cc.view._scaleY);b._playing=!1;b._dispatchEvent(ccui.VideoPlayer.EventType.COMPLETED)});e.addEventListener("play",function(){b._dispatchEvent(ccui.VideoPlayer.EventType.PLAYING)});e.addEventListener("pause",function(){b._dispatchEvent(ccui.VideoPlayer.EventType.PAUSED)})};b.initStyle=function(){if(this._video){var a=this._video;a.style.position="absolute";a.style.bottom="0px";
a.style.left="0px";a.className="cocosVideo"}};b.changeSize=function(a,b){var e=this._node._contentSize;a=a||e.width;b=b||e.height;if(e=this._video)0!==a&&(e.width=a),0!==b&&(e.height=b)};b.removeDom=function(){var a=this._video;if(a){var b=!1;(b="contains"in cc.container?cc.container.contains(a):cc.container.compareDocumentPosition(a)%16)&&cc.container.removeChild(a)}}}})(ccui.VideoPlayer._polyfill);ccui.RichElement=ccui.Class.extend({_type:0,_tag:0,_color:null,_opacity:0,ctor:function(a,b,c){this._type=0;this._tag=a||0;this._color=cc.color(255,255,255,255);b&&(this._color.r=b.r,this._color.g=b.g,this._color.b=b.b);this._opacity=c||0;this._color.a=void 0===c?b.a:c}});
ccui.RichElementText=ccui.RichElement.extend({_text:"",_fontName:"",_fontSize:0,_fontDefinition:null,ctor:function(a,b,c,d,e,f){var g=b;b&&b instanceof cc.FontDefinition&&(g=b.fillStyle,e=b.fontName,f=b.fontSize,this._fontDefinition=b);ccui.RichElement.prototype.ctor.call(this,a,g,c);this._type=ccui.RichElement.TEXT;this._text=d;this._fontName=e;this._fontSize=f}});ccui.RichElementText.create=function(a,b,c,d,e,f){return new ccui.RichElementText(a,b,c,d,e,f)};
ccui.RichElementImage=ccui.RichElement.extend({_filePath:"",_textureRect:null,_textureType:0,ctor:function(a,b,c,d){ccui.RichElement.prototype.ctor.call(this,a,b,c);this._type=ccui.RichElement.IMAGE;this._filePath=d||"";this._textureRect=cc.rect(0,0,0,0);this._textureType=0}});ccui.RichElementImage.create=function(a,b,c,d){return new ccui.RichElementImage(a,b,c,d)};
ccui.RichElementCustomNode=ccui.RichElement.extend({_customNode:null,ctor:function(a,b,c,d){ccui.RichElement.prototype.ctor.call(this,a,b,c);this._type=ccui.RichElement.CUSTOM;this._customNode=d||null}});ccui.RichElementCustomNode.create=function(a,b,c,d){return new ccui.RichElementCustomNode(a,b,c,d)};
ccui.RichText=ccui.Widget.extend({_formatTextDirty:!1,_richElements:null,_elementRenders:null,_leftSpaceWidth:0,_verticalSpace:0,_elementRenderersContainer:null,_lineBreakOnSpace:!1,_textHorizontalAlignment:null,_textVerticalAlignment:null,ctor:function(){ccui.Widget.prototype.ctor.call(this);this._formatTextDirty=!1;this._richElements=[];this._elementRenders=[];this._verticalSpace=this._leftSpaceWidth=0;this._textHorizontalAlignment=cc.TEXT_ALIGNMENT_LEFT;this._textVerticalAlignment=cc.VERTICAL_TEXT_ALIGNMENT_TOP},
_initRenderer:function(){this._elementRenderersContainer=new cc.Node;this._elementRenderersContainer.setAnchorPoint(0.5,0.5);this.addProtectedChild(this._elementRenderersContainer,0,-1)},insertElement:function(a,b){this._richElements.splice(b,0,a);this._formatTextDirty=!0},pushBackElement:function(a){this._richElements.push(a);this._formatTextDirty=!0},removeElement:function(a){cc.isNumber(a)?this._richElements.splice(a,1):cc.arrayRemoveObject(this._richElements,a);this._formatTextDirty=!0},formatText:function(){if(this._formatTextDirty){this._elementRenderersContainer.removeAllChildren();
this._elementRenders.length=0;var a,b,c=this._richElements;if(this._ignoreSize)for(this._addNewLine(),a=0;a<c.length;a++){b=c[a];var d=null;switch(b._type){case ccui.RichElement.TEXT:d=b._fontDefinition?new cc.LabelTTF(b._text,b._fontDefinition):new cc.LabelTTF(b._text,b._fontName,b._fontSize);break;case ccui.RichElement.IMAGE:d=new cc.Sprite(b._filePath);break;case ccui.RichElement.CUSTOM:d=b._customNode}d.setColor(b._color);d.setOpacity(b._color.a);this._pushToContainer(d)}else for(this._addNewLine(),
a=0;a<c.length;a++)switch(b=c[a],b._type){case ccui.RichElement.TEXT:b._fontDefinition?this._handleTextRenderer(b._text,b._fontDefinition,b._fontDefinition.fontSize,b._fontDefinition.fillStyle):this._handleTextRenderer(b._text,b._fontName,b._fontSize,b._color);break;case ccui.RichElement.IMAGE:this._handleImageRenderer(b._filePath,b._color,b._color.a);break;case ccui.RichElement.CUSTOM:this._handleCustomRenderer(b._customNode)}this.formatRenderers();this._formatTextDirty=!1}},_handleTextRenderer:function(a,
b,c,d){if(""!==a)if("\n"===a)this._addNewLine();else{var e=b instanceof cc.FontDefinition?new cc.LabelTTF(a,b):new cc.LabelTTF(a,b,c),f=e.getContentSize().width;this._leftSpaceWidth-=f;if(0>this._leftSpaceWidth){var e=a.length*(1- -this._leftSpaceWidth/f),f=a.substr(0,e),g=a.substr(e,a.length-1),h=0<e;this._lineBreakOnSpace&&(g=f.lastIndexOf(" "),e=-1===g?e:g+1,g=a.substr(e,a.length-1),h=0<e&&" "!==g);h&&(a=null,b instanceof cc.FontDefinition?(a=new cc.LabelTTF(f.substr(0,e),b),a.setOpacity(b.fillStyle.a)):
(a=new cc.LabelTTF(f.substr(0,e),b,c),a.setColor(d),a.setOpacity(d.a)),this._pushToContainer(a));this._addNewLine();this._handleTextRenderer(g,b,c,d)}else b instanceof cc.FontDefinition?e.setOpacity(b.fillStyle.a):(e.setColor(d),e.setOpacity(d.a)),this._pushToContainer(e)}},_handleImageRenderer:function(a,b,c){a=new cc.Sprite(a);this._handleCustomRenderer(a)},_handleCustomRenderer:function(a){var b=a.getContentSize();this._leftSpaceWidth-=b.width;0>this._leftSpaceWidth?(this._addNewLine(),this._pushToContainer(a),
this._leftSpaceWidth-=b.width):this._pushToContainer(a)},_addNewLine:function(){this._leftSpaceWidth=this._customSize.width;this._elementRenders.push([])},formatRenderers:function(){var a=0,b=this._elementRenderersContainer,c=this._elementRenders,d,e,f,g,h,k;if(this._ignoreSize){d=0;f=c[0];for(e=g=0;e<f.length;e++)h=f[e],h.setAnchorPoint(cc.p(0,0)),h.setPosition(g,0),b.addChild(h,1,e),k=h.getLineHeight?h.getLineHeight():a,h=h.getContentSize(),d+=h.width,a=Math.max(Math.min(a,k),h.height),g+=h.width;
if(this._textHorizontalAlignment!==cc.TEXT_ALIGNMENT_LEFT)for(k=0,this._textHorizontalAlignment===cc.TEXT_ALIGNMENT_RIGHT?k=this._contentSize.width-g:this._textHorizontalAlignment===cc.TEXT_ALIGNMENT_CENTER&&(k=(this._contentSize.width-g)/2),e=0;e<f.length;e++)f[e].x+=k;b.setContentSize(d,a)}else{var m=[];for(d=0;d<c.length;d++){f=c[d];for(e=g=0;e<f.length;e++)h=f[e],k=h.getLineHeight?h.getLineHeight():h.getContentSize().height,g=Math.max(Math.min(h.getContentSize().height,k),g);m[d]=g;a+=m[d]}var n=
this._customSize.height;for(d=0;d<c.length;d++){f=c[d];g=0;n-=m[d]+this._verticalSpace;for(e=0;e<f.length;e++)h=f[e],h.setAnchorPoint(cc.p(0,0)),h.setPosition(cc.p(g,n)),b.addChild(h,1),g+=h.getContentSize().width;if(this._textHorizontalAlignment!==cc.TEXT_ALIGNMENT_LEFT||this._textVerticalAlignment!==cc.VERTICAL_TEXT_ALIGNMENT_TOP)for(k=0,this._textHorizontalAlignment===cc.TEXT_ALIGNMENT_RIGHT?k=this._contentSize.width-g:this._textHorizontalAlignment===cc.TEXT_ALIGNMENT_CENTER&&(k=(this._contentSize.width-
g)/2),g=0,this._textVerticalAlignment===cc.VERTICAL_TEXT_ALIGNMENT_BOTTOM?g=this._customSize.height-a:this._textVerticalAlignment===cc.VERTICAL_TEXT_ALIGNMENT_CENTER&&(g=(this._customSize.height-a)/2),e=0;e<f.length;e++)h=f[e],h.x+=k,h.y-=g}b.setContentSize(this._contentSize)}a=c.length;for(d=0;d<a;d++)c[d].length=0;this._elementRenders.length=0;this.setContentSize(this._ignoreSize?this.getVirtualRendererSize():this._customSize);this._updateContentSizeWithTextureSize(this._contentSize);b.setPosition(0.5*
this._contentSize.width,0.5*this._contentSize.height)},_pushToContainer:function(a){0>=this._elementRenders.length||this._elementRenders[this._elementRenders.length-1].push(a)},_adaptRenderers:function(){this.formatText()},setVerticalSpace:function(a){this._verticalSpace=a},setAnchorPoint:function(a){ccui.Widget.prototype.setAnchorPoint.call(this,a);this._elementRenderersContainer.setAnchorPoint(a)},_setAnchorX:function(a){ccui.Widget.prototype._setAnchorX.call(this,a);this._elementRenderersContainer._setAnchorX(a)},
_setAnchorY:function(a){ccui.Widget.prototype._setAnchorY.call(this,a);this._elementRenderersContainer._setAnchorY(a)},getVirtualRendererSize:function(){return this._elementRenderersContainer.getContentSize()},ignoreContentAdaptWithSize:function(a){this._ignoreSize!==a&&(this._formatTextDirty=!0,ccui.Widget.prototype.ignoreContentAdaptWithSize.call(this,a))},getContentSize:function(){this.formatText();return cc.Node.prototype.getContentSize.call(this)},_getWidth:function(){this.formatText();return cc.Node.prototype._getWidth.call(this)},
_getHeight:function(){this.formatText();return cc.Node.prototype._getHeight.call(this)},setContentSize:function(a,b){ccui.Widget.prototype.setContentSize.call(this,void 0===b?a.width:a,void 0===b?a.height:b);this._formatTextDirty=!0},getDescription:function(){return"RichText"},setCascadeOpacityEnabled:function(a){ccui.Widget.prototype.setCascadeOpacityEnabled.call(this,a);this._elementRenderersContainer.setCascadeOpacityEnabled(a)},setLineBreakOnSpace:function(a){this._lineBreakOnSpace=a;this._formatTextDirty=
!0;this.formatText()},setTextHorizontalAlignment:function(a){a!==this._textHorizontalAlignment&&(this._textHorizontalAlignment=a,this.formatText())},setTextVerticalAlignment:function(a){a!==this._textVerticalAlignment&&(this._textVerticalAlignment=a,this.formatText())}});ccui.RichText.create=function(){return new ccui.RichText};ccui.RichElement.TEXT=0;ccui.RichElement.IMAGE=1;ccui.RichElement.CUSTOM=2;ccui.WebView=ccui.Widget.extend({ctor:function(a){ccui.Widget.prototype.ctor.call(this);this._EventList={};a&&this.loadURL(a)},visit:function(){var a=this._renderCmd,b=a._div,c=cc.container,d=cc.eventManager;if(this._visible)c.appendChild(b),null===this._listener&&(this._listener=d.addCustomListener(cc.game.EVENT_RESIZE,function(){a.resize()}));else{var e=!1;(e="contains"in c?c.contains(b):c.compareDocumentPosition(b)%16)&&c.removeChild(b);b=d._listenersMap[cc.game.EVENT_RESIZE].getFixedPriorityListeners();
d._removeListenerInVector(b,a._listener);a._listener=null}a.updateStatus();a.resize(cc.view)},setJavascriptInterfaceScheme:function(a){},loadData:function(a,b,c,d){},loadHTMLString:function(a,b){},loadURL:function(a){this._renderCmd.updateURL(a);this._dispatchEvent(ccui.WebView.EventType.LOADING)},stopLoading:function(){cc.log("Web does not support loading")},reload:function(){var a=this._renderCmd._iframe;a&&(a=a.contentWindow)&&a.location&&a.location.reload()},canGoBack:function(){cc.log("Web does not support query history");
return!0},canGoForward:function(){cc.log("Web does not support query history");return!0},goBack:function(){try{if(ccui.WebView._polyfill.closeHistory)return cc.log("The current browser does not support the GoBack");var a=this._renderCmd._iframe;if(a){var b=a.contentWindow;if(b&&b.location)try{b.history.back.call(b)}catch(c){b.history.back()}}}catch(d){cc.log(d)}},goForward:function(){try{if(ccui.WebView._polyfill.closeHistory)return cc.log("The current browser does not support the GoForward");var a=
this._renderCmd._iframe;if(a){var b=a.contentWindow;if(b&&b.location)try{b.history.forward.call(b)}catch(c){b.history.forward()}}}catch(d){cc.log(d)}},evaluateJS:function(a){var b=this._renderCmd._iframe;if(b){b=b.contentWindow;try{b.eval(a),this._dispatchEvent(ccui.WebView.EventType.JS_EVALUATED)}catch(c){console.error(c)}}},setScalesPageToFit:function(){cc.log("Web does not support zoom")},setEventListener:function(a,b){this._EventList[a]=b},removeEventListener:function(a){this._EventList[a]=null},
_dispatchEvent:function(a){(a=this._EventList[a])&&a.call(this,this,this._renderCmd._iframe.src)},_createRenderCmd:function(){return new ccui.WebView.RenderCmd(this)},setContentSize:function(a,b){ccui.Widget.prototype.setContentSize.call(this,a,b);void 0===b&&(b=a.height,a=a.width);this._renderCmd.changeSize(a,b)},cleanup:function(){this._renderCmd.removeDom();this.stopAllActions();this.unscheduleAllCallbacks()}});ccui.WebView.EventType={LOADING:"loading",LOADED:"load",ERROR:"error",JS_EVALUATED:"js"};
(function(){var a=ccui.WebView._polyfill={devicePixelRatio:!1,enableDiv:!1};cc.sys.os===cc.sys.OS_IOS&&(a.enableDiv=!0);cc.sys.isMobile?cc.sys.browserType===cc.sys.BROWSER_TYPE_FIREFOX&&(a.enableBG=!0):cc.sys.browserType===cc.sys.BROWSER_TYPE_IE&&(a.closeHistory=!0)})();
(function(a){var b=null,b=cc._renderType===cc.game.RENDER_TYPE_WEBGL?cc.Node.WebGLRenderCmd:cc.Node.CanvasRenderCmd;ccui.WebView.RenderCmd=function(b){this._rootCtor(b);this._iframe=this._div=null;a.enableDiv?(this._div=document.createElement("div"),this._div.style["-webkit-overflow"]="auto",this._div.style["-webkit-overflow-scrolling"]="touch",this._iframe=document.createElement("iframe"),this._iframe.style.width="100%",this._iframe.style.height="100%",this._div.appendChild(this._iframe)):this._div=
this._iframe=document.createElement("iframe");a.enableBG&&(this._div.style.background="#FFF");this._iframe.addEventListener("load",function(){b._dispatchEvent(ccui.WebView.EventType.LOADED)});this._iframe.addEventListener("error",function(){b._dispatchEvent(ccui.WebView.EventType.ERROR)});this._div.style.background="#FFF";this._div.style.height="200px";this._div.style.width="300px";this._div.style.overflow="scroll";this._div.style.border="none";this._listener=null;this.initStyle()};b=ccui.WebView.RenderCmd.prototype=
Object.create(b.prototype);b.constructor=ccui.WebView.RenderCmd;b.transform=function(a,b){this.originTransform(a,b);this.updateMatrix(this._worldTransform,cc.view._scaleX,cc.view._scaleY)};b.updateStatus=function(){a.devicePixelRatio=cc.view.isRetinaEnabled();var b=cc.Node._dirtyFlags,d=this._dirtyFlag;d&b.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this.updateMatrix(this._worldTransform,cc.view._scaleX,cc.view._scaleY),this._dirtyFlag^=this._dirtyFlag&cc.Node._dirtyFlags.transformDirty);
d&b.orderDirty&&(this._dirtyFlag^=this._dirtyFlag&b.orderDirty)};b.resize=function(a){a=a||cc.view;var b=this._node,e=cc.eventManager;b._parent&&b._visible?this.updateMatrix(this._worldTransform,a._scaleX,a._scaleY):(a=e._listenersMap[cc.game.EVENT_RESIZE].getFixedPriorityListeners(),e._removeListenerInVector(a,this._listener),this._listener=null)};b.updateMatrix=function(b,d,e){var f=this._node;if(a.devicePixelRatio){var g=cc.view.getDevicePixelRatio();d/=g;e/=g}if(!1!==this._loaded){var h=cc.game.container.style,
g=parseInt(h.paddingLeft),h=parseInt(h.paddingBottom),k=f._contentSize.width,m=f._contentSize.height;b="matrix("+b.a*d+","+b.b+","+b.c+","+b.d*e+","+(g+b.tx*d-k/2+k*f._scaleX/2*d)+","+-(h+b.ty*e-m/2+m*f._scaleY/2*e)+")";this._div.style.transform=b;this._div.style["-webkit-transform"]=b}};b.initStyle=function(){if(this._div){var a=this._div;a.style.position="absolute";a.style.bottom="0px";a.style.left="0px"}};b.updateURL=function(a){var b=this._iframe;b.src=a;var e=this,f=function(){e._loaded=!0;b.removeEventListener("load",
f)};b.addEventListener("load",f)};b.changeSize=function(a,b){var e=this._div;e&&(e.style.width=a+"px",e.style.height=b+"px")};b.removeDom=function(){var a=this._div;if(a){var b=!1;(b="contains"in cc.container?cc.container.contains(a):cc.container.compareDocumentPosition(a)%16)&&cc.container.removeChild(a)}}})(ccui.WebView._polyfill);ccui.ScrollViewBar=ccui.ProtectedNode.extend({_parentScroll:null,_direction:null,_upperHalfCircle:null,_lowerHalfCircle:null,_body:null,_opacity:255,_marginFromBoundary:0,_marginForLength:0,_touching:!1,_autoHideEnabled:!0,autoHideTime:0,_autoHideRemainingTime:0,_className:"ScrollViewBar",ctor:function(a,b){cc.ProtectedNode.prototype.ctor.call(this);this._direction=b;this._parentScroll=a;this._marginForLength=this._marginFromBoundary=ccui.ScrollViewBar.DEFAULT_MARGIN;this.opacity=255*ccui.ScrollViewBar.DEFAULT_SCROLLBAR_OPACITY;
this.autoHideTime=ccui.ScrollViewBar.DEFAULT_AUTO_HIDE_TIME;this._autoHideEnabled=!0;ccui.ScrollViewBar.prototype.init.call(this);this.setCascadeColorEnabled(!0);this.setCascadeOpacityEnabled(!0)},init:function(){this._upperHalfCircle=ccui.helper._createSpriteFromBase64(ccui.ScrollViewBar.HALF_CIRCLE_IMAGE,ccui.ScrollViewBar.HALF_CIRCLE_IMAGE_KEY);this._upperHalfCircle.setAnchorPoint(cc.p(0.5,0));this._lowerHalfCircle=ccui.helper._createSpriteFromBase64(ccui.ScrollViewBar.HALF_CIRCLE_IMAGE,ccui.ScrollViewBar.HALF_CIRCLE_IMAGE_KEY);
this._lowerHalfCircle.setAnchorPoint(cc.p(0.5,0));this._lowerHalfCircle.setScaleY(-1);this.addProtectedChild(this._upperHalfCircle);this.addProtectedChild(this._lowerHalfCircle);this._body=ccui.helper._createSpriteFromBase64(ccui.ScrollViewBar.BODY_IMAGE_1_PIXEL_HEIGHT,ccui.ScrollViewBar.BODY_IMAGE_1_PIXEL_HEIGHT_KEY);this._body.setAnchorPoint(cc.p(0.5,0));this.addProtectedChild(this._body);this.setColor(ccui.ScrollViewBar.DEFAULT_COLOR);this.onScrolled(cc.p(0,0));cc.ProtectedNode.prototype.setOpacity.call(this,
0);this._autoHideRemainingTime=0;this._direction===ccui.ScrollView.DIR_HORIZONTAL&&this.setRotation(90)},setPositionFromCorner:function(a){this._direction===ccui.ScrollView.DIR_VERTICAL?(this._marginForLength=a.y,this._marginFromBoundary=a.x):(this._marginForLength=a.x,this._marginFromBoundary=a.y)},onEnter:function(){cc.ProtectedNode.prototype.onEnter.call(this);this.scheduleUpdate()},getPositionFromCorner:function(){return this._direction===ccui.ScrollView.DIR_VERTICAL?cc.p(this._marginFromBoundary,
this._marginForLength):cc.p(this._marginForLength,this._marginFromBoundary)},setWidth:function(a){a/=this._body.width;this._body.setScaleX(a);this._upperHalfCircle.setScale(a);this._lowerHalfCircle.setScale(-a)},getWidth:function(){return this._body.getBoundingBox().width},setAutoHideEnabled:function(a){this._autoHideEnabled=a;!this._autoHideEnabled&&!this._touching&&0>=this._autoHideRemainingTime?cc.ProtectedNode.prototype.setOpacity.call(this,this.opacity):cc.ProtectedNode.prototype.setOpacity.call(this,
0)},isAutoHideEnabled:function(){return this._autoHideEnabled},setOpacity:function(a){this._opacity=a},getOpacity:function(){return this._opacity},_updateLength:function(a){var b=a/this._body.getTextureRect().height;this._body.setScaleY(b);this._upperHalfCircle.setPositionY(this._body.getPositionY()+a)},_processAutoHide:function(a){!this._autoHideEnabled||0>=this._autoHideRemainingTime||this._touching||(this._autoHideRemainingTime-=a,this._autoHideRemainingTime<=this.autoHideTime&&(this._autoHideRemainingTime=
Math.max(0,this._autoHideRemainingTime),cc.ProtectedNode.prototype.setOpacity.call(this,this._autoHideRemainingTime/this.autoHideTime*this._opacity)))},update:function(a){this._processAutoHide(a)},onTouchBegan:function(){this._autoHideEnabled&&(this._touching=!0)},onTouchEnded:function(){this._autoHideEnabled&&(this._touching=!1,0>=this._autoHideRemainingTime||(this._autoHideRemainingTime=this.autoHideTime))},onScrolled:function(a){this._autoHideEnabled&&(this._autoHideRemainingTime=this.autoHideTime,
cc.ProtectedNode.prototype.setOpacity.call(this,this.opacity));var b=this._parentScroll.getInnerContainer(),c=0,d=0,e=0,f=0;this._direction===ccui.ScrollView.DIR_VERTICAL?(c=b.height,d=this._parentScroll.height,e=a.y,f=-b.getPositionY()):this._direction===ccui.ScrollView.DIR_HORIZONTAL&&(c=b.width,d=this._parentScroll.width,e=a.x,f=-b.getPositionX());a=this._calculateLength(c,d,e);c=this._calculatePosition(c,d,f,e,a);this._updateLength(a);this.setPosition(c)},_calculateLength:function(a,b,c){0!==
c&&(a+=20*(0<c?c:-c));c=b/a;return Math.abs(b-2*this._marginForLength)*c},_calculatePosition:function(a,b,c,d,e){a-=b;0!==d&&(a+=Math.abs(d));d=0;0!==a&&(d=Math.max(c/a,0),d=Math.min(d,1));b=(b-e-2*this._marginForLength)*d+this._marginForLength;return this._direction===ccui.ScrollView.DIR_VERTICAL?cc.p(this._parentScroll.width-this._marginFromBoundary,b):cc.p(b,this._marginFromBoundary)}});_p=ccui.ScrollViewBar.prototype;cc.defineGetterSetter(_p,"opacity",_p.getOpacity,_p.setOpacity);
cc.defineGetterSetter(_p,"autoHideEnabled",_p.isAutoHideEnabled,_p.setAutoHideEnabled);ccui.ScrollViewBar.DEFAULT_COLOR=cc.color(52,65,87);ccui.ScrollViewBar.DEFAULT_MARGIN=20;ccui.ScrollViewBar.DEFAULT_AUTO_HIDE_TIME=0.2;ccui.ScrollViewBar.DEFAULT_SCROLLBAR_OPACITY=0.4;ccui.ScrollViewBar.HALF_CIRCLE_IMAGE_KEY="/__half_circle_image";ccui.ScrollViewBar.HALF_CIRCLE_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAGCAMAAADAMI+zAAAAJ1BMVEX///////////////////////////////////////////////////9Ruv0SAAAADHRSTlMABgcbbW7Hz9Dz+PmlcJP5AAAAMElEQVR4AUXHwQ2AQAhFwYcLH1H6r1djzDK3ASxUpTBeK/uTCyz7dx54b44m4p5cD1MwAooEJyk3AAAAAElFTkSuQmCC";
ccui.ScrollViewBar.BODY_IMAGE_1_PIXEL_HEIGHT_KEY="/__body_image_height";ccui.ScrollViewBar.BODY_IMAGE_1_PIXEL_HEIGHT="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAABCAMAAADdNb8LAAAAA1BMVEX///+nxBvIAAAACklEQVR4AWNABgAADQABYc2cpAAAAABJRU5ErkJggg\x3d\x3d";ccui.ScrollView=ccui.Layout.extend({_innerContainer:null,_direction:null,_topBoundary:0,_bottomBoundary:0,_leftBoundary:0,_rightBoundary:0,_touchMoveDisplacements:null,_touchMoveTimeDeltas:null,_touchMovePreviousTimestamp:0,_touchTotalTimeThreshold:0.5,_autoScrolling:!1,_autoScrollTargetDelta:null,_autoScrollAttenuate:!0,_autoScrollStartPosition:null,_autoScrollTotalTime:0,_autoScrollAccumulatedTime:0,_autoScrollCurrentlyOutOfBoundary:!1,_autoScrollBraking:!1,_autoScrollBrakingStartPosition:null,
_bePressed:!1,_childFocusCancelOffset:0,bounceEnabled:!1,_outOfBoundaryAmount:null,_outOfBoundaryAmountDirty:!0,inertiaScrollEnabled:!1,_scrollBarEnabled:!0,_verticalScrollBar:null,_horizontalScrollBar:null,_scrollViewEventListener:null,_scrollViewEventSelector:null,_className:"ScrollView",ctor:function(){ccui.Layout.prototype.ctor.call(this);this.setClippingEnabled(!0);this._innerContainer.setTouchEnabled(!1);this._direction=ccui.ScrollView.DIR_NONE;this._childFocusCancelOffset=5;this.inertiaScrollEnabled=
!0;this._outOfBoundaryAmount=cc.p(0,0);this._autoScrollTargetDelta=cc.p(0,0);this._autoScrollStartPosition=cc.p(0,0);this._autoScrollBrakingStartPosition=cc.p(0,0);this._touchMoveDisplacements=[];this._touchMoveTimeDeltas=[];this._touchMovePreviousTimestamp=0;this._scrollBarEnabled=!0;this._initScrollBar();this.setTouchEnabled(!0)},onEnter:function(){ccui.Layout.prototype.onEnter.call(this);this.scheduleUpdate()},onExit:function(){cc.renderer._removeCache(this.__instanceId);ccui.Layout.prototype.onExit.call(this)},
visit:function(a){var b=this._renderCmd,c=a?a._renderCmd:null;if(this._visible){this._adaptRenderers();this._doLayout();a=cc.renderer;b.visit(c);a.pushRenderCommand(b);b instanceof ccui.ScrollView.WebGLRenderCmd&&a._turnToCacheMode(this.__instanceId);var d=this._clippingEnabled&&this._clippingType===ccui.Layout.CLIPPING_STENCIL,e=this._clippingEnabled&&this._clippingType===ccui.Layout.CLIPPING_SCISSOR;d?b.stencilClippingVisit(c):e&&b.scissorClippingVisit(c);var f,g=this._children,h=g.length,k,c=this._protectedChildren,
m=c.length;this._reorderChildDirty&&this.sortAllChildren();this._reorderProtectedChildDirty&&this.sortAllProtectedChildren();for(f=0;f<h;f++)(k=g[f])&&k._visible&&k.visit(this);for(f=0;f<m;f++)(g=c[f])&&g._visible&&(b._changeProtectedChild(g),g.visit(this));d?b.postStencilVisit():e&&b.postScissorVisit();b instanceof ccui.ScrollView.WebGLRenderCmd&&a._turnToNormalMode();this.updateChildren();b._dirtyFlag=0}else b._propagateFlagsDown(c)},findNextFocusedWidget:function(a,b){return this.getLayoutType()===
ccui.Layout.LINEAR_VERTICAL||this.getLayoutType()===ccui.Layout.LINEAR_HORIZONTAL?this._innerContainer.findNextFocusedWidget(a,b):ccui.Widget.prototype.findNextFocusedWidget.call(this,a,b)},_initRenderer:function(){ccui.Layout.prototype._initRenderer.call(this);this._innerContainer=new ccui.Layout;this._innerContainer.setColor(cc.color(255,255,255));this._innerContainer.setOpacity(255);this._innerContainer.setCascadeColorEnabled(!0);this._innerContainer.setCascadeOpacityEnabled(!0);this.addProtectedChild(this._innerContainer,
1,1)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new ccui.ScrollView.WebGLRenderCmd(this):new ccui.ScrollView.CanvasRenderCmd(this)},_onSizeChanged:function(){ccui.Layout.prototype._onSizeChanged.call(this);var a=this._contentSize;this._topBoundary=a.height;this._rightBoundary=a.width;var b=this._innerContainer.getContentSize();this._innerContainer.setContentSize(cc.size(Math.max(b.width,a.width),Math.max(b.height,a.height)));this._innerContainer.setPosition(0,a.height-
this._innerContainer.getContentSize().height);if(this._verticalScrollBar)this._verticalScrollBar.onScrolled(this._getHowMuchOutOfBoundary());if(this._horizontalScrollBar)this._horizontalScrollBar.onScrolled(this._getHowMuchOutOfBoundary())},setInnerContainerSize:function(a){var b=this._innerContainer,c=this._contentSize,d=c.width,e=c.height;a.width<c.width?cc.log("Inner width \x3c\x3d ScrollView width, it will be force sized!"):d=a.width;a.height<c.height?cc.log("Inner height \x3c\x3d ScrollView height, it will be force sized!"):
e=a.height;b.setContentSize(cc.size(d,e));a=this._innerContainer.getPosition();b=this._innerContainer.getAnchorPoint();0!=this._innerContainer.getLeftBoundary()&&(a.x=b.x*d);this._innerContainer.getTopBoundary()!=this._contentSize.height&&(a.y=this._contentSize.height-(1-b.y)*e);this.setInnerContainerPosition(a);this._updateScrollBar(cc.p(0,0))},_setInnerWidth:function(a){var b=this._contentSize.width,c=b,d=this._innerContainer,e=d.width;a<b?cc.log("Inner width \x3c\x3d scrollview width, it will be force sized!"):
c=a;d.width=c;switch(this._direction){case ccui.ScrollView.DIR_HORIZONTAL:case ccui.ScrollView.DIR_BOTH:d.getRightBoundary()<=b&&this._scrollChildren(e-d.width,0)}a=d.anchorX;0<d.getLeftBoundary()&&(d.x=a*c);d.getRightBoundary()<b&&(d.x=b-(1-a)*c)},_setInnerHeight:function(a){var b=this._contentSize.height,c=b,d=this._innerContainer,e=d.height;a<b?cc.log("Inner height \x3c\x3d scrollview height, it will be force sized!"):c=a;d.height=c;switch(this._direction){case ccui.ScrollView.DIR_VERTICAL:case ccui.ScrollView.DIR_BOTH:this._scrollChildren(0,
e-c)}a=d.anchorY;0<d.getLeftBoundary()&&(d.y=a*c);d.getRightBoundary()<b&&(d.y=b-(1-a)*c)},setInnerContainerPosition:function(a){if(a.x!==this._innerContainer.getPositionX()||a.y!==this._innerContainer.getPositionY()){this._innerContainer.setPosition(a);this._outOfBoundaryAmountDirty=!0;if(this.bounceEnabled)for(a=ccui.ScrollView.MOVEDIR_TOP;a<ccui.ScrollView.MOVEDIR_RIGHT;++a)this._isOutOfBoundary(a)&&this._processScrollEvent(a,!0);this._dispatchEvent(ccui.ScrollView.EVENT_CONTAINER_MOVED)}},getInnerContainerPosition:function(){return this._innerContainer.getPosition()},
getInnerContainerSize:function(){return this._innerContainer.getContentSize()},_getInnerWidth:function(){return this._innerContainer.width},_getInnerHeight:function(){return this._innerContainer.height},_isInContainer:function(a){if(!this._clippingEnabled)return!0;var b=a._position,c=a._contentSize;a=a._anchorPoint;var d=this._customSize,e=this._innerContainer._position,f=0,g=0;return(f=b.y-a.y*c.height)>=d.height-e.y||f+c.height<=-e.y||(g=b.x-a.x*c.width)>=d.width-e.x||g+c.width<=-e.x?!1:!0},updateChildren:function(){var a,
b,c,d=this._innerContainer._children;b=0;for(c=d.length;b<c;b++)a=d[b],!0===a._inViewRect&&!1===this._isInContainer(a)?a._inViewRect=!1:!1===a._inViewRect&&!0===this._isInContainer(a)&&(a._inViewRect=!0)},addChild:function(a,b,c){if(!a)return!1;!1===this._isInContainer(a)&&(a._inViewRect=!1);b=b||a.getLocalZOrder();c=c||a.getTag();return this._innerContainer.addChild(a,b,c)},removeAllChildren:function(){this.removeAllChildrenWithCleanup(!0)},removeAllChildrenWithCleanup:function(a){this._innerContainer.removeAllChildrenWithCleanup(a)},
removeChild:function(a,b){return this._innerContainer.removeChild(a,b)},getChildren:function(){return this._innerContainer.getChildren()},getChildrenCount:function(){return this._innerContainer.getChildrenCount()},getChildByTag:function(a){return this._innerContainer.getChildByTag(a)},getChildByName:function(a){return this._innerContainer.getChildByName(a)},_flattenVectorByDirection:function(a){var b=cc.p(0,0);b.x=this._direction===ccui.ScrollView.DIR_VERTICAL?0:a.x;b.y=this._direction===ccui.ScrollView.DIR_HORIZONTAL?
0:a.y;return b},_getHowMuchOutOfBoundary:function(a){void 0===a&&(a=cc.p(0,0));if(0===a.x&&0===a.y&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var b=cc.p(0,0);this._innerContainer.getLeftBoundary()+a.x>this._leftBoundary?b.x=this._leftBoundary-(this._innerContainer.getLeftBoundary()+a.x):this._innerContainer.getRightBoundary()+a.x<this._rightBoundary&&(b.x=this._rightBoundary-(this._innerContainer.getRightBoundary()+a.x));this._innerContainer.getTopBoundary()+a.y<this._topBoundary?
b.y=this._topBoundary-(this._innerContainer.getTopBoundary()+a.y):this._innerContainer.getBottomBoundary()+a.y>this._bottomBoundary&&(b.y=this._bottomBoundary-(this._innerContainer.getBottomBoundary()+a.y));0===a.x&&0===a.y&&(this._outOfBoundaryAmount=b,this._outOfBoundaryAmountDirty=!1);return b},_isOutOfBoundary:function(a){var b=this._getHowMuchOutOfBoundary();if(void 0!==a)switch(a){case ccui.ScrollView.MOVEDIR_TOP:return 0<b.y;case ccui.ScrollView.MOVEDIR_BOTTOM:return 0>b.y;case ccui.ScrollView.MOVEDIR_LEFT:return 0>
b.x;case ccui.ScrollView.MOVEDIR_RIGHT:return 0<b.x}else return!this._fltEqualZero(b);return!1},_moveInnerContainer:function(a,b){var c=this._flattenVectorByDirection(a);this.setInnerContainerPosition(cc.pAdd(this.getInnerContainerPosition(),c));c=this._getHowMuchOutOfBoundary();this._updateScrollBar(c);this.bounceEnabled&&b&&this._startBounceBackIfNeeded()},_updateScrollBar:function(a){if(this._verticalScrollBar)this._verticalScrollBar.onScrolled(a);if(this._horizontalScrollBar)this._horizontalScrollBar.onScrolled(a)},
_calculateTouchMoveVelocity:function(){for(var a=0,b=0;b<this._touchMoveTimeDeltas.length;++b)a+=this._touchMoveTimeDeltas[b];if(0==a||a>=this._touchTotalTimeThreshold)return cc.p(0,0);for(var c=cc.p(0,0),b=0;b<this._touchMoveDisplacements.length;++b)c.x+=this._touchMoveDisplacements[b].x,c.y+=this._touchMoveDisplacements[b].y;return cc.pMult(c,1/a)},setTouchTotalTimeThreshold:function(a){this._touchTotalTimeThreshold=a},getTouchTotalTimeThreshold:function(){return this._touchTotalTimeThreshold},
_startInertiaScroll:function(a){var b=cc.pMult(a,0.7);this._startAttenuatingAutoScroll(b,a)},_startBounceBackIfNeeded:function(){if(!this.bounceEnabled)return!1;var a=this._getHowMuchOutOfBoundary();if(this._fltEqualZero(a))return!1;this._startAutoScroll(a,1,!0);return!0},_startAutoScrollToDestination:function(a,b,c){this._startAutoScroll(cc.pSub(a,this._innerContainer.getPosition()),b,c)},_calculateAutoScrollTimeByInitialSpeed:function(a){return Math.sqrt(Math.sqrt(a/5))},_startAttenuatingAutoScroll:function(a,
b){var c=this._calculateAutoScrollTimeByInitialSpeed(cc.pLength(b));this._startAutoScroll(a,c,!0)},_startAutoScroll:function(a,b,c){a=this._flattenVectorByDirection(a);this._autoScrolling=!0;this._autoScrollTargetDelta=a;this._autoScrollAttenuate=c;this._autoScrollStartPosition=this._innerContainer.getPosition();this._autoScrollTotalTime=b;this._autoScrollAccumulatedTime=0;this._autoScrollBraking=!1;this._autoScrollBrakingStartPosition=cc.p(0,0);b=this._getHowMuchOutOfBoundary();!this._fltEqualZero(b)&&
(this._autoScrollCurrentlyOutOfBoundary=!0,c=this._getHowMuchOutOfBoundary(a),0<b.x*c.x||0<b.y*c.y)&&(this._autoScrollBraking=!0)},stopAutoScroll:function(){this._autoScrolling=!1;this._autoScrollAttenuate=!0;this._autoScrollAccumulatedTime=this._autoScrollTotalTime=0},_isNecessaryAutoScrollBrake:function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollBraking=this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBrakingStartPosition=
this.getInnerContainerPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},_getAutoScrollStopEpsilon:function(){return 1E-4},_fltEqualZero:function(a){return 1E-4>=Math.abs(a.x)&&1E-4>=Math.abs(a.y)},_processAutoScrolling:function(a){var b=this._isNecessaryAutoScrollBrake()?0.05:1;this._autoScrollAccumulatedTime+=1/b*a;var c=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(c-=1,c=c*c*c*c*c+1);a=cc.pAdd(this._autoScrollStartPosition,
cc.pMult(this._autoScrollTargetDelta,c));c=Math.abs(c-1)<=this._getAutoScrollStopEpsilon();this.bounceEnabled?a=cc.pAdd(this._autoScrollBrakingStartPosition,cc.pMult(cc.pSub(a,this._autoScrollBrakingStartPosition),b)):(b=cc.pSub(a,this.getInnerContainerPosition()),b=this._getHowMuchOutOfBoundary(b),this._fltEqualZero(b)||(a.x+=b.x,a.y+=b.y,c=!0));c&&(this._autoScrolling=!1,this._dispatchEvent(ccui.ScrollView.EVENT_AUTOSCROLL_ENDED));this._moveInnerContainer(cc.pSub(a,this.getInnerContainerPosition()),
c)},_jumpToDestination:function(a,b){void 0===a.x&&(a=cc.p(a,b));this._autoScrolling=!1;this._moveInnerContainer(cc.pSub(a,this.getInnerContainerPosition()),!0)},_scrollChildren:function(a){if(this.bounceEnabled){var b=this._getHowMuchOutOfBoundary();a.x*=0==b.x?1:0.5;a.y*=0==b.y?1:0.5}this.bounceEnabled||(b=this._getHowMuchOutOfBoundary(a),a.x+=b.x,a.y+=b.y);var c=b=!1,d=!1,e=!1;0<a.y?this._innerContainer.getBottomBoundary()+a.y>=this._bottomBoundary&&(e=!0):0>a.y&&this._innerContainer.getTopBoundary()+
a.y<=this._topBoundary&&(d=!0);0>a.x?this._innerContainer.getRightBoundary()+a.x<=this._rightBoundary&&(c=!0):0<a.x&&this._innerContainer.getLeftBoundary()+a.x>=this._leftBoundary&&(b=!0);this._moveInnerContainer(a,!1);0==a.x&&0==a.y||this._processScrollingEvent();e&&this._processScrollEvent(ccui.ScrollView.MOVEDIR_BOTTOM,!1);d&&this._processScrollEvent(ccui.ScrollView.MOVEDIR_TOP,!1);b&&this._processScrollEvent(ccui.ScrollView.MOVEDIR_LEFT,!1);c&&this._processScrollEvent(ccui.ScrollView.MOVEDIR_RIGHT,
!1)},scrollToBottom:function(a,b){this._startAutoScrollToDestination(cc.p(this._innerContainer.getPositionX(),0),a,b)},scrollToTop:function(a,b){this._startAutoScrollToDestination(cc.p(this._innerContainer.getPositionX(),this._contentSize.height-this._innerContainer.getContentSize().height),a,b)},scrollToLeft:function(a,b){this._startAutoScrollToDestination(cc.p(0,this._innerContainer.getPositionY()),a,b)},scrollToRight:function(a,b){this._startAutoScrollToDestination(cc.p(this._contentSize.width-
this._innerContainer.getContentSize().width,this._innerContainer.getPositionY()),a,b)},scrollToTopLeft:function(a,b){this._direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll direction is not both!"):this._startAutoScrollToDestination(cc.p(0,this._contentSize.height-this._innerContainer.getContentSize().height),a,b)},scrollToTopRight:function(a,b){if(this._direction!==ccui.ScrollView.DIR_BOTH)cc.log("Scroll direction is not both!");else{var c=this._innerContainer.getContentSize();this._startAutoScrollToDestination(cc.p(this._contentSize.width-
c.width,this._contentSize.height-c.height),a,b)}},scrollToBottomLeft:function(a,b){this._direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll direction is not both!"):this._startAutoScrollToDestination(cc.p(0,0),a,b)},scrollToBottomRight:function(a,b){this._direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll direction is not both!"):this._startAutoScrollToDestination(cc.p(this._contentSize.width-this._innerContainer.getContentSize().width,0),a,b)},scrollToPercentVertical:function(a,b,c){var d=this._contentSize.height-
this._innerContainer.getContentSize().height,e=-d;this._startAutoScrollToDestination(cc.p(this._innerContainer.getPositionX(),d+a*e/100),b,c)},scrollToPercentHorizontal:function(a,b,c){var d=this._innerContainer.getContentSize().width-this._contentSize.width;this._startAutoScrollToDestination(cc.p(-(a*d/100),this._innerContainer.getPositionY()),b,c)},scrollToPercentBothDirection:function(a,b,c){if(this._direction===ccui.ScrollView.DIR_BOTH){var d=this._contentSize.height-this._innerContainer.getContentSize().height,
e=-d,f=this._innerContainer.getContentSize().width-this._contentSize.width;this._startAutoScrollToDestination(cc.p(-(a.x*f/100),d+a.y*e/100),b,c)}},jumpToBottom:function(){this._jumpToDestination(this._innerContainer.getPositionX(),0)},jumpToTop:function(){this._jumpToDestination(this._innerContainer.getPositionX(),this._contentSize.height-this._innerContainer.getContentSize().height)},jumpToLeft:function(){this._jumpToDestination(0,this._innerContainer.getPositionY())},jumpToRight:function(){this._jumpToDestination(this._contentSize.width-
this._innerContainer.getContentSize().width,this._innerContainer.getPositionY())},jumpToTopLeft:function(){this._direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll _direction is not both!"):this._jumpToDestination(0,this._contentSize.height-this._innerContainer.getContentSize().height)},jumpToTopRight:function(){if(this._direction!==ccui.ScrollView.DIR_BOTH)cc.log("Scroll _direction is not both!");else{var a=this._innerContainer.getContentSize();this._jumpToDestination(this._contentSize.width-a.width,
this._contentSize.height-a.height)}},jumpToBottomLeft:function(){this._direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll _direction is not both!"):this._jumpToDestination(0,0)},jumpToBottomRight:function(){this._direction!==ccui.ScrollView.DIR_BOTH?cc.log("Scroll _direction is not both!"):this._jumpToDestination(this._contentSize.width-this._innerContainer.getContentSize().width,0)},jumpToPercentVertical:function(a){var b=this._contentSize.height-this._innerContainer.getContentSize().height,c=-b;
this._jumpToDestination(this._innerContainer.getPositionX(),b+a*c/100)},jumpToPercentHorizontal:function(a){var b=this._innerContainer.getContentSize().width-this._contentSize.width;this._jumpToDestination(-(a*b/100),this._innerContainer.getPositionY())},jumpToPercentBothDirection:function(a){if(this._direction===ccui.ScrollView.DIR_BOTH){var b=this._innerContainer.getContentSize(),c=this._contentSize.height-b.height;this._jumpToDestination(-(a.x*(b.width-this._contentSize.width)/100),c+a.y*-c/100)}},
_gatherTouchMove:function(a){for(;5<=this._touchMoveDisplacements.length;)this._touchMoveDisplacements.splice(0,1),this._touchMoveTimeDeltas.splice(0,1);this._touchMoveDisplacements.push(a);a=(new Date).getTime();this._touchMoveTimeDeltas.push((a-this._touchMovePreviousTimestamp)/1E3);this._touchMovePreviousTimestamp=a},_handlePressLogic:function(a){this._bePressed=!0;this._autoScrolling=!1;this._touchMovePreviousTimestamp=(new Date).getTime();this._touchMoveDisplacements.length=0;this._touchMoveTimeDeltas.length=
0;if(this._verticalScrollBar)this._verticalScrollBar.onTouchBegan();if(this._horizontalScrollBar)this._horizontalScrollBar.onTouchBegan()},_handleMoveLogic:function(a){var b=this.convertToNodeSpace(a.getLocation());a=this.convertToNodeSpace(a.getPreviousLocation());b=cc.pSub(b,a);this._scrollChildren(b);this._gatherTouchMove(b)},_handleReleaseLogic:function(a){var b=this.convertToNodeSpace(a.getLocation());a=this.convertToNodeSpace(a.getPreviousLocation());b=cc.pSub(b,a);this._gatherTouchMove(b);
this._bePressed=!1;!this._startBounceBackIfNeeded()&&this.inertiaScrollEnabled&&(b=this._calculateTouchMoveVelocity(),0===b.x&&0===b.y||this._startInertiaScroll(b));if(this._verticalScrollBar)this._verticalScrollBar.onTouchEnded();if(this._horizontalScrollBar)this._horizontalScrollBar.onTouchEnded()},onTouchBegan:function(a,b){var c=ccui.Layout.prototype.onTouchBegan.call(this,a,b);this._isInterceptTouch||this._hit&&this._handlePressLogic(a);return c},onTouchMoved:function(a,b){ccui.Layout.prototype.onTouchMoved.call(this,
a,b);this._isInterceptTouch||this._handleMoveLogic(a)},onTouchEnded:function(a,b){ccui.Layout.prototype.onTouchEnded.call(this,a,b);this._isInterceptTouch||this._handleReleaseLogic(a);this._isInterceptTouch=!1},onTouchCancelled:function(a,b){ccui.Layout.prototype.onTouchCancelled.call(this,a,b);this._isInterceptTouch||this._handleReleaseLogic(a);this._isInterceptTouch=!1},update:function(a){this._autoScrolling&&this._processAutoScrolling(a)},interceptTouchEvent:function(a,b,c){if(!this._touchEnabled)ccui.Layout.prototype.interceptTouchEvent.call(this,
a,b,c);else if(this._direction!==ccui.ScrollView.DIR_NONE){var d=c.getLocation();switch(a){case ccui.Widget.TOUCH_BEGAN:this._isInterceptTouch=!0;this._touchBeganPosition.x=d.x;this._touchBeganPosition.y=d.y;this._handlePressLogic(c);break;case ccui.Widget.TOUCH_MOVED:a=cc.pLength(cc.pSub(b.getTouchBeganPosition(),d));this._touchMovePosition.x=d.x;this._touchMovePosition.y=d.y;a>this._childFocusCancelOffset&&(b.setHighlighted(!1),this._handleMoveLogic(c));break;case ccui.Widget.TOUCH_CANCELED:case ccui.Widget.TOUCH_ENDED:this._touchEndPosition.x=
d.x,this._touchEndPosition.y=d.y,this._handleReleaseLogic(c),b.isSwallowTouches()&&(this._isInterceptTouch=!1)}}},_processScrollEvent:function(a,b){var c=0;switch(a){case ccui.ScrollView.MOVEDIR_TOP:c=b?ccui.ScrollView.EVENT_BOUNCE_TOP:ccui.ScrollView.EVENT_SCROLL_TO_TOP;break;case ccui.ScrollView.MOVEDIR_BOTTOM:c=b?ccui.ScrollView.EVENT_BOUNCE_BOTTOM:ccui.ScrollView.EVENT_SCROLL_TO_BOTTOM;break;case ccui.ScrollView.MOVEDIR_LEFT:c=b?ccui.ScrollView.EVENT_BOUNCE_LEFT:ccui.ScrollView.EVENT_SCROLL_TO_LEFT;
break;case ccui.ScrollView.MOVEDIR_RIGHT:c=b?ccui.ScrollView.EVENT_BOUNCE_RIGHT:ccui.ScrollView.EVENT_SCROLL_TO_RIGHT}this._dispatchEvent(c)},_processScrollingEvent:function(){this._dispatchEvent(ccui.ScrollView.EVENT_SCROLLING)},_dispatchEvent:function(a){this._scrollViewEventSelector&&(this._scrollViewEventListener?this._scrollViewEventSelector.call(this._scrollViewEventListener,this,a):this._scrollViewEventSelector(this,a));this._ccEventCallback&&this._ccEventCallback(this,a)},addEventListenerScrollView:function(a,
b){this._scrollViewEventSelector=a;this._scrollViewEventListener=b},addEventListener:function(a){this._ccEventCallback=a},setDirection:function(a){this._direction=a;this._scrollBarEnabled&&(this._removeScrollBar(),this._initScrollBar())},getDirection:function(){return this._direction},setBounceEnabled:function(a){this.bounceEnabled=a},isBounceEnabled:function(){return this.bounceEnabled},setInertiaScrollEnabled:function(a){this.inertiaScrollEnabled=a},isInertiaScrollEnabled:function(){return this.inertiaScrollEnabled},
setScrollBarEnabled:function(a){this._scrollBarEnabled!==a&&(this._scrollBarEnabled&&this._removeScrollBar(),(this._scrollBarEnabled=a)&&this._initScrollBar())},isScrollBarEnabled:function(){return this._scrollBarEnabled},setScrollBarPositionFromCorner:function(a){this._direction!==ccui.ScrollView.DIR_HORIZONTAL&&this.setScrollBarPositionFromCornerForVertical(a);this._direction!==ccui.ScrollView.DIR_VERTICAL&&this.setScrollBarPositionFromCornerForHorizontal(a)},setScrollBarPositionFromCornerForVertical:function(a){cc.assert(this._scrollBarEnabled,
"Scroll bar should be enabled!");cc.assert(this._direction!==ccui.ScrollView.DIR_HORIZONTAL,"Scroll view doesn't have a vertical scroll bar!");this._verticalScrollBar.setPositionFromCorner(a)},getScrollBarPositionFromCornerForVertical:function(){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!");cc.assert(this._direction!==ccui.ScrollView.DIR_HORIZONTAL,"Scroll view doesn't have a vertical scroll bar!");return this._verticalScrollBar.getPositionFromCorner()},setScrollBarPositionFromCornerForHorizontal:function(a){cc.assert(this._scrollBarEnabled,
"Scroll bar should be enabled!");cc.assert(this._direction!==ccui.ScrollView.DIR_VERTICAL,"Scroll view doesn't have a horizontal scroll bar!");this._horizontalScrollBar.setPositionFromCorner(a)},getScrollBarPositionFromCornerForHorizontal:function(){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!");cc.assert(this._direction!==ccui.ScrollView.DIR_VERTICAL,"Scroll view doesn't have a horizontal scroll bar!");return this._horizontalScrollBar.getPositionFromCorner()},setScrollBarWidth:function(a){cc.assert(this._scrollBarEnabled,
"Scroll bar should be enabled!");this._verticalScrollBar&&this._verticalScrollBar.setWidth(a);this._horizontalScrollBar&&this._horizontalScrollBar.setWidth(a)},getScrollBarWidth:function(){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!");return this._verticalScrollBar?this._verticalScrollBar.getWidth():this._horizontalScrollBar?this._horizontalScrollBar.getWidth():0},setScrollBarColor:function(a){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!");this._verticalScrollBar&&
this._verticalScrollBar.setColor(a);this._horizontalScrollBar&&this._horizontalScrollBar.setColor(a)},getScrollBarColor:function(){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!");this._verticalScrollBar&&this._verticalScrollBar.getColor();this._horizontalScrollBar&&this._horizontalScrollBar.getColor();return cc.color.WHITE},setScrollBarOpacity:function(a){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!");this._verticalScrollBar&&(this._verticalScrollBar.opacity=a);
this._horizontalScrollBar&&(this._horizontalScrollBar.opacity=a)},getScrollBarOpacity:function(){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!");return this._verticalScrollBar?this._verticalScrollBar.opacity:this._horizontalScrollBar?this._horizontalScrollBar.opacity:-1},setScrollBarAutoHideEnabled:function(a){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!");this._verticalScrollBar&&(this._verticalScrollBar.autoHideEnabled=a);this._horizontalScrollBar&&(this._horizontalScrollBar.autoHideEnabled=
a)},isScrollBarAutoHideEnabled:function(){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!");return this._verticalScrollBar?this._verticalScrollBar.autoHideEnabled:this._horizontalScrollBar?this._horizontalScrollBar.autoHideEnabled:!1},setScrollBarAutoHideTime:function(a){cc.assert(this._scrollBarEnabled,"Scroll bar should be enabled!");this._verticalScrollBar&&(this._verticalScrollBar.autoHideTime=a);this._horizontalScrollBar&&(this._horizontalScrollBar.autoHideTime=a)},getScrollBarAutoHideTime:function(){cc.assert(this._scrollBarEnabled,
"Scroll bar should be enabled!");return this._verticalScrollBar?this._verticalScrollBar.autoHideTime:this._horizontalScrollBar?this._horizontalScrollBar.autoHideTime:0},getInnerContainer:function(){return this._innerContainer},setLayoutType:function(a){this._innerContainer.setLayoutType(a)},getLayoutType:function(){return this._innerContainer.getLayoutType()},_doLayout:function(){this._doLayoutDirty&&(this._doLayoutDirty=!1)},getDescription:function(){return"ScrollView"},_createCloneInstance:function(){return new ccui.ScrollView},
_copyClonedWidgetChildren:function(a){ccui.Layout.prototype._copyClonedWidgetChildren.call(this,a)},_copySpecialProperties:function(a){a instanceof ccui.ScrollView&&(ccui.Layout.prototype._copySpecialProperties.call(this,a),this.setInnerContainerSize(a.getInnerContainerSize()),this.setInnerContainerPosition(a.getInnerContainerPosition()),this.setDirection(a._direction),this._topBoundary=a._topBoundary,this._bottomBoundary=a._bottomBoundary,this._leftBoundary=a._leftBoundary,this._rightBoundary=a._rightBoundary,
this._bePressed=a._bePressed,this._childFocusCancelOffset=a._childFocusCancelOffset,this._touchMoveDisplacements=a._touchMoveDisplacements,this._touchMoveTimeDeltas=a._touchMoveTimeDeltas,this._touchMovePreviousTimestamp=a._touchMovePreviousTimestamp,this._autoScrolling=a._autoScrolling,this._autoScrollAttenuate=a._autoScrollAttenuate,this._autoScrollStartPosition=a._autoScrollStartPosition,this._autoScrollTargetDelta=a._autoScrollTargetDelta,this._autoScrollTotalTime=a._autoScrollTotalTime,this._autoScrollAccumulatedTime=
a._autoScrollAccumulatedTime,this._autoScrollCurrentlyOutOfBoundary=a._autoScrollCurrentlyOutOfBoundary,this._autoScrollBraking=a._autoScrollBraking,this._autoScrollBrakingStartPosition=a._autoScrollBrakingStartPosition,this.setBounceEnabled(a.bounceEnabled),this.setInertiaScrollEnabled(a.inertiaScrollEnabled),this._scrollViewEventListener=a._scrollViewEventListener,this._scrollViewEventSelector=a._scrollViewEventSelector,this._ccEventCallback=a._ccEventCallback,this.setScrollBarEnabled(a.isScrollBarEnabled()),
this.isScrollBarEnabled()&&(this._direction!==ccui.ScrollView.DIR_HORIZONTAL&&this.setScrollBarPositionFromCornerForVertical(a.getScrollBarPositionFromCornerForVertical()),this._direction!==ccui.ScrollView.DIR_VERTICAL&&this.setScrollBarPositionFromCornerForHorizontal(a.getScrollBarPositionFromCornerForHorizontal()),this.setScrollBarWidth(a.getScrollBarWidth()),this.setScrollBarColor(a.getScrollBarColor()),this.setScrollBarAutoHideEnabled(a.isScrollBarAutoHideEnabled()),this.setScrollBarAutoHideTime(a.getScrollBarAutoHideTime())))},
_initScrollBar:function(){this._direction===ccui.ScrollView.DIR_HORIZONTAL||this._verticalScrollBar||(this._verticalScrollBar=new ccui.ScrollViewBar(this,ccui.ScrollView.DIR_VERTICAL),this.addProtectedChild(this._verticalScrollBar,2));this._direction===ccui.ScrollView.DIR_VERTICAL||this._horizontalScrollBar||(this._horizontalScrollBar=new ccui.ScrollViewBar(this,ccui.ScrollView.DIR_HORIZONTAL),this.addProtectedChild(this._horizontalScrollBar,2))},_removeScrollBar:function(){this._verticalScrollBar&&
(this.removeProtectedChild(this._verticalScrollBar),this._verticalScrollBar=null);this._horizontalScrollBar&&(this.removeProtectedChild(this._horizontalScrollBar),this._horizontalScrollBar=null)},getNodeByTag:function(a){return this._innerContainer.getNodeByTag(a)},getNodes:function(){return this._innerContainer.getNodes()},removeNode:function(a){this._innerContainer.removeNode(a)},removeNodeByTag:function(a){this._innerContainer.removeNodeByTag(a)},removeAllNodes:function(){this._innerContainer.removeAllNodes()},
addNode:function(a,b,c){this._innerContainer.addNode(a,b,c)}});_p=ccui.ScrollView.prototype;cc.defineGetterSetter(_p,"innerWidth",_p._getInnerWidth,_p._setInnerWidth);cc.defineGetterSetter(_p,"innerHeight",_p._getInnerHeight,_p._setInnerHeight);cc.defineGetterSetter(_p,"direction",_p.getDirection,_p.setDirection);cc.defineGetterSetter(_p,"touchTotalTimeThreshold",_p.getTouchTotalTimeThreshold,_p.setTouchTotalTimeThreshold);_p=null;ccui.ScrollView.create=function(){return new ccui.ScrollView};
ccui.ScrollView.DIR_NONE=0;ccui.ScrollView.DIR_VERTICAL=1;ccui.ScrollView.DIR_HORIZONTAL=2;ccui.ScrollView.DIR_BOTH=3;ccui.ScrollView.EVENT_SCROLL_TO_TOP=0;ccui.ScrollView.EVENT_SCROLL_TO_BOTTOM=1;ccui.ScrollView.EVENT_SCROLL_TO_LEFT=2;ccui.ScrollView.EVENT_SCROLL_TO_RIGHT=3;ccui.ScrollView.EVENT_SCROLLING=4;ccui.ScrollView.EVENT_BOUNCE_TOP=5;ccui.ScrollView.EVENT_BOUNCE_BOTTOM=6;ccui.ScrollView.EVENT_BOUNCE_LEFT=7;ccui.ScrollView.EVENT_BOUNCE_RIGHT=8;ccui.ScrollView.EVENT_CONTAINER_MOVED=9;
ccui.ScrollView.EVENT_AUTOSCROLL_ENDED=10;ccui.ScrollView.MOVEDIR_TOP=0;ccui.ScrollView.MOVEDIR_BOTTOM=1;ccui.ScrollView.MOVEDIR_LEFT=2;ccui.ScrollView.MOVEDIR_RIGHT=3;ccui.ListView=ccui.ScrollView.extend({_model:null,_items:null,_gravity:null,_itemsMargin:0,_curSelectedIndex:0,_refreshViewDirty:!0,_listViewEventListener:null,_listViewEventSelector:null,_ccListViewEventCallback:null,_magneticAllowedOutOfBoundary:!0,_magneticType:0,_className:"ListView",ctor:function(){this._items=[];ccui.ScrollView.prototype.ctor.call(this);this._gravity=ccui.ListView.GRAVITY_CENTER_VERTICAL;this.setTouchEnabled(!0);this.setDirection(ccui.ScrollView.DIR_VERTICAL)},setItemModel:function(a){a?
this._model=a:cc.log("Can't set a null to item model!")},_handleReleaseLogic:function(a){ccui.ScrollView.prototype._handleReleaseLogic.call(this,a);this._autoScrolling||this._startMagneticScroll()},_onItemListChanged:function(){this._outOfBoundaryAmountDirty=!0},_updateInnerContainerSize:function(){var a,b=this._items,c;switch(this.direction){case ccui.ScrollView.DIR_VERTICAL:c=b.length;var d=(c-1)*this._itemsMargin;for(a=0;a<c;a++)d+=b[a].getContentSize().height;this.setInnerContainerSize(cc.size(this._contentSize.width,
d));break;case ccui.ScrollView.DIR_HORIZONTAL:c=b.length;d=(c-1)*this._itemsMargin;for(a=0;a<c;a++)d+=b[a].getContentSize().width;this.setInnerContainerSize(cc.size(d,this._contentSize.height))}},_remedyLayoutParameter:function(a){cc.assert(null!=a,"ListView Item can't be nil!");var b=a.getLayoutParameter(ccui.LayoutParameter.LINEAR),c=!0;b||(b=new ccui.LinearLayoutParameter,c=!1);var d=this.getIndex(a);switch(this.direction){case ccui.ScrollView.DIR_VERTICAL:this._remedyVerticalLayoutParameter(b,
d);break;case ccui.ScrollView.DIR_HORIZONTAL:this._remedyHorizontalLayoutParameter(b,d)}c||a.setLayoutParameter(b)},_remedyVerticalLayoutParameter:function(a,b){cc.assert(null!=a,"Layout parameter can't be nil!");switch(this._gravity){case ccui.ListView.GRAVITY_LEFT:a.setGravity(ccui.LinearLayoutParameter.LEFT);break;case ccui.ListView.GRAVITY_RIGHT:a.setGravity(ccui.LinearLayoutParameter.RIGHT);break;case ccui.ListView.GRAVITY_CENTER_HORIZONTAL:a.setGravity(ccui.LinearLayoutParameter.CENTER_HORIZONTAL)}0===
b?a.setMargin(ccui.MarginZero()):a.setMargin(new ccui.Margin(0,this._itemsMargin,0,0))},_remedyHorizontalLayoutParameter:function(a,b){cc.assert(null!=a,"Layout parameter can't be nil!");switch(this._gravity){case ccui.ListView.GRAVITY_TOP:a.setGravity(ccui.LinearLayoutParameter.TOP);break;case ccui.ListView.GRAVITY_BOTTOM:a.setGravity(ccui.LinearLayoutParameter.BOTTOM);break;case ccui.ListView.GRAVITY_CENTER_VERTICAL:a.setGravity(ccui.LinearLayoutParameter.CENTER_VERTICAL)}0===b?a.setMargin(ccui.MarginZero()):
a.setMargin(new ccui.Margin(this._itemsMargin,0,0,0))},pushBackDefaultItem:function(){if(null!=this._model){var a=this._model.clone();this._remedyLayoutParameter(a);this.addChild(a);this._refreshViewDirty=!0}},insertDefaultItem:function(a){if(null!=this._model){var b=this._model.clone();this._items.splice(a,0,b);ccui.ScrollView.prototype.addChild.call(this,b);this._remedyLayoutParameter(b);this._refreshViewDirty=!0}},pushBackCustomItem:function(a){this._remedyLayoutParameter(a);this.addChild(a);this._refreshViewDirty=
!0},addChild:function(a,b,c){a&&(b=b||a.getLocalZOrder(),c=c||a.getName(),ccui.ScrollView.prototype.addChild.call(this,a,b,c),a instanceof ccui.Widget&&(this._items.push(a),this._onItemListChanged()))},removeChild:function(a,b){if(a){var c=this._items.indexOf(a);-1<c&&this._items.splice(c,1);this._onItemListChanged();ccui.ScrollView.prototype.removeChild.call(this,a,b)}},removeAllChildren:function(){this.removeAllChildrenWithCleanup(!0)},removeAllChildrenWithCleanup:function(a){ccui.ScrollView.prototype.removeAllChildrenWithCleanup.call(this,
a);this._items=[];this._onItemListChanged()},insertCustomItem:function(a,b){this._items.splice(b,0,a);this._onItemListChanged();ccui.ScrollView.prototype.addChild.call(this,a);this._remedyLayoutParameter(a);this._refreshViewDirty=!0},removeItem:function(a){a=this.getItem(a);null!=a&&(this.removeChild(a,!0),this._refreshViewDirty=!0)},removeLastItem:function(){this.removeItem(this._items.length-1)},removeAllItems:function(){this.removeAllChildren()},getItem:function(a){return 0>a||a>=this._items.length?
null:this._items[a]},getItems:function(){return this._items},getIndex:function(a){return null==a?-1:this._items.indexOf(a)},setGravity:function(a){this._gravity!==a&&(this._gravity=a,this._refreshViewDirty=!0)},setMagneticType:function(a){this._magneticType=a;this._onItemListChanged();this._startMagneticScroll()},getMagneticType:function(){return this._magneticType},setMagneticAllowedOutOfBoundary:function(a){this._magneticAllowedOutOfBoundary=a},getMagneticAllowedOutOfBoundary:function(){return this._magneticAllowedOutOfBoundary},
setItemsMargin:function(a){this._itemsMargin!==a&&(this._itemsMargin=a,this._refreshViewDirty=!0)},getItemsMargin:function(){return this._itemsMargin},setDirection:function(a){switch(a){case ccui.ScrollView.DIR_VERTICAL:this.setLayoutType(ccui.Layout.LINEAR_VERTICAL);break;case ccui.ScrollView.DIR_HORIZONTAL:this.setLayoutType(ccui.Layout.LINEAR_HORIZONTAL);break;case ccui.ScrollView.DIR_BOTH:return;default:return}ccui.ScrollView.prototype.setDirection.call(this,a)},_getHowMuchOutOfBoundary:function(a){void 0===
a&&(a=cc.p(0,0));if(this._magneticAllowedOutOfBoundary&&0!==this._items.length){if(this._magneticType===ccui.ListView.MAGNETIC_NONE||this._magneticType===ccui.ListView.MAGNETIC_BOTH_END)return ccui.ScrollView.prototype._getHowMuchOutOfBoundary.call(this,a);if(0===a.x&&0===a.y&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount}else return ccui.ScrollView.prototype._getHowMuchOutOfBoundary.call(this,a);var b=this._leftBoundary,c=this._rightBoundary,d=this._topBoundary,e=this._bottomBoundary,
f=this._items.length-1,g=this.getContentSize(),h=cc.p(0,0),k=cc.p(0,0);switch(this._magneticType){case ccui.ListView.MAGNETIC_CENTER:h.x=(g.width-this._items[0].width)/2;h.y=(g.height-this._items[0].height)/2;k.x=(g.width-this._items[f].width)/2;k.y=(g.height-this._items[f].height)/2;break;case ccui.ListView.MAGNETIC_LEFT:case ccui.ListView.MAGNETIC_TOP:k.x=g.width-this._items[f].width;k.y=g.height-this._items[f].height;break;case ccui.ListView.MAGNETIC_RIGHT:case ccui.ListView.MAGNETIC_BOTTOM:h.x=
g.width-this._items[0].width,h.y=g.height-this._items[0].height}b+=h.x;c-=k.x;d-=h.y;e+=k.y;f=cc.p(0,0);this._innerContainer.getLeftBoundary()+a.x>b?f.x=b-(this._innerContainer.getLeftBoundary()+a.x):this._innerContainer.getRightBoundary()+a.x<c&&(f.x=c-(this._innerContainer.getRightBoundary()+a.x));this._innerContainer.getTopBoundary()+a.y<d?f.y=d-(this._innerContainer.getTopBoundary()+a.y):this._innerContainer.getBottomBoundary()+a.y>e&&(f.y=e-(this._innerContainer.getBottomBoundary()+a.y));0===
a.x&&0===a.y&&(this._outOfBoundaryAmount=f,this._outOfBoundaryAmountDirty=!1);return f},_calculateItemPositionWithAnchor:function(a,b){var c=cc.p(a.getLeftBoundary(),a.getBottomBoundary()),d=a.getContentSize();return cc.p(c.x+d.width*b.x,c.y+d.height*b.y)},_findClosestItem:function(a,b,c,d,e,f,g){cc.assert(0<=d&&f<b.length&&d<=f,"");if(d===f)return b[d];if(1===f-d)return e<=g?b[d]:b[f];var h=Math.floor((d+f)/2),k=this._calculateItemPositionWithAnchor(b[h],c),k=cc.pLength(cc.pSub(a,k));return e<=g?
this._findClosestItem(a,b,c,d,e,h,k):this._findClosestItem(a,b,c,h,k,f,g)},getClosestItemToPosition:function(a,b){if(0===this._items.length)return null;var c=this._calculateItemPositionWithAnchor(this._items[0],b),c=cc.pLength(cc.pSub(a,c)),d=this._items.length-1,e=this._calculateItemPositionWithAnchor(this._items[d],b),e=cc.pLength(cc.pSub(a,e));return this._findClosestItem(a,this._items,b,0,c,d,e)},getClosestItemToPositionInCurrentView:function(a,b){var c=this.getContentSize(),d=cc.pMult(this._innerContainer.getPosition(),
-1);d.x+=c.width*a.x;d.y+=c.height*a.y;return this.getClosestItemToPosition(d,b)},getCenterItemInCurrentView:function(){return this.getClosestItemToPositionInCurrentView(cc.p(0.5,0.5),cc.p(0.5,0.5))},getLeftmostItemInCurrentView:function(){return this._direction===ccui.ScrollView.DIR_HORIZONTAL?this.getClosestItemToPositionInCurrentView(cc.p(0,0.5),cc.p(0.5,0.5)):null},getRightmostItemInCurrentView:function(){return this._direction===ccui.ScrollView.DIR_HORIZONTAL?this.getClosestItemToPositionInCurrentView(cc.p(1,
0.5),cc.p(0.5,0.5)):null},getTopmostItemInCurrentView:function(){return this._direction===ccui.ScrollView.DIR_VERTICAL?this.getClosestItemToPositionInCurrentView(cc.p(0.5,1),cc.p(0.5,0.5)):null},getBottommostItemInCurrentView:function(){return this._direction===ccui.ScrollView.DIR_VERTICAL?this.getClosestItemToPositionInCurrentView(cc.p(0.5,0),cc.p(0.5,0.5)):null},_calculateItemDestination:function(a,b,c){var d=this.getContentSize(),e=cc.p(0,0);e.x+=d.width*a.x;e.y+=d.height*a.y;a=this._calculateItemPositionWithAnchor(b,
c);return cc.pMult(cc.pSub(a,e),-1)},jumpToBottom:function(){this.doLayout();ccui.ScrollView.prototype.jumpToBottom.call(this)},jumpToTop:function(){this.doLayout();ccui.ScrollView.prototype.jumpToTop.call(this)},jumpToLeft:function(){this.doLayout();ccui.ScrollView.prototype.jumpToLeft.call(this)},jumpToRight:function(){this.doLayout();ccui.ScrollView.prototype.jumpToRight.call(this)},jumpToTopLeft:function(){this.doLayout();ccui.ScrollView.prototype.jumpToTopLeft.call(this)},jumpToTopRight:function(){this.doLayout();
ccui.ScrollView.prototype.jumpToTopRight.call(this)},jumpToBottomLeft:function(){this.doLayout();ccui.ScrollView.prototype.jumpToBottomLeft.call(this)},jumpToBottomRight:function(){this.doLayout();ccui.ScrollView.prototype.jumpToBottomRight.call(this)},jumpToPercentVertical:function(a){this.doLayout();ccui.ScrollView.prototype.jumpToPercentVertical.call(this,a)},jumpToPercentHorizontal:function(a){this.doLayout();ccui.ScrollView.prototype.jumpToPercentHorizontal.call(this,a)},jumpToPercentBothDirection:function(a){this.doLayout();
ccui.ScrollView.prototype.jumpToPercentBothDirection.call(this,a)},jumpToItem:function(a,b,c){if(a=this.getItem(a))this.doLayout(),b=this._calculateItemDestination(b,a,c),this.bounceEnabled||(c=cc.pSub(b,this._innerContainer.getPosition()),c=this._getHowMuchOutOfBoundary(c),b.x+=c.x,b.y+=c.y),this._jumpToDestination(b)},scrollToItem:function(a,b,c,d){void 0===d&&(d=1);if(a=this.getItem(a))b=this._calculateItemDestination(b,a,c),this._startAutoScrollToDestination(b,d,!0)},requestRefreshView:function(){this._refreshViewDirty=
!0},refreshView:function(){this.forceDoLayout()},doLayout:function(){this._doLayout()},requestDoLayout:function(){this._refreshViewDirty=!0},_doLayout:function(){if(this._refreshViewDirty){for(var a=this._items,b=0;b<a.length;b++){var c=a[b];c.setLocalZOrder(b);this._remedyLayoutParameter(c)}this._updateInnerContainerSize();this._innerContainer.forceDoLayout();this._refreshViewDirty=!1}},addEventListenerListView:function(a,b){this._listViewEventListener=b;this._listViewEventSelector=a},addEventListener:function(a){this._ccListViewEventCallback=
a},_selectedItemEvent:function(a){a=a===ccui.Widget.TOUCH_BEGAN?ccui.ListView.ON_SELECTED_ITEM_START:ccui.ListView.ON_SELECTED_ITEM_END;this._listViewEventSelector&&(this._listViewEventListener?this._listViewEventSelector.call(this._listViewEventListener,this,a):this._listViewEventSelector(this,a));this._ccListViewEventCallback&&this._ccListViewEventCallback(this,a)},interceptTouchEvent:function(a,b,c){ccui.ScrollView.prototype.interceptTouchEvent.call(this,a,b,c);if(this._touchEnabled&&a!==ccui.Widget.TOUCH_MOVED){for(c=
b;c;){if(c&&c.getParent()===this._innerContainer){this._curSelectedIndex=this.getIndex(c);break}c=c.getParent()}b.isHighlighted()&&this._selectedItemEvent(a)}},getCurSelectedIndex:function(){return this._curSelectedIndex},_onSizeChanged:function(){ccui.ScrollView.prototype._onSizeChanged.call(this);this._refreshViewDirty=!0},getDescription:function(){return"ListView"},_createCloneInstance:function(){return new ccui.ListView},_copyClonedWidgetChildren:function(a){a=a.getItems();for(var b=0;b<a.length;b++)this.pushBackCustomItem(a[b].clone())},
_copySpecialProperties:function(a){a instanceof ccui.ListView&&(ccui.ScrollView.prototype._copySpecialProperties.call(this,a),this.setItemModel(a._model),this.setItemsMargin(a._itemsMargin),this.setGravity(a._gravity),this._listViewEventListener=a._listViewEventListener,this._listViewEventSelector=a._listViewEventSelector)},_startAttenuatingAutoScroll:function(a,b){var c=a;if(0!==this._items.length&&this._magneticType!==ccui.ListView.MAGNETIC_NONE){var c=this._flattenVectorByDirection(c),d=this._getHowMuchOutOfBoundary(c);
if(0===d.x&&0===d.y){d=this._magneticType;d===ccui.ListView.MAGNETIC_BOTH_END&&(this._direction===ccui.ScrollView.DIR_HORIZONTAL?d=0<c.x?ccui.ListView.MAGNETIC_LEFT:ccui.ListView.MAGNETIC_RIGHT:this._direction===ccui.ScrollView.DIR_VERTICAL&&(d=0<c.y?ccui.ListView.MAGNETIC_BOTTOM:ccui.ListView.MAGNETIC_TOP));var e=this._getAnchorPointByMagneticType(d),d=cc.pMult(this._innerContainer.getPosition(),-1);d.x+=this.width*e.x;d.y+=this.height*e.y;c=this.getClosestItemToPosition(cc.pSub(d,c),e);c=this._calculateItemPositionWithAnchor(c,
e);c=cc.pSub(d,c)}}ccui.ScrollView.prototype._startAttenuatingAutoScroll.call(this,c,b)},_getAnchorPointByMagneticType:function(a){switch(a){case ccui.ListView.MAGNETIC_BOTH_END:return cc.p(0,1);case ccui.ListView.MAGNETIC_CENTER:return cc.p(0.5,0.5);case ccui.ListView.MAGNETIC_LEFT:return cc.p(0,0.5);case ccui.ListView.MAGNETIC_RIGHT:return cc.p(1,0.5);case ccui.ListView.MAGNETIC_TOP:return cc.p(0.5,1);case ccui.ListView.MAGNETIC_BOTTOM:return cc.p(0.5,0)}return cc.p(0,0)},_startMagneticScroll:function(){if(0!==
this._items.length&&this._magneticType!==ccui.ListView.MAGNETIC_NONE){var a=this._getAnchorPointByMagneticType(this._magneticType),b=cc.pMult(this._innerContainer.getPosition(),-1);b.x+=this.width*a.x;b.y+=this.height*a.y;b=this.getClosestItemToPosition(b,a);this.scrollToItem(this.getIndex(b),a,a)}}});ccui.ListView.create=function(){return new ccui.ListView};ccui.ListView.EVENT_SELECTED_ITEM=0;ccui.ListView.ON_SELECTED_ITEM_START=0;ccui.ListView.ON_SELECTED_ITEM_END=1;ccui.ListView.GRAVITY_LEFT=0;
ccui.ListView.GRAVITY_RIGHT=1;ccui.ListView.GRAVITY_CENTER_HORIZONTAL=2;ccui.ListView.GRAVITY_TOP=3;ccui.ListView.GRAVITY_BOTTOM=4;ccui.ListView.GRAVITY_CENTER_VERTICAL=5;ccui.ListView.MAGNETIC_NONE=0;ccui.ListView.MAGNETIC_CENTER=1;ccui.ListView.MAGNETIC_BOTH_END=2;ccui.ListView.MAGNETIC_LEFT=3;ccui.ListView.MAGNETIC_RIGHT=4;ccui.ListView.MAGNETIC_TOP=5;ccui.ListView.MAGNETIC_BOTTOM=6;ccui.PageView=ccui.ListView.extend({_curPageIdx:0,_childFocusCancelOffset:0,_pageViewEventListener:null,_pageViewEventSelector:null,_className:"PageView",_indicator:null,_indicatorPositionAsAnchorPoint:null,ctor:function(){ccui.ListView.prototype.ctor.call(this);this._childFocusCancelOffset=5;this._indicatorPositionAsAnchorPoint=cc.p(0.5,0.1);this._pageViewEventSelector=this._pageViewEventListener=null;this.setDirection(ccui.ScrollView.DIR_HORIZONTAL);this.setMagneticType(ccui.ListView.MAGNETIC_CENTER);
this.setScrollBarEnabled(!1)},addWidgetToPage:function(a,b,c){this.insertCustomItem(a,b)},addPage:function(a){this.pushBackCustomItem(a)},insertPage:function(a,b){this.insertCustomItem(a,b)},removePage:function(a){this.removeItem(this.getIndex(a))},removePageAtIndex:function(a){this.removeItem(a)},removeAllPages:function(){this.removeAllItems()},scrollToItem:function(a){ccui.ListView.prototype.scrollToItem.call(this,a,cc.p(0.5,0.5),cc.p(0.5,0.5))},scrollToPage:function(a){this.scrollToItem(a)},_doLayout:function(){if(this._refreshViewDirty){ccui.ListView.prototype._doLayout.call(this);
if(this._indicator){var a=this.getIndex(this.getCenterItemInCurrentView());this._indicator.indicate(a)}this._refreshViewDirty=!1}},setDirection:function(a){ccui.ListView.prototype.setDirection.call(this,a);a===ccui.ScrollView.DIR_HORIZONTAL?this._indicatorPositionAsAnchorPoint=cc.p(0.5,0.1):a===ccui.ScrollView.DIR_VERTICAL&&(this._indicatorPositionAsAnchorPoint=cc.p(0.1,0.5));this._indicator&&(this._indicator.setDirection(a),this._refreshIndicatorPosition())},setCustomScrollThreshold:function(a){},
getCustomScrollThreshold:function(){return 0},setUsingCustomScrollThreshold:function(a){},isUsingCustomScrollThreshold:function(){return!1},_moveInnerContainer:function(a,b){ccui.ListView.prototype._moveInnerContainer.call(this,a,b);this._curPageIdx=this.getIndex(this.getCenterItemInCurrentView());this._indicator&&this._indicator.indicate(this._curPageIdx)},_onItemListChanged:function(){ccui.ListView.prototype._onItemListChanged.call(this);this._indicator&&this._indicator.reset(this._items.length)},
_onSizeChanged:function(){ccui.ListView.prototype._onSizeChanged.call(this);this._refreshIndicatorPosition()},_remedyLayoutParameter:function(a){a.setContentSize(this.getContentSize());ccui.ListView.prototype._remedyLayoutParameter.call(this,a)},_refreshIndicatorPosition:function(){if(this._indicator){var a=this.getContentSize();this._indicator.setPosition(cc.p(a.width*this._indicatorPositionAsAnchorPoint.x,a.height*this._indicatorPositionAsAnchorPoint.y))}},_handleReleaseLogic:function(a){ccui.ScrollView.prototype._handleReleaseLogic.call(this,
a);if(!(0>=this._items.length))if(a=this._flattenVectorByDirection(this._calculateTouchMoveVelocity()),500>cc.pLength(a))this._startMagneticScroll();else{var b=this.getItem(this._curPageIdx),b=this._calculateItemDestination(cc.p(0.5,0.5),b,cc.p(0.5,0.5)),b=cc.pSub(b,this.getInnerContainerPosition()),b=this._flattenVectorByDirection(b);0<a.x*b.x||0<a.y*b.y?this._startMagneticScroll():(0>a.x||0<a.y?++this._curPageIdx:--this._curPageIdx,this._curPageIdx=Math.min(this._curPageIdx,this._items.length),
this._curPageIdx=Math.max(this._curPageIdx,0),this.scrollToItem(this._curPageIdx))}},_getAutoScrollStopEpsilon:function(){return 0.001},_pageTurningEvent:function(){this._pageViewEventSelector&&(this._pageViewEventListener?this._pageViewEventSelector.call(this._pageViewEventListener,this,ccui.PageView.EVENT_TURNING):this._pageViewEventSelector(this,ccui.PageView.EVENT_TURNING));this._ccEventCallback&&this._ccEventCallback(this,ccui.PageView.EVENT_TURNING)},addEventListenerPageView:function(a,b){this._pageViewEventSelector=
a;this._pageViewEventListener=b},addEventListener:function(a){this._ccEventCallback=function(b,c){c==ccui.ScrollView.EVENT_AUTOSCROLL_ENDED&&a(this,c)}},setCurrentPageIndex:function(a){this.jumpToItem(a,cc.p(0.5,0.5),cc.p(0.5,0.5))},setCurPageIndex:function(a){this.setCurrentPageIndex(a)},getCurrentPageIndex:function(){return this._curPageIdx},getCurPageIndex:function(){var a=this.getCenterItemInCurrentView();return this.getIndex(a)},getPages:function(){return this.getItems()},getPage:function(a){return this.getItem(a)},
getDescription:function(){return"PageView"},_createCloneInstance:function(){return new ccui.PageView},_copyClonedWidgetChildren:function(a){a=a.getPages();for(var b=0;b<a.length;b++)this.addPage(a[b].clone())},_copySpecialProperties:function(a){ccui.ListView.prototype._copySpecialProperties.call(this,a);this._ccEventCallback=a._ccEventCallback;this._pageViewEventListener=a._pageViewEventListener;this._pageViewEventSelector=a._pageViewEventSelector;this._customScrollThreshold=a._customScrollThreshold},
setIndicatorEnabled:function(a){a!=(null!==this._indicator)&&(a?(this._indicator=new ccui.PageViewIndicator,this._indicator.setDirection(this.getDirection()),this.addProtectedChild(this._indicator,1E4),this.setIndicatorSelectedIndexColor(cc.color(100,100,255)),this._refreshIndicatorPosition()):(this.removeProtectedChild(this._indicator),this._indicator=null))},getIndicatorEnabled:function(){return null!==this._indicator},setIndicatorPositionAsAnchorPoint:function(a){this._indicatorPositionAsAnchorPoint=
a;this._refreshIndicatorPosition()},getIndicatorPositionAsAnchorPoint:function(){return this._indicatorPositionAsAnchorPoint},setIndicatorPosition:function(a){if(this._indicator){var b=this.getContentSize();this._indicatorPositionAsAnchorPoint.x=a.x/b.width;this._indicatorPositionAsAnchorPoint.y=a.y/b.height;this._indicator.setPosition(a)}},getIndicatorPosition:function(){cc.assert(null!==this._indicator,"");return this._indicator.getPosition()},setIndicatorSpaceBetweenIndexNodes:function(a){this._indicator&&
this._indicator.setSpaceBetweenIndexNodes(a)},getIndicatorSpaceBetweenIndexNodes:function(){cc.assert(null!==this._indicator,"");return this._indicator.getSpaceBetweenIndexNodes()},setIndicatorSelectedIndexColor:function(a){this._indicator&&this._indicator.setSelectedIndexColor(a)},getIndicatorSelectedIndexColor:function(){cc.assert(null!==this._indicator,"");return this._indicator.getSelectedIndexColor()},setIndicatorIndexNodesColor:function(a){this._indicator&&this._indicator.setIndexNodesColor(a)},
getIndicatorIndexNodesColor:function(){cc.assert(null!==this._indicator,"");return this._indicator.getIndexNodesColor()},setIndicatorIndexNodesScale:function(a){this._indicator&&(this._indicator.setIndexNodesScale(a),this._indicator.indicate(this._curPageIdx))},getIndicatorIndexNodesScale:function(){cc.assert(null!==this._indicator,"");return this._indicator.getIndexNodesScale()},setIndicatorIndexNodesTexture:function(a,b){this._indicator&&(this._indicator.setIndexNodesTexture(a,b),this._indicator.indicate(this._curPageIdx))}});
ccui.PageView.create=function(){return new ccui.PageView};ccui.PageView.EVENT_TURNING=0;ccui.PageView.TOUCH_DIR_LEFT=0;ccui.PageView.TOUCH_DIR_RIGHT=1;ccui.PageView.DIRECTION_LEFT=0;ccui.PageView.DIRECTION_RIGHT=1;ccui.PageViewIndicator=ccui.ProtectedNode.extend({_direction:null,_indexNodes:null,_currentIndexNode:null,_spaceBetweenIndexNodes:0,_indexNodesScale:1,_indexNodesColor:null,_useDefaultTexture:!0,_indexNodesTextureFile:"",_indexNodesTexType:ccui.Widget.LOCAL_TEXTURE,_className:"PageViewIndicator",ctor:function(){cc.ProtectedNode.prototype.ctor.call(this);this._direction=ccui.ScrollView.DIR_HORIZONTAL;this._indexNodes=[];this._spaceBetweenIndexNodes=ccui.PageViewIndicator.SPACE_BETWEEN_INDEX_NODES_DEFAULT;
this._indexNodesColor=cc.color.WHITE;this._currentIndexNode=ccui.helper._createSpriteFromBase64(ccui.PageViewIndicator.CIRCLE_IMAGE,ccui.PageViewIndicator.CIRCLE_IMAGE_KEY);this._currentIndexNode.setVisible(!1);this.addProtectedChild(this._currentIndexNode,1)},setDirection:function(a){this._direction=a;this._rearrange()},reset:function(a){for(;this._indexNodes.length<a;)this._increaseNumberOfPages();for(;this._indexNodes.length>a;)this._decreaseNumberOfPages();this._rearrange();this._currentIndexNode.setVisible(0<
this._indexNodes.length)},indicate:function(a){0>a||a>=this._indexNodes.length||this._currentIndexNode.setPosition(this._indexNodes[a].getPosition())},_rearrange:function(){if(0!==this._indexNodes.length)for(var a=this._direction===ccui.ScrollView.DIR_HORIZONTAL,b=this._indexNodes[0].getContentSize(),c=a?b.width:b.height,d=this._indexNodes.length,d=-((c*d+this._spaceBetweenIndexNodes*(d-1))/2)+c/2,e=0;e<this._indexNodes.length;++e){var f;f=a?cc.p(d,b.height/2):cc.p(b.width/2,-d);this._indexNodes[e].setPosition(f);
d+=c+this._spaceBetweenIndexNodes}},setSpaceBetweenIndexNodes:function(a){this._spaceBetweenIndexNodes!==a&&(this._spaceBetweenIndexNodes=a,this._rearrange())},getSpaceBetweenIndexNodes:function(){return this._spaceBetweenIndexNodes},setSelectedIndexColor:function(a){this._currentIndexNode.setColor(a)},getSelectedIndexColor:function(){return this._currentIndexNode.getColor()},setIndexNodesColor:function(a){this._indexNodesColor=a;for(var b=0;b<this._indexNodes.length;++b)this._indexNodes[b].setColor(a)},
getIndexNodesColor:function(){var a=this._indexNodesColor;return cc.color(a.r,a.g,a.b,a.a)},setIndexNodesScale:function(a){if(this._indexNodesScale!==a){this._indexNodesScale=a;this._currentIndexNode.setScale(a);for(a=0;a<this._indexNodes.length;++a)this._indexNodes[a].setScale(this,_indexNodesScale);this._rearrange()}},getIndexNodesScale:function(){return this._indexNodesScale},setIndexNodesTexture:function(a,b){void 0===b&&(b=ccui.Widget.LOCAL_TEXTURE);this._useDefaultTexture=!1;this._indexNodesTextureFile=
a;this._indexNodesTexType=b;switch(b){case ccui.Widget.LOCAL_TEXTURE:this._currentIndexNode.setTexture(a);for(var c=0;c<this._indexNodes.length;++c)this._indexNodes[c].setTexture(a);break;case ccui.Widget.PLIST_TEXTURE:for(this._currentIndexNode.setSpriteFrame(a),c=0;c<this._indexNodes.length;++c)this._indexNodes[c].setSpriteFrame(a)}this._rearrange()},_increaseNumberOfPages:function(){var a;if(this._useDefaultTexture)a=ccui.helper._createSpriteFromBase64(ccui.PageViewIndicator.CIRCLE_IMAGE,ccui.PageViewIndicator.CIRCLE_IMAGE_KEY);
else switch(a=new cc.Sprite,this._indexNodesTexType){case ccui.Widget.LOCAL_TEXTURE:a.initWithFile(this._indexNodesTextureFile);break;case ccui.Widget.PLIST_TEXTURE:a.initWithSpriteFrameName(this._indexNodesTextureFile)}a.setColor(this._indexNodesColor);a.setScale(this._indexNodesScale);this.addProtectedChild(a);this._indexNodes.push(a)},_decreaseNumberOfPages:function(){0!==this._indexNodes.length&&(this.removeProtectedChild(this._indexNodes[0]),this._indexNodes.splice(0,1))},clear:function(){for(var a=
0;a<this._indexNodes.length;++a)this.removeProtectedChild(this._indexNodes[a]);this._indexNodes.length=0;this._currentIndexNode.setVisible(!1)}});_p=ccui.PageViewIndicator.prototype;cc.defineGetterSetter(_p,"spaceBetweenIndexNodes",_p.getSpaceBetweenIndexNodes,_p.setSpaceBetweenIndexNodes);ccui.PageViewIndicator.SPACE_BETWEEN_INDEX_NODES_DEFAULT=23;ccui.PageViewIndicator.CIRCLE_IMAGE_KEY="/__circle_image";ccui.PageViewIndicator.CIRCLE_IMAGE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAQAAADZc7J/AAAA8ElEQVRIx62VyRGCQBBF+6gWRCEmYDIQkhiBCgHhSclC8YqWzOV5oVzKAYZp3r1/9fpbxAIBMTsKrjx5cqVgR0wgLhCRUWOjJiPqD56xoaGPhpRZV/iSEy6crHmw5oIrF9b/lVeMofrJgjlnxlIy/wik+JB+mme8BExbBhm+5CJC2LE2LtSEQoyGWDioBA5CoRIohJtK4CYDxzNEM4GAugR1E9VjVC+SZpXvhCJCrjomESLvc17pDGX7bWmlh6UtpjPVCWy9zaJ0TD7qfm3pwERMz2trRVZk3K3BD/L34AY+dEDCniMVBkPFkT2J/b2/AIV+dRpFLOYoAAAAAElFTkSuQmCC";(function(){if(ccui.ProtectedNode.CanvasRenderCmd){ccui.ScrollView.CanvasRenderCmd=function(a){this._layoutCmdCtor(a);this._dirty=!1};var a=ccui.ScrollView.CanvasRenderCmd.prototype=Object.create(ccui.Layout.CanvasRenderCmd.prototype);a.constructor=ccui.ScrollView.CanvasRenderCmd;a.rendering=function(a){var c=cc.renderer._cacheToCanvasCmds[this._node.__instanceId],d,e=cc.view.getScaleX(),f=cc.view.getScaleY(),g=a||cc._renderContext;g.computeRealOffsetY();this._node.updateChildren();a=0;for(d=c.length;a<
d;a++){var h=c[a]._node;h instanceof ccui.ScrollView||h&&h._parent&&!1===h._parent._inViewRect||c[a].rendering(g,e,f)}}}})();(function(){if(ccui.ProtectedNode.WebGLRenderCmd){ccui.ScrollView.WebGLRenderCmd=function(a){this._layoutCmdCtor(a);this._needDraw=!0;this._dirty=!1};var a=ccui.ScrollView.WebGLRenderCmd.prototype=Object.create(ccui.Layout.WebGLRenderCmd.prototype);a.constructor=ccui.ScrollView.WebGLRenderCmd;a.rendering=function(a){var c=cc.renderer._cacheToBufferCmds[this._node.__instanceId],d,e,f,g=a||cc._renderContext;if(c)for(this._node.updateChildren(),g.bindBuffer(gl.ARRAY_BUFFER,null),a=0,d=c.length;a<d;a++)f=
c[a],e=f._node,e&&e._parent&&!1===e._parent._inViewRect||(f.uploadData?cc.renderer._uploadBufferData(f):(0<f._batchingSize&&cc.renderer._batchRendering(),f.rendering(g)),cc.renderer._batchRendering())}}})();cc.Component=cc.Class.extend({_owner:null,_name:"",_enabled:!0,ctor:function(){this._owner=null;this._name="";this._enabled=!0},init:function(){return!0},onEnter:function(){},onExit:function(){},update:function(a){},serialize:function(a){},isEnabled:function(){return this._enabled},setEnabled:function(a){this._enabled=a},getName:function(){return this._name},setName:function(a){this._name=a},setOwner:function(a){this._owner=a},getOwner:function(){return this._owner}});cc.Component.create=function(){return new cc.Component};cc.ComponentContainer=cc.Class.extend({_components:null,_owner:null,ctor:function(a){this._components=null;this._owner=a},getComponent:function(a){if(!a)throw Error("cc.ComponentContainer.getComponent(): name should be non-null");a=a.trim();this._components||(this._components={});return this._components[a]},add:function(a){if(!a)throw Error("cc.ComponentContainer.add(): component should be non-null");if(a.getOwner())return cc.log("cc.ComponentContainer.add(): Component already added. It can't be added again"),
!1;null==this._components&&(this._components={},this._owner.scheduleUpdate());if(this._components[a.getName()])return cc.log("cc.ComponentContainer.add(): Component already added. It can't be added again"),!1;a.setOwner(this._owner);this._components[a.getName()]=a;a.onEnter();return!0},remove:function(a){if(!a)throw Error("cc.ComponentContainer.remove(): name should be non-null");if(!this._components)return!1;if(a instanceof cc.Component)return this._removeByComponent(a);a=a.trim();return this._removeByComponent(this._components[a])},
_removeByComponent:function(a){if(!a)return!1;a.onExit();a.setOwner(null);delete this._components[a.getName()];return!0},removeAll:function(){if(this._components){var a=this._components,b;for(b in a){var c=a[b];c.onExit();c.setOwner(null);delete a[b]}this._owner.unscheduleUpdate();this._components=null}},_alloc:function(){this._components={}},visit:function(a){if(this._components){var b=this._components,c;for(c in b)b[c].update(a)}},isEmpty:function(){return this._components?0===this._components.length:
!0}});ccui.LayoutComponent_ReferencePoint={BOTTOM_LEFT:0,TOP_LEFT:1,BOTTOM_RIGHT:2,TOP_RIGHT:3};ccui.LayoutComponent_PositionType={Position:0,RelativePosition:1,PreRelativePosition:2,PreRelativePositionEnable:3};ccui.LayoutComponent_SizeType={Size:0,PreSize:1,PreSizeEnable:2};
ccui.LayoutComponent=cc.Component.extend({_horizontalEdge:0,_verticalEdge:0,_leftMargin:0,_rightMargin:0,_bottomMargin:0,_topMargin:0,_usingPositionPercentX:!1,_positionPercentX:0,_usingPositionPercentY:!1,_positionPercentY:0,_usingStretchWidth:!1,_usingStretchHeight:!1,_percentWidth:0,_usingPercentWidth:!1,_percentHeight:0,_usingPercentHeight:!1,_actived:!0,_isPercentOnly:!1,ctor:function(){this._name=ccui.LayoutComponent.NAME},init:function(){return cc.Component.prototype.init.call(this)?!0:!1},
getPercentContentSize:function(){return cc.p(this._percentWidth,this._percentHeight)},setPercentContentSize:function(a){this.setPercentWidth(a.x);this.setPercentHeight(a.y)},setUsingPercentContentSize:function(a){this._usingPercentWidth=this._usingPercentHeight=a},SetActiveEnable:function(a){this._actived=a},getUsingPercentContentSize:function(){return this._usingPercentWidth&&this._usingPercentHeight},getAnchorPosition:function(){return this._owner.getAnchorPoint()},setAnchorPosition:function(a,
b){var c=this._owner.getBoundingBox();this._owner.setAnchorPoint(a,b);var d=this._owner.getBoundingBox(),e=c.x-d.x,c=c.y-d.y,d=this._owner.getPosition();d.x+=e;d.y+=c;this.setPosition(d)},getPosition:function(){return this._owner.getPosition()},setPosition:function(a,b){var c=this._getOwnerParent(),d;null!=c?(void 0===b?(d=a.x,b=a.y):d=a,c=c.getContentSize(),0!==c.width?this._positionPercentX=d/c.width:(this._positionPercentX=0,this._usingPositionPercentX&&(d=0)),0!==c.height?this._positionPercentY=
b/c.height:(this._positionPercentY=0,this._usingPositionPercentY&&(b=0)),this._owner.setPosition(d,b),this._refreshHorizontalMargin(),this._refreshVerticalMargin()):this._owner.setPosition(a,b)},isPositionPercentXEnabled:function(){return this._usingPositionPercentX},setPositionPercentXEnabled:function(a){if(this._usingPositionPercentX=a)this._horizontalEdge=ccui.LayoutComponent.horizontalEdge.NONE},getPositionPercentX:function(){return this._positionPercentX},setPositionPercentX:function(a){this._positionPercentX=
a;a=this._getOwnerParent();null!==a&&(this._owner.setPositionX(a.width*this._positionPercentX),this._refreshHorizontalMargin())},isPositionPercentYEnabled:function(){return this._usingPositionPercentY},setPositionPercentYEnabled:function(a){if(this._usingPositionPercentY=a)this._verticalEdge=ccui.LayoutComponent.verticalEdge.NONE},getPositionPercentY:function(){return this._positionPercentY},setPositionPercentY:function(a){this._positionPercentY=a;a=this._getOwnerParent();null!==a&&(this._owner.setPositionY(a.height*
this._positionPercentY),this._refreshVerticalMargin())},getHorizontalEdge:function(){return this._horizontalEdge},setHorizontalEdge:function(a){this._horizontalEdge=a;this._horizontalEdge!==ccui.LayoutComponent.horizontalEdge.NONE&&(this._usingPositionPercentX=!1);var b=this._getOwnerParent();null!==b&&(a=this._owner.getPosition(),b=b.getContentSize(),0!==b.width?this._positionPercentX=a.x/b.width:(this._positionPercentX=0,a.x=0,this._usingPositionPercentX&&this._owner.setPosition(a)),this._refreshHorizontalMargin())},
getVerticalEdge:function(){return this._verticalEdge},setVerticalEdge:function(a){this._verticalEdge=a;this._verticalEdge!==ccui.LayoutComponent.verticalEdge.NONE&&(this._usingPositionPercentY=!1);var b=this._getOwnerParent();null!==b&&(a=this._owner.getPosition(),b=b.getContentSize(),0!==b.height?this._positionPercentY=a.y/b.height:(this._positionPercentY=0,a.y=0,this._usingPositionPercentY&&this._owner.setPosition(a)),this._refreshVerticalMargin())},getLeftMargin:function(){return this._leftMargin},
setLeftMargin:function(a){this._leftMargin=a},getRightMargin:function(){return this._rightMargin},setRightMargin:function(a){this._rightMargin=a},getTopMargin:function(){return this._topMargin},setTopMargin:function(a){this._topMargin=a},getBottomMargin:function(){return this._bottomMargin},setBottomMargin:function(a){this._bottomMargin=a},getSize:function(){return this.getOwner().getContentSize()},setSize:function(a){var b=this._getOwnerParent();null!==b?(b=b.getContentSize(),0!==b.width?this._percentWidth=
a.width/b.width:(this._percentWidth=0,this._usingPercentWidth&&(a.width=0)),0!==b.height?this._percentHeight=a.height/b.height:(this._percentHeight=0,this._usingPercentHeight&&(a.height=0)),this._owner.setContentSize(a),this._refreshHorizontalMargin(),this._refreshVerticalMargin()):this._owner.setContentSize(a)},isPercentWidthEnabled:function(){return this._usingPercentWidth},setPercentWidthEnabled:function(a){if(this._usingPercentWidth=a)this._usingStretchWidth=!1},getSizeWidth:function(){return this._owner.width},
setSizeWidth:function(a){var b=this._owner.getContentSize();b.width=a;a=this._getOwnerParent();null!==a?(a=a.getContentSize(),0!==a.width?this._percentWidth=b.width/a.width:(this._percentWidth=0,this._usingPercentWidth&&(b.width=0)),this._owner.setContentSize(b),this._refreshHorizontalMargin()):this._owner.setContentSize(b)},getPercentWidth:function(){return this._percentWidth},setPercentWidth:function(a){this._percentWidth=a;a=this._getOwnerParent();if(null!==a){var b=this._owner.getContentSize();
b.width=a.width*this._percentWidth;this._owner.setContentSize(b);this._refreshHorizontalMargin()}},isPercentHeightEnabled:function(){return this._usingPercentHeight},setPercentHeightEnabled:function(a){if(this._usingPercentHeight=a)this._usingStretchHeight=!1},getSizeHeight:function(){return this._owner.height},setSizeHeight:function(a){var b=this._owner.getContentSize();b.height=a;a=this._getOwnerParent();null!==a?(a=a.getContentSize(),0!==a.height?this._percentHeight=b.height/a.height:(this._percentHeight=
0,this._usingPercentHeight&&(b.height=0)),this._owner.setContentSize(b),this._refreshVerticalMargin()):this._owner.setContentSize(b)},getPercentHeight:function(){return this._percentHeight},setPercentHeight:function(a){this._percentHeight=a;a=this._getOwnerParent();if(null!==a){var b=this._owner.getContentSize();b.height=a.height*this._percentHeight;this._owner.setContentSize(b);this._refreshVerticalMargin()}},isStretchWidthEnabled:function(){return this._usingStretchWidth},setStretchWidthEnabled:function(a){if(this._usingStretchWidth=
a)this._usingPercentWidth=!1},isStretchHeightEnabled:function(){return this._usingStretchHeight},setStretchHeightEnabled:function(a){if(this._usingStretchHeight=a)this._usingPercentHeight=!1},setPercentOnlyEnabled:function(a){this._isPercentOnly=a},setActiveEnabled:function(a){this._actived=a},refreshLayout:function(){if(this._actived){var a=this._getOwnerParent();if(null!==a){var a=a.getContentSize(),b=this._owner,c=b.getAnchorPoint(),d=b.getContentSize(),e=b.getPosition();switch(this._horizontalEdge){case ccui.LayoutComponent.horizontalEdge.NONE:this._usingStretchWidth&&
!this._isPercentOnly?(d.width=a.width*this._percentWidth,e.x=this._leftMargin+c.x*d.width):(this._usingPositionPercentX&&(e.x=a.width*this._positionPercentX),this._usingPercentWidth&&(d.width=a.width*this._percentWidth));break;case ccui.LayoutComponent.horizontalEdge.LEFT:if(this._isPercentOnly)break;if(this._usingPercentWidth||this._usingStretchWidth)d.width=a.width*this._percentWidth;e.x=this._leftMargin+c.x*d.width;break;case ccui.LayoutComponent.horizontalEdge.RIGHT:if(this._isPercentOnly)break;
if(this._usingPercentWidth||this._usingStretchWidth)d.width=a.width*this._percentWidth;e.x=a.width-(this._rightMargin+(1-c.x)*d.width);break;case ccui.LayoutComponent.horizontalEdge.CENTER:if(this._isPercentOnly)break;this._usingStretchWidth?(d.width=a.width-this._leftMargin-this._rightMargin,0>d.width&&(d.width=0),e.x=this._leftMargin+c.x*d.width):(this._usingPercentWidth&&(d.width=a.width*this._percentWidth),e.x=a.width*this._positionPercentX)}switch(this._verticalEdge){case ccui.LayoutComponent.verticalEdge.NONE:this._usingStretchHeight&&
!this._isPercentOnly?(d.height=a.height*this._percentHeight,e.y=this._bottomMargin+c.y*d.height):(this._usingPositionPercentY&&(e.y=a.height*this._positionPercentY),this._usingPercentHeight&&(d.height=a.height*this._percentHeight));break;case ccui.LayoutComponent.verticalEdge.BOTTOM:if(this._isPercentOnly)break;if(this._usingPercentHeight||this._usingStretchHeight)d.height=a.height*this._percentHeight;e.y=this._bottomMargin+c.y*d.height;break;case ccui.LayoutComponent.verticalEdge.TOP:if(this._isPercentOnly)break;
if(this._usingPercentHeight||this._usingStretchHeight)d.height=a.height*this._percentHeight;e.y=a.height-(this._topMargin+(1-c.y)*d.height);break;case ccui.LayoutComponent.verticalEdge.CENTER:if(this._isPercentOnly)break;this._usingStretchHeight?(d.height=a.height-this._topMargin-this._bottomMargin,0>d.height&&(d.height=0),e.y=this._bottomMargin+c.y*d.height):(this._usingPercentHeight&&(d.height=a.height*this._percentHeight),e.y=a.height*this._positionPercentY)}b.setPosition(e);b.setContentSize(d);
if(b instanceof ccui.PageView)for(b.forceDoLayout(),a=b.getPages(),b=0;b<a.length;b++)ccui.helper.doLayout(a[b]);else ccui.helper.doLayout(b)}}},_getOwnerParent:function(){return this._owner?this._owner.getParent():null},_refreshHorizontalMargin:function(){var a=this._getOwnerParent();if(null!==a){var b=this._owner.getPosition(),c=this._owner.getAnchorPoint(),d=this._owner.getContentSize(),a=a.getContentSize();this._leftMargin=b.x-c.x*d.width;this._rightMargin=a.width-(b.x+(1-c.x)*d.width)}},_refreshVerticalMargin:function(){var a=
this._getOwnerParent();if(null!==a){var b=this._owner.getPosition(),c=this._owner.getAnchorPoint(),d=this._owner.getContentSize(),a=a.getContentSize();this._bottomMargin=b.y-c.y*d.height;this._topMargin=a.height-(b.y+(1-c.y)*d.height)}}});ccui.LayoutComponent.horizontalEdge={NONE:0,LEFT:1,RIGHT:2,CENTER:3};ccui.LayoutComponent.verticalEdge={NONE:0,BOTTOM:1,TOP:2,CENTER:3};ccui.LayoutComponent.NAME="__ui_layout";
ccui.LayoutComponent.bindLayoutComponent=function(a){var b=a.getComponent(ccui.LayoutComponent.NAME);if(void 0!==b)return b;b=new ccui.LayoutComponent;b.init();a.addComponent(b);a instanceof ccui.Widget||a.addEventListener&&a.addEventListener("load",function(){b.refreshLayout()},this);return b};var ccs=ccs||{};window.ccs=ccs;ccs.Class=ccs.Class||cc.Class;ccs.Class.extend=ccs.Class.extend||cc.Class.extend;ccs.Node=ccs.Node||cc.Node;ccs.Node.extend=ccs.Node.extend||cc.Node.extend;ccs.Sprite=ccs.Sprite||cc.Sprite;ccs.Sprite.extend=ccs.Sprite.extend||cc.Sprite.extend;ccs.Component=ccs.Component||cc.Component;ccs.Component.extend=ccs.Component.extend||cc.Component.extend;ccs.cocostudioVersion="v1.3.0.0";ccs.VERSION_COMBINED=0.3;ccs.VERSION_CHANGE_ROTATION_RANGE=1;ccs.VERSION_COLOR_READING=1.1;ccs.MAX_VERTEXZ_VALUE=5E6;ccs.ARMATURE_MAX_CHILD=50;ccs.ARMATURE_MAX_ZORDER=100;ccs.ARMATURE_MAX_COUNT=ccs.MAX_VERTEXZ_VALUE/ccs.ARMATURE_MAX_CHILD/ccs.ARMATURE_MAX_ZORDER;ccs.AUTO_ADD_SPRITE_FRAME_NAME_PREFIX=!1;ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT=!1;ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX=!1;ccs.armatureVersion=function(){return"v1.1.0.0"};ccs.CONST_VERSION="version";ccs.CONST_VERSION_2_0=2;ccs.CONST_VERSION_COMBINED=0.3;ccs.CONST_ARMATURES="armatures";ccs.CONST_ARMATURE="armature";ccs.CONST_BONE="b";ccs.CONST_DISPLAY="d";ccs.CONST_ANIMATIONS="animations";ccs.CONST_ANIMATION="animation";ccs.CONST_MOVEMENT="mov";ccs.CONST_FRAME="f";ccs.CONST_TEXTURE_ATLAS="TextureAtlas";ccs.CONST_SUB_TEXTURE="SubTexture";ccs.CONST_SKELETON="skeleton";ccs.CONST_A_NAME="name";ccs.CONST_A_DURATION="dr";ccs.CONST_A_FRAME_INDEX="fi";
ccs.CONST_A_DURATION_TO="to";ccs.CONST_A_DURATION_TWEEN="drTW";ccs.CONST_A_LOOP="lp";ccs.CONST_A_MOVEMENT_SCALE="sc";ccs.CONST_A_MOVEMENT_DELAY="dl";ccs.CONST_A_DISPLAY_INDEX="dI";ccs.CONST_A_PLIST="plist";ccs.CONST_A_PARENT="parent";ccs.CONST_A_SKEW_X="kX";ccs.CONST_A_SKEW_Y="kY";ccs.CONST_A_SCALE_X="cX";ccs.CONST_A_SCALE_Y="cY";ccs.CONST_A_Z="z";ccs.CONST_A_EVENT="evt";ccs.CONST_A_SOUND="sd";ccs.CONST_A_SOUND_EFFECT="sdE";ccs.CONST_A_TWEEN_EASING="twE";ccs.CONST_A_EASING_PARAM="twEP";
ccs.CONST_A_TWEEN_ROTATE="twR";ccs.CONST_A_IS_ARMATURE="isArmature";ccs.CONST_A_DISPLAY_TYPE="displayType";ccs.CONST_A_MOVEMENT="mov";ccs.CONST_A_X="x";ccs.CONST_A_Y="y";ccs.CONST_A_COCOS2DX_X="cocos2d_x";ccs.CONST_A_COCOS2DX_Y="cocos2d_y";ccs.CONST_A_WIDTH="width";ccs.CONST_A_HEIGHT="height";ccs.CONST_A_PIVOT_X="pX";ccs.CONST_A_PIVOT_Y="pY";ccs.CONST_A_COCOS2D_PIVOT_X="cocos2d_pX";ccs.CONST_A_COCOS2D_PIVOT_Y="cocos2d_pY";ccs.CONST_A_BLEND_TYPE="bd";ccs.CONST_A_BLEND_SRC="bd_src";
ccs.CONST_A_BLEND_DST="bd_dst";ccs.CONST_A_ALPHA="a";ccs.CONST_A_RED="r";ccs.CONST_A_GREEN="g";ccs.CONST_A_BLUE="b";ccs.CONST_A_ALPHA_OFFSET="aM";ccs.CONST_A_RED_OFFSET="rM";ccs.CONST_A_GREEN_OFFSET="gM";ccs.CONST_A_BLUE_OFFSET="bM";ccs.CONST_A_COLOR_TRANSFORM="colorTransform";ccs.CONST_A_TWEEN_FRAME="tweenFrame";ccs.CONST_CONTOUR="con";ccs.CONST_CONTOUR_VERTEX="con_vt";ccs.CONST_FL_NAN="NaN";ccs.CONST_FRAME_DATA="frame_data";ccs.CONST_MOVEMENT_BONE_DATA="mov_bone_data";ccs.CONST_MOVEMENT_DATA="mov_data";
ccs.CONST_ANIMATION_DATA="animation_data";ccs.CONST_DISPLAY_DATA="display_data";ccs.CONST_SKIN_DATA="skin_data";ccs.CONST_BONE_DATA="bone_data";ccs.CONST_ARMATURE_DATA="armature_data";ccs.CONST_CONTOUR_DATA="contour_data";ccs.CONST_TEXTURE_DATA="texture_data";ccs.CONST_VERTEX_POINT="vertex";ccs.CONST_COLOR_INFO="color";ccs.CONST_CONFIG_FILE_PATH="config_file_path";ccs.CONST_CONTENT_SCALE="content_scale";
ccs.DataInfo=function(){this.asyncStruct=null;this.configFileQueue=[];this.contentScale=1;this.baseFilePath=this.filename="";this.cocoStudioVersion=this.flashToolVersion=0};
ccs.dataReaderHelper={ConfigType:{DragonBone_XML:0,CocoStudio_JSON:1,CocoStudio_Binary:2},_configFileList:[],_flashToolVersion:ccs.CONST_VERSION_2_0,_positionReadScale:1,_asyncRefCount:0,_asyncRefTotalCount:0,_dataQueue:null,setPositionReadScale:function(a){this._positionReadScale=a},getPositionReadScale:function(){return this._positionReadScale},addDataFromFile:function(a){if(-1===this._configFileList.indexOf(a)){this._configFileList.push(a);var b=this._initBaseFilePath(a),c=cc.path.extname(a).toLowerCase(),
d=new ccs.DataInfo;d.filename=a;d.basefilePath=b;".xml"===c?ccs.dataReaderHelper.addDataFromXML(a,d):".json"===c||".exportjson"===c?ccs.dataReaderHelper.addDataFromJson(a,d):".csb"===c&&ccs.dataReaderHelper.addDataFromBinaryCache(a,d)}},addDataFromFileAsync:function(a,b,c,d,e){if(-1!==this._configFileList.indexOf(c))e&&d&&(0===this._asyncRefTotalCount&&0===this._asyncRefCount?this._asyncCallBack(d,e,1):this._asyncCallBack(d,e,(this._asyncRefTotalCount-this._asyncRefCount)/this._asyncRefTotalCount));
else{this._asyncRefTotalCount++;this._asyncRefCount++;var f=this;cc.director.getScheduler().schedule(function(){f.addDataFromFile(c);f._asyncRefCount--;f._asyncCallBack(d,e,(f._asyncRefTotalCount-f._asyncRefCount)/f._asyncRefTotalCount)},this,0.1,!1,0,!1,"armatrueDataHelper")}},removeConfigFile:function(a){for(var b=this._configFileList,c=b.length,d=b[c],e=0;e<c;e++)b[e]===a&&(d=e);d!==b[c]&&cc.arrayRemoveObject(b,a)},addDataFromCache:function(a,b){if(a){b.flashToolVersion=parseFloat(a.getAttribute(ccs.CONST_VERSION));
var c=a.querySelectorAll(ccs.CONST_SKELETON+" \x3e "+ccs.CONST_ARMATURES+" \x3e  "+ccs.CONST_ARMATURE+""),d=ccs.armatureDataManager,e;for(e=0;e<c.length;e++){var f=this.decodeArmature(c[e],b);d.addArmatureData(f.name,f,b.filename)}c=a.querySelectorAll(ccs.CONST_SKELETON+" \x3e "+ccs.CONST_ANIMATIONS+" \x3e  "+ccs.CONST_ANIMATION+"");for(e=0;e<c.length;e++)f=this.decodeAnimation(c[e],b),d.addAnimationData(f.name,f,b.filename);c=a.querySelectorAll(ccs.CONST_SKELETON+" \x3e "+ccs.CONST_TEXTURE_ATLAS+
" \x3e  "+ccs.CONST_SUB_TEXTURE+"");for(e=0;e<c.length;e++)f=this.decodeTexture(c[e],b),d.addTextureData(f.name,f,b.filename)}else cc.log("XML error  or  XML is empty.")},decodeArmature:function(a,b){var c=new ccs.ArmatureData;c.init();c.name=a.getAttribute(ccs.CONST_A_NAME);for(var d=a.querySelectorAll(ccs.CONST_ARMATURE+" \x3e "+ccs.CONST_BONE),e=0;e<d.length;e++){var f=d[e],g=f.getAttribute(ccs.CONST_A_PARENT),h=null;if(g)for(var k=0;k<d.length&&(h=d[k],g!=d[k].getAttribute(ccs.CONST_A_NAME));k++);
f=this.decodeBone(f,h,b);c.addBoneData(f)}return c},decodeArmatureFromJSON:function(a,b){var c=new ccs.ArmatureData;c.init();var d=a[ccs.CONST_A_NAME];d&&(c.name=d);b.cocoStudioVersion=c.dataVersion=a[ccs.CONST_VERSION]||0.1;for(var d=a[ccs.CONST_BONE_DATA],e=0;e<d.length;e++){var f=this.decodeBoneFromJson(d[e],b);c.addBoneData(f)}return c},decodeBone:function(a,b,c){b=new ccs.BoneData;b.init();b.name=a.getAttribute(ccs.CONST_A_NAME);b.parentName=a.getAttribute(ccs.CONST_A_PARENT)||"";b.zOrder=parseInt(a.getAttribute(ccs.CONST_A_Z))||
0;a=a.querySelectorAll(ccs.CONST_BONE+" \x3e "+ccs.CONST_DISPLAY);for(var d=0;d<a.length;d++){var e=this.decodeBoneDisplay(a[d],c);b.addDisplayData(e)}return b},decodeBoneFromJson:function(a,b){var c=new ccs.BoneData;c.init();this.decodeNodeFromJson(c,a,b);c.name=a[ccs.CONST_A_NAME]||"";c.parentName=a[ccs.CONST_A_PARENT]||"";for(var d=a[ccs.CONST_DISPLAY_DATA]||[],e=0;e<d.length;e++){var f=this.decodeBoneDisplayFromJson(d[e],b);c.addDisplayData(f)}return c},decodeBoneDisplay:function(a,b){var c=null;
1===(parseFloat(a.getAttribute(ccs.CONST_A_IS_ARMATURE))||0)?(c=new ccs.ArmatureDisplayData,c.displayType=ccs.DISPLAY_TYPE_ARMATURE):(c=new ccs.SpriteDisplayData,c.displayType=ccs.DISPLAY_TYPE_SPRITE);var d=a.getAttribute(ccs.CONST_A_NAME)||"";d&&(c.displayName=d);return c},decodeBoneDisplayFromJson:function(a,b){var c=a[ccs.CONST_A_DISPLAY_TYPE]||ccs.DISPLAY_TYPE_SPRITE,d=null;switch(c){case ccs.DISPLAY_TYPE_SPRITE:var d=new ccs.SpriteDisplayData,e=a[ccs.CONST_A_NAME];null!=e&&(d.displayName=e);
if(e=(a[ccs.CONST_SKIN_DATA]||[])[0]){var f=d.skinData;f.x=e[ccs.CONST_A_X]*this._positionReadScale;f.y=e[ccs.CONST_A_Y]*this._positionReadScale;f.scaleX=null==e[ccs.CONST_A_SCALE_X]?1:e[ccs.CONST_A_SCALE_X];f.scaleY=null==e[ccs.CONST_A_SCALE_Y]?1:e[ccs.CONST_A_SCALE_Y];f.skewX=null==e[ccs.CONST_A_SKEW_X]?1:e[ccs.CONST_A_SKEW_X];f.skewY=null==e[ccs.CONST_A_SKEW_Y]?1:e[ccs.CONST_A_SKEW_Y];f.x*=b.contentScale;f.y*=b.contentScale}break;case ccs.DISPLAY_TYPE_ARMATURE:d=new ccs.ArmatureDisplayData;e=a[ccs.CONST_A_NAME];
null!=e&&(d.displayName=a[ccs.CONST_A_NAME]);break;case ccs.DISPLAY_TYPE_PARTICLE:d=new ccs.ParticleDisplayData;e=a[ccs.CONST_A_PLIST];null!=e&&(d.displayName=b.asyncStruct?b.asyncStruct.basefilePath+e:b.basefilePath+e);break;default:d=new ccs.SpriteDisplayData}d.displayType=c;return d},decodeAnimation:function(a,b){var c=new ccs.AnimationData,d=a.getAttribute(ccs.CONST_A_NAME),e=ccs.armatureDataManager.getArmatureData(d);c.name=d;for(var d=a.querySelectorAll(ccs.CONST_ANIMATION+" \x3e "+ccs.CONST_MOVEMENT),
f=null,g=0;g<d.length;g++)f=d[g],f=this.decodeMovement(f,e,b),c.addMovement(f);return c},decodeAnimationFromJson:function(a,b){var c=new ccs.AnimationData;a[ccs.CONST_A_NAME]&&(c.name=a[ccs.CONST_A_NAME]);for(var d=a[ccs.CONST_MOVEMENT_DATA]||[],e=0;e<d.length;e++){var f=this.decodeMovementFromJson(d[e],b);c.addMovement(f)}return c},decodeMovement:function(a,b,c){var d=new ccs.MovementData;d.name=a.getAttribute(ccs.CONST_A_NAME);var e;e=0;e=a.getAttribute(ccs.CONST_A_DURATION);d.duration=null==e?
0:parseFloat(e);e=a.getAttribute(ccs.CONST_A_DURATION_TO);d.durationTo=null==e?0:parseFloat(e);e=a.getAttribute(ccs.CONST_A_DURATION_TWEEN);d.durationTween=null==e?0:parseFloat(e);e=a.getAttribute(ccs.CONST_A_LOOP);d.loop=e?Boolean(parseFloat(e)):!0;if(e=a.getAttribute(ccs.CONST_A_TWEEN_EASING))e!=ccs.CONST_FL_NAN?(e=null==e?0:parseFloat(e),d.tweenEasing=2===e?ccs.TweenType.SINE_EASEINOUT:e):d.tweenEasing=ccs.TweenType.LINEAR;a=a.querySelectorAll(ccs.CONST_MOVEMENT+" \x3e "+ccs.CONST_BONE);var f=
null;for(e=0;e<a.length;e++){var f=a[e],g=f.getAttribute(ccs.CONST_A_NAME);if(!d.getMovementBoneData(g)){var g=b.getBoneData(g),h=g.parentName,k=null;if(""!==h)for(var m=0;m<a.length&&(k=a[m],h!==k.getAttribute(ccs.CONST_A_NAME));m++);f=this.decodeMovementBone(f,k,g,c);d.addMovementBoneData(f)}}return d},decodeMovementFromJson:function(a,b){var c=new ccs.MovementData;c.loop=null==a[ccs.CONST_A_LOOP]?!1:a[ccs.CONST_A_LOOP];c.durationTween=a[ccs.CONST_A_DURATION_TWEEN]||0;c.durationTo=a[ccs.CONST_A_DURATION_TO]||
0;c.duration=a[ccs.CONST_A_DURATION]||0;c.scale=null==a[ccs.CONST_A_DURATION]?1:null==a[ccs.CONST_A_MOVEMENT_SCALE]?1:a[ccs.CONST_A_MOVEMENT_SCALE];c.tweenEasing=null==a[ccs.CONST_A_TWEEN_EASING]?ccs.TweenType.LINEAR:a[ccs.CONST_A_TWEEN_EASING];var d=a[ccs.CONST_A_NAME];d&&(c.name=d);for(var d=a[ccs.CONST_MOVEMENT_BONE_DATA]||[],e=0;e<d.length;e++){var f=this.decodeMovementBoneFromJson(d[e],b);c.addMovementBoneData(f)}return c},decodeMovementBone:function(a,b,c,d){var e=new ccs.MovementBoneData;e.init();
var f;a&&(f=parseFloat(a.getAttribute(ccs.CONST_A_MOVEMENT_SCALE))||0,e.scale=f,f=parseFloat(a.getAttribute(ccs.CONST_A_MOVEMENT_DELAY))||0,0<f&&(f-=1),e.delay=f);var g=0,h=f=0,k=null,m=[];if(null!=b){for(var n=b.querySelectorAll(ccs.CONST_BONE+" \x3e "+ccs.CONST_FRAME),g=0;g<n.length;g++)m.push(n[g]);g=m.length}e.name=a.getAttribute(ccs.CONST_A_NAME);a=a.querySelectorAll(ccs.CONST_BONE+" \x3e "+ccs.CONST_FRAME);for(var p=n=0,r=0;r<a.length;r++){var s=a[r];if(b)for(;n<g&&(k?p<f||p>=f+h:1);)k=m[n],
f+=h,h=parseFloat(k.getAttribute(ccs.CONST_A_DURATION)),n++;s=this.decodeFrame(s,k,c,d);e.addFrameData(s);s.frameID=p;p+=s.duration;e.duration=p}b=e.frameList;c=Math.PI;for(g=b.length-1;0<=g;g--)if(0<g){d=b[g].skewX-b[g-1].skewX;f=b[g].skewY-b[g-1].skewY;if(d<-c||d>c)b[g-1].skewX=0>d?b[g-1].skewX-2*c:b[g-1].skewX+2*c;if(f<-c||f>c)b[g-1].skewY=0>f?b[g-1].skewY-2*c:b[g-1].skewY+2*c}b=new ccs.FrameData;b.copy(e.frameList[e.frameList.length-1]);b.frameID=e.duration;e.addFrameData(b);return e},decodeMovementBoneFromJson:function(a,
b){var c=new ccs.MovementBoneData;c.init();c.delay=a[ccs.CONST_A_MOVEMENT_DELAY]||0;var d=a[ccs.CONST_A_NAME];d&&(c.name=d);for(var e=(a[ccs.CONST_FRAME_DATA]||[]).length,d=0;d<e;d++){var f=this.decodeFrameFromJson(a[ccs.CONST_FRAME_DATA][d],b);c.addFrameData(f);b.cocoStudioVersion<ccs.CONST_VERSION_COMBINED&&(f.frameID=c.duration,c.duration+=f.duration)}if(b.cocoStudioVersion<ccs.VERSION_CHANGE_ROTATION_RANGE)for(e=c.frameList,f=Math.PI,d=e.length-1;0<=d;d--)if(0<d){var g=e[d].skewX-e[d-1].skewX,
h=e[d].skewY-e[d-1].skewY;if(g<-f||g>f)e[d-1].skewX=0>g?e[d-1].skewX-2*f:e[d-1].skewX+2*f;if(h<-f||h>f)e[d-1].skewY=0>h?e[d-1].skewY-2*f:e[d-1].skewY+2*f}b.cocoStudioVersion<ccs.CONST_VERSION_COMBINED&&0<c.frameList.length&&(f=new ccs.FrameData,f.copy(c.frameList[c.frameList.length-1]),c.addFrameData(f),f.frameID=c.duration);return c},decodeFrame:function(a,b,c,d){var e=0,e=e=e=e=e=e=e=e=e=e=e=0;c=new ccs.FrameData;c.strMovement=a.getAttribute(ccs.CONST_A_MOVEMENT)||"";c.movement=c.strMovement;c.strEvent=
a.getAttribute(ccs.CONST_A_EVENT)||"";c.event=c.strEvent;c.strSound=a.getAttribute(ccs.CONST_A_SOUND)||"";c.sound=c.strSound;c.strSoundEffect=a.getAttribute(ccs.CONST_A_SOUND_EFFECT)||"";c.soundEffect=c.strSoundEffect;e=a.getAttribute(ccs.CONST_A_TWEEN_FRAME);c.isTween=!(void 0!==e&&("false"===e||"0"===e));if(d.flashToolVersion>=ccs.CONST_VERSION_2_0){if(e=a.getAttribute(ccs.CONST_A_COCOS2DX_X))c.x=parseFloat(e),c.x*=this._positionReadScale;e=a.getAttribute(ccs.CONST_A_COCOS2DX_Y)}else{if(e=a.getAttribute(ccs.CONST_A_X))c.x=
parseFloat(e),c.x*=this._positionReadScale;e=a.getAttribute(ccs.CONST_A_Y)}e&&(c.y=-parseFloat(e),c.y*=this._positionReadScale);e=a.getAttribute(ccs.CONST_A_SCALE_X);null!=e&&(c.scaleX=parseFloat(e));e=a.getAttribute(ccs.CONST_A_SCALE_Y);null!=e&&(c.scaleY=parseFloat(e));e=a.getAttribute(ccs.CONST_A_SKEW_X);null!=e&&(c.skewX=cc.degreesToRadians(parseFloat(e)));e=a.getAttribute(ccs.CONST_A_SKEW_Y);null!=e&&(c.skewY=cc.degreesToRadians(-parseFloat(e)));e=a.getAttribute(ccs.CONST_A_DURATION);null!=e&&
(c.duration=parseFloat(e));e=a.getAttribute(ccs.CONST_A_DISPLAY_INDEX);null!=e&&(c.displayIndex=parseFloat(e));e=a.getAttribute(ccs.CONST_A_Z);null!=e&&(c.zOrder=parseInt(e));e=a.getAttribute(ccs.CONST_A_TWEEN_ROTATE);null!=e&&(c.tweenRotate=parseFloat(e));e=a.getAttribute(ccs.CONST_A_BLEND_TYPE);if(null!=e){var f=c.blendFunc;switch(e){case ccs.BLEND_TYPE_NORMAL:f.src=cc.BLEND_SRC;f.dst=cc.BLEND_DST;break;case ccs.BLEND_TYPE_ADD:f.src=cc.SRC_ALPHA;f.dst=cc.ONE;break;case ccs.BLEND_TYPE_MULTIPLY:f.src=
cc.DST_COLOR;f.dst=cc.ONE_MINUS_SRC_ALPHA;break;case ccs.BLEND_TYPE_SCREEN:f.src=cc.ONE;f.dst=cc.ONE_MINUS_DST_COLOR;break;default:c.blendFunc.src=cc.BLEND_SRC,c.blendFunc.dst=cc.BLEND_DST}}var g=a.querySelectorAll(ccs.CONST_FRAME+" \x3e "+ccs.CONST_A_COLOR_TRANSFORM);if(g&&0<g.length){var g=g[0],h,k,m,n,p,e=parseFloat(g.getAttribute(ccs.CONST_A_ALPHA))||0,f=parseFloat(g.getAttribute(ccs.CONST_A_RED))||0;h=parseFloat(g.getAttribute(ccs.CONST_A_GREEN))||0;k=parseFloat(g.getAttribute(ccs.CONST_A_BLUE))||
0;m=parseFloat(g.getAttribute(ccs.CONST_A_ALPHA_OFFSET))||0;n=parseFloat(g.getAttribute(ccs.CONST_A_RED_OFFSET))||0;p=parseFloat(g.getAttribute(ccs.CONST_A_GREEN_OFFSET))||0;g=parseFloat(g.getAttribute(ccs.CONST_A_BLUE_OFFSET))||0;c.a=2.55*m+e;c.r=2.55*n+f;c.g=2.55*p+h;c.b=2.55*g+k;c.isUseColorInfo=!0}e=a.getAttribute(ccs.CONST_A_TWEEN_EASING);null!=e&&(e!=ccs.CONST_FL_NAN?(e=a.getAttribute(ccs.CONST_A_TWEEN_EASING))&&(c.tweenEasing=2===e?ccs.TweenType.SINE_EASEINOUT:e):c.tweenEasing=ccs.TweenType.LINEAR);
b&&(a=new ccs.BaseData,d.flashToolVersion>=ccs.CONST_VERSION_2_0?(a.x=parseFloat(b.getAttribute(ccs.CONST_A_COCOS2DX_X)),a.y=parseFloat(b.getAttribute(ccs.CONST_A_COCOS2DX_Y))):(a.x=parseFloat(b.getAttribute(ccs.CONST_A_X)),a.y=parseFloat(b.getAttribute(ccs.CONST_A_Y))),a.skewX=parseFloat(b.getAttribute(ccs.CONST_A_SKEW_X)),a.skewY=parseFloat(b.getAttribute(ccs.CONST_A_SKEW_Y)),a.y=-a.y,a.skewX=cc.degreesToRadians(a.skewX),a.skewY=cc.degreesToRadians(-a.skewY),ccs.TransformHelp.transformFromParent(c,
a));return c},decodeFrameFromJson:function(a,b){var c=new ccs.FrameData;this.decodeNodeFromJson(c,a,b);c.tweenEasing=a[ccs.CONST_A_TWEEN_EASING]||ccs.TweenType.LINEAR;c.displayIndex=a[ccs.CONST_A_DISPLAY_INDEX];var d=null==a[ccs.CONST_A_BLEND_DST]?cc.BLEND_DST:a[ccs.CONST_A_BLEND_DST];c.blendFunc.src=null==a[ccs.CONST_A_BLEND_SRC]?cc.BLEND_SRC:a[ccs.CONST_A_BLEND_SRC];c.blendFunc.dst=d;c.isTween=null==a[ccs.CONST_A_TWEEN_FRAME]?!0:a[ccs.CONST_A_TWEEN_FRAME];d=a[ccs.CONST_A_EVENT];null!=d&&(c.strEvent=
d,c.event=d);b.cocoStudioVersion<ccs.CONST_VERSION_COMBINED?c.duration=null==a[ccs.CONST_A_DURATION]?1:a[ccs.CONST_A_DURATION]:c.frameID=a[ccs.CONST_A_FRAME_INDEX];for(var d=a[ccs.CONST_A_EASING_PARAM]||[],e=0;e<d.length;e++)c.easingParams[e]=d[e];return c},decodeTexture:function(a,b){var c=new ccs.TextureData;c.init();a.getAttribute(ccs.CONST_A_NAME)&&(c.name=a.getAttribute(ccs.CONST_A_NAME));var d,e;b.flashToolVersion>=ccs.CONST_VERSION_2_0?(d=parseFloat(a.getAttribute(ccs.CONST_A_COCOS2D_PIVOT_X))||
0,e=parseFloat(a.getAttribute(ccs.CONST_A_COCOS2D_PIVOT_Y))||0):(d=parseFloat(a.getAttribute(ccs.CONST_A_PIVOT_X))||0,e=parseFloat(a.getAttribute(ccs.CONST_A_PIVOT_Y))||0);var f=parseFloat(a.getAttribute(ccs.CONST_A_WIDTH))||0,g=parseFloat(a.getAttribute(ccs.CONST_A_HEIGHT))||0;c.pivotX=d/f;c.pivotY=(g-e)/g;d=a.querySelectorAll(ccs.CONST_SUB_TEXTURE+" \x3e "+ccs.CONST_CONTOUR);for(e=0;e<d.length;e++)c.addContourData(this.decodeContour(d[e],b));return c},decodeTextureFromJson:function(a){var b=new ccs.TextureData;
b.init();var c=a[ccs.CONST_A_NAME];null!=c&&(b.name=c);b.width=a[ccs.CONST_A_WIDTH]||0;b.height=a[ccs.CONST_A_HEIGHT]||0;b.pivotX=a[ccs.CONST_A_PIVOT_X]||0;b.pivotY=a[ccs.CONST_A_PIVOT_Y]||0;a=a[ccs.CONST_CONTOUR_DATA]||[];for(c=0;c<a.length;c++)b.contourDataList.push(this.decodeContourFromJson(a[c]));return b},decodeContour:function(a,b){var c=new ccs.ContourData;c.init();for(var d=a.querySelectorAll(ccs.CONST_CONTOUR+" \x3e "+ccs.CONST_CONTOUR_VERTEX),e,f=0;f<d.length;f++){e=d[f];var g=cc.p(0,0);
g.x=parseFloat(e.getAttribute(ccs.CONST_A_X))||0;g.y=parseFloat(e.getAttribute(ccs.CONST_A_Y))||0;g.y=-g.y;c.vertexList.push(g)}return c},decodeContourFromJson:function(a){var b=new ccs.ContourData;b.init();a=a[ccs.CONST_VERTEX_POINT]||[];for(var c=a.length,d=0;d<c;d++){var e=a[d],f=cc.p(0,0);f.x=e[ccs.CONST_A_X]||0;f.y=e[ccs.CONST_A_Y]||0;b.vertexList.push(f)}return b},addDataFromJsonCache:function(a,b){b.contentScale=null==a[ccs.CONST_CONTENT_SCALE]?1:a[ccs.CONST_CONTENT_SCALE];var c=a[ccs.CONST_ARMATURE_DATA]||
[],d,e;for(d=0;d<c.length;d++)e=this.decodeArmatureFromJSON(c[d],b),ccs.armatureDataManager.addArmatureData(e.name,e,b.filename);c=a[ccs.CONST_ANIMATION_DATA]||[];for(d=0;d<c.length;d++)e=this.decodeAnimationFromJson(c[d],b),ccs.armatureDataManager.addAnimationData(e.name,e,b.filename);c=a[ccs.CONST_TEXTURE_DATA]||[];for(d=0;d<c.length;d++)e=this.decodeTextureFromJson(c[d],b),ccs.armatureDataManager.addTextureData(e.name,e,b.filename);if(null==b.asyncStruct?ccs.armatureDataManager.isAutoLoadSpriteFile():
b.asyncStruct.autoLoadSpriteFile){var c=a[ccs.CONST_CONFIG_FILE_PATH]||[],f;for(d=0;d<c.length;d++)e=c[d],f=e.lastIndexOf("."),e=e.substring(0,f),f=b.basefilePath+e+".plist",e=b.basefilePath+e+".png",ccs.armatureDataManager.addSpriteFrameFromFile(f,e,b.filename)}},decodeNodeFromJson:function(a,b,c){a.x=b[ccs.CONST_A_X]*this._positionReadScale;a.y=b[ccs.CONST_A_Y]*this._positionReadScale;a.x*=c.contentScale;a.y*=c.contentScale;a.zOrder=b[ccs.CONST_A_Z];a.skewX=b[ccs.CONST_A_SKEW_X]||0;a.skewY=b[ccs.CONST_A_SKEW_Y]||
0;a.scaleX=null==b[ccs.CONST_A_SCALE_X]?1:b[ccs.CONST_A_SCALE_X];a.scaleY=null==b[ccs.CONST_A_SCALE_Y]?1:b[ccs.CONST_A_SCALE_Y];if(b=c.cocoStudioVersion<ccs.VERSION_COLOR_READING?b[0]:b[ccs.CONST_COLOR_INFO]||null)a.a=null==b[ccs.CONST_A_ALPHA]?255:b[ccs.CONST_A_ALPHA],a.r=null==b[ccs.CONST_A_RED]?255:b[ccs.CONST_A_RED],a.g=null==b[ccs.CONST_A_GREEN]?255:b[ccs.CONST_A_GREEN],a.b=null==b[ccs.CONST_A_BLUE]?255:b[ccs.CONST_A_BLUE],a.isUseColorInfo=!0},clear:function(){this._configFileList=[];this._asyncRefTotalCount=
this._asyncRefCount=0},_asyncCallBack:function(a,b,c){a&&cc.isFunction(a)&&a.call(b,c);if(b&&a&&"string"===typeof a)b[a](c)},_initBaseFilePath:function(a){var b=a.lastIndexOf("/");return a=-1<b?a.substr(0,b+1):""},addDataFromXML:function(a,b){var c=cc.loader.getRes(a);if(!c)throw Error("Please load the resource first : "+a);(c=cc.saxParser.parse(c).documentElement)&&this.addDataFromCache(c,b)},addDataFromJson:function(a,b){var c=cc.loader.getRes(a);this.addDataFromJsonCache(c,b)}};ccs.spriteFrameCacheHelper={_textureAtlasDic:{},_imagePaths:[],addSpriteFrameFromFile:function(a,b){cc.spriteFrameCache.addSpriteFrames(a,b)},getTextureAtlasWithTexture:function(a){return null},clear:function(){this._textureAtlasDic={};this._imagePaths=[]}};ccs.TransformHelp=ccs.TransformHelp||ccs.Class.extend({});ccs.TransformHelp.helpMatrix1=cc.affineTransformMake(1,0,0,1,0,0);ccs.TransformHelp.helpMatrix2=cc.affineTransformMake(1,0,0,1,0,0);ccs.TransformHelp.helpPoint1=cc.p(0,0);ccs.TransformHelp.helpPoint2=cc.p(0,0);ccs.TransformHelp.helpParentNode={};
ccs.TransformHelp.transformFromParent=function(a,b){this.nodeToMatrix(a,this.helpMatrix1);this.nodeToMatrix(b,this.helpMatrix2);this.helpMatrix2=cc.affineTransformInvert(this.helpMatrix2);this.helpMatrix1=cc.affineTransformConcat(this.helpMatrix1,this.helpMatrix2);this.matrixToNode(this.helpMatrix1,a)};
ccs.TransformHelp.transformToParent=function(a,b){this.nodeToMatrix(a,this.helpMatrix1);this.nodeToMatrix(b,this.helpMatrix2);this.helpMatrix1=cc.affineTransformConcat(this.helpMatrix1,this.helpMatrix2);this.matrixToNode(this.helpMatrix1,a)};
ccs.TransformHelp.transformFromParentWithoutScale=function(a,b){for(var c in b)this.helpParentNode[c]=b[c];this.helpParentNode.scaleX=1;this.helpParentNode.scaleY=1;this.nodeToMatrix(a,this.helpMatrix1);this.nodeToMatrix(this.helpParentNode,this.helpMatrix2);this.helpMatrix2=cc.affineTransformInvert(this.helpMatrix2);this.helpMatrix1=cc.affineTransformConcat(this.helpMatrix1,this.helpMatrix2);this.matrixToNode(this.helpMatrix1,a)};
ccs.TransformHelp.transformToParentWithoutScale=function(a,b){for(var c in b)this.helpParentNode[c]=b[c];this.helpParentNode.scaleX=1;this.helpParentNode.scaleY=1;this.nodeToMatrix(a,this.helpMatrix1);this.nodeToMatrix(this.helpParentNode,this.helpMatrix2);this.helpMatrix1=cc.affineTransformConcat(this.helpMatrix1,this.helpMatrix2);this.matrixToNode(this.helpMatrix1,a)};
ccs.TransformHelp.nodeToMatrix=function(a,b){if(a.skewX===-a.skewY){var c=Math.sin(a.skewX),d=Math.cos(a.skewX);b.a=a.scaleX*d;b.b=a.scaleX*-c;b.c=a.scaleY*c;b.d=a.scaleY*d}else b.a=a.scaleX*Math.cos(a.skewY),b.b=a.scaleX*Math.sin(a.skewY),b.c=a.scaleY*Math.sin(a.skewX),b.d=a.scaleY*Math.cos(a.skewX);b.tx=a.x;b.ty=a.y};
ccs.TransformHelp.matrixToNode=function(a,b){this.helpPoint1.x=0;this.helpPoint1.y=1;this.helpPoint1=cc.pointApplyAffineTransform(this.helpPoint1,a);this.helpPoint1.x-=a.tx;this.helpPoint1.y-=a.ty;this.helpPoint2.x=1;this.helpPoint2.y=0;this.helpPoint2=cc.pointApplyAffineTransform(this.helpPoint2,a);this.helpPoint2.x-=a.tx;this.helpPoint2.y-=a.ty;b.skewX=-(Math.atan2(this.helpPoint1.y,this.helpPoint1.x)-1.5707964);b.skewY=Math.atan2(this.helpPoint2.y,this.helpPoint2.x);b.scaleX=Math.sqrt(a.a*a.a+
a.b*a.b);b.scaleY=Math.sqrt(a.c*a.c+a.d*a.d);b.x=a.tx;b.y=a.ty};ccs.TransformHelp.nodeConcat=function(a,b){a.x+=b.x;a.y+=b.y;a.skewX+=b.skewX;a.skewY+=b.skewY;a.scaleX+=b.scaleX;a.scaleY+=b.scaleY};ccs.TransformHelp.nodeSub=function(a,b){a.x-=b.x;a.y-=b.y;a.skewX-=b.skewX;a.skewY-=b.skewY;a.scaleX-=b.scaleX;a.scaleY-=b.scaleY};ccs.TweenType={CUSTOM_EASING:-1,LINEAR:0,SINE_EASEIN:1,SINE_EASEOUT:2,SINE_EASEINOUT:3,QUAD_EASEIN:4,QUAD_EASEOUT:5,QUAD_EASEINOUT:6,CUBIC_EASEIN:7,CUBIC_EASEOUT:8,CUBIC_EASEINOUT:9,QUART_EASEIN:10,QUART_EASEOUT:11,QUART_EASEINOUT:12,QUINT_EASEIN:13,QUINT_EASEOUT:14,QUINT_EASEINOUT:15,EXPO_EASEIN:16,EXPO_EASEOUT:17,EXPO_EASEINOUT:18,CIRC_EASEIN:19,CIRC_EASEOUT:20,CIRC_EASEINOUT:21,ELASTIC_EASEIN:22,ELASTIC_EASEOUT:23,ELASTIC_EASEINOUT:24,BACK_EASEIN:25,BACK_EASEOUT:26,BACK_EASEINOUT:27,BOUNCE_EASEIN:28,
BOUNCE_EASEOUT:29,BOUNCE_EASEINOUT:30,TWEEN_EASING_MAX:1E4};ccs.TweenFunction=ccs.TweenFunction||ccs.Class.extend({});ccs.DOUBLE_PI=ccs.M_PI_X_2=2*Math.PI;ccs.HALF_PI=ccs.M_PI_2=Math.PI/2;ccs.M_PI=Math.PI;
ccs.TweenFunction.tweenTo=function(a,b,c){var d=0;switch(b){case ccs.TweenType.CUSTOM_EASING:d=this.customEase(a,c);break;case ccs.TweenType.LINEAR:d=this.linear(a);break;case ccs.TweenType.SINE_EASEIN:d=this.sineEaseIn(a);break;case ccs.TweenType.SINE_EASEOUT:d=this.sineEaseOut(a);break;case ccs.TweenType.SINE_EASEINOUT:d=this.sineEaseInOut(a);break;case ccs.TweenType.QUAD_EASEIN:d=this.quadEaseIn(a);break;case ccs.TweenType.QUAD_EASEOUT:d=this.quadEaseOut(a);break;case ccs.TweenType.QUAD_EASEINOUT:d=
this.quadEaseInOut(a);break;case ccs.TweenType.CUBIC_EASEIN:d=this.cubicEaseIn(a);break;case ccs.TweenType.CUBIC_EASEOUT:d=this.cubicEaseOut(a);break;case ccs.TweenType.CUBIC_EASEINOUT:d=this.cubicEaseInOut(a);break;case ccs.TweenType.QUART_EASEIN:d=this.quartEaseIn(a);break;case ccs.TweenType.QUART_EASEOUT:d=this.quartEaseOut(a);break;case ccs.TweenType.QUART_EASEINOUT:d=this.quartEaseInOut(a);break;case ccs.TweenType.QUINT_EASEIN:d=this.quintEaseIn(a);break;case ccs.TweenType.QUINT_EASEOUT:d=this.quintEaseOut(a);
break;case ccs.TweenType.QUINT_EASEINOUT:d=this.quintEaseInOut(a);break;case ccs.TweenType.EXPO_EASEIN:d=this.expoEaseIn(a);break;case ccs.TweenType.EXPO_EASEOUT:d=this.expoEaseOut(a);break;case ccs.TweenType.EXPO_EASEINOUT:d=this.expoEaseInOut(a);break;case ccs.TweenType.CIRC_EASEIN:d=this.circEaseIn(a);break;case ccs.TweenType.CIRC_EASEOUT:d=this.circEaseOut(a);break;case ccs.TweenType.CIRC_EASEINOUT:d=this.circEaseInOut(a);break;case ccs.TweenType.ELASTIC_EASEIN:b=0.3;null!=c&&0<c.length&&(b=c[0]);
d=this.elasticEaseIn(a,b);break;case ccs.TweenType.ELASTIC_EASEOUT:b=0.3;null!=c&&0<c.length&&(b=c[0]);d=this.elasticEaseOut(a,b);break;case ccs.TweenType.ELASTIC_EASEINOUT:b=0.3;null!=c&&0<c.length&&(b=c[0]);d=this.elasticEaseInOut(a,b);break;case ccs.TweenType.BACK_EASEIN:d=this.backEaseIn(a);break;case ccs.TweenType.BACK_EASEOUT:d=this.backEaseOut(a);break;case ccs.TweenType.BACK_EASEINOUT:d=this.backEaseInOut(a);break;case ccs.TweenType.BOUNCE_EASEIN:d=this.bounceEaseIn(a);break;case ccs.TweenType.BOUNCE_EASEOUT:d=
this.bounceEaseOut(a);break;case ccs.TweenType.BOUNCE_EASEINOUT:d=this.bounceEaseInOut(a);break;default:d=this.sineEaseInOut(a)}return d};ccs.TweenFunction.linear=function(a){return a};ccs.TweenFunction.sineEaseIn=function(a){return-1*Math.cos(a*ccs.HALF_PI)+1};ccs.TweenFunction.sineEaseOut=function(a){return Math.sin(a*ccs.HALF_PI)};ccs.TweenFunction.sineEaseInOut=function(a){return-0.5*(Math.cos(ccs.M_PI*a)-1)};ccs.TweenFunction.quadEaseIn=function(a){return a*a};
ccs.TweenFunction.quadEaseOut=function(a){return-1*a*(a-2)};ccs.TweenFunction.quadEaseInOut=function(a){a*=2;if(1>a)return 0.5*a*a;--a;return-0.5*(a*(a-2)-1)};ccs.TweenFunction.cubicEaseIn=function(a){return a*a*a};ccs.TweenFunction.cubicEaseOut=function(a){a-=1;return a*a*a+1};ccs.TweenFunction.cubicEaseInOut=function(a){a*=2;if(1>a)return 0.5*a*a*a;a-=2;return 0.5*(a*a*a+2)};ccs.TweenFunction.quartEaseIn=function(a){return a*a*a*a};
ccs.TweenFunction.quartEaseOut=function(a){a-=1;return-(a*a*a*a-1)};ccs.TweenFunction.quartEaseInOut=function(a){a*=2;if(1>a)return 0.5*a*a*a*a;a-=2;return-0.5*(a*a*a*a-2)};ccs.TweenFunction.quintEaseIn=function(a){return a*a*a*a*a};ccs.TweenFunction.quintEaseOut=function(a){a-=1;return a*a*a*a*a+1};ccs.TweenFunction.quintEaseInOut=function(a){a*=2;if(1>a)return 0.5*a*a*a*a*a;a-=2;return 0.5*(a*a*a*a*a+2)};ccs.TweenFunction.expoEaseIn=function(a){return 0===a?0:Math.pow(2,10*(a-1))-0.001};
ccs.TweenFunction.expoEaseOut=function(a){return 1===a?1:-Math.pow(2,-10*a)+1};ccs.TweenFunction.expoEaseInOut=function(a){a/=0.5;return a=1>a?0.5*Math.pow(2,10*(a-1)):0.5*(-Math.pow(2,-10*(a-1))+2)};ccs.TweenFunction.circEaseIn=function(a){return-1*(Math.sqrt(1-a*a)-1)};ccs.TweenFunction.circEaseOut=function(a){a-=1;return Math.sqrt(1-a*a)};ccs.TweenFunction.circEaseInOut=function(a){a*=2;if(1>a)return-0.5*(Math.sqrt(1-a*a)-1);a-=2;return 0.5*(Math.sqrt(1-a*a)+1)};
ccs.TweenFunction.elasticEaseIn=function(a,b){var c=0.3;0<b.length&&(c=b[0]);var d=0;0===a||1===a?d=a:(d=c/4,a-=1,d=-Math.pow(2,10*a)*Math.sin((a-d)*ccs.DOUBLE_PI/c));return d};ccs.TweenFunction.elasticEaseOut=function(a,b){var c=0.3;0<b.length&&(c=b[0]);var d=0;0===a||1===a?d=a:(d=c/4,d=Math.pow(2,-10*a)*Math.sin((a-d)*ccs.DOUBLE_PI/c)+1);return d};
ccs.TweenFunction.elasticEaseInOut=function(a,b){var c=0.3;0<b.length&&(c=b[0]);var d=0;0===a||1===a?d=a:(c||(c=0.3*1.5),d=c/4,a=2*a-1,d=0>a?-0.5*Math.pow(2,10*a)*Math.sin((a-d)*ccs.DOUBLE_PI/c):Math.pow(2,-10*a)*Math.sin((a-d)*ccs.DOUBLE_PI/c)*0.5+1);return d};ccs.TweenFunction.backEaseIn=function(a){return a*a*(2.70158*a-1.70158)};ccs.TweenFunction.backEaseOut=function(a){a-=1;return a*a*(2.70158*a+1.70158)+1};
ccs.TweenFunction.backEaseInOut=function(a){a*=2;if(1>a)return a*a*(3.5949095*a-2.5949095)/2;a-=2;return a*a*(3.5949095*a+2.5949095)/2+1};ccs.bounceTime=function(a){if(a<1/2.75)return 7.5625*a*a;if(a<2/2.75)return a-=1.5/2.75,7.5625*a*a+0.75;if(a<2.5/2.75)return a-=2.25/2.75,7.5625*a*a+0.9375;a-=2.625/2.75;return 7.5625*a*a+0.984375};ccs.TweenFunction.bounceEaseIn=function(a){return 1-ccs.bounceTime(1-a)};ccs.TweenFunction.bounceEaseOut=function(a){return ccs.bounceTime(a)};
ccs.TweenFunction.bounceEaseInOut=function(a){var b=0;return b=0.5>a?0.5*(1-ccs.bounceTime(1-2*a)):0.5*ccs.bounceTime(2*a-1)+0.5};ccs.TweenFunction.customEase=function(a,b){if(0<b.length){var c=1-a;return b[1]*c*c*c+3*b[3]*a*c*c+3*b[5]*a*a*c+b[7]*a*a*a}return a};ccs.TweenFunction.easeIn=function(a,b){return Math.pow(a,b)};ccs.TweenFunction.easeOut=function(a,b){return Math.pow(a,1/b)};ccs.TweenFunction.easeInOut=function(a,b){a*=2;return 1>a?0.5*Math.pow(a,b):1-0.5*Math.pow(2-a,b)};
ccs.TweenFunction.quadraticIn=function(a){return Math.pow(a,2)};ccs.TweenFunction.quadraticOut=function(a){return-a*(a-2)};ccs.TweenFunction.bezieratFunction=function(a,b,c,d,e){return Math.pow(1-e,3)*a+3*e*Math.pow(1-e,2)*b+3*Math.pow(e,2)*(1-e)*c+Math.pow(e,3)*d};var ENABLE_PHYSICS_DETECT=!1;ccs.fmodf=function(a,b){for(;a>b;)a-=b;return a};var CC_SAFE_RELEASE=function(a){a&&a.release&&a.release()};ccs.isSpriteContainPoint=function(a,b,c){b=a.convertToNodeSpace(b);c&&(c.x=b.x,c.y=b.y);a=a.getContentSize();return cc.rectContainsPoint(cc.rect(0,0,a.width,a.height),b)};ccs.SPRITE_CONTAIN_POINT=ccs.isSpriteContainPoint;ccs.SPRITE_CONTAIN_POINT_WITH_RETURN=ccs.isSpriteContainPoint;
ccs.extBezierTo=function(a,b,c,d,e){var f=cc.p(0,0);d&&!e&&(f.x=Math.pow(1-a,2)*b.x+2*a*(1-a)*c.x+Math.pow(a,2)*d.x,f.y=Math.pow(1-a,2)*b.y+2*a*(1-a)*c.y+Math.pow(a,2)*d.y);e&&(f.x=b.x*Math.pow(1-a,3)+3*a*c.x*Math.pow(1-a,2)+3*d.x*Math.pow(a,2)*(1-a)+e.x*Math.pow(a,3),f.y=b.y*Math.pow(1-a,3)+3*a*c.y*Math.pow(1-a,2)+3*d.y*Math.pow(a,2)*(1-a)+e.y*Math.pow(a,3));return f};ccs.extCircleTo=function(a,b,c,d,e){var f=cc.p(0,0);f.x=b.x+c*Math.cos(d+e*a);f.y=b.y+c*Math.sin(d+e*a);return f};ccs.RelativeData=function(){this.plistFiles=[];this.armatures=[];this.animations=[];this.textures=[]};
ccs.armatureDataManager={_animationDatas:{},_armatureDatas:{},_textureDatas:{},_autoLoadSpriteFile:!1,_relativeDatas:{},s_sharedArmatureDataManager:null,removeArmatureFileInfo:function(a){var b=this.getRelativeData(a);if(b){var c,d;for(c=0;c<b.armatures.length;c++)d=b.armatures[c],this.removeArmatureData(d);for(c=0;c<b.animations.length;c++)d=b.animations[c],this.removeAnimationData(d);for(c=0;c<b.textures.length;c++)d=b.textures[c],this.removeTextureData(d);for(c=0;c<b.plistFiles.length;c++)d=b.plistFiles[c],
cc.spriteFrameCache.removeSpriteFramesFromFile(d);delete this._relativeDatas[a];ccs.dataReaderHelper.removeConfigFile(a)}},addArmatureData:function(a,b,c){(c=this.getRelativeData(c))&&c.armatures.push(a);this._armatureDatas[a]=b},getArmatureData:function(a){var b=null;this._armatureDatas&&(b=this._armatureDatas[a]);return b},removeArmatureData:function(a){this._armatureDatas[a]&&delete this._armatureDatas[a]},addAnimationData:function(a,b,c){(c=this.getRelativeData(c))&&c.animations.push(a);this._animationDatas[a]=
b},getAnimationData:function(a){var b=null;this._animationDatas[a]&&(b=this._animationDatas[a]);return b},removeAnimationData:function(a){this._animationDatas[a]&&delete this._animationDatas[a]},addTextureData:function(a,b,c){(c=this.getRelativeData(c))&&c.textures.push(a);this._textureDatas[a]=b},getTextureData:function(a){var b=null;this._textureDatas&&(b=this._textureDatas[a]);return b},removeTextureData:function(a){this._textureDatas[a]&&delete this._textureDatas[a]},addArmatureFileInfo:function(){var a,
b,c;switch(arguments.length){case 1:c=arguments[0];this.addRelativeData(c);this._autoLoadSpriteFile=!0;ccs.dataReaderHelper.addDataFromFile(c);break;case 3:a=arguments[0],b=arguments[1],c=arguments[2],this.addRelativeData(c),this._autoLoadSpriteFile=!1,ccs.dataReaderHelper.addDataFromFile(c),this.addSpriteFrameFromFile(b,a)}},addArmatureFileInfoAsync:function(){var a,b,c,d,e;switch(arguments.length){case 3:c=arguments[0];d=arguments[2];e=arguments[1];this.addRelativeData(c);this._autoLoadSpriteFile=
!0;ccs.dataReaderHelper.addDataFromFileAsync("","",c,e,d);break;case 5:a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[4],e=arguments[3],this.addRelativeData(c),this._autoLoadSpriteFile=!1,ccs.dataReaderHelper.addDataFromFileAsync(a,b,c,e,d),this.addSpriteFrameFromFile(b,a)}},addSpriteFrameFromFile:function(a,b,c){(c=this.getRelativeData(c))&&c.plistFiles.push(a);ccs.spriteFrameCacheHelper.addSpriteFrameFromFile(a,b)},isAutoLoadSpriteFile:function(){return this._autoLoadSpriteFile},getArmatureDatas:function(){return this._armatureDatas},
getAnimationDatas:function(){return this._animationDatas},getTextureDatas:function(){return this._textureDatas},addRelativeData:function(a){this._relativeDatas[a]||(this._relativeDatas[a]=new ccs.RelativeData)},getRelativeData:function(a){return this._relativeDatas[a]},clear:function(){for(var a in this._relativeDatas)this.removeArmatureFileInfo(a);this._animationDatas={};this._armatureDatas={};this._textureDatas={};this._relativeDatas={};ccs.spriteFrameCacheHelper.clear();ccs.dataReaderHelper.clear()}};ccs.BLEND_TYPE_NORMAL=0;ccs.BLEND_TYPE_LAYER=1;ccs.BLEND_TYPE_DARKEN=2;ccs.BLEND_TYPE_MULTIPLY=3;ccs.BLEND_TYPE_LIGHTEN=4;ccs.BLEND_TYPE_SCREEN=5;ccs.BLEND_TYPE_OVERLAY=6;ccs.BLEND_TYPE_HIGHLIGHT=7;ccs.BLEND_TYPE_ADD=8;ccs.BLEND_TYPE_SUBTRACT=9;ccs.BLEND_TYPE_DIFFERENCE=10;ccs.BLEND_TYPE_INVERT=11;ccs.BLEND_TYPE_ALPHA=12;ccs.BLEND_TYPE_ERASE=13;ccs.DISPLAY_TYPE_SPRITE=0;ccs.DISPLAY_TYPE_ARMATURE=1;ccs.DISPLAY_TYPE_PARTICLE=2;ccs.DISPLAY_TYPE_MAX=3;
ccs.BaseData=ccs.Class.extend({x:0,y:0,zOrder:0,skewX:0,skewY:0,scaleX:1,scaleY:1,tweenRotate:0,isUseColorInfo:!1,r:255,g:255,b:255,a:255,ctor:function(){this.skewY=this.skewX=this.zOrder=this.y=this.x=0;this.scaleY=this.scaleX=1;this.tweenRotate=0;this.isUseColorInfo=!1;this.a=this.b=this.g=this.r=255},copy:function(a){this.x=a.x;this.y=a.y;this.zOrder=a.zOrder;this.scaleX=a.scaleX;this.scaleY=a.scaleY;this.skewX=a.skewX;this.skewY=a.skewY;this.tweenRotate=a.tweenRotate;this.isUseColorInfo=a.isUseColorInfo;
this.r=a.r;this.g=a.g;this.b=a.b;this.a=a.a},setColor:function(a){this.r=a.r;this.g=a.g;this.b=a.b;this.a=a.a},getColor:function(){return cc.color(this.r,this.g,this.b,this.a)},subtract:function(a,b,c){this.x=b.x-a.x;this.y=b.y-a.y;this.scaleX=b.scaleX-a.scaleX;this.scaleY=b.scaleY-a.scaleY;this.skewX=b.skewX-a.skewX;this.skewY=b.skewY-a.skewY;this.isUseColorInfo||a.isUseColorInfo||b.isUseColorInfo?(this.a=b.a-a.a,this.r=b.r-a.r,this.g=b.g-a.g,this.b=b.b-a.b,this.isUseColorInfo=!0):(this.a=this.r=
this.g=this.b=0,this.isUseColorInfo=!1);c&&(this.skewX>ccs.M_PI&&(this.skewX-=ccs.DOUBLE_PI),this.skewX<-ccs.M_PI&&(this.skewX+=ccs.DOUBLE_PI),this.skewY>ccs.M_PI&&(this.skewY-=ccs.DOUBLE_PI),this.skewY<-ccs.M_PI&&(this.skewY+=ccs.DOUBLE_PI));b.tweenRotate&&(this.skewX+=b.tweenRotate*ccs.PI*2,this.skewY-=b.tweenRotate*ccs.PI*2)}});
ccs.DisplayData=ccs.Class.extend({displayType:ccs.DISPLAY_TYPE_MAX,displayName:"",ctor:function(){this.displayType=ccs.DISPLAY_TYPE_MAX},changeDisplayToTexture:function(a){var b=a.lastIndexOf(".");-1!==b&&(a=a.substring(0,b));return a},copy:function(a){this.displayName=a.displayName;this.displayType=a.displayType}});
ccs.SpriteDisplayData=ccs.DisplayData.extend({skinData:null,ctor:function(){this.skinData=new ccs.BaseData;this.displayType=ccs.DISPLAY_TYPE_SPRITE},copy:function(a){ccs.DisplayData.prototype.copy.call(this,a);this.skinData=a.skinData}});ccs.ArmatureDisplayData=ccs.DisplayData.extend({ctor:function(){this.displayName="";this.displayType=ccs.DISPLAY_TYPE_ARMATURE}});ccs.ParticleDisplayData=ccs.DisplayData.extend({ctor:function(){this.displayType=ccs.DISPLAY_TYPE_PARTICLE}});
ccs.BoneData=ccs.BaseData.extend({displayDataList:null,name:"",parentName:"",boneDataTransform:null,ctor:function(){this.displayDataList=[];this.parentName=this.name="";this.boneDataTransform=null},init:function(){this.displayDataList.length=0;return!0},addDisplayData:function(a){this.displayDataList.push(a)},getDisplayData:function(a){return this.displayDataList[a]}});
ccs.ArmatureData=ccs.Class.extend({boneDataDic:null,name:"",dataVersion:0.1,ctor:function(){this.boneDataDic={};this.name="";this.dataVersion=0.1},init:function(){return!0},addBoneData:function(a){this.boneDataDic[a.name]=a},getBoneDataDic:function(){return this.boneDataDic},getBoneData:function(a){return this.boneDataDic[a]}});
ccs.FrameData=ccs.BaseData.extend({duration:0,tweenEasing:0,easingParamNumber:0,easingParams:null,displayIndex:-1,movement:"",event:"",sound:"",soundEffect:"",blendFunc:null,frameID:0,isTween:!0,ctor:function(){ccs.BaseData.prototype.ctor.call(this);this.duration=1;this.tweenEasing=ccs.TweenType.LINEAR;this.easingParamNumber=0;this.easingParams=[];this.displayIndex=0;this.soundEffect=this.sound=this.event=this.movement="";this.blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST);this.frameID=0;this.isTween=
!0},copy:function(a){ccs.BaseData.prototype.copy.call(this,a);this.duration=a.duration;this.displayIndex=a.displayIndex;this.tweenEasing=a.tweenEasing;this.easingParamNumber=a.easingParamNumber;if(0!==this.easingParamNumber)for(var b=this.easingParams.length=0;b<this.easingParamNumber;b++)this.easingParams[b]=a.easingParams[b];this.blendFunc=a.blendFunc;this.isTween=a.isTween}});
ccs.MovementBoneData=ccs.Class.extend({delay:0,scale:1,duration:0,frameList:null,name:"",ctor:function(){this.delay=0;this.scale=1;this.duration=0;this.frameList=[];this.name=""},init:function(){return!0},addFrameData:function(a){this.frameList.push(a)},getFrameData:function(a){return this.frameList[a]}});ccs.MovementData=function(){this.name="";this.duration=0;this.scale=1;this.durationTween=this.durationTo=0;this.loop=!0;this.tweenEasing=ccs.TweenType.LINEAR;this.movBoneDataDic={}};
ccs.MovementData.prototype.addMovementBoneData=function(a){this.movBoneDataDic[a.name]=a};ccs.MovementData.prototype.getMovementBoneData=function(a){return this.movBoneDataDic[a]};ccs.AnimationData=function(){this.movementDataDic={};this.movementNames=[];this.name=""};ccs.AnimationData.prototype.addMovement=function(a){this.movementDataDic[a.name]=a;this.movementNames.push(a.name)};ccs.AnimationData.prototype.getMovement=function(a){return this.movementDataDic[a]};
ccs.AnimationData.prototype.getMovementCount=function(){return Object.keys(this.movementDataDic).length};ccs.ContourVertex2=function(a,b){this.x=a||0;this.y=b||0};ccs.ContourData=function(){this.vertexList=[]};ccs.ContourData.prototype.init=function(){this.vertexList.length=0;return!0};ccs.ContourData.prototype.addVertex=function(a){this.vertexList.push(a)};ccs.TextureData=function(){this.width=this.height=0;this.pivotY=this.pivotX=0.5;this.name="";this.contourDataList=[]};
ccs.TextureData.prototype.init=function(){this.contourDataList.length=0};ccs.TextureData.prototype.addContourData=function(a){this.contourDataList.push(a)};ccs.TextureData.prototype.getContourData=function(a){return this.contourDataList[a]};ccs.DecorativeDisplay=ccs.Class.extend({_display:null,_colliderDetector:null,_displayData:null,ctor:function(){this._displayData=this._colliderDetector=this._display=null},init:function(){return!0},setDisplay:function(a){a._parent&&(a._parent.removeChild(a),delete a._parent);this._display=a},getDisplay:function(){return this._display},setColliderDetector:function(a){this._colliderDetector=a},getColliderDetector:function(){return this._colliderDetector},setDisplayData:function(a){this._displayData=
a},getDisplayData:function(){return this._displayData},release:function(){this._colliderDetector=this._displayData=this._display=null}});ccs.DecorativeDisplay.create=function(){return new ccs.DecorativeDisplay};ccs.displayFactory={addDisplay:function(a,b,c){switch(c.displayType){case ccs.DISPLAY_TYPE_SPRITE:this.addSpriteDisplay(a,b,c);break;case ccs.DISPLAY_TYPE_PARTICLE:this.addParticleDisplay(a,b,c);break;case ccs.DISPLAY_TYPE_ARMATURE:this.addArmatureDisplay(a,b,c)}},createDisplay:function(a,b){switch(b.getDisplayData().displayType){case ccs.DISPLAY_TYPE_SPRITE:this.createSpriteDisplay(a,b);break;case ccs.DISPLAY_TYPE_PARTICLE:this.createParticleDisplay(a,b);break;case ccs.DISPLAY_TYPE_ARMATURE:this.createArmatureDisplay(a,
b)}},_helpTransform:{a:1,b:0,c:0,d:1,tx:0,ty:0},updateDisplay:function(a,b,c){var d=a.getDisplayRenderNode();if(d){switch(a.getDisplayRenderNodeType()){case ccs.DISPLAY_TYPE_SPRITE:c&&(d._renderCmd.setDirtyFlag(cc.Node._dirtyFlags.transformDirty),d.updateArmatureTransform());break;case ccs.DISPLAY_TYPE_PARTICLE:this.updateParticleDisplay(a,d,b);break;case ccs.DISPLAY_TYPE_ARMATURE:this.updateArmatureDisplay(a,d,b);break;default:b=a.getNodeToArmatureTransform(),d.setAdditionalTransform(b)}if((ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT||
ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX)&&c&&(d=a.getDisplayManager().getCurrentDecorativeDisplay(),c=d.getColliderDetector())){b=d.getDisplay();var e=b.getNodeToParentTransform(),d=this._helpTransform;d.a=e.a;d.b=e.b;d.c=e.c;d.d=e.d;d.tx=e.tx;d.ty=e.ty;b=cc.pointApplyAffineTransform(b.getAnchorPointInPoints(),d);d.tx=b.x;d.ty=b.y;a=cc.affineTransformConcat(d,a.getArmature().getNodeToParentTransform());c.updateTransform(a)}}},addSpriteDisplay:function(a,b,c){var d=new ccs.SpriteDisplayData;d.copy(c);
b.setDisplayData(d);this.createSpriteDisplay(a,b)},createSpriteDisplay:function(a,b){var c=null,d=b.getDisplayData(),c=d.displayName,e=c.lastIndexOf(".");-1!==e&&(c=c.substring(0,e));c=""===c?new ccs.Skin:new ccs.Skin("#"+c+".png");b.setDisplay(c);c.setBone(a);this.initSpriteDisplay(a,b,d.displayName,c);(e=a.getArmature())&&(e.getArmatureData().dataVersion>=ccs.CONST_VERSION_COMBINED?c.setSkinData(d.skinData):c.setSkinData(a.boneData))},initSpriteDisplay:function(a,b,c,d){var e=c.lastIndexOf(".");
-1!==e&&(c=c.substring(0,e));(c=ccs.armatureDataManager.getTextureData(c))&&d.setAnchorPoint(cc.p(c.pivotX,c.pivotY));(ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT||ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX)&&c&&0<c.contourDataList.length&&(a=new ccs.ColliderDetector(a),a.addContourDataList(c.contourDataList),b.setColliderDetector(a))},addArmatureDisplay:function(a,b,c){var d=new ccs.ArmatureDisplayData;d.copy(c);b.setDisplayData(d);this.createArmatureDisplay(a,b)},createArmatureDisplay:function(a,b){var c=
b.getDisplayData(),c=new ccs.Armature(c.displayName,a);b.setDisplay(c)},updateArmatureDisplay:function(a,b,c){b&&(b.sortAllChildren(),b.update(c))},addParticleDisplay:function(a,b,c){var d=new ccs.ParticleDisplayData;d.copy(c);b.setDisplayData(d);this.createParticleDisplay(a,b)},createParticleDisplay:function(a,b){var c=b.getDisplayData(),c=new cc.ParticleSystem(c.displayName);c.removeFromParent();c.cleanup();a.getArmature()&&c.setParent(a.getArmature());b.setDisplay(c)},updateParticleDisplay:function(a,
b,c){var d=new ccs.BaseData;ccs.TransformHelp.matrixToNode(a.nodeToArmatureTransform(),d);b.setPosition(d.x,d.y);b.setScaleX(d.scaleX);b.setScaleY(d.scaleY);b.update(c)}};ccs.DisplayManager=ccs.Class.extend({_decoDisplayList:null,_currentDecoDisplay:null,_displayRenderNode:null,_displayIndex:null,_forceChangeDisplay:!1,_bone:null,_visible:!0,_displayType:null,ctor:function(a){this._decoDisplayList=[];this._displayIndex=this._displayRenderNode=this._currentDecoDisplay=null;this._forceChangeDisplay=!1;this._bone=null;this._visible=!0;this._displayType=ccs.DISPLAY_TYPE_MAX;a&&ccs.DisplayManager.prototype.init.call(this,a)},init:function(a){this._bone=a;this.initDisplayList(a.getBoneData());
return!0},addDisplay:function(a,b){var c,d=this._decoDisplayList;0<=b&&b<d.length?c=d[b]:(c=new ccs.DecorativeDisplay,d.push(c));if(a instanceof ccs.DisplayData)ccs.displayFactory.addDisplay(this._bone,c,a);else{var e=null;if(a instanceof ccs.Skin){a.setBone(this._bone);e=new ccs.SpriteDisplayData;ccs.displayFactory.initSpriteDisplay(this._bone,c,a.getDisplayName(),a);var f=c.getDisplayData();if(f instanceof ccs.SpriteDisplayData)a.setSkinData(f.skinData),e.skinData=f.skinData;else{for(var f=!1,g=
d.length-2;0<=g;g--){var h=d[g].getDisplayData();if(h instanceof ccs.SpriteDisplayData){f=!0;a.setSkinData(h.skinData);e.skinData=h.skinData;break}}f||a.setSkinData(new ccs.BaseData)}}else a instanceof cc.ParticleSystem?(e=new ccs.ParticleDisplayData,a.removeFromParent(),a._performRecursive(cc.Node._stateCallbackType.cleanup),(d=this._bone.getArmature())&&a.setParent(d)):a instanceof ccs.Armature?(e=new ccs.ArmatureDisplayData,e.displayName=a.getName(),a.setParentBone(this._bone)):e=new ccs.DisplayData;
c.setDisplay(a);c.setDisplayData(e)}b===this._displayIndex&&(this._displayIndex=-1,this.changeDisplayWithIndex(b,!1))},_addDisplayOther:function(a,b){var c=null;if(b instanceof ccs.Skin){b.setBone(this._bone);c=new ccs.SpriteDisplayData;c.displayName=b.getDisplayName();ccs.displayFactory.initSpriteDisplay(this._bone,a,b.getDisplayName(),b);var d=a.getDisplayData();if(d instanceof ccs.SpriteDisplayData)b.setSkinData(d.skinData);else{for(var d=!1,e=this._decoDisplayList.length-2;0<=e;e--){var f=this._decoDisplayList[e].getDisplayData();
if(f){d=!0;b.setSkinData(f.skinData);c.skinData=f.skinData;break}}d||b.setSkinData(new ccs.BaseData);b.setSkinData(new ccs.BaseData)}}else b instanceof cc.ParticleSystem?(c=new ccs.ParticleDisplayData,c.displayName=b._plistFile):b instanceof ccs.Armature?(c=new ccs.ArmatureDisplayData,c.displayName=b.getName(),b.setParentBone(this._bone)):c=new ccs.DisplayData;a.setDisplay(b);a.setDisplayData(c)},removeDisplay:function(a){this._decoDisplayList.splice(a,1);a===this._displayIndex&&(this.setCurrentDecorativeDisplay(null),
this._displayIndex=-1)},getDecorativeDisplayList:function(){return this._decoDisplayList},changeDisplayWithIndex:function(a,b){a>=this._decoDisplayList.length?cc.log("the index value is out of range"):(this._forceChangeDisplay=b,this._displayIndex!==a&&(this._displayIndex=a,0>a?this._displayRenderNode&&(this._displayRenderNode.removeFromParent(!0),this.setCurrentDecorativeDisplay(null)):this.setCurrentDecorativeDisplay(this._decoDisplayList[a])))},changeDisplayWithName:function(a,b){for(var c=this._decoDisplayList,
d=0;d<c.length;d++)if(c[d].getDisplayData().displayName===a){this.changeDisplayWithIndex(d,b);break}},setCurrentDecorativeDisplay:function(a){var b=this._currentDecoDisplay;(ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT||ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX)&&b&&b.getColliderDetector()&&b.getColliderDetector().setActive(!1);b=this._currentDecoDisplay=a;(ccs.ENABLE_PHYSICS_CHIPMUNK_DETECT||ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX)&&b&&b.getColliderDetector()&&b.getColliderDetector().setActive(!0);a=b?b.getDisplay():
null;var b=this._displayRenderNode,c=this._bone;b&&(b instanceof ccs.Armature&&c.setChildArmature(null),b.removeFromParent(!0));(this._displayRenderNode=a)?(a instanceof ccs.Armature?(this._bone.setChildArmature(a),a.setParentBone(this._bone)):a instanceof cc.ParticleSystem&&(a instanceof ccs.Armature?(c.setChildArmature(a),a.setParentBone(c)):a instanceof cc.ParticleSystem&&a.resetSystem()),a.setColor(c.getDisplayedColor()),a.setOpacity(c.getDisplayedOpacity()),this._displayRenderNode.setVisible(this._visible),
this._displayType=this._currentDecoDisplay.getDisplayData().displayType):this._displayType=ccs.DISPLAY_TYPE_MAX;cc.renderer.childrenOrderDirty=!0},getDisplayRenderNode:function(){return this._displayRenderNode},getDisplayRenderNodeType:function(){return this._displayType},getCurrentDisplayIndex:function(){return this._displayIndex},getCurrentDecorativeDisplay:function(){return this._currentDecoDisplay},getDecorativeDisplayByIndex:function(a){return this._decoDisplayList[a]},initDisplayList:function(a){this._decoDisplayList.length=
0;if(a){a=a.displayDataList;for(var b=this._decoDisplayList,c=this._bone,d=0;d<a.length;d++){var e=a[d],f=new ccs.DecorativeDisplay;f.setDisplayData(e);ccs.displayFactory.createDisplay(c,f);b.push(f)}}},containPoint:function(a,b){if(!this._visible||0>this._displayIndex)return!1;void 0!==b&&(a=cc.p(a,b));if(this._currentDecoDisplay.getDisplayData().displayType===ccs.DISPLAY_TYPE_SPRITE){var c=this._currentDecoDisplay.getDisplay(),c=c.getChildByTag(0);return ccs.SPRITE_CONTAIN_POINT_WITH_RETURN(c,a)}return!1},
setVisible:function(a){this._displayRenderNode&&(this._visible=a,this._displayRenderNode.setVisible(a))},isVisible:function(){return this._visible},getContentSize:function(){return this._displayRenderNode?this._displayRenderNode.getContentSize():cc.size(0,0)},getBoundingBox:function(){return this._displayRenderNode?this._displayRenderNode.getBoundingBox():cc.rect(0,0,0,0)},getAnchorPoint:function(){return this._displayRenderNode?this._displayRenderNode.getAnchorPoint():cc.p(0,0)},getAnchorPointInPoints:function(){return this._displayRenderNode?
this._displayRenderNode.getAnchorPointInPoints():cc.p(0,0)},getForceChangeDisplay:function(){return this._forceChangeDisplay},release:function(){this._decoDisplayList=null;this._displayRenderNode&&(this._displayRenderNode.removeFromParent(!0),this._displayRenderNode=null)}});ccs.DisplayManager.create=function(a){return new ccs.DisplayManager(a)};ccs.Skin=ccs.Sprite.extend({_skinData:null,bone:null,_skinTransform:null,_displayName:"",_armature:null,_className:"Skin",ctor:function(a,b){cc.Sprite.prototype.ctor.call(this);this.bone=this._skinData=null;this._displayName="";this._skinTransform=cc.affineTransformIdentity();this._armature=null;null==a||""===a?ccs.Skin.prototype.init.call(this):"#"===a[0]?ccs.Skin.prototype.initWithSpriteFrameName.call(this,a.substr(1)):ccs.Skin.prototype.initWithFile.call(this,a,b)},initWithSpriteFrameName:function(a){if(""===
a)return!1;var b=cc.spriteFrameCache.getSpriteFrame(a),c=!0;b?this.initWithSpriteFrame(b):(cc.log("Can't find CCSpriteFrame with %s. Please check your .plist file",a),c=!1);this._displayName=a;return c},initWithFile:function(a,b){var c=b?cc.Sprite.prototype.initWithFile.call(this,a,b):cc.Sprite.prototype.initWithFile.call(this,a);this._displayName=a;return c},setSkinData:function(a){this._skinData=a;this.setScaleX(a.scaleX);this.setScaleY(a.scaleY);this.setRotationX(cc.radiansToDegrees(a.skewX));
this.setRotationY(cc.radiansToDegrees(-a.skewY));this.setPosition(a.x,a.y);this._renderCmd.transform()},getSkinData:function(){return this._skinData},updateArmatureTransform:function(){this._renderCmd.transform()},getNodeToWorldTransform:function(){return this._renderCmd.getNodeToWorldTransform()},getNodeToWorldTransformAR:function(){return this._renderCmd.getNodeToWorldTransformAR()},setBone:function(a){this.bone=a;if(a=this.bone.getArmature())this._armature=a},getBone:function(){return this.bone},
getDisplayName:function(){return this._displayName},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new ccs.Skin.CanvasRenderCmd(this):new ccs.Skin.WebGLRenderCmd(this)}});_p=ccs.Skin.prototype;cc.defineGetterSetter(_p,"skinData",_p.getSkinData,_p.setSkinData);cc.defineGetterSetter(_p,"displayName",_p.getDisplayName);_p=null;ccs.Skin.create=function(a,b){return new ccs.Skin(a,b)};ccs.Skin.createWithSpriteFrameName=function(a){return new ccs.Skin("#"+a)};(function(){ccs.Skin.RenderCmd={_realWorldTM:null,transform:function(a,c){this._transform||(this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0});var d=this._node,e=a?a._worldTransform:null,f=this._transform,g=this._worldTransform;if(this._dirtyFlag&cc.Node._dirtyFlags.transformDirty||e)this.originTransform(),cc.affineTransformConcatIn(this._transform,d.bone.getNodeToArmatureTransform()),this._dirtyFlag&=~cc.Node._dirtyFlags.transformDirty;if(e){if(g.a=f.a*
e.a+f.b*e.c,g.b=f.a*e.b+f.b*e.d,g.c=f.c*e.a+f.d*e.c,g.d=f.c*e.b+f.d*e.d,g.tx=f.tx*e.a+f.ty*e.c+e.tx,g.ty=f.tx*e.b+f.ty*e.d+e.ty,e=this._vertices){var h=d._offsetPosition.x,k=h+d._rect.width,m=d._offsetPosition.y,d=m+d._rect.height;e[0].x=h*g.a+d*g.c+g.tx;e[0].y=h*g.b+d*g.d+g.ty;e[1].x=h*g.a+m*g.c+g.tx;e[1].y=h*g.b+m*g.d+g.ty;e[2].x=k*g.a+d*g.c+g.tx;e[2].y=k*g.b+d*g.d+g.ty;e[3].x=k*g.a+m*g.c+g.tx;e[3].y=k*g.b+m*g.d+g.ty}}else g.a=f.a,g.b=f.b,g.c=f.c,g.d=f.d,g.tx=f.tx,g.ty=f.ty;if(g=this._realWorldTM)g.a=
f.a,g.b=f.b,g.c=f.c,g.d=f.d,g.tx=f.tx,g.ty=f.ty,cc.affineTransformConcatIn(g,this._node.bone.getArmature()._renderCmd._worldTransform)},getNodeToWorldTransform:function(){return cc.affineTransformConcat(this._transform,this._node.bone.getArmature().getNodeToWorldTransform())},getNodeToWorldTransformAR:function(){var a=this._transform,c=this._node;this._anchorPointInPoints=cc.pointApplyAffineTransform(this._anchorPointInPoints,a);a.tx=this._anchorPointInPoints.x;a.ty=this._anchorPointInPoints.y;return cc.affineTransformConcat(a,
c.bone.getArmature().getNodeToWorldTransform())}};ccs.Skin.CanvasRenderCmd=function(a){this._spriteCmdCtor(a);this._realWorldTM={a:1,b:0,c:0,d:1,tx:0,ty:0}};var a=ccs.Skin.CanvasRenderCmd.prototype=Object.create(cc.Sprite.CanvasRenderCmd.prototype);cc.inject(ccs.Skin.RenderCmd,a);a.constructor=ccs.Skin.CanvasRenderCmd;a._updateCurrentRegions=function(){var a=this._currentRegion;this._currentRegion=this._oldRegion;this._oldRegion=a;cc.Node.CanvasRenderCmd.RegionStatus.DirtyDouble!==this._regionFlag||
this._currentRegion.isEmpty()||this._oldRegion.union(this._currentRegion);this._currentRegion.updateRegion(this.getLocalBB(),this._realWorldTM)};ccs.Skin.WebGLRenderCmd=function(a){this._spriteCmdCtor(a)};a=ccs.Skin.WebGLRenderCmd.prototype=Object.create(cc.Sprite.WebGLRenderCmd.prototype);cc.inject(ccs.Skin.RenderCmd,a);a.constructor=ccs.Skin.WebGLRenderCmd})();ccs.ANIMATION_TYPE_SINGLE_FRAME=-4;ccs.ANIMATION_TYPE_NO_LOOP=-3;ccs.ANIMATION_TYPE_TO_LOOP_FRONT=-2;ccs.ANIMATION_TYPE_TO_LOOP_BACK=-1;ccs.ANIMATION_TYPE_LOOP_FRONT=0;ccs.ANIMATION_TYPE_LOOP_BACK=1;ccs.ANIMATION_TYPE_MAX=2;
ccs.ProcessBase=ccs.Class.extend({_processScale:1,_isComplete:!0,_isPause:!0,_isPlaying:!1,_currentPercent:0,_rawDuration:0,_loopType:0,_tweenEasing:0,animationInternal:null,_currentFrame:0,_durationTween:0,_nextFrameIndex:0,_curFrameIndex:null,_isLoopBack:!1,ctor:function(){this._processScale=1;this._isPause=this._isComplete=!0;this._isPlaying=!1;this._rawDuration=this._durationTween=this._currentPercent=this._currentFrame=0;this._loopType=ccs.ANIMATION_TYPE_LOOP_BACK;this._tweenEasing=ccs.TweenType.LINEAR;
this.animationInternal=1/60;this._durationTween=this._curFrameIndex=0;this._isLoopBack=!1},pause:function(){this._isPause=!0;this._isPlaying=!1},resume:function(){this._isPause=!1;this._isPlaying=!0},stop:function(){this._isComplete=!0;this._isPlaying=!1},play:function(a,b,c,d){this._isPause=this._isComplete=!1;this._isPlaying=!0;this._currentFrame=0;this._nextFrameIndex=a;this._tweenEasing=d},update:function(a){if(!(this._isComplete||this._isPause||0>=this._rawDuration||1<a)){var b=void 0===this._nextFrameIndex?
0:this._nextFrameIndex,c=this._currentFrame;0>=b?(this._currentPercent=1,c=0):(c+=a/this.animationInternal*this._processScale,this._currentPercent=c/b,c=ccs.fmodf(c,b));this._currentFrame=c;this.updateHandler()}},gotoFrame:function(a){var b=this._loopType;b===ccs.ANIMATION_TYPE_NO_LOOP?b=ccs.ANIMATION_TYPE_MAX:b===ccs.ANIMATION_TYPE_TO_LOOP_FRONT&&(b=ccs.ANIMATION_TYPE_LOOP_FRONT);this._loopType=b;this._curFrameIndex=a;this._nextFrameIndex=this._durationTween},getCurrentFrameIndex:function(){return this._curFrameIndex=
(this._rawDuration-1)*this._currentPercent},updateHandler:function(){},isPause:function(){return this._isPause},isComplete:function(){return this._isComplete},getCurrentPercent:function(){return this._currentPercent},getRawDuration:function(){return this._rawDuration},getLoop:function(){return this._loopType},getTweenEasing:function(){return this._tweenEasing},getAnimationInternal:function(){return this.animationInternal},setAnimationInternal:function(a){this.animationInternal=a},getProcessScale:function(){return this._processScale},
setProcessScale:function(a){this._processScale=a},isPlaying:function(){return this._isPlaying}});_p=ccs.ProcessBase.prototype;cc.defineGetterSetter(_p,"currentFrameIndex",_p.getCurrentFrameIndex);cc.defineGetterSetter(_p,"paused",_p.isPause);cc.defineGetterSetter(_p,"completed",_p.isComplete);cc.defineGetterSetter(_p,"currentPercent",_p.getCurrentPercent);cc.defineGetterSetter(_p,"rawDuration",_p.getRawDuration);cc.defineGetterSetter(_p,"loop",_p.getLoop);cc.defineGetterSetter(_p,"tweenEasing",_p.getTweenEasing);
cc.defineGetterSetter(_p,"playing",_p.isPlaying);_p=null;ccs.MovementEventType={start:0,complete:1,loopComplete:2};ccs.AnimationEvent=ccs.Class.extend({_arguments:null,_callFunc:null,_selectorTarget:null,ctor:function(a,b,c){this._data=c;this._callFunc=a;this._selectorTarget=b},call:function(){this._callFunc&&this._callFunc.apply(this._selectorTarget,this._arguments)},setArguments:function(a){this._arguments=a}});ccs.MovementEvent=function(){this.armature=null;this.movementType=ccs.MovementEventType.start;this.movementID=""};
ccs.FrameEvent=function(){this.bone=null;this.frameEventName="";this.currentFrameIndex=this.originFrameIndex=0};
ccs.ArmatureAnimation=ccs.ProcessBase.extend({_animationData:null,_movementData:null,_armature:null,_movementID:"",_toIndex:0,_tweenList:null,_speedScale:1,_ignoreFrameEvent:!1,_frameEventQueue:null,_movementEventQueue:null,_movementList:null,_onMovementList:!1,_movementListLoop:!1,_movementIndex:0,_movementListDurationTo:-1,_movementEventCallFunc:null,_frameEventCallFunc:null,_movementEventTarget:null,_frameEventTarget:null,_movementEventListener:null,_frameEventListener:null,ctor:function(a){ccs.ProcessBase.prototype.ctor.call(this);
this._tweenList=[];this._movementList=[];this._frameEventQueue=[];this._movementEventQueue=[];this._armature=null;a&&ccs.ArmatureAnimation.prototype.init.call(this,a)},init:function(a){this._armature=a;this._tweenList.length=0;return!0},pause:function(){for(var a=this._tweenList,b=0;b<a.length;b++)a[b].pause();ccs.ProcessBase.prototype.pause.call(this)},resume:function(){for(var a=this._tweenList,b=0;b<a.length;b++)a[b].resume();ccs.ProcessBase.prototype.resume.call(this)},stop:function(){for(var a=
this._tweenList,b=0;b<a.length;b++)a[b].stop();a.length=0;ccs.ProcessBase.prototype.stop.call(this)},setAnimationScale:function(a){this.setSpeedScale(a)},getAnimationScale:function(){return this.getSpeedScale()},setSpeedScale:function(a){if(a!==this._speedScale){this._speedScale=a;this._processScale=this._movementData?this._speedScale*this._movementData.scale:this._speedScale;a=this._armature.getBoneDic();for(var b in a){var c=a[b];c.getTween().setProcessScale(this._processScale);c.getChildArmature()&&
c.getChildArmature().getAnimation().setSpeedScale(this._processScale)}}},getSpeedScale:function(){return this._speedScale},play:function(a,b,c){cc.assert(this._animationData,"this.animationData can not be null");this._movementData=this._animationData.getMovement(a);cc.assert(this._movementData,"this._movementData can not be null");b=void 0===b?-1:b;c=void 0===c?-1:c;this._rawDuration=this._movementData.duration;this._movementID=a;this._processScale=this._speedScale*this._movementData.scale;b=-1===
b?this._movementData.durationTo:b;a=0===this._movementData.durationTween?this._rawDuration:this._movementData.durationTween;var d=this._movementData.tweenEasing;c=0>c?this._movementData.loop:c;this._onMovementList=!1;ccs.ProcessBase.prototype.play.call(this,b,a,c,d);0===this._rawDuration?this._loopType=ccs.ANIMATION_TYPE_SINGLE_FRAME:(this._loopType=c?ccs.ANIMATION_TYPE_TO_LOOP_FRONT:ccs.ANIMATION_TYPE_NO_LOOP,this._durationTween=a);this._tweenList.length=0;var e,f=this._armature.getBoneDic(),g;for(g in f){var h=
f[g];e=this._movementData.movBoneDataDic[h.getName()];var k=h.getTween();e&&0<e.frameList.length?(this._tweenList.push(k),e.duration=this._movementData.duration,k.play(e,b,a,c,d),k.setProcessScale(this._processScale),h.getChildArmature()&&(h.getChildArmature().getAnimation().setSpeedScale(this._processScale),h.getChildArmature().getAnimation().isPlaying()||h.getChildArmature().getAnimation().playWithIndex(0))):h.isIgnoreMovementBoneData()||(h.getDisplayManager().changeDisplayWithIndex(-1,!1),k.stop())}this._armature.update(0)},
playByIndex:function(a,b,c,d,e){cc.log("playByIndex is deprecated. Use playWithIndex instead.");this.playWithIndex(a,b,d)},playWithIndex:function(a,b,c){var d=this._animationData.movementNames;cc.assert(-1<a&&a<d.length);this.play(d[a],b,c)},playWithNames:function(a,b,c){this._movementListLoop=void 0===c?!0:c;this._movementListDurationTo=void 0===b?-1:b;this._onMovementList=!0;this._movementIndex=0;a instanceof Array?this._movementList=a:this._movementList.length=0;this.updateMovementList()},playWithIndexes:function(a,
b,c){this._movementList.length=0;this._movementListLoop=void 0===c?!0:c;this._movementListDurationTo=void 0===b?-1:b;this._onMovementList=!0;this._movementIndex=0;b=this._animationData.movementNames;for(c=0;c<a.length;c++)this._movementList.push(b[a[c]]);this.updateMovementList()},gotoAndPlay:function(a){if(!this._movementData||0>a||a>=this._movementData.duration)cc.log("Please ensure you have played a movement, and the frameIndex is in the range.");else{var b=this._ignoreFrameEvent;this._isPlaying=
this._ignoreFrameEvent=!0;this._isComplete=this._isPause=!1;ccs.ProcessBase.prototype.gotoFrame.call(this,a);this._currentPercent=this._curFrameIndex/(this._movementData.duration-1);this._currentFrame=this._nextFrameIndex*this._currentPercent;for(var c=this._tweenList,d=0;d<c.length;d++)c[d].gotoAndPlay(a);this._armature.update(0);this._ignoreFrameEvent=b}},gotoAndPause:function(a){this.gotoAndPlay(a);this.pause()},getMovementCount:function(){return this._animationData.getMovementCount()},update:function(a){ccs.ProcessBase.prototype.update.call(this,
a);for(var b=this._tweenList,c=0;c<b.length;c++)b[c].update(a);for(b=this._frameEventQueue;0<b.length;)a=b.shift(),this._ignoreFrameEvent=!0,this._frameEventCallFunc&&this._frameEventCallFunc.call(this._frameEventTarget,a.bone,a.frameEventName,a.originFrameIndex,a.currentFrameIndex),this._frameEventListener&&this._frameEventListener(a.bone,a.frameEventName,a.originFrameIndex,a.currentFrameIndex),this._ignoreFrameEvent=!1;for(b=this._movementEventQueue;0<b.length;)a=b.shift(),this._movementEventCallFunc&&
this._movementEventCallFunc.call(this._movementEventTarget,a.armature,a.movementType,a.movementID),this._movementEventListener&&this._movementEventListener(a.armature,a.movementType,a.movementID)},updateHandler:function(){var a=this._currentPercent;if(1<=a){switch(this._loopType){case ccs.ANIMATION_TYPE_NO_LOOP:this._loopType=ccs.ANIMATION_TYPE_MAX;this._currentFrame=(a-1)*this._nextFrameIndex;a=this._currentFrame/this._durationTween;if(1>a){this._nextFrameIndex=this._durationTween;this.movementEvent(this._armature,
ccs.MovementEventType.start,this._movementID);break}break;case ccs.ANIMATION_TYPE_MAX:case ccs.ANIMATION_TYPE_SINGLE_FRAME:a=1;this._isComplete=!0;this._isPlaying=!1;this.movementEvent(this._armature,ccs.MovementEventType.complete,this._movementID);this.updateMovementList();break;case ccs.ANIMATION_TYPE_TO_LOOP_FRONT:this._loopType=ccs.ANIMATION_TYPE_LOOP_FRONT;a=ccs.fmodf(a,1);this._currentFrame=0===this._nextFrameIndex?0:ccs.fmodf(this._currentFrame,this._nextFrameIndex);this._nextFrameIndex=0<
this._durationTween?this._durationTween:1;this.movementEvent(this,ccs.MovementEventType.start,this._movementID);break;default:this._currentFrame=ccs.fmodf(this._currentFrame,this._nextFrameIndex),this._toIndex=0,this.movementEvent(this._armature,ccs.MovementEventType.loopComplete,this._movementID)}this._currentPercent=a}},getCurrentMovementID:function(){return this._isComplete?"":this._movementID},setMovementEventCallFunc:function(a,b){1===arguments.length?this._movementEventListener=a:2===arguments.length&&
(this._movementEventTarget=b,this._movementEventCallFunc=a)},setFrameEventCallFunc:function(a,b){1===arguments.length?this._frameEventListener=a:2===arguments.length&&(this._frameEventTarget=b,this._frameEventCallFunc=a)},setUserObject:function(a){this._userObject=a},frameEvent:function(a,b,c,d){if(this._frameEventTarget&&this._frameEventCallFunc||this._frameEventListener){var e=new ccs.FrameEvent;e.bone=a;e.frameEventName=b;e.originFrameIndex=c;e.currentFrameIndex=d;this._frameEventQueue.push(e)}},
movementEvent:function(a,b,c){if(this._movementEventTarget&&this._movementEventCallFunc||this._movementEventListener){var d=new ccs.MovementEvent;d.armature=a;d.movementType=b;d.movementID=c;this._movementEventQueue.push(d)}},updateMovementList:function(){if(this._onMovementList){var a,b=this._movementList;this._movementListLoop?(a=b[this._movementIndex],this.play(a,a.durationTo,0),this._movementIndex++,this._movementIndex>=b.length&&(this._movementIndex=0)):this._movementIndex<b.length?(a=b[this._movementIndex],
this.play(a,a.durationTo,0),this._movementIndex++):this._onMovementList=!1;this._onMovementList=!0}},setAnimationData:function(a){this._animationData!==a&&(this._animationData=a)},getAnimationData:function(){return this._animationData},getUserObject:function(){return this._userObject},isIgnoreFrameEvent:function(){return this._ignoreFrameEvent}});_p=ccs.ArmatureAnimation.prototype;cc.defineGetterSetter(_p,"speedScale",_p.getSpeedScale,_p.setSpeedScale);
cc.defineGetterSetter(_p,"animationScale",_p.getAnimationScale,_p.setAnimationScale);_p=null;ccs.ArmatureAnimation.create=function(a){return new ccs.ArmatureAnimation(a)};ccs.Tween=ccs.ProcessBase.extend({_tweenData:null,_to:null,_from:null,_between:null,_movementBoneData:null,_bone:null,_frameTweenEasing:0,_betweenDuration:0,_totalDuration:0,_toIndex:0,_fromIndex:0,_animation:null,_passLastFrame:!1,ctor:function(a){ccs.ProcessBase.prototype.ctor.call(this);this._frameTweenEasing=ccs.TweenType.LINEAR;ccs.Tween.prototype.init.call(this,a)},init:function(a){this._from=new ccs.FrameData;this._between=new ccs.FrameData;this._bone=a;this._tweenData=this._bone.getTweenData();
this._tweenData.displayIndex=-1;this._animation=null!==this._bone&&null!==this._bone.getArmature()?this._bone.getArmature().getAnimation():null;return!0},play:function(a,b,c,d,e){ccs.ProcessBase.prototype.play.call(this,b,c,d,e);this._loopType=d?ccs.ANIMATION_TYPE_TO_LOOP_FRONT:ccs.ANIMATION_TYPE_NO_LOOP;this._fromIndex=this._toIndex=this._betweenDuration=this._totalDuration=0;e=a!==this._movementBoneData;this.setMovementBoneData(a);this._rawDuration=this._movementBoneData.duration;a=this._movementBoneData.getFrameData(0);
this._tweenData.displayIndex=a.displayIndex;this._bone.getArmature().getArmatureData().dataVersion>=ccs.CONST_VERSION_COMBINED&&(ccs.TransformHelp.nodeSub(this._tweenData,this._bone.getBoneData()),this._tweenData.scaleX+=1,this._tweenData.scaleY+=1);0===this._rawDuration?(this._loopType=ccs.ANIMATION_TYPE_SINGLE_FRAME,0===b?this.setBetween(a,a):this.setBetween(this._tweenData,a),this._frameTweenEasing=ccs.TweenType.LINEAR):1<this._movementBoneData.frameList.length&&(this._durationTween=c*this._movementBoneData.scale,
d&&0!==this._movementBoneData.delay?this.setBetween(this._tweenData,this.tweenNodeTo(this.updateFrameData(1-this._movementBoneData.delay),this._between)):e&&0!==b?this.setBetween(this._tweenData,a):this.setBetween(a,a));this.tweenNodeTo(0)},gotoAndPlay:function(a){ccs.ProcessBase.prototype.gotoFrame.call(this,a);this._fromIndex=this._toIndex=this._betweenDuration=this._totalDuration=0;this._isPlaying=!0;this._isComplete=this._isPause=!1;this._currentPercent=this._curFrameIndex/(this._rawDuration-
1);this._currentFrame=this._nextFrameIndex*this._currentPercent},gotoAndPause:function(a){this.gotoAndPlay(a);this.pause()},updateHandler:function(){var a=null==this._currentPercent?1:this._currentPercent,b=this._loopType;if(1<=a)switch(b){case ccs.ANIMATION_TYPE_SINGLE_FRAME:a=1;this._isComplete=!0;this._isPlaying=!1;break;case ccs.ANIMATION_TYPE_NO_LOOP:b=ccs.ANIMATION_TYPE_MAX;a=0>=this._durationTween?1:(a-1)*this._nextFrameIndex/this._durationTween;1<=a?(a=1,this._isComplete=!0,this._isPlaying=
!1):(this._nextFrameIndex=this._durationTween,this._currentFrame=a*this._nextFrameIndex,this._fromIndex=this._toIndex=this._betweenDuration=this._totalDuration=0);break;case ccs.ANIMATION_TYPE_TO_LOOP_FRONT:b=ccs.ANIMATION_TYPE_LOOP_FRONT;this._nextFrameIndex=0<this._durationTween?this._durationTween:1;0!==this._movementBoneData.delay?(this._currentFrame=(1-this._movementBoneData.delay)*this._nextFrameIndex,a=this._currentFrame/this._nextFrameIndex):this._currentFrame=a=0;this._fromIndex=this._toIndex=
this._betweenDuration=this._totalDuration=0;break;case ccs.ANIMATION_TYPE_MAX:a=1;this._isComplete=!0;this._isPlaying=!1;break;default:this._currentFrame=ccs.fmodf(this._currentFrame,this._nextFrameIndex)}1>a&&b<ccs.ANIMATION_TYPE_TO_LOOP_BACK&&(a=Math.sin(a*cc.PI/2));this._currentPercent=a;this._loopType=b;b>ccs.ANIMATION_TYPE_TO_LOOP_BACK&&(a=this.updateFrameData(a));this._frameTweenEasing!==ccs.TweenType.TWEEN_EASING_MAX&&this.tweenNodeTo(a)},setBetween:function(a,b,c){void 0===c&&(c=!0);0>a.displayIndex&&
0<=b.displayIndex?(this._from.copy(b),this._between.subtract(b,b,c)):0>b.displayIndex&&0<=a.displayIndex?(this._from.copy(a),this._between.subtract(b,b,c)):(this._from.copy(a),this._between.subtract(a,b,c));a.isTween||(this._tweenData.copy(a),this._tweenData.isTween=!0);this.arriveKeyFrame(a)},arriveKeyFrame:function(a){if(a){var b=this._bone,c=b.getDisplayManager(),d=a.displayIndex;c.getForceChangeDisplay()||c.changeDisplayWithIndex(d,!1);this._tweenData.zOrder=a.zOrder;b.updateZOrder();this._bone.setBlendFunc(a.blendFunc);
(b=b.getChildArmature())&&""!==a.movement&&b.getAnimation().play(a.movement)}},tweenNodeTo:function(a,b){b||(b=this._tweenData);var c=this._from,d=this._between;c.isTween||(a=0);b.x=c.x+a*d.x;b.y=c.y+a*d.y;b.scaleX=c.scaleX+a*d.scaleX;b.scaleY=c.scaleY+a*d.scaleY;b.skewX=c.skewX+a*d.skewX;b.skewY=c.skewY+a*d.skewY;this._bone.setTransformDirty(!0);b&&d.isUseColorInfo&&this.tweenColorTo(a,b);return b},tweenColorTo:function(a,b){var c=this._from,d=this._between;b.a=c.a+a*d.a;b.r=c.r+a*d.r;b.g=c.g+a*
d.g;b.b=c.b+a*d.b;this._bone.updateColor()},updateFrameData:function(a){1<a&&0!==this._movementBoneData.delay&&(a=ccs.fmodf(a,1));a*=this._rawDuration-1;var b,c,d=this._totalDuration,e=this._betweenDuration,f=this._toIndex;if(a<d||a>=d+e){var e=this._movementBoneData.frameList,g=e.length;if(a<e[0].frameID)return b=c=e[0],this.setBetween(b,c),this._currentPercent;if(a>=e[g-1].frameID){if(this._passLastFrame)return b=c=e[g-1],this.setBetween(b,c),this._currentPercent;this._passLastFrame=!0}else this._passLastFrame=
!1;do if(this._fromIndex=f,b=e[this._fromIndex],d=b.frameID,f=this._fromIndex+1,f>=g&&(f=0),c=e[f],b.strEvent&&!this._animation.isIgnoreFrameEvent()&&this._animation.frameEvent(this._bone,b.strEvent,b.frameID,a),a===b.frameID||this._passLastFrame&&this._fromIndex===g-1)break;while(a<b.frameID||a>=c.frameID);e=c.frameID-b.frameID;this._frameTweenEasing=b.tweenEasing;this.setBetween(b,c,!1);this._totalDuration=d;this._betweenDuration=e;this._toIndex=f}a=0===e?0:(a-this._totalDuration)/this._betweenDuration;
b=this._frameTweenEasing!==ccs.TweenType.LINEAR?this._frameTweenEasing:this._tweenEasing;b===ccs.TweenType.TWEEN_EASING_MAX||b===ccs.TweenType.LINEAR||this._passLastFrame||(a=ccs.TweenFunction.tweenTo(a,b,this._from.easingParams));return a},setAnimation:function(a){this._animation=a},getAnimation:function(){return this._animation},setMovementBoneData:function(a){this._movementBoneData=a}});_p=ccs.Tween.prototype;cc.defineGetterSetter(_p,"animation",_p.getAnimation,_p.setAnimation);_p=null;
ccs.Tween.create=function(a){return new ccs.Tween(a)};ccs.PT_RATIO=32;ccs.ColliderFilter=ccs.Class.extend({_collisionType:0,_group:0,_categoryBits:0,_groupIndex:0,_maskBits:0,ctor:function(a,b){this._collisionType=a||0;this._group=b||0},updateShape:function(a){if(a instanceof cp.Shape)a.collision_type=this._collisionType,a.group=this._group;else if(a instanceof Box2D.b2FilterData){var b=new Box2D.b2FilterData;b.categoryBits=this._categoryBits;b.groupIndex=this._groupIndex;b.maskBits=this._maskBits;a.SetFilterData(b)}}});
ccs.ColliderBody=ccs.Class.extend({shape:null,coutourData:null,colliderFilter:null,_calculatedVertexList:null,ctor:function(a){this.shape=null;this.coutourData=a;this.colliderFilter=new ccs.ColliderFilter;ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX&&(this._calculatedVertexList=[])},getContourData:function(){return this.coutourData},setColliderFilter:function(a){this.colliderFilter=a},getCalculatedVertexList:function(){return this._calculatedVertexList},setB2Fixture:function(a){this._fixture=a},getB2Fixture:function(){return this._fixture},
setShape:function(a){this.shape=a},getShape:function(){return this.shape},setContourData:function(a){this.coutourData=a},getColliderFilter:function(){return this.colliderFilter}});
ccs.ColliderDetector=ccs.Class.extend({_colliderBodyList:null,_bone:null,_body:null,_active:!1,_filter:null,helpPoint:cc.p(0,0),ctor:function(a){this._colliderBodyList=[];this._body=this._bone=null;this._active=!1;this._filter=null;ccs.ColliderDetector.prototype.init.call(this,a)},init:function(a){this._colliderBodyList.length=0;a&&(this._bone=a);this._filter=new ccs.ColliderFilter;return!0},addContourData:function(a){var b=new ccs.ColliderBody(a);this._colliderBodyList.push(b);if(ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX){b=
b.getCalculatedVertexList();a=a.vertexList;for(var c=0;c<a.length;c++){var d=new ccs.ContourVertex2(0,0);b.push(d)}}},addContourDataList:function(a){for(var b=0;b<a.length;b++)this.addContourData(a[b])},removeContourData:function(a){var b=[],c,d=this._colliderBodyList;for(c=0;c<d.length;c++){var e=d[c];e&&e.getContourData()===a&&b.push(e)}for(c=0;c<b.length;c++)cc.arrayRemoveObject(d,b[c])},removeAll:function(){this._colliderBodyList.length=0},setActive:function(a){if(this._active!==a){this._active=
a;a=this._body;var b;if(a)if(b=null,this._active)for(var c=0;c<this._colliderBodyList.length;c++)b=this._colliderBodyList[c],b=b.getShape(),a.space.addShape(b);else for(c=0;c<this._colliderBodyList.length;c++)b=this._colliderBodyList[c],b=b.getShape(),a.space.removeShape(b)}},getActive:function(){return this._active},getColliderBodyList:function(){return this._colliderBodyList},setColliderFilter:function(a){this._filter=a;for(var b=this._colliderBodyList,c=0;c<b.length;c++){var d=b[c];d.setColliderFilter(a);
d.getShape()&&d.getColliderFilter().updateShape(d.getShape())}},getColliderFilter:function(){return this._filter},updateTransform:function(a){if(this._active)for(var b=null,c=this._body,d=this.helpPoint,e=0;e<this._colliderBodyList.length;e++){var b=this._colliderBodyList[e],f=b.getContourData(),g=null;c&&(g=b.getShape());for(var f=f.vertexList,h=b.getCalculatedVertexList(),b=0;b<f.length;b++){d.x=f[b].x;d.y=f[b].y;d=cc.pointApplyAffineTransform(d,a);if(ccs.ENABLE_PHYSICS_SAVE_CALCULATED_VERTEX){var k=
cc.p(0,0);k.x=d.x;k.y=d.y;h[b]=k}g&&(g.verts[2*b]=d.x,g.verts[2*b+1]=d.y)}if(g)for(b=0;b<f.length;b++)h=cp.v.normalize(cp.v.perp(cp.v.sub(g.verts[(b+1)%g.verts.length],g.verts[b]))),g.planes&&(g.planes[b].n=h,g.planes[b].d=cp.v.dot(h,g.verts[b]))}},setBody:function(a){this._body=a;for(var b=this._colliderBodyList,c=0;c<b.length;c++){a=b[c];for(var d=[],e=a.getContourData().vertexList,f=0;f<e.length;f++){var g=e[f];d.push(g.x);d.push(g.y)}d=new cp.PolyShape(this._body,d,cp.vzero);d.sensor=!0;d.data=
this._bone;this._active&&this._body.space.addShape(d);a.setShape(d);a.getColliderFilter().updateShape(d)}},getBody:function(){return this._body}});_p=ccs.ColliderDetector.prototype;cc.defineGetterSetter(_p,"colliderFilter",_p.getColliderFilter,_p.setColliderFilter);cc.defineGetterSetter(_p,"active",_p.getActive,_p.setActive);cc.defineGetterSetter(_p,"body",_p.getBody,_p.setBody);_p=null;ccs.ColliderDetector.create=function(a){return new ccs.ColliderDetector(a)};ccs.Armature=ccs.Node.extend({animation:null,armatureData:null,batchNode:null,_parentBone:null,_boneDic:null,_topBoneList:null,_armatureIndexDic:null,_offsetPoint:null,version:0,_armatureTransformDirty:!0,_body:null,_blendFunc:null,_className:"Armature",ctor:function(a,b){cc.Node.prototype.ctor.call(this);this._name="";this._topBoneList=[];this._armatureIndexDic={};this._offsetPoint=cc.p(0,0);this._armatureTransformDirty=!0;this._blendFunc={src:cc.BLEND_SRC,dst:cc.BLEND_DST};a&&ccs.Armature.prototype.init.call(this,
a,b);this._texture={}},init:function(a,b){b&&(this._parentBone=b);this.removeAllChildren();this.animation=new ccs.ArmatureAnimation;this.animation.init(this);this._boneDic={};this._topBoneList.length=0;var c=ccs.armatureDataManager,d;if(""!==a){d=c.getAnimationData(a);cc.assert(d,"AnimationData not exist!");this.animation.setAnimationData(d);c=c.getArmatureData(a);cc.assert(c,"ArmatureData not exist!");this.armatureData=c;var c=c.getBoneDataDic(),e;for(e in c){var c=this.createBone(String(e)),f=d.getMovement(d.movementNames[0]);
f&&(f=f.getMovementBoneData(c.getName()))&&!(0>=f.frameList.length)&&(f=f.getFrameData(0))&&(c.getTweenData().copy(f),c.changeDisplayWithIndex(f.displayIndex,!1))}this.update(0);this.updateOffsetPoint()}else a="new_armature",this.armatureData=new ccs.ArmatureData,this.armatureData.name=a,d=new ccs.AnimationData,d.name=a,c.addArmatureData(a,this.armatureData),c.addAnimationData(a,d),this.animation.setAnimationData(d);this._renderCmd.initShaderCache();this.setCascadeOpacityEnabled(!0);this.setCascadeColorEnabled(!0);
return!0},visit:function(a){var b=this._renderCmd;a=a?a._renderCmd:null;this._visible?(b.visit(a),b._dirtyFlag=0):b._propagateFlagsDown(a)},addChild:function(a,b,c){a instanceof ccui.Widget?cc.log("Armature doesn't support to add Widget as its child, it will be fix soon."):cc.Node.prototype.addChild.call(this,a,b,c)},createBone:function(a){var b=this.getBone(a);if(b)return b;var b=this.armatureData.getBoneData(a),c=b.parentName,d=null;c?(this.createBone(c),d=new ccs.Bone(a),this.addBone(d,c)):(d=
new ccs.Bone(a),this.addBone(d,""));d.setBoneData(b);d.getDisplayManager().changeDisplayWithIndex(-1,!1);return d},addBone:function(a,b){cc.assert(a,"Argument must be non-nil");var c=this._boneDic;a.getName()&&cc.assert(!c[a.getName()],"bone already added. It can't be added again");if(b){var d=c[b];d?d.addChildBone(a):this._topBoneList.push(a)}else this._topBoneList.push(a);a.setArmature(this);c[a.getName()]=a;this.addChild(a)},removeBone:function(a,b){cc.assert(a,"bone must be added to the bone dictionary!");
a.setArmature(null);a.removeFromParent(b);cc.arrayRemoveObject(this._topBoneList,a);delete this._boneDic[a.getName()];this.removeChild(a,!0)},getBone:function(a){return this._boneDic[a]},changeBoneParent:function(a,b){cc.assert(a,"bone must be added to the bone dictionary!");var c=a.getParentBone();c&&(cc.arrayRemoveObject(c.getChildren(),a),a.setParentBone(null));b&&((c=this._boneDic[b])?(c.addChildBone(a),cc.arrayRemoveObject(this._topBoneList,a)):this._topBoneList.push(a))},getBoneDic:function(){return this._boneDic},
updateOffsetPoint:function(){var a=this.getBoundingBox();this.setContentSize(a);var b=this._offsetPoint;b.x=-a.x;b.y=-a.y;0!==a.width&&0!==a.height&&this.setAnchorPoint(b.x/a.width,b.y/a.height)},getOffsetPoints:function(){return{x:this._offsetPoint.x,y:this._offsetPoint.y}},setAnimation:function(a){this.animation=a},getAnimation:function(){return this.animation},getArmatureTransformDirty:function(){return this._armatureTransformDirty},update:function(a){this.animation.update(a);for(var b=this._topBoneList,
c=0;c<b.length;c++)b[c].update(a);this._armatureTransformDirty=!1},onEnter:function(){cc.Node.prototype.onEnter.call(this);this.scheduleUpdate()},onExit:function(){cc.Node.prototype.onExit.call(this);this.unscheduleUpdate()},getBoundingBox:function(){for(var a,b,c,d=0,e=!0,f=cc.rect(0,0,0,0),g=this._children,h=g.length,k=0;k<h;k++)if(a=g[k])if(d=a.getDisplayManager().getBoundingBox(),0!==d.x||0!==d.y||0!==d.width||0!==d.height)e?(a=d.x,b=d.y,c=d.x+d.width,d=d.y+d.height,e=!1):(a=d.x<f.x?d.x:f.x,b=
d.y<f.y?d.y:f.y,c=d.x+d.width>f.x+f.width?d.x+d.width:f.x+f.width,d=d.y+d.height>f.y+f.height?d.y+d.height:f.y+f.height),f.x=a,f.y=b,f.width=c-a,f.height=d-b;return cc.rectApplyAffineTransform(f,this.getNodeToParentTransform())},getBoneAtPoint:function(a,b){for(var c=this._children,d=c.length-1;0<=d;d--){var e=c[d];if(e instanceof ccs.Bone&&e.getDisplayManager().containPoint(a,b))return e}return null},setParentBone:function(a){this._parentBone=a;a=this._boneDic;for(var b in a)a[b].setArmature(this)},
getParentBone:function(){return this._parentBone},drawContour:function(){cc._drawingUtil.setDrawColor(255,255,255,255);cc._drawingUtil.setLineWidth(1);var a=this._boneDic,b;for(b in a){var c=a[b].getColliderDetector();if(c)for(var c=c.getColliderBodyList(),d=0;d<c.length;d++){var e=c[d].getCalculatedVertexList();cc._drawingUtil.drawPoly(e,e.length,!0)}}},setBody:function(a){if(this._body!==a){this._body=a;this._body.data=this;var b,c;a=this._children;for(var d=0;d<a.length;d++)if(b=a[d],b instanceof
ccs.Bone){b=b.getDisplayManager().getDecorativeDisplayList();for(var e=0;e<b.length;e++)c=b[e],(c=c.getColliderDetector())&&c.setBody(this._body)}}},getShapeList:function(){return this._body?this._body.shapeList:null},getBody:function(){return this._body},setBlendFunc:function(a,b){void 0===b?(this._blendFunc.src=a.src,this._blendFunc.dst=a.dst):(this._blendFunc.src=a,this._blendFunc.dst=b)},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},setColliderFilter:function(a){var b=
this._boneDic,c;for(c in b)b[c].setColliderFilter(a)},getArmatureData:function(){return this.armatureData},setArmatureData:function(a){this.armatureData=a},getBatchNode:function(){return this.batchNode},setBatchNode:function(a){this.batchNode=a},getVersion:function(){return this.version},setVersion:function(a){this.version=a},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new ccs.Armature.CanvasRenderCmd(this):new ccs.Armature.WebGLRenderCmd(this)}});_p=ccs.Armature.prototype;
cc.defineGetterSetter(_p,"parentBone",_p.getParentBone,_p.setParentBone);cc.defineGetterSetter(_p,"body",_p.getBody,_p.setBody);cc.defineGetterSetter(_p,"colliderFilter",null,_p.setColliderFilter);_p=null;ccs.Armature.create=function(a,b){return new ccs.Armature(a,b)};(function(){ccs.Armature.RenderCmd={_updateAnchorPointInPoint:function(){var a=this._node,b=a._contentSize,c=a._anchorPoint,a=a._offsetPoint;this._anchorPointInPoints.x=b.width*c.x-a.x;this._anchorPointInPoints.y=b.height*c.y-a.y;this._realAnchorPointInPoints.x=b.width*c.x;this._realAnchorPointInPoints.y=b.height*c.y;this.setDirtyFlag(cc.Node._dirtyFlags.transformDirty)},getAnchorPointInPoints:function(){return cc.p(this._realAnchorPointInPoints)}}})();
(function(){ccs.Armature.CanvasRenderCmd=function(a){this._rootCtor(a);this._needDraw=!0;this._realAnchorPointInPoints=new cc.Point(0,0);this._canUseDirtyRegion=!0;this._startRenderCmd=new cc.CustomRenderCmd(this,this._startCmdCallback);this._RestoreRenderCmd=new cc.CustomRenderCmd(this,this._RestoreCmdCallback);this._startRenderCmd._canUseDirtyRegion=!0;this._RestoreRenderCmd._canUseDirtyRegion=!0;this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0};this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0}};var a=
ccs.Armature.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);cc.inject(ccs.Armature.RenderCmd,a);a.constructor=ccs.Armature.CanvasRenderCmd;a._startCmdCallback=function(a,c,d){var e=this._node._parent;this.transform(e?e._renderCmd:null);a=a||cc._renderContext;a.save();a._switchToArmatureMode(!0,this._worldTransform,c,d)};a.transform=function(a,c){this.originTransform(a,c);for(var d=this._node._children,e=0,f=d.length;e<f;e++){var g=d[e],h=g._renderCmd;if(g&&g.getDisplayRenderNode){var k=
g.getDisplayRenderNodeType(),m=g.getDisplayRenderNode();if(m&&m._renderCmd){m=m._renderCmd;m.transform(null);k!==ccs.DISPLAY_TYPE_ARMATURE&&k!==ccs.DISPLAY_TYPE_SPRITE&&cc.affineTransformConcatIn(m._worldTransform,g._worldTransform);var k=cc.Node._dirtyFlags,n=m._dirtyFlag,p=h._dirtyFlag,r=p&k.colorDirty,p=p&k.opacityDirty;r&&h._updateDisplayColor(this._displayedColor);p&&h._updateDisplayOpacity(this._displayedOpacity);(r||p)&&h._updateColor();h=g._renderCmd._displayedColor;g=g._renderCmd._displayedOpacity;
r=n&k.colorDirty;p=n&k.opacityDirty;r&&m._updateDisplayColor(h);p&&m._updateDisplayOpacity(g);(r||p)&&m._updateColor()}}}};a._RestoreCmdCallback=function(a){this._cacheDirty=!1;a._switchToArmatureMode(!1);a.restore()};a.initShaderCache=function(){};a.setShaderProgram=function(){};a.updateChildPosition=function(a,c){a.visit()};a.rendering=function(a,c,d){for(var e=this._node._children,f=0,g=e.length;f<g;f++){var h=e[f];if(h&&h.getDisplayRenderNode){var k=h.getDisplayRenderNode();if(null!==k)switch(h._renderCmd._syncStatus(this),
h.getDisplayRenderNodeType()){case ccs.DISPLAY_TYPE_SPRITE:k.visit(h);break;case ccs.DISPLAY_TYPE_ARMATURE:k._renderCmd.rendering(a,c,d);break;default:k.visit(h)}}else h instanceof cc.Node&&this._visitNormalChild(h)}};a._visitNormalChild=function(a){if(a){var c=a._renderCmd;if(a._visible){c._curLevel=this._curLevel+1;var d,e=a._children,f;c._syncStatus(this);c.transform(null);var g=e.length;if(0<g){a.sortAllChildren();for(d=0;d<g;d++)if(f=e[d],0>f._localZOrder)f.visit(a);else break;for(cc.renderer.pushRenderCommand(c);d<
g;d++)e[d].visit(a)}else cc.renderer.pushRenderCommand(c);this._dirtyFlag=0}}};a.visit=function(a){var c=this._node;c._visible&&(this._syncStatus(a),c.sortAllChildren(),cc.renderer.pushRenderCommand(this._startRenderCmd),this.rendering(),cc.renderer.pushRenderCommand(this._RestoreRenderCmd),this._cacheDirty=!1)}})();(function(){ccs.Armature.WebGLRenderCmd=function(a){this._rootCtor(a);this._needDraw=!0;this._parentCmd=null;this._realAnchorPointInPoints=new cc.Point(0,0);this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0};this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0}};var a=ccs.Armature.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.inject(ccs.Armature.RenderCmd,a);a.constructor=ccs.Armature.WebGLRenderCmd;a.uploadData=function(a,c,d){a=this._node;d=this._parentCmd||this;for(var e=a._children,
f=cc.BlendFunc.ALPHA_PREMULTIPLIED,g=cc.BlendFunc.ALPHA_NON_PREMULTIPLIED,h=0,k=e.length;h<k;h++){var m=e[h],n=m._renderCmd;if(m&&m.getDisplayRenderNode){var p=m.getDisplayRenderNode();if(null!==p)switch(c=p._renderCmd,m.getDisplayRenderNodeType()){case ccs.DISPLAY_TYPE_SPRITE:p instanceof ccs.Skin&&(p.setShaderProgram(this._shaderProgram),this._updateColorAndOpacity(c,m),c.transform(d),n=m.getBlendFunc(),n.src!==f.src||n.dst!==f.dst?p.setBlendFunc(m.getBlendFunc()):(m=p.getTexture(),a._blendFunc.src===
f.src&&a._blendFunc.dst===f.dst&&m&&!m.hasPremultipliedAlpha()?p.setBlendFunc(g):p.setBlendFunc(a._blendFunc)),cc.renderer._uploadBufferData(c));break;case ccs.DISPLAY_TYPE_ARMATURE:p.setShaderProgram(this._shaderProgram),this._updateColorAndOpacity(c,m),c._parentCmd=this;default:n._syncStatus(d),c._syncStatus(n),c.uploadData?cc.renderer._uploadBufferData(c):c.rendering&&(cc.renderer._batchRendering(),c.rendering(cc._renderContext))}}else m instanceof cc.Node&&(m.setShaderProgram(this._shaderProgram),
n._syncStatus(d),n.uploadData?cc.renderer._uploadBufferData(n):n.rendering&&(cc.renderer._batchRendering(),n.rendering(cc._renderContext)))}this._parentCmd=null;return 0};a.initShaderCache=function(){this._shaderProgram=cc.shaderCache.programForKey(cc.SHADER_SPRITE_POSITION_TEXTURECOLOR)};a.setShaderProgram=function(a){this._shaderProgram=a};a._updateColorAndOpacity=function(a,c){var d=c._renderCmd._displayedColor,e=c._renderCmd._displayedOpacity,f=cc.Node._dirtyFlags,g=a._dirtyFlag,h=g&f.colorDirty,
f=g&f.opacityDirty;h&&a._updateDisplayColor(d);f&&a._updateDisplayOpacity(e);(h||f)&&a._updateColor()};a.visit=function(a){var c=this._node;if(c._visible){if(a=a||this.getParentRenderCmd())this._curLevel=a._curLevel+1;this._syncStatus(a);c.sortAllChildren();a=cc.renderer;var d=c._children,e,f=d.length;isNaN(c._customZ)&&(c._vertexZ=a.assignedZ,a.assignedZ+=a.assignedZStep);for(e=0;e<f;e++)if(c=d[e],0>c._localZOrder)isNaN(c._customZ)&&(c._vertexZ=a.assignedZ,a.assignedZ+=a.assignedZStep);else break;
for(a.pushRenderCommand(this);e<f;e++)c=d[e],isNaN(c._customZ)&&(c._vertexZ=a.assignedZ,a.assignedZ+=a.assignedZStep);this._dirtyFlag=0}}})();ccs.Bone=ccs.Node.extend({_boneData:null,_armature:null,_childArmature:null,_displayManager:null,ignoreMovementBoneData:!1,_tween:null,_tweenData:null,_parentBone:null,_boneTransformDirty:!1,_worldTransform:null,_blendFunc:null,blendDirty:!1,_worldInfo:null,_armatureParentBone:null,_dataVersion:0,_className:"Bone",ctor:function(a){cc.Node.prototype.ctor.call(this);this._displayManager=this._tween=this._boneData=this._childArmature=this._armature=this._parentBone=this._tweenData=null;this.ignoreMovementBoneData=
!1;this._worldTransform=cc.affineTransformMake(1,0,0,1,0,0);this._boneTransformDirty=!0;this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST);this.blendDirty=!1;this._armatureParentBone=this._worldInfo=null;this._dataVersion=0;ccs.Bone.prototype.init.call(this,a)},init:function(a){a&&(this._name=a);this._tweenData=new ccs.FrameData;this._tween=new ccs.Tween(this);this._displayManager=new ccs.DisplayManager(this);this._worldInfo=new ccs.BaseData;this._boneData=new ccs.BaseData;return!0},setBoneData:function(a){cc.assert(a,
"_boneData must not be null");this._boneData!==a&&(this._boneData=a);this.setName(this._boneData.name);this._localZOrder=this._boneData.zOrder;this._displayManager.initDisplayList(a)},getBoneData:function(){return this._boneData},setArmature:function(a){(this._armature=a)?(this._tween.setAnimation(this._armature.getAnimation()),this._dataVersion=this._armature.getArmatureData().dataVersion,this._armatureParentBone=this._armature.getParentBone()):this._armatureParentBone=null},getArmature:function(){return this._armature},
update:function(a){this._parentBone&&(this._boneTransformDirty=this._boneTransformDirty||this._parentBone.isTransformDirty());this._armatureParentBone&&!this._boneTransformDirty&&(this._boneTransformDirty=this._armatureParentBone.isTransformDirty());if(this._boneTransformDirty){var b=this._tweenData;this._dataVersion>=ccs.CONST_VERSION_COMBINED&&(ccs.TransformHelp.nodeConcat(b,this._boneData),b.scaleX-=1,b.scaleY-=1);var c=this._worldInfo;c.copy(b);c.x=b.x+this._position.x;c.y=b.y+this._position.y;
c.scaleX=b.scaleX*this._scaleX;c.scaleY=b.scaleY*this._scaleY;c.skewX=b.skewX+this._skewX+cc.degreesToRadians(this._rotationX);c.skewY=b.skewY+this._skewY-cc.degreesToRadians(this._rotationY);this._parentBone?this._applyParentTransform(this._parentBone):this._armatureParentBone&&this._applyParentTransform(this._armatureParentBone);ccs.TransformHelp.nodeToMatrix(c,this._worldTransform);this._armatureParentBone&&cc.affineTransformConcatIn(this._worldTransform,this._armature.getNodeToParentTransform())}ccs.displayFactory.updateDisplay(this,
a,this._boneTransformDirty||this._armature.getArmatureTransformDirty());for(b=0;b<this._children.length;b++)this._children[b].update(a);this._boneTransformDirty=!1},_applyParentTransform:function(a){var b=this._worldInfo,c=a._worldTransform;a=a._worldInfo;var d=b.x,e=b.y;b.x=d*c.a+e*c.c+a.x;b.y=d*c.b+e*c.d+a.y;b.scaleX*=a.scaleX;b.scaleY*=a.scaleY;b.skewX+=a.skewX;b.skewY+=a.skewY},setBlendFunc:function(a,b){var c=this._blendFunc,d,e;void 0===b?(d=a.src,e=a.dst):(d=a,e=b);if(c.src!==d||c.dst!==e)c.src=
d,c.dst=e,this.blendDirty=!0},updateColor:function(){var a=this._displayManager.getDisplayRenderNode();if(null!==a){var b=this._renderCmd;a.setColor(cc.color(b._displayedColor.r*this._tweenData.r/255,b._displayedColor.g*this._tweenData.g/255,b._displayedColor.b*this._tweenData.b/255));a.setOpacity(b._displayedOpacity*this._tweenData.a/255)}},updateZOrder:function(){this._armature.getArmatureData().dataVersion>=ccs.CONST_VERSION_COMBINED?this.setLocalZOrder(this._tweenData.zOrder+this._boneData.zOrder):
this.setLocalZOrder(this._tweenData.zOrder)},addChildBone:function(a){cc.assert(a,"Argument must be non-nil");cc.assert(!a.parentBone,"child already added. It can't be added again");0>this._children.indexOf(a)&&(this._children.push(a),a.setParentBone(this))},removeChildBone:function(a,b){if(0<this._children.length&&-1!==this._children.getIndex(a)){if(b)for(var c=a._children,d=0;d<c.length;d++)a.removeChildBone(c[d],b);a.setParentBone(null);a.getDisplayManager().setCurrentDecorativeDisplay(null);cc.arrayRemoveObject(this._children,
a)}},removeFromParent:function(a){this._parentBone&&this._parentBone.removeChildBone(this,a)},setParentBone:function(a){this._parentBone=a},getParentBone:function(){return this._parentBone},setChildArmature:function(a){this._childArmature!==a&&(null==a&&this._childArmature&&this._childArmature.setParentBone(null),this._childArmature=a)},getChildArmature:function(){return this._childArmature},getTween:function(){return this._tween},setLocalZOrder:function(a){this._localZOrder!==a&&cc.Node.prototype.setLocalZOrder.call(this,
a)},getNodeToArmatureTransform:function(){return this._worldTransform},getNodeToWorldTransform:function(){return cc.affineTransformConcat(this._worldTransform,this._armature.getNodeToWorldTransform())},getDisplayRenderNode:function(){return this._displayManager.getDisplayRenderNode()},getDisplayRenderNodeType:function(){return this._displayManager.getDisplayRenderNodeType()},addDisplay:function(a,b){return this._displayManager.addDisplay(a,b||0)},removeDisplay:function(a){this._displayManager.removeDisplay(a)},
changeDisplayByIndex:function(a,b){cc.log("changeDisplayByIndex is deprecated. Use changeDisplayWithIndex instead.");this.changeDisplayWithIndex(a,b)},changeDisplayByName:function(a,b){cc.log("changeDisplayByName is deprecated. Use changeDisplayWithName instead.");this.changeDisplayWithName(a,b)},changeDisplayWithIndex:function(a,b){this._displayManager.changeDisplayWithIndex(a,b)},changeDisplayWithName:function(a,b){this._displayManager.changeDisplayWithName(a,b)},getColliderDetector:function(){var a=
this._displayManager.getCurrentDecorativeDisplay();return a&&(a=a.getColliderDetector())?a:null},setColliderFilter:function(a){for(var b=this._displayManager.getDecorativeDisplayList(),c=0;c<b.length;c++){var d=b[c].getColliderDetector();d&&d.setColliderFilter(a)}},getColliderFilter:function(){var a=this.displayManager.getCurrentDecorativeDisplay();return a&&(a=a.getColliderDetector())?a.getColliderFilter():null},setTransformDirty:function(a){this._boneTransformDirty=a},isTransformDirty:function(){return this._boneTransformDirty},
getDisplayManager:function(){return this._displayManager},setIgnoreMovementBoneData:function(a){this._ignoreMovementBoneData=a},isIgnoreMovementBoneData:function(){return this._ignoreMovementBoneData},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},setBlendDirty:function(a){this._blendDirty=a},isBlendDirty:function(){return this._blendDirty},getTweenData:function(){return this._tweenData},getWorldInfo:function(){return this._worldInfo},getChildrenBone:function(){return this._children},
nodeToArmatureTransform:function(){return this.getNodeToArmatureTransform()},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getColliderBodyList:function(){var a=this.getColliderDetector();return a?a.getColliderBodyList():null},getIgnoreMovementBoneData:function(){return this.isIgnoreMovementBoneData()},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new ccs.Bone.CanvasRenderCmd(this):new ccs.Bone.WebGLRenderCmd(this)}});_p=ccs.Bone.prototype;
cc.defineGetterSetter(_p,"boneData",_p.getBoneData,_p.setBoneData);cc.defineGetterSetter(_p,"armature",_p.getArmature,_p.setArmature);cc.defineGetterSetter(_p,"childArmature",_p.getChildArmature,_p.setChildArmature);cc.defineGetterSetter(_p,"childrenBone",_p.getChildrenBone);cc.defineGetterSetter(_p,"tween",_p.getTween);cc.defineGetterSetter(_p,"tweenData",_p.getTweenData);cc.defineGetterSetter(_p,"colliderFilter",_p.getColliderFilter,_p.setColliderFilter);_p=null;ccs.Bone.create=function(a){return new ccs.Bone(a)};
ccs.Bone.RenderCmd={_updateColor:function(){var a=this._node,b=a._displayManager.getDisplayRenderNode();if(null!==b){var c=b._renderCmd;b.setColor(this._displayedColor);b.setOpacity(this._displayedOpacity);c._syncDisplayColor(a._tweenData);c._syncDisplayOpacity(a._tweenData.a);c._updateColor()}},transform:function(a,b){this._transform||(this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0});var c=this._node,d=this._transform,e=this._worldTransform,f=a?a._worldTransform:
null;f&&(this.originTransform(),cc.affineTransformConcatIn(d,c._worldTransform));f?(e.a=d.a*f.a+d.b*f.c,e.b=d.a*f.b+d.b*f.d,e.c=d.c*f.a+d.d*f.c,e.d=d.c*f.b+d.d*f.d,e.tx=d.tx*f.a+d.ty*f.c+f.tx,e.ty=d.tx*f.b+d.ty*f.d+f.ty):(e.a=d.a,e.b=d.b,e.c=d.c,e.d=d.d,e.tx=d.tx,e.ty=d.ty)}};(function(){ccs.Bone.CanvasRenderCmd=function(a){this._rootCtor(a);this._needDraw=!1};var a=ccs.Bone.CanvasRenderCmd.prototype=Object.create(cc.Node.CanvasRenderCmd.prototype);cc.inject(ccs.Bone.RenderCmd,a);a.constructor=ccs.Bone.CanvasRenderCmd})();
(function(){if(cc.Node.WebGLRenderCmd){ccs.Bone.WebGLRenderCmd=function(a){this._rootCtor(a);this._needDraw=!1};var a=ccs.Bone.WebGLRenderCmd.prototype=Object.create(cc.Node.WebGLRenderCmd.prototype);cc.inject(ccs.Bone.RenderCmd,a);a.constructor=ccs.Bone.WebGLRenderCmd}})();ccs.FRAME_TYPE_MOVE=0;ccs.FRAME_TYPE_SCALE=1;ccs.FRAME_TYPE_ROTATE=2;ccs.FRAME_TYPE_TINT=3;ccs.FRAME_TYPE_FADE=4;ccs.FRAME_TYPE_MAX=5;
ccs.FrameEaseType={CUSTOM:-1,LINEAR:0,SINE_EASEIN:1,SINE_EASEOUT:2,SINE_EASEINOUT:3,QUAD_EASEIN:4,QUAD_EASEOUT:5,QUAD_EASEINOUT:6,CUBIC_EASEIN:7,CUBIC_EASEOUT:8,CUBIC_EASEINOUT:9,QUART_EASEIN:10,QUART_EASEOUT:11,QUART_EASEINOUT:12,QUINT_EASEIN:13,QUINT_EASEOUT:14,QUINT_EASEINOUT:15,EXPO_EASEIN:16,EXPO_EASEOUT:17,EXPO_EASEINOUT:18,CIRC_EASEIN:19,CIRC_EASEOUT:20,CIRC_EASEINOUT:21,ELASTIC_EASEIN:22,ELASTIC_EASEOUT:23,ELASTIC_EASEINOUT:24,BACK_EASEIN:25,BACK_EASEOUT:26,BACK_EASEINOUT:27,BOUNCE_EASEIN:28,
BOUNCE_EASEOUT:29,BOUNCE_EASEINOUT:30,TWEEN_EASING_MAX:1E3};
ccs.ActionFrame=ccs.Class.extend({frameType:0,easingType:0,frameIndex:0,_Parameter:null,time:0,ctor:function(){this.frameType=0;this.easingType=ccs.FrameEaseType.LINEAR;this.time=this.frameIndex=0},getAction:function(a,b){cc.log("Need a definition of \x3cgetAction\x3e for ActionFrame");return null},_getEasingAction:function(a){if(null===a)return console.error("Action cannot be null!"),null;var b;switch(this.easingType){case ccs.FrameEaseType.LINEAR:b=a;break;case ccs.FrameEaseType.SINE_EASEIN:b=a.easing(cc.easeSineIn());
break;case ccs.FrameEaseType.SINE_EASEOUT:b=a.easing(cc.easeSineOut());break;case ccs.FrameEaseType.SINE_EASEINOUT:b=a.easing(cc.easeSineInOut());break;case ccs.FrameEaseType.QUAD_EASEIN:b=a.easing(cc.easeQuadraticActionIn());break;case ccs.FrameEaseType.QUAD_EASEOUT:b=a.easing(cc.easeQuadraticActionOut());break;case ccs.FrameEaseType.QUAD_EASEINOUT:b=a.easing(cc.easeQuadraticActionInOut());break;case ccs.FrameEaseType.CUBIC_EASEIN:b=a.easing(cc.easeCubicActionIn());break;case ccs.FrameEaseType.CUBIC_EASEOUT:b=
a.easing(cc.easeCubicActionOut());break;case ccs.FrameEaseType.CUBIC_EASEINOUT:b=a.easing(cc.easeCubicActionInOut());break;case ccs.FrameEaseType.QUART_EASEIN:b=a.easing(cc.easeQuarticActionIn());break;case ccs.FrameEaseType.QUART_EASEOUT:b=a.easing(cc.easeQuarticActionOut());break;case ccs.FrameEaseType.QUART_EASEINOUT:b=a.easing(cc.easeQuarticActionInOut());break;case ccs.FrameEaseType.QUINT_EASEIN:b=a.easing(cc.easeQuinticActionIn());break;case ccs.FrameEaseType.QUINT_EASEOUT:b=a.easing(cc.easeQuinticActionOut());
break;case ccs.FrameEaseType.QUINT_EASEINOUT:b=a.easing(cc.easeQuinticActionInOut());break;case ccs.FrameEaseType.EXPO_EASEIN:b=a.easing(cc.easeExponentialIn());break;case ccs.FrameEaseType.EXPO_EASEOUT:b=a.easing(cc.easeExponentialOut());break;case ccs.FrameEaseType.EXPO_EASEINOUT:b=a.easing(cc.easeExponentialInOut());break;case ccs.FrameEaseType.CIRC_EASEIN:b=a.easing(cc.easeCircleActionIn());break;case ccs.FrameEaseType.CIRC_EASEOUT:b=a.easing(cc.easeCircleActionOut());break;case ccs.FrameEaseType.CIRC_EASEINOUT:b=
a.easing(cc.easeCircleActionInOut());break;case ccs.FrameEaseType.ELASTIC_EASEIN:b=a.easing(cc.easeElasticIn());break;case ccs.FrameEaseType.ELASTIC_EASEOUT:b=a.easing(cc.easeElasticOut());break;case ccs.FrameEaseType.ELASTIC_EASEINOUT:b=a.easing(cc.easeElasticInOut());break;case ccs.FrameEaseType.BACK_EASEIN:b=a.easing(cc.easeBackIn());break;case ccs.FrameEaseType.BACK_EASEOUT:b=a.easing(cc.easeBackOut());break;case ccs.FrameEaseType.BACK_EASEINOUT:b=a.easing(cc.easeBackInOut());break;case ccs.FrameEaseType.BOUNCE_EASEIN:b=
a.easing(cc.easeBounceIn());break;case ccs.FrameEaseType.BOUNCE_EASEOUT:b=a.easing(cc.easeBounceOut());break;case ccs.FrameEaseType.BOUNCE_EASEINOUT:b=a.easing(cc.easeBounceInOut())}return b},setEasingParameter:function(a){this._Parameter=[];for(var b=0;b<a.length;b++)this._Parameter.push(a[b])},setEasingType:function(a){this.easingType=a}});
ccs.ActionMoveFrame=ccs.ActionFrame.extend({_position:null,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this);this._position=cc.p(0,0);this.frameType=ccs.FRAME_TYPE_MOVE},setPosition:function(a,b){void 0===b?(this._position.x=a.x,this._position.y=a.y):(this._position.x=a,this._position.y=b)},getPosition:function(){return this._position},getAction:function(a){return this._getEasingAction(cc.moveTo(a,this._position))}});
ccs.ActionScaleFrame=ccs.ActionFrame.extend({_scaleX:1,_scaleY:1,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this);this._scaleY=this._scaleX=1;this.frameType=ccs.FRAME_TYPE_SCALE},setScaleX:function(a){this._scaleX=a},getScaleX:function(){return this._scaleX},setScaleY:function(a){this._scaleY=a},getScaleY:function(){return this._scaleY},getAction:function(a){return this._getEasingAction(cc.scaleTo(a,this._scaleX,this._scaleY))}});
ccs.ActionRotationFrame=ccs.ActionFrame.extend({_rotation:0,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this);this._rotation=0;this.frameType=ccs.FRAME_TYPE_ROTATE},setRotation:function(a){this._rotation=a},getRotation:function(){return this._rotation},getAction:function(a,b){return void 0===b?this._getEasingAction(cc.rotateTo(a,this._rotation)):b instanceof cc.ActionRotationFrame?this._getEasingAction(cc.rotateBy(a,this._rotation-b._rotation)):this.getAction(a)}});
ccs.ActionFadeFrame=ccs.ActionFrame.extend({_opacity:255,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this);this._opacity=255;this.frameType=ccs.FRAME_TYPE_FADE},setOpacity:function(a){this._opacity=a},getOpacity:function(){return this._opacity},getAction:function(a){return this._getEasingAction(cc.fadeTo(a,this._opacity))}});
ccs.ActionTintFrame=ccs.ActionFrame.extend({_color:null,ctor:function(){ccs.ActionFrame.prototype.ctor.call(this);this._color=cc.color(255,255,255,255);this.frameType=ccs.FRAME_TYPE_TINT},setColor:function(a){var b=this._color;b.r=a.r;b.g=a.g;b.b=a.b},getColor:function(){var a=this._color;return cc.color(a.r,a.g,a.b,a.a)},getAction:function(a){return this._getEasingAction(cc.tintTo(a,this._color.r,this._color.g,this._color.b))}});ccs.actionManager={_actionDic:{},initWithDictionary:function(a,b,c){var d=a.lastIndexOf("/");a=a.substr(d+1,a.length);b=b.actionlist;for(var d=[],e=0;e<b.length;e++){var f=new ccs.ActionObject;f.initWithDictionary(b[e],c);d.push(f)}this._actionDic[a]=d},getActionByName:function(a,b){var c=a.lastIndexOf("/"),c=a.substr(c+1,a.length),c=this._actionDic[c];if(!c)return null;for(var d=0;d<c.length;d++){var e=c[d];if(b===e.getName())return e}return null},playActionByName:function(a,b,c){(a=this.getActionByName(a,
b))&&a.play(c)},stopActionByName:function(a,b){var c=this.getActionByName(a,b);c&&c.stop()},releaseActions:function(){this._actionDic={}},clear:function(){this._actionDic={}}};ccs.ActionNode=ccs.Class.extend({_currentFrameIndex:0,_destFrameIndex:0,_unitTime:0,_actionTag:0,_object:null,_actionSpawn:null,_action:null,_frameArray:null,_frameArrayNum:0,ctor:function(){this._destFrameIndex=this._currentFrameIndex=0;this._unitTime=0.1;this._actionTag=0;this._action=this._actionSpawn=this._object=null;this._frameArray=[];this._frameArrayNum=ccs.FRAME_TYPE_MAX;for(var a=0;a<this._frameArrayNum;a++)this._frameArray.push([])},initWithDictionary:function(a,b){this.setActionTag(a.ActionTag);
for(var c=a.actionframelist,d=ccui.helper.seekActionWidgetByActionTag(b,a.ActionTag),e=d instanceof ccui.Widget&&!(d instanceof ccui.Layout),f=0;f<c.length;f++){var g=c[f],h=g.frameid,k=g.tweenType;null==k&&(k=0);for(var m=g.tweenParameter,n=[],p=0;p<m;p++)n.push(g.tweenParameter[p]);if(void 0!==g.positionx){var p=g.positionx,r=g.positiony;e&&d.parent&&(m=d.parent.getAnchorPointInPoints(),p+=m.x,r+=m.y);m=new ccs.ActionMoveFrame;m.frameIndex=h;m.setEasingType(k);m.setEasingParameter(n);m.setPosition(p,
r);p=this._frameArray[ccs.FRAME_TYPE_MOVE];p.push(m)}void 0!==g.scalex&&(p=g.scalex,r=g.scaley,m=new ccs.ActionScaleFrame,m.frameIndex=h,m.setEasingType(k),m.setEasingParameter(n),m.setScaleX(p),m.setScaleY(r),p=this._frameArray[ccs.FRAME_TYPE_SCALE],p.push(m));void 0!==g.rotation&&(p=g.rotation,m=new ccs.ActionRotationFrame,m.frameIndex=h,m.setEasingType(k),m.setEasingParameter(n),m.setRotation(p),p=this._frameArray[ccs.FRAME_TYPE_ROTATE],p.push(m));void 0!==g.opacity&&(p=g.opacity,m=new ccs.ActionFadeFrame,
m.frameIndex=h,m.setEasingType(k),m.setEasingParameter(n),m.setOpacity(p),p=this._frameArray[ccs.FRAME_TYPE_FADE],p.push(m));void 0!==g.colorr&&(p=g.colorr,r=g.colorg,g=g.colorb,m=new ccs.ActionTintFrame,m.frameIndex=h,m.setEasingType(k),m.setEasingParameter(n),m.setColor(cc.color(p,r,g)),p=this._frameArray[ccs.FRAME_TYPE_TINT],p.push(m))}this._initActionNodeFromRoot(b)},_initActionNodeFromRoot:function(a){a instanceof ccui.Widget&&(a=ccui.helper.seekActionWidgetByActionTag(a,this.getActionTag()))&&
this.setObject(a)},setUnitTime:function(a){this._unitTime=a;this._refreshActionProperty()},getUnitTime:function(){return this._unitTime},setActionTag:function(a){this._actionTag=a},getActionTag:function(){return this._actionTag},setObject:function(a){this._object=a},getObject:function(){return this._object},getActionNode:function(){return this._object instanceof cc.Node?this._object:null},insertFrame:function(a,b){null!=b&&this._frameArray[b.frameType].splice(a,0,b)},addFrame:function(a){a&&this._frameArray[a.frameType].push(a)},
deleteFrame:function(a){void 0!==a&&cc.arrayRemoveObject(this._frameArray[a.frameType],a)},clearAllFrame:function(){for(var a=0;a<this._frameArrayNum;a++)this._frameArray[a].length=0},_refreshActionProperty:function(){if(!this._object)return null;for(var a=[],b=0;b<this._frameArrayNum;b++){var c=this._frameArray[b];if(!(0>=c.length)){for(var d=[],e=0;e<c.length;e++){var f=c[e],g=null;0!==e?(g=(f.frameIndex-c[e-1].frameIndex)*this.getUnitTime(),g=f.getAction(g)):g=f.getAction(0);g&&d.push(g)}d&&(c=
cc.sequence(d),null!==c&&a.push(c))}}this._action=null;return this._actionSpawn=cc.spawn(a)},playAction:function(a){this._object&&this._actionSpawn&&(this._action=a?cc.sequence(this._actionSpawn,a):cc.sequence(this._actionSpawn),this._runAction())},_runAction:function(){var a=this.getActionNode();null!==a&&null!==this._action&&a.runAction(this._action)},stopAction:function(){var a=this.getActionNode();null!==a&&null!==this._action&&(this._action.isDone()||a.stopAction(this._action))},getFirstFrameIndex:function(){for(var a=
99999,b=!1,c=this._frameArray,d=0,e=this._frameArrayNum;d<e;d++){var f=c[d];0>=f.length||(b=!0,f=f[0].frameIndex,a=a>f?f:a)}b||(a=0);return a},getLastFrameIndex:function(){for(var a=-1,b=!1,c=this._frameArray,d=0,e=this._frameArrayNum;d<e;d++){var f=c[d];0>=f.length||(b=!0,f=f[f.length-1].frameIndex,a=a<f?f:a)}b||(a=0);return a},updateActionToTimeLine:function(a){for(var b=!1,c=this.getUnitTime(),d=0;d<this._frameArrayNum;d++){var e=this._frameArray[d];if(e)for(var f=0;f<e.length;f++){var g=e[f];
if(g.frameIndex*c===a){this._easingToFrame(1,1,g);b=!0;break}else if(g.frameIndex*c>a){0===f?(this._easingToFrame(1,1,g),b=!1):(b=e[f-1],e=(g.frameIndex-b.frameIndex)*c,f=a-b.frameIndex*c,this._easingToFrame(e,1,b),this._easingToFrame(e,f/e,g),b=!0);break}}}return b},_easingToFrame:function(a,b,c){a=c.getAction(a);c=this.getActionNode();null!=a&&null!=c&&(a.startWithTarget(c),a.update(b))},isActionDoneOnce:function(){return this._action?this._action.isDone():!0}});ccs.ActionObject=ccs.Class.extend({_actionNodeList:null,_name:"",_loop:!1,_pause:!1,_playing:!1,_unitTime:0,_currentTime:0,_scheduler:null,_callback:null,_fTotalTime:0,ctor:function(){this._actionNodeList=[];this._name="";this._playing=this._pause=this._loop=!1;this._unitTime=0.1;this._fTotalTime=this._currentTime=0;this._scheduler=cc.director.getScheduler()},setName:function(a){this._name=a},getName:function(){return this._name},setLoop:function(a){this._loop=a},getLoop:function(){return this._loop},
setUnitTime:function(a){this._unitTime=a;a=this._actionNodeList.length;for(var b=0;b<a;b++)this._actionNodeList[b].setUnitTime(this._unitTime)},getUnitTime:function(){return this._unitTime},getCurrentTime:function(){return this._currentTime},setCurrentTime:function(a){this._currentTime=a},getTotalTime:function(){return this._fTotalTime},isPlaying:function(){return this._playing},initWithDictionary:function(a,b){this.setName(a.name);this.setLoop(a.loop);this.setUnitTime(a.unittime);for(var c=a.actionnodelist,
d=0,e=0;e<c.length;e++){var f=new ccs.ActionNode;f.initWithDictionary(c[e],b);f.setUnitTime(this.getUnitTime());this._actionNodeList.push(f);f=f.getLastFrameIndex()-f.getFirstFrameIndex();f>d&&(d=f)}this._fTotalTime=d*this._unitTime},addActionNode:function(a){a&&(this._actionNodeList.push(a),a.setUnitTime(this._unitTime))},removeActionNode:function(a){null!=a&&cc.arrayRemoveObject(this._actionNodeList,a)},play:function(a){this.stop();this.updateToFrameByTime(0);for(var b=this._actionNodeList,c=b.length,
d=0;d<c;d++)b[d].playAction(a);this._loop&&this._scheduler.schedule(this.simulationActionUpdate,this,0,cc.REPEAT_FOREVER,0,!1,this.__instanceId+"");void 0!==a&&(this._callback=a)},pause:function(){this._pause=!0;this._playing=!1},stop:function(){for(var a=this._actionNodeList,b=0;b<a.length;b++)a[b].stopAction();this._scheduler.unschedule(this.simulationActionUpdate,this);this._playing=this._pause=!1},updateToFrameByTime:function(a){this._currentTime=a;for(var b=0;b<this._actionNodeList.length;b++)this._actionNodeList[b].updateActionToTimeLine(a)},
simulationActionUpdate:function(a){a=!0;for(var b=this._actionNodeList,c=0,d=b.length;c<d;c++)if(!b[c].isActionDoneOnce()){a=!1;break}a&&(null!==this._callback&&this._callback.execute(),this._loop?this.play():(this._playing=!1,this._scheduler.unschedule(this.simulationActionUpdate,this)))}});ccs.ComAttribute=ccs.Component.extend({_jsonDict:null,_filePath:"",ctor:function(){cc.Component.prototype.ctor.call(this);this._jsonDict={};this._filePath="";this._name="CCComAttribute";ccs.ComAttribute.prototype.init.call(this)},init:function(){this._jsonDict={};return!0},setInt:function(a,b){a?this._jsonDict[a]=b:cc.log("Argument must be non-nil")},setDouble:function(a,b){a?this._jsonDict[a]=b:cc.log("Argument must be non-nil")},setFloat:function(a,b){a?this._jsonDict[a]=b:cc.log("Argument must be non-nil")},
setBool:function(a,b){a?this._jsonDict[a]=b:cc.log("Argument must be non-nil")},setString:function(a,b){a?this._jsonDict[a]=b:cc.log("Argument must be non-nil")},setObject:function(a,b){a?this._jsonDict[a]=b:cc.log("Argument must be non-nil")},getInt:function(a){return parseInt(this._jsonDict[a]||0)},getDouble:function(a){return parseFloat(this._jsonDict[a]||0)},getFloat:function(a){return parseFloat(this._jsonDict[a]||0)},getBool:function(a){return Boolean(this._jsonDict[a]||!1)},getString:function(a){return this._jsonDict[a]||
""},getObject:function(a){return this._jsonDict[a]},parse:function(a){this._jsonDict=cc.loader.getRes(a)}});ccs.ComAttribute.create=function(){return new ccs.ComAttribute};ccs.ComAudio=ccs.Component.extend({_filePath:"",_loop:!1,ctor:function(){cc.Component.prototype.ctor.call(this);this._name="Audio";ccs.ComAudio.prototype.init.call(this)},init:function(){return!0},onExit:function(){this.stopBackgroundMusic(!0);this.stopAllEffects()},end:function(){cc.audioEngine.end()},preloadBackgroundMusic:function(a){cc.loader.load(a)},playBackgroundMusic:function(a,b){a?cc.audioEngine.playMusic(a,b):cc.audioEngine.playMusic(this._filePath,this._loop)},stopBackgroundMusic:function(a){cc.audioEngine.stopMusic(a)},
pauseBackgroundMusic:function(){cc.audioEngine.pauseMusic()},resumeBackgroundMusic:function(){cc.audioEngine.resumeMusic()},rewindBackgroundMusic:function(){cc.audioEngine.rewindMusic()},willPlayBackgroundMusic:function(){return cc.audioEngine.willPlayMusic()},isBackgroundMusicPlaying:function(){return cc.audioEngine.isMusicPlaying()},getBackgroundMusicVolume:function(){return cc.audioEngine.getMusicVolume()},setBackgroundMusicVolume:function(a){cc.audioEngine.setMusicVolume(a)},getEffectsVolume:function(){return cc.audioEngine.getEffectsVolume()},
setEffectsVolume:function(a){cc.audioEngine.setEffectsVolume(a)},playEffect:function(a,b){return a?cc.audioEngine.playEffect(a,b):cc.audioEngine.playEffect(this._filePath,this._loop)},pauseEffect:function(a){cc.audioEngine.pauseEffect(a)},pauseAllEffects:function(){cc.audioEngine.pauseAllEffects()},resumeEffect:function(a){cc.audioEngine.resumeEffect(a)},resumeAllEffects:function(){cc.audioEngine.resumeAllEffects()},stopEffect:function(a){cc.audioEngine.stopEffect(a)},stopAllEffects:function(){cc.audioEngine.stopAllEffects()},
preloadEffect:function(a){cc.loader.getRes(a);this.setFile(a);this.setLoop(!1)},unloadEffect:function(a){cc.audioEngine.unloadEffect(a)},setFile:function(a){this._filePath=a},setLoop:function(a){this._loop=a},getFile:function(){return this._filePath},isLoop:function(){return this._loop}});ccs.ComAudio.create=function(){return new ccs.ComAudio};ccs.ComController=ccs.Component.extend({ctor:function(){cc.Component.prototype.ctor.call(this);this._name="ComController";ccs.ComController.prototype.init.call(this)},onEnter:function(){null!==this._owner&&this._owner.scheduleUpdate()},isEnabled:function(){return this._enabled},setEnabled:function(a){this._enabled=a}});ccs.ComController.create=function(){return new ccs.ComController};ccs.ComRender=ccs.Component.extend({_render:null,ctor:function(a,b){cc.Component.prototype.ctor.call(this);this._render=a;this._name=b;this.isRenderer=!0;ccs.ComRender.prototype.init.call(this)},onEnter:function(){this._owner&&this._owner.addChild(this._render)},onExit:function(){this._owner&&(this._owner.removeChild(this._render,!0),this._render=null)},getNode:function(){return this._render},setNode:function(a){this._render=a}});ccs.ComRender.create=function(a,b){return new ccs.ComRender(a,b)};ccs.objectFactory={_typeMap:{},createObject:function(a){var b=null;(a=this._typeMap[a])&&(b=cc.isFunction(a._fun)?new a._fun:a._fun);return b},registerType:function(a){this._typeMap[a._className]=a},createGUI:function(a){var b=null;"Panel"===a?a="Layout":"TextArea"===a?a="Label":"TextButton"===a&&(a="Button");(a=this._typeMap[a])&&a._fun&&(b=a._fun);return b},removeAll:function(){this._typeMap={}}};
ccs.TInfo=ccs.Class.extend({_className:"",_fun:null,ctor:function(a,b){b?(this._className=a,this._fun=b):(this._className=a._className,this._fun=a._fun);ccs.objectFactory.registerType(this)}});ccs.sendEvent=function(a){a=ccs.triggerManager.get(a);if(null!=a)for(var b=0;b<a.length;b++){var c=a[b];null!=c&&c.detect()&&c.done()}};ccs.registerTriggerClass=function(a,b){new ccs.TInfo(a,b)};ccs.triggerManager={_eventTriggers:{},_triggerObjs:{},_movementDispatches:[],parse:function(a){for(var b=0;b<a.length;++b){var c=a[b],d=new ccs.TriggerObj;d.serialize(c);for(var c=d.getEvents(),e=0;e<c.length;e++)this.add(c[e],d);this._triggerObjs[d.getId()]=d}},get:function(a){return this._eventTriggers[a]},getTriggerObj:function(a){return this._triggerObjs[a]},add:function(a,b){var c=this._eventTriggers[a];c||(c=[]);-1===c.indexOf(b)&&(c.push(b),this._eventTriggers[a]=c)},removeAll:function(){for(var a in this._eventTriggers)for(var b=
this._eventTriggers[a],c=0;c<b.length;c++)b[c].removeAll();this._eventTriggers={}},remove:function(a,b){if(b)return this._removeObj(a,b);var c=!1,d=this._eventTriggers[a];if(d){for(c=0;c<d.length;c++){var e=d[c];e&&e.removeAll()}delete this._eventTriggers[a];c=!0}return c},_removeObj:function(a,b){var c=!1;do{var d=this._eventTriggers[a];if(d){for(c=0;c<d.length;c++){var e=d[c];if(e&&e==b){e.removeAll();d.splice(c,1);break}}c=!0}}while(0);return c},removeTriggerObj:function(a){a=this.getTriggerObj(a);
if(!a)return!1;for(var b=a.getEvents(),c=0;c<b.length;c++)this.remove(b[c],a);return!0},isEmpty:function(){return!this._eventTriggers||0>=this._eventTriggers.length},addArmatureMovementCallBack:function(a,b,c){if(null!=a&&null!=c&&null!=b){for(var d,e=!1,f=0;f<this._movementDispatches.length;f++)(d=this._movementDispatches[f])&&d[0]===a&&(d.addAnimationEventCallBack(b,c),e=!0);e||(d=new ccs.ArmatureMovementDispatcher,a.getAnimation().setMovementEventCallFunc(d.animationEvent,d),d.addAnimationEventCallBack(b,
c),this._movementDispatches.push([a,d]))}},removeArmatureMovementCallBack:function(a,b,c){if(null!=a&&null!=b&&null!=c)for(var d,e=0;e<this._movementDispatches.length;e++)(d=this._movementDispatches[e])&&d[0]===a&&d.removeAnimationEventCallBack(c,b)},removeArmatureAllMovementCallBack:function(a){if(null!=a)for(var b,c=0;c<this._movementDispatches.length;c++)if((b=this._movementDispatches[c])&&b[0]===a){this._movementDispatches.splice(c,1);break}},removeAllArmatureMovementCallBack:function(){this._movementDispatches.length=
0},version:function(){return"1.2.0.0"}};
ccs.ArmatureMovementDispatcher=ccs.Class.extend({_mapEventAnimation:null,ctor:function(){this._mapEventAnimation=[]},animationEvent:function(a,b,c){for(var d,e,f=0;f<this._mapEventAnimation.length;f++)d=this._mapEventAnimation[f],e=d[0],(d=d[1])&&d.call(e,a,b,c)},addAnimationEventCallBack:function(a,b){this._mapEventAnimation.push([b,a])},removeAnimationEventCallBack:function(a,b){for(var c,d=0;d<this._mapEventAnimation.length;d++)c=this._mapEventAnimation[d],c[0]===b&&this._mapEventAnimation.splice(d,
1)}});ccs.BaseTriggerCondition=ccs.Class.extend({ctor:function(){},init:function(){return!0},detect:function(){return!0},serialize:function(a){},removeAll:function(){}});ccs.BaseTriggerAction=ccs.Class.extend({ctor:function(){},init:function(){return!0},done:function(){},serialize:function(a){},removeAll:function(){}});
ccs.TriggerObj=ccs.Class.extend({_cons:null,_acts:null,_id:0,_enable:!0,_vInt:null,ctor:function(){this._id=0;this._enable=!0;ccs.TriggerObj.prototype.init.call(this)},init:function(){this._cons=[];this._acts=[];this._vInt=[];return!0},detect:function(){if(!this._enable||0===this._cons.length)return!0;for(var a=!0,b=null,c=0;c<this._cons.length;c++)(b=this._cons[c])&&b.detect&&(a=a&&b.detect());return a},done:function(){if(this._enable&&0!==this._acts.length)for(var a,b=0;b<this._acts.length;b++)(a=
this._acts[b])&&a.done&&a.done()},removeAll:function(){for(var a=null,b=0;b<this._cons.length;b++)(a=this._cons[b])&&a.removeAll();this._cons=[];for(b=0;b<this._acts.length;b++)(a=this._acts[b])&&a.removeAll();this._acts=[]},serialize:function(a){this._id=a.id||0;for(var b=a.conditions||[],c=0;c<b.length;c++){var d=b[c],e=d.classname,f=ccs.objectFactory.createObject(e);f?(f.serialize(d),f.init(),this._cons.push(f)):cc.log("class named classname("+e+") can not implement!")}b=a.actions||[];for(c=0;c<
b.length;c++)d=b[c],e=d.classname,(f=ccs.objectFactory.createObject(e))?(f.serialize(d),f.init(),this._acts.push(f)):cc.log("class named classname("+e+") can not implement!");a=a.events||[];for(c=0;c<a.length;c++)d=a[c],d=d.id,0>d||this._vInt.push(d)},getId:function(){return this._id},setEnable:function(a){this._enable=a},getEvents:function(){return this._vInt}});ccs.TriggerObj.create=function(){return new ccs.TriggerObj};ccs.ActionTimelineData=ccs.Class.extend({_actionTag:0,ctor:function(a){this._init(a)},_init:function(a){this._actionTag=a;return!0},setActionTag:function(a){this._actionTag=a},getActionTag:function(){return this._actionTag}});ccs.AnimationInfo=function(a,b,c){this.name=a;this.startIndex=b;this.endIndex=c};
ccs.ComExtensionData=ccs.Component.extend({_customProperty:null,_timelineData:null,_name:"ComExtensionData",ctor:function(){this._customProperty="";this._timelineData=new ccs.ActionTimelineData(0);return!0},setActionTag:function(a){this._timelineData.setActionTag(a)},getActionTag:function(){return this._timelineData.getActionTag()},setCustomProperty:function(a){this._customProperty=a},getCustomProperty:function(){return this._customProperty}});ccs.ComExtensionData.create=function(){return new ccs.ComExtensionData};
ccs.ActionTimelineData.create=function(a){return new ccs.ActionTimelineData(a)};
ccs.ActionTimeline=cc.Action.extend({_timelineMap:null,_timelineList:null,_duration:0,_time:null,_timeSpeed:1,_frameInternal:1/60,_playing:!1,_currentFrame:0,_startFrame:0,_endFrame:0,_loop:null,_frameEventListener:null,_animationInfos:null,_lastFrameListener:null,ctor:function(){cc.Action.prototype.ctor.call(this);this._timelineMap={};this._timelineList=[];this._animationInfos={};this.init()},_gotoFrame:function(a){for(var b=this._timelineList.length,c=0;c<b;c++)this._timelineList[c]._gotoFrame(a)},
_stepToFrame:function(a){for(var b=this._timelineList.length,c=0;c<b;c++)this._timelineList[c]._stepToFrame(a)},_emitFrameEvent:function(a){this._frameEventListener&&this._frameEventListener(a)},init:function(){return!0},gotoFrameAndPlay:function(a,b,c,d){var e=0,f=arguments.length,g=[],h;for(e;e<f;e++)"boolean"===typeof arguments[e]?h=arguments[e]:g.push(arguments[e]);a=g[0];b=void 0!==g[1]?g[1]:this._duration;c=g[2]||a;this._startFrame=a;this._endFrame=b;this._currentFrame=c;this._loop=null!=h?
h:!0;this._time=this._currentFrame*this._frameInternal;this.resume();this._gotoFrame(this._currentFrame)},getTime:function(){return this._time},gotoFrameAndPause:function(a){this._startFrame=this._currentFrame=a;this._time=this._currentFrame*this._frameInternal;this.pause();this._gotoFrame(this._currentFrame)},pause:function(){this._playing=!1},resume:function(){this._playing=!0},isPlaying:function(){return this._playing},setTimeSpeed:function(a){this._timeSpeed=a},getTimeSpeed:function(){return this._timeSpeed},
setDuration:function(a){this._duration=a},getDuration:function(){return this._duration},getStartFrame:function(){return this._startFrame},getEndFrame:function(){return this._endFrame},setCurrentFrame:function(a){a>=this._startFrame&&a<=this._endFrame?(this._currentFrame=a,this._time=this._currentFrame*this._frameInternal):cc.log("frame index is not between start frame and end frame")},getCurrentFrame:function(){return this._currentFrame},addTimeline:function(a){var b=a.getActionTag();this._timelineMap[b]||
(this._timelineMap[b]=[]);-1===this._timelineMap[b].indexOf(a)&&(this._timelineList.push(a),this._timelineMap[b].push(a),a.setActionTimeline(this))},removeTimeline:function(a){var b=a.getActionTag();this._timelineMap[b]&&this._timelineMap[b].some(function(b){if(b===a)return!0})&&(cc.arrayRemoveObject(this._timelineMap[b],a),cc.arrayRemoveObject(this._timelineList,a),a.setActionTimeline(null))},getTimelines:function(){return this._timelineList},setFrameEventCallFunc:function(a){this._frameEventListener=
a},clearFrameEventCallFunc:function(){this._frameEventListener=null},clone:function(){var a=new ccs.ActionTimeline;a.setDuration(this._duration);a.setTimeSpeed(this._timeSpeed);for(var b in this._timelineMap){var c=this._timelineMap[b],d;for(d in c){var e=c[d].clone();a.addTimeline(e)}}return a},reverse:function(){return null},step:function(a){this._playing&&0!==this._timelineMap.length&&0!==this._duration&&(this._time+=a*this._timeSpeed,a=this._time-this._endFrame*this._frameInternal,a<this._frameInternal?
(this._currentFrame=Math.floor(this._time/this._frameInternal),this._stepToFrame(this._currentFrame),0<=a&&this._lastFrameListener&&this._lastFrameListener()):(this._playing=this._loop)?this.gotoFrameAndPlay(this._startFrame,this._endFrame,this._loop):(this._time=this._endFrame*this._frameInternal,this._currentFrame!=this._endFrame&&(this._currentFrame=this._endFrame,this._stepToFrame(this._currentFrame),this._lastFrameListener&&this._lastFrameListener())))},_foreachNodeDescendant:function(a,b){b(a);
for(var c=a.getChildren(),d=0;d<c.length;d++)this._foreachNodeDescendant(c[d],b)},startWithTarget:function(a){cc.Action.prototype.startWithTarget.call(this,a);var b=this;this._foreachNodeDescendant(a,function(a){var d=a.getComponent("ComExtensionData");if(d&&(d=d.getActionTag(),b._timelineMap[d]))for(var d=b._timelineMap[d],e=0;e<d.length;e++)d[e].setNode(a)})},isDone:function(){return!1},play:function(a,b){var c=this._animationInfos[a];if(!c)return cc.log("Can't find animation info for %s",a);this.gotoFrameAndPlay(c.startIndex,
c.endIndex,b)},addAnimationInfo:function(a){this._animationInfos[a.name]=a},removeAnimationInfo:function(a){delete this._animationInfos[a]},isAnimationInfoExists:function(a){return this._animationInfos[a]},getAnimationInfo:function(a){return this._animationInfos[a]},setLastFrameCallFunc:function(a){this._lastFrameListener=a},clearLastFrameCallFunc:function(){this._lastFrameListener=null}});ccs.ActionTimeline.create=function(){return new ccs.ActionTimeline};ccs.Frame=ccs.Class.extend({_frameIndex:null,_tween:null,_timeline:null,_node:null,_tweenType:null,_easingParam:null,_enterWhenPassed:null,ctor:function(){this._frameIndex=0;this._tween=!0;this._node=this._timeline=null;this._enterWhenPassed=!1;this._easingParam=[]},_emitEvent:function(){this._timeline&&this._timeline.getActionTimeline()._emitFrameEvent(this)},_cloneProperty:function(a){this._frameIndex=a.getFrameIndex();this._tween=a.isTween();this._tweenType=a.getTweenType();this.setEasingParams(a.getEasingParams())},
setFrameIndex:function(a){this._frameIndex=a},getFrameIndex:function(){return this._frameIndex},setTimeline:function(a){this._timeline=a},getTimeline:function(a){return this._timeline},setNode:function(a){this._node=a},getNode:function(){return this._node},setTween:function(a){this._tween=a},isTween:function(){return this._tween},onEnter:function(a){},apply:function(a){this._tween&&(this._tweenType!==ccs.FrameEaseType.TWEEN_EASING_MAX&&this._tweenType!==ccs.FrameEaseType.LINEAR&&(a=this.tweenPercent(a)),
this._onApply(a))},_onApply:function(a){},clone:function(){},tweenPercent:function(a){var b=ccs.Frame.tweenToMap[this._tweenType];return b?b(a,this._easingParam):a},setEasingParams:function(a){if(a)for(var b=this._easingParam.length=0;b<a.length;b++)this._easingParam[b]=a[b]},getEasingParams:function(){return this._easingParam},setTweenType:function(a){this._tweenType=a},getTweenType:function(){return this._tweenType},isEnterWhenPassed:function(){return this._enterWhenPassed}});
ccs.Frame.tweenToMap={"-1":function(a,b){if(b){var c=1-a;return b[1]*c*c*c+3*b[3]*a*c*c+3*b[5]*a*a*c+b[7]*a*a*a}return a},1:cc._easeSineInObj.easing,2:cc._easeSineOutObj.easing,3:cc._easeSineInOutObj.easing,4:cc._easeQuadraticActionIn.easing,5:cc._easeQuadraticActionOut.easing,6:cc._easeQuadraticActionInOut.easing,7:cc._easeCubicActionIn.easing,8:cc._easeCubicActionOut.easing,9:cc._easeCubicActionInOut.easing,10:cc._easeCubicActionIn.easing,11:cc._easeCubicActionOut.easing,12:cc._easeCubicActionInOut.easing,
13:cc._easeQuinticActionIn.easing,14:cc._easeQuinticActionOut.easing,15:cc._easeQuinticActionInOut.easing,16:cc._easeExponentialInObj.easing,17:cc._easeExponentialOutObj.easing,18:cc._easeExponentialInOutObj.easing,19:cc._easeCircleActionIn.easing,20:cc._easeCircleActionOut.easing,21:cc._easeCircleActionInOut.easing,22:function(a,b){var c=0.3;null!=b&&(c=b[0]);return cc.easeElasticIn(c).easing(a)},23:function(a,b){var c=0.3;null!=b&&(c=b[0]);return cc.easeElasticOut(c).easing(a)},24:function(a,b){var c=
0.3;null!=b&&(c=b[0]);return cc.easeElasticInOut(c).easing(a)},25:cc._easeBackInObj.easing,26:cc._easeBackOutObj.easing,27:cc._easeBackInOutObj.easing,28:cc._easeBounceInObj.easing,29:cc._easeBounceOutObj.easing,30:cc._easeBounceInOutObj.easing};
ccs.VisibleFrame=ccs.Frame.extend({_visible:!0,ctor:function(){ccs.Frame.prototype.ctor.call(this);this._visible=!0},onEnter:function(a){this._node&&this._node.setVisible(this._visible)},clone:function(){var a=new ccs.VisibleFrame;a.setVisible(this._visible);a._cloneProperty(this);return a},setVisible:function(a){this._visible=a},isVisible:function(){return this._visible}});ccs.VisibleFrame.create=function(){return new ccs.VisibleFrame};
ccs.TextureFrame=ccs.Frame.extend({_sprite:null,_textureName:null,ctor:function(){ccs.Frame.prototype.ctor.call(this);this._textureName=""},setNode:function(a){ccs.Frame.prototype.setNode.call(this,a);this._sprite=a},onEnter:function(a){if(this._sprite){a=this._sprite.getBlendFunc();var b=cc.spriteFrameCache._spriteFrames[this._textureName];null!=b?this._sprite.setSpriteFrame(b):this._sprite.setTexture(this._textureName);this._sprite.getBlendFunc()!==a&&this._sprite.setBlendFunc(a)}},clone:function(){var a=
new ccs.TextureFrame;a.setTextureName(this._textureName);a._cloneProperty(this);return a},setTextureName:function(a){this._textureName=a},getTextureName:function(){return this._textureName}});ccs.TextureFrame.create=function(){return new ccs.TextureFrame};
ccs.RotationFrame=ccs.Frame.extend({_rotation:null,_betwennRotation:null,ctor:function(){ccs.Frame.prototype.ctor.call(this);this._rotation=0},onEnter:function(a){this._node&&(this._node.setRotation(this._rotation),this._tween&&(this._betwennRotation=a._rotation-this._rotation))},_onApply:function(a){0!==this._betwennRotation&&this._node.setRotation(this._rotation+a*this._betwennRotation)},clone:function(){var a=new ccs.RotationFrame;a.setRotation(this._rotation);a._cloneProperty(this);return a},
setRotation:function(a){this._rotation=a},getRotation:function(){return this._rotation}});ccs.RotationFrame.create=function(){return new ccs.RotationFrame};
ccs.SkewFrame=ccs.Frame.extend({_skewX:null,_skewY:null,_betweenSkewX:null,_betweenSkewY:null,ctor:function(){ccs.Frame.prototype.ctor.call(this);this._skewY=this._skewX=0},onEnter:function(a){this._node&&(this._node.setSkewX(this._skewX),this._node.setSkewY(this._skewY),this._tween&&(this._betweenSkewX=a._skewX-this._skewX,this._betweenSkewY=a._skewY-this._skewY))},_onApply:function(a){if(0!==this._betweenSkewX||0!==this._betweenSkewY){var b=this._skewY+a*this._betweenSkewY;this._node.setSkewX(this._skewX+
a*this._betweenSkewX);this._node.setSkewY(b)}},clone:function(){var a=new ccs.SkewFrame;a.setSkewX(this._skewX);a.setSkewY(this._skewY);a._cloneProperty(this);return a},setSkewX:function(a){this._skewX=a},getSkewX:function(){return this._skewX},setSkewY:function(a){this._skewY=a},getSkewY:function(){return this._skewY}});ccs.SkewFrame.create=function(){return new ccs.SkewFrame};
ccs.RotationSkewFrame=ccs.SkewFrame.extend({onEnter:function(a){this._node&&(this._node.setRotationX(this._skewX),this._node.setRotationY(this._skewY),this._tween&&(this._betweenSkewX=a._skewX-this._skewX,this._betweenSkewY=a._skewY-this._skewY))},_onApply:function(a){if(this._node&&(0!==this._betweenSkewX||0!==this._betweenSkewY)){var b=this._skewY+a*this._betweenSkewY;this._node.setRotationX(this._skewX+a*this._betweenSkewX);this._node.setRotationY(b)}},clone:function(){var a=new ccs.RotationSkewFrame;
a.setSkewX(this._skewX);a.setSkewY(this._skewY);a._cloneProperty(this);return a}});ccs.RotationSkewFrame.create=function(){return new ccs.RotationSkewFrame};
ccs.PositionFrame=ccs.Frame.extend({_position:null,_betweenX:null,_betweenY:null,ctor:function(){ccs.Frame.prototype.ctor.call(this);this._position=cc.p(0,0)},onEnter:function(a){this._node&&(this._node.setPosition(this._position),this._tween&&(this._betweenX=a._position.x-this._position.x,this._betweenY=a._position.y-this._position.y))},_onApply:function(a){if(this._node&&(0!==this._betweenX||0!==this._betweenY)){var b=cc.p(0,0);b.x=this._position.x+this._betweenX*a;b.y=this._position.y+this._betweenY*
a;this._node.setPosition(b)}},clone:function(){var a=new ccs.PositionFrame;a.setPosition(this._position);a._cloneProperty(this);return a},setPosition:function(a){this._position=a},getPosition:function(){return this._position},setX:function(a){this._position.x=a},getX:function(){return this._position.x},setY:function(a){this._position.y=a},getY:function(){return this._position.y}});ccs.PositionFrame.create=function(){return new ccs.PositionFrame};
ccs.ScaleFrame=ccs.Frame.extend({_scaleX:null,_scaleY:null,_betweenScaleX:null,_betweenScaleY:null,ctor:function(){ccs.Frame.prototype.ctor.call(this);this._scaleY=this._scaleX=1},onEnter:function(a){this._node&&(this._node.setScaleX(this._scaleX),this._node.setScaleY(this._scaleY),this._tween&&(this._betweenScaleX=a._scaleX-this._scaleX,this._betweenScaleY=a._scaleY-this._scaleY))},_onApply:function(a){if(this._node&&(0!==this._betweenScaleX||0!==this._betweenScaleY)){var b=this._scaleY+this._betweenScaleY*
a;this._node.setScaleX(this._scaleX+this._betweenScaleX*a);this._node.setScaleY(b)}},clone:function(){var a=new ccs.ScaleFrame;a.setScaleX(this._scaleX);a.setScaleY(this._scaleY);a._cloneProperty(this);return a},setScale:function(a){this._scaleY=this._scaleX=a},setScaleX:function(a){this._scaleX=a},getScaleX:function(){return this._scaleX},setScaleY:function(a){this._scaleY=a},getScaleY:function(){return this._scaleY}});ccs.ScaleFrame.create=function(){return new ccs.ScaleFrame};
ccs.AnchorPointFrame=ccs.Frame.extend({_anchorPoint:null,ctor:function(){ccs.Frame.prototype.ctor.call(this);this._anchorPoint=cc.p(0,0)},onEnter:function(a){this._node&&this._node.setAnchorPoint(this._anchorPoint)},clone:function(){var a=new ccs.AnchorPointFrame;a.setAnchorPoint(this._anchorPoint);a._cloneProperty(this);return a},setAnchorPoint:function(a){this._anchorPoint=a},getAnchorPoint:function(){return this._anchorPoint}});ccs.AnchorPointFrame.create=function(){return new ccs.AnchorPointFrame};
ccs.InnerActionType={LoopAction:0,NoLoopAction:1,SingleFrame:2};
ccs.InnerActionFrame=ccs.Frame.extend({_innerActionType:null,_startFrameIndex:null,_endFrameIndex:0,_singleFrameIndex:0,_enterWithName:null,_animationName:"",ctor:function(){ccs.Frame.prototype.ctor.call(this);this._enterWithName=!1;this._innerActionType=ccs.InnerActionType.LoopAction;this._startFrameIndex=0},onEnter:function(a){if(this._node&&(a=this._node.getActionByTag(this._node.getTag())))if(ccs.InnerActionType.SingleFrame===this._innerActionType)a.gotoFrameAndPause(this._singleFrameIndex);else{var b=
this._startFrameIndex,c=this._endFrameIndex;this._enterWithName&&("-- ALL --"===this._animationName?(b=0,c=a.getDuration()):a.isAnimationInfoExists(this._animationName)?(c=a.getAnimationInfo(this._animationName),b=c.startIndex,c=c.endIndex):cc.log("Animation %s not exists!",this._animationName));var d=this._timeline.getActionTimeline().getDuration()-this._frameIndex-c+b;0>d&&(c+=d);ccs.InnerActionType.NoLoopAction===this._innerActionType?a.gotoFrameAndPlay(b,c,!1):ccs.InnerActionType.LoopAction===
this._innerActionType&&a.gotoFrameAndPlay(b,c,!0)}},setAnimationName:function(a){this._animationName=a},setSingleFrameIndex:function(a){this._singleFrameIndex=a},getSingleFrameIndex:function(){return this._startFrameIndex},setEnterWithName:function(a){this._enterWithName=a},getEnterWithName:function(){return this._enterWithName},clone:function(){var a=new ccs.InnerActionFrame;a.setInnerActionType(this._innerActionType);a.setStartFrameIndex(this._startFrameIndex);a.setEnterWithName(this._enterWithName);
a.setAnimationName(this._animationName);a.setSingleFrameIndex(this._singleFrameIndex);a._cloneProperty(this);return a},setInnerActionType:function(a){this._innerActionType=a},getInnerActionType:function(){return this._innerActionType},setStartFrameIndex:function(a){this._startFrameIndex=a},getStartFrameIndex:function(){return this._startFrameIndex}});ccs.InnerActionFrame.create=function(){return new ccs.InnerActionFrame};
ccs.ColorFrame=ccs.Frame.extend({_alpha:null,_color:null,_betweenAlpha:null,_betweenRed:null,_betweenGreen:null,_betweenBlue:null,ctor:function(){ccs.Frame.prototype.ctor.call(this);this._color=cc.color(255,255,255)},onEnter:function(a){this._node&&(this._node.setColor(this._color),this._tween&&(a=a._color,this._betweenRed=a.r-this._color.r,this._betweenGreen=a.g-this._color.g,this._betweenBlue=a.b-this._color.b))},_onApply:function(a){if(this._node&&this._tween&&(0!==this._betweenAlpha||0!==this._betweenRed||
0!==this._betweenGreen||0!==this._betweenBlue)){var b=cc.color(255,255,255);b.r=this._color.r+this._betweenRed*a;b.g=this._color.g+this._betweenGreen*a;b.b=this._color.b+this._betweenBlue*a;this._node.setColor(b);null!==this._alpha&&this._node.setOpacity(this._alpha+this._betweenAlpha*a)}},clone:function(){var a=new ccs.ColorFrame;a.setColor(this._color);a._cloneProperty(this);return a},setColor:function(a){this._color=a},getColor:function(){return this._color}});ccs.ColorFrame.create=function(){return new ccs.ColorFrame};
ccs.AlphaFrame=ccs.Frame.extend({_alpha:null,_betweenAlpha:null,ctor:function(){ccs.Frame.prototype.ctor.call(this);this._alpha=255},onEnter:function(a){this._node&&(this._node.setOpacity(this._alpha),this._tween&&(this._betweenAlpha=a._alpha-this._alpha))},_onApply:function(a){this._node&&this._node.setOpacity(this._alpha+this._betweenAlpha*a)},setAlpha:function(a){this._alpha=a},getAlpha:function(){return this._alpha},clone:function(){var a=new ccs.AlphaFrame;a.setAlpha(this._alpha);a._cloneProperty(this);
return a}});ccs.EventFrame=ccs.Frame.extend({_event:null,ctor:function(){ccs.Frame.prototype.ctor.call(this);this._event="";this._enterWhenPassed=!0},onEnter:function(a){this._emitEvent()},clone:function(){var a=new ccs.EventFrame;a.setEvent(this._event);a._cloneProperty(this);return a},setEvent:function(a){this._event=a},getEvent:function(){return this._event}});ccs.EventFrame.create=function(){return new ccs.EventFrame};
ccs.ZOrderFrame=ccs.Frame.extend({_zorder:0,onEnter:function(a){this._node&&this._node.setLocalZOrder(this._zorder)},clone:function(){var a=new ccs.ZOrderFrame;a.setZOrder(this._zorder);a._cloneProperty(this);return a},setZOrder:function(a){this._zorder=a},getZOrder:function(){return this._zorder}});ccs.ZOrderFrame.create=function(){return new ccs.ZOrderFrame};
ccs.BlendFuncFrame=ccs.Frame.extend({ctor:function(){this._super();this._blendFunc=null},onEnter:function(a,b){this._node&&this._blendFunc&&this._node.setBlendFunc(this._blendFunc)},clone:function(){var a=new ccs.BlendFuncFrame;a.setBlendFunc(this._blendFunc);a._cloneProperty(this);return a},setBlendFunc:function(a){a&&a.src&&a.dst&&(this._blendFunc=a)},getBlendFunc:function(){return this._blendFunc}});ccs.BlendFuncFrame.create=function(){return new ccs.BlendFuncFrame};ccs.Timeline=ccs.Class.extend({_frames:null,_currentKeyFrame:null,_currentKeyFrameIndex:null,_fromIndex:null,_toIndex:null,_betweenDuration:null,_actionTag:null,_ActionTimeline:null,_node:null,ctor:function(){this._frames=[];this._currentKeyFrame=null;this._actionTag=this._betweenDuration=this._toIndex=this._fromIndex=this._currentKeyFrameIndex=0;this._node=this._ActionTimeline=null},_gotoFrame:function(a){0!==this._frames.length&&(this._binarySearchKeyFrame(a),this._apply(a))},_stepToFrame:function(a){0!==
this._frames.length&&(this._updateCurrentKeyFrame(a),this._apply(a))},getFrames:function(){return this._frames},addFrame:function(a){this._frames.push(a);a.setTimeline(this)},insertFrame:function(a,b){this._frames.splice(b,0,a);a.setTimeline(this)},removeFrame:function(a){cc.arrayRemoveObject(this._frames,a);a.setTimeline(null)},setActionTag:function(a){this._actionTag=a},getActionTag:function(){return this._actionTag},setNode:function(a){for(var b=0;b<this._frames.length;b++)this._frames[b].setNode(a)},
getNode:function(){return this._node},setActionTimeline:function(a){this._ActionTimeline=a},getActionTimeline:function(){return this._ActionTimeline},clone:function(){var a=new ccs.Timeline;a._actionTag=this._actionTag;for(var b=0;b<this._frames.length;b++){var c=this._frames[b].clone();a.addFrame(c)}return a},_apply:function(a){this._currentKeyFrame&&this._currentKeyFrame.apply(0>=this._betweenDuration?0:(a-this._currentKeyFrameIndex)/this._betweenDuration)},_binarySearchKeyFrame:function(a){var b=
null,c=null,d=this._frames.length,e=!1;do if(a<this._frames[0].getFrameIndex())this._currentKeyFrameIndex>=this._frames[0].getFrameIndex()&&(e=!0),this._toIndex=this._fromIndex=0,b=c=this._frames[0],this._currentKeyFrameIndex=0,this._betweenDuration=this._frames[0].getFrameIndex();else if(a>=this._frames[d-1].getFrameIndex())this._fromIndex=d-1,this._toIndex=0,b=c=this._frames[d-1],this._currentKeyFrameIndex=this._frames[d-1].getFrameIndex(),this._betweenDuration=0;else{for(var f=-1,b=0,c=d-1,g=0;b<=
c;){g=Math.ceil((b+c)/2);if(a>=this._frames[g].getFrameIndex()&&a<this._frames[g+1].getFrameIndex()){f=g;break}this._frames[g].getFrameIndex()>a?c=g-1:b=g+1}this._fromIndex=f;this._toIndex=1<d?f+1|0:f|0;b=this._frames[f];c=this._frames[f+1];0===f&&this._currentKeyFrameIndex<b.getFrameIndex()&&(e=!0);this._currentKeyFrameIndex=b.getFrameIndex();this._betweenDuration=c.getFrameIndex()-b.getFrameIndex()}while(0);if(e||this._currentKeyFrame!=b)this._currentKeyFrame=b,this._currentKeyFrame.onEnter(c)},
_updateCurrentKeyFrame:function(a){if(a<this._currentKeyFrameIndex||a>=this._currentKeyFrameIndex+this._betweenDuration){var b=null,c=null;do{var d=this._frames.length;if(a<this._frames[0].getFrameIndex())b=c=this._frames[0],this._currentKeyFrameIndex=0,this._betweenDuration=this._frames[0].getFrameIndex();else{if(a>=this._frames[d-1].getFrameIndex()&&(a=this._frames[d-1].getFrameIndex(),this._currentKeyFrameIndex>=a))return;do{this._fromIndex=this._toIndex;b=this._frames[this._fromIndex];this._currentKeyFrameIndex=
b.getFrameIndex();this._toIndex=this._fromIndex+1;this._toIndex>=d&&(this._toIndex=0);c=this._frames[this._toIndex];if(a===b.getFrameIndex())break;if(a>b.getFrameIndex()&&a<c.getFrameIndex())break;if(b.isEnterWhenPassed())b.onEnter(c)}while(1);this._betweenDuration=c.getFrameIndex()-b.getFrameIndex()}}while(0);this._currentKeyFrame=b;this._currentKeyFrame.onEnter(c)}}});ccs.Timeline.create=function(){return new ccs.Timeline};ccs.SkinNode=function(){var a=cc.Node.extend({});a.create=function(){};return a}();ccs.BoneNode=function(){var a=cc.Node,b=ccs.SkinNode,c=cc.BlendFunc,d={p:cc.p,size:cc.size,rect:cc.rect},e={log:cc.log,assert:cc.assert},f=a.extend({_customCommand:null,_blendFunc:null,_rackColor:null,_rackLength:null,_rackWidth:null,_childBones:null,_boneSkins:null,_rootSkeleton:null,_squareVertices:null,_squareColors:null,_noMVPVertices:null,ctor:function(b){a.prototype.ctor.call(this);null===this._squareVertices&&(this._squareVertices=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]);this._rackColor=
cc.color.WHITE;this._blendFunc=c.ALPHA_NON_PREMULTIPLIED;this._childBones=[];this._boneSkins=[];this._rackLength=void 0===b?50:b;this._rackWidth=20;this._updateVertices()},visit:function(a){this._visit&&this._visit(a&&a._renderCmd)},addSkin:function(b,c,d){var f=this._boneSkins;e.assert(null!=b,"Argument must be non-nil");if(d)for(d=0;d<f.length;d++)f[d].setVisible(!1);a.prototype.addChild.call(this,b);this._boneSkins.push(b);b.setVisible(c)},getChildBones:function(){return this._childBones},getSkins:function(){return this._boneSkins},
displaySkin:function(a,b){var c=this._boneSkins,d,e;if("string"===typeof a)for(e=0;e<c.length;e++)d=c[e],a==d.getName()?d.setVisible(!0):b&&d.setVisible(!1);else for(e=0;e<c.length;e++)d=c[e],d==a?d.setVisible(!0):b&&d.setVisible(!1)},getVisibleSkins:function(){for(var a=[],b=this._boneSkins,c,d=0;d<b.length;d++)c=b[d],c.isVisible()&&a.push(c);return a},getRootSkeletonNode:function(){return this._rootSkeleton},getAllSubBones:function(){for(var a=[],b=[],c=this._childBones,d=0;d<c.length;d++)b.push(c[d]);
for(;0<b.length;)for(c=b.pop(),a.push(c),c=c.getChildBones(),d=0;d<c;d++)b.push(c[d]);return a},getAllSubSkins:function(){for(var a=this.getAllSubBones(),b=[],c=0;c<a.length;c++)for(var d=a[c].getSkins(),e=0;e<d.length;e++)b.push(d[c]);return b},addChild:function(b,c,d){a.prototype.addChild.call(this,b,c,d);this._addToChildrenListHelper(b)},removeChild:function(b,c){-1!==this._children.indexOf(b)&&(a.prototype.removeChild.call(this,b,c),this._removeFromChildrenListHelper(b))},setBlendFunc:function(a){var b=
this._blendFunc;if(a&&b.src!==a.src&&b.dst!==a.dst){this._blendFunc=a;for(var b=this._boneSkins,c,d=0;d<b.length;d++)c=b[d],c.setBlendFunc(a)}},getBlendFunc:function(){return this._blendFunc},setDebugDrawLength:function(a){this._rackLength=a;this._updateVertices()},getDebugDrawLength:function(){return this._rackLength},setDebugDrawWidth:function(a){this._rackWidth=a;this._updateVertices()},getDebugDrawWidth:function(){return this._rackWidth},setDebugDrawEnabled:function(a){var b=this._renderCmd;b._debug!==
a&&(b._debug=a,cc.renderer.childrenOrderDirty=!0,this._visible&&null!=this._rootSkeleton&&(this._rootSkeleton._subBonesDirty=!0,this._rootSkeleton._subBonesOrderDirty=!0))},isDebugDrawEnabled:function(){return this._renderCmd._debug},setDebugDrawColor:function(a){this._rackColor=a},getDebugDrawColor:function(){return this._rackColor},getVisibleSkinsRect:function(){var a,b,c,e=0;a=b=c=e;var f=!0,g=d.rect(0,0,0,0);this._renderCmd._debug&&null!=this._rootSkeleton&&this._rootSkeleton._renderCmd._debug&&
(c=this._rackWidth,e=this._rackLength,f=!1);for(var h=this._boneSkins,t,w=0;w<h.length;w++){t=h[w];var v=t.getBoundingBox();!t.isVisible()||0===v.x&&0===v.y&&0===v.width&&0===v.height||(f?(a=cc.rectGetMinX(v),b=cc.rectGetMinY(v),c=cc.rectGetMaxX(v),e=cc.rectGetMaxY(v),f=!1):(a=Math.min(cc.rectGetMinX(v),a),b=Math.min(cc.rectGetMinY(v),b),c=Math.max(cc.rectGetMaxX(v),c),e=Math.max(cc.rectGetMaxY(v),e)),g.setRect(a,b,c-a,e-b))}return g},getBoundingBox:function(){var a=this.getVisibleSkinsRect();return cc.rectApplyAffineTransform(a,
this.getNodeToParentAffineTransform())},batchBoneDrawToSkeleton:function(a){},setLocalZOrder:function(b){a.prototype.setLocalZOrder.call(this,b);null!=this._rootSkeleton&&(this._rootSkeleton._subBonesOrderDirty=!0)},setName:function(b){var c=this._rootSkeleton,d=this.getName();a.prototype.setName.call(this,b);if(null!=c){var d=c._subBonesMap[d],e=c._subBonesMap[b];d&&!e&&(delete c._subBonesMap[d],c._subBonesMap[b]=d)}},setContentSize:function(b){a.prototype.setContentSize.call(this,b);this._updateVertices()},
setAnchorPoint:function(b){a.prototype.setAnchorPoint.call(this,b);this._updateVertices()},setVisible:function(b){this._visible!=b&&(a.prototype.setVisible.call(this,b),null!=this._rootSkeleton&&(this._rootSkeleton._subBonesDirty=!0,this._rootSkeleton._subBonesOrderDirty=!0))},_addToChildrenListHelper:function(a){a instanceof f?this._addToBoneList(a):this._addToSkinList(a)},_removeFromChildrenListHelper:function(a){a instanceof f?this._removeFromBoneList(a):a instanceof b&&this._removeFromSkinList(skin)},
_removeFromBoneList:function(a){if(null!=this._rootSkeleton&&a instanceof ccs.SkeletonNode&&a._rootSkeleton===this._rootSkeleton){a._rootSkeleton=null;var b=a.getAllSubBones();b.push(a);for(var c,d=0;d<b.length;d++)c=b[d],c._rootSkeleton=null,delete this._rootSkeleton._subBonesMap[c.getName()],this._rootSkeleton._subBonesDirty=!0,this._rootSkeleton._subBonesOrderDirty=!0}else this._rootSkeleton._subBonesDirty=!0,this._rootSkeleton._subBonesOrderDirty=!0;cc.arrayRemoveObject(this._childBones,a)},_setRootSkeleton:function(a){this._rootSkeleton=
a;a=this.getAllSubBones();for(var b=0;b<a.length;b++)this._addToBoneList(a[b])},_addToBoneList:function(a){-1===this._childBones.indexOf(a)&&this._childBones.push(a);if(null!=this._rootSkeleton&&!(a instanceof b||a._rootSkeleton)){var c=a.getAllSubBones();c.push(a);for(var d=0;d<c.length;d++){a=c[d];a._setRootSkeleton(this._rootSkeleton);var e=a.getName();this._rootSkeleton._subBonesMap[e]?cc.log("already has a bone named %s in skeleton %s",e,this._rootSkeleton.getName()):this._rootSkeleton._subBonesMap[a.getName()]=
a;this._rootSkeleton._subBonesDirty=!0;this._rootSkeleton._subBonesOrderDirty=!0}}},_visitSkins:function(){var a=this._renderCmd;if(this._visible){var b=a.getParentRenderCmd();b&&(a._curLevel=b._curLevel+1);var c=this._boneSkins,d;a._syncStatus(b);var e=c.length;if(0<e){this.sortAllChildren();for(b=0;b<e;b++)if(d=c[b],0>d._localZOrder)d.visit(this);else break;for(;b<e;b++)c[b].visit(this)}a._dirtyFlag=0}},_addToSkinList:function(a){this._boneSkins.push(a);if(a.getBlendFunc){var b=a.getBlendFunc();
this._blendFunc.src!==b.src&&this._blendFunc.dst!==b.dst&&a.setBlendFunc(this._blendFunc)}},_removeFromSkinList:function(a){cc.arrayRemoveObject(this._boneSkins,a)},sortAllChildren:function(){this._sortArray(this._childBones);this._sortArray(this._boneSkins);a.prototype.sortAllChildren.call(this)},_sortArray:function(a){if(a){var b=a.length,c,d,e;for(c=1;c<b;c++){e=a[c];for(d=c-1;0<=d;){if(e._localZOrder<a[d]._localZOrder)a[d+1]=a[d];else if(e._localZOrder===a[d]._localZOrder&&e.arrivalOrder<a[d].arrivalOrder)a[d+
1]=a[d];else break;d--}a[d+1]=e}}},_updateVertices:function(){var a=this._squareVertices,b=this._renderCmd._anchorPointInPoints;if(this._rackLength!=a[2].x-b.x||a[3].y!=this._rackWidth/2-b.y){a[1].x=a[1].y=a[3].y=0;a[0].x=a[2].x=0.1*this._rackLength;a[2].y=0.5*this._rackWidth;a[0].y=-a[2].y;a[3].x=this._rackLength;for(var c=0;c<a.length;c++)a[c].x+=b.x,a[c].y+=b.y;this._renderCmd.updateDebugPoint(a)}},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new g(this):new h(this)}});
f.create=function(a,b){return new ccui.BoneNode(a,b)};var g=function(){var b=function(a){this._rootCtor(a);this._debug=!1;this._color=cc.color.WHITE;this._drawNode=new cc.DrawNode},c=b.prototype=Object.create(a.CanvasRenderCmd.prototype);c.constructor=b;c.updateDebugPoint=function(a){this._drawNode.clear();this._drawNode.drawPoly(a,this._color,0,this._color)};c.transform=function(a,b){var c=this._node._rootSkeleton;this.originTransform(a,b);c&&c._renderCmd._debug&&this._drawNode._renderCmd.transform(this)};
return b}(),h=function(){var b=function(a){this._rootCtor(a);this._debug=!1;this._color=cc.color.WHITE;this._drawNode=new cc.DrawNode},c=b.prototype=Object.create(a.WebGLRenderCmd.prototype);c.constructor=b;c.updateDebugPoint=function(a){this._drawNode.clear();this._drawNode.drawPoly(a,this._color,0,this._color)};c.transform=function(a,b){var c=this._node._rootSkeleton;this.originTransform(a,b);c&&c._renderCmd._debug&&this._drawNode._renderCmd.transform(this)};return b}();return f}();ccs.SkeletonNode=function(){var a=ccs.BoneNode,b=a.extend({_subBonesMap:null,_squareVertices:null,_squareColors:null,_noMVPVertices:null,_skinGroupMap:null,_sortedAllBonesDirty:!1,_sortedAllBones:null,_batchedBoneVetices:null,_batchedBoneColors:null,_batchedVeticesCount:null,_batchBoneCommand:null,_subOrderedAllBones:null,ctor:function(){this._squareVertices=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}];this._rootSkeleton=this;a.prototype.ctor.call(this);this._subBonesMap=
{};this._subOrderedAllBones=[];this._skinGroupMap={};this._rackLength=this._rackWidth=20;this._updateVertices()},getBoneNode:function(a){return(a=this._subBonesMap[a])?a:null},getAllSubBonesMap:function(){return this._subBonesMap},changeSkins:function(a){if("object"===typeof a){var b,e;for(e in a){b=a[e];var f=this.getBoneNode(e);null!==f&&f.displaySkin(b,!0)}}else(a=this._suitMap[a])&&this.changeSkins(a,!0)},addSkinGroup:function(a,b){this._skinGroupMap[a]=b},getBoundingBox:function(){var a,b,e,
f=0;a=b=e=f;var g=this.getVisibleSkinsRect(),h=!0;if(0!==g.x||0!==g.y||0!==g.width||0!==g.height)a=cc.rectGetMinX(g),b=cc.rectGetMinY(g),e=cc.rectGetMaxX(g),f=cc.rectGetMaxY(g),h=!1;for(var k=this.getAllSubBones(),m,n=0;n<k.length;n++)if(m=k[n],m=cc.rectApplyAffineTransform(m.getVisibleSkinsRect(),m.getNodeToParentTransform(m.getRootSkeletonNode())),0!==m.x||0!==m.y||0!==m.width||0!==m.height)h?(a=cc.rectGetMinX(m),b=cc.rectGetMinY(m),e=cc.rectGetMaxX(m),f=cc.rectGetMaxY(m),h=!1):(a=Math.min(cc.rectGetMinX(m),
a),b=Math.min(cc.rectGetMinY(m),b),e=Math.max(cc.rectGetMaxX(m),e),f=Math.max(cc.rectGetMaxY(m),f));g.x=a;g.y=b;g.width=e-a;g.height=f-b;return cc.rectApplyAffineTransform(g,this.getNodeToParentTransform())},_visit:function(a){var b=this._renderCmd;a=a||b.getParentRenderCmd();if(this._visible){b._syncStatus(a);var e;if(0!==this._children.length)for(a=0;a<this._children.length;a++)e=this._children[a],e.visit(this);this._checkSubBonesDirty();e=this._subOrderedAllBones;var f;for(a=0;a<e.length;a++)f=
e[a],f._visitSkins();if(b._debug)for(a=0;a<e.length;a++)f=e[a]._renderCmd,cc.renderer.pushRenderCommand(f._drawNode._renderCmd);b._dirtyFlag=0}else b._propagateFlagsDown(a)},_checkSubBonesDirty:function(){this._subBonesDirty&&(this._updateOrderedAllbones(),this._subBonesDirty=!1);this._subBonesOrderDirty&&(this._sortOrderedAllBones(),this._subBonesOrderDirty=!1)},_updateOrderedAllbones:function(){this._subOrderedAllBones.length=0;for(var a=[],b=this._childBones,e,f=0;f<b.length;f++)e=b[f],e.isVisible()&&
a.push(e);for(;0<a.length;)for(f=a.pop(),b=f._renderCmd,b._syncStatus(b.getParentRenderCmd()),this._subOrderedAllBones.push(f),b=f.getChildBones(),f=0;f<b.length;f++)e=b[f],e.isVisible()&&a.push(e)},_sortOrderedAllBones:function(){this._sortArray(this._subOrderedAllBones)},_updateVertices:function(){var a=this._squareVertices,b=this._renderCmd._anchorPointInPoints;if(this._rackLength!=a[6].x-b.x||this._rackWidth!=a[3].y-b.y){var e=0.5*this._rackLength,f=0.5*this._rackWidth,g=0.25*e,h=0.25*f;a[5].y=
a[2].y=a[1].y=a[6].y=a[0].x=a[4].x=a[7].x=a[3].x=0;a[5].x=-e;a[0].y=-f;a[6].x=e;a[3].y=f;a[1].x=g;a[7].y=h;a[2].x=-g;a[4].y=-h;for(e=0;e<a.length;e++)a[e].x+=b.x,a[e].y+=b.y}},_updateAllDrawBones:function(){this._subDrawBones={};for(var a in this._subBonesMap){var b=this._subBonesMap[a];b.isVisible()&&b.isDebugDrawEnabled()&&this._subDrawBones.push(b)}this._sortArray(this._sortedAllBones);this._subDrawBones=!1}});b.create=function(){return new b};return b}();ccs._load=function(){var a=function(a,d,h){var k=cc.loader.getRes(a);k||"res/effect/default_effect.json"==a||(a="res/effect/default_effect.json",k=cc.loader.getRes(a));if(!k)return cc.log("%s does not exist",a);var m=a.match(c),m=(m&&m[1]?m[1]:null).toLocaleLowerCase();if("json"!==m&&"exportjson"!==m)return cc.log("%s load error, must be json file",a);var n;d?n=b[d]:k.widgetTree?n=b.ccui:k.nodeTree?n=b.timeline:k.Content&&k.Content.Content?n=b.timeline:k.gameobjects&&(n=b.scene);if(!n)return cc.log("Can't find the parser : %s",
a),new cc.Node;d=k.version||k.Version;if(!d&&k.armature_data)return cc.warn("%s is armature. please use:",a),cc.warn("    ccs.armatureDataManager.addArmatureFileInfoAsync(%s);",a),cc.warn("    var armature \x3d new ccs.Armature('name');"),new cc.Node;n=e(n,d);return n?n.parse(a,k,h)||null:(cc.log("Can't find the parser : %s",a),new cc.Node)},b={ccui:{},timeline:{},action:{},scene:{}};a.registerParser=function(a,c,d){if(!a||!c||!d)return cc.log("register parser error");b[a]||(b[a]={});b[a][c]=d};a.getParser=
function(a,c){return a&&c?b[a]?b[a][c]:void 0:a?b[a]:b};var c=/\.([^\.]+)$/,d=/([^\.](\.\*)?)*$/,e=function(a,b){return a[b]?a[b]:"*"===b?null:e(a,b.replace(d,"*"))};return a}();
ccs._parser=cc.Class.extend({ctor:function(){this.parsers={}},_dirnameReg:/\S*\//,_dirname:function(a){return(a=a.match(this._dirnameReg))&&a[0]?a[0]:""},getClass:function(a){return a.classname},getNodeJson:function(a){return a.widgetTree},parse:function(a,b,c){c=c||this._dirname(a);this.pretreatment(b,c);var d=this.parseNode(this.getNodeJson(b),c,a);d&&this.deferred(b,c,d,a);return d},pretreatment:function(a,b,c){},deferred:function(a,b,c,d){},parseNode:function(a,b){var c=this.parsers[this.getClass(a)],
d=null;c?d=c.call(this,a,b):cc.log("Can't find the parser : %s",this.getClass(a));return d},registerParser:function(a,b){this.parsers[a]=b}});ccs.load=function(a,b){var c={node:null,action:null};c.node=ccs._load(a,null,b);c.action=ccs._load(a,"action",b);c.action&&-1===c.action.tag&&c.node&&(c.action.tag=c.node.tag);return c};ccs.load.validate={};ccs.load.preload=!0;
ccs.loadWithVisibleSize=function(a,b){var c=ccs.load(a,b),d=cc.director.getVisibleSize();c.node&&d&&(c.node.setContentSize(d.width,d.height),ccui.helper.doLayout(c.node));return c};ccs.actionTimelineCache={createAction:function(a){return ccs._load(a,"action")}};ccs.csLoader={createNode:function(a){return ccs._load(a)}};
cc.loader.register(["json"],{load:function(a,b,c,d){cc.loader.loadJson(a,function(a,c){var g=cc.path;if(c&&c.Content&&c.Content.Content.UsedResources){for(var h=c.Content.Content.UsedResources,k=g.dirname(b),m=[],n,p=0;p<h.length;p++)if(ccs.load.preload||!/\.(png|jpg$)/.test(h[p]))n=g.join(k,h[p]),n=g._normalize(n),ccs.load.validate[n]||(ccs.load.validate[n]=!0,m.push(n));cc.loader.load(m,function(){d(a,c)})}else d(a,c)})}});(function(a,b){var c=new (b.extend({getNodeJson:function(a){return a},parseNode:function(a,b){var c=this.parsers[this.getClass(a)],d=null;c?d=c.call(this,a,b):cc.log("Can't find the parser : %s",this.getClass(a));return d},deferred:function(a,b,c,d){ccs.triggerManager.parse(a.Triggers||[]);ccs.sceneReader&&(ccs.sceneReader._node=c)},setPropertyFromJsonDict:function(a,b){var c=cc.isUndefined(b.x)?0:b.x,d=cc.isUndefined(b.y)?0:b.y;a.setPosition(c,d);c=Boolean(cc.isUndefined(b.visible)?1:b.visible);
a.setVisible(c);c=cc.isUndefined(b.objecttag)?-1:b.objecttag;a.setTag(c);c=cc.isUndefined(b.zorder)?0:b.zorder;a.setLocalZOrder(c);c=cc.isUndefined(b.scalex)?1:b.scalex;d=cc.isUndefined(b.scaley)?1:b.scaley;a.setScaleX(c);a.setScaleY(d);c=cc.isUndefined(b.rotation)?0:b.rotation;a.setRotation(c);a.setName(b.name||"")}}));c.parseChild=function(a,b,c){for(var d=0;d<b.length;d++){var e,f=b[d];f&&(e=this.parseNode(f,c));e&&a.addChild(e)}};var d={CCSprite:function(a,b,c){var d=new cc.Sprite;f(b.fileData,
c,function(a,b){if(0===b)d.setTexture(a);else if(1===b){var c=cc.spriteFrameCache.getSpriteFrame(a);d.setSpriteFrame(c)}});b=new ccs.ComRender(d,"CCSprite");a.addComponent(b);return b},CCTMXTiledMap:function(a,b,c){var d=null;f(b.fileData,c,function(a,b){0===b&&(d=new cc.TMXTiledMap(a))});b=new ccs.ComRender(d,"CCTMXTiledMap");a.addComponent(b);return b},CCParticleSystemQuad:function(a,b,c){var d=null;f(b.fileData,c,function(a,b){0===b?d=new cc.ParticleSystem(a):cc.log("unknown resourcetype on CCParticleSystemQuad!");
d.setPosition(0,0)});b=new ccs.ComRender(d,"CCParticleSystemQuad");a.addComponent(b);return b},CCArmature:function(a,b,c){var d=null;f(b.fileData,c,function(a,b){if(0===b){var c=cc.loader.getRes(a);c||cc.log("Please load the resource [%s] first!",a);c=c.armature_data[0].name;ccs.armatureDataManager.addArmatureFileInfo(a);d=new ccs.Armature(c)}});if(d)return c=new ccs.ComRender(d,"CCArmature"),a.addComponent(c),(a=b.selectedactionname)&&d.getAnimation()&&d.getAnimation().play(a),c},CCComAudio:function(a,
b,c){var d=null;f(b.fileData,c,function(c,e){if(0===e){d=new ccs.ComAudio;d.preloadEffect(c);var f=b.name;f&&d.setName(f);a.addComponent(d)}})},CCComAttribute:function(a,b,c){var d=null;f(b.fileData,c,function(b,c){0===c?(d=new ccs.ComAttribute,""!==b&&d.parse(b),a.addComponent(d)):cc.log("unknown resourcetype on CCComAttribute!")});return d},CCBackgroundAudio:function(a,b,c){var d=null;f(b.fileData,c,function(c,e){if(0===e){d=new ccs.ComAudio;d.preloadBackgroundMusic(c);d.setFile(c);var f=Boolean(b.loop||
0);d.setLoop(f);var k=b.name;k&&d.setName(k);a.addComponent(d);d.playBackgroundMusic(c,f)}})},GUIComponent:function(a,b,c){var d=null;f(b.fileData,c,function(a,b){d=ccs._load(a,"ccui")});b=new ccs.ComRender(d,"GUIComponent");a.addComponent(b);return b},CCScene:function(){}},e={},f=function(a,b,c){if(null!=a){var d=a.path,f=a.resourceType;a=a.plist;d&&(a&&(cc.loader.getRes(b+a)?(e[b+a]=!0,cc.spriteFrameCache.addSpriteFrames(b+a)):e[b+a]||cc.log("%s need to be preloaded",b+a)),0!==f?c(d,f):c(b+d,f))}};
c.parseComponents=function(a,b,c){a&&b&&b.forEach(function(b){var e=d[b.classname],f=null;e?f=e(a,b,c):cc.log("Can't find the component parser : %s",b.classname);b=b.name;f&&b&&f.setName(b)})};c.registerParser("CCNode",function(a,b){var c=new cc.Node;this.setPropertyFromJsonDict(c,a);this.parseChild.call(this,c,a.gameobjects,b);this.parseComponents(c,a.components,b);var d=a.CanvasSize;d&&c.setContentSize(cc.size(d._width,d._height));return c});a.registerParser("scene","*",c)})(ccs._load,ccs._parser);(function(a,b){var c=Array(50),d=new (b.extend({addSpriteFrame:function(a,b){if(a)for(var c=0;c<a.length;c++)cc.spriteFrameCache.addSpriteFrames(b+a[c])},pretreatment:function(a,b){this.addSpriteFrame(a.textures,b)},parseRecursive:function(a,b){var d=1,e=null,f,p,r,s,u;for(c[0]=a;0<d;)if(d--,p=c[d],c[d]=null,p)if(r=p.classname,f=this.parsers[r]){if(r=new f.object)if(e||(e=r),s=p.options,this.generalAttributes(r,s),f.handle(r,s,b),this.colorAttributes(r,s),f=p.parent,p.parent=null,f instanceof ccui.PageView?
f.addPage(r):f instanceof ccui.ListView?f.pushBackCustomItem(r):f&&(f instanceof ccui.Layout||(r.getPositionType()===ccui.Widget.POSITION_PERCENT&&(s=r._positionPercent,u=f._anchorPoint,r._positionPercent.x=s.x+u.x,r._positionPercent.y=s.y+u.y),s=f._renderCmd._anchorPointInPoints,r._position.x+=s.x,r._position.y+=s.y,r.setNodeDirty()),f.addChild(r)),(p=p.children)&&0<p.length)for(f=p.length-1;0<=f;f--)c[d]=p[f],c[d].parent=r,d++}else cc.log("Can't find the parser : %s",r);return e},parse:function(a,
b,c){c=c||this._dirname(a);this.pretreatment(b,c);var d=this.parseRecursive(b.widgetTree,c);d&&this.deferred(b,c,d,a);return d},deferred:function(a,b,c,d){c&&(ccs.actionManager.initWithDictionary(d,a.animation,c),c.setContentSize(a.designWidth,a.designHeight))}}));d.generalAttributes=function(a,b){a._ignoreSize=b.ignoreSize||!0;a._sizeType=b.sizeType||0;a._positionType=b.positionType||0;a._sizePercent.x=b.sizePercentX||0;a._sizePercent.y=b.sizePercentY||0;a._positionPercent.x=b.positionPercentX||
0;a._positionPercent.y=b.positionPercentY||0;var c=0,d=0;b.adaptScreen?(d=cc.director.getWinSize(),c=d.width,d=d.height):(c=b.width||0,d=b.height||0);var e=b.anchorPointX,f=b.anchorPointY;a._anchorPoint.x=isNaN(e)?0.5:e;a._anchorPoint.y=isNaN(f)?0.5:f;a.setContentSize(c,d);a.setTag(b.tag);a.setActionTag(b.actiontag);a.setTouchEnabled(b.touchAble);a._name=b.name||"default";a._position.x=b.x||0;a._position.y=b.y||0;a._scaleX=b.scaleX||1;a._scaleY=b.scaleY||1;a._rotationX=a._rotationY=b.rotation||0;
a._visible=b.visible||!1;a._localZOrder=b.ZOrder||0;if(null!=b.layoutParameter){c=b.layoutParameter;d=null;switch(isNaN(c.type)?2:c.type){case 1:d=new ccui.LinearLayoutParameter;d._linearGravity=c.gravity||0;break;case 2:d=new ccui.RelativeLayoutParameter,d._relativeLayoutName=c.relativeName,d._relativeWidgetName=c.relativeToName,d._relativeAlign=c.align||0}null!=d&&(e=d._margin,e.left=c.marginLeft||0,e.top=c.marginTop||0,e.right=c.marginRight||0,e.bottom=c.marginDown||0,a.setLayoutParameter(d))}};
d.colorAttributes=function(a,b){var c=null!==b.opacity?b.opacity:255;null!=c&&a.setOpacity(c);var c=b.colorR,d=b.colorG,e=b.colorB;a.setColor(cc.color(null==c?255:c,null==d?255:d,null==e?255:e));a.setFlippedX(b.flipX);a.setFlippedY(b.flipY)};var e=function(a,b,c,d){c&&(0===b?d(a+c,b):d(c,b))};d.LayoutAttributes=function(a,b,c){var d=0,f=0;b.adaptScreen?(f=cc.director.getWinSize(),d=f.width,f=f.height):(d=b.width||0,f=b.height||0);a.setSize(cc.size(d,f));a.setClippingEnabled(b.clipAble);d=b.backGroundScale9Enable;
a.setBackGroundImageScale9Enabled(d);var f=b.bgColorR||0,p=b.bgColorG||0,r=b.bgColorB||0,s=isNaN(b.bgStartColorR)?255:b.bgStartColorR,u=isNaN(b.bgStartColorG)?255:b.bgStartColorG,t=isNaN(b.bgStartColorB)?255:b.bgStartColorB,w=isNaN(b.bgEndColorR)?255:b.bgEndColorR,v=isNaN(b.bgEndColorG)?255:b.bgEndColorG,x=isNaN(b.bgEndColorB)?255:b.bgEndColorB;a.setBackGroundColorVector(cc.p(b.vectorX||0,b.vectorY||0));var A=b.bgColorOpacity||0;a.setBackGroundColorType(b.colorType||0);a.setBackGroundColor(cc.color(s,
u,t),cc.color(w,v,x));a.setBackGroundColor(cc.color(f,p,r));a.setBackGroundColorOpacity(A);(f=b.backGroundImageData)&&e(c,f.resourceType||0,f.path,function(b,c){a.setBackGroundImage(b,c)});d&&(c=b.capInsetsX||0,d=b.capInsetsY||0,f=isNaN(b.capInsetsWidth)?1:b.capInsetsWidth,p=isNaN(b.capInsetsHeight)?1:b.capInsetsHeight,a.setBackGroundImageCapInsets(cc.rect(c,d,f,p)));b.layoutType&&a.setLayoutType(b.layoutType)};d.ButtonAttributes=function(a,b,c){var d=b.scale9Enable;a.setScale9Enabled(d);var f=b.normalData;
e(c,f.resourceType||0,f.path,function(b,c){a.loadTextureNormal(b,c)});f=b.pressedData;e(c,f.resourceType||0,f.path,function(b,c){a.loadTexturePressed(b,c)});f=b.disabledData;e(c,f.resourceType||0,f.path,function(b,c){a.loadTextureDisabled(b,c)});if(d){c=b.capInsetsX||0;var d=b.capInsetsY||0,f=isNaN(b.capInsetsWidth)?1:b.capInsetsWidth,p=isNaN(b.capInsetsHeight)?1:b.capInsetsHeight;a.setCapInsets(cc.rect(c,d,f,p));c=b.scale9Width||0;d=b.scale9Height||0;null!=c&&null!=d&&a.setSize(cc.size(c,d))}if(c=
b.text||"")a.setTitleText(c),a.setTitleColor(cc.color(null!==b.textColorR?b.textColorR:255,null!==b.textColorG?b.textColorG:255,null!==b.textColorB?b.textColorB:255)),null!=b.fontSize&&a.setTitleFontSize(b.fontSize),b.fontName&&a.setTitleFontName(b.fontName)};d.CheckBoxAttributes=function(a,b,c){var d=b.backGroundBoxData;e(c,d.resourceType||0,d.path,function(b,c){a.loadTextureBackGround(b,c)});var f=b.backGroundBoxSelectedData;e(c,f.resourceType||d.resourceType,f.path||d.path,function(b,c){a.loadTextureBackGroundSelected(b,
c)});d=b.frontCrossData;e(c,d.resourceType||0,d.path,function(b,c){a.loadTextureFrontCross(b,c)});f=b.backGroundBoxDisabledData;e(c,f.resourceType||d.resourceType,f.path||d.path,function(b,c){a.loadTextureBackGroundDisabled(b,c)});d=b.frontCrossDisabledData;e(c,d.resourceType||0,d.path,function(b,c){a.loadTextureFrontCrossDisabled(b,c)});b.selectedState&&a.setSelected(b.selectedState)};d.ImageViewAttributes=function(a,b,c){var d=b.fileNameData;e(c,d.resourceType||0,d.path,function(b,c){a.loadTexture(b,
c)});c=!1;b.scale9Enable&&(c=b.scale9Enable);a.setScale9Enabled(c);if(c){c=b.scale9Height||0;b.scale9Width&&c&&a.setSize(cc.size(b.scale9Width||0,b.scale9Height||0));c=b.capInsetsX||0;var d=b.capInsetsY||0,f=isNaN(b.capInsetsWidth)?1:b.capInsetsWidth;b=isNaN(b.capInsetsHeight)?1:b.capInsetsHeight;a.setCapInsets(cc.rect(c,d,f,b))}};d.TextAtlasAttributes=function(a,b,c){var d=b.stringValue,e=b.charMapFileData,f=b.itemWidth,r=b.itemHeight,s=b.startCharMap;if(null!=d&&e&&null!=f&&null!=r&&null!=s)switch(b=
b.charMapFileData,b.resourceType||0){case 0:a.setProperty(d,c+b.path,f,r,s);break;case 1:cc.log("Wrong res type of LabelAtlas!")}};d.TextBMFontAttributes=function(a,b,c){var d=b.fileNameData;switch(d.resourceType||0){case 0:a.setFntFile(c+d.path);break;case 1:cc.log("Wrong res type of LabelAtlas!")}a.setString(b.text||"")};var f=/\.ttf$/;d.TextAttributes=function(a,b,c){a.setTouchScaleChangeEnabled(b.touchScaleEnable);var d=b.text||"";d&&a._setString(d);null!=b.fontSize&&a._setFontSize(b.fontSize);
d=b.fontName;null!=d&&(cc.sys.isNative?f.test(d)?a.setFontName(cc.path.join(cc.loader.resPath,c,d)):a.setFontName(d):a._setFontName(d.replace(f,"")));c=b.areaHeight||0;b.areaWidth&&c&&(c=cc.size(b.areaWidth,b.areaHeight),a._setTextAreaSize(c));c=b.hAlignment||0;null!=c&&a._setTextHorizontalAlignment(c);b=b.vAlignment||0;null!=b&&a._setTextVerticalAlignment(b);a._updateUITextContentSize()};d.ListViewAttributes=function(a,b,c){d.ScrollViewAttributes(a,b,c);a.setDirection(b.direction||1);a.setGravity(b.gravity||
0);a.setItemsMargin(b.itemMargin||0)};d.LoadingBarAttributes=function(a,b,c){var d=b.textureData;e(c,d.resourceType||0,d.path,function(b,c){a.loadTexture(b,c)});c=b.scale9Enable;a.setScale9Enabled(c);if(c){c=b.capInsetsX||0;var d=b.capInsetsY||0,f=isNaN(b.capInsetsWidth)?1:b.capInsetsWidth,p=isNaN(b.capInsetsHeight)?1:b.capInsetsHeight;a.setCapInsets(cc.rect(c,d,f,p));a.setSize(cc.size(b.width||0,b.height||0))}a.setDirection(b.direction||0);a.setPercent(b.percent||0)};d.PageViewAttributes=d.LayoutAttributes;
d.ScrollViewAttributes=function(a,b,c){d.LayoutAttributes(a,b,c);a.setInnerContainerSize(cc.size(null!=b.innerWidth?b.innerWidth:200,null!=b.innerHeight?b.innerHeight:200));a.setDirection(null!=b.direction?b.direction:1);a.setBounceEnabled(b.bounceEnable)};d.SliderAttributes=function(a,b,c){var d=b.scale9Enable;a.setScale9Enabled(d);var f=b.length,p=b.barFileNameData,r=p.resourceType||0,p=p.path;null!=b.barFileName?d&&(e(c,r,p,function(b,c){a.loadBarTexture(b,c)}),a.setSize(cc.size(f,a.getContentSize().height))):
e(c,r,p,function(b,c){a.loadBarTexture(b,c)});d=b.ballNormalData;e(c,d.resourceType||0,d.path,function(b,c){a.loadSlidBallTextureNormal(b,c)});f=b.ballPressedData;e(c,f.resourceType||d.resourceType,f.path||d.path,function(b,c){a.loadSlidBallTexturePressed(b,c)});d=b.ballDisabledData;e(c,d.resourceType||0,d.path,function(b,c){a.loadSlidBallTextureDisabled(b,c)});b=b.progressBarData;e(c,b.resourceType||0,b.path,function(b,c){a.loadProgressBarTexture(b,c)})};d.TextFieldAttributes=function(a,b,c){var d=
b.placeHolder||"";d&&a.setPlaceHolder(d);a.setString(b.text||"");(d=b.fontSize)&&a.setFontSize(d);d=b.fontName;null!=d&&(cc.sys.isNative?f.test(d)?a.setFontName(cc.path.join(cc.loader.resPath,c,d)):a.setFontName(d):a.setFontName(d.replace(f,"")));c=b.touchSizeWidth||0;d=b.touchSizeHeight||0;null!=c&&null!=d&&a.setTouchSize(c,d);c=b.maxLengthEnable;a.setMaxLengthEnabled(c);c&&a.setMaxLength(b.maxLength);c=b.passwordEnable;a.setPasswordEnabled(c);c&&a.setPasswordStyleText(b.passwordStyleText);c=b.areaWidth||
0;d=b.areaHeight||0;c&&d&&(c=cc.size(c,d),a.setTextAreaSize(c));(c=b.hAlignment||0)&&a.setTextHorizontalAlignment(c);(c=b.vAlignment||0)&&a.setTextVerticalAlignment(c);c=isNaN(b.colorR)?255:b.colorR;d=isNaN(b.colorG)?255:b.colorG;b=isNaN(b.colorB)?255:b.colorB;a.setTextColor(cc.color(c,d,b))};d.parsers={Panel:{object:ccui.Layout,handle:d.LayoutAttributes},Button:{object:ccui.Button,handle:d.ButtonAttributes},CheckBox:{object:ccui.CheckBox,handle:d.CheckBoxAttributes},ImageView:{object:ccui.ImageView,
handle:d.ImageViewAttributes},LabelAtlas:{object:ccui.TextAtlas,handle:d.TextAtlasAttributes},LabelBMFont:{object:ccui.TextBMFont,handle:d.TextBMFontAttributes},Label:{object:ccui.Text,handle:d.TextAttributes},ListView:{object:ccui.ListView,handle:d.ListViewAttributes},LoadingBar:{object:ccui.LoadingBar,handle:d.LoadingBarAttributes},PageView:{object:ccui.PageView,handle:d.PageViewAttributes},ScrollView:{object:ccui.ScrollView,handle:d.ScrollViewAttributes},Slider:{object:ccui.Slider,handle:d.SliderAttributes},
TextField:{object:ccui.TextField,handle:d.TextFieldAttributes}};a.registerParser("ccui","*",d)})(ccs._load,ccs._parser);(function(a,b){var c=new (b.extend({getNodeJson:function(a){return a.action},parseNode:function(a,b,c){if(!a)return null;var g=this,h=new ccs.ActionTimeline;h.setDuration(a.duration);h.setTimeSpeed(a.speed||1);a.timelines.forEach(function(a){var c=g.parsers[a.frameType],d;c?d=c.call(g,a,b):cc.log("parser does not exist : %s",a.frameType);d&&h.addTimeline(d);"ColorFrame"===a.frameType&&h.addTimeline(g.parsers.AlphaFrame.call(g,a,b))});return h}}));[{name:"PositionFrame",handle:function(a){var b=new ccs.PositionFrame;
b.setPosition(cc.p(a.x,a.y));return b}},{name:"VisibleFrame",handle:function(a){var b=new ccs.VisibleFrame;b.setVisible(a.value);return b}},{name:"ScaleFrame",handle:function(a){var b=new ccs.ScaleFrame,c=a.y;b.setScaleX(a.x);b.setScaleY(c);return b}},{name:"RotationFrame",handle:function(a){var b=new ccs.RotationFrame;b.setRotation(a.rotation);return b}},{name:"SkewFrame",handle:function(a){var b=new ccs.SkewFrame,c=a.y;b.setSkewX(a.x);b.setSkewY(c);return b}},{name:"RotationSkewFrame",handle:function(a){var b=
new ccs.RotationSkewFrame,c=a.y;b.setSkewX(a.x);b.setSkewY(c);return b}},{name:"AnchorFrame",handle:function(a){var b=new ccs.AnchorPointFrame;b.setAnchorPoint(cc.p(a.x,a.y));return b}},{name:"InnerActionFrame",handle:function(a){var b=new ccs.InnerActionFrame,c=a.startFrame;b.setInnerActionType(a.innerActionType);b.setStartFrameIndex(c);return b}},{name:"ColorFrame",handle:function(a){var b=new ccs.ColorFrame;b.setColor(cc.color(a.red,a.green,a.blue));(new ccs.AlphaFrame).setAlpha(a.alpha);return b}},
{name:"AlphaFrame",handle:function(a){var b=new ccs.AlphaFrame;b.setAlpha(a.alpha);return b}},{name:"TextureFrame",handle:function(a){var b=new ccs.TextureFrame;a=a.value;if(null!=a){var c=a;null==cc.spriteFrameCache.getSpriteFrame(c)&&(c=ccs.csLoader.getJsonPath()+a);b.setTextureName(c)}return b}},{name:"EventFrame",handle:function(a){var b=new ccs.EventFrame;a=a.value;null!=a&&b.setEvent(a);return b}},{name:"ZOrderFrame",handle:function(a){var b=new ccs.ZOrderFrame;b.setZOrder(a.value);return b}}].forEach(function(a){c.registerParser(a.name,
function(b,c){var g=new ccs.Timeline;g.setActionTag(b.actionTag);var h=b.frames;h&&h.length&&h.forEach(function(b){var c=a.handle(b);c.setFrameIndex(b.frameIndex);c.setTween(b.tween);g.addFrame(c)});return g})});a.registerParser("action","0.*",c);a.registerParser("action","1.*",c)})(ccs._load,ccs._parser);(function(a,b){var c=new (b.extend({getNodeJson:function(a){return a.Content.Content.Animation},parseNode:function(a,b,c){if(!a)return null;var d=this,k=new ccs.ActionTimeline;k.setDuration(a.Duration);k.setTimeSpeed(a.Speed||1);a.Timelines.forEach(function(a){var c=d.parsers[a.Property],e;c?e=c.call(d,a,b):cc.log("parser does not exist : %s",a.Property);e&&k.addTimeline(e)});return k},deferred:function(a,b,c,d){b=(a=a.Content.Content.AnimationList)?a.length:0;for(d=0;d<b;d++){var k=a[d],m={name:null,
startIndex:null,endIndex:null};m.name=k.Name;m.startIndex=k.StartIndex;m.endIndex=k.EndIndex;c.addAnimationInfo(m)}}})),d=function(a,b){a.setTweenType(b.Type);var c=b.Points,d=[];c&&(c.forEach(function(a){d.push(a.X);d.push(a.Y)}),a.setEasingParams(d))};[{name:"Position",handle:function(a){var b=new ccs.PositionFrame;b.setPosition(cc.p(a.X,a.Y));return b}},{name:"VisibleForFrame",handle:function(a){var b=new ccs.VisibleFrame;b.setVisible(a.Value);return b}},{name:"Scale",handle:function(a){var b=
new ccs.ScaleFrame,c=a.Y;b.setScaleX(a.X);b.setScaleY(c);return b}},{name:"Rotation",handle:function(a){var b=new ccs.RotationFrame;b.setRotation(a.Rotation||a.Value||0);return b}},{name:"Skew",handle:function(a){var b=new ccs.SkewFrame,c=a.Y;b.setSkewX(a.X);b.setSkewY(c);return b}},{name:"RotationSkew",handle:function(a){var b=new ccs.RotationSkewFrame,c=a.Y;b.setSkewX(a.X);b.setSkewY(c);return b}},{name:"Anchor",handle:function(a){var b=new ccs.AnchorPointFrame;b.setAnchorPoint(cc.p(a.X,a.Y));return b}},
{name:"AnchorPoint",handle:function(a){var b=new ccs.AnchorPointFrame;b.setAnchorPoint(cc.p(a.X,a.Y));return b}},{name:"InnerAction",handle:function(a){var b=new ccs.InnerActionFrame,c=a.StartFrame;b.setInnerActionType(a.InnerActionType);b.setStartFrameIndex(c);return b}},{name:"CColor",handle:function(a){var b=new ccs.ColorFrame;(a=a.Color)||(a={});a.R=void 0===a.R?255:a.R;a.G=void 0===a.G?255:a.G;a.B=void 0===a.B?255:a.B;b.setColor(cc.color(a.R,a.G,a.B));return b}},{name:"Alpha",handle:function(a){var b=
new ccs.AlphaFrame;b.setAlpha(a.Value);return b}},{name:"FileData",handle:function(a,b){var c,d,k,m;c=new ccs.TextureFrame;d=a.TextureFile;null!=d&&(k=d.Plist,d=d.Path,m=cc.spriteFrameCache.getSpriteFrame(d),!m&&k&&(cc.loader.getRes(b+k)?(cc.spriteFrameCache.addSpriteFrames(b+k),m=cc.spriteFrameCache.getSpriteFrame(d)):cc.log("%s need to be preloaded",b+k)),null==m&&(d=b+d),c.setTextureName(d));return c}},{name:"FrameEvent",handle:function(a){var b=new ccs.EventFrame;a=a.Value;null!=a&&b.setEvent(a);
return b}},{name:"ZOrder",handle:function(a){var b=new ccs.ZOrderFrame;b.setZOrder(a.Value);return b}},{name:"ActionValue",handle:function(a){var b=new ccs.InnerActionFrame,c=a.InnerActionType,d=a.CurrentAniamtionName,k=a.SingleFrameIndex;a=a.FrameIndex;void 0!==a&&b.setFrameIndex(a);b.setInnerActionType(ccs.InnerActionType[c]);b.setSingleFrameIndex(k);b.setEnterWithName(!0);d&&b.setAnimationName(d);return b}},{name:"BlendFunc",handle:function(a){var b=new ccs.BlendFuncFrame;(a=a.BlendFunc)&&void 0!==
a.Src&&void 0!==a.Dst&&b.setBlendFunc(new cc.BlendFunc(a.Src,a.Dst));return b}}].forEach(function(a){c.registerParser(a.name,function(b,c){var h=new ccs.Timeline;h.setActionTag(b.ActionTag);var k=b.Frames;k&&k.length&&k.forEach(function(b){var f=a.handle(b,c);f.setFrameIndex(b.FrameIndex);f.setTween(null!=b.Tween?b.Tween:!0);(b=b.EasingData)&&d(f,b);h.addFrame(f)});return h})});a.registerParser("action","2.*",c);a.registerParser("action","*",c)})(ccs._load,ccs._parser);(function(a,b){var c={},d=new (b.extend({getNodeJson:function(a){return a.nodeTree},addSpriteFrame:function(a,b,d){if(a&&b&&a.length===b.length)for(var e=0;e<a.length;e++){var m=d+a[e];cc.loader.getRes(m)||c[m]?c[m]=!0:cc.log("%s need to be preloaded",m);cc.spriteFrameCache.addSpriteFrames(m,d+b[e])}},pretreatment:function(a,b,c){this.addSpriteFrame(a.textures,a.texturesPng,b)}}));d.generalAttributes=function(a,b){var c=null!=b.width?b.width:0,d=null!=b.height?b.height:0,e=null!=b.x?b.x:0,n=null!=
b.y?b.y:0,p=null!=b.scaleX?b.scaleX:1,r=null!=b.scaleY?b.scaleY:1,s=null!=b.rotation?b.rotation:0,u=null!=b.rotationSkewX?b.rotationSkewX:0,t=null!=b.rotationSkewY?b.rotationSkewY:0,w=null!=b.skewX?b.skewX:0,v=null!=b.skewY?b.skewY:0,x=null!=b.anchorPointX?b.anchorPointX:0.5,A=null!=b.anchorPointY?b.anchorPointY:0.5,y=null!=b.opacity?b.opacity:255,z=null!=b.colorR?b.colorR:255,B=null!=b.colorG?b.colorG:255,D=null!=b.colorB?b.colorB:255,C=null!=b.colorR?b.colorR:0,G=null!=b.tag?b.tag:0,F=null!=b.actionTag?
b.actionTag:0,E=null!=b.visible?b.visible:!0;0==e&&0==n||a.setPosition(cc.p(e,n));1!=p&&a.setScaleX(p);1!=r&&a.setScaleY(r);0!=s&&a.setRotation(s);0!=u&&a.setRotationX(u);0!=t&&a.setRotationY(t);0!=w&&a.setSkewX(w);0!=v&&a.setSkewY(v);0.5==x&&0.5==A||a.setAnchorPoint(cc.p(x,A));0==c&&0==d||a.setContentSize(cc.size(c,d));0!=C&&a.setLocalZOrder(C);!0!=E&&a.setVisible(E);255!=y&&a.setOpacity(y);255==z&&255==B&&255==D||a.setColor(cc.color(z,B,D));a.setTag(G);a.setUserObject(new ccs.ActionTimelineData(F))};
d.parseComponent=function(a,b){if(b)for(var c=0;c<b.length;++c){var d=this.loadComponent(b[c]);d&&a.addComponent(d)}};d.parseChild=function(a,b,c,d){a=c.children;for(c=0;c<a.length;c++){var e=this.parseNode(a[c],d);if(e)if(b instanceof ccui.PageView)e instanceof ccui.Layout&&b.addPage(e);else if(b instanceof ccui.ListView)e instanceof ccui.Widget&&b.pushBackCustomItem(e);else{if(!(b instanceof ccui.Layout)&&e instanceof ccui.Widget){if(e.getPositionType()===ccui.Widget.POSITION_PERCENT){var n=e.getPositionPercent(),
p=b.getAnchorPoint();e.setPositionPercent(cc.p(n.x+p.x,n.y+p.y))}n=b.getAnchorPointInPoints();e.setPosition(cc.p(e.getPositionX()+n.x,e.getPositionY()+n.y))}b.addChild(e)}}};d.initNode=function(a){var b=new cc.Node;this.generalAttributes(b,a);return b};d.initSubGraph=function(a){var b=a.fileName,b=b&&""!==b?this.createNode(b):new ccs.Node;this.generalAttributes(b,a);return b};d.initSprite=function(a,b){var c=a.fileName;if(null!=c){var d=cc.spriteFrameCache.getSpriteFrame(c),c=d?ccs.Sprite.createWithSpriteFrame(d):
new ccs.Sprite(b+c);c||(c=new cc.Sprite,cc.log("filePath is empty. Create a sprite with no texture"))}else c=new ccs.Sprite;this.generalAttributes(c,a);var d=a.flipX,e=a.flipY;!1!=d&&c.setFlippedX(d);!1!=e&&c.setFlippedY(e);return c};d.initParticle=function(a,b){var c=a.tmxFile,d=new cc.ParticleSystemQuad(a.plistFile);d.setTotalParticles(c);this.generalAttributes(d,a);return d};d.initTMXTiledMap=function(a,b){var c=a.tmxFile,d=a.tmxString,e=a.resourcePath,n=null;c&&""!==c?n=new cc.TMXTiledMap(c):
d&&""!==d&&e&&""!==e&&(n=new cc.TMXTiledMap(d,e));return n};var e=a.getParser("ccui")["*"];d.initWidget=function(a,b){var c=a.classname,d=e.parsers[c];if(!d)return cc.log("%s parser is not found",c);if(c=d.call(e,a,b)){var d=a.rotationSkewX,m=a.rotationSkewY,n=a.skewX,p=a.skewY;0!=d&&c.setRotationX(d);0!=m&&c.setRotationY(m);0!=n&&c.setSkewX(n);0!=p&&c.setSkewY(p);c.setUserObject(new ccs.ActionTimelineData(a.actionTag))}return c};[{name:"Node",handle:d.initNode},{name:"SubGraph",handle:d.initSubGraph},
{name:"Sprite",handle:d.initSprite},{name:"Particle",handle:d.initParticle},{name:"TMXTiledMap",handle:d.initTMXTiledMap},{name:"Widget",handle:d.initWidget},{name:"Panel",handle:d.initWidget},{name:"Button",handle:d.initWidget},{name:"CheckBox",handle:d.initWidget},{name:"ImageView",handle:d.initWidget},{name:"LabelAtlas",handle:d.initWidget},{name:"LabelBMFont",handle:d.initWidget},{name:"Label",handle:d.initWidget},{name:"ListView",handle:d.initWidget},{name:"LoadingBar",handle:d.initWidget},{name:"PageView",
handle:d.initWidget},{name:"ScrollView",handle:d.initWidget},{name:"Slider",handle:d.initWidget},{name:"TextField",handle:d.initWidget}].forEach(function(a){d.registerParser(a.name,function(b,c,d){var e=a.handle.call(this,b.options);this.parseComponent(e,b.components);this.parseChild(c,e,b,d);return e})});a.registerParser("timeline","0.*",d);a.registerParser("timeline","1.*",d)})(ccs._load,ccs._parser);(function(a,b){var c=new (b.extend({parse:function(a,b,c){c=void 0!==c?c:this._dirname(a);this.pretreatment(b,c,a);var d=this.parseNode(this.getNodeJson(b),c);this.deferred(b,c,d,a);return d},getNodeJson:function(a){a=a.Content;return a.ObjectData?a.ObjectData:a.Content.ObjectData},getClass:function(a){return a.ctype}})),d=function(a,b){return void 0===a?b:a};c.generalAttributes=function(a,b){null!=b.Name&&a.setName(b.Name);var c=b.Position;null==c||null==c.X&&null==c.Y||a.setPosition(cc.p(c.X||0,
c.Y||0));c=b.Scale;null!=c&&(null!=c.ScaleX&&a.setScaleX(c.ScaleX),null!=c.ScaleY&&a.setScaleY(c.ScaleY));c=b.RotationSkewX;null!=c&&a.setRotationX(c);c=b.RotationSkewY;null!=b.RotationSkewY&&a.setRotationY(c);c=b.AnchorPoint;null!=c&&(null==c.ScaleX&&(c.ScaleX=0),null==c.ScaleY&&(c.ScaleY=0),0.5==c.ScaleX&&0.5==c.ScaleY||a.setAnchorPoint(cc.p(c.ScaleX,c.ScaleY)));null!=b.ZOrder&&a.setLocalZOrder(b.ZOrder);c=d(b.VisibleForFrame,!0);a.setVisible(c);(c=b.Size)&&r(a,c);null!=b.Alpha&&a.setOpacity(b.Alpha);
a.setTag(b.Tag||0);var c=b.ActionTag||0,e=new ccs.ComExtensionData,g=b.UserData;void 0!==g&&e.setCustomProperty(g);e.setActionTag(c);a.getComponent("ComExtensionData")&&a.removeComponent("ComExtensionData");a.addComponent(e);a.setCascadeColorEnabled(!0);a.setCascadeOpacityEnabled(!0);f(a,b)};c.parseChild=function(a,b,c){if(a&&b)for(var d=0;d<b.length;d++){var e=this.parseNode(b[d],c);if(e)if(a instanceof ccui.PageView)e instanceof ccui.Layout&&a.addPage(e);else if(a instanceof ccui.ListView)e instanceof
ccui.Widget&&a.pushBackCustomItem(e);else{if(!(a instanceof ccui.Layout)&&e instanceof ccui.Widget&&e.getPositionType()===ccui.Widget.POSITION_PERCENT){var f=e.getPositionPercent(),g=a.getAnchorPoint();e.setPositionPercent(cc.p(f.x+g.x,f.y+g.y))}a.addChild(e)}}};c.initSingleNode=function(a){var b=new cc.Node;this.generalAttributes(b,a);a=a.CColor;null!=a&&b.setColor(p(a));return b};c.initSprite=function(a,b){var c=new cc.Sprite;n(a.FileData,b,function(a,b){if(0===b)c.setTexture(a);else if(1===b){var d=
cc.spriteFrameCache.getSpriteFrame(a);d&&c.setSpriteFrame(d)}});var d=a.BlendFunc;if(a.BlendFunc){var e=cc.BlendFunc.ALPHA_PREMULTIPLIED;void 0!==d.Src&&(e.src=d.Src);void 0!==d.Dst&&(e.dst=d.Dst);c.setBlendFunc(e)}a.FlipX&&c.setFlippedX(!0);a.FlipY&&c.setFlippedY(!0);this.generalAttributes(c,a);d=a.CColor;null!=d&&c.setColor(p(d));return c};c.initParticle=function(a,b){var c,d=this;n(a.FileData,b,function(b,e){cc.loader.getRes(b)||cc.log("%s need to be preloaded",b);c=new cc.ParticleSystem(b);d.generalAttributes(c,
a);c.setPositionType(cc.ParticleSystem.TYPE_GROUPED);!cc.sys.isNative&&c.setDrawMode(cc.ParticleSystem.TEXTURE_MODE);var f=a.BlendFunc;if(a.BlendFunc){var g=cc.BlendFunc.ALPHA_PREMULTIPLIED;void 0!==f.Src&&(g.src=f.Src);void 0!==f.Dst&&(g.dst=f.Dst);c.setBlendFunc(g)}});return c};c.widgetAttributes=function(a,b,c){a.setCascadeColorEnabled(!0);a.setCascadeOpacityEnabled(!0);a.setUnifySizeEnabled(!1);a.ignoreContentAdaptWithSize(!1);!c&&r(a,b.Size);(c=b.Name)&&a.setName(c);c=b.ActionTag||0;a.setActionTag(c);
var g=new ccs.ComExtensionData,h=b.UserData;void 0!==h&&g.setCustomProperty(h);g.setActionTag(c);a.getComponent("ComExtensionData")&&a.removeComponent("ComExtensionData");a.addComponent(g);(c=b.RotationSkewX)&&a.setRotationX(c);(c=b.RotationSkewY)&&a.setRotationY(c);b.FlipX&&a.setFlippedX(!0);b.FlipY&&a.setFlippedY(!0);c=b.zOrder;null!=c&&a.setLocalZOrder(c);c=d(b.VisibleForFrame,!0);a.setVisible(c);c=b.Alpha;null!=c&&a.setOpacity(c);a.setTag(b.Tag||0);a.setTouchEnabled(b.TouchEnable||!1);c=b.CallBackType;
null!=c&&a.setCallbackType(c);(c=b.CallBackName)&&a.setCallbackName(c);c=b.Position;null!=c&&a.setPosition(c.X||0,c.Y||0);g=b.Scale;null!=g&&(c=d(g.ScaleX,1),g=d(g.ScaleY,1),a.setScaleX(c),a.setScaleY(g));c=b.AnchorPoint;null!=c&&a.setAnchorPoint(c.ScaleX||0,c.ScaleY||0);c=b.CColor;null!=c&&a.setColor(p(c));f(a,b);e(a,b)};var e=function(a,b){var c=b.CallBackType,d=b.CallBackName,e=function(b){if("function"===typeof a[d])a[d](b)};"Click"===c?a.addClickEventListener(e):"Touch"===c?a.addTouchEventListener(e):
"Event"===c&&a.addCCSEventListener(e)},f=function(a,b){var c=ccui.LayoutComponent.bindLayoutComponent(a);if(c){var d=b.PositionPercentXEnable||b.PositionPercentXEnabled||!1,e=b.PositionPercentYEnable||b.PositionPercentYEnabled||!1,f=0,g=0,h=b.PrePosition;null!=h&&(f=h.X||0,g=h.Y||0);var k=b.PercentWidthEnable||b.PercentWidthEnabled||!1,m=b.PercentHeightEnable||b.PercentHeightEnabled||!1,n=0,p=0,r=b.PreSize;null!=h&&(n=r.X||0,p=r.Y||0);var F=b.StretchWidthEnable||!1,E=b.StretchHeightEnable||!1,J=b.HorizontalEdge,
h=b.VerticalEdge,r=b.LeftMargin||0,K=b.RightMargin||0,I=b.TopMargin||0,M=b.BottomMargin||0;c.setPositionPercentXEnabled(d);c.setPositionPercentYEnabled(e);c.setPositionPercentX(f);c.setPositionPercentY(g);c.setPercentWidthEnabled(k);c.setPercentHeightEnabled(m);c.setPercentWidth(n);c.setPercentHeight(p);c.setPercentWidthEnabled(k||m);c.setStretchWidthEnabled(F);c.setStretchHeightEnabled(E);d=ccui.LayoutComponent.horizontalEdge.NONE;"LeftEdge"===J?d=ccui.LayoutComponent.horizontalEdge.LEFT:"RightEdge"===
J?d=ccui.LayoutComponent.horizontalEdge.RIGHT:"BothEdge"===J&&(d=ccui.LayoutComponent.horizontalEdge.CENTER);c.setHorizontalEdge(d);d=ccui.LayoutComponent.verticalEdge.NONE;"TopEdge"===h?d=ccui.LayoutComponent.verticalEdge.TOP:"BottomEdge"===h?d=ccui.LayoutComponent.verticalEdge.BOTTOM:"BothEdge"===h&&(d=ccui.LayoutComponent.verticalEdge.CENTER);c.setVerticalEdge(d);c.setTopMargin(I);c.setBottomMargin(M);c.setLeftMargin(r);c.setRightMargin(K);c.setVerticalEdge(d);c.setTopMargin(I);c.setBottomMargin(M);
c.setLeftMargin(r);c.setRightMargin(K)}},g=function(a,b,c,d){2===a.getBackGroundColorType()?(c=c||{},d=d||{},a.setBackGroundColor(p(c),p(d))):(b=b||{},a.setBackGroundColor(p(b)))},h=function(a,b){a.setBackGroundColorVector(cc.p(b.ScaleX||0,b.ScaleY||0))};c.initPanel=function(a,b){var c=new ccui.Layout;this.widgetAttributes(c,a);var e=a.ClipAble||!1;null!=e&&c.setClippingEnabled(e);e=d(a.ComboBoxIndex,0);c.setBackGroundColorType(e);e=d(a.BackColorAlpha,255);null!=e&&c.setBackGroundColorOpacity(e);
e=a.Scale9Enable;null!=e&&c.setBackGroundImageScale9Enabled(e);var f=d(a.Alpha,255);c.setOpacity(f);n(a.FileData,b,function(a,b){c.setBackGroundImage(a,b)});e?(c.setBackGroundImageCapInsets(cc.rect(a.Scale9OriginX||0,a.Scale9OriginY||0,a.Scale9Width||0,a.Scale9Height||0)),r(c,a.Size)):c.isIgnoreContentAdaptWithSize()||r(c,a.Size);g(c,a.SingleColor,a.FirstColor,a.EndColor);h(c,a.ColorVector);return c};c.initText=function(a,b){var c=new ccui.Text,e=a.TouchScaleChangeAble;null!=e&&c.setTouchScaleChangeEnabled(e);
e=a.LabelText;null!=e&&c.setString(e);e=a.FontSize;null!=e&&c.setFontSize(e);e=a.FontName;null!=e&&c.setFontName(e);var e=a.AreaWidth,f=a.areaHeight;e&&f&&c.setTextAreaSize(cc.size(e,f));e=a.HorizontalAlignmentType||"HT_Left";switch(e){case "HT_Right":e=2;break;case "HT_Center":e=1;break;default:e=0}c.setTextHorizontalAlignment(e);e=a.VerticalAlignmentType||"VT_Top";switch(e){case "VT_Bottom":e=2;break;case "VT_Center":e=1;break;default:e=0}c.setTextVerticalAlignment(e);e=a.FontResource;null!=e&&
(e=e.Path,null!=e&&(e=cc.sys.isNative?cc.path.join(cc.loader.resPath,b,e):(e=e.match(/([^\/]+)\.(\S+)/))?e[1]:"",c.setFontName(e)));a.OutlineEnabled&&a.OutlineColor&&c.enableOutline&&c.enableOutline(p(a.OutlineColor),d(a.OutlineSize,1));a.ShadowEnabled&&a.ShadowColor&&c.enableShadow&&c.enableShadow(p(a.ShadowColor),cc.size(d(a.ShadowOffsetX,2),d(a.ShadowOffsetY,-2)),a.ShadowBlurRadius||0);e=a.IsCustomSize;null!=e&&c.ignoreContentAdaptWithSize(!e);c.setUnifySizeEnabled(!1);e=a.CColor;a.CColor=null;
c.setTextColor(p(e));this.widgetAttributes(c,a,c.isIgnoreContentAdaptWithSize());a.CColor=e;return c};c.initButton=function(a,b){var c=new ccui.Button;n(a.NormalFileData,b,function(a,b){c.loadTextureNormal(a,b)});n(a.PressedFileData,b,function(a,b){c.loadTexturePressed(a,b)});n(a.DisabledFileData,b,function(a,b){c.loadTextureDisabled(a,b)});var e=d(a.Scale9Enable,!1);e&&c.setScale9Enabled(e);var f=a.ButtonText;null!=f&&c.setTitleText(f);f=a.FontSize;null!=f&&c.setTitleFontSize(f);f=a.FontName;null!=
f&&c.setTitleFontName(f);f=a.TextColor;null!=f&&c.setTitleColor(p(f));f=d(a.DisplayState,!0);c.setBright(f);c.setEnabled(f);f=a.FontResource;null!=f&&(f=f.Path,null!=f&&(f=cc.sys.isNative?cc.path.join(cc.loader.resPath,b,f):(f=f.match(/([^\/]+)\.(\S+)/))?f[1]:"",c.setTitleFontName(f)));(f=c.getTitleRenderer())&&a.ShadowEnabled&&a.ShadowColor&&f.enableShadow&&f.enableShadow(p(a.ShadowColor),cc.size(d(a.ShadowOffsetX,2),d(a.ShadowOffsetY,-2)),a.ShadowBlurRadius||0);f&&a.OutlineEnabled&&a.OutlineColor&&
f.enableStroke&&f.enableStroke(p(a.OutlineColor),d(a.OutlineSize,1));this.widgetAttributes(c,a);e&&(c.setUnifySizeEnabled(!1),c.ignoreContentAdaptWithSize(!1),e=cc.rect(a.Scale9OriginX||0,a.Scale9OriginY||0,a.Scale9Width||0,a.Scale9Height||0),c.setCapInsets(e));r(c,a.Size);return c};c.initCheckBox=function(a,b){var c=new ccui.CheckBox;this.widgetAttributes(c,a);[{name:"NormalBackFileData",handle:c.loadTextureBackGround},{name:"PressedBackFileData",handle:c.loadTextureBackGroundSelected},{name:"NodeNormalFileData",
handle:c.loadTextureFrontCross},{name:"DisableBackFileData",handle:c.loadTextureBackGroundDisabled},{name:"NodeDisableFileData",handle:c.loadTextureFrontCrossDisabled}].forEach(function(d){n(a[d.name],b,function(a,b){d.handle.call(c,a,b)})});var e=d(a.CheckedState,!1);c.setSelected(e);e=d(a.DisplayState,!0);c.setBright(e);c.setEnabled(e);return c};c.initScrollView=function(a,b){var c=new ccui.ScrollView;this.widgetAttributes(c,a);n(a.FileData,b,function(a,b){c.setBackGroundImage(a,b)});c.setClippingEnabled(a.ClipAble||
!1);var e=d(a.ComboBoxIndex,0);c.setBackGroundColorType(e);e=a.BackColorAlpha;null!=e&&c.setBackGroundColorOpacity(e);a.Scale9Enable?(c.setBackGroundImageScale9Enabled(!0),c.setBackGroundImageCapInsets(cc.rect(a.Scale9OriginX||0,a.Scale9OriginY||0,a.Scale9Width||0,a.Scale9Height||0)),r(c,a.Size)):c.isIgnoreContentAdaptWithSize()||r(c,a.Size);g(c,a.SingleColor,a.FirstColor,a.EndColor);h(c,a.ColorVector);e=a.InnerNodeSize;e=cc.size(e.Width||0,e.Height||0);c.setInnerContainerSize(e);e=0;"Vertical"===
a.ScrollDirectionType&&(e=1);"Horizontal"===a.ScrollDirectionType&&(e=2);"Vertical_Horizontal"===a.ScrollDirectionType&&(e=3);c.setDirection(e);e=d(a.IsBounceEnabled,!1);c.setBounceEnabled(e);return c};c.initImageView=function(a,b){var c=new ccui.ImageView;n(a.FileData,b,function(a,b){c.loadTexture(a,b)});n(a.ImageFileData,b,function(a,b){c.loadTexture(a,b)});a.Scale9Enable?(c.setScale9Enabled(!0),c.setUnifySizeEnabled(!1),c.ignoreContentAdaptWithSize(!1),c.setCapInsets(cc.rect(a.Scale9OriginX||0,
a.Scale9OriginY||0,a.Scale9Width||0,a.Scale9Height||0))):r(c,a.Size);this.widgetAttributes(c,a);return c};c.initLoadingBar=function(a,b){var c=new ccui.LoadingBar;this.widgetAttributes(c,a);n(a.ImageFileData,b,function(a,b){c.loadTexture(a,b)});c.setDirection("Right_To_Left"===a.ProgressType?1:0);var e=d(a.ProgressInfo,80);null!=e&&c.setPercent(e);return c};c.initSlider=function(a,b){var c=new ccui.Slider,e=cc.loader;this.widgetAttributes(c,a);[{name:"BackGroundData",handle:c.loadBarTexture},{name:"BallNormalData",
handle:c.loadSlidBallTextureNormal},{name:"BallPressedData",handle:c.loadSlidBallTexturePressed},{name:"BallDisabledData",handle:c.loadSlidBallTextureDisabled},{name:"ProgressBarData",handle:c.loadProgressBarTexture}].forEach(function(d){n(a[d.name],b,function(a,b){0!==b||e.getRes(a)||cc.log("%s need to be preloaded",a);d.handle.call(c,a,b)})});c.setPercent(a.PercentInfo||0);var f=d(a.DisplayState,!0);c.setBright(f);c.setEnabled(f);return c};c.initPageView=function(a,b){var c=new ccui.PageView;this.widgetAttributes(c,
a);n(a.FileData,b,function(a,b){c.setBackGroundImage(a,b)});c.setClippingEnabled(a.ClipAble||!1);a.Scale9Enable&&(c.setBackGroundImageScale9Enabled(!0),c.setBackGroundImageCapInsets(cc.rect(a.Scale9OriginX||0,a.Scale9OriginY||0,a.Scale9Width||0,a.Scale9Height||0)));var e=d(a.ComboBoxIndex,0);c.setBackGroundColorType(e);g(c,a.SingleColor,a.FirstColor,a.EndColor);h(c,a.ColorVector);e=a.BackColorAlpha;null!=e&&c.setBackGroundColorOpacity(e);r(c,a.Size);return c};c.initListView=function(a,b){var c=new ccui.ListView;
this.widgetAttributes(c,a);n(a.FileData,b,function(a,b){c.setBackGroundImage(a,b)});c.setClippingEnabled(a.ClipAble||!1);var e=d(a.ComboBoxIndex,0);c.setBackGroundColorType(e);e=d(a.BackColorAlpha,255);a.Scale9Enable&&(c.setBackGroundImageScale9Enabled(!0),c.setBackGroundImageCapInsets(cc.rect(a.Scale9OriginX||0,a.Scale9OriginY||0,a.Scale9Width||0,a.Scale9Height||0)));var f=d(a.DirectionType,ccui.ListView.DIR_HORIZONTAL),k=d(a.VerticalType,"Align_Left"),m=d(a.HorizontalType,"Align_Top");f?"Vertical"===
f&&(c.setDirection(ccui.ScrollView.DIR_VERTICAL),""===m?c.setGravity(ccui.ListView.GRAVITY_LEFT):"Align_Right"===m?c.setGravity(ccui.ListView.GRAVITY_RIGHT):"Align_HorizontalCenter"===m&&c.setGravity(ccui.ListView.GRAVITY_CENTER_HORIZONTAL)):(c.setDirection(ccui.ScrollView.DIR_HORIZONTAL),"Align_Bottom"===k?c.setGravity(ccui.ListView.GRAVITY_BOTTOM):"Align_VerticalCenter"===k?c.setGravity(ccui.ListView.GRAVITY_CENTER_VERTICAL):c.setGravity(ccui.ListView.GRAVITY_TOP));f=d(a.IsBounceEnabled,!1);c.setBounceEnabled(f);
c.setItemsMargin(a.ItemMargin||0);f=a.InnerNodeSize;null!=f&&c.setInnerContainerSize(cc.size(f.Widget||0,f.Height||0));g(c,a.SingleColor,a.FirstColor,a.EndColor);h(c,a.ColorVector);null!=e&&c.setBackGroundColorOpacity(e);r(c,a.Size);return c};c.initTextAtlas=function(a,b){var c=new ccui.TextAtlas,d=a.LabelText,e=a.CharWidth,f=a.CharHeight,g=a.StartChar;n(a.LabelAtlasFileImage_CNB,b,function(a,b){cc.loader.getRes(a)||cc.log("%s need to be preloaded",a);0===b&&c.setProperty(d,a,e,f,g)});this.widgetAttributes(c,
a);c.ignoreContentAdaptWithSize(!0);return c};c.initTextBMFont=function(a,b){var c=new ccui.TextBMFont;this.widgetAttributes(c,a);n(a.LabelBMFontFile_CNB,b,function(a,b){cc.loader.getRes(a)||cc.log("%s need to be pre loaded",a);c.setFntFile(a)});c.setString(a.LabelText);c.ignoreContentAdaptWithSize(!0);return c};c.initTextField=function(a,b){var c=new ccui.TextField;a.PasswordEnable&&(c.setPasswordEnabled(!0),c.setPasswordStyleText(a.PasswordStyleText||"*"));var d=a.PlaceHolderText;null!=d&&c.setPlaceHolder(d);
d=a.FontSize;null!=d&&c.setFontSize(d);d=a.FontName;null!=d&&c.setFontName(d);a.MaxLengthEnable&&(c.setMaxLengthEnabled(!0),c.setMaxLength(a.MaxLengthText||0));this.widgetAttributes(c,a);d=a.LabelText;null!=d&&c.setString(d);d=a.FontResource;null!=d&&(d=d.Path,null!=d&&(d=cc.sys.isNative?cc.path.join(cc.loader.resPath,b,d):(d=d.match(/([^\/]+)\.(\S+)/))?d[1]:"",c.setFontName(d)));c.setUnifySizeEnabled(!1);c.ignoreContentAdaptWithSize(!1);d=a.CColor;null!=d&&c.setTextColor(p(d));c.isIgnoreContentAdaptWithSize()||
(r(c,a.Size),cc.sys.isNative&&c.getVirtualRenderer().setLineBreakWithoutSpace(!0));return c};c.initSimpleAudio=function(a,b){var c=new ccs.ComAudio;c.setLoop(a.Loop||!1);n(a.FileData,b,function(a,b){c.setFile(a)})};c.initGameMap=function(a,b){var d=null;n(a.FileData,b,function(b,e){0===e&&(d=new cc.TMXTiledMap(b));c.generalAttributes(d,a)});return d};c.initProjectNode=function(a,b){var d=a.FileData;if(null!=d&&d.Path){d=b+d.Path;if(cc.loader.getRes(d)){d=ccs.load(d,b);c.generalAttributes(d.node,a);
if(d.action&&d.node){d.action.tag=d.node.tag;var e=a.InnerActionSpeed;void 0!==e&&d.action.setTimeSpeed(e);d.node.runAction(d.action);d.action.gotoFrameAndPause(0)}return d.node}cc.log("%s need to be preloaded",d)}};var k=function(a){return a?(a=a.match(/([^\/]+)\.[^\/]+$/))&&a[1]?a[1]:"":""};c.initArmature=function(a,b){var d=new ccs.Armature,e=a.IsLoop,f=a.IsAutoPlay,g=a.CurrentAnimationName;n(a.FileData,b,function(a,b){var c,h,m=cc.loader.getRes(a);m?(c=m.config_file_path,h=m.config_png_path,c.forEach(function(a,
b){h[b]&&cc.spriteFrameCache.addSpriteFrames(a,h[b])})):cc.log("%s need to be preloaded",a);ccs.armatureDataManager.addArmatureFileInfo(a);d.init(k(a));f?d.getAnimation().play(g,-1,e):(d.getAnimation().play(g),d.getAnimation().gotoAndPause(0))});delete a.AnchorPoint;delete a.Size;c.generalAttributes(d,a);d.setColor(p(a.CColor));return d};c.initBoneNode=function(a,b){var d=new ccs.BoneNode,e=a.Length;void 0!==e&&d.setDebugDrawLength(e);(e=a.BlendFunc)&&void 0!==e.Src&&void 0!==e.Dst&&d.setBlendFunc(new cc.BlendFunc(e.Src,
e.Dst));c.generalAttributes(d,a);e=a.CColor;!e||void 0===e.R&&void 0===e.G&&void 0===e.B||d.setColor(p(e));return d};c.initSkeletonNode=function(a){var b=new ccs.SkeletonNode;c.generalAttributes(b,a);a=a.CColor;!a||void 0===a.R&&void 0===a.G&&void 0===a.B||b.setColor(p(a));return b};var m={},n=function(a,b,c){if(null!=a){var d=a.Path,e;e="Default"===a.Type||"Normal"===a.Type?0:1;if(a=a.Plist)cc.loader.getRes(b+a)?(m[b+a]=!0,cc.spriteFrameCache.addSpriteFrames(b+a)):m[b+a]||cc.spriteFrameCache.getSpriteFrame(d)||
cc.log("%s need to be preloaded",b+a);0!==e?cc.spriteFrameCache.getSpriteFrame(d)?c(d,e):cc.log("failed to get spriteFrame: %s",d):c(b+d,e)}},p=function(a){if(a)return cc.color(null!=a.R?a.R:255,null!=a.G?a.G:255,null!=a.B?a.B:255,null!=a.A?a.A:255)},r=function(a,b){var c=b.X||0,d=b.Y||0;b&&a.setContentSize(cc.size(c,d))};[{name:"SingleNodeObjectData",handle:c.initSingleNode},{name:"NodeObjectData",handle:c.initSingleNode},{name:"LayerObjectData",handle:c.initSingleNode},{name:"GameNodeObjectData",
handle:c.initSingleNode},{name:"GameLayerObjectData",handle:c.initSingleNode},{name:"SpriteObjectData",handle:c.initSprite},{name:"ParticleObjectData",handle:c.initParticle},{name:"PanelObjectData",handle:c.initPanel},{name:"TextObjectData",handle:c.initText},{name:"ButtonObjectData",handle:c.initButton},{name:"CheckBoxObjectData",handle:c.initCheckBox},{name:"ScrollViewObjectData",handle:c.initScrollView},{name:"ImageViewObjectData",handle:c.initImageView},{name:"LoadingBarObjectData",handle:c.initLoadingBar},
{name:"SliderObjectData",handle:c.initSlider},{name:"PageViewObjectData",handle:c.initPageView},{name:"ListViewObjectData",handle:c.initListView},{name:"TextAtlasObjectData",handle:c.initTextAtlas},{name:"TextBMFontObjectData",handle:c.initTextBMFont},{name:"TextFieldObjectData",handle:c.initTextField},{name:"SimpleAudioObjectData",handle:c.initSimpleAudio},{name:"GameMapObjectData",handle:c.initGameMap},{name:"ProjectNodeObjectData",handle:c.initProjectNode},{name:"ArmatureNodeObjectData",handle:c.initArmature},
{name:"BoneNodeObjectData",handle:c.initBoneNode},{name:"SkeletonNodeObjectData",handle:c.initSkeletonNode}].forEach(function(a){c.registerParser(a.name,function(b,c){var d=a.handle.call(this,b,c);this.parseChild(d,b.Children,c);return d})});a.registerParser("timeline","2.*",c);a.registerParser("timeline","*",c)})(ccs._load,ccs._parser);(function(){ccs.uiReader={_fileDesignSizes:{},widgetFromJsonFile:function(a){var c=cc.loader.getRes(a);c&&(this._fileDesignSizes[a]=cc.size(c.designWidth||0,c.designHeight||0));var c=c.Version||c.version,d=ccs.uiReader.getVersionInteger(c);return!c||1700<=d?(cc.warn("Not supported file types, Please try use the ccs.load"),null):ccs._load(a,"ccui")},registerTypeAndCallBack:function(a,c,d,e){var f=ccs._load.getParser("ccui")["*"],g=e.bind(d);f.registerParser(a,function(e,f){var m=new c,n=e.options;
d.setPropsFromJsonDictionary&&d.setPropsFromJsonDictionary(m,n);this.generalAttributes(m,n);var p=n.customProperty,p=p?JSON.parse(p):{};g(a,m,p);this.colorAttributes(m,n);this.anchorPointAttributes(m,n);this.parseChild.call(this,m,e,f);return m})},getVersionInteger:function(a){if(!a||"string"!==typeof a)return 0;a=a.split(".");if(4!==a.length)return 0;var c=0;a.forEach(function(a,b){c+=a*Math.pow(10,3-b)});return c},storeFileDesignSize:function(a,c){this._fileDesignSizes[a]=c},getFileDesignSize:function(a){return this._fileDesignSizes[a]},
getFilePath:function(){return this._filePath},setFilePath:function(a){this._filePath=a},getParseObjectMap:function(){return ccs._load.getParser("ccui")["*"].parsers},getParseCallBackMap:function(){return ccs._load.getParser("ccui")["*"].parsers},clear:function(){}};var a=ccs._load.getParser("ccui")["*"];ccs.imageViewReader={setPropsFromJsonDictionary:a.ImageViewAttributes};ccs.buttonReader={setPropsFromJsonDictionary:a.ButtonAttributes};ccs.checkBoxReader={setPropsFromJsonDictionary:a.CheckBoxAttributes};
ccs.labelAtlasReader={setPropsFromJsonDictionary:a.TextAtlasAttributes};ccs.labelBMFontReader={setPropsFromJsonDictionary:a.TextBMFontAttributes};ccs.labelReader={setPropsFromJsonDictionary:a.TextAttributes};ccs.layoutReader={setPropsFromJsonDictionary:a.LayoutAttributes};ccs.listViewReader={setPropsFromJsonDictionary:a.ListViewAttributes};ccs.loadingBarReader={setPropsFromJsonDictionary:a.LoadingBarAttributes};ccs.pageViewReader={setPropsFromJsonDictionary:a.PageViewAttributes};ccs.scrollViewReader=
{setPropsFromJsonDictionary:a.ScrollViewAttributes};ccs.sliderReader={setPropsFromJsonDictionary:a.SliderAttributes};ccs.textFieldReader={setPropsFromJsonDictionary:a.TextFieldAttributes}})();
(function(){ccs.sceneReader={_node:null,createNodeWithSceneFile:function(a){return this._node=a=ccs._load(a,"scene")},getNodeByTag:function(a){return null==this._node?null:this._node.getTag()===a?this._node:this._nodeByTag(this._node,a)},_nodeByTag:function(a,b){if(null==a)return null;for(var c=null,d=a.getChildren(),e=0;e<d.length&&(!(c=d[e])||c.getTag()!==b)&&!(c=this._nodeByTag(c,b));e++);return c},version:function(){return"*"},setTarget:function(){},clear:function(){ccs.triggerManager.removeAll();
cc.audioEngine.end()}}})();cc.CONTROL_EVENT_TOTAL_NUMBER=9;cc.CONTROL_EVENT_TOUCH_DOWN=1;cc.CONTROL_EVENT_TOUCH_DRAG_INSIDE=2;cc.CONTROL_EVENT_TOUCH_DRAG_OUTSIDE=4;cc.CONTROL_EVENT_TOUCH_DRAG_ENTER=8;cc.CONTROL_EVENT_TOUCH_DRAG_EXIT=16;cc.CONTROL_EVENT_TOUCH_UP_INSIDE=32;cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE=64;cc.CONTROL_EVENT_TOUCH_CANCEL=128;cc.CONTROL_EVENT_VALUECHANGED=256;cc.CONTROL_STATE_NORMAL=1;cc.CONTROL_STATE_HIGHLIGHTED=2;cc.CONTROL_STATE_DISABLED=4;cc.CONTROL_STATE_SELECTED=8;cc.CONTROL_STATE_INITIAL=8;
cc.Control=cc.Layer.extend({_isOpacityModifyRGB:!1,_hasVisibleParents:!1,_touchListener:null,_className:"Control",isOpacityModifyRGB:function(){return this._isOpacityModifyRGB},setOpacityModifyRGB:function(a){this._isOpacityModifyRGB=a;for(var b=this.getChildren(),c=0,d=b.length;c<d;c++){var e=b[c];e&&e.setOpacityModifyRGB(a)}},_state:cc.CONTROL_STATE_NORMAL,getState:function(){return this._state},_enabled:!1,_selected:!1,_highlighted:!1,_dispatchTable:null,setEnabled:function(a){this._state=(this._enabled=
a)?cc.CONTROL_STATE_NORMAL:cc.CONTROL_STATE_DISABLED;this.needsLayout()},isEnabled:function(){return this._enabled},setSelected:function(a){this._selected=a;this.needsLayout()},isSelected:function(){return this._selected},setHighlighted:function(a){this._highlighted=a;this.needsLayout()},isHighlighted:function(){return this._highlighted},hasVisibleParents:function(){for(var a=this.getParent();null!=a;a=a.getParent())if(!a.isVisible())return!1;return!0},ctor:function(){cc.Layer.prototype.ctor.call(this);
this._dispatchTable={};this._color=cc.color.WHITE},init:function(){this._state=cc.CONTROL_STATE_NORMAL;this._enabled=!0;this._highlighted=this._selected=!1;var a=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0});this.onTouchBegan&&(a.onTouchBegan=this.onTouchBegan.bind(this));this.onTouchMoved&&(a.onTouchMoved=this.onTouchMoved.bind(this));this.onTouchEnded&&(a.onTouchEnded=this.onTouchEnded.bind(this));this.onTouchCancelled&&(a.onTouchCancelled=this.onTouchCancelled.bind(this));
this._touchListener=a;return!0},onEnter:function(){var a=this._touchListener;a._isRegistered()||cc.eventManager.addListener(a,this);cc.Node.prototype.onEnter.call(this)},sendActionsForControlEvents:function(a){for(var b=0,c=cc.CONTROL_EVENT_TOTAL_NUMBER;b<c;b++)if(a&1<<b)for(var d=this._dispatchListforControlEvent(1<<b),e=0,f=d.length;e<f;e++)d[e].invoke(this)},addTargetWithActionForControlEvents:function(a,b,c){for(var d=0,e=cc.CONTROL_EVENT_TOTAL_NUMBER;d<e;d++)c&1<<d&&this._addTargetWithActionForControlEvent(a,
b,1<<d)},removeTargetWithActionForControlEvents:function(a,b,c){for(var d=0,e=cc.CONTROL_EVENT_TOTAL_NUMBER;d<e;d++)c&1<<d&&this._removeTargetWithActionForControlEvent(a,b,1<<d)},getTouchLocation:function(a){a=a.getLocation();return this.convertToNodeSpace(a)},isTouchInside:function(a){a=a.getLocation();a=this.getParent().convertToNodeSpace(a);return cc.rectContainsPoint(this.getBoundingBox(),a)},_invocationWithTargetAndActionForControlEvent:function(a,b,c){return null},_dispatchListforControlEvent:function(a){a=
a.toString();this._dispatchTable[a]||(this._dispatchTable[a]=[]);return this._dispatchTable[a]},_addTargetWithActionForControlEvent:function(a,b,c){a=new cc.Invocation(a,b,c);this._dispatchListforControlEvent(c).push(a)},_removeTargetWithActionForControlEvent:function(a,b,c){c=this._dispatchListforControlEvent(c);if(a||b)for(var d=0;d<c.length;){var e=c[d],f=!0;a&&(f=a===e.getTarget());b&&(f=f&&b===e.getAction());f?cc.arrayRemoveObject(c,e):d++}else c.length=0},needsLayout:function(){}});_p=cc.Control.prototype;
cc.defineGetterSetter(_p,"state",_p.getState);cc.defineGetterSetter(_p,"enabled",_p.isEnabled,_p.setEnabled);cc.defineGetterSetter(_p,"selected",_p.isSelected,_p.setSelected);cc.defineGetterSetter(_p,"highlighted",_p.isHighlighted,_p.setHighlighted);_p=null;cc.Control.create=function(){var a=new cc.Control;return a&&a.init()?a:null};cc.CONTROL_ZOOM_ACTION_TAG=3435855873;
cc.ControlButton=cc.Control.extend({_doesAdjustBackgroundImage:!1,zoomOnTouchDown:!1,_preferredSize:null,_labelAnchorPoint:null,_currentTitle:null,_currentTitleColor:null,_titleLabel:null,_backgroundSprite:null,_opacity:0,_isPushed:!1,_titleDispatchTable:null,_titleColorDispatchTable:null,_titleLabelDispatchTable:null,_backgroundSpriteDispatchTable:null,_parentInited:!1,_marginV:0,_marginH:0,_className:"ControlButton",ctor:function(a,b,c){cc.Control.prototype.ctor.call(this);this._preferredSize=cc.size(0,
0);this._labelAnchorPoint=cc.p(0,0);this._currentTitle="";this._currentTitleColor=cc.color.WHITE;this._titleDispatchTable={};this._titleColorDispatchTable={};this._titleLabelDispatchTable={};this._backgroundSpriteDispatchTable={};void 0!=c?this.initWithTitleAndFontNameAndFontSize(a,b,c):void 0!=b?this.initWithLabelAndBackgroundSprite(a,b):void 0!=a?this.initWithBackgroundSprite(a):this.init()},init:function(){return this.initWithLabelAndBackgroundSprite(new cc.LabelTTF("","Arial",12),new cc.Scale9Sprite)},
needsLayout:function(){if(this._parentInited){this._titleLabel&&this._titleLabel.setVisible(!1);this._backgroundSprite&&this._backgroundSprite.setVisible(!1);this.setLabelAnchorPoint(this._labelAnchorPoint);var a=this._state;this._currentTitle=this.getTitleForState(a);this._currentTitleColor=this.getTitleColorForState(a);var b=this._titleLabel=this.getTitleLabelForState(a);b&&b.setString&&b.setString(this._currentTitle);b&&b.setColor(this._currentTitleColor);var c=this.getContentSize();b&&b.setPosition(c.width/
2,c.height/2);(a=this._backgroundSprite=this.getBackgroundSpriteForState(a))&&a.setPosition(c.width/2,c.height/2);c=cc.size(0,0);if(b){var d=b.getBoundingBox();c.width=d.width;c.height=d.height}this._doesAdjustBackgroundImage?a&&a.setContentSize(c.width+2*this._marginH,c.height+2*this._marginV):a&&(d=a.getPreferredSize(),d=cc.size(d.width,d.height),0>=d.width&&(d.width=c.width),0>=d.height&&(d.height=c.height),a.setContentSize(d));c=b?b.getBoundingBox():cc.rect(0,0,0,0);d=a?a.getBoundingBox():cc.rect(0,
0,0,0);c=cc.rectUnion(c,d);this.setContentSize(c.width,c.height);c=this.getContentSize();b&&(b.setPosition(c.width/2,c.height/2),b.setVisible(!0));a&&(a.setPosition(c.width/2,c.height/2),a.setVisible(!0))}},initWithLabelAndBackgroundSprite:function(a,b){if(!a)throw Error("cc.ControlButton.initWithLabelAndBackgroundSprite(): label should be non-null");if(!b)throw Error("cc.ControlButton.initWithLabelAndBackgroundSprite(): backgroundSprite should be non-null");if(cc.Control.prototype.init.call(this,
!0)){this._parentInited=!0;this._titleDispatchTable={};this._titleColorDispatchTable={};this._titleLabelDispatchTable={};this._backgroundSpriteDispatchTable={};this._isPushed=!1;this.zoomOnTouchDown=!0;this._currentTitle=null;this.setAdjustBackgroundImage(!0);this.setPreferredSize(cc.size(0,0));this.zoomOnTouchDown=!0;this.ignoreAnchorPointForPosition(!1);this.setAnchorPoint(0.5,0.5);this._titleLabel=a;this._backgroundSprite=b;this.setOpacity(255);this.setOpacityModifyRGB(!0);var c=a.getString();
this.setTitleForState(c,cc.CONTROL_STATE_NORMAL);this.setTitleColorForState(a.getColor(),cc.CONTROL_STATE_NORMAL);this.setTitleLabelForState(a,cc.CONTROL_STATE_NORMAL);this.setBackgroundSpriteForState(b,cc.CONTROL_STATE_NORMAL);this._state=cc.CONTROL_STATE_NORMAL;this._marginH=24;this._marginV=12;this._labelAnchorPoint=cc.p(0.5,0.5);this.setPreferredSize(cc.size(0,0));this.needsLayout();return!0}return!1},initWithTitleAndFontNameAndFontSize:function(a,b,c){a=new cc.LabelTTF(a,b,c);return this.initWithLabelAndBackgroundSprite(a,
new cc.Scale9Sprite)},initWithBackgroundSprite:function(a){var b=new cc.LabelTTF("","Arial",30);return this.initWithLabelAndBackgroundSprite(b,a)},doesAdjustBackgroundImage:function(){return this._doesAdjustBackgroundImage},setAdjustBackgroundImage:function(a){this._doesAdjustBackgroundImage=a;this.needsLayout()},getZoomOnTouchDown:function(){return this.zoomOnTouchDown},setZoomOnTouchDown:function(a){return this.zoomOnTouchDown=a},getPreferredSize:function(){return this._preferredSize},setPreferredSize:function(a){if(0===
a.width&&0===a.height)this._doesAdjustBackgroundImage=!0;else{this._doesAdjustBackgroundImage=!1;var b=this._backgroundSpriteDispatchTable,c;for(c in b)b[c].setPreferredSize(a)}this._preferredSize=a;this.needsLayout()},getLabelAnchorPoint:function(){return this._labelAnchorPoint},setLabelAnchorPoint:function(a){this._labelAnchorPoint=a;this._titleLabel&&this._titleLabel.setAnchorPoint(a)},_getCurrentTitle:function(){return this._currentTitle},_getCurrentTitleColor:function(){return this._currentTitleColor},
getOpacity:function(){return this._opacity},setOpacity:function(a){cc.Control.prototype.setOpacity.call(this,a);var b=this._backgroundSpriteDispatchTable,c;for(c in b)b[c].setOpacity(a)},setColor:function(a){cc.Control.prototype.setColor.call(this,a);var b=this._backgroundSpriteDispatchTable,c;for(c in b)b[c].setColor(a)},getColor:function(){var a=this._realColor;return cc.color(a.r,a.g,a.b,a.a)},isPushed:function(){return this._isPushed},_getVerticalMargin:function(){return this._marginV},_getHorizontalOrigin:function(){return this._marginH},
setMargins:function(a,b){this._marginV=b;this._marginH=a;this.needsLayout()},setEnabled:function(a){cc.Control.prototype.setEnabled.call(this,a);this.needsLayout()},setSelected:function(a){cc.Control.prototype.setSelected.call(this,a);this.needsLayout()},setHighlighted:function(a){this._state=a?cc.CONTROL_STATE_HIGHLIGHTED:cc.CONTROL_STATE_NORMAL;cc.Control.prototype.setHighlighted.call(this,a);(a=this.getActionByTag(cc.CONTROL_ZOOM_ACTION_TAG))&&this.stopAction(a);this.zoomOnTouchDown&&(a=this.isHighlighted()&&
this.isEnabled()&&!this.isSelected()?1.1:1,a=cc.scaleTo(0.05,a),a.setTag(cc.CONTROL_ZOOM_ACTION_TAG),this.runAction(a))},onTouchBegan:function(a,b){if(!(this.isTouchInside(a)&&this.isEnabled()&&this.isVisible()&&this.hasVisibleParents()))return!1;this._isPushed=!0;this.setHighlighted(!0);this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DOWN);return!0},onTouchMoved:function(a,b){if(this._enabled&&this._isPushed&&!this._selected){var c=this.isTouchInside(a);c&&!this._highlighted?(this.setHighlighted(!0),
this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DRAG_ENTER)):c&&this._highlighted?this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DRAG_INSIDE):!c&&this._highlighted?(this.setHighlighted(!1),this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DRAG_EXIT)):c||this._highlighted||this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_DRAG_OUTSIDE)}else this._highlighted&&this.setHighlighted(!1)},onTouchEnded:function(a,b){this._isPushed=!1;this.setHighlighted(!1);this.isTouchInside(a)?
this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_UP_INSIDE):this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_UP_OUTSIDE)},onTouchCancelled:function(a,b){this._isPushed=!1;this.setHighlighted(!1);this.sendActionsForControlEvents(cc.CONTROL_EVENT_TOUCH_CANCEL)},getTitleForState:function(a){var b=this._titleDispatchTable;return b?b[a]?b[a]:b[cc.CONTROL_STATE_NORMAL]:""},setTitleForState:function(a,b){this._titleDispatchTable[b]=a||"";this.getState()===b&&this.needsLayout()},getTitleColorForState:function(a){return(a=
this._titleColorDispatchTable[a])?a:(a=this._titleColorDispatchTable[cc.CONTROL_STATE_NORMAL])?a:cc.color.WHITE},setTitleColorForState:function(a,b){this._titleColorDispatchTable[b]=a;this.getState()===b&&this.needsLayout()},getTitleLabelForState:function(a){var b=this._titleLabelDispatchTable;return b[a]?b[a]:b[cc.CONTROL_STATE_NORMAL]},setTitleLabelForState:function(a,b){var c=this._titleLabelDispatchTable;if(c[b]){var d=c[b];d&&this.removeChild(d,!0)}c[b]=a;a.setVisible(!1);a.setAnchorPoint(0.5,
0.5);this.addChild(a,1);this.getState()===b&&this.needsLayout()},setTitleTTFForState:function(a,b){var c=this.getTitleForState(b);c||(c="");this.setTitleLabelForState(new cc.LabelTTF(c,a,12),b)},getTitleTTFForState:function(a){a=this.getTitleLabelForState(a);return null!=a&&a instanceof cc.LabelTTF?a.getFontName():""},setTitleTTFSizeForState:function(a,b){var c=this.getTitleLabelForState(b);null!=c&&c instanceof cc.LabelTTF&&c.setFontSize(a)},getTitleTTFSizeForState:function(a){a=this.getTitleLabelForState(a);
return null!=a&&a instanceof cc.LabelTTF?a.getFontSize():0},setTitleBMFontForState:function(a,b){var c=this.getTitleForState(b);c||(c="");this.setTitleLabelForState(new cc.LabelBMFont(c,a),b)},getTitleBMFontForState:function(a){a=this.getTitleLabelForState(a);return null!=a&&a instanceof cc.LabelBMFont?a.getFntFile():""},getBackgroundSpriteForState:function(a){var b=this._backgroundSpriteDispatchTable;return b[a]?b[a]:b[cc.CONTROL_STATE_NORMAL]},setBackgroundSpriteForState:function(a,b){var c=this._backgroundSpriteDispatchTable;
if(c[b]){var d=c[b];d&&this.removeChild(d,!0)}c[b]=a;a.setVisible(!1);a.setAnchorPoint(0.5,0.5);this.addChild(a);c=this._preferredSize;0===c.width&&0===c.height||a.setPreferredSize(c);this._state===b&&this.needsLayout()},setBackgroundSpriteFrameForState:function(a,b){var c=cc.Scale9Sprite.createWithSpriteFrame(a);this.setBackgroundSpriteForState(c,b)}});_p=cc.ControlButton.prototype;cc.defineGetterSetter(_p,"adjustBackground",_p.getAdjustBackgroundImage,_p.setAdjustBackgroundImage);
cc.defineGetterSetter(_p,"preferredSize",_p.getPreferredSize,_p.setPreferredSize);cc.defineGetterSetter(_p,"labelAnchor",_p.getLabelAnchorPoint,_p.setLabelAnchorPoint);_p=null;cc.ControlButton.create=function(a,b,c){return new cc.ControlButton(a,b,c)};cc.RGBA=function(a,b,c,d){this.r=a;this.g=b;this.b=c;this.a=d};cc.HSV=function(a,b,c){this.h=a;this.s=b;this.v=c};cc.ControlUtils={};cc.ControlUtils.addSpriteToTargetWithPosAndAnchor=function(a,b,c,d){a=new cc.Sprite("#"+a);if(!a)return null;a.setPosition(c);a.setAnchorPoint(d);b.addChild(a);return a};
cc.ControlUtils.HSVfromRGB=function(a){var b=new cc.HSV,c,d;c=a.r<a.g?a.r:a.g;c=c<a.b?c:a.b;d=a.r>a.g?a.r:a.g;d=d>a.b?d:a.b;b.v=d;c=d-c;if(0<d)b.s=c/d;else return b.s=0,b.h=-1,b;b.h=a.r>=d?(a.g-a.b)/c:a.g>=d?2+(a.b-a.r)/c:4+(a.r-a.g)/c;b.h*=60;0>b.h&&(b.h+=360);return b};
cc.ControlUtils.RGBfromHSV=function(a){var b,c,d,e,f=new cc.RGBA;f.a=1;if(0>=a.s){if(!a.h)return f.r=a.v,f.g=a.v,f.b=a.v,f;f.r=0;f.g=0;f.b=0;return f}b=a.h;360<=b&&(b=0);b/=60;e=0|b;d=b-e;b=a.v*(1-a.s);c=a.v*(1-a.s*d);d=a.v*(1-a.s*(1-d));switch(e){case 0:f.r=a.v;f.g=d;f.b=b;break;case 1:f.r=c;f.g=a.v;f.b=b;break;case 2:f.r=b;f.g=a.v;f.b=d;break;case 3:f.r=b;f.g=c;f.b=a.v;break;case 4:f.r=d;f.g=b;f.b=a.v;break;default:f.r=a.v,f.g=b,f.b=c}return f};
cc.ControlUtils.CCRectUnion=function(a,b){return cc.rectUnion(a,b)};cc.Invocation=cc.Class.extend({_action:null,_target:null,_controlEvent:null,ctor:function(a,b,c){this._target=a;this._action=b;this._controlEvent=c},getAction:function(){return this._action},getTarget:function(){return this._target},getControlEvent:function(){return this._controlEvent},invoke:function(a){if(this._target&&this._action)if(cc.isString(this._action))this._target[this._action](a,this._controlEvent);else this._action.call(this._target,a,this._controlEvent)}});cc.Spacer=cc.Layer.extend({});cc.Spacer.verticalSpacer=function(a){var b=new cc.Spacer;b.init();b.setContentSize(0,a);return b};cc.Spacer.horizontalSpacer=function(a){var b=new cc.Spacer;b.init();b.setContentSize(a,0);return b};
cc.MenuPassive=cc.Layer.extend({_color:null,_opacity:0,_className:"MenuPassive",ctor:function(){},getColor:function(){var a=this._color;return cc.color(a.r,a.g,a.b,a.a)},setColor:function(a){var b=this._color;b.r=a.r;b.g=a.g;b.b=a.b;if(this._children&&0<this._children.length)for(b=0;b<this._children.length;b++)this._children[b]&&this._children[b].setColor(a);void 0===a.a||a.a_undefined||this.setOpacity(a.a)},getOpacity:function(){return this._opacity},setOpacity:function(a){this._opacity=a;if(this._children&&
0<this._children.length)for(var b=0;b<this._children.length;b++)this._children[b]&&this._children[b].setOpacity(a);this._color.a=a},initWithItems:function(a,b){if(this.init()){var c=cc.director.getWinSize();this.ignoreAnchorPointForPosition(!0);this.setAnchorPoint(0.5,0.5);this.setContentSize(c);this.setPosition(c.width/2,c.height/2);c=0;if(a){this.addChild(a,c);for(var d=0;d<b.length;d++)b[d]&&(c++,this.addChild(b[d],c))}return!0}return!1},alignItemsVertically:function(){this.alignItemsVerticallyWithPadding(cc.DEFAULT_PADDING)},
alignItemsVerticallyWithPadding:function(a){var b=-a,c;if(this._children&&0<this._children.length)for(c=0;c<this._children.length;c++)this._children[c]&&(b+=this._children[c].getContentSize().height*this._children[c].getScaleY()+a);var d=0,e=b/2;if(this._children&&0<this._children.length)for(c=0;c<this._children.length;c++)this._children[c]&&(d=Math.max(d,this._children[c].getContentSize().width),this._children[c].setPosition(0,e-this._children[c].getContentSize().height*this._children[c].getScaleY()/
2),e-=this._children[c].getContentSize().height*this._children[c].getScaleY()+a);this.setContentSize(d,b)},alignItemsHorizontally:function(){this.alignItemsHorizontallyWithPadding(cc.DEFAULT_PADDING)},alignItemsHorizontallyWithPadding:function(a){var b=-a,c;if(this._children&&0<this._children.length)for(c=0;c<this._children.length;c++)this._children[c]&&(b+=this._children[c].getContentSize().width*this._children[c].getScaleX()+a);var d=0,e=-b/2;if(this._children&&0<this._children.length)for(c=0;c<
this._children.length;c++)this._children[c]&&(d=Math.max(d,this._children[c].getContentSize().height),this._children[c].setPosition(e+this._children[c].getContentSize().width*this._children[c].getScaleX()/2,0),e+=this._children[c].getContentSize().width*this._children[c].getScaleX()+a);this.setContentSize(b,d)},alignItemsInColumns:function(a){var b=[],c;for(c=1;c<arguments.length;c++)b.push(arguments[c]);var d=-5,e=0,f=0,g=0,h,k;if(this._children&&0<this._children.length)for(c=0;c<this._children.length;c++)this._children[c]&&
(e>=b.length?cc.log("cc.MenuPassive.alignItemsInColumns(): invalid row index"):(h=b[e])?(k=this._children[c].getContentSize().height,f=0|(f>=k||null==k?f:k),++g,g>=h&&(d+=f+5,f=g=0,++e)):cc.log("cc.MenuPassive.alignItemsInColumns(): can not have zero columns on a row"));var m=cc.director.getWinSize(),n=h=f=e=0,p=0,d=d/2;if(this._children&&0<this._children.length)for(c=0;c<this._children.length;c++)this._children[c]&&(0===h&&(h=b[e],p=n=m.width/(1+h)),k=this._children[c].getContentSize().height,f=
0|(f>=k||null==k?f:k),this._children[c].setPosition(p-m.width/2,d-this._children[c].getContentSize().height/2),p+=n,++g,g>=h&&(d-=f+5,f=h=g=0,++e))},alignItemsInRows:function(a){var b=[],c;for(c=1;c<arguments.length;c++)b.push(arguments[c]);var d=[],e=[],f=-10,g=-5,h=0,k=0,m=0,n,p;if(this._children&&0<this._children.length)for(c=0;c<this._children.length;c++)this._children[c]&&(h>=b.length?cc.log("cc.MenuPassive.alignItemsInRows(): invalid row index"):(n=b[h])?(p=this._children[c].getContentSize().width,
k=0|(k>=p||null==p?k:p),g+=0|this._children[c].getContentSize().height+5,++m,m>=n&&(d.push(k),e.push(g),f+=k+10,k=m=0,g=-5,++h)):cc.log("cc.MenuPassive.alignItemsInColumns(): can't have zero rows on a column"));g=cc.director.getWinSize();k=h=0;n=null;var f=-f/2,r=0;if(this._children&&0<this._children.length)for(c=0;c<this._children.length;c++)this._children[c]&&(null==n&&(n=b[h],r=e[h]),p=this._children[c].getContentSize().width,k=0|(k>=p||null==p?k:p),this._children[c].setPosition(f+d[h]/2,r-g.height/
2),r-=this._children[c].getContentSize().height+10,++m,m>=n&&(f+=k+5,k=n=m=0,++h))},setOpacityModifyRGB:function(a){},isOpacityModifyRGB:function(){return!1}});cc.MenuPassive.create=function(a){a||(a=null);for(var b=[],c=1;c<arguments.length;c++)b.push(arguments[c]);return(c=new cc.MenuPassive)&&c.initWithItems(a,b)?c:null};cc.MenuPassive.createWithItem=function(a){return cc.MenuPassive.create(a,null)};cc.ControlSaturationBrightnessPicker=cc.Control.extend({_saturation:0,_brightness:0,_background:null,_overlay:null,_shadow:null,_slider:null,_startPos:null,_boxPos:0,_boxSize:0,_className:"ControlSaturationBrightnessPicker",ctor:function(a,b){cc.Control.prototype.ctor.call(this);b&&this.initWithTargetAndPos(a,b)},getSaturation:function(){return this._saturation},getBrightness:function(){return this._brightness},getBackground:function(){return this._background},getOverlay:function(){return this._brightness},
getShadow:function(){return this._shadow},getSlider:function(){return this._slider},getStartPos:function(){return this._startPos},initWithTargetAndPos:function(a,b){return cc.Control.prototype.init.call(this)?(this._background=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPickerBackground.png",a,b,cc.p(0,0)),this._overlay=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPickerOverlay.png",a,b,cc.p(0,0)),this._shadow=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPickerShadow.png",
a,b,cc.p(0,0)),this._slider=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPicker.png",a,b,cc.p(0.5,0.5)),this._startPos=b,this._boxPos=35,this._boxSize=this._background.getContentSize().width/2,!0):!1},setEnabled:function(a){cc.Control.prototype.setEnabled.call(this,a);this._slider&&this._slider.setOpacity(a?255:128)},updateWithHSV:function(a){var b=new cc.HSV;b.s=1;b.h=a.h;b.v=1;a=cc.ControlUtils.RGBfromHSV(b);this._background.setColor(cc.color(0|255*a.r,0|255*a.g,0|255*a.b))},updateDraggerWithHSV:function(a){a=
cc.p(this._startPos.x+this._boxPos+this._boxSize*(1-a.s),this._startPos.y+this._boxPos+this._boxSize*a.v);this._updateSliderPosition(a)},_updateSliderPosition:function(a){var b=this._startPos.x+0.5*this._background.getBoundingBox().width,c=this._startPos.y+0.5*this._background.getBoundingBox().height,d=a.x-b,e=a.y-c,f=Math.sqrt(d*d+e*e),d=Math.atan2(e,d),e=0.5*this._background.getBoundingBox().width;f>e&&(a.x=b+e*Math.cos(d),a.y=c+e*Math.sin(d));this._slider.setPosition(a);a.x<this._startPos.x+this._boxPos?
a.x=this._startPos.x+this._boxPos:a.x>this._startPos.x+this._boxPos+this._boxSize-1&&(a.x=this._startPos.x+this._boxPos+this._boxSize-1);a.y<this._startPos.y+this._boxPos?a.y=this._startPos.y+this._boxPos:a.y>this._startPos.y+this._boxPos+this._boxSize&&(a.y=this._startPos.y+this._boxPos+this._boxSize);this._saturation=1-Math.abs((this._startPos.x+this._boxPos-a.x)/this._boxSize);this._brightness=Math.abs((this._startPos.y+this._boxPos-a.y)/this._boxSize)},_checkSliderPosition:function(a){var b=this._startPos.x+
0.5*this._background.getBoundingBox().width,c=this._startPos.y+0.5*this._background.getBoundingBox().height,b=a.x-b,c=a.y-c;return Math.sqrt(b*b+c*c)<=0.5*this._background.getBoundingBox().width?(this._updateSliderPosition(a),this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED),!0):!1},onTouchBegan:function(a,b){if(!this.isEnabled()||!this.isVisible())return!1;var c=this.getTouchLocation(a);return this._checkSliderPosition(c)},onTouchMoved:function(a,b){var c=this.getTouchLocation(a);this._checkSliderPosition(c)}});
_p=cc.ControlSaturationBrightnessPicker.prototype;cc.defineGetterSetter(_p,"saturation",_p.getSaturation);cc.defineGetterSetter(_p,"brightness",_p.getBrightness);cc.defineGetterSetter(_p,"background",_p.getBackground);cc.defineGetterSetter(_p,"overlay",_p.getOverlay);cc.defineGetterSetter(_p,"shadow",_p.getShadow);cc.defineGetterSetter(_p,"slider",_p.getSlider);cc.defineGetterSetter(_p,"startPos",_p.getStartPos);_p=null;
cc.ControlSaturationBrightnessPicker.create=function(a,b){return new cc.ControlSaturationBrightnessPicker(a,b)};cc.ControlHuePicker=cc.Control.extend({_hue:0,_huePercentage:0,_background:null,_slider:null,_startPos:null,_className:"ControlHuePicker",ctor:function(a,b){cc.Control.prototype.ctor.call(this);b&&this.initWithTargetAndPos(a,b)},getHue:function(){return this._hue},setHue:function(a){this._hue=a;this.setHuePercentage(this._hue/360)},getHuePercentage:function(){return this._huePercentage},setHuePercentage:function(a){this._huePercentage=a;this._hue=360*this._huePercentage;var b=this._background.getBoundingBox(),
c=this._startPos.x+0.5*b.width;a=this._startPos.y+0.5*b.height;var b=0.5*b.width-15,d=cc.degreesToRadians(360*this._huePercentage-180),c=c+b*Math.cos(d);a+=b*Math.sin(d);this._slider.setPosition(c,a)},setEnabled:function(a){cc.Control.prototype.setEnabled.call(this,a);this._slider&&this._slider.setOpacity(a?255:128)},getBackground:function(){return this._background},getSlider:function(){return this._slider},getStartPos:function(){return this._startPos},initWithTargetAndPos:function(a,b){return cc.Control.prototype.init.call(this)?
(this._background=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("huePickerBackground.png",a,b,cc.p(0,0)),this._slider=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("colourPicker.png",a,b,cc.p(0.5,0.5)),this._slider.setPosition(b.x,b.y+0.5*this._background.getBoundingBox().height),this._startPos=b,this._huePercentage=this._hue=0,!0):!1},_updateSliderPosition:function(a){var b=this._background.getBoundingBox();a=Math.atan2(a.y-(this._startPos.y+0.5*b.height),a.x-(this._startPos.x+0.5*b.width));
a=cc.radiansToDegrees(a)+180;this.setHue(a);this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},_checkSliderPosition:function(a){var b=Math.sqrt(Math.pow(a.x+10,2)+Math.pow(a.y,2));return 80>b&&59<b?(this._updateSliderPosition(a),!0):!1},onTouchBegan:function(a,b){if(!this.isEnabled()||!this.isVisible())return!1;var c=this.getTouchLocation(a);return this._checkSliderPosition(c)},onTouchMoved:function(a,b){var c=this.getTouchLocation(a);this._checkSliderPosition(c)}});_p=cc.ControlHuePicker.prototype;
cc.defineGetterSetter(_p,"hue",_p.getHue,_p.setHue);cc.defineGetterSetter(_p,"huePercent",_p.getHuePercentage,_p.setHuePercentage);cc.defineGetterSetter(_p,"background",_p.getBackground);cc.defineGetterSetter(_p,"slider",_p.getSlider);cc.defineGetterSetter(_p,"startPos",_p.getStartPos);_p=null;cc.ControlHuePicker.create=function(a,b){return new cc.ControlHuePicker(a,b)};cc.ControlColourPicker=cc.Control.extend({_hsv:null,_colourPicker:null,_huePicker:null,_background:null,_className:"ControlColourPicker",ctor:function(){cc.Control.prototype.ctor.call(this);this.init()},hueSliderValueChanged:function(a,b){this._hsv.h=a.getHue();var c=cc.ControlUtils.RGBfromHSV(this._hsv);cc.Control.prototype.setColor.call(this,cc.color(0|255*c.r,0|255*c.g,0|255*c.b));this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED);this._updateControlPicker()},colourSliderValueChanged:function(a,
b){this._hsv.s=a.getSaturation();this._hsv.v=a.getBrightness();var c=cc.ControlUtils.RGBfromHSV(this._hsv);cc.Control.prototype.setColor.call(this,cc.color(0|255*c.r,0|255*c.g,0|255*c.b));this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},setColor:function(a){cc.Control.prototype.setColor.call(this,a);var b=new cc.RGBA;b.r=a.r/255;b.g=a.g/255;b.b=a.b/255;b.a=1;this._hsv=cc.ControlUtils.HSVfromRGB(b);this._updateHueAndControlPicker()},getBackground:function(){return this._background},
init:function(){if(cc.Control.prototype.init.call(this)){cc.spriteFrameCache.addSpriteFrames(res.CCControlColourPickerSpriteSheet_plist);var a=new cc.SpriteBatchNode(res.CCControlColourPickerSpriteSheet_png);this.addChild(a);this._hsv=new cc.HSV(0,0,0);this._background=cc.ControlUtils.addSpriteToTargetWithPosAndAnchor("menuColourPanelBackground.png",a,cc.p(0,0),cc.p(0.5,0.5));var b=cc.pSub(this._background.getPosition(),cc.p(this._background.getContentSize().width/2,this._background.getContentSize().height/
2));this._huePicker=new cc.ControlHuePicker(a,cc.p(b.x+8,b.y+8));this._colourPicker=new cc.ControlSaturationBrightnessPicker(a,cc.p(b.x+28,b.y+28));this._huePicker.addTargetWithActionForControlEvents(this,this.hueSliderValueChanged,cc.CONTROL_EVENT_VALUECHANGED);this._colourPicker.addTargetWithActionForControlEvents(this,this.colourSliderValueChanged,cc.CONTROL_EVENT_VALUECHANGED);this._updateHueAndControlPicker();this.addChild(this._huePicker);this.addChild(this._colourPicker);this.setContentSize(this._background.getContentSize());
return!0}return!1},_updateControlPicker:function(){this._huePicker.setHue(this._hsv.h);this._colourPicker.updateWithHSV(this._hsv)},_updateHueAndControlPicker:function(){this._huePicker.setHue(this._hsv.h);this._colourPicker.updateWithHSV(this._hsv);this._colourPicker.updateDraggerWithHSV(this._hsv)},setEnabled:function(a){cc.Control.prototype.setEnabled.call(this,a);null!==this._huePicker&&this._huePicker.setEnabled(a);this._colourPicker&&this._colourPicker.setEnabled(a)},onTouchBegan:function(){return!1}});
_p=cc.ControlColourPicker.prototype;cc.defineGetterSetter(_p,"background",_p.getBackground);_p=null;cc.ControlColourPicker.create=function(){return new cc.ControlColourPicker};var res=res||{};res.CCControlColourPickerSpriteSheet_plist=res.CCControlColourPickerSpriteSheet_plist||"res/extensions/CCControlColourPickerSpriteSheet.plist";res.CCControlColourPickerSpriteSheet_png=res.CCControlColourPickerSpriteSheet_png||"res/extensions/CCControlColourPickerSpriteSheet.png";cc.SLIDER_MARGIN_H=24;cc.SLIDER_MARGIN_V=8;
cc.ControlSlider=cc.Control.extend({_value:0,_minimumValue:0,_maximumValue:0,_minimumAllowedValue:0,_maximumAllowedValue:0,_thumbSprite:null,_progressSprite:null,_backgroundSprite:null,_className:"ControlSlider",ctor:function(a,b,c){cc.Control.prototype.ctor.call(this);void 0!=c&&(a=new cc.Sprite(a),b=new cc.Sprite(b),c=new cc.Sprite(c),this.initWithSprites(a,b,c))},getValue:function(){return this._value},setValue:function(a){a=Math.max(a,this._minimumValue);this._value=a=Math.min(a,this._maximumValue);
this.needsLayout();this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},getMinimumValue:function(){return this._minimumValue},setMinimumValue:function(a){this._minimumAllowedValue=this._minimumValue=a;this._minimumValue>=this._maximumValue&&(this._maximumValue=this._minimumValue+1);this.setValue(this._value)},getMaximumValue:function(){return this._maximumValue},setMaximumValue:function(a){this._maximumAllowedValue=this._maximumValue=a;this._maximumValue<=this._minimumValue&&(this._minimumValue=
this._maximumValue-1);this.setValue(this._value)},isTouchInside:function(a){a=a.getLocation();a=this.getParent().convertToNodeSpace(a);var b=this.getBoundingBox();b.width+=this._thumbSprite.getContentSize().width;b.x-=this._thumbSprite.getContentSize().width/2;return cc.rectContainsPoint(b,a)},locationFromTouch:function(a){a=a.getLocation();a=this.convertToNodeSpace(a);0>a.x?a.x=0:a.x>this._backgroundSprite.getContentSize().width&&(a.x=this._backgroundSprite.getContentSize().width);return a},getMinimumAllowedValue:function(){return this._minimumAllowedValue},
setMinimumAllowedValue:function(a){this._minimumAllowedValue=a},getMaximumAllowedValue:function(){return this._maximumAllowedValue},setMaximumAllowedValue:function(a){this._maximumAllowedValue=a},getThumbSprite:function(){return this._thumbSprite},getProgressSprite:function(){return this._progressSprite},getBackgroundSprite:function(){return this._backgroundSprite},initWithSprites:function(a,b,c){return cc.Control.prototype.init.call(this)?(this.ignoreAnchorPointForPosition(!1),this._backgroundSprite=
a,this._progressSprite=b,this._thumbSprite=c,a=cc.ControlUtils.CCRectUnion(a.getBoundingBox(),c.getBoundingBox()),this.setContentSize(a.width,a.height),this._backgroundSprite.setAnchorPoint(0.5,0.5),this._backgroundSprite.setPosition(a.width/2,a.height/2),this.addChild(this._backgroundSprite),this._progressSprite.setAnchorPoint(0,0.5),this._progressSprite.setPosition(0,a.height/2),this.addChild(this._progressSprite),this._thumbSprite.setPosition(0,a.height/2),this.addChild(this._thumbSprite),this._minimumValue=
0,this._maximumValue=1,this.setValue(this._minimumValue),!0):!1},setEnabled:function(a){cc.Control.prototype.setEnabled.call(this,a);this._thumbSprite&&this._thumbSprite.setOpacity(a?255:128)},sliderBegan:function(a){this.setSelected(!0);this._thumbSprite.setColor(cc.color.GRAY);this.setValue(this.valueForLocation(a))},sliderMoved:function(a){this.setValue(this.valueForLocation(a))},sliderEnded:function(a){this.isSelected()&&this.setValue(this.valueForLocation(this._thumbSprite.getPosition()));this._thumbSprite.setColor(cc.color.WHITE);
this.setSelected(!1)},getTouchLocationInControl:function(a){a=a.getLocation();a=this.convertToNodeSpace(a);0>a.x?a.x=0:a.x>this._backgroundSprite.getContentSize().width+cc.SLIDER_MARGIN_H&&(a.x=this._backgroundSprite.getContentSize().width+cc.SLIDER_MARGIN_H);return a},onTouchBegan:function(a,b){if(!this.isTouchInside(a)||!this.isEnabled()||!this.isVisible())return!1;var c=this.locationFromTouch(a);this.sliderBegan(c);return!0},onTouchMoved:function(a,b){var c=this.locationFromTouch(a);this.sliderMoved(c)},
onTouchEnded:function(a,b){this.sliderEnded(cc.p(0,0))},needsLayout:function(){this._thumbSprite.setPositionX((this._value-this._minimumValue)/(this._maximumValue-this._minimumValue)*this._backgroundSprite.getContentSize().width);var a=this._progressSprite.getTextureRect(),a=cc.rect(a.x,a.y,this._thumbSprite.getPositionX(),a.height);this._progressSprite.setTextureRect(a,this._progressSprite.isTextureRectRotated());this._thumbSprite._renderCmd.transform(this._renderCmd)},valueForLocation:function(a){a=
a.x/this._backgroundSprite.getContentSize().width;return Math.max(Math.min(this._minimumValue+a*(this._maximumValue-this._minimumValue),this._maximumAllowedValue),this._minimumAllowedValue)}});_p=cc.ControlSlider.prototype;cc.defineGetterSetter(_p,"value",_p.getValue,_p.setValue);cc.defineGetterSetter(_p,"minValue",_p.getMinimumValue,_p.setMinimumValue);cc.defineGetterSetter(_p,"maxValue",_p.getMaximumValue,_p.setMaximumValue);cc.defineGetterSetter(_p,"minAllowedValue",_p.getMinimumAllowedValue,_p.setMinimumAllowedValue);
cc.defineGetterSetter(_p,"maxAllowedValue",_p.getMaximumAllowedValue,_p.setMaximumAllowedValue);cc.defineGetterSetter(_p,"thumbSprite",_p.getThumbSprite);cc.defineGetterSetter(_p,"progressSprite",_p.getProgressSprite);cc.defineGetterSetter(_p,"backgroundSprite",_p.getBackgroundSprite);_p=null;cc.ControlSlider.create=function(a,b,c){return new cc.ControlSlider(a,b,c)};cc.ControlSwitch=cc.Control.extend({_switchSprite:null,_initialTouchXPosition:0,_moved:!1,_on:!1,_className:"ControlSwitch",ctor:function(a,b,c,d,e,f){cc.Control.prototype.ctor.call(this);f&&this.initWithMaskSprite(a,b,c,d,e,f)},initWithMaskSprite:function(a,b,c,d,e,f){if(!a)throw Error("cc.ControlSwitch.initWithMaskSprite(): maskSprite should be non-null.");if(!b)throw Error("cc.ControlSwitch.initWithMaskSprite(): onSprite should be non-null.");if(!c)throw Error("cc.ControlSwitch.initWithMaskSprite(): offSprite should be non-null.");
if(!d)throw Error("cc.ControlSwitch.initWithMaskSprite(): thumbSprite should be non-null.");return this.init()?(this._on=!0,this._switchSprite=new cc.ControlSwitchSprite,this._switchSprite.initWithMaskSprite(a,b,c,d,e,f),this._switchSprite.setPosition(this._switchSprite.getContentSize().width/2,this._switchSprite.getContentSize().height/2),this.addChild(this._switchSprite),this.ignoreAnchorPointForPosition(!1),this.setAnchorPoint(0.5,0.5),this.setContentSize(this._switchSprite.getContentSize()),!0):
!1},setOn:function(a,b){b=b||!1;var c=(this._on=a)?this._switchSprite.getOnPosition():this._switchSprite.getOffPosition();b?this._switchSprite.runAction(new cc.ActionTween(0.2,"sliderXPosition",this._switchSprite.getSliderXPosition(),c)):this._switchSprite.setSliderXPosition(c);this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},isOn:function(){return this._on},hasMoved:function(){return this._moved},setEnabled:function(a){this._enabled=a;this._switchSprite.setOpacity(a?255:128)},locationFromTouch:function(a){a=
a.getLocation();return a=this.convertToNodeSpace(a)},onTouchBegan:function(a,b){if(!this.isTouchInside(a)||!this.isEnabled()||!this.isVisible())return!1;this._moved=!1;this._initialTouchXPosition=this.locationFromTouch(a).x-this._switchSprite.getSliderXPosition();this._switchSprite.getThumbSprite().setColor(cc.color.GRAY);this._switchSprite.needsLayout();return!0},onTouchMoved:function(a,b){var c=this.locationFromTouch(a),c=cc.p(c.x-this._initialTouchXPosition,0);this._moved=!0;this._switchSprite.setSliderXPosition(c.x)},
onTouchEnded:function(a,b){var c=this.locationFromTouch(a);this._switchSprite.getThumbSprite().setColor(cc.color.WHITE);this.hasMoved()?this.setOn(!(c.x<this._switchSprite.getContentSize().width/2),!0):this.setOn(!this._on,!0)},onTouchCancelled:function(a,b){var c=this.locationFromTouch(a);this._switchSprite.getThumbSprite().setColor(cc.color.WHITE);this.hasMoved()?this.setOn(!(c.x<this._switchSprite.getContentSize().width/2),!0):this.setOn(!this._on,!0)}});
cc.ControlSwitch.create=function(a,b,c,d,e,f){return new cc.ControlSwitch(a,b,c,d,e,f)};
cc.ControlSwitchSprite=cc.Sprite.extend({_sliderXPosition:0,_onPosition:0,_offPosition:0,_textureLocation:0,_maskLocation:0,_maskSize:null,_onSprite:null,_offSprite:null,_thumbSprite:null,_onLabel:null,_offLabel:null,_clipper:null,_stencil:null,_backRT:null,ctor:function(){cc.Sprite.prototype.ctor.call(this);this._maskLocation=this._offPosition=this._onPosition=this._sliderXPosition=0;this._maskSize=cc.size(0,0);this._offLabel=this._onLabel=this._thumbSprite=this._offSprite=this._onSprite=null},initWithMaskSprite:function(a,
b,c,d,e,f){return cc.Sprite.prototype.init.call(this)?(this.setSpriteFrame(a.displayFrame()),this._onPosition=0,this._offPosition=-b.getContentSize().width+d.getContentSize().width/2,this._sliderXPosition=this._onPosition,this.setOnSprite(b),this.setOffSprite(c),this.setThumbSprite(d),this.setOnLabel(e),this.setOffLabel(f),this._stencil=a,a=this._maskSize=this._stencil.getContentSize(),this._stencil.setPosition(0,0),this._clipper=new cc.ClippingNode,this._clipper.setAnchorPoint(0.5,0.5),this._clipper.setPosition(a.width/
2,a.height/2),this._clipper.setStencil(this._stencil),this.addChild(this._clipper),this._clipper.addChild(b),this._clipper.addChild(c),this._clipper.addChild(e),this._clipper.addChild(f),this.addChild(this._thumbSprite),this.needsLayout(),!0):!1},needsLayout:function(){var a=this._maskSize;this._onSprite.setPosition(this._onSprite.getContentSize().width/2+this._sliderXPosition-a.width/2,this._onSprite.getContentSize().height/2-a.height/2);this._offSprite.setPosition(this._onSprite.getContentSize().width+
this._offSprite.getContentSize().width/2+this._sliderXPosition-a.width/2,this._offSprite.getContentSize().height/2-a.height/2);this._onLabel&&this._onLabel.setPosition(this._onSprite.getPositionX()-this._thumbSprite.getContentSize().width/6,this._onSprite.getContentSize().height/2-a.height/2);this._offLabel&&this._offLabel.setPosition(this._offSprite.getPositionX()+this._thumbSprite.getContentSize().width/6,this._offSprite.getContentSize().height/2-a.height/2);this._thumbSprite.setPosition(this._onSprite.getContentSize().width+
this._sliderXPosition,this._maskSize.height/2)},setSliderXPosition:function(a){a<=this._offPosition?a=this._offPosition:a>=this._onPosition&&(a=this._onPosition);this._sliderXPosition=a;this.needsLayout()},getSliderXPosition:function(){return this._sliderXPosition},_getOnSideWidth:function(){return this._onSprite.getContentSize().width},_getOffSideWidth:function(){return this._offSprite.getContentSize().height},updateTweenAction:function(a,b){"sliderXPosition"===b&&this.setSliderXPosition(a)},setOnPosition:function(a){this._onPosition=
a},getOnPosition:function(){return this._onPosition},setOffPosition:function(a){this._offPosition=a},getOffPosition:function(){return this._offPosition},setMaskTexture:function(a){this._stencil.setTexture(a)},getMaskTexture:function(){return this._stencil.getTexture()},setTextureLocation:function(a){this._textureLocation=a},getTextureLocation:function(){return this._textureLocation},setMaskLocation:function(a){this._maskLocation=a},getMaskLocation:function(){return this._maskLocation},setOnSprite:function(a){this._onSprite=
a},getOnSprite:function(){return this._onSprite},setOffSprite:function(a){this._offSprite=a},getOffSprite:function(){return this._offSprite},setThumbSprite:function(a){this._thumbSprite=a},getThumbSprite:function(){return this._thumbSprite},setOnLabel:function(a){this._onLabel=a},getOnLabel:function(){return this._onLabel},setOffLabel:function(a){this._offLabel=a},getOffLabel:function(){return this._offLabel}});_p=cc.ControlSwitchSprite.prototype;
cc.defineGetterSetter(_p,"sliderX",_p.getSliderXPosition,_p.setSliderXPosition);cc.defineGetterSetter(_p,"onPos",_p.getOnPosition,_p.setOnPosition);cc.defineGetterSetter(_p,"offPos",_p.getOffPosition,_p.setOffPosition);cc.defineGetterSetter(_p,"maskTexture",_p.getMaskTexture,_p.setMaskTexture);cc.defineGetterSetter(_p,"maskPos",_p.getMaskLocation,_p.setMaskLocation);cc.defineGetterSetter(_p,"onSprite",_p.getOnSprite,_p.setOnSprite);cc.defineGetterSetter(_p,"offSprite",_p.getOffSprite,_p.setOffSprite);
cc.defineGetterSetter(_p,"thumbSprite",_p.getThumbSprite,_p.setThumbSprite);cc.defineGetterSetter(_p,"onLabel",_p.getOnLabel,_p.setOnLabel);cc.defineGetterSetter(_p,"offLabel",_p.getOffLabel,_p.setOffLabel);cc.defineGetterSetter(_p,"onSideWidth",_p._getOnSideWidth);cc.defineGetterSetter(_p,"offSideWidth",_p._getOffSideWidth);_p=null;cc.CONTROL_STEPPER_PARTMINUS=0;cc.CONTROL_STEPPER_PARTPLUS=1;cc.CONTROL_STEPPER_PARTNONE=2;cc.CONTROL_STEPPER_LABELCOLOR_ENABLED=cc.color(55,55,55);cc.CONTROL_STEPPER_LABELCOLOR_DISABLED=cc.color(147,147,147);cc.CONTROL_STEPPER_LABELFONT="CourierNewPSMT";cc.AUTOREPEAT_DELTATIME=0.15;cc.AUTOREPEAT_INCREASETIME_INCREMENT=12;
cc.ControlStepper=cc.Control.extend({_minusSprite:null,_plusSprite:null,_minusLabel:null,_plusLabel:null,_value:0,_continuous:!1,_autorepeat:!1,_wraps:!1,_minimumValue:0,_maximumValue:0,_stepValue:0,_touchInsideFlag:!1,_touchedPart:cc.CONTROL_STEPPER_PARTNONE,_autorepeatCount:0,_className:"ControlStepper",ctor:function(a,b){cc.Control.prototype.ctor.call(this);this._plusLabel=this._minusLabel=this._plusSprite=this._minusSprite=null;this._value=0;this._wraps=this._autorepeat=this._continuous=!1;this._stepValue=
this._maximumValue=this._minimumValue=0;this._touchInsideFlag=!1;this._touchedPart=cc.CONTROL_STEPPER_PARTNONE;this._autorepeatCount=0;b&&this.initWithMinusSpriteAndPlusSprite(a,b)},initWithMinusSpriteAndPlusSprite:function(a,b){if(!a)throw Error("cc.ControlStepper.initWithMinusSpriteAndPlusSprite(): Minus sprite should be non-null.");if(!b)throw Error("cc.ControlStepper.initWithMinusSpriteAndPlusSprite(): Plus sprite should be non-null.");if(this.init()){this._continuous=this._autorepeat=!0;this._minimumValue=
0;this._maximumValue=100;this._value=0;this._stepValue=1;this._wraps=!1;this.ignoreAnchorPointForPosition(!1);this.setMinusSprite(a);this._minusSprite.setPosition(a.getContentSize().width/2,a.getContentSize().height/2);this.addChild(this._minusSprite);this.setMinusLabel(new cc.LabelTTF("-",cc.CONTROL_STEPPER_LABELFONT,40,cc.size(40,40),cc.TEXT_ALIGNMENT_CENTER,cc.VERTICAL_TEXT_ALIGNMENT_CENTER));this._minusLabel.setColor(cc.CONTROL_STEPPER_LABELCOLOR_DISABLED);this._minusLabel.setPosition(this._minusSprite.getContentSize().width/
2,this._minusSprite.getContentSize().height/2);this._minusSprite.addChild(this._minusLabel);this.setPlusSprite(b);this._plusSprite.setPosition(a.getContentSize().width+b.getContentSize().width/2,a.getContentSize().height/2);this.addChild(this._plusSprite);this.setPlusLabel(new cc.LabelTTF("+",cc.CONTROL_STEPPER_LABELFONT,40,cc.size(40,40),cc.TEXT_ALIGNMENT_CENTER,cc.VERTICAL_TEXT_ALIGNMENT_CENTER));this._plusLabel.setColor(cc.CONTROL_STEPPER_LABELCOLOR_ENABLED);this._plusLabel.setPosition(this._plusSprite.getContentSize().width/
2,this._plusSprite.getContentSize().height/2);this._plusSprite.addChild(this._plusLabel);var c=cc.ControlUtils.CCRectUnion(this._minusSprite.getBoundingBox(),this._plusSprite.getBoundingBox());this.setContentSize(this._minusSprite.getContentSize().width+this._plusSprite.getContentSize().height,c.height);return!0}return!1},setWraps:function(a){if(this._wraps=a)this._minusLabel.setColor(cc.CONTROL_STEPPER_LABELCOLOR_ENABLED),this._plusLabel.setColor(cc.CONTROL_STEPPER_LABELCOLOR_ENABLED);this.setValue(this._value)},
getWraps:function(){return this._wraps},setMinimumValue:function(a){if(a>=this._maximumValue)throw Error("cc.ControlStepper.setMinimumValue(): minimumValue should be numerically less than maximumValue.");this._minimumValue=a;this.setValue(this._value)},getMinimumValue:function(){return this._minimumValue},setMaximumValue:function(a){if(a<=this._minimumValue)throw Error("cc.ControlStepper.setMaximumValue(): maximumValue should be numerically less than maximumValue.");this._maximumValue=a;this.setValue(this._value)},
getMaximumValue:function(){return this._maximumValue},setValue:function(a){this.setValueWithSendingEvent(a,!0)},getValue:function(){return this._value},setStepValue:function(a){if(0>=a)throw Error("cc.ControlStepper.setMaximumValue(): stepValue should be numerically greater than 0.");this._stepValue=a},getStepValue:function(){return this._stepValue},isContinuous:function(){return this._continuous},setValueWithSendingEvent:function(a,b){a<this._minimumValue?a=this._wraps?this._maximumValue:this._minimumValue:
a>this._maximumValue&&(a=this._wraps?this._minimumValue:this._maximumValue);this._value=a;this._wraps||(this._minusLabel.setColor(a===this._minimumValue?cc.CONTROL_STEPPER_LABELCOLOR_DISABLED:cc.CONTROL_STEPPER_LABELCOLOR_ENABLED),this._plusLabel.setColor(a===this._maximumValue?cc.CONTROL_STEPPER_LABELCOLOR_DISABLED:cc.CONTROL_STEPPER_LABELCOLOR_ENABLED));b&&this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},startAutorepeat:function(){this._autorepeatCount=-1;this.schedule(this.update,
cc.AUTOREPEAT_DELTATIME,cc.REPEAT_FOREVER,3*cc.AUTOREPEAT_DELTATIME)},stopAutorepeat:function(){this.unschedule(this.update)},update:function(a){this._autorepeatCount++;this._autorepeatCount<cc.AUTOREPEAT_INCREASETIME_INCREMENT&&0!==this._autorepeatCount%3||(this._touchedPart===cc.CONTROL_STEPPER_PARTMINUS?this.setValueWithSendingEvent(this._value-this._stepValue,this._continuous):this._touchedPart===cc.CONTROL_STEPPER_PARTPLUS&&this.setValueWithSendingEvent(this._value+this._stepValue,this._continuous))},
updateLayoutUsingTouchLocation:function(a){a.x<this._minusSprite.getContentSize().width&&this._value>this._minimumValue?(this._touchedPart=cc.CONTROL_STEPPER_PARTMINUS,this._minusSprite.setColor(cc.color.GRAY),this._plusSprite.setColor(cc.color.WHITE)):a.x>=this._minusSprite.getContentSize().width&&this._value<this._maximumValue?(this._touchedPart=cc.CONTROL_STEPPER_PARTPLUS,this._minusSprite.setColor(cc.color.WHITE),this._plusSprite.setColor(cc.color.GRAY)):(this._touchedPart=cc.CONTROL_STEPPER_PARTNONE,
this._minusSprite.setColor(cc.color.WHITE),this._plusSprite.setColor(cc.color.WHITE))},onTouchBegan:function(a,b){if(!this.isTouchInside(a)||!this.isEnabled()||!this.isVisible())return!1;var c=this.getTouchLocation(a);this.updateLayoutUsingTouchLocation(c);this._touchInsideFlag=!0;this._autorepeat&&this.startAutorepeat();return!0},onTouchMoved:function(a,b){if(this.isTouchInside(a)){var c=this.getTouchLocation(a);this.updateLayoutUsingTouchLocation(c);this._touchInsideFlag||(this._touchInsideFlag=
!0,this._autorepeat&&this.startAutorepeat())}else this._touchInsideFlag=!1,this._touchedPart=cc.CONTROL_STEPPER_PARTNONE,this._minusSprite.setColor(cc.color.WHITE),this._plusSprite.setColor(cc.color.WHITE),this._autorepeat&&this.stopAutorepeat()},onTouchEnded:function(a,b){this._minusSprite.setColor(cc.color.WHITE);this._plusSprite.setColor(cc.color.WHITE);this._autorepeat&&this.stopAutorepeat();if(this.isTouchInside(a)){var c=this.getTouchLocation(a);this.setValue(this._value+(c.x<this._minusSprite.getContentSize().width?
0-this._stepValue:this._stepValue))}},setMinusSprite:function(a){this._minusSprite=a},getMinusSprite:function(){return this._minusSprite},setPlusSprite:function(a){this._plusSprite=a},getPlusSprite:function(){return this._plusSprite},setMinusLabel:function(a){this._minusLabel=a},getMinusLabel:function(){return this._minusLabel},setPlusLabel:function(a){this._plusLabel=a},getPlusLabel:function(){return this._plusLabel}});_p=cc.ControlStepper.prototype;cc.defineGetterSetter(_p,"wraps",_p.getWraps,_p.setWraps);
cc.defineGetterSetter(_p,"value",_p.getValue,_p.setValue);cc.defineGetterSetter(_p,"minValue",_p.getMinimumValue,_p.setMinimumValue);cc.defineGetterSetter(_p,"maxValue",_p.getMaximumValue,_p.setMaximumValue);cc.defineGetterSetter(_p,"stepValue",_p.getStepValue,_p.setStepValue);cc.defineGetterSetter(_p,"continuous",_p.isContinuous);cc.defineGetterSetter(_p,"minusSprite",_p.getMinusSprite,_p.setMinusSprite);cc.defineGetterSetter(_p,"plusSprite",_p.getPlusSprite,_p.setPlusSprite);
cc.defineGetterSetter(_p,"minusLabel",_p.getMinusLabel,_p.setMinusLabel);cc.defineGetterSetter(_p,"plusLabel",_p.getPlusLabel,_p.setPlusLabel);_p=null;cc.ControlStepper.create=function(a,b){return new cc.ControlStepper(a,b)};cc.ControlPotentiometer=cc.Control.extend({_thumbSprite:null,_progressTimer:null,_previousLocation:null,_value:0,_minimumValue:0,_maximumValue:1,_className:"ControlPotentiometer",ctor:function(a,b,c){cc.Control.prototype.ctor.call(this);void 0!=c&&(a=new cc.Sprite(a),c=new cc.Sprite(c),b=new cc.ProgressTimer(new cc.Sprite(b)),this.initWithTrackSprite_ProgressTimer_ThumbSprite(a,b,c))},initWithTrackSprite_ProgressTimer_ThumbSprite:function(a,b,c){return this.init()?(this.setProgressTimer(b),this.setThumbSprite(c),
this._thumbSprite.setPosition(b.getPosition()),this.addChild(c,2),this.addChild(b,1),this.addChild(a),this.setContentSize(a.getContentSize()),this._minimumValue=0,this._maximumValue=1,this.setValue(this._minimumValue),!0):!1},setEnabled:function(a){this.setEnabled(a);null!==this._thumbSprite&&this._thumbSprite.setOpacity(a?255:128)},setValue:function(a){a<this._minimumValue&&(a=this._minimumValue);a>this._maximumValue&&(a=this._maximumValue);this._value=a;a=(a-this._minimumValue)/(this._maximumValue-
this._minimumValue);this._progressTimer.setPercentage(100*a);this._thumbSprite.setRotation(360*a);this.sendActionsForControlEvents(cc.CONTROL_EVENT_VALUECHANGED)},getValue:function(){return this._value},setMinimumValue:function(a){this._minimumValue=a;this._minimumValue>=this._maximumValue&&(this._maximumValue=this._minimumValue+1);this.setValue(this._maximumValue)},getMinimumValue:function(){return this._minimumValue},setMaximumValue:function(a){this._maximumValue=a;this._maximumValue<=this._minimumValue&&
(this._minimumValue=this._maximumValue-1);this.setValue(this._minimumValue)},getMaximumValue:function(){return this._maximumValue},isTouchInside:function(a){a=this.getTouchLocation(a);return this.distanceBetweenPointAndPoint(this._progressTimer.getPosition(),a)<Math.min(this.getContentSize().width/2,this.getContentSize().height/2)},onTouchBegan:function(a,b){if(!this.isTouchInside(a)||!this.isEnabled()||!this.isVisible())return!1;this._previousLocation=this.getTouchLocation(a);this.potentiometerBegan(this._previousLocation);
return!0},onTouchMoved:function(a,b){var c=this.getTouchLocation(a);this.potentiometerMoved(c)},onTouchEnded:function(a,b){this.potentiometerEnded(cc.p(0,0))},distanceBetweenPointAndPoint:function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},angleInDegreesBetweenLineFromPoint_toPoint_toLineFromPoint_toPoint:function(a,b,c,d){var e=d.x-c.x;c=d.y-c.y;a=Math.atan2(b.x-a.x,b.y-a.y);e=Math.atan2(e,c);return 180*(a-e)/Math.PI},potentiometerBegan:function(a){this.setSelected(!0);this.getThumbSprite().setColor(cc.color.GRAY)},
potentiometerMoved:function(a){var b=this.angleInDegreesBetweenLineFromPoint_toPoint_toLineFromPoint_toPoint(this._progressTimer.getPosition(),a,this._progressTimer.getPosition(),this._previousLocation);180<b?b-=360:-180>b&&(b+=360);this.setValue(this._value+b/360*(this._maximumValue-this._minimumValue));this._previousLocation=a},potentiometerEnded:function(a){this.getThumbSprite().setColor(cc.color.WHITE);this.setSelected(!1)},setThumbSprite:function(a){this._thumbSprite=a},getThumbSprite:function(){return this._thumbSprite},
setProgressTimer:function(a){this._progressTimer=a},getProgressTimer:function(){return this._progressTimer},setPreviousLocation:function(a){this._previousLocation=a},getPreviousLocation:function(){return this._previousLocation}});_p=cc.ControlPotentiometer.prototype;cc.defineGetterSetter(_p,"value",_p.getValue,_p.setValue);cc.defineGetterSetter(_p,"minValue",_p.getMinimumValue,_p.setMinimumValue);cc.defineGetterSetter(_p,"maxValue",_p.getMaximumValue,_p.setMaximumValue);
cc.defineGetterSetter(_p,"progressTimer",_p.getProgressTimer,_p.setProgressTimer);cc.defineGetterSetter(_p,"thumbSprite",_p.getThumbSprite,_p.setThumbSprite);cc.defineGetterSetter(_p,"prevLocation",_p.getPreviousLocation,_p.setPreviousLocation);_p=null;cc.ControlPotentiometer.create=function(a,b,c){return new cc.ControlPotentiometer(a,b,c)};cc.SCROLLVIEW_DIRECTION_NONE=-1;cc.SCROLLVIEW_DIRECTION_HORIZONTAL=0;cc.SCROLLVIEW_DIRECTION_VERTICAL=1;cc.SCROLLVIEW_DIRECTION_BOTH=2;var SCROLL_DEACCEL_RATE=0.95,SCROLL_DEACCEL_DIST=1,BOUNCE_DURATION=0.15,INSET_RATIO=0.2,MOVE_INCH=0.04375,BOUNCE_BACK_FACTOR=0.35;cc.convertDistanceFromPointToInch=function(a){var b=cc.view,b=(b.getScaleX()+b.getScaleY())/2;return a*b/160};cc.ScrollViewDelegate=cc.Class.extend({scrollViewDidScroll:function(a){},scrollViewDidZoom:function(a){},bounceFinish:function(a){}});
cc.ScrollView=cc.Layer.extend({_zoomScale:0,_minZoomScale:0,_maxZoomScale:0,_delegate:null,_direction:cc.SCROLLVIEW_DIRECTION_BOTH,_dragging:!1,_contentOffset:null,_container:null,_touchMoved:!1,_maxInset:null,_minInset:null,_bounceable:!1,_clippingToBounds:!1,_scrollDistance:null,_touchPoint:null,_touchLength:0,_touches:null,_viewSize:null,_minScale:0,_maxScale:0,_parentScissorRect:null,_scissorRestored:!1,_tmpViewRect:null,_touchListener:null,_className:"ScrollView",ctor:function(a,b){cc.Layer.prototype.ctor.call(this);
this._contentOffset=cc.p(0,0);this._maxInset=cc.p(0,0);this._minInset=cc.p(0,0);this._scrollDistance=cc.p(0,0);this._touchPoint=cc.p(0,0);this._touches=[];this._viewSize=cc.size(0,0);this._parentScissorRect=new cc.Rect(0,0,0,0);this._tmpViewRect=new cc.Rect(0,0,0,0);void 0!=b?this.initWithViewSize(a,b):this.initWithViewSize(cc.size(200,200),null)},init:function(){return this.initWithViewSize(cc.size(200,200),null)},initWithViewSize:function(a,b){var c=cc.p(0,0);return cc.Layer.prototype.init.call(this)?
(b||this._container||(b=new cc.Layer),b&&this.setContainer(b),this.setViewSize(a),this.setTouchEnabled(!0),this._touches.length=0,this._delegate=null,this._clippingToBounds=this._bounceable=!0,this._direction=cc.SCROLLVIEW_DIRECTION_BOTH,this._container.setPosition(c),this._touchLength=0,this._minScale=this._maxScale=1,!0):!1},visit:function(a){var b=this._renderCmd,c=a?a._renderCmd:null;if(this._visible){a=cc.renderer;b.visit(c);this._clippingToBounds&&a.pushRenderCommand(b.startCmd);var d=this._children,
e=d.length;if(0<e)for(this._reorderChildDirty&&this.sortAllChildren(),c=0;c<e;c++)d[c].visit(this);this._clippingToBounds&&a.pushRenderCommand(b.endCmd);b._dirtyFlag=0}else b._propagateFlagsDown(c)},setContentOffset:function(a,b){if(b)this.setContentOffsetInDuration(a,BOUNCE_DURATION);else{if(!this._bounceable){var c=this.minContainerOffset(),d=this.maxContainerOffset();a.x=Math.max(c.x,Math.min(d.x,a.x));a.y=Math.max(c.y,Math.min(d.y,a.y))}this._container.setPosition(a);c=this._delegate;null!=c&&
c.scrollViewDidScroll&&c.scrollViewDidScroll(this)}},getContentOffset:function(){var a=this._container.getPosition();return cc.p(a.x,a.y)},setContentOffsetInDuration:function(a,b){var c=cc.moveTo(b,a),d=cc.callFunc(this._stoppedAnimatedScroll,this);this._container.runAction(cc.sequence(c,d));this.schedule(this._performedAnimatedScroll)},setZoomScale:function(a,b){if(b)this.setZoomScaleInDuration(a,BOUNCE_DURATION);else{var c=this._container;if(c.getScale()!==a){var d,e;0===this._touchLength?(e=this._viewSize,
e=cc.p(0.5*e.width,0.5*e.height),e=this.convertToWorldSpace(e)):e=this._touchPoint;d=c.convertToNodeSpace(e);c.setScale(Math.max(this._minScale,Math.min(this._maxScale,a)));d=c.convertToWorldSpace(d);e=cc.pSub(e,d);this._delegate&&this._delegate.scrollViewDidZoom&&this._delegate.scrollViewDidZoom(this);this.setContentOffset(cc.pAdd(c.getPosition(),e))}}},getZoomScale:function(){return this._container.getScale()},setZoomScaleInDuration:function(a,b){if(0<b){var c=this._container.getScale();c!==a&&
(c=cc.actionTween(b,"zoomScale",c,a),this.runAction(c))}else this.setZoomScale(a)},minContainerOffset:function(){var a=this._container,b=a.getContentSize(),c=this._viewSize;return cc.p(c.width-b.width*a.getScaleX(),c.height-b.height*a.getScaleY())},maxContainerOffset:function(){return cc.p(0,0)},isNodeVisible:function(a){var b=this.getContentOffset(),c=this.getViewSize(),d=this.getZoomScale(),b=cc.rect(-b.x/d,-b.y/d,c.width/d,c.height/d);return cc.rectIntersectsRect(b,a.getBoundingBox())},pause:function(a){this._container.pause();
a=this._container.getChildren();for(var b=0;b<a.length;b++)a[b].pause();this._super()},resume:function(a){a=this._container.getChildren();for(var b=0,c=a.length;b<c;b++)a[b].resume();this._container.resume();this._super()},isDragging:function(){return this._dragging},isTouchMoved:function(){return this._touchMoved},isBounceable:function(){return this._bounceable},setBounceable:function(a){this._bounceable=a},getViewSize:function(){return this._viewSize},setViewSize:function(a){this._viewSize=a;cc.Node.prototype.setContentSize.call(this,
a)},getContainer:function(){return this._container},setContainer:function(a){a&&(this.removeAllChildren(!0),this._container=a,a.ignoreAnchorPointForPosition(!1),a.setAnchorPoint(0,0),this.addChild(a),this.setViewSize(this._viewSize))},getDirection:function(){return this._direction},setDirection:function(a){this._direction=a},getDelegate:function(){return this._delegate},setDelegate:function(a){this._delegate=a},onTouchBegan:function(a,b){for(var c=this;null!=c;c=c.parent)if(!c.isVisible())return!1;
var c=this._getViewRect(),d=this._container,e=d.convertToWorldSpace(d.convertTouchToNodeSpace(a)),f=this._touches;if(2<f.length||this._touchMoved||!cc.rectContainsPoint(c,e))return!1;f.push(a);1===f.length?(this._touchPoint=this.convertTouchToNodeSpace(a),this._touchMoved=!1,this._dragging=!0,this._scrollDistance.x=0,this._touchLength=this._scrollDistance.y=0):2===f.length&&(this._touchPoint=cc.pMidpoint(this.convertTouchToNodeSpace(f[0]),this.convertTouchToNodeSpace(f[1])),this._touchLength=cc.pDistance(d.convertTouchToNodeSpace(f[0]),
d.convertTouchToNodeSpace(f[1])),this._dragging=!1);return!0},onTouchMoved:function(a,b){if(this.isVisible())if(this.setNodeDirty(),1===this._touches.length&&this._dragging){this._touchMoved=!0;this._getViewRect();var c=this.convertTouchToNodeSpace(a),d=cc.pSub(c,this._touchPoint),e=0,f=this._direction,g;if(f===cc.SCROLLVIEW_DIRECTION_VERTICAL)e=d.y,g=this._container.getPositionY(),this.minContainerOffset().y<=g&&g<=this.maxContainerOffset().y||(d.y*=BOUNCE_BACK_FACTOR);else if(f===cc.SCROLLVIEW_DIRECTION_HORIZONTAL)e=
d.x,g=this._container.getPositionX(),this.minContainerOffset().x<=g&&g<=this.maxContainerOffset().x||(d.x*=BOUNCE_BACK_FACTOR);else{e=Math.sqrt(d.x*d.x+d.y*d.y);g=this._container.getPositionY();var h=this.minContainerOffset(),k=this.maxContainerOffset();h.y<=g&&g<=k.y||(d.y*=BOUNCE_BACK_FACTOR);g=this._container.getPositionX();h.x<=g&&g<=k.x||(d.x*=BOUNCE_BACK_FACTOR)}if(this._touchMoved||!(Math.abs(cc.convertDistanceFromPointToInch(e))<MOVE_INCH))if(this._touchMoved||(d.x=0,d.y=0),this._touchPoint=
c,this._touchMoved=!0,this._dragging){switch(f){case cc.SCROLLVIEW_DIRECTION_VERTICAL:d.x=0;break;case cc.SCROLLVIEW_DIRECTION_HORIZONTAL:d.y=0}e=this._container.getPosition();c=e.x+d.x;e=e.y+d.y;this._scrollDistance=d;this.setContentOffset(cc.p(c,e))}}else 2!==this._touches.length||this._dragging||(d=cc.pDistance(this._container.convertTouchToNodeSpace(this._touches[0]),this._container.convertTouchToNodeSpace(this._touches[1])),this.setZoomScale(this.getZoomScale()*d/this._touchLength))},onTouchEnded:function(a,
b){this.isVisible()&&(1===this._touches.length&&this._touchMoved&&this.schedule(this._deaccelerateScrolling),this._touches.length=0,this._touchMoved=this._dragging=!1)},onTouchCancelled:function(a,b){this.isVisible()&&(this._touches.length=0,this._touchMoved=this._dragging=!1)},setContentSize:function(a,b){null!==this.getContainer()&&(void 0===b?this.getContainer().setContentSize(a):this.getContainer().setContentSize(a,b),this.updateInset())},_setWidth:function(a){var b=this.getContainer();null!==
b&&(b._setWidth(a),this.updateInset())},_setHeight:function(a){var b=this.getContainer();null!==b&&(b._setHeight(a),this.updateInset())},getContentSize:function(){return this._container.getContentSize()},updateInset:function(){if(null!==this.getContainer()){var a=this._viewSize,b=this.maxContainerOffset();this._maxInset.x=b.x+a.width*INSET_RATIO;this._maxInset.y=b.y+a.height*INSET_RATIO;b=this.minContainerOffset();this._minInset.x=b.x-a.width*INSET_RATIO;this._minInset.y=b.y-a.height*INSET_RATIO}},
isClippingToBounds:function(){return this._clippingToBounds},setClippingToBounds:function(a){this._clippingToBounds=a},addChild:function(a,b,c){if(!a)throw Error("child must not nil!");b=b||a.getLocalZOrder();c=c||a.getTag();this._container!==a?this._container.addChild(a,b,c):cc.Layer.prototype.addChild.call(this,a,b,c)},isTouchEnabled:function(){return null!==this._touchListener},setTouchEnabled:function(a){this._touchListener&&cc.eventManager.removeListener(this._touchListener);this._touchListener=
null;a?(a=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE}),this.onTouchBegan&&(a.onTouchBegan=this.onTouchBegan.bind(this)),this.onTouchMoved&&(a.onTouchMoved=this.onTouchMoved.bind(this)),this.onTouchEnded&&(a.onTouchEnded=this.onTouchEnded.bind(this)),this.onTouchCancelled&&(a.onTouchCancelled=this.onTouchCancelled.bind(this)),this._touchListener=a,cc.eventManager.addListener(a,this)):(this._touchMoved=this._dragging=!1,this._touches.length=0)},_initWithViewSize:function(a){return null},
_relocateContainer:function(a){var b=this.minContainerOffset(),c=this.maxContainerOffset(),d=this._direction,e=this._container.getPosition(),f=e.x,g=e.y;if(d===cc.SCROLLVIEW_DIRECTION_BOTH||d===cc.SCROLLVIEW_DIRECTION_HORIZONTAL)f=Math.max(f,b.x),f=Math.min(f,c.x);if(d===cc.SCROLLVIEW_DIRECTION_BOTH||d===cc.SCROLLVIEW_DIRECTION_VERTICAL)g=Math.min(g,c.y),g=Math.max(g,b.y);g===e.y&&f===e.x||this.setContentOffset(cc.p(f,g),a)},_deaccelerateScrolling:function(a){if(this._dragging)this.unschedule(this._deaccelerateScrolling);
else{var b,c;b=this._container.getPosition();a=this._scrollDistance;this._container.setPosition(b.x+a.x,b.y+a.y);this._bounceable?(b=this._maxInset,c=this._minInset):(b=this.maxContainerOffset(),c=this.minContainerOffset());var d=this._container.getPositionX(),e=this._container.getPositionY();a.x*=SCROLL_DEACCEL_RATE;a.y*=SCROLL_DEACCEL_RATE;this.setContentOffset(cc.p(d,e));if(Math.abs(a.x)<=SCROLL_DEACCEL_DIST&&Math.abs(a.y)<=SCROLL_DEACCEL_DIST||e>b.y||e<c.y||d>b.x||d<c.x||d===b.x||d===c.x||e===
b.y||e===c.y)this.unschedule(this._deaccelerateScrolling),this._relocateContainer(!0)}},_performedAnimatedScroll:function(a){this._dragging?this.unschedule(this._performedAnimatedScroll):this._delegate&&this._delegate.scrollViewDidScroll&&this._delegate.scrollViewDidScroll(this)},_stoppedAnimatedScroll:function(a){this.unschedule(this._performedAnimatedScroll);this._delegate&&this._delegate.scrollViewDidScroll&&this._delegate.scrollViewDidScroll(this);this._delegate&&this._delegate.bounceFinish&&
this._delegate.bounceFinish(this)},_handleZoom:function(){},_getViewRect:function(){for(var a=this.convertToWorldSpace(cc.p(0,0)),b=this._viewSize,c=this.getScaleX(),d=this.getScaleY(),e=this._parent;null!=e;e=e.getParent())c*=e.getScaleX(),d*=e.getScaleY();0>c&&(a.x+=b.width*c,c=-c);0>d&&(a.y+=b.height*d,d=-d);e=this._tmpViewRect;e.x=a.x;e.y=a.y;e.width=b.width*c;e.height=b.height*d;return e},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ScrollView.CanvasRenderCmd(this):
new cc.ScrollView.WebGLRenderCmd(this)}});_p=cc.ScrollView.prototype;cc.defineGetterSetter(_p,"minOffset",_p.minContainerOffset);cc.defineGetterSetter(_p,"maxOffset",_p.maxContainerOffset);cc.defineGetterSetter(_p,"bounceable",_p.isBounceable,_p.setBounceable);cc.defineGetterSetter(_p,"viewSize",_p.getViewSize,_p.setViewSize);cc.defineGetterSetter(_p,"container",_p.getContainer,_p.setContainer);cc.defineGetterSetter(_p,"direction",_p.getDirection,_p.setDirection);
cc.defineGetterSetter(_p,"delegate",_p.getDelegate,_p.setDelegate);cc.defineGetterSetter(_p,"clippingToBounds",_p.isClippingToBounds,_p.setClippingToBounds);_p=null;cc.ScrollView.create=function(a,b){return new cc.ScrollView(a,b)};(function(){cc.ScrollView.CanvasRenderCmd=function(a){this._layerCmdCtor(a);this._needDraw=!1;this.startCmd=new cc.CustomRenderCmd(this,this._startCmd);this.startCmd._canUseDirtyRegion=!0;this.endCmd=new cc.CustomRenderCmd(this,this._endCmd);this.endCmd._canUseDirtyRegion=!0};var a=cc.ScrollView.CanvasRenderCmd.prototype=Object.create(cc.Layer.CanvasRenderCmd.prototype);a.constructor=cc.ScrollView.CanvasRenderCmd;a._startCmd=function(a,c,d){var e=this._node,f=a||cc._renderContext;a=f.getContext();
f.save();e._clippingToBounds&&(this._scissorRestored=!1,f.setTransform(this._worldTransform,c,d),d=e.getScaleX(),c=e.getScaleY(),d*=e._viewSize.width,e=e._viewSize.height*c,a.beginPath(),a.rect(0,0,d,-e),a.closePath(),a.clip())};a._endCmd=function(a){a=a||cc._renderContext;a.restore()}})();(function(){cc.ScrollView.WebGLRenderCmd=function(a){this._layerCmdCtor(a);this._needDraw=!1;this.startCmd=new cc.CustomRenderCmd(this,this._startCmd);this.endCmd=new cc.CustomRenderCmd(this,this._endCmd)};var a=cc.ScrollView.WebGLRenderCmd.prototype=Object.create(cc.Layer.WebGLRenderCmd.prototype);a.constructor=cc.ScrollView.WebGLRenderCmd;a._startCmd=function(){var a=this._node,c=cc.view,d=a._getViewRect();if(c.isScissorEnabled()){if(a._scissorRestored=!0,a._parentScissorRect=c.getScissorRect(),
cc.rectIntersection(d,a._parentScissorRect)){var e=a._parentScissorRect,a=Math.max(d.x,e.x),f=Math.max(d.y,e.y),g=Math.min(d.x+d.width,e.x+e.width),d=Math.min(d.y+d.height,e.y+e.height);c.setScissorInPoints(a,f,g-a,d-f)}}else a=cc._renderContext,a.enable(a.SCISSOR_TEST),c.setScissorInPoints(d.x,d.y,d.width,d.height)};a._endCmd=function(){var a=this._node;a._scissorRestored?(a=a._parentScissorRect,cc.view.setScissorInPoints(a.x,a.y,a.width,a.height)):(a=cc._renderContext,a.disable(a.SCISSOR_TEST))}})();cc.SortableObject=cc.Class.extend({setObjectID:function(a){},getObjectID:function(){return 0}});cc.SortedObject=cc.SortableObject.extend({_objectID:0,ctor:function(){this._objectID=0},setObjectID:function(a){this._objectID=a},getObjectID:function(){return this._objectID}});var _compareObject=function(a,b){return a.getObjectID()-b.getObjectID()};
cc.ArrayForObjectSorting=cc.Class.extend({_saveObjectArr:null,ctor:function(){this._saveObjectArr=[]},insertSortedObject:function(a){if(!a)throw Error("cc.ArrayForObjectSorting.insertSortedObject(): addObject should be non-null.");var b=this.indexOfSortedObject(a);this.insertObject(a,b)},removeSortedObject:function(a){if(0!==this.count()){var b=this.indexOfSortedObject(a);b<this.count()&&b!==cc.INVALID_INDEX&&this.objectAtIndex(b).getObjectID()===a.getObjectID()&&this.removeObjectAtIndex(b)}},setObjectID_ofSortedObject:function(a,
b){var c=this.indexOfSortedObject(b);if(c<this.count()&&c!==cc.INVALID_INDEX){var d=this.objectAtIndex(c);d.getObjectID()===b.getObjectID()&&(this.removeObjectAtIndex(c),d.setObjectID(a),this.insertSortedObject(d))}},objectWithObjectID:function(a){if(0===this.count())return null;var b=new cc.SortedObject;b.setObjectID(a);var c=this.indexOfSortedObject(b);c<this.count()&&c!==cc.INVALID_INDEX&&(b=this.objectAtIndex(c),b.getObjectID()!==a&&(b=null));return b},getObjectWithObjectID:function(a){return null},
indexOfSortedObject:function(a){var b=0;if(a){var c=0;a=a.getObjectID();for(var d=this._saveObjectArr,e=0;e<d.length;e++){var f=d[e].getObjectID();if(a===f||a>=c&&a<f)break;c=f;b++}}else b=cc.INVALID_INDEX;return b},count:function(){return this._saveObjectArr.length},lastObject:function(){var a=this._saveObjectArr;return 0===a.length?null:a[a.length-1]},objectAtIndex:function(a){return this._saveObjectArr[a]},addObject:function(a){this._saveObjectArr.push(a);this._saveObjectArr.sort(_compareObject)},
removeObjectAtIndex:function(a){this._saveObjectArr.splice(a,1);this._saveObjectArr.sort(_compareObject)},insertObject:function(a,b){this._saveObjectArr.splice(b,0,a);this._saveObjectArr.sort(_compareObject)}});cc.TABLEVIEW_FILL_TOPDOWN=0;cc.TABLEVIEW_FILL_BOTTOMUP=1;cc.TableViewCell=cc.Node.extend({_idx:0,_className:"TableViewCell",getIdx:function(){return this._idx},setIdx:function(a){this._idx=a},reset:function(){this._idx=cc.INVALID_INDEX},setObjectID:function(a){this._idx=a},getObjectID:function(){return this._idx}});_p=cc.TableViewCell.prototype;cc.defineGetterSetter(_p,"objectId",_p.getObjectID,_p.setObjectID);_p=null;
cc.TableViewDelegate=cc.ScrollViewDelegate.extend({tableCellTouched:function(a,b){},tableCellHighlight:function(a,b){},tableCellUnhighlight:function(a,b){},tableCellWillRecycle:function(a,b){}});cc.TableViewDataSource=cc.Class.extend({tableCellSizeForIndex:function(a,b){return this.cellSizeForTable(a)},cellSizeForTable:function(a){return cc.size(0,0)},tableCellAtIndex:function(a,b){return null},numberOfCellsInTableView:function(a){return 0}});
cc.TableView=cc.ScrollView.extend({_vOrdering:null,_indices:null,_cellsFreed:null,_dataSource:null,_tableViewDelegate:null,_oldDirection:null,_cellsPositions:null,_touchedCell:null,ctor:function(a,b,c){cc.ScrollView.prototype.ctor.call(this);this._oldDirection=cc.SCROLLVIEW_DIRECTION_NONE;this._cellsPositions=[];this.initWithViewSize(b,c);this.setDataSource(a);this._updateCellPositions();this._updateContentSize()},__indexFromOffset:function(a){var b=0,c=this._dataSource.numberOfCellsInTableView(this)-
1;switch(this.getDirection()){case cc.SCROLLVIEW_DIRECTION_HORIZONTAL:a=a.x;break;default:a=a.y}for(var d=this._cellsPositions;c>=b;){var e=0|b+(c-b)/2,f=d[e],g=d[e+1];if(a>=f&&a<=g)return e;a<f?c=e-1:b=e+1}return 0>=b?0:-1},_indexFromOffset:function(a){var b={x:a.x,y:a.y};a=this._dataSource.numberOfCellsInTableView(this)-1;this._vOrdering===cc.TABLEVIEW_FILL_TOPDOWN&&(b.y=this.getContainer().getContentSize().height-b.y);b=this.__indexFromOffset(b);-1!==b&&(b=Math.max(0,b),b>a&&(b=cc.INVALID_INDEX));
return b},__offsetFromIndex:function(a){switch(this.getDirection()){case cc.SCROLLVIEW_DIRECTION_HORIZONTAL:a=cc.p(this._cellsPositions[a],0);break;default:a=cc.p(0,this._cellsPositions[a])}return a},_offsetFromIndex:function(a){var b=this.__offsetFromIndex(a);a=this._dataSource.tableCellSizeForIndex(this,a);this._vOrdering===cc.TABLEVIEW_FILL_TOPDOWN&&(b.y=this.getContainer().getContentSize().height-b.y-a.height);return b},_updateCellPositions:function(){var a=this._dataSource.numberOfCellsInTableView(this),
b=this._cellsPositions;if(0<a){for(var c=0,d,e=this._dataSource,f=0;f<a;f++)switch(b[f]=c,d=e.tableCellSizeForIndex(this,f),this.getDirection()){case cc.SCROLLVIEW_DIRECTION_HORIZONTAL:c+=d.width;break;default:c+=d.height}this._cellsPositions[a]=c}},_updateContentSize:function(){var a=cc.size(0,0),b=this._dataSource.numberOfCellsInTableView(this);if(0<b)switch(a=this._cellsPositions[b],this.getDirection()){case cc.SCROLLVIEW_DIRECTION_HORIZONTAL:a=cc.size(a,this._viewSize.height);break;default:a=
cc.size(this._viewSize.width,a)}this.setContentSize(a);this._oldDirection!==this._direction&&(this._direction===cc.SCROLLVIEW_DIRECTION_HORIZONTAL?this.setContentOffset(cc.p(0,0)):this.setContentOffset(cc.p(0,this.minContainerOffset().y)),this._oldDirection=this._direction)},_moveCellOutOfSight:function(a){this._tableViewDelegate&&this._tableViewDelegate.tableCellWillRecycle&&this._tableViewDelegate.tableCellWillRecycle(this,a);this._cellsFreed.addObject(a);this._cellsUsed.removeSortedObject(a);cc.arrayRemoveObject(this._indices,
a.getIdx());a.reset();a.getParent()===this.getContainer()&&this.getContainer().removeChild(a,!0)},_setIndexForCell:function(a,b){b.setAnchorPoint(0,0);b.setPosition(this._offsetFromIndex(a));b.setIdx(a)},_addCellIfNecessary:function(a){a.getParent()!==this.getContainer()&&this.getContainer().addChild(a);this._cellsUsed.insertSortedObject(a);var b=this._indices;a=a.getIdx();-1===b.indexOf(a)&&(b.push(a),b.sort(function(a,b){return a-b}))},getDataSource:function(){return this._dataSource},setDataSource:function(a){this._dataSource=
a},getDelegate:function(){return this._tableViewDelegate},setDelegate:function(a){this._tableViewDelegate=a},setVerticalFillOrder:function(a){this._vOrdering!==a&&(this._vOrdering=a,0<this._cellsUsed.count()&&this.reloadData())},getVerticalFillOrder:function(){return this._vOrdering},initWithViewSize:function(a,b){return cc.ScrollView.prototype.initWithViewSize.call(this,a,b)?(this._cellsUsed=new cc.ArrayForObjectSorting,this._cellsFreed=new cc.ArrayForObjectSorting,this._indices=[],this._tableViewDelegate=
null,this._vOrdering=cc.TABLEVIEW_FILL_BOTTOMUP,this.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL),cc.ScrollView.prototype.setDelegate.call(this,this),!0):!1},updateCellAtIndex:function(a){if(!(a===cc.INVALID_INDEX||a>this._dataSource.numberOfCellsInTableView(this)-1)){var b=this.cellAtIndex(a);b&&this._moveCellOutOfSight(b);b=this._dataSource.tableCellAtIndex(this,a);this._setIndexForCell(a,b);this._addCellIfNecessary(b)}},insertCellAtIndex:function(a){if(!(a===cc.INVALID_INDEX||a>this._dataSource.numberOfCellsInTableView(this)-
1)){var b,c=this._cellsUsed;if(b=c.objectWithObjectID(a))for(var d=b=c.indexOfSortedObject(b);d<c.count();d++)b=c.objectAtIndex(d),this._setIndexForCell(b.getIdx()+1,b);b=this._dataSource.tableCellAtIndex(this,a);this._setIndexForCell(a,b);this._addCellIfNecessary(b);this._updateCellPositions();this._updateContentSize()}},removeCellAtIndex:function(a){if(!(a===cc.INVALID_INDEX||a>this._dataSource.numberOfCellsInTableView(this)-1)){var b=this.cellAtIndex(a);if(b){var c=this._cellsUsed,d=c.indexOfSortedObject(b);
this._moveCellOutOfSight(b);cc.arrayRemoveObject(this._indices,a);this._updateCellPositions();for(a=c.count()-1;a>d;a--)b=c.objectAtIndex(a),this._setIndexForCell(b.getIdx()-1,b)}}},reloadData:function(){this._oldDirection=cc.SCROLLVIEW_DIRECTION_NONE;for(var a=this._cellsUsed,b=this._cellsFreed,c=this.getContainer(),d=0,e=a.count();d<e;d++){var f=a.objectAtIndex(d);this._tableViewDelegate&&this._tableViewDelegate.tableCellWillRecycle&&this._tableViewDelegate.tableCellWillRecycle(this,f);b.addObject(f);
f.reset();f.getParent()===c&&c.removeChild(f,!0)}this._indices=[];this._cellsUsed=new cc.ArrayForObjectSorting;this._updateCellPositions();this._updateContentSize();0<this._dataSource.numberOfCellsInTableView(this)&&this.scrollViewDidScroll(this);this.setNodeDirty()},dequeueCell:function(){if(0===this._cellsFreed.count())return null;var a=this._cellsFreed.objectAtIndex(0);this._cellsFreed.removeObjectAtIndex(0);return a},cellAtIndex:function(a){return-1===this._indices.indexOf(a)?null:this._cellsUsed.objectWithObjectID(a)},
bounceFinish:function(a){null!==this._tableViewDelegate&&this._tableViewDelegate.bounceFinish&&this._tableViewDelegate.bounceFinish(this)},scrollViewDidScroll:function(a){var b=this._dataSource.numberOfCellsInTableView(this);if(0!==b){null!==this._tableViewDelegate&&this._tableViewDelegate.scrollViewDidScroll&&this._tableViewDelegate.scrollViewDidScroll(this);var c=0,d=this._viewSize,c=this.getContainer(),e=this.getContentOffset();e.x*=-1;e.y*=-1;var f=Math.max(b-1,0);this._vOrdering===cc.TABLEVIEW_FILL_TOPDOWN&&
(e.y+=d.height/c.getScaleY());a=this._indexFromOffset(e);a===cc.INVALID_INDEX&&(a=b-1);e.y=this._vOrdering===cc.TABLEVIEW_FILL_TOPDOWN?e.y-d.height/c.getScaleY():e.y+d.height/c.getScaleY();e.x+=d.width/c.getScaleX();d=this._indexFromOffset(e);d===cc.INVALID_INDEX&&(d=b-1);e=this._cellsUsed;if(0<e.count())for(b=e.objectAtIndex(0),c=b.getIdx();c<a;)if(this._moveCellOutOfSight(b),0<e.count())b=e.objectAtIndex(0),c=b.getIdx();else break;if(0<e.count())for(b=e.lastObject(),c=b.getIdx();c<=f&&c>d;)if(this._moveCellOutOfSight(b),
0<e.count())b=e.lastObject(),c=b.getIdx();else break;for(f=this._indices;a<=d;a++)-1===f.indexOf(a)&&this.updateCellAtIndex(a)}},scrollViewDidZoom:function(a){},onTouchEnded:function(a,b){if(this.isVisible()){if(this._touchedCell){var c=this.getBoundingBox(),d=cc.p(c.x,c.y),d=this._parent.convertToWorldSpace(d);c.x=d.x;c.y=d.y;d=this._tableViewDelegate;cc.rectContainsPoint(c,a.getLocation())&&null!==d&&(d.tableCellUnhighlight&&d.tableCellUnhighlight(this,this._touchedCell),d.tableCellTouched&&d.tableCellTouched(this,
this._touchedCell));this._touchedCell=null}cc.ScrollView.prototype.onTouchEnded.call(this,a,b)}},onTouchBegan:function(a,b){for(var c=this;null!=c;c=c.parent)if(!c.isVisible())return!1;c=cc.ScrollView.prototype.onTouchBegan.call(this,a,b);if(1===this._touches.length){var d;d=this.getContainer().convertTouchToNodeSpace(a);d=this._indexFromOffset(d);(this._touchedCell=d===cc.INVALID_INDEX?null:this.cellAtIndex(d))&&null!==this._tableViewDelegate&&this._tableViewDelegate.tableCellHighlight&&this._tableViewDelegate.tableCellHighlight(this,
this._touchedCell)}else this._touchedCell&&(null!==this._tableViewDelegate&&this._tableViewDelegate.tableCellUnhighlight&&this._tableViewDelegate.tableCellUnhighlight(this,this._touchedCell),this._touchedCell=null);return c},onTouchMoved:function(a,b){cc.ScrollView.prototype.onTouchMoved.call(this,a,b);this._touchedCell&&this.isTouchMoved()&&(null!==this._tableViewDelegate&&this._tableViewDelegate.tableCellUnhighlight&&this._tableViewDelegate.tableCellUnhighlight(this,this._touchedCell),this._touchedCell=
null)},onTouchCancelled:function(a,b){cc.ScrollView.prototype.onTouchCancelled.call(this,a,b);this._touchedCell&&(null!==this._tableViewDelegate&&this._tableViewDelegate.tableCellUnhighlight&&this._tableViewDelegate.tableCellUnhighlight(this,this._touchedCell),this._touchedCell=null)}});_p=cc.TableView.prototype;cc.defineGetterSetter(_p,"dataSource",_p.getDataSource,_p.setDataSource);cc.defineGetterSetter(_p,"delegate",_p.getDelegate,_p.setDelegate);
cc.defineGetterSetter(_p,"verticalFillOrder",_p.getVerticalFillOrder,_p.setVerticalFillOrder);_p=null;cc.TableView.create=function(a,b,c){return new cc.TableView(a,b,c)};cc.pool={_pool:{},_releaseCB:function(){this.release()},_autoRelease:function(a){var b=void 0===a._running?!1:!a._running;cc.director.getScheduler().schedule(this._releaseCB,a,0,0,0,b)},putInPool:function(a){var b=a.constructor.prototype.__pid;if(!b){var c={writable:!0,enumerable:!1,configurable:!0};c.value=ClassManager.getNewID();Object.defineProperty(a.constructor.prototype,"__pid",c)}this._pool[b]||(this._pool[b]=[]);a.retain&&a.retain();a.unuse&&a.unuse();this._pool[b].push(a)},hasObject:function(a){return(a=
this._pool[a.prototype.__pid])&&0!==a.length?!0:!1},removeObject:function(a){var b=a.constructor.prototype.__pid;if(b&&(b=this._pool[b]))for(var c=0;c<b.length;c++)a===b[c]&&(a.release&&a.release(),b.splice(c,1))},getFromPool:function(a){if(this.hasObject(a)){var b=this._pool[a.prototype.__pid],c=Array.prototype.slice.call(arguments);c.shift();b=b.pop();b.reuse&&b.reuse.apply(b,c);cc.sys.isNative&&b.release&&this._autoRelease(b);return b}},drainAllPools:function(){for(var a in this._pool)for(var b=
0;b<this._pool[a].length;b++){var c=this._pool[a][b];c.release&&c.release()}this._pool={}}}; 
 			});
 		define("fs.js", function(require, module, exports){ 			
(function(){})(); 
 			});
 		define("long.js", function(require, module, exports){ 			
(function(){(function(a,b){"function"==typeof define&&define.amd?define([],b):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=b():(a.dcodeIO=a.dcodeIO||{}).Long=b()})(this,function(){function f(d,a,b){this.low=0|d,this.high=0|a,this.unsigned=!!b}function i(b){return!0===(b&&b.__isLong__)}function a(f,a){var b,c;if(a){if(f>>>=0,(c=0<=f&&256>f)&&(b=e[f]))return b;b=g(f,0>(0|f)?-1:0,!0),c&&(e[f]=b)}else{if(f|=0,(c=-128<=f&&128>f)&&(b=d[f]))return b;b=g(f,0>f?-1:0,!1),c&&(d[f]=b)}return b}function j(d,e){if(isNaN(d)||!isFinite(d))return e?k:v;if(e){if(0>d)return k;if(d>=c)return u}else{if(d<=-m)return x;if(d+1>=m)return t}return 0>d?j(-d,e).neg():g(0|d%4294967296,0|d/4294967296,e)}function g(d,a,b){return new f(d,a,b)}function h(i,a,k){if(0===i.length)throw Error("empty string");if("NaN"===i||"Infinity"===i||"+Infinity"===i||"-Infinity"===i)return v;if("number"==typeof a?(k=a,a=!1):a=!!a,k=k||10,2>k||36<k)throw RangeError("radix");var c;if(0<(c=i.indexOf("-")))throw Error("interior hyphen");if(0===c)return h(i.substring(1),a,k).neg();c=j(n(k,8));for(var l=v,e=0;e<i.length;e+=8){var f=Math.min(8,i.length-e),d=parseInt(i.substring(e,e+f),k);8>f?(f=j(n(k,f)),l=l.mul(f).add(j(d))):(l=l.mul(c),l=l.add(j(d)))}return l.unsigned=a,l}function o(b){return b instanceof f?b:"number"==typeof b?j(b):"string"==typeof b?h(b):g(b.low,b.high,b.unsigned)}Object.defineProperty(f.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),f.isLong=i;var d={},e={};f.fromInt=a,f.fromNumber=j,f.fromBits=g;var n=Math.pow;f.fromString=h,f.fromValue=o;var c=18446744073709552000,m=c/2,q=a(16777216),v=a(0);f.ZERO=v;var k=a(0,!0);f.UZERO=k;var p=a(1);f.ONE=p;var r=a(1,!0);f.UONE=r;var s=a(-1);f.NEG_ONE=s;var t=g(-1,2147483647,!1);f.MAX_VALUE=t;var u=g(-1,-1,!0);f.MAX_UNSIGNED_VALUE=u;var x=g(0,-2147483648,!1);f.MIN_VALUE=x;var l=f.prototype;return l.toInt=function(){return this.unsigned?this.low>>>0:this.low},l.toNumber=function(){return this.unsigned?4294967296*(this.high>>>0)+(this.low>>>0):4294967296*this.high+(this.low>>>0)},l.toString=function(g){if(g=g||10,2>g||36<g)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(x)){var a=j(g),b=this.div(a),a=b.mul(a).sub(this);return b.toString(g)+a.toInt().toString(g)}return"-"+this.neg().toString(g)}for(var b=j(n(g,6),this.unsigned),a=this,c="";;){var e=a.div(b),d=(a.sub(e.mul(b)).toInt()>>>0).toString(g),a=e;if(a.isZero())return d+c;for(;6>d.length;)d="0"+d;c=""+d+c}},l.getHighBits=function(){return this.high},l.getHighBitsUnsigned=function(){return this.high>>>0},l.getLowBits=function(){return this.low},l.getLowBitsUnsigned=function(){return this.low>>>0},l.getNumBitsAbs=function(){if(this.isNegative())return this.eq(x)?64:this.neg().getNumBitsAbs();for(var c=0==this.high?this.low:this.high,a=31;0<a&&0==(c&1<<a);a--);return 0==this.high?a+1:a+33},l.isZero=function(){return 0===this.high&&0===this.low},l.isNegative=function(){return!this.unsigned&&0>this.high},l.isPositive=function(){return this.unsigned||0<=this.high},l.isOdd=function(){return 1==(1&this.low)},l.isEven=function(){return 0==(1&this.low)},l.equals=function(b){return i(b)||(b=o(b)),this.unsigned!==b.unsigned&&1==this.high>>>31&&1==b.high>>>31?!1:this.high===b.high&&this.low===b.low},l.eq=l.equals,l.notEquals=function(b){return!this.eq(b)},l.neq=l.notEquals,l.lessThan=function(b){return 0>this.comp(b)},l.lt=l.lessThan,l.lessThanOrEqual=function(b){return 0>=this.comp(b)},l.lte=l.lessThanOrEqual,l.greaterThan=function(b){return 0<this.comp(b)},l.gt=l.greaterThan,l.greaterThanOrEqual=function(b){return 0<=this.comp(b)},l.gte=l.greaterThanOrEqual,l.compare=function(d){if(i(d)||(d=o(d)),this.eq(d))return 0;var a=this.isNegative(),e=d.isNegative();return a&&!e?-1:!a&&e?1:this.unsigned?d.high>>>0>this.high>>>0||d.high===this.high&&d.low>>>0>this.low>>>0?-1:1:this.sub(d).isNegative()?-1:1},l.comp=l.compare,l.negate=function(){return!this.unsigned&&this.eq(x)?x:this.not().add(p)},l.neg=l.negate,l.add=function(e){i(e)||(e=o(e));var a,h=this.high>>>16,b=65535&this.high,c=this.low>>>16,d=e.high>>>16,j=65535&e.high,f=e.low>>>16;return a=0+((65535&this.low)+(65535&e.low)),e=0+(a>>>16),e+=c+f,c=0+(e>>>16),c+=b+j,b=0+(c>>>16),b=65535&b+(h+d),g((65535&e)<<16|65535&a,b<<16|65535&c,this.unsigned)},l.subtract=function(b){return i(b)||(b=o(b)),this.add(b.neg())},l.sub=l.subtract,l.multiply=function(e){if(this.isZero())return v;if(i(e)||(e=o(e)),e.isZero())return v;if(this.eq(x))return e.isOdd()?x:v;if(e.eq(x))return this.isOdd()?x:v;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(q)&&e.lt(q))return j(this.toNumber()*e.toNumber(),this.unsigned);var a=this.high>>>16,b=65535&this.high,c=this.low>>>16,d=65535&this.low,k=e.high>>>16,f=65535&e.high,l=e.low>>>16;e=65535&e.low;var m,n,h,p;return p=0+d*e,h=0+(p>>>16),h+=c*e,n=0+(h>>>16),h=(65535&h)+d*l,n+=h>>>16,h&=65535,n+=b*e,m=0+(n>>>16),n=(65535&n)+c*l,m+=n>>>16,n&=65535,n+=d*f,m+=n>>>16,n&=65535,m=65535&m+(a*e+b*l+c*f+d*k),g(h<<16|65535&p,m<<16|n,this.unsigned)},l.mul=l.multiply,l.divide=function(g){if(i(g)||(g=o(g)),g.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?k:v;var a,b,c;if(this.unsigned){if(g.unsigned||(g=g.toUnsigned()),g.gt(this))return k;if(g.gt(this.shru(1)))return r;c=k}else{if(this.eq(x))return g.eq(p)||g.eq(s)?x:g.eq(x)?p:(a=this.shr(1).div(g).shl(1),a.eq(v))?g.isNegative()?p:s:(b=this.sub(g.mul(a)),c=a.add(b.div(g)));if(g.eq(x))return this.unsigned?k:v;if(this.isNegative())return g.isNegative()?this.neg().div(g.neg()):this.neg().div(g).neg();if(g.isNegative())return this.div(g.neg()).neg();c=v}for(b=this;b.gte(g);){a=Math.max(1,Math.floor(b.toNumber()/g.toNumber()));for(var d=Math.ceil(Math.log(a)/Math.LN2),d=48>=d?1:n(2,d-48),e=j(a),f=e.mul(g);f.isNegative()||f.gt(b);)a-=d,e=j(a,this.unsigned),f=e.mul(g);e.isZero()&&(e=p),c=c.add(e),b=b.sub(f)}return c},l.div=l.divide,l.modulo=function(b){return i(b)||(b=o(b)),this.sub(this.div(b).mul(b))},l.mod=l.modulo,l.not=function(){return g(~this.low,~this.high,this.unsigned)},l.and=function(b){return i(b)||(b=o(b)),g(this.low&b.low,this.high&b.high,this.unsigned)},l.or=function(b){return i(b)||(b=o(b)),g(this.low|b.low,this.high|b.high,this.unsigned)},l.xor=function(b){return i(b)||(b=o(b)),g(this.low^b.low,this.high^b.high,this.unsigned)},l.shiftLeft=function(b){return i(b)&&(b=b.toInt()),0==(b&=63)?this:32>b?g(this.low<<b,this.high<<b|this.low>>>32-b,this.unsigned):g(0,this.low<<b-32,this.unsigned)},l.shl=l.shiftLeft,l.shiftRight=function(b){return i(b)&&(b=b.toInt()),0==(b&=63)?this:32>b?g(this.low>>>b|this.high<<32-b,this.high>>b,this.unsigned):g(this.high>>b-32,0<=this.high?0:-1,this.unsigned)},l.shr=l.shiftRight,l.shiftRightUnsigned=function(c){if(i(c)&&(c=c.toInt()),c&=63,0===c)return this;var a=this.high;return 32>c?g(this.low>>>c|a<<32-c,a>>>c,this.unsigned):32===c?g(a,0,this.unsigned):g(a>>>c-32,0,this.unsigned)},l.shru=l.shiftRightUnsigned,l.toSigned=function(){return this.unsigned?g(this.low,this.high,!1):this},l.toUnsigned=function(){return this.unsigned?this:g(this.low,this.high,!0)},l.toBytes=function(b){return b?this.toBytesLE():this.toBytesBE()},l.toBytesLE=function(){var c=this.high,a=this.low;return[255&a,255&a>>>8,255&a>>>16,255&a>>>24,255&c,255&c>>>8,255&c>>>16,255&c>>>24]},l.toBytesBE=function(){var c=this.high,a=this.low;return[255&c>>>24,255&c>>>16,255&c>>>8,255&c,255&a>>>24,255&a>>>16,255&a>>>8,255&a]},f})})(); 
 			});
 		define("path.js", function(require, module, exports){ 			
(function(){})(); 
 			});
 		define("protobufjs.js", function(require, module, exports){ 			
(function(){(function(a,b){"function"==typeof define&&define.amd?define(["bytebuffer"],b):"function"==typeof require&&"object"==typeof module&&module&&module.exports?module.exports=b(require("bytebuffer"),!0):(a.dcodeIO=a.dcodeIO||{}).ProtoBuf=b(a.dcodeIO.ByteBuffer)})(this,function(i){var a={};return a.ByteBuffer=i,a.Long=i.Long||null,a.VERSION="5.0.1",a.WIRE_TYPES={},a.WIRE_TYPES.VARINT=0,a.WIRE_TYPES.BITS64=1,a.WIRE_TYPES.LDELIM=2,a.WIRE_TYPES.STARTGROUP=3,a.WIRE_TYPES.ENDGROUP=4,a.WIRE_TYPES.BITS32=5,a.PACKABLE_WIRE_TYPES=[a.WIRE_TYPES.VARINT,a.WIRE_TYPES.BITS64,a.WIRE_TYPES.BITS32],a.TYPES={int32:{name:"int32",wireType:a.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:a.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:a.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:a.WIRE_TYPES.VARINT,defaultValue:a.Long?a.Long.ZERO:void 0},uint64:{name:"uint64",wireType:a.WIRE_TYPES.VARINT,defaultValue:a.Long?a.Long.UZERO:void 0},sint64:{name:"sint64",wireType:a.WIRE_TYPES.VARINT,defaultValue:a.Long?a.Long.ZERO:void 0},bool:{name:"bool",wireType:a.WIRE_TYPES.VARINT,defaultValue:!1},double:{name:"double",wireType:a.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:a.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:a.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:a.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:a.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:a.WIRE_TYPES.BITS64,defaultValue:a.Long?a.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:a.WIRE_TYPES.BITS64,defaultValue:a.Long?a.Long.ZERO:void 0},float:{name:"float",wireType:a.WIRE_TYPES.BITS32,defaultValue:0},enum:{name:"enum",wireType:a.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:a.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:a.WIRE_TYPES.STARTGROUP,defaultValue:null}},a.MAP_KEY_TYPES=[a.TYPES.int32,a.TYPES.sint32,a.TYPES.sfixed32,a.TYPES.uint32,a.TYPES.fixed32,a.TYPES.int64,a.TYPES.sint64,a.TYPES.sfixed64,a.TYPES.uint64,a.TYPES.fixed64,a.TYPES.bool,a.TYPES.string,a.TYPES.bytes],a.ID_MIN=1,a.ID_MAX=536870911,a.convertFieldsToCamelCase=!1,a.populateAccessors=!0,a.populateDefaults=!0,a.Util=function(){var a={};return a.IS_NODE=!("object"!=typeof process||"[object process]"!=process+""||process.browser),a.XHR=function(){for(var a=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],b=null,c=0;c<a.length;c++){try{b=a[c]()}catch(a){continue}break}if(!b)throw Error("XMLHttpRequest is not supported");return b},a.fetch=function(b,c){if(c&&"function"!=typeof c&&(c=null),a.IS_NODE){var d=require("fs");if(c)d.readFile(b,function(a,b){a?c(null):c(""+b)});else try{return d.readFileSync(b)}catch(a){return null}}else{var e=a.XHR();if(e.open("GET",b,!!c),e.setRequestHeader("Accept","text/plain"),"function"==typeof e.overrideMimeType&&e.overrideMimeType("text/plain"),c)e.onreadystatechange=function(){4==e.readyState&&(200==e.status||0==e.status&&"string"==typeof e.responseText?c(e.responseText):c(null))},4!=e.readyState&&e.send(null);else return e.send(null),200==e.status||0==e.status&&"string"==typeof e.responseText?e.responseText:null}},a.toCamelCase=function(a){return a.replace(/_([a-zA-Z])/g,function(a,b){return b.toUpperCase()})},a}(),a.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)+$/,FQTYPEREF:/^(?:\.[a-zA-Z][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},a.DotProto=function(g,i){function b(d,b){var e=-1,a=1;if("-"==d.charAt(0)&&(a=-1,d=d.substring(1)),i.NUMBER_DEC.test(d))e=parseInt(d);else if(i.NUMBER_HEX.test(d))e=parseInt(d.substring(2),16);else if(i.NUMBER_OCT.test(d))e=parseInt(d.substring(1),8);else throw Error("illegal id value: "+(0>a?"-":"")+d);if(e=0|a*e,!b&&0>e)throw Error("illegal id value: "+(0>a?"-":"")+d);return e}function h(a){var b=1;if("-"==a.charAt(0)&&(b=-1,a=a.substring(1)),i.NUMBER_DEC.test(a))return b*parseInt(a,10);if(i.NUMBER_HEX.test(a))return b*parseInt(a.substring(2),16);if(i.NUMBER_OCT.test(a))return b*parseInt(a.substring(1),8);if("inf"===a)return Infinity*b;if("nan"===a)return NaN;if(i.NUMBER_FLT.test(a))return b*parseFloat(a);throw Error("illegal number value: "+(0>b?"-":"")+a)}function d(a,b,c){"undefined"==typeof a[b]?a[b]=c:(Array.isArray(a[b])||(a[b]=[a[b]]),a[b].push(c))}var c={},j=function(a){this.source=a+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},a=j.prototype;a._readString=function(){var a="\""===this._stringOpen?i.STRING_DQ:i.STRING_SQ;a.lastIndex=this.index-1;var b=a.exec(this.source);if(!b)throw Error("unterminated string");return this.index=a.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,b[1]},a.next=function(){if(0<this.stack.length)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var a,b;do{for(a=!1;i.WHITESPACE.test(b=this.source.charAt(this.index));)if("\n"===b&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,a=!0}else if("*"===(b=this.source.charAt(this.index))){do{if("\n"===b&&++this.line,++this.index===this.source.length)return null;a=b,b=this.source.charAt(this.index)}while("*"!==a||"/"!==b);++this.index,a=!0}else return"/"}while(a);if(this.index===this.source.length)return null;if(b=this.index,i.DELIM.lastIndex=0,!i.DELIM.test(this.source.charAt(b++)))for(;b<this.source.length&&!i.DELIM.test(this.source.charAt(b));)++b;return b=this.source.substring(this.index,this.index=b),("\""===b||"'"===b)&&(this._stringOpen=b),b},a.peek=function(){if(0===this.stack.length){var a=this.next();if(null===a)return null;this.stack.push(a)}return this.stack[0]},a.skip=function(a){var b=this.next();if(b!==a)throw Error("illegal '"+b+"', '"+a+"' expected")},a.omit=function(a){return this.peek()===a&&(this.next(),!0)},a.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},c.Tokenizer=j;var e=function(a){this.tn=new j(a),this.proto3=!1},a=e.prototype;return a.parse=function(){var d,c,e={name:"[ROOT]",package:null,messages:[],enums:[],imports:[],options:{},services:[]},b=!0;try{for(;d=this.tn.next();)switch(d){case"package":if(!b||null!==e["package"])throw Error("unexpected 'package'");if(d=this.tn.next(),!i.TYPEREF.test(d))throw Error("illegal package name: "+d);this.tn.skip(";"),e["package"]=d;break;case"import":if(!b)throw Error("unexpected 'import'");d=this.tn.peek(),("public"===d||(c="weak"===d))&&this.tn.next(),d=this._readString(),this.tn.skip(";"),c||e.imports.push(d);break;case"syntax":if(!b)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(e.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(e,null),b=!1;break;case"enum":this._parseEnum(e),b=!1;break;case"option":this._parseOption(e);break;case"service":this._parseService(e);break;case"extend":this._parseExtend(e);break;default:throw Error("unexpected '"+d+"'");}}catch(a){throw a.message="Parse error at line "+this.tn.line+": "+a.message,a}return delete e.name,e},e.parse=function(a){return new e(a).parse()},a._readString=function(){var a,c="";do{if(a=this.tn.next(),"'"!==a&&"\""!==a)throw Error("illegal string delimiter: "+a);c+=this.tn.next(),this.tn.skip(a),a=this.tn.peek()}while("\""===a||"\""===a);return c},a._readValue=function(a){var b=this.tn.peek();if("\""===b||"'"===b)return this._readString();if(this.tn.next(),i.NUMBER.test(b))return h(b);if(i.BOOL.test(b))return"true"===b.toLowerCase();if(a&&i.TYPEREF.test(b))return b;throw Error("illegal value: "+b)},a._parseOption=function(d,b){var c=this.tn.next(),a=!1;if("("===c&&(a=!0,c=this.tn.next()),!i.TYPEREF.test(c))throw Error("illegal option name: "+c);var f=c;a&&(this.tn.skip(")"),f="("+f+")",c=this.tn.peek(),i.FQTYPEREF.test(c)&&(f+=c,this.tn.next())),this.tn.skip("="),this._parseOptionValue(d,f),b||this.tn.skip(";")},a._parseOptionValue=function(e,b){var c=this.tn.peek();if("{"!==c)d(e.options,b,this._readValue(!0));else for(this.tn.skip("{");"}"!==(c=this.tn.next());){if(!i.NAME.test(c))throw Error("illegal option name: "+b+"."+c);this.tn.omit(":")?d(e.options,b+"."+c,this._readValue(!0)):this._parseOptionValue(e,b+"."+c)}},a._parseService=function(d){var b=this.tn.next();if(!i.NAME.test(b))throw Error("illegal service name at line "+this.tn.line+": "+b);var e={name:b,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(b=this.tn.next());)if("option"===b)this._parseOption(e);else if("rpc"===b)this._parseServiceRPC(e);else throw Error("illegal service token: "+b);this.tn.omit(";"),d.services.push(e)},a._parseServiceRPC=function(d){var b=this.tn.next();if(!i.NAME.test(b))throw Error("illegal rpc service method name: "+b);var c=b,a={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),b=this.tn.next(),"stream"===b.toLowerCase()&&(a.request_stream=!0,b=this.tn.next()),!i.TYPEREF.test(b))throw Error("illegal rpc service request type: "+b);if(a.request=b,this.tn.skip(")"),b=this.tn.next(),"returns"!==b.toLowerCase())throw Error("illegal rpc service request type delimiter: "+b);if(this.tn.skip("("),b=this.tn.next(),"stream"===b.toLowerCase()&&(a.response_stream=!0,b=this.tn.next()),a.response=b,this.tn.skip(")"),b=this.tn.peek(),"{"===b){for(this.tn.next();"}"!==(b=this.tn.next());)if("option"===b)this._parseOption(a);else throw Error("illegal rpc service token: "+b);this.tn.omit(";")}else this.tn.skip(";");"undefined"==typeof d.rpc&&(d.rpc={}),d.rpc[c]=a},a._parseMessage=function(d,f){var g=!!f,a=this.tn.next(),h={name:"",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!i.NAME.test(a))throw Error("illegal "+(g?"group":"message")+" name: "+a);for(h.name=a,g&&(this.tn.skip("="),f.id=b(this.tn.next()),h.isGroup=!0),a=this.tn.peek(),"["===a&&f&&this._parseFieldOptions(f),this.tn.skip("{");"}"!==(a=this.tn.next());)if(i.RULE.test(a))this._parseMessageField(h,a);else if("oneof"===a)this._parseMessageOneOf(h);else if("enum"===a)this._parseEnum(h);else if("message"===a)this._parseMessage(h);else if("option"===a)this._parseOption(h);else if("service"===a)this._parseService(h);else if("extensions"===a)h.extensions=this._parseExtensionRanges();else if("reserved"===a)this._parseIgnored();else if("extend"===a)this._parseExtend(h);else if(i.TYPEREF.test(a)){if(!this.proto3)throw Error("illegal field rule: "+a);this._parseMessageField(h,"optional",a)}else throw Error("illegal message token: "+a);return this.tn.omit(";"),d.messages.push(h),h},a._parseIgnored=function(){for(;";"!==this.tn.peek();)this.tn.next();this.tn.skip(";")},a._parseMessageField=function(d,f,g){if(!i.RULE.test(f))throw Error("illegal message field rule: "+f);var h={rule:f,type:"",name:"",options:{},id:0};if("map"===f){if(g)throw Error("illegal type: "+g);if(this.tn.skip("<"),f=this.tn.next(),!i.TYPE.test(f)&&!i.TYPEREF.test(f))throw Error("illegal message field type: "+f);if(h.keytype=f,this.tn.skip(","),f=this.tn.next(),!i.TYPE.test(f)&&!i.TYPEREF.test(f))throw Error("illegal message field: "+f);if(h.type=f,this.tn.skip(">"),f=this.tn.next(),!i.NAME.test(f))throw Error("illegal message field name: "+f);h.name=f,this.tn.skip("="),h.id=b(this.tn.next()),f=this.tn.peek(),"["==f&&this._parseFieldOptions(h),this.tn.skip(";")}else if(g="undefined"==typeof g?this.tn.next():g,"group"===g){if(f=this._parseMessage(d,h),!/^[A-Z]/.test(f.name))throw Error("illegal group name: "+f.name);h.type=f.name,h.name=f.name.toLowerCase(),this.tn.omit(";")}else{if(!i.TYPE.test(g)&&!i.TYPEREF.test(g))throw Error("illegal message field type: "+g);if(h.type=g,f=this.tn.next(),!i.NAME.test(f))throw Error("illegal message field name: "+f);h.name=f,this.tn.skip("="),h.id=b(this.tn.next()),f=this.tn.peek(),"["==f&&this._parseFieldOptions(h),this.tn.skip(";")}return d.fields.push(h),h},a._parseMessageOneOf=function(d){var b=this.tn.next();if(!i.NAME.test(b))throw Error("illegal oneof name: "+b);var c=b,a=[];for(this.tn.skip("{");"}"!==(b=this.tn.next());)b=this._parseMessageField(d,"optional",b),b.oneof=c,a.push(b.id);this.tn.omit(";"),d.oneofs[c]=a},a._parseFieldOptions=function(a){this.tn.skip("[");for(var b=!0;"]"!==this.tn.peek();)b||this.tn.skip(","),this._parseOption(a,!0),b=!1;this.tn.next()},a._parseEnum=function(d){var f={name:"",values:[],options:{}},c=this.tn.next();if(!i.NAME.test(c))throw Error("illegal name: "+c);for(f.name=c,this.tn.skip("{");"}"!==(c=this.tn.next());)if("option"===c)this._parseOption(f);else{if(!i.NAME.test(c))throw Error("illegal name: "+c);this.tn.skip("=");var g={name:c,id:b(this.tn.next(),!0)},c=this.tn.peek();"["==c&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),f.values.push(g)}this.tn.omit(";"),d.enums.push(f)},a._parseExtensionRanges=function(){var b,c,d=[];do{for(c=[];;){if(b=this.tn.next(),b="min"===b?g.ID_MIN:"max"===b?g.ID_MAX:h(b),(c.push(b),2===c.length))break;if("to"!==this.tn.peek()){c.push(b);break}this.tn.next()}d.push(c)}while(this.tn.omit(","));return this.tn.skip(";"),d},a._parseExtend=function(c){var b=this.tn.next();if(!i.TYPEREF.test(b))throw Error("illegal extend reference: "+b);var d={ref:b,fields:[]};for(this.tn.skip("{");"}"!==(b=this.tn.next());)if(i.RULE.test(b))this._parseMessageField(d,b);else if(i.TYPEREF.test(b)){if(!this.proto3)throw Error("illegal field rule: "+b);this._parseMessageField(d,"optional",b)}else throw Error("illegal extend token: "+b);return this.tn.omit(";"),c.messages.push(d),d},a.toString=function(){return"Parser at line "+this.tn.line},c.Parser=e,c}(a,a.Lang),a.Reflect=function(j){function b(a,b){if(a&&"number"==typeof a.low&&"number"==typeof a.high&&"boolean"==typeof a.unsigned&&a.low===a.low&&a.high===a.high)return new j.Long(a.low,a.high,"undefined"==typeof b?a.unsigned:b);if("string"==typeof a)return j.Long.fromString(a,b||!1,10);if("number"==typeof a)return j.Long.fromNumber(a,b||!1);throw Error("not convertible to Long")}function d(b,e){var f=e.readVarint32(),a=7&f,f=f>>>3;switch(a){case j.WIRE_TYPES.VARINT:do f=e.readUint8();while(128==(128&f));break;case j.WIRE_TYPES.BITS64:e.offset+=8;break;case j.WIRE_TYPES.LDELIM:f=e.readVarint32(),e.offset+=f;break;case j.WIRE_TYPES.STARTGROUP:d(f,e);break;case j.WIRE_TYPES.ENDGROUP:if(f===b)return!1;throw Error("Illegal GROUPEND after unknown group: "+f+" ("+b+" expected)");case j.WIRE_TYPES.BITS32:e.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+b+": "+a);}return!0}var g={},m=function(c,d,b){this.builder=c,this.parent=d,this.name=b},h=m.prototype;h.fqn=function(){var a=this.name,c=this;do{if(c=c.parent,null==c)break;a=c.name+"."+a}while(1);return a},h.toString=function(a){return(a?this.className+" ":"")+this.fqn()},h.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},g.T=m;var k=function(e,f,b,a,c){m.call(this,e,f,b),this.className="Namespace",this.children=[],this.options=a||{},this.syntax=c||"proto2"},h=k.prototype=Object.create(m.prototype);h.getChildren=function(e){if(e=e||null,null==e)return this.children.slice();for(var b=[],a=0,c=this.children.length;a<c;++a)this.children[a]instanceof e&&b.push(this.children[a]);return b},h.addChild=function(c){var b;if(b=this.getChild(c.name))if(b instanceof o.Field&&b.name!==b.originalName&&null===this.getChild(b.originalName))b.name=b.originalName;else if(c instanceof o.Field&&c.name!==c.originalName&&null===this.getChild(c.originalName))c.name=c.originalName;else throw Error("Duplicate name in namespace "+this.toString(!0)+": "+c.name);this.children.push(c)},h.getChild=function(e){for(var f="number"==typeof e?"id":"name",a=0,c=this.children.length;a<c;++a)if(this.children[a][f]===e)return this.children[a];return null},h.resolve=function(f,h){var a="string"==typeof f?f.split("."):f,c=this,d=0;if(""===a[d]){for(;null!==c.parent;)c=c.parent;d++}do{do{if(!(c instanceof g.Namespace)){c=null;break}if(c=c.getChild(a[d]),!(c&&c instanceof g.T)||h&&!(c instanceof g.Namespace)){c=null;break}d++}while(d<a.length);if(null!=c)break;if(null!==this.parent)return this.parent.resolve(f,h)}while(null!=c);return c},h.qn=function(e){var b=[],a=e;do b.unshift(a.name),a=a.parent;while(null!==a);for(a=1;a<=b.length;a++){var c=b.slice(b.length-a);if(e===this.resolve(c,e instanceof g.Namespace))return c.join(".")}return e.fqn()},h.build=function(){for(var a,f={},b=this.children,c=0,d=b.length;c<d;++c)a=b[c],a instanceof k&&(f[a.name]=a.build());return Object.defineProperty&&Object.defineProperty(f,"$options",{value:this.buildOpt()}),f},h.buildOpt=function(){for(var e={},b=Object.keys(this.options),a=0,c=b.length;a<c;++a)e[b[a]]=this.options[b[a]];return e},h.getOption=function(a){return"undefined"==typeof a?this.options:"undefined"==typeof this.options[a]?null:this.options[a]},g.Namespace=k;var n=function(b,e,a,c){if(this.type=b,this.resolvedType=e,this.isMapKey=a,this.syntax=c,a&&0>j.MAP_KEY_TYPES.indexOf(b))throw Error("Invalid map key type: "+b.name)},a=n.prototype;n.defaultFieldValue=function(a){if("string"==typeof a&&(a=j.TYPES[a]),"undefined"==typeof a.defaultValue)throw Error("default value for type "+a.name+" is not supported");return a==j.TYPES.bytes?new i(0):a.defaultValue},a.verifyValue=function(d){function h(c,b){throw Error("Illegal value for "+a.toString(!0)+" of type "+a.type.name+": "+c+" ("+b+")")}var a=this;switch(this.type){case j.TYPES.int32:case j.TYPES.sint32:case j.TYPES.sfixed32:return("number"!=typeof d||d===d&&0!=d%1)&&h(typeof d,"not an integer"),4294967295<d?0|d:d;case j.TYPES.uint32:case j.TYPES.fixed32:return("number"!=typeof d||d===d&&0!=d%1)&&h(typeof d,"not an integer"),0>d?d>>>0:d;case j.TYPES.int64:case j.TYPES.sint64:case j.TYPES.sfixed64:if(j.Long)try{return b(d,!1)}catch(a){h(typeof d,a.message)}else h(typeof d,"requires Long.js");case j.TYPES.uint64:case j.TYPES.fixed64:if(j.Long)try{return b(d,!0)}catch(a){h(typeof d,a.message)}else h(typeof d,"requires Long.js");case j.TYPES.bool:return"boolean"!=typeof d&&h(typeof d,"not a boolean"),d;case j.TYPES.float:case j.TYPES.double:return"number"!=typeof d&&h(typeof d,"not a number"),d;case j.TYPES.string:return"string"==typeof d||d&&d instanceof String||h(typeof d,"not a string"),""+d;case j.TYPES.bytes:return i.isByteBuffer(d)?d:i.wrap(d,"base64");case j.TYPES["enum"]:for(var c=this.resolvedType.getChildren(j.Reflect.Enum.Value),e=0;e<c.length;e++)if(c[e].name==d||c[e].id==d)return c[e].id;if("proto3"===this.syntax)return("number"!=typeof d||d===d&&0!=d%1)&&h(typeof d,"not an integer"),(4294967295<d||0>d)&&h(typeof d,"not in range for uint32"),d;h(d,"not a valid enum value");case j.TYPES.group:case j.TYPES.message:if(d&&"object"==typeof d||h(typeof d,"object expected"),d instanceof this.resolvedType.clazz)return d;if(d instanceof j.Builder.Message){var e,c={};for(e in d)d.hasOwnProperty(e)&&(c[e]=d[e]);d=c}return new this.resolvedType.clazz(d);}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+d+" (undefined type "+this.type+")")},a.calculateLength=function(b,d){if(null===d)return 0;var a;switch(this.type){case j.TYPES.int32:return 0>d?i.calculateVarint64(d):i.calculateVarint32(d);case j.TYPES.uint32:return i.calculateVarint32(d);case j.TYPES.sint32:return i.calculateVarint32(i.zigZagEncode32(d));case j.TYPES.fixed32:case j.TYPES.sfixed32:case j.TYPES.float:return 4;case j.TYPES.int64:case j.TYPES.uint64:return i.calculateVarint64(d);case j.TYPES.sint64:return i.calculateVarint64(i.zigZagEncode64(d));case j.TYPES.fixed64:case j.TYPES.sfixed64:return 8;case j.TYPES.bool:return 1;case j.TYPES["enum"]:return i.calculateVarint32(d);case j.TYPES.double:return 8;case j.TYPES.string:return a=i.calculateUTF8Bytes(d),i.calculateVarint32(a)+a;case j.TYPES.bytes:if(0>d.remaining())throw Error("Illegal value for "+this.toString(!0)+": "+d.remaining()+" bytes remaining");return i.calculateVarint32(d.remaining())+d.remaining();case j.TYPES.message:return a=this.resolvedType.calculate(d),i.calculateVarint32(a)+a;case j.TYPES.group:return a=this.resolvedType.calculate(d),a+i.calculateVarint32(b<<3|j.WIRE_TYPES.ENDGROUP);}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+d+" (unknown type)")},a.encodeValue=function(b,d,e){if(null===d)return e;switch(this.type){case j.TYPES.int32:0>d?e.writeVarint64(d):e.writeVarint32(d);break;case j.TYPES.uint32:e.writeVarint32(d);break;case j.TYPES.sint32:e.writeVarint32ZigZag(d);break;case j.TYPES.fixed32:e.writeUint32(d);break;case j.TYPES.sfixed32:e.writeInt32(d);break;case j.TYPES.int64:case j.TYPES.uint64:e.writeVarint64(d);break;case j.TYPES.sint64:e.writeVarint64ZigZag(d);break;case j.TYPES.fixed64:e.writeUint64(d);break;case j.TYPES.sfixed64:e.writeInt64(d);break;case j.TYPES.bool:"string"==typeof d?e.writeVarint32("false"===d.toLowerCase()?0:!!d):e.writeVarint32(d?1:0);break;case j.TYPES["enum"]:e.writeVarint32(d);break;case j.TYPES.float:e.writeFloat32(d);break;case j.TYPES.double:e.writeFloat64(d);break;case j.TYPES.string:e.writeVString(d);break;case j.TYPES.bytes:if(0>d.remaining())throw Error("Illegal value for "+this.toString(!0)+": "+d.remaining()+" bytes remaining");b=d.offset,e.writeVarint32(d.remaining()),e.append(d),d.offset=b;break;case j.TYPES.message:b=new i().LE(),this.resolvedType.encode(d,b),e.writeVarint32(b.offset),e.append(b.flip());break;case j.TYPES.group:this.resolvedType.encode(d,e),e.writeVarint32(b<<3|j.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+d+" (unknown type)");}return e},a.decode=function(b,a,c){if(a!=this.type.wireType)throw Error("Unexpected wire type for element");switch(this.type){case j.TYPES.int32:return 0|b.readVarint32();case j.TYPES.uint32:return b.readVarint32()>>>0;case j.TYPES.sint32:return 0|b.readVarint32ZigZag();case j.TYPES.fixed32:return b.readUint32()>>>0;case j.TYPES.sfixed32:return 0|b.readInt32();case j.TYPES.int64:return b.readVarint64();case j.TYPES.uint64:return b.readVarint64().toUnsigned();case j.TYPES.sint64:return b.readVarint64ZigZag();case j.TYPES.fixed64:return b.readUint64();case j.TYPES.sfixed64:return b.readInt64();case j.TYPES.bool:return!!b.readVarint32();case j.TYPES["enum"]:return b.readVarint32();case j.TYPES.float:return b.readFloat();case j.TYPES.double:return b.readDouble();case j.TYPES.string:return b.readVString();case j.TYPES.bytes:if(c=b.readVarint32(),b.remaining()<c)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+c+" required but got only "+b.remaining());return a=b.clone(),a.limit=a.offset+c,b.offset+=c,a;case j.TYPES.message:return c=b.readVarint32(),this.resolvedType.decode(b,c);case j.TYPES.group:return this.resolvedType.decode(b,-1,c);}throw Error("[INTERNAL] Illegal decode type")},a.valueFromString=function(b){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case j.TYPES.int32:case j.TYPES.sint32:case j.TYPES.sfixed32:case j.TYPES.uint32:case j.TYPES.fixed32:return this.verifyValue(parseInt(b));case j.TYPES.int64:case j.TYPES.sint64:case j.TYPES.sfixed64:case j.TYPES.uint64:case j.TYPES.fixed64:return this.verifyValue(b);case j.TYPES.bool:return"true"===b;case j.TYPES.string:return this.verifyValue(b);case j.TYPES.bytes:return i.fromBinary(b);}},a.valueToString=function(b){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===j.TYPES.bytes?b.toString("binary"):b.toString()},g.Element=n;var o=function(a,b,c,d,e,g){k.call(this,a,b,c,d,g),this.className="Message",this.extensions=void 0,this.clazz=null,this.isGroup=!!e,this._fieldsByName=this._fieldsById=this._fields=null},a=o.prototype=Object.create(k.prototype);a.build=function(b){if(this.clazz&&!b)return this.clazz;b=function(h,j){function n(b,c,g,d){if(null===b||"object"!=typeof b){if(d&&d instanceof h.Reflect.Enum){var e=h.Reflect.Enum.getName(d.object,b);if(null!==e)return e}return b}if(i.isByteBuffer(b))return c?b.toBase64():b.toBuffer();if(h.Long.isLong(b))return g?b.toString():h.Long.fromValue(b);var j;if(Array.isArray(b))return j=[],b.forEach(function(e,a){j[a]=n(e,c,g,d)}),j;if(j={},b instanceof h.Map){for(var e=b.entries(),l=e.next();!l.done;l=e.next())j[b.keyElem.valueToString(l.value[0])]=n(l.value[1],c,g,b.valueElem.resolvedType);return j}var f,e=b.$type,l=void 0;for(f in b)b.hasOwnProperty(f)&&(e&&(l=e.getChild(f))?j[f]=n(b[f],c,g,l.resolvedType):j[f]=n(b[f],c,g));return j}var b=j.getChildren(h.Reflect.Message.Field),c=j.getChildren(h.Reflect.Message.OneOf),d=function(a){h.Builder.Message.call(this);for(var e=0,g=c.length;e<g;++e)this[c[e].name]=null;for(e=0,g=b.length;e<g;++e){var f=b[e];this[f.name]=f.repeated?[]:f.map?new h.Map(f):null,(f.required||"proto3"===j.syntax)&&null!==f.defaultValue&&(this[f.name]=f.defaultValue)}if(0<arguments.length)if(1!==arguments.length||null===a||"object"!=typeof a||!("function"!=typeof a.encode||a instanceof d)||Array.isArray(a)||a instanceof h.Map||i.isByteBuffer(a)||a instanceof ArrayBuffer||h.Long&&a instanceof h.Long)for(e=0,g=arguments.length;e<g;++e)"undefined"!=typeof(f=arguments[e])&&this.$set(b[e].name,f);else this.$set(a)},k=d.prototype=Object.create(h.Builder.Message.prototype);k.add=function(a,b,c){var f=j._fieldsByName[a];if(!c){if(!f)throw Error(this+"#"+a+" is undefined");if(!(f instanceof h.Reflect.Message.Field))throw Error(this+"#"+a+" is not a field: "+f.toString(!0));if(!f.repeated)throw Error(this+"#"+a+" is not a repeated field");b=f.verifyValue(b,!0)}return null===this[a]&&(this[a]=[]),this[a].push(b),this},k.$add=k.add,k.set=function(a,b,f){if(a&&"object"==typeof a){for(var d in f=b,a)a.hasOwnProperty(d)&&"undefined"!=typeof(b=a[d])&&this.$set(d,b,f);return this}if(d=j._fieldsByName[a],f)this[a]=b;else{if(!d)throw Error(this+"#"+a+" is not a field: undefined");if(!(d instanceof h.Reflect.Message.Field))throw Error(this+"#"+a+" is not a field: "+d.toString(!0));this[d.name]=b=d.verifyValue(b)}return d&&d.oneof&&(f=this[d.oneof.name],null===b?f===a&&(this[d.oneof.name]=null):(null!==f&&f!==d.name&&(this[f]=null),this[d.oneof.name]=d.name)),this},k.$set=k.set,k.get=function(a,b){if(b)return this[a];var c=j._fieldsByName[a];if(!(c&&c instanceof h.Reflect.Message.Field))throw Error(this+"#"+a+" is not a field: undefined");if(!(c instanceof h.Reflect.Message.Field))throw Error(this+"#"+a+" is not a field: "+c.toString(!0));return this[c.name]},k.$get=k.get;for(var e,f=0;f<b.length;f++)e=b[f],e instanceof h.Reflect.Message.ExtensionField||j.builder.options.populateAccessors&&function(f){var a=f.originalName.replace(/(_[a-zA-Z])/g,function(b){return b.toUpperCase().replace("_","")}),a=a.substring(0,1).toUpperCase()+a.substring(1),b=f.originalName.replace(/([A-Z])/g,function(b){return"_"+b}),c=function(b,a){return this[f.name]=a?b:f.verifyValue(b),this},d=function(){return this[f.name]};null===j.getChild("set"+a)&&(k["set"+a]=c),null===j.getChild("set_"+b)&&(k["set_"+b]=c),null===j.getChild("get"+a)&&(k["get"+a]=d),null===j.getChild("get_"+b)&&(k["get_"+b]=d)}(e);return k.encode=function(a,e){"boolean"==typeof a&&(e=a,a=void 0);var c=!1;a||(a=new i,c=!0);var f=a.littleEndian;try{return j.encode(this,a.LE(),e),(c?a.flip():a).LE(f)}catch(b){throw a.LE(f),b}},d.encode=function(e,b,a){return new d(e).encode(b,a)},k.calculate=function(){return j.calculate(this)},k.encodeDelimited=function(a,b){var c=!1;a||(a=new i,c=!0);var e=new i().LE();return j.encode(this,e,b).flip(),a.writeVarint32(e.remaining()),a.append(e),c?a.flip():a},k.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toArrayBuffer()),a}},k.toArrayBuffer=k.encodeAB,k.encodeNB=function(){try{return this.encode().toBuffer()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toBuffer()),a}},k.toBuffer=k.encodeNB,k.encode64=function(){try{return this.encode().toBase64()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toBase64()),a}},k.toBase64=k.encode64,k.encodeHex=function(){try{return this.encode().toHex()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toHex()),a}},k.toHex=k.encodeHex,k.toRaw=function(c,d){return n(this,!!c,!!d,this.$type)},k.encodeJSON=function(){return JSON.stringify(n(this,!0,!0,this.$type))},d.decode=function(a,f,e){"string"==typeof f&&(e=f),"string"==typeof a&&(a=i.wrap(a,e?e:"base64")),a=i.isByteBuffer(a)?a:i.wrap(a),f=a.littleEndian;try{var g=j.decode(a.LE());return a.LE(f),g}catch(b){throw a.LE(f),b}},d.decodeDelimited=function(a,f){if("string"==typeof a&&(a=i.wrap(a,f?f:"base64")),a=i.isByteBuffer(a)?a:i.wrap(a),1>a.remaining())return null;var c=a.offset,g=a.readVarint32();if(a.remaining()<g)return a.offset=c,null;try{var d=j.decode(a.slice(a.offset,a.offset+g).LE());return a.offset+=g,d}catch(b){throw a.offset+=g,b}},d.decode64=function(a){return d.decode(a,"base64")},d.decodeHex=function(a){return d.decode(a,"hex")},d.decodeJSON=function(a){return new d(JSON.parse(a))},k.toString=function(){return j.toString()},Object.defineProperty&&(Object.defineProperty(d,"$options",{value:j.buildOpt()}),Object.defineProperty(k,"$options",{value:d.$options}),Object.defineProperty(d,"$type",{value:j}),Object.defineProperty(k,"$type",{value:j})),d}(j,this),this._fields=[],this._fieldsById={},this._fieldsByName={};for(var g,e=0,c=this.children.length;e<c;e++)if(g=this.children[e],g instanceof f||g instanceof o||g instanceof l){if(b.hasOwnProperty(g.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+g.toString(!0)+" cannot override static property '"+g.name+"'");b[g.name]=g.build()}else if(g instanceof o.Field)g.build(),this._fields.push(g),this._fieldsById[g.id]=g,this._fieldsByName[g.name]=g;else if(!(g instanceof o.OneOf||g instanceof q))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[e].toString(!0));return this.clazz=b},a.encode=function(g,b,a){for(var c,e,h=null,d=0,i=this._fields.length;d<i;++d)c=this._fields[d],e=g[c.name],c.required&&null===e?null===h&&(h=c):c.encode(a?e:c.verifyValue(e),b,g);if(null!==h)throw g=Error("Missing at least one required field for "+this.toString(!0)+": "+h),g.encoded=b,g;return b},a.calculate=function(f){for(var b,e,g=0,a=0,c=this._fields.length;a<c;++a){if(b=this._fields[a],e=f[b.name],b.required&&null===e)throw Error("Missing at least one required field for "+this.toString(!0)+": "+b);g+=b.calculate(e,f)}return g},a.decode=function(b,a,g){a="number"==typeof a?a:-1;for(var h,f,i,k=b.offset,e=new this.clazz;b.offset<k+a||-1===a&&0<b.remaining();){if(h=b.readVarint32(),f=7&h,i=h>>>3,f===j.WIRE_TYPES.ENDGROUP){if(i!==g)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+i+" ("+(g?g+" expected":"not a group")+")");break}if(h=this._fieldsById[i])h.repeated&&!h.options.packed?e[h.name].push(h.decode(f,b)):h.map?(f=h.decode(f,b),e[h.name].set(f[0],f[1])):(e[h.name]=h.decode(f,b),h.oneof&&(f=e[h.oneof.name],null!==f&&f!==h.name&&(e[f]=null),e[h.oneof.name]=h.name));else switch(f){case j.WIRE_TYPES.VARINT:b.readVarint32();break;case j.WIRE_TYPES.BITS32:b.offset+=4;break;case j.WIRE_TYPES.BITS64:b.offset+=8;break;case j.WIRE_TYPES.LDELIM:h=b.readVarint32(),b.offset+=h;break;case j.WIRE_TYPES.STARTGROUP:for(;d(i,b););break;default:throw Error("Illegal wire type for unknown field "+i+" in "+this.toString(!0)+"#decode: "+f);}}for(b=0,a=this._fields.length;b<a;++b)if(h=this._fields[b],null===e[h.name])if("proto3"===this.syntax)e[h.name]=h.defaultValue;else{if(h.required)throw b=Error("Missing at least one required field for "+this.toString(!0)+": "+h.name),b.decoded=e,b;j.populateDefaults&&null!==h.defaultValue&&(e[h.name]=h.defaultValue)}return e},g.Message=o;var p=function(b,a,c,d,e,g,f,i,h,k){m.call(this,b,a,g),this.className="Message.Field",this.required="required"===c,this.repeated="repeated"===c,this.map="map"===c,this.keyType=d||null,this.type=e,this.resolvedType=null,this.id=f,this.options=i||{},this.defaultValue=null,this.oneof=h||null,this.syntax=k||"proto2",this.originalName=this.name,this.keyElement=this.element=null,!this.builder.options.convertFieldsToCamelCase||this instanceof o.ExtensionField||(this.name=j.Util.toCamelCase(this.name))},a=p.prototype=Object.create(m.prototype);a.build=function(){this.element=new n(this.type,this.resolvedType,!1,this.syntax),this.map&&(this.keyElement=new n(this.keyType,void 0,!0,this.syntax)),"proto3"!==this.syntax||this.repeated||this.map?"undefined"!=typeof this.options["default"]&&(this.defaultValue=this.verifyValue(this.options["default"])):this.defaultValue=n.defaultFieldValue(this.type)},a.verifyValue=function(b,g){function h(c,b){throw Error("Illegal value for "+d.toString(!0)+" of type "+d.type.name+": "+c+" ("+b+")")}g=g||!1;var d=this;if(null===b)return this.required&&h(typeof b,"required"),"proto3"===this.syntax&&this.type!==j.TYPES.message&&h(typeof b,"proto3 field without field presence cannot be null"),null;var e;if(this.repeated&&!g){Array.isArray(b)||(b=[b]);var i=[];for(e=0;e<b.length;e++)i.push(this.element.verifyValue(b[e]));return i}return this.map&&!g?b instanceof j.Map?b:(b instanceof Object||h(typeof b,"expected ProtoBuf.Map or raw object for map field"),new j.Map(this,b)):(!this.repeated&&Array.isArray(b)&&h(typeof b,"no array expected"),this.element.verifyValue(b))},a.hasWirePresence=function(b,a){if("proto3"!==this.syntax)return null!==b;if(this.oneof&&a[this.oneof.name]===this.name)return!0;switch(this.type){case j.TYPES.int32:case j.TYPES.sint32:case j.TYPES.sfixed32:case j.TYPES.uint32:case j.TYPES.fixed32:return 0!==b;case j.TYPES.int64:case j.TYPES.sint64:case j.TYPES.sfixed64:case j.TYPES.uint64:case j.TYPES.fixed64:return 0!==b.low||0!==b.high;case j.TYPES.bool:return b;case j.TYPES.float:case j.TYPES.double:return 0!==b;case j.TYPES.string:return 0<b.length;case j.TYPES.bytes:return 0<b.remaining();case j.TYPES["enum"]:return 0!==b;case j.TYPES.message:return null!==b;default:return!0;}},a.encode=function(b,g,a){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===b||this.repeated&&0==b.length)return g;try{if(this.repeated){var c;if(this.options.packed&&0<=j.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){g.writeVarint32(this.id<<3|j.WIRE_TYPES.LDELIM),g.ensureCapacity(g.offset+=1);var d=g.offset;for(c=0;c<b.length;c++)this.element.encodeValue(this.id,b[c],g);var e=g.offset-d,f=i.calculateVarint32(e);if(1<f){var h=g.slice(d,g.offset),d=d+(f-1);g.offset=d,g.append(h)}g.writeVarint32(e,d-f)}else for(c=0;c<b.length;c++)g.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,b[c],g)}else this.map?b.forEach(function(b,a,c){c=i.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,a)+i.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,b),g.writeVarint32(this.id<<3|j.WIRE_TYPES.LDELIM),g.writeVarint32(c),g.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,a,g),g.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,b,g)},this):this.hasWirePresence(b,a)&&(g.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,b,g))}catch(a){throw Error("Illegal value for "+this.toString(!0)+": "+b+" ("+a+")")}return g},a.calculate=function(b,a){if(b=this.verifyValue(b),null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===b||this.repeated&&0==b.length)return 0;var f=0;try{if(this.repeated){var c,d;if(this.options.packed&&0<=j.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)){for(f+=i.calculateVarint32(this.id<<3|j.WIRE_TYPES.LDELIM),c=d=0;c<b.length;c++)d+=this.element.calculateLength(this.id,b[c]);f+=i.calculateVarint32(d),f+=d}else for(c=0;c<b.length;c++)f+=i.calculateVarint32(this.id<<3|this.type.wireType),f+=this.element.calculateLength(this.id,b[c])}else this.map?b.forEach(function(b,a){b=i.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,a)+i.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,b),f+=i.calculateVarint32(this.id<<3|j.WIRE_TYPES.LDELIM),f+=i.calculateVarint32(b),f+=b},this):this.hasWirePresence(b,a)&&(f+=i.calculateVarint32(this.id<<3|this.type.wireType),f+=this.element.calculateLength(this.id,b))}catch(a){throw Error("Illegal value for "+this.toString(!0)+": "+b+" ("+a+")")}return f},a.decode=function(b,a,c){if(!(!this.map&&b==this.type.wireType||!c&&this.repeated&&this.options.packed&&b==j.WIRE_TYPES.LDELIM||this.map&&b==j.WIRE_TYPES.LDELIM))throw Error("Illegal wire type for field "+this.toString(!0)+": "+b+" ("+this.type.wireType+" expected)");if(b==j.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&0<=j.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)&&!c){for(b=a.readVarint32(),b=a.offset+b,c=[];a.offset<b;)c.push(this.decode(this.type.wireType,a,!0));return c}if(this.map){var e=n.defaultFieldValue(this.keyType);if(c=n.defaultFieldValue(this.type),b=a.readVarint32(),a.remaining()<b)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+b+" required but got only "+a.remaining());var g=a.clone();for(g.limit=g.offset+b,a.offset+=b;0<g.remaining();)if(a=g.readVarint32(),b=7&a,a>>>=3,1===a)e=this.keyElement.decode(g,b,a);else if(2===a)c=this.element.decode(g,b,a);else throw Error("Unexpected tag in map field key/value submessage");return[e,c]}return this.element.decode(a,b,this.id)},g.Message.Field=p,a=function(c,a,b,d,e,g,f){p.call(this,c,a,b,null,d,e,g,f)},a.prototype=Object.create(p.prototype),g.Message.ExtensionField=a,g.Message.OneOf=function(d,a,b){m.call(this,d,a,b),this.fields=[]};var f=function(a,b,c,d,e){k.call(this,a,b,c,d,e),this.className="Enum",this.object=null};f.getName=function(f,a){for(var b,e=Object.keys(f),c=0;c<e.length;++c)if(f[b=e[c]]===a)return b;return null},(f.prototype=Object.create(k.prototype)).build=function(b){if(this.object&&!b)return this.object;b=new j.Builder.Enum;for(var g=this.getChildren(f.Value),c=0,d=g.length;c<d;++c)b[g[c].name]=g[c].id;return Object.defineProperty&&Object.defineProperty(b,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=b},g.Enum=f,a=function(e,a,b,c){m.call(this,e,a,b),this.className="Enum.Value",this.id=c},a.prototype=Object.create(m.prototype),g.Enum.Value=a;var q=function(e,a,b,c){m.call(this,e,a,b),this.field=c};q.prototype=Object.create(m.prototype),g.Extension=q;var l=function(a,b,c,d){k.call(this,a,b,c,d),this.className="Service",this.clazz=null};(l.prototype=Object.create(k.prototype)).build=function(b){return this.clazz&&!b?this.clazz:this.clazz=function(f,g){for(var h=function(a){f.Builder.Service.call(this),this.rpcImpl=a||function(d,a,b){setTimeout(b.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},c=h.prototype=Object.create(f.Builder.Service.prototype),a=g.getChildren(f.Reflect.Service.RPCMethod),d=0;d<a.length;d++)(function(f){c[f.name]=function(a,b){try{try{a=f.resolvedRequestType.clazz.decode(i.wrap(a))}catch(a){if(!(a instanceof TypeError))throw a}if(null===a||"object"!=typeof a)throw Error("Illegal arguments");a instanceof f.resolvedRequestType.clazz||(a=new f.resolvedRequestType.clazz(a)),this.rpcImpl(f.fqn(),a,function(a,c){if(a)b(a);else{null===c&&(c="");try{c=f.resolvedResponseType.clazz.decode(c)}catch(a){}c&&c instanceof f.resolvedResponseType.clazz?b(null,c):b(Error("Illegal response type received in service method "+g.name+"#"+f.name))}})}catch(a){setTimeout(b.bind(this,a),0)}},h[f.name]=function(a,b,c){new h(a)[f.name](b,c)},Object.defineProperty&&(Object.defineProperty(h[f.name],"$options",{value:f.buildOpt()}),Object.defineProperty(c[f.name],"$options",{value:h[f.name].$options}))})(a[d]);return Object.defineProperty&&(Object.defineProperty(h,"$options",{value:g.buildOpt()}),Object.defineProperty(c,"$options",{value:h.$options}),Object.defineProperty(h,"$type",{value:g}),Object.defineProperty(c,"$type",{value:g})),h}(j,this)},g.Service=l;var r=function(e,a,b,c){m.call(this,e,a,b),this.className="Service.Method",this.options=c||{}};return(r.prototype=Object.create(m.prototype)).buildOpt=h.buildOpt,g.Service.Method=r,h=function(g,a,b,c,d,e,h,f){r.call(this,g,a,b,f),this.className="Service.RPCMethod",this.requestName=c,this.responseName=d,this.requestStream=e,this.responseStream=h,this.resolvedResponseType=this.resolvedRequestType=null},h.prototype=Object.create(r.prototype),g.Service.RPCMethod=h,g}(a),a.Builder=function(f,b,g){function e(c){c.messages&&c.messages.forEach(function(a){a.syntax=c.syntax,e(a)}),c.enums&&c.enums.forEach(function(a){a.syntax=c.syntax})}var h=function(b){this.ptr=this.ns=new g.Namespace(this,null,""),this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=b||{}},a=h.prototype;return h.isMessage=function(b){return"string"!=typeof b.name||"undefined"!=typeof b.values||"undefined"!=typeof b.rpc?!1:!0},h.isMessageField=function(b){return"string"!=typeof b.rule||"string"!=typeof b.name||"string"!=typeof b.type||"undefined"==typeof b.id?!1:!0},h.isEnum=function(b){return"string"==typeof b.name&&"undefined"!=typeof b.values&&Array.isArray(b.values)&&0!==b.values.length},h.isService=function(b){return"string"==typeof b.name&&"object"==typeof b.rpc&&b.rpc},h.isExtend=function(b){return"string"==typeof b.ref},a.reset=function(){return this.ptr=this.ns,this},a.define=function(c){if("string"!=typeof c||!b.TYPEREF.test(c))throw Error("illegal namespace: "+c);return c.split(".").forEach(function(c){var a=this.ptr.getChild(c);null===a&&this.ptr.addChild(a=new g.Namespace(this,this.ptr,c)),this.ptr=a},this),this},a.create=function(b){if(!b)return this;if(Array.isArray(b)){if(0===b.length)return this;b=b.slice()}else b=[b];for(var e=[b];0<e.length;){if(b=e.pop(),!Array.isArray(b))throw Error("not a valid namespace: "+JSON.stringify(b));for(;0<b.length;){var d=b.shift();if(h.isMessage(d)){var i=new g.Message(this,this.ptr,d.name,d.options,d.isGroup,d.syntax),j={};d.oneofs&&Object.keys(d.oneofs).forEach(function(b){i.addChild(j[b]=new g.Message.OneOf(this,i,b))},this),d.fields&&d.fields.forEach(function(c){if(null!==i.getChild(0|c.id))throw Error("duplicate or invalid field id in "+i.name+": "+c.id);if(c.options&&"object"!=typeof c.options)throw Error("illegal field options in "+i.name+"#"+c.name);var a=null;if("string"==typeof c.oneof&&!(a=j[c.oneof]))throw Error("illegal oneof in "+i.name+"#"+c.name+": "+c.oneof);c=new g.Message.Field(this,i,c.rule,c.keytype,c.type,c.name,c.id,c.options,a,d.syntax),a&&a.fields.push(c),i.addChild(c)},this);var c=[];if(d.enums&&d.enums.forEach(function(b){c.push(b)}),d.messages&&d.messages.forEach(function(b){c.push(b)}),d.services&&d.services.forEach(function(b){c.push(b)}),d.extensions&&(i.extensions="number"==typeof d.extensions[0]?[d.extensions]:d.extensions),this.ptr.addChild(i),0<c.length){e.push(b),b=c,c=null,this.ptr=i,i=null;continue}c=null}else if(h.isEnum(d))i=new g.Enum(this,this.ptr,d.name,d.options,d.syntax),d.values.forEach(function(b){i.addChild(new g.Enum.Value(this,i,b.name,b.id))},this),this.ptr.addChild(i);else if(h.isService(d))i=new g.Service(this,this.ptr,d.name,d.options),Object.keys(d.rpc).forEach(function(c){var a=d.rpc[c];i.addChild(new g.Service.RPCMethod(this,i,c,a.request,a.response,!!a.request_stream,!!a.response_stream,a.options))},this),this.ptr.addChild(i);else if(!h.isExtend(d))throw Error("not a valid definition: "+JSON.stringify(d));else if(i=this.ptr.resolve(d.ref,!0))d.fields.forEach(function(h){if(null!==i.getChild(0|h.id))throw Error("duplicate extended field id in "+i.name+": "+h.id);if(i.extensions){var a=!1;if(i.extensions.forEach(function(c){h.id>=c[0]&&h.id<=c[1]&&(a=!0)}),!a)throw Error("illegal extended field id in "+i.name+": "+h.id+" (not within valid ranges)")}var b=h.name;this.options.convertFieldsToCamelCase&&(b=f.Util.toCamelCase(b));var b=new g.Message.ExtensionField(this,i,h.rule,h.type,this.ptr.fqn()+"."+b,h.id,h.options),d=new g.Extension(this,this.ptr,h.name,b);b.extension=d,this.ptr.addChild(d),i.addChild(b)},this);else if(!/\.?google\.protobuf\./.test(d.ref))throw Error("extended message "+d.ref+" is not defined");i=d=null}b=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},a["import"]=function(g,a){var b="/";if("string"==typeof a){if(f.Util.IS_NODE&&(a=require("path").resolve(a)),!0===this.files[a])return this.reset();this.files[a]=!0}else if("object"==typeof a){var i=a.root;if(f.Util.IS_NODE&&(i=require("path").resolve(i)),(0<=i.indexOf("\\")||0<=a.file.indexOf("\\"))&&(b="\\"),i=i+b+a.file,!0===this.files[i])return this.reset();this.files[i]=!0}if(g.imports&&0<g.imports.length){var j=!1;"object"==typeof a?(this.importRoot=a.root,j=!0,i=this.importRoot,a=a.file,0<=i.indexOf("\\")||0<=a.indexOf("\\"))&&(b="\\"):"string"==typeof a?this.importRoot?i=this.importRoot:0<=a.indexOf("/")?(i=a.replace(/\/[^\/]*$/,""),""===i&&(i="/")):0<=a.indexOf("\\")?(i=a.replace(/\\[^\\]*$/,""),b="\\"):i=".":i=null;for(var k=0;k<g.imports.length;k++)if("string"==typeof g.imports[k]){if(!i)throw Error("cannot determine import root");var c=g.imports[k];if("google/protobuf/descriptor.proto"!==c&&(c=i+b+c,!0!==this.files[c])){/\.proto$/i.test(c)&&!f.DotProto&&(c=c.replace(/\.proto$/,".json"));var l=f.Util.fetch(c);if(null===l)throw Error("failed to import '"+c+"' in '"+a+"': file not found");/\.json$/i.test(c)?this["import"](JSON.parse(l+""),c):this["import"](f.DotProto.Parser.parse(l),c)}}else a?/\.(\w+)$/.test(a)?this["import"](g.imports[k],a.replace(/^(.+)\.(\w+)$/,function(d,a,b){return a+"_import"+k+"."+b})):this["import"](g.imports[k],a+"_import"+k):this["import"](g.imports[k]);j&&(this.importRoot=null)}g["package"]&&this.define(g["package"]),g.syntax&&e(g);var m=this.ptr;return g.options&&Object.keys(g.options).forEach(function(a){m.options[a]=g.options[a]}),g.messages&&(this.create(g.messages),this.ptr=m),g.enums&&(this.create(g.enums),this.ptr=m),g.services&&(this.create(g.services),this.ptr=m),g["extends"]&&this.create(g["extends"]),this.reset()},a.resolveAll=function(){var c;if(null==this.ptr||"object"==typeof this.ptr.type)return this;if(this.ptr instanceof g.Namespace)this.ptr.children.forEach(function(b){this.ptr=b,this.resolveAll()},this);else if(this.ptr instanceof g.Message.Field){if(b.TYPE.test(this.ptr.type))this.ptr.type=f.TYPES[this.ptr.type];else{if(!b.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(c=(this.ptr instanceof g.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0),!c)throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(this.ptr.resolvedType=c,c instanceof g.Enum){if(this.ptr.type=f.TYPES["enum"],"proto3"===this.ptr.syntax&&"proto3"!==c.syntax)throw Error("proto3 message cannot reference proto2 enum");}else if(c instanceof g.Message)this.ptr.type=c.isGroup?f.TYPES.group:f.TYPES.message;else throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type)}if(this.ptr.map){if(!b.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=f.TYPES[this.ptr.keyType]}}else if(this.ptr instanceof f.Reflect.Service.Method){if(this.ptr instanceof f.Reflect.Service.RPCMethod){if(c=this.ptr.parent.resolve(this.ptr.requestName,!0),!(c&&c instanceof f.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=c,c=this.ptr.parent.resolve(this.ptr.responseName,!0),!(c&&c instanceof f.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=c}else throw Error("illegal service type in "+this.ptr.toString(!0));}else if(!(this.ptr instanceof f.Reflect.Message.OneOf||this.ptr instanceof f.Reflect.Extension||this.ptr instanceof f.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()},a.build=function(c){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!c)return this.result;c="string"==typeof c?c.split("."):c;for(var e=this.result,b=0;b<c.length;b++)if(e[c[b]])e=e[c[b]];else{e=null;break}return e},a.lookup=function(c,a){return c?this.ns.resolve(c,a):this.ns},a.toString=function(){return"Builder"},h.Message=function(){},h.Enum=function(){},h.Service=function(){},h}(a,a.Lang,a.Reflect),a.Map=function(a,g){function c(c){var b=0;return{next:function(){return b<c.length?{done:!1,value:c[b++]}:{done:!0}}}}var b=function(d,b){if(!d.map)throw Error("field is not a map");if(this.field=d,this.keyElem=new g.Element(d.keyType,null,!0,d.syntax),this.valueElem=new g.Element(d.type,d.resolvedType,!1,d.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),b)for(var a=Object.keys(b),e=0;e<a.length;e++){var f=this.keyElem.valueFromString(a[e]),i=this.valueElem.verifyValue(b[a[e]]);this.map[this.keyElem.valueToString(f)]={key:f,value:i}}},d=b.prototype;return d.clear=function(){this.map={}},d["delete"]=function(c){c=this.keyElem.valueToString(this.keyElem.verifyValue(c));var b=c in this.map;return delete this.map[c],b},d.entries=function(){for(var e,f=[],b=Object.keys(this.map),a=0;a<b.length;a++)f.push([(e=this.map[b[a]]).key,e.value]);return c(f)},d.keys=function(){for(var e=[],b=Object.keys(this.map),a=0;a<b.length;a++)e.push(this.map[b[a]].key);return c(e)},d.values=function(){for(var e=[],b=Object.keys(this.map),a=0;a<b.length;a++)e.push(this.map[b[a]].value);return c(e)},d.forEach=function(c,b){for(var a,e=Object.keys(this.map),d=0;d<e.length;d++)c.call(b,(a=this.map[e[d]]).value,a.key,this)},d.set=function(c,b){var a=this.keyElem.verifyValue(c),e=this.valueElem.verifyValue(b);return this.map[this.keyElem.valueToString(a)]={key:a,value:e},this},d.get=function(a){return a=this.keyElem.valueToString(this.keyElem.verifyValue(a)),a in this.map?this.map[a].value:void 0},d.has=function(a){return this.keyElem.valueToString(this.keyElem.verifyValue(a))in this.map},b}(a,a.Reflect),a.loadProto=function(c,b,d){return("string"==typeof b||b&&"string"==typeof b.file&&"string"==typeof b.root)&&(d=b,b=void 0),a.loadJson(a.DotProto.Parser.parse(c),b,d)},a.protoFromString=a.loadProto,a.loadProtoFile=function(c,d,e){if(d&&"object"==typeof d?(e=d,d=null):d&&"function"==typeof d||(d=null),d)return a.Util.fetch("string"==typeof c?c:c.root+"/"+c.file,function(b){if(null===b)d(Error("Failed to fetch file"));else try{d(null,a.loadProto(b,e,c))}catch(a){d(a)}});var f=a.Util.fetch("object"==typeof c?c.root+"/"+c.file:c);return null===f?null:a.loadProto(f,e,c)},a.protoFromFile=a.loadProtoFile,a.newBuilder=function(c){return c=c||{},"undefined"==typeof c.convertFieldsToCamelCase&&(c.convertFieldsToCamelCase=a.convertFieldsToCamelCase),"undefined"==typeof c.populateAccessors&&(c.populateAccessors=a.populateAccessors),new a.Builder(c)},a.loadJson=function(c,d,e){return("string"==typeof d||d&&"string"==typeof d.file&&"string"==typeof d.root)&&(e=d,d=null),d&&"object"==typeof d||(d=a.newBuilder()),"string"==typeof c&&(c=JSON.parse(c)),d["import"](c,e),d.resolveAll(),d},a.loadJsonFile=function(c,d,e){if(d&&"object"==typeof d?(e=d,d=null):d&&"function"==typeof d||(d=null),d)return a.Util.fetch("string"==typeof c?c:c.root+"/"+c.file,function(b){if(null===b)d(Error("Failed to fetch file"));else try{d(null,a.loadJson(JSON.parse(b),e,c))}catch(a){d(a)}});var f=a.Util.fetch("object"==typeof c?c.root+"/"+c.file:c);return null===f?null:a.loadJson(JSON.parse(f),e,c)},a})})(); 
 			});
 		define("game.js", function(require, module, exports){ 			
(function(){require('engine.js'),window.Long=require('long.js'),window.DEBUG=!0,window.showEnvSwitch=!1,window.showGmPanel=!1,window.showEnvSwitch?!(window.serverEnv=wx.getStorageSync('serverEnv'))&&(window.serverEnv='daily'):window.serverEnv='online',window.GetCurVersion=function(){return'v0.1.1.1'},window.remoteResPath='https://h5game.qq.com/tg130/',window.LocalResManager=require('LocalResManager.js'),window.RemoveLogic=require('RemoveLogic.js'),window.alert=function(a){wx.showModal({title:'',content:a,showCancel:!1})},require('Service.js'),require('App.js')})(); 
 			}); 	require("game.js");
 	